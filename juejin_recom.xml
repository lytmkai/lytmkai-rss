<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>æ˜é‡‘æ–‡ç« æ¨è</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…æˆé•¿çš„ç¤¾åŒº</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[ã€ŠJavaScript Promise å®Œå…¨è§£æï¼šexecutorã€çŠ¶æ€ä¸é“¾å¼è°ƒç”¨ã€‹]]></title>    <link>https://juejin.cn/post/7570912420568416266</link>    <guid>https://juejin.cn/post/7570912420568416266</guid>    <pubDate>2025-11-10T15:16:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570912420568416266" data-draft-id="7570912420568268810" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€ŠJavaScript Promise å®Œå…¨è§£æï¼šexecutorã€çŠ¶æ€ä¸é“¾å¼è°ƒç”¨ã€‹"/> <meta itemprop="keywords" content="Promise,JavaScript"/> <meta itemprop="datePublished" content="2025-11-10T15:16:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="xhxxx"/> <meta itemprop="url" content="https://juejin.cn/user/3235201610941578"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€ŠJavaScript Promise å®Œå…¨è§£æï¼šexecutorã€çŠ¶æ€ä¸é“¾å¼è°ƒç”¨ã€‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3235201610941578/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    xhxxx
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T15:16:14.000Z" title="Mon Nov 10 2025 15:16:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ·±å…¥ç†è§£ JavaScript Promiseï¼šä»æ„é€ åˆ°çŠ¶æ€æµè½¬</h2>
<p>åœ¨ç°ä»£ JavaScript å¼€å‘ä¸­ï¼Œ<code>Promise</code> å·²æˆä¸ºå¤„ç†å¼‚æ­¥æ“ä½œçš„æ ‡å‡†å·¥å…·ã€‚ä½†å¾ˆå¤šäººåªæ˜¯â€œä¼šç”¨â€ï¼Œå´ä¸ç†è§£å®ƒèƒŒåçš„è¿è¡Œæœºåˆ¶ã€‚æœ¬æ–‡å°†å¸¦ä½ ä»é›¶å¼€å§‹ï¼Œæ·±å…¥å‰–æ <code>Promise</code> çš„<strong>æ„é€ æ–¹å¼ã€å†…éƒ¨çŠ¶æ€å˜åŒ–è§„åˆ™</strong>ï¼Œä»¥åŠ <code>.then()</code> å’Œ <code>.catch()</code> æ˜¯å¦‚ä½•ååŒå·¥ä½œçš„ã€‚</p>
<hr/>
<h3 data-id="heading-1">ä¸€ã€Promise æ˜¯å¦‚ä½•æ„é€ çš„ï¼Ÿ</h3>
<p><code>Promise</code> æ˜¯ä¸€ä¸ªå†…ç½®çš„æ„é€ å‡½æ•°ï¼Œé€šè¿‡ <code>new Promise()</code> åˆ›å»ºå®ä¾‹ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> myPromise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
  <span class="hljs-comment">// executorï¼ˆæ‰§è¡Œå™¨ï¼‰å‡½æ•°</span>
});
</code></pre>
<h4 data-id="heading-2">æ„é€ å‡½æ•°æ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼š<strong>executor å‡½æ•°</strong></h4>
<ul>
<li>
<p>è¿™ä¸ªå‡½æ•°ä¼š<strong>ç«‹å³åŒæ­¥æ‰§è¡Œ</strong>ï¼ˆä¸æ˜¯å¼‚æ­¥ï¼ï¼‰ã€‚</p>
</li>
<li>
<h3 data-id="heading-3">Promiseæœ‰ä¸‰ç§çŠ¶æ€</h3>
</li>
<li>
<ul>
<li><strong>pending(å¾…å®š)</strong></li>
</ul>
</li>
<li>
<ul>
<li><strong>fulfilled(å·²å…‘ç°)</strong></li>
</ul>
</li>
<li>
<ul>
<li><strong>rejected(å·²æ‹’ç»)</strong></li>
</ul>
</li>
<li>
<h3 data-id="heading-4">Promiseä¸¤ä¸ªå†…éƒ¨å±æ€§</h3>
</li>
<li>
<ul>
<li><strong>state</strong></li>
</ul>
</li>
<li>
<ul>
<li><strong>result</strong></li>
</ul>
</li>
<li>
<h3 data-id="heading-5">Promiseæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š</h3>
<ul>
<li>
<p><code>resolve(value)</code>ï¼šç”¨äºå°† Promise stateå˜ä¸º <strong>fulfilledï¼ˆæˆåŠŸï¼‰</strong>ã€resultï¼š<strong>value</strong></p>
</li>
<li>
<p><code>reject(error)</code>ï¼šç”¨äºå°† Promise stateå˜ä¸º <strong>rejectedï¼ˆå¤±è´¥ï¼‰</strong>ã€resultï¼š<strong>error</strong></p>
</li>
</ul>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/988d61b78816441fb8b092cce22c4cfd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGh4eHg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763394768&amp;x-signature=QaDp3oe0gr0PVVRNuAh1BtISfdE%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>æ³¨æ„ï¼šå³ä½¿ä½ æ²¡æœ‰è°ƒç”¨ <code>resolve</code> æˆ– <code>reject</code>ï¼ŒPromise ä¹Ÿä¼šä¸€ç›´å¤„äº <code>pending</code> çŠ¶æ€ï¼Œæ°¸è¿œä¸ä¼šå®Œæˆã€‚</p>
</blockquote>
<h4 data-id="heading-6">ç¤ºä¾‹ï¼šåŸºæœ¬æ„é€ </h4>
<pre><code class="hljs language-js" lang="js"> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">1</span>);
        <span class="hljs-comment">//Promise å¼‚æ­¥ä»»åŠ¡åŒæ­¥åŒ–</span>
        <span class="hljs-comment">//è®¸è¯º Promise åŒ…å«ä¸€ä¸ªè€—æ—¶æ€§çš„ä»»åŠ¡</span>
        <span class="hljs-keyword">const</span> p=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>)=&gt;</span>{
            <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">2</span>);
            <span class="hljs-title function_">resolve</span>();
        }, <span class="hljs-number">3000</span>);
     
        })
        p.<span class="hljs-title function_">then</span>(<span class="hljs-function">()=&gt;</span>{
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">3</span>);
        })
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">4</span>);
</code></pre>
<p>è¾“å‡ºé¡ºåºï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3b2f2ad18a447b5af5d23e7b5a1f065~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGh4eHg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763394768&amp;x-signature=yg%2Bn1x9mwWFYqBngS0vrdMdZ82A%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs">1å’Œ4ä½œä¸ºåŒæ­¥ä»»åŠ¡å…ˆæ‰§è¡Œ
2åœ¨3ç§’åè¾“å‡º
å½“å¼‚æ­¥ä»»åŠ¡ç»“æŸæˆåŠŸå.thenå¤„ç†å‡½æ•°è¾“å‡º3
</code></pre>
<p>è¿™è¯´æ˜ï¼š<strong>executor æ˜¯åŒæ­¥æ‰§è¡Œçš„ï¼Œä½†å…¶ä¸­çš„å¼‚æ­¥é€»è¾‘ï¼ˆå¦‚ setTimeoutï¼‰ä¼šè¢«æ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—</strong>ã€‚</p>
<hr/>
<h3 data-id="heading-7">äºŒã€Promise çŠ¶æ€çš„ä¸å¯é€†æ€§</h3>
<h4 data-id="heading-8">çŠ¶æ€ä¸€æ—¦æ”¹å˜ï¼Œå°±ä¸å¯é€†è½¬</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> p = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
  <span class="hljs-title function_">resolve</span>(<span class="hljs-string">'ç¬¬ä¸€æ¬¡ resolve'</span>);
  <span class="hljs-title function_">resolve</span>(<span class="hljs-string">'ç¬¬äºŒæ¬¡ resolve'</span>); <span class="hljs-comment">// æ— æ•ˆï¼</span>
  <span class="hljs-title function_">reject</span>(<span class="hljs-string">'å°è¯• reject'</span>);     <span class="hljs-comment">// ä¹Ÿæ— æ•ˆï¼</span>
});

p.<span class="hljs-title function_">then</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">log</span>); <span class="hljs-comment">// åªè¾“å‡º "ç¬¬ä¸€æ¬¡ resolve"</span>
</code></pre>
<blockquote>
<p>executor åªèƒ½è°ƒç”¨ä¸€ä¸ªÂ <code>resolve</code>Â æˆ–ä¸€ä¸ªÂ <code>reject</code>ã€‚ä»»ä½•çŠ¶æ€çš„æ›´æ”¹éƒ½æ˜¯æœ€ç»ˆçš„ã€‚
æ‰€æœ‰å…¶ä»–çš„å†å¯¹Â <code>resolve</code>Â å’ŒÂ <code>reject</code>Â çš„è°ƒç”¨éƒ½ä¼šè¢«å¿½ç•¥ï¼š</p>
</blockquote>
<hr/>
<h3 data-id="heading-9">ä¸‰ã€<code>.then()</code>ï¼šç›‘å¬çŠ¶æ€å˜åŒ–çš„æ¡¥æ¢</h3>
<p><code>.then()</code> æ˜¯ Promise æœ€æ ¸å¿ƒçš„æ–¹æ³•ï¼Œç”¨äºæ³¨å†Œ<strong>æˆåŠŸå’Œå¤±è´¥çš„å›è°ƒå‡½æ•°</strong>ã€‚</p>
<h4 data-id="heading-10">è¯­æ³•</h4>
<pre><code class="hljs language-js" lang="js">promise.<span class="hljs-title function_">then</span>(
  onFulfilled,   <span class="hljs-comment">// å½“çŠ¶æ€å˜ä¸º fulfilled æ—¶è°ƒç”¨</span>
  onRejected     <span class="hljs-comment">// å½“çŠ¶æ€å˜ä¸º rejected æ—¶è°ƒç”¨ï¼ˆå¯é€‰ï¼‰</span>
);
</code></pre>
<p><strong>æ¯æ¬¡åªæ ¹æ®å¼‚æ­¥å¤„ç†ç»“æœè¿è¡Œä¸€ä¸ªå‡½æ•°</strong></p>
<h4 data-id="heading-11">å…³é”®ç‰¹æ€§</h4>
<ol>
<li><strong><code>.then()</code> æ€»æ˜¯è¿”å›ä¸€ä¸ªæ–°çš„ Promise</strong>ï¼Œæ”¯æŒé“¾å¼è°ƒç”¨ã€‚</li>
<li>å¦‚æœ <code>onFulfilled</code> è¿”å›ä¸€ä¸ªå€¼ï¼Œæ–° Promise ä¼šè¢« <code>resolve</code> è¯¥å€¼ã€‚</li>
<li>å¦‚æœ <code>onFulfilled</code> æŠ›å‡ºå¼‚å¸¸ï¼Œæ–° Promise ä¼šè¢« <code>reject</code>ã€‚</li>
</ol>
<h4 data-id="heading-12">ç¤ºä¾‹ï¼šæˆåŠŸä¸å¤±è´¥å¤„ç†</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> p = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
  <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() &gt; <span class="hljs-number">0.5</span> ? <span class="hljs-title function_">resolve</span>(<span class="hljs-string">'OK'</span>) : <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'NO'</span>));
});

p.<span class="hljs-title function_">then</span>(
  <span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">' æˆåŠŸ:'</span>, result),
  <span class="hljs-function"><span class="hljs-params">error</span>  =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">' å¤±è´¥:'</span>, error.<span class="hljs-property">message</span>)
);
</code></pre>
<blockquote>
<p>æç¤ºï¼šè™½ç„¶ <code>.then()</code> æ”¯æŒä¸¤ä¸ªå‚æ•°ï¼Œä½†æ›´æ¨èä½¿ç”¨ <code>.catch()</code> ç»Ÿä¸€å¤„ç†é”™è¯¯ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-13">å››ã€<code>.catch()</code>ï¼šä¸“ä¸ºé”™è¯¯è®¾è®¡çš„å¤„ç†å™¨</h3>
<p><code>.catch(onRejected)</code> æ˜¯ <code>.then(null, onRejected)</code> çš„è¯­æ³•ç³–ã€‚</p>
<pre><code class="hljs language-ini" lang="ini">promise
  .then(<span class="hljs-attr">result</span> =&gt; { /* å¤„ç†æˆåŠŸ */ })
  .catch(<span class="hljs-attr">error</span> =&gt; { /* å¤„ç†å¤±è´¥ */ })<span class="hljs-comment">;</span>
</code></pre>
<h4 data-id="heading-14">ä¸ºä»€ä¹ˆæ¨èç”¨ <code>.catch()</code>ï¼Ÿ</h4>
<ul>
<li><strong>ç»Ÿä¸€é”™è¯¯æ•è·</strong>ï¼šé“¾å¼è°ƒç”¨ä¸­ï¼Œä»»ä½•ä¸€ä¸ªç¯èŠ‚æŠ›å‡ºå¼‚å¸¸ï¼Œéƒ½ä¼šè¢«åç»­çš„ <code>.catch()</code> æ•è·ã€‚</li>
<li><strong>é¿å…é—æ¼é”™è¯¯å¤„ç†</strong>ï¼šå¦‚æœåªç”¨ <code>.then()</code> çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œæ— æ³•æ•è· <code>.then()</code> å›è°ƒå†…éƒ¨çš„é”™è¯¯ã€‚</li>
</ul>
<h4 data-id="heading-15">å¯¹æ¯”ç¤ºä¾‹</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">//  ä¸æ¨èï¼šæ— æ³•æ•è· then å†…éƒ¨çš„é”™è¯¯</span>
promise.<span class="hljs-title function_">then</span>(
  <span class="hljs-function">() =&gt;</span> { <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Oops!'</span>); },
  <span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'è¿™é‡Œä¸ä¼šæ‰§è¡Œï¼'</span>)
);

<span class="hljs-comment">//  æ¨èï¼šèƒ½æ•è·æ‰€æœ‰å‰é¢çš„é”™è¯¯</span>
promise
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> { <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Oops!'</span>); })
  .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ•è·åˆ°äº†:'</span>, err.<span class="hljs-property">message</span>));
</code></pre>
<blockquote>
<p><strong>.catch</strong>å…¶å®æ˜¯.thenå¤„ç†é”™è¯¯çš„ä¸€ç§ç®€å†™æ–¹å¼.catch(f)è°ƒç”¨æ˜¯.then(null,f)çš„ä¸€ç§æ¨¡æ‹Ÿ</p>
</blockquote>
<hr/>
<h3 data-id="heading-16">ğŸ”— äº”ã€é“¾å¼è°ƒç”¨ä¸çŠ¶æ€ä¼ é€’</h3>
<p>ç”±äº <code>.then()</code> å’Œ <code>.catch()</code> éƒ½è¿”å›æ–°çš„ Promiseï¼Œæˆ‘ä»¬å¯ä»¥æ„å»ºæ¸…æ™°çš„å¼‚æ­¥æµç¨‹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">fetchUser()
  .then(<span class="hljs-attr">user</span> =&gt; fetchPosts(user.id))
  .then(<span class="hljs-attr">posts</span> =&gt; render(posts))
  .catch(<span class="hljs-attr">err</span> =&gt; showError(err))<span class="hljs-comment">;</span>
</code></pre>
<p>åœ¨è¿™ä¸ªé“¾æ¡ä¸­ï¼š</p>
<ul>
<li>æ¯ä¸€æ­¥çš„è¿”å›å€¼ä¼šä½œä¸ºä¸‹ä¸€æ­¥çš„è¾“å…¥ï¼›</li>
<li>ä»»ä½•ä¸€æ­¥å‡ºé”™ï¼Œéƒ½ä¼šè·³è½¬åˆ°æœ€è¿‘çš„ <code>.catch()</code>ã€‚</li>
</ul>
<hr/>
<hr/>
<h3 data-id="heading-17">æ€»ç»“ï¼šPromise çš„æ ¸å¿ƒå¿ƒæ™ºæ¨¡å‹</h3>
<ol>
<li><strong>æ„é€ å³æ‰§è¡Œ</strong>ï¼š<code>new Promise(executor)</code> ä¼šç«‹å³è¿è¡Œ executorã€‚</li>
<li><strong>çŠ¶æ€å•å‘ä¸å¯é€†</strong>ï¼š<code>pending â†’ fulfilled</code> æˆ– <code>pending â†’ rejected</code>ï¼Œä»…ä¸€æ¬¡ã€‚</li>
<li><strong><code>.then()</code> æ˜¯è§‚å¯Ÿè€…</strong>ï¼šæ ¹æ®çŠ¶æ€å†³å®šè°ƒç”¨å“ªä¸ªå›è°ƒã€‚</li>
<li><strong><code>.catch()</code> æ˜¯å®‰å…¨ç½‘</strong>ï¼šé›†ä¸­å¤„ç†æ•´ä¸ªé“¾è·¯çš„å¼‚å¸¸ã€‚</li>
<li><strong>é“¾å¼è°ƒç”¨é è¿”å›æ–° Promise</strong>ï¼šå®ç°å¼‚æ­¥æµç¨‹çš„çº¿æ€§è¡¨è¾¾ã€‚</li>
</ol>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä» "å¤–å–ç‚¹å•" åˆ° Promiseï¼šæ­ç§˜ JavaScript å¼‚æ­¥çš„åº•å±‚é€»è¾‘]]></title>    <link>https://juejin.cn/post/7570912420568432650</link>    <guid>https://juejin.cn/post/7570912420568432650</guid>    <pubDate>2025-11-10T15:17:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570912420568432650" data-draft-id="7571060853354119178" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä» &quot;å¤–å–ç‚¹å•&quot; åˆ° Promiseï¼šæ­ç§˜ JavaScript å¼‚æ­¥çš„åº•å±‚é€»è¾‘"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript"/> <meta itemprop="datePublished" content="2025-11-10T15:17:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç™½å…°åœ°ç©ºç“¶"/> <meta itemprop="url" content="https://juejin.cn/user/191753514127514"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä» "å¤–å–ç‚¹å•" åˆ° Promiseï¼šæ­ç§˜ JavaScript å¼‚æ­¥çš„åº•å±‚é€»è¾‘
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/191753514127514/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç™½å…°åœ°ç©ºç“¶
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T15:17:24.000Z" title="Mon Nov 10 2025 15:17:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>ä½ æ˜¯å¦ç»å†è¿‡è¿™äº›åœºæ™¯ï¼Ÿ</strong></p>
<ul>
<li>æ‰“å¼€ç½‘é¡µç‚¹å‡»æŒ‰é’®ï¼Œé¡µé¢ç¬é—´å˜æˆ"å¹»ç¯ç‰‡"å¡æ­»ï¼Ÿ</li>
<li>å†™ä»£ç æ—¶Â <code>console.log(2)</code>Â æ˜æ˜åœ¨Â <code>setTimeout</code>Â åé¢ï¼Œå´å…ˆæ‰“å°äº†Â <code>3</code>ï¼Ÿ</li>
</ul>
<p><strong>è¿™äº›"è¯¡å¼‚"ç°è±¡èƒŒåï¼Œè—ç€ JavaScript å¼‚æ­¥ç¼–ç¨‹çš„æ ¸å¿ƒé€»è¾‘ï¼</strong><br/>
ä½œä¸ºå‰ç«¯å¼€å‘è€…ï¼Œæˆ‘ä»¬æ¯å¤©éƒ½åœ¨å’Œå¼‚æ­¥æ‰“äº¤é“ï¼Œä½†ä½ çœŸçš„ç†è§£å®ƒçš„åº•å±‚åŸç†å—ï¼Ÿ<br/>
ä¸ºä»€ä¹ˆ JS å¿…é¡»æ˜¯å•çº¿ç¨‹ï¼ŸPromise åˆ°åº•è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿfetch çš„åº•å±‚åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ<br/>
<strong>ä»Šå¤©ï¼Œæˆ‘ä»¬å°†é€šè¿‡"å¤–å–ç‚¹å•"çš„ç±»æ¯”ï¼Œä¸€æ­¥æ­¥æ­å¼€ JS å¼‚æ­¥çš„ç¥ç§˜é¢çº±ï¼</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-0">ä¸€ã€ä¸ºä»€ä¹ˆ JS å¿…é¡»æœ‰"å¼‚æ­¥"ï¼Ÿâ€”â€” å•çº¿ç¨‹çš„"ç”Ÿå­˜æ™ºæ…§"</h2>
<h3 data-id="heading-1">ğŸ§¬ JavaScript çš„"åŸºå› "ï¼šå•çº¿ç¨‹è®¾è®¡</h3>
<p><strong>JavaScript æ˜¯å•çº¿ç¨‹è¯­è¨€</strong>â€”â€”åŒä¸€æ—¶é—´åªèƒ½åšä¸€ä»¶äº‹ã€‚<br/>
æƒ³è±¡ä¸€ä¸ªå°å¨æˆ¿é‡Œçš„å¨å¸ˆï¼š</p>
<ul>
<li>ç‚’é’èœæ—¶ä¸èƒ½åŒæ—¶ç…ç‰›æ’</li>
<li>å¿…é¡»ç­‰é’èœå‡ºé”…æ‰èƒ½å¤„ç†ä¸‹ä¸€é“èœ</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ</strong><br/>
å› ä¸º JS æœ€åˆæ˜¯ä¸ºæµè§ˆå™¨æ‰“é€ çš„è„šæœ¬è¯­è¨€ï¼Œè´Ÿè´£ DOM æ“ä½œå’Œäº‹ä»¶å“åº”ï¼š</p>
<blockquote>
<p>âŒ å¦‚æœå…è®¸å¤šçº¿ç¨‹ï¼š<br/>
<em>çº¿ç¨‹Aåˆ é™¤æŒ‰é’®</em>Â +Â <em>çº¿ç¨‹Bç‚¹å‡»æŒ‰é’®</em>Â =Â <strong>é¡µé¢å´©æºƒï¼</strong><br/>
âœ… å•çº¿ç¨‹é¿å…äº†èµ„æºç«äº‰é—®é¢˜ï¼Œä¿è¯æ‰§è¡Œå®‰å…¨</p>
</blockquote>
<hr/>
<h3 data-id="heading-2">âš ï¸ å•çº¿ç¨‹çš„è‡´å‘½é—®é¢˜ï¼šé˜»å¡</h3>
<p>å½“é‡åˆ°è€—æ—¶ä»»åŠ¡æ—¶ï¼ˆå¦‚ç½‘ç»œè¯·æ±‚ï¼‰ï¼Œå•çº¿ç¨‹ä¼š<strong>å®Œå…¨é˜»å¡</strong>ï¼š</p>
<blockquote>
<p>ğŸ² å¨å¸ˆç‚–ä¸€é”…2å°æ—¶çš„æ±¤ â†’ åé¢æ‰€æœ‰å®¢äººå¹²ç­‰ â†’Â <strong>é¡µé¢å¡æ­»ï¼</strong></p>
</blockquote>
<p><strong>è§£å†³æ–¹æ¡ˆï¼šåŒæ­¥ vs å¼‚æ­¥</strong></p>




















<table><thead><tr><th>ä»»åŠ¡ç±»å‹</th><th>ç‰¹ç‚¹</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><strong>åŒæ­¥ä»»åŠ¡</strong></td><td>ç«‹å³æ‰§è¡Œï¼ŒæŒ‰é¡ºåºå®Œæˆ</td><td><code>console.log()</code>ã€å˜é‡å£°æ˜</td></tr><tr><td><strong>å¼‚æ­¥ä»»åŠ¡</strong></td><td>å»¶è¿Ÿå¤„ç†ï¼Œä¸é˜»å¡ä¸»çº¿ç¨‹</td><td><code>setTimeout</code>ã€<code>fetch</code></td></tr></tbody></table>
<p><strong>å¤–å–ç‚¹å•ç±»æ¯”</strong>Â ğŸ”ï¼š</p>
<ol>
<li>å®¢äººä¸‹å•ï¼ˆå‘èµ·å¼‚æ­¥ä»»åŠ¡ï¼‰</li>
<li>æœåŠ¡å‘˜ä¸å‚»ç­‰ â†’ ç»§ç»­æ¥å¾…æ–°å®¢äººï¼ˆæ‰§è¡ŒåŒæ­¥ä»»åŠ¡ï¼‰</li>
<li>èœåšå¥½å â†’ é€šçŸ¥å®¢äººå–é¤ï¼ˆæ‰§è¡Œå›è°ƒï¼‰</li>
</ol>
<blockquote>
<p>ğŸ’¡Â <strong>å¼‚æ­¥çš„æœ¬è´¨</strong>ï¼š<br/>
<strong>æŠŠè€—æ—¶ä»»åŠ¡äº¤ç»™åˆ«äººå¤„ç†ï¼Œè‡ªå·±å…ˆå»åšåˆ«çš„äº‹</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-3">äºŒã€å¼‚æ­¥ä»»åŠ¡å¦‚ä½•"æ’é˜Ÿ"ï¼Ÿâ€”â€” Event Loop çš„å·¥ä½œæµç¨‹</h2>
<h3 data-id="heading-4">ğŸ¦ é“¶è¡ŒåŠç†ä¸šåŠ¡ç±»æ¯”</h3>





















<table><thead><tr><th>ç»„ä»¶</th><th>ç±»æ¯”è¯´æ˜</th></tr></thead><tbody><tr><td><strong>è°ƒç”¨æ ˆ (Call Stack)</strong></td><td>æ­£åœ¨åŠç†ä¸šåŠ¡çš„çª—å£</td></tr><tr><td><strong>ä»»åŠ¡é˜Ÿåˆ— (Task Queue)</strong></td><td>ç­‰å€™åŒºçš„æ’å·å•</td></tr><tr><td><strong>Event Loop</strong></td><td>å«å·å‘˜ï¼šæ£€æŸ¥çª—å£æ˜¯å¦ç©ºé—²javascript</td></tr></tbody></table>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">1</span>); <span class="hljs-comment">// åŒæ­¥ä»»åŠ¡</span>
<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">2</span>); <span class="hljs-comment">// å¼‚æ­¥ä»»åŠ¡</span>
}, <span class="hljs-number">5000</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">3</span>); <span class="hljs-comment">// åŒæ­¥ä»»åŠ¡</span>
</code></pre>
<h3 data-id="heading-5">ğŸ” æ‰§è¡Œæµç¨‹è¯¦è§£</h3>
<ol>
<li><code>console.log(1)</code>Â â†’ æ‰§è¡Œ â†’ è¾“å‡ºÂ <code>1</code>Â â†’ å‡ºæ ˆ âœ…</li>
<li>é‡åˆ°Â <code>setTimeout</code>Â â†’ <strong>äº¤ç»™æµè§ˆå™¨çº¿ç¨‹å¤„ç†</strong> â†’ ç»§ç»­æ‰§è¡Œåç»­ä»£ç </li>
<li><code>console.log(3)</code>Â â†’ æ‰§è¡Œ â†’ è¾“å‡ºÂ <code>3</code>Â â†’ å‡ºæ ˆ âœ…</li>
<li><strong>5ç§’å</strong>ï¼šå®šæ—¶å™¨å®Œæˆ â†’ å›è°ƒå‡½æ•°è¿›å…¥<strong>ä»»åŠ¡é˜Ÿåˆ—</strong></li>
<li>Event Loop æ£€æµ‹åˆ°è°ƒç”¨æ ˆç©ºé—² â†’ å°†å›è°ƒç§»å…¥è°ƒç”¨æ ˆ</li>
<li><code>console.log(2)</code>Â â†’ æ‰§è¡Œ â†’ è¾“å‡ºÂ <code>2</code></li>
</ol>
<p>âœ… <strong>æœ€ç»ˆè¾“å‡ºï¼š<code>1 â†’ 3 â†’ 2</code></strong></p>
<blockquote>
<p>ğŸ“ŒÂ <strong>å…³é”®ç»“è®º</strong>ï¼š<br/>
<strong>å¼‚æ­¥ä»»åŠ¡ä¸ä¼šç«‹åˆ»æ‰§è¡Œï¼Œè€Œæ˜¯ç­‰ä¸»çº¿ç¨‹ç©ºé—²åï¼Œç”± Event Loop ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­å–å‡ºæ‰§è¡Œ</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-6">ä¸‰ã€Promiseï¼šç»™å¼‚æ­¥ä»»åŠ¡ä¸€å¼ "å¯æ§çš„å–é¤å·"</h2>
<h3 data-id="heading-7">ğŸŒªï¸ å›è°ƒåœ°ç‹±é—®é¢˜</h3>
<p>æ—©æœŸå¼‚æ­¥ä»£ç åƒ"å‰¥æ´‹è‘±"ï¼Œå±‚å±‚åµŒå¥—éš¾ä»¥ç»´æŠ¤ï¼šjavascript</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åµŒå¥—ä¸‰å±‚çš„å›è°ƒåœ°ç‹±</span>
<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"ç¬¬ä¸€æ­¥"</span>);
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"ç¬¬äºŒæ­¥"</span>);
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"ç¬¬ä¸‰æ­¥"</span>);
    }, <span class="hljs-number">1000</span>);
  }, <span class="hljs-number">1000</span>);
}, <span class="hljs-number">1000</span>);
</code></pre>
<h3 data-id="heading-8">ğŸ’¡ Promise çš„æ ¸å¿ƒä»·å€¼</h3>
<p><strong>Promise = å¯æ§çš„å–é¤å·</strong></p>
<ul>
<li>æ˜ç¡®çŸ¥é“ä»»åŠ¡ä½•æ—¶æˆåŠŸ/å¤±è´¥</li>
<li>æŒ‰é¡ºåºå¤„ç†å¤šä¸ªå¼‚æ­¥ä»»åŠ¡</li>
<li>æ¶ˆé™¤å›è°ƒåœ°ç‹±</li>
</ul>
<hr/>
<h3 data-id="heading-9">ğŸ¯ Promise çš„ä¸‰å¤§æ ¸å¿ƒç‰¹æ€§</h3>
<h4 data-id="heading-10">1. ä¸‰ç§ä¸å¯é€†çŠ¶æ€</h4>

























<table><thead><tr><th>çŠ¶æ€</th><th>å«ä¹‰</th><th>è§¦å‘æ–¹å¼</th></tr></thead><tbody><tr><td><code>pending</code></td><td>ç­‰å¾…ä¸­ï¼ˆåˆå§‹çŠ¶æ€ï¼‰</td><td>åˆ›å»º Promise æ—¶</td></tr><tr><td><code>fulfilled</code></td><td>æˆåŠŸå®Œæˆ</td><td>è°ƒç”¨ <code>resolve()</code></td></tr><tr><td><code>rejected</code></td><td>å¤±è´¥</td><td>è°ƒç”¨ <code>reject()</code></td></tr></tbody></table>
<h4 data-id="heading-11">2. é“¾å¼è°ƒç”¨Â <code>.then()</code>Â å’ŒÂ <code>.catch()</code></h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> p = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">_, reject</span>) =&gt;</span> {
  fs.<span class="hljs-title function_">readFile</span>(<span class="hljs-string">'./b.txt'</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {
    err ? <span class="hljs-title function_">reject</span>(err) : <span class="hljs-title function_">resolve</span>(data.<span class="hljs-title function_">toString</span>());
  });
});

p.<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æˆåŠŸï¼š'</span>, data);
}).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å¤±è´¥ï¼š'</span>, err.<span class="hljs-property">message</span>); <span class="hljs-comment">// æ•è· reject å’Œå¼‚å¸¸</span>
});
</code></pre>
<p>ğŸ“ŒÂ <code>.catch()</code>Â ä¼šæ•è·ï¼š</p>
<ul>
<li><code>reject()</code>Â è§¦å‘çš„é”™è¯¯</li>
<li><code>.then()</code>Â ä¸­æŠ›å‡ºçš„å¼‚å¸¸ï¼ˆç±»ä¼¼ try-catchï¼‰</li>
<li>
<h2 data-id="heading-12">å››ã€fetchï¼šåŸºäº Promise çš„ç½‘ç»œè¯·æ±‚åˆ©å™¨</h2>
</li>
</ul>
<h3 data-id="heading-13">âœ… åŸºæœ¬ç”¨æ³•</h3>
<pre><code class="hljs language-ini" lang="ini">fetch('https://api.github.com/orgs/lemoncode/members')
  .then(<span class="hljs-attr">response</span> =&gt; response.json())
  .then(<span class="hljs-attr">members</span> =&gt; {
    const <span class="hljs-attr">list</span> = members.map(m =&gt; `&lt;li&gt;<span class="hljs-variable">${m.login}</span>&lt;/li&gt;`).join(<span class="hljs-string">''</span>)<span class="hljs-comment">;</span>
    document.getElementById('members').<span class="hljs-attr">innerHTML</span> = list<span class="hljs-comment">;</span>
  })
  .catch(<span class="hljs-attr">err</span> =&gt; console.error(<span class="hljs-string">'è¯·æ±‚å¤±è´¥ï¼š'</span>, err))<span class="hljs-comment">;</span>
</code></pre>
<h3 data-id="heading-14">ğŸ” åº•å±‚æ‰§è¡Œæµç¨‹</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7496c79a05db43fd92faf13bde73c54b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m95YWw5Zyw56m655O2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763392644&amp;x-signature=ZKGLuwy6V4PT%2FINAKiq5FeXxSz4%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-15">âš ï¸ å…³é”®æ³¨æ„äº‹é¡¹</h3>
<p><strong>HTTP é”™è¯¯ä¸ä¼šè§¦å‘ rejectï¼</strong><br/>
404/500 ç­‰çŠ¶æ€ç å±äº"æœåŠ¡å™¨æ­£å¸¸å“åº”"ï¼Œéœ€æ‰‹åŠ¨æ£€æŸ¥ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">fetch</span>(url)
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {
    <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) { <span class="hljs-comment">// æ£€æŸ¥ HTTP çŠ¶æ€</span>
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`HTTPé”™è¯¯ï¼š<span class="hljs-subst">${response.status}</span>`</span>);
    }
    <span class="hljs-keyword">return</span> response.<span class="hljs-title function_">json</span>();
  })
  .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'é”™è¯¯ï¼š'</span>, err));
</code></pre>
<h2 data-id="heading-16">äº”ã€å¼‚æ­¥ç¼–ç¨‹è¿›åŒ–å²ï¼šä»å›è°ƒåˆ° async/await</h2>
<h3 data-id="heading-17">ğŸ“ˆ å‘å±•å†ç¨‹</h3>

























<table><thead><tr><th>æ—¶ä»£</th><th>ç‰¹ç‚¹</th><th>é—®é¢˜</th></tr></thead><tbody><tr><td><strong>å›è°ƒå‡½æ•°</strong></td><td>æœ€åŸå§‹æ–¹å¼</td><td>å›è°ƒåœ°ç‹±ï¼ŒåµŒå¥—è¿‡æ·±</td></tr><tr><td><strong>Promise</strong></td><td>é“¾å¼è°ƒç”¨ï¼ŒçŠ¶æ€ç®¡ç†</td><td><code>.then</code> åµŒå¥—ä»æ˜¾ç¹ç</td></tr><tr><td><strong>async/await</strong></td><td>ç”¨åŒæ­¥å†™æ³•å¤„ç†å¼‚æ­¥</td><td>æœ€æ¸…æ™°çš„ä»£ç ç»“æ„</td></tr></tbody></table>
<h3 data-id="heading-18">ğŸ’« async/await å®æˆ˜</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getMembers</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// await ä¼š"æš‚åœ"å‡½æ•°æ‰§è¡Œï¼Œä½†ä¸é˜»å¡ä¸»çº¿ç¨‹</span>
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://api.github.com/orgs/lemoncode/members'</span>);
    
    <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`HTTP <span class="hljs-subst">${response.status}</span>`</span>);
    
    <span class="hljs-keyword">const</span> members = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(members);
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'å‡ºé”™äº†ï¼š'</span>, err);
  }
}

</code></pre>
<blockquote>
<p>âœ…Â <strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>ä»£ç ç»“æ„åƒåŒæ­¥ä¸€æ ·æ¸…æ™°</li>
<li>é”™è¯¯å¤„ç†ç»Ÿä¸€ç”¨ try/catch</li>
<li>é¿å… Promise é“¾å¼è°ƒç”¨çš„åµŒå¥—</li>
</ul>
</blockquote>
<hr/>
<h2 data-id="heading-19">ğŸŒŸ æ€»ç»“ï¼šç†è§£å¼‚æ­¥ = æŒæ¡ JS çš„"è¿è¡Œæ³•åˆ™"</h2>





























<table><thead><tr><th>æ ¸å¿ƒæ¦‚å¿µ</th><th>å…³é”®è¦ç‚¹</th></tr></thead><tbody><tr><td><strong>å•çº¿ç¨‹</strong></td><td>ä¸ºé¿å… DOM æ“ä½œå†²çªè€Œè®¾è®¡ï¼Œå¿…é¡»é€šè¿‡å¼‚æ­¥é¿å…é˜»å¡</td></tr><tr><td><strong>Event Loop</strong></td><td>å¼‚æ­¥è°ƒåº¦ä¸­å¿ƒï¼šåè°ƒè°ƒç”¨æ ˆï¼ˆçª—å£ï¼‰å’Œä»»åŠ¡é˜Ÿåˆ—ï¼ˆæ’å·ï¼‰ï¼Œå®ç°éé˜»å¡æ‰§è¡Œ</td></tr><tr><td><strong>Promise</strong></td><td>é€šè¿‡çŠ¶æ€ç®¡ç†ï¼ˆpending/fulfilled/rejectedï¼‰å’Œé“¾å¼è°ƒç”¨ï¼Œè§£å†³å›è°ƒåœ°ç‹±é—®é¢˜</td></tr><tr><td><strong>fetch</strong></td><td>åŸºäº Promise çš„ç½‘ç»œè¯·æ±‚ APIï¼Œæ³¨æ„ HTTP é”™è¯¯éœ€æ‰‹åŠ¨æ£€æŸ¥ <code>response.ok</code></td></tr><tr><td><strong>async/await</strong></td><td>è¯­æ³•ç³–ï¼Œè®©å¼‚æ­¥ä»£ç åƒåŒæ­¥ä¸€æ ·å¯è¯»ï¼Œåº•å±‚ä»åŸºäº Promise</td></tr></tbody></table>
<blockquote>
<p>ğŸ’¡Â <strong>ä¸‹æ¬¡é‡åˆ°"æ‰§è¡Œé¡ºåºè¯¡å¼‚"æ—¶</strong>ï¼š<br/>
ä»è¿™ä¸‰ä¸ªè§’åº¦åˆ†æï¼š<br/>
1ï¸âƒ£Â <strong>è°ƒç”¨æ ˆ</strong>å½“å‰åœ¨æ‰§è¡Œä»€ä¹ˆï¼Ÿ<br/>
2ï¸âƒ£Â <strong>ä»»åŠ¡é˜Ÿåˆ—</strong>ä¸­æœ‰ä»€ä¹ˆç­‰å¾…æ‰§è¡Œï¼Ÿ<br/>
3ï¸âƒ£Â <strong>Promise çŠ¶æ€</strong>å¦‚ä½•å˜åŒ–ï¼Ÿ<br/>
<strong>ä½ ä¼šå‘ç°æ‰€æœ‰"è¯¡å¼‚"ç°è±¡ï¼Œéƒ½æœ‰ç« å¯å¾ªï¼</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-20">ğŸš€ åŠ¨æ‰‹å®è·µå»ºè®®</h3>
<ol>
<li>ç”¨ Promise å°è£…ä¸€ä¸ªÂ <code>setTimeout</code>Â å‡½æ•°</li>
<li>å°è¯•ç”¨ async/await é‡æ„å›è°ƒåœ°ç‹±ä»£ç </li>
<li>åœ¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·ä¸­è°ƒè¯•å¼‚æ­¥ä»£ç ï¼Œè§‚å¯Ÿè°ƒç”¨æ ˆå˜åŒ–</li>
</ol>
<p><strong>æŒæ¡å¼‚æ­¥ç¼–ç¨‹ï¼Œä½ å°±èƒ½çœŸæ­£æŒæ§ JavaScript çš„è¿è¡Œè„‰æï¼</strong><br/>
ç°åœ¨ï¼Œæ‰“å¼€ç¼–è¾‘å™¨ï¼Œäº²æ‰‹ä½“éªŒ"æŒæ§å¼‚æ­¥"çš„å¿«æ„Ÿå§ï¼ ğŸ’»âœ¨</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue é¡¹ç›®ä¸Šçº¿å‰å¿…æŸ¥ï¼8 ä¸ªæ˜“å¿½ç•¥çŸ¥è¯†ç‚¹ï¼Œ90% å¼€å‘è€…éƒ½è¸©è¿‡å‘]]></title>    <link>https://juejin.cn/post/7570923924365033535</link>    <guid>https://juejin.cn/post/7570923924365033535</guid>    <pubDate>2025-11-10T15:42:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570923924365033535" data-draft-id="7570899512782782527" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue é¡¹ç›®ä¸Šçº¿å‰å¿…æŸ¥ï¼8 ä¸ªæ˜“å¿½ç•¥çŸ¥è¯†ç‚¹ï¼Œ90% å¼€å‘è€…éƒ½è¸©è¿‡å‘"/> <meta itemprop="keywords" content="Vue.js,å‰ç«¯,é¢è¯•"/> <meta itemprop="datePublished" content="2025-11-10T15:42:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="zzpper"/> <meta itemprop="url" content="https://juejin.cn/user/3560673121928058"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue é¡¹ç›®ä¸Šçº¿å‰å¿…æŸ¥ï¼8 ä¸ªæ˜“å¿½ç•¥çŸ¥è¯†ç‚¹ï¼Œ90% å¼€å‘è€…éƒ½è¸©è¿‡å‘
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3560673121928058/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    zzpper
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T15:42:38.000Z" title="Mon Nov 10 2025 15:42:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vue é¡¹ç›®ä¸Šçº¿å‰å¿…æŸ¥ï¼8 ä¸ªæ˜“å¿½ç•¥çŸ¥è¯†ç‚¹ï¼Œ90% å¼€å‘è€…éƒ½è¸©è¿‡å‘</h2>
<p>æœ€è¿‘æœ€è¿‘æ¥æ‰‹äº†ä¸€ä¸ªæœ‹å‹çš„ Vue3 é¡¹ç›®ï¼Œæ”¹ bug æ”¹åˆ°æ€€ç–‘äººç”Ÿ â€”â€” æ˜æ˜è¯­æ³•çœ‹ç€æ²¡æ¯›ç—…ï¼Œé¡µé¢å°±æ˜¯ä¸æ›´æ–°ï¼›çˆ¶å­ç»„ä»¶ä¼ å€¼å¶å°”å¤±æ•ˆï¼›æ‰“åŒ…åæ ·å¼çªç„¶é”™ä¹±â€¦ æ’æŸ¥åå‘ç°å…¨æ˜¯äº› â€œä¸èµ·çœ¼â€ çš„çŸ¥è¯†ç‚¹åœ¨ä½œç¥Ÿã€‚</p>
<p>è¿™äº›çŸ¥è¯†ç‚¹ä¸åƒå“åº”å¼ã€ç”Ÿå‘½å‘¨æœŸé‚£æ ·è¢«åå¤å¼ºè°ƒï¼Œå´ååæ˜¯é¢è¯•é«˜é¢‘è€ƒç‚¹å’Œé¡¹ç›®çº¿ä¸Šé—®é¢˜çš„é‡ç¾åŒºã€‚ä»Šå¤©å°±å¸¦å¤§å®¶é€ä¸ªæ‹†è§£ï¼Œæ¯ä¸ªéƒ½é™„ä»£ç ç¤ºä¾‹å’Œé¿å‘æ–¹æ¡ˆï¼Œæ–°æ‰‹èƒ½é¿å‘ï¼Œè€æ‰‹èƒ½æŸ¥æ¼ï¼Œå»ºè®®æ”¶è—å¤‡ç”¨ï¼ğŸš€</p>
<h3 data-id="heading-1">1. Scoped æ ·å¼çš„ â€œéšå½¢æ³„éœ²â€ï¼Œçˆ¶å­ç»„ä»¶æ ·å¼ä¸²å‘³äº†</h3>
<p>å†™ç»„ä»¶æ—¶å¤§å®¶éƒ½ä¹ æƒ¯åŠ <code>scoped</code>è®©æ ·å¼å±€éƒ¨åŒ–ï¼Œä½†ä½ å¯èƒ½é‡åˆ°è¿‡ï¼šçˆ¶ç»„ä»¶çš„æ ·å¼è«åå…¶å¦™å½±å“äº†å­ç»„ä»¶ï¼Ÿè¿™å¯ä¸æ˜¯ Vue çš„ bugã€‚</p>
<h4 data-id="heading-2">éšè—é™·é˜±</h4>
<p>Vue ä¸º<code>scoped</code>æ ·å¼çš„å…ƒç´ æ·»åŠ ç‹¬ç‰¹å±æ€§ï¼ˆå¦‚<code>data-v-xxx</code>ï¼‰æ¥éš”ç¦»æ ·å¼ï¼Œä½†<strong>å­ç»„ä»¶çš„æ ¹èŠ‚ç‚¹ä¼šåŒæ—¶ç»§æ‰¿çˆ¶ç»„ä»¶å’Œè‡ªèº«çš„ scoped æ ·å¼</strong>ã€‚æ¯”å¦‚è¿™æ ·çš„ä»£ç ï¼š</p>
<p>vue</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- çˆ¶ç»„ä»¶ App.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">h4</span>&gt;</span>çˆ¶ç»„ä»¶æ ‡é¢˜<span class="hljs-tag">&lt;/<span class="hljs-name">h4</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">HelloWorld</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-tag">h4</span> { <span class="hljs-attribute">color</span>: red; }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>

<span class="hljs-comment">&lt;!-- å­ç»„ä»¶ HelloWorld.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">h4</span>&gt;</span>å­ç»„ä»¶æ ‡é¢˜<span class="hljs-tag">&lt;/<span class="hljs-name">h4</span>&gt;</span> <span class="hljs-comment">&lt;!-- ä¼šè¢«çˆ¶ç»„ä»¶çš„redæ ·å¼å½±å“ --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p>æœ€ç»ˆå­ç»„ä»¶çš„ h4 ä¹Ÿä¼šå˜æˆçº¢è‰²ï¼Œå¾ˆå¤šäººç¬¬ä¸€æ¬¡é‡åˆ°éƒ½ä¼šæ‡µåœˆã€‚</p>
<h4 data-id="heading-3">é¿å‘æ–¹æ¡ˆ</h4>
<ol>
<li>
<p>ç»™å­ç»„ä»¶æ ¹å…ƒç´ åŠ å”¯ä¸€ classï¼Œé¿å…æ ‡ç­¾é€‰æ‹©å™¨å†²çª</p>
<p>vue</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- ä¼˜åŒ–å HelloWorld.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"hello-world"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h4</span>&gt;</span>å­ç»„ä»¶æ ‡é¢˜<span class="hljs-tag">&lt;/<span class="hljs-name">h4</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
</li>
<li>
<p>Vue3 æ”¯æŒå¤šæ ¹èŠ‚ç‚¹ï¼Œç›´æ¥ç”¨å¤šä¸ªæ ¹å…ƒç´ æ‰“ç ´ç»§æ‰¿é“¾</p>
</li>
<li>
<p>å°½é‡ç”¨ class é€‰æ‹©å™¨æ›¿ä»£æ ‡ç­¾é€‰æ‹©å™¨ï¼Œå‡å°‘å†²çªæ¦‚ç‡</p>
</li>
</ol>
<h3 data-id="heading-4">2. æ•°ç»„ / å¯¹è±¡å“åº”å¼å¤±æ•ˆï¼Ÿåˆ«å†ç›´æ¥æ”¹ç´¢å¼•äº†</h3>
<p>è¿™æ˜¯ Vue å“åº”å¼ç³»ç»Ÿçš„ç»å…¸ â€œå‘â€ï¼ŒVue3 ç”¨ Proxy ä¼˜åŒ–äº†ä¸å°‘ï¼Œä½†æŸäº›åœºæ™¯ä¾ç„¶ä¼šè¸©é›·ã€‚</p>
<h4 data-id="heading-5">éšè—é™·é˜±</h4>
<p>Vue çš„å“åº”å¼ä¾èµ–æ•°æ®åŠ«æŒå®ç°ï¼Œä½†ä»¥ä¸‹ä¸¤ç§æ“ä½œæ— æ³•è¢«ç›‘å¬ï¼š</p>
<ol>
<li>ç»™å¯¹è±¡æ–°å¢æœªå£°æ˜çš„å±æ€§</li>
<li>ç›´æ¥ä¿®æ”¹æ•°ç»„ç´¢å¼•æˆ–é•¿åº¦</li>
</ol>
<p>vue</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{{ user.age }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{{ list[0] }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"modifyData"</span>&gt;</span>ä¿®æ”¹æ•°æ®<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">const</span> user = <span class="hljs-title function_">reactive</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'å¼ ä¸‰'</span> })
<span class="hljs-keyword">const</span> list = <span class="hljs-title function_">reactive</span>([<span class="hljs-string">'è‹¹æœ'</span>])

<span class="hljs-keyword">const</span> <span class="hljs-title function_">modifyData</span> = (<span class="hljs-params"/>) =&gt; {
  user.<span class="hljs-property">age</span> = <span class="hljs-number">25</span> <span class="hljs-comment">// æ–°å¢å±æ€§ï¼Œé¡µé¢ä¸æ›´æ–°</span>
  list[<span class="hljs-number">0</span>] = <span class="hljs-string">'é¦™è•‰'</span> <span class="hljs-comment">// ç›´æ¥æ”¹ç´¢å¼•ï¼Œé¡µé¢ä¸æ›´æ–°</span>
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>ç‚¹å‡»æŒ‰é’®åï¼Œæ•°æ®ç¡®å®å˜äº†ï¼Œä½†é¡µé¢çº¹ä¸ä¸åŠ¨ã€‚</p>
<h4 data-id="heading-6">é¿å‘æ–¹æ¡ˆ</h4>
<p>é’ˆå¯¹ä¸åŒæ•°æ®ç±»å‹ç”¨æ­£ç¡®å§¿åŠ¿ä¿®æ”¹ï¼š</p>
<p>vue</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">const</span> user = <span class="hljs-title function_">reactive</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'å¼ ä¸‰'</span> })
<span class="hljs-keyword">const</span> list = <span class="hljs-title function_">reactive</span>([<span class="hljs-string">'è‹¹æœ'</span>])

<span class="hljs-keyword">const</span> <span class="hljs-title function_">modifyData</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-comment">// å¯¹è±¡æ–°å¢å±æ€§ï¼šç›´æ¥èµ‹å€¼å³å¯ï¼ˆVue3 Proxyæ”¯æŒï¼‰</span>
  user.<span class="hljs-property">age</span> = <span class="hljs-number">25</span> 
  <span class="hljs-comment">// æ•°ç»„ä¿®æ”¹ï¼šç”¨spliceæˆ–æ›¿æ¢æ•°ç»„</span>
  list.<span class="hljs-title function_">splice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-string">'é¦™è•‰'</span>) 
  <span class="hljs-comment">// ä¹Ÿå¯ç›´æ¥æ›¿æ¢æ•´ä¸ªæ•°ç»„</span>
  <span class="hljs-comment">// list = ['é¦™è•‰', 'æ©™å­']</span>
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<blockquote>
<p>å°è´´å£«ï¼šVue2 ä¸­éœ€ç”¨<code>this.$set(user, 'age', 25)</code>ï¼ŒVue3 çš„ Proxy æ— éœ€é¢å¤– APIï¼Œä½†ä¿®æ”¹æ•°ç»„ç´¢å¼•ä»éœ€ç”¨æ•°ç»„æ–¹æ³•ã€‚</p>
</blockquote>
<h3 data-id="heading-7">3. setup é‡Œçš„å¼‚æ­¥è¯·æ±‚ï¼Œåˆ«æ¼äº† Suspense é…åˆ</h3>
<p>Vue3 çš„ Composition API æ˜¯è¶‹åŠ¿ï¼Œä½†å¾ˆå¤šäººåœ¨ setup é‡Œå†™å¼‚æ­¥è¯·æ±‚æ—¶ï¼Œé‡åˆ°è¿‡æ•°æ®æ¸²æŸ“å»¶è¿Ÿæˆ–æŠ¥é”™çš„é—®é¢˜ã€‚</p>
<h4 data-id="heading-8">éšè—é™·é˜±</h4>
<p>setup å‡½æ•°æ‰§è¡Œæ—¶ç»„ä»¶è¿˜æœªæŒ‚è½½ï¼Œè‹¥ç›´æ¥åœ¨ setup ä¸­å†™ async/awaitï¼Œè¿”å›çš„ Promise ä¼šå¯¼è‡´ç»„ä»¶æ¸²æŸ“å¼‚å¸¸ï¼Œå› ä¸º setup æœ¬èº«ä¸æ”¯æŒç›´æ¥è¿”å› Promiseã€‚</p>
<p>vue</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- é”™è¯¯ç¤ºä¾‹ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>
<span class="hljs-keyword">const</span> data = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>)

<span class="hljs-comment">// ç›´æ¥ç”¨awaitä¼šå¯¼è‡´ç»„ä»¶åˆå§‹åŒ–å¼‚å¸¸</span>
<span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api/list'</span>) 
data.<span class="hljs-property">value</span> = res.<span class="hljs-property">data</span>
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h4 data-id="heading-9">é¿å‘æ–¹æ¡ˆ</h4>
<p>ç”¨ Vue3 å†…ç½®çš„<code>&lt;Suspense&gt;</code>ç»„ä»¶åŒ…è£¹å¼‚æ­¥ç»„ä»¶ï¼Œæ­é…å¼‚æ­¥ setup ä½¿ç”¨ï¼š</p>
<p>vue</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- çˆ¶ç»„ä»¶ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">default</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">DataList</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">fallback</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>åŠ è½½ä¸­...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span> <span class="hljs-comment">&lt;!-- åŠ è½½å ä½ --&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-comment">&lt;!-- DataList.vue å¼‚æ­¥ç»„ä»¶ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>
<span class="hljs-keyword">const</span> data = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>)

<span class="hljs-comment">// setupå¯ä»¥å†™æˆasyncå‡½æ•°</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchData</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api/list'</span>)
  data.<span class="hljs-property">value</span> = res.<span class="hljs-property">data</span>
}
<span class="hljs-title function_">fetchData</span>()
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>è¿™æ ·æ—¢èƒ½æ­£å¸¸å‘èµ·å¼‚æ­¥è¯·æ±‚ï¼Œåˆèƒ½ä¼˜é›…å¤„ç†åŠ è½½çŠ¶æ€ï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚</p>
<h3 data-id="heading-10">4. é props å±æ€§ â€œæ‚„æ‚„ç»§æ‰¿â€ï¼ŒDOM å¤šäº†è«åå±æ€§</h3>
<p>ç»™ç»„ä»¶ä¼ äº†æ²¡åœ¨ props ä¸­å£°æ˜çš„å±æ€§ï¼ˆå¦‚ idã€classï¼‰ï¼Œç»“æœå‘ç°å­ç»„ä»¶æ ¹å…ƒç´ è‡ªåŠ¨å¤šäº†è¿™äº›å±æ€§ï¼Œæœ‰æ—¶ä¼šå¯¼è‡´æ ·å¼æˆ–åŠŸèƒ½å†²çªã€‚</p>
<h4 data-id="heading-11">éšè—é™·é˜±</h4>
<p>è¿™æ˜¯ Vue çš„<strong>é props å±æ€§ç»§æ‰¿</strong>ç‰¹æ€§ï¼Œåƒ idã€classã€name è¿™ç±»æœªè¢« props æ¥æ”¶çš„å±æ€§ï¼Œä¼šé»˜è®¤æŒ‚è½½åˆ°å­ç»„ä»¶çš„æ ¹å…ƒç´ ä¸Šã€‚æ¯”å¦‚ï¼š</p>
<p>vue</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- çˆ¶ç»„ä»¶ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">UserCard</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"user-card"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-style"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-comment">&lt;!-- å­ç»„ä»¶ UserCard.vue æœªå£°æ˜å¯¹åº”props --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>ç”¨æˆ·ä¿¡æ¯å¡ç‰‡<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span> <span class="hljs-comment">&lt;!-- æœ€ç»ˆä¼šè¢«æ¸²æŸ“ä¸º&lt;div id="user-card" class="card-style"&gt; --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<p>è‹¥å­ç»„ä»¶æ ¹å…ƒç´ å·²æœ‰ classï¼Œä¼šå’Œç»§æ‰¿çš„ class åˆå¹¶ï¼Œæœ‰æ—¶ä¼šè¦†ç›–é¢„æœŸæ ·å¼ã€‚</p>
<h4 data-id="heading-12">é¿å‘æ–¹æ¡ˆ</h4>
<ol>
<li>
<p>ç¦æ­¢ç»§æ‰¿ï¼šç”¨<code>inheritAttrs: false</code>å…³é—­è‡ªåŠ¨ç»§æ‰¿</p>
<p>vue</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-comment">// å…³é—­épropså±æ€§ç»§æ‰¿</span>
<span class="hljs-title function_">defineOptions</span>({ <span class="hljs-attr">inheritAttrs</span>: <span class="hljs-literal">false</span> }) 
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
</li>
<li>
<p>æ‰‹åŠ¨æ§åˆ¶å±æ€§ä½ç½®ï¼šç”¨<code>$attrs</code>å°†å±æ€§æŒ‚è½½åˆ°æŒ‡å®šå…ƒç´ </p>
<p>vue</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-bind</span>=<span class="hljs-string">"$attrs"</span>&gt;</span>åªç»™è¿™ä¸ªå…ƒç´ åŠ ç»§æ‰¿å±æ€§<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
</li>
</ol>
<h3 data-id="heading-13">5. ç”Ÿå‘½å‘¨æœŸçš„ â€œé¡ºåºé™·é˜±â€ï¼Œçˆ¶å­ç»„ä»¶æ‰§è¡Œé¡ºåºæåäº†</h3>
<p>Vue2 å‡çº§ Vue3 åï¼Œç”Ÿå‘½å‘¨æœŸä¸ä»…æ”¹äº†å‘½åï¼Œçˆ¶å­ç»„ä»¶çš„æ‰§è¡Œé¡ºåºä¹Ÿæœ‰å·®å¼‚ï¼Œè¿™æ˜¯é¢è¯•é«˜é¢‘é¢˜ï¼Œä¹Ÿæ˜¯é¡¹ç›®ä¸­å¼‚æ­¥é€»è¾‘å‡ºé”™çš„å¸¸è§åŸå› ã€‚</p>
<h4 data-id="heading-14">éšè—é™·é˜±</h4>
<p>å¾ˆå¤šäººä»æ²¿ç”¨ Vue2 çš„æ€ç»´å†™ Vue3 ä»£ç ï¼Œæ¯”å¦‚è®¤ä¸ºçˆ¶ç»„ä»¶çš„<code>onMounted</code>ä¼šæ¯”å­ç»„ä»¶å…ˆæ‰§è¡Œï¼Œç»“æœ DOM æ“ä½œæ—¶æŠ¥é”™ã€‚</p>















<table><thead><tr><th>é˜¶æ®µ</th><th>Vue2 æ‰§è¡Œé¡ºåº</th><th>Vue3 æ‰§è¡Œé¡ºåº</th></tr></thead><tbody><tr><td>åˆå§‹åŒ–</td><td>çˆ¶ beforeCreateâ†’çˆ¶ createdâ†’çˆ¶ beforeMountâ†’å­ beforeCreateâ†’å­ createdâ†’å­ beforeMountâ†’å­ mountedâ†’çˆ¶ mounted</td><td>çˆ¶ setupâ†’çˆ¶ onBeforeMountâ†’å­ setupâ†’å­ onBeforeMountâ†’å­ onMountedâ†’çˆ¶ onMounted</td></tr></tbody></table>
<h4 data-id="heading-15">é¿å‘æ–¹æ¡ˆ</h4>
<ol>
<li>
<p>æ•°æ®åˆå§‹åŒ–ï¼šVue3 å¯åœ¨ setup ä¸­ç›´æ¥ç”¨ async/await å‘èµ·è¯·æ±‚ï¼Œé…åˆ Suspense</p>
</li>
<li>
<p>DOM æ“ä½œï¼šåŠ¡å¿…åœ¨<code>onMounted</code>ä¸­æ‰§è¡Œï¼Œä¸”è¦æ¸…æ¥šå­ç»„ä»¶çš„ mounted ä¼šæ¯”çˆ¶ç»„ä»¶å…ˆè§¦å‘</p>
</li>
<li>
<p>æ¸…ç†å·¥ä½œï¼šå®šæ—¶å™¨ã€äº‹ä»¶ç›‘å¬ä¸€å®šè¦åœ¨<code>onBeforeUnmount</code>ä¸­æ¸…é™¤ï¼Œé¿å…å†…å­˜æ³„æ¼</p>
<p>vue</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onMounted, onBeforeUnmount } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">let</span> timer = <span class="hljs-literal">null</span>
<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  timer = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å®šæ—¶å™¨è¿è¡Œä¸­'</span>)
  }, <span class="hljs-number">1000</span>)
})
<span class="hljs-comment">// ç»„ä»¶å¸è½½å‰æ¸…é™¤å®šæ—¶å™¨</span>
<span class="hljs-title function_">onBeforeUnmount</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-built_in">clearInterval</span>(timer)
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
</li>
</ol>
<h3 data-id="heading-16">6. CSS ä¸­ç”¨ v-bindï¼ŒåŠ¨æ€æ ·å¼çš„æ­£ç¡®æ‰“å¼€æ–¹å¼</h3>
<p>Vue3.2 + æ”¯æŒåœ¨ CSS ä¸­ç›´æ¥ç”¨ v-bind ç»‘å®šæ•°æ®ï¼Œè¿™ä¸ªç‰¹æ€§å¾ˆå®ç”¨ï¼Œä½†å¾ˆå¤šäººä¸çŸ¥é“å®ƒçš„åº•å±‚é€»è¾‘å’Œä½¿ç”¨é™åˆ¶ã€‚</p>
<h4 data-id="heading-17">éšè—é™·é˜±</h4>
<p>ç›´æ¥åœ¨ CSS ä¸­ç»‘å®šè®¡ç®—å±æ€§æ—¶ï¼Œè¯¯ä»¥ä¸ºä¿®æ”¹æ•°æ®åæ ·å¼ä¸ä¼šå®æ—¶æ›´æ–°ï¼Œæˆ–è€…æ‹…å¿ƒå½±å“æ€§èƒ½ã€‚</p>
<p>vue</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text"</span>&gt;</span>åŠ¨æ€é¢œè‰²æ–‡æœ¬<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"changeColor"</span>&gt;</span>åˆ‡æ¢é¢œè‰²<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref, computed } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">const</span> primaryColor = <span class="hljs-title function_">ref</span>(<span class="hljs-string">'red'</span>)
<span class="hljs-keyword">const</span> textColor = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> primaryColor.<span class="hljs-property">value</span>)
<span class="hljs-keyword">const</span> <span class="hljs-title function_">changeColor</span> = (<span class="hljs-params"/>) =&gt; {
  primaryColor.<span class="hljs-property">value</span> = primaryColor.<span class="hljs-property">value</span> === <span class="hljs-string">'red'</span> ? <span class="hljs-string">'blue'</span> : <span class="hljs-string">'red'</span>
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.text</span> {
  <span class="hljs-attribute">color</span>: <span class="hljs-built_in">v-bind</span>(textColor);
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<h4 data-id="heading-18">é¿å‘æ–¹æ¡ˆ</h4>
<ol>
<li>æ— éœ€æ‹…å¿ƒæ€§èƒ½ï¼šv-bind ä¼šè¢«ç¼–è¯‘æˆ CSS è‡ªå®šä¹‰å±æ€§ï¼Œé€šè¿‡å†…è”æ ·å¼åº”ç”¨åˆ°ç»„ä»¶ï¼Œæ•°æ®å˜æ›´æ—¶ä»…æ›´æ–°è‡ªå®šä¹‰å±æ€§</li>
<li>æ”¯æŒå¤šç§æ•°æ®ç±»å‹ï¼šå¯ç»‘å®š refã€reactiveã€computedï¼Œç”šè‡³æ˜¯ props ä¼ é€’çš„å€¼</li>
<li>ä¸ scoped å…¼å®¹ï¼šåŠ¨æ€æ ·å¼åŒæ ·æ”¯æŒå±€éƒ¨ä½œç”¨åŸŸï¼Œä¸ä¼šæ±¡æŸ“å…¨å±€</li>
</ol>
<h3 data-id="heading-19">7. ref è·å–å…ƒç´ ï¼Œåˆ«åœ¨ onMounted å‰æ€¥ç€ç”¨</h3>
<p>ç”¨ ref è·å– DOM å…ƒç´ æ˜¯åŸºç¡€æ“ä½œï¼Œä½†æ–°æ‰‹å¸¸çŠ¯çš„é”™æ˜¯åœ¨ DOM æœªæŒ‚è½½å®Œæˆæ—¶å°±è°ƒç”¨å…ƒç´ æ–¹æ³•ã€‚</p>
<h4 data-id="heading-20">éšè—é™·é˜±</h4>
<p>åœ¨<code>setup</code>æˆ–<code>onBeforeMount</code>ä¸­è·å– refï¼Œç»“æœæ‹¿åˆ°<code>undefined</code>ã€‚</p>
<p>vue</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"inputRef"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref, onBeforeMount } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">const</span> inputRef = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>)

<span class="hljs-title function_">onBeforeMount</span>(<span class="hljs-function">() =&gt;</span> {
  inputRef.<span class="hljs-property">value</span>.<span class="hljs-title function_">focus</span>() <span class="hljs-comment">// æŠ¥é”™ï¼šCannot read property 'focus' of null</span>
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h4 data-id="heading-21">é¿å‘æ–¹æ¡ˆ</h4>
<ol>
<li>
<p>åŸºç¡€ç”¨æ³•ï¼šåœ¨<code>onMounted</code>ä¸­æ“ä½œ ref å…ƒç´ ï¼Œæ­¤æ—¶ DOM å·²å®Œå…¨æŒ‚è½½</p>
<p>vue</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref, onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">const</span> inputRef = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>)

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  inputRef.<span class="hljs-property">value</span>.<span class="hljs-title function_">focus</span>() <span class="hljs-comment">// æ­£å¸¸ç”Ÿæ•ˆ</span>
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
</li>
<li>
<p>åŠ¨æ€å…ƒç´ ï¼šè‹¥ ref ç»‘å®šåœ¨ v-for æ¸²æŸ“çš„å…ƒç´ ä¸Šï¼ŒinputRef ä¼šå˜æˆæ•°ç»„ï¼Œéœ€é€šè¿‡ç´¢å¼•è®¿é—®</p>
</li>
<li>
<p>ç»„ä»¶ refï¼šè·å–å­ç»„ä»¶å®ä¾‹æ—¶ï¼Œå­ç»„ä»¶éœ€ç”¨<code>defineExpose</code>æš´éœ²å±æ€§å’Œæ–¹æ³•</p>
</li>
</ol>
<h3 data-id="heading-22">8. watch ç›‘å¬æ•°ç»„ / å¯¹è±¡ï¼Œæ·±åº¦ç›‘å¬åˆ«å†™é”™äº†</h3>
<p>watch æ˜¯ Vue ä¸­å¤„ç†å“åº”å¼æ•°æ®å˜åŒ–çš„æ ¸å¿ƒ APIï¼Œä½†ç›‘å¬å¤æ‚æ•°æ®ç±»å‹æ—¶ï¼Œå¾ˆå®¹æ˜“å‡ºç° â€œç›‘å¬ä¸åˆ°å˜åŒ–â€ çš„é—®é¢˜ã€‚</p>
<h4 data-id="heading-23">éšè—é™·é˜±</h4>
<p>ç›´æ¥ç›‘å¬æ•°ç»„æˆ–å¯¹è±¡æ—¶ï¼Œé»˜è®¤åªç›‘å¬å¼•ç”¨å˜åŒ–ï¼Œå¯¹å†…éƒ¨å±æ€§çš„ä¿®æ”¹æ— æ³•è§¦å‘ç›‘å¬ã€‚</p>
<p>vue</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref, watch } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">const</span> user = <span class="hljs-title function_">ref</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'å¼ ä¸‰'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">20</span> })

<span class="hljs-comment">// é”™è¯¯ï¼šç›‘å¬ä¸åˆ°ageçš„å˜åŒ–</span>
<span class="hljs-title function_">watch</span>(user, <span class="hljs-function">(<span class="hljs-params">newVal</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç”¨æˆ·ä¿¡æ¯å˜äº†'</span>, newVal)
})

<span class="hljs-keyword">const</span> <span class="hljs-title function_">changeAge</span> = (<span class="hljs-params"/>) =&gt; {
  user.<span class="hljs-property">value</span>.<span class="hljs-property">age</span> = <span class="hljs-number">25</span> <span class="hljs-comment">// ä»…ä¿®æ”¹å†…éƒ¨å±æ€§ï¼Œä¸è§¦å‘ç›‘å¬</span>
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h4 data-id="heading-24">é¿å‘æ–¹æ¡ˆ</h4>
<p>æ ¹æ® Vue ç‰ˆæœ¬é€‰æ‹©æ­£ç¡®çš„ç›‘å¬æ–¹å¼ï¼š</p>
<ol>
<li>
<p>Vue3 ç›‘å¬ ref åŒ…è£¹çš„å¯¹è±¡ï¼šå¼€å¯æ·±åº¦ç›‘å¬</p>
<p>vue</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">watch</span>(user, <span class="hljs-function">(<span class="hljs-params">newVal</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç”¨æˆ·ä¿¡æ¯å˜äº†'</span>, newVal)
}, { <span class="hljs-attr">deep</span>: <span class="hljs-literal">true</span> }) <span class="hljs-comment">// å¼€å¯æ·±åº¦ç›‘å¬</span>
</code></pre>
</li>
<li>
<p>ç²¾å‡†ç›‘å¬å•ä¸ªå±æ€§ï¼šç”¨å‡½æ•°è¿”å›å€¼çš„æ–¹å¼ï¼Œæ€§èƒ½æ›´ä¼˜</p>
<p>vue</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åªç›‘å¬ageå˜åŒ–ï¼Œæ— éœ€æ·±åº¦ç›‘å¬</span>
<span class="hljs-title function_">watch</span>(<span class="hljs-function">() =&gt;</span> user.<span class="hljs-property">value</span>.<span class="hljs-property">age</span>, <span class="hljs-function">(<span class="hljs-params">newAge</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å¹´é¾„å˜äº†'</span>, newAge)
})
</code></pre>
</li>
</ol>
<h3 data-id="heading-25">æœ€åæ€»ç»“</h3>
<p>Vue è¿™äº›æ˜“å¿½ç•¥çš„çŸ¥è¯†ç‚¹ï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯å¯¹åº•å±‚åŸç†ç†è§£ä¸é€å½»å¯¼è‡´çš„ã€‚å¾ˆå¤šæ—¶å€™æˆ‘ä»¬åªé¡¾ç€å®ç°åŠŸèƒ½ï¼Œå´å¿½ç•¥äº†è¿™äº›ç»†èŠ‚ï¼Œç­‰åˆ°é¡¹ç›®ä¸Šçº¿å‡ºç° bug æ‰è¿½æ‚”è«åŠã€‚</p>
<p>ä»¥ä¸Š 8 ä¸ªçŸ¥è¯†ç‚¹ï¼Œå»ºè®®ç»“åˆä»£ç é€ä¸ªå®æ“éªŒè¯ã€‚å¦‚æœæœ¬æ–‡å¸®ä½ é¿å¼€äº†å‘ï¼Œæ¬¢è¿ç‚¹èµæ”¶è—ï¼Œä¹Ÿå¯ä»¥åœ¨è¯„è®ºåŒºåˆ†äº«ä½ è¸©è¿‡çš„ Vue ç¥å‘ï¼Œä¸€èµ·é¿é›·æˆé•¿ï¼ğŸ’ª</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é¸¿è’™5ï¼šHarmonyOSåº”ç”¨å¼€å‘-UIAbilityç»„ä»¶]]></title>    <link>https://juejin.cn/post/7570901172527235107</link>    <guid>https://juejin.cn/post/7570901172527235107</guid>    <pubDate>2025-11-10T13:07:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570901172527235107" data-draft-id="7570909641682731048" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é¸¿è’™5ï¼šHarmonyOSåº”ç”¨å¼€å‘-UIAbilityç»„ä»¶"/> <meta itemprop="keywords" content="HarmonyOS"/> <meta itemprop="datePublished" content="2025-11-10T13:07:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸œæ—çŸ¥è¯†åº“"/> <meta itemprop="url" content="https://juejin.cn/user/1667340630507341"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é¸¿è’™5ï¼šHarmonyOSåº”ç”¨å¼€å‘-UIAbilityç»„ä»¶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1667340630507341/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸œæ—çŸ¥è¯†åº“
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T13:07:23.000Z" title="Mon Nov 10 2025 13:07:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. UIAbility ç»„ä»¶</h2>
<p>æ¯ä¸€ä¸ªUIAbilityå®ä¾‹ï¼Œéƒ½å¯¹åº”äºä¸€ä¸ªæœ€è¿‘ä»»åŠ¡åˆ—è¡¨ä¸­çš„ä»»åŠ¡ã€‚</p>
<p>UIAbilityæ˜¯ä¸€ç§åŒ…å«ç”¨æˆ·ç•Œé¢çš„åº”ç”¨ç»„ä»¶ï¼Œä¸»è¦ç”¨äºå’Œç”¨æˆ·è¿›è¡Œäº¤äº’ã€‚UIAbilityä¹Ÿæ˜¯ç³»ç»Ÿè°ƒåº¦çš„å•å…ƒï¼Œä¸ºåº”ç”¨æä¾›çª—å£åœ¨å…¶ä¸­ç»˜åˆ¶ç•Œé¢ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d5829b79b864cf6aecf120ae7b6f212~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5p6X55-l6K-G5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763384843&amp;x-signature=yc64E9qKXGq0DlUN9pJeHyM6Rps%3D" alt="" loading="lazy"/>â€‹</p>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>ç¼–è¾‘</p>
<p>ä¸€ä¸ªåº”ç”¨å¯ä»¥æœ‰ä¸€ä¸ª UIAbilityä¹Ÿå¯ä»¥æœ‰å¤šä¸ªUIAbilityï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p>
<ul>
<li>å• UIAbilityï¼šä»»åŠ¡åˆ—è¡¨åªæœ‰ä¸€ä¸ªä»»åŠ¡ï¼Œåº”ç”¨å†…éƒ¨ç»“åˆã€å¤šé¡µé¢ã€‘çš„å½¢å¼è®©ç”¨æˆ·è¿›è¡Œçš„æœç´¢å’Œæµè§ˆå†…å®¹ï¼Œé¡µé¢çš„è·³è½¬ä½¿ç”¨è·¯ç”±æ¥å®ç°å³å¯ï¼ˆåˆ°ç›®å‰ä¸ºæ­¢å’±ä»¬åšçš„éƒ½æ˜¯è¿™ç§ï¼‰</li>
<li>å¤šä¸ª UIAbilityï¼šé‚£ä¹ˆåœ¨ä»»åŠ¡åˆ—è¡¨ä¸­ä¼šæœ‰å¤šä¸ªä»»åŠ¡ã€‚æ¯”å¦‚å›¾ç‰‡ä¸­èŠå¤©åº”ç”¨å¢åŠ ä¸€ä¸ªâ€œå¤–å–åŠŸèƒ½â€çš„åœºæ™¯ï¼Œåˆ™å¯ä»¥å°†èŠå¤©åº”ç”¨ä¸­â€œå¤–å–åŠŸèƒ½â€çš„å†…å®¹ç‹¬ç«‹ä¸ºä¸€ä¸ªUIAbilityï¼Œå½“ç”¨æˆ·æ‰“å¼€èŠå¤©åº”ç”¨çš„â€œå¤–å–åŠŸèƒ½â€ï¼ŒæŸ¥çœ‹å¤–å–è®¢å•è¯¦æƒ…ï¼Œæ­¤æ—¶æœ‰æ–°çš„èŠå¤©æ¶ˆæ¯ï¼Œå³å¯ä»¥é€šè¿‡æœ€è¿‘ä»»åŠ¡åˆ—è¡¨åˆ‡æ¢å›åˆ°èŠå¤©çª—å£ç»§ç»­è¿›è¡ŒèŠå¤©å¯¹è¯ã€‚</li>
</ul>
<h3 data-id="heading-1">1.1 æŒ‡å®š UIAbility çš„å¯åŠ¨é¡µé¢</h3>
<p>åœ¨UIAbilityçš„onWindowStageCreate()ç”Ÿå‘½å‘¨æœŸå›è°ƒä¸­ï¼Œé€šè¿‡ WindowStage å¯¹è±¡çš„ loadContent() æ–¹æ³•è®¾ç½®å¯åŠ¨é¡µé¢ã€‚</p>
<p><strong>TIP</strong></p>
<ul>
<li><strong>å¦‚æœåº”ç”¨å¯åŠ¨å‡ºç°ç™½å±ï¼Œå¯èƒ½æ˜¯åŠ è½½çš„é¡µé¢è®¾ç½®å‡ºç°é—®é¢˜</strong></li>
<li><strong>è®¾ç½®çš„é¡µé¢ï¼Œéœ€è¦åœ¨</strong> <strong>main_page.json5</strong> <strong>ä¸­å­˜åœ¨ï¼Œä¸”åŒå</strong></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32f3df11de0546c6a721059da5e07bea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5p6X55-l6K-G5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763384843&amp;x-signature=iM4qEOa%2Bow9cGK%2BGQO3bIKvi0J4%3D" alt="" loading="lazy"/>â€‹</p>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>ç¼–è¾‘</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">onWindowStageCreate</span>(<span class="hljs-attr">windowStage</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">WindowStage</span>): <span class="hljs-keyword">void</span> {
  <span class="hljs-comment">// Main window is created, set main page for this ability</span>
  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'Ability onWindowStageCreate'</span>);

  windowStage.<span class="hljs-title function_">loadContent</span>(<span class="hljs-string">'pages/AppStorageCase01'</span>, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (err.<span class="hljs-property">code</span>) {
      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">DOMAIN</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Failed to load the content. Cause: %{public}s'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));
      <span class="hljs-keyword">return</span>;
    }
    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Succeeded in loading the content.'</span>);
  });
}
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<p><strong>æ³¨æ„ï¼š</strong></p>
<ol>
<li>windowStage.loadContentåŠ è½½çš„é¡µé¢ï¼Œä¸å¯ä»¥ç”¨ / å¼€å¤´</li>
<li>åŠ è½½çš„é¡µé¢éœ€è¦åœ¨ <strong>main_pages.json5</strong> ä¸­å­˜åœ¨</li>
<li>å‡ºç°é¡µé¢ç™½è‰²çš„ï¼ˆä¸Šè¿° 2 ä¸ªé—®é¢˜ï¼‰</li>
</ol>
<h3 data-id="heading-2">1.2 UIAbility ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ</h3>
<p>å½“ç”¨æˆ·æ‰“å¼€ã€åˆ‡æ¢å’Œè¿”å›åˆ°å¯¹åº”åº”ç”¨æ—¶ï¼Œåº”ç”¨ä¸­çš„UIAbilityå®ä¾‹ä¼šåœ¨å…¶ç”Ÿå‘½å‘¨æœŸçš„ä¸åŒçŠ¶æ€ä¹‹é—´è½¬æ¢ã€‚UIAbilityç±»æä¾›äº†ä¸€ç³»åˆ—ã€å›è°ƒå‡½æ•°ã€‘ï¼Œå¦‚æœéœ€è¦åœ¨ç‰¹å®šçš„æ—¶é—´æ·»åŠ è‡ªå®šä¹‰é€»è¾‘ï¼Œå¾€å¯¹åº”çš„å›è°ƒå‡½æ•°å†…æ·»åŠ ä»£ç å³å¯</p>
<p>tips:</p>
<ol>
<li>å›è°ƒå‡½æ•°ç”±ã€å¼€å‘è€…æ³¨å†Œã€‘</li>
<li>å›è°ƒå‡½æ•°ç”±ã€ç³»ç»Ÿè°ƒç”¨ã€‘ï¼Œå¹¶ä¸”ä¼šä¼ å…¥å¯¹åº”çš„å‚æ•°</li>
</ol>
<p>UIAbilityçš„ç”Ÿå‘½å‘¨æœŸåŒ…æ‹¬Createã€Foregroundã€Backgroundã€Destroyå››ä¸ªçŠ¶æ€ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54f3353c5bfe4d19a25081e48a21d588~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5p6X55-l6K-G5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763384843&amp;x-signature=Bh1sQpNGqUh2I1cUQTf6Zxb02xw%3D" alt="" loading="lazy"/>â€‹</p>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>ç¼–è¾‘</p>
<ul>
<li><strong>onCreate</strong>:Abilityåˆ›å»ºæ—¶å›è°ƒï¼Œæ‰§è¡Œåˆå§‹åŒ–ä¸šåŠ¡é€»è¾‘æ“ä½œã€‚</li>
<li><strong>onDestory</strong>:Abilityç”Ÿå‘½å‘¨æœŸå›è°ƒï¼Œåœ¨é”€æ¯æ—¶å›è°ƒï¼Œæ‰§è¡Œèµ„æºæ¸…ç†ç­‰æ“ä½œã€‚</li>
<li><strong>onWindowStageCreate</strong>:å½“WindowStageåˆ›å»ºåè°ƒç”¨ã€‚</li>
<li><strong>onWindowStageDestory</strong>:å½“WindowStageé”€æ¯åè°ƒç”¨ã€‚</li>
<li><strong>onForeground</strong>:Abilityç”Ÿå‘½å‘¨æœŸå›è°ƒï¼Œå½“åº”ç”¨ä»åå°è½¬åˆ°å‰å°æ—¶è§¦å‘ã€‚</li>
<li><strong>onBackground</strong>:Abilityç”Ÿå‘½å‘¨æœŸå›è°ƒï¼Œå½“åº”ç”¨ä»å‰å°è½¬åˆ°åå°æ—¶è§¦å‘ã€‚</li>
</ul>
<p>å¯ä»¥æ ¹æ®ä¸‹å›¾çš„æ–¹å¼è§‚å¯Ÿåˆ°çŠ¶æ€æ”¹å˜æ—¶è§¦å‘çš„å›è°ƒå‡½æ•°å‡½æ•°ï¼š</p>
<p><strong>æ³¨ï¼š</strong></p>
<ul>
<li>3 ä¸‹æ–¹åˆ’æ¨ªçº¿çš„å†…å®¹éœ€è¦æ‰‹åŠ¨è¾“å…¥</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8aab022f01ad4e858aa2a220b19ddc2e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5p6X55-l6K-G5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763384843&amp;x-signature=9xhP%2BTuYQRPDobYcCoFkoALRgy8%3D" alt="" loading="lazy"/>â€‹</p>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>ç¼–è¾‘</p>
<h3 data-id="heading-3">1.3 UIAbility ç»„ä»¶é—´äº¤äº’</h3>
<p>UIAbilityæ˜¯ã€ç³»ç»Ÿè°ƒåº¦ã€‘çš„æœ€å°å•å…ƒã€‚åœ¨è®¾å¤‡å†…çš„åŠŸèƒ½æ¨¡å—ä¹‹é—´è·³è½¬æ—¶ï¼Œä¼šæ¶‰åŠåˆ°å¯åŠ¨ç‰¹å®šçš„UIAbilityï¼Œå’±ä»¬æ¥çœ‹çœ‹å¦‚ä½•å®ç°ã€‚ã€æ³¨ï¼šå’±ä»¬ç›®å‰ä¸“æ³¨äºå¯åŠ¨åº”ç”¨å†…çš„ UIAbility å³å¯ã€‘</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/edd6fa3f3880435da7b1212271c5b44e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5p6X55-l6K-G5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763384843&amp;x-signature=ckN%2FmpM8pKT6WPiXa%2FwG4rdIUpk%3D" alt="" loading="lazy"/>â€‹</p>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>ç¼–è¾‘</p>
<p>å¤šä¸ª <strong>Ability</strong> çš„åº”ç”¨</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b41df5e2913e44aa965e18e7e4db339e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5p6X55-l6K-G5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763384843&amp;x-signature=GyQTtGxX9%2F9Vn9UpYK4sxe2gFwg%3D" alt="" loading="lazy"/>â€‹</p>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>ç¼–è¾‘</p>
<h4 data-id="heading-4">1.3.1 åˆ›å»ºå¤šä¸ª Ability</h4>
<p>é¦–å…ˆåœ¨é¡¹ç›®ä¸­åˆ›å»ºå¤šä¸ª Ability</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/40acc2f5885d4767b383cd7f43f68edf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5p6X55-l6K-G5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763384843&amp;x-signature=5MhqHqtgXwzrji58dBD7H%2FIWbxs%3D" alt="" loading="lazy"/>â€‹</p>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>ç¼–è¾‘</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f83370d48ba44e6b6590c713ca83f3c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5p6X55-l6K-G5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763384843&amp;x-signature=K1FFq8diu3GH%2F%2FPXvjphmw91tp0%3D" alt="" loading="lazy"/>â€‹</p>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>ç¼–è¾‘</p>
<p>åˆ›å»ºå®Œæ¯•ä¹‹åé¡¹ç›®ä¼šå‘ç”Ÿå¦‚ä¸‹æ”¹å˜:</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a1c88c60d86494d85aafa1b27b49e9e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5p6X55-l6K-G5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763384843&amp;x-signature=DFt016XZzEfaMVMKltOhECNc2fg%3D" alt="" loading="lazy"/>â€‹</p>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>ç¼–è¾‘</p>
<h4 data-id="heading-5">1.3.2 å¦‚ä½•è®¾ç½®é»˜è®¤å¯åŠ¨çš„ Ability</h4>
<p>å¦‚æœå¸Œæœ›åˆšåˆšåˆ›å»ºçš„Ability ä½œä¸ºé»˜è®¤å¯åŠ¨çš„ Ability å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è¿›è¡Œè®¾ç½®ï¼š</p>
<ol>
<li>è°ƒæ•´é…ç½®ï¼š</li>
</ol>

<ol>
<li>
<ol>
<li>é…ç½®ä¸­å¢åŠ ï¼šexported å’Œ skills ï¼Œå¹¶ç§»é™¤é»˜è®¤Ability ä¸­å¯¹åº”çš„é…ç½®</li>
</ol>
</li>
</ol>

<ol>
<li>è°ƒæ•´é¡ºåºï¼š</li>
</ol>

<ol>
<li>
<ol>
<li>å¦‚æœå¤šä¸ª Ability ä¸­éƒ½è®¾ç½®äº†exported å’Œ skills ï¼Œé‚£ä¹ˆè°ƒæ•´ä»–ä»¬åœ¨ abilities æ•°ç»„ä¸­çš„é¡ºåºå³å¯ï¼Œæ’åé å‰çš„å…ˆå¯åŠ¨</li>
</ol>
</li>
</ol>

<pre><code class="hljs language-kotlin" lang="kotlin">{
  <span class="hljs-string">"module"</span>: {
    <span class="hljs-comment">// ....</span>
    <span class="hljs-string">"abilities"</span>: [
      <span class="hljs-comment">// é»˜è®¤çš„ Ability</span>
      {
        <span class="hljs-string">"name"</span>: <span class="hljs-string">"EntryAbility"</span>,
        <span class="hljs-string">"srcEntry"</span>: <span class="hljs-string">"./ets/entryability/EntryAbility.ets"</span>,
        <span class="hljs-string">"description"</span>: <span class="hljs-string">"<span class="hljs-variable">$string</span>:EntryAbility_desc"</span>,
        <span class="hljs-string">"icon"</span>: <span class="hljs-string">"<span class="hljs-variable">$media</span>:icon"</span>,
        <span class="hljs-string">"label"</span>: <span class="hljs-string">"<span class="hljs-variable">$string</span>:EntryAbility_label"</span>,
        <span class="hljs-string">"startWindowIcon"</span>: <span class="hljs-string">"<span class="hljs-variable">$media</span>:startIcon"</span>,
        <span class="hljs-string">"startWindowBackground"</span>: <span class="hljs-string">"<span class="hljs-variable">$color</span>:start_window_background"</span>,
      },
      {
        <span class="hljs-string">"name"</span>: <span class="hljs-string">"SecondAbility"</span>,
        <span class="hljs-string">"srcEntry"</span>: <span class="hljs-string">"./ets/secondability/SecondAbility.ets"</span>,
        <span class="hljs-string">"description"</span>: <span class="hljs-string">"<span class="hljs-variable">$string</span>:SecondAbility_desc"</span>,
        <span class="hljs-string">"icon"</span>: <span class="hljs-string">"<span class="hljs-variable">$media</span>:icon"</span>,
        <span class="hljs-string">"label"</span>: <span class="hljs-string">"<span class="hljs-variable">$string</span>:SecondAbility_label"</span>,
        <span class="hljs-string">"startWindowIcon"</span>: <span class="hljs-string">"<span class="hljs-variable">$media</span>:startIcon"</span>,
        <span class="hljs-string">"startWindowBackground"</span>: <span class="hljs-string">"<span class="hljs-variable">$color</span>:start_window_background"</span>,
        <span class="hljs-string">"exported"</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-string">"skills"</span>: [
          {
            <span class="hljs-string">"entities"</span>: [
              <span class="hljs-string">"entity.system.home"</span>
            ],
            <span class="hljs-string">"actions"</span>: [
              <span class="hljs-string">"action.system.home"</span>
            ]
          }
        ]
      }
    ],
    <span class="hljs-string">"requestPermissions"</span>: [
      {
        <span class="hljs-string">"name"</span>: <span class="hljs-string">"ohos.permission.INTERNET"</span>,
        <span class="hljs-string">"usedScene"</span>: {
          <span class="hljs-string">"abilities"</span>: [
            <span class="hljs-string">"FormAbility"</span>
          ],
          <span class="hljs-string">"when"</span>: <span class="hljs-string">"inuse"</span>
        }
      }
    ],
    <span class="hljs-string">"extensionAbilities"</span>: [

    ]
  }
}
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<h4 data-id="heading-6">1.3.3 å¯åŠ¨ UIAbility</h4>
<p>åˆšåˆšæ¼”ç¤ºçš„æ˜¯è®¾ç½®é»˜è®¤å¯åŠ¨çš„ UIAbilityï¼Œæ¥ä¸‹æ¥æ¼”ç¤ºå¦‚ä½•åœ¨åº”ç”¨é€»è¾‘ä¸­ï¼Œé€šè¿‡ã€ä»£ç å¯åŠ¨ã€‘</p>
<p>å¯åŠ¨ UIAbility çš„è¯ï¼Œå’±ä»¬åˆ†ä¸º 2 ç§æƒ…å†µï¼š</p>
<ol>
<li>å¯åŠ¨åŒä¸€ä¸ªæ¨¡å—ä¸­çš„å…¶ä»– UIAbility(ç›®å‰ä»£ç çš„æƒ…å†µ)</li>
<li>å¯åŠ¨ä¸åŒæ¨¡å—ä¸­çš„ UIAbility</li>
</ol>
<h5 data-id="heading-7">1.3.3.1 åŒä¸€ä¸ªæ¨¡å—ä¸­çš„ UIAbility</h5>
<p>åŒä¸€ä¸ªæ¨¡å—ä¸­çš„UIAbilityè·³è½¬</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e17d3472b3154035b6f6d88cacc27906~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5p6X55-l6K-G5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763384843&amp;x-signature=DUXviaGDj1QXC%2B69Uz3PmYklStY%3D" alt="" loading="lazy"/>â€‹</p>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>ç¼–è¾‘</p>
<p>è¿™éƒ¨åˆ†ä»£ç èƒ½å¤Ÿ <strong>C+V</strong> å¹¶ä¸”ã€è°ƒæ•´ã€‘ä¸ºéœ€è¦çš„å€¼å³å¯ï¼š</p>
<ol>
<li>å‡†å¤‡ want ä½œä¸º UIAbility çš„å¯åŠ¨å…¥å£å‚æ•°ï¼Œç„¶åè®¾ç½®å¯¹åº”çš„å±æ€§å€¼</li>
<li>é€šè¿‡ this.contextè·å–å½“å‰ UIAbility çš„ã€ä¸Šä¸‹æ–‡å¯¹è±¡ã€‘ï¼Œç„¶åè°ƒç”¨ startAbility å¹¶ä¼ å…¥ want å³å¯å®ç°å¯åŠ¨</li>
</ol>
<p>ä¸Šä¸‹æ–‡å¯¹è±¡ï¼šå…¶æä¾›äº†åº”ç”¨çš„ä¸€äº›ã€åŸºç¡€ä¿¡æ¯ã€‘å’Œä¸€äº›å¯ä»¥ã€è°ƒç”¨çš„æ–¹æ³•ã€‘</p>
<p><strong>è¯•ä¸€è¯•ï¼š</strong></p>
<ol>
<li>ä»ä¸Šä¸€æ­¥ã€ æ·»åŠ çš„Abiltyã€‘ è·³è½¬åˆ°ã€é»˜è®¤çš„ Abilityã€‘</li>
</ol>

<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { common, <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;

<span class="hljs-meta">@Entry</span>
  <span class="hljs-meta">@Component</span>
  struct <span class="hljs-title class_">SecondAbilityPage</span> {
    <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;
    <span class="hljs-comment">//1. è·å–ä¸Šä¸‹æ–‡å¯¹è±¡(åç»­ç›´æ¥ä½¿ç”¨)</span>
    context = <span class="hljs-title function_">getContext</span>(<span class="hljs-variable language_">this</span>) <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;

    <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
      <span class="hljs-title class_">Row</span>() {
        <span class="hljs-title class_">Column</span>() {
          <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)
            .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)
            .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)
            .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
              <span class="hljs-comment">//2. å‡†å¤‡ wantç±»å‹çš„å¯¹è±¡å¹¶è®¾ç½®å±æ€§</span>
              <span class="hljs-keyword">let</span> <span class="hljs-attr">wantInfo</span>: <span class="hljs-title class_">Want</span> = {
                <span class="hljs-attr">deviceId</span>: <span class="hljs-string">''</span>, <span class="hljs-comment">// deviceIdä¸ºç©ºè¡¨ç¤ºæœ¬è®¾å¤‡</span>
                <span class="hljs-attr">bundleName</span>: <span class="hljs-string">'com.example.day07'</span>, <span class="hljs-comment">// AppScope/app.json5ç¡®è®¤</span>
                <span class="hljs-attr">moduleName</span>: <span class="hljs-string">'entry'</span>, <span class="hljs-comment">// moduleNameéå¿…é€‰</span>
                <span class="hljs-attr">abilityName</span>: <span class="hljs-string">'EntryAbility'</span>, <span class="hljs-comment">//  src/main/module.json5ç¡®è®¤</span>
                <span class="hljs-attr">parameters</span>: {
                  <span class="hljs-comment">// è‡ªå®šä¹‰ä¿¡æ¯</span>
                  <span class="hljs-attr">info</span>: <span class="hljs-string">'æ¥è‡ªEntryAbility Page_UIAbilityComponentsInteractiveé¡µé¢'</span>
                },
              }
              <span class="hljs-comment">//3. é€šè¿‡ä¸Šä¸‹æ–‡å¯¹è±¡æ‹‰èµ·å¯¹åº”çš„ Abilit</span>
              <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">startAbility</span>(wantInfo)
                .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
                  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'startAbility success.'</span>);
                })
                .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {
                  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'startAbility failed.'</span>);
                });
            })
        }
        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
      }
      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)
        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Orange</span>)
    }
  }
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<h5 data-id="heading-8">1.3.3.2 ä¸åŒæ¨¡å—ä¸­çš„ UIAbilityï¼ˆäº†è§£ï¼‰</h5>
<p>ä¸Šä¸€èŠ‚æ¼”ç¤ºçš„æ–¹æ³•å› ä¸ºæ˜¯åœ¨åŒä¸€ä¸ªæ¨¡å—ä¸­çš„ä¸­çš„ UIAbilityï¼Œè™½ç„¶ UIAbility ä¸åŒï¼Œä½†æ˜¯é¡µé¢æ”¾ç½®çš„æ–‡ä»¶å¤¹æ˜¯ä¸€æ ·çš„ï¼Œéƒ½åœ¨ Pages é‡Œé¢ã€‚å¦‚æœæƒ³è¦ æŠŠ Pages å†åˆ†å¼€ï¼Œå¯ä»¥é€šè¿‡åˆ†æ¨¡å—çš„æ–¹å¼æ¥å®ç°</p>
<ol>
<li>åˆ›å»ºæ¨¡å—</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/91a3a71055ea48ccb68a4ae29bf33638~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5p6X55-l6K-G5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763384843&amp;x-signature=QLbm0O3e8j3Bi%2BqsrgQZuOW%2Fryo%3D" alt="" loading="lazy"/>â€‹</p>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>ç¼–è¾‘</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d63cd83ceb3146648b87e7d8d2862381~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5p6X55-l6K-G5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763384843&amp;x-signature=QCUCmRNDzJi2yh0Pskia2H%2FGcNw%3D" alt="" loading="lazy"/>â€‹</p>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>ç¼–è¾‘</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c4f2f305f470464e8cb4cac4a405bc41~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5p6X55-l6K-G5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763384843&amp;x-signature=HdMcmjVJ%2B2hbwsrMJuHz%2BPqaue4%3D" alt="" loading="lazy"/>â€‹</p>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>ç¼–è¾‘</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fdd967fcfbef45949fd43ac094c2ee4b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5p6X55-l6K-G5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763384843&amp;x-signature=GWwmBNOrpyxosUudeRVlh%2FHmFqE%3D" alt="" loading="lazy"/>â€‹</p>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>ç¼–è¾‘</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/837fb183c35b40f7b9c7f6899e112f15~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5p6X55-l6K-G5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763384843&amp;x-signature=XVUAEdniWIAy6LxXcXYCZjh8Gaw%3D" alt="" loading="lazy"/>â€‹</p>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>ç¼–è¾‘</p>
<ol>
<li>è°ƒæ•´æ–°åˆ›å»ºæ¨¡å—å†…éƒ¨çš„é¡µé¢å†…å®¹</li>
</ol>

<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@Entry</span>
<span class="hljs-keyword">@Component</span>
struct Index {
  <span class="hljs-built_in">build</span>() {
    <span class="hljs-built_in">Row</span>() {
      <span class="hljs-built_in">Column</span>() {
        Text('å…¶ä»–æ¨¡å—çš„é¡µé¢')
          <span class="hljs-selector-class">.fontSize</span>(<span class="hljs-number">50</span>)
          <span class="hljs-selector-class">.fontWeight</span>(FontWeight.Bold)
      }
      <span class="hljs-selector-class">.width</span>('<span class="hljs-number">100%</span>')
    }
    <span class="hljs-selector-class">.height</span>('<span class="hljs-number">100%</span>')
    <span class="hljs-selector-class">.backgroundColor</span>('#<span class="hljs-number">0094</span>ff')
  }
}
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4fe4c5efb3d341dd8c3d9fa406e112eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5p6X55-l6K-G5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763384843&amp;x-signature=cJ0qDhjoktfN32rpWugKfjbkRxk%3D" alt="" loading="lazy"/>â€‹</p>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>ç¼–è¾‘</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79b9ac6dd63c4836b4992ae39b8bd190~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5p6X55-l6K-G5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763384843&amp;x-signature=PamDvPRvQEk5eIx7RW4KqL%2B9LBw%3D" alt="" loading="lazy"/>â€‹</p>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>ç¼–è¾‘</p>
<p>ç°åœ¨é¡¹ç›®ä¸­æœ‰å¤šä¸ªæ¨¡å—ï¼Œéœ€è¦åœ¨ç¼–è¾‘é…ç½®ä¸­å°†å¤šä¸ªæ¨¡å—éƒ½å‹¾é€‰ä¸Š</p>
<ol>
<li>åœ¨åŸæ¨¡å—ä¸­è·³è½¬åˆ° æ–°åˆ›å»ºæ¨¡å—ä¸­çš„ UIAbility</li>
</ol>

<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> common <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.app.ability.common'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Want</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.app.ability.Want'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.base'</span>;


<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Page</span>_UIAbilityComponentsInteractive {
  <span class="hljs-keyword">private</span> context = <span class="hljs-title function_">getContext</span>(<span class="hljs-variable language_">this</span>) <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Button</span>(<span class="hljs-string">'è·³è½¬åˆ°å¦å¤–çš„ Ability'</span>)
      .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-comment">// contextä¸ºAbilityå¯¹è±¡çš„æˆå‘˜ï¼Œåœ¨éAbilityå¯¹è±¡å†…éƒ¨è°ƒç”¨éœ€è¦</span>
        <span class="hljs-comment">// å°†Contextå¯¹è±¡ä¼ é€’è¿‡å»</span>
        <span class="hljs-keyword">let</span> <span class="hljs-attr">wantInfo</span>: <span class="hljs-title class_">Want</span> = {
          <span class="hljs-attr">deviceId</span>: <span class="hljs-string">''</span>, <span class="hljs-comment">// deviceIdä¸ºç©ºè¡¨ç¤ºæœ¬è®¾å¤‡</span>
          <span class="hljs-attr">bundleName</span>: <span class="hljs-string">'com.example.day07'</span>,
          <span class="hljs-attr">moduleName</span>: <span class="hljs-string">'secondApplication'</span>, <span class="hljs-comment">// moduleNameéå¿…é€‰</span>
          <span class="hljs-attr">abilityName</span>: <span class="hljs-string">'SecondApplicationAbility'</span>,
          <span class="hljs-attr">parameters</span>: {
            <span class="hljs-comment">// è‡ªå®šä¹‰ä¿¡æ¯</span>
            <span class="hljs-attr">info</span>: <span class="hljs-string">'æ¥è‡ªEntryAbility Page_UIAbilityComponentsInteractiveé¡µé¢'</span>
          },
        }
        <span class="hljs-comment">// contextä¸ºè°ƒç”¨æ–¹UIAbilityçš„UIAbilityContext</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">startAbility</span>(wantInfo)
          .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'startAbility success.'</span>);
          })
          .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'startAbility failed.'</span>);
          });
      })
  }
}
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<p><strong>TIP</strong></p>
<p>å¯åŠ¨å…¶ä»–åº”ç”¨çš„ UIAbility å¯ä»¥å‚è€ƒ-<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fharmonyos-guides%2Fuiability-intra-device-interaction-0000001820999601%23ZH-CN_TOPIC_0000001820999601__%25E5%2590%25AF%25E5%258A%25A8%25E5%2585%25B6%25E4%25BB%2596%25E5%25BA%2594%25E7%2594%25A8%25E7%259A%2584uiability" title="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/uiability-intra-device-interaction-0000001820999601#ZH-CN_TOPIC_0000001820999601__%E5%90%AF%E5%8A%A8%E5%85%B6%E4%BB%96%E5%BA%94%E7%94%A8%E7%9A%84uiability" target="_blank" ref="nofollow noopener noreferrer">ä¼ é€é—¨</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/499e0f41c59c4c2782a03cc708fbf5b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5p6X55-l6K-G5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763384843&amp;x-signature=A1SzA%2BVMrIhD%2BUxhbrM5lqLihOI%3D" alt="" loading="lazy"/>â€‹</p>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>ç¼–è¾‘</p>
<p>å¯åŠ¨ç•Œé¢å’Œé¢„æœŸä¸åŒï¼›å¦‚ä½•æ’æŸ¥ï¼š</p>
<ol>
<li>ç¡®è®¤å¯åŠ¨çš„æ¨¡å—</li>
<li>æ‰¾åˆ°æ¨¡å—çš„ module.json5</li>
<li>æ‰¾åˆ°é»˜è®¤å¯åŠ¨çš„ Ability</li>
<li>æ‰“å¼€ Ability çœ‹çœ‹é»˜è®¤åŠ è½½çš„é¡µé¢</li>
</ol>

<ol>
<li>
<ol>
<li>é¡µé¢å¯¹ä¸å¯¹</li>
<li>æ˜¯å¦å·¦ä¾§æœ‰/</li>
</ol>
</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f0b646f7ffff4981a4c22386601f06af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5p6X55-l6K-G5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763384843&amp;x-signature=oEau5dmLEgevXN7mwbJoAebQydI%3D" alt="" loading="lazy"/>â€‹</p>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>ç¼–è¾‘</p>
<ol>
<li>bundleNameï¼šåº”ç”¨çš„åŒ…åï¼ŒAppScore/app.json5</li>
<li>moduleName: æ¨¡å—å</li>
</ol>

<ol>
<li>
<ol>
<li>ï¼ˆåŒä¸€ä¸ªæ¨¡å—è·³è½¬ï¼Œå¯ä»¥çœç•¥ï¼‰</li>
<li>è·³è½¬åˆ°å…¶ä»–çš„æ¨¡å—ï¼Œæ¨¡å—/module.json5</li>
</ol>
</li>
</ol>

<ol>
<li>abilityName:</li>
</ol>

<ol>
<li>
<ol>
<li>æ¨¡å—/module.json5ï¼Œæ‰¾åˆ° Ability æ•°ç»„ï¼Œç¡®è®¤è¦è·³è½¬çš„ Ability</li>
</ol>
</li>
</ol>
<p>â€‹
â€‹</p>
<p>Â HarmonyOSèµ‹èƒ½èµ„æºä¸°å¯Œåº¦å»ºè®¾ï¼ˆç¬¬å››æœŸï¼‰-å´ä¸œæ—</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Ftraining%2FclassDetail%2F9fdeeb1a35d64d2fabad3948ae7aab72%3Ftype%3D1%3Fha_source%3Dhmosclass%26ha_sourceId%3D89000248" title="https://developer.huawei.com/consumer/cn/training/classDetail/9fdeeb1a35d64d2fabad3948ae7aab72?type=1?ha_source=hmosclass&amp;ha_sourceId=89000248" target="_blank" ref="nofollow noopener noreferrer">developer.huawei.com/consumer/cnâ€¦</a></p>
<p>â€‹</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é¸¿è’™5ï¼šHarmonyOSåº”ç”¨å¼€å‘-éƒ¨åˆ†åŸç”Ÿèƒ½åŠ›]]></title>    <link>https://juejin.cn/post/7570935965435346959</link>    <guid>https://juejin.cn/post/7570935965435346959</guid>    <pubDate>2025-11-10T13:16:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570935965435346959" data-draft-id="7570909641682796584" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é¸¿è’™5ï¼šHarmonyOSåº”ç”¨å¼€å‘-éƒ¨åˆ†åŸç”Ÿèƒ½åŠ›"/> <meta itemprop="keywords" content="HarmonyOS"/> <meta itemprop="datePublished" content="2025-11-10T13:16:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸œæ—çŸ¥è¯†åº“"/> <meta itemprop="url" content="https://juejin.cn/user/1667340630507341"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é¸¿è’™5ï¼šHarmonyOSåº”ç”¨å¼€å‘-éƒ¨åˆ†åŸç”Ÿèƒ½åŠ›
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1667340630507341/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸œæ—çŸ¥è¯†åº“
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T13:16:38.000Z" title="Mon Nov 10 2025 13:16:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>â€‹</p>
<h2 data-id="heading-0">4. é¸¿è’™åŸç”Ÿèƒ½åŠ›</h2>
<h3 data-id="heading-1">4.1 éŸ³è§†é¢‘æ’­æ”¾</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6d1de60d43e48f6bfd759d853131d5f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5p6X55-l6K-G5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763385398&amp;x-signature=nheg22cakeXRXm7JDqAfj9jvM34%3D" alt="" loading="lazy"/>â€‹</p>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>ç¼–è¾‘</p>
<p>arkUIæä¾›äº†Videoç»„ä»¶å¯ä»¥ç›´æ¥æ’­æ”¾è§†é¢‘ï¼Œå¹¶æä¾›è‡ªå¸¦çš„æ’­æ”¾-æš‚åœ å…¨å±ï¼Œæ‹–åŠ¨è¿›åº¦ç­‰åŠŸèƒ½</p>
<p>ç”¨æ³•</p>
<ul>
<li>Videoæä¾›æ„é€ å‚æ•° Video({ src: string | Resource })</li>
<li>srcæ”¯æŒåœ¨çº¿è·¯å¾„-å’Œæœ¬åœ°èµ„æºè·¯å¾„</li>
</ul>

<ul>
<li>ç¤ºä¾‹</li>
</ul>

<pre><code class="hljs language-css" lang="css"> <span class="hljs-selector-tag">Video</span>({
          <span class="hljs-attribute">src</span>:<span class="hljs-string">'https://video19.ifeng.com/video09/2024/05/23/p7199260608686989961-0-122707.mp4'</span>
        })
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<p>ç‰ˆæƒè¯´æ˜ï¼š ä¸Šè¿°ä»£ç ä¸­çš„è§†é¢‘é“¾æ¥ä¸ºå‚è€ƒå­¦ä¹ ï¼Œå¹¶éç”¨ä½œå•†ä¸šç”¨é€”ï¼Œè¯·åŒå­¦ä»¬è‡ªè¡Œæ”¾ç½®çš„å¤–é“¾è§†é¢‘é“¾æ¥</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f6dc5f2b5aac4899814b2b884f7fb610~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5p6X55-l6K-G5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763385398&amp;x-signature=MnqiGXd4p9Lfasg9LAFI2Vmb7QE%3D" alt="" loading="lazy"/>â€‹</p>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>ç¼–è¾‘</p>
<ul>
<li>æ”¾æ˜ æœ¬åœ°è§†é¢‘</li>
</ul>
<p>æœ¬åœ°è§†é¢‘æˆ‘ä»¬éœ€è¦æ”¾ç½®åœ¨èµ„æºç›®å½•çš„åŸå§‹æ–‡ä»¶ä¸­rawfileç›®å½•ä¸‹ï¼Œä½¿ç”¨$rawfileå‡½æ•°æ¥è·å–è·¯å¾„è¿›è¡Œèµ‹å€¼å³å¯</p>
<pre><code class="hljs language-css" lang="css"> <span class="hljs-selector-tag">Video</span>({
            <span class="hljs-attribute">src</span>: $<span class="hljs-built_in">rawfile</span>(<span class="hljs-string">'hm.mp4'</span>)
          })
            <span class="hljs-selector-class">.width</span>('<span class="hljs-number">100%</span>')
            <span class="hljs-selector-class">.aspectRatio</span>(<span class="hljs-number">1.4</span>)
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<ul>
<li>å®Œæ•´ä»£ç </li>
</ul>

<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Entry</span>
  <span class="hljs-variable">@Component</span>
  struct VideoCase {
    <span class="hljs-selector-tag">build</span>() {
      <span class="hljs-selector-tag">Row</span>() {
        <span class="hljs-selector-tag">Column</span>() {
          <span class="hljs-selector-tag">Tabs</span>(){
            <span class="hljs-selector-tag">TabContent</span>(){
              <span class="hljs-selector-tag">Video</span>({
                <span class="hljs-attribute">src</span>:<span class="hljs-string">'https://video19.ifeng.com/video09/2024/05/23/p7199260608686989961-0-122707.mp4'</span>
              })
            }.<span class="hljs-built_in">tabBar</span>(<span class="hljs-string">'åœ¨çº¿è§†é¢‘'</span>)
            <span class="hljs-built_in">TabContent</span>(){
              <span class="hljs-selector-tag">Video</span>({
                <span class="hljs-attribute">src</span>:$<span class="hljs-built_in">rawfile</span>(<span class="hljs-string">'hm.mp4'</span>)
              })
            }.<span class="hljs-built_in">tabBar</span>(<span class="hljs-string">'æœ¬åœ°è§†é¢‘'</span>)
          }
        }
        .<span class="hljs-built_in">width</span>(<span class="hljs-string">'100%'</span>)
      }
      .<span class="hljs-built_in">height</span>(<span class="hljs-string">'100%'</span>)
    }
  }
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<ul>
<li>è§†é¢‘æ§åˆ¶-æ’­æ”¾-æš‚åœ--å€é€Ÿ-å…¨å±-è¿›åº¦</li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æ„é€ å‡½æ•°ä¼ å…¥currentProgressRate æ§åˆ¶å€é€Ÿï¼Œå®ƒæ¥è‡ªPlaybackSpeedçš„æšä¸¾ï¼Œç›®å‰æ”¯æŒ</p>
<p>0.75-1-1.25-1.75-2å€é€Ÿè®¾ç½®</p>
<ul>
<li>åŒæ—¶æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¼ å…¥VideoControlleræ¥è·å–è§†é¢‘æ’­æ”¾çš„æ§åˆ¶æƒ</li>
</ul>

<ul>
<li>å®ç°æ§åˆ¶å€é€Ÿæ’­æ”¾</li>
</ul>

<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@Entry</span>
  <span class="hljs-keyword">@Component</span>
  struct VideoCase {
    <span class="hljs-keyword">@State</span>
    <span class="hljs-attribute">speed</span>: number = <span class="hljs-number">1</span>

    build() {
      <span class="hljs-built_in">Row</span>() {
        <span class="hljs-built_in">Tabs</span>() {
          <span class="hljs-built_in">TabContent</span>() {
            <span class="hljs-built_in">Column</span>({ space: <span class="hljs-number">20</span> }) {
              <span class="hljs-selector-tag">Video</span>({
                currentProgressRate: this.speed,
                src: 'https://vd3.bdstatic.com/mda-pmj5ajqd7p4b6pgb/<span class="hljs-number">576</span>p/h264/<span class="hljs-number">1703044058699262355</span>/mda-pmj5ajqd7p4b6pgb.mp4?auth_key=<span class="hljs-number">1703138418</span>-<span class="hljs-number">0</span>-<span class="hljs-number">0</span>-<span class="hljs-number">618</span>ea72b33be241c96c6cff86c06e080&amp;bcevod_channel=searchbox_feed&amp;cr=<span class="hljs-number">1</span>&amp;cd=<span class="hljs-number">0</span>&amp;pd=<span class="hljs-number">1</span>&amp;pt=<span class="hljs-number">4</span>&amp;logid=<span class="hljs-number">0018430194</span>&amp;vid=<span class="hljs-number">9762003448174112444</span>&amp;abtest=all'
              })
                <span class="hljs-selector-class">.width</span>('<span class="hljs-number">100%</span>')
                <span class="hljs-selector-class">.aspectRatio</span>(<span class="hljs-number">1.4</span>)
              <span class="hljs-built_in">Slider</span>({
                value: this.speed,
                min: <span class="hljs-number">0.75</span>,
                step: <span class="hljs-number">0.25</span>,
                max: <span class="hljs-number">2</span>,
                style: SliderStyle.InSet
              })
                <span class="hljs-selector-class">.showSteps</span>(true)
                <span class="hljs-selector-class">.onChange</span>(value =&gt; {
                  this.speed = value
                })
              Text(this.speed+"å€é€Ÿ")<span class="hljs-selector-class">.fontSize</span>(<span class="hljs-number">14</span>)<span class="hljs-selector-class">.textAlign</span>(TextAlign.Center)<span class="hljs-selector-class">.width</span>('<span class="hljs-number">100%</span>')

            }
            <span class="hljs-selector-class">.width</span>('<span class="hljs-number">100%</span>')
          }<span class="hljs-selector-class">.tabBar</span>("åœ¨çº¿è§†é¢‘")
          <span class="hljs-built_in">TabContent</span>() {
            <span class="hljs-selector-tag">Video</span>({
              src: $rawfile('hm.mp4')
            })
              <span class="hljs-selector-class">.width</span>('<span class="hljs-number">100%</span>')
              <span class="hljs-selector-class">.aspectRatio</span>(<span class="hljs-number">1.4</span>)
          }
          <span class="hljs-selector-class">.tabBar</span>("æœ¬åœ°è§†é¢‘")
        }
        <span class="hljs-selector-class">.animationDuration</span>(<span class="hljs-number">300</span>)

      }
      <span class="hljs-selector-class">.height</span>('<span class="hljs-number">100%</span>')
    }
  }
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<ul>
<li>å®ç°é€šè¿‡controlleræ§åˆ¶è§†é¢‘ æš‚åœ- æ’­æ”¾-åœæ­¢-å…¨å±-é™éŸ³-æ’­æ”¾é€Ÿåº¦- æ’­æ”¾è¿›åº¦</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7bc09adcebff4a17a567bdb762699546~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5p6X55-l6K-G5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763385398&amp;x-signature=IMGje3CHt05E3mi7U%2BSmeaf6CGI%3D" alt="" loading="lazy"/>â€‹</p>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>ç¼–è¾‘</p>
<p>è‡ªå®šä¹‰controllerï¼Œæ‰‹åŠ¨æ§åˆ¶è§†é¢‘æ’­æ”¾</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">import</span> { <span class="hljs-selector-tag">media</span> } <span class="hljs-selector-tag">from</span> '@<span class="hljs-selector-tag">kit</span><span class="hljs-selector-class">.MediaKit</span>'
<span class="hljs-selector-tag">import</span> { <span class="hljs-selector-tag">image</span> } <span class="hljs-selector-tag">from</span> '@<span class="hljs-selector-tag">kit</span><span class="hljs-selector-class">.ImageKit</span>'

@<span class="hljs-selector-tag">Entry</span>
  @<span class="hljs-selector-tag">Component</span>
  <span class="hljs-selector-tag">struct</span> <span class="hljs-selector-tag">VideoControlCase</span> {
    <span class="hljs-variable">@State</span>
    <span class="hljs-attribute">currentSpeed</span>: number = <span class="hljs-number">1</span>
    <span class="hljs-variable">@State</span>
    <span class="hljs-attribute">isMuted</span>: boolean = false
    <span class="hljs-variable">@State</span>
    <span class="hljs-attribute">showController</span>: boolean = false
    <span class="hljs-variable">@State</span>
    <span class="hljs-attribute">currentTime</span>: number = <span class="hljs-number">0</span>
    <span class="hljs-variable">@State</span>
    <span class="hljs-attribute">videoTime</span>: number = <span class="hljs-number">0</span>
    <span class="hljs-attribute">controller</span>: VideoController = new <span class="hljs-built_in">VideoController</span>()
    <span class="hljs-variable">@State</span> <span class="hljs-attribute">previewImage</span>: image.PixelMap | undefined = undefined

    <span class="hljs-built_in">build</span>() {
      <span class="hljs-selector-tag">Row</span>() {
        <span class="hljs-selector-tag">Column</span>({ space: 20 }) {
          <span class="hljs-selector-tag">Stack</span>({ alignContent: Alignment.BottomEnd }) {
            <span class="hljs-selector-tag">Video</span>({
              <span class="hljs-comment">// è§†é¢‘æº</span>
              <span class="hljs-attribute">src</span>: $<span class="hljs-built_in">rawfile</span>(<span class="hljs-string">'hm.mp4'</span>),
              <span class="hljs-comment">// å°é¢å›¾</span>
              <span class="hljs-attribute">previewUri</span>: this.previewImage,
              <span class="hljs-comment">// å€é€Ÿ 0.75 ~ 2,0.25ä¸€ä¸ªæ¡£</span>
              <span class="hljs-attribute">currentProgressRate</span>: this.currentSpeed,
              <span class="hljs-comment">// æ§åˆ¶å™¨</span>
              <span class="hljs-attribute">controller</span>: this.controller

            })
              <span class="hljs-selector-class">.height</span>(<span class="hljs-number">400</span>)
              <span class="hljs-selector-class">.objectFit</span>(ImageFit.Contain)<span class="hljs-comment">// å¡«å……æ¨¡å¼</span>
              <span class="hljs-selector-class">.autoPlay</span>(true)<span class="hljs-comment">// è‡ªåŠ¨æ’­æ”¾</span>
              <span class="hljs-selector-class">.loop</span>(true)<span class="hljs-comment">// å¾ªç¯æ’­æ”¾</span>
              <span class="hljs-selector-class">.muted</span>(this.isMuted)<span class="hljs-comment">// æ˜¯å¦é™éŸ³</span>
              <span class="hljs-selector-class">.controls</span>(this.showController)<span class="hljs-comment">//æ˜¯å¦å±•ç¤ºæ§åˆ¶æ </span>
              <span class="hljs-selector-class">.onAppear</span>(async () =&gt; {
                <span class="hljs-comment">//è·å–è§†é¢‘çš„å†…éƒ¨çš„æˆªå›¾</span>
                <span class="hljs-selector-tag">const</span> <span class="hljs-selector-tag">generator</span> = <span class="hljs-selector-tag">await</span> <span class="hljs-selector-tag">media</span><span class="hljs-selector-class">.createAVImageGenerator</span>()
                <span class="hljs-selector-tag">generator</span><span class="hljs-selector-class">.fdSrc</span> = <span class="hljs-selector-tag">await</span> <span class="hljs-selector-tag">getContext</span>()<span class="hljs-selector-class">.resourceManager</span><span class="hljs-selector-class">.getRawFd</span>(<span class="hljs-string">'1.mp4'</span>)
                <span class="hljs-selector-tag">const</span> <span class="hljs-selector-tag">previewUri</span> =
                  <span class="hljs-selector-tag">await</span> <span class="hljs-selector-tag">generator</span><span class="hljs-selector-class">.fetchFrameByTime</span>(<span class="hljs-number">5000</span>, media.AVImageQueryOptions.AV_IMAGE_QUERY_NEXT_SYNC,
                                                   { <span class="hljs-attribute">height</span>: <span class="hljs-number">400</span>, <span class="hljs-attribute">width</span>: <span class="hljs-number">300</span> })
                <span class="hljs-selector-tag">this</span><span class="hljs-selector-class">.previewImage</span> = <span class="hljs-selector-tag">previewUri</span>
              })
              <span class="hljs-selector-class">.onPrepared</span>((time) =&gt; { <span class="hljs-comment">// è§†é¢‘å‡†å¤‡å¥½äº†å¯ä»¥è·å–è§†é¢‘çš„æ—¶é•¿</span>
                <span class="hljs-selector-tag">this</span><span class="hljs-selector-class">.videoTime</span> = <span class="hljs-selector-tag">time</span><span class="hljs-selector-class">.duration</span>
              })
              <span class="hljs-selector-class">.onUpdate</span>((time) =&gt; { <span class="hljs-comment">// è§†é¢‘æ’­æ”¾ä¸­å¯ä»¥è·å–æ’­æ”¾çš„æ—¶é•¿</span>
                <span class="hljs-selector-tag">this</span><span class="hljs-selector-class">.currentTime</span> = <span class="hljs-selector-tag">time</span><span class="hljs-selector-class">.time</span>
              })
              <span class="hljs-selector-class">.onFullscreenChange</span>((screen) =&gt; { <span class="hljs-comment">// æ ¹æ®æ˜¯å¦å…¨å±åˆ¤æ–­æ˜¯å¦å±•ç¤ºæ§åˆ¶æ¡</span>
                <span class="hljs-selector-tag">this</span><span class="hljs-selector-class">.showController</span> = <span class="hljs-selector-tag">screen</span><span class="hljs-selector-class">.fullscreen</span>
              })
            <span class="hljs-selector-tag">Row</span>() {
              <span class="hljs-selector-tag">Button</span>(<span class="hljs-string">'å…¨å±'</span>)
                <span class="hljs-selector-class">.onClick</span>(() =&gt; {
                  <span class="hljs-selector-tag">this</span><span class="hljs-selector-class">.controller</span><span class="hljs-selector-class">.requestFullscreen</span>(true)
                })
              <span class="hljs-comment">// ä¸€èˆ¬ä¸éœ€è¦æ‰‹åŠ¨å…¨å±ï¼Œå¯ä»¥è¿‡å‡ ç§’è‡ªåŠ¨é€€å‡ºï¼Œæç¤ºè¯¥å……å€¼äº†ï¼</span>
              <span class="hljs-comment">// Button('é€€å‡ºå…¨å±')</span>
              <span class="hljs-comment">//   .onClick(() =&gt; {</span>
              <span class="hljs-comment">//     this.controller.exitFullscreen()</span>
              <span class="hljs-comment">//   })</span>
            }
          }


          <span class="hljs-selector-tag">Row</span>({ space: 20 }) {
            <span class="hljs-selector-tag">Text</span>(<span class="hljs-string">'æ’­æ”¾è¿›åº¦ï¼š'</span>)
            <span class="hljs-selector-tag">Slider</span>({
              value: $$this.currentTime,
              min: 0,
              max: this.videoTime,
            })
              <span class="hljs-selector-class">.layoutWeight</span>(<span class="hljs-number">1</span>)<span class="hljs-comment">// æ”¹å˜æ—¶è®¾ç½®è§†é¢‘æ’­æ”¾æ—¶é•¿</span>
              <span class="hljs-selector-class">.onChange</span>((val) =&gt; {
                <span class="hljs-selector-tag">this</span><span class="hljs-selector-class">.controller</span><span class="hljs-selector-class">.setCurrentTime</span>(val)
              })
          }
          <span class="hljs-selector-class">.padding</span>(<span class="hljs-number">20</span>)

          <span class="hljs-selector-tag">Row</span>({ space: 20 }) {
            <span class="hljs-selector-tag">Text</span>(<span class="hljs-string">'æ’­æ”¾é€Ÿåº¦ï¼š'</span>)
            <span class="hljs-selector-tag">Slider</span>({
              value: $$this.currentSpeed,
              min: 0.75,
              max: 2,
              step: 0.25
            })
              <span class="hljs-selector-class">.layoutWeight</span>(<span class="hljs-number">1</span>)

          }
          .<span class="hljs-built_in">padding</span>(<span class="hljs-number">20</span>)

          <span class="hljs-built_in">Row</span>({ <span class="hljs-attribute">space</span>: <span class="hljs-number">20</span> }) {
            <span class="hljs-selector-tag">Button</span>(<span class="hljs-string">'æ’­æ”¾'</span>)
              <span class="hljs-selector-class">.onClick</span>(() =&gt; {
                <span class="hljs-selector-tag">this</span><span class="hljs-selector-class">.controller</span><span class="hljs-selector-class">.start</span>()
              })
            <span class="hljs-selector-tag">Button</span>(<span class="hljs-string">'æš‚åœ'</span>)
              <span class="hljs-selector-class">.onClick</span>(() =&gt; {
              <span class="hljs-selector-tag">this</span><span class="hljs-selector-class">.controller</span><span class="hljs-selector-class">.pause</span>()
            })
          <span class="hljs-selector-tag">Button</span>(<span class="hljs-string">'åœæ­¢'</span>)
            <span class="hljs-selector-class">.onClick</span>(() =&gt; {
              <span class="hljs-selector-tag">this</span><span class="hljs-selector-class">.controller</span><span class="hljs-selector-class">.stop</span>()
            })
          <span class="hljs-selector-tag">Button</span>(<span class="hljs-string">'é™éŸ³'</span>)
            <span class="hljs-selector-class">.onClick</span>(() =&gt; {
              <span class="hljs-selector-tag">this</span><span class="hljs-selector-class">.isMuted</span> = !<span class="hljs-selector-tag">this</span><span class="hljs-selector-class">.isMuted</span>
            })
        }
      }
      <span class="hljs-selector-class">.width</span>(<span class="hljs-string">'100%'</span>)
    }
    <span class="hljs-selector-class">.height</span>(<span class="hljs-string">'100%'</span>)
  }
}
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<p>åŒç†- å¦‚æœæˆ‘ä»¬æƒ³æ’­æ”¾ä¸€æ®µéŸ³é¢‘-ç”¨åŒæ ·çš„æ–¹å¼ç»™åˆ°æˆ‘ä»¬çš„Videoçš„srcå±æ€§å°±å¯ä»¥äº†VideoåŒæ—¶æ”¯æŒ</p>
<h3 data-id="heading-2">4.2 æŠ–éŸ³å°æ¡ˆä¾‹</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c080c15821174f3b9094322bae030800~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5p6X55-l6K-G5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763385398&amp;x-signature=Qpt%2BEHvH7d%2BKL8QvAGN703%2BuxFg%3D" alt="" loading="lazy"/>â€‹</p>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>ç¼–è¾‘</p>
<ul>
<li>å£°æ˜ç±»å‹å’Œæ•°æ®</li>
</ul>

<pre><code class="hljs language-css" lang="css">class VideoItem {
  videoUrl: string = <span class="hljs-string">''</span>
  title: string = <span class="hljs-string">""</span>
}

const allData: VideoItem[] = [
  {
    videoUrl: <span class="hljs-string">'https://vd4.bdstatic.com/mda-pmia5y0htmibjej2/576p/h264/1702970058650094297/mda-pmia5y0htmibjej2.mp4?auth_key=1703155514-0-0-a92de0b6c32239b242d0e51b151ee2d6&amp;bcevod_channel=searchbox_feed&amp;cr=1&amp;cd=0&amp;pd=1&amp;pt=4&amp;logid=2714832517&amp;vid=9811936085320099438&amp;abtest=all'</span>,
    title: <span class="hljs-string">'æˆ‘ä»¬åªæ˜¯æ‹¿æŸç«™çš„æ•°æ®è¿›è¡Œä¸€ä¸‹æµ‹è¯•'</span>
  },
  {
    title: <span class="hljs-string">'è¯·å¤§å®¶è‡ªè¡Œå‡†å¤‡åœ¨çº¿ç´ æ'</span>,
    videoUrl: <span class="hljs-string">'https://vd4.bdstatic.com/mda-pmjxx4ccc8x719t3/hd/h264/1703111503445924222/mda-pmjxx4ccc8x719t3.mp4?auth_key=1703155561-0-0-e7c32efbedae026e0e17c900bbd0cf55&amp;bcevod_channel=searchbox_feed&amp;pd=1&amp;cr=1&amp;cd=0&amp;pt=4&amp;logid=2761194416&amp;vid=7476642150019887968&amp;abtest=all'</span>
  },
  {
    title: <span class="hljs-string">'ä½ çŸ¥é“å†¬å¤©çš„é›ªæ˜¯ä»€ä¹ˆé¢œè‰²å—, æˆ‘çŒœä½ ä¸çŸ¥é“'</span>,
    videoUrl: <span class="hljs-string">'https://vd4.bdstatic.com/mda-pku9q3zt0rzybip0/hd/cae_h264/1701381974031001593/mda-pku9q3zt0rzybip0.mp4?v_from_s=hkapp-haokan-hbf&amp;auth_key=1703155589-0-0-133df5be4b625ce34e1a75fe3a4baabf&amp;bcevod_channel=searchbox_feed&amp;pd=1&amp;cr=1&amp;cd=0&amp;pt=4&amp;logid=2789259407&amp;vid=4775310688475056528&amp;abtest=all'</span>
  },
  {
    title: <span class="hljs-string">'å®å­ä»¬ï¼Œæˆ‘å½“ä¼—ç¤¾æ­»äº†ï¼Œæˆ‘ç«Ÿç„¶åœ¨ä¼—ç›®ç½ç½ä¹‹ä¸‹å®Œæˆäº†è‡ªå·±äººç”Ÿä¸­çš„ç¬¬ä¸€æ®µç¨‹åº'</span>,
    videoUrl: <span class="hljs-string">'https://vd2.bdstatic.com/mda-pkkf9qb7zksdaqs9/576p/h264/1700564765354260319/mda-pkkf9qb7zksdaqs9.mp4?v_from_s=hkapp-haokan-hbf&amp;auth_key=1703155630-0-0-9a47a2910e8d5d90b47ba709fa530b5e&amp;bcevod_channel=searchbox_feed&amp;pd=1&amp;cr=1&amp;cd=0&amp;pt=4&amp;logid=2830328412&amp;vid=8335346471874826776&amp;abtest=all'</span>
  },
  {
    title: <span class="hljs-string">'æ–‡å­¦ï¼Œå¯ä»¥åœ¨å¯‚é™çš„å¤œç”¨æ›¼å¦™çš„æ–‡å­—å‹¾å‹’å‡ºå…³äºäººç”Ÿï¼ŒèŒåœºï¼Œæ„Ÿæƒ…çš„è¯¸å¤šæƒ…ç»ªï¼Œæ— å¥ˆæ­¤ç”Ÿå½“ä¸ºç¨‹åºå‘˜'</span>,
    videoUrl: <span class="hljs-string">'https://vd2.bdstatic.com/mda-pj8qa65bc9r1v1cf/576p/h264/1696871444324088416/mda-pj8qa65bc9r1v1cf.mp4?auth_key=1703155654-0-0-fdc0ca9c37ec26be3da9809b89e6151c&amp;bcevod_channel=searchbox_feed&amp;pd=1&amp;cr=1&amp;cd=0&amp;pt=4&amp;logid=2854467125&amp;vid=5483608480722064830&amp;abtest=all'</span>
  },
  {
    title: <span class="hljs-string">'å½“ä½ é˜…è¯»åˆ°è¿™æ®µæ–‡å­—çš„æ—¶å€™ï¼Œæˆ‘æ—©å·²å…¥ç¡ï¼Œå½“æˆ‘åœ¨ç¡æ¢¦ä¸­æƒŠé†’ï¼Œä½ å´æ—©å·²å®‰ç„¶ç¡å»'</span>,
    videoUrl: <span class="hljs-string">'https://vd2.bdstatic.com/mda-pmexhyfui3e6rbmd/hd/cae_h264/1702705379314308540/mda-pmexhyfui3e6rbmd.mp4?auth_key=1703155684-0-0-5b0145fb4c2ec2f0d1bbd525ddb3d592&amp;bcevod_channel=searchbox_feed&amp;pd=1&amp;cr=1&amp;cd=0&amp;pt=4&amp;logid=2884962294&amp;vid=3059586091403538183&amp;abtest=all'</span>
  },
  {
    title: <span class="hljs-string">'æ¯ä¸ªäººçš„å†…å¿ƒéƒ½æœ‰ä¸€æ®µç‹¬å¤„çš„å¹½é—­ï¼Œä¸å¯è¯‰è¯´çš„çª’æ¯æ„Ÿå­¤ç‹¬æ„Ÿåœ¨æ¯å½“æˆ‘ä»¬æ²‰é™ä¸‹æ¥çš„æ—¶å€™å˜æ„ˆå‘å¼ºçƒˆ'</span>,
    videoUrl: <span class="hljs-string">'https://vd3.bdstatic.com/mda-pmbgjjpkihkf7tjd/576p/h264/1702381478247675613/mda-pmbgjjpkihkf7tjd.mp4?v_from_s=hkapp-haokan-hbf&amp;auth_key=1703155722-0-0-ea3c2453fbbb2cca66b12e9afe3d419f&amp;bcevod_channel=searchbox_feed&amp;pd=1&amp;cr=1&amp;cd=0&amp;pt=4&amp;logid=2922207105&amp;vid=9050628586030215591&amp;abtest=all'</span>
  },
  {
    title: <span class="hljs-string">'å¦‚æœåœ¨æœªæ¥çš„æŸä¸€å¤©ï¼ŒæŸä¸€ä¸ªæ—©æ™¨ æ™šä¸Š ç¬é—´ï¼Œä½ ä¼šå¶ç„¶æƒ³èµ·å¤šå¹´å‰çš„ä¸€æ®µå¾€äº‹ï¼Œå…¶å®å¹¶ä¸æ˜¯æˆ‘ä»¬æœ‰å¤šæ€€æ—§ï¼Œåªæ˜¯å› ä¸ºæˆ‘ä»¬èµ°è¿‡äº†å¤ªå¤šçš„è·¯'</span>,
    videoUrl: <span class="hljs-string">'https://vd2.bdstatic.com/mda-pj7ktq9euqchetdc/cae_h264/1696824500894354779/mda-pj7ktq9euqchetdc.mp4?v_from_s=hkapp-haokan-hbf&amp;auth_key=1703155751-0-0-fccb0f110a3b447af67eb0feeabf06ad&amp;bcevod_channel=searchbox_feed&amp;pd=1&amp;cr=0&amp;cd=0&amp;pt=4&amp;logid=2951492012&amp;vid=12162674818438199896'</span>
  },
  {
    title: <span class="hljs-string">'ä»€ä¹ˆæ˜¯çŸ¥å·±ï¼Œæœ‰ä¸ªç½‘çº¢è¯´ï¼Œå½“ä½ ç†è§£æ‰€æœ‰äººçš„æ—¶å€™ï¼Œä½ ä¸€å®šä¸èƒ½è¢«æ‰€æœ‰äººç†è§£ï¼Œæ¯ä¸ªäººéƒ½æˆ–å¤šæˆ–å°‘çš„è‡ªç§ï¼Œåªæ˜¯æˆ–å¤šæˆ–å°‘è€Œå·²'</span>,
    videoUrl: <span class="hljs-string">'https://vd3.bdstatic.com/mda-pmh5hr95fg6u8u0k/hd/cae_h264/1702877143957184120/mda-pmh5hr95fg6u8u0k.mp4?v_from_s=hkapp-haokan-hbf&amp;auth_key=1703155785-0-0-5cfc2be95d00306082c7875a747dd998&amp;bcevod_channel=searchbox_feed&amp;pd=1&amp;cr=1&amp;cd=0&amp;pt=4&amp;logid=2985314718&amp;vid=2720370579167170031&amp;abtest=all'</span>
  }
]
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<ul>
<li>å®ç°ä»£ç </li>
</ul>

<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Entry</span>
  <span class="hljs-variable">@Component</span>
  struct DouyinCase {
    <span class="hljs-variable">@State</span>
    <span class="hljs-attribute">list</span>: VideoItem[] = allData
    <span class="hljs-variable">@State</span>
    <span class="hljs-attribute">activeIndex</span>: number = <span class="hljs-number">0</span>

    <span class="hljs-built_in">build</span>() {
      <span class="hljs-selector-tag">Swiper</span>() {
        <span class="hljs-comment">// å¾ªç¯çš„æ•°æ® æŠ–éŸ³çš„åˆ—è¡¨æ•°æ®</span>
        <span class="hljs-selector-tag">ForEach</span>(this.list, (<span class="hljs-attribute">item</span>: VideoItem, <span class="hljs-attribute">index</span>: number) =&gt; {
          <span class="hljs-comment">// å°è£…å•ç‹¬çš„ç»„ä»¶å®ç° Videoç»„ä»¶</span>
          <span class="hljs-selector-tag">VideoComp</span>({
            <span class="hljs-selector-tag">item</span>,
            <span class="hljs-selector-tag">index</span>,
            <span class="hljs-selector-tag">activeIndex</span>: <span class="hljs-selector-tag">this</span><span class="hljs-selector-class">.activeIndex</span>
          })
        })
      }
      <span class="hljs-selector-class">.index</span>($$this.activeIndex)
        <span class="hljs-selector-class">.cachedCount</span>(<span class="hljs-number">3</span>)
        <span class="hljs-selector-class">.vertical</span>(true)
        <span class="hljs-selector-class">.indicator</span>(false)
        <span class="hljs-selector-class">.width</span>(<span class="hljs-string">'100%'</span>)
        <span class="hljs-selector-class">.height</span>(<span class="hljs-string">'100%'</span>)
    }
  }

@<span class="hljs-selector-tag">Component</span>
  <span class="hljs-selector-tag">struct</span> <span class="hljs-selector-tag">VideoComp</span> {
    item: VideoItem = new VideoItem()
    index: number = -1
    @Require
    @Prop
    @Watch('changeVideo')
    activeIndex: number

    changeVideo() {
      this.activeIndex === this.index ? this.controller.start() : this.controller.<span class="hljs-attribute">pause()
    }

    controller</span>: VideoController = new <span class="hljs-built_in">VideoController</span>()

    <span class="hljs-variable">@State</span>
    <span class="hljs-attribute">isPlay</span>:boolean = true
    <span class="hljs-built_in">build</span>() {
      <span class="hljs-built_in">Stack</span>({ <span class="hljs-attribute">alignContent</span>: Alignment.Bottom }) {
        <span class="hljs-built_in">Stack</span>(){
          <span class="hljs-built_in">Video</span>({
            <span class="hljs-attribute">src</span>: this.item.videoUrl,
            <span class="hljs-attribute">controller</span>: this.controller
          })
            .<span class="hljs-built_in">controls</span>(false)
            .<span class="hljs-built_in">objectFit</span>(ImageFit.Contain)
            .<span class="hljs-built_in">autoPlay</span>(this.activeIndex === this.index ? <span class="hljs-attribute">true </span>: false)
            .<span class="hljs-built_in">loop</span>(true)
            .<span class="hljs-built_in">onPause</span>(()=&gt;{
              this.isPlay = false
            })
            .<span class="hljs-built_in">onStart</span>(()=&gt;{
              this.isPlay = true
            })
            .<span class="hljs-built_in">onClick</span>(()=&gt;{
              this.isPlay?this.controller.<span class="hljs-built_in">pause</span>():this.controller.<span class="hljs-built_in">start</span>()
            })
          <span class="hljs-built_in">if</span>(!this.isPlay){
            <span class="hljs-built_in">Image</span>($<span class="hljs-built_in">r</span>(<span class="hljs-string">'sys.media.ohos_ic_public_play'</span>))
              .<span class="hljs-built_in">width</span>(<span class="hljs-number">100</span>)
              .<span class="hljs-built_in">aspectRatio</span>(<span class="hljs-number">1</span>)
              .<span class="hljs-built_in">fillColor</span>(<span class="hljs-string">'#ccc'</span>)
              .<span class="hljs-built_in">onClick</span>(()=&gt;{
                this.controller.<span class="hljs-built_in">start</span>()
              })
          }
        }
        <span class="hljs-built_in">Text</span>(this.item.title)
          .<span class="hljs-built_in">fontSize</span>(<span class="hljs-number">14</span>)
          .<span class="hljs-built_in">fontColor</span>(<span class="hljs-attribute">Color</span>.White)
          .<span class="hljs-built_in">padding</span>(<span class="hljs-number">20</span>)
      }
    }
  }

class VideoItem {
  videoUrl: string = ''
  title: string = ""
}

<span class="hljs-selector-tag">const</span> <span class="hljs-selector-tag">allData</span>: <span class="hljs-selector-tag">VideoItem</span><span class="hljs-selector-attr">[]</span> = <span class="hljs-selector-attr">[  {    videoUrl: <span class="hljs-string">'https://vd4.bdstatic.com/mda-pmia5y0htmibjej2/576p/h264/1702970058650094297/mda-pmia5y0htmibjej2.mp4?auth_key=1703155514-0-0-a92de0b6c32239b242d0e51b151ee2d6&amp;bcevod_channel=searchbox_feed&amp;cr=1&amp;cd=0&amp;pd=1&amp;pt=4&amp;logid=2714832517&amp;vid=9811936085320099438&amp;abtest=all'</span>,    title: <span class="hljs-string">'æˆ‘ä»¬åªæ˜¯æ‹¿æŸç«™çš„æ•°æ®è¿›è¡Œä¸€ä¸‹æµ‹è¯•'</span>  },  {    title: <span class="hljs-string">'è¯·å¤§å®¶è‡ªè¡Œå‡†å¤‡åœ¨çº¿ç´ æ'</span>,    videoUrl: <span class="hljs-string">'https://vd4.bdstatic.com/mda-pmjxx4ccc8x719t3/hd/h264/1703111503445924222/mda-pmjxx4ccc8x719t3.mp4?auth_key=1703155561-0-0-e7c32efbedae026e0e17c900bbd0cf55&amp;bcevod_channel=searchbox_feed&amp;pd=1&amp;cr=1&amp;cd=0&amp;pt=4&amp;logid=2761194416&amp;vid=7476642150019887968&amp;abtest=all'</span>  },  {    title: <span class="hljs-string">'ä½ çŸ¥é“å†¬å¤©çš„é›ªæ˜¯ä»€ä¹ˆé¢œè‰²å—, æˆ‘çŒœä½ ä¸çŸ¥é“'</span>,    videoUrl: <span class="hljs-string">'https://vd4.bdstatic.com/mda-pku9q3zt0rzybip0/hd/cae_h264/1701381974031001593/mda-pku9q3zt0rzybip0.mp4?v_from_s=hkapp-haokan-hbf&amp;auth_key=1703155589-0-0-133df5be4b625ce34e1a75fe3a4baabf&amp;bcevod_channel=searchbox_feed&amp;pd=1&amp;cr=1&amp;cd=0&amp;pt=4&amp;logid=2789259407&amp;vid=4775310688475056528&amp;abtest=all'</span>  },  {    title: <span class="hljs-string">'å®å­ä»¬ï¼Œæˆ‘å½“ä¼—ç¤¾æ­»äº†ï¼Œæˆ‘ç«Ÿç„¶åœ¨ä¼—ç›®ç½ç½ä¹‹ä¸‹å®Œæˆäº†è‡ªå·±äººç”Ÿä¸­çš„ç¬¬ä¸€æ®µç¨‹åº'</span>,    videoUrl: <span class="hljs-string">'https://vd2.bdstatic.com/mda-pkkf9qb7zksdaqs9/576p/h264/1700564765354260319/mda-pkkf9qb7zksdaqs9.mp4?v_from_s=hkapp-haokan-hbf&amp;auth_key=1703155630-0-0-9a47a2910e8d5d90b47ba709fa530b5e&amp;bcevod_channel=searchbox_feed&amp;pd=1&amp;cr=1&amp;cd=0&amp;pt=4&amp;logid=2830328412&amp;vid=8335346471874826776&amp;abtest=all'</span>  },  {    title: <span class="hljs-string">'æ–‡å­¦ï¼Œå¯ä»¥åœ¨å¯‚é™çš„å¤œç”¨æ›¼å¦™çš„æ–‡å­—å‹¾å‹’å‡ºå…³äºäººç”Ÿï¼ŒèŒåœºï¼Œæ„Ÿæƒ…çš„è¯¸å¤šæƒ…ç»ªï¼Œæ— å¥ˆæ­¤ç”Ÿå½“ä¸ºç¨‹åºå‘˜'</span>,    videoUrl: <span class="hljs-string">'https://vd2.bdstatic.com/mda-pj8qa65bc9r1v1cf/576p/h264/1696871444324088416/mda-pj8qa65bc9r1v1cf.mp4?auth_key=1703155654-0-0-fdc0ca9c37ec26be3da9809b89e6151c&amp;bcevod_channel=searchbox_feed&amp;pd=1&amp;cr=1&amp;cd=0&amp;pt=4&amp;logid=2854467125&amp;vid=5483608480722064830&amp;abtest=all'</span>  },  {    title: <span class="hljs-string">'å½“ä½ é˜…è¯»åˆ°è¿™æ®µæ–‡å­—çš„æ—¶å€™ï¼Œæˆ‘æ—©å·²å…¥ç¡ï¼Œå½“æˆ‘åœ¨ç¡æ¢¦ä¸­æƒŠé†’ï¼Œä½ å´æ—©å·²å®‰ç„¶ç¡å»'</span>,    videoUrl: <span class="hljs-string">'https://vd2.bdstatic.com/mda-pmexhyfui3e6rbmd/hd/cae_h264/1702705379314308540/mda-pmexhyfui3e6rbmd.mp4?auth_key=1703155684-0-0-5b0145fb4c2ec2f0d1bbd525ddb3d592&amp;bcevod_channel=searchbox_feed&amp;pd=1&amp;cr=1&amp;cd=0&amp;pt=4&amp;logid=2884962294&amp;vid=3059586091403538183&amp;abtest=all'</span>  },  {    title: <span class="hljs-string">'æ¯ä¸ªäººçš„å†…å¿ƒéƒ½æœ‰ä¸€æ®µç‹¬å¤„çš„å¹½é—­ï¼Œä¸å¯è¯‰è¯´çš„çª’æ¯æ„Ÿå­¤ç‹¬æ„Ÿåœ¨æ¯å½“æˆ‘ä»¬æ²‰é™ä¸‹æ¥çš„æ—¶å€™å˜æ„ˆå‘å¼ºçƒˆ'</span>,    videoUrl: <span class="hljs-string">'https://vd3.bdstatic.com/mda-pmbgjjpkihkf7tjd/576p/h264/1702381478247675613/mda-pmbgjjpkihkf7tjd.mp4?v_from_s=hkapp-haokan-hbf&amp;auth_key=1703155722-0-0-ea3c2453fbbb2cca66b12e9afe3d419f&amp;bcevod_channel=searchbox_feed&amp;pd=1&amp;cr=1&amp;cd=0&amp;pt=4&amp;logid=2922207105&amp;vid=9050628586030215591&amp;abtest=all'</span>  },  {    title: <span class="hljs-string">'å¦‚æœåœ¨æœªæ¥çš„æŸä¸€å¤©ï¼ŒæŸä¸€ä¸ªæ—©æ™¨ æ™šä¸Š ç¬é—´ï¼Œä½ ä¼šå¶ç„¶æƒ³èµ·å¤šå¹´å‰çš„ä¸€æ®µå¾€äº‹ï¼Œå…¶å®å¹¶ä¸æ˜¯æˆ‘ä»¬æœ‰å¤šæ€€æ—§ï¼Œåªæ˜¯å› ä¸ºæˆ‘ä»¬èµ°è¿‡äº†å¤ªå¤šçš„è·¯'</span>,    videoUrl: <span class="hljs-string">'https://vd2.bdstatic.com/mda-pj7ktq9euqchetdc/cae_h264/1696824500894354779/mda-pj7ktq9euqchetdc.mp4?v_from_s=hkapp-haokan-hbf&amp;auth_key=1703155751-0-0-fccb0f110a3b447af67eb0feeabf06ad&amp;bcevod_channel=searchbox_feed&amp;pd=1&amp;cr=0&amp;cd=0&amp;pt=4&amp;logid=2951492012&amp;vid=12162674818438199896'</span>  },  {    title: <span class="hljs-string">'ä»€ä¹ˆæ˜¯çŸ¥å·±ï¼Œæœ‰ä¸ªç½‘çº¢è¯´ï¼Œå½“ä½ ç†è§£æ‰€æœ‰äººçš„æ—¶å€™ï¼Œä½ ä¸€å®šä¸èƒ½è¢«æ‰€æœ‰äººç†è§£ï¼Œæ¯ä¸ªäººéƒ½æˆ–å¤šæˆ–å°‘çš„è‡ªç§ï¼Œåªæ˜¯æˆ–å¤šæˆ–å°‘è€Œå·²'</span>,    videoUrl: <span class="hljs-string">'https://vd3.bdstatic.com/mda-pmh5hr95fg6u8u0k/hd/cae_h264/1702877143957184120/mda-pmh5hr95fg6u8u0k.mp4?v_from_s=hkapp-haokan-hbf&amp;auth_key=1703155785-0-0-5cfc2be95d00306082c7875a747dd998&amp;bcevod_channel=searchbox_feed&amp;pd=1&amp;cr=1&amp;cd=0&amp;pt=4&amp;logid=2985314718&amp;vid=2720370579167170031&amp;abtest=all'</span>  }]</span>
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<h3 data-id="heading-3">4.3 ç»˜ç”»èƒ½åŠ›-ç”»å¸ƒç»„ä»¶</h3>
<ul>
<li>ArkUIé‡Œé¢çš„ç”»å¸ƒå’Œå‰ç«¯çš„Canvasçš„ç”¨æ³•åŸºæœ¬ä¸€è‡´</li>
<li>ä½¿ç”¨æ–¹æ³•</li>
</ul>
<ol>
<li>
<p>æ”¾ç½®Canvasç»„ä»¶-ç»™å®½å’Œé«˜</p>
</li>
<li>
<p>åˆå§‹åŒ–ç”»ç¬”å¯¹è±¡ CanvasRenderingContext2Dï¼Œå°†ç”»ç¬”å¯¹è±¡ä½œä¸ºæ„é€ å‚æ•°ä¼ é€’ç»™Canvasç»„ä»¶</p>
</li>
<li>
<p>å¯ä»¥åœ¨Canvasçš„onReadyäº‹ä»¶ä¸­è¿›è¡ŒåŠ¨æ€ç»˜åˆ¶</p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.harmonyos.com%2Fcn%2Fdocs%2Fdocumentation%2Fdoc-references-V3%2Fts-canvasrenderingcontext2d-0000001478181441-V3" title="https://developer.harmonyos.com/cn/docs/documentation/doc-references-V3/ts-canvasrenderingcontext2d-0000001478181441-V3" target="_blank" ref="nofollow noopener noreferrer">ç»˜åˆ¶æ–¹æ³•å®˜æ–¹æ–‡æ¡£</a></p>
</li>
</ol>
<ul>
<li>äº†è§£ç»˜ç”»çš„åŸºæœ¬æ¡ä»¶ï¼šç”»å¸ƒã€ç”»ç¬”ã€ç»˜åˆ¶æ–¹æ³•</li>
</ul>

<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@Entry</span>
  <span class="hljs-keyword">@Component</span>
  struct CanvasCase {
    <span class="hljs-comment">// 2.å‡†å¤‡ä¸€æ ¹ç¬”ï¼Œä¼ å…¥ç”»å¸ƒ</span>
    myPen: CanvasRenderingContext2D = new <span class="hljs-built_in">CanvasRenderingContext2D</span>()

    <span class="hljs-built_in">drawLine</span>() {
      <span class="hljs-comment">// moveToï¼šç¬”ç¦»å¼€ç”»å¸ƒç§»åŠ¨</span>
      this<span class="hljs-selector-class">.myPen</span><span class="hljs-selector-class">.moveTo</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
      <span class="hljs-comment">// moveToï¼šç¬”åœ¨ç”»å¸ƒç§»åŠ¨</span>
      this<span class="hljs-selector-class">.myPen</span><span class="hljs-selector-class">.lineTo</span>(<span class="hljs-number">100</span>, <span class="hljs-number">100</span>)
      <span class="hljs-comment">// çº¿å®½</span>
      this<span class="hljs-selector-class">.myPen</span><span class="hljs-selector-class">.lineWidth</span> = <span class="hljs-number">4</span>
      <span class="hljs-comment">// çº¿æ¡é¢œè‰²</span>
      this<span class="hljs-selector-class">.myPen</span><span class="hljs-selector-class">.strokeStyle</span> = 'red'
      <span class="hljs-comment">// ç»˜åˆ¶</span>
      this<span class="hljs-selector-class">.myPen</span><span class="hljs-selector-class">.stroke</span>()
    }

    <span class="hljs-built_in">build</span>() {
      <span class="hljs-built_in">Row</span>() {
        <span class="hljs-built_in">Column</span>() {
          <span class="hljs-comment">// 1.å‡†å¤‡ä¸€ä¸ªç”»å¸ƒ</span>
          <span class="hljs-selector-tag">Canvas</span>(this.myPen)
            <span class="hljs-selector-class">.width</span>('<span class="hljs-number">100%</span>')
            <span class="hljs-selector-class">.height</span>(<span class="hljs-number">300</span>)
            <span class="hljs-selector-class">.backgroundColor</span>(Color.Gray)
            <span class="hljs-selector-class">.onReady</span>(() =&gt; {
              <span class="hljs-comment">// 3.å‡†å¤‡å¥½åå°±å¯ä»¥è¿›è¡Œç»˜ç”»äº†</span>
              this<span class="hljs-selector-class">.drawLine</span>()
            })
        }
        <span class="hljs-selector-class">.width</span>('<span class="hljs-number">100%</span>')
      }
      <span class="hljs-selector-class">.height</span>('<span class="hljs-number">100%</span>')
    }
  }
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<p>ç»˜åˆ¶å…¶ä»–å†…å®¹</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e5f142dc0d024dd3bd9e2c059c1b9773~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5p6X55-l6K-G5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763385398&amp;x-signature=FKLwbJrAn11oD755e5fvZGb9FOs%3D" alt="" loading="lazy"/>â€‹</p>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>ç¼–è¾‘</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Entry</span>
  <span class="hljs-meta">@Component</span>
  struct CanvasCase2 {
    <span class="hljs-comment">// 2.å‡†å¤‡ä¸€æ ¹ç¬”ï¼Œä¼ å…¥ç”»å¸ƒ</span>
    myPen: CanvasRenderingContext2D = new CanvasRenderingContext2D()
    <span class="hljs-meta">@State</span>
    canvasWidth: number = <span class="hljs-number">0</span>
    <span class="hljs-meta">@State</span>
    canvasHeight: number = <span class="hljs-number">0</span>

    <span class="hljs-comment">// æ¸…ç©ºç”»å¸ƒ</span>
    drawClear() {
      <span class="hljs-keyword">this</span>.myPen.clearRect(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-keyword">this</span>.canvasWidth, <span class="hljs-keyword">this</span>.canvasHeight)
    }

    <span class="hljs-comment">// ç”»çº¿</span>
    drawLine() {
      <span class="hljs-keyword">this</span>.myPen.beginPath()
      <span class="hljs-comment">// moveToï¼šç¬”ç¦»å¼€ç”»å¸ƒç§»åŠ¨</span>
      <span class="hljs-keyword">this</span>.myPen.moveTo(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
      <span class="hljs-comment">// moveToï¼šç¬”åœ¨ç”»å¸ƒç§»åŠ¨</span>
      <span class="hljs-keyword">this</span>.myPen.lineTo(<span class="hljs-number">100</span>, <span class="hljs-number">100</span>)
      <span class="hljs-comment">// çº¿å®½</span>
      <span class="hljs-keyword">this</span>.myPen.lineWidth = <span class="hljs-number">4</span>
      <span class="hljs-comment">// çº¿æ¡é¢œè‰²</span>
      <span class="hljs-keyword">this</span>.myPen.strokeStyle = <span class="hljs-string">'red'</span>
      <span class="hljs-comment">// ç»˜åˆ¶</span>
      <span class="hljs-keyword">this</span>.myPen.stroke()
      <span class="hljs-keyword">this</span>.myPen.closePath()
    }

    <span class="hljs-comment">// ç”»åœ†</span>
    drawCircle() {
      <span class="hljs-keyword">this</span>.myPen.beginPath()
      <span class="hljs-keyword">this</span>.myPen.lineWidth = <span class="hljs-number">2</span>
      <span class="hljs-keyword">this</span>.myPen.arc(<span class="hljs-keyword">this</span>.canvasWidth / <span class="hljs-number">2</span>, <span class="hljs-keyword">this</span>.canvasHeight / <span class="hljs-number">2</span>, <span class="hljs-number">100</span>, <span class="hljs-number">0</span>, <span class="hljs-number">360</span>)
      <span class="hljs-keyword">this</span>.myPen.stroke()
      <span class="hljs-keyword">this</span>.myPen.closePath()
    }

    <span class="hljs-comment">// ç”»çŸ©å½¢</span>
    drawRect() {
      <span class="hljs-keyword">this</span>.myPen.beginPath()
      <span class="hljs-keyword">this</span>.myPen.lineWidth = <span class="hljs-number">2</span>
      <span class="hljs-keyword">this</span>.myPen.strokeRect(<span class="hljs-number">50</span>, <span class="hljs-number">50</span>, <span class="hljs-number">100</span>, <span class="hljs-number">80</span>)
      <span class="hljs-comment">// å®å¿ƒ</span>
      <span class="hljs-comment">// this.myPen.fillRect(50,50,100,80)</span>
      <span class="hljs-keyword">this</span>.myPen.closePath()
    }

    <span class="hljs-comment">// ç”»è´å¡å°”æ›²çº¿</span>
    drawBezierCurve() {
      <span class="hljs-keyword">this</span>.myPen.beginPath()
      <span class="hljs-keyword">this</span>.myPen.lineWidth = <span class="hljs-number">2</span>
      <span class="hljs-keyword">this</span>.myPen.moveTo(<span class="hljs-number">50</span>, <span class="hljs-number">50</span>)
      <span class="hljs-keyword">this</span>.myPen.bezierCurveTo(<span class="hljs-number">100</span>, <span class="hljs-number">233</span>, <span class="hljs-number">30</span>, <span class="hljs-number">327</span>, <span class="hljs-number">111</span>, <span class="hljs-number">343</span>)
      <span class="hljs-keyword">this</span>.myPen.stroke()
      <span class="hljs-keyword">this</span>.myPen.closePath()
    }

    <span class="hljs-comment">// ç”»æ–‡å­—</span>
    drawText(){
      <span class="hljs-keyword">this</span>.myPen.beginPath()
      <span class="hljs-keyword">this</span>.myPen.font = <span class="hljs-string">'100px  sans-serif '</span>
      <span class="hljs-keyword">this</span>.myPen.fillText(<span class="hljs-string">'ç²¾å¿ æŠ¥å›½'</span>,<span class="hljs-keyword">this</span>.canvasWidth/<span class="hljs-number">2</span>,<span class="hljs-keyword">this</span>.canvasHeight/<span class="hljs-number">2</span>)
      <span class="hljs-keyword">this</span>.myPen.closePath()
    }

    <span class="hljs-comment">//ç”»å›¾</span>
    drawImage(){
      <span class="hljs-keyword">this</span>.myPen.beginPath()
      <span class="hljs-keyword">this</span>.myPen.drawImage(new ImageBitmap(<span class="hljs-string">'/assets/1.webp'</span>),<span class="hljs-number">0</span>,<span class="hljs-number">0</span>)
      <span class="hljs-keyword">this</span>.myPen.closePath()
    }

    build() {
      Column({ space: <span class="hljs-number">15</span> }) {
        <span class="hljs-comment">// 1.å‡†å¤‡ä¸€ä¸ªç”»å¸ƒ</span>
        Canvas(<span class="hljs-keyword">this</span>.myPen)
          .width(<span class="hljs-string">'100%'</span>)
          .height(<span class="hljs-number">580</span>)
          .backgroundColor(Color.Gray)
          .onReady(() =&gt; {
            <span class="hljs-comment">// 3.å‡†å¤‡å¥½åå°±å¯ä»¥è¿›è¡Œç»˜ç”»äº†</span>
            <span class="hljs-comment">// this.drawLine()</span>
          })
          .onAreaChange((_, _val) =&gt; {
            <span class="hljs-keyword">this</span>.canvasWidth = _val.width <span class="hljs-keyword">as</span> number
            <span class="hljs-keyword">this</span>.canvasHeight = _val.height <span class="hljs-keyword">as</span> number
          })
        Flex({ wrap: FlexWrap.Wrap }) {
          Button(<span class="hljs-string">'æ¸…ç©º'</span>)
            .onClick(() =&gt; {
              <span class="hljs-keyword">this</span>.drawClear()
            })
          Button(<span class="hljs-string">'ç”»çº¿'</span>)
            .onClick(() =&gt; {
              <span class="hljs-keyword">this</span>.drawLine()
            })
          Button(<span class="hljs-string">'ç”»åœ†'</span>)
            .onClick(() =&gt; {
              <span class="hljs-keyword">this</span>.drawCircle()
            })
          Button(<span class="hljs-string">'ç”»çŸ©å½¢'</span>)
            .onClick(() =&gt; {
              <span class="hljs-keyword">this</span>.drawRect()
            })
          Button(<span class="hljs-string">'ç”»æ›²çº¿'</span>)
            .onClick(() =&gt; {
              <span class="hljs-keyword">this</span>.drawBezierCurve()
            })
          Button(<span class="hljs-string">'ç”»æ–‡å­—'</span>)
            .onClick(() =&gt; {
              <span class="hljs-keyword">this</span>.drawText()
            })
          Button(<span class="hljs-string">'ç”»å›¾'</span>)
            .onClick(() =&gt; {
              <span class="hljs-keyword">this</span>.drawImage()
            })
        }.width(<span class="hljs-string">'100%'</span>)
      }
      .width(<span class="hljs-string">'100%'</span>)
        .height(<span class="hljs-string">'100%'</span>)
    }
  }
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<h3 data-id="heading-4">4.4 ç­¾å­—ç‰ˆ</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/622b08199b1b42428c49b449a91aa88b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5p6X55-l6K-G5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763385398&amp;x-signature=5uh3IMTYvEEjWiwsGXdMEMhcwno%3D" alt="" loading="lazy"/>â€‹</p>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>ç¼–è¾‘</p>
<ul>
<li>æ¥ä¸‹æ¥éœ€è¦å¤„ç†ä»€ä¹ˆæ—¶å€™å¼€å§‹åœ¨ç”»æ¿ä¸Šç”»çš„æ—¶æœºé—®é¢˜äº†</li>
<li>Canvasæœ‰ä¸€ä¸ªonTouchäº‹ä»¶ï¼Œ é‡Œé¢åŒ…å« æŒ‰ä¸‹ï¼ŒæŠ¬èµ·ï¼Œç§»åŠ¨ç­‰äº‹ä»¶ï¼Œæˆ‘ä»¬è®¤ä¸ºæŒ‰ä¸‹ï¼Œè¡¨ç¤ºå¼€å§‹ç”»ï¼ŒæŠ¬èµ·è¡¨ç¤ºåŠ¨ä½œç»“æŸï¼Œç§»åŠ¨è¡¨ç¤ºæ­£å¼ç»˜åˆ¶ï¼Œå°è¯•ç”¨äº‹ä»¶æ¥æµ‹è¯•ä¸€ä¸‹</li>
</ul>

<pre><code class="hljs language-scss" lang="scss"><span class="hljs-selector-tag">Canvas</span>(this.context)
         <span class="hljs-selector-class">.width</span>(<span class="hljs-number">360</span>)
         <span class="hljs-selector-class">.height</span>(<span class="hljs-number">300</span>)
         <span class="hljs-selector-class">.backgroundColor</span>(Color.Pink)
         <span class="hljs-selector-class">.onTouch</span>((event: TouchEvent) =&gt; {
           <span class="hljs-built_in">if</span>(event.type === TouchType.Down) {
             promptAction<span class="hljs-selector-class">.showToast</span>({ message: 'å¼€å§‹ç»˜ç”»' })
           }
           <span class="hljs-built_in">if</span>(event.type === TouchType.Move) {
             promptAction<span class="hljs-selector-class">.showToast</span>({ message: 'ç»˜ç”»ä¸­' })
           }
           <span class="hljs-built_in">if</span>(event.type === TouchType.Up) {
             promptAction<span class="hljs-selector-class">.showToast</span>({ message: 'ç»“æŸç»˜ç”»' })
           }
         })
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<ul>
<li>å®ç°ç»˜ç”»</li>
</ul>

<pre><code class="hljs language-csharp" lang="csharp">      .onReady(() =&gt; {
            <span class="hljs-keyword">this</span>.myPen.lineWidth = <span class="hljs-number">2</span>
            <span class="hljs-keyword">this</span>.myPen.strokeStyle = <span class="hljs-string">'red'</span>
          })
      .onTouch((<span class="hljs-keyword">event</span>) =&gt; {
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">event</span>.type === TouchType.Down) {
              <span class="hljs-keyword">this</span>.myPen.beginPath()
              <span class="hljs-keyword">this</span>.myPen.moveTo(<span class="hljs-keyword">event</span>.touches[<span class="hljs-number">0</span>].x, <span class="hljs-keyword">event</span>.touches[<span class="hljs-number">0</span>].y)
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">event</span>.type === TouchType.Move) {
              <span class="hljs-keyword">this</span>.myPen.lineTo(<span class="hljs-keyword">event</span>.touches[<span class="hljs-number">0</span>].x, <span class="hljs-keyword">event</span>.touches[<span class="hljs-number">0</span>].y)
              <span class="hljs-keyword">this</span>.myPen.stroke()
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">event</span>.type === TouchType.Up) {
              <span class="hljs-keyword">this</span>.myPen.closePath()
            }
          })
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<p>å®ç°ä¿å­˜å›¾ç‰‡å’Œæ¸…ç©ºç”»å¸ƒæ–¹æ³•ï¼Œç”»å¸ƒçš„é«˜åº¦éœ€è¦ä½¿ç”¨onAreaChangeçš„æ–¹å¼æ¥è·å–</p>
<pre><code class="hljs language-typescript" lang="typescript"> .<span class="hljs-title function_">onAreaChange</span>(<span class="hljs-function">(<span class="hljs-params">oldArea, newArea</span>) =&gt;</span> {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasWidth</span> = newArea.<span class="hljs-property">width</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span>
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasHeight</span> = newArea.<span class="hljs-property">height</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span>
        })
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<ul>
<li>æŒ‰é’®è°ƒç”¨å¯¹åº”çš„æ–¹æ³•</li>
</ul>

<pre><code class="hljs language-scss" lang="scss"> Row () {
        <span class="hljs-selector-tag">Button</span>("æ¸…ç©ºç”»å¸ƒ")
          <span class="hljs-selector-class">.onClick</span>(() =&gt; {
            this<span class="hljs-selector-class">.clearCanvas</span>()
          })
        <span class="hljs-selector-tag">Button</span>("ä¿å­˜å›¾ç‰‡")
          <span class="hljs-selector-class">.onClick</span>(() =&gt; {
            this<span class="hljs-selector-class">.savePicture</span>()
          })
      }
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<ul>
<li>æ¸…å±æ–¹æ³•</li>
</ul>

<pre><code class="hljs language-less" lang="less">  <span class="hljs-variable">@State</span>
  <span class="hljs-attribute">canvasWidth</span>: number = <span class="hljs-number">0</span>
  <span class="hljs-variable">@State</span>
  <span class="hljs-attribute">canvasHeight</span>: number = <span class="hljs-number">0</span>
  <span class="hljs-comment">// æ¸…ç©ºç”»å¸ƒ</span>
  <span class="hljs-built_in">drawClear</span>() {
    <span class="hljs-selector-tag">this</span><span class="hljs-selector-class">.myPen</span><span class="hljs-selector-class">.clearRect</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, this.canvasWidth, this.canvasHeight)
  }
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<ul>
<li>å­˜å‚¨å›¾ç‰‡</li>
</ul>
<p>å­˜å‚¨å›¾ç‰‡æ˜¯å°†canvasè½¬æˆbase64ï¼Œå¯ä»¥ç›´æ¥ç”¨äºå±•ç¤º</p>
<pre><code class="hljs language-kotlin" lang="kotlin"> Button(<span class="hljs-string">"å­˜å‚¨å›¾ç‰‡"</span>)
          .onClick(() =&gt; {
              <span class="hljs-keyword">this</span>.imageUrl = <span class="hljs-keyword">this</span>.context.toDataURL(<span class="hljs-string">"image/jpg"</span>)
          })
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<p>ä¹Ÿå¯ä»¥å°†å›¾ç‰‡å†™å…¥æ²™ç®±åå±•ç¤ºï¼Œéœ€è¦å°†base64 -&gt; buffer</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ee328db115a40c08e601c8dcfc5f260~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5p6X55-l6K-G5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763385398&amp;x-signature=6i3eSHVY2gk6eOAUY4NotQwAfF4%3D" alt="" loading="lazy"/>â€‹</p>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>ç¼–è¾‘</p>
<pre><code class="hljs language-ini" lang="ini"> Button("å­˜å‚¨å›¾ç‰‡")
          .onClick(() =&gt; {
              // ä½¿ç”¨ä¸‹è½½åˆ°æ²™ç®±çš„å›¾ç‰‡
              let <span class="hljs-attr">img</span> = this.myPen.toDataURL(<span class="hljs-string">'image/jpg'</span>)
              const <span class="hljs-attr">filePath</span> = getContext().tempDir + <span class="hljs-string">"/"</span> + Date.now() + <span class="hljs-string">'.jpeg'</span>
              const <span class="hljs-attr">file</span> = fileIo.openSync(filePath, fileIo.OpenMode.CREATE | fileIo.OpenMode.READ_WRITE)
              const <span class="hljs-attr">base64Image</span> = img.split(<span class="hljs-string">';base64,'</span>).pop()<span class="hljs-comment">;</span>
              // å°†base64æ•°æ®è§£ç ä¸ºäºŒè¿›åˆ¶æ•°æ®
              const <span class="hljs-attr">imgBuffer</span> = buffer.from(base64Image, <span class="hljs-string">"base64"</span>)
              fileIo.writeSync(file.fd, imgBuffer.buffer)
              fileIo.closeSync(file)
              <span class="hljs-attr">this.imageUrl</span> = <span class="hljs-string">"file://"</span> + filePath
          })
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<p>å¦‚æœå¸Œæœ›æ‰‹åŠ¿ç§»åŠ¨æ¸²æŸ“çš„æ›´åŠ ä¸æ»‘ï¼Œå¯ä»¥ç»™ç”»ç¬”åŠ ä¸ŠæŠ—é”¯é½¿å¤„ç†</p>
<pre><code class="hljs language-arduino" lang="arduino">  context: CanvasRenderingContext2D = <span class="hljs-keyword">new</span> <span class="hljs-built_in">CanvasRenderingContext2D</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">RenderingContextSettings</span>(<span class="hljs-literal">true</span>))
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<ul>
<li>å®Œæ•´ä»£ç </li>
</ul>

<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> { fileIo } from <span class="hljs-string">'@kit.CoreFileKit'</span>
<span class="hljs-keyword">import</span> { buffer } from <span class="hljs-string">'@kit.ArkTS'</span>

<span class="hljs-meta">@Entry</span>
  <span class="hljs-meta">@Component</span>
  struct SignBoardCase {
    myPen: CanvasRenderingContext2D = new CanvasRenderingContext2D(new RenderingContextSettings(<span class="hljs-literal">true</span>))
    <span class="hljs-meta">@State</span>
    canvasWidth: number = <span class="hljs-number">0</span>
    <span class="hljs-meta">@State</span>
    canvasHeight: number = <span class="hljs-number">0</span>

    <span class="hljs-meta">@State</span>
    imageUrl:string = <span class="hljs-string">''</span>
    <span class="hljs-comment">// æ¸…ç©ºç”»å¸ƒ</span>
    drawClear() {
      <span class="hljs-keyword">this</span>.myPen.clearRect(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-keyword">this</span>.canvasWidth, <span class="hljs-keyword">this</span>.canvasHeight)
    }

    build() {
      Row() {
        Column({ space: <span class="hljs-number">20</span> }) {
          Text(<span class="hljs-string">'ç­¾å­—æ¿'</span>)
          Canvas(<span class="hljs-keyword">this</span>.myPen)
            .width(<span class="hljs-string">'100%'</span>)
            .height(<span class="hljs-number">300</span>)
            .backgroundColor(Color.Pink)
            .onReady(() =&gt; {
              <span class="hljs-keyword">this</span>.myPen.lineWidth = <span class="hljs-number">2</span>
              <span class="hljs-keyword">this</span>.myPen.strokeStyle = <span class="hljs-string">'red'</span>
            })
            .onAreaChange((_, _val) =&gt; {
              <span class="hljs-keyword">this</span>.canvasWidth = _val.width <span class="hljs-keyword">as</span> number
              <span class="hljs-keyword">this</span>.canvasHeight = _val.height <span class="hljs-keyword">as</span> number
            })
            .onTouch((event) =&gt; {
              <span class="hljs-keyword">if</span> (event.type === TouchType.Down) {
                <span class="hljs-keyword">this</span>.myPen.beginPath()
                <span class="hljs-keyword">this</span>.myPen.moveTo(event.touches[<span class="hljs-number">0</span>].x, event.touches[<span class="hljs-number">0</span>].y)
              } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (event.type === TouchType.Move) {
                <span class="hljs-keyword">this</span>.myPen.lineTo(event.touches[<span class="hljs-number">0</span>].x, event.touches[<span class="hljs-number">0</span>].y)
                <span class="hljs-keyword">this</span>.myPen.stroke()
              } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (event.type === TouchType.Up) {
                <span class="hljs-keyword">this</span>.myPen.closePath()
              }
            })
          <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.imageUrl){
            Image(<span class="hljs-keyword">this</span>.imageUrl)
              .width(<span class="hljs-string">'100%'</span>)
          }
          Row({ space: <span class="hljs-number">20</span> }) {
            Button(<span class="hljs-string">'ä¿å­˜'</span>)
              .onClick(() =&gt; {
                <span class="hljs-comment">// ä½¿ç”¨canvasè½¬åŒ–çš„å›¾ç‰‡</span>
                <span class="hljs-comment">// this.imageUrl = this.myPen.toDataURL('image/jpg')</span>
                <span class="hljs-comment">// ä½¿ç”¨ä¸‹è½½åˆ°æ²™ç®±çš„å›¾ç‰‡</span>
                let img = <span class="hljs-keyword">this</span>.myPen.toDataURL(<span class="hljs-string">'image/jpg'</span>)
                <span class="hljs-keyword">const</span> filePath = getContext().tempDir + <span class="hljs-string">"/"</span> + Date.now() + <span class="hljs-string">'.jpeg'</span>
                <span class="hljs-keyword">const</span> file = fileIo.openSync(filePath, fileIo.OpenMode.CREATE | fileIo.OpenMode.READ_WRITE)
                <span class="hljs-keyword">const</span> base64Image = img.split(<span class="hljs-string">';base64,'</span>).pop();
                <span class="hljs-comment">// å°†base64æ•°æ®è§£ç ä¸ºäºŒè¿›åˆ¶æ•°æ®</span>
                <span class="hljs-keyword">const</span> imgBuffer = buffer.from(base64Image, <span class="hljs-string">"base64"</span>)
                fileIo.writeSync(file.fd, imgBuffer.buffer)
                fileIo.closeSync(file)
                <span class="hljs-keyword">this</span>.imageUrl = <span class="hljs-string">"file://"</span> + filePath
              })
            Button(<span class="hljs-string">'é‡ç­¾'</span>)
              .onClick(() =&gt; {
                <span class="hljs-keyword">this</span>.drawClear()
                <span class="hljs-keyword">this</span>.imageUrl = <span class="hljs-string">''</span>
              })
          }
        }
        .width(<span class="hljs-string">'100%'</span>)
      }
      .height(<span class="hljs-string">'100%'</span>)
    }
  }
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<p>HarmonyOSèµ‹èƒ½èµ„æºä¸°å¯Œåº¦å»ºè®¾ï¼ˆç¬¬å››æœŸï¼‰-å´ä¸œæ—</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Ftraining%2FclassDetail%2F9fdeeb1a35d64d2fabad3948ae7aab72%3Ftype%3D1%3Fha_source%3Dhmosclass%26ha_sourceId%3D89000248" title="https://developer.huawei.com/consumer/cn/training/classDetail/9fdeeb1a35d64d2fabad3948ae7aab72?type=1?ha_source=hmosclass&amp;ha_sourceId=89000248" target="_blank" ref="nofollow noopener noreferrer">developer.huawei.com/consumer/cnâ€¦</a></p>
<p>â€‹</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Banner Carouseï¼šæ‰“é€ å·®å¼‚åŒ–è½®æ’­ä½“éªŒçš„å®è·µç¬”è®°]]></title>    <link>https://juejin.cn/post/7570978150009012262</link>    <guid>https://juejin.cn/post/7570978150009012262</guid>    <pubDate>2025-11-10T13:22:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570978150009012262" data-draft-id="7570902804451213322" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Banner Carouseï¼šæ‰“é€ å·®å¼‚åŒ–è½®æ’­ä½“éªŒçš„å®è·µç¬”è®°"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-11-10T13:22:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="appå‡ºæµ·åˆ›æ”¶è€æ"/> <meta itemprop="url" content="https://juejin.cn/user/2594503168892711"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Banner Carouseï¼šæ‰“é€ å·®å¼‚åŒ–è½®æ’­ä½“éªŒçš„å®è·µç¬”è®°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2594503168892711/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    appå‡ºæµ·åˆ›æ”¶è€æ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T13:22:06.000Z" title="Mon Nov 10 2025 13:22:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸ºä»€ä¹ˆè¦é€ è½®å­</h2>
<ul>
<li>é˜…è¯»ã€çŸ­å‰§ç±» App çš„å°é¢è½®æ’­æ˜¯ç”¨æˆ·ç¬¬ä¸€è§¦ç‚¹ï¼Œæ™®é€š <code>ViewPager</code> åªèƒ½å¹³é“ºï¼Œä¸»æ¨å†…å®¹éš¾ä»¥çªå‡ºã€‚</li>
<li>è§†è§‰è®¾è®¡æå‡ºâ€œä¸­é—´æ”¾å¤§ã€ä¸¤ä¾§éœ²å‡ºã€åº•æ é½å¹³â€çš„å¤æ‚éœ€æ±‚ï¼Œå¸‚é¢ä¸Šå¼€æºåº“è¦ä¹ˆä¸å¯å®šåˆ¶ï¼Œè¦ä¹ˆå®ç°è¿‡é‡ã€‚</li>
<li>å›¢é˜Ÿå¸Œæœ›æ²‰æ·€æˆç»„ä»¶ï¼Œæé«˜å¤ç”¨æ•ˆç‡ï¼Œäºæ˜¯è½åœ°äº† Banner Carousel SDKï¼Œå¹¶é€šè¿‡ JitPack åˆ†äº«ç»™å†…éƒ¨ä¸ç¤¾åŒºã€‚</li>
</ul>
<h2 data-id="heading-1">ç›®æ ‡æ•ˆæœ</h2>
<ul>
<li>ä¿æŒ 5 å¼ å¡ç‰‡å¯è§ï¼Œä¸­é—´ä¸»å¡æ”¾å¤§ 1.8 å€ï¼Œå…¶ä½™å¡ç‰‡ä»¥æ­£å¸¸æ¯”ä¾‹éœ²å‡ºã€‚</li>
<li>ç¼©æ”¾æ¢è½´å¯é€‰ï¼šé»˜è®¤ä¸­å¿ƒç¼©æ”¾ï¼Œä¹Ÿæ”¯æŒâ€œä»ä¸Šå‘ä¸‹å‹ç¼©â€è®©åº•éƒ¨ä¿¡æ¯æ å§‹ç»ˆè´´ç´§åº•è¾¹ã€‚</li>
<li>é¡¶éƒ¨å¯æ˜¾ç¤ºå®Œç»“ / è¿è½½å¾½æ ‡ï¼Œåº•æ å±•ç¤ºè¯„åˆ†ä¸é˜…è¯»æ•°ï¼Œæ»šåŠ¨æ—¶è‡ªåŠ¨è¡¥å¿ä½ç§»ã€‚</li>
<li>æ— é™å¾ªç¯æ»‘åŠ¨ä¸é¢„åŠ è½½ï¼Œé…åˆç‚¹å‡»ã€ç¿»é¡µå›è°ƒï¼Œæ–¹ä¾¿è”åŠ¨èƒŒæ™¯æˆ–è·³è½¬è¯¦æƒ…ã€‚</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a0e7e40f720f434ea6cdb5ab4ba3b0eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYXBw5Ye65rW35Yib5pS26ICB5p2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763385725&amp;x-signature=Bz1MToGLmukEtI0RmRUTdyMwggI%3D" alt="20251110-190112.gif" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d93453e0006d4a5880c92b846725da72~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYXBw5Ye65rW35Yib5pS26ICB5p2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763385725&amp;x-signature=wE9hMIUzF9VAIhAwfzXer4fnOEo%3D" alt="20251110-190915.gif" loading="lazy"/></p>
<h2 data-id="heading-2">æŠ€æœ¯å®ç°</h2>
<ul>
<li><strong>Kotlin + ViewPager2</strong>ï¼šåˆ©ç”¨ <code>CompositePageTransformer</code> ç»„åˆé—´è·ä¸ç¼©æ”¾åŠ¨ç”»ï¼Œå…¼é¡¾æ˜“ç”¨æ€§ä¸æ‰©å±•æ€§ã€‚</li>
<li><strong>è‡ªå®šä¹‰ <code>ScaleInTransformer</code></strong>ï¼šæ ¹æ® <code>ScalePivotType</code> è®¡ç®—ç¼©æ”¾æ¢è½´åŠä½ç§»ï¼Œå®ç°åº•éƒ¨é½å¹³çš„ç‰¹æ•ˆã€‚</li>
<li><strong>ConstraintLayout + ImageFilterView</strong>ï¼šå•å¡å¸ƒå±€é‡‡ç”¨åœ†è§’å¤§å›¾ + æ¸å˜åº•æ ï¼Œä¿æŒè§†è§‰é£æ ¼ç»Ÿä¸€ã€‚</li>
<li><strong>Builder æ¨¡å¼é…ç½®</strong>ï¼š<code>BannerCarouselView.setup { ... }</code> ä¸€ç«™å¼è®¾ç½®æ•°æ®ã€é—´è·ã€æ¯”ä¾‹ã€ç¼©æ”¾æ¢è½´ã€å›è°ƒç­‰å‚æ•°ã€‚</li>
<li><strong>JitPack åˆ†å‘</strong>ï¼šæ‰“ tag å³å‘å¸ƒï¼Œå…å» Sonatype å®¡æ ¸æµç¨‹ï¼Œæ»¡è¶³å›¢é˜Ÿå¿«é€Ÿé›†æˆéœ€æ±‚ã€‚</li>
</ul>
<h2 data-id="heading-3">å¿«é€Ÿä½¿ç”¨</h2>
<p>åœ¨åº”ç”¨ <code>settings.gradle.kts</code> ä¸­æ·»åŠ ä»“åº“ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin">dependencyResolutionManagement {
    repositories {
        google()
        mavenCentral()
        maven(<span class="hljs-string">"https://jitpack.io"</span>)
    }
}
</code></pre>
<p>æ¨¡å—ä¾èµ–ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin">dependencies {
    implementation(<span class="hljs-string">"com.github.liselfcreator:BannerCarousel:1.0.0"</span>)
}
</code></pre>
<p>é¡µé¢è°ƒç”¨ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin">bannerCarouselView.setup {
    setData(banners)
    showStatus(<span class="hljs-literal">true</span>)
    showBottom(<span class="hljs-literal">true</span>)
    setItemSpacingDp(<span class="hljs-number">17</span>)
    setEdgeVisibleFraction(<span class="hljs-number">0.2f</span>)
    setCenterScaleFactor(<span class="hljs-number">1.8f</span>)
    setScalePivot(ScalePivotType.TOP)
    setImageLoader { imageView, url, placeholder -&gt;
        Glide.with(imageView)
            .load(url)
            .placeholder(placeholder)
            .into(imageView)
    }
    setOnPageChangeListener { index, model -&gt;
        <span class="hljs-comment">// åŒæ­¥èƒŒæ™¯ã€æ ‡é¢˜ç­‰</span>
    }
    setOnItemClickListener { position, model -&gt;
        <span class="hljs-comment">// å¤„ç†ç‚¹å‡»</span>
    }
}
</code></pre>
<blockquote>
<p><code>ScalePivotType.TOP</code> ä¼šè®©ç¼©æ”¾ä»é¡¶éƒ¨å¼€å§‹ï¼Œåº•éƒ¨ä¿¡æ¯æ ä¿æŒé½å¹³ï¼›é»˜è®¤ä½¿ç”¨ <code>CENTER</code>ã€‚</p>
</blockquote>
<h2 data-id="heading-4">æˆæœä¸å±•æœ›</h2>
<p>è¯¦ç»†ä½¿ç”¨æ–¹å¼å¯ä»¥å‚è€ƒ github-&gt; <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fliselfcreator%2FBannerCarousel" target="_blank" title="https://github.com/liselfcreator/BannerCarousel" ref="nofollow noopener noreferrer">BannerCarousel</a></p>
<ul>
<li>Demo å·²å®ç°ä¸èƒŒæ™¯å›¾åŒæ­¥ï¼Œæ»‘åŠ¨ä½“éªŒç¬¦åˆè®¾è®¡é¢„æœŸã€‚</li>
<li>ä¸‹ä¸€æ­¥è®¡åˆ’è¡¥å……è‡ªåŠ¨ç¿»é¡µã€æŒ‡ç¤ºå™¨ã€æ›´å¤šå¾½æ ‡æ ·å¼ä¸ç¼“å­˜ä¼˜åŒ–ã€‚</li>
<li>æ¬¢è¿ä¸šåŠ¡åŒå­¦å’Œç¤¾åŒºè´¡çŒ® Issue / PRï¼Œè®© Banner Carousel SDK æ›´åŠ æ˜“ç”¨ã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é¸¿è’™å¼¹æ€§å¸ƒå±€Flexè¯¦è§£]]></title>    <link>https://juejin.cn/post/7570901172527530019</link>    <guid>https://juejin.cn/post/7570901172527530019</guid>    <pubDate>2025-11-10T14:02:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570901172527530019" data-draft-id="7570909641683042344" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é¸¿è’™å¼¹æ€§å¸ƒå±€Flexè¯¦è§£"/> <meta itemprop="keywords" content="HarmonyOS"/> <meta itemprop="datePublished" content="2025-11-10T14:02:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é‡‘é¸¿å®¢"/> <meta itemprop="url" content="https://juejin.cn/user/4072230193213886"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é¸¿è’™å¼¹æ€§å¸ƒå±€Flexè¯¦è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4072230193213886/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é‡‘é¸¿å®¢
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T14:02:07.000Z" title="Mon Nov 10 2025 14:02:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¼¹æ€§å¸ƒå±€ï¼ˆFlexï¼‰æä¾›æ›´åŠ æœ‰æ•ˆçš„æ–¹å¼å¯¹å®¹å™¨ä¸­çš„å­å…ƒç´ è¿›è¡Œæ’åˆ—ã€å¯¹é½å’Œåˆ†é…å‰©ä½™ç©ºé—´ã€‚å¸¸ç”¨äºé¡µé¢å¤´éƒ¨å¯¼èˆªæ çš„å‡åŒ€åˆ†å¸ƒã€é¡µé¢æ¡†æ¶çš„æ­å»ºã€å¤šè¡Œæ•°æ®çš„æ’åˆ—ç­‰ã€‚ å®¹å™¨é»˜è®¤å­˜åœ¨ä¸»è½´ä¸äº¤å‰è½´ï¼Œå­å…ƒç´ é»˜è®¤æ²¿ä¸»è½´æ’åˆ—ï¼Œå­å…ƒç´ åœ¨ä¸»è½´æ–¹å‘çš„å°ºå¯¸ç§°ä¸ºä¸»è½´å°ºå¯¸ï¼Œåœ¨äº¤å‰è½´æ–¹å‘çš„å°ºå¯¸ç§°ä¸ºäº¤å‰è½´å°ºå¯¸ã€‚<br/>
ä¸»è½´ä¸ºæ°´å¹³æ–¹å‘çš„Flexå®¹å™¨ç¤ºæ„å›¾<br/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f3b28b039b4d41ce970c79e26e1c6d6d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6bi_5a6i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763388127&amp;x-signature=fBDGxtEIBBJKYM0gFUeLoEQyBto%3D" alt="ä¸»è½´ä¸ºæ°´å¹³æ–¹å‘çš„Flexå®¹å™¨ç¤ºæ„å›¾" loading="lazy"/></p>
<ul>
<li>ä¸»è½´ï¼šFlexç»„ä»¶å¸ƒå±€æ–¹å‘çš„è½´çº¿ï¼Œå­å…ƒç´ é»˜è®¤æ²¿ç€ä¸»è½´æ’åˆ—ã€‚ä¸»è½´å¼€å§‹çš„ä½ç½®ç§°ä¸ºä¸»è½´èµ·å§‹ç‚¹ï¼Œç»“æŸä½ç½®ç§°ä¸ºä¸»è½´ç»“æŸç‚¹ã€‚</li>
<li>äº¤å‰è½´ï¼šå‚ç›´äºä¸»è½´æ–¹å‘çš„è½´çº¿ã€‚äº¤å‰è½´å¼€å§‹çš„ä½ç½®ç§°ä¸ºäº¤å‰è½´èµ·å§‹ç‚¹ï¼Œç»“æŸä½ç½®ç§°ä¸ºäº¤å‰è½´ç»“æŸç‚¹ã€‚</li>
</ul>
<h2 data-id="heading-0">å¸ƒå±€æ–¹å‘</h2>
<p>åœ¨å¼¹æ€§å¸ƒå±€ä¸­ï¼Œå®¹å™¨çš„å­å…ƒç´ å¯ä»¥æŒ‰ç…§ä»»æ„æ–¹å‘æ’åˆ—ã€‚é€šè¿‡è®¾ç½®å‚æ•°directionï¼Œå¯ä»¥å†³å®šä¸»è½´çš„æ–¹å‘ï¼Œä»è€Œæ§åˆ¶å­å…ƒç´ çš„æ’åˆ—æ–¹å‘ã€‚<br/>
å¼¹æ€§å¸ƒå±€æ–¹å‘å›¾<br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/40fc89794a234565b1ebce0957de1380~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6bi_5a6i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763388127&amp;x-signature=f1FZspTNFYHTw3R1fU5IN8tI2VQ%3D" alt="img003_2.png" loading="lazy"/></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">direction</span>: <span class="hljs-title class_">FlexDirection</span>.<span class="hljs-property">Row</span> }) {
  <span class="hljs-title class_">Text</span>(<span class="hljs-string">'1'</span>).<span class="hljs-title function_">width</span>(<span class="hljs-string">'33%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#F5DEB3'</span>)
  <span class="hljs-title class_">Text</span>(<span class="hljs-string">'2'</span>).<span class="hljs-title function_">width</span>(<span class="hljs-string">'33%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#D2B48C'</span>)
  <span class="hljs-title class_">Text</span>(<span class="hljs-string">'3'</span>).<span class="hljs-title function_">width</span>(<span class="hljs-string">'33%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#F5DEB3'</span>)
}
.<span class="hljs-title function_">height</span>(<span class="hljs-number">70</span>)
.<span class="hljs-title function_">width</span>(<span class="hljs-string">'90%'</span>)
.<span class="hljs-title function_">padding</span>(<span class="hljs-number">10</span>)
.<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#AFEEEE'</span>)
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/62079e72a6a04b5a9609c859f277cf7a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6bi_5a6i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763388127&amp;x-signature=%2FyBU93S%2FLOtrNegWwiWg2XUkSac%3D" alt="img003_3.png" loading="lazy"/></p>
<p>directionè®¾ç½®ä¸åŒå€¼çš„å«ä¹‰</p>
<ul>
<li>FlexDirection.Rowï¼šï¼ˆé»˜è®¤å€¼ï¼‰ï¼šä¸»è½´ä¸ºæ°´å¹³æ–¹å‘ï¼Œå­å…ƒç´ ä»èµ·å§‹ç«¯æ²¿ç€æ°´å¹³æ–¹å‘å¼€å§‹æ’å¸ƒã€‚</li>
<li>FlexDirection.RowReverseï¼šä¸»è½´ä¸ºæ°´å¹³æ–¹å‘ï¼Œå­å…ƒç´ ä»ç»ˆç‚¹ç«¯æ²¿ç€FlexDirection.Rowç›¸åçš„æ–¹å‘å¼€å§‹æ’å¸ƒã€‚</li>
<li>FlexDirection.Columnï¼šä¸»è½´ä¸ºå‚ç›´æ–¹å‘ï¼Œå­å…ƒç´ ä»èµ·å§‹ç«¯æ²¿ç€å‚ç›´æ–¹å‘å¼€å§‹æ’å¸ƒã€‚</li>
<li>FlexDirection.ColumnReverseï¼šä¸»è½´ä¸ºå‚ç›´æ–¹å‘ï¼Œå­å…ƒç´ ä»ç»ˆç‚¹ç«¯æ²¿ç€FlexDirection.Columnç›¸åçš„æ–¹å‘å¼€å§‹æ’å¸ƒã€‚</li>
</ul>
<h2 data-id="heading-1">å¸ƒå±€æ¢è¡Œ</h2>
<p>å¼¹æ€§å¸ƒå±€åˆ†ä¸ºå•è¡Œå¸ƒå±€å’Œå¤šè¡Œå¸ƒå±€ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒFlexå®¹å™¨ä¸­çš„å­å…ƒç´ éƒ½æ’åœ¨ä¸€æ¡çº¿ï¼ˆåˆç§°â€œè½´çº¿â€ï¼‰ä¸Šã€‚wrapå±æ€§æ§åˆ¶å½“å­å…ƒç´ ä¸»è½´å°ºå¯¸ä¹‹å’Œå¤§äºå®¹å™¨ä¸»è½´å°ºå¯¸æ—¶ï¼ŒFlexæ˜¯å•è¡Œå¸ƒå±€è¿˜æ˜¯å¤šè¡Œå¸ƒå±€ã€‚åœ¨å¤šè¡Œå¸ƒå±€æ—¶ï¼Œé€šè¿‡äº¤å‰è½´æ–¹å‘ï¼Œç¡®è®¤æ–°è¡Œæ’åˆ—æ–¹å‘ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">wrap</span>: <span class="hljs-title class_">FlexWrap</span>.<span class="hljs-property">NoWrap</span> }) {
  <span class="hljs-title class_">Text</span>(<span class="hljs-string">'1'</span>).<span class="hljs-title function_">width</span>(<span class="hljs-string">'50%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#F5DEB3'</span>)
  <span class="hljs-title class_">Text</span>(<span class="hljs-string">'2'</span>).<span class="hljs-title function_">width</span>(<span class="hljs-string">'50%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#D2B48C'</span>)
  <span class="hljs-title class_">Text</span>(<span class="hljs-string">'3'</span>).<span class="hljs-title function_">width</span>(<span class="hljs-string">'50%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#F5DEB3'</span>)
} 
.<span class="hljs-title function_">width</span>(<span class="hljs-string">'90%'</span>)
.<span class="hljs-title function_">padding</span>(<span class="hljs-number">10</span>)
.<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#AFEEEE'</span>)
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5912b8efcb00432dbbe23de8131138f6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6bi_5a6i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763388127&amp;x-signature=mAUudQoD7h6LD4sqxpHwgNKruFQ%3D" alt="img003_3.png" loading="lazy"/><br/>
wrapè®¾ç½®ä¸åŒå€¼çš„å«ä¹‰</p>
<ul>
<li>FlexWrap.NoWrapï¼ˆé»˜è®¤å€¼ï¼‰ï¼šä¸æ¢è¡Œã€‚å¦‚æœå­å…ƒç´ çš„å®½åº¦æ€»å’Œå¤§äºçˆ¶å…ƒç´ çš„å®½åº¦ï¼Œåˆ™å­å…ƒç´ ä¼šè¢«å‹ç¼©å®½åº¦ã€‚</li>
<li>FlexWrap. Wrapï¼šæ¢è¡Œï¼Œæ¯ä¸€è¡Œå­å…ƒç´ æŒ‰ç…§ä¸»è½´æ–¹å‘æ’åˆ—ã€‚</li>
<li>FlexWrap. WrapReverseï¼šæ¢è¡Œï¼Œæ¯ä¸€è¡Œå­å…ƒç´ æŒ‰ç…§ä¸»è½´åæ–¹å‘æ’åˆ—ã€‚</li>
</ul>
<h2 data-id="heading-2">ä¸»è½´å¯¹é½æ–¹å¼</h2>
<p>é€šè¿‡justifyContentå‚æ•°è®¾ç½®å­å…ƒç´ åœ¨ä¸»è½´æ–¹å‘çš„å¯¹é½æ–¹å¼ã€‚
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ee5056c9ad1940e7953a79b5a11eb594~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6bi_5a6i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763388127&amp;x-signature=SseiIWlDWZUHO14dy%2BpUuP88dQM%3D" alt="img003_4.png" loading="lazy"/></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Start</span> }) {  
  <span class="hljs-title class_">Text</span>(<span class="hljs-string">'1'</span>).<span class="hljs-title function_">width</span>(<span class="hljs-string">'20%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#F5DEB3'</span>)
  <span class="hljs-title class_">Text</span>(<span class="hljs-string">'2'</span>).<span class="hljs-title function_">width</span>(<span class="hljs-string">'20%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#D2B48C'</span>)    
  <span class="hljs-title class_">Text</span>(<span class="hljs-string">'3'</span>).<span class="hljs-title function_">width</span>(<span class="hljs-string">'20%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#F5DEB3'</span>)
}
.<span class="hljs-title function_">width</span>(<span class="hljs-string">'90%'</span>)
.<span class="hljs-title function_">padding</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">bottom</span>: <span class="hljs-number">10</span> })
.<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#AFEEEE'</span>)
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aacab3fdcb4141169fcb061ff1d0e450~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6bi_5a6i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763388127&amp;x-signature=ZNxQWgdDEc5KTzJF5%2BaPp0i24C4%3D" alt="img003_5.png" loading="lazy"/><br/>
justifyContentè®¾ç½®ä¸åŒå€¼çš„å«ä¹‰</p>
<ul>
<li>FlexAlign.Startï¼ˆé»˜è®¤å€¼ï¼‰ï¼šå­å…ƒç´ åœ¨ä¸»è½´æ–¹å‘èµ·å§‹ç«¯å¯¹é½ï¼Œ ç¬¬ä¸€ä¸ªå­å…ƒç´ ä¸çˆ¶å…ƒç´ è¾¹æ²¿å¯¹é½ï¼Œå…¶ä»–å…ƒç´ ä¸å‰ä¸€ä¸ªå…ƒç´ å¯¹é½ã€‚</li>
<li>FlexAlign.Centerï¼šå­å…ƒç´ åœ¨ä¸»è½´æ–¹å‘å±…ä¸­å¯¹é½ã€‚</li>
<li>FlexAlign.Endï¼šå­å…ƒç´ åœ¨ä¸»è½´æ–¹å‘ç»ˆç‚¹ç«¯å¯¹é½ï¼Œæœ€åä¸€ä¸ªå­å…ƒç´ ä¸çˆ¶å…ƒç´ è¾¹æ²¿å¯¹é½ï¼Œå…¶ä»–å…ƒç´ ä¸åä¸€ä¸ªå…ƒç´ å¯¹é½ã€‚</li>
<li>FlexAlign.SpaceBetweenï¼šFlexä¸»è½´æ–¹å‘å‡åŒ€åˆ†é…å¼¹æ€§å…ƒç´ ï¼Œç›¸é‚»å­å…ƒç´ ä¹‹é—´è·ç¦»ç›¸åŒã€‚ç¬¬ä¸€ä¸ªå­å…ƒç´ å’Œæœ€åä¸€ä¸ªå­å…ƒç´ ä¸çˆ¶å…ƒç´ è¾¹æ²¿å¯¹é½ã€‚</li>
<li>FlexAlign.SpaceAroundï¼šFlexä¸»è½´æ–¹å‘å‡åŒ€åˆ†é…å¼¹æ€§å…ƒç´ ï¼Œç›¸é‚»å­å…ƒç´ ä¹‹é—´è·ç¦»ç›¸åŒã€‚ç¬¬ä¸€ä¸ªå­å…ƒç´ åˆ°ä¸»è½´èµ·å§‹ç«¯çš„è·ç¦»å’Œæœ€åä¸€ä¸ªå­å…ƒç´ åˆ°ä¸»è½´ç»ˆç‚¹ç«¯çš„è·ç¦»æ˜¯ç›¸é‚»å…ƒç´ ä¹‹é—´è·ç¦»çš„ä¸€åŠã€‚</li>
<li>FlexAlign.SpaceEvenlyï¼šFlexä¸»è½´æ–¹å‘å…ƒç´ ç­‰é—´è·å¸ƒå±€ï¼Œç›¸é‚»å­å…ƒç´ ä¹‹é—´çš„é—´è·ã€ç¬¬ä¸€ä¸ªå­å…ƒç´ ä¸ä¸»è½´èµ·å§‹ç«¯çš„é—´è·ã€æœ€åä¸€ä¸ªå­å…ƒç´ åˆ°ä¸»è½´ç»ˆç‚¹ç«¯çš„é—´è·å‡ç›¸ç­‰ã€‚</li>
</ul>
<h2 data-id="heading-3">äº¤å‰è½´å¯¹é½æ–¹å¼</h2>
<p>å®¹å™¨å’Œå­å…ƒç´ éƒ½å¯ä»¥è®¾ç½®äº¤å‰è½´å¯¹é½æ–¹å¼ï¼Œä¸”å­å…ƒç´ è®¾ç½®çš„å¯¹é½æ–¹å¼ä¼˜å…ˆçº§è¾ƒé«˜ã€‚</p>
<h3 data-id="heading-4">å®¹å™¨ç»„ä»¶è®¾ç½®äº¤å‰è½´å¯¹é½</h3>
<p>å¯ä»¥é€šè¿‡Flexç»„ä»¶çš„alignItemså‚æ•°è®¾ç½®å­å…ƒç´ åœ¨äº¤å‰è½´çš„å¯¹é½æ–¹å¼ã€‚</p>
<ul>
<li>ItemAlign.Autoï¼šä½¿ç”¨Flexå®¹å™¨ä¸­é»˜è®¤é…ç½®ã€‚</li>
<li>ItemAlign.Startï¼šäº¤å‰è½´æ–¹å‘é¦–éƒ¨å¯¹é½ã€‚</li>
<li>ItemAlign.Centerï¼šäº¤å‰è½´æ–¹å‘å±…ä¸­å¯¹é½ã€‚</li>
<li>ItemAlign.Endï¼šäº¤å‰è½´æ–¹å‘åº•éƒ¨å¯¹é½ã€‚</li>
<li>ItemAlign.Stretchï¼šäº¤å‰è½´æ–¹å‘æ‹‰ä¼¸å¡«å……ï¼Œåœ¨æœªè®¾ç½®å°ºå¯¸æ—¶ï¼Œæ‹‰ä¼¸åˆ°å®¹å™¨å°ºå¯¸ã€‚</li>
<li>ItemAlign.Baselineï¼šäº¤å‰è½´æ–¹å‘æ–‡æœ¬åŸºçº¿å¯¹é½ã€‚</li>
</ul>
<h3 data-id="heading-5">å­å…ƒç´ è®¾ç½®äº¤å‰è½´å¯¹é½</h3>
<p>å­å…ƒç´ çš„alignSelfå±æ€§ä¹Ÿå¯ä»¥è®¾ç½®å­å…ƒç´ åœ¨çˆ¶å®¹å™¨äº¤å‰è½´çš„å¯¹é½æ–¹å¼ï¼Œä¸”ä¼šè¦†ç›–Flexå¸ƒå±€å®¹å™¨ä¸­alignItemsé…ç½®ã€‚</p>
<h3 data-id="heading-6">å†…å®¹å¯¹é½</h3>
<p>å¯ä»¥é€šè¿‡alignContentå‚æ•°è®¾ç½®å­å…ƒç´ å„è¡Œåœ¨äº¤å‰è½´å‰©ä½™ç©ºé—´å†…çš„å¯¹é½æ–¹å¼ï¼Œåªåœ¨å¤šè¡Œçš„Flexå¸ƒå±€ä¸­ç”Ÿæ•ˆï¼Œå¯é€‰å€¼æœ‰ï¼š</p>
<ul>
<li>FlexAlign.Startï¼šå­å…ƒç´ å„è¡Œä¸äº¤å‰è½´èµ·ç‚¹å¯¹é½ã€‚</li>
<li>FlexAlign.Centerï¼šå­å…ƒç´ å„è¡Œåœ¨äº¤å‰è½´æ–¹å‘å±…ä¸­å¯¹é½ã€‚</li>
<li>FlexAlign.Endï¼šå­å…ƒç´ å„è¡Œä¸äº¤å‰è½´ç»ˆç‚¹å¯¹é½ã€‚</li>
<li>FlexAlign.SpaceBetweenï¼šå­å…ƒç´ å„è¡Œä¸äº¤å‰è½´ä¸¤ç«¯å¯¹é½ï¼Œå„è¡Œé—´å‚ç›´é—´è·å¹³å‡åˆ†å¸ƒã€‚</li>
<li>FlexAlign.SpaceAroundï¼šå­å…ƒç´ å„è¡Œé—´è·ç›¸ç­‰ï¼Œæ˜¯å…ƒç´ é¦–å°¾è¡Œä¸äº¤å‰è½´ä¸¤ç«¯è·ç¦»çš„ä¸¤å€ã€‚</li>
<li>FlexAlign.SpaceEvenly: å­å…ƒç´ å„è¡Œé—´è·ï¼Œå­å…ƒç´ é¦–å°¾è¡Œä¸äº¤å‰è½´ä¸¤ç«¯è·ç¦»éƒ½ç›¸ç­‰ã€‚</li>
</ul>
<h2 data-id="heading-7">ä½¿ç”¨Flexå®ç°æœç´¢è®°å½•è‡ªåŠ¨æ¢è¡Œ</h2>
<p>æˆ‘ä»¬å¯ä»¥æ ¹æ®Flexè‡ªåŠ¨æ¢è¡Œç‰¹æ€§å®ç°ä¸€ä¸ªæœç´¢è®°å½•é¡µé¢ï¼Œå› ä¸ºæœç´¢å†…å®¹æ˜¯ç”±ç”¨æˆ·è¾“å…¥ï¼Œå…·ä½“å¤šé•¿æ— æ³•ç¡®å®šï¼Œä¸€è¡Œæ˜¾ç¤ºå¤šå°‘æ¡è®°å½•æ˜¯ç”±æœç´¢å†…å®¹æ’åˆ—æ˜¾ç¤ºã€‚è‹¥ç”±æˆ‘ä»¬è‡ªå·±æ¥æµ‹é‡è®¡ç®—ï¼Œä¼šéå¸¸éº»çƒ¦ï¼Œè€Œä½¿ç”¨Flexçš„è‡ªåŠ¨æ¢è¡Œç‰¹æ€§ï¼Œå°±éå¸¸ç®€å•äº†ï¼Œç¤ºä¾‹å¦‚ä¸‹</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Index</span> {
  <span class="hljs-attr">items</span>: <span class="hljs-built_in">string</span>[] = [<span class="hljs-string">"æœç´¢1"</span>, <span class="hljs-string">"æœç´¢222"</span>, <span class="hljs-string">"æœç´¢33333333"</span>, <span class="hljs-string">"æœç´¢a"</span>, <span class="hljs-string">"æœç´¢b"</span>, <span class="hljs-string">"æœç´¢c"</span>, <span class="hljs-string">"æœç´¢d"</span>, <span class="hljs-string">"æœç´¢44444"</span>, <span class="hljs-string">"æœç´¢55555"</span>, <span class="hljs-string">"æœç´¢666666"</span>]

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">direction</span>: <span class="hljs-title class_">FlexDirection</span>.<span class="hljs-property">Row</span>, <span class="hljs-attr">wrap</span>: <span class="hljs-title class_">FlexWrap</span>.<span class="hljs-property">Wrap</span> }) {
      <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> {
        <span class="hljs-title class_">Text</span>(item)
          .<span class="hljs-title function_">height</span>(<span class="hljs-number">32</span>)
          .<span class="hljs-title function_">padding</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">16</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">16</span> })
          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">8</span>)
          .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">24</span>)
          .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#DDDDDD'</span>)
      })
    }
    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
  }
}
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b10c9cf4d3834125bfcf749dc15826fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6bi_5a6i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763388127&amp;x-signature=u2f5AuMdZs1aWWwbVv%2FXVfhbmWc%3D" alt="img003_6.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸ºä»€ä¹ˆåº”è¯¥æµ‹è¯•æ— JavaScriptçš„é¡µé¢ä½“éªŒ]]></title>    <link>https://juejin.cn/post/7570902804451360778</link>    <guid>https://juejin.cn/post/7570902804451360778</guid>    <pubDate>2025-11-10T11:37:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570902804451360778" data-draft-id="7570932873130754075" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸ºä»€ä¹ˆåº”è¯¥æµ‹è¯•æ— JavaScriptçš„é¡µé¢ä½“éªŒ"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½,AIGC"/> <meta itemprop="datePublished" content="2025-11-10T11:37:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="qife122"/> <meta itemprop="url" content="https://juejin.cn/user/1743174852185579"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸ºä»€ä¹ˆåº”è¯¥æµ‹è¯•æ— JavaScriptçš„é¡µé¢ä½“éªŒ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1743174852185579/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    qife122
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T11:37:51.000Z" title="Mon Nov 10 2025 11:37:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸ºä»€ä¹ˆåº”è¯¥æµ‹è¯•æ— JavaScriptçš„é¡µé¢</h2>
<p>å½“å¼€å‘è€…è€ƒè™‘æ— éšœç¢è®¿é—®æ—¶ï¼Œè®¨è®ºé€šå¸¸å›´ç»•å±å¹•é˜…è¯»å™¨ã€è¯­ä¹‰åŒ–HTMLã€é¢œè‰²å¯¹æ¯”åº¦æˆ–é”®ç›˜å¯¼èˆªå±•å¼€ã€‚è¿™äº›ç¡®å®éƒ½éå¸¸é‡è¦ã€‚</p>
<p>ä½†è¿˜æœ‰ä¸€ä¸ªè¾ƒå°‘è¢«è®¨è®ºçš„é¢†åŸŸéœ€è¦è€ƒè™‘ï¼šç½‘ç«™åœ¨æ²¡æœ‰JavaScriptæ—¶çš„è¡¨ç°ã€‚</p>
<p>ä»¥ä¸‹æ˜¯æœ¬æ–‡å°†è¦æ¶µç›–çš„å†…å®¹ï¼š</p>
<ul>
<li>JavaScriptå¯èƒ½å¤±æ•ˆçš„åŸå› </li>
<li>æ¸è¿›å¢å¼ºçš„å®è·µåº”ç”¨</li>
<li>å½“é¡µé¢ç»å¯¹éœ€è¦JavaScriptæ—¶</li>
<li>ç»“è®º</li>
</ul>
<h3 data-id="heading-1">JavaScriptå¯èƒ½å¤±æ•ˆçš„åŸå› </h3>
<p>åœ¨å‡ ä¹æ‰€æœ‰ç½‘ç«™éƒ½ä¾èµ–JavaScriptæ¡†æ¶è¿›è¡Œæ¸²æŸ“å’Œäº¤äº’çš„ä¸–ç•Œé‡Œï¼Œè€ƒè™‘"æ— JS"ä½“éªŒå¯èƒ½å¬èµ·æ¥"æ— å…³ç´§è¦"ã€‚ä½†JavaScriptå¯èƒ½å› å¤šç§åŸå› å¤±æ•ˆï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li><strong>ç¼“æ…¢æˆ–ä¸ç¨³å®šçš„ç½‘ç»œ</strong>ï¼šä½å¸¦å®½åœ°åŒºçš„ç§»åŠ¨ç”¨æˆ·å¯èƒ½ä¼šé‡åˆ°è¶…æ—¶æˆ–è„šæœ¬åŠ è½½ä¸å®Œæ•´çš„æƒ…å†µ</li>
<li><strong>æµè§ˆå™¨æ‰©å±•å’Œæ‹¦æˆªå™¨</strong>ï¼šå®‰å…¨æˆ–éšç§å·¥å…·å¯èƒ½é˜»æ­¢æˆ–å‰¥ç¦»è„šæœ¬</li>
<li><strong>è¾…åŠ©æŠ€æœ¯é™åˆ¶</strong>ï¼šä¸€äº›ç”¨æˆ·ç¦ç”¨JavaScriptæµè§ˆï¼Œæˆ–ä½¿ç”¨é˜»æ­¢è„šæœ¬çš„æ—§ç‰ˆ/ä¸“ç”¨æµè§ˆå™¨ï¼ˆæˆ–ä¸¥æ ¼çš„ä¼ä¸š/æ ¡å›­ç­–ç•¥ï¼‰</li>
</ul>
<p>å¾ˆå®¹æ˜“å‡è®¾JavaScriptå§‹ç»ˆå¯ç”¨ï¼Œä½†è¿™ç»å¯¹ä¸æ˜¯ä¿è¯çš„ã€‚å¦‚æœJavaScriptå¤±æ•ˆï¼Œç”¨æˆ·å°†é¢ä¸´ä¸å¿…è¦çš„éšœç¢ã€‚æˆ‘ä»¬æ— æ³•æ€»æ˜¯é¢„æµ‹å®ƒå¯èƒ½å¤±æ•ˆçš„åŸå› ï¼Œä½†æˆ‘ä»¬å¯ä»¥è®©ç½‘ç«™æ›´ä¼˜é›…åœ°é™çº§ã€‚</p>
<p>æµ‹è¯•æ— JavaScriptçš„ç½‘ç«™æ˜¯ä¸ºäº†æé«˜éŸ§æ€§å’Œå¯è®¿é—®æ€§ã€‚</p>
<h3 data-id="heading-2">æ¸è¿›å¢å¼ºçš„å®è·µ</h3>
<p>ä½¿ç”¨JavaScriptæ—¶ï¼Œä½ å¯èƒ½ä¼šæƒ³å†™è¿™æ ·çš„ä»£ç ï¼š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"goToPage('/homepage')"</span>&gt;</span>Home page<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
</code></pre>
<p>ä½†<code>&lt;span&gt;</code>ä¸æ˜¯é“¾æ¥ï¼Œé»˜è®¤ä¸å¯é”®ç›˜èšç„¦ï¼Œå¦‚æœJavaScriptè¢«ç¦ç”¨ï¼Œå®ƒå°†æ— æ³•å·¥ä½œã€‚ç›¸åï¼Œä½ åº”è¯¥ä½¿ç”¨é»˜è®¤å·¥ä½œçš„è¯­ä¹‰åŒ–HTMLï¼Œä»…åœ¨JSå¯ç”¨æ—¶è¿›è¡Œå¢å¼ºï¼š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- æ— è®ºæ˜¯å¦æœ‰JSéƒ½èƒ½å·¥ä½œï¼Œå¹¶è¢«è¾…åŠ©æŠ€æœ¯è¯†åˆ«ä¸ºé“¾æ¥ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/homepage"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"home-link"</span>&gt;</span>Home page<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-comment">// æ¸è¿›å¢å¼ºï¼šä»…åœ¨JSåŠ è½½æ—¶æ‹¦æˆª</span>
  <span class="hljs-keyword">const</span> link = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'home-link'</span>);
  link?.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
    <span class="hljs-comment">// å¦‚æœä½ æœ‰å®¢æˆ·ç«¯è·¯ç”±ï¼Œå–æ¶ˆæ³¨é‡Šä»¥é˜²æ­¢æ•´é¡µé‡æ–°åŠ è½½ï¼š</span>
    <span class="hljs-comment">// e.preventDefault();</span>
    <span class="hljs-comment">// router.push('/homepage'); // æˆ– history.pushState(...) ç­‰</span>
  });
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>è¿™æ ·ï¼Œç”¨æˆ·é»˜è®¤è·å¾—çœŸæ­£çš„é“¾æ¥å’Œé”®ç›˜å¯è®¿é—®æ€§ï¼Œè€Œä½ çš„SPAè·¯ç”±ï¼ˆæˆ–å…¶ä»–å¢å¼ºåŠŸèƒ½ï¼‰ä»…åœ¨è„šæœ¬è¿è¡Œæ—¶ç”Ÿæ•ˆã€‚</p>
<p>æäº¤æŒ‰é’®åªæœ‰åœ¨ä½äºå…·æœ‰çœŸå®actionï¼ˆå’ŒæœåŠ¡å™¨ç«¯å¤„ç†/éªŒè¯ï¼‰çš„<code>&lt;form&gt;</code>å†…æ—¶æ‰èƒ½åœ¨æ— JSæƒ…å†µä¸‹å·¥ä½œã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">"/contact"</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"post"</span> <span class="hljs-attr">novalidate</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>Message <span class="hljs-tag">&lt;<span class="hljs-name">textarea</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"message"</span> <span class="hljs-attr">required</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">textarea</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span>&gt;</span>Send<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
</code></pre>
<p>è¯·æ³¨æ„ï¼Œæ²¡æœ‰JSæ—¶ï¼Œå†…ç½®çš„æµè§ˆå™¨éªŒè¯å¯èƒ½æœ‰é™ - å› æ­¤è¯·ç¡®ä¿åœ¨è¿™ç§æƒ…å†µä¸‹å§‹ç»ˆè¿›è¡ŒæœåŠ¡å™¨ç«¯éªŒè¯ã€‚</p>
<h3 data-id="heading-3">å½“é¡µé¢ç»å¯¹éœ€è¦JavaScriptæ—¶</h3>
<p>å¹¶éæ¯ä¸ªåŠŸèƒ½éƒ½å¯ä»¥åœ¨æ²¡æœ‰JavaScriptçš„æƒ…å†µä¸‹äº¤ä»˜ã€‚å¤æ‚çš„Webåº”ç”¨ç¨‹åºå¯èƒ½ä¾èµ–è„šæœ¬æ¥è¿è¡Œã€‚</p>
<p>åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªç®€å•çš„é¡µé¢ï¼Œå‘ŠçŸ¥ç”¨æˆ·é¡µé¢æ— æ³•æ­£å¸¸å·¥ä½œçš„åŸå› ã€‚</p>
<p>Googleçš„æ— JavaScripté¡µé¢å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç°å®ä¸–ç•Œä¾‹å­ã€‚å¦‚æœä½ åœ¨Chromeä¸­ç¦ç”¨JavaScriptå¹¶å¯¼èˆªåˆ°Googleï¼Œä½ ä¼šçœ‹åˆ°ä¸€ä¸ªé¡µé¢ï¼Œå‘ŠçŸ¥ç”¨æˆ·éœ€è¦å¼€å¯JavaScriptæ‰èƒ½è®¿é—®è¯¥é¡µé¢ã€‚</p>
<p>å½“è„šæœ¬å¤±æ•ˆæ—¶ï¼ŒGoogleä¸æ˜¯è®©ç”¨æˆ·ç›¯ç€ç©ºç™½é¡µé¢ï¼Œè€Œæ˜¯å‘ŠçŸ¥ç”¨æˆ·ä¸ºä»€ä¹ˆæ— æ³•è®¿é—®é¡µé¢ã€‚ä½†è¯·æ³¨æ„ï¼ŒGoogleçš„æ¶ˆæ¯ä»…åœ¨æµè§ˆå™¨ä¸­ç¦ç”¨JavaScriptæ—¶å‡ºç°ã€‚å¦‚æœJSåªæ˜¯åŠ è½½å¤±è´¥ï¼Œ<code>&lt;noscript&gt;</code>æ¶ˆæ¯ä¸ä¼šå‡ºç°ï¼ˆç¨åä¼šè¯¦ç»†è¯´æ˜ï¼‰ã€‚</p>
<p>åƒGoogleè¿™æ ·çš„"æ— JavaScript"é¡µé¢æˆ–ç®€å•çš„æ¶ˆæ¯ï¼ˆå¦‚"åŠ è½½äº¤äº’å¼ä»ªè¡¨æ¿ï¼ˆéœ€è¦JavaScriptï¼‰"ï¼‰æ¯”æ²‰é»˜æ›´å…·å¯è®¿é—®æ€§ã€‚ä½ å¯ä»¥åœ¨<code>&lt;noscript&gt;</code>æ ‡ç­¾ä¸­åŒ…å«ä¸€ä¸ªå›é€€æ¶ˆæ¯ï¼Œè§£é‡Šé¡µé¢ä¸ºä»€ä¹ˆéœ€è¦JavaScriptä»¥åŠç”¨æˆ·å¯ä»¥åšä»€ä¹ˆã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªä¾‹å­ï¼š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">noscript</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>æ­¤é¡µé¢éœ€è¦JavaScriptæ‰èƒ½æ­£å¸¸è¿è¡Œã€‚è¯·åœ¨æµè§ˆå™¨è®¾ç½®ä¸­å¯ç”¨JavaScriptã€‚<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">noscript</span>&gt;</span>
</code></pre>
<p>ä½†<code>&lt;noscript&gt;</code>æœ‰ä¸€ä¸ªå…³é”®é™åˆ¶ï¼šå®ƒä»…åœ¨æµè§ˆå™¨ä¸­ç¦ç”¨è„šæœ¬æ—¶æ¸²æŸ“ã€‚å½“è„šæœ¬å·²å¯ç”¨ä½†åŠ è½½å¤±è´¥æˆ–åœ¨è¿è¡Œæ—¶å´©æºƒæ—¶ï¼ˆå¦‚CDNä¸­æ–­ã€CSPé˜»æ­¢ã€MIME/type=moduleä¸åŒ¹é…æˆ–è¯­æ³•é”™è¯¯ï¼‰ï¼Œå®ƒæ²¡æœ‰å¸®åŠ©ã€‚</p>
<p>ä¸ºäº†å¤„ç†è¿™ç§æƒ…å†µï¼Œä½ å¯ä»¥ä½¿ç”¨æœåŠ¡å™¨æ¸²æŸ“çš„HTMLæˆ–å†…å®¹ä¼˜å…ˆæ¨¡æ¿ï¼Œè¿™æ ·å³ä½¿æ°´åˆ/JSå¤±è´¥ï¼Œé¡µé¢ä»ç„¶æ˜¾ç¤ºæœ‰æ„ä¹‰çš„å†…å®¹ã€‚</p>
<p>é€šè¿‡æ·»åŠ å›é€€æ–¹æ¡ˆï¼Œä½ å¯ä»¥ç¡®ä¿ç”¨æˆ·ä¸ä¼šç–‘æƒ‘ç½‘ç«™æ˜¯å¦å·²æŸåã€‚å³ä½¿JavaScriptæ˜¯å¿…éœ€çš„ï¼Œä½ ä»ç„¶å¯ä»¥é€šè¿‡æ‰¿è®¤ä¾èµ–å…³ç³»å¹¶æä¾›æ›¿ä»£æ–¹æ¡ˆæ¥ä½¿ä½“éªŒå¯è®¿é—®ã€‚</p>
<h3 data-id="heading-4">ç»“è®º</h3>
<p>æ— JavaScriptæµ‹è¯•ä¸æ˜¯ä¸ºäº†æ”¯æŒæ¯ä¸€ä¸ªå¯èƒ½çš„è¾¹ç¼˜æƒ…å†µã€‚å®ƒæ˜¯ä¸ºäº†æ„å»ºæœ‰éŸ§æ€§ã€å¯è®¿é—®å’ŒåŒ…å®¹çš„ç½‘ç«™ã€‚</p>
<ul>
<li>è¿æ¥ä¸å¯é çš„ç”¨æˆ·ä»å›é€€å†…å®¹ä¸­å—ç›Š</li>
<li>å½“è„šæœ¬å¤±æ•ˆæ—¶ï¼Œæ¯ä¸ªäººéƒ½èƒ½ä»å¯é¢„æµ‹ã€å¯é çš„ä½“éªŒä¸­å—ç›Š</li>
</ul>
<p>æ— éšœç¢è®¿é—®æ˜¯å…³äºåœ¨ä»»ä½•å‡ºç°éšœç¢çš„åœ°æ–¹å‡å°‘éšœç¢ã€‚æœ‰æ—¶å€™ï¼Œæœ€å¤§çš„éšœç¢æ˜¯å‡è®¾JavaScriptå°†å§‹ç»ˆå·¥ä½œã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åŸºäº LangGraph + MCPçš„æ™ºèƒ½éŸ³ä¹æ¨è Agentï¼šä»æ„å›¾åˆ°å¯è§£é‡Šæ¨èçš„å…¨é“¾è·¯å®è·µ]]></title>    <link>https://juejin.cn/post/7570902473433153536</link>    <guid>https://juejin.cn/post/7570902473433153536</guid>    <pubDate>2025-11-10T12:00:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570902473433153536" data-draft-id="7570902473433137152" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åŸºäº LangGraph + MCPçš„æ™ºèƒ½éŸ³ä¹æ¨è Agentï¼šä»æ„å›¾åˆ°å¯è§£é‡Šæ¨èçš„å…¨é“¾è·¯å®è·µ"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2025-11-10T12:00:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æƒ³è¦æœ‰å®åŠ›"/> <meta itemprop="url" content="https://juejin.cn/user/68589789656281"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åŸºäº LangGraph + MCPçš„æ™ºèƒ½éŸ³ä¹æ¨è Agentï¼šä»æ„å›¾åˆ°å¯è§£é‡Šæ¨èçš„å…¨é“¾è·¯å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/68589789656281/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æƒ³è¦æœ‰å®åŠ›
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T12:00:07.000Z" title="Mon Nov 10 2025 12:00:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">æ‘˜è¦ï¼ˆå¯¼è¯­ï¼‰</h3>
<p>æˆ‘è‡ªå·±åšäº†ä¸€ä¸ªå¼€æºçš„æ™ºèƒ½éŸ³ä¹æ¨è Agentï¼ŒåŸºäº LangGraph å·¥ä½œæµä¸ç¡…åŸºæµåŠ¨ LLMï¼Œæä¾›è‡ªç„¶è¯­è¨€å¤šç»´åº¦éŸ³ä¹æ¨èï¼ˆå¿ƒæƒ…/åœºæ™¯/æµæ´¾/ç›¸ä¼¼æ­Œæ›²ç­‰ï¼‰ï¼Œå‰ç«¯é‡‡ç”¨ Streamlitï¼Œå¼€ç®±å³ç”¨ã€‚æ–‡ç« å°†ä»æ¶æ„ã€æ ¸å¿ƒæµç¨‹ã€å…³é”®æ¨¡å—åˆ°éƒ¨ç½²ä¸æ‰©å±•ï¼ˆå« MCP/Spotify é›†æˆï¼‰è¿›è¡Œç³»ç»Ÿè®²è§£ï¼Œå¹¶ç»™å‡ºå¯ç›´æ¥è¿è¡Œçš„ç¤ºä¾‹ä»£ç ä¸é…ç½®æ¨¡æ¿ã€‚</p>
<ul>
<li>å…³é”®è¯ï¼šéŸ³ä¹æ¨èã€LangGraphã€å¤§æ¨¡å‹åº”ç”¨ã€ç¡…åŸºæµåŠ¨ã€Streamlitã€MCP</li>
<li>é€‚è¯»äººç¾¤ï¼šAI åº”ç”¨å¼€å‘è€…ã€æ¨èç³»ç»Ÿä»ä¸šè€…ã€åŸå‹/è¯¾é¢˜ç ”ç©¶äººå‘˜</li>
<li>é¡¹ç›®åœ°å€<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fimagist13%2FMuisc-Research" target="_blank" title="https://github.com/imagist13/Muisc-Research" ref="nofollow noopener noreferrer">ï¼šhttps://github.com/imagist13/Muisc-Research</a></li>
</ul>
<p>æ±‚æ±‚å¤§å®¶ä¸ºæˆ‘çš„ä»“åº“ç‚¹ä¸ªstarï¼Œæˆ‘ä¹‹åä¼šä¸æ–­æ›´æ–°è¯¥é¡¹ç›®ï¼ŒåŒæ—¶ä¹ŸæœŸå¾…å¤§å®¶æäº¤PRã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/709f5608d02946dfae5b75bf68176af4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oOz6KaB5pyJ5a6e5Yqb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763380807&amp;x-signature=G3fxEdvrv%2Beyyh%2BUMpgO8dAaV4c%3D" alt="å±å¹•æˆªå›¾ 2025-11-10 164711.png" loading="lazy"/></p>
<pre><code class="hljs">ä¸€ä¸ªåŸºäºAIçš„æ™ºèƒ½éŸ³ä¹æ¨èç³»ç»Ÿï¼Œä½¿ç”¨LangGraphæ„å»ºï¼Œæ”¯æŒè‡ªç„¶è¯­è¨€äº¤äº’å’Œä¸ªæ€§åŒ–æ¨èã€‚
ğŸ¯ æ™ºèƒ½ç†è§£å¿ƒæƒ…ã€åœºæ™¯ã€æµæ´¾ç­‰éœ€æ±‚ï¼Œä¸€é”®ç”Ÿæˆæ¨èæ­Œå•
ğŸ” é›†æˆæœç´¢ã€æ¨èä¸è§£é‡Šï¼Œè®©ä½ çŸ¥é“æ¯é¦–æ­Œçš„æ¨èç†ç”±
âš™ï¸ åŸºäº LangGraph + Streamlitï¼Œè½»é‡éƒ¨ç½²å³å¯è¿è¡Œ
ğŸ” æ”¯æŒè‡ªå®šä¹‰ LLMï¼ˆDeepSeekã€Qwen ç­‰ï¼‰ä¸æœ¬åœ°éŸ³ä¹æ•°æ®
</code></pre>
<hr/>
<h3 data-id="heading-1">ç›®å½•</h3>
<ul>
<li>ä¸€ã€é¡¹ç›®ç®€ä»‹</li>
<li>äºŒã€å¿«é€Ÿä¸Šæ‰‹ï¼ˆ5 åˆ†é’Ÿè·‘é€šï¼‰</li>
<li>ä¸‰ã€ç³»ç»Ÿæ¶æ„</li>
<li>å››ã€æ ¸å¿ƒæµç¨‹ï¼ˆä»æ„å›¾åˆ°ç»“æœï¼‰</li>
<li>äº”ã€å…³é”®æ¨¡å—è¯¦è§£</li>
<li>å…­ã€ç¤ºä¾‹ä»£ç ï¼ˆå¯åŠ¨ä¸ API è°ƒç”¨ï¼‰</li>
<li>ä¸ƒã€è¿›é˜¶èƒ½åŠ›ï¼šMCP/Spotify é›†æˆ</li>
<li>å…«ã€æµ‹è¯•ä¸æ•…éšœæ’æŸ¥</li>
<li>ä¹ã€æ€§èƒ½ä¸æ¼”è¿›æ–¹å‘</li>
<li>åã€å¼€æºä¿¡æ¯ä¸å‚è€ƒèµ„æ–™</li>
<li>é™„å½•ï¼šsetting.json æœ€å°é…ç½®æ¨¡æ¿</li>
</ul>
<hr/>
<h3 data-id="heading-2">ä¸€ã€é¡¹ç›®ç®€ä»‹</h3>
<ul>
<li>é¡¹ç›®å®šä½ï¼šä¸€ä¸ªèƒ½â€œå¬æ‡‚ä½ â€çš„éŸ³ä¹æ¨è Agentã€‚æ”¯æŒå¿ƒæƒ…ã€åœºæ™¯ã€æµæ´¾ã€è‰ºæœ¯å®¶ã€ç›¸ä¼¼æ­Œæ›²ç­‰å¤šç»´åº¦æ¨èï¼Œå¹¶è¾“å‡ºå¯è§£é‡Šç†ç”±ã€‚</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c2ed42c7f7c346d4b63cdf365b79deb6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oOz6KaB5pyJ5a6e5Yqb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763380807&amp;x-signature=l0bXnZHd6cHm00m1DU4W82DELo0%3D" alt="å±å¹•æˆªå›¾ 2025-11-10 160341.png" loading="lazy"/></p>
<ul>
<li>
<p>æŠ€æœ¯é€‰å‹ï¼š</p>
<ul>
<li>LangGraph + LangChainï¼šå·¥ä½œæµç¼–æ’ä¸ LLM åº”ç”¨æ¡†æ¶</li>
<li>ç¡…åŸºæµåŠ¨ï¼ˆSiliconFlowï¼‰ï¼šDeepSeek/Qwen ç­‰æ¨¡å‹æœåŠ¡</li>
<li>Streamlitï¼šè½»é‡ Web UI</li>
<li>Python + asyncio + Pydanticï¼šåç«¯ä¸æ•°æ®æ ¡éªŒ</li>
</ul>
</li>
<li>
<p>ä½¿ç”¨åœºæ™¯ï¼šåŸå‹å¼€å‘ã€A/B æµ‹è¯•ã€è¯¾ç¨‹/åˆ†äº« Demoã€è¯¾é¢˜ç ”ç©¶ã€‚</p>
</li>
</ul>
<h3 data-id="heading-3">äºŒã€å¿«é€Ÿä¸Šæ‰‹ï¼ˆ5 åˆ†é’Ÿè·‘é€šï¼‰</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. å…‹éš†å¹¶è¿›å…¥ç›®å½•</span>
git <span class="hljs-built_in">clone</span> &lt;your-repo-url&gt;
<span class="hljs-built_in">cd</span> deep-search

<span class="hljs-comment"># 2. å®‰è£…ä¾èµ–</span>
pip install -r requirements.txt

<span class="hljs-comment"># 3. æ·»åŠ é…ç½®ï¼ˆè§æ–‡æœ« setting.json æ¨¡æ¿ï¼‰</span>
<span class="hljs-comment"># 4. å¯åŠ¨ Web åº”ç”¨</span>
python run_music_app.py
</code></pre>
<p>å¯åŠ¨åè®¿é—®ï¼š<code>http://localhost:8501</code></p>
<p>å¸¸è§äº¤äº’ç¤ºä¾‹ï¼š</p>
<ul>
<li>â€œæˆ‘ç°åœ¨å¿ƒæƒ…å¾ˆå¥½ï¼Œæ¨èä¸€äº›å¼€å¿ƒçš„éŸ³ä¹â€</li>
<li>â€œé€‚åˆè¿åŠ¨æ—¶å¬çš„éŸ³ä¹â€</li>
<li>â€œæœç´¢å‘¨æ°ä¼¦çš„æ­Œæ›²â€</li>
<li>â€œæœ‰æ²¡æœ‰ç±»ä¼¼ã€Šæ™´å¤©ã€‹çš„æ­Œæ›²â€</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1544849cd4cd4516b5a4812d76af9003~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oOz6KaB5pyJ5a6e5Yqb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763380807&amp;x-signature=g88bslUYSqF%2FS3UVDAJourb5hrw%3D" alt="å±å¹•æˆªå›¾ 2025-11-10 160610.png" loading="lazy"/></p>
<h3 data-id="heading-4">ä¸‰ã€ç³»ç»Ÿæ¶æ„</h3>
<ul>
<li>æ’å›¾ä½ï¼ˆå»ºè®®ï¼šç³»ç»Ÿç»„ä»¶æ¶æ„å›¾ï¼‰
<ul>
<li>å»ºè®®åŒ…å«ï¼šUserã€Streamlit UIã€Agentï¼ˆLangGraphï¼‰ã€LLMï¼ˆSiliconFlowï¼‰ã€Toolsã€æœ¬åœ°æ•°æ®æºæˆ–å¤–éƒ¨éŸ³ä¹ API</li>
</ul>
</li>
</ul>
<p>æ¨¡å—åˆ’åˆ†ï¼š</p>
<ul>
<li><code>config/</code>ï¼šé…ç½®åŠ è½½ï¼ˆæ”¯æŒ <code>setting.json</code> ä¸ç¯å¢ƒå˜é‡ï¼‰</li>
<li><code>llms/</code>ï¼šLLM æŠ½è±¡ä¸ç¡…åŸºæµåŠ¨å®ç°ï¼ˆOpenAI å…¼å®¹ï¼‰</li>
<li><code>graphs/</code>ï¼šéŸ³ä¹æ¨èå·¥ä½œæµå›¾ä¸çŠ¶æ€ç®¡ç†</li>
<li><code>prompts/</code>ï¼šæç¤ºè¯</li>
<li><code>tools/</code>ï¼šéŸ³ä¹å·¥å…·ä¸ MCP é€‚é…</li>
<li><code>music_agent.py</code>ï¼šAgent ä¸»å…¥å£</li>
<li><code>music_app.py</code>ï¼šStreamlit å‰ç«¯</li>
<li><code>data/music_database.json</code>ï¼šæœ¬åœ°æ•°æ®ï¼ˆå¯æ›¿æ¢å®é™… APIï¼‰</li>
</ul>
<h3 data-id="heading-5">å››ã€æ ¸å¿ƒæµç¨‹ï¼ˆä»æ„å›¾åˆ°ç»“æœï¼‰</h3>
<ul>
<li>æ’å›¾ä½ï¼ˆå»ºè®®ï¼šæµç¨‹å›¾/æ—¶åºå›¾ï¼‰
<ol>
<li>ç”¨æˆ·è¾“å…¥è‡ªç„¶è¯­è¨€</li>
<li>æ„å›¾è¯†åˆ« <code>analyze_intent</code></li>
<li>æ„å›¾è·¯ç”± <code>route_by_intent</code>
<ul>
<li>search / recommend_by_mood / recommend_by_activity / recommend_by_genre / recommend_by_artist / general_chat</li>
</ul>
</li>
<li>åˆ†æ”¯èŠ‚ç‚¹å¤„ç†ï¼šæœç´¢/æ¨è/èŠå¤©</li>
<li>ç”Ÿæˆå¯è§£é‡Šç»“æœï¼ˆæ¨èç†ç”±/ç»“æ„åŒ– JSONï¼‰</li>
<li>Web å±•ç¤ºä¸äº¤äº’</li>
</ol>
</li>
</ul>
<h3 data-id="heading-6">äº”ã€å…³é”®æ¨¡å—è¯¦è§£</h3>
<ul>
<li>é…ç½®ç®¡ç† <code>config/settings_loader.py</code>
<ul>
<li>ä¼˜å…ˆä» <code>setting.json</code> è¯»å–ï¼Œå›é€€åˆ°ç¯å¢ƒå˜é‡</li>
<li>ç»Ÿä¸€æ³¨å…¥ API Keyã€Base URLã€é»˜è®¤æ¨¡å‹ç­‰</li>
</ul>
</li>
<li>LLM å°è£… <code>llms/siliconflow_llm.py</code>
<ul>
<li>ä½¿ç”¨ OpenAI å…¼å®¹å®¢æˆ·ç«¯ + ç¡…åŸºæµåŠ¨ Base URL</li>
<li>ä¾¿äºæ›´æ¢æ¨¡å‹æˆ–ä¾›åº”å•†ï¼Œä¸šåŠ¡ä¾§é›¶ä¾µå…¥</li>
</ul>
</li>
<li>å·¥ä½œæµ <code>graphs/music_graph.py</code>
<ul>
<li>å®šä¹‰çŠ¶æ€ã€èŠ‚ç‚¹ä¸è·¯ç”±ï¼›å°†â€œæ„å›¾ç†è§£ â†’ ä»»åŠ¡æ‰§è¡Œ â†’ ç»“æœç”Ÿæˆâ€æ¨¡å—åŒ–</li>
</ul>
</li>
<li>å·¥å…·å±‚ <code>tools/</code>
<ul>
<li>æœç´¢ã€ç›¸ä¼¼åº¦ã€æ¨èå¼•æ“èƒ½åŠ›</li>
<li>MCP é€‚é…ï¼ˆåç»­å¯¹æ¥å¤–éƒ¨ API/å·¥å…·ï¼‰</li>
</ul>
</li>
<li>å‰ç«¯ <code>music_app.py</code>
<ul>
<li>è¾“å…¥ + ç»“æœå¡ç‰‡/åˆ—è¡¨ + ç†ç”±</li>
<li>ä¾§è¾¹æ å¿«æ·æŒ‰é’®ï¼ˆå¿ƒæƒ…/åœºæ™¯/æµæ´¾ï¼‰</li>
</ul>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8909d8a9f6804a5797d8a4a8ed0bd08e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oOz6KaB5pyJ5a6e5Yqb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763380807&amp;x-signature=%2Fu5cT8MlXJpF2vqEyAgMI5C1gZM%3D" alt="å±å¹•æˆªå›¾ 2025-11-10 173942.png" loading="lazy"/></p>
<h3 data-id="heading-7">å…­ã€ç¤ºä¾‹ä»£ç ï¼ˆå¯åŠ¨ä¸ API è°ƒç”¨ï¼‰</h3>
<ul>
<li>å¯åŠ¨è„šæœ¬ç‰‡æ®µï¼ˆè‡ªåŠ¨æ£€æŸ¥ç¯å¢ƒå˜é‡å¹¶å¯åŠ¨ Streamlitï¼‰ï¼š</li>
</ul>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># run_music_app.pyï¼ˆèŠ‚é€‰ï¼‰</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸµ éŸ³ä¹æ¨èAgent - å¯åŠ¨ä¸­..."</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> check_env():
        sys.exit(<span class="hljs-number">1</span>)

    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\næ­£åœ¨å¯åŠ¨Streamlitåº”ç”¨..."</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"è®¿é—®åœ°å€: http://localhost:8501"</span>)
    subprocess.run([
        sys.executable, <span class="hljs-string">"-m"</span>, <span class="hljs-string">"streamlit"</span>, <span class="hljs-string">"run"</span>, <span class="hljs-string">"music_app.py"</span>,
        <span class="hljs-string">"--server.headless=true"</span>
    ])
</code></pre>
<ul>
<li>Python API ä½¿ç”¨ï¼š</li>
</ul>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> asyncio
<span class="hljs-keyword">from</span> music_agent <span class="hljs-keyword">import</span> MusicRecommendationAgent

<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    agent = MusicRecommendationAgent()
    result = <span class="hljs-keyword">await</span> agent.get_recommendations(<span class="hljs-string">"æˆ‘ç°åœ¨å¿ƒæƒ…å¾ˆå¥½ï¼Œæ¨èä¸€äº›å¼€å¿ƒçš„éŸ³ä¹"</span>)
    <span class="hljs-built_in">print</span>(result[<span class="hljs-string">"response"</span>])

    search_result = <span class="hljs-keyword">await</span> agent.search_music(<span class="hljs-string">"å‘¨æ°ä¼¦"</span>, genre=<span class="hljs-string">"æµè¡Œ"</span>)
    <span class="hljs-keyword">for</span> song <span class="hljs-keyword">in</span> search_result[<span class="hljs-string">"results"</span>]:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{song[<span class="hljs-string">'title'</span>]}</span> - <span class="hljs-subst">{song[<span class="hljs-string">'artist'</span>]}</span>"</span>)

asyncio.run(main())
</code></pre>
<h3 data-id="heading-8">ä¸ƒã€è¿›é˜¶èƒ½åŠ›ï¼šMCP/Spotify é›†æˆ</h3>
<ul>
<li>MCP Serverï¼ˆç¤ºä¾‹ä½äº <code>mcp/</code>ï¼‰
<ul>
<li><code>siliconflow_server.py</code>ï¼šå°†ç¡…åŸºæµåŠ¨èƒ½åŠ›ä»¥ MCP å·¥å…·æš´éœ²</li>
<li><code>music_server_updated_2025.py</code>ï¼šæ›´å®Œæ•´çš„éŸ³ä¹å·¥å…·é›†åˆ</li>
</ul>
</li>
<li>å¯¹æ¥ Spotify/ç½‘æ˜“äº‘ï¼ˆè§„åˆ’/å¯è¡Œæ€§ï¼‰
<ul>
<li>ä½¿ç”¨å®˜æ–¹ API è·å–æ£€ç´¢/éŸ³é¢‘ç‰¹å¾/è‰ºäººç”»åƒ</li>
<li>å°†æ£€ç´¢ä¸ç›¸ä¼¼åº¦è®¡ç®—å¤–åŒ…ç»™å¤–éƒ¨æœåŠ¡ï¼Œæå‡è¦†ç›–ä¸å‡†ç¡®ç‡</li>
</ul>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b4302c79748140a2a9521c6d9f3a3f8a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oOz6KaB5pyJ5a6e5Yqb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763380807&amp;x-signature=eh399ni2hHSW1rpdCaUYamOp8og%3D" alt="å±å¹•æˆªå›¾ 2025-11-10 160502.png" loading="lazy"/></p>
<h3 data-id="heading-9">å…«ã€æµ‹è¯•ä¸æ•…éšœæ’æŸ¥</h3>
<ul>
<li>å»ºè®®æµ‹è¯•é¡¹ï¼š
<ul>
<li>æ„å›¾è¯†åˆ«æ­£ç¡®ç‡ï¼ˆå¤šæ ·åŒ–è¾“å…¥ï¼‰</li>
<li>JSON è¾“å‡ºæ ¡éªŒï¼ˆå­—æ®µ/ç±»å‹/é•¿åº¦ï¼‰</li>
<li>è¶…æ—¶ä¸é‡è¯•ç­–ç•¥ã€ç½‘ç»œå¼‚å¸¸å¤„ç†</li>
</ul>
</li>
<li>å¸¸è§é—®é¢˜ï¼š
<ul>
<li>æœªè®¾ç½® <code>SILICONFLOW_API_KEY</code>ï¼šè¯·åœ¨ <code>setting.json</code> æˆ–ç¯å¢ƒå˜é‡ä¸­é…ç½®</li>
<li>Streamlit å¯åŠ¨å¤±è´¥ï¼šå°è¯• <code>streamlit run music_app.py</code></li>
<li>è¿”å›æ ¼å¼ä¸è§„èŒƒï¼šæ£€æŸ¥æç¤ºè¯æˆ–åœ¨å·¥ä½œæµå¢åŠ  JSON æ¸…æ´—æ­¥éª¤</li>
</ul>
</li>
</ul>
<h3 data-id="heading-10">ä¹ã€æ€§èƒ½ä¸æ¼”è¿›æ–¹å‘</h3>
<ul>
<li>æ€§èƒ½ä¼˜åŒ–ï¼š
<ul>
<li>æ¨¡å‹/æ¸©åº¦/ä¸Šä¸‹æ–‡è£å‰ª</li>
<li>ç¼“å­˜ä¸å»é‡ï¼ˆç›¸åŒæ„å›¾/ç›¸ä¼¼è¯·æ±‚ï¼‰</li>
<li>å‰ç«¯åˆ†é¡µä¸æ‡’åŠ è½½</li>
</ul>
</li>
<li>å¯æ¼”è¿›æ–¹å‘ï¼š
<ul>
<li>å®æ—¶å¯¹æ¥éŸ³ä¹ APIï¼ˆæ£€ç´¢/éŸ³é¢‘ç‰¹å¾ï¼‰</li>
<li>æ’­æ”¾ä¸æ­Œå•ç®¡ç†</li>
<li>é•¿æœŸåå¥½å­¦ä¹ ï¼ˆå‘é‡æ£€ç´¢ + åé¦ˆé—­ç¯ï¼‰</li>
<li>å¤šæ¨¡æ€ä¿¡å·ï¼ˆå°é¢å›¾ã€æ­Œè¯æƒ…æ„Ÿåˆ†æï¼‰</li>
<li>å­å›¾/ç­–ç•¥æ‹†åˆ†ä¸å¤šæ¨¡å‹ååŒ</li>
</ul>
</li>
</ul>
<h3 data-id="heading-11">åã€å¼€æºä¿¡æ¯ä¸å‚è€ƒèµ„æ–™</h3>
<ul>
<li>è®¸å¯è¯ï¼šMIT</li>
<li>ä¸»è¦ä¾èµ–ï¼šLangGraphã€LangChainã€openai/å…¼å®¹å®¢æˆ·ç«¯ã€Streamlitã€Pydanticã€asyncio</li>
<li>å‚è€ƒï¼š
<ul>
<li>LangGraph å®˜æ–¹æ–‡æ¡£</li>
<li>ç¡…åŸºæµåŠ¨ API æ–‡æ¡£</li>
<li>Streamlit æ–‡æ¡£</li>
<li>Spotify/ç½‘æ˜“äº‘å¼€æ”¾å¹³å°æ–‡æ¡£ï¼ˆå¦‚éœ€ï¼‰</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-12">é™„å½•ï¼šsetting.json æœ€å°é…ç½®æ¨¡æ¿</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"SILICONFLOW_API_KEY"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"SILICONFLOW_BASE_URL"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://api.siliconflow.cn/v1"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"SILICONFLOW_CHAT_MODEL"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Qwen/Qwen2.5-72B-Instruct"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"TAILYAPI_API_KEY"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"TAILYAPI_BASE_URL"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://api.tavily.com"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"APP_NAME"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"DeepSearch Quickstart"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"SPOTIFY_CLIENT_ID"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"SPOTIFY_CLIENT_SECRET"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<hr/>
<h3 data-id="heading-13">æ–‡æœ« CTA</h3>
<p>å¦‚æœä½ å¯¹â€œèƒ½å¬æ‡‚ä½ â€çš„éŸ³ä¹æ¨èç³»ç»Ÿæ„Ÿå…´è¶£ï¼Œæ¬¢è¿ Starã€Fork ä¸äº¤æµã€‚ä¹Ÿæ¬¢è¿åœ¨è¯„è®ºåŒºåˆ†äº«ä½ çš„ä½¿ç”¨ä½“éªŒæˆ–æ”¹è¿›å»ºè®®ï¼Œä¸€èµ·æŠŠè¿™ä¸ª Agent æ‰“ç£¨æˆå¯è½åœ°ã€å¯æ‰©å±•çš„é«˜è´¨é‡ AI åº”ç”¨ã€‚
Githupä»“åº“åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fimagist13%2FMuisc-Research" target="_blank" title="https://github.com/imagist13/Muisc-Research" ref="nofollow noopener noreferrer">github.com/imagist13/Mâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å›¾è§£æºç ï¼šä¸‡å­—è§£æ Spring AI åˆ°åº•æ˜¯æ€ä¹ˆå®ç° MCP çš„]]></title>    <link>https://juejin.cn/post/7570935965435641871</link>    <guid>https://juejin.cn/post/7570935965435641871</guid>    <pubDate>2025-11-10T15:05:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570935965435641871" data-draft-id="7570902473433628672" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å›¾è§£æºç ï¼šä¸‡å­—è§£æ Spring AI åˆ°åº•æ˜¯æ€ä¹ˆå®ç° MCP çš„"/> <meta itemprop="keywords" content="åç«¯,Java,æ¶æ„"/> <meta itemprop="datePublished" content="2025-11-10T15:05:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°ç’ä¹±æ’"/> <meta itemprop="url" content="https://juejin.cn/user/3653045848387931"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å›¾è§£æºç ï¼šä¸‡å­—è§£æ Spring AI åˆ°åº•æ˜¯æ€ä¹ˆå®ç° MCP çš„
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3653045848387931/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°ç’ä¹±æ’
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T15:05:15.000Z" title="Mon Nov 10 2025 15:05:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»18åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€å‰è¨€ï¼šSpring AI ä¸ MCP</h2>
<p>Â Â Â åœ¨è¿‡å»çš„ä¸€å¹´é‡Œï¼Œå¤§æ¨¡å‹ç”Ÿæ€çš„ä¸€ä¸ªæ˜æ˜¾è¶‹åŠ¿æ˜¯<strong>ä»æ¨¡å‹è°ƒç”¨èµ°å‘æ¨¡å‹åä½œ</strong>ã€‚ä¸ä»…ä»…æ˜¯æ€ä¹ˆè®©å¤§æ¨¡å‹å›ç­”é—®é¢˜ï¼Œæ›´æ˜¯æ€ä¹ˆè®©æ¨¡å‹å…·å¤‡æ‰§è¡Œã€ååŒä¸æ’ä»¶åŒ–èƒ½åŠ›ã€‚Spring AI æ­£æ˜¯åœ¨è¿™ä¸€èƒŒæ™¯ä¸‹è¯ç”Ÿçš„ï¼Œå®ƒè¯•å›¾ä»¥ Spring çš„æ–¹å¼ï¼Œå°† AI èƒ½åŠ›èå…¥ç°æœ‰çš„ä¼ä¸šçº§åº”ç”¨ä½“ç³»ä¸­ã€‚</p>
<p>Â Â Â Spring AI æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªä¸º Java ç”Ÿæ€è®¾è®¡çš„ AI é›†æˆæ¡†æ¶ã€‚å®ƒç»Ÿä¸€äº†ä¸åŒæ¨¡å‹ï¼ˆå¦‚ OpenAIã€Anthropicã€Ollama ç­‰ï¼‰çš„è°ƒç”¨æ–¹å¼ï¼Œå¹¶æä¾›äº† Prompt æ¨¡æ¿ã€è¾“å‡ºè§£æã€å·¥å…·è°ƒç”¨ï¼ˆTool Invocationï¼‰ç­‰ä¸Šå±‚æŠ½è±¡ï¼Œè®©å¼€å‘è€…å¯ä»¥åƒä½¿ç”¨ RestTemplate ä¸€æ ·ä¼˜é›…åœ°è°ƒç”¨å¤§æ¨¡å‹ã€‚</p>
<p>Â Â Â Spring AI åœ¨ 2024 å¹´å¼•å…¥äº†å¯¹ <strong>MCP</strong>ï¼ˆ<strong>Model Context Protocol</strong>ï¼‰çš„æ”¯æŒï¼Œè¿™ä¸€æœºåˆ¶æ—¨åœ¨æ ‡å‡†åŒ–æ¨¡å‹ä¸å¤–éƒ¨ç³»ç»Ÿï¼ˆæ’ä»¶ã€æ•°æ®åº“ã€APIã€æ–‡ä»¶ç³»ç»Ÿç­‰ï¼‰ä¹‹é—´çš„ä¸Šä¸‹æ–‡é€šä¿¡åè®®ï¼Œä½¿æ¨¡å‹å…·å¤‡ç†è§£å’Œè°ƒç”¨å¤–éƒ¨èµ„æºçš„èƒ½åŠ›ã€‚æ¢å¥è¯è¯´ï¼ŒMCP è§„èŒƒäº†æ¨¡å‹ä¸å¤–éƒ¨ä¸–ç•Œä¹‹é—´çš„é€šä¿¡ï¼Œä½¿æ¨¡å‹èƒ½å¤Ÿåœ¨å—æ§ã€å®‰å…¨ã€å¯æ‰©å±•çš„ç¯å¢ƒä¸‹è®¿é—®å¤–éƒ¨èµ„æºå¹¶æ‰§è¡Œä»»åŠ¡ã€‚</p>
<p>Â Â Â åœ¨ç†è§£äº† Spring AI ä¸ MCP çš„èƒŒæ™¯ä¹‹åï¼Œæœ¬æ–‡å°†ä»æºç è§’åº¦å‡ºå‘ï¼Œç³»ç»Ÿè§£æ Spring AI æ˜¯å¦‚ä½•å®ç° MCP åè®®çš„ã€‚æˆ‘ä»¬å°†ä¾æ¬¡æ¢³ç†å…¶æ•´ä½“æ¶æ„è®¾è®¡ã€æ ¸å¿ƒäº¤äº’è¿‡ç¨‹ã€å…³é”®ç»„ä»¶æºç ä»¥åŠè¿è¡Œæ—¶çš„æ‰§è¡Œæœºåˆ¶ï¼Œå¹¶é€šè¿‡æ–­ç‚¹æ¼”ç¤ºè¿˜åŸå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„å®é™…åä½œè·¯å¾„ã€‚</p>
<h2 data-id="heading-1">äºŒã€æ¶æ„è§£æ</h2>
<p>Â Â Â åœ¨ Spring AI MCP ä¸­ï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„è®¾è®¡å‘ˆç°å‡ºé«˜åº¦çš„å¯¹ç§°æ€§ä¸åˆ†å±‚åŒ–ç‰¹å¾ï¼Œå…¶æ¶æ„çš„æ ¸å¿ƒæ€æƒ³æ˜¯åˆ†å±‚è§£è€¦ã€èŒè´£æ¸…æ™°ã€å¯¹ç§°å¯æ‰©å±•ã€‚æ— è®ºæ˜¯å®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡ç«¯ï¼Œæ¯ä¸€å±‚éƒ½åªè´Ÿè´£å•ä¸€ç»´åº¦çš„åŠŸèƒ½ã€‚ä¸‹å›¾ä¸º MCP å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„åˆ†å±‚æ¶æ„å›¾ï¼š</p>













<table><thead><tr><th>MCP å®¢æˆ·ç«¯</th><th>MCP æœåŠ¡ç«¯</th></tr></thead><tbody><tr><td><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d565ab1898d34bb38d0e04d5d38f6af9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP55KQ5Lmx5pKe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763392738&amp;x-signature=bGL34eFN4UtlKiY9rRMqZXciAW8%3D" alt="" loading="lazy"/></td><td><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/112a3eaad5514d4f8a5b98107085e13e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP55KQ5Lmx5pKe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763392738&amp;x-signature=jdZkWpNyjjXTX3T8aHuV5TxPn8I%3D" alt="" loading="lazy"/></td></tr></tbody></table>
<p>Â Â Â åœ¨ Spring AI MCP ä¸­ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„æ¶æ„æ˜¯ååˆ†æ¥è¿‘çš„ï¼Œè‡ªä¸Šè€Œä¸‹åŒ…å«<strong>å…¥å£å±‚ã€è¿è¡Œå±‚ã€ä¼šè¯å±‚ã€ä¼ è¾“å±‚</strong>ï¼Œä¸åŒä¹‹å¤„åœ¨äºæœåŠ¡ç«¯æ¶æ„ä¼šå¤šå‡ºä¸€å±‚ï¼Œå³<strong>ä¼šè¯ç®¡ç†å±‚</strong>ï¼Œä¸‹é¢æ˜¯å„å±‚çš„ä½œç”¨ï¼š</p>
<ul>
<li><strong>å…¥å£å±‚</strong>ï¼šè¿™ä¸€å±‚æ˜¯ MCP å®¢æˆ·ç«¯/æœåŠ¡ç«¯å¯¹å¤–çš„ç»Ÿä¸€å…¥å£ï¼Œå¯¹åº”çš„æ¥å£ä¸º <strong>McpClient/McpServer</strong>ã€‚åªéœ€é€šè¿‡å…¶å·¥å‚æ–¹æ³•ï¼Œå¹¶æä¾›é…ç½®ä¿¡æ¯ï¼ˆå¦‚è¶…æ—¶æ—¶é—´ã€èƒ½åŠ›é…ç½®ç­‰ï¼‰ï¼Œå°±èƒ½ä»¥åŒæ­¥æˆ–å¼‚æ­¥æ¨¡å¼åˆ›å»ºè¿è¡Œå±‚çš„å®¢æˆ·ç«¯/æœåŠ¡ç«¯å®ä¾‹ã€‚å…¥å£å±‚å¯¹ä¸‹å±‚çš„å¤æ‚å®ç°è¿›è¡Œäº†å°è£…ï¼Œå¯¹ä¸Šå±‚æä¾›ç»Ÿä¸€ã€ç®€æ´çš„æ„å»ºå…¥å£ï¼Œä½¿å¾—è°ƒç”¨è€…æ— éœ€å…³å¿ƒä¼ è¾“æ–¹å¼ä¸æ¶ˆæ¯æœºåˆ¶çš„å·®å¼‚ã€‚</li>
<li><strong>è¿è¡Œå±‚</strong>ï¼šè¿™ä¸€å±‚æ˜¯ MCP å®¢æˆ·ç«¯/æœåŠ¡ç«¯çš„æ ¸å¿ƒæ§åˆ¶ä¸­å¿ƒï¼Œå¯¹åº”çš„ç±»ä¸º <strong>McpAsyncClient/McpSyncClientã€McpAsyncServer/McpSyncServer</strong>ã€‚å…¶å®ç°äº†å…·ä½“çš„ä¸šåŠ¡è¡Œä¸ºï¼ŒåŒ…æ‹¬åˆå§‹åŒ–ã€å·¥å…·æ³¨å†Œã€å·¥å…·è°ƒç”¨ç­‰æ“ä½œï¼Œå¹¶ä½¿ç”¨å“åº”å¼ç¼–ç¨‹æ¨¡å‹æ¥å¤„ç†å¼‚æ­¥æµç¨‹ã€‚</li>
<li><strong>ä¼šè¯ç®¡ç†å±‚</strong>ï¼šè¿™ä¸€å±‚æ˜¯ MCP æœåŠ¡ç«¯ç‰¹æœ‰çš„éƒ¨åˆ†ï¼Œç”¨äºç®¡ç†å¤šä¸ªå®¢æˆ·ç«¯ä¼šè¯ï¼Œå¯¹åº”çš„æ¥å£ä¸º <strong>McpServerTransportProvider</strong>ã€‚å…¶ç”¨äºç®¡ç†æ´»è·ƒä¼šè¯çš„ç”Ÿå‘½å‘¨æœŸã€å‘æ‰€æœ‰å®¢æˆ·ç«¯å¹¿æ’­æ¶ˆæ¯ã€ç»Ÿä¸€å…³é—­ä¸æ¸…ç†è¿æ¥èµ„æºç­‰ï¼Œä½¿å¾—æœåŠ¡ç«¯å¯ä»¥åŒæ—¶ç»´æŠ¤å¤šä¸ªå®¢æˆ·ç«¯è¿æ¥ã€‚</li>
<li><strong>ä¼šè¯å±‚</strong>ï¼šè¿™ä¸€å±‚æ˜¯ MCP å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¹‹é—´é€šä¿¡çš„ä¸Šä¸‹æ–‡è½½ä½“ï¼Œå¯¹åº”çš„ç±»ä¸º <strong>McpClientSession/McpServerSession</strong>ã€‚æ¯ä¸€ä¸ªä¼šè¯ä»£è¡¨ä¸€æ¬¡å®Œæ•´çš„é€»è¾‘è¿æ¥ï¼Œå…¶è´Ÿè´£ç®¡ç†å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¹‹é—´çš„æ¶ˆæ¯ä¸Šä¸‹æ–‡ï¼ŒåŒ…æ‹¬è¯·æ±‚ã€å“åº”ä¸é€šçŸ¥ã€‚è¯¥å±‚åŸºäº JSON-RPC åè®®ï¼Œå®ç°äº†é€šä¿¡æ•°æ®çš„ç»Ÿä¸€å°è£…ä¸ä¼ é€’ï¼Œä½¿ä¸šåŠ¡é€»è¾‘ä¸åº•å±‚ä¼ è¾“æœºåˆ¶ç›¸äº’è§£è€¦ã€‚</li>
<li><strong>ä¼ è¾“å±‚</strong>ï¼šè¿™ä¸€å±‚è´Ÿè´£å®é™…çš„æ•°æ®æ”¶å‘ä¸åºåˆ—åŒ–ï¼Œå¯¹åº”çš„æ¥å£æ˜¯ <strong>McpClientTransport/McpServerTransport</strong>ã€‚å…¶å±è”½äº†åº•å±‚ I/O çš„å¤æ‚æ€§ï¼Œä¸ºä¸Šå±‚æä¾›æ¶ˆæ¯å‘é€ã€å¯¹è±¡ååºåˆ—åŒ–ç­‰æ“ä½œï¼Œå¹¶æä¾›äº†ä¸åŒåè®®çš„å®ç°ï¼Œå¦‚ Stdioã€HTTP + SSEã€Streamable HTTPã€‚</li>
</ul>
<h2 data-id="heading-2">ä¸‰ã€æ ¸å¿ƒäº¤äº’è¿‡ç¨‹</h2>
<p>Â Â Â ä¸Šä¸€ç« æˆ‘ä»¬ä»æ¶æ„å±‚é¢æ¢³ç†äº† Spring AI MCP çš„æ•´ä½“è®¾è®¡æ€è·¯ï¼šå®¢æˆ·ç«¯ç”±å…¥å£å±‚ã€è¿è¡Œå±‚ã€ä¼šè¯å±‚ä¸ä¼ è¾“å±‚æ„æˆï¼ŒæœåŠ¡ç«¯åˆ™åœ¨æ­¤åŸºç¡€ä¸Šå¢åŠ äº†ä¼šè¯ç®¡ç†å±‚ï¼Œç”¨ä»¥åè°ƒå¤šä¼šè¯åœºæ™¯ä¸‹çš„èµ„æºä¸ä¸Šä¸‹æ–‡ã€‚ä½†ç†è§£åˆ†å±‚ç»“æ„åªæ˜¯ç¬¬ä¸€æ­¥ï¼Œè¦çœŸæ­£æŒæ¡ MCP çš„è¿è¡Œæœºåˆ¶ï¼Œè¿˜éœ€è¦æ·±å…¥åˆ°â€œå±‚ä¸å±‚ä¹‹é—´â€ï¼Œä¹Ÿå°±æ˜¯å®ƒä»¬<strong>å¦‚ä½•å»ºç«‹è¿æ¥ã€åˆå§‹åŒ–ã€äº¤æ¢æ¶ˆæ¯ã€è°ƒç”¨å·¥å…·çš„æ ¸å¿ƒäº¤äº’è¿‡ç¨‹</strong>ã€‚</p>
<p>Â Â Â æœ¬ç« å°†ä»¥ SSE ä¸ºç¤ºä¾‹ï¼Œä¸²è”èµ· MCP åœ¨çœŸå®è¿è¡Œä¸­çš„ä¸‰æ¡ä¸»çº¿ï¼Œåˆ†åˆ«æ˜¯<strong>å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„æ„å»ºä¸è¿æ¥è¿‡ç¨‹ã€åˆå§‹åŒ–è¿‡ç¨‹ã€å·¥å…·å‘ç°ä¸è°ƒç”¨è¿‡ç¨‹</strong>ã€‚é€šè¿‡è¿™ä¸‰ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬å°†ä»æºç å±‚é¢ä»¥å›¾çš„å½¢å¼è¿˜åŸ MCP çš„äº¤äº’é€»è¾‘ï¼Œç†æ¸…æ¯ä¸€å±‚çš„èŒè´£è¾¹ç•Œä¸åä½œæ–¹å¼ã€‚å®é™…ä¸Šæºç ä¸­å¯¹äºå…¶ä»–åè®®çš„å¤„ç†ä¹Ÿæ˜¯éå¸¸ç±»ä¼¼çš„ï¼Œåªæ˜¯ä¼ è¾“å±‚çš„å®ç°ä¸Šä¼šç•¥æœ‰ä¸åŒï¼Œä½†æ•´ä½“ç»“æ„éƒ½æ˜¯ä¸€è‡´çš„ã€‚</p>
<p>Â Â Â åœ¨è§£æä¸‰ä¸ªé˜¶æ®µä¹‹å‰ï¼Œå…ˆè¦è®²è¿°ä¸€ä¸‹ Spring AI MCP çš„ SSE å®ç°ä¸­å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¸­æ˜¯å“ªäº›å±‚æ¬¡å®Œæˆæ¶ˆæ¯æ”¶å‘çš„ï¼š</p>













<table><thead><tr><th>MCP å®¢æˆ·ç«¯</th><th>MCP æœåŠ¡ç«¯</th></tr></thead><tbody><tr><td>åœ¨ MCP å®¢æˆ·ç«¯ä¸­ï¼Œæ¶ˆæ¯çš„æ”¶å‘å®Œå…¨ç”±ä¼ è¾“å±‚è´Ÿè´£å®Œæˆã€‚<br/><strong>è¿æ¥å»ºç«‹é˜¶æ®µ</strong>ï¼šå‘æœåŠ¡ç«¯å‘é€ <strong>GET è¯·æ±‚</strong>ï¼Œä»¥å»ºç«‹ SSE é•¿è¿æ¥ã€‚å»ºç«‹æˆåŠŸåï¼Œå®¢æˆ·ç«¯ä¼šæŒç»­ç›‘å¬è¯¥è¿æ¥ï¼Œç”¨äºæ¥æ”¶æ¥è‡ªæœåŠ¡ç«¯çš„å®æ—¶æ¶ˆæ¯ä¸äº‹ä»¶æ¨é€ã€‚<br/><strong>ä¸šåŠ¡äº¤äº’é˜¶æ®µ</strong>ï¼šåœ¨æ‰§è¡Œå¦‚åˆå§‹åŒ–ã€å·¥å…·å‘ç°ã€å·¥å…·è°ƒç”¨ç­‰æ“ä½œæ—¶ï¼Œä¼ è¾“å±‚ä¼šå‘æœåŠ¡ç«¯å‘é€ <strong>POST è¯·æ±‚</strong>ã€‚æœåŠ¡ç«¯æ¥æ”¶åˆ°è¿™äº›è¯·æ±‚åï¼Œä¼šé€šè¿‡ SSE é€šé“è¿”å›å“åº”æˆ–æ‰§è¡Œç»“æœï¼Œä»è€Œå®Œæˆä¸€æ¬¡å®Œæ•´çš„è¯·æ±‚-å“åº”å¾ªç¯ã€‚</td><td>ä¸å®¢æˆ·ç«¯ä¸åŒï¼ŒMCP æœåŠ¡ç«¯çš„æ¶ˆæ¯æ”¶å‘ç”±<strong>ä¼šè¯ç®¡ç†å±‚</strong>å’Œ<strong>ä¼ è¾“å±‚</strong>å…±åŒå®Œæˆã€‚<br/><strong>ä¼šè¯ç®¡ç†å±‚</strong>ï¼šè´Ÿè´£æ¥æ”¶å®¢æˆ·ç«¯çš„ GETã€POST è¯·æ±‚ï¼Œå…¶ä¸­ï¼šGET è¯·æ±‚ç”¨äºæ¥æ”¶å®¢æˆ·ç«¯çš„ SSE é•¿è¿æ¥è¯·æ±‚ï¼›POST è¯·æ±‚ç”¨äºæ¥æ”¶å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯ï¼Œå¹¶è¿›è¡ŒåŸºç¡€å“åº”ï¼ˆä¾‹å¦‚è¿”å› HTTP 200 OK çŠ¶æ€ç ï¼‰ã€‚<br/><strong>ä¼ è¾“å±‚</strong>ï¼šå®é™…çš„æ¶ˆæ¯å‘é€è€…ï¼Œåœ¨å·²å»ºç«‹çš„ SSE é€šé“ä¸Šå‘å®¢æˆ·ç«¯æ¨é€å“åº”æˆ–äº‹ä»¶æ¶ˆæ¯ï¼Œå¦‚å·¥å…·è°ƒç”¨ç»“æœã€è¿æ¥å»ºç«‹å“åº”ç­‰ã€‚</td></tr></tbody></table>
<h3 data-id="heading-3">3.1 å®¢æˆ·ç«¯/æœåŠ¡ç«¯æ„å»ºã€è¿æ¥è¿‡ç¨‹</h3>
<p>Â Â Â é¦–å…ˆè®²è§£å®¢æˆ·ç«¯/æœåŠ¡ç«¯çš„æ„å»ºå’Œè¿æ¥è¿‡ç¨‹ï¼Œè¿™æ˜¯ä»–ä»¬äº¤äº’çš„ç¬¬ä¸€æ­¥ï¼Œå…¶ä¸­æ¯”è¾ƒç‰¹æ®Šçš„æ˜¯ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯<strong>å‘èµ·è¿æ¥çš„è¿‡ç¨‹æ˜¯å‘ç”Ÿåœ¨å®¢æˆ·ç«¯çš„æ„å»ºè¿‡ç¨‹çš„</strong>ï¼Œå› æ­¤ä¸‹é¢ä¼šå°†å®¢æˆ·ç«¯æ„å»ºä¸è¿æ¥è¿‡ç¨‹ä¸€èµ·è®²è§£ã€‚</p>
<ul>
<li><strong>æœåŠ¡ç«¯æ„å»ºè¿‡ç¨‹</strong>ï¼šæœåŠ¡ç«¯çš„æ„å»ºè¿‡ç¨‹æ¯”è¾ƒç®€å•ï¼Œåœ¨å…¥å£å±‚ä¸­é…ç½®äº†æœåŠ¡ç«¯çš„æ‰€æœ‰ä¿¡æ¯ï¼ˆå¦‚è¶…æ—¶æ—¶é—´ã€èƒ½åŠ›é…ç½®ï¼‰åï¼Œè°ƒç”¨å…¶<strong>å·¥å‚æ–¹æ³•</strong>å°±èƒ½æ„å»ºå‡ºä¸€ä¸ªæœåŠ¡ç«¯è¿è¡Œå±‚å®ä¾‹ã€‚</li>
<li><strong>å®¢æˆ·ç«¯æ„å»ºè¿‡ç¨‹</strong>ï¼šä¸æœåŠ¡ç«¯ç±»ä¼¼ï¼Œåœ¨å…¥å£å±‚ä¸­é…ç½®äº†å®¢æˆ·ç«¯çš„æ‰€æœ‰ä¿¡æ¯ï¼ˆå¦‚è¶…æ—¶æ—¶é—´ã€èƒ½åŠ›é…ç½®ï¼‰åï¼Œè°ƒç”¨å…¶<strong>å·¥å‚æ–¹æ³•</strong>å°±èƒ½æ„å»ºå‡ºä¸€ä¸ªå®¢æˆ·ç«¯è¿è¡Œå±‚å®ä¾‹ã€‚ä½†æœ‰æ‰€åŒºåˆ«çš„æ˜¯ï¼Œå®¢æˆ·ç«¯è¿˜éœ€è¦åˆ›å»ºå‡ºå…¶ä¼šè¯å±‚å¯¹è±¡ã€‚åœ¨é…ç½®å®Œ<strong>ä¼šè¯å±‚å¯¹è±¡</strong>åï¼ˆéœ€è¦é…ç½®è¶…æ—¶æ—¶é—´ã€ä¼ è¾“å±‚å¯¹è±¡ç­‰ï¼‰ï¼Œè¿˜éœ€è¦<strong>è°ƒç”¨ä¼ è¾“å±‚æ–¹æ³•æ¥å»ºç«‹ä¸æœåŠ¡ç«¯çš„è¿æ¥</strong>ï¼Œæ­¤æ—¶ä¼šå‘å®¢æˆ·ç«¯å‘é€ <strong>GET è¯·æ±‚æ¥å»ºç«‹å¹¶ç›‘å¬ SSE è¿æ¥</strong>ã€‚æœåŠ¡ç«¯çš„ä¼šè¯ç®¡ç†å±‚æ¥æ”¶åˆ°åï¼Œä¼šå¼€å¯ SSE è¿æ¥ï¼Œå¹¶ä¸ºå®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ªä¼šè¯å±‚å¯¹è±¡ï¼Œæœ€åå†è¿”å›å®¢æˆ·ç«¯<strong>æ¶ˆæ¯ç«¯ç‚¹åœ°å€</strong>ï¼ˆä¹‹åå®¢æˆ·ç«¯éœ€è¦å‘è¿™ä¸ªåœ°å€å‘é€ä¸šåŠ¡äº¤äº’æ¶ˆæ¯ï¼‰ã€‚åœ¨å®¢æˆ·ç«¯æ”¶åˆ°å“åº”åï¼Œä¼šä¿å­˜è¿™ä¸ªæ¶ˆæ¯ç«¯ç‚¹åœ°å€ï¼Œè‡³æ­¤å®¢æˆ·ç«¯çš„æ„å»ºè¿‡ç¨‹æ‰ç®—ç»“æŸã€‚</li>
</ul>
<p>Â Â Â è¯¦ç»†çš„äº¤äº’æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8900d8b647ae48bea6a48a92282a7d4e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP55KQ5Lmx5pKe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763392738&amp;x-signature=rz0p8yOTINr56XEiikh8D4nYapA%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">3.2 å®¢æˆ·ç«¯/æœåŠ¡ç«¯åˆå§‹åŒ–è¿‡ç¨‹</h3>
<p>Â Â Â ç„¶åè®²è§£å®¢æˆ·ç«¯/æœåŠ¡ç«¯çš„åˆå§‹åŒ–è¿‡ç¨‹ï¼Œè¿™æ˜¯ä»–ä»¬äº¤äº’çš„ç¬¬äºŒæ­¥ã€‚æ•´ä¸ªåˆå§‹åŒ–è¿‡ç¨‹å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š<strong>åˆå§‹åŒ–å»ºç«‹ã€åˆå§‹åŒ–å®Œæˆé€šçŸ¥</strong>ã€‚<strong>åˆå§‹åŒ–å»ºç«‹</strong>æŒ‡çš„æ˜¯å®¢æˆ·ç«¯åœ¨å‘æœåŠ¡ç«¯å‘èµ·åˆå§‹åŒ–è¯·æ±‚ï¼ŒæœåŠ¡ç«¯å‘å®¢æˆ·ç«¯å“åº”æœåŠ¡ç«¯ä¿¡æ¯çš„è¿‡ç¨‹ã€‚è¿™ä¸ªè¿‡ç¨‹å®Œæˆåï¼ŒæœåŠ¡ç«¯å­˜å‚¨çš„çŠ¶æ€ä»…æ˜¯<strong>åˆå§‹åŒ–ä¸­</strong>ï¼Œå³è¿˜æœªç»“æŸåˆå§‹åŒ–è¿‡ç¨‹ï¼Œä¹‹åè¿˜éœ€è¦å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€<strong>åˆå§‹åŒ–å®Œæˆé€šçŸ¥</strong>ï¼ŒæœåŠ¡ç«¯å­˜å‚¨çš„çŠ¶æ€æ‰ä¼šè®¾ç½®ä¸º<strong>åˆå§‹åŒ–å®Œæˆ</strong>ï¼Œè¿™æ‰æ ‡å¿—ç€åŒæ–¹æ­£å¼å®Œæˆåˆå§‹åŒ–äº¤äº’ã€‚è¿™æ ·åšçš„æ„ä¹‰åœ¨äº<strong>åŒæ–¹èƒ½é€šè¿‡ä¸¤æ¬¡æ¶ˆæ¯äº¤æ¢å®ŒæˆçŠ¶æ€ç¡®è®¤</strong>ï¼Œç¡®ä¿åˆå§‹åŒ–è¿‡ç¨‹å®Œæ•´å¯é ã€‚</p>
<ul>
<li><strong>åˆå§‹åŒ–å»ºç«‹</strong>ï¼š</li>
</ul>
<p>Â Â Â ä¸Šå±‚æœåŠ¡åœ¨è°ƒç”¨å®¢æˆ·ç«¯è¿è¡Œå±‚å¯¹è±¡çš„åˆå§‹åŒ–æ–¹æ³•åï¼Œå°±èƒ½å¼€å¯è¿™ä¸€è¿‡ç¨‹ã€‚è¿è¡Œå±‚å¯¹è±¡ä¼šæ„å»ºåˆå§‹åŒ–è¯·æ±‚æ–¹æ³•ã€å‚æ•°ï¼ˆåŒ…å«<strong>å®¢æˆ·ç«¯ç‰ˆæœ¬ã€é…ç½®ä¿¡æ¯</strong>ï¼‰ï¼Œç„¶åè°ƒç”¨ä¼šè¯å±‚å¯¹è±¡å‘é€è¯·æ±‚ã€‚ä¼šè¯å±‚å¯¹è±¡å°†è¯·æ±‚è½¬æ¢ä¸º JSON-RPC æ ¼å¼çš„æ¶ˆæ¯ï¼Œç„¶åå°±è°ƒç”¨ä¼ è¾“å±‚å¯¹è±¡å‘é€æ¶ˆæ¯ã€‚ä¼ è¾“å±‚å¯¹è±¡åˆ™<strong>å‘æœåŠ¡ç«¯çš„æ¶ˆæ¯ç«¯ç‚¹å‘é€ POST è¯·æ±‚</strong>ï¼Œå¹¶æºå¸¦åˆšæ‰æ„å»ºçš„ JSON-RPC æ¶ˆæ¯ã€‚</p>
<p>Â Â Â æœåŠ¡ç«¯çš„ä¼šè¯ç®¡ç†å±‚æ¥æ”¶åˆ°åï¼Œä¼šå–å‡ºè¿æ¥è¿‡ç¨‹æ—¶åˆ›å»ºçš„ä¼šè¯å±‚å¯¹è±¡ï¼Œç„¶åè®©å…¶æ¥å¤„ç†è¿™ä¸ªæ¶ˆæ¯ã€‚ä¼šè¯å±‚å¯¹è±¡ä¼šä¿å­˜å®¢æˆ·ç«¯æ¶ˆæ¯ï¼Œå¹¶è®¾ç½®çŠ¶æ€ä¸º<strong>åˆå§‹åŒ–ä¸­</strong>ï¼Œä¹‹åæ„å»º JSON-RPC å“åº”æ¶ˆæ¯ï¼ˆå†…å®¹åŒ…å«æœåŠ¡ç«¯ç‰ˆæœ¬ã€ä¿¡æ¯ç­‰ï¼‰ï¼Œå†è°ƒç”¨ä¼ è¾“å±‚å¯¹è±¡å‘é€æ¶ˆæ¯ç»™å®¢æˆ·ç«¯ã€‚æœ€åä¼ è¾“å±‚å¯¹è±¡åˆ™é€šè¿‡ SSE è¿æ¥å‘å®¢æˆ·ç«¯å‘é€è¿™ä¸ª JSON -RPC æ¶ˆæ¯ã€‚</p>
<p>Â Â Â å®¢æˆ·ç«¯ä¼ è¾“å±‚å¯¹è±¡æ¥æ”¶åˆ°è¿™ä¸€å“åº”åï¼Œä¼šä¸€ç›´å‘ä¸Šä¼ é€’åˆ°è¿è¡Œå±‚ï¼Œä¹‹åè¿è¡Œå±‚å¯¹è±¡ä¼šå­˜å‚¨å“åº”ä¸­æœåŠ¡ç«¯çš„é…ç½®ä¿¡æ¯ã€‚</p>
<ul>
<li><strong>åˆå§‹åŒ–å®Œæˆé€šçŸ¥</strong>ï¼š</li>
</ul>
<p>Â Â Â åœ¨åˆå§‹åŒ–å»ºç«‹åï¼Œå®¢æˆ·ç«¯è¿è¡Œå±‚å¯¹è±¡è¿˜éœ€è¦è°ƒç”¨ä¼šè¯å±‚å¯¹è±¡æ¥é€šçŸ¥æœåŠ¡ç«¯åˆå§‹åŒ–å®Œæˆï¼Œä¼šè¯å±‚å¯¹è±¡åˆ™ä¼šæ„å»º JSON-RPC é€šçŸ¥æ¶ˆæ¯ï¼Œå¹¶è°ƒç”¨ä¼ è¾“å±‚å¯¹è±¡å‘é€è¿™ä¸€é€šçŸ¥ã€‚ä¼ è¾“å±‚å¯¹è±¡åˆ™<strong>å‘æœåŠ¡ç«¯çš„æ¶ˆæ¯ç«¯ç‚¹å‘é€ POST è¯·æ±‚</strong>ï¼Œå¹¶æºå¸¦åˆšæ‰æ„å»ºçš„ JSON-RPC æ¶ˆæ¯ã€‚</p>
<p>Â Â Â æœåŠ¡ç«¯çš„ä¼šè¯ç®¡ç†å±‚æ¥æ”¶åˆ°åï¼Œä¼šå–å‡ºè¿æ¥è¿‡ç¨‹æ—¶åˆ›å»ºçš„ä¼šè¯å±‚å¯¹è±¡ï¼Œç„¶åè®©å…¶æ¥å¤„ç†è¿™ä¸ªæ¶ˆæ¯ã€‚ä¼šè¯å±‚å¯¹è±¡åˆ™å°†çŠ¶æ€è®¾ç½®ä¸º<strong>åˆå§‹åŒ–å®Œæˆ</strong>ï¼Œå¹¶è¿”å›æˆåŠŸä¿¡æ¯ç»™ä¼šè¯ç®¡ç†å±‚ã€‚æœ€ç»ˆä¼šè¯ç®¡ç†å±‚ä¼šå‘å®¢æˆ·ç«¯çš„ POST è¯·æ±‚åšä¸€ä¸ªç®€å•çš„å“åº”ã€‚</p>
<p>Â Â Â å®¢æˆ·ç«¯ä¼ è¾“å±‚å¯¹è±¡æ¥æ”¶åˆ°è¿™ä¸€å“åº”åï¼Œä¼šä¸€ç›´å‘ä¸Šä¼ é€’åˆ°è¿è¡Œå±‚ï¼Œæœ€åè¿è¡Œå±‚ä¼šå°†å®¢æˆ·ç«¯çš„çŠ¶æ€æ ‡è®°ä¸º<strong>åˆå§‹åŒ–å®Œæˆ</strong>ã€‚è‡³æ­¤æ•´ä¸ªåˆå§‹åŒ–è¿‡ç¨‹æ‰ç®—ç»“æŸã€‚</p>
<p>Â Â Â è¯¦ç»†çš„äº¤äº’æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/129f05e2149742078afe85b6f586d270~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP55KQ5Lmx5pKe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763392738&amp;x-signature=w4RFZ54Efj9cCKI%2FX%2F4WwnCJRnY%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-5">3.3 å·¥å…·å‘ç°ã€è°ƒç”¨è¿‡ç¨‹</h3>
<p>Â Â Â æœ€åè®²è§£å·¥å…·å‘ç°ã€è°ƒç”¨çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹å±äº MCP çš„ä¸šåŠ¡äº¤äº’æµç¨‹ã€‚å…¶ä»–çš„è¿‡ç¨‹éƒ½æ˜¯å¾ˆç±»ä¼¼çš„ï¼Œå› ä¸ºæºç å¯¹æ•´ä¸ªä¸šåŠ¡äº¤äº’è¿›è¡Œäº†éå¸¸å¥½çš„æŠ½è±¡ï¼Œæ‰€ä»¥æ¯ä¸ªä¸šåŠ¡æµç¨‹åœ¨å±‚æ¬¡èµ°å‘ä¸Šéƒ½æ˜¯éå¸¸ç±»ä¼¼çš„ã€‚</p>
<ul>
<li><strong>å·¥å…·å‘ç°è¿‡ç¨‹</strong>ï¼š</li>
</ul>
<p>Â Â Â ä¸Šå±‚æœåŠ¡åœ¨è°ƒç”¨å®¢æˆ·ç«¯è¿è¡Œå±‚å¯¹è±¡çš„å·¥å…·å‘ç°æ–¹æ³•åï¼Œå°±èƒ½å¼€å¯è¿™ä¸€è¿‡ç¨‹ã€‚è¿è¡Œå±‚å¯¹è±¡ä¼šè°ƒç”¨ä¼šè¯å±‚å¯¹è±¡å‘é€è¯·æ±‚ï¼Œæ¥è·å–å·¥å…·åˆ—è¡¨ï¼Œä¼šè¯å±‚å¯¹è±¡å°†è¯·æ±‚å†…å®¹è½¬æ¢ä¸º JSON-RPC æ ¼å¼æ¶ˆæ¯åï¼Œè°ƒç”¨ä¼ è¾“å±‚å¯¹è±¡å‘é€æ¶ˆæ¯ã€‚æœ€åï¼Œä¼ è¾“å±‚å¯¹è±¡åˆ™<strong>å‘æœåŠ¡ç«¯çš„æ¶ˆæ¯ç«¯ç‚¹å‘é€ POST è¯·æ±‚</strong>ï¼Œå¹¶æºå¸¦è¿™ä¸€æ¶ˆæ¯ã€‚</p>
<p>Â Â Â æœåŠ¡ç«¯çš„ä¼šè¯ç®¡ç†å±‚å¯¹è±¡æ¥æ”¶åˆ°åï¼Œä¼šå–å‡ºè¿æ¥è¿‡ç¨‹æ—¶åˆ›å»ºçš„ä¼šè¯å±‚å¯¹è±¡ï¼Œç„¶åè®©å…¶æ¥å¤„ç†è¿™ä¸ªæ¶ˆæ¯ã€‚ä¼šè¯å±‚å¯¹è±¡åˆ™ä¼šæ„å»º JSON-RPC å“åº”æ¶ˆæ¯ï¼Œå†…å®¹åŒ…å«æœåŠ¡ç«¯çš„å¯ç”¨å·¥å…·åˆ—è¡¨ï¼Œå†è°ƒç”¨ä¼ è¾“å±‚å¯¹è±¡å‘é€æ¶ˆæ¯ç»™å®¢æˆ·ç«¯ã€‚æœ€åï¼Œä¼ è¾“å±‚å¯¹è±¡ä¼šé€šè¿‡ <strong>SSE è¿æ¥</strong>å‘å®¢æˆ·ç«¯å‘é€è¿™ä¸€æ¶ˆæ¯ã€‚</p>
<p>Â Â Â å®¢æˆ·ç«¯çš„ä¼ è¾“å±‚å¯¹è±¡åœ¨æ¥æ”¶åˆ°åï¼Œä¼šå°†è¿”å›çš„å†…å®¹ä¸€ç›´å‘ä¸Šä¼ é€’åˆ°è¿è¡Œå±‚å¯¹è±¡ï¼Œç„¶åå†è¿”å›ç»™ä¸Šå±‚çš„è°ƒç”¨è€…ï¼Œ</p>
<ul>
<li>å·¥å…·è°ƒç”¨è¿‡ç¨‹ï¼š</li>
</ul>
<p>Â Â Â æ•´ä¸ªè¿‡ç¨‹å…¶å®å’Œå·¥å…·å‘ç°è¿‡ç¨‹éå¸¸ç±»ä¼¼ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°ã€‚å”¯ä¸€çš„åŒºåˆ«åœ¨äºæœåŠ¡ç«¯çš„<strong>ä¼šè¯å±‚å¯¹è±¡æ‰§è¡Œé€»è¾‘ä¸åŒ</strong>ï¼Œæ­¤æ—¶å…¶ä¼šè°ƒç”¨ç›¸åº”çš„å·¥å…·å¹¶ç­‰å¾…è°ƒç”¨ç»“æœï¼Œæœ€åå†æŠŠè¿™ä¸ªç»“æœé€šè¿‡ä¼ è¾“å±‚è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p>
<p>Â Â Â è¯¦ç»†çš„äº¤äº’æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09f2e6d151df42e4b71a986a97aa8837~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP55KQ5Lmx5pKe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763392738&amp;x-signature=G5ChKPx1APdXarZi4ClG%2Fih6IKs%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">å››ã€æ ¸å¿ƒç»„ä»¶æºç å‰–æ</h2>
<p>Â Â Â åœ¨ä¸Šä¸€ç« ä¸­ï¼Œæˆ‘ä»¬æ·±å…¥è§£æäº† MCP å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯åœ¨ SSE æ¨¡å¼ä¸‹çš„æ ¸å¿ƒäº¤äº’æµç¨‹ï¼Œä»æ„å»ºä¸è¿æ¥ã€åˆå§‹åŒ–ï¼Œåˆ°å·¥å…·çš„å‘ç°ä¸è°ƒç”¨ï¼Œå…¨æµç¨‹å‘ˆç°äº†åˆ†å±‚æ¶æ„ä¸‹å„æ¨¡å—çš„åä½œæœºåˆ¶ã€‚ç†è§£äº†äº¤äº’é€»è¾‘ä¹‹åï¼Œæœ¬ç« å°†ä»¥ Spring AI MCP çš„æºç ä¸ºåŸºç¡€ï¼Œå‰–æå…¶æ ¸å¿ƒç»„ä»¶çš„å®ç°ç»†èŠ‚ï¼Œä»¥æ›´å¥½åœ°ç†è§£å…¶å†…éƒ¨çš„è¿ä½œæ–¹å¼ã€‚</p>
<p>Â Â è¿™é‡Œå…ˆç»™å‡º MCP å®¢æˆ·ç«¯ã€æœåŠ¡ç«¯çš„å®Œæ•´ç±»å›¾ï¼Œåç»­ä¼šé€å±‚æ‹†åˆ†è¿™ä¸ªç±»å›¾ï¼Œè‡ªä¸Šè€Œä¸‹åœ°è®²è§£å„ä¸ªå±‚æ¬¡æ¶‰åŠåˆ°çš„æºç ã€‚è¿™é‡Œæˆ‘ä½¿ç”¨çš„æºç ç‰ˆæœ¬ä¸º 0.10.0ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmodelcontextprotocol%2Fjava-sdk%2Freleases%2Ftag%2Fv0.10.0" target="_blank" title="https://github.com/modelcontextprotocol/java-sdk/releases/tag/v0.10.0" ref="nofollow noopener noreferrer">github.com/modelcontexâ€¦</a>ï¼‰ï¼Œå¯¹åº” Spring AI 1.0.0 ç‰ˆæœ¬å†…ä½¿ç”¨çš„ mcp ç‰ˆæœ¬ã€‚</p>













<table><thead><tr><th>MCP å®¢æˆ·ç«¯</th><th>MCP æœåŠ¡ç«¯</th></tr></thead><tbody><tr><td><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4e4722da37224f488950dadae80c59b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP55KQ5Lmx5pKe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763392738&amp;x-signature=cYBwlpqQuALHygieqYDtlNAqo2Q%3D" alt="" loading="lazy"/></td><td><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a23cc1870a85471584d79bb102134d52~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP55KQ5Lmx5pKe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763392738&amp;x-signature=zD8pyYw7WiDFtS5mbOI5678nP9g%3D" alt="" loading="lazy"/></td></tr></tbody></table>
<blockquote>
<p>Â Â Â ç”±äºæ˜é‡‘ç¯‡å¹…æœ‰é™ï¼Œè¿™ä¸€ç« çš„éƒ¨åˆ†æ”¾åœ¨äº†è¿™é‡Œï¼š<a href="https://juejin.cn/spost/7570902473433825280" target="_blank" title="https://juejin.cn/spost/7570902473433825280">juejin.cn/spost/75709â€¦</a>ã€‚</p>
</blockquote>
<h2 data-id="heading-7">äº”ã€è¿è¡Œæ—¶æ–­ç‚¹è¿½è¸ª</h2>
<p>Â Â Â åœ¨å‰é¢çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä»æ¶æ„ã€äº¤äº’æµç¨‹ã€æ ¸å¿ƒæºç ä¸‰ä¸ªè§’åº¦å‰–æäº† Spring AI MCP çš„æ•´ä½“è®¾è®¡ä¸å…³é”®å®ç°ï¼Œç†æ¸…äº†å„å±‚ä¹‹é—´çš„èŒè´£åˆ’åˆ†ä¸è°ƒç”¨å…³ç³»ã€‚ä¸ºäº†è®©å¤§å®¶èƒ½ç›´è§‚åœ°çœ‹åˆ° MCP åœ¨å®é™…è¿è¡Œæ—¶çš„äº¤äº’è¿‡ç¨‹ï¼Œè¿™ä¸€ç« å°†é€šè¿‡<strong>æ–­ç‚¹è°ƒè¯•</strong>çš„æ–¹å¼ï¼Œä»¥æœåŠ¡ç«¯æºç çš„è§†è§’ï¼Œæ·±å…¥æ¼”ç¤º <strong>SSE æ¨¡å¼ä¸‹å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯åˆå§‹åŒ–çš„è¿‡ç¨‹</strong>ã€‚åœ¨ç†è§£äº†åˆå§‹åŒ–è¿™ä¸ªæ¯”è¾ƒå¤æ‚çš„è¿‡ç¨‹åï¼Œå…¶ä»–çš„è¿‡ç¨‹ä¹Ÿæ˜¯éå¸¸ç±»ä¼¼çš„ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥æŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤æ­å»ºå¥½ç¯å¢ƒåè‡ªè¡Œè°ƒè¯•ã€‚</p>
<h3 data-id="heading-8">5.1 ç¯å¢ƒæ­å»º</h3>
<p>Â Â Â pom ä¾èµ–ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.modelcontextprotocol.sdk<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mcp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.10.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>Â Â Â å·¥ç¨‹ä»£ç ï¼š</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">import</span> org.springframework.boot.web.servlet.ServletRegistrationBean;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;
<span class="hljs-keyword">import</span> org.springframework.web.servlet.config.annotation.EnableWebMvc;
<span class="hljs-keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

<span class="hljs-keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;

<span class="hljs-keyword">import</span> io.modelcontextprotocol.server.transport.HttpServletSseServerTransportProvider;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableWebMvc</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">McpServerConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebMvcConfigurer</span> {

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> HttpServletSseServerTransportProvider <span class="hljs-title function_">servletSseServerTransportProvider</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> HttpServletSseServerTransportProvider.builder()
            .objectMapper(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>())
            .messageEndpoint(<span class="hljs-string">"/mcp/message"</span>)
            .build();
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> ServletRegistrationBean <span class="hljs-title function_">customServletBean</span><span class="hljs-params">(HttpServletSseServerTransportProvider transportProvider)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServletRegistrationBean</span>(transportProvider);
    }
}
</code></pre>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;
<span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;
<span class="hljs-keyword">import</span> org.springframework.context.ConfigurableApplicationContext;

<span class="hljs-keyword">import</span> io.modelcontextprotocol.server.McpServer;
<span class="hljs-keyword">import</span> io.modelcontextprotocol.server.McpServerFeatures;
<span class="hljs-keyword">import</span> io.modelcontextprotocol.server.McpSyncServer;
<span class="hljs-keyword">import</span> io.modelcontextprotocol.server.transport.HttpServletSseServerTransportProvider;
<span class="hljs-keyword">import</span> io.modelcontextprotocol.spec.McpSchema;

<span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">McpServerApplication</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">ConfigurableApplicationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> SpringApplication.run(McpServerApplication.class, args);
        <span class="hljs-comment">// ä» spring å®¹å™¨ä¸­å–å‡ºä¼šè¯ç®¡ç†å±‚å¯¹è±¡</span>
        <span class="hljs-type">HttpServletSseServerTransportProvider</span> <span class="hljs-variable">transportProvider</span> <span class="hljs-operator">=</span> context.getBean(HttpServletSseServerTransportProvider.class);
        <span class="hljs-comment">// å®šä¹‰å·¥å…·ï¼Œè¿™é‡Œä¸ºç®€å•çš„ä¸¤æ•°åŠ å‡ä¹˜é™¤è®¡ç®—å™¨</span>
        <span class="hljs-type">var</span> <span class="hljs-variable">schema</span> <span class="hljs-operator">=</span> <span class="hljs-string">"""
                {
                  "type" : "object",
                  "id" : "urn:jsonschema:Operation",
                  "properties" : {
                    "operation" : {
                      "type" : "string"
                    },
                    "a" : {
                      "type" : "number"
                    },
                    "b" : {
                      "type" : "number"
                    }
                  }
                }
                """</span>;
        <span class="hljs-comment">// å·¥å…·çš„å…·ä½“å®ç°</span>
        <span class="hljs-type">var</span> <span class="hljs-variable">syncToolSpecification</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpServerFeatures</span>.SyncToolSpecification(
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpSchema</span>.Tool(<span class="hljs-string">"calculator"</span>, <span class="hljs-string">"Basic calculator"</span>, schema),
                (exchange, arguments) -&gt; {
                    <span class="hljs-type">String</span> <span class="hljs-variable">operation</span> <span class="hljs-operator">=</span> (String) arguments.get(<span class="hljs-string">"operation"</span>);
                    <span class="hljs-type">double</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> Double.parseDouble(String.valueOf(arguments.get(<span class="hljs-string">"a"</span>)));
                    <span class="hljs-type">double</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> Double.parseDouble(String.valueOf(arguments.get(<span class="hljs-string">"b"</span>)));
                    <span class="hljs-type">double</span> resultValue;
                    <span class="hljs-keyword">switch</span> (operation) {
                        <span class="hljs-keyword">case</span> <span class="hljs-string">"add"</span>:
                            resultValue = a + b;
                            <span class="hljs-keyword">break</span>;
                        <span class="hljs-keyword">case</span> <span class="hljs-string">"subtract"</span>:
                            resultValue = a - b;
                            <span class="hljs-keyword">break</span>;
                        <span class="hljs-keyword">case</span> <span class="hljs-string">"multiply"</span>:
                            resultValue = a * b;
                            <span class="hljs-keyword">break</span>;
                        <span class="hljs-keyword">case</span> <span class="hljs-string">"divide"</span>:
                            <span class="hljs-keyword">if</span> (b == <span class="hljs-number">0</span>) {
                                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpSchema</span>.CallToolResult(<span class="hljs-string">"Error: Division by zero"</span>, <span class="hljs-literal">true</span>);
                            }
                            resultValue = a / b;
                            <span class="hljs-keyword">break</span>;
                        <span class="hljs-keyword">default</span>:
                            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpSchema</span>.CallToolResult(<span class="hljs-string">"Error: Unknown operation '"</span> + operation + <span class="hljs-string">"'"</span>, <span class="hljs-literal">true</span>);
                    }
                    <span class="hljs-comment">// è¿”å›æ‰§è¡Œç»“æœ</span>
                    <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> String.valueOf(resultValue);
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpSchema</span>.CallToolResult(result, <span class="hljs-literal">false</span>);
                }
        );
        <span class="hljs-comment">// æ„å»ºè¿è¡Œå±‚å¯¹è±¡</span>
        <span class="hljs-type">McpSyncServer</span> <span class="hljs-variable">syncServer</span> <span class="hljs-operator">=</span> McpServer.sync(transportProvider)
                .serverInfo(<span class="hljs-string">"my-server"</span>, <span class="hljs-string">"1.0.0"</span>)
                .capabilities(McpSchema.ServerCapabilities.builder()
                        .resources(<span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>)
                        .tools(<span class="hljs-literal">true</span>) <span class="hljs-comment">// å¼€å¯å·¥å…·è°ƒç”¨èƒ½åŠ›</span>
                        .prompts(<span class="hljs-literal">true</span>) <span class="hljs-comment">// å¼€å¯æç¤ºè¯æ¨¡æ¿èƒ½åŠ›</span>
                        .logging() <span class="hljs-comment">// å¼€å¯äº‹ä»¶æ¨é€èƒ½åŠ›</span>
                        .completions() <span class="hljs-comment">// å¼€å¯è‡ªåŠ¨è¡¥å…¨èƒ½åŠ›</span>
                        .build())
                .build();
        <span class="hljs-comment">// æ·»åŠ å®šä¹‰å¥½çš„å·¥å…·</span>
        syncServer.addTool(syncToolSpecification);
    }

}
</code></pre>
<p>Â Â Â ä¹‹åå°±å¯ä»¥è¿è¡Œ main æ–¹æ³•å¯åŠ¨æœåŠ¡ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f698ac4c729496da890b87a6af8dfab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP55KQ5Lmx5pKe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763392738&amp;x-signature=ZeAcIV6TYjm%2BNHH3kYrpXX3T9xc%3D" alt="" loading="lazy"/></p>
<p>Â Â Â è¿™é‡Œæˆ‘ä½¿ç”¨çš„ MCP å®¢æˆ·ç«¯æ˜¯ <strong>MCP Inspector</strong>ï¼Œå®ƒæ˜¯ä¸€ä¸ªç”¨äºè°ƒè¯•ã€æµ‹è¯•å’Œå¯è§†åŒ–äº¤äº’çš„å·¥å…·ï¼Œç›¸å½“äºä¸€ä¸ªå›¾å½¢åŒ–çš„ MCP å®¢æˆ·ç«¯ï¼Œå¯ä»¥ç›´è§‚åœ°æŸ¥çœ‹ã€è°ƒç”¨å’Œè°ƒè¯• MCP Server çš„å„ç§èƒ½åŠ›ã€‚å®‰è£…äº† Node.js åï¼Œå°±å¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤å¯åŠ¨ MCP Inspectorï¼š</p>
<pre><code class="hljs language-bash" lang="bash">npx @modelcontextprotocol/inspector
</code></pre>
<p>Â Â Â å¯åŠ¨åçš„ç•Œé¢å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9a9860fec403419fbb02d3dee6dba2ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP55KQ5Lmx5pKe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763392738&amp;x-signature=Xx%2FpRXR8hX6I%2Bg7MMaJbNcZdhKg%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-9">5.2 æ–­ç‚¹æ¼”ç¤º</h3>
<p>Â Â Â åœ¨ç¬¬ä¸‰ç« è®²è§£åˆå§‹åŒ–è¿‡ç¨‹æ—¶ï¼Œæåˆ°åˆå§‹åŒ–è¿‡ç¨‹åŒ…å«ä¸¤å¤§æ­¥éª¤ï¼š<strong>åˆå§‹åŒ–å»ºç«‹ã€åˆå§‹åŒ–å®Œæˆé€šçŸ¥</strong>ï¼Œè€Œå¯¹äºè¿™ä¸¤ä¸ªæ­¥éª¤ï¼Œå®¢æˆ·ç«¯éƒ½ä¼šå‘é€ POST è¯·æ±‚ï¼Œå› æ­¤è¿™é‡Œé¦–å…ˆéœ€è¦æŠŠæ–­ç‚¹è®¾ç½®åœ¨æœåŠ¡ç«¯<strong>ä¼šè¯ç®¡ç†å±‚</strong> <code>HttpServletSseServerTransportProvider</code> ä¸­æ¥æ”¶ POST è¯·æ±‚çš„æ–¹æ³• <code>doPost()</code>ã€‚åœ¨ MCP Inspector ä¸­è§¦å‘è¿™ä¸€æ­¥éª¤çš„æ–¹å¼å°±æ˜¯ç‚¹å‡» <strong>Connect</strong> æŒ‰é’®ï¼Œåœ¨è¿æ¥å®Œæˆåï¼Œå°±ä¼šå‘é€ POST è¯·æ±‚è§¦å‘åˆå§‹åŒ–è¿‡ç¨‹ã€‚</p>
<h4 data-id="heading-10">5.2.1 åˆå§‹åŒ–å»ºç«‹</h4>
<p>Â Â Â åˆå§‹åŒ–å»ºç«‹è¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼Œå¯ä»¥çœ‹åˆ°å®¢æˆ·ç«¯å‘é€äº† POST è¯·æ±‚ï¼Œè¯·æ±‚è·¯å¾„ä¸º <strong>/mcp/message</strong>ï¼ˆå¯¹åº”äºæœåŠ¡ç«¯è®¾ç½®çš„æ¶ˆæ¯ç«¯ç‚¹åœ°å€ï¼‰ï¼Œä¸”é€šè¿‡è¯·æ±‚å‚æ•°ä¸­çš„ sessionIdï¼ˆè¿™ä¸ª id æ˜¯å®¢æˆ·ç«¯åœ¨è¿æ¥è¿‡ç¨‹å¾—åˆ°çš„ï¼‰è·å¾—åˆ°å¯¹åº”çš„ä¼šè¯å¯¹è±¡ï¼Œç„¶åå†é€šè¿‡ä¼šè¯å±‚å¯¹è±¡å¤„ç† JSON-RPC æ¶ˆæ¯ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/88ed4ad10f124eb68a0c04ec9f06fc3c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP55KQ5Lmx5pKe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763392738&amp;x-signature=COb%2Fgt1r2oG28xDWbzkf3bN%2Foy4%3D" alt="" loading="lazy"/></p>
<p>Â Â ä¼šè¯å±‚å¯¹è±¡åœ¨ <code>handle()</code> æ–¹æ³•é‡Œåˆ¤æ–­äº†æ¶ˆæ¯çš„ç±»å‹ï¼Œè¿™é‡Œä¸ºè¯·æ±‚ç±»å‹ï¼Œä¹‹åèµ°å…¥ <code>handleIncomingRequest()</code> æ–¹æ³•ã€‚å¦‚ä¸‹æ‰€ç¤ºã€‚<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8df4c23a887844c3ab3c5441171738bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP55KQ5Lmx5pKe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763392738&amp;x-signature=fJNAsiyF8XHEbmXwNvaFpg0iONM%3D" alt="" loading="lazy"/></p>
<p>Â Â Â <code>handleIncomingRequest()</code> è¿™ä¸ªæ–¹æ³•ä¼šä¿®æ”¹æœåŠ¡ç«¯çš„çŠ¶æ€ä¸º <strong>STATE_INITIALIZING</strong>ï¼ˆåˆå§‹åŒ–ä¸­ï¼‰ï¼Œç„¶åå†è®©è¯·æ±‚å¤„ç†å™¨å¤„ç†è¿™ä¸ªè¯·æ±‚ã€‚å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/02f4daa5d6474a8292a12934fe52f200~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP55KQ5Lmx5pKe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763392738&amp;x-signature=cS1YaO9GKvZsMhfCmJd29WZoqg8%3D" alt="" loading="lazy"/></p>
<p>Â Â Â å¤„ç†å™¨çš„å®ç°å¯¹åº”äº <code>asyncInitializeRequestHandler()</code> æ–¹æ³•ï¼ˆè¿™ä¸ªæ–¹æ³•çš„å®šä¹‰åœ¨è¿è¡Œå±‚ <code>McpAsyncServer</code> ä¸­ï¼Œä»¥ lambda çš„æ–¹å¼ä¼ ç»™äº†ä¼šè¯å¯¹è±¡ï¼‰ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šæ„å»ºç»™å®¢æˆ·ç«¯çš„è¿”å›ç»“æœï¼Œå³æœåŠ¡ç«¯çš„åŸºæœ¬ä¿¡æ¯ã€åè®®ç‰ˆæœ¬ç­‰ã€‚å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8bb1a70d65604305bbd9764a9d598c03~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP55KQ5Lmx5pKe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763392738&amp;x-signature=FpABtjqKvtQM18M%2FLrxWjq08zQU%3D" alt="" loading="lazy"/></p>
<p>Â Â Â æœ€ååˆ™è°ƒç”¨ä¼ è¾“å±‚ <code>HttpServletMcpSessionTransport</code> çš„ <code>sendMessage()</code> æ–¹æ³•é€šè¿‡ SSE è¿æ¥å‘é€ç»“æœæ¶ˆæ¯ç»™å®¢æˆ·ç«¯ã€‚å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5444bc3c32eb4f54bb8a7b9f2aa8bc66~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP55KQ5Lmx5pKe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763392738&amp;x-signature=elcSyDQtGZbyBWjO%2FW78V5xlAgY%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-11">5.2.2 åˆå§‹åŒ–å®Œæˆé€šçŸ¥</h4>
<p>Â Â Â åˆå§‹åŒ–å®Œæˆè¿‡ç¨‹é€šçŸ¥çš„è¿‡ç¨‹ä¸å‰é¢åˆå§‹åŒ–å»ºç«‹è¿‡ç¨‹éå¸¸ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ä¼šè¯ç®¡ç†å±‚æ¥æ”¶ POST è¯·æ±‚åè½¬å‘ç»™ä¼šè¯å±‚å¤„ç†ï¼ŒåŒºåˆ«åœ¨äºä¼šè¯å±‚çš„å¤„ç†é€»è¾‘ä¸åŒï¼Œä¸‹é¢çš„æ¼”ç¤ºä»…å±•ç¤ºä¸åŒä¹‹å¤„ã€‚</p>
<p>Â Â åœ¨ä¼šè¯å±‚çš„ <code>handle()</code> æ–¹æ³•ä¸­ï¼Œæ­¤æ—¶çš„æ¶ˆæ¯ç±»å‹ä¸ºé€šçŸ¥ç±»å‹ï¼Œå› æ­¤ä¼šèµ°å…¥ <code>handleIncomingNotification()</code> æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f51c4d8ac4dc44ddbd07d54bad8cd62f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP55KQ5Lmx5pKe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763392738&amp;x-signature=T4hO0tADB%2Fame90xBQivOGlqfXw%3D" alt="" loading="lazy"/></p>
<p>Â Â Â <code>handleIncomingNotification()</code> æ–¹æ³•ä¼šå°†æœåŠ¡ç«¯çš„çŠ¶æ€è®¾ç½®ä¸º <strong>STATE_INITIALIZED</strong>ï¼ˆåˆå§‹åŒ–å®Œæˆï¼‰ï¼Œç„¶åå†è®©é€šçŸ¥å¤„ç†å™¨å¤„ç†è¿™ä¸ªè¯·æ±‚ã€‚<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f14815190f3a4c5e9fbae893936c9d18~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP55KQ5Lmx5pKe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763392738&amp;x-signature=6hUhDlEHmCbn5ERNuCHDpsdT1Q0%3D" alt="" loading="lazy"/></p>
<p>Â Â Â è€Œè¿™ä¸ªå¤„ç†å™¨å®é™…ä¸Šå¹¶æ²¡æœ‰åšä»»ä½•äº‹æƒ…ï¼Œåœ¨è¿è¡Œå±‚ <code>McpAsyncServer</code> æ„é€ æ–¹æ³•ä¸­ lambda è®¾ç½®ä¸º <code>Mono::empty</code>ï¼Œå³ä¸åšä»»ä½•äº‹ã€‚å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b65ce08f07643418aed4db7698f2756~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP55KQ5Lmx5pKe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763392738&amp;x-signature=x8vN0euG2GRhcHTtfcnK1nxYZP0%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-12">å…­ã€æ€»ç»“ä¸æ€è€ƒ</h2>
<p>Â Â Â æ•´ä½“æ¥çœ‹ï¼ŒSpring AI å¯¹ MCP çš„å®ç°ä½“ç°å‡ºé«˜åº¦çš„<strong>æ¶æ„ä¸€è‡´æ€§ä¸æŠ½è±¡ä¼˜é›…æ€§</strong>ã€‚æ— è®ºæ˜¯å®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡ç«¯ï¼Œå…¶éƒ½ä»¥åˆ†å±‚åŒ–ã€æ¥å£åŒ–çš„æ–¹å¼å°†æ ¸å¿ƒåè®®èƒ½åŠ›æŠ½ç¦»å‡ºæ¥ï¼Œä½¿å¾—é€šä¿¡ã€ä¼šè¯ã€å·¥å…·è°ƒç”¨ç­‰åŠŸèƒ½å¯ä»¥åœ¨ç»Ÿä¸€æ¨¡å‹ä¸‹ååŒè¿ä½œã€‚è¿™ç§è®¾è®¡æ—¢å»¶ç»­äº† Spring ä½“ç³»ä¸€è´¯çš„â€œä»¥æ¥å£é©±åŠ¨æ¡†æ¶â€çš„å“²å­¦ï¼Œä¹Ÿè®© MCP èƒ½å¤Ÿä»¥æä½è€¦åˆçš„æ–¹å¼åµŒå…¥åˆ°æ›´å¹¿æ³›çš„ AI åº”ç”¨åœºæ™¯ä¸­ã€‚</p>
<p>Â Â Â ä»æºç å±‚é¢çœ‹ï¼ŒSpring AI MCP çš„å…³é”®ç‰¹å¾åœ¨äºâ€œ<strong>å¯¹ç§°ä¸è§£è€¦</strong>â€ã€‚å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„ç±»ç»“æ„å‡ ä¹æ˜¯é•œåƒå¼çš„å­˜åœ¨ï¼Œè¿™ç§å¯¹ç§°è®¾è®¡ä¸ä»…æå‡äº†ç†è§£ä¸è°ƒè¯•çš„ä¾¿åˆ©æ€§ï¼Œä¹Ÿä¸ºæœªæ¥çš„æ‰©å±•ï¼ˆå¦‚è‡ªå®šä¹‰ Transportã€å·¥å…·æ³¨å†Œæœºåˆ¶æˆ–æ–°èƒ½åŠ›å£°æ˜ï¼‰æä¾›äº†å¤©ç„¶çš„ç©ºé—´ã€‚è€Œåœ¨è¿è¡Œæ—¶ï¼Œé€šè¿‡<strong>äº‹ä»¶æµä¸å¼‚æ­¥æœºåˆ¶</strong>ï¼Œç³»ç»Ÿå®ç°äº†åè®®å±‚ä¸æ‰§è¡Œå±‚çš„å½»åº•åˆ†ç¦»ï¼Œä½¿å¼€å‘è€…èƒ½å¤Ÿåœ¨ä¿æŒé«˜æŠ½è±¡å±‚çš„åŒæ—¶ï¼Œç²¾ç¡®æŒæ¡åº•å±‚äº¤äº’ç»†èŠ‚ã€‚</p>
<p>Â Â Â æ›´æ·±å±‚æ¬¡åœ°ï¼ŒSpring AI å¯¹ MCP çš„å®ç°å¹¶éç®€å•çš„åè®®è½åœ°ï¼Œè€Œæ˜¯ä¸€ç§â€œ<strong>å¼€å‘è€…å¯æ§çš„ AI æ¥å£ä½“ç³»</strong>â€çš„æ¢ç´¢ã€‚å®ƒå°†â€œæ¨¡å‹ä¸Šä¸‹æ–‡åè®®â€è½¬åŒ–ä¸ºå¯ç¼–ç¨‹çš„äº¤äº’éª¨æ¶ï¼Œè®©è¯­è¨€æ¨¡å‹ä¸å†æ˜¯é»‘ç›’ï¼Œè€Œæˆä¸ºå¯ç®¡ç†ã€å¯è°ƒåº¦çš„æœåŠ¡ç«¯å®ä½“ã€‚</p>
<p>Â Â Â è¿™ç§æ€è·¯çš„ä»·å€¼ï¼Œä¸ä»…åœ¨äºå½“å‰çš„ Agent åº”ç”¨ï¼Œæ›´å¯èƒ½æˆä¸º<strong>æœªæ¥ AI å¹³å°åŒ–ã€æ¨¡å—åŒ–å‘å±•çš„å…³é”®åŸºçŸ³</strong>ã€‚å¯ä»¥é¢„è§ï¼Œéšç€ MCP æ ‡å‡†çš„ä¸æ–­å®Œå–„ä»¥åŠ Spring AI çš„ç”Ÿæ€æ‰©å±•ï¼Œè¿™ä¸€ä½“ç³»å°†<strong>ä»â€œå®éªŒæ€§æ¡†æ¶â€èµ°å‘â€œåŸºç¡€è®¾æ–½çº§ç»„ä»¶â€</strong>ã€‚åœ¨é‚£ä¹‹å‰ï¼Œç†è§£å…¶æºç è®¾è®¡ä¸è¿è¡ŒåŸç†ï¼Œæ­£æ˜¯å¼€å‘è€…æŒæ¡ä¸‹ä¸€ä»£ AI ç³»ç»Ÿæ„å»ºæ–¹å¼çš„æœ€å¥½èµ·ç‚¹ã€‚</p>
<h2 data-id="heading-13">å‚è€ƒèµ„æ–™</h2>
<ol>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fqq_44560143%2Farticle%2Fdetails%2F149063737" target="_blank" title="https://blog.csdn.net/qq_44560143/article/details/149063737" ref="nofollow noopener noreferrer">Spring AI MCP æµ…æ_springboot mcpå¦‚ä½•å‘Šè¯‰å¤§æ¨¡å‹å‚æ•°å«ä¹‰-CSDNåšå®¢</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg2ODYyMDY1Ng%3D%3D%26mid%3D2247485360%26idx%3D1%26sn%3Dd65f8e98ed5358242dbea8299d02b119%26scene%3D21%26poc_token%3DHJxYD2mjzMXFcF3hFshkbxrvFmez_NYH9_zJbgtT" target="_blank" title="https://mp.weixin.qq.com/s?__biz=Mzg2ODYyMDY1Ng==&amp;mid=2247485360&amp;idx=1&amp;sn=d65f8e98ed5358242dbea8299d02b119&amp;scene=21&amp;poc_token=HJxYD2mjzMXFcF3hFshkbxrvFmez_NYH9_zJbgtT" ref="nofollow noopener noreferrer">SpringAI(GA)ï¼šMCPæºç è§£è¯»</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmodelcontextprotocol%2Fjava-sdk" target="_blank" title="https://github.com/modelcontextprotocol/java-sdk" ref="nofollow noopener noreferrer">github.com/modelcontexâ€¦</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV11XNrzdEE7%2F%3Fspm_id_from%3D333.1007.top_right_bar_window_history.content.click%26vd_source%3Db9a6a3dbb4871a28097897f1c6538c23" target="_blank" title="https://www.bilibili.com/video/BV11XNrzdEE7/?spm_id_from=333.1007.top_right_bar_window_history.content.click&amp;vd_source=b9a6a3dbb4871a28097897f1c6538c23" ref="nofollow noopener noreferrer">æ·±åº¦æŒ–æ˜MCPåè®®åº•å±‚æ¶æ„ï¼Œå•æ­¥è·Ÿè¸ªç»†èŠ‚ä¸€è§ˆæ— é—_å“”å“©å“”å“©_bilibili</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmodelcontextprotocol.io%2Fsdk%2Fjava%2Fmcp-server" target="_blank" title="https://modelcontextprotocol.io/sdk/java/mcp-server" ref="nofollow noopener noreferrer">modelcontextprotocol.io/sdk/java/mcâ€¦</a></li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å›¾è§£æºç ï¼šä¸‡å­—è§£æ Spring AI åˆ°åº•æ˜¯æ€ä¹ˆå®ç° MCP çš„ï¼ˆæºç éƒ¨åˆ†ï¼‰]]></title>    <link>https://juejin.cn/post/7570902473433825280</link>    <guid>https://juejin.cn/post/7570902473433825280</guid>    <pubDate>2025-11-10T15:05:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570902473433825280" data-draft-id="7570902473433808896" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å›¾è§£æºç ï¼šä¸‡å­—è§£æ Spring AI åˆ°åº•æ˜¯æ€ä¹ˆå®ç° MCP çš„ï¼ˆæºç éƒ¨åˆ†ï¼‰"/> <meta itemprop="keywords" content="åç«¯,Java,æ¶æ„"/> <meta itemprop="datePublished" content="2025-11-10T15:05:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°ç’ä¹±æ’"/> <meta itemprop="url" content="https://juejin.cn/user/3653045848387931"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å›¾è§£æºç ï¼šä¸‡å­—è§£æ Spring AI åˆ°åº•æ˜¯æ€ä¹ˆå®ç° MCP çš„ï¼ˆæºç éƒ¨åˆ†ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3653045848387931/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°ç’ä¹±æ’
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T15:05:42.000Z" title="Mon Nov 10 2025 15:05:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»37åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>Â Â Â ç”±äºç¯‡å¹…é—®é¢˜ï¼Œæºç éƒ¨åˆ†åœ¨è¿™é‡Œæ–°å»ºäº†ä¸€ç¯‡æ–‡ç« ï¼Œå®Œæ•´çš„æ–‡ç« åœ¨è¿™é‡Œï¼š<a href="https://juejin.cn/spost/7570935965435641871" target="_blank" title="https://juejin.cn/spost/7570935965435641871">juejin.cn/spost/75709â€¦</a>ã€‚</p>
</blockquote>
<h2 data-id="heading-0">3.1 å®¢æˆ·ç«¯</h2>
<h3 data-id="heading-1">3.1.1 å…¥å£å±‚</h3>
<p>Â Â Â MCP å®¢æˆ·ç«¯å…¥å£å±‚æ¶‰åŠåˆ°çš„ç±»åŒ…æ‹¬ <strong>McpClient</strong>ã€<strong>McpClient.AsyncSpc</strong>ï¼ˆå†…éƒ¨ç±»ï¼‰ã€<strong>McpClient.SyncSpec</strong>ï¼ˆå†…éƒ¨ç±»ï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32b42c569874488d8e11385e81cd591f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP55KQ5Lmx5pKe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763392204&amp;x-signature=YsxcuZklkx%2BMRUNQAdepWRfPn5Y%3D" alt="" loading="lazy"/></p>
<p>Â Â Â åœ¨å…¥å£å±‚ä¸­ï¼Œ<code>McpClient</code> æ˜¯åˆ›å»º MCP å®¢æˆ·ç«¯çš„ç»Ÿä¸€å…¥å£ï¼Œé€šè¿‡é™æ€æ–¹æ³• <code>sync()</code> å’Œ <code>async()</code> æä¾›äº†åŒæ­¥å’Œå¼‚æ­¥ä¸¤ç§æ¨¡å¼çš„æ„å»ºæ–¹å¼ï¼Œåˆ†åˆ«è¿”å› <code>SyncSpec</code> å’Œ <code>AsyncSpec</code> è¿™ä¸¤ä¸ªå†…éƒ¨æ„å»ºå™¨ç±»ï¼Œç”¨äºé…ç½®å®¢æˆ·ç«¯å®ä¾‹çš„å„é¡¹å‚æ•°å¹¶æœ€ç»ˆç”Ÿæˆå¯¹åº”çš„ <code>McpSyncClient</code> å’Œ <code>McpAsyncClient</code>ã€‚</p>
<p>Â Â Â å…¶ä¸­ï¼Œ<code>AsyncSpec</code> å’Œ <code>SyncSpec</code> çš„è®¾è®¡éå¸¸ç›¸ä¼¼ï¼Œéƒ½å°è£…äº†é…ç½®ä¿¡æ¯ï¼Œä¸”å®ƒä»¬å†…éƒ¨çš„æ–¹æ³•ï¼ˆå¦‚ <code>requestTimeout()</code>ã€<code>initializationTimeout()</code>ã€<code>capabilities()</code>ï¼‰éƒ½åªæ˜¯å¯¹æ„å»ºå™¨å†…æˆå‘˜å˜é‡çš„ç®€å•èµ‹å€¼ã€‚è€Œä¸åŒçš„æ˜¯ï¼Œå¼‚æ­¥æ¨¡å¼åœ¨å¤„ç†æœåŠ¡ç«¯çš„å˜æ›´é€šçŸ¥æ—¶ï¼Œæ˜¯åŸºäº Reactor çš„ <code>Mono</code> è¿›è¡Œå“åº”å¼è°ƒç”¨çš„ï¼Œè€ŒåŒæ­¥æ¨¡å¼åˆ™ä½¿ç”¨ä¼ ç»Ÿçš„ Consumer å›è°ƒæ–¹å¼ã€‚</p>
<p>Â Â Â æ ¸å¿ƒçš„å‚æ•°æè¿°å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>transport</code>ï¼šä¼ è¾“å±‚å®ç°å¯¹è±¡ã€‚</li>
<li><code>requestTimeout</code>ï¼šè¯·æ±‚è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ 20sã€‚</li>
<li><code>initializationTimeout</code>ï¼šåˆå§‹åŒ–è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ 20sã€‚</li>
<li><code>capabilities</code>ï¼šå®¢æˆ·ç«¯èƒ½åŠ›é…ç½®ï¼ŒåŒ…å«å®éªŒæ€§åŠŸèƒ½ã€æ ¹åŠŸèƒ½ã€é‡‡æ ·èƒ½åŠ›ç­‰é…ç½®ã€‚</li>
<li><code>clientInfo</code>ï¼šå®¢æˆ·ç«¯åŸºæœ¬ä¿¡æ¯ï¼ŒåŒ…å«å®¢æˆ·ç«¯åå­—å’Œç‰ˆæœ¬ã€‚</li>
<li><code>toolsChangeConsumers</code>ï¼šå·¥å…·å˜æ›´é€šçŸ¥çš„æ¶ˆè´¹è€…åˆ—è¡¨ï¼Œç”¨äºä¿å­˜å½“æœåŠ¡ç«¯å·¥å…·åˆ—è¡¨å˜åŒ–æ—¶è¦å¼‚æ­¥æ‰§è¡Œçš„å›è°ƒå‡½æ•°åˆ—è¡¨ã€‚</li>
</ul>
<p>Â Â Â æ ¸å¿ƒçš„æºç åŠæ³¨é‡Šå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">/**
 * åˆ›å»º MCP å®¢æˆ·ç«¯çš„å·¥å‚ç±»
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">McpClient</span> {

    <span class="hljs-comment">/**
     * åˆ›å»º MCP åŒæ­¥å®¢æˆ·ç«¯
     *
     * <span class="hljs-doctag">@param</span> transport ä¼ è¾“å±‚å¯¹è±¡
     * <span class="hljs-doctag">@return</span> åŒæ­¥å®¢æˆ·ç«¯æ„å»ºå™¨
     */</span>
    <span class="hljs-keyword">static</span> SyncSpec <span class="hljs-title function_">sync</span><span class="hljs-params">(McpClientTransport transport)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SyncSpec</span>(transport);
    }

    <span class="hljs-comment">/**
     * åˆ›å»º MCP å¼‚æ­¥å®¢æˆ·ç«¯
     *
     * <span class="hljs-doctag">@param</span> transport ä¼ è¾“å±‚å¯¹è±¡
     * <span class="hljs-doctag">@return</span> å¼‚æ­¥å®¢æˆ·ç«¯æ„å»ºå™¨
     */</span>
    <span class="hljs-keyword">static</span> AsyncSpec <span class="hljs-title function_">async</span><span class="hljs-params">(McpClientTransport transport)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AsyncSpec</span>(transport);
    }

    <span class="hljs-comment">/**
     * åŒæ­¥å®¢æˆ·ç«¯æ„å»ºå™¨
     */</span>
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">SyncSpec</span> {

        <span class="hljs-comment">// å®¢æˆ·ç«¯ä¼ è¾“å±‚å¯¹è±¡</span>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> McpClientTransport transport;

        <span class="hljs-comment">// è¯·æ±‚è¶…æ—¶æ—¶é—´</span>
        <span class="hljs-keyword">private</span> <span class="hljs-type">Duration</span> <span class="hljs-variable">requestTimeout</span> <span class="hljs-operator">=</span> Duration.ofSeconds(<span class="hljs-number">20</span>);

        <span class="hljs-comment">// åˆå§‹åŒ–è¶…æ—¶æ—¶é—´</span>
        <span class="hljs-keyword">private</span> <span class="hljs-type">Duration</span> <span class="hljs-variable">initializationTimeout</span> <span class="hljs-operator">=</span> Duration.ofSeconds(<span class="hljs-number">20</span>);

        <span class="hljs-comment">// å®¢æˆ·ç«¯èƒ½åŠ›é…ç½®</span>
        <span class="hljs-keyword">private</span> ClientCapabilities capabilities;

        <span class="hljs-comment">// å®¢æˆ·ç«¯å®ç°ä¿¡æ¯</span>
        <span class="hljs-keyword">private</span> <span class="hljs-type">Implementation</span> <span class="hljs-variable">clientInfo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Implementation</span>(<span class="hljs-string">"Java SDK MCP Client"</span>, <span class="hljs-string">"1.0.0"</span>);

        <span class="hljs-comment">// å·¥å…·å˜æ›´é€šçŸ¥çš„æ¶ˆè´¹è€…åˆ—è¡¨</span>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;Consumer&lt;List&lt;McpSchema.Tool&gt;&gt;&gt; toolsChangeConsumers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

        <span class="hljs-comment">// å…¶ä»–å±æ€§çœç•¥...</span>

        <span class="hljs-keyword">private</span> <span class="hljs-title function_">SyncSpec</span><span class="hljs-params">(McpClientTransport transport)</span> {
            Assert.notNull(transport, <span class="hljs-string">"Transport must not be null"</span>);
            <span class="hljs-built_in">this</span>.transport = transport;
        }

        <span class="hljs-comment">/**
         * è®¾ç½®è¯·æ±‚è¶…æ—¶æ—¶é—´
         */</span>
        <span class="hljs-keyword">public</span> SyncSpec <span class="hljs-title function_">requestTimeout</span><span class="hljs-params">(Duration requestTimeout)</span> {
            Assert.notNull(requestTimeout, <span class="hljs-string">"Request timeout must not be null"</span>);
            <span class="hljs-built_in">this</span>.requestTimeout = requestTimeout;
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
        }

        <span class="hljs-comment">/**
         * è®¾ç½®åˆå§‹åŒ–è¶…æ—¶æ—¶é—´
         */</span>
        <span class="hljs-keyword">public</span> SyncSpec <span class="hljs-title function_">initializationTimeout</span><span class="hljs-params">(Duration initializationTimeout)</span> {
            Assert.notNull(initializationTimeout, <span class="hljs-string">"Initialization timeout must not be null"</span>);
            <span class="hljs-built_in">this</span>.initializationTimeout = initializationTimeout;
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
        }

        <span class="hljs-comment">/**
         * è®¾ç½®å®¢æˆ·ç«¯èƒ½åŠ›é…ç½®
         */</span>
        <span class="hljs-keyword">public</span> SyncSpec <span class="hljs-title function_">capabilities</span><span class="hljs-params">(ClientCapabilities capabilities)</span> {
            Assert.notNull(capabilities, <span class="hljs-string">"Capabilities must not be null"</span>);
            <span class="hljs-built_in">this</span>.capabilities = capabilities;
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
        }

        <span class="hljs-comment">/**
         * è®¾ç½®å®¢æˆ·ç«¯å®ç°ä¿¡æ¯
         */</span>
        <span class="hljs-keyword">public</span> SyncSpec <span class="hljs-title function_">clientInfo</span><span class="hljs-params">(Implementation clientInfo)</span> {
            Assert.notNull(clientInfo, <span class="hljs-string">"Client info must not be null"</span>);
            <span class="hljs-built_in">this</span>.clientInfo = clientInfo;
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
        }

        <span class="hljs-comment">/**
         * è®¾ç½®å®¢æˆ·ç«¯å·¥å…·å˜æ›´é€šçŸ¥çš„æ¶ˆè´¹è€…åˆ—è¡¨
         */</span>
        <span class="hljs-keyword">public</span> SyncSpec <span class="hljs-title function_">toolsChangeConsumer</span><span class="hljs-params">(Consumer&lt;List&lt;McpSchema.Tool&gt;&gt; toolsChangeConsumer)</span> {
            Assert.notNull(toolsChangeConsumer, <span class="hljs-string">"Tools change consumer must not be null"</span>);
            <span class="hljs-built_in">this</span>.toolsChangeConsumers.add(toolsChangeConsumer);
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
        }

        <span class="hljs-comment">/**
         * æ„å»ºåŒæ­¥å®¢æˆ·ç«¯å®ä¾‹
         */</span>
        <span class="hljs-keyword">public</span> McpSyncClient <span class="hljs-title function_">build</span><span class="hljs-params">()</span> {
            <span class="hljs-comment">// ç”±äºã€ŒåŒæ­¥ã€å®¢æˆ·ç«¯ä¾èµ–äºã€Œå¼‚æ­¥ã€å®¢æˆ·ç«¯ï¼Œå› æ­¤è¿™é‡Œä¼šå…ˆåˆ›å»ºã€Œå¼‚æ­¥ã€å®¢æˆ·ç«¯ï¼Œå†å°†å…¶ä½œä¸ºã€ŒåŒæ­¥ã€å®¢æˆ·ç«¯çš„å±æ€§</span>
            McpClientFeatures.<span class="hljs-type">Sync</span> <span class="hljs-variable">syncFeatures</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpClientFeatures</span>.Sync(<span class="hljs-built_in">this</span>.clientInfo, <span class="hljs-built_in">this</span>.capabilities,
                    <span class="hljs-built_in">this</span>.roots, <span class="hljs-built_in">this</span>.toolsChangeConsumers, <span class="hljs-built_in">this</span>.resourcesChangeConsumers, <span class="hljs-built_in">this</span>.promptsChangeConsumers,
                    <span class="hljs-built_in">this</span>.loggingConsumers, <span class="hljs-built_in">this</span>.samplingHandler);
            McpClientFeatures.<span class="hljs-type">Async</span> <span class="hljs-variable">asyncFeatures</span> <span class="hljs-operator">=</span> McpClientFeatures.Async.fromSync(syncFeatures);

            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpSyncClient</span>(
                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpAsyncClient</span>(transport, <span class="hljs-built_in">this</span>.requestTimeout, <span class="hljs-built_in">this</span>.initializationTimeout, asyncFeatures));
        }

        <span class="hljs-comment">// å…¶ä»–æ–¹æ³•çœç•¥...</span>
    }

    <span class="hljs-comment">/**
     * å¼‚æ­¥å®¢æˆ·ç«¯æ„å»ºå™¨
     */</span>
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">AsyncSpec</span> {
        <span class="hljs-comment">// å¼‚æ­¥æ„å»ºå™¨çš„å±æ€§å’Œæ–¹æ³•ä¹Ÿæ˜¯ç±»ä¼¼çš„</span>

        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> McpClientTransport transport;

        <span class="hljs-keyword">private</span> <span class="hljs-type">Duration</span> <span class="hljs-variable">requestTimeout</span> <span class="hljs-operator">=</span> Duration.ofSeconds(<span class="hljs-number">20</span>);

        <span class="hljs-keyword">private</span> <span class="hljs-type">Duration</span> <span class="hljs-variable">initializationTimeout</span> <span class="hljs-operator">=</span> Duration.ofSeconds(<span class="hljs-number">20</span>);

        <span class="hljs-keyword">private</span> ClientCapabilities capabilities;

        <span class="hljs-keyword">private</span> <span class="hljs-type">Implementation</span> <span class="hljs-variable">clientInfo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Implementation</span>(<span class="hljs-string">"Spring AI MCP Client"</span>, <span class="hljs-string">"0.3.1"</span>);


        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;Function&lt;List&lt;McpSchema.Tool&gt;, Mono&lt;Void&gt;&gt;&gt; toolsChangeConsumers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

        <span class="hljs-comment">// å…¶ä»–å±æ€§çœç•¥...</span>

        <span class="hljs-keyword">private</span> <span class="hljs-title function_">AsyncSpec</span><span class="hljs-params">(McpClientTransport transport)</span> {
            Assert.notNull(transport, <span class="hljs-string">"Transport must not be null"</span>);
            <span class="hljs-built_in">this</span>.transport = transport;
        }

        <span class="hljs-keyword">public</span> AsyncSpec <span class="hljs-title function_">requestTimeout</span><span class="hljs-params">(Duration requestTimeout)</span> {
            Assert.notNull(requestTimeout, <span class="hljs-string">"Request timeout must not be null"</span>);
            <span class="hljs-built_in">this</span>.requestTimeout = requestTimeout;
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
        }

        <span class="hljs-keyword">public</span> AsyncSpec <span class="hljs-title function_">initializationTimeout</span><span class="hljs-params">(Duration initializationTimeout)</span> {
            Assert.notNull(initializationTimeout, <span class="hljs-string">"Initialization timeout must not be null"</span>);
            <span class="hljs-built_in">this</span>.initializationTimeout = initializationTimeout;
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
        }

        <span class="hljs-keyword">public</span> AsyncSpec <span class="hljs-title function_">capabilities</span><span class="hljs-params">(ClientCapabilities capabilities)</span> {
            Assert.notNull(capabilities, <span class="hljs-string">"Capabilities must not be null"</span>);
            <span class="hljs-built_in">this</span>.capabilities = capabilities;
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
        }

        <span class="hljs-keyword">public</span> AsyncSpec <span class="hljs-title function_">clientInfo</span><span class="hljs-params">(Implementation clientInfo)</span> {
            Assert.notNull(clientInfo, <span class="hljs-string">"Client info must not be null"</span>);
            <span class="hljs-built_in">this</span>.clientInfo = clientInfo;
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
        }

        <span class="hljs-keyword">public</span> AsyncSpec <span class="hljs-title function_">toolsChangeConsumer</span><span class="hljs-params">(Function&lt;List&lt;McpSchema.Tool&gt;, Mono&lt;Void&gt;&gt; toolsChangeConsumer)</span> {
            Assert.notNull(toolsChangeConsumer, <span class="hljs-string">"Tools change consumer must not be null"</span>);
            <span class="hljs-built_in">this</span>.toolsChangeConsumers.add(toolsChangeConsumer);
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
        }

        <span class="hljs-keyword">public</span> McpAsyncClient <span class="hljs-title function_">build</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpAsyncClient</span>(<span class="hljs-built_in">this</span>.transport, <span class="hljs-built_in">this</span>.requestTimeout, <span class="hljs-built_in">this</span>.initializationTimeout,
                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpClientFeatures</span>.Async(<span class="hljs-built_in">this</span>.clientInfo, <span class="hljs-built_in">this</span>.capabilities, <span class="hljs-built_in">this</span>.roots,
                            <span class="hljs-built_in">this</span>.toolsChangeConsumers, <span class="hljs-built_in">this</span>.resourcesChangeConsumers, <span class="hljs-built_in">this</span>.promptsChangeConsumers,
                            <span class="hljs-built_in">this</span>.loggingConsumers, <span class="hljs-built_in">this</span>.samplingHandler));
        }

        <span class="hljs-comment">// å…¶ä»–æ–¹æ³•çœç•¥...</span>
    }
}
</code></pre>
<h3 data-id="heading-2">3.1.2 è¿è¡Œå±‚</h3>
<p>Â Â Â MCP å®¢æˆ·ç«¯è¿è¡Œå±‚æ¶‰åŠåˆ°çš„ç±»åŒ…æ‹¬ <strong>McpSyncClient</strong>ã€<strong>McpAsyncClient</strong>ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/256bdc0a60404133a4f7a8dff0a6e2c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP55KQ5Lmx5pKe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763392204&amp;x-signature=Ny%2BnHRc0R11dEYQs1w56y5Cp9Ec%3D" alt="" loading="lazy"/></p>
<p>Â Â Â åœ¨è¿è¡Œå±‚ä¸­ï¼Œ<code>McpSyncClient</code> å’Œ <code>McpAsyncClient</code> åˆ†åˆ«æ˜¯ MCP åŒæ­¥å®¢æˆ·ç«¯å’Œå¼‚æ­¥å®¢æˆ·ç«¯çš„æ‰§è¡Œæ ¸å¿ƒï¼Œå®ƒä»¬å…±åŒæ‰¿æ‹…äº†ä¸æœåŠ¡ç«¯äº¤äº’çš„å®é™…é€»è¾‘ã€‚ä»ç±»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼ŒåŒæ­¥å®¢æˆ·ç«¯å¹¶æ²¡æœ‰ç‹¬ç«‹å®ç°å®é™…çš„ä¸šåŠ¡é€»è¾‘ï¼Œè€Œæ˜¯é€šè¿‡ç»„åˆçš„æ–¹å¼æŒæœ‰ä¸€ä¸ªå¼‚æ­¥å®¢æˆ·ç«¯å®ä¾‹ï¼Œå¹¶<strong>å°†æ‰€æœ‰æ ¸å¿ƒæ–¹æ³•è°ƒç”¨å§”æ‰˜ç»™å®ƒæ‰§è¡Œ</strong>ã€‚åœ¨å…¶æºç ä¸­ï¼Œ<code>initialize()</code>ã€<code>ping()</code>ã€<code>callTool()</code> ç­‰æ–¹æ³•éƒ½æ˜¯é€šè¿‡è°ƒç”¨å¼‚æ­¥å®¢æˆ·ç«¯å¯¹åº”çš„æ–¹æ³•ï¼Œå†é€šè¿‡é˜»å¡çš„æ–¹å¼è·å–ç»“æœçš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>åŒæ­¥å®¢æˆ·ç«¯åªæ˜¯å¼‚æ­¥å®¢æˆ·ç«¯çš„ä¸€å±‚åŒ…è£…</strong>ã€‚</p>
<p>Â Â Â å¼‚æ­¥å®¢æˆ·ç«¯æ˜¯æ•´ä¸ªè¿è¡Œå±‚çš„é€»è¾‘æ ¸å¿ƒï¼Œå†…éƒ¨å°è£…äº† MCP ä¼šè¯ã€èƒ½åŠ›é…ç½®ã€ä¼ è¾“å±‚ç­‰å¤šä¸ªæ ¸å¿ƒå¯¹è±¡ï¼š</p>
<ul>
<li><code>initialized</code>ï¼šè¡¨ç¤ºæ˜¯å¦åˆå§‹åŒ–å®Œæˆã€‚</li>
<li><code>mcpSession</code>ï¼šå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯é€šä¿¡çš„ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œå°è£…äº†æ¶ˆæ¯å‘é€ã€ä¼ è¾“é€šé“å…³é—­ç­‰åº•å±‚é€»è¾‘ã€‚</li>
<li><code>clientCapabilities/serverCapabilities</code>ï¼šåˆ†åˆ«è¡¨ç¤ºå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„åŠŸèƒ½èƒ½åŠ›ï¼Œå¦‚å®¢æˆ·ç«¯æ˜¯å¦æ”¯æŒé‡‡æ ·ï¼ŒæœåŠ¡ç«¯æ˜¯å¦æ”¯æŒå·¥å…·è°ƒç”¨ã€Prompt ç®¡ç†ã€èµ„æºåŒæ­¥ç­‰ã€‚</li>
<li><code>clientInfo/serverInfo</code>ï¼šåˆ†åˆ«è¡¨ç¤ºå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„åŸºæœ¬ä¿¡æ¯ï¼Œå¦‚åç§°å’Œç‰ˆæœ¬ã€‚</li>
<li><code>transport</code>ï¼šåº•å±‚ä¼ è¾“é€šé“ï¼ˆå¦‚ Stdioã€SSE ç­‰ï¼‰ï¼Œå±è”½äº†å…·ä½“çš„åè®®ç»†èŠ‚ã€‚</li>
</ul>
<p>Â Â Â ä¸»è¦æ–¹æ³•åŒ…æ‹¬ï¼š</p>
<ul>
<li><code>initialize()</code>ï¼šè´Ÿè´£å®Œæˆ MCP å®¢æˆ·ç«¯çš„åˆå§‹åŒ–è¿‡ç¨‹ï¼Œå»ºè®®é€šä¿¡ä¼šè¯ã€åŒæ­¥èƒ½åŠ›ä¿¡æ¯ã€‚</li>
<li><code>ping()</code>ï¼šå‘é€ä¸€ä¸ªå¿ƒè·³è¯·æ±‚ä»¥éªŒè¯è¿æ¥çŠ¶æ€ï¼Œç”¨äºæ£€æµ‹æœåŠ¡ç«¯æ˜¯å¦ä»å¤„äºå¯ç”¨çŠ¶æ€ã€‚</li>
<li><code>callTool()</code>ï¼šè°ƒç”¨æœåŠ¡ç«¯æ³¨å†Œçš„æŸä¸ªå·¥å…·ã€‚</li>
<li><code>listTools()</code>ï¼šå‘æœåŠ¡ç«¯è¯·æ±‚æ¥è·å–å¯ç”¨çš„å·¥å…·åˆ—è¡¨ã€‚</li>
<li><code>close()</code>ï¼šç«‹å³å…³é—­å®¢æˆ·ç«¯è¿æ¥å’Œä¼šè¯èµ„æºã€‚</li>
<li><code>closeGracefully()</code>ï¼šæ‰§è¡Œä¼˜é›…å…³é—­æ“ä½œï¼Œç¡®ä¿æœªå®Œæˆçš„è¯·æ±‚æ­£å¸¸ç»“æŸã€‚</li>
</ul>
<p>Â Â Â æ ¸å¿ƒçš„æºç åŠæ³¨é‡Šå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">/**
 * MCP å¼‚æ­¥å®¢æˆ·ç«¯
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">McpAsyncClient</span> {

    <span class="hljs-comment">// æ˜¯å¦åˆå§‹åŒ–å®Œæˆ</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">AtomicBoolean</span> <span class="hljs-variable">initialized</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicBoolean</span>(<span class="hljs-literal">false</span>);

    <span class="hljs-comment">// ä¼šè¯å±‚å¯¹è±¡</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> McpClientSession mcpSession;

    <span class="hljs-comment">// å®¢æˆ·ç«¯èƒ½åŠ›é…ç½®</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> McpSchema.ClientCapabilities clientCapabilities;

    <span class="hljs-comment">// æœåŠ¡ç«¯èƒ½åŠ›é…ç½®</span>
    <span class="hljs-keyword">private</span> McpSchema.ServerCapabilities serverCapabilities;

    <span class="hljs-comment">// ä¼ è¾“å±‚å¯¹è±¡</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> McpTransport transport;

    <span class="hljs-comment">// å…¶ä»–å±æ€§çœç•¥...</span>

    <span class="hljs-comment">/**
     * MCP å¼‚æ­¥å®¢æˆ·ç«¯æ„é€ æ–¹æ³•
     *
     * <span class="hljs-doctag">@param</span> transport ä¼ è¾“å±‚å¯¹è±¡
     * <span class="hljs-doctag">@param</span> requestTimeout ä¼šè¯ä¸­è¯·æ±‚-å“åº”çš„è¶…æ—¶æ—¶é—´
     * <span class="hljs-doctag">@param</span> initializationTimeout å®¢æˆ·ç«¯-æœåŠ¡å™¨ç­‰å¾…çš„æœ€å¤§è¶…æ—¶æ—¶é—´
     * <span class="hljs-doctag">@param</span> features MCP å®¢æˆ·ç«¯æ”¯æŒçš„ç‰¹æ€§
     */</span>
    McpAsyncClient(McpClientTransport transport, Duration requestTimeout, Duration initializationTimeout,
                   McpClientFeatures.Async features) {

        Assert.notNull(transport, <span class="hljs-string">"Transport must not be null"</span>);
        Assert.notNull(requestTimeout, <span class="hljs-string">"Request timeout must not be null"</span>);
        Assert.notNull(initializationTimeout, <span class="hljs-string">"Initialization timeout must not be null"</span>);

        <span class="hljs-built_in">this</span>.clientInfo = features.clientInfo();
        <span class="hljs-built_in">this</span>.clientCapabilities = features.clientCapabilities();
        <span class="hljs-built_in">this</span>.transport = transport;
        <span class="hljs-built_in">this</span>.roots = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;(features.roots());
        <span class="hljs-built_in">this</span>.initializationTimeout = initializationTimeout;

        <span class="hljs-comment">// è¯·æ±‚å¤„ç†å™¨ key: æ–¹æ³•åï¼Œvalue: å¤„ç†å™¨</span>
        Map&lt;String, RequestHandler&lt;?&gt;&gt; requestHandlers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();

        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.clientCapabilities.roots() != <span class="hljs-literal">null</span>) {
            requestHandlers.put(McpSchema.METHOD_ROOTS_LIST, rootsListRequestHandler());
        }

        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.clientCapabilities.sampling() != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">if</span> (features.samplingHandler() == <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpError</span>(<span class="hljs-string">"Sampling handler must not be null when client capabilities include sampling"</span>);
            }
            <span class="hljs-built_in">this</span>.samplingHandler = features.samplingHandler();
            requestHandlers.put(McpSchema.METHOD_SAMPLING_CREATE_MESSAGE, samplingCreateMessageHandler());
        }

        <span class="hljs-comment">// é€šçŸ¥å¤„ç†å™¨ï¼Œkey: æ–¹æ³•åï¼Œvalue: å¤„ç†å™¨</span>
        Map&lt;String, NotificationHandler&gt; notificationHandlers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();

        <span class="hljs-comment">// Tools Change Notification</span>
        <span class="hljs-comment">// å·¥å…·å˜æ›´é€šçŸ¥æ¶ˆè´¹è€…</span>
        List&lt;Function&lt;List&lt;McpSchema.Tool&gt;, Mono&lt;Void&gt;&gt;&gt; toolsChangeConsumersFinal = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        <span class="hljs-comment">// æ·»åŠ é»˜è®¤çš„è°ƒè¯•æ—¥å¿—æ¶ˆè´¹è€…</span>
        toolsChangeConsumersFinal
                .add((notification) -&gt; Mono.fromRunnable(() -&gt; logger.debug(<span class="hljs-string">"Tools changed: {}"</span>, notification)));
        <span class="hljs-comment">// æ·»åŠ ç”¨æˆ·è‡ªå®šä¹‰çš„æ¶ˆè´¹è€…</span>
        <span class="hljs-keyword">if</span> (!Utils.isEmpty(features.toolsChangeConsumers())) {
            toolsChangeConsumersFinal.addAll(features.toolsChangeConsumers());
        }
        <span class="hljs-comment">// æ³¨å†Œå·¥å…·å˜æ›´é€šçŸ¥å¤„ç†å™¨</span>
        notificationHandlers.put(McpSchema.METHOD_NOTIFICATION_TOOLS_LIST_CHANGED,
                asyncToolsChangeNotificationHandler(toolsChangeConsumersFinal));

        <span class="hljs-comment">// èµ„æºå˜æ›´é€šçŸ¥æ¶ˆè´¹è€…</span>
        List&lt;Function&lt;List&lt;McpSchema.Resource&gt;, Mono&lt;Void&gt;&gt;&gt; resourcesChangeConsumersFinal = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        resourcesChangeConsumersFinal
                .add((notification) -&gt; Mono.fromRunnable(() -&gt; logger.debug(<span class="hljs-string">"Resources changed: {}"</span>, notification)));
        <span class="hljs-keyword">if</span> (!Utils.isEmpty(features.resourcesChangeConsumers())) {
            resourcesChangeConsumersFinal.addAll(features.resourcesChangeConsumers());
        }
        <span class="hljs-comment">// æ³¨å†Œèµ„æºå˜æ›´é€šçŸ¥å¤„ç†å™¨</span>
        notificationHandlers.put(McpSchema.METHOD_NOTIFICATION_RESOURCES_LIST_CHANGED,
                asyncResourcesChangeNotificationHandler(resourcesChangeConsumersFinal));

        <span class="hljs-comment">// æç¤ºè¯å˜æ›´é€šçŸ¥æ¶ˆè´¹è€…</span>
        List&lt;Function&lt;List&lt;McpSchema.Prompt&gt;, Mono&lt;Void&gt;&gt;&gt; promptsChangeConsumersFinal = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        promptsChangeConsumersFinal
                .add((notification) -&gt; Mono.fromRunnable(() -&gt; logger.debug(<span class="hljs-string">"Prompts changed: {}"</span>, notification)));
        <span class="hljs-keyword">if</span> (!Utils.isEmpty(features.promptsChangeConsumers())) {
            promptsChangeConsumersFinal.addAll(features.promptsChangeConsumers());
        }
        <span class="hljs-comment">// æ³¨å†Œæç¤ºè¯å˜æ›´é€šçŸ¥å¤„ç†å™¨</span>
        notificationHandlers.put(McpSchema.METHOD_NOTIFICATION_PROMPTS_LIST_CHANGED,
                asyncPromptsChangeNotificationHandler(promptsChangeConsumersFinal));

        <span class="hljs-comment">// æ—¥å¿—è®°å½•å˜æ›´é€šçŸ¥æ¶ˆè´¹è€…</span>
        List&lt;Function&lt;LoggingMessageNotification, Mono&lt;Void&gt;&gt;&gt; loggingConsumersFinal = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        loggingConsumersFinal.add((notification) -&gt; Mono.fromRunnable(() -&gt; logger.debug(<span class="hljs-string">"Logging: {}"</span>, notification)));
        <span class="hljs-keyword">if</span> (!Utils.isEmpty(features.loggingConsumers())) {
            loggingConsumersFinal.addAll(features.loggingConsumers());
        }
        <span class="hljs-comment">// æ³¨å†Œæ—¥å¿—è®°å½•å˜æ›´é€šçŸ¥å¤„ç†å™¨</span>
        notificationHandlers.put(McpSchema.METHOD_NOTIFICATION_MESSAGE,
                asyncLoggingNotificationHandler(loggingConsumersFinal));

        <span class="hljs-comment">// åˆ›å»ºå®¢æˆ·ç«¯ä¼šè¯</span>
        <span class="hljs-built_in">this</span>.mcpSession = <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpClientSession</span>(requestTimeout, transport, requestHandlers, notificationHandlers);
    }

    <span class="hljs-comment">/**
     * ç«‹åˆ»å…³é—­å®¢æˆ·ç«¯è¿æ¥
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">this</span>.mcpSession.close();
    }

    <span class="hljs-comment">/**
     * ä¼˜é›…å…³é—­å®¢æˆ·ç«¯è¿æ¥
     *
     * <span class="hljs-doctag">@return</span> Monoï¼Œå…³é—­åå®Œæˆ
     */</span>
    <span class="hljs-keyword">public</span> Mono&lt;Void&gt; <span class="hljs-title function_">closeGracefully</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.mcpSession.closeGracefully();
    }

    <span class="hljs-comment">/**
     * åˆå§‹åŒ–é˜¶æ®µ
     *
     * <span class="hljs-doctag">@return</span> Monoï¼Œåˆå§‹åŒ–åå®Œæˆ
     */</span>
    <span class="hljs-keyword">public</span> Mono&lt;McpSchema.InitializeResult&gt; initialize() {

        <span class="hljs-type">String</span> <span class="hljs-variable">latestVersion</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.protocolVersions.get(<span class="hljs-built_in">this</span>.protocolVersions.size() - <span class="hljs-number">1</span>);
        <span class="hljs-comment">// æ„å»ºåˆå§‹åŒ–è¯·æ±‚</span>
        McpSchema.<span class="hljs-type">InitializeRequest</span> <span class="hljs-variable">initializeRequest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpSchema</span>.InitializeRequest(<span class="hljs-comment">// @formatter:off</span>
                latestVersion,
                <span class="hljs-built_in">this</span>.clientCapabilities,
                <span class="hljs-built_in">this</span>.clientInfo); <span class="hljs-comment">// @formatter:on</span>

        <span class="hljs-comment">// å‘æœåŠ¡ç«¯å‘é€åˆå§‹åŒ–è¯·æ±‚</span>
        Mono&lt;McpSchema.InitializeResult&gt; result = <span class="hljs-built_in">this</span>.mcpSession.sendRequest(McpSchema.METHOD_INITIALIZE,
                initializeRequest, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeReference</span>&lt;McpSchema.InitializeResult&gt;() {
                });

        <span class="hljs-keyword">return</span> result.flatMap(initializeResult -&gt; {
            <span class="hljs-comment">// å­˜æ”¾æœåŠ¡ç«¯é…ç½®ä¿¡æ¯</span>
            <span class="hljs-built_in">this</span>.serverCapabilities = initializeResult.capabilities();
            <span class="hljs-built_in">this</span>.serverInstructions = initializeResult.instructions();
            <span class="hljs-built_in">this</span>.serverInfo = initializeResult.serverInfo();

            logger.info(<span class="hljs-string">"Server response with Protocol: {}, Capabilities: {}, Info: {} and Instructions {}"</span>,
                    initializeResult.protocolVersion(), initializeResult.capabilities(), initializeResult.serverInfo(),
                    initializeResult.instructions());

            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>.protocolVersions.contains(initializeResult.protocolVersion())) {
                <span class="hljs-comment">// å®¢æˆ·ç«¯ä¸æ”¯æŒæœåŠ¡ç«¯åè®®ç‰ˆæœ¬ï¼Œè¿”å›é”™è¯¯ä¿¡æ¯</span>
                <span class="hljs-keyword">return</span> Mono.error(<span class="hljs-keyword">new</span> <span class="hljs-title class_">McpError</span>(
                        <span class="hljs-string">"Unsupported protocol version from the server: "</span> + initializeResult.protocolVersion()));
            }

            <span class="hljs-comment">// å‘æœåŠ¡ç«¯å‘é€é€šçŸ¥ï¼Œå‘ŠçŸ¥åˆå§‹åŒ–å®Œæˆ</span>
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.mcpSession.sendNotification(McpSchema.METHOD_NOTIFICATION_INITIALIZED, <span class="hljs-literal">null</span>).doOnSuccess(v -&gt; {
                <span class="hljs-comment">// æ ‡è®°åˆå§‹åŒ–å®Œæˆ</span>
                <span class="hljs-built_in">this</span>.initialized.set(<span class="hljs-literal">true</span>);
                <span class="hljs-built_in">this</span>.initializedSink.tryEmitValue(initializeResult);
            }).thenReturn(initializeResult);
        });
    }

    <span class="hljs-comment">/**
     * åœ¨æ‰§è¡Œæ“ä½œä¹‹å‰ï¼Œç¡®ä¿å®¢æˆ·ç«¯å·²ç»åˆå§‹åŒ–å®Œæˆ
     *
     * <span class="hljs-doctag">@param</span> actionName æ‰§è¡Œçš„æ“ä½œå
     * <span class="hljs-doctag">@param</span> operation å…·ä½“çš„æ“ä½œ
     * <span class="hljs-doctag">@return</span> Monoï¼Œæ“ä½œæ‰§è¡Œåå®Œæˆ
     */</span>
    <span class="hljs-keyword">private</span> &lt;T&gt; Mono&lt;T&gt; <span class="hljs-title function_">withInitializationCheck</span><span class="hljs-params">(String actionName,
                                                Function&lt;McpSchema.InitializeResult, Mono&lt;T&gt;&gt; operation)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.initializedSink.asMono()
                .timeout(<span class="hljs-built_in">this</span>.initializationTimeout)
                .onErrorResume(TimeoutException.class,
                        ex -&gt; Mono.error(<span class="hljs-keyword">new</span> <span class="hljs-title class_">McpError</span>(<span class="hljs-string">"Client must be initialized before "</span> + actionName)))
                .flatMap(operation);
    }

    <span class="hljs-comment">/**
     * å‘æœåŠ¡ç«¯å‘é€ ping
     *
     * <span class="hljs-doctag">@return</span> Monoï¼ŒæœåŠ¡å™¨å“åº”åå®Œæˆ
     */</span>
    <span class="hljs-keyword">public</span> Mono&lt;Object&gt; <span class="hljs-title function_">ping</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.withInitializationCheck(<span class="hljs-string">"pinging the server"</span>, initializedResult -&gt; <span class="hljs-built_in">this</span>.mcpSession
                .sendRequest(McpSchema.METHOD_PING, <span class="hljs-literal">null</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeReference</span>&lt;Object&gt;() {
                }));
    }

    <span class="hljs-comment">/**
     * å‘æœåŠ¡ç«¯è°ƒç”¨æŒ‡å®šçš„å·¥å…·
     *
     * <span class="hljs-doctag">@param</span> callToolRequest è¯·æ±‚ï¼ŒåŒ…æ‹¬å·¥å…·åã€å‚æ•°
     * <span class="hljs-doctag">@return</span> Monoï¼ŒæœåŠ¡ç«¯å“åº”åå®Œæˆ
     */</span>
    <span class="hljs-keyword">public</span> Mono&lt;McpSchema.CallToolResult&gt; callTool(McpSchema.CallToolRequest callToolRequest) {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.withInitializationCheck(<span class="hljs-string">"calling tools"</span>, initializedResult -&gt; {
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.serverCapabilities.tools() == <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">return</span> Mono.error(<span class="hljs-keyword">new</span> <span class="hljs-title class_">McpError</span>(<span class="hljs-string">"Server does not provide tools capability"</span>));
            }
            <span class="hljs-comment">// å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚è°ƒç”¨å·¥å…·</span>
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.mcpSession.sendRequest(McpSchema.METHOD_TOOLS_CALL, callToolRequest, CALL_TOOL_RESULT_TYPE_REF);
        });
    }

    <span class="hljs-comment">/**
     * æ£€ç´¢æœåŠ¡ç«¯æä¾›çš„æ‰€æœ‰å·¥å…·åˆ—è¡¨
     *
     * <span class="hljs-doctag">@return</span> Monoï¼ŒæœåŠ¡ç«¯å“åº”åå®Œæˆ
     */</span>
    <span class="hljs-keyword">public</span> Mono&lt;McpSchema.ListToolsResult&gt; listTools() {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.listTools(<span class="hljs-literal">null</span>);
    }

    <span class="hljs-comment">/**
     * æ£€ç´¢æœåŠ¡ç«¯æä¾›çš„æ‰€æœ‰å·¥å…·åˆ—è¡¨
     *
     * <span class="hljs-doctag">@param</span> cursor åˆ†é¡µæ¸¸æ ‡ï¼ˆå¯é€‰ï¼‰
     * <span class="hljs-doctag">@return</span> Monoï¼ŒæœåŠ¡ç«¯å“åº”åå®Œæˆ
     */</span>
    <span class="hljs-keyword">public</span> Mono&lt;McpSchema.ListToolsResult&gt; listTools(String cursor) {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.withInitializationCheck(<span class="hljs-string">"listing tools"</span>, initializedResult -&gt; {
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.serverCapabilities.tools() == <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">return</span> Mono.error(<span class="hljs-keyword">new</span> <span class="hljs-title class_">McpError</span>(<span class="hljs-string">"Server does not provide tools capability"</span>));
            }
            <span class="hljs-comment">// å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚è·å–å·¥å…·åˆ—è¡¨</span>
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.mcpSession.sendRequest(McpSchema.METHOD_TOOLS_LIST, <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpSchema</span>.PaginatedRequest(cursor),
                    LIST_TOOLS_RESULT_TYPE_REF);
        });
    }

    <span class="hljs-comment">/**
     * æ„å»ºå·¥å…·å˜æ›´é€šçŸ¥å¤„ç†å™¨
     * <span class="hljs-doctag">@param</span> toolsChangeConsumers æ¶ˆè´¹è€…
     * <span class="hljs-doctag">@return</span> å¤„ç†å™¨
     */</span>
    <span class="hljs-keyword">private</span> NotificationHandler <span class="hljs-title function_">asyncToolsChangeNotificationHandler</span><span class="hljs-params">(
            List&lt;Function&lt;List&lt;McpSchema.Tool&gt;, Mono&lt;Void&gt;&gt;&gt; toolsChangeConsumers)</span> {
        <span class="hljs-keyword">return</span> params -&gt; <span class="hljs-built_in">this</span>.listTools()
                <span class="hljs-comment">// å°†å·¥å…·å¹¿æ’­ç»™æ‰€æœ‰æ¶ˆè´¹è€…ï¼Œå¹¶æ‰§è¡Œæ¯ä¸ªæ¶ˆè´¹è€…çš„é€»è¾‘</span>
                .flatMap(listToolsResult -&gt; Flux.fromIterable(toolsChangeConsumers)
                        .flatMap(consumer -&gt; consumer.apply(listToolsResult.tools()))
                        .onErrorResume(error -&gt; {
                            logger.error(<span class="hljs-string">"Error handling tools list change notification"</span>, error);
                            <span class="hljs-keyword">return</span> Mono.empty();
                        })
                        .then());
    }

    <span class="hljs-comment">// å…¶ä»–æ–¹æ³•çœç•¥...</span>
}
</code></pre>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">/**
 * MCP åŒæ­¥å®¢æˆ·ç«¯ï¼Œå°è£…äº† MCPAsyncClient æ¥æä¾›é˜»å¡æ“ä½œçš„ API
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">McpSyncClient</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AutoCloseable</span> {

    <span class="hljs-comment">// ä»£ç†ï¼ŒMCP å¼‚æ­¥å®¢æˆ·ç«¯</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> McpAsyncClient delegate;

    <span class="hljs-comment">/**
     * MCP åŒæ­¥å®¢æˆ·ç«¯æ„é€ æ–¹æ³•
     *
     * <span class="hljs-doctag">@param</span> delegate ä»£ç†ï¼Œå®é™…ä¸º MCP å¼‚æ­¥å®¢æˆ·ç«¯
     */</span>
    McpSyncClient(McpAsyncClient delegate) {
        Assert.notNull(delegate, <span class="hljs-string">"The delegate can not be null"</span>);
        <span class="hljs-built_in">this</span>.delegate = delegate;
    }

    <span class="hljs-comment">// æ–¹æ³•ä¸å¼‚æ­¥å®¢æˆ·ç«¯ç±»ä¼¼ï¼Œåªæ˜¯å†…éƒ¨é€»è¾‘éƒ½äº¤ç”±å¼‚æ­¥å®¢æˆ·ç«¯æ¥å®Œæˆï¼Œä¸”ä¸ºé˜»å¡è¿‡ç¨‹</span>

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">this</span>.delegate.close();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">closeGracefully</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-built_in">this</span>.delegate.closeGracefully().block(Duration.ofMillis(DEFAULT_CLOSE_TIMEOUT_MS));
        }
        <span class="hljs-keyword">catch</span> (RuntimeException e) {
            logger.warn(<span class="hljs-string">"Client didn't close within timeout of {} ms."</span>, DEFAULT_CLOSE_TIMEOUT_MS, e);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-keyword">public</span> McpSchema.InitializeResult <span class="hljs-title function_">initialize</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.delegate.initialize().block();
    }

    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">ping</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.delegate.ping().block();
    }

    <span class="hljs-keyword">public</span> McpSchema.CallToolResult <span class="hljs-title function_">callTool</span><span class="hljs-params">(McpSchema.CallToolRequest callToolRequest)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.delegate.callTool(callToolRequest).block();
    }

    <span class="hljs-keyword">public</span> McpSchema.ListToolsResult <span class="hljs-title function_">listTools</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.delegate.listTools().block();
    }
}
</code></pre>
<h3 data-id="heading-3">3.1.3 ä¼šè¯å±‚</h3>
<p>Â Â Â MCP å®¢æˆ·ç«¯ä¼šè¯å±‚æ¶‰åŠåˆ°çš„ç±»åŒ…æ‹¬ <strong>McpSession</strong>ã€<strong>McpClientSession</strong>ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/80618fc4fe1b4d33b884b4ccebdaf220~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP55KQ5Lmx5pKe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763392204&amp;x-signature=3ss2nGd1pNwDOIUGadEJSx1HpNQ%3D" alt="" loading="lazy"/></p>
<p>Â Â Â ä¼šè¯å±‚æ˜¯ MCP æ¶æ„ä¸­è´Ÿè´£æ¶ˆæ¯æ”¶å‘å’Œäº‹ä»¶å¤„ç†çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œå®ƒå°†å®¢æˆ·ç«¯ä¸åº•å±‚ä¼ è¾“é€šé“è§£è€¦ï¼Œä½¿ä¸Šå±‚é€»è¾‘æ— éœ€å…³å¿ƒå…·ä½“é€šä¿¡ç»†èŠ‚ã€‚å…¶é€šè¿‡ <code>McpSession</code> æ¥å£å®šä¹‰ç»Ÿä¸€æ“ä½œè§„èŒƒï¼Œå¹¶åœ¨ <code>McpClientSession</code> æä¾›äº†å…·ä½“å®ç°ã€‚å…¶æ ¸å¿ƒæ–¹æ³•åŒ…æ‹¬ï¼š</p>
<ul>
<li><code>sendRequest()</code>ï¼šå‘æœåŠ¡ç«¯å‘é€è¯·æ±‚æ¶ˆæ¯å¹¶ç­‰å¾…å“åº”ï¼Œè¿”å› Mono è¡¨ç¤ºæ”¯æŒå¼‚æ­¥å¤„ç†ã€‚</li>
<li><code>sendNotification()</code>ï¼šå‘æœåŠ¡ç«¯å‘é€æ— å“åº”çš„é€šçŸ¥æ¶ˆæ¯ï¼Œè¿”å› Mono è¡¨ç¤ºæ”¯æŒå¼‚æ­¥å¤„ç†ã€‚</li>
<li><code>close()</code>ï¼šç«‹å³å…³é—­å®¢æˆ·ç«¯è¿æ¥å’Œä¼šè¯èµ„æºã€‚</li>
<li><code>closeGracefully()</code>ï¼šæ‰§è¡Œä¼˜é›…å…³é—­æ“ä½œï¼Œç¡®ä¿æœªå®Œæˆçš„è¯·æ±‚æ­£å¸¸ç»“æŸï¼Œè¿”å› Mono è¡¨ç¤ºæ”¯æŒå¼‚æ­¥å¤„ç†ã€‚</li>
</ul>
<p>Â Â Â McpClientSession å®ç°äº†ä¸Šè¿°çš„æ–¹æ³•ï¼Œå…¶å†…éƒ¨æ ¸å¿ƒçš„æˆå‘˜å˜é‡åŒ…æ‹¬ï¼š</p>
<ul>
<li><code>requestTimeout</code>ï¼šè¯·æ±‚è¶…æ—¶æ—¶é—´ï¼Œç”¨äºæ§åˆ¶è¯·æ±‚ç­‰å¾…æ—¶é•¿ï¼Œé¿å…é•¿æ—¶é—´é˜»å¡ã€‚</li>
<li><code>transport</code>ï¼šä¼ è¾“å±‚å¯¹è±¡ï¼Œå±è”½äº†å®é™…çš„ä¼ è¾“åè®®å®ç°ã€‚</li>
<li><code>pendingResponses</code>ï¼šå¹¶å‘å“ˆå¸Œè¡¨ï¼Œä¿å­˜æ‰€æœ‰å¾…å¤„ç†çš„è¯·æ±‚å“åº”ï¼Œé€šè¿‡ MonoSink ä¸å¼‚æ­¥æµç»‘å®šï¼Œå®ç°è¯·æ±‚-å“åº”çš„å¼‚æ­¥åŒ¹é…ã€‚</li>
<li><code>requestHandlers/notification</code>ï¼šåˆ†åˆ«è¡¨ç¤ºè¯·æ±‚å¤„ç†å™¨å’Œé€šçŸ¥å¤„ç†å™¨ï¼Œç”¨äºåŠ¨æ€å¤„ç†æœåŠ¡ç«¯è¯·æ±‚æˆ–é€šçŸ¥ï¼Œå½“æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯å‘é€è¯·æ±‚æˆ–é€šçŸ¥æ—¶ï¼Œåˆ™è°ƒç”¨å¯¹åº”çš„å¤„ç†å™¨è¿›è¡Œå¤„ç†ã€‚</li>
<li><code>connection</code>ï¼šè¡¨ç¤ºåº•å±‚è¿æ¥çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†å¯¹è±¡ï¼Œç”¨äºæ§åˆ¶ä¼šè¯çš„å¯åŠ¨ä¸å…³é—­ã€‚</li>
</ul>
<p>Â Â Â æ ¸å¿ƒçš„æºç åŠæ³¨é‡Šå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">/**
 * MCP ä¼šè¯ï¼Œç”¨æˆ·å¤„ç†å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¹‹é—´çš„é€šä¿¡
 * æä¾›äº†æ¶ˆæ¯äº¤äº’å’Œä¼šè¯ç”Ÿå‘½å‘¨æœŸç®¡ç†çš„æ–¹æ³•
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">McpSession</span> {

    <span class="hljs-comment">/**
     * å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚å¹¶è¿”å›å“åº”ç»“æœ
     *
     * <span class="hljs-doctag">@param</span> method è°ƒç”¨çš„æ–¹æ³•å
     * <span class="hljs-doctag">@param</span> requestParams è¯·æ±‚å‚æ•°
     * <span class="hljs-doctag">@param</span> typeRef ååºåˆ—åŒ–å“åº”ç»“æœæ‰€éœ€çš„ç±»å‹
     * <span class="hljs-doctag">@return</span> Monoï¼ŒæœåŠ¡ç«¯å“åº”åå®Œæˆ
     */</span>
    &lt;T&gt; Mono&lt;T&gt; <span class="hljs-title function_">sendRequest</span><span class="hljs-params">(String method, Object requestParams, TypeReference&lt;T&gt; typeRef)</span>;

    <span class="hljs-comment">/**
     * å‘æœåŠ¡ç«¯å‘é€ä¸å¸¦å‚æ•°çš„é€šçŸ¥
     *
     * <span class="hljs-doctag">@param</span> method æ–¹æ³•å
     * <span class="hljs-doctag">@return</span> Monoï¼Œé€šçŸ¥å‘é€åå®Œæˆ
     */</span>
    <span class="hljs-keyword">default</span> Mono&lt;Void&gt; <span class="hljs-title function_">sendNotification</span><span class="hljs-params">(String method)</span> {
        <span class="hljs-keyword">return</span> sendNotification(method, <span class="hljs-literal">null</span>);
    }

    <span class="hljs-comment">/**
     * å‘æœåŠ¡ç«¯å‘é€å¸¦å‚æ•°çš„é€šçŸ¥
     *
     * <span class="hljs-doctag">@param</span> method é€šçŸ¥æ–¹æ³•å
     * <span class="hljs-doctag">@param</span> params æ–¹æ³•å‚æ•°
     * <span class="hljs-doctag">@return</span> Monoï¼Œé€šçŸ¥å‘é€åå®Œæˆ
     */</span>
    Mono&lt;Void&gt; <span class="hljs-title function_">sendNotification</span><span class="hljs-params">(String method, Object params)</span>;

    <span class="hljs-comment">/**
     * ä¼˜é›…å…³é—­å®¢æˆ·ç«¯è¿æ¥
     *
     * <span class="hljs-doctag">@return</span> Monoï¼Œå…³é—­åå®Œæˆ
     */</span>
    Mono&lt;Void&gt; <span class="hljs-title function_">closeGracefully</span><span class="hljs-params">()</span>;

    <span class="hljs-comment">/**
     * ç«‹åˆ»å…³é—­å®¢æˆ·ç«¯è¿æ¥
     */</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span>;
}
</code></pre>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">/**
 * MCP å®¢æˆ·ç«¯ä¼šè¯å®ç°ç±»ï¼Œç”¨äºç®¡ç†å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´çš„åŒå‘ JSON-RPC é€šä¿¡
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">McpClientSession</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">McpSession</span> {

    <span class="hljs-comment">// è¯·æ±‚è¶…æ—¶æ—¶é—´</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Duration requestTimeout;

    <span class="hljs-comment">// ä¼ è¾“å±‚å¯¹è±¡</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> McpClientTransport transport;

    <span class="hljs-comment">// å¾…å¤„ç†çš„è¯·æ±‚å“åº”</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ConcurrentHashMap&lt;Object, MonoSink&lt;McpSchema.JSONRPCResponse&gt;&gt; pendingResponses = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();

    <span class="hljs-comment">// è¯·æ±‚å¤„ç†å™¨</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ConcurrentHashMap&lt;String, RequestHandler&lt;?&gt;&gt; requestHandlers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();

    <span class="hljs-comment">// é€šçŸ¥å¤„ç†å™¨</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ConcurrentHashMap&lt;String, NotificationHandler&gt; notificationHandlers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();

    <span class="hljs-comment">// è¯·æ±‚ id çš„ä¼šè¯å‰ç¼€</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">sessionPrefix</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString().substring(<span class="hljs-number">0</span>, <span class="hljs-number">8</span>);

    <span class="hljs-comment">// ç”¨äºç”Ÿæˆå”¯ä¸€è¯·æ±‚ id çš„åŸå­è®¡æ•°å™¨</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">AtomicLong</span> <span class="hljs-variable">requestCounter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicLong</span>(<span class="hljs-number">0</span>);

    <span class="hljs-comment">// åº•å±‚è¿æ¥å¯¹è±¡</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Disposable connection;

    <span class="hljs-comment">/**
     * åˆ›å»ºå®¢æˆ·ç«¯ä¼šè¯å¯¹è±¡
     *
     * <span class="hljs-doctag">@param</span> requestTimeout è¯·æ±‚è¶…æ—¶æ—¶é—´
     * <span class="hljs-doctag">@param</span> transport ä¼ è¾“å±‚å¯¹è±¡
     * <span class="hljs-doctag">@param</span> requestHandlers è¯·æ±‚å¤„ç†å™¨
     * <span class="hljs-doctag">@param</span> notificationHandlers é€šçŸ¥å¤„ç†å™¨
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">McpClientSession</span><span class="hljs-params">(Duration requestTimeout, McpClientTransport transport,
                            Map&lt;String, RequestHandler&lt;?&gt;&gt; requestHandlers, Map&lt;String, NotificationHandler&gt; notificationHandlers)</span> {

        Assert.notNull(requestTimeout, <span class="hljs-string">"The requestTimeout can not be null"</span>);
        Assert.notNull(transport, <span class="hljs-string">"The transport can not be null"</span>);
        Assert.notNull(requestHandlers, <span class="hljs-string">"The requestHandlers can not be null"</span>);
        Assert.notNull(notificationHandlers, <span class="hljs-string">"The notificationHandlers can not be null"</span>);

        <span class="hljs-built_in">this</span>.requestTimeout = requestTimeout;
        <span class="hljs-built_in">this</span>.transport = transport;
        <span class="hljs-built_in">this</span>.requestHandlers.putAll(requestHandlers);
        <span class="hljs-built_in">this</span>.notificationHandlers.putAll(notificationHandlers);

        <span class="hljs-comment">// ä½¿ç”¨ä¼ è¾“å±‚å¯¹è±¡å»ºç«‹è¿æ¥</span>
        <span class="hljs-built_in">this</span>.connection = <span class="hljs-built_in">this</span>.transport.connect(mono -&gt; mono.doOnNext(<span class="hljs-built_in">this</span>::handle)).subscribe();
    }

    <span class="hljs-comment">/**
     * å¤„ç†æ¥æ”¶åˆ°çš„ JSON-RPC æ¶ˆæ¯
     *
     * <span class="hljs-doctag">@param</span> message JSON-RPC æ¶ˆæ¯
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span><span class="hljs-params">(McpSchema.JSONRPCMessage message)</span> {
        <span class="hljs-keyword">if</span> (message <span class="hljs-keyword">instanceof</span> McpSchema.JSONRPCResponse response) {
            <span class="hljs-comment">// å¤„ç†å“åº”æ¶ˆæ¯</span>
            logger.debug(<span class="hljs-string">"Received Response: {}"</span>, response);
            <span class="hljs-comment">// æ ¹æ®å“åº” id å–å‡ºå¯¹åº”çš„ MonoSinkï¼ˆç­‰å¾…ç»“æœçš„å“åº”å¯¹è±¡ï¼‰</span>
            <span class="hljs-type">var</span> <span class="hljs-variable">sink</span> <span class="hljs-operator">=</span> pendingResponses.remove(response.id());
            <span class="hljs-keyword">if</span> (sink == <span class="hljs-literal">null</span>) {
                logger.warn(<span class="hljs-string">"Unexpected response for unknown id {}"</span>, response.id());
            }
            <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// å°†å“åº”ç»“æœæ¨é€ç»™è®¢é˜…è€…</span>
                sink.success(response);
            }
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (message <span class="hljs-keyword">instanceof</span> McpSchema.JSONRPCRequest request) {
            <span class="hljs-comment">// å¤„ç†è¯·æ±‚æ¶ˆæ¯</span>
            logger.debug(<span class="hljs-string">"Received request: {}"</span>, request);
            handleIncomingRequest(request).onErrorResume(error -&gt; {
                <span class="hljs-comment">// å¤„ç†è¯·æ±‚æ—¶å‘ç”Ÿé”™è¯¯ï¼Œåˆ™æ„é€  JSON-RPC é”™è¯¯å“åº”å‘é€ç»™æœåŠ¡ç«¯</span>
                <span class="hljs-type">var</span> <span class="hljs-variable">errorResponse</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpSchema</span>.JSONRPCResponse(McpSchema.JSONRPC_VERSION, request.id(), <span class="hljs-literal">null</span>,
                        <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpSchema</span>.JSONRPCResponse.JSONRPCError(McpSchema.ErrorCodes.INTERNAL_ERROR,
                                error.getMessage(), <span class="hljs-literal">null</span>));
                <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.transport.sendMessage(errorResponse).then(Mono.empty());
            }).flatMap(<span class="hljs-built_in">this</span>.transport::sendMessage).subscribe();
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (message <span class="hljs-keyword">instanceof</span> McpSchema.JSONRPCNotification notification) {
            <span class="hljs-comment">// å¤„ç†é€šçŸ¥æ¶ˆæ¯</span>
            logger.debug(<span class="hljs-string">"Received notification: {}"</span>, notification);
            handleIncomingNotification(notification)
                    .doOnError(error -&gt; logger.error(<span class="hljs-string">"Error handling notification: {}"</span>, error.getMessage()))
                    .subscribe();
        }
        <span class="hljs-keyword">else</span> {
            logger.warn(<span class="hljs-string">"Received unknown message type: {}"</span>, message);
        }
    }

    <span class="hljs-comment">/**
     * å¤„ç† JSON-RPC è¯·æ±‚æ¶ˆæ¯ï¼Œå°†å…¶è·¯ç”±åˆ°å¯¹åº”çš„å¤„ç†å™¨
     *
     * <span class="hljs-doctag">@param</span> request JSON-RPC è¯·æ±‚
     * <span class="hljs-doctag">@return</span> Monoï¼Œå¤„ç†åå®Œæˆ
     */</span>
    <span class="hljs-keyword">private</span> Mono&lt;McpSchema.JSONRPCResponse&gt; handleIncomingRequest(McpSchema.JSONRPCRequest request) {
        <span class="hljs-keyword">return</span> Mono.defer(() -&gt; {
            <span class="hljs-comment">// æ ¹æ®æ–¹æ³•åè·å–å¤„ç†å™¨</span>
            <span class="hljs-type">var</span> <span class="hljs-variable">handler</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.requestHandlers.get(request.method());
            <span class="hljs-keyword">if</span> (handler == <span class="hljs-literal">null</span>) {
                <span class="hljs-comment">// ä¸å­˜åœ¨å¤„ç†å™¨æ—¶ï¼Œè¿”å› JSON-RPC é”™è¯¯æ¶ˆæ¯</span>
                <span class="hljs-type">MethodNotFoundError</span> <span class="hljs-variable">error</span> <span class="hljs-operator">=</span> getMethodNotFoundError(request.method());
                <span class="hljs-keyword">return</span> Mono.just(<span class="hljs-keyword">new</span> <span class="hljs-title class_">McpSchema</span>.JSONRPCResponse(McpSchema.JSONRPC_VERSION, request.id(), <span class="hljs-literal">null</span>,
                        <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpSchema</span>.JSONRPCResponse.JSONRPCError(McpSchema.ErrorCodes.METHOD_NOT_FOUND,
                                error.message(), error.data())));
            }
            <span class="hljs-comment">// è°ƒç”¨å¤„ç†å™¨ï¼Œå¹¶å°†ç»“æœå°è£…æˆ JSON-RPC æ¶ˆæ¯</span>
            <span class="hljs-keyword">return</span> handler.handle(request.params())
                    .map(result -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpSchema</span>.JSONRPCResponse(McpSchema.JSONRPC_VERSION, request.id(), result, <span class="hljs-literal">null</span>))
                    .onErrorResume(error -&gt; Mono.just(<span class="hljs-keyword">new</span> <span class="hljs-title class_">McpSchema</span>.JSONRPCResponse(McpSchema.JSONRPC_VERSION, request.id(),
                            <span class="hljs-literal">null</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpSchema</span>.JSONRPCResponse.JSONRPCError(McpSchema.ErrorCodes.INTERNAL_ERROR,
                            error.getMessage(), <span class="hljs-literal">null</span>))));
        });
    }

    <span class="hljs-comment">/**
     * è¡¨ç¤ºæ–¹æ³•æœªæ‰¾åˆ°çš„é”™è¯¯æ•°æ®ç»“æ„
     *
     * <span class="hljs-doctag">@param</span> method æ–¹æ³•å
     * <span class="hljs-doctag">@param</span> message å¼‚å¸¸ä¿¡æ¯
     * <span class="hljs-doctag">@param</span> data é™„åŠ æ•°æ®
     */</span>
    <span class="hljs-keyword">record</span> <span class="hljs-title class_">MethodNotFoundError</span><span class="hljs-params">(String method, String message, Object data)</span> {
    }

    <span class="hljs-comment">/**
     * æ ¹æ®æ–¹æ³•åè¿”å›å¯¹åº”çš„ MethodNotFoundError å¯¹è±¡
     *
     * <span class="hljs-doctag">@param</span> method æ–¹æ³•å
     * <span class="hljs-doctag">@return</span> MethodNotFoundError å¯¹è±¡
     */</span>
    <span class="hljs-keyword">private</span> MethodNotFoundError <span class="hljs-title function_">getMethodNotFoundError</span><span class="hljs-params">(String method)</span> {
        <span class="hljs-keyword">switch</span> (method) {
            <span class="hljs-keyword">case</span> McpSchema.METHOD_ROOTS_LIST:
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MethodNotFoundError</span>(method, <span class="hljs-string">"Roots not supported"</span>,
                        Map.of(<span class="hljs-string">"reason"</span>, <span class="hljs-string">"Client does not have roots capability"</span>));
            <span class="hljs-keyword">default</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MethodNotFoundError</span>(method, <span class="hljs-string">"Method not found: "</span> + method, <span class="hljs-literal">null</span>);
        }
    }

    <span class="hljs-comment">/**
     * å¤„ç† JSON-RPC é€šçŸ¥æ¶ˆæ¯ï¼Œå°†å…¶è·¯ç”±åˆ°å¯¹åº”çš„å¤„ç†å™¨
     *
     * <span class="hljs-doctag">@param</span> notification JSON-RPC èèµ„è‚¡
     * <span class="hljs-doctag">@return</span> Monoï¼Œå¤„ç†åå®Œæˆ
     */</span>
    <span class="hljs-keyword">private</span> Mono&lt;Void&gt; <span class="hljs-title function_">handleIncomingNotification</span><span class="hljs-params">(McpSchema.JSONRPCNotification notification)</span> {
        <span class="hljs-keyword">return</span> Mono.defer(() -&gt; {
            <span class="hljs-comment">// æ ¹æ®æ–¹æ³•åè·å–å¤„ç†å™¨</span>
            <span class="hljs-type">var</span> <span class="hljs-variable">handler</span> <span class="hljs-operator">=</span> notificationHandlers.get(notification.method());
            <span class="hljs-keyword">if</span> (handler == <span class="hljs-literal">null</span>) {
                <span class="hljs-comment">// ä¸å­˜åœ¨å¤„ç†å™¨æ—¶ç›´æ¥è¿”å›</span>
                logger.error(<span class="hljs-string">"No handler registered for notification method: {}"</span>, notification.method());
                <span class="hljs-keyword">return</span> Mono.empty();
            }
            <span class="hljs-comment">// è°ƒç”¨å¤„ç†å™¨</span>
            <span class="hljs-keyword">return</span> handler.handle(notification.params());
        });
    }

    <span class="hljs-comment">/**
     * ç”Ÿæˆå”¯ä¸€çš„è¯·æ±‚ id
     *
     * <span class="hljs-doctag">@return</span> è¯·æ±‚ id
     */</span>
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">generateRequestId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.sessionPrefix + <span class="hljs-string">"-"</span> + <span class="hljs-built_in">this</span>.requestCounter.getAndIncrement();
    }

    <span class="hljs-comment">/**
     * å‘é€ JSON-RPC è¯·æ±‚å¹¶è¿”å›å“åº”ç»“æœ
     *
     * <span class="hljs-doctag">@param</span> method è°ƒç”¨çš„æ–¹æ³•å
     * <span class="hljs-doctag">@param</span> requestParams è¯·æ±‚å‚æ•°
     * <span class="hljs-doctag">@param</span> typeRef å“åº”ååºåˆ—åŒ–æ‰€éœ€çš„ç±»å‹
     * <span class="hljs-doctag">@return</span> Monoï¼ŒåŒ…å«å“åº”ç»“æœ
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> &lt;T&gt; Mono&lt;T&gt; <span class="hljs-title function_">sendRequest</span><span class="hljs-params">(String method, Object requestParams, TypeReference&lt;T&gt; typeRef)</span> {
        <span class="hljs-comment">// ç”Ÿæˆè¯·æ±‚ id</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">requestId</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.generateRequestId();

        <span class="hljs-keyword">return</span> Mono.deferContextual(ctx -&gt; Mono.&lt;McpSchema.JSONRPCResponse&gt;create(sink -&gt; {
            <span class="hljs-comment">// ç¼“å­˜å½“å‰è¯·æ±‚</span>
            <span class="hljs-built_in">this</span>.pendingResponses.put(requestId, sink);
            <span class="hljs-comment">// æ„å»º JSON-RPC è¯·æ±‚å¯¹è±¡</span>
            McpSchema.<span class="hljs-type">JSONRPCRequest</span> <span class="hljs-variable">jsonrpcRequest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpSchema</span>.JSONRPCRequest(McpSchema.JSONRPC_VERSION, method,
                    requestId, requestParams);
            <span class="hljs-comment">// å‘é€æ¶ˆæ¯</span>
            <span class="hljs-built_in">this</span>.transport.sendMessage(jsonrpcRequest)
                    .contextWrite(ctx)
                    .subscribe(v -&gt; {
                    }, error -&gt; {
                        <span class="hljs-built_in">this</span>.pendingResponses.remove(requestId);
                        sink.error(error);
                    });
        })).timeout(<span class="hljs-built_in">this</span>.requestTimeout).handle((jsonRpcResponse, sink) -&gt; {
            <span class="hljs-comment">// å¤„ç†å“åº”</span>
            <span class="hljs-keyword">if</span> (jsonRpcResponse.error() != <span class="hljs-literal">null</span>) {
                <span class="hljs-comment">// å‡ºç°å¼‚å¸¸</span>
                logger.error(<span class="hljs-string">"Error handling request: {}"</span>, jsonRpcResponse.error());
                sink.error(<span class="hljs-keyword">new</span> <span class="hljs-title class_">McpError</span>(jsonRpcResponse.error()));
            }
            <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">if</span> (typeRef.getType().equals(Void.class)) {
                    <span class="hljs-comment">// è¿”å›ç»“æœç±»å‹ä¸ºç©ºæ—¶ç›´æ¥ç»“æŸ</span>
                    sink.complete();
                }
                <span class="hljs-keyword">else</span> {
                    <span class="hljs-comment">// è¿”å›ç»“æœç±»å‹ä¸ä¸ºç©ºæ—¶å°†ç»“æœè½¬æ¢ä¸º typeRef ç±»å‹å¯¹è±¡å¹¶è¿”å›</span>
                    sink.next(<span class="hljs-built_in">this</span>.transport.unmarshalFrom(jsonRpcResponse.result(), typeRef));
                }
            }
        });
    }

    <span class="hljs-comment">/**
     * å‘é€ JSON-RPC é€šçŸ¥
     *
     * <span class="hljs-doctag">@param</span> method é€šçŸ¥æ–¹æ³•å
     * <span class="hljs-doctag">@param</span> params æ–¹æ³•å‚æ•°
     * <span class="hljs-doctag">@return</span> Monoï¼Œå‘é€åå®Œæˆ
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Mono&lt;Void&gt; <span class="hljs-title function_">sendNotification</span><span class="hljs-params">(String method, Object params)</span> {
        <span class="hljs-comment">// æ„å»º JSON-RPC æ¶ˆæ¯</span>
        McpSchema.<span class="hljs-type">JSONRPCNotification</span> <span class="hljs-variable">jsonrpcNotification</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpSchema</span>.JSONRPCNotification(McpSchema.JSONRPC_VERSION,
                method, params);
        <span class="hljs-comment">// å‘é€æ¶ˆæ¯</span>
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.transport.sendMessage(jsonrpcNotification);
    }

    <span class="hljs-comment">/**
     * ä¼˜é›…å…³é—­å®¢æˆ·ç«¯è¿æ¥
     *
     * <span class="hljs-doctag">@return</span> Monoï¼Œå…³é—­åå®Œæˆ
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Mono&lt;Void&gt; <span class="hljs-title function_">closeGracefully</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> Mono.defer(() -&gt; {
            <span class="hljs-built_in">this</span>.connection.dispose();
            <span class="hljs-keyword">return</span> transport.closeGracefully();
        });
    }

    <span class="hljs-comment">/**
     * ç«‹åˆ»å…³é—­å®¢æˆ·ç«¯è¿æ¥
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">this</span>.connection.dispose();
        transport.close();
    }

}
</code></pre>
<h3 data-id="heading-4">3.1.4 ä¼ è¾“å±‚</h3>
<p>Â Â Â MCP å®¢æˆ·ç«¯ä¼ è¾“å±‚æ¶‰åŠåˆ°çš„ç±»åŒ…æ‹¬ï¼š<strong>McpTransport</strong>ã€<strong>McpClientTransport</strong>ã€<strong>HttpClientSseClientTransport</strong>ã€<strong>StdioClientTransport</strong> ç­‰ï¼Œå…¶ä¸­ <code>HttpClientSseClientTransport</code> å’Œ <code>StdioClientTransport</code> ä¸º <code>McpClientTransport</code> å®ç°ç±»ï¼Œåˆ†åˆ«å¯¹åº” SSE å’Œ Stdio çš„å…·ä½“å®ç°ï¼Œè¿™é‡Œä»…åˆ—å‡ºä¸¤ç§ï¼Œå®é™…ä¸Šä¸åŒçš„ä¼ è¾“åè®®éƒ½ä¼šæœ‰å¯¹åº”çš„å®ç°ç±»ã€‚å…¶ç±»å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/895d3a8e650e49db8d56004a59eed342~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP55KQ5Lmx5pKe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763392204&amp;x-signature=3xcvN%2B8jwtX6Bv%2FOtf4gfKdLzHM%3D" alt="" loading="lazy"/></p>
<p>Â Â Â ä¼ è¾“å±‚æ‰¿æ‹…ç€æ‰€æœ‰æ¶ˆæ¯çš„å®é™…å‘é€ä¸æ¥æ”¶èŒè´£ï¼Œæ— è®ºä¸Šå±‚å¦‚ä½•ç»„ç»‡ä¼šè¯æˆ–å°è£…å®¢æˆ·ç«¯é€»è¾‘ï¼Œæœ€ç»ˆéƒ½å¿…é¡»é€šè¿‡è¿™ä¸€å±‚å°† JSON-RPC æ¶ˆæ¯åºåˆ—åŒ–ã€å‘é€å¹¶æ¥æ”¶å“åº”ã€‚æ ¸å¿ƒæ¥å£æ˜¯ <code>McpTransport</code> å’Œå…¶å­æ¥å£ <code>McpClientTransport</code>ï¼š</p>
<ul>
<li><code>McpTransport</code> æ¥å£å®šä¹‰äº†åŸºç¡€é€šä¿¡èƒ½åŠ›ï¼š
<ul>
<li><code>sendMessage()</code>ï¼šå‘æœåŠ¡ç«¯å¼‚æ­¥å‘é€ JSON-RPC æ¶ˆæ¯ã€‚</li>
<li><code>unmarshalFrom()</code>ï¼šå°†æ•°æ®è½¬åŒ–ä¸ºæŒ‡å®šç±»å‹çš„å¯¹è±¡ã€‚</li>
<li><code>close()</code>ï¼šç«‹åˆ»å…³é—­ä¼ è¾“è¿æ¥ã€‚</li>
<li><code>closeGracefully()</code>ï¼šä¼˜é›…å…³é—­ä¼ è¾“è¿æ¥ï¼Œå°†é˜»æ­¢æ–°çš„æ¶ˆæ¯å‘é€ï¼Œä½†å…è®¸æ­£åœ¨è¿›è¡Œçš„æ“ä½œå®Œæˆã€‚</li>
</ul>
</li>
<li><code>McpClientTransport</code> åˆ™æ‰©å±•äº†å®¢æˆ·ç«¯çš„è¿æ¥è¡Œä¸ºï¼š
<ul>
<li><code>connect()</code>ï¼šå»ºç«‹ä¸æœåŠ¡ç«¯çš„è¿æ¥ï¼ŒåŒæ—¶ä¼šå°†æ¶ˆæ¯æµä¸å®¢æˆ·ç«¯çš„å¤„ç†é€»è¾‘ç»‘å®šèµ·æ¥ã€‚</li>
</ul>
</li>
</ul>
<p>Â Â Â æ ¸å¿ƒçš„æºç åŠæ³¨é‡Šå¦‚ä¸‹æ‰€ç¤ºï¼ˆå®ç°ç±»ä¸­ä»…ç»™å‡º <code>HttpClientSseClientTransport</code> çš„å…·ä½“å®ç°ï¼Œå…¶ä»–çš„å®ç°ç±»æ˜¯ç±»ä¼¼çš„ï¼‰ï¼š</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">/**
 * MCP å¼‚æ­¥ä¼ è¾“å±‚
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">McpTransport</span> {

    <span class="hljs-comment">/**
     * ç«‹åˆ»å…³é—­å®¢æˆ·ç«¯è¿æ¥
     */</span>
    <span class="hljs-keyword">default</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">this</span>.closeGracefully().subscribe();
    }

    <span class="hljs-comment">/**
     * ä¼˜é›…å…³é—­å®¢æˆ·ç«¯è¿æ¥
     *
     * <span class="hljs-doctag">@return</span> Monoï¼Œå…³é—­åå®Œæˆ
     */</span>
    Mono&lt;Void&gt; <span class="hljs-title function_">closeGracefully</span><span class="hljs-params">()</span>;

    <span class="hljs-comment">/**
     * å¼‚æ­¥å‘é€ JSON-RPC æ¶ˆæ¯
     *
     * <span class="hljs-doctag">@param</span> message JSON-RPC æ¶ˆæ¯
     * <span class="hljs-doctag">@return</span> Monoï¼Œå‘é€åå®Œæˆ
     */</span>
    Mono&lt;Void&gt; <span class="hljs-title function_">sendMessage</span><span class="hljs-params">(JSONRPCMessage message)</span>;

    <span class="hljs-comment">/**
     * å°†æ•°æ®è½¬æ¢ä¸ºæŒ‡å®šç±»å‹çš„å¯¹è±¡
     *
     * <span class="hljs-doctag">@param</span> data æ•°æ®
     * <span class="hljs-doctag">@param</span> typeRef æŒ‡å®šç±»å‹
     * <span class="hljs-doctag">@return</span> æŒ‡å®šç±»å‹çš„å¯¹è±¡
     */</span>
    &lt;T&gt; T <span class="hljs-title function_">unmarshalFrom</span><span class="hljs-params">(Object data, TypeReference&lt;T&gt; typeRef)</span>;

}
</code></pre>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">/**
 * MCP å®¢æˆ·ç«¯ä¼ è¾“å±‚
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">McpClientTransport</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">McpTransport</span> {

    <span class="hljs-comment">/**
     * ä¸æœåŠ¡ç«¯å»ºç«‹è¿æ¥
     *
     * <span class="hljs-doctag">@param</span> handler å¤„ç†å™¨ï¼Œç”¨äºå¤„ç†ä»æœåŠ¡ç«¯æ¥æ”¶åˆ°çš„æ¶ˆæ¯
     * <span class="hljs-doctag">@return</span> Monoï¼Œè¿æ¥å»ºç«‹æ—¶å®Œæˆ
     */</span>
    Mono&lt;Void&gt; <span class="hljs-title function_">connect</span><span class="hljs-params">(Function&lt;Mono&lt;McpSchema.JSONRPCMessage&gt;, Mono&lt;McpSchema.JSONRPCMessage&gt;&gt; handler)</span>;

}
</code></pre>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">/**
 * SSE ä¼ è¾“å±‚å®ç°ç±»
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpClientSseClientTransport</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">McpClientTransport</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(HttpClientSseClientTransport.class);

    <span class="hljs-comment">// æ¶ˆæ¯äº‹ä»¶ç±»å‹</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">MESSAGE_EVENT_TYPE</span> <span class="hljs-operator">=</span> <span class="hljs-string">"message"</span>;

    <span class="hljs-comment">// ç«¯ç‚¹äº‹ä»¶ç±»å‹</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">ENDPOINT_EVENT_TYPE</span> <span class="hljs-operator">=</span> <span class="hljs-string">"endpoint"</span>;

    <span class="hljs-comment">// SSE ç«¯ç‚¹é»˜è®¤å€¼</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEFAULT_SSE_ENDPOINT</span> <span class="hljs-operator">=</span> <span class="hljs-string">"/sse"</span>;

    <span class="hljs-comment">// MCP æœåŠ¡ç«¯ uri</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> URI baseUri;

    <span class="hljs-comment">// SSE ç«¯ç‚¹</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String sseEndpoint;

    <span class="hljs-comment">// SSE å®¢æˆ·ç«¯ï¼Œç”¨äºå¤„ç†æœåŠ¡ç«¯å‘é€çš„äº‹ä»¶</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> FlowSseClient sseClient;

    <span class="hljs-comment">// HTTP å®¢æˆ·ç«¯ï¼Œç”¨äºå‘æœåŠ¡ç«¯å‘é€æ¶ˆæ¯ï¼Œä½¿ç”¨ HTTP/POST æ–¹æ³•</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> HttpClient httpClient;

    <span class="hljs-comment">// HTTP è¯·æ±‚æ„å»ºå™¨ï¼Œç”¨äºæ„å»ºå‘æœåŠ¡ç«¯å‘é€æ¶ˆæ¯çš„è¯·æ±‚</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> HttpRequest.Builder requestBuilder;

    <span class="hljs-comment">// JSON å¯¹è±¡æ˜ å°„å™¨ï¼Œç”¨äºæ¶ˆæ¯åºåˆ—åŒ–/ååºåˆ—åŒ–</span>
    <span class="hljs-keyword">protected</span> ObjectMapper objectMapper;

    <span class="hljs-comment">// æ ‡å¿—ä¼ è¾“æ˜¯å¦å¤„äºå…³é—­çŠ¶æ€</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">isClosing</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;

    <span class="hljs-comment">// åè°ƒç«¯ç‚¹å‘ç°çš„é”</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">CountDownLatch</span> <span class="hljs-variable">closeLatch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(<span class="hljs-number">1</span>);

    <span class="hljs-comment">// æ¶ˆæ¯ç«¯ç‚¹</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AtomicReference&lt;String&gt; messageEndpoint = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicReference</span>&lt;&gt;();

    <span class="hljs-comment">// SSE è¿æ¥</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AtomicReference&lt;CompletableFuture&lt;Void&gt;&gt; connectionFuture = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicReference</span>&lt;&gt;();

    <span class="hljs-comment">/**
     * åˆ›å»ºä¼ è¾“å±‚å¯¹è±¡
     *
     * <span class="hljs-doctag">@param</span> httpClient HTTP å®¢æˆ·ç«¯
     * <span class="hljs-doctag">@param</span> requestBuilder HTTP è¯·æ±‚æ„å»ºå™¨
     * <span class="hljs-doctag">@param</span> baseUri MCP æœåŠ¡ç«¯ uri
     * <span class="hljs-doctag">@param</span> sseEndpoint SSE ç«¯ç‚¹
     * <span class="hljs-doctag">@param</span> objectMapper JSON å¯¹è±¡æ˜ å°„å™¨
     */</span>
    HttpClientSseClientTransport(HttpClient httpClient, HttpRequest.Builder requestBuilder, String baseUri,
                                 String sseEndpoint, ObjectMapper objectMapper) {
        Assert.notNull(objectMapper, <span class="hljs-string">"ObjectMapper must not be null"</span>);
        Assert.hasText(baseUri, <span class="hljs-string">"baseUri must not be empty"</span>);
        Assert.hasText(sseEndpoint, <span class="hljs-string">"sseEndpoint must not be empty"</span>);
        Assert.notNull(httpClient, <span class="hljs-string">"httpClient must not be null"</span>);
        Assert.notNull(requestBuilder, <span class="hljs-string">"requestBuilder must not be null"</span>);
        <span class="hljs-built_in">this</span>.baseUri = URI.create(baseUri);
        <span class="hljs-built_in">this</span>.sseEndpoint = sseEndpoint;
        <span class="hljs-built_in">this</span>.objectMapper = objectMapper;
        <span class="hljs-built_in">this</span>.httpClient = httpClient;
        <span class="hljs-built_in">this</span>.requestBuilder = requestBuilder;

        <span class="hljs-built_in">this</span>.sseClient = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FlowSseClient</span>(<span class="hljs-built_in">this</span>.httpClient, requestBuilder);
    }

    <span class="hljs-comment">/**
     * ä¸æœåŠ¡ç«¯å»ºç«‹ SSE è¿æ¥å¹¶è®¾ç½®æ¶ˆæ¯å¤„ç†
     *
     * <span class="hljs-doctag">@param</span> handler å¤„ç†æ¥æ”¶åˆ°çš„ JSON-RPC æ¶ˆæ¯
     * <span class="hljs-doctag">@return</span> Monoï¼Œå½“è¿æ¥å»ºç«‹æ—¶å®Œæˆ
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Mono&lt;Void&gt; <span class="hljs-title function_">connect</span><span class="hljs-params">(Function&lt;Mono&lt;JSONRPCMessage&gt;, Mono&lt;JSONRPCMessage&gt;&gt; handler)</span> {
        CompletableFuture&lt;Void&gt; future = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CompletableFuture</span>&lt;&gt;();
        connectionFuture.set(future);

        <span class="hljs-comment">// æ‹¼æ¥ SSE æœåŠ¡ç«¯çš„å®Œæ•´ URIï¼ˆbaseUri + sseEndpointï¼‰</span>
        <span class="hljs-type">URI</span> <span class="hljs-variable">clientUri</span> <span class="hljs-operator">=</span> Utils.resolveUri(<span class="hljs-built_in">this</span>.baseUri, <span class="hljs-built_in">this</span>.sseEndpoint);
        <span class="hljs-comment">// å‘èµ·è®¢é˜…ï¼Œç›‘å¬æœåŠ¡ç«¯çš„ SSE äº‹ä»¶</span>
        sseClient.subscribe(clientUri.toString(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">FlowSseClient</span>.SseEventHandler() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onEvent</span><span class="hljs-params">(SseEvent event)</span> {
                <span class="hljs-keyword">if</span> (isClosing) {
                    <span class="hljs-comment">// è‹¥ä¼ è¾“å…³é—­åˆ™ç›´æ¥é€€å‡º</span>
                    <span class="hljs-keyword">return</span>;
                }

                <span class="hljs-keyword">try</span> {
                    <span class="hljs-keyword">if</span> (ENDPOINT_EVENT_TYPE.equals(event.type())) {
                        <span class="hljs-comment">// endpoint äº‹ä»¶ï¼Œæ¥æ”¶æœåŠ¡ç«¯è¿”å›çš„æ¶ˆæ¯å‘é€ç«¯ç‚¹åœ°å€</span>
                        <span class="hljs-type">String</span> <span class="hljs-variable">endpoint</span> <span class="hljs-operator">=</span> event.data();
                        messageEndpoint.set(endpoint);
                        closeLatch.countDown();
                        future.complete(<span class="hljs-literal">null</span>);
                    }
                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (MESSAGE_EVENT_TYPE.equals(event.type())) {
                        <span class="hljs-comment">// message äº‹ä»¶ï¼Œæ¥æ”¶æœåŠ¡ç«¯æ¨é€çš„ JSON-RPC æ¶ˆæ¯</span>
                        <span class="hljs-comment">// ååºåˆ—åŒ–æ•°æ®ä¸º JSON-RPC æ ¼å¼æ•°æ®</span>
                        <span class="hljs-type">JSONRPCMessage</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> McpSchema.deserializeJsonRpcMessage(objectMapper, event.data());
                        <span class="hljs-comment">// è°ƒç”¨å¤„ç†å™¨æ¥å¤„ç†æœåŠ¡ç«¯è¿”å›çš„æ¶ˆæ¯</span>
                        handler.apply(Mono.just(message)).subscribe();
                    }
                    <span class="hljs-keyword">else</span> {
                        logger.error(<span class="hljs-string">"Received unrecognized SSE event type: {}"</span>, event.type());
                    }
                }
                <span class="hljs-keyword">catch</span> (IOException e) {
                    logger.error(<span class="hljs-string">"Error processing SSE event"</span>, e);
                    future.completeExceptionally(e);
                }
            }

            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onError</span><span class="hljs-params">(Throwable error)</span> {
                <span class="hljs-keyword">if</span> (!isClosing) {
                    logger.error(<span class="hljs-string">"SSE connection error"</span>, error);
                    future.completeExceptionally(error);
                }
            }
        });

        <span class="hljs-keyword">return</span> Mono.fromFuture(future);
    }

    <span class="hljs-comment">/**
     * å‘æœåŠ¡ç«¯å‘é€ JSON-RPC æ¶ˆæ¯
     *
     * <span class="hljs-doctag">@param</span> message å‘é€çš„ JSON-RPC æ¶ˆæ¯
     * <span class="hljs-doctag">@return</span> Monoï¼Œå½“æ¶ˆæ¯å‘é€æˆåŠŸæ—¶å®Œæˆ
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Mono&lt;Void&gt; <span class="hljs-title function_">sendMessage</span><span class="hljs-params">(JSONRPCMessage message)</span> {
        <span class="hljs-keyword">if</span> (isClosing) {
            <span class="hljs-keyword">return</span> Mono.empty();
        }

        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">if</span> (!closeLatch.await(<span class="hljs-number">10</span>, TimeUnit.SECONDS)) {
                <span class="hljs-comment">// ç¡®ä¿è¿æ¥å·²ç»å»ºç«‹</span>
                <span class="hljs-keyword">return</span> Mono.error(<span class="hljs-keyword">new</span> <span class="hljs-title class_">McpError</span>(<span class="hljs-string">"Failed to wait for the message endpoint"</span>));
            }
        }
        <span class="hljs-keyword">catch</span> (InterruptedException e) {
            <span class="hljs-keyword">return</span> Mono.error(<span class="hljs-keyword">new</span> <span class="hljs-title class_">McpError</span>(<span class="hljs-string">"Failed to wait for the message endpoint"</span>));
        }

        <span class="hljs-comment">// è·å–å‘é€æ¶ˆæ¯çš„ç«¯ç‚¹</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">endpoint</span> <span class="hljs-operator">=</span> messageEndpoint.get();
        <span class="hljs-keyword">if</span> (endpoint == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> Mono.error(<span class="hljs-keyword">new</span> <span class="hljs-title class_">McpError</span>(<span class="hljs-string">"No message endpoint available"</span>));
        }

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// åºåˆ—åŒ–æ¶ˆæ¯ï¼Œå°† JSON-RPC æ¶ˆæ¯è½¬åŒ–ä¸ºå­—ç¬¦ä¸²</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">jsonText</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.objectMapper.writeValueAsString(message);
            <span class="hljs-comment">// æ‹¼æ¥ URIï¼ˆbaseUri + messageEndpointï¼‰</span>
            <span class="hljs-type">URI</span> <span class="hljs-variable">requestUri</span> <span class="hljs-operator">=</span> Utils.resolveUri(baseUri, endpoint);
            <span class="hljs-comment">// æ„å»º POST è¯·æ±‚</span>
            <span class="hljs-type">HttpRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.requestBuilder.uri(requestUri)
                    .POST(HttpRequest.BodyPublishers.ofString(jsonText))
                    .build();

            <span class="hljs-keyword">return</span> Mono.fromFuture(
                    <span class="hljs-comment">// å¼‚æ­¥å‘é€ HTTP è¯·æ±‚</span>
                    httpClient.sendAsync(request, HttpResponse.BodyHandlers.discarding()).thenAccept(response -&gt; {
                        <span class="hljs-keyword">if</span> (response.statusCode() != <span class="hljs-number">200</span> &amp;&amp; response.statusCode() != <span class="hljs-number">201</span> &amp;&amp; response.statusCode() != <span class="hljs-number">202</span>
                                &amp;&amp; response.statusCode() != <span class="hljs-number">206</span>) {
                            logger.error(<span class="hljs-string">"Error sending message: {}"</span>, response.statusCode());
                        }
                    }));
        }
        <span class="hljs-keyword">catch</span> (IOException e) {
            <span class="hljs-keyword">if</span> (!isClosing) {
                <span class="hljs-keyword">return</span> Mono.error(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"Failed to serialize message"</span>, e));
            }
            <span class="hljs-keyword">return</span> Mono.empty();
        }
    }

    <span class="hljs-comment">/**
     * ä¼˜é›…åœ°å…³é—­ä¼ è¾“è¿æ¥ï¼Œå°†é˜»æ­¢æ–°çš„æ¶ˆæ¯å‘é€ï¼Œå¹¶å…è®¸æ­£åœ¨è¿›è¡Œçš„æ“ä½œå®Œæˆ
     *
     * <span class="hljs-doctag">@return</span> Monoï¼Œå½“å…³é—­æˆåŠŸæ—¶å®Œæˆ
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Mono&lt;Void&gt; <span class="hljs-title function_">closeGracefully</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> Mono.fromRunnable(() -&gt; {
            <span class="hljs-comment">// è®¾ç½®å…³é—­æ ‡å¿—</span>
            isClosing = <span class="hljs-literal">true</span>;
            CompletableFuture&lt;Void&gt; future = connectionFuture.get();
            <span class="hljs-keyword">if</span> (future != <span class="hljs-literal">null</span> &amp;&amp; !future.isDone()) {
                <span class="hljs-comment">// å…³é—­è¿æ¥</span>
                future.cancel(<span class="hljs-literal">true</span>);
            }
        });
    }

    <span class="hljs-comment">/**
     * ä½¿ç”¨é…ç½®çš„å¯¹è±¡æ˜ å°„å™¨å°†æ•°æ®è§£æä¸ºæŒ‡å®šç±»å‹
     *
     * <span class="hljs-doctag">@param</span> data è§£æçš„æ•°æ®
     * <span class="hljs-doctag">@param</span> typeRef è½¬æ¢çš„ç›®æ ‡ç±»å‹
     * <span class="hljs-doctag">@return</span> è§£æåçš„å¯¹è±¡
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> &lt;T&gt; T <span class="hljs-title function_">unmarshalFrom</span><span class="hljs-params">(Object data, TypeReference&lt;T&gt; typeRef)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.objectMapper.convertValue(data, typeRef);
    }
}
</code></pre>
<h2 data-id="heading-5">3.2 æœåŠ¡ç«¯</h2>
<h3 data-id="heading-6">3.2.1 å…¥å£å±‚</h3>
<p>Â Â Â MCP æœåŠ¡ç«¯å…¥å£å±‚æ¶‰åŠåˆ°çš„ç±»åŒ…æ‹¬ <strong>McpServer</strong>ã€<strong>McpServer.AsyncSpecification</strong>ï¼ˆå†…éƒ¨ç±»ï¼‰ã€<strong>McpClient.SyncSpecification</strong>ï¼ˆå†…éƒ¨ç±»ï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/204df260dc45470bb614a5db65f6e3d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP55KQ5Lmx5pKe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763392204&amp;x-signature=frWZp0Lz%2FZdI8ZFT7c%2BN3CouuWU%3D" alt="" loading="lazy"/></p>
<p>Â Â Â ä¸å®¢æˆ·ç«¯ç±»ä¼¼ï¼Œå…¥å£å±‚ä¹Ÿæ˜¯åˆ›å»º MCP æœåŠ¡ç«¯çš„ç»Ÿä¸€å…¥å£ï¼Œé€šè¿‡é™æ€æ–¹æ³• <code>sync()</code> å’Œ <code>async()</code> æä¾›äº†åŒæ­¥å’Œå¼‚æ­¥ä¸¤ç§æ¨¡å¼çš„æ„å»ºæ–¹å¼ï¼Œåˆ†åˆ«è¿”å› <code>SyncSpecification</code> å’Œ <code>AyncSpecification</code> è¿™ä¸¤ä¸ªå†…éƒ¨æ„å»ºå™¨ç±»ï¼Œç”¨äºé…ç½®å®¢æˆ·ç«¯å®ä¾‹çš„å„é¡¹å‚æ•°å¹¶æœ€ç»ˆç”Ÿæˆå¯¹åº”çš„ <code>McpSyncServer</code> å’Œ<code> McpAsyncServer</code>ã€‚</p>
<p>Â Â Â å¹¶ä¸”ï¼Œ<code>AyncSpecification</code> å’Œ <code>SyncSpecification</code> çš„è®¾è®¡ä¹Ÿååˆ†ç›¸ä¼¼ï¼Œéƒ½å°è£…äº†é…ç½®ä¿¡æ¯ï¼Œä¸”å®ƒä»¬å†…éƒ¨çš„æ–¹æ³•ï¼ˆå¦‚ <code>serverInfo()</code>ã€<code>capabilities()</code>ï¼‰éƒ½åªæ˜¯å¯¹æ„å»ºå™¨å†…æˆå‘˜å˜é‡å’Œçš„ç®€å•èµ‹å€¼ã€‚è€Œä¸åŒçš„æ˜¯ï¼Œå¼‚æ­¥æ¨¡å¼åœ¨å¤„ç†æœåŠ¡ç«¯çš„å˜æ›´é€šçŸ¥æ—¶ï¼Œæ˜¯åŸºäº Reactor çš„ <code>Mono</code> è¿›è¡Œå“åº”å¼è°ƒç”¨çš„ï¼Œè€ŒåŒæ­¥æ¨¡å¼åˆ™ä½¿ç”¨ä¼ ç»Ÿçš„ Consumer å›è°ƒæ–¹å¼ã€‚</p>
<p>Â Â Â æ ¸å¿ƒçš„å‚æ•°æè¿°å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>transportProvider</code>ï¼šä¼šè¯ç®¡ç†å±‚å®ç°å¯¹è±¡ã€‚</li>
<li><code>objectMappe</code>ï¼šå¯¹è±¡æ˜ å°„å™¨ï¼Œç”¨äºåºåˆ—åŒ–å’Œååºåˆ—åŒ– JSON æ¶ˆæ¯ã€‚</li>
<li><code>serverInfo</code>ï¼šæœåŠ¡ç«¯åŸºæœ¬ä¿¡æ¯ï¼ŒåŒ…å«æœåŠ¡ç«¯åå­—å’Œç‰ˆæœ¬,</li>
<li><code>capabilities</code>ï¼šæœåŠ¡ç«¯èƒ½åŠ›é…ç½®ï¼ŒåŒ…å«è¡¥å…¨ã€æ—¥å¿—ã€å·¥å…·ç­‰é…ç½®ã€‚</li>
<li><code>tools</code>ï¼šæœåŠ¡ç«¯å¯è°ƒç”¨çš„å·¥å…·åˆ—è¡¨ã€‚</li>
<li><code>requestTimeout</code>ï¼šè¯·æ±‚è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ 10sã€‚</li>
</ul>
<p>Â Â Â æ ¸å¿ƒçš„æºç åŠæ³¨é‡Šå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">/**
 * åˆ›å»º MCP æœåŠ¡ç«¯çš„å·¥å‚ç±»
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">McpServer</span> {

    <span class="hljs-comment">/**
     * æ„å»ºä¸€ä¸ªæä¾›é˜»å¡æ“ä½œçš„åŒæ­¥ MCP æœåŠ¡ç«¯
     *
     * <span class="hljs-doctag">@param</span> transportProvider MCP ä¼ è¾“å±‚å®ç°
     * <span class="hljs-doctag">@return</span> åŒæ­¥ MCP æœåŠ¡ç«¯æ„å»ºå™¨
     */</span>
    <span class="hljs-keyword">static</span> SyncSpecification <span class="hljs-title function_">sync</span><span class="hljs-params">(McpServerTransportProvider transportProvider)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SyncSpecification</span>(transportProvider);
    }

    <span class="hljs-comment">/**
     * æä¾›ä¸€ä¸ªéé˜»å¡æ“ä½œçš„å¼‚æ­¥ MCP æœåŠ¡ç«¯
     *
     * <span class="hljs-doctag">@param</span> transportProvider MCP ä¼šè¯ç®¡ç†å¯¹è±¡
     * <span class="hljs-doctag">@return</span> å¼‚æ­¥ MCP æœåŠ¡ç«¯æ„å»ºå™¨
     */</span>
    <span class="hljs-keyword">static</span> AsyncSpecification <span class="hljs-title function_">async</span><span class="hljs-params">(McpServerTransportProvider transportProvider)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AsyncSpecification</span>(transportProvider);
    }

    <span class="hljs-comment">/**
     * å¼‚æ­¥ MCP æœåŠ¡ç«¯æ„å»ºå™¨
     */</span>
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">AsyncSpecification</span> {

        <span class="hljs-comment">// é»˜è®¤æœåŠ¡ç«¯åŸºæœ¬ä¿¡æ¯</span>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> McpSchema.<span class="hljs-type">Implementation</span> <span class="hljs-variable">DEFAULT_SERVER_INFO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpSchema</span>.Implementation(<span class="hljs-string">"mcp-server"</span>,
                <span class="hljs-string">"1.0.0"</span>);

        <span class="hljs-comment">// ä¼šè¯ç®¡ç†å¯¹è±¡</span>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> McpServerTransportProvider transportProvider;

        <span class="hljs-comment">// JSON å¯¹è±¡æ˜ å°„å™¨ï¼Œç”¨äºæ¶ˆæ¯åºåˆ—åŒ–/ååºåˆ—åŒ–</span>
        <span class="hljs-keyword">private</span> ObjectMapper objectMapper;

        <span class="hljs-comment">// æœåŠ¡ç«¯åŸºæœ¬ä¿¡æ¯</span>
        <span class="hljs-keyword">private</span> McpSchema.<span class="hljs-type">Implementation</span> <span class="hljs-variable">serverInfo</span> <span class="hljs-operator">=</span> DEFAULT_SERVER_INFO;

        <span class="hljs-comment">// æœåŠ¡ç«¯æ”¯æŒçš„åŠŸèƒ½</span>
        <span class="hljs-keyword">private</span> McpSchema.ServerCapabilities serverCapabilities;

        <span class="hljs-comment">// æœåŠ¡ç«¯å¯è°ƒç”¨çš„å·¥å…·åˆ—è¡¨</span>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;McpServerFeatures.AsyncToolSpecification&gt; tools = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

        <span class="hljs-comment">// è¯·æ±‚è¶…æ—¶æ—¶é—´</span>
        <span class="hljs-keyword">private</span> <span class="hljs-type">Duration</span> <span class="hljs-variable">requestTimeout</span> <span class="hljs-operator">=</span> Duration.ofSeconds(<span class="hljs-number">10</span>);

        <span class="hljs-comment">// å…¶ä»–å±æ€§çœç•¥...</span>

        <span class="hljs-keyword">private</span> <span class="hljs-title function_">AsyncSpecification</span><span class="hljs-params">(McpServerTransportProvider transportProvider)</span> {
            Assert.notNull(transportProvider, <span class="hljs-string">"Transport provider must not be null"</span>);
            <span class="hljs-built_in">this</span>.transportProvider = transportProvider;
        }

        <span class="hljs-comment">/**
         * è®¾ç½®å¯¹è±¡æ˜ å°„å™¨
         */</span>
        <span class="hljs-keyword">public</span> AsyncSpecification <span class="hljs-title function_">objectMapper</span><span class="hljs-params">(ObjectMapper objectMapper)</span> {
            Assert.notNull(objectMapper, <span class="hljs-string">"ObjectMapper must not be null"</span>);
            <span class="hljs-built_in">this</span>.objectMapper = objectMapper;
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
        }

        <span class="hljs-comment">/**
         * è®¾ç½®æœåŠ¡ç«¯åŸºæœ¬ä¿¡æ¯
         */</span>
        <span class="hljs-keyword">public</span> AsyncSpecification <span class="hljs-title function_">serverInfo</span><span class="hljs-params">(McpSchema.Implementation serverInfo)</span> {
            Assert.notNull(serverInfo, <span class="hljs-string">"Server info must not be null"</span>);
            <span class="hljs-built_in">this</span>.serverInfo = serverInfo;
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
        }

        <span class="hljs-comment">/**
         * è®¾ç½®æœåŠ¡ç«¯æ”¯æŒçš„åŠŸèƒ½
         */</span>
        <span class="hljs-keyword">public</span> AsyncSpecification <span class="hljs-title function_">capabilities</span><span class="hljs-params">(McpSchema.ServerCapabilities serverCapabilities)</span> {
            Assert.notNull(serverCapabilities, <span class="hljs-string">"Server capabilities must not be null"</span>);
            <span class="hljs-built_in">this</span>.serverCapabilities = serverCapabilities;
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
        }

        <span class="hljs-comment">/**
         * æ·»åŠ å·¥å…·
         */</span>
        <span class="hljs-keyword">public</span> AsyncSpecification <span class="hljs-title function_">tools</span><span class="hljs-params">(List&lt;McpServerFeatures.AsyncToolSpecification&gt; toolSpecifications)</span> {
            Assert.notNull(toolSpecifications, <span class="hljs-string">"Tool handlers list must not be null"</span>);
            <span class="hljs-built_in">this</span>.tools.addAll(toolSpecifications);
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
        }

        <span class="hljs-comment">/**
         * è®¾ç½®è¶…æ—¶æ—¶é—´
         */</span>
        <span class="hljs-keyword">public</span> AsyncSpecification <span class="hljs-title function_">requestTimeout</span><span class="hljs-params">(Duration requestTimeout)</span> {
            Assert.notNull(requestTimeout, <span class="hljs-string">"Request timeout must not be null"</span>);
            <span class="hljs-built_in">this</span>.requestTimeout = requestTimeout;
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
        }

        <span class="hljs-comment">/**
         * æ„å»ºå¼‚æ­¥ MCP æœåŠ¡ç«¯
         */</span>
        <span class="hljs-keyword">public</span> McpAsyncServer <span class="hljs-title function_">build</span><span class="hljs-params">()</span> {
            <span class="hljs-type">var</span> <span class="hljs-variable">features</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpServerFeatures</span>.Async(<span class="hljs-built_in">this</span>.serverInfo, <span class="hljs-built_in">this</span>.serverCapabilities, <span class="hljs-built_in">this</span>.tools,
                    <span class="hljs-built_in">this</span>.resources, <span class="hljs-built_in">this</span>.resourceTemplates, <span class="hljs-built_in">this</span>.prompts, <span class="hljs-built_in">this</span>.completions, <span class="hljs-built_in">this</span>.rootsChangeHandlers,
                    <span class="hljs-built_in">this</span>.instructions);
            <span class="hljs-type">var</span> <span class="hljs-variable">mapper</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.objectMapper != <span class="hljs-literal">null</span> ? <span class="hljs-built_in">this</span>.objectMapper : <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>();
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpAsyncServer</span>(<span class="hljs-built_in">this</span>.transportProvider, mapper, features, <span class="hljs-built_in">this</span>.requestTimeout,
                    <span class="hljs-built_in">this</span>.uriTemplateManagerFactory);
        }

        <span class="hljs-comment">// å…¶ä»–æ–¹æ³•çœç•¥...</span>
    }

    <span class="hljs-comment">/**
     * åŒæ­¥ MCP æœåŠ¡ç«¯æ„å»ºå™¨
     */</span>
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">SyncSpecification</span> {
        <span class="hljs-comment">// å¼‚æ­¥æ„å»ºå™¨çš„å±æ€§å’Œæ–¹æ³•ä¹Ÿæ˜¯ç±»ä¼¼çš„</span>

        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> McpSchema.<span class="hljs-type">Implementation</span> <span class="hljs-variable">DEFAULT_SERVER_INFO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpSchema</span>.Implementation(<span class="hljs-string">"mcp-server"</span>,
                <span class="hljs-string">"1.0.0"</span>);

        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> McpServerTransportProvider transportProvider;

        <span class="hljs-keyword">private</span> ObjectMapper objectMapper;

        <span class="hljs-keyword">private</span> McpSchema.<span class="hljs-type">Implementation</span> <span class="hljs-variable">serverInfo</span> <span class="hljs-operator">=</span> DEFAULT_SERVER_INFO;

        <span class="hljs-keyword">private</span> McpSchema.ServerCapabilities serverCapabilities;

        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;McpServerFeatures.SyncToolSpecification&gt; tools = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

        <span class="hljs-keyword">private</span> <span class="hljs-type">Duration</span> <span class="hljs-variable">requestTimeout</span> <span class="hljs-operator">=</span> Duration.ofSeconds(<span class="hljs-number">10</span>);

        <span class="hljs-comment">// å…¶ä»–å±æ€§çœç•¥...</span>

        <span class="hljs-keyword">private</span> <span class="hljs-title function_">SyncSpecification</span><span class="hljs-params">(McpServerTransportProvider transportProvider)</span> {
            Assert.notNull(transportProvider, <span class="hljs-string">"Transport provider must not be null"</span>);
            <span class="hljs-built_in">this</span>.transportProvider = transportProvider;
        }

        <span class="hljs-keyword">public</span> SyncSpecification <span class="hljs-title function_">objectMapper</span><span class="hljs-params">(ObjectMapper objectMapper)</span> {
            Assert.notNull(objectMapper, <span class="hljs-string">"ObjectMapper must not be null"</span>);
            <span class="hljs-built_in">this</span>.objectMapper = objectMapper;
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
        }

        <span class="hljs-keyword">public</span> SyncSpecification <span class="hljs-title function_">serverInfo</span><span class="hljs-params">(McpSchema.Implementation serverInfo)</span> {
            Assert.notNull(serverInfo, <span class="hljs-string">"Server info must not be null"</span>);
            <span class="hljs-built_in">this</span>.serverInfo = serverInfo;
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
        }

        <span class="hljs-keyword">public</span> SyncSpecification <span class="hljs-title function_">capabilities</span><span class="hljs-params">(McpSchema.ServerCapabilities serverCapabilities)</span> {
            Assert.notNull(serverCapabilities, <span class="hljs-string">"Server capabilities must not be null"</span>);
            <span class="hljs-built_in">this</span>.serverCapabilities = serverCapabilities;
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
        }

        <span class="hljs-keyword">public</span> SyncSpecification <span class="hljs-title function_">tools</span><span class="hljs-params">(List&lt;McpServerFeatures.SyncToolSpecification&gt; toolSpecifications)</span> {
            Assert.notNull(toolSpecifications, <span class="hljs-string">"Tool handlers list must not be null"</span>);
            <span class="hljs-built_in">this</span>.tools.addAll(toolSpecifications);
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
        }

        <span class="hljs-keyword">public</span> SyncSpecification <span class="hljs-title function_">requestTimeout</span><span class="hljs-params">(Duration requestTimeout)</span> {
            Assert.notNull(requestTimeout, <span class="hljs-string">"Request timeout must not be null"</span>);
            <span class="hljs-built_in">this</span>.requestTimeout = requestTimeout;
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
        }

        <span class="hljs-keyword">public</span> McpSyncServer <span class="hljs-title function_">build</span><span class="hljs-params">()</span> {
            <span class="hljs-comment">// ç”±äºã€ŒåŒæ­¥ã€æœåŠ¡ç«¯ä¾èµ–äºã€Œå¼‚æ­¥ã€æœåŠ¡ç«¯ï¼Œå› æ­¤è¿™é‡Œä¼šå…ˆåˆ›å»ºã€Œå¼‚æ­¥ã€æœåŠ¡ç«¯ï¼Œå†å°†å…¶ä½œä¸ºã€ŒåŒæ­¥ã€æœåŠ¡ç«¯çš„å±æ€§</span>
            McpServerFeatures.<span class="hljs-type">Sync</span> <span class="hljs-variable">syncFeatures</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpServerFeatures</span>.Sync(<span class="hljs-built_in">this</span>.serverInfo, <span class="hljs-built_in">this</span>.serverCapabilities,
                    <span class="hljs-built_in">this</span>.tools, <span class="hljs-built_in">this</span>.resources, <span class="hljs-built_in">this</span>.resourceTemplates, <span class="hljs-built_in">this</span>.prompts, <span class="hljs-built_in">this</span>.completions,
                    <span class="hljs-built_in">this</span>.rootsChangeHandlers, <span class="hljs-built_in">this</span>.instructions);
            McpServerFeatures.<span class="hljs-type">Async</span> <span class="hljs-variable">asyncFeatures</span> <span class="hljs-operator">=</span> McpServerFeatures.Async.fromSync(syncFeatures);
            <span class="hljs-type">var</span> <span class="hljs-variable">mapper</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.objectMapper != <span class="hljs-literal">null</span> ? <span class="hljs-built_in">this</span>.objectMapper : <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>();
            <span class="hljs-type">var</span> <span class="hljs-variable">asyncServer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpAsyncServer</span>(<span class="hljs-built_in">this</span>.transportProvider, mapper, asyncFeatures, <span class="hljs-built_in">this</span>.requestTimeout,
                    <span class="hljs-built_in">this</span>.uriTemplateManagerFactory);

            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpSyncServer</span>(asyncServer);
        }

        <span class="hljs-comment">// å…¶ä»–æ–¹æ³•çœç•¥...</span>
    }


}
</code></pre>
<h3 data-id="heading-7">3.2.2 è¿è¡Œå±‚</h3>
<p>Â Â Â MCP æœåŠ¡ç«¯è¿è¡Œå±‚æ¶‰åŠåˆ°çš„ç±»åŒ…æ‹¬ <strong>McpSyncServer</strong>ã€<strong>McpAsyncServer</strong>ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/803e820a05564035884b7bf08bd53522~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP55KQ5Lmx5pKe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763392204&amp;x-signature=Gz%2BfXmKyRo90PsawbEZYoopBbhU%3D" alt="" loading="lazy"/></p>
<p>Â Â Â åœ¨è°ƒç”¨å…¥å£å±‚ä¸­æ„å»ºå™¨çš„ <code>build()</code> æ–¹æ³•åï¼Œå°±èƒ½æ„å»ºå‡ºè¿è¡Œå±‚çš„æœåŠ¡ç«¯å¯¹è±¡ã€‚ä¸å®¢æˆ·ç«¯ç±»ä¼¼ï¼ŒåŒæ­¥æœåŠ¡ç«¯å¹¶æ²¡æœ‰ç‹¬ç«‹å®ç°å®é™…çš„ä¸šåŠ¡é€»è¾‘ï¼Œè€Œæ˜¯é€šè¿‡ç»„åˆçš„æ–¹å¼æŒæœ‰ä¸€ä¸ªå¼‚æ­¥æœåŠ¡ç«¯å®ä¾‹ï¼Œå¹¶<strong>å°†æ‰€æœ‰æ ¸å¿ƒæ–¹æ³•è°ƒç”¨å§”æ‰˜ç»™å®ƒæ‰§è¡Œ</strong>ã€‚å…¶æ ¸å¿ƒçš„æ–¹æ³•åŒ…æ‹¬ï¼š</p>
<ul>
<li><code>addTool()</code>ï¼šæ³¨å†Œä¸€ä¸ªå¯ç”¨çš„å·¥å…·ã€‚</li>
<li><code>removeTool()</code>ï¼šæ³¨é”€å·¥å…·ã€‚</li>
<li><code>notifyToolsListChanged()</code>ï¼šé€šçŸ¥å®¢æˆ·ç«¯å¯ç”¨å·¥å…·åˆ—è¡¨å·²æ›´æ”¹ã€‚</li>
<li><code>close()</code>ï¼šç«‹å³å…³é—­æœåŠ¡ç«¯è¿æ¥å’Œä¼šè¯èµ„æºã€‚</li>
<li><code>closeGracefully()</code>ï¼šæ‰§è¡Œä¼˜é›…å…³é—­æ“ä½œï¼Œç¡®ä¿æœªå®Œæˆçš„è¯·æ±‚æ­£å¸¸ç»“æŸã€‚</li>
</ul>
<p>Â Â Â æ ¸å¿ƒçš„æºç åŠæ³¨é‡Šå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">/**
 * MCP å¼‚æ­¥æœåŠ¡ç«¯
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">McpAsyncServer</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(McpAsyncServer.class);

    <span class="hljs-comment">// ä¼šè¯ç®¡ç†å±‚å¯¹è±¡</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> McpServerTransportProvider mcpTransportProvider;

    <span class="hljs-comment">// å¯¹è±¡æ˜ å°„å™¨</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ObjectMapper objectMapper;

    <span class="hljs-comment">// æœåŠ¡ç«¯èƒ½åŠ›é…ç½®</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> McpSchema.ServerCapabilities serverCapabilities;

    <span class="hljs-comment">// æœåŠ¡ç«¯åŸºæœ¬ä¿¡æ¯</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> McpSchema.Implementation serverInfo;

    <span class="hljs-comment">// å·¥å…·åˆ—è¡¨</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> CopyOnWriteArrayList&lt;McpServerFeatures.AsyncToolSpecification&gt; tools = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CopyOnWriteArrayList</span>&lt;&gt;();

    <span class="hljs-comment">// å…¶ä»–å±æ€§çœç•¥...</span>

    <span class="hljs-comment">/**
     * MCP å¼‚æ­¥æœåŠ¡ç«¯æ„é€ æ–¹æ³•
     *
     * <span class="hljs-doctag">@param</span> mcpTransportProvider ä¼šè¯ç®¡ç†å±‚å¯¹è±¡
     * <span class="hljs-doctag">@param</span> objectMapper å¯¹è±¡æ˜ å°„å™¨
     * <span class="hljs-doctag">@param</span> features æœåŠ¡ç«¯ç‰¹å¾
     * <span class="hljs-doctag">@param</span> requestTimeout è¯·æ±‚è¶…æ—¶æ—¶é—´
     */</span>
    McpAsyncServer(McpServerTransportProvider mcpTransportProvider, ObjectMapper objectMapper,
                   McpServerFeatures.Async features, Duration requestTimeout,
                   McpUriTemplateManagerFactory uriTemplateManagerFactory) {
        <span class="hljs-built_in">this</span>.mcpTransportProvider = mcpTransportProvider;
        <span class="hljs-built_in">this</span>.objectMapper = objectMapper;
        <span class="hljs-built_in">this</span>.serverInfo = features.serverInfo();
        <span class="hljs-built_in">this</span>.serverCapabilities = features.serverCapabilities();
        <span class="hljs-built_in">this</span>.instructions = features.instructions();
        <span class="hljs-built_in">this</span>.tools.addAll(features.tools());
        <span class="hljs-built_in">this</span>.resources.putAll(features.resources());
        <span class="hljs-built_in">this</span>.resourceTemplates.addAll(features.resourceTemplates());
        <span class="hljs-built_in">this</span>.prompts.putAll(features.prompts());
        <span class="hljs-built_in">this</span>.completions.putAll(features.completions());
        <span class="hljs-built_in">this</span>.uriTemplateManagerFactory = uriTemplateManagerFactory;

        Map&lt;String, McpServerSession.RequestHandler&lt;?&gt;&gt; requestHandlers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();

        <span class="hljs-comment">// åˆå§‹åŒ–æ¯ä¸ª MCP æ–¹æ³•å¯¹åº”çš„å¤„ç†å™¨</span>

        <span class="hljs-comment">// æ·»åŠ  PING æ–¹æ³•å¤„ç†å™¨</span>
        requestHandlers.put(McpSchema.METHOD_PING, (exchange, params) -&gt; Mono.just(Map.of()));

        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.serverCapabilities.tools() != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// æ·»åŠ åˆ—å‡ºå·¥å…·åˆ—è¡¨å¤„ç†å™¨</span>
            requestHandlers.put(McpSchema.METHOD_TOOLS_LIST, toolsListRequestHandler());
            <span class="hljs-comment">// æ·»åŠ å·¥å…·è°ƒç”¨å¤„ç†å™¨</span>
            requestHandlers.put(McpSchema.METHOD_TOOLS_CALL, toolsCallRequestHandler());
        }

        <span class="hljs-comment">// æ·»åŠ èµ„æºå¤„ç†å™¨</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.serverCapabilities.resources() != <span class="hljs-literal">null</span>) {
            requestHandlers.put(McpSchema.METHOD_RESOURCES_LIST, resourcesListRequestHandler());
            requestHandlers.put(McpSchema.METHOD_RESOURCES_READ, resourcesReadRequestHandler());
            requestHandlers.put(McpSchema.METHOD_RESOURCES_TEMPLATES_LIST, resourceTemplateListRequestHandler());
        }

        <span class="hljs-comment">// æ·»åŠ æ¨¡æ¿å¤„ç†å™¨</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.serverCapabilities.prompts() != <span class="hljs-literal">null</span>) {
            requestHandlers.put(McpSchema.METHOD_PROMPT_LIST, promptsListRequestHandler());
            requestHandlers.put(McpSchema.METHOD_PROMPT_GET, promptsGetRequestHandler());
        }

        <span class="hljs-comment">// æ·»åŠ æ—¥å¿—å¤„ç†å™¨</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.serverCapabilities.logging() != <span class="hljs-literal">null</span>) {
            requestHandlers.put(McpSchema.METHOD_LOGGING_SET_LEVEL, setLoggerRequestHandler());
        }

        <span class="hljs-comment">// æ·»åŠ è‡ªåŠ¨è¡¥å…¨å¤„ç†å™¨</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.serverCapabilities.completions() != <span class="hljs-literal">null</span>) {
            requestHandlers.put(McpSchema.METHOD_COMPLETION_COMPLETE, completionCompleteRequestHandler());
        }

        <span class="hljs-comment">// åˆå§‹åŒ–æ¯ä¸ªé€šçŸ¥æ–¹æ³•å¯¹åº”çš„å¤„ç†å™¨</span>
        Map&lt;String, McpServerSession.NotificationHandler&gt; notificationHandlers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();

        <span class="hljs-comment">// æ·»åŠ åˆå§‹åŒ–å®Œæˆé€šçŸ¥å¤„ç†å™¨</span>
        notificationHandlers.put(McpSchema.METHOD_NOTIFICATION_INITIALIZED, (exchange, params) -&gt; Mono.empty());

        <span class="hljs-comment">// æ ¹åˆ—è¡¨å˜æ›´æ¶ˆè´¹è€…</span>
        List&lt;BiFunction&lt;McpAsyncServerExchange, List&lt;McpSchema.Root&gt;, Mono&lt;Void&gt;&gt;&gt; rootsChangeConsumers = features
                .rootsChangeConsumers();

        <span class="hljs-keyword">if</span> (Utils.isEmpty(rootsChangeConsumers)) {
            rootsChangeConsumers = List.of((exchange, roots) -&gt; Mono.fromRunnable(() -&gt; logger
                    .warn(<span class="hljs-string">"Roots list changed notification, but no consumers provided. Roots list changed: {}"</span>, roots)));
        }

        <span class="hljs-comment">// æ·»åŠ æ ¹åˆ—è¡¨å˜æ›´é€šçŸ¥å¤„ç†å™¨</span>
        notificationHandlers.put(McpSchema.METHOD_NOTIFICATION_ROOTS_LIST_CHANGED,
                asyncRootsListChangedNotificationHandler(rootsChangeConsumers));

        <span class="hljs-comment">// è®¾ç½®ä¼šè¯å·¥å‚å¯¹è±¡</span>
        mcpTransportProvider.setSessionFactory(
                transport -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpServerSession</span>(UUID.randomUUID().toString(), requestTimeout, transport,
                        <span class="hljs-built_in">this</span>::asyncInitializeRequestHandler, Mono::empty, requestHandlers, notificationHandlers));
    }

    <span class="hljs-comment">/**
     * åˆå§‹åŒ–å¤„ç†å™¨
     *
     * <span class="hljs-doctag">@param</span> initializeRequest åˆå§‹åŒ–è¯·æ±‚
     * <span class="hljs-doctag">@return</span> Monoï¼Œåˆå§‹åŒ–åå®Œæˆ
     */</span>
    <span class="hljs-keyword">private</span> Mono&lt;McpSchema.InitializeResult&gt; asyncInitializeRequestHandler(
            McpSchema.InitializeRequest initializeRequest) {
        <span class="hljs-keyword">return</span> Mono.defer(() -&gt; {
            logger.info(<span class="hljs-string">"Client initialize request - Protocol: {}, Capabilities: {}, Info: {}"</span>,
                    initializeRequest.protocolVersion(), initializeRequest.capabilities(),
                    initializeRequest.clientInfo());

            <span class="hljs-comment">// éœ€è¦è¿”å›çš„æœåŠ¡ç«¯åè®®ç‰ˆæœ¬ï¼Œä¸ºå½“å‰æ”¯æŒçš„æœ€é«˜åè®®ç‰ˆæœ¬</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">serverProtocolVersion</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.protocolVersions.get(<span class="hljs-built_in">this</span>.protocolVersions.size() - <span class="hljs-number">1</span>);

            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.protocolVersions.contains(initializeRequest.protocolVersion())) {
                <span class="hljs-comment">// å¦‚æœæœåŠ¡ç«¯æ”¯æŒå®¢æˆ·ç«¯è¯·æ±‚æ—¶æŒ‡å®šçš„åè®®ç‰ˆæœ¬ï¼Œåˆ™å“åº”ç›¸åŒçš„ç‰ˆæœ¬</span>
                serverProtocolVersion = initializeRequest.protocolVersion();
            }
            <span class="hljs-keyword">else</span> {
                logger.warn(
                        <span class="hljs-string">"Client requested unsupported protocol version: {}, so the server will suggest the {} version instead"</span>,
                        initializeRequest.protocolVersion(), serverProtocolVersion);
            }

            <span class="hljs-comment">// å°†æœåŠ¡ç«¯çš„èƒ½åŠ›é…ç½®ã€åŸºæœ¬ä¿¡æ¯ç­‰è¿”å›ç»™å®¢æˆ·ç«¯</span>
            <span class="hljs-keyword">return</span> Mono.just(<span class="hljs-keyword">new</span> <span class="hljs-title class_">McpSchema</span>.InitializeResult(serverProtocolVersion, <span class="hljs-built_in">this</span>.serverCapabilities,
                    <span class="hljs-built_in">this</span>.serverInfo, <span class="hljs-built_in">this</span>.instructions));
        });
    }

    <span class="hljs-comment">/**
     * ä¼˜é›…å…³é—­æœåŠ¡ç«¯
     */</span>
    <span class="hljs-keyword">public</span> Mono&lt;Void&gt; <span class="hljs-title function_">closeGracefully</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.mcpTransportProvider.closeGracefully();
    }

    <span class="hljs-comment">/**
     * Close the server immediately.
     */</span>
    <span class="hljs-comment">/**
     * ç«‹å³å…³é—­æœåŠ¡ç«¯
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">this</span>.mcpTransportProvider.close();
    }

    <span class="hljs-comment">/**
     * æ·»åŠ æ–°çš„å·¥å…·
     *
     * <span class="hljs-doctag">@param</span> toolSpecification è¦æ·»åŠ çš„å·¥å…·è§„èŒƒ
     * <span class="hljs-doctag">@return</span> Monoï¼Œå‘å®¢æˆ·ç«¯å‘é€é€šçŸ¥åè¿”å›
     */</span>
    <span class="hljs-keyword">public</span> Mono&lt;Void&gt; <span class="hljs-title function_">addTool</span><span class="hljs-params">(McpServerFeatures.AsyncToolSpecification toolSpecification)</span> {
        <span class="hljs-keyword">if</span> (toolSpecification == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> Mono.error(<span class="hljs-keyword">new</span> <span class="hljs-title class_">McpError</span>(<span class="hljs-string">"Tool specification must not be null"</span>));
        }
        <span class="hljs-keyword">if</span> (toolSpecification.tool() == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> Mono.error(<span class="hljs-keyword">new</span> <span class="hljs-title class_">McpError</span>(<span class="hljs-string">"Tool must not be null"</span>));
        }
        <span class="hljs-keyword">if</span> (toolSpecification.call() == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> Mono.error(<span class="hljs-keyword">new</span> <span class="hljs-title class_">McpError</span>(<span class="hljs-string">"Tool call handler must not be null"</span>));
        }
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.serverCapabilities.tools() == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> Mono.error(<span class="hljs-keyword">new</span> <span class="hljs-title class_">McpError</span>(<span class="hljs-string">"Server must be configured with tool capabilities"</span>));
        }

        <span class="hljs-keyword">return</span> Mono.defer(() -&gt; {
            <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦å­˜åœ¨é‡å¤åå­—çš„å·¥å…·ï¼Œå¦‚æœå­˜åœ¨ç›´æ¥è¿”å›é”™è¯¯ä¿¡æ¯</span>
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.tools.stream().anyMatch(th -&gt; th.tool().name().equals(toolSpecification.tool().name()))) {
                <span class="hljs-keyword">return</span> Mono
                        .error(<span class="hljs-keyword">new</span> <span class="hljs-title class_">McpError</span>(<span class="hljs-string">"Tool with name '"</span> + toolSpecification.tool().name() + <span class="hljs-string">"' already exists"</span>));
            }

            <span class="hljs-built_in">this</span>.tools.add(toolSpecification);
            logger.debug(<span class="hljs-string">"Added tool handler: {}"</span>, toolSpecification.tool().name());

            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.serverCapabilities.tools().listChanged()) {
                <span class="hljs-comment">// å¦‚æœå¼€å¯é€šçŸ¥é…ç½®ï¼Œåˆ™é€šçŸ¥å®¢æˆ·ç«¯å·¥å…·åˆ—è¡¨å˜æ›´</span>
                <span class="hljs-keyword">return</span> notifyToolsListChanged();
            }
            <span class="hljs-keyword">return</span> Mono.empty();
        });
    }

    <span class="hljs-comment">/**
     * ç§»é™¤å·¥å…·
     *
     * <span class="hljs-doctag">@param</span> toolName ç§»é™¤çš„å·¥å…·å
     * <span class="hljs-doctag">@return</span> Monoï¼Œå‘å®¢æˆ·ç«¯å‘é€é€šçŸ¥åå®Œæˆ
     */</span>
    <span class="hljs-keyword">public</span> Mono&lt;Void&gt; <span class="hljs-title function_">removeTool</span><span class="hljs-params">(String toolName)</span> {
        <span class="hljs-keyword">if</span> (toolName == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> Mono.error(<span class="hljs-keyword">new</span> <span class="hljs-title class_">McpError</span>(<span class="hljs-string">"Tool name must not be null"</span>));
        }
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.serverCapabilities.tools() == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> Mono.error(<span class="hljs-keyword">new</span> <span class="hljs-title class_">McpError</span>(<span class="hljs-string">"Server must be configured with tool capabilities"</span>));
        }

        <span class="hljs-keyword">return</span> Mono.defer(() -&gt; {
            <span class="hljs-comment">// ç§»é™¤å·¥å…·</span>
            <span class="hljs-type">boolean</span> <span class="hljs-variable">removed</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.tools
                    .removeIf(toolSpecification -&gt; toolSpecification.tool().name().equals(toolName));
            <span class="hljs-keyword">if</span> (removed) {
                logger.debug(<span class="hljs-string">"Removed tool handler: {}"</span>, toolName);
                <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.serverCapabilities.tools().listChanged()) {
                    <span class="hljs-comment">// å¦‚æœå¼€å¯é€šçŸ¥é…ç½®ï¼Œåˆ™é€šçŸ¥å®¢æˆ·ç«¯å·¥å…·åˆ—è¡¨å˜æ›´</span>
                    <span class="hljs-keyword">return</span> notifyToolsListChanged();
                }
                <span class="hljs-keyword">return</span> Mono.empty();
            }
            <span class="hljs-comment">// å¦‚æœä¸å­˜åœ¨å¯¹åº”åå­—çš„å·¥å…·ï¼Œå³ç§»é™¤å¤±è´¥ï¼Œåˆ™è¿”å›é”™è¯¯ä¿¡æ¯</span>
            <span class="hljs-keyword">return</span> Mono.error(<span class="hljs-keyword">new</span> <span class="hljs-title class_">McpError</span>(<span class="hljs-string">"Tool with name '"</span> + toolName + <span class="hljs-string">"' not found"</span>));
        });
    }

    <span class="hljs-comment">/**
     * é€šçŸ¥å®¢æˆ·ç«¯å¯ç”¨å·¥å…·åˆ—è¡¨å·²æ›´æ”¹
     *
     * <span class="hljs-doctag">@return</span> Monoï¼Œé€šçŸ¥åå®Œæˆ
     */</span>
    <span class="hljs-keyword">public</span> Mono&lt;Void&gt; <span class="hljs-title function_">notifyToolsListChanged</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// è°ƒç”¨ä¼šè¯ç®¡ç†å±‚å¯¹è±¡æ¥é€šçŸ¥</span>
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.mcpTransportProvider.notifyClients(McpSchema.METHOD_NOTIFICATION_TOOLS_LIST_CHANGED, <span class="hljs-literal">null</span>);
    }

    <span class="hljs-comment">/**
     * åˆ—å‡ºå·¥å…·åˆ—è¡¨å¤„ç†å™¨
     *
     * <span class="hljs-doctag">@return</span> å·¥å…·åˆ—è¡¨
     */</span>
    <span class="hljs-keyword">private</span> McpServerSession.RequestHandler&lt;McpSchema.ListToolsResult&gt; toolsListRequestHandler() {
        <span class="hljs-keyword">return</span> (exchange, params) -&gt; {
            List&lt;Tool&gt; tools = <span class="hljs-built_in">this</span>.tools.stream().map(McpServerFeatures.AsyncToolSpecification::tool).toList();

            <span class="hljs-keyword">return</span> Mono.just(<span class="hljs-keyword">new</span> <span class="hljs-title class_">McpSchema</span>.ListToolsResult(tools, <span class="hljs-literal">null</span>));
        };
    }

    <span class="hljs-comment">/**
     * å·¥å…·è°ƒç”¨å¤„ç†å™¨
     *
     * <span class="hljs-doctag">@return</span> å·¥å…·è°ƒç”¨ç»“æœ
     */</span>
    <span class="hljs-keyword">private</span> McpServerSession.RequestHandler&lt;CallToolResult&gt; <span class="hljs-title function_">toolsCallRequestHandler</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> (exchange, params) -&gt; {
            <span class="hljs-comment">// å°†è¯·æ±‚å‚æ•°è½¬æ¢ä¸º CallToolRequest å¯¹è±¡</span>
            McpSchema.<span class="hljs-type">CallToolRequest</span> <span class="hljs-variable">callToolRequest</span> <span class="hljs-operator">=</span> objectMapper.convertValue(params,
                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeReference</span>&lt;McpSchema.CallToolRequest&gt;() {
                    });

            <span class="hljs-comment">// è·å–éœ€è¦è°ƒç”¨çš„å·¥å…·</span>
            Optional&lt;McpServerFeatures.AsyncToolSpecification&gt; toolSpecification = <span class="hljs-built_in">this</span>.tools.stream()
                    .filter(tr -&gt; callToolRequest.name().equals(tr.tool().name()))
                    .findAny();

            <span class="hljs-keyword">if</span> (toolSpecification.isEmpty()) {
                <span class="hljs-comment">// å¦‚æœæ²¡æ‰¾åˆ°å·¥å…·ï¼Œåˆ™è¿”å›é”™è¯¯ä¿¡æ¯</span>
                <span class="hljs-keyword">return</span> Mono.error(<span class="hljs-keyword">new</span> <span class="hljs-title class_">McpError</span>(<span class="hljs-string">"Tool not found: "</span> + callToolRequest.name()));
            }

            <span class="hljs-keyword">return</span> toolSpecification.map(tool -&gt; tool.call().apply(exchange, callToolRequest.arguments()))
                    .orElse(Mono.error(<span class="hljs-keyword">new</span> <span class="hljs-title class_">McpError</span>(<span class="hljs-string">"Tool not found: "</span> + callToolRequest.name())));
        };
    }

    <span class="hljs-comment">// å…¶ä»–æ–¹æ³•çœç•¥...</span>

}
</code></pre>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">/**
 * MCP åŒæ­¥æœåŠ¡ç«¯ï¼Œå°è£…äº† MCPAsyncServer æ¥æä¾›é˜»å¡æ“ä½œçš„ API
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">McpSyncServer</span> {

    <span class="hljs-comment">// å¼‚æ­¥æœåŠ¡ç«¯ä»£ç†ï¼Œå®é™…çš„è°ƒç”¨æ‰§è¡Œè€…</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> McpAsyncServer asyncServer;

    <span class="hljs-comment">/**
     * MCP åŒæ­¥å®¢æˆ·ç«¯æ„é€ æ–¹æ³•
     *
     * <span class="hljs-doctag">@param</span> asyncServer ä»£ç†ï¼Œå®é™…ä¸º MCP å¼‚æ­¥å®¢æˆ·ç«¯
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">McpSyncServer</span><span class="hljs-params">(McpAsyncServer asyncServer)</span> {
        Assert.notNull(asyncServer, <span class="hljs-string">"Async server must not be null"</span>);
        <span class="hljs-built_in">this</span>.asyncServer = asyncServer;
    }

    <span class="hljs-comment">// æ–¹æ³•ä¸å¼‚æ­¥æœåŠ¡ç«¯ç±»ä¼¼ï¼Œåªæ˜¯å†…éƒ¨é€»è¾‘éƒ½äº¤ç”±å¼‚æ­¥æœåŠ¡ç«¯æ¥å®Œæˆï¼Œä¸”ä¸ºé˜»å¡è¿‡ç¨‹</span>

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addTool</span><span class="hljs-params">(McpServerFeatures.SyncToolSpecification toolHandler)</span> {
        <span class="hljs-built_in">this</span>.asyncServer.addTool(McpServerFeatures.AsyncToolSpecification.fromSync(toolHandler)).block();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeTool</span><span class="hljs-params">(String toolName)</span> {
        <span class="hljs-built_in">this</span>.asyncServer.removeTool(toolName).block();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">notifyToolsListChanged</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">this</span>.asyncServer.notifyToolsListChanged().block();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">closeGracefully</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">this</span>.asyncServer.closeGracefully().block();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">this</span>.asyncServer.close();
    }

}
</code></pre>
<h3 data-id="heading-8">3.2.3 ä¼šè¯ç®¡ç†å±‚</h3>
<p>Â Â Â Â Â Â Â MCP æœåŠ¡ç«¯ä¼šè¯ç®¡ç†å±‚æ¶‰åŠåˆ°çš„ç±»åŒ…æ‹¬ <strong>McpServerTransportProvider</strong>ã€<strong>HttpServletSseServerTransportProvider</strong>ã€<strong>StdioServerTransportProvider</strong> ç­‰ï¼Œå…¶ä¸­ <code>HttpServletSseServerTransportProvider</code> å’Œ <code>StdioServerTransportProvider</code> ä¸º McpServerTransportProvider å®ç°ç±»ï¼Œåˆ†åˆ«å¯¹åº” SSEã€Stdio çš„å…·ä½“å®ç°ï¼Œè¿™é‡Œä»…åˆ—å‡ºä¸¤ç§ï¼Œå®é™…ä¸Šåº•å±‚ä½¿ç”¨äº†ä¸åŒçš„ä¼ è¾“åè®®ï¼Œä¼šå¯¹åº”ç€ä¸åŒçš„å®ç°ç±»ã€‚å…¶ç±»å›¾å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7893c0d31a4f4eefaaa56f9c99aee292~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP55KQ5Lmx5pKe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763392204&amp;x-signature=OyNT6K8ED%2FHMvcnUKUPhHb7DyeI%3D" alt="" loading="lazy"/></p>
<p>Â Â Â è¿™ä¸€å±‚æ˜¯ MCP æœåŠ¡ç«¯ç‰¹æœ‰çš„éƒ¨åˆ†ï¼Œç”¨äºç®¡ç†å¤šä¸ªå®¢æˆ·ç«¯ä¼šè¯ã€‚å…¶ä¸­ <code>McpServerTransportProvider</code> å®šä¹‰äº†ç›¸å…³çš„æ ¸å¿ƒæ–¹æ³•ï¼š</p>
<ul>
<li><code>setSessionFactory()</code>ï¼šè®¾ç½®å·¥å‚å¯¹è±¡ï¼Œç”¨äºä¸ºæ–°å®¢æˆ·ç«¯åˆ›å»ºä¼šè¯çš„å·¥å‚å¯¹è±¡ã€‚</li>
<li><code>notifyClients()</code>ï¼šå‘æ‰€æœ‰å·²è¿æ¥çš„å®¢æˆ·ç«¯å‘é€é€šçŸ¥ã€‚</li>
<li><code>close()</code>ï¼šç«‹å³å…³é—­æ‰€æœ‰å·²è¿æ¥å®¢æˆ·ç«¯çš„ä¼ è¾“å¹¶é‡Šæ”¾æ‰€æœ‰å…³è”èµ„æºã€‚</li>
<li><code>closeGracefully()</code>ï¼šä¼˜é›…åœ°å…³é—­æ‰€æœ‰å·²è¿æ¥å®¢æˆ·ç«¯çš„ä¼ è¾“å¹¶å¼‚æ­¥é‡Šæ”¾æ‰€æœ‰å…³è”èµ„æºã€‚</li>
</ul>
<p>Â Â Â æ ¸å¿ƒçš„æºç åŠæ³¨é‡Šå¦‚ä¸‹æ‰€ç¤ºï¼ˆå®ç°ç±»ä¸­ä»…ç»™å‡º <code>HttpServletSseServerTransportProvider</code> çš„å…·ä½“å®ç°ï¼Œå…¶ä»–çš„å®ç°ç±»æ˜¯ç±»ä¼¼çš„ï¼‰ï¼š</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">/**
 * ç”¨äºæ¡¥æ¥æœåŠ¡ç«¯å’Œ MCP æœåŠ¡å™¨ä¼ è¾“å±‚
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">McpServerTransportProvider</span> {

    <span class="hljs-comment">/**
     * è®¾ç½®å·¥å‚å¯¹è±¡ï¼Œç”¨äºä¸ºæ–°å®¢æˆ·ç«¯åˆ›å»ºä¼šè¯çš„å·¥å‚å¯¹è±¡
     *
     * <span class="hljs-doctag">@param</span> sessionFactory ä¼šè¯å·¥å‚
     */</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">setSessionFactory</span><span class="hljs-params">(McpServerSession.Factory sessionFactory)</span>;

    <span class="hljs-comment">/**
     * å‘æ‰€æœ‰å·²è¿æ¥çš„å®¢æˆ·ç«¯å‘é€é€šçŸ¥
     *
     * <span class="hljs-doctag">@param</span> method é€šçŸ¥æ–¹æ³•å
     * <span class="hljs-doctag">@param</span> params é€šçŸ¥æ–¹æ³•å¯¹åº”çš„å‚æ•°
     * <span class="hljs-doctag">@return</span> Monoï¼Œé€šçŸ¥åå®Œæˆ
     */</span>
    Mono&lt;Void&gt; <span class="hljs-title function_">notifyClients</span><span class="hljs-params">(String method, Object params)</span>;

    <span class="hljs-comment">/**
     * ç«‹å³å…³é—­æ‰€æœ‰å·²è¿æ¥å®¢æˆ·ç«¯çš„ä¼ è¾“å¹¶é‡Šæ”¾æ‰€æœ‰å…³è”èµ„æº
     */</span>
    <span class="hljs-keyword">default</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">this</span>.closeGracefully().subscribe();
    }

    <span class="hljs-comment">/**
     * ä¼˜é›…åœ°å…³é—­æ‰€æœ‰å·²è¿æ¥å®¢æˆ·ç«¯çš„ä¼ è¾“å¹¶å¼‚æ­¥é‡Šæ”¾æ‰€æœ‰å…³è”èµ„æº
     *
     * <span class="hljs-doctag">@return</span> Monoï¼Œå½“å…³é—­æˆåŠŸæ—¶å®Œæˆ
     */</span>
    Mono&lt;Void&gt; <span class="hljs-title function_">closeGracefully</span><span class="hljs-params">()</span>;

}
</code></pre>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-meta">@WebServlet(asyncSupported = true)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpServletSseServerTransportProvider</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HttpServlet</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">McpServerTransportProvider</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(HttpServletSseServerTransportProvider.class);

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">UTF_8</span> <span class="hljs-operator">=</span> <span class="hljs-string">"UTF-8"</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">APPLICATION_JSON</span> <span class="hljs-operator">=</span> <span class="hljs-string">"application/json"</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">FAILED_TO_SEND_ERROR_RESPONSE</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Failed to send error response: {}"</span>;

    <span class="hljs-comment">// é»˜è®¤çš„ SSE è¿æ¥ç«¯ç‚¹</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEFAULT_SSE_ENDPOINT</span> <span class="hljs-operator">=</span> <span class="hljs-string">"/sse"</span>;

    <span class="hljs-comment">// æ¶ˆæ¯äº‹ä»¶ç±»å‹</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">MESSAGE_EVENT_TYPE</span> <span class="hljs-operator">=</span> <span class="hljs-string">"message"</span>;

    <span class="hljs-comment">// ç«¯ç‚¹äº‹ä»¶ç±»å‹</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">ENDPOINT_EVENT_TYPE</span> <span class="hljs-operator">=</span> <span class="hljs-string">"endpoint"</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEFAULT_BASE_URL</span> <span class="hljs-operator">=</span> <span class="hljs-string">""</span>;

    <span class="hljs-comment">// å¯¹è±¡æ˜ å°„å™¨</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ObjectMapper objectMapper;

    <span class="hljs-comment">// æœåŠ¡ç«¯ä¼ è¾“åŸºæœ¬ url</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String baseUrl;

    <span class="hljs-comment">// æ¶ˆæ¯ç«¯ç‚¹ï¼Œç”¨äºå¤„ç†æœåŠ¡ç«¯å‘é€çš„æ¶ˆæ¯</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String messageEndpoint;

    <span class="hljs-comment">// SSE ç«¯ç‚¹ï¼Œç”¨äºå¤„ç† SSE è¿æ¥</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String sseEndpoint;

    <span class="hljs-comment">// æ´»è·ƒä¼šè¯ mapï¼Œkey ä¸ºä¼šè¯ id</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;String, McpServerSession&gt; sessions = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();

    <span class="hljs-comment">// æ ‡è®°ä¼ è¾“æ˜¯å¦æ­£åœ¨å…³é—­</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">AtomicBoolean</span> <span class="hljs-variable">isClosing</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicBoolean</span>(<span class="hljs-literal">false</span>);

    <span class="hljs-comment">// ä¼šè¯å·¥å‚ï¼Œç”¨äºåˆ›å»ºæ–°çš„ä¼šè¯</span>
    <span class="hljs-keyword">private</span> McpServerSession.Factory sessionFactory;

    <span class="hljs-comment">/**
     * æ„é€ æ–¹æ³•ï¼Œä½¿ç”¨é»˜è®¤çš„ baseUrl
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">HttpServletSseServerTransportProvider</span><span class="hljs-params">(ObjectMapper objectMapper, String messageEndpoint,
                                                 String sseEndpoint)</span> {
        <span class="hljs-built_in">this</span>(objectMapper, DEFAULT_BASE_URL, messageEndpoint, sseEndpoint);
    }

    <span class="hljs-comment">/**
     * æ„é€ æ–¹æ³•
     *
     * <span class="hljs-doctag">@param</span> objectMapper å¯¹è±¡æ˜ å°„å™¨
     * <span class="hljs-doctag">@param</span> baseUrl æœåŠ¡ç«¯åŸºæœ¬ url
     * <span class="hljs-doctag">@param</span> messageEndpoint æ¶ˆæ¯ç«¯ç‚¹
     * <span class="hljs-doctag">@param</span> sseEndpoint SSE ç«¯ç‚¹
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">HttpServletSseServerTransportProvider</span><span class="hljs-params">(ObjectMapper objectMapper, String baseUrl, String messageEndpoint,
                                                 String sseEndpoint)</span> {
        <span class="hljs-built_in">this</span>.objectMapper = objectMapper;
        <span class="hljs-built_in">this</span>.baseUrl = baseUrl;
        <span class="hljs-built_in">this</span>.messageEndpoint = messageEndpoint;
        <span class="hljs-built_in">this</span>.sseEndpoint = sseEndpoint;
    }

    <span class="hljs-comment">/**
     * è®¾ç½®å·¥å‚å¯¹è±¡ï¼Œç”¨äºä¸ºæ–°å®¢æˆ·ç«¯åˆ›å»ºä¼šè¯çš„å·¥å‚å¯¹è±¡
     *
     * <span class="hljs-doctag">@param</span> sessionFactory ä¼šè¯å·¥å‚
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setSessionFactory</span><span class="hljs-params">(McpServerSession.Factory sessionFactory)</span> {
        <span class="hljs-built_in">this</span>.sessionFactory = sessionFactory;
    }

    <span class="hljs-comment">/**
     * å‘æ‰€æœ‰å·²è¿æ¥çš„å®¢æˆ·ç«¯å‘é€é€šçŸ¥
     *
     * <span class="hljs-doctag">@param</span> method é€šçŸ¥æ–¹æ³•å
     * <span class="hljs-doctag">@param</span> params é€šçŸ¥æ–¹æ³•å¯¹åº”çš„å‚æ•°
     * <span class="hljs-doctag">@return</span> Monoï¼Œé€šçŸ¥åå®Œæˆ
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Mono&lt;Void&gt; <span class="hljs-title function_">notifyClients</span><span class="hljs-params">(String method, Object params)</span> {
        <span class="hljs-keyword">if</span> (sessions.isEmpty()) {
            <span class="hljs-comment">// æ— è¿æ¥ä¸­çš„ä¼šè¯ï¼Œç›´æ¥è¿”å›</span>
            logger.debug(<span class="hljs-string">"No active sessions to broadcast message to"</span>);
            <span class="hljs-keyword">return</span> Mono.empty();
        }

        logger.debug(<span class="hljs-string">"Attempting to broadcast message to {} active sessions"</span>, sessions.size());

        <span class="hljs-keyword">return</span> Flux.fromIterable(sessions.values())
                <span class="hljs-comment">// è°ƒç”¨ä¼šè¯å¯¹è±¡çš„æ–¹æ³•æ¥å‘é€é€šçŸ¥</span>
                .flatMap(session -&gt; session.sendNotification(method, params)
                        .doOnError(
                                e -&gt; logger.error(<span class="hljs-string">"Failed to send message to session {}: {}"</span>, session.getId(), e.getMessage()))
                        .onErrorComplete())
                .then();
    }

    <span class="hljs-comment">/**
     * å¤„ç† GET è¯·æ±‚æ¥å»ºç«‹ SSE è¿æ¥
     * <span class="hljs-doctag">@param</span> request HTTP Servlet è¯·æ±‚
     * <span class="hljs-doctag">@param</span> response HTTP Servlet å“åº”
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doGet</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span>
            <span class="hljs-keyword">throws</span> ServletException, IOException {

        <span class="hljs-comment">// è·å– uri</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">requestURI</span> <span class="hljs-operator">=</span> request.getRequestURI();
        <span class="hljs-keyword">if</span> (!requestURI.endsWith(sseEndpoint)) {
            <span class="hljs-comment">// åªå…è®¸ SSE ç«¯ç‚¹è¿æ¥è¯·æ±‚</span>
            response.sendError(HttpServletResponse.SC_NOT_FOUND);
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-keyword">if</span> (isClosing.get()) {
            <span class="hljs-comment">// è¿æ¥æ­£åœ¨è¢«å…³é—­æ—¶æ‹’ç»æ–°çš„è¯·æ±‚</span>
            response.sendError(HttpServletResponse.SC_SERVICE_UNAVAILABLE, <span class="hljs-string">"Server is shutting down"</span>);
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-comment">// è®¾ç½® SSE å“åº”å¤´</span>
        response.setContentType(<span class="hljs-string">"text/event-stream"</span>);
        response.setCharacterEncoding(UTF_8);
        response.setHeader(<span class="hljs-string">"Cache-Control"</span>, <span class="hljs-string">"no-cache"</span>);
        response.setHeader(<span class="hljs-string">"Connection"</span>, <span class="hljs-string">"keep-alive"</span>);
        response.setHeader(<span class="hljs-string">"Access-Control-Allow-Origin"</span>, <span class="hljs-string">"*"</span>);

        <span class="hljs-comment">// ç”Ÿæˆå”¯ä¸€ sessionId</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">sessionId</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString();
        <span class="hljs-comment">// å¼€å¯å¼‚æ­¥ä¸Šä¸‹æ–‡</span>
        <span class="hljs-type">AsyncContext</span> <span class="hljs-variable">asyncContext</span> <span class="hljs-operator">=</span> request.startAsync();
        <span class="hljs-comment">// è®¾ç½®è¿æ¥æ°¸ä¸è¿‡æœŸï¼Œå³ SSE è¿æ¥å¯é•¿æ—¶é—´ä¿æŒ</span>
        asyncContext.setTimeout(<span class="hljs-number">0</span>);

        <span class="hljs-type">PrintWriter</span> <span class="hljs-variable">writer</span> <span class="hljs-operator">=</span> response.getWriter();

        <span class="hljs-comment">// å°† sessionIdã€å¼‚æ­¥ä¸Šä¸‹æ–‡ã€å“åº”è¾“å‡ºæµå°è£…è¿›ä¼ è¾“å±‚å¯¹è±¡</span>
        <span class="hljs-type">HttpServletMcpSessionTransport</span> <span class="hljs-variable">sessionTransport</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpServletMcpSessionTransport</span>(sessionId, asyncContext,
                writer);

        <span class="hljs-comment">// ä½¿ç”¨ä¼šè¯å·¥å‚åˆ›å»ºä¸€ä¸ªæ–°çš„ session å¹¶æ³¨å†Œè¿› sessions</span>
        <span class="hljs-type">McpServerSession</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.create(sessionTransport);
        <span class="hljs-built_in">this</span>.sessions.put(sessionId, session);

        <span class="hljs-comment">// å‘å®¢æˆ·ç«¯å‘é€ endpoint äº‹ä»¶ï¼Œå†…å®¹åŒ…å« baseUrlã€æ¶ˆæ¯ç«¯ç‚¹ã€sessionId ç»„æˆçš„æ¶ˆæ¯ç«¯ç‚¹ url</span>
        <span class="hljs-built_in">this</span>.sendEvent(writer, ENDPOINT_EVENT_TYPE, <span class="hljs-built_in">this</span>.baseUrl + <span class="hljs-built_in">this</span>.messageEndpoint + <span class="hljs-string">"?sessionId="</span> + sessionId);
    }

    <span class="hljs-comment">/**
     * å¤„ç†å®¢æˆ·ç«¯çš„ POST è¯·æ±‚æ¶ˆæ¯
     *
     * <span class="hljs-doctag">@param</span> request HTTP Servlet è¯·æ±‚
     * <span class="hljs-doctag">@param</span> response HTTP Servlet å“åº”
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doPost</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span>
            <span class="hljs-keyword">throws</span> ServletException, IOException {

        <span class="hljs-keyword">if</span> (isClosing.get()) {
            <span class="hljs-comment">// è¿æ¥æ­£åœ¨è¢«å…³é—­æ—¶æ‹’ç»æ–°çš„è¯·æ±‚</span>
            response.sendError(HttpServletResponse.SC_SERVICE_UNAVAILABLE, <span class="hljs-string">"Server is shutting down"</span>);
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-comment">// è·å– uri</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">requestURI</span> <span class="hljs-operator">=</span> request.getRequestURI();
        <span class="hljs-keyword">if</span> (!requestURI.endsWith(messageEndpoint)) {
            <span class="hljs-comment">// åªå…è®¸æ¶ˆæ¯ç«¯ç‚¹è¯·æ±‚</span>
            response.sendError(HttpServletResponse.SC_NOT_FOUND);
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-comment">//  ä»è¯·æ±‚å‚æ•°ä¸­è·å– sessionId</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">sessionId</span> <span class="hljs-operator">=</span> request.getParameter(<span class="hljs-string">"sessionId"</span>);
        <span class="hljs-keyword">if</span> (sessionId == <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// å¦‚æœ sessionId ä¸ºç©ºï¼Œè¿”å›å¼‚å¸¸ä¿¡æ¯</span>
            response.setContentType(APPLICATION_JSON);
            response.setCharacterEncoding(UTF_8);
            response.setStatus(HttpServletResponse.SC_BAD_REQUEST);
            <span class="hljs-type">String</span> <span class="hljs-variable">jsonError</span> <span class="hljs-operator">=</span> objectMapper.writeValueAsString(<span class="hljs-keyword">new</span> <span class="hljs-title class_">McpError</span>(<span class="hljs-string">"Session ID missing in message endpoint"</span>));
            <span class="hljs-type">PrintWriter</span> <span class="hljs-variable">writer</span> <span class="hljs-operator">=</span> response.getWriter();
            writer.write(jsonError);
            writer.flush();
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-comment">// ä» sessions é›†åˆä¸­è·å–å½“å‰ session</span>
        <span class="hljs-type">McpServerSession</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessions.get(sessionId);
        <span class="hljs-keyword">if</span> (session == <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// å¦‚æœä¸åŒ…å«å½“å‰ sessionId å¯¹åº”çš„ sessionï¼Œè¿”å›å¼‚å¸¸ä¿¡æ¯</span>
            response.setContentType(APPLICATION_JSON);
            response.setCharacterEncoding(UTF_8);
            response.setStatus(HttpServletResponse.SC_NOT_FOUND);
            <span class="hljs-type">String</span> <span class="hljs-variable">jsonError</span> <span class="hljs-operator">=</span> objectMapper.writeValueAsString(<span class="hljs-keyword">new</span> <span class="hljs-title class_">McpError</span>(<span class="hljs-string">"Session not found: "</span> + sessionId));
            <span class="hljs-type">PrintWriter</span> <span class="hljs-variable">writer</span> <span class="hljs-operator">=</span> response.getWriter();
            writer.write(jsonError);
            writer.flush();
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// è¯»å–è¯·æ±‚ä½“å†…å®¹ï¼Œæ‹¼æ¥ä¸ºå­—ç¬¦ä¸²</span>
            <span class="hljs-type">BufferedReader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> request.getReader();
            <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">body</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
            String line;
            <span class="hljs-keyword">while</span> ((line = reader.readLine()) != <span class="hljs-literal">null</span>) {
                body.append(line);
            }

            <span class="hljs-comment">// å°†æ‹¼æ¥åçš„å†…å®¹ååºåˆ—åŒ–ä¸º JSON-RPC æ¶ˆæ¯å¯¹è±¡</span>
            McpSchema.<span class="hljs-type">JSONRPCMessage</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> McpSchema.deserializeJsonRpcMessage(objectMapper, body.toString());

            <span class="hljs-comment">// ä½¿ç”¨ session æ‰§è¡Œå½“å‰æ¶ˆæ¯ï¼Œå¹¶é˜»å¡ç›´åˆ°æ‰§è¡Œå®Œæˆ</span>
            session.handle(message).block();

            <span class="hljs-comment">// è®¾ç½®å“åº”ç  200ï¼Œè¡¨ç¤ºè¯·æ±‚æˆåŠŸ</span>
            response.setStatus(HttpServletResponse.SC_OK);
        }
        <span class="hljs-keyword">catch</span> (Exception e) {
            logger.error(<span class="hljs-string">"Error processing message: {}"</span>, e.getMessage());
            <span class="hljs-keyword">try</span> {
                <span class="hljs-type">McpError</span> <span class="hljs-variable">mcpError</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpError</span>(e.getMessage());
                response.setContentType(APPLICATION_JSON);
                response.setCharacterEncoding(UTF_8);
                response.setStatus(HttpServletResponse.SC_INTERNAL_SERVER_ERROR);
                <span class="hljs-type">String</span> <span class="hljs-variable">jsonError</span> <span class="hljs-operator">=</span> objectMapper.writeValueAsString(mcpError);
                <span class="hljs-type">PrintWriter</span> <span class="hljs-variable">writer</span> <span class="hljs-operator">=</span> response.getWriter();
                writer.write(jsonError);
                writer.flush();
            }
            <span class="hljs-keyword">catch</span> (IOException ex) {
                logger.error(FAILED_TO_SEND_ERROR_RESPONSE, ex.getMessage());
                response.sendError(HttpServletResponse.SC_INTERNAL_SERVER_ERROR, <span class="hljs-string">"Error processing message"</span>);
            }
        }
    }

    <span class="hljs-comment">/**
     * ä¼˜é›…åœ°å…³é—­æ‰€æœ‰å·²è¿æ¥å®¢æˆ·ç«¯çš„ä¼ è¾“å¹¶å¼‚æ­¥é‡Šæ”¾æ‰€æœ‰å…³è”èµ„æº
     *
     * <span class="hljs-doctag">@return</span> Monoï¼Œå½“å…³é—­æˆåŠŸæ—¶å®Œæˆ
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Mono&lt;Void&gt; <span class="hljs-title function_">closeGracefully</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// è®¾ç½®å…³é—­ä¼ è¾“æ ‡å¿—</span>
        isClosing.set(<span class="hljs-literal">true</span>);
        logger.debug(<span class="hljs-string">"Initiating graceful shutdown with {} active sessions"</span>, sessions.size());
        <span class="hljs-comment">// è°ƒç”¨ä¼šè¯å±‚å¯¹è±¡å…³é—­ä¼ è¾“</span>
        <span class="hljs-keyword">return</span> Flux.fromIterable(sessions.values()).flatMap(McpServerSession::closeGracefully).then();
    }

    <span class="hljs-comment">/**
     * å‘å®¢æˆ·ç«¯å‘é€ SSE äº‹ä»¶
     *
     * <span class="hljs-doctag">@param</span> writer å‘é€äº‹ä»¶çš„ writer
     * <span class="hljs-doctag">@param</span> eventType äº‹ä»¶ç±»å‹ï¼ˆæ¶ˆæ¯æˆ–ç«¯ç‚¹ï¼‰
     * <span class="hljs-doctag">@param</span> data äº‹ä»¶æ•°æ®
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendEvent</span><span class="hljs-params">(PrintWriter writer, String eventType, String data)</span> <span class="hljs-keyword">throws</span> IOException {
        writer.write(<span class="hljs-string">"event: "</span> + eventType + <span class="hljs-string">"\n"</span>);
        writer.write(<span class="hljs-string">"data: "</span> + data + <span class="hljs-string">"\n\n"</span>);
        writer.flush();

        <span class="hljs-keyword">if</span> (writer.checkError()) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IOException</span>(<span class="hljs-string">"Client disconnected"</span>);
        }
    }

    <span class="hljs-comment">/**
     * åœ¨ servlet è¢«é”€æ¯æ—¶æ¸…ç†èµ„æº
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">destroy</span><span class="hljs-params">()</span> {
        closeGracefully().block();
        <span class="hljs-built_in">super</span>.destroy();
    }

}
</code></pre>
<h3 data-id="heading-9">3.2.4 ä¼šè¯å±‚</h3>
<p>Â Â Â MCP æœåŠ¡ç«¯ä¼šè¯å±‚æ¶‰åŠåˆ°çš„ç±»åŒ…æ‹¬ <strong>McpSession</strong>ã€<strong>McpServerSession</strong>ã€<strong>McpServerSession.Factory</strong>ï¼ˆå†…éƒ¨ç±»ï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94c5b0c522504ec4b8bf725adbf46388~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP55KQ5Lmx5pKe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763392204&amp;x-signature=1mSqWXuPZVg6K9JnUGPtEyesoU0%3D" alt="" loading="lazy"/></p>
<p>Â Â ä¼šè¯å±‚è´Ÿè´£ä¸å•ä¸ªå®¢æˆ·ç«¯å»ºç«‹ç‹¬ç«‹ä¼šè¯ã€ç®¡ç†è¯·æ±‚/é€šçŸ¥çš„æ”¶å‘ã€å¹¶ç»´æŠ¤è¿æ¥çŠ¶æ€ï¼Œå®ƒå°†æœåŠ¡ç«¯ä¸åº•å±‚ä¼ è¾“é€šé“è§£è€¦ï¼Œä½¿ä¸Šå±‚é€»è¾‘æ— éœ€å…³å¿ƒå…·ä½“é€šä¿¡ç»†èŠ‚ã€‚å…¶é€šè¿‡ <code>McpSession</code> æ¥å£å®šä¹‰ç»Ÿä¸€æ“ä½œè§„èŒƒï¼Œå¹¶åœ¨ <code>McpServerSession</code> æä¾›äº†å…·ä½“å®ç°ã€‚å…¶æ ¸å¿ƒæ–¹æ³•åŒ…æ‹¬ï¼š</p>
<ul>
<li><code>sendRequest()</code>ï¼šå‘æœåŠ¡ç«¯å‘é€è¯·æ±‚æ¶ˆæ¯å¹¶ç­‰å¾…å“åº”ï¼Œè¿”å› <code>Mono</code> è¡¨ç¤ºæ”¯æŒå¼‚æ­¥å¤„ç†ã€‚</li>
<li><code>sendNotification()</code>ï¼šå‘æœåŠ¡ç«¯å‘é€æ— å“åº”çš„é€šçŸ¥æ¶ˆæ¯ï¼Œè¿”å› <code>Mono</code> è¡¨ç¤ºæ”¯æŒå¼‚æ­¥å¤„ç†ã€‚</li>
<li><code>close()</code>ï¼šç«‹å³å…³é—­å®¢æˆ·ç«¯è¿æ¥å’Œä¼šè¯èµ„æºã€‚</li>
<li><code>closeGracefully()</code>ï¼šæ‰§è¡Œä¼˜é›…å…³é—­æ“ä½œï¼Œç¡®ä¿æœªå®Œæˆçš„è¯·æ±‚æ­£å¸¸ç»“æŸï¼Œè¿”å› <code>Mono</code> è¡¨ç¤ºæ”¯æŒå¼‚æ­¥å¤„ç†ã€‚</li>
</ul>
<p>Â Â Â æ­¤å¤–ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œå­˜åœ¨å·¥å‚æ¥å£ <code>McpServerSession.Factory</code>ï¼Œè¿™ä¸ªå·¥å‚é€šå¸¸ç”±ä¸Šå±‚ï¼ˆä¼šè¯ç®¡ç†å±‚ï¼‰æ¥è°ƒç”¨ï¼Œå½“ä¸€ä¸ªæ–°çš„å®¢æˆ·ç«¯å»ºç«‹è¿æ¥æ—¶ï¼Œå°±ä¼šè°ƒç”¨ <code>create()</code> æ–¹æ³•æ¥ç”Ÿæˆä¼šè¯å®ä¾‹ã€‚</p>
<p>Â Â Â æ ¸å¿ƒçš„æºç åŠæ³¨é‡Šå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">/**
 * MCP ä¼šè¯ï¼Œç”¨æˆ·å¤„ç†å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¹‹é—´çš„é€šä¿¡
 * æä¾›äº†æ¶ˆæ¯äº¤äº’å’Œä¼šè¯ç”Ÿå‘½å‘¨æœŸç®¡ç†çš„æ–¹æ³•
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">McpSession</span> {

    <span class="hljs-comment">/**
     * å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚å¹¶è¿”å›å“åº”ç»“æœ
     *
     * <span class="hljs-doctag">@param</span> method è°ƒç”¨çš„æ–¹æ³•å
     * <span class="hljs-doctag">@param</span> requestParams è¯·æ±‚å‚æ•°
     * <span class="hljs-doctag">@param</span> typeRef ååºåˆ—åŒ–å“åº”ç»“æœæ‰€éœ€çš„ç±»å‹
     * <span class="hljs-doctag">@return</span> Monoï¼ŒæœåŠ¡ç«¯å“åº”åå®Œæˆ
     */</span>
    &lt;T&gt; Mono&lt;T&gt; <span class="hljs-title function_">sendRequest</span><span class="hljs-params">(String method, Object requestParams, TypeReference&lt;T&gt; typeRef)</span>;

    <span class="hljs-comment">/**
     * å‘æœåŠ¡ç«¯å‘é€ä¸å¸¦å‚æ•°çš„é€šçŸ¥
     *
     * <span class="hljs-doctag">@param</span> method æ–¹æ³•å
     * <span class="hljs-doctag">@return</span> Monoï¼Œé€šçŸ¥å‘é€åå®Œæˆ
     */</span>
    <span class="hljs-keyword">default</span> Mono&lt;Void&gt; <span class="hljs-title function_">sendNotification</span><span class="hljs-params">(String method)</span> {
        <span class="hljs-keyword">return</span> sendNotification(method, <span class="hljs-literal">null</span>);
    }

    <span class="hljs-comment">/**
     * å‘æœåŠ¡ç«¯å‘é€å¸¦å‚æ•°çš„é€šçŸ¥
     *
     * <span class="hljs-doctag">@param</span> method é€šçŸ¥æ–¹æ³•å
     * <span class="hljs-doctag">@param</span> params æ–¹æ³•å‚æ•°
     * <span class="hljs-doctag">@return</span> Monoï¼Œé€šçŸ¥å‘é€åå®Œæˆ
     */</span>
    Mono&lt;Void&gt; <span class="hljs-title function_">sendNotification</span><span class="hljs-params">(String method, Object params)</span>;

    <span class="hljs-comment">/**
     * ä¼˜é›…å…³é—­å®¢æˆ·ç«¯è¿æ¥
     *
     * <span class="hljs-doctag">@return</span> Monoï¼Œå…³é—­åå®Œæˆ
     */</span>
    Mono&lt;Void&gt; <span class="hljs-title function_">closeGracefully</span><span class="hljs-params">()</span>;

    <span class="hljs-comment">/**
     * ç«‹åˆ»å…³é—­å®¢æˆ·ç«¯è¿æ¥
     */</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span>;

}
</code></pre>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">/**
 * MCP æœåŠ¡ç«¯ä¼šè¯å®ç°ç±»ï¼Œç®¡ç†ä¸å®¢æˆ·ç«¯çš„åŒå‘ JSON-RPC é€šä¿¡
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">McpServerSession</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">McpSession</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(McpServerSession.class);

    <span class="hljs-comment">// è¯·æ±‚ç¼“å­˜ï¼Œç”¨äºç¼“å­˜è¿˜æœªå¤„ç†å®Œçš„è¯·æ±‚</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ConcurrentHashMap&lt;Object, MonoSink&lt;McpSchema.JSONRPCResponse&gt;&gt; pendingResponses = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();

    <span class="hljs-comment">// ä¼šè¯ id</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String id;

    <span class="hljs-comment">/** Duration to wait for request responses before timing out */</span>
    <span class="hljs-comment">// è¯·æ±‚è¶…æ—¶æ—¶é—´</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Duration requestTimeout;

    <span class="hljs-comment">// ç”¨äºç”Ÿæˆå”¯ä¸€è¯·æ±‚ id çš„åŸå­è®¡æ•°å™¨</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">AtomicLong</span> <span class="hljs-variable">requestCounter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicLong</span>(<span class="hljs-number">0</span>);

    <span class="hljs-comment">// åˆå§‹åŒ–å¤„ç†å™¨</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> InitRequestHandler initRequestHandler;

    <span class="hljs-comment">// åˆå§‹åŒ–é€šçŸ¥å¤„ç†å™¨</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> InitNotificationHandler initNotificationHandler;

    <span class="hljs-comment">// è¯·æ±‚å¤„ç†å™¨ map</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;String, RequestHandler&lt;?&gt;&gt; requestHandlers;

    <span class="hljs-comment">// é€šçŸ¥å¤„ç†å™¨ map</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;String, NotificationHandler&gt; notificationHandlers;

    <span class="hljs-comment">// ä¼ è¾“å±‚å¯¹è±¡</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> McpServerTransport transport;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Sinks.One&lt;McpAsyncServerExchange&gt; exchangeSink = Sinks.one();

    <span class="hljs-comment">// å®¢æˆ·ç«¯èƒ½åŠ›é…ç½®</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AtomicReference&lt;McpSchema.ClientCapabilities&gt; clientCapabilities = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicReference</span>&lt;&gt;();

    <span class="hljs-comment">// å®¢æˆ·ç«¯åŸºæœ¬ä¿¡æ¯</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AtomicReference&lt;McpSchema.Implementation&gt; clientInfo = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicReference</span>&lt;&gt;();

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">STATE_UNINITIALIZED</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">STATE_INITIALIZING</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">STATE_INITIALIZED</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;

    <span class="hljs-comment">// åˆå§‹åŒ–çŠ¶æ€</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">state</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(STATE_UNINITIALIZED);

    <span class="hljs-comment">/**
     * æ„é€ æ–¹æ³•
     *
     * <span class="hljs-doctag">@param</span> id ä¼šè¯ id
     * <span class="hljs-doctag">@param</span> requestTimeout è¯·æ±‚è¶…æ—¶æ—¶é—´
     * <span class="hljs-doctag">@param</span> transport ä¼ è¾“å±‚å¯¹è±¡
     * <span class="hljs-doctag">@param</span> initHandler åˆå§‹åŒ–å¤„ç†å™¨
     * <span class="hljs-doctag">@param</span> initNotificationHandler åˆå§‹åŒ–é€šçŸ¥å¤„ç†å™¨
     * <span class="hljs-doctag">@param</span> requestHandlers è¯·æ±‚å¤„ç†å™¨
     * <span class="hljs-doctag">@param</span> notificationHandlers é€šçŸ¥å¤„ç†å™¨
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">McpServerSession</span><span class="hljs-params">(String id, Duration requestTimeout, McpServerTransport transport,
                            InitRequestHandler initHandler, InitNotificationHandler initNotificationHandler,
                            Map&lt;String, RequestHandler&lt;?&gt;&gt; requestHandlers, Map&lt;String, NotificationHandler&gt; notificationHandlers)</span> {
        <span class="hljs-built_in">this</span>.id = id;
        <span class="hljs-built_in">this</span>.requestTimeout = requestTimeout;
        <span class="hljs-built_in">this</span>.transport = transport;
        <span class="hljs-built_in">this</span>.initRequestHandler = initHandler;
        <span class="hljs-built_in">this</span>.initNotificationHandler = initNotificationHandler;
        <span class="hljs-built_in">this</span>.requestHandlers = requestHandlers;
        <span class="hljs-built_in">this</span>.notificationHandlers = notificationHandlers;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.id;
    }

    <span class="hljs-comment">/**
     * åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å®Œæˆåˆå§‹åŒ–åè°ƒç”¨
     *
     * <span class="hljs-doctag">@param</span> clientCapabilities å®¢æˆ·ç«¯èƒ½åŠ›é…ç½®
     * <span class="hljs-doctag">@param</span> clientInfo å®¢æˆ·ç«¯åŸºæœ¬ä¿¡æ¯
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(McpSchema.ClientCapabilities clientCapabilities, McpSchema.Implementation clientInfo)</span> {
        <span class="hljs-built_in">this</span>.clientCapabilities.lazySet(clientCapabilities);
        <span class="hljs-built_in">this</span>.clientInfo.lazySet(clientInfo);
    }

    <span class="hljs-comment">/**
     * åˆ›å»ºå”¯ä¸€çš„è¯·æ±‚ id
     */</span>
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">generateRequestId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.id + <span class="hljs-string">"-"</span> + <span class="hljs-built_in">this</span>.requestCounter.getAndIncrement();
    }

    <span class="hljs-comment">/**
     * å‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯
     *
     * <span class="hljs-doctag">@param</span> method æ–¹æ³•å
     * <span class="hljs-doctag">@param</span> requestParams æ–¹æ³•å‚æ•°
     * <span class="hljs-doctag">@param</span> typeRef å“åº”ç±»å‹
     * <span class="hljs-doctag">@return</span> Monoï¼Œå‘é€åå®Œæˆ
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> &lt;T&gt; Mono&lt;T&gt; <span class="hljs-title function_">sendRequest</span><span class="hljs-params">(String method, Object requestParams, TypeReference&lt;T&gt; typeRef)</span> {
        <span class="hljs-comment">// ç”Ÿæˆè¯·æ±‚ id</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">requestId</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.generateRequestId();

        <span class="hljs-keyword">return</span> Mono.&lt;McpSchema.JSONRPCResponse&gt;create(sink -&gt; {
            <span class="hljs-comment">// ç¼“å­˜å½“å‰è¯·æ±‚</span>
            <span class="hljs-built_in">this</span>.pendingResponses.put(requestId, sink);
            <span class="hljs-comment">// æ„å»º JSON-RPC è¯·æ±‚å¯¹è±¡</span>
            McpSchema.<span class="hljs-type">JSONRPCRequest</span> <span class="hljs-variable">jsonrpcRequest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpSchema</span>.JSONRPCRequest(McpSchema.JSONRPC_VERSION, method,
                    requestId, requestParams);
            <span class="hljs-comment">// å‘é€è¯·æ±‚</span>
            <span class="hljs-built_in">this</span>.transport.sendMessage(jsonrpcRequest).subscribe(v -&gt; {
            }, error -&gt; {
                <span class="hljs-built_in">this</span>.pendingResponses.remove(requestId);
                sink.error(error);
            });
        }).timeout(requestTimeout).handle((jsonRpcResponse, sink) -&gt; {
            <span class="hljs-comment">// å¤„ç†å“åº”é€»è¾‘</span>
            <span class="hljs-keyword">if</span> (jsonRpcResponse.error() != <span class="hljs-literal">null</span>) {
                <span class="hljs-comment">// å‡ºç°å¼‚å¸¸</span>
                sink.error(<span class="hljs-keyword">new</span> <span class="hljs-title class_">McpError</span>(jsonRpcResponse.error()));
            }
            <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">if</span> (typeRef.getType().equals(Void.class)) {
                    <span class="hljs-comment">// è¿”å›ç»“æœç±»å‹ä¸ºç©ºæ—¶ç›´æ¥ç»“æŸ</span>
                    sink.complete();
                }
                <span class="hljs-keyword">else</span> {
                    <span class="hljs-comment">// è¿”å›ç»“æœç±»å‹ä¸ä¸ºç©ºæ—¶å°†ç»“æœè½¬æ¢ä¸º typeRef ç±»å‹å¯¹è±¡å¹¶è¿”å›</span>
                    sink.next(<span class="hljs-built_in">this</span>.transport.unmarshalFrom(jsonRpcResponse.result(), typeRef));
                }
            }
        });
    }

    <span class="hljs-comment">/**
     * å‘æœåŠ¡ç«¯å‘é€å¸¦å‚æ•°çš„é€šçŸ¥
     *
     * <span class="hljs-doctag">@param</span> method é€šçŸ¥æ–¹æ³•å
     * <span class="hljs-doctag">@param</span> params æ–¹æ³•å‚æ•°
     * <span class="hljs-doctag">@return</span> Monoï¼Œé€šçŸ¥å‘é€åå®Œæˆ
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Mono&lt;Void&gt; <span class="hljs-title function_">sendNotification</span><span class="hljs-params">(String method, Object params)</span> {
        <span class="hljs-comment">// å°†æ–¹æ³•å’Œå‚æ•°è½¬æ¢ä¸º JSON-RPC é€šçŸ¥å¯¹è±¡</span>
        McpSchema.<span class="hljs-type">JSONRPCNotification</span> <span class="hljs-variable">jsonrpcNotification</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpSchema</span>.JSONRPCNotification(McpSchema.JSONRPC_VERSION,
                method, params);
        <span class="hljs-comment">// ä½¿ç”¨ä¼ è¾“å±‚å¯¹è±¡å‘é€æ¶ˆæ¯</span>
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.transport.sendMessage(jsonrpcNotification);
    }

    <span class="hljs-comment">/**
     * å°†æ¶ˆæ¯åˆ†å‘åˆ°åˆé€‚çš„å¤„ç†ç¨‹åº
     *
     * <span class="hljs-doctag">@param</span> message JSON-RPC æ¶ˆæ¯
     * <span class="hljs-doctag">@return</span> Monoï¼Œæ¶ˆæ¯å¤„ç†åå®Œæˆ
     */</span>
    <span class="hljs-keyword">public</span> Mono&lt;Void&gt; <span class="hljs-title function_">handle</span><span class="hljs-params">(McpSchema.JSONRPCMessage message)</span> {
        <span class="hljs-keyword">return</span> Mono.defer(() -&gt; {
            <span class="hljs-keyword">if</span> (message <span class="hljs-keyword">instanceof</span> McpSchema.JSONRPCResponse response) {
                <span class="hljs-comment">// å¤„ç†å“åº”ç±»å‹çš„æ¶ˆæ¯</span>
                logger.debug(<span class="hljs-string">"Received Response: {}"</span>, response);
                <span class="hljs-comment">// è·å–å“åº”å›è°ƒå¹¶ä»ç¼“å­˜ä¸­ç§»é™¤å½“å‰è¯·æ±‚ï¼Œè¡¨ç¤ºå½“å‰è¯·æ±‚å¤„ç†å®Œæ¯•</span>
                <span class="hljs-type">var</span> <span class="hljs-variable">sink</span> <span class="hljs-operator">=</span> pendingResponses.remove(response.id());
                <span class="hljs-keyword">if</span> (sink == <span class="hljs-literal">null</span>) {
                    logger.warn(<span class="hljs-string">"Unexpected response for unknown id {}"</span>, response.id());
                }
                <span class="hljs-keyword">else</span> {
                    <span class="hljs-comment">// å°†å“åº”ä¼ é€’ç»™è®¢é˜…è€…</span>
                    sink.success(response);
                }
                <span class="hljs-keyword">return</span> Mono.empty();
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (message <span class="hljs-keyword">instanceof</span> McpSchema.JSONRPCRequest request) {
                <span class="hljs-comment">// å¤„ç†è¯·æ±‚ç±»å‹çš„æ¶ˆæ¯</span>
                logger.debug(<span class="hljs-string">"Received request: {}"</span>, request);
                <span class="hljs-keyword">return</span> handleIncomingRequest(request).onErrorResume(error -&gt; {
                    <span class="hljs-comment">// å¤„ç†å¤±è´¥æ—¶è¿”å›å¼‚å¸¸ç±»å‹å“åº”</span>
                    <span class="hljs-type">var</span> <span class="hljs-variable">errorResponse</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpSchema</span>.JSONRPCResponse(McpSchema.JSONRPC_VERSION, request.id(), <span class="hljs-literal">null</span>,
                            <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpSchema</span>.JSONRPCResponse.JSONRPCError(McpSchema.ErrorCodes.INTERNAL_ERROR,
                                    error.getMessage(), <span class="hljs-literal">null</span>));
                    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.transport.sendMessage(errorResponse).then(Mono.empty());
                }).flatMap(<span class="hljs-built_in">this</span>.transport::sendMessage);
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (message <span class="hljs-keyword">instanceof</span> McpSchema.JSONRPCNotification notification) {
                <span class="hljs-comment">// å¤„ç†é€šçŸ¥ç±»å‹çš„æ¶ˆæ¯</span>
                logger.debug(<span class="hljs-string">"Received notification: {}"</span>, notification);
                <span class="hljs-keyword">return</span> handleIncomingNotification(notification)
                        .doOnError(error -&gt; logger.error(<span class="hljs-string">"Error handling notification: {}"</span>, error.getMessage()));
            }
            <span class="hljs-keyword">else</span> {
                logger.warn(<span class="hljs-string">"Received unknown message type: {}"</span>, message);
                <span class="hljs-keyword">return</span> Mono.empty();
            }
        });
    }

    <span class="hljs-comment">/**
     * å°† JSON-RPC é€šçŸ¥ç±»å‹æ¶ˆæ¯è·¯ç”±åˆ°ç›¸åº”çš„å¤„ç†ç¨‹åºæ¥å¤„ç†
     *
     * <span class="hljs-doctag">@param</span> notification JSON-RPC é€šçŸ¥
     * <span class="hljs-doctag">@return</span> Monoï¼Œé€šçŸ¥å¤„ç†åå®Œæˆ
     */</span>
    <span class="hljs-keyword">private</span> Mono&lt;Void&gt; <span class="hljs-title function_">handleIncomingNotification</span><span class="hljs-params">(McpSchema.JSONRPCNotification notification)</span> {
        <span class="hljs-keyword">return</span> Mono.defer(() -&gt; {
            <span class="hljs-keyword">if</span> (McpSchema.METHOD_NOTIFICATION_INITIALIZED.equals(notification.method())) {
                <span class="hljs-comment">// åˆå§‹åŒ–å®Œæˆé€šçŸ¥æ–¹æ³•æ‰§è¡Œé€»è¾‘</span>
                <span class="hljs-comment">// çŠ¶æ€è®¾ç½®ä¸ºåˆå§‹åŒ–å®Œæˆ</span>
                <span class="hljs-built_in">this</span>.state.lazySet(STATE_INITIALIZED);
                exchangeSink.tryEmitValue(<span class="hljs-keyword">new</span> <span class="hljs-title class_">McpAsyncServerExchange</span>(<span class="hljs-built_in">this</span>, clientCapabilities.get(), clientInfo.get()));
                <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.initNotificationHandler.handle();
            }

            <span class="hljs-comment">// æ ¹æ®æ–¹æ³•åè·å–å¤„ç†å™¨</span>
            <span class="hljs-type">var</span> <span class="hljs-variable">handler</span> <span class="hljs-operator">=</span> notificationHandlers.get(notification.method());
            <span class="hljs-keyword">if</span> (handler == <span class="hljs-literal">null</span>) {
                <span class="hljs-comment">// å¤„ç†å™¨ä¸å­˜åœ¨æ—¶è¿”å›ç©ºä¿¡æ¯</span>
                logger.error(<span class="hljs-string">"No handler registered for notification method: {}"</span>, notification.method());
                <span class="hljs-keyword">return</span> Mono.empty();
            }
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.exchangeSink.asMono().flatMap(exchange -&gt; handler.handle(exchange, notification.params()));
        });
    }

    <span class="hljs-comment">/**
     * è¡¨ç¤ºæ–¹æ³•æœªæ‰¾åˆ°çš„é”™è¯¯æ•°æ®ç»“æ„
     *
     * <span class="hljs-doctag">@param</span> method æ–¹æ³•å
     * <span class="hljs-doctag">@param</span> message å¼‚å¸¸ä¿¡æ¯
     * <span class="hljs-doctag">@param</span> data é™„åŠ æ•°æ®
     */</span>
    <span class="hljs-keyword">record</span> <span class="hljs-title class_">MethodNotFoundError</span><span class="hljs-params">(String method, String message, Object data)</span> {
    }

    <span class="hljs-comment">/**
     * æ ¹æ®æ–¹æ³•åè¿”å›å¯¹åº”çš„ MethodNotFoundError å¯¹è±¡
     *
     * <span class="hljs-doctag">@param</span> method æ–¹æ³•å
     * <span class="hljs-doctag">@return</span> MethodNotFoundError å¯¹è±¡
     */</span>
    <span class="hljs-keyword">private</span> MethodNotFoundError <span class="hljs-title function_">getMethodNotFoundError</span><span class="hljs-params">(String method)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MethodNotFoundError</span>(method, <span class="hljs-string">"Method not found: "</span> + method, <span class="hljs-literal">null</span>);
    }

    <span class="hljs-comment">/**
     * ä¼˜é›…å…³é—­å®¢æˆ·ç«¯è¿æ¥
     *
     * <span class="hljs-doctag">@return</span> Monoï¼Œå…³é—­åå®Œæˆ
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Mono&lt;Void&gt; <span class="hljs-title function_">closeGracefully</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.transport.closeGracefully();
    }

    <span class="hljs-comment">/**
     * ç«‹åˆ»å…³é—­å®¢æˆ·ç«¯è¿æ¥
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">this</span>.transport.close();
    }

}
</code></pre>
<h3 data-id="heading-10">3.2.5 ä¼ è¾“å±‚</h3>
<p>Â Â Â MCP æœåŠ¡ç«¯ä¼ è¾“å±‚æ¶‰åŠåˆ°çš„ç±»åŒ…æ‹¬ï¼š<strong>McpTransport</strong>ã€<strong>McpServerTransport</strong>ã€<strong>HttpServletSseServerTransportProvider.HttpServletMcpSessionTransport</strong>ï¼ˆå†…éƒ¨ç±»ï¼‰ã€<strong>StdioServerTransportProvider.StdioMcpSessionTransport</strong>ï¼ˆå†…éƒ¨ç±»ï¼‰ ç­‰ã€‚å…¶ä¸­ <code>HttpServletMcpSessionTransport</code> å’Œ <code>StdioMcpSessionTransport</code> ä¸º <code>McpServerTransport</code> çš„å®ç°ç±»ï¼Œåˆ†åˆ«å¯¹åº” SSE å’Œ Stdio çš„å…·ä½“å®ç°ï¼Œè¿™é‡Œä»…åˆ—å‡ºä¸¤ç§ï¼Œå®é™…ä¸Šä¸åŒçš„ä¼ è¾“åè®®éƒ½ä¼šæœ‰å¯¹åº”çš„å®ç°ç±»ã€‚å…¶ç±»å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e638db16b3254f9990964a2068ab5473~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP55KQ5Lmx5pKe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763392204&amp;x-signature=DG5rA9r2G3wiO0OZwglOFRfVY0E%3D" alt="" loading="lazy"/></p>
<p>Â Â Â æ ¸å¿ƒæ¥å£æ˜¯ <code>McpTransport</code> å’Œå…¶å­æ¥å£ <code>McpServerTransport</code>ï¼Œå…¶ä¸­ <code>McpServerTransport</code> å†…éƒ¨ä¸ºç©ºï¼Œå³æœåŠ¡ç«¯çš„ä¼ è¾“å±‚ç±»è¿˜æ²¡æœ‰æ‰©å±•å…¶ä»–çš„åŠŸèƒ½ã€‚<code>McpTransport</code> ä¸­æ ¸å¿ƒæ–¹æ³•çš„åŠŸèƒ½å·²åœ¨ MCP å®¢æˆ·ç«¯ä¼ è¾“å±‚ç»™å‡ºï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚</p>
<p>Â Â Â æ ¸å¿ƒçš„æºç åŠæ³¨é‡Šå¦‚ä¸‹æ‰€ç¤ºï¼ˆ<code>McpTransport</code> åœ¨ MCP å®¢æˆ·ç«¯ä¼ è¾“å±‚å·²ç»™å‡ºï¼Œè¿™é‡Œä¹Ÿä¸å†èµ˜è¿°ã€‚å®ç°ç±»ä¸­ä»…ç»™å‡º <code>HttpServletMcpSessionTransport</code> çš„å…·ä½“å®ç°ï¼Œå…¶ä»–çš„å®ç°ç±»æ˜¯ç±»ä¼¼çš„ï¼‰ï¼š</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">/**
 * HttpServlet SSE ä¼šè¯çš„ McpServerTransport å®ç°ç±»ï¼Œå¤„ç†ç‰¹å®šå®¢æˆ·ç«¯ä¼šè¯çš„ä¼ è¾“å±‚é€šä¿¡
 */</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpServletMcpSessionTransport</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">McpServerTransport</span> {

    <span class="hljs-comment">// ä¼šè¯ id</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String sessionId;

    <span class="hljs-comment">// å¼‚æ­¥ä¸Šä¸‹æ–‡</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AsyncContext asyncContext;

    <span class="hljs-comment">// å†™å…¥å™¨ï¼Œç”¨äºå‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> PrintWriter writer;

    <span class="hljs-comment">/**
     * æ„é€ æ–¹æ³•
     *
     * <span class="hljs-doctag">@param</span> sessionId ä¼šè¯ id
     * <span class="hljs-doctag">@param</span> asyncContext å¼‚æ­¥ä¼šè¯ä¸Šä¸‹æ–‡
     * <span class="hljs-doctag">@param</span> writer ç”¨äºå‘å®¢æˆ·ç«¯å‘é€æœåŠ¡ç«¯æ¶ˆæ¯çš„å†™å…¥å™¨
     */</span>
    HttpServletMcpSessionTransport(String sessionId, AsyncContext asyncContext, PrintWriter writer) {
        <span class="hljs-built_in">this</span>.sessionId = sessionId;
        <span class="hljs-built_in">this</span>.asyncContext = asyncContext;
        <span class="hljs-built_in">this</span>.writer = writer;
        logger.debug(<span class="hljs-string">"Session transport {} initialized with SSE writer"</span>, sessionId);
    }

    <span class="hljs-comment">/**
     * é€šè¿‡ SSE è¿æ¥å‘å®¢æˆ·ç«¯å‘é€ JSON-RPC æ¶ˆæ¯
     *
     * <span class="hljs-doctag">@param</span> message JSON-RPC æ¶ˆæ¯
     * <span class="hljs-doctag">@return</span> Monoï¼Œåœ¨æ¶ˆæ¯å‘é€å®Œæˆåè¿”å›ç»“æœ
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Mono&lt;Void&gt; <span class="hljs-title function_">sendMessage</span><span class="hljs-params">(McpSchema.JSONRPCMessage message)</span> {
        <span class="hljs-keyword">return</span> Mono.fromRunnable(() -&gt; {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// å°†æ¶ˆæ¯åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²</span>
                <span class="hljs-type">String</span> <span class="hljs-variable">jsonText</span> <span class="hljs-operator">=</span> objectMapper.writeValueAsString(message);
                <span class="hljs-comment">// å‘é€æ¶ˆæ¯</span>
                sendEvent(writer, MESSAGE_EVENT_TYPE, jsonText);
                logger.debug(<span class="hljs-string">"Message sent to session {}"</span>, sessionId);
            }
            <span class="hljs-keyword">catch</span> (Exception e) {
                logger.error(<span class="hljs-string">"Failed to send message to session {}: {}"</span>, sessionId, e.getMessage());
                sessions.remove(sessionId);
                asyncContext.complete();
            }
        });
    }

    <span class="hljs-comment">/**
     * é€šè¿‡å·²é…ç½®çš„ ObjectMapper å°†æ•°æ®ä»ä¸€ç§ç±»å‹è½¬æ¢ä¸ºå¦ä¸€ç§ç±»å‹
     *
     * <span class="hljs-doctag">@param</span> data æºæ•°æ®
     * <span class="hljs-doctag">@param</span> typeRef ç›®æ ‡ç±»å‹
     * <span class="hljs-doctag">@return</span> è½¬æ¢åçš„å¯¹è±¡
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> &lt;T&gt; T <span class="hljs-title function_">unmarshalFrom</span><span class="hljs-params">(Object data, TypeReference&lt;T&gt; typeRef)</span> {
        <span class="hljs-keyword">return</span> objectMapper.convertValue(data, typeRef);
    }

    <span class="hljs-comment">/**
     * ä¼˜é›…åœ°å…³é—­å½“å‰ä¼ è¾“
     *
     * <span class="hljs-doctag">@return</span> Monoï¼Œå…³é—­ä¼ è¾“åè¿”å›ç»“æœ
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Mono&lt;Void&gt; <span class="hljs-title function_">closeGracefully</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> Mono.fromRunnable(() -&gt; {
            logger.debug(<span class="hljs-string">"Closing session transport: {}"</span>, sessionId);
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// ä»å·²æ³¨å†Œçš„ sessions é›†åˆä¸­ç§»é™¤å½“å‰ session</span>
                sessions.remove(sessionId);
                <span class="hljs-comment">// ç»“æŸå¼‚æ­¥é•¿ä¸‹æ–‡</span>
                asyncContext.complete();
                logger.debug(<span class="hljs-string">"Successfully completed async context for session {}"</span>, sessionId);
            }
            <span class="hljs-keyword">catch</span> (Exception e) {
                logger.warn(<span class="hljs-string">"Failed to complete async context for session {}: {}"</span>, sessionId, e.getMessage());
            }
        });
    }

    <span class="hljs-comment">/**
     * ç«‹åˆ»å…³é—­å½“å‰ä¼ è¾“
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// ä»å·²æ³¨å†Œçš„ sessions é›†åˆä¸­ç§»é™¤å½“å‰ session</span>
            sessions.remove(sessionId);
            <span class="hljs-comment">// ç»“æŸå¼‚æ­¥é•¿ä¸‹æ–‡</span>
            asyncContext.complete();
            logger.debug(<span class="hljs-string">"Successfully completed async context for session {}"</span>, sessionId);
        }
        <span class="hljs-keyword">catch</span> (Exception e) {
            logger.warn(<span class="hljs-string">"Failed to complete async context for session {}: {}"</span>, sessionId, e.getMessage());
        }
    }

}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Springäº‹åŠ¡ç®¡ç†é™·é˜±ï¼š@Transactionalå¤±æ•ˆçš„8ä¸ªå¸¸è§åœºæ™¯ä¸è§£å†³æ–¹æ¡ˆ]]></title>    <link>https://juejin.cn/post/7570932873131835419</link>    <guid>https://juejin.cn/post/7570932873131835419</guid>    <pubDate>2025-11-10T18:04:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570932873131835419" data-draft-id="7570984257665941550" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Springäº‹åŠ¡ç®¡ç†é™·é˜±ï¼š@Transactionalå¤±æ•ˆçš„8ä¸ªå¸¸è§åœºæ™¯ä¸è§£å†³æ–¹æ¡ˆ"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-11-10T18:04:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¤§å¤´an"/> <meta itemprop="url" content="https://juejin.cn/user/618374030438861"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Springäº‹åŠ¡ç®¡ç†é™·é˜±ï¼š@Transactionalå¤±æ•ˆçš„8ä¸ªå¸¸è§åœºæ™¯ä¸è§£å†³æ–¹æ¡ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/618374030438861/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¤§å¤´an
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T18:04:20.000Z" title="Mon Nov 10 2025 18:04:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    11
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¼•è¨€</h2>
<blockquote>
<p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œä½ æ˜¯å¦é‡åˆ°è¿‡è¿™æ ·çš„å›°æ‰°ï¼šæ˜æ˜åœ¨æ–¹æ³•ä¸Šæ·»åŠ äº†<code>@Transactional</code>æ³¨è§£ï¼Œä½†äº‹åŠ¡å´æ²¡æœ‰æŒ‰é¢„æœŸå·¥ä½œâ€”â€”è¯¥å›æ»šçš„æ—¶å€™æ²¡æœ‰å›æ»šï¼Œè¯¥ä¿æŒåŸå­æ€§çš„æ“ä½œå´å‡ºç°äº†éƒ¨åˆ†æˆåŠŸï¼Ÿæœ¬æ–‡å°†æ·±å…¥å‰–æSpringäº‹åŠ¡ç®¡ç†ä¸­å¸¸è§çš„8ä¸ªé™·é˜±ï¼Œå¸®åŠ©ä½ å½»åº•è§£å†³è¿™äº›é—®é¢˜ã€‚</p>
</blockquote>
<h2 data-id="heading-1">å‰ç½®çŸ¥è¯†</h2>
<p>åœ¨æ·±å…¥é—®é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆç®€å•å›é¡¾Springäº‹åŠ¡çš„æ ¸å¿ƒæœºåˆ¶ï¼š</p>
<ul>
<li><strong>PlatformTransactionManager</strong>ï¼šäº‹åŠ¡ç®¡ç†å™¨æ ¸å¿ƒæ¥å£</li>
<li><strong>@Transactional</strong>ï¼šå£°æ˜å¼äº‹åŠ¡æ³¨è§£</li>
<li><strong>äº‹åŠ¡ä¼ æ’­æœºåˆ¶</strong>ï¼šPROPAGATION_REQUIREDã€PROPAGATION_REQUIRES_NEWç­‰</li>
<li><strong>AOPä»£ç†æœºåˆ¶</strong>ï¼šSpringé€šè¿‡ä»£ç†å®ç°äº‹åŠ¡ç®¡ç†</li>
</ul>
<h2 data-id="heading-2">é™·é˜±ä¸€ï¼šéPublicæ–¹æ³•</h2>
<h3 data-id="heading-3">ç°è±¡æè¿°</h3>
<p>åœ¨épublicæ–¹æ³•ä¸Šä½¿ç”¨<code>@Transactional</code>æ³¨è§£ï¼Œäº‹åŠ¡å®Œå…¨ä¸ç”Ÿæ•ˆã€‚</p>
<h3 data-id="heading-4">åŸç†åˆ†æ</h3>
<p>Springäº‹åŠ¡ç®¡ç†åŸºäºAOPä»£ç†å®ç°ã€‚åœ¨é»˜è®¤é…ç½®ä¸‹ï¼ŒSpringçš„AOPä»£ç†åªèƒ½æ‹¦æˆªpublicæ–¹æ³•ã€‚è¿™æ˜¯ç”±äºSpringä½¿ç”¨çš„ä»£ç†æœºåˆ¶ï¼ˆJDKåŠ¨æ€ä»£ç†å’ŒCGLIBï¼‰çš„é™åˆ¶æ‰€è‡´ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    
    <span class="hljs-comment">// é”™è¯¯ç¤ºä¾‹ï¼šäº‹åŠ¡ä¸ä¼šç”Ÿæ•ˆ</span>
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">createUserInternal</span><span class="hljs-params">(User user)</span> {
        userMapper.insert(user);
        <span class="hljs-comment">// å¦‚æœè¿™é‡Œå‡ºç°å¼‚å¸¸ï¼Œäº‹åŠ¡ä¸ä¼šå›æ»š</span>
        <span class="hljs-keyword">if</span> (user.getAge() &lt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"å¹´é¾„ä¸èƒ½ä¸ºè´Ÿæ•°"</span>);
        }
    }
    
    <span class="hljs-comment">// æ­£ç¡®ç¤ºä¾‹ï¼šä½¿ç”¨publicä¿®é¥°ç¬¦</span>
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createUser</span><span class="hljs-params">(User user)</span> {
        userMapper.insert(user);
        <span class="hljs-keyword">if</span> (user.getAge() &lt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"å¹´é¾„ä¸èƒ½ä¸ºè´Ÿæ•°"</span>);
        }
    }
}
</code></pre>
<h3 data-id="heading-5">è§£å†³æ–¹æ¡ˆ</h3>
<ul>
<li>å°†éœ€è¦ä½¿ç”¨äº‹åŠ¡çš„æ–¹æ³•å£°æ˜ä¸ºpublic</li>
<li>å¦‚æœéœ€è¦ä¿æŠ¤æ–¹æ³•è®¿é—®ï¼Œå¯ä»¥ä½¿ç”¨å…¶ä»–è®¿é—®æ§åˆ¶æœºåˆ¶</li>
</ul>
<h2 data-id="heading-6">é™·é˜±äºŒï¼šè‡ªè°ƒç”¨é—®é¢˜</h2>
<h3 data-id="heading-7">ç°è±¡æè¿°</h3>
<p>åœ¨åŒä¸€ä¸ªç±»ä¸­ï¼Œä¸€ä¸ªæ–¹æ³•è°ƒç”¨å¦ä¸€ä¸ªå¸¦æœ‰<code>@Transactional</code>æ³¨è§£çš„æ–¹æ³•ï¼Œäº‹åŠ¡ä¸ç”Ÿæ•ˆã€‚</p>
<h3 data-id="heading-8">åŸç†åˆ†æ</h3>
<p>Springé€šè¿‡ä»£ç†å¯¹è±¡æ¥ç®¡ç†äº‹åŠ¡ã€‚å½“åœ¨åŒä¸€ä¸ªç±»ä¸­ç›´æ¥è°ƒç”¨æ–¹æ³•æ—¶ï¼Œè°ƒç”¨çš„æ˜¯ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•ï¼Œè€Œä¸æ˜¯ä»£ç†å¯¹è±¡çš„æ–¹æ³•ï¼Œå› æ­¤äº‹åŠ¡æ‹¦æˆªå™¨ä¸ä¼šèµ·ä½œç”¨ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderMapper orderMapper;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">placeOrder</span><span class="hljs-params">(Order order)</span> {
        <span class="hljs-comment">// å…¶ä»–ä¸šåŠ¡é€»è¾‘</span>
        validateOrder(order);
        
        <span class="hljs-comment">// è‡ªè°ƒç”¨ - äº‹åŠ¡ä¸ä¼šç”Ÿæ•ˆï¼</span>
        createOrder(order);
        
        <span class="hljs-comment">// æ­£ç¡®çš„è°ƒç”¨æ–¹å¼</span>
        <span class="hljs-comment">// orderService.createOrder(order);</span>
    }
    
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createOrder</span><span class="hljs-params">(Order order)</span> {
        orderMapper.insert(order);
        updateInventory(order.getItems());
        <span class="hljs-comment">// å¦‚æœæ›´æ–°åº“å­˜å¤±è´¥ï¼ŒæœŸæœ›è®¢å•åˆ›å»ºå›æ»šï¼Œä½†è‡ªè°ƒç”¨æ—¶ä¸ä¼šå›æ»š</span>
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateInventory</span><span class="hljs-params">(List&lt;OrderItem&gt; items)</span> {
        <span class="hljs-keyword">for</span> (OrderItem item : items) {
            <span class="hljs-keyword">if</span> (item.getQuantity() &gt; getStock(item.getProductId())) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"åº“å­˜ä¸è¶³"</span>);
            }
            <span class="hljs-comment">// æ›´æ–°åº“å­˜...</span>
        }
    }
}
</code></pre>
<h3 data-id="heading-9">è§£å†³æ–¹æ¡ˆ</h3>
<p><strong>æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨AopContextè·å–ä»£ç†å¯¹è±¡</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">placeOrder</span><span class="hljs-params">(Order order)</span> {
        validateOrder(order);
        
        <span class="hljs-comment">// é€šè¿‡AopContextè·å–ä»£ç†å¯¹è±¡</span>
        <span class="hljs-type">OrderService</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> (OrderService) AopContext.currentProxy();
        proxy.createOrder(order);
    }
    
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createOrder</span><span class="hljs-params">(Order order)</span> {
        <span class="hljs-comment">// äº‹åŠ¡æ“ä½œ...</span>
    }
}
</code></pre>
<p><em>éœ€è¦åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ <code>@EnableAspectJAutoProxy(exposeProxy = true)</code></em></p>
<p><strong>æ–¹æ¡ˆäºŒï¼šé‡æ„ä»£ç ç»“æ„</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderTransactionService orderTransactionService;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">placeOrder</span><span class="hljs-params">(Order order)</span> {
        validateOrder(order);
        orderTransactionService.createOrder(order);
    }
}

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderTransactionService</span> {
    
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createOrder</span><span class="hljs-params">(Order order)</span> {
        <span class="hljs-comment">// äº‹åŠ¡æ“ä½œ...</span>
    }
}
</code></pre>
<h2 data-id="heading-10">é™·é˜±ä¸‰ï¼šå¼‚å¸¸è¢«æ•è·</h2>
<h3 data-id="heading-11">ç°è±¡æè¿°</h3>
<p>æ–¹æ³•ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œä½†äº‹åŠ¡æ²¡æœ‰å›æ»šï¼Œå› ä¸ºå¼‚å¸¸åœ¨æ–¹æ³•å†…éƒ¨è¢«æ•è·å¤„ç†äº†ã€‚</p>
<h3 data-id="heading-12">åŸç†åˆ†æ</h3>
<p>Springé»˜è®¤åªåœ¨æŠ›å‡º<strong>RuntimeException</strong>å’Œ<strong>Error</strong>æ—¶å›æ»šäº‹åŠ¡ã€‚å¦‚æœå¼‚å¸¸è¢«æ•è·ï¼Œæˆ–è€…æŠ›å‡ºçš„æ˜¯å—æ£€å¼‚å¸¸ï¼ˆChecked Exceptionï¼‰ï¼Œäº‹åŠ¡ä¸ä¼šè‡ªåŠ¨å›æ»šã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PaymentService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> PaymentMapper paymentMapper;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> AccountService accountService;
    
    <span class="hljs-comment">// é”™è¯¯ç¤ºä¾‹ï¼šå¼‚å¸¸è¢«æ•è·</span>
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processPayment</span><span class="hljs-params">(Payment payment)</span> {
        <span class="hljs-keyword">try</span> {
            paymentMapper.insert(payment);
            accountService.deductBalance(payment.getUserId(), payment.getAmount());
            <span class="hljs-comment">// å¯èƒ½æŠ›å‡ºå—æ£€å¼‚å¸¸</span>
            sendPaymentNotification(payment);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-comment">// å¼‚å¸¸è¢«æ•è·ï¼Œäº‹åŠ¡ä¸ä¼šå›æ»šï¼</span>
            log.error(<span class="hljs-string">"æ”¯ä»˜å¤„ç†å¤±è´¥"</span>, e);
        }
    }
    
    <span class="hljs-comment">// é”™è¯¯ç¤ºä¾‹ï¼šæŠ›å‡ºå—æ£€å¼‚å¸¸</span>
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processPaymentWithCheckedException</span><span class="hljs-params">(Payment payment)</span> <span class="hljs-keyword">throws</span> IOException {
        paymentMapper.insert(payment);
        accountService.deductBalance(payment.getUserId(), payment.getAmount());
        
        <span class="hljs-keyword">if</span> (payment.getAmount().compareTo(BigDecimal.ZERO) &lt; <span class="hljs-number">0</span>) {
            <span class="hljs-comment">// å—æ£€å¼‚å¸¸ï¼Œé»˜è®¤ä¸ä¼šè§¦å‘å›æ»š</span>
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IOException</span>(<span class="hljs-string">"æ”¯ä»˜é‡‘é¢ä¸èƒ½ä¸ºè´Ÿæ•°"</span>);
        }
    }
}
</code></pre>
<h3 data-id="heading-13">è§£å†³æ–¹æ¡ˆ</h3>
<p><strong>æ–¹æ¡ˆä¸€ï¼šæ‰‹åŠ¨å›æ»š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Transactional</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processPayment</span><span class="hljs-params">(Payment payment)</span> {
    <span class="hljs-keyword">try</span> {
        paymentMapper.insert(payment);
        accountService.deductBalance(payment.getUserId(), payment.getAmount());
        sendPaymentNotification(payment);
    } <span class="hljs-keyword">catch</span> (Exception e) {
        log.error(<span class="hljs-string">"æ”¯ä»˜å¤„ç†å¤±è´¥"</span>, e);
        <span class="hljs-comment">// æ‰‹åŠ¨è®¾ç½®å›æ»š</span>
        TransactionAspectSupport.currentTransactionStatus().setRollbackOnly();
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"æ”¯ä»˜å¤±è´¥"</span>, e);
    }
}
</code></pre>
<p><strong>æ–¹æ¡ˆäºŒï¼šæŒ‡å®šå›æ»šå¼‚å¸¸</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æŒ‡å®šæ‰€æœ‰Exceptionéƒ½è§¦å‘å›æ»š</span>
<span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processPaymentWithCheckedException</span><span class="hljs-params">(Payment payment)</span> <span class="hljs-keyword">throws</span> IOException {
    paymentMapper.insert(payment);
    accountService.deductBalance(payment.getUserId(), payment.getAmount());
    
    <span class="hljs-keyword">if</span> (payment.getAmount().compareTo(BigDecimal.ZERO) &lt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IOException</span>(<span class="hljs-string">"æ”¯ä»˜é‡‘é¢ä¸èƒ½ä¸ºè´Ÿæ•°"</span>);
    }
}

<span class="hljs-comment">// æ›´ç²¾ç¡®çš„æ§åˆ¶</span>
<span class="hljs-meta">@Transactional(rollbackFor = {BusinessException.class, IOException.class}, 
               noRollbackFor = {ValidationException.class})</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processPaymentWithSpecificExceptions</span><span class="hljs-params">(Payment payment)</span> {
    <span class="hljs-comment">// ä¸šåŠ¡é€»è¾‘...</span>
}
``
## é™·é˜±å››ï¼šæ•°æ®åº“å¼•æ“ä¸æ”¯æŒäº‹åŠ¡

### ç°è±¡æè¿°
åœ¨MySQLä¸­ä½¿ç”¨MyISAMå­˜å‚¨å¼•æ“ï¼Œäº‹åŠ¡æ³¨è§£å®Œå…¨æ— æ•ˆã€‚

### åŸç†åˆ†æ
MyISAMæ˜¯MySQLçš„é»˜è®¤å­˜å‚¨å¼•æ“ï¼ˆåœ¨æ—§ç‰ˆæœ¬ä¸­ï¼‰ï¼Œä½†å®ƒ**ä¸æ”¯æŒäº‹åŠ¡**ã€‚åªæœ‰æ”¯æŒäº‹åŠ¡çš„å­˜å‚¨å¼•æ“ï¼ˆå¦‚InnoDBï¼‰æ‰èƒ½æ­£å¸¸å·¥ä½œã€‚

### è§£å†³æ–¹æ¡ˆ

**æ£€æŸ¥å¹¶ä¿®æ”¹æ•°æ®åº“å¼•æ“ï¼š**
```sql
-- æ£€æŸ¥è¡¨ä½¿ç”¨çš„å­˜å‚¨å¼•æ“
SHOW TABLE STATUS LIKE <span class="hljs-string">'your_table_name'</span>;

-- ä¿®æ”¹è¡¨å­˜å‚¨å¼•æ“ä¸ºInnoDB
ALTER TABLE your_table_name ENGINE=InnoDB;

-- åˆ›å»ºæ–°è¡¨æ—¶æŒ‡å®šå­˜å‚¨å¼•æ“
CREATE TABLE <span class="hljs-title function_">example</span> <span class="hljs-params">(
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(<span class="hljs-number">100</span>)</span>
) ENGINE=InnoDB;
</code></pre>
<p><strong>Springé…ç½®ä¸­éªŒè¯äº‹åŠ¡ç®¡ç†å™¨ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableTransactionManagement</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TransactionConfig</span> {
    
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> PlatformTransactionManager <span class="hljs-title function_">transactionManager</span><span class="hljs-params">(DataSource dataSource)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataSourceTransactionManager</span>(dataSource);
    }
}
</code></pre>
<h2 data-id="heading-14">é™·é˜±äº”ï¼šé”™è¯¯çš„ä¼ æ’­æœºåˆ¶</h2>
<h3 data-id="heading-15">ç°è±¡æè¿°</h3>
<p>æœŸæœ›ä¸€ä¸ªæ“ä½œåœ¨ç‹¬ç«‹äº‹åŠ¡ä¸­æ‰§è¡Œï¼Œä½†ç”±äºä¼ æ’­æœºåˆ¶è®¾ç½®ä¸å½“ï¼Œå¯¼è‡´äº‹åŠ¡è¡Œä¸ºä¸ç¬¦åˆé¢„æœŸã€‚</p>
<h3 data-id="heading-16">åŸç†åˆ†æ</h3>
<p>Springæä¾›äº†å¤šç§äº‹åŠ¡ä¼ æ’­æœºåˆ¶ï¼Œé”™è¯¯çš„ä½¿ç”¨ä¼šå¯¼è‡´äº‹åŠ¡è¾¹ç•Œæ··ä¹±ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AuditService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> AuditMapper auditMapper;
    
    <span class="hljs-comment">// é”™è¯¯ä½¿ç”¨ä¼ æ’­æœºåˆ¶</span>
    <span class="hljs-meta">@Transactional(propagation = Propagation.SUPPORTS)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">logOperation</span><span class="hljs-params">(String operation)</span> {
        auditMapper.insert(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AuditLog</span>(operation));
        <span class="hljs-comment">// å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œè¿™ä¸ªæ’å…¥æ“ä½œä¸ä¼šåœ¨äº‹åŠ¡ä¸­æ‰§è¡Œ</span>
    }
}

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BusinessService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> AuditService auditService;
    
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">businessMethod</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// ä¸»ä¸šåŠ¡é€»è¾‘...</span>
        
        <span class="hljs-comment">// å®¡è®¡æ—¥å¿— - æœŸæœ›ç‹¬ç«‹äº‹åŠ¡ï¼Œä½†å®é™…ä½¿ç”¨äº†ä¸»äº‹åŠ¡</span>
        auditService.logOperation(<span class="hljs-string">"ä¸šåŠ¡æ“ä½œå®Œæˆ"</span>);
    }
}
</code></pre>
<h3 data-id="heading-17">è§£å†³æ–¹æ¡ˆ</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AuditService</span> {
    
    <span class="hljs-comment">// æ­£ç¡®ä½¿ç”¨REQUIRES_NEW</span>
    <span class="hljs-meta">@Transactional(propagation = Propagation.REQUIRES_NEW)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">logOperationInNewTransaction</span><span class="hljs-params">(String operation)</span> {
        auditMapper.insert(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AuditLog</span>(operation));
        <span class="hljs-comment">// è¿™ä¸ªæ“ä½œä¼šåœ¨ç‹¬ç«‹çš„æ–°äº‹åŠ¡ä¸­æ‰§è¡Œ</span>
        <span class="hljs-comment">// å³ä½¿å¤–éƒ¨äº‹åŠ¡å›æ»šï¼Œå®¡è®¡æ—¥å¿—ä»ç„¶ä¼šä¿å­˜</span>
    }
    
    <span class="hljs-comment">// æ­£ç¡®ä½¿ç”¨NOT_SUPPORTED</span>
    <span class="hljs-meta">@Transactional(propagation = Propagation.NOT_SUPPORTED)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">logOperationWithoutTransaction</span><span class="hljs-params">(String operation)</span> {
        auditMapper.insert(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AuditLog</span>(operation));
        <span class="hljs-comment">// è¿™ä¸ªæ“ä½œä¼šåœ¨æ— äº‹åŠ¡ç¯å¢ƒä¸­æ‰§è¡Œ</span>
    }
}
</code></pre>
<h2 data-id="heading-18">é™·é˜±å…­ï¼šæ–¹æ³•å†…æ‰‹åŠ¨æäº¤</h2>
<h3 data-id="heading-19">ç°è±¡æè¿°</h3>
<p>åœ¨æ–¹æ³•ä¸­æ‰‹åŠ¨è·å–Connectionå¹¶æ‰§è¡Œcommitï¼Œå¹²æ‰°äº†Springçš„äº‹åŠ¡ç®¡ç†ã€‚</p>
<h3 data-id="heading-20">åŸç†åˆ†æ</h3>
<p>Springé€šè¿‡ThreadLocalæ¥ç®¡ç†äº‹åŠ¡ä¸Šä¸‹æ–‡ï¼Œæ‰‹åŠ¨æ“ä½œConnectionä¼šç ´åè¿™ç§ç®¡ç†æœºåˆ¶ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// é”™è¯¯ç¤ºä¾‹ï¼šæ‰‹åŠ¨ç®¡ç†Connection</span>
<span class="hljs-meta">@Transactional</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateWithManualCommit</span><span class="hljs-params">(Data data)</span> {
    <span class="hljs-type">Connection</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">try</span> {
        conn = dataSource.getConnection();
        conn.setAutoCommit(<span class="hljs-literal">false</span>);
        
        <span class="hljs-comment">// æ‰§è¡ŒSQLæ“ä½œ</span>
        updateData(conn, data);
        
        <span class="hljs-comment">// æ‰‹åŠ¨æäº¤</span>
        conn.commit();
    } <span class="hljs-keyword">catch</span> (SQLException e) {
        <span class="hljs-keyword">if</span> (conn != <span class="hljs-literal">null</span>) {
            conn.rollback();
        }
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);
    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-keyword">if</span> (conn != <span class="hljs-literal">null</span>) {
            conn.close();
        }
    }
}
</code></pre>
<h3 data-id="heading-21">è§£å†³æ–¹æ¡ˆ</h3>
<p><strong>å®Œå…¨ä¾èµ–Springçš„äº‹åŠ¡ç®¡ç†ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Transactional</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateWithSpringTransaction</span><span class="hljs-params">(Data data)</span> {
    <span class="hljs-comment">// ç›´æ¥ä½¿ç”¨Springç®¡ç†çš„æ•°æ®è®¿é—®ç»„ä»¶</span>
    jdbcTemplate.update(<span class="hljs-string">"UPDATE table SET column = ? WHERE id = ?"</span>, 
                       data.getValue(), data.getId());
    <span class="hljs-comment">// Springä¼šè‡ªåŠ¨å¤„ç†äº‹åŠ¡æäº¤å’Œå›æ»š</span>
}
</code></pre>
<h2 data-id="heading-22">é™·é˜±ä¸ƒï¼šå¼‚æ­¥æ–¹æ³•è°ƒç”¨</h2>
<h3 data-id="heading-23">ç°è±¡æè¿°</h3>
<p>åœ¨å¼‚æ­¥æ–¹æ³•ä¸­ä½¿ç”¨<code>@Transactional</code>ï¼Œäº‹åŠ¡ä¸Šä¸‹æ–‡æ— æ³•ä¼ é€’åˆ°æ–°çº¿ç¨‹ã€‚</p>
<h3 data-id="heading-24">åŸç†åˆ†æ</h3>
<p>äº‹åŠ¡ä¿¡æ¯å­˜å‚¨åœ¨ThreadLocalä¸­ï¼Œå¼‚æ­¥æ‰§è¡Œæ—¶ä¼šåˆ‡æ¢åˆ°æ–°çš„çº¿ç¨‹ï¼Œäº‹åŠ¡ä¸Šä¸‹æ–‡ä¸¢å¤±ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AsyncService</span> {
    
    <span class="hljs-meta">@Async</span>
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">asyncProcess</span><span class="hljs-params">(Data data)</span> {
        <span class="hljs-comment">// è¿™ä¸ªäº‹åŠ¡ä¸ä¼šç”Ÿæ•ˆï¼</span>
        dataMapper.insert(data);
        processData(data);
    }
}
</code></pre>
<h3 data-id="heading-25">è§£å†³æ–¹æ¡ˆ</h3>
<p><strong>æ–¹æ¡ˆä¸€ï¼šåœ¨è°ƒç”¨å¼‚æ­¥æ–¹æ³•å‰å®Œæˆäº‹åŠ¡æ“ä½œ</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> AsyncService asyncService;
    
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">mainProcess</span><span class="hljs-params">(Data data)</span> {
        <span class="hljs-comment">// åœ¨ä¸»äº‹åŠ¡ä¸­å®Œæˆæ ¸å¿ƒæ•°æ®æ“ä½œ</span>
        dataMapper.insert(data);
        
        <span class="hljs-comment">// å¼‚æ­¥å¤„ç†éæ ¸å¿ƒä¸šåŠ¡</span>
        asyncService.asyncProcessNonCritical(data);
    }
}

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AsyncService</span> {
    
    <span class="hljs-meta">@Async</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">asyncProcessNonCritical</span><span class="hljs-params">(Data data)</span> {
        <span class="hljs-comment">// éæ ¸å¿ƒçš„å¼‚æ­¥å¤„ç†ï¼Œä¸è¦æ±‚äº‹åŠ¡</span>
        sendNotification(data);
        updateCache(data);
    }
}
</code></pre>
<p><strong>æ–¹æ¡ˆäºŒï¼šä½¿ç”¨ç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AsyncService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> TransactionTemplate transactionTemplate;
    
    <span class="hljs-meta">@Async</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">asyncProcessWithTransaction</span><span class="hljs-params">(Data data)</span> {
        transactionTemplate.execute(status -&gt; {
            <span class="hljs-comment">// åœ¨ç¼–ç¨‹å¼äº‹åŠ¡ä¸­æ‰§è¡Œ</span>
            dataMapper.insert(data);
            processData(data);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        });
    }
}
</code></pre>
<h2 data-id="heading-26">é™·é˜±å…«ï¼šå¤šæ•°æ®æºäº‹åŠ¡é…ç½®é”™è¯¯</h2>
<h3 data-id="heading-27">ç°è±¡æè¿°</h3>
<p>åœ¨å¤šæ•°æ®æºç¯å¢ƒä¸‹ï¼Œäº‹åŠ¡ç®¡ç†å™¨é…ç½®ä¸æ­£ç¡®ï¼Œå¯¼è‡´äº‹åŠ¡æ— æ³•æ­£ç¡®ç»‘å®šåˆ°å¯¹åº”çš„æ•°æ®æºã€‚</p>
<h3 data-id="heading-28">åŸç†åˆ†æ</h3>
<p>å½“å­˜åœ¨å¤šä¸ªæ•°æ®æºæ—¶ï¼Œéœ€è¦æ˜ç¡®æŒ‡å®šæ¯ä¸ªäº‹åŠ¡ä½¿ç”¨å“ªä¸ªäº‹åŠ¡ç®¡ç†å™¨ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// é”™è¯¯é…ç½®ï¼šæ²¡æœ‰æŒ‡å®šäº‹åŠ¡ç®¡ç†å™¨</span>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableTransactionManagement</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MultiDataSourceConfig</span> {
    
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-meta">@Primary</span>
    <span class="hljs-keyword">public</span> DataSource <span class="hljs-title function_">primaryDataSource</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// ä¸»æ•°æ®æºé…ç½®</span>
    }
    
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> DataSource <span class="hljs-title function_">secondaryDataSource</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// æ¬¡è¦æ•°æ®æºé…ç½®</span>
    }
    
    <span class="hljs-comment">// åªé…ç½®äº†ä¸€ä¸ªäº‹åŠ¡ç®¡ç†å™¨</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> PlatformTransactionManager <span class="hljs-title function_">transactionManager</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataSourceTransactionManager</span>(primaryDataSource());
    }
}
</code></pre>
<h3 data-id="heading-29">è§£å†³æ–¹æ¡ˆ</h3>
<p><strong>æ­£ç¡®é…ç½®å¤šæ•°æ®æºäº‹åŠ¡ç®¡ç†ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableTransactionManagement</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MultiDataSourceConfig</span> {
    
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-meta">@Primary</span>
    <span class="hljs-keyword">public</span> DataSource <span class="hljs-title function_">primaryDataSource</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// ä¸»æ•°æ®æºé…ç½®</span>
    }
    
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> DataSource <span class="hljs-title function_">secondaryDataSource</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// æ¬¡è¦æ•°æ®æºé…ç½®</span>
    }
    
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-meta">@Primary</span>
    <span class="hljs-keyword">public</span> PlatformTransactionManager <span class="hljs-title function_">primaryTransactionManager</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataSourceTransactionManager</span>(primaryDataSource());
    }
    
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> PlatformTransactionManager <span class="hljs-title function_">secondaryTransactionManager</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataSourceTransactionManager</span>(secondaryDataSource());
    }
}

<span class="hljs-comment">// ä½¿ç”¨æŒ‡å®šçš„äº‹åŠ¡ç®¡ç†å™¨</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    
    <span class="hljs-meta">@Transactional(transactionManager = "primaryTransactionManager")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">primaryDatabaseOperation</span><span class="hljs-params">(User user)</span> {
        <span class="hljs-comment">// ä½¿ç”¨ä¸»æ•°æ®æºçš„äº‹åŠ¡</span>
    }
    
    <span class="hljs-meta">@Transactional(transactionManager = "secondaryTransactionManager")</span>  
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">secondaryDatabaseOperation</span><span class="hljs-params">(Log log)</span> {
        <span class="hljs-comment">// ä½¿ç”¨æ¬¡è¦æ•°æ®æºçš„äº‹åŠ¡</span>
    }
}
</code></pre>
<h2 data-id="heading-30">æ€»ç»“ä¸æœ€ä½³å®è·µ</h2>


















































<table><thead><tr><th>é™·é˜±åœºæ™¯</th><th>é—®é¢˜ç°è±¡</th><th>è§£å†³æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td>éPublicæ–¹æ³•</td><td>äº‹åŠ¡å®Œå…¨ä¸ç”Ÿæ•ˆ</td><td>å°†æ–¹æ³•æ”¹ä¸ºpublic</td></tr><tr><td>è‡ªè°ƒç”¨é—®é¢˜</td><td>åŒç±»è°ƒç”¨äº‹åŠ¡å¤±æ•ˆ</td><td>ä½¿ç”¨AopContextæˆ–é‡æ„ä»£ç ç»“æ„</td></tr><tr><td>å¼‚å¸¸è¢«æ•è·</td><td>å¼‚å¸¸å¤„ç†ä½†äº‹åŠ¡æœªå›æ»š</td><td>æ‰‹åŠ¨å›æ»šæˆ–æŒ‡å®šrollbackFor</td></tr><tr><td>æ•°æ®åº“å¼•æ“ä¸æ”¯æŒ</td><td>äº‹åŠ¡æ³¨è§£æ— æ•ˆ</td><td>ä½¿ç”¨InnoDBç­‰æ”¯æŒäº‹åŠ¡çš„å¼•æ“</td></tr><tr><td>é”™è¯¯çš„ä¼ æ’­æœºåˆ¶</td><td>äº‹åŠ¡è¾¹ç•Œæ··ä¹±</td><td>æ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©åˆé€‚çš„ä¼ æ’­æœºåˆ¶</td></tr><tr><td>æ–¹æ³•å†…æ‰‹åŠ¨æäº¤</td><td>å¹²æ‰°Springäº‹åŠ¡ç®¡ç†</td><td>å®Œå…¨ä¾èµ–Springå£°æ˜å¼äº‹åŠ¡</td></tr><tr><td>å¼‚æ­¥æ–¹æ³•è°ƒç”¨</td><td>äº‹åŠ¡ä¸Šä¸‹æ–‡ä¸¢å¤±</td><td>åˆ†ç¦»äº‹åŠ¡æ“ä½œä¸å¼‚æ­¥å¤„ç†</td></tr><tr><td>å¤šæ•°æ®æºé…ç½®é”™è¯¯</td><td>äº‹åŠ¡ç»‘å®šé”™è¯¯æ•°æ®æº</td><td>æ˜ç¡®é…ç½®å’ŒæŒ‡å®šäº‹åŠ¡ç®¡ç†å™¨</td></tr></tbody></table>
<h2 data-id="heading-31">è°ƒè¯•æŠ€å·§</h2>
<p><strong>æŸ¥çœ‹äº‹åŠ¡çŠ¶æ€ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Transactional</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">debugTransaction</span><span class="hljs-params">()</span> {
    <span class="hljs-type">TransactionStatus</span> <span class="hljs-variable">status</span> <span class="hljs-operator">=</span> TransactionAspectSupport.currentTransactionStatus();
    System.out.println(<span class="hljs-string">"æ˜¯å¦æ˜¯æ–°äº‹åŠ¡: "</span> + status.isNewTransaction());
    System.out.println(<span class="hljs-string">"æ˜¯å¦æœ‰ä¿å­˜ç‚¹: "</span> + status.hasSavepoint());
    System.out.println(<span class="hljs-string">"æ˜¯å¦å·²å®Œæˆ: "</span> + status.isCompleted());
}
</code></pre>
<p><strong>å¯ç”¨äº‹åŠ¡è°ƒè¯•æ—¥å¿—ï¼š</strong></p>
<pre><code class="hljs language-properties" lang="properties"># application.properties
logging.level.org.springframework.transaction.interceptor=TRACE
logging.level.org.springframework.jdbc.datasource.DataSourceTransactionManager=DEBUG
</code></pre>
<h2 data-id="heading-32">äº’åŠ¨è®¨è®º</h2>
<p>ä½ åœ¨é¡¹ç›®ä¸­è¿˜é‡åˆ°è¿‡å“ªäº›Springäº‹åŠ¡ç›¸å…³çš„é—®é¢˜ï¼Ÿæ˜¯å¦æœ‰å…¶ä»–æœ‰è¶£çš„"å‘"æƒ³è¦åˆ†äº«ï¼Ÿæ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€è®¨è®ºï¼</p>
<hr/>
<p><strong>ä¸‹ä¸€ç¯‡é¢„å‘Š</strong>ï¼šã€ŠSpringäº‹åŠ¡ä¼ æ’­æœºåˆ¶æ·±åº¦è§£æï¼š7ç§ä¼ æ’­è¡Œä¸ºçš„ä½¿ç”¨åœºæ™¯å’Œé™·é˜±ã€‹</p>
<p>è®°å¾—å…³æ³¨å’Œç‚¹èµï¼Œè·å–æ›´å¤šæŠ€æœ¯å¹²è´§ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¦‚ä½•ä½¿ç”¨ ECK åœ¨ AWS EKS è‡ªåŠ¨æ¨¡å¼ä¸‹éƒ¨ç½² Elasticsearch å’Œ Kibana]]></title>    <link>https://juejin.cn/post/7570908785293918227</link>    <guid>https://juejin.cn/post/7570908785293918227</guid>    <pubDate>2025-11-10T23:38:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570908785293918227" data-draft-id="7570885801478783017" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¦‚ä½•ä½¿ç”¨ ECK åœ¨ AWS EKS è‡ªåŠ¨æ¨¡å¼ä¸‹éƒ¨ç½² Elasticsearch å’Œ Kibana"/> <meta itemprop="keywords" content="Elasticsearch"/> <meta itemprop="datePublished" content="2025-11-10T23:38:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Elasticsearch"/> <meta itemprop="url" content="https://juejin.cn/user/2612095360441448"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¦‚ä½•ä½¿ç”¨ ECK åœ¨ AWS EKS è‡ªåŠ¨æ¨¡å¼ä¸‹éƒ¨ç½² Elasticsearch å’Œ Kibana
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2612095360441448/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Elasticsearch
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T23:38:32.000Z" title="Mon Nov 10 2025 23:38:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æœ¬æ–‡ç”± <a href="https://link.juejin.cn?target=http%3A%2F%2Fksria.com%2Fsimpread%2F" target="_blank" title="http://ksria.com/simpread/" ref="nofollow noopener noreferrer">ç®€æ‚¦ SimpRead</a> è½¬ç ï¼Œ åŸæ–‡åœ°å€ <a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2FUbuntuTouch%2Farticle%2Fdetails%2F154675171%3Fspm%3D1001.2014.3001.5501" target="_blank" title="https://blog.csdn.net/UbuntuTouch/article/details/154675171?spm=1001.2014.3001.5501" ref="nofollow noopener noreferrer">blog.csdn.net</a></p>
</blockquote>
<p>ä½œè€…ï¼šæ¥è‡ª ElasticÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fsearch-labs%2Fauthor%2Feduard-martin" title="https://www.elastic.co/search-labs/author/eduard-martin" target="_blank" ref="nofollow noopener noreferrer">Eduard Martin</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf1529d8a25f4b6cbbc324bf0d71938b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763422711&amp;x-signature=zuJaSk%2B8sS3J2g2e7k2Mzm1OI8M%3D" alt="" loading="lazy"/></p>
<p>åœ¨è¿™ä¸ªæ˜“äºç†è§£çš„æŒ‡å—ä¸­ï¼Œå­¦ä¹ å¦‚ä½•ä½¿ç”¨ AWS EKS è‡ªåŠ¨æ¨¡å¼å’Œ ECK åœ¨ Kubernetes ä¸Šéƒ¨ç½² Elasticsearch å’Œ Kibanaã€‚</p>
<p>åˆæ¬¡æ¥è§¦ Elasticsearchï¼ŸåŠ å…¥æˆ‘ä»¬çš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fvirtual-events%2Fgetting-started-elasticsearch" title="https://www.elastic.co/virtual-events/getting-started-elasticsearch" target="_blank" ref="nofollow noopener noreferrer">Elasticsearch å…¥é—¨</a>ç½‘ç»œç ”è®¨ä¼šå§ã€‚ä½ ä¹Ÿå¯ä»¥ç«‹å³å¼€å§‹<a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.elastic.co%2Fregistration" title="https://cloud.elastic.co/registration" target="_blank" ref="nofollow noopener noreferrer">å…è´¹çš„äº‘è¯•ç”¨</a>ï¼Œæˆ–åœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F143747798" title="https://elasticstack.blog.csdn.net/article/details/143747798" target="_blank" ref="nofollow noopener noreferrer">æœ¬åœ°æœºå™¨</a>ä¸Šä½“éªŒ Elasticã€‚</p>
<hr/>
<p>è¿™ç¯‡æ–‡ç« æ˜¯ä¸€ä¸ªç³»åˆ—çš„ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†åœ¨å…¶ä¸­å­¦ä¹ å¦‚ä½•ä½¿ç”¨ä¸åŒçš„åŸºç¡€è®¾æ–½å®‰è£… Elasticsearchã€‚</p>
<p>è¿™æ¬¡ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Kubernetes æœåŠ¡ï¼ˆEKSï¼‰çš„è‡ªåŠ¨æ¨¡å¼ã€‚åœ¨å…¶ä»–æ–‡ç« ä¸­ï¼Œä½ å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fsearch-labs%2Fblog%2Felasticsearch-on-aws-ec2-deployment-guide" title="https://www.elastic.co/search-labs/blog/elasticsearch-on-aws-ec2-deployment-guide" target="_blank" ref="nofollow noopener noreferrer">AWS EC2</a> å’Œ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fsearch-labs%2Fblog%2Faws-elasticsearch-service-set-up" title="https://www.elastic.co/search-labs/blog/aws-elasticsearch-service-set-up" target="_blank" ref="nofollow noopener noreferrer">AWS Marketplace</a>ã€‚</p>
<p>å¯¹äº Elasticsearchï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Fdeploy-manage%2Fdeploy%2Fcloud-on-k8s" title="https://www.elastic.co/docs/deploy-manage/deploy/cloud-on-k8s" target="_blank" ref="nofollow noopener noreferrer">Elastic Cloud on Kubernetes</a>ï¼ˆECKï¼‰ï¼Œè¿™æ˜¯å®˜æ–¹çš„ Elasticsearch Kubernetes è¿ç»´å·¥å…·ï¼Œå¯ç®€åŒ–æ‰€æœ‰ Elastic Stack ç»„ä»¶åœ¨ Kubernetes ä¸Šçš„éƒ¨ç½²ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/30e9dd685b904daf985128dbfbe05b66~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763422711&amp;x-signature=DpgjxeA45l8%2BEZkMEbNLoKFT6NE%3D" alt="" loading="lazy"/></p>
<p>ä¸åŸºäº Marketplace çš„ Elastic Cloud è§£å†³æ–¹æ¡ˆç›¸æ¯”ï¼ŒECK éœ€è¦æ›´å¤šçš„é…ç½®å·¥ä½œï¼Œä½†æ¯”ä½ è‡ªå·±éƒ¨ç½²è™šæ‹Ÿæœºæ›´è‡ªåŠ¨åŒ–ï¼Œå› ä¸º Kubernetes è¿ç»´å·¥å…·ä¼šè´Ÿè´£ç³»ç»Ÿç¼–æ’å’ŒèŠ‚ç‚¹æ‰©ç¼©å®¹ã€‚</p>
<h2 data-id="heading-0">ä»€ä¹ˆæ˜¯ EKS è‡ªåŠ¨æ¨¡å¼ï¼Ÿ</h2>
<p>EKS è‡ªåŠ¨æ¨¡å¼ï¼ˆ<em><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Faws.amazon.com%2Feks%2Fauto-mode%2F" title="https://aws.amazon.com/eks/auto-mode/" target="_blank" ref="nofollow noopener noreferrer">Auto Mode</a></strong></em>ï¼‰æ˜¯ AWS æä¾›çš„ä¸€ç§éƒ¨ç½²æ¨¡å‹ï¼Œå®ƒç®€åŒ–äº†æ•°æ®å¹³é¢çš„é…ç½®ï¼›ä¾‹å¦‚å­˜å‚¨ã€ç½‘ç»œå’Œè®¡ç®—ç­‰ç°åœ¨éƒ½ç”± EKS ç®¡ç†ã€‚é€šè¿‡ä¸€é”®å®‰è£…ï¼Œè‡ªåŠ¨æ¨¡å¼ä¼šè‡ªåŠ¨é€‰æ‹©æœ€ä¼˜èµ„æºï¼Œå¹¶åœ¨éœ€è¦æ—¶ä¸ºä½ è¿›è¡Œæ‰©å±•ã€‚ä½ å¯ä»¥åœ¨æˆ‘ä»¬çš„ AWS EC2 å’Œ AWS Marketplace æ–‡ç« ä¸­æ¢ç´¢å…¶ä»– AWS é€‰é¡¹ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f347ce69cb0b4e64afba5c780e3ed7f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763422711&amp;x-signature=iIRY%2F8rEAN6gnQ3YmloCJhI3xVQ%3D" alt="" loading="lazy"/><br/>
<em>Source:Â <a href="https://link.juejin.cn?target=https%3A%2F%2Faws.amazon.com%2Fblogs%2Fcontainers%2Fgetting-started-with-amazon-eks-auto-mode%2F" title="https://aws.amazon.com/blogs/containers/getting-started-with-amazon-eks-auto-mode/" target="_blank" ref="nofollow noopener noreferrer">aws.amazon.com/blogs/contaâ€¦</a></em></p>
<h2 data-id="heading-1">å¦‚ä½•è®¾ç½® ECK è¿ç»´å·¥å…·</h2>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å°†å®‰è£… eksctlï¼Œå®ƒæ˜¯ç”¨äºä»ç»ˆç«¯ç®¡ç† AWS EKS çš„å®˜æ–¹ CLIï¼Œç„¶ååœ¨å·²éƒ¨ç½²çš„ EKS Kubernetes é›†ç¾¤ä¸Šå®‰è£…å¹¶è¿è¡Œ ECK è¿ç»´å·¥å…·ã€‚</p>
<p>1ï¼‰ç™»å½• <a href="https://link.juejin.cn?target=https%3A%2F%2Faws.amazon.com%2F" title="https://aws.amazon.com/" target="_blank" ref="nofollow noopener noreferrer">AWS</a></p>
<p>2ï¼‰åœ¨<strong>å·¦ä¸‹è§’</strong>ç‚¹å‡» <strong>CloudShell</strong> æŒ‰é’®è¿›å…¥æ§åˆ¶å°ï¼Œå¹¶ä»é‚£é‡Œéƒ¨ç½² EKS é›†ç¾¤ã€‚æˆ–è€…ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ <strong>AWS CLI</strong>ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/51e8e673c5704071ab4e3f68b3245f4c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763422711&amp;x-signature=P5zinm9C69PRih8sW8af0WQS6fE%3D" alt="" loading="lazy"/></p>
<p>3ï¼‰å®‰è£… eksctlï¼Œé€šè¿‡ CloudShell ç®¡ç† EKS é›†ç¾¤</p>
<pre><code class="hljs language-bash" lang="bash"> `1.   <span class="hljs-comment"># 1. Download the eksctl archive to your current directory</span>
2.  curl --silent --location <span class="hljs-string">"https://github.com/eksctl-io/eksctl/releases/latest/download/eksctl_<span class="hljs-subst">$(uname -s)</span>_amd64.tar.gz"</span> -o eksctl.tar.gz

4.  <span class="hljs-comment"># 2. Extract the eksctl binary to the /tmp directory</span>
5.  tar xz -C /tmp -f eksctl.tar.gz

7.  <span class="hljs-comment"># 3. Move the eksctl binary to /usr/local/bin using sudo for system-wide access</span>
8.  sudo <span class="hljs-built_in">mv</span> /tmp/eksctl /usr/local/bin

10.  <span class="hljs-comment"># 4. Make the eksctl binary executable (if it's not already)</span>
11.  sudo <span class="hljs-built_in">chmod</span> +x /usr/local/bin/eksctl

13.  <span class="hljs-comment"># 5. Verify the installation by checking the eksctl version</span>
14.  eksctl version`AIå†™ä»£ç ![](https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png)
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f2176ce48bc4186a490054aa6762985~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763422711&amp;x-signature=GmrBaDpmwRUWloaZg6Bhqsi76ec%3D" alt="" loading="lazy"/></p>
<p>4ï¼‰åˆ›å»ºä¸€ä¸ªè‡ªåŠ¨æ¨¡å¼çš„ EKS é›†ç¾¤</p>
<pre><code class="hljs language-css" lang="css">`eksctl create cluster <span class="hljs-attr">--name</span> elastic-test <span class="hljs-attr">--region</span> us-east-<span class="hljs-number">1</span> <span class="hljs-attr">--enable-auto-mode</span>`AIå†™ä»£ç 
</code></pre>
<p>5ï¼‰ç­‰å¾…é›†ç¾¤å‡†å¤‡å°±ç»ªã€‚åˆ›å»ºå¤§çº¦éœ€è¦ 10 åˆ†é’Ÿã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b616963081684cefa7e0f03df7dcdcc8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763422711&amp;x-signature=iKqmmV31o2VM%2BYwtd0bw4DDRrJQ%3D" alt="" loading="lazy"/></p>
<p>6ï¼‰å®‰è£… Elastic Cloud on Kubernetesï¼ˆECKï¼‰è¿ç»´å·¥å…·</p>
<pre><code class="hljs language-bash" lang="bash">`

1.  <span class="hljs-comment"># Install ECK Custom Resource Definitions</span>
2.  kubectl create -f https://download.elastic.co/downloads/eck/2.16.1/crds.yaml

4.  <span class="hljs-comment"># Install the ECK operator</span>
5.  kubectl apply -f https://download.elastic.co/downloads/eck/2.16.1/operator.yaml

`AIå†™ä»£ç 
</code></pre>
<p>7ï¼‰åˆ›å»º storageClass</p>
<p>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª gp3 EBS storageClassï¼ŒEKS è‡ªåŠ¨æ¨¡å¼å°†è‡ªåŠ¨å®‰è£… <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fkubernetes-sigs%2Faws-ebs-csi-driver%2F" title="https://github.com/kubernetes-sigs/aws-ebs-csi-driver/" target="_blank" ref="nofollow noopener noreferrer">CSI Driver</a>ã€‚ä½ å¯ä»¥åœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.aws.amazon.com%2Febs%2Flatest%2Fuserguide%2Febs-volume-types.html%23vol-type-ssd" title="https://docs.aws.amazon.com/ebs/latest/userguide/ebs-volume-types.html#vol-type-ssd" target="_blank" ref="nofollow noopener noreferrer">è¿™é‡Œ</a>æŸ¥çœ‹æ›´å¤šç£ç›˜é€‰é¡¹ï¼Œåœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Fdeploy-manage%2Fdeploy%2Fcloud-on-k8s%2Fstorage-recommendations" title="https://www.elastic.co/docs/deploy-manage/deploy/cloud-on-k8s/storage-recommendations" target="_blank" ref="nofollow noopener noreferrer">è¿™é‡Œ</a>æŸ¥çœ‹ ECK å­˜å‚¨æ¨èã€‚</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">`</span>

<span class="hljs-number">1</span><span class="hljs-string">.</span>  <span class="hljs-string">cat</span> <span class="hljs-string">&lt;&lt;EOF</span> <span class="hljs-string">|</span> <span class="hljs-string">kubectl</span> <span class="hljs-string">apply</span> <span class="hljs-string">-f</span> <span class="hljs-bullet">-</span>
<span class="hljs-attr">2.  apiVersion:</span> <span class="hljs-string">storage.k8s.io/v1</span>
<span class="hljs-attr">3.  kind:</span> <span class="hljs-string">StorageClass</span>
<span class="hljs-attr">4.  metadata:</span>
<span class="hljs-attr">5.    name:</span> <span class="hljs-string">auto-ebs-sc</span>
<span class="hljs-attr">6.    annotations:</span>
<span class="hljs-attr">7.      storageclass.kubernetes.io/is-default-class:</span> <span class="hljs-string">"true"</span>
<span class="hljs-attr">8.  provisioner:</span> <span class="hljs-string">ebs.csi.eks.amazonaws.com</span>
<span class="hljs-attr">9.  volumeBindingMode:</span> <span class="hljs-string">WaitForFirstConsumer</span>
<span class="hljs-attr">10.  parameters:</span>
<span class="hljs-attr">11.    type:</span> <span class="hljs-string">gp3</span>
<span class="hljs-attr">12.    encrypted:</span> <span class="hljs-string">"true"</span>
<span class="hljs-number">13</span><span class="hljs-string">.</span>  <span class="hljs-string">EOF</span>

<span class="hljs-string">`AIå†™ä»£ç ![](https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png)</span>
</code></pre>
<p>8ï¼‰è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªä½¿ç”¨åˆšåˆšåˆ›å»ºçš„ storageClass çš„å•èŠ‚ç‚¹ Elasticsearch å®ä¾‹ã€‚æˆ‘ä»¬å°†è¯·æ±‚ 1GB å†…å­˜å’Œ 1 ä¸ª CPUã€‚</p>
<p>å¦‚æœä½ æƒ³æŸ¥çœ‹ä¸åŒé…ç½®çš„ç¤ºä¾‹ï¼Œå¯ä»¥è®¿é—®æ­¤<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Fdeploy-manage%2Fdeploy%2Fcloud-on-k8s%2Frecipes" title="https://www.elastic.co/docs/deploy-manage/deploy/cloud-on-k8s/recipes" target="_blank" ref="nofollow noopener noreferrer">é“¾æ¥</a>ã€‚</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">`</span>

<span class="hljs-number">1</span><span class="hljs-string">.</span>  <span class="hljs-string">cat</span> <span class="hljs-string">&lt;&lt;EOF</span> <span class="hljs-string">|</span> <span class="hljs-string">kubectl</span> <span class="hljs-string">apply</span> <span class="hljs-string">-f</span> <span class="hljs-bullet">-</span>
<span class="hljs-attr">2.  apiVersion:</span> <span class="hljs-string">elasticsearch.k8s.elastic.co/v1</span>
<span class="hljs-attr">3.  kind:</span> <span class="hljs-string">Elasticsearch</span>
<span class="hljs-attr">4.  metadata:</span>
<span class="hljs-attr">5.    name:</span> <span class="hljs-string">quickstart</span>
<span class="hljs-attr">6.  spec:</span>
<span class="hljs-attr">7.    version:</span> <span class="hljs-number">9.0</span><span class="hljs-number">.0</span>
<span class="hljs-attr">8.    nodeSets:</span>
<span class="hljs-attr">9.      - name:</span> <span class="hljs-string">default</span>
<span class="hljs-attr">10.        count:</span> <span class="hljs-number">1</span>
<span class="hljs-attr">11.        podTemplate:</span>
<span class="hljs-attr">12.          spec:</span>
<span class="hljs-attr">13.            containers:</span>
<span class="hljs-attr">14.              - name:</span> <span class="hljs-string">elasticsearch</span>
<span class="hljs-attr">15.                resources:</span>
<span class="hljs-attr">16.                  requests:</span>
<span class="hljs-attr">17.                    memory:</span> <span class="hljs-string">1Gi</span>
<span class="hljs-attr">18.                    cpu:</span> <span class="hljs-number">1</span>
<span class="hljs-attr">19.                  limits:</span>
<span class="hljs-attr">20.                    memory:</span> <span class="hljs-string">1Gi</span>
<span class="hljs-attr">21.                    cpu:</span> <span class="hljs-number">1</span>
<span class="hljs-attr">22.        volumeClaimTemplates:</span>
<span class="hljs-attr">23.          - metadata:</span>
<span class="hljs-attr">24.              name:</span> <span class="hljs-string">elasticsearch-data</span>
<span class="hljs-attr">25.            spec:</span>
<span class="hljs-attr">26.              accessModes:</span>
<span class="hljs-number">27</span><span class="hljs-string">.</span>                <span class="hljs-bullet">-</span> <span class="hljs-string">ReadWriteOnce</span>
<span class="hljs-attr">28.              resources:</span>
<span class="hljs-attr">29.                requests:</span>
<span class="hljs-attr">30.                  storage:</span> <span class="hljs-string">5Gi</span>
<span class="hljs-attr">31.              storageClassName:</span> <span class="hljs-string">auto-ebs-sc</span>
<span class="hljs-number">32</span><span class="hljs-string">.</span>  <span class="hljs-string">EOF</span>

<span class="hljs-string">`AIå†™ä»£ç ![](https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png)</span>
</code></pre>
<p>9ï¼‰æˆ‘ä»¬è¿˜å°†éƒ¨ç½²ä¸€ä¸ª Kibana å•èŠ‚ç‚¹é›†ç¾¤ã€‚å¯¹äº Kibanaï¼Œæˆ‘ä»¬å°†æ·»åŠ ä¸€ä¸ª LoadBalancerï¼Œè¿™å°†ä¸ºæˆ‘ä»¬æä¾›ä¸€ä¸ªå¤–éƒ¨ IPï¼Œå¯ä»¥ä»æˆ‘ä»¬çš„è®¾å¤‡è®¿é—® Kibanaã€‚</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">`</span>

<span class="hljs-number">1</span><span class="hljs-string">.</span>  <span class="hljs-string">cat</span> <span class="hljs-string">&lt;&lt;EOF</span> <span class="hljs-string">|</span> <span class="hljs-string">kubectl</span> <span class="hljs-string">apply</span> <span class="hljs-string">-f</span> <span class="hljs-bullet">-</span>
<span class="hljs-attr">2.  apiVersion:</span> <span class="hljs-string">kibana.k8s.elastic.co/v1</span>
<span class="hljs-attr">3.  kind:</span> <span class="hljs-string">Kibana</span>
<span class="hljs-attr">4.  metadata:</span>
<span class="hljs-attr">5.    name:</span> <span class="hljs-string">quickstart</span>
<span class="hljs-attr">6.  spec:</span>
<span class="hljs-attr">7.    version:</span> <span class="hljs-number">9.0</span><span class="hljs-number">.0</span>
<span class="hljs-attr">8.    http:</span>
<span class="hljs-attr">9.      service:</span>
<span class="hljs-attr">10.        metadata:</span>
<span class="hljs-attr">11.          annotations:</span>
<span class="hljs-attr">12.            service.beta.kubernetes.io/aws-load-balancer-scheme:</span> <span class="hljs-string">"internet-facing"</span>
<span class="hljs-attr">13.        spec:</span>
<span class="hljs-attr">14.          type:</span> <span class="hljs-string">LoadBalancer</span>
<span class="hljs-attr">15.    count:</span> <span class="hljs-number">1</span>
<span class="hljs-attr">16.    elasticsearchRef:</span>
<span class="hljs-attr">17.      name:</span> <span class="hljs-string">quickstart</span>
<span class="hljs-number">18</span><span class="hljs-string">.</span>  <span class="hljs-string">EOF</span>

<span class="hljs-string">`AIå†™ä»£ç ![](https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png)</span>
</code></pre>
<p><strong>è¯·æ³¨æ„è¿™ä¸ªæ³¨è§£</strong>ï¼š</p>
<p>service.beta.kubernetes.io/aws-load-balancer-scheme: "internet-facing"</p>
<p><strong>è¿™éå¸¸é‡è¦ï¼Œå› ä¸ºå®ƒå‘Šè¯‰è‡ªåŠ¨æ¨¡å¼æä¾›ä¸€ä¸ªé¢å‘å…¬ç½‘çš„ LoadBalancerã€‚å¦‚æœæœªè®¾ç½®ï¼ŒLoadBalancer å°†æ˜¯å†…éƒ¨çš„ã€‚</strong></p>
<p>10ï¼‰æ£€æŸ¥ä½ çš„ pods æ˜¯å¦æ­£åœ¨è¿è¡Œ</p>
<pre><code class="hljs language-arduino" lang="arduino">`kubectl get pods`AIå†™ä»£ç 
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb44aa283acc43c9adabd1dd4de27704~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763422711&amp;x-signature=Osn%2Bv%2B9TOJ05hHjcdNEjKzIa0Fs%3D" alt="" loading="lazy"/></p>
<p>11ï¼‰ä½ ä¹Ÿå¯ä»¥è¿è¡Œ kubectl get elasticsearch å’Œ kubectl get kibana æŸ¥çœ‹æ›´å…·ä½“çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œå¦‚ Elasticsearch ç‰ˆæœ¬ã€èŠ‚ç‚¹å’Œå¥åº·çŠ¶æ€ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/92257f50180f432eabc41c87b2f36c74~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763422711&amp;x-signature=rncyEpl3jzKC84lkRGiZZbeaMbU%3D" alt="" loading="lazy"/></p>
<p>12ï¼‰è®¿é—®ä½ çš„æœåŠ¡</p>
<pre><code class="hljs language-arduino" lang="arduino">`kubectl get svc`AIå†™ä»£ç 
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a5981796bc247508ee659be3b75e6a9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763422711&amp;x-signature=sE%2FqXZrfgNyKjhvxgiiFQA15Tvc%3D" alt="" loading="lazy"/></p>
<p>è¿™ä¼šåœ¨ EXTERNAL-IP ä¸‹å‘ä½ æ˜¾ç¤º Kibana çš„å¤–éƒ¨ URLã€‚ LoadBalancer å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ¥é…ç½®ã€‚ <strong>å¤åˆ¶ EXTERNAL-IP çš„å€¼</strong>ã€‚</p>
<p>13ï¼‰è·å– elastic ç”¨æˆ·çš„ Elasticsearch å¯†ç ï¼š</p>
<pre><code class="hljs language-sql" lang="sql">`kubectl <span class="hljs-keyword">get</span> secret quickstart<span class="hljs-operator">-</span>es<span class="hljs-operator">-</span>elastic<span class="hljs-operator">-</span><span class="hljs-keyword">user</span> <span class="hljs-operator">-</span>o<span class="hljs-operator">=</span>jsonpath<span class="hljs-operator">=</span><span class="hljs-string">'{.data.elastic}'</span> <span class="hljs-operator">|</span> base64 <span class="hljs-comment">--decode`AIå†™ä»£ç </span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d212014dde6e4f709903fdfa7777c73a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763422711&amp;x-signature=q2sLvET%2BaxYlS8Pa3g9QwDMOTro%3D" alt="" loading="lazy"/></p>
<p>14ï¼‰é€šè¿‡æµè§ˆå™¨è®¿é—® Kibanaï¼š</p>
<ul>
<li>URL: https://&lt;EXTERNAL_IP&gt;:5601</li>
<li>ç”¨æˆ·å: elastic</li>
<li>å¯†ç : Arc133835D8507OIgKqkWBGxï¼ˆæ¥è‡ªä¸Šä¸€æ­¥ï¼‰</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/86e899fd2a0542148df345747e756059~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763422711&amp;x-signature=OazyzSCSIcVPSNgH6R%2Bri2yueGg%3D" alt="" loading="lazy"/></p>
<p>15ï¼‰å½“ä½ ä»æµè§ˆå™¨è®¿é—® Elastic æ—¶ï¼Œä½ ä¼šçœ‹åˆ°è¿™ä¸ªæ¬¢è¿ç•Œé¢ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f98ceb04f28440ad9aa0b2ff231ad8f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763422711&amp;x-signature=UIm1KPu1Vi6Opt18N2VxuDYgCws%3D" alt="" loading="lazy"/></p>
<p>å¦‚æœä½ æƒ³æ›´æ”¹ Elasticsearch é›†ç¾¤è§„æ ¼ï¼Œæ¯”å¦‚æ›´æ”¹æˆ–è°ƒæ•´èŠ‚ç‚¹å¤§å°ï¼Œä½ å¯ä»¥ä½¿ç”¨æ–°çš„è®¾ç½®å†æ¬¡åº”ç”¨ yml æ¸…å•ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">`</span>

<span class="hljs-number">1</span><span class="hljs-string">.</span>  <span class="hljs-string">cat</span> <span class="hljs-string">&lt;&lt;EOF</span> <span class="hljs-string">|</span> <span class="hljs-string">kubectl</span> <span class="hljs-string">apply</span> <span class="hljs-string">-f</span> <span class="hljs-bullet">-</span>
<span class="hljs-attr">2.  apiVersion:</span> <span class="hljs-string">elasticsearch.k8s.elastic.co/v1</span>
<span class="hljs-attr">3.  kind:</span> <span class="hljs-string">Elasticsearch</span>
<span class="hljs-attr">4.  metadata:</span>
<span class="hljs-attr">5.    name:</span> <span class="hljs-string">quickstart</span>
<span class="hljs-attr">6.  spec:</span>
<span class="hljs-attr">7.    version:</span> <span class="hljs-number">9.0</span><span class="hljs-number">.0</span>
<span class="hljs-attr">8.    nodeSets:</span>
<span class="hljs-attr">9.      - name:</span> <span class="hljs-string">default</span>
<span class="hljs-attr">10.        count:</span> <span class="hljs-number">2</span>
<span class="hljs-attr">11.        podTemplate:</span>
<span class="hljs-attr">12.          spec:</span>
<span class="hljs-attr">13.            containers:</span>
<span class="hljs-attr">14.              - name:</span> <span class="hljs-string">elasticsearch</span>
<span class="hljs-attr">15.                resources:</span>
<span class="hljs-attr">16.                  requests:</span>
<span class="hljs-attr">17.                    memory:</span> <span class="hljs-number">1.</span><span class="hljs-string">5Gi</span>
<span class="hljs-attr">18.                    cpu:</span> <span class="hljs-number">2</span>
<span class="hljs-attr">19.                  limits:</span>
<span class="hljs-attr">20.                    memory:</span> <span class="hljs-number">1.</span><span class="hljs-string">5Gi</span>
<span class="hljs-attr">21.                    cpu:</span> <span class="hljs-number">2</span>
<span class="hljs-attr">22.        volumeClaimTemplates:</span>
<span class="hljs-attr">23.          - metadata:</span>
<span class="hljs-attr">24.              name:</span> <span class="hljs-string">elasticsearch-data</span>
<span class="hljs-attr">25.            spec:</span>
<span class="hljs-attr">26.              accessModes:</span>
<span class="hljs-number">27</span><span class="hljs-string">.</span>                <span class="hljs-bullet">-</span> <span class="hljs-string">ReadWriteOnce</span>
<span class="hljs-attr">28.              resources:</span>
<span class="hljs-attr">29.                requests:</span>
<span class="hljs-attr">30.                  storage:</span> <span class="hljs-number">7.</span><span class="hljs-string">5Gi</span>
<span class="hljs-attr">31.              storageClassName:</span> <span class="hljs-string">auto-ebs-sc</span>
<span class="hljs-number">32</span><span class="hljs-string">.</span>  <span class="hljs-string">EOF</span>

<span class="hljs-string">`AIå†™ä»£ç ![](https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png)</span>
</code></pre>
<p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†å¢åŠ ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¢åŠ å†…å­˜ã€CPU å’Œç£ç›˜ã€‚</p>
<p>Kibana ä¹ŸåŒæ ·é€‚ç”¨ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">`</span>

<span class="hljs-number">1</span><span class="hljs-string">.</span>  <span class="hljs-string">cat</span> <span class="hljs-string">&lt;&lt;EOF</span> <span class="hljs-string">|</span> <span class="hljs-string">kubectl</span> <span class="hljs-string">apply</span> <span class="hljs-string">-f</span> <span class="hljs-bullet">-</span>
<span class="hljs-attr">2.  apiVersion:</span> <span class="hljs-string">kibana.k8s.elastic.co/v1</span>
<span class="hljs-attr">3.  kind:</span> <span class="hljs-string">Kibana</span>
<span class="hljs-attr">4.  metadata:</span>
<span class="hljs-attr">5.    name:</span> <span class="hljs-string">quickstart</span>
<span class="hljs-attr">6.  spec:</span>
<span class="hljs-attr">7.    version:</span> <span class="hljs-number">9.0</span><span class="hljs-number">.0</span>
<span class="hljs-attr">8.    http:</span>
<span class="hljs-attr">9.      service:</span>
<span class="hljs-attr">10.        metadata:</span>
<span class="hljs-attr">11.          annotations:</span>
<span class="hljs-attr">12.            service.beta.kubernetes.io/aws-load-balancer-scheme:</span> <span class="hljs-string">"internet-facing"</span>
<span class="hljs-attr">13.        spec:</span>
<span class="hljs-attr">14.          type:</span> <span class="hljs-string">LoadBalancer</span>
<span class="hljs-attr">15.    count:</span> <span class="hljs-number">1</span>
<span class="hljs-attr">16.    elasticsearchRef:</span>
<span class="hljs-attr">17.      name:</span> <span class="hljs-string">quickstart</span>
<span class="hljs-attr">18.    podTemplate:</span>
<span class="hljs-attr">19.      spec:</span>
<span class="hljs-attr">20.        containers:</span>
<span class="hljs-attr">21.          - name:</span> <span class="hljs-string">kibana</span>
<span class="hljs-attr">22.            env:</span>
<span class="hljs-attr">23.              - name:</span> <span class="hljs-string">NODE_OPTIONS</span>
<span class="hljs-attr">24.                value:</span> <span class="hljs-string">"--max-old-space-size=1024"</span>
<span class="hljs-attr">25.            resources:</span>
<span class="hljs-attr">26.              requests:</span>
<span class="hljs-attr">27.                memory:</span> <span class="hljs-number">0.</span><span class="hljs-string">5Gi</span>
<span class="hljs-attr">28.                cpu:</span> <span class="hljs-number">0.5</span>
<span class="hljs-attr">29.              limits:</span>
<span class="hljs-attr">30.                memory:</span> <span class="hljs-string">1Gi</span>
<span class="hljs-attr">31.                cpu:</span> <span class="hljs-number">1</span>
<span class="hljs-number">32</span><span class="hljs-string">.</span>  <span class="hljs-string">EOF</span>

<span class="hljs-string">`AIå†™ä»£ç ![](https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png)</span>
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥è°ƒæ•´å®¹å™¨çš„ CPU/å†…å­˜ï¼Œä¹Ÿå¯ä»¥è°ƒæ•´ <a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2F" title="https://nodejs.org/" target="_blank" ref="nofollow noopener noreferrer">Node.js</a> çš„å†…å­˜ä½¿ç”¨ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2Fapi%2Fcli.html%23--max-old-space-sizesize-in-mib" title="https://nodejs.org/api/cli.html#--max-old-space-sizesize-in-mib" target="_blank" ref="nofollow noopener noreferrer">max-old-space-size</a>ï¼‰ã€‚</p>
<p>è¯·è®°ä½ï¼Œ<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Fdeploy-manage%2Fdeploy%2Fcloud-on-k8s%2Fvolume-claim-templates" title="https://www.elastic.co/docs/deploy-manage/deploy/cloud-on-k8s/volume-claim-templates" target="_blank" ref="nofollow noopener noreferrer">å·²æœ‰çš„å·å£°æ˜æ— æ³•ç¼©å°</a>ã€‚åº”ç”¨æ›´æ–°åï¼Œè¿ç»´å·¥å…·ä¼šåœ¨æœ€å°ä¸­æ–­æ—¶é—´å†…å®Œæˆæ›´æ”¹ã€‚</p>
<p>æµ‹è¯•å®Œæˆåè®°å¾—åˆ é™¤é›†ç¾¤ï¼Œä»¥é¿å…ä¸å¿…è¦çš„è´¹ç”¨ã€‚</p>
<pre><code class="hljs language-css" lang="css">`eksctl delete cluster <span class="hljs-attr">--name</span> elastic-test <span class="hljs-attr">--region</span> us-east-<span class="hljs-number">1</span>`AIå†™ä»£ç 
</code></pre>
<h2 data-id="heading-2">ç»“è®º</h2>
<p>åœ¨æœ¬æŒ‡å—ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ ECK åœ¨ AWS EKS è‡ªåŠ¨æ¨¡å¼ä¸‹éƒ¨ç½²äº† Elasticsearch å’Œ Kibanaã€‚è‡ªåŠ¨æ¨¡å¼ä¸ºä½ ç®¡ç†é›†ç¾¤èµ„æºï¼Œè€Œ ECK ç®¡ç†æ‰©ç¼©å®¹å’Œç¼–æ’ã€‚ç»“æœæ˜¯ï¼Œæ¯”ä½¿ç”¨ AWS Marketplace éœ€è¦æ›´å¤šæ“ä½œï¼Œä½†æ¯”ç›´æ¥åœ¨è™šæ‹Ÿæœºä¸Šè¿è¡Œ Elasticsearch å°‘å¾—å¤šã€‚è¿™åœ¨æ§åˆ¶å’Œç®€åŒ–ä¹‹é—´å–å¾—äº†è‰¯å¥½å¹³è¡¡ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ„å»ºåŸºç¡€ã€‚</p>
<h2 data-id="heading-3">ä¸‹ä¸€æ­¥</h2>
<p>å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äº Kubernetes å’Œè‡ªåŠ¨æ¨¡å¼çš„å†…å®¹ï¼Œå¯ä»¥æŸ¥çœ‹è¿™äº›æ–‡ç« ï¼š</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Fdeploy-manage%2Fdeploy%2Fcloud-on-k8s" title="https://www.elastic.co/docs/deploy-manage/deploy/cloud-on-k8s" target="_blank" ref="nofollow noopener noreferrer">Elastic Cloud on Kubernetes | Elastic Docs</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Faws.amazon.com%2Feks%2F" title="https://aws.amazon.com/eks/" target="_blank" ref="nofollow noopener noreferrer">Amazon Elastic Kubernetes Service (EKS)</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.aws.amazon.com%2Feks%2Flatest%2Fuserguide%2Fautomode.html" title="https://docs.aws.amazon.com/eks/latest/userguide/automode.html" target="_blank" ref="nofollow noopener noreferrer">ä½¿ç”¨ EKS è‡ªåŠ¨æ¨¡å¼è‡ªåŠ¨åŒ–é›†ç¾¤åŸºç¡€è®¾æ–½ â€” Amazon EKS</a></li>
</ul>
<p>åŸæ–‡ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fsearch-labs%2Fblog%2Faws-eks-auto-mode-elasticsearch-deployment-guide" title="https://www.elastic.co/search-labs/blog/aws-eks-auto-mode-elasticsearch-deployment-guide" target="_blank" ref="nofollow noopener noreferrer">www.elastic.co/search-labsâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç”¨ LaraDumps é«˜æ•ˆè°ƒè¯• PHP å’Œ Laravel]]></title>    <link>https://juejin.cn/post/7570932873131982875</link>    <guid>https://juejin.cn/post/7570932873131982875</guid>    <pubDate>2025-11-11T00:01:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570932873131982875" data-draft-id="7571060853354414090" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç”¨ LaraDumps é«˜æ•ˆè°ƒè¯• PHP å’Œ Laravel"/> <meta itemprop="keywords" content="PHP,åç«¯"/> <meta itemprop="datePublished" content="2025-11-11T00:01:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="BingoGo"/> <meta itemprop="url" content="https://juejin.cn/user/993614242266077"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç”¨ LaraDumps é«˜æ•ˆè°ƒè¯• PHP å’Œ Laravel
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/993614242266077/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    BingoGo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T00:01:13.000Z" title="Tue Nov 11 2025 00:01:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ç”¨ LaraDumps é«˜æ•ˆè°ƒè¯• PHP å’Œ Laravel</h2>
<h3 data-id="heading-1">å¼•è¨€</h3>
<p>å¦‚æœä½ å¼€å‘ Laravel åº”ç”¨æœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œè‚¯å®šç”¨è¿‡æ— æ•°æ¬¡ <code>dd()</code>ã€<code>dump()</code> æˆ– <code>var_dump()</code>ã€‚å®ƒä»¬ç¡®å®èƒ½ç”¨ï¼Œä½†ä¹Ÿæœ‰ä»£ä»·ï¼š</p>
<ul>
<li>ä¼šä¸­æ–­åº”ç”¨æµç¨‹</li>
<li>åœ¨æµè§ˆå™¨é‡Œè¾“å‡ºå¾ˆä¹±</li>
<li>åˆ·æ–°é¡µé¢å°±æ²¡äº†</li>
<li>æ²¡æ³•ä¼˜é›…åœ°æŸ¥çœ‹å¤æ‚æ•°æ®</li>
</ul>
<p>å¦‚æœ PHP è°ƒè¯•èƒ½åƒç”¨ä¸“ä¸šå·¥å…·é‚£æ ·é¡ºæ‰‹ï¼Œè€Œä¸æ˜¯åœ¨æµè§ˆå™¨æ§åˆ¶å°é‡Œçæ‘¸ç´¢ï¼Œä¼šæ€æ ·ï¼Ÿ</p>
<p>è¿™å°±æ˜¯ LaraDumps â€”â€” ä¸€ä¸ªå…è´¹å¼€æºçš„æ¡Œé¢è°ƒè¯•åº”ç”¨ï¼Œèƒ½æŠŠä½ çš„ PHP å’Œ Laravel è°ƒè¯•ä½“éªŒæå‡ä¸€ä¸ªæ¡£æ¬¡ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcatchadmin.com%2Fpost%2F2025-11%2Flaradumps-debugging-guide" target="_blank" title="https://catchadmin.com/post/2025-11/laradumps-debugging-guide" ref="nofollow noopener noreferrer">åŸæ–‡ ç”¨ LaraDumps é«˜æ•ˆè°ƒè¯• PHP å’Œ Laravel</a></p>
<h3 data-id="heading-2">ä¸ºä»€ä¹ˆç”¨ LaraDumpsï¼Ÿ</h3>
<p>è·Ÿä¼ ç»Ÿè°ƒè¯•æ–¹æ³•ä¸åŒï¼ŒLaraDumps ä¸ä¼šæŠŠè°ƒè¯•ä¿¡æ¯æ‰“å°åˆ°æµè§ˆå™¨ã€‚å®ƒä¼šæŠŠæ‰€æœ‰ä¸œè¥¿å‘é€åˆ°ä¸€ä¸ªå¹²å‡€ã€æœ‰åºçš„å®æ—¶æ¡Œé¢ç•Œé¢ã€‚</p>
<p>ä¸»è¦ä¼˜åŠ¿ï¼š</p>
<ul>
<li>åº”ç”¨ä¸ä¼šä¸­æ–­ â€”â€” é¡µé¢æ­£å¸¸è·‘</li>
<li>æŒä¹…åŒ–å†å² â€”â€” åˆ·æ–°åæ•°æ®è¿˜åœ¨</li>
<li>å¤šæ¡è¾“å‡º â€”â€” åŒæ—¶æŸ¥çœ‹ä¸åŒä½ç½®çš„æ•°æ®</li>
<li>å®æ—¶ç›‘æ§ SQL å’Œæ—¥å¿—</li>
<li>ä¸é™äº Laravelï¼Œä»»ä½• PHP é¡¹ç›®éƒ½èƒ½ç”¨</li>
<li>å˜é‡ã€æ•°ç»„ã€å¯¹è±¡æ ¼å¼åŒ–å¾—å¾ˆæ¼‚äº®</li>
</ul>
<h3 data-id="heading-3">æ ¸å¿ƒåŠŸèƒ½</h3>
<h4 data-id="heading-4">æ— ä¸­æ–­å®æ—¶è°ƒè¯•</h4>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">index</span>(<span class="hljs-params"/>)
</span>{
    <span class="hljs-variable">$games</span> = <span class="hljs-title class_">Game</span>::<span class="hljs-title function_ invoke__">orderBy</span>(<span class="hljs-string">'match_date'</span>, <span class="hljs-string">'asc'</span>)-&gt;<span class="hljs-title function_ invoke__">get</span>();

    <span class="hljs-title function_ invoke__">ds</span>(<span class="hljs-variable">$games</span>);

    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">view</span>(<span class="hljs-string">'games.index'</span>, <span class="hljs-title function_ invoke__">compact</span>(<span class="hljs-string">'games'</span>));
}
</code></pre>
<p>ç”¨ <code>ds($games)</code> ä»£æ›¿ <code>dd($games)</code>ï¼Œç»“æœä¼šç›´æ¥å‡ºç°åœ¨ LaraDumps æ¡Œé¢åº”ç”¨é‡Œï¼Œä¸ä¼šä¸­æ–­è¯·æ±‚ï¼Œä¹Ÿä¸ä¼šåœ¨æµè§ˆå™¨é‡Œè¾“å‡ºä¹±ä¸ƒå…«ç³Ÿçš„ä¸œè¥¿ã€‚</p>
<h4 data-id="heading-5">æŒä¹…åŒ–å†å²</h4>
<p>åˆ·æ–°é¡µé¢å <code>dd()</code> çš„è¾“å‡ºå°±æ²¡äº†ï¼Œé‡åˆ°è¿‡å§ï¼Ÿ</p>
<p>LaraDumps è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚ä½ çš„è°ƒè¯•è¾“å‡ºä¼šä¸€ç›´ä¿ç•™ï¼Œå³ä½¿å¤šæ¬¡è¯·æ±‚åä¹Ÿèƒ½å›çœ‹ä¹‹å‰çš„æ•°æ®ã€‚</p>
<h4 data-id="heading-6">ç‹¬ç«‹æ¡Œé¢åº”ç”¨</h4>
<p>æ‰€æœ‰è°ƒè¯•ä¿¡æ¯éƒ½è¿›å…¥ä¸€ä¸ªç‹¬ç«‹çš„ã€ä¼˜é›…çš„åº”ç”¨ï¼Œå…·å¤‡ï¼š</p>
<ul>
<li>å¤šå±æ”¯æŒ</li>
<li>æ˜æš—ä¸»é¢˜ï¼ˆåŸºäº daisyUIï¼‰</li>
<li>å¯æœç´¢çš„è¡¨æ ¼è§†å›¾ï¼ˆç”¨äºæ•°ç»„å’Œå¯¹è±¡ï¼‰</li>
<li>æ ‡ç­¾é¡µåˆ†ç¦»ä¸åŒçš„è¾“å‡º</li>
</ul>
<h4 data-id="heading-7">Laravel ä¸“å±å·¥å…·</h4>
<p>LaraDumps ä¸é™æ¡†æ¶ï¼Œä½†ä¸º Laravel å¼€å‘è€…æä¾›äº†é¢å¤–åŠŸèƒ½ï¼š</p>
<p><strong>è·¯ç”±åˆ—è¡¨</strong></p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-title function_ invoke__">ds</span>()-&gt;<span class="hljs-title function_ invoke__">routes</span>();
</code></pre>
<p>è¿™ä¼šæŠŠæ•´ä¸ª Laravel è·¯ç”±åˆ—è¡¨è¾“å‡ºåˆ°åº”ç”¨é‡Œ â€”â€” åœ¨å¤§é¡¹ç›®ä¸­è¶…çº§æœ‰ç”¨ã€‚</p>
<p><strong>æ¨¡å‹æ£€æŸ¥å™¨</strong></p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Models</span>\<span class="hljs-title">Game</span>;

<span class="hljs-variable">$game</span> = <span class="hljs-title class_">Game</span>::<span class="hljs-title function_ invoke__">first</span>();

<span class="hljs-title function_ invoke__">ds</span>()-&gt;<span class="hljs-title function_ invoke__">model</span>(<span class="hljs-variable">$game</span>);
</code></pre>
<p>è¿™ä¼šç»™ä½ ä¸€ä¸ªç»“æ„åŒ–çš„è§†å›¾ï¼Œå±•ç¤ºæ¨¡å‹å±æ€§ã€å…³è”ã€ç±»å‹è½¬æ¢ç­‰ã€‚æ¯”æ‰‹åŠ¨æ‰“å°æ•°ç»„å¼ºå¤ªå¤šã€‚</p>
<p><strong>Blade æŒ‡ä»¤</strong></p>
<p>æœ‰æ—¶ä½ åªæ˜¯æƒ³åœ¨ Blade è§†å›¾é‡Œåšä¸ªæ ‡è®°ï¼š</p>
<pre><code class="hljs language-blade" lang="blade">@ds('Rendering Games Table Blade')
</code></pre>
<p>åœ¨è°ƒè¯•å¤æ‚ UI æµç¨‹æ—¶ç‰¹åˆ«æœ‰ç”¨ã€‚</p>
<h4 data-id="heading-8">5. æŸ¥è¯¢å’Œæ—¥å¿—ç›‘æ§</h4>
<p>LaraDumps å¯ä»¥è‡ªåŠ¨è¿½è¸ªæ•°æ®åº“æŸ¥è¯¢å¹¶æ•è· Laravel æ—¥å¿— â€”â€” æ— éœ€é…ç½®ã€‚</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$games</span> = <span class="hljs-title class_">Game</span>::<span class="hljs-title function_ invoke__">query</span>()
    -&gt;<span class="hljs-title function_ invoke__">where</span>(<span class="hljs-string">'is_active'</span>, <span class="hljs-literal">true</span>)
    -&gt;<span class="hljs-title function_ invoke__">ds</span>() <span class="hljs-comment">// åœ¨ get() å‰é“¾å¼è°ƒç”¨</span>
    -&gt;<span class="hljs-title function_ invoke__">get</span>();
</code></pre>
<p>è¿™ä¼šæŠŠæŸ¥è¯¢å’Œç»“æœè®°å½•åˆ°æ¡Œé¢åº”ç”¨ã€‚</p>
<p>å¦‚æœä½ ç”¨ Log facadeï¼š</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-title class_">\Log</span>::<span class="hljs-title function_ invoke__">info</span>(<span class="hljs-string">'This will appear in LaraDumps too!'</span>);
</code></pre>
<h4 data-id="heading-9">6. Xdebug é›†æˆ</h4>
<p>å¦‚æœä½ å–œæ¬¢å•æ­¥è°ƒè¯•ï¼ŒLaraDumps é›†æˆäº† Xdebugã€‚ä½ å¯ä»¥è®¾æ–­ç‚¹ã€å•æ­¥æ‰§è¡Œï¼ŒåŒæ—¶è¿˜èƒ½ç”¨å®ƒæ¼‚äº®çš„å˜é‡æ£€æŸ¥å™¨ã€‚</p>
<h3 data-id="heading-10">å®é™…è°ƒè¯•æ¡ˆä¾‹</h3>
<p>çœ‹å‡ ä¸ªå®é™…åœºæ™¯ï¼Œå±•ç¤º LaraDumps å¦‚ä½•è®©ä½ çš„ç”Ÿæ´»æ›´è½»æ¾ã€‚</p>
<h4 data-id="heading-11">è°ƒè¯•æ”¯ä»˜æµç¨‹</h4>
<p>å‡è®¾ä½ åœ¨åšå¤šæ­¥éª¤ç»“è´¦æµç¨‹ã€‚åœ¨æ§åˆ¶å™¨é‡Œç”¨ <code>dd()</code> ä¼šä¸­æ–­é‡å®šå‘æµç¨‹ã€‚ç”¨ LaraDumpsï¼š</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkout</span>(<span class="hljs-params">Request <span class="hljs-variable">$request</span></span>)
</span>{
    <span class="hljs-title function_ invoke__">ds</span>(<span class="hljs-string">'Checkout started'</span>, <span class="hljs-variable">$request</span>-&gt;<span class="hljs-title function_ invoke__">all</span>());

    <span class="hljs-variable">$payment</span> = <span class="hljs-variable language_">$this</span>-&gt;paymentService-&gt;<span class="hljs-title function_ invoke__">create</span>(<span class="hljs-variable">$request</span>-&gt;<span class="hljs-title function_ invoke__">user</span>(), <span class="hljs-variable">$request</span>-&gt;amount);

    <span class="hljs-title function_ invoke__">ds</span>(<span class="hljs-variable">$payment</span>)-&gt;<span class="hljs-title function_ invoke__">label</span>(<span class="hljs-string">'Payment Created'</span>);

    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">redirect</span>()-&gt;<span class="hljs-title function_ invoke__">route</span>(<span class="hljs-string">'payment.redirect'</span>, [<span class="hljs-string">'id'</span> =&gt; <span class="hljs-variable">$payment</span>-&gt;id]);
}
</code></pre>
<p>ä½ å¯ä»¥è¿½è¸ªæ•´ä¸ªæµç¨‹è€Œä¸ä¸­æ–­æ‰§è¡Œï¼Œåœ¨å¤šä¸ªä½ç½®æŸ¥çœ‹æ•°æ®ã€‚</p>
<h4 data-id="heading-12">è°ƒè¯•åå°ä»»åŠ¡</h4>
<pre><code class="hljs language-php" lang="php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SendWelcomeEmail</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ShouldQueue</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handle</span>(<span class="hljs-params"/>)
    </span>{
        <span class="hljs-title function_ invoke__">ds</span>(<span class="hljs-string">'Job started'</span>);

        <span class="hljs-comment">// ...å‘é€é‚®ä»¶é€»è¾‘</span>

        <span class="hljs-title function_ invoke__">ds</span>(<span class="hljs-string">'Job finished'</span>);
    }
}
</code></pre>
<p>LaraDumps çš„ä»»åŠ¡ç›‘æ§å™¨ä¼šå®æ—¶æ˜¾ç¤ºä»»åŠ¡æ‰§è¡Œä¿¡æ¯ â€”â€” å¯¹é˜Ÿåˆ—å¯†é›†å‹åº”ç”¨ç‰¹åˆ«åˆé€‚ã€‚</p>
<h4 data-id="heading-13">JSON éªŒè¯å’Œå­—ç¬¦ä¸²æœç´¢</h4>
<p>æ¡Œé¢åº”ç”¨é‡Œæœ‰ä¸ª JSON éªŒè¯å·¥å…·ï¼Œå¯ä»¥éªŒè¯å’Œç¾åŒ– JSON å­—ç¬¦ä¸²ã€‚è¿˜æœ‰å†…ç½®çš„å­—ç¬¦ä¸²æœç´¢åŠŸèƒ½ï¼Œèƒ½å¿«é€Ÿåœ¨å¤§é‡è¾“å‡ºä¸­æ‰¾åˆ°å€¼ã€‚</p>
<h3 data-id="heading-14">å®‰è£…</h3>
<p>è®¾ç½® LaraDumps å¾ˆç®€å•ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">composer require laradumps/laradumps --dev
</code></pre>
<p>ç„¶åä»å®˜æ–¹æ–‡æ¡£ä¸‹è½½å¹¶è¿è¡Œé€‚åˆä½ æ“ä½œç³»ç»Ÿçš„æ¡Œé¢åº”ç”¨ã€‚</p>
<p>å°±è¿™æ · â€”â€” ä½ å¯ä»¥å¼€å§‹ç”¨ <code>ds()</code> è¿›è¡Œå¹²å‡€çš„è°ƒè¯•äº†ã€‚</p>
<h3 data-id="heading-15">æ€»ç»“</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Flaradumps.dev%2F" target="_blank" title="https://laradumps.dev/" ref="nofollow noopener noreferrer">LaraDumps</a> æ˜¯é‚£ç§ä¸€æ—¦ç”¨ä¸Šå°±å›ä¸å»çš„å·¥å…·ã€‚å®ƒè®© PHP è°ƒè¯•æ›´ç°ä»£åŒ–ã€æ›´å¹²å‡€ã€æ›´å¿«é€Ÿã€ä¹Ÿæ›´æ„‰å¿«ã€‚</p>
<p>æ— è®ºä½ æ˜¯åœ¨åšå°å‹ Laravel åº”ç”¨è¿˜æ˜¯å¤§å‹ä¼ä¸šç³»ç»Ÿï¼ŒæŠŠ LaraDumps åŠ å…¥å·¥å…·ç®±éƒ½èƒ½èŠ‚çœä½ å¥½å‡ ä¸ªå°æ—¶çš„æŠ“ç‹‚æ—¶é—´ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¤§æ•°æ®-149 Apache Druid å®æ—¶ OLAP æ¶æ„ä¸é€‰å‹è¦ç‚¹]]></title>    <link>https://juejin.cn/post/7571005077801664522</link>    <guid>https://juejin.cn/post/7571005077801664522</guid>    <pubDate>2025-11-11T01:55:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571005077801664522" data-draft-id="7571005077801615370" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¤§æ•°æ®-149 Apache Druid å®æ—¶ OLAP æ¶æ„ä¸é€‰å‹è¦ç‚¹"/> <meta itemprop="keywords" content="åç«¯,å¤§æ•°æ®,NoSQL"/> <meta itemprop="datePublished" content="2025-11-11T01:55:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ­¦å­åº·"/> <meta itemprop="url" content="https://juejin.cn/user/149189314230039"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¤§æ•°æ®-149 Apache Druid å®æ—¶ OLAP æ¶æ„ä¸é€‰å‹è¦ç‚¹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/149189314230039/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ­¦å­åº·
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T01:55:41.000Z" title="Tue Nov 11 2025 01:55:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">TL;DR</h2>
<ul>
<li>åœºæ™¯ï¼šç¦»çº¿+å®æ—¶çš„çœ‹æ¿/ç›‘æ§/è¿è¥åˆ†æï¼Œéœ€è¦é«˜å¹¶å‘ã€äºšç§’çº§èšåˆ</li>
<li>ç»“è®ºï¼šå½“â€œæ—¶é—´åˆ†åŒº+é¢„èšåˆ+æµæ‰¹ä¸€ä½“â€æ˜¯å¼ºéœ€æ±‚æ—¶ï¼ŒDruidæ›´çœå¿ƒï¼›çµæ´»åº¦ä½äº ClickHouse/ESï¼Œéœ€æŒ‰ä¸šåŠ¡å»ºæ¨¡å–èˆ</li>
<li>äº§å‡ºï¼šæ‘˜è¦ã€ç‰ˆæœ¬çŸ©é˜µä¸å¸¸è§æ•…éšœé€ŸæŸ¥&amp;ä¿®å¤ SOP</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/638b20f6f3134fea885f4950152db4ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763430941&amp;x-signature=VLbvvN9IyMIT%2B48p23xhCVqf1UY%3D" alt="å¤§æ•°æ®-149 Apache Druid å®æ—¶ OLAP æ¶æ„ä¸é€‰å‹è¦ç‚¹" loading="lazy"/></p>
<h2 data-id="heading-1">ç‰ˆæœ¬çŸ©é˜µ</h2>

























<table><thead><tr><th>ç‰ˆæœ¬</th><th>å‘å¸ƒæ—¥æœŸ</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>34.0.0</td><td>2025-08-11</td><td>æ–‡æ¡£éªŒè¯æœ€æ–°ç¨³å®šç‰ˆï¼›æŒ‰éœ€å‡çº§å¹¶è¯„ä¼°å‘é‡åŒ–ä¸å¹¶å‘å‚æ•°ã€‚</td></tr><tr><td>33.0.0</td><td>2025-04-29</td><td>æ–‡æ¡£éªŒè¯ä¸Šä¸€ä¸»ç‰ˆæœ¬ï¼Œå®˜æ–¹ä»æä¾›å‘å¸ƒä¿¡æ¯å¯å‚è€ƒã€‚</td></tr><tr><td>32.0.1</td><td>2025-03-19</td><td>æ–‡æ¡£éªŒè¯ç»´æŠ¤ç‰ˆï¼›è‡ª 32.0 èµ· Java 11 æ ‡è®°å¼ƒç”¨ï¼Œéœ€è§„åˆ’ JDK å‡çº§ã€‚</td></tr></tbody></table>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7fbbb63731fa41ee9d46ab910878c21f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763430941&amp;x-signature=QJELMxCRWy3BYfJ9KCSNvzRFGFE%3D" alt="Apache Druid" loading="lazy"/></p>
<h2 data-id="heading-2">Druid ä»‹ç»</h2>
<p>æ•°æ®åˆ†æçš„åŸºç¡€æ¶æ„å¯ä»¥æ ¹æ®ä¸åŒçš„ä¸šåŠ¡éœ€æ±‚å’ŒæŠ€æœ¯ç‰¹ç‚¹åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼Œæ¯ç§æ¶æ„éƒ½æœ‰å…¶ç‰¹å®šçš„åº”ç”¨åœºæ™¯å’Œä¼˜åŠ¿ï¼š</p>
<ol>
<li>
<p><strong>åŸºäºHadoop/Sparkçš„æ‰¹å¤„ç†åˆ†æ</strong></p>
<ul>
<li>å…¸å‹æ¡ˆä¾‹ï¼šä½¿ç”¨Hadoopçš„MapReduceæˆ–Spark Coreè¿›è¡Œå¤§è§„æ¨¡æ•°æ®é›†çš„å¤„ç†</li>
<li>åº”ç”¨åœºæ™¯ï¼šé€‚ç”¨äºå¯¹å†å²æ•°æ®è¿›è¡Œç¦»çº¿åˆ†æã€æ•°æ®æŒ–æ˜ç­‰åœºæ™¯</li>
<li>æŠ€æœ¯ç»†èŠ‚ï¼šHadoopé€‚åˆå¤„ç†TBçº§ä»¥ä¸Šçš„æ•°æ®ï¼ŒSparkåˆ™åœ¨å†…å­˜è®¡ç®—æ–¹é¢è¡¨ç°æ›´ä¼˜</li>
</ul>
</li>
<li>
<p><strong>æ··åˆæ¶æ„ï¼ˆHadoop/Spark + RDBMSï¼‰</strong></p>
<ul>
<li>å®ç°æ–¹å¼ï¼šå…ˆä½¿ç”¨Hadoop/Sparkè¿›è¡Œé¢„å¤„ç†ï¼Œå°†èšåˆåçš„ç»“æœå¯¼å…¥MySQL/Oracleç­‰å…³ç³»å‹æ•°æ®åº“</li>
<li>ä¼˜åŠ¿ï¼šç»“åˆäº†åˆ†å¸ƒå¼è®¡ç®—çš„é«˜æ•ˆæ€§å’ŒRDBMSçš„æŸ¥è¯¢ä¾¿æ·æ€§</li>
<li>å…¸å‹åº”ç”¨ï¼šæ•°æ®ä»“åº“ã€BIæŠ¥è¡¨ç³»ç»Ÿ</li>
</ul>
</li>
<li>
<p><strong>NoSQLå­˜å‚¨æ¶æ„</strong></p>
<ul>
<li>è§£å†³æ–¹æ¡ˆï¼šå°†å¤„ç†ç»“æœä¿å­˜åˆ°HBaseã€MongoDBç­‰NoSQLæ•°æ®åº“</li>
<li>ä¼˜åŠ¿ï¼šè§£å†³äº†ä¼ ç»Ÿæ•°æ®åº“çš„å­˜å‚¨å®¹é‡é™åˆ¶ï¼Œæ”¯æŒæµ·é‡æ•°æ®å­˜å‚¨</li>
<li>åœºæ™¯ç¤ºä¾‹ï¼šç”¨æˆ·è¡Œä¸ºæ—¥å¿—åˆ†æã€ç‰©è”ç½‘è®¾å¤‡æ•°æ®å­˜å‚¨</li>
<li>ç‰¹åˆ«è¯´æ˜ï¼šHBaseç‰¹åˆ«é€‚åˆéœ€è¦éšæœºå®æ—¶è¯»å†™è®¿é—®è¶…å¤§è§„æ¨¡æ•°æ®é›†çš„åœºæ™¯</li>
</ul>
</li>
<li>
<p><strong>æµå¼å¤„ç†æ¶æ„</strong></p>
<ul>
<li>æŠ€æœ¯é€‰å‹ï¼šä½¿ç”¨Storm/Spark Streaming/Flinkå¤„ç†å®æ—¶æ•°æ®æµ</li>
<li>å­˜å‚¨é€‰æ‹©ï¼šå¤„ç†ç»“æœå¯ä¿å­˜åˆ°RDBMSæˆ–NoSQL</li>
<li>å…¸å‹åº”ç”¨ï¼šå®æ—¶ç›‘æ§ç³»ç»Ÿã€é‡‘èäº¤æ˜“åˆ†æ</li>
<li>æ€§èƒ½å¯¹æ¯”ï¼šFlinkåœ¨ä½å»¶è¿Ÿæ–¹é¢è¡¨ç°çªå‡ºï¼ŒSpark Streamingæ›´é€‚åˆå¾®æ‰¹å¤„ç†åœºæ™¯</li>
</ul>
</li>
<li>
<p><strong>å®æ—¶åˆ†ææ•°æ®åº“æ¶æ„</strong></p>
<ul>
<li>ä»£è¡¨äº§å“ï¼šä½¿ç”¨Druidç­‰OLAPåˆ†æå‹æ•°æ®åº“</li>
<li>æ ¸å¿ƒä¼˜åŠ¿ï¼šæ”¯æŒäºšç§’çº§æŸ¥è¯¢å“åº”ï¼Œé€‚åˆå®æ—¶åˆ†æåœºæ™¯</li>
<li>åº”ç”¨ç¤ºä¾‹ï¼šå¹¿å‘Šæ•ˆæœå®æ—¶åˆ†æã€è¿è¥æŒ‡æ ‡ç›‘æ§çœ‹æ¿</li>
<li>æ¶æ„ç‰¹ç‚¹ï¼šé€šå¸¸é‡‡ç”¨åˆ—å¼å­˜å‚¨ï¼Œæ”¯æŒé«˜æ€§èƒ½èšåˆæŸ¥è¯¢</li>
</ul>
</li>
</ol>
<p>æ¯ç§æ¶æ„çš„é€‰æ‹©éœ€è¦è€ƒè™‘æ•°æ®è§„æ¨¡ã€å®æ—¶æ€§è¦æ±‚ã€æŸ¥è¯¢å¤æ‚åº¦ä»¥åŠå›¢é˜ŸæŠ€æœ¯æ ˆç­‰å› ç´ ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™äº›æ¶æ„å¾€å¾€ä¼šç»„åˆä½¿ç”¨ï¼Œå½¢æˆå®Œæ•´çš„æ•°æ®åˆ†æè§£å†³æ–¹æ¡ˆã€‚ä¾‹å¦‚ï¼šæµå¤„ç†æ¶æ„å¯èƒ½åŒæ—¶å¯¹æ¥å®æ—¶åˆ†ææ•°æ®åº“å’Œç¦»çº¿æ•°æ®ä»“åº“ï¼Œå½¢æˆLambdaæ¶æ„ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4775524ecfe24ac1b9bf0def31307f2e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763430941&amp;x-signature=z6syE4fWC7gWSZM00hAXzFfpiyw%3D" alt="å¤§æ•°æ®æ•´ä½“çš„äº‹ä»¶æµ" loading="lazy"/></p>
<ul>
<li>äº’è”ç½‘æŠ€æœ¯çš„å¿«é€Ÿå¢é•¿å‚¬ç”Ÿå‡ºäº†å„ç±»å¤§ä½“é‡çš„æ•°æ®ï¼ŒHadoopå¾ˆå¤§çš„è´¡çŒ®åœ¨äºå¸®åŠ©ä¼ä¸šå°†ä»–ä»¬é‚£äº›ä½ä»·å€¼çš„äº‹ä»¶æµæ•°æ®è½¬æ¢ä¸ºé«˜ä»·å€¼çš„èšåˆæ•°æ®ã€‚</li>
<li>Hadoopæ“…é•¿çš„æ˜¯å­˜å‚¨å’Œè·å–å¤§è§„æ¨¡æ•°æ®ï¼Œå®ƒå¹¶ä¸æä¾›ä»»ä½•æ€§èƒ½ä¸Šçš„ä¿è¯å®ƒä»¬èƒ½å¤Ÿå¾ˆå¿«çš„å–åˆ°æ•°æ®ï¼Œè™½ç„¶Hadoopæ˜¯é«˜å¯ç”¨çš„ç³»ç»Ÿï¼Œä½†åœ¨é«˜å¹¶å‘ä¸‹è´Ÿè½½ä¸‹æ€§èƒ½ä¼šä¸‹é™ã€‚</li>
<li>Hadoopæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„åç«¯ã€æ‰¹é‡å¤„ç†å’Œæ•°æ®ä»“åº“ç³»ç»Ÿï¼Œåœ¨ä¸€ä¸ªéœ€è¦é«˜å¹¶å‘çš„å¹¶ä¸”ä¿è¯æŸ¥è¯¢æ€§èƒ½å’Œæ•°æ®å¯ç”¨æ€§ï¼Œå¹¶éœ€è¦æä¾›äº§å“çº§çš„ä¿è¯çš„éœ€æ±‚ï¼ŒHadoopå¹¶ä¸èƒ½å¤Ÿæ»¡è¶³ã€‚</li>
<li>Druidæ˜¯Metamarketsï¼ˆä¸€å®¶ä¸ºåœ¨çº¿åª’ä½“æˆ–å¹¿å‘Šå…¬å¸æä¾›æ•°æ®åˆ†ææœåŠ¡çš„å…¬å¸ï¼‰é€€å‡ºçš„ä¸€ä¸ªåˆ†å¸ƒå¼å†…å­˜å®æ—¶åˆ†æç³»ç»Ÿï¼Œç”¨äºè§£å†³å¦‚ä½•åœ¨å¤§è§„æ¨¡æ•°æ®é›†ä¸‹è¿›è¡Œå¿«é€Ÿçš„ã€äº¤äº’å¼çš„æŸ¥è¯¢å’Œåˆ†æã€‚</li>
<li>Druidæ˜¯ä¸€ä¸ªå¼€æºçš„æ•°æ®åˆ†æå¼•æ“å·¥å…·ï¼Œä¸ºå®æ—¶å’Œå†å²æ•°æ®çš„æ¬¡ç§’çº§ï¼ˆå¤šäºä¸€ç§’ï¼‰æŸ¥è¯¢è®¾è®¡ï¼Œä¸»è¦åº”ç”¨äºå¯¹æ•°æ®çš„OLAPæŸ¥è¯¢ï¼ŒDruidæä¾›ä½å»¶è¿Ÿï¼ˆå®æ—¶ï¼‰çš„æ•°æ®æ‘„å–ã€çµæ´»çš„æ•°æ®æ¢ç´¢ã€å¿«é€Ÿçš„æ•°æ®èšåˆã€‚ç°åœ¨çš„Druidéƒ¨ç½²å·²æ”¯æŒæ‰©å±•åˆ°æ•°ä¸‡äº¿æ—¶é—´å’ŒPBçº§æ•°æ®ã€‚</li>
</ul>
<h3 data-id="heading-3">æ•°æ®æ‘„å–å±‚ (Ingestion Layer)</h3>
<ul>
<li>ä»»åŠ¡ç®¡ç†å™¨ (Supervisor)ï¼šè´Ÿè´£ç®¡ç†æ•°æ®æ‘„å–ä»»åŠ¡ã€‚</li>
<li>æ•°æ®æº (Data Sources)ï¼šæ˜¯ Druid ä¸­çš„åŸºæœ¬æ¦‚å¿µï¼Œç”¨äºè¡¨ç¤ºä¸€ç»„æ•°æ®ã€‚</li>
</ul>
<h3 data-id="heading-4">å­˜å‚¨å±‚ (Storage Layer)</h3>
<ul>
<li>Druid ä½¿ç”¨åˆ—å¼å­˜å‚¨æ¥ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½ã€‚æ•°æ®æŒ‰åˆ—å­˜å‚¨ï¼Œä»¥æé«˜èšåˆå’Œè¿‡æ»¤çš„æ•ˆç‡ã€‚</li>
<li>Segmentsï¼šæ•°æ®åœ¨ Druid ä¸­è¢«åˆ’åˆ†ä¸ºç§°ä¸º segments çš„å—ï¼Œæ¯ä¸ª segment é€šå¸¸åŒ…å«ä¸€ä¸ªæ—¶é—´èŒƒå›´å†…çš„æ•°æ®ã€‚</li>
</ul>
<h3 data-id="heading-5">æŸ¥è¯¢å±‚ (Query Layer)</h3>
<ul>
<li>Druid æ”¯æŒå¤šç§æŸ¥è¯¢ç±»å‹ï¼ŒåŒ…æ‹¬å®æ—¶æŸ¥è¯¢ã€æ‰¹é‡æŸ¥è¯¢å’Œå¤æ‚çš„èšåˆæŸ¥è¯¢ã€‚</li>
<li>æŸ¥è¯¢åè°ƒå™¨ (Query Coordinator)ï¼šè´Ÿè´£ç®¡ç†æŸ¥è¯¢è¯·æ±‚å’Œå°†è¯·æ±‚åˆ†å‘åˆ°ä¸åŒçš„èŠ‚ç‚¹ã€‚</li>
</ul>
<h3 data-id="heading-6">ç´¢å¼•å±‚ (Indexing Layer)</h3>
<ul>
<li>Druid é‡‡ç”¨ä¸€ç§åŸºäºæ—¶é—´çš„ç´¢å¼•ç­–ç•¥ï¼Œæ”¯æŒå®æ—¶å’Œå†å²æ•°æ®çš„å¿«é€ŸæŸ¥è¯¢ã€‚</li>
<li>æ”¯æŒå¤šç§ç´¢å¼•ç±»å‹ï¼ŒåŒ…æ‹¬åŸºæœ¬ç´¢å¼•ã€ç»´åº¦ç´¢å¼•å’Œæ—¶é—´ç´¢å¼•ã€‚</li>
</ul>
<h3 data-id="heading-7">æœåŠ¡å±‚ (Service Layer)</h3>
<ul>
<li>Druid çš„æ¶æ„ä¸­åŒ…æ‹¬å¤šä¸ªæœåŠ¡ï¼Œå¦‚ Brokerã€Historicalã€Middle Manager ç­‰ï¼Œè´Ÿè´£æ•°æ®çš„æŸ¥è¯¢å’Œæ‘„å–ã€‚</li>
<li>Brokerï¼šæ¥å—æŸ¥è¯¢è¯·æ±‚ï¼Œå¹¶å°†å…¶è·¯ç”±åˆ°åˆé€‚çš„ Historical æˆ–å®æ—¶èŠ‚ç‚¹ã€‚</li>
<li>Historicalï¼šå­˜å‚¨å†å²æ•°æ®å¹¶å¤„ç†æŸ¥è¯¢ã€‚</li>
<li>Middle Managerï¼šè´Ÿè´£æ‘„å–å’Œå¤„ç†å®æ—¶æ•°æ®æµã€‚</li>
</ul>
<h2 data-id="heading-8">ä¸OLAPå¯¹æ¯”</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/303c44aa93b441208b0747c608a1b0f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763430941&amp;x-signature=80OEoZi14ruxjte3DMjdhf8LA0o%3D" alt="å„ç§æ•°æ®åº“ OLAP çš„å¯¹æ¯”" loading="lazy"/>
SparkSQL / Impala / ClickHouseï¼Œæ”¯æŒæµ·é‡æ•°æ®ï¼Œçµæ´»æ€§å¼ºï¼Œä½†å¯¹å“åº”æ—¶é—´æ²¡æœ‰ä¿è¯ï¼Œå½“æ•°æ®é‡å’Œè®¡ç®—å¤æ‚åº¦å¢åŠ åï¼Œå“åº”æ—¶é—´ä¼šå˜æ…¢ï¼Œä»ç§’çº§åˆ°åˆ†é’Ÿçº§ï¼Œç”šè‡³å°æ—¶çº§éƒ½æœ‰å¯èƒ½ã€‚
æœç´¢å¼•æ“æ¶æ„çš„ç³»ç»Ÿï¼ˆElasticsearchç­‰ï¼‰ï¼Œåœ¨å…¥åº“çš„æ—¶å€™å°†æ•°æ®è½¬æ¢ä¸ºå€’æ’ç´¢å¼•ï¼Œç‰ºç‰²äº†çµæ´»æ€§æ¢äº†å¾ˆå¥½æ€§èƒ½ï¼Œåœ¨æœç´¢çš„æŸ¥è¯¢ä¸Šåšåˆ°äº†äºšç§’çº§åˆ«çš„å“åº”ï¼Œä½†æ˜¯å¯¹äºæ‰«æèšåˆä¸ºä¸»çš„æŸ¥è¯¢ï¼Œéšç€å¤„ç†æ•°æ®é‡çš„å¢åŠ ï¼Œå“åº”æ—¶é—´ä¹Ÿä¼šé€€åŒ–åˆ°åˆ†é’Ÿçº§åˆ«ã€‚
Druid/Kylinï¼Œåœ¨å…¥åº“çš„æ—¶å€™å¯¹æ•°æ®è¿›è¡Œé¢„èšåˆï¼Œè¿›ä¸€æ­¥ç‰ºç‰²çµæ´»æ€§æ¥æ¢å–æ€§èƒ½ï¼Œå®ç°å¯¹è¶…å¤§æ•°æ®é›†çš„ç§’çº§å“åº”ã€‚</p>
<ul>
<li>Kylinåˆ©ç”¨Hadoop HBaseåšè®¡ç®—å’Œå­˜å‚¨ï¼Œä½¿ç”¨SQLæŸ¥è¯¢ï¼Œæä¾›JDBCã€ODBCé©±åŠ¨ä¸å¸¸è§çš„BIå·¥å…·çš„é›†æˆ</li>
<li>Druidæœ‰è‡ªå·±ç‹¬ç«‹çš„åˆ†å¸ƒå¼é›†ç¾¤ï¼Œèƒ½å¤Ÿå®æ—¶æ‘„å…¥æ•°æ®ï¼Œæœ‰è‡ªå·±çš„æŸ¥è¯¢æ¥å£ï¼ˆä¸BIå…¼å®¹æ€§è¾ƒå¼±ï¼‰ï¼Œé€šå¸¸ç”¨äºå®æ—¶è¦æ±‚é«˜çš„åœºæ™¯
ç›®å‰æ²¡æœ‰ä¸€ä¸ªOLAPåˆ†æå¼•æ“èƒ½åœ¨æ•°æ®é‡ã€çµæ´»ç¨‹åº¦ã€æ€§èƒ½ã€ååã€å¹¶å‘åšåˆ°å®Œç¾ï¼Œéœ€è¦åŸºäºè‡ªå·±çš„ä¸šåŠ¡åœºæ™¯è¿›è¡Œé€‰æ‹©ã€‚</li>
</ul>
<h2 data-id="heading-9">æŠ€æœ¯ç‰¹ç‚¹</h2>
<h3 data-id="heading-10">åŸºæœ¬ä»‹ç»</h3>
<p>Apache Druid æ˜¯ä¸€ä¸ªå¼€æºçš„ã€åˆ†å¸ƒå¼ã€å®æ—¶OLAPåˆ†æå·¥å…·ï¼ŒDruidçš„æ ¸å¿ƒç»“åˆäº†æ•°æ®ä»“åº“ã€æ—¶é—´åºåˆ—æ•°æ®åº“å’Œæœç´¢ç³»ç»Ÿçš„æ€æƒ³ï¼Œé€‚ç”¨äºå¤šç§åœºæ™¯çš„é«˜æ€§èƒ½æ•°æ®å®æ—¶åˆ†æã€‚Druidå°†è¿™ä¸‰ä¸ªç³»ç»Ÿä¸­çš„æ¯ä¸ªç³»ç»Ÿçš„å…³é”®ç‰¹å¾åˆå¹¶åˆ°å…¶æ¥æ”¶å±‚ã€å­˜å‚¨æ ¼å¼ã€æŸ¥è¯¢å±‚å’Œæ ¸å¿ƒä½“ç³»ç»“æ„ä¸­ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a80bb5f912d3413f9e422fb7fd934ea6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763430941&amp;x-signature=Z2PjtI4xFeIrncu5f4WIkRmsWls%3D" alt="Apache Druid æŠ€æœ¯èƒŒæ™¯" loading="lazy"/>
æ—¶é—´åºåˆ—æ•°æ®åº“ä¸»è¦ç”¨äºå¤„ç†ã€å¸¦æ—¶é—´æ ‡ç­¾ï¼ˆæŒ‰ç…§æ—¶é—´çš„é¡ºåºå˜åŒ–ï¼‰çš„æ•°æ®ï¼Œå¸¦æ—¶é—´æ ‡ç­¾çš„æ•°æ®ä¹Ÿç§°ä¸ºæ—¶é—´åºåˆ—æ•°æ®ã€‚</p>
<p>æ—¶é—´åºåˆ—æ•°æ®åº“ä¸»è¦ç”¨äºç”µåŠ›è¡Œä¸šã€åŒ–å·¥è¡Œä¸šç­‰å„ç±»å®æ—¶ç›‘æµ‹ã€æ£€æŸ¥ã€åˆ†æè®¾å¤‡æ‰€é‡‡é›†ã€äº§ç”Ÿçš„æ•°æ®ï¼Œè¿™äº›å·¥ä¸šæ•°æ®çš„å…¸å‹ç‰¹ç‚¹æ˜¯ï¼š</p>
<ul>
<li>äº§ç”Ÿé¢‘ç‡å¿«ï¼ˆæ¯ä¸€ä¸ªç›‘æµ‹ç‚¹ä¸€ç§’é’Ÿå¯å†…å¯ä»¥äº§ç”Ÿå¤šæ¡æ•°æ®ï¼‰</li>
<li>ä¸¥é‡ä¾èµ–äºé‡‡é›†æ—¶é—´ï¼ˆæ¯ä¸€æ¡æ•°æ®å‡è¦æ±‚å¯¹åº”å”¯ä¸€çš„æ—¶é—´ï¼‰</li>
<li>æµ‹ç‚¹å¤šä¿¡æ¯å¤§ï¼ˆå¸¸è§„çš„å®æ—¶æ£€æµ‹ç³»ç»Ÿå‡æœ‰æˆåƒä¸Šä¸‡çš„ç›‘æµ‹ç‚¹ï¼Œç›‘æµ‹ç‚¹æ¯ç§’é’Ÿéƒ½äº§ç”Ÿæ•°æ®ï¼Œæ¯å¤©äº§ç”Ÿå‡ åGBçš„æ•°æ®ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-11">ä¸»è¦ç‰¹ç‚¹</h3>
<h4 data-id="heading-12">åˆ—å¼å­˜å‚¨</h4>
<p>Druidç‹¬ç«‹çš„å­˜å‚¨å’Œå‹ç¼©æ¯ä¸€åˆ—ï¼Œä¸»éœ€è¦è¯»å–ç‰¹å®šæŸ¥è¯¢æ‰€éœ€çš„å†…å®¹ï¼Œè¿™å¯ä»¥æ”¯æŒå¿«é€Ÿæ‰«æã€æ’åå’Œèšåˆã€‚</p>
<h4 data-id="heading-13">æµå¼å’Œæ‰¹é‡æ‘„å–ï¼ˆIngestionï¼‰</h4>
<p>æ”¯æŒApache Kafkaã€HDFSã€AWS S3 ç­‰ç°æˆçš„è¿æ¥å™¨</p>
<h4 data-id="heading-14">æœ¬åœ°çš„æœç´¢ç´¢å¼•</h4>
<p>Druidä¸ºå­—ç¬¦ä¸²åˆ›å»ºå€’æ’ç´¢å¼•ï¼Œä»¥æ”¯æŒå¿«é€Ÿæœç´¢å’Œæ’åº</p>
<h4 data-id="heading-15">çµæ´»çš„Schema</h4>
<p>Druidå¯ä»¥å¤„ç†å˜åŒ–çš„Schemaå’ŒåµŒå¥—æ•°æ®</p>
<h4 data-id="heading-16">åŸºäºæ—¶é—´ä¼˜åŒ–Partition</h4>
<p>DruidåŸºäºæ—¶é—´æ™ºèƒ½çš„å¯¹æ•°æ®è¿›è¡Œåˆ†åŒºï¼ŒåŸºäºæ—¶é—´çš„æŸ¥è¯¢æ¯”ä¼ ç»Ÿæ•°æ®åº“è¦å¿«çš„å¤š</p>
<h4 data-id="heading-17">æ”¯æŒSQL</h4>
<p>Druidæ”¯æŒæœ¬æœºçš„JSONè¯­è¨€ï¼Œè¿˜æ”¯æŒåŸºäºHTTPæˆ–è€…JDBCçš„SQL</p>
<h4 data-id="heading-18">æ°´å¹³æ‰©å±•æ€§</h4>
<p>Druidå·²ç»ç”¨æˆ·ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæ¯ç§’æ¥æ”¶ç™¾ä¸‡ä¸ªäº‹ä»¶ï¼Œä¿å­˜å¤šå¹´çš„æ•°æ®å¹¶æä¾›æ¬¡ç§’çº§æŸ¥è¯¢</p>
<h4 data-id="heading-19">æ“ä½œç®€å•</h4>
<p>åªéœ€è¦å¢åŠ æˆ–åˆ é™¤æœåŠ¡å™¨å³å¯æ‰©å±•æˆ–ç¼©å°è§„æ¨¡ï¼ŒDruidä¼šè‡ªåŠ¨å¹³è¡¡ï¼Œå®¹é”™æ¶æ„é€šè¿‡æœåŠ¡å™¨çš„æ•…éšœè¿›è¡Œè·¯ç”±ã€‚</p>
<h3 data-id="heading-20">é›†æˆ</h3>
<p>Druidæ˜¯å¼€æºå¤§æ•°æ®çš„æŠ€æœ¯è¡¥å……ï¼ŒåŒ…æ‹¬Apache Kafkaã€Apache Hadoopã€Apache Flinkç­‰ï¼Œé€šå¸¸ä½äºå­˜å‚¨æˆ–å¤„ç†å±‚ä¸æœ€ç»ˆåº”ç”¨ä¹‹é—´ï¼Œå……å½“æŸ¥è¯¢å±‚æˆ–æ•°æ®åˆ†ææœåŠ¡ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9a246d7cb31e4fe0918fa7830cdc3a46~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763430941&amp;x-signature=rOsqiIeqgqaEcgCuP4jQLCuuRp0%3D" alt="Apache Druid é›†æˆçš„æŠ€æœ¯" loading="lazy"/></p>
<h3 data-id="heading-21">Ingestion(æ‘„å–)</h3>
<p>Druidæ”¯æŒæµå¼ä¼ è¾“å’Œæ‰¹é‡ç¤¾åŒºï¼ŒDruidè¿æ¥åˆ°æ•°æ®æºï¼ŒåŒ…æ‹¬ï¼šKafkaï¼ˆç”¨äºæµæ•°æ®åŠ è½½ï¼‰ï¼Œæˆ–åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œå¦‚HDFSï¼ˆç”¨äºæ‰¹å¤„ç†æ•°æ®åŠ è½½ï¼‰ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d954dbc764f04e3e9fa1d399d7a5ad97~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763430941&amp;x-signature=qUn9RRAr49VeNEjXQ%2B31xFgz%2BgY%3D" alt="Apache Druid Ingestion" loading="lazy"/></p>
<h3 data-id="heading-22">å­˜å‚¨</h3>
<p>Druidçš„æ•°æ®å­˜å‚¨é‡‡ç”¨åˆ—å¼å­˜å‚¨æ ¼å¼ï¼Œæ ¹æ®åˆ—çš„ç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ç­‰ï¼‰ï¼Œåº”ç”¨ä¸åŒçš„å‹ç¼©å’Œç¼–ç æ–¹æ³•ï¼Œæ ¹æ®åˆ—ç±»å‹ä¸åŒçš„ç±»å‹çš„ç´¢å¼•
Druidä¸ºå­—ç¬¦ä¸²åˆ—æ„å»ºå€’æ’ç´¢å¼•ï¼Œä»¥è¿›è¡Œå¿«é€Ÿæœç´¢å’Œè¿‡æ»¤ï¼ŒDruidå¯æŒ‰æ—¶é—´å¯¹æ•°æ®è¿›è¡Œæ™ºèƒ½åˆ†åŒºï¼Œä»¥å®ç°é¢å‘æ—¶é—´çš„å¿«é€ŸæŸ¥è¯¢ã€‚
Druidåœ¨æ‘„å–æ•°æ®æ—¶å¯¹æ•°æ®è¿›è¡Œé¢„èšåˆï¼ŒèŠ‚çœå¤§é‡çš„å­˜å‚¨ç©ºé—´ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5e2799e1a345426fbd7d010db6e06295~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763430941&amp;x-signature=EBzmEunRwR6bBdv8wkhrklG0hZE%3D" alt="Apache Druid å­˜å‚¨æ–¹æ¡ˆ" loading="lazy"/></p>
<h3 data-id="heading-23">æŸ¥è¯¢æ–¹å¼</h3>
<p>Druidæ”¯æŒJSONã€SQLä¸¤ç§æ–¹å¼æŸ¥è¯¢æ•°æ®ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/84d64204721d4fbdaccfecbdffd7ad07~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763430941&amp;x-signature=dAHkMaDMl3Qw%2FAPC01R%2BtjdBsQA%3D" alt="Apache Druid æ•°æ®æŸ¥è¯¢çš„æ–¹å¼" loading="lazy"/></p>
<h2 data-id="heading-24">åº”ç”¨åœºæ™¯</h2>
<p>Druidæ“…é•¿çš„éƒ¨åˆ†ï¼š</p>
<ul>
<li>å¯¹äºå¤§éƒ¨åˆ†æŸ¥è¯¢åœºæ™¯å¯ä»¥äºšç§’çº§å“åº”</li>
<li>äº‹ä»¶æµå®æ—¶å†™å…¥ä¸æ‰¹é‡æ•°æ®å¯¼å…¥å…¼å¤‡</li>
<li>æ•°æ®å†™å…¥å‰é¢„èšåˆèŠ‚çœå­˜å‚¨ç©ºé—´ï¼Œæå‡æŸ¥è¯¢æ•ˆç‡</li>
<li>æ°´å¹³æ‰©å®¹èƒ½åŠ›å¼º</li>
<li>ç¤¾åŒºæ´»è·ƒ</li>
</ul>
<p>å…·ä½“çš„æ–¹å‘æœ‰å¦‚ä¸‹ï¼š</p>
<ul>
<li>å®æ—¶æ•°æ®åˆ†æï¼šå¯¹å®æ—¶æ•°æ®æµï¼ˆå¦‚æ—¥å¿—ã€ä¼ æ„Ÿå™¨æ•°æ®ç­‰ï¼‰è¿›è¡Œå¿«é€Ÿåˆ†æå’Œå¯è§†åŒ–ã€‚</li>
<li>å•†ä¸šæ™ºèƒ½ï¼šç”¨äºå•†ä¸šåˆ†æï¼Œæ”¯æŒå¿«é€Ÿçš„æŠ¥å‘Šç”Ÿæˆå’Œè‡ªåŠ©å¼æ•°æ®æ¢ç´¢ã€‚</li>
<li>ç›‘æ§å’ŒæŒ‡æ ‡åˆ†æï¼šé€‚åˆç›‘æ§åº”ç”¨ç¨‹åºæ€§èƒ½ã€ç”¨æˆ·è¡Œä¸ºåˆ†æä»¥åŠæ“ä½œæŒ‡æ ‡ã€‚</li>
<li>ç½‘ç»œåˆ†æï¼šå¤„ç†ç½‘ç»œæµé‡æ•°æ®ï¼Œä»¥ä¾¿å¿«é€Ÿæ£€æµ‹å¼‚å¸¸æˆ–è¿›è¡Œè¶‹åŠ¿åˆ†æã€‚</li>
<li>å¤æ‚äº‹ä»¶å¤„ç† (CEP)ï¼šå®æ—¶å¤„ç†å’Œåˆ†æäº‹ä»¶æµï¼Œå¸®åŠ©ä¼ä¸šå¿«é€Ÿå“åº”å¸‚åœºå˜åŒ–ã€‚</li>
<li>æœºå™¨å­¦ä¹ é¢„å¤„ç†ï¼šä½œä¸ºæœºå™¨å­¦ä¹ æ¨¡å‹çš„è¾“å…¥ï¼Œæä¾›å¿«é€Ÿçš„æ•°æ®æ‘„å–å’Œå¤„ç†èƒ½åŠ›ã€‚</li>
</ul>
<p>é‚£æ˜¯å¦éœ€è¦Druidå‘¢ï¼Ÿ</p>
<ul>
<li>å¤„ç†æ—¶é—´åºåˆ—äº‹ä»¶</li>
<li>å¿«é€Ÿçš„èšåˆä»¥åŠæ¢ç´¢å¼åˆ†æ</li>
<li>è¿‘å®æ—¶çš„åˆ†æ äºšç§’çº§å“åº”</li>
<li>å­˜å‚¨å¤§é‡ï¼ˆTBã€PBçº§åˆ«ï¼‰å¯ä»¥é¢„å…ˆå®šä¹‰è‹¥å¹²ç»´åº¦çš„äº‹ä»¶</li>
<li>æ— å•ç‚¹é—®é¢˜çš„æ•°æ®å­˜å‚¨</li>
</ul>
<h2 data-id="heading-25">é”™è¯¯é€ŸæŸ¥</h2>



































<table><thead><tr><th>ç—‡çŠ¶</th><th>æ ¹å› </th><th>ä¿®å¤</th></tr></thead><tbody><tr><td>å®æ—¶æ‘„å–å»¶è¿Ÿä¸Šå‡ï¼ˆKafka lag å¢å¤§ï¼‰</td><td>ä»»åŠ¡æ§½ä¸è¶³ã€supervisor é…ç½®ä¸å½“æˆ–æ‰©å±•æœªåŠ è½½</td><td>Overlord supervisor/{id}/statsã€MiddleManager æŒ‡æ ‡æå‡ taskCount/å¹¶å‘æ§½ï¼Œæ ¡éªŒå¹¶åŠ è½½ druid-kafka-indexing-service æ‰©å±•ã€‚</td></tr><tr><td>æŸ¥è¯¢æ—¶å¿«æ—¶æ…¢ã€æŠ–åŠ¨æ˜æ˜¾</td><td>å°è€Œå¤šçš„ segments é€ æˆè°ƒåº¦ä¸æ‰«æå¼€é”€</td><td>è§‚å¯Ÿæ®µæ•°ã€å¤§å°ä¸æ—¶é—´åˆ†å¸ƒï¼›å¯ç”¨/åŠ å¼º Compactionï¼Œåˆå¹¶å°æ®µï¼Œä¼˜åŒ–æ®µå¤§å°ä¸è¡Œæ•°ã€‚</td></tr><tr><td>Broker/Historical å†…å­˜åƒç´§æˆ– OOM</td><td>ç»“æœé›†è¿‡å¤§ã€å¹¶å‘é«˜ã€ä¸Šä¸‹æ–‡å‚æ•°ä¸åˆç†</td><td>Broker/Historical JVM/æŸ¥è¯¢æŒ‡æ ‡ï¼›é™åˆ¶è¿”å›é‡ï¼›å¼€å¯/è°ƒæ•´å‘é‡åŒ–ä¸æŸ¥è¯¢ä¸Šä¸‹æ–‡ï¼›æŒ‰â€œåŸºç¡€é›†ç¾¤è°ƒä¼˜â€å¢é…ä¸é…é¢ã€‚</td></tr><tr><td>æ— æ³•æ¶ˆè´¹ Kafkaï¼ˆæç¤ºéœ€åŠ è½½æ‰©å±•ï¼‰</td><td>Kafka ç´¢å¼•æ‰©å±•æœªåŠ è½½åˆ° Overlord/MiddleManager</td><td>å¯åŠ¨æ—¥å¿—ä¸ druid.extensions.loadListï¼›åœ¨ä¸¤ç«¯åŠ è½½æ‰©å±•å¹¶é‡å¯ï¼ŒæŒ‰å®˜æ–¹ Kafka æ‘„å–æ–‡æ¡£æ ¸å¯¹é…ç½®ã€‚</td></tr><tr><td>å‡çº§åå¯åŠ¨æŠ¥ Java ç‰ˆæœ¬/å¼ƒç”¨å‘Šè­¦</td><td>è¿è¡Œåœ¨ Java 11ï¼Œç‰ˆæœ¬å·²å¼ƒç”¨æˆ–å³å°†ç§»é™¤æ”¯æŒ</td><td>å¯åŠ¨æ—¥å¿—å‘Šè­¦ï¼›è¿ç§»è‡³ JDK 17/21ï¼›å®˜æ–¹è®¡åˆ’åœ¨ 37.0.0 ç»“æŸ Java 11 æ”¯æŒï¼Œæå‰éªŒè¯ä¾èµ–ã€‚</td></tr></tbody></table>
<h2 data-id="heading-26">å…¶ä»–ç³»åˆ—</h2>
<h3 data-id="heading-27">ğŸš€ AIç¯‡æŒç»­æ›´æ–°ä¸­ï¼ˆé•¿æœŸæ›´æ–°ï¼‰</h3>
<p><strong>AIç‚¼ä¸¹æ—¥å¿—-29 - å­—èŠ‚è·³åŠ¨ DeerFlow æ·±åº¦ç ”ç©¶æ¡†<em>æ–œä½“æ ·å¼</em>æ¶ ç§æœ‰éƒ¨ç½² æµ‹è¯•ä¸Šæ‰‹ æ¶æ„ç ”ç©¶</strong>ï¼ŒæŒç»­æ‰“é€ å®ç”¨AIå·¥å…·æŒ‡å—ï¼
<strong>AI-è°ƒæŸ¥ç ”ç©¶-108-å…·èº«æ™ºèƒ½ æœºå™¨äººæ¨¡å‹è®­ç»ƒå…¨æµç¨‹è¯¦è§£ï¼šä»é¢„è®­ç»ƒåˆ°å¼ºåŒ–å­¦ä¹ ä¸äººç±»åé¦ˆ</strong></p>
<h3 data-id="heading-28">ğŸ’» Javaç¯‡æŒç»­æ›´æ–°ä¸­ï¼ˆé•¿æœŸæ›´æ–°ï¼‰</h3>
<p><strong>Java-154 æ·±å…¥æµ…å‡º MongoDB ç”¨Javaè®¿é—® MongoDB æ•°æ®åº“ ä»ç¯å¢ƒæ­å»ºåˆ°CRUDå®Œæ•´ç¤ºä¾‹</strong>
MyBatis å·²å®Œç»“ï¼ŒSpring å·²å®Œç»“ï¼ŒNginxå·²å®Œç»“ï¼ŒTomcatå·²å®Œç»“ï¼Œåˆ†å¸ƒå¼æœåŠ¡æ­£åœ¨æ›´æ–°ï¼æ·±å…¥æµ…å‡ºåŠ©ä½ æ‰“ç‰¢åŸºç¡€ï¼</p>
<h3 data-id="heading-29">ğŸ“Š å¤§æ•°æ®æ¿å—å·²å®Œæˆå¤šé¡¹å¹²è´§æ›´æ–°ï¼ˆ300ç¯‡ï¼‰ï¼š</h3>
<p>åŒ…æ‹¬ Hadoopã€Hiveã€Kafkaã€Flinkã€ClickHouseã€Elasticsearch ç­‰äºŒåä½™é¡¹æ ¸å¿ƒç»„ä»¶ï¼Œè¦†ç›–ç¦»çº¿+å®æ—¶æ•°ä»“å…¨æ ˆï¼
<strong>å¤§æ•°æ®-278 Spark MLib - åŸºç¡€ä»‹ç» æœºå™¨å­¦ä¹ ç®—æ³• æ¢¯åº¦æå‡æ ‘ GBDTæ¡ˆä¾‹ è¯¦è§£</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[èåˆæ•°æ®åº“æ—¶ä»£ï¼šé‡‘ä»“ â€œäº”ä¸ªä¸€ä½“åŒ–â€ æ¶æ„é‡å¡‘æ•°æ®ç®¡ç†æ–°èŒƒå¼]]></title>    <link>https://juejin.cn/post/7570908785293983763</link>    <guid>https://juejin.cn/post/7570908785293983763</guid>    <pubDate>2025-11-11T00:37:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570908785293983763" data-draft-id="7570885801478799401" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="èåˆæ•°æ®åº“æ—¶ä»£ï¼šé‡‘ä»“ â€œäº”ä¸ªä¸€ä½“åŒ–â€ æ¶æ„é‡å¡‘æ•°æ®ç®¡ç†æ–°èŒƒå¼"/> <meta itemprop="keywords" content="æ•°æ®åº“"/> <meta itemprop="datePublished" content="2025-11-11T00:37:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="xcLeigh"/> <meta itemprop="url" content="https://juejin.cn/user/1775071503323875"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            èåˆæ•°æ®åº“æ—¶ä»£ï¼šé‡‘ä»“ â€œäº”ä¸ªä¸€ä½“åŒ–â€ æ¶æ„é‡å¡‘æ•°æ®ç®¡ç†æ–°èŒƒå¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1775071503323875/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    xcLeigh
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T00:37:33.000Z" title="Tue Nov 11 2025 00:37:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æ•°å­—ç»æµæ—¶ä»£ï¼Œæ•°æ®ç±»å‹ç¹æ‚ã€è¿ç§»å›°éš¾ã€è¿ç»´å¤æ‚ç­‰é—®é¢˜è®©ä¼ä¸šå¤‡å—å›°æ‰°ã€‚é‡‘ä»“æ•°æ®åº“æ·±è€•å››åä½™å¹´ï¼Œæ¨å‡º â€œäº”ä¸ªä¸€ä½“åŒ–â€ èåˆæ¶æ„ï¼Œç”¨ä¸€å¥—ç³»ç»Ÿç ´è§£å¤šåœºæ™¯æ•°æ®ç®¡ç†éš¾é¢˜ã€‚è¯¥æ¶æ„å®ç°å¤šè¯­æ³•å…¼å®¹ï¼ŒOracleã€MySQL ç­‰ä¸»æµæ•°æ®åº“è¯­æ³•æ— ç¼é€‚é…ï¼Œè¿ç§»é›¶æˆæœ¬ï¼›æ”¯æŒå…³ç³»ã€JSONã€GISã€å‘é‡ç­‰å¤šæ¨¡æ•°æ®ç»Ÿä¸€å­˜å‚¨æŸ¥è¯¢ï¼Œæ‰“ç ´æ•°æ®å­¤å²›ï¼›è¦†ç›–äº¤æ˜“ã€åˆ†æã€AI æ¨ç†ç­‰å…¨åœºæ™¯ï¼Œæ— éœ€æ‹†åˆ†ç³»ç»Ÿï¼›é›†ä¸­ä¸åˆ†å¸ƒå¼æ¶æ„çµæ´»åˆ‡æ¢ï¼Œé€‚é…ä¸åŒä¸šåŠ¡è§„æ¨¡ï¼›å¼€å‘è¿ç»´å·¥å…·ä¸€ä½“åŒ–ï¼Œå¤§å¹…é™æœ¬å¢æ•ˆã€‚ç›®å‰ï¼Œè¯¥æ¶æ„å·²åœ¨èƒ½æºã€é‡‘èã€äº¤é€šç­‰å¤šè¡Œä¸šè½åœ°ï¼Œå‡­å€ŸæŸ¥è¯¢å¿«ã€æˆæœ¬ä½ã€ç¨³å®šæ€§å¼ºçš„ä¼˜åŠ¿ï¼Œæˆä¸ºä¼ä¸šæ•°å­—åŒ–è½¬å‹çš„å¯é æ”¯æ’‘ï¼ŒåŠ©åŠ›æ•°æ®ä»·å€¼å……åˆ†é‡Šæ”¾ã€‚</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c5bf023be4524a2f8182b8b72c7efb2a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGNMZWlnaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763426253&amp;x-signature=OXws%2BDXG9PFMAJ%2Bm9t0NHeeAy3c%3D" alt="é‡‘ä»“ â€œäº”ä¸ªä¸€ä½“åŒ–â€ æ¶æ„é‡å¡‘æ•°æ®ç®¡ç†æ–°èŒƒå¼" loading="lazy"/></p>
<p>ç°åœ¨æ•°å­—ç»æµå‘å±•å¾—è¶Šæ¥è¶Šå¿«ï¼Œæ•°æ®æ—©å°±æˆäº†ä¼ä¸šæœ€æ ¸å¿ƒçš„æˆ˜ç•¥èµ„äº§ã€‚äº’è”ç½‘ã€ç‰©è”ç½‘ã€AIè¿™äº›æŠ€æœ¯ç”¨å¾—è¶Šæ¥è¶Šæ·±ï¼Œæ•°æ®ä¸€ä¸‹å­å˜å¾—åˆå¤šåˆæ‚ï¼Œè¿˜å¾—å®æ—¶å¤„ç†ï¼Œä¼ ç»Ÿæ•°æ®åº“é‚£å¥—â€œåªèƒ½é€‚é…ä¸€ç§æ¨¡å¼ã€æ¶æ„é›¶æ•£ã€è¿ç»´éº»çƒ¦â€çš„é—®é¢˜ï¼Œç°åœ¨çœ‹è¶Šæ¥è¶Šçªå‡ºã€‚å’±ä»¬å›½äº§æ•°æ®åº“é‡Œçš„é¢†å¤´ç¾Šé‡‘ä»“ï¼ŒæŠ“ä½â€œèåˆâ€è¿™ä¸ªå…³é”®ç‚¹ï¼Œæå‡ºäº†â€œäº”ä¸ªä¸€ä½“åŒ–â€æ¶æ„ï¼Œä¸€å¥—ç³»ç»Ÿå°±èƒ½æå®šå„ç§åœºæ™¯çš„æ•°æ®ç®¡ç†é—®é¢˜ï¼Œç»™ä¼ä¸šæ•°å­—åŒ–è½¬å‹æ‰˜åº•ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f27a42a251af4f80b2ceae8fc563de0a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGNMZWlnaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763426253&amp;x-signature=d8wPQ95a1Me%2B58pX%2FFDSL2uEvQg%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/>
10å¤šä¸ªå®é™…èƒ½ç”¨çš„ä»£ç æ¡ˆä¾‹ï¼Œè¿˜æœ‰5ä¸ªè¡Œä¸šé‡ŒçœŸæ­£è½åœ°çš„åœºæ™¯ï¼Œåƒå¤šè¯­æ³•å…¼å®¹ã€å¤šæ¨¡æ•°æ®å¤„ç†ã€åˆ†å¸ƒå¼éƒ¨ç½²è¿™äº›æ ¸å¿ƒéœ€æ±‚éƒ½è¦†ç›–åˆ°äº†ï¼ŒæŠ€æœ¯åŒå­¦çœ‹äº†å°±èƒ½å¿«é€Ÿä¸Šæ‰‹ç”¨èµ·æ¥ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€æ•°æ®åº“ç»•ä¸å¼€çš„ä¸‰ä¸ªéš¾é¢˜</h2>
<p>æ•°å­—åŒ–è½¬å‹è¶Šå¾€æ·±èµ°ï¼Œæ•°æ®åº“å°±ä¸åªæ˜¯å­˜æ•°æ®é‚£ä¹ˆç®€å•äº†ã€‚ç°åœ¨ä¼ä¸šç®¡æ•°æ®ï¼ŒåŸºæœ¬ä¸Šéƒ½è¦é¢å¯¹ä¸‰ä¸ªå¤´ç–¼äº‹ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb784930bb7245cabde84c486ae36a15~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGNMZWlnaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763426253&amp;x-signature=YRWYlgqJHhqlg1g8xW6Qr825ByY%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<ul>
<li><strong>æ•°æ®ç±»å‹å¤ªæ•£</strong>ï¼šä»¥å‰çš„ç»“æ„åŒ–æ•°æ®å°±ä¸è¯´äº†ï¼Œç°åœ¨è¿˜æœ‰JSONæ–‡æ¡£è¿™ç§åŠç»“æ„åŒ–çš„ã€æ—¥å¿—è¿™ç§æ— ç»“æ„çš„ï¼ŒåŠ ä¸ŠGISåœ°ç†æ•°æ®ã€æ—¶åºç›‘æ§æ•°æ®ã€å‘é‡ç‰¹å¾æ•°æ®ï¼Œä¹±ä¸ƒå…«ç³Ÿçš„éƒ½å­˜åœ¨ä¸åŒæ•°æ®åº“é‡Œï¼Œæƒ³è·¨ç€æŸ¥ç‚¹ä¸œè¥¿ç‰¹åˆ«è´¹åŠ²ã€‚</li>
<li><strong>è¿ç§»èµ·æ¥å¤ªéº»çƒ¦</strong>ï¼šä¼ä¸šææ•°å­—åŒ–ï¼Œç»å¸¸è¦æ¢ä¸åŒç±»å‹çš„æ•°æ®åº“ã€‚ä¼ ç»Ÿçš„è¿ç§»æ–¹å¼å¾—æ”¹ä¸€å †ä»£ç ã€é€‚é…æ•°æ®ï¼Œåˆè´¹é’±åˆå®¹æ˜“å‡ºé—®é¢˜ï¼Œè·Ÿâ€œä½ç€äººçš„æˆ¿å­é‡Œé‡è£…åœ°æš–â€ä¸€æ ·æŠ˜è…¾ã€‚</li>
<li><strong>ç®¡ç†è¿ç»´å¤ªå¤æ‚</strong>ï¼šä¸šåŠ¡è¶Šåšè¶Šå¤§ï¼Œæ•°æ®åº“é›†ç¾¤ä¹Ÿè·Ÿç€æ‰©ï¼Œåˆ†æ•£çš„æ¶æ„å¯¼è‡´èµ„æºæµªè´¹ã€ä¸åŒç”¨æˆ·çš„æ•°æ®éš¾éš”ç¦»ã€è·¨å¤šä¸ªäº‘éƒ¨ç½²ä¹Ÿéº»çƒ¦ï¼Œè¿ç»´æˆæœ¬ä¸€ç›´é™ä¸ä¸‹æ¥ã€‚</li>
</ul>
<p>é¢å¯¹è¿™äº›é—®é¢˜ï¼Œæ•°æ®åº“è¡Œä¸šè‚¯å®šè¦â€œåˆâ€èµ·æ¥ï¼Œè¿™æ˜¯èº²ä¸å¼€çš„è¶‹åŠ¿ã€‚é‡‘ä»“åšæ•°æ®åº“å››åå¤šå¹´äº†ï¼ŒæŠ€æœ¯ç§¯ç´¯å¤Ÿæ·±ï¼Œæ¨å‡ºçš„â€œäº”ä¸ªä¸€ä½“åŒ–â€èåˆæ¶æ„ï¼Œå°±æ˜¯è¦è§£å†³â€œä¸€æ¬¾æ•°æ®åº“æå®šæ‰€æœ‰äº‹â€è¿™ä¸ªæ ¸å¿ƒéœ€æ±‚ã€‚</p>
<h2 data-id="heading-1">äºŒã€äº”ä¸ªä¸€ä½“åŒ–ï¼šé‡‘ä»“èåˆæ•°æ®åº“çš„æ ¸å¿ƒæ¶æ„ï¼ˆå¸¦å®é™…ä»£ç ï¼‰</h2>
<p>é‡‘ä»“æ•°æ®åº“KESäº§å“ç”¨çš„æ˜¯æ¾è€¦åˆã€èƒ½æ‰©å±•çš„äº”åŒ–æŠ€æœ¯å¹³å°æ¶æ„ï¼Œä»äº”ä¸ªæ–¹é¢æ·±åº¦èåˆï¼Œä¸ç®¡ä»€ä¹ˆåœºæ™¯çš„æ•°æ®ç®¡ç†éƒ½èƒ½è¦†ç›–åˆ°ã€‚ä¸‹é¢ç»“åˆå®é™…ä»£ç å’Œå…·ä½“åœºæ™¯ï¼Œè·Ÿå¤§å®¶è¯´æ¸…æ¥šæ¯ä¸ªæ¶æ„æ€ä¹ˆç”¨ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/152f7d301e0f4e15bb9758853ef2913b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGNMZWlnaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763426253&amp;x-signature=V4McUjLj%2F9C13BrXp7ovkQ3GMec%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h3 data-id="heading-2">1. å¤šè¯­æ³•ä¸€èµ·å…¼å®¹ï¼šä¸ç”¨é¢å¤–èŠ±é’±å°±èƒ½æ¢æ•°æ®åº“</h3>
<p>è¿ç§»æ•°æ®åº“æœ€éº»çƒ¦çš„å°±æ˜¯è¯­æ³•ä¸å…¼å®¹ï¼Œä¸åŒæ•°æ®åº“çš„SQLè¯­æ³•ã€å­˜å‚¨è¿‡ç¨‹ã€å‡½æ•°éƒ½ä¸ä¸€æ ·ã€‚é‡‘ä»“æ•°æ®åº“ç‰¹æ„åšäº†å¤šè¯­æ³•ä¸€ä½“åŒ–å…¼å®¹ï¼ŒOracleã€MySQLã€SQL Serverè¿™äº›ä¸»æµçš„è¯­æ³•éƒ½æ”¯æŒï¼Œåº”ç”¨ä»£ç ä¸ç”¨æ”¹å°±èƒ½ç›´æ¥è¿è¿‡æ¥ã€‚</p>
<h4 data-id="heading-3">å®é™…ç”¨ä¾‹1ï¼šOracleå­˜å‚¨è¿‡ç¨‹ç›´æ¥å°±èƒ½è·‘</h4>
<p>æœ‰ä¸ªé‡‘èæœºæ„ï¼Œæƒ³æŠŠOracleæ•°æ®åº“é‡Œâ€œæ›´æ–°ç”¨æˆ·è´¦æˆ·ä½™é¢â€çš„å­˜å‚¨è¿‡ç¨‹è¿åˆ°é‡‘ä»“ï¼Œç»“æœä¸€è¡Œä»£ç æ²¡æ”¹å°±è·‘é€šäº†ï¼š</p>
<pre><code class="hljs language-plsql" lang="plsql">-- Oracleé£æ ¼å­˜å‚¨è¿‡ç¨‹ï¼ˆé‡‘ä»“ç›´æ¥å…¼å®¹è¿è¡Œï¼‰
CREATE OR REPLACE PROCEDURE update_user_balance(
    p_user_id IN NUMBER,
    p_amount  IN NUMBER,
    p_result  OUT VARCHAR2
) AS
    v_current_balance NUMBER;
BEGIN
    -- æŸ¥è¯¢å½“å‰ä½™é¢ï¼ˆå…¼å®¹Oracle ROWNUMè¯­æ³•ï¼‰
    SELECT balance INTO v_current_balance 
    FROM user_account 
    WHERE user_id = p_user_id AND ROWNUM = 1;
    
    -- æ›´æ–°ä½™é¢ï¼ˆå…¼å®¹Oracle MERGEè¯­æ³•ï¼‰
    MERGE INTO user_account a
    USING (SELECT p_user_id AS user_id, v_current_balance + p_amount AS new_balance FROM DUAL) b
    ON (a.user_id = b.user_id)
    WHEN MATCHED THEN UPDATE SET a.balance = b.new_balance;
    
    p_result := 'SUCCESS';
EXCEPTION
    WHEN NO_DATA_FOUND THEN
        p_result := 'USER_NOT_FOUND';
    WHEN OTHERS THEN
        p_result := 'ERROR: ' || SQLERRM;
END;
/

-- è°ƒç”¨å­˜å‚¨è¿‡ç¨‹ï¼ˆå…¼å®¹Oracle EXECè¯­æ³•ï¼‰
DECLARE
    v_res VARCHAR2(100);
BEGIN
    EXEC update_user_balance(1001, 500, v_res);
    DBMS_OUTPUT.PUT_LINE(v_res); -- è¾“å‡ºï¼šSUCCESS
END;
/
</code></pre>
<h4 data-id="heading-4">å®é™…ç”¨ä¾‹2ï¼šMySQLå®¢æˆ·ç«¯ç›´æ¥è¿é‡‘ä»“</h4>
<p>ä¸€å®¶äº’è”ç½‘å…¬å¸ä¸€ç›´ç”¨MySQLå®¢æˆ·ç«¯ï¼Œæƒ³è¿é‡‘ä»“æ•°æ®åº“ï¼Œç»“æœè¿æ¥ä»£ç å’ŒSQLè¯­å¥éƒ½æ²¡æ”¹ï¼Œç›´æ¥å°±è¿ä¸Šäº†ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># MySQLé£æ ¼Pythonè¿æ¥ä»£ç ï¼ˆç›´æ¥è¿æ¥é‡‘ä»“ï¼‰</span>
<span class="hljs-keyword">import</span> pymysql

<span class="hljs-comment"># è¿æ¥é‡‘ä»“æ•°æ®åº“ï¼ˆä½¿ç”¨MySQLåè®®ä¸ç«¯å£ï¼‰</span>
conn = pymysql.connect(
    host=<span class="hljs-string">'192.168.1.100'</span>,
    port=<span class="hljs-number">3306</span>,  <span class="hljs-comment"># é‡‘ä»“å…¼å®¹MySQLç«¯å£</span>
    user=<span class="hljs-string">'test'</span>,
    password=<span class="hljs-string">'Test@123'</span>,
    db=<span class="hljs-string">'ecommerce'</span>,
    charset=<span class="hljs-string">'utf8mb4'</span>
)

<span class="hljs-comment"># æ‰§è¡ŒMySQLé£æ ¼SQLï¼ˆå…¼å®¹LIMITã€GROUP_CONCATï¼‰</span>
<span class="hljs-keyword">with</span> conn.cursor() <span class="hljs-keyword">as</span> cursor:
    sql = <span class="hljs-string">"""
        SELECT order_id, GROUP_CONCAT(product_name) AS product_list 
        FROM orders 
        WHERE create_time &gt; '2025-01-01' 
        GROUP BY order_id 
        LIMIT 10;
    """</span>
    cursor.execute(sql)
    result = cursor.fetchall()
    <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> result:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"è®¢å•ID: <span class="hljs-subst">{row[<span class="hljs-number">0</span>]}</span>, å•†å“åˆ—è¡¨: <span class="hljs-subst">{row[<span class="hljs-number">1</span>]}</span>"</span>)

conn.close()
</code></pre>
<h3 data-id="heading-5">2. å¤šæ¨¡æ•°æ®ä¸€èµ·å­˜ï¼šä¸ç”¨è·¨åº“å°±èƒ½æŸ¥å„ç§æ•°æ®</h3>
<p>é‡‘ä»“æ•°æ®åº“èƒ½æŠŠå…³ç³»ã€æ–‡æ¡£ã€å›¾ã€æ—¶åºã€GISã€å‘é‡è¿™äº›ä¸åŒç±»å‹çš„æ•°æ®æ”¾åœ¨ä¸€èµ·å­˜ï¼Œè¿˜èƒ½æ··åˆæŸ¥è¯¢ï¼Œä¸ç”¨å†æå¤æ‚çš„è·¨åº“é›†æˆï¼Œå°±èƒ½æŠŠä¸åŒç±»å‹çš„æ•°æ®å…³è”èµ·æ¥åˆ†æã€‚</p>
<h4 data-id="heading-6">å®é™…ç”¨ä¾‹3ï¼šå…³ç³»æ•°æ®å’ŒJSONæ–‡æ¡£ä¸€èµ·æŸ¥</h4>
<p>æŸç”µå•†å¹³å°æƒ³æŸ¥â€œç”¨æˆ·åŸºæœ¬ä¿¡æ¯+æœ€è¿‘3æ¡è®¢å•è¯¦æƒ…â€ï¼Œè®¢å•è¯¦æƒ…æ˜¯ç”¨JSONæ ¼å¼å­˜çš„ï¼Œç›´æ¥ç”¨ä¸€æ¡SQLå°±æŸ¥å‡ºæ¥äº†ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 1. åˆ›å»ºå«JSONå­—æ®µçš„è¡¨ï¼ˆé‡‘ä»“åŸç”Ÿæ”¯æŒJSONBç±»å‹ï¼‰</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> users (
    user_id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY,
    username <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    user_info JSONB, <span class="hljs-comment">-- å­˜å‚¨ç”¨æˆ·åœ°å€ã€ç”µè¯ç­‰åŠç»“æ„åŒ–æ•°æ®</span>
    register_time <span class="hljs-type">TIMESTAMP</span>
);

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> orders (
    order_id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY,
    user_id <span class="hljs-type">INT</span> <span class="hljs-keyword">REFERENCES</span> users(user_id),
    order_detail JSONB, <span class="hljs-comment">-- å­˜å‚¨è®¢å•å•†å“ã€é‡‘é¢ç­‰è¯¦æƒ…</span>
    create_time <span class="hljs-type">TIMESTAMP</span>
);

<span class="hljs-comment">-- 2. æ’å…¥å¤šæ¨¡æ•°æ®</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> users <span class="hljs-keyword">VALUES</span> (
    <span class="hljs-number">1001</span>,
    <span class="hljs-string">'zhangsan'</span>,
    <span class="hljs-string">'{"phone": "13800138000", "address": "åŒ—äº¬å¸‚æµ·æ·€åŒºä¸­å…³æ‘"}'</span>,
    <span class="hljs-string">'2025-01-10'</span>
);

<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> orders <span class="hljs-keyword">VALUES</span> (
    <span class="hljs-number">20001</span>,
    <span class="hljs-number">1001</span>,
    <span class="hljs-string">'{"products": [{"name": "ç¬”è®°æœ¬ç”µè„‘", "price": 5999}, {"name": "é¼ æ ‡", "price": 99}], "total": 6098}'</span>,
    <span class="hljs-string">'2025-02-01'</span>
);

<span class="hljs-comment">-- 3. æ··åˆæŸ¥è¯¢ï¼ˆå…³ç³»å­—æ®µ+JSONå±æ€§è¿‡æ»¤+èšåˆï¼‰</span>
<span class="hljs-keyword">SELECT</span> 
    u.user_id,
    u.username,
    u.user_info<span class="hljs-operator">-</span><span class="hljs-operator">&gt;&gt;</span><span class="hljs-string">'$.phone'</span> <span class="hljs-keyword">AS</span> phone, <span class="hljs-comment">-- æå–JSONå±æ€§</span>
    <span class="hljs-built_in">COUNT</span>(o.order_id) <span class="hljs-keyword">AS</span> order_count,
    <span class="hljs-built_in">ARRAY_AGG</span>(o.order_detail<span class="hljs-operator">-</span><span class="hljs-operator">&gt;&gt;</span><span class="hljs-string">'$.total'</span>) <span class="hljs-keyword">AS</span> order_totals <span class="hljs-comment">-- èšåˆJSONå±æ€§</span>
<span class="hljs-keyword">FROM</span> users u
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> orders o <span class="hljs-keyword">ON</span> u.user_id <span class="hljs-operator">=</span> o.user_id
<span class="hljs-keyword">WHERE</span> o.create_time <span class="hljs-keyword">BETWEEN</span> <span class="hljs-string">'2025-01-01'</span> <span class="hljs-keyword">AND</span> <span class="hljs-string">'2025-03-01'</span>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> u.user_id, u.username, u.user_info<span class="hljs-operator">-</span><span class="hljs-operator">&gt;&gt;</span><span class="hljs-string">'$.phone'</span>;
</code></pre>
<h4 data-id="heading-7">å®é™…ç”¨ä¾‹4ï¼šæ—¶åºæ•°æ®å’ŒGISç©ºé—´æ•°æ®ä¸€èµ·æŸ¥</h4>
<p>æŸæ™ºæ…§äº¤é€šå¹³å°è¦æŸ¥â€œ2025-10-01 08:00-09:00ä¹‹é—´ï¼Œåœ¨ä¸Šæµ·è™¹æ¡¥æœºåœº5å…¬é‡Œå†…è¡Œé©¶çš„å‡ºç§Ÿè½¦è½¨è¿¹â€ï¼Œç”¨é‡‘ä»“çš„æ—¶åº+GISèåˆåŠŸèƒ½ç›´æ¥å°±å®ç°äº†ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 1. åˆ›å»ºæ—¶åº+GISæ··åˆè¡¨ï¼ˆé‡‘ä»“åŸç”Ÿæ”¯æŒTIMESTAMPTZã€GEOGRAPHYç±»å‹ï¼‰</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> taxi_trajectory (
    taxi_id <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    track_time TIMESTAMPTZ <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>, <span class="hljs-comment">-- æ—¶åºæ—¶é—´å­—æ®µ</span>
    location GEOGRAPHY(POINT) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>, <span class="hljs-comment">-- GISåœ°ç†åæ ‡ï¼ˆç»çº¬åº¦ï¼‰</span>
    speed <span class="hljs-type">NUMERIC</span>(<span class="hljs-number">5</span>,<span class="hljs-number">1</span>),
    <span class="hljs-keyword">PRIMARY</span> KEY (taxi_id, track_time) <span class="hljs-comment">-- æ—¶é—´+ä¸šåŠ¡ç»´åº¦åˆ†åŒºé”®</span>
) <span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">RANGE</span> (track_time); <span class="hljs-comment">-- æŒ‰æ—¶é—´åˆ†åŒº</span>

<span class="hljs-comment">-- 2. åˆ›å»ºåˆ†åŒºï¼ˆæŒ‰å¤©åˆ†åŒºï¼‰</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> taxi_trajectory_20251001 <span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">OF</span> taxi_trajectory
<span class="hljs-keyword">FOR</span> <span class="hljs-keyword">VALUES</span> <span class="hljs-keyword">FROM</span> (<span class="hljs-string">'2025-10-01'</span>) <span class="hljs-keyword">TO</span> (<span class="hljs-string">'2025-10-02'</span>);

<span class="hljs-comment">-- 3. æ’å…¥è½¨è¿¹æ•°æ®ï¼ˆç»çº¬åº¦ï¼šè™¹æ¡¥æœºåœºçº¦121.33Â°E, 31.19Â°Nï¼‰</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> taxi_trajectory <span class="hljs-keyword">VALUES</span> (
    <span class="hljs-string">'SH-T-12345'</span>,
    <span class="hljs-string">'2025-10-01 08:15:30+08'</span>,
    ST_SetSRID(ST_MakePoint(<span class="hljs-number">121.33</span>, <span class="hljs-number">31.19</span>), <span class="hljs-number">4326</span>), <span class="hljs-comment">-- æ„å»ºGISç‚¹</span>
    <span class="hljs-number">45.5</span>
);

<span class="hljs-comment">-- 4. æ—¶ç©ºæ··åˆæŸ¥è¯¢ï¼ˆæ—¶é—´èŒƒå›´+ç©ºé—´è·ç¦»è¿‡æ»¤ï¼‰</span>
<span class="hljs-keyword">SELECT</span> 
    taxi_id,
    track_time,
    ST_AsText(location) <span class="hljs-keyword">AS</span> location, <span class="hljs-comment">-- è½¬æ¢ä¸ºå¯è¯»ç»çº¬åº¦</span>
    speed,
    ST_Distance(
        location,
        ST_SetSRID(ST_MakePoint(<span class="hljs-number">121.33</span>, <span class="hljs-number">31.19</span>), <span class="hljs-number">4326</span>) <span class="hljs-comment">-- è™¹æ¡¥æœºåœºåæ ‡</span>
    ) <span class="hljs-operator">/</span> <span class="hljs-number">1000</span> <span class="hljs-keyword">AS</span> distance_km <span class="hljs-comment">-- è®¡ç®—è·ç¦»ï¼ˆå•ä½ï¼šå…¬é‡Œï¼‰</span>
<span class="hljs-keyword">FROM</span> taxi_trajectory
<span class="hljs-keyword">WHERE</span> 
    track_time <span class="hljs-keyword">BETWEEN</span> <span class="hljs-string">'2025-10-01 08:00:00+08'</span> <span class="hljs-keyword">AND</span> <span class="hljs-string">'2025-10-01 09:00:00+08'</span>
    <span class="hljs-keyword">AND</span> ST_Distance(
        location,
        ST_SetSRID(ST_MakePoint(<span class="hljs-number">121.33</span>, <span class="hljs-number">31.19</span>), <span class="hljs-number">4326</span>)
    ) <span class="hljs-operator">&lt;=</span> <span class="hljs-number">5000</span>; <span class="hljs-comment">-- ç­›é€‰5å…¬é‡Œå†…æ•°æ®</span>
</code></pre>
<h4 data-id="heading-8">å®é™…ç”¨ä¾‹5ï¼šå‘é‡æ•°æ®å’Œæ–‡æœ¬è¯­ä¹‰ä¸€èµ·æŸ¥</h4>
<p>æœ‰ä¸ªåšAIçš„å…¬å¸æƒ³å®ç°â€œæ–‡æœ¬è¯­ä¹‰æœç´¢â€ï¼ŒæŠŠæ–‡æœ¬è½¬æˆå‘é‡å­˜èµ·æ¥ï¼Œé€šè¿‡å‘é‡ç›¸ä¼¼åº¦æ‰¾ç›¸ä¼¼æ–‡æœ¬ï¼Œç”¨é‡‘ä»“çš„å‘é‡å­˜å‚¨åŠŸèƒ½å¾ˆå¿«å°±å®ç°äº†ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 1. åˆ›å»ºå‘é‡è¡¨ï¼ˆé‡‘ä»“æ”¯æŒVECTORç±»å‹ï¼Œé€‚é…AIåœºæ™¯ï¼‰</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> text_vectors (
    id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY,
    content TEXT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>, <span class="hljs-comment">-- åŸå§‹æ–‡æœ¬</span>
    vec VECTOR(<span class="hljs-number">768</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-comment">-- 768ç»´å‘é‡ï¼ˆå¦‚BERTæ¨¡å‹è¾“å‡ºï¼‰</span>
);

<span class="hljs-comment">-- 2. åˆ›å»ºå‘é‡ç´¢å¼•ï¼ˆHNSWç®—æ³•ï¼Œä¼˜åŒ–ç›¸ä¼¼åº¦æŸ¥è¯¢æ€§èƒ½ï¼‰</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_text_vec <span class="hljs-keyword">ON</span> text_vectors <span class="hljs-keyword">USING</span> HNSW (vec vector_cosine_ops);

<span class="hljs-comment">-- 3. æ’å…¥å‘é‡æ•°æ®ï¼ˆæ¨¡æ‹ŸBERTç”Ÿæˆçš„å‘é‡ï¼‰</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> text_vectors <span class="hljs-keyword">VALUES</span> (
    <span class="hljs-number">1</span>,
    <span class="hljs-string">'é‡‘ä»“æ•°æ®åº“æ”¯æŒå¤šæ¨¡æ•°æ®ä¸€ä½“åŒ–å­˜å‚¨'</span>,
    <span class="hljs-string">'[0.123, 0.456, ..., 0.789]'</span> <span class="hljs-comment">-- 768ç»´å‘é‡çœç•¥</span>
);

<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> text_vectors <span class="hljs-keyword">VALUES</span> (
    <span class="hljs-number">2</span>,
    <span class="hljs-string">'å›½äº§æ•°æ®åº“é¢†å†›è€…æ¨å‡ºèåˆæ¶æ„'</span>,
    <span class="hljs-string">'[0.234, 0.567, ..., 0.890]'</span>
);

<span class="hljs-comment">-- 4. å‘é‡è¯­ä¹‰æ£€ç´¢ï¼ˆæŸ¥è¯¢ä¸ç›®æ ‡æ–‡æœ¬æœ€ç›¸ä¼¼çš„3æ¡è®°å½•ï¼‰</span>
<span class="hljs-comment">-- ç›®æ ‡æ–‡æœ¬ï¼š"é‡‘ä»“æ¨å‡ºå¤šæ¨¡èåˆæ•°æ®åº“æ¶æ„"ï¼ˆæ¨¡æ‹Ÿå…¶å‘é‡ï¼‰</span>
<span class="hljs-keyword">SELECT</span> 
    id,
    content,
    vector_cosine_distance(vec, <span class="hljs-string">'[0.189, 0.512, ..., 0.834]'</span>) <span class="hljs-keyword">AS</span> similarity <span class="hljs-comment">-- è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦</span>
<span class="hljs-keyword">FROM</span> text_vectors
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> similarity <span class="hljs-keyword">ASC</span> <span class="hljs-comment">-- ç›¸ä¼¼åº¦è¶Šå°è¶Šç›¸ä¼¼</span>
LIMIT <span class="hljs-number">3</span>;
</code></pre>
<h3 data-id="heading-9">3. å¤šåœºæ™¯ä¸€èµ·å¤„ç†ï¼šä¸ç®¡ä»€ä¹ˆä¸šåŠ¡éœ€æ±‚éƒ½èƒ½è¦†ç›–</h3>
<p>é‡‘ä»“æ•°æ®åº“èƒ½åŒæ—¶å¤„ç†OLTPï¼ˆäº¤æ˜“ï¼‰ã€OLAPï¼ˆåˆ†æï¼‰ã€æµå¤„ç†ã€AIæ¨ç†è¿™äº›åœºæ™¯ï¼Œä¸ç”¨æŠŠç³»ç»Ÿæ‹†åˆ†å¼€ï¼Œå°±èƒ½å®ç°å®æ—¶å†³ç­–ã€‚</p>
<h4 data-id="heading-10">å®é™…ç”¨ä¾‹6ï¼šå®æ—¶äº¤æ˜“å’Œå®æ—¶åˆ†æä¸€èµ·æŸ¥</h4>
<p>æŸé›¶å”®ä¼ä¸šæƒ³å®æ—¶æŸ¥â€œåº“å­˜ä¸è¶³10ä»¶ï¼Œä¸”è¿‘7å¤©é”€é‡å‰50çš„å•†å“â€ï¼Œç”¨é‡‘ä»“çš„HTAPæ··åˆæŸ¥è¯¢åŠŸèƒ½ï¼Œä¸€æ¡SQLå°±æå®šäº†ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 1. åˆ›å»ºå•†å“è¡¨ï¼ˆæ”¯æŒäº¤æ˜“åœºæ™¯ï¼‰</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> products (
    product_id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY,
    product_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    stock <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>, <span class="hljs-comment">-- å®æ—¶åº“å­˜ï¼ˆOLTPå­—æ®µï¼‰</span>
    category <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>)
);

<span class="hljs-comment">-- 2. åˆ›å»ºé”€å”®æµæ°´è¡¨ï¼ˆæ—¶åºæ•°æ®ï¼Œæ”¯æŒåˆ†æåœºæ™¯ï¼‰</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> sales_flow (
    flow_id BIGSERIAL <span class="hljs-keyword">PRIMARY</span> KEY,
    product_id <span class="hljs-type">INT</span> <span class="hljs-keyword">REFERENCES</span> products(product_id),
    sale_time <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    sale_num <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    sale_amount <span class="hljs-type">NUMERIC</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>)
);

<span class="hljs-comment">-- 3. HTAPæ··åˆæŸ¥è¯¢ï¼ˆå®æ—¶åº“å­˜è¿‡æ»¤+è¿‘7å¤©é”€é‡åˆ†æï¼‰</span>
<span class="hljs-keyword">SELECT</span> 
    p.product_id,
    p.product_name,
    p.stock,
    <span class="hljs-built_in">SUM</span>(s.sale_num) <span class="hljs-keyword">AS</span> <span class="hljs-number">7</span>d_sale_num <span class="hljs-comment">-- è¿‘7å¤©é”€é‡ï¼ˆOLAPåˆ†æï¼‰</span>
<span class="hljs-keyword">FROM</span> products p
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> sales_flow s 
    <span class="hljs-keyword">ON</span> p.product_id <span class="hljs-operator">=</span> s.product_id 
    <span class="hljs-keyword">AND</span> s.sale_time <span class="hljs-operator">&gt;=</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-operator">-</span> <span class="hljs-type">INTERVAL</span> <span class="hljs-string">'7 days'</span>
<span class="hljs-keyword">WHERE</span> p.stock <span class="hljs-operator">&lt;</span> <span class="hljs-number">10</span> <span class="hljs-comment">-- å®æ—¶åº“å­˜è¿‡æ»¤ï¼ˆOLTPäº¤æ˜“å­—æ®µï¼‰</span>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> p.product_id, p.product_name, p.stock
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-number">7</span>d_sale_num <span class="hljs-keyword">DESC</span>
LIMIT <span class="hljs-number">50</span>;
</code></pre>
<h3 data-id="heading-11">4. é›†ä¸­å’Œåˆ†å¸ƒä¸€èµ·ç”¨ï¼šä¸ç®¡ä¸šåŠ¡å¤§å°éƒ½èƒ½é€‚é…</h3>
<p>é‡‘ä»“æ•°æ®åº“æ”¯æŒä¸»å¤‡ã€è¯»å†™åˆ†ç¦»ã€åˆ†å¸ƒå¼è¿™äº›éƒ¨ç½²æ¨¡å¼ï¼Œä¸šåŠ¡å°çš„æ—¶å€™ç”¨é›†ä¸­å¼ï¼Œä¸šåŠ¡å¤§äº†å°±æ‰©æˆåˆ†å¸ƒå¼ï¼Œç‰¹åˆ«çµæ´»ã€‚ä¸‹é¢ç»™å¤§å®¶çœ‹ä¸ªåˆ†å¸ƒå¼éƒ¨ç½²çš„å®é™…æ¡ˆä¾‹ã€‚</p>
<h4 data-id="heading-12">å®é™…ç”¨ä¾‹7ï¼šæŒ‰åŒºåŸŸåˆ†ç‰‡çš„åˆ†å¸ƒå¼åˆ†è¡¨</h4>
<p>æœ‰ä¸ªç‰©æµä¼ä¸šè¦å­˜å…¨å›½çš„ç‰©æµè®¢å•æ•°æ®ï¼ŒæŒ‰â€œåŒºåŸŸâ€åˆ†ç‰‡éƒ¨ç½²åˆ†å¸ƒå¼é›†ç¾¤ï¼Œæ•°æ®è‡ªåŠ¨åˆ†åˆ°ä¸åŒèŠ‚ç‚¹ï¼ŒæŸ¥è¯¢çš„æ—¶å€™ä¹Ÿä¸ç”¨ç®¡åˆ†ç‰‡ï¼Œç›´æ¥æŸ¥å°±è¡Œï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 1. åˆ›å»ºåˆ†å¸ƒå¼åˆ†è¡¨è§„åˆ™ï¼ˆæŒ‰regionå­—æ®µåˆ†ç‰‡ï¼‰</span>
<span class="hljs-keyword">CREATE</span> SHARDING TABLESPACE ts_shard1 <span class="hljs-keyword">WITH</span> (LOCATION <span class="hljs-operator">=</span> <span class="hljs-string">'shard1_host:5432'</span>);
<span class="hljs-keyword">CREATE</span> SHARDING TABLESPACE ts_shard2 <span class="hljs-keyword">WITH</span> (LOCATION <span class="hljs-operator">=</span> <span class="hljs-string">'shard2_host:5432'</span>);

<span class="hljs-comment">-- 2. åˆ›å»ºåˆ†å¸ƒå¼è¡¨ï¼ˆæŒ‰regionå“ˆå¸Œåˆ†ç‰‡ï¼‰</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> logistics_orders (
    order_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY</span> KEY,
    region <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>, <span class="hljs-comment">-- åˆ†ç‰‡é”®ï¼šååŒ—ã€åä¸œã€åå—ç­‰</span>
    consignee <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    create_time <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>
) 
SHARDING <span class="hljs-keyword">BY</span> HASH (region) <span class="hljs-comment">-- å“ˆå¸Œåˆ†ç‰‡ç­–ç•¥</span>
SHARDING TABLESPACES (ts_shard1, ts_shard2); <span class="hljs-comment">-- åˆ†ç‰‡å­˜å‚¨èŠ‚ç‚¹</span>

<span class="hljs-comment">-- 3. æ’å…¥æ•°æ®ï¼ˆè‡ªåŠ¨è·¯ç”±åˆ°å¯¹åº”åˆ†ç‰‡ï¼‰</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> logistics_orders <span class="hljs-keyword">VALUES</span> (
    <span class="hljs-number">30001</span>,
    <span class="hljs-string">'ååŒ—'</span>,
    <span class="hljs-string">'Li Si'</span>,
    <span class="hljs-string">'2025-02-10 14:30:00'</span>
); <span class="hljs-comment">-- è‡ªåŠ¨è·¯ç”±åˆ°ts_shard1</span>

<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> logistics_orders <span class="hljs-keyword">VALUES</span> (
    <span class="hljs-number">30002</span>,
    <span class="hljs-string">'åä¸œ'</span>,
    <span class="hljs-string">'Wang Wu'</span>,
    <span class="hljs-string">'2025-02-10 15:45:00'</span>
); <span class="hljs-comment">-- è‡ªåŠ¨è·¯ç”±åˆ°ts_shard2</span>

<span class="hljs-comment">-- 4. åˆ†å¸ƒå¼æŸ¥è¯¢ï¼ˆé€æ˜è·¨åˆ†ç‰‡æŸ¥è¯¢ï¼‰</span>
<span class="hljs-keyword">SELECT</span> region, <span class="hljs-built_in">COUNT</span>(order_id) <span class="hljs-keyword">AS</span> order_count
<span class="hljs-keyword">FROM</span> logistics_orders
<span class="hljs-keyword">WHERE</span> create_time <span class="hljs-operator">&gt;=</span> <span class="hljs-string">'2025-02-01'</span>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> region;
</code></pre>
<h3 data-id="heading-13">5. å¼€å‘å’Œè¿ç»´ä¸€èµ·ç®¡ï¼šåˆçœæˆæœ¬åˆææ•ˆç‡</h3>
<p>é‡‘ä»“æ•°æ®åº“æœ‰KStudioï¼ˆå¼€å‘å·¥å…·ï¼‰å’ŒKOPSï¼ˆè¿ç»´å¹³å°ï¼‰ï¼Œå¼€å‘å’Œè¿ç»´èƒ½æ‰“é€šï¼Œä¸ç”¨å„è‡ªä¸ºæ”¿ã€‚ä¸‹é¢ç»™å¤§å®¶çœ‹ä¸ªè‡ªåŠ¨åŒ–è¿ç»´çš„è„šæœ¬æ¡ˆä¾‹ã€‚</p>
<h4 data-id="heading-14">å®é™…ç”¨ä¾‹8ï¼šè‡ªåŠ¨å¤‡ä»½æ•°æ®åº“çš„è„šæœ¬</h4>
<p>æœ‰ä¸ªä¼ä¸šæƒ³æ¯å¤©å‡Œæ™¨3ç‚¹è‡ªåŠ¨å¤‡ä»½æ•°æ®åº“ï¼Œè¿˜å¾—è‡ªåŠ¨æ¸…ç†7å¤©å‰çš„æ—§å¤‡ä»½ï¼Œç”¨KOPSçš„è„šæœ¬å¾ˆå¿«å°±å®ç°äº†è‡ªåŠ¨åŒ–ï¼š</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">#</span><span class="bash">!/bin/bash</span>
<span class="hljs-meta prompt_"># </span><span class="bash">é‡‘ä»“KOPSè‡ªåŠ¨åŒ–å¤‡ä»½è„šæœ¬ï¼ˆå…¼å®¹Linuxç¯å¢ƒï¼‰</span>
<span class="hljs-meta prompt_">
# </span><span class="bash">é…ç½®å‚æ•°</span>
DB_NAME="production_db"
BACKUP_DIR="/data/kingbase/backup"
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_FILE="${BACKUP_DIR}/${DB_NAME}_${DATE}.dmp"
RETENTION_DAYS=7
<span class="hljs-meta prompt_">
# </span><span class="bash">1. åˆ›å»ºå¤‡ä»½ç›®å½•</span>
mkdir -p ${BACKUP_DIR}
<span class="hljs-meta prompt_">
# </span><span class="bash">2. æ‰§è¡Œå…¨é‡å¤‡ä»½ï¼ˆä½¿ç”¨é‡‘ä»“åŸç”Ÿå¤‡ä»½å·¥å…·ï¼‰</span>
ksql -U sysdba -d ${DB_NAME} -c "BACKUP DATABASE ${DB_NAME} TO '${BACKUP_FILE}' WITH COMPRESSION 6;"
<span class="hljs-meta prompt_">
# </span><span class="bash">3. æ£€æŸ¥å¤‡ä»½æ˜¯å¦æˆåŠŸ</span>
if [ $? -eq 0 ]; then
    echo "[$DATE] å¤‡ä»½æˆåŠŸï¼š${BACKUP_FILE}" &gt;&gt; ${BACKUP_DIR}/backup_log.txt
else
    echo "[$DATE] å¤‡ä»½å¤±è´¥" &gt;&gt; ${BACKUP_DIR}/backup_log.txt
    exit 1
fi
<span class="hljs-meta prompt_">
# </span><span class="bash">4. æ¸…ç†è¿‡æœŸå¤‡ä»½ï¼ˆä¿ç•™7å¤©å†…æ•°æ®ï¼‰</span>
find ${BACKUP_DIR} -name "${DB_NAME}_*.dmp" -mtime +${RETENTION_DAYS} -delete
echo "[$DATE] å·²æ¸…ç†${RETENTION_DAYS}å¤©å‰çš„æ—§å¤‡ä»½" &gt;&gt; ${BACKUP_DIR}/backup_log.txt
</code></pre>
<h4 data-id="heading-15">å®é™…ç”¨ä¾‹9ï¼šAIè¾…åŠ©ä¼˜åŒ–SQL</h4>
<p>ç”¨KStudioå¼€å‘çš„æ—¶å€™ï¼Œé‡åˆ°å†™å¾—ä¸å¥½çš„SQLï¼Œä¸ç”¨è‡ªå·±è´¹åŠ²ä¼˜åŒ–ï¼ŒAIèƒ½è‡ªåŠ¨æ”¹æˆé«˜æ•ˆçš„ç‰ˆæœ¬ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- åŸå§‹ä½æ•ˆSQLï¼ˆæœªèµ°ç´¢å¼•ï¼Œå…¨è¡¨æ‰«æï¼‰</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders 
<span class="hljs-keyword">WHERE</span> create_time <span class="hljs-keyword">BETWEEN</span> <span class="hljs-string">'2025-01-01'</span> <span class="hljs-keyword">AND</span> <span class="hljs-string">'2025-01-31'</span>
<span class="hljs-keyword">AND</span> order_status <span class="hljs-operator">=</span> <span class="hljs-string">'PAID'</span>;

<span class="hljs-comment">-- KStudio AIä¼˜åŒ–åSQLï¼ˆè‡ªåŠ¨æ·»åŠ ç´¢å¼•æç¤ºï¼Œä¼˜åŒ–è¿‡æ»¤é¡ºåºï¼‰</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-comment">/*+ INDEX(orders idx_orders_create_time_status) */</span> <span class="hljs-comment">-- AIæ¨èç´¢å¼•</span>
    order_id, user_id, total_amount
<span class="hljs-keyword">FROM</span> orders 
<span class="hljs-keyword">WHERE</span> order_status <span class="hljs-operator">=</span> <span class="hljs-string">'PAID'</span> <span class="hljs-comment">-- å…ˆè¿‡æ»¤ç­‰å€¼æ¡ä»¶</span>
<span class="hljs-keyword">AND</span> create_time <span class="hljs-keyword">BETWEEN</span> <span class="hljs-string">'2025-01-01'</span> <span class="hljs-keyword">AND</span> <span class="hljs-string">'2025-01-31'</span>; <span class="hljs-comment">-- å†è¿‡æ»¤èŒƒå›´æ¡ä»¶</span>

<span class="hljs-comment">-- AIåŒæ—¶ç”Ÿæˆç´¢å¼•åˆ›å»ºè¯­å¥</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_orders_create_time_status 
<span class="hljs-keyword">ON</span> orders (order_status, create_time)
INCLUDE (order_id, user_id, total_amount); <span class="hljs-comment">-- è¦†ç›–ç´¢å¼•ï¼Œé¿å…å›è¡¨</span>
</code></pre>
<h2 data-id="heading-16">ä¸‰ã€è¡Œä¸šé‡Œæ€ä¹ˆç”¨ï¼šäº”ä¸ªä¸€ä½“åŒ–çš„å®é™…ä»·å€¼</h2>
<p>é‡‘ä»“â€œäº”ä¸ªä¸€ä½“åŒ–â€æ¶æ„å·²ç»åœ¨å¾ˆå¤šè¡Œä¸šç”¨èµ·æ¥äº†ï¼Œä¸‹é¢ç»™å¤§å®¶åˆ†äº«5ä¸ªå…¸å‹çš„è½åœ°åœºæ™¯ï¼Œçœ‹çœ‹å®é™…ç”¨ç€æ•ˆæœæ€ä¹ˆæ ·ï¼š</p>
<h3 data-id="heading-17">1. èƒ½æºè¡Œä¸šï¼šæ™ºèƒ½ç”µç½‘è°ƒåº¦ç³»ç»Ÿ</h3>
<ul>
<li><strong>å®é™…éœ€æ±‚</strong>ï¼šè¦å®æ—¶å¤„ç†å…¨å›½26ä¸ªçœ1000å¤šä¸ªèŠ‚ç‚¹çš„ç”µç½‘æ—¶åºç›‘æ§æ•°æ®ï¼Œæ¯ç§’éƒ½æœ‰10ä¸‡å¤šæ¡æ•°æ®è¿›æ¥ï¼Œè¿˜å¾—æŠŠGISåœ°ç†å®šä½ã€è®¾å¤‡å°è´¦è¿™äº›å…³ç³»æ•°æ®æ”¾åœ¨ä¸€èµ·åˆ†æã€‚</li>
<li><strong>ç”¨é‡‘ä»“çš„æ–¹æ¡ˆ</strong>ï¼š
<ul>
<li>å¤šæ¨¡å­˜å‚¨ï¼šæŠŠç”µç½‘è´Ÿè·çš„æ—¶åºæ•°æ®ã€å˜ç”µç«™ä½ç½®çš„GISæ•°æ®ã€è®¾å¤‡ä¿¡æ¯çš„å…³ç³»æ•°æ®æ”¾åœ¨ä¸€èµ·å­˜ï¼›</li>
<li>åˆ†å¸ƒå¼æ¶æ„ï¼šæŒ‰çœä»½åˆ†ç‰‡éƒ¨ç½²ï¼Œèƒ½æ‰©å±•åˆ°16ä¸ªè®¡ç®—èŠ‚ç‚¹ï¼›</li>
<li>å®é™…æ•ˆæœï¼šæŸ¥æ•°æ®å»¶è¿Ÿä¸åˆ°1.5ç§’ï¼Œç³»ç»Ÿå·²ç»ç¨³å®šè·‘äº†16å¹´ï¼Œå­˜å‚¨æˆæœ¬çœäº†60%ã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-18">2. é‡‘èè¡Œä¸šï¼šåŸºé‡‘TAç³»ç»Ÿ</h3>
<ul>
<li><strong>å®é™…éœ€æ±‚</strong>ï¼šæƒ³æ¢æ‰Oracleæ•°æ®åº“ï¼Œæ¯å¤©è¦å¤„ç†ç™¾ä¸‡çº§çš„åŸºé‡‘äº¤æ˜“è®¢å•ï¼Œè¿˜å¾—å®æ—¶ç®—å‡€å€¼ã€åˆ†æå†å²äº¤æ˜“æ•°æ®ã€‚</li>
<li><strong>ç”¨é‡‘ä»“çš„æ–¹æ¡ˆ</strong>ï¼š
<ul>
<li>å¤šè¯­æ³•å…¼å®¹ï¼šOracleçš„å­˜å‚¨è¿‡ç¨‹ä¸ç”¨æ”¹å°±èƒ½è¿è¿‡æ¥ï¼ŒTPCCæ€§èƒ½èƒ½åˆ°220ä¸‡tpmcï¼›</li>
<li>HTAPä¸€ä½“åŒ–ï¼šäº¤æ˜“è®¢å•å’Œå‡€å€¼åˆ†æåœ¨ä¸€ä¸ªåº“é‡Œå¤„ç†ï¼Œæ•°æ®å»¶è¿Ÿä¸åˆ°100msï¼›</li>
<li>å®é™…æ•ˆæœï¼šè¿ç§»æ—¶é—´å°‘äº†ä¸€åŠï¼Œè¿ç»´æˆæœ¬é™äº†40%ï¼Œç°åœ¨å·²ç»æ”¯æŒ130å¤šå®¶é‡‘èæœºæ„çš„æ ¸å¿ƒä¸šåŠ¡ã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-19">3. äº¤é€šè¡Œä¸šï¼šå‡ºç§Ÿè½¦è½¨è¿¹ç›‘æ§ç³»ç»Ÿ</h3>
<ul>
<li><strong>å®é™…éœ€æ±‚</strong>ï¼šè¦å­˜10ä¸‡è¾†å‡ºç§Ÿè½¦çš„å®æ—¶è½¨è¿¹æ•°æ®ï¼Œæ¯å¤©å¾—æœ‰10äº¿å¤šæ¡ï¼Œè¿˜å¾—æ”¯æŒâ€œæŒ‰æ—¶é—´å’Œç©ºé—´æŸ¥+åˆ†æè¿è§„æƒ…å†µâ€ã€‚</li>
<li><strong>ç”¨é‡‘ä»“çš„æ–¹æ¡ˆ</strong>ï¼š
<ul>
<li>æ—¶åº+GISèåˆï¼šè½¨è¿¹æ•°æ®æŒ‰æ—¶é—´åˆ†åŒºï¼ŒåŠ ä¸ŠR-Treeç©ºé—´ç´¢å¼•ï¼ŒæŸ¥5å…¬é‡ŒèŒƒå›´å†…çš„æ•°æ®ä¸åˆ°500msï¼›</li>
<li>åˆ†å¸ƒå¼åˆ†ç‰‡ï¼šæŒ‰åŒºåŸŸå­˜æ•°æ®ï¼Œèƒ½æ‰©å±•åˆ°32ä¸ªå­˜å‚¨èŠ‚ç‚¹ï¼›</li>
<li>å®é™…æ•ˆæœï¼šæŸ¥è¯¢é€Ÿåº¦å¿«äº†10å€ï¼Œå­˜å‚¨æˆæœ¬çœäº†80%ï¼Œæ¯å¤©èƒ½æ”¯æ’‘200å¤šä¸‡æ¬¡è½¨è¿¹æŸ¥è¯¢ã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-20">4. åŒ»ç–—è¡Œä¸šï¼šåŒ»é™¢HISç³»ç»Ÿ</h3>
<ul>
<li><strong>å®é™…éœ€æ±‚</strong>ï¼šè¦å­˜æ‚£è€…çš„ç”µå­ç—…å†ï¼ˆæ–‡æœ¬ï¼‰ã€æ£€æŸ¥æŠ¥å‘Šï¼ˆJSONï¼‰ã€å½±åƒæ•°æ®ï¼ˆå‘é‡ï¼‰ï¼Œå¤šä¸ªç§‘å®¤è¦å…±äº«æ•°æ®ï¼Œè¿˜å¾—ä¿æŠ¤æ‚£è€…éšç§ã€‚</li>
<li><strong>ç”¨é‡‘ä»“çš„æ–¹æ¡ˆ</strong>ï¼š
<ul>
<li>å¤šæ¨¡å­˜å‚¨ï¼šæŠŠæ‚£è€…åŸºæœ¬ä¿¡æ¯çš„å…³ç³»æ•°æ®ã€æ£€æŸ¥æŠ¥å‘Šçš„JSONæ•°æ®ã€å½±åƒç‰¹å¾çš„å‘é‡æ•°æ®æ”¾åœ¨ä¸€èµ·ç®¡ï¼›</li>
<li>é«˜å®‰å…¨ç‰¹æ€§ï¼šæ•°æ®åŠ å¯†ã€åŠ¨æ€è„±æ•ï¼Œèƒ½æ»¡è¶³ç­‰ä¿å››çº§çš„è¦æ±‚ï¼›</li>
<li>å®é™…æ•ˆæœï¼šå·²ç»åœ¨301åŒ»é™¢è¿™äº›ä¸‰ç”²åŒ»é™¢ç”¨èµ·æ¥äº†ï¼ŒæŸ¥æ•°æ®æ•ˆç‡å¿«äº†8å€ï¼Œéšç§ä¿æŠ¤å®Œå…¨ç¬¦åˆè§„å®šã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-21">5. æ”¿åŠ¡è¡Œä¸šï¼šåŸå¸‚åº”æ€¥ç®¡ç†ç³»ç»Ÿ</h3>
<ul>
<li><strong>å®é™…éœ€æ±‚</strong>ï¼šè¦æŠŠå…¬å®‰ã€äº¤é€šã€æ¶ˆé˜²è¿™äº›å¤šä¸ªéƒ¨é—¨çš„æ•°æ®æ•´åˆèµ·æ¥ï¼Œé‡åˆ°çªå‘äº‹ä»¶èƒ½å®æ—¶å“åº”ï¼Œè¿˜èƒ½åˆ†æå†å²æ•°æ®ã€‚</li>
<li><strong>ç”¨é‡‘ä»“çš„æ–¹æ¡ˆ</strong>ï¼š
<ul>
<li>å¼€å‘è¿ç»´ä¸€ä½“åŒ–ï¼šç”¨KStudioå¿«é€ŸåšæŠ¥è¡¨ï¼Œç”¨KOPSè‡ªåŠ¨ç›‘æ§ç³»ç»ŸçŠ¶æ€ï¼›</li>
<li>è·¨å¤šäº‘éƒ¨ç½²ï¼šä¸€ä¸ªé›†ç¾¤èƒ½è·¨æ”¿åŠ¡äº‘å’Œç§æœ‰äº‘éƒ¨ç½²ï¼Œæ•°æ®åŒæ­¥ä¸åˆ°30ç§’ï¼›</li>
<li>å®é™…æ•ˆæœï¼šçªå‘äº‹ä»¶å“åº”æ—¶é—´ç¼©åˆ°5åˆ†é’Ÿå†…ï¼Œå¤šéƒ¨é—¨æ•°æ®æ•´åˆæ•ˆç‡æäº†60%ã€‚</li>
</ul>
</li>
</ul>
<h2 data-id="heading-22">å››ã€æœ€åè¯´å‡ å¥ï¼šèåˆæ‰èƒ½è®©æ•°æ®æ›´æœ‰ä»·å€¼</h2>
<p>æ•°å­—åŒ–è½¬å‹è¯´ç™½äº†å°±æ˜¯è¦æŠŠæ•°æ®çš„ä»·å€¼å‘æŒ¥å‡ºæ¥ï¼Œè€Œæ•°æ®åº“æ˜¯ç®¡æ•°æ®çš„æ ¸å¿ƒï¼Œæ¶æ„å¥½ä¸å¥½ï¼Œç›´æ¥å½±å“æ•°æ®ä»·å€¼èƒ½ä¸èƒ½å¿«é€Ÿå…‘ç°ã€‚é‡‘ä»“çš„â€œäº”ä¸ªä¸€ä½“åŒ–â€æ¶æ„ï¼Œä»è¯­æ³•å…¼å®¹ã€å¤šæ¨¡èåˆã€åœºæ™¯è¦†ç›–ã€æ¶æ„å¼¹æ€§ã€è¿ç»´æ™ºèƒ½è¿™äº”ä¸ªæ–¹é¢æ•´åˆï¼ŒæŠŠä¼ ç»Ÿæ•°æ®åº“çš„å„ç§é™åˆ¶éƒ½æ‰“ç ´äº†ã€‚</p>
<p>å¯¹æŠ€æœ¯åŒå­¦æ¥è¯´ï¼Œè¿™æ„å‘³ç€ä¸ç”¨å­¦å¥½å‡ å¥—æ•°æ®åº“è¯­æ³•ï¼Œä¸ç”¨å†™å¤æ‚çš„è·¨åº“ä»£ç ï¼Œä¹Ÿä¸ç”¨æ“å¿ƒæ¶æ„æ‰©å±•ä¼šä¸ä¼šä¸å…¼å®¹â€”â€”ä¸€å¥—ç³»ç»Ÿã€ä¸€å¥—ä»£ç ï¼Œä¸ç®¡ä»€ä¹ˆä¸šåŠ¡åœºæ™¯éƒ½èƒ½è¦†ç›–åˆ°ã€‚
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63671fd7641e4cfdb3d28e38593baf06~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGNMZWlnaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763426253&amp;x-signature=h4Vve4RayUVlDwvvNsutvOv5kmY%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<p>ä»¥åAIæŠ€æœ¯å’Œæ•°æ®åº“ä¼šç»“åˆå¾—æ›´ç´§å¯†ï¼Œé‡‘ä»“ä¹Ÿä¼šç»§ç»­æ·±åŒ–â€œäº”ä¸ªä¸€ä½“åŒ–â€çš„èƒ½åŠ›ï¼Œç ”ç©¶æ™ºèƒ½åˆ†ç‰‡ã€å¼¹æ€§ä¼¸ç¼©ã€å¤šæ¨¡æ€èåˆè¿™äº›æ–°æ–¹å‘ã€‚ä½œä¸ºå›½äº§æ•°æ®åº“çš„æ ‡æ†ï¼Œé‡‘ä»“ä¸€ç›´æƒ³ç€â€œè®©ä¸­å›½æ•°æ®è·‘åœ¨ä¸­å›½å¼•æ“ä¸Šâ€ï¼Œå¸Œæœ›èƒ½å¸®æ›´å¤šä¼ä¸šç®¡å¥½æ•°æ®ã€çœæˆæœ¬ææ•ˆç‡ï¼Œç»™æ•°å­—ç»æµé«˜è´¨é‡å‘å±•æ·»æŠŠåŠ›ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä½ çŸ¥é“ç¨‹åºæ€æ ·ä¼˜é›…é€€å‡ºå—ï¼Ÿâ€”â€” Go å¼€å‘ä¸­çš„â€œä½“é¢å‘Šåˆ«â€œå…¨æŒ‡å—]]></title>    <link>https://juejin.cn/post/7570975737634324521</link>    <guid>https://juejin.cn/post/7570975737634324521</guid>    <pubDate>2025-11-11T00:46:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570975737634324521" data-draft-id="7570923924365344831" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä½ çŸ¥é“ç¨‹åºæ€æ ·ä¼˜é›…é€€å‡ºå—ï¼Ÿâ€”â€” Go å¼€å‘ä¸­çš„â€œä½“é¢å‘Šåˆ«â€œå…¨æŒ‡å—"/> <meta itemprop="keywords" content="Go"/> <meta itemprop="datePublished" content="2025-11-11T00:46:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Mgx"/> <meta itemprop="url" content="https://juejin.cn/user/4334740908805417"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä½ çŸ¥é“ç¨‹åºæ€æ ·ä¼˜é›…é€€å‡ºå—ï¼Ÿâ€”â€” Go å¼€å‘ä¸­çš„â€œä½“é¢å‘Šåˆ«â€œå…¨æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4334740908805417/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Mgx
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T00:46:19.000Z" title="Tue Nov 11 2025 00:46:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Mgxæ›°ï¼š</p>
<blockquote>
<p>"èµ°å¾—å¿«ï¼Œä¸å¦‚èµ°å¾—ç¨³ï¼›é€€å¾—æ€¥ï¼Œä¸å¦‚é€€å¾—å‡€ã€‚"</p>
</blockquote>
<p>åœ¨ Go ä¸–ç•Œé‡Œï¼Œå†™ä¸€ä¸ªèƒ½è·‘çš„ç¨‹åºå¾ˆå®¹æ˜“ï¼Œä½†å†™ä¸€ä¸ªèƒ½ä½“é¢é€€å‡ºçš„ç¨‹åºï¼Œå´æ˜¯ä¸€é—¨è‰ºæœ¯ã€‚</p>
<p>ä»Šå¤©ï¼Œæˆ‘ä»¬å°±ä»"Hello, World"çº§åˆ«çš„é€€å‡ºï¼Œä¸€è·¯æ‰“æ€ªå‡çº§ï¼Œç›´åˆ°æå®šå¤šçº§æµæ°´çº¿æ¸…ç©ºé€€å‡ºè¿™ä¸ªç»ˆæ Bossï¼</p>
<h2 data-id="heading-0">ğŸŒ± ä¸€ã€æœ€åŸå§‹çš„é€€å‡ºï¼šè¯´èµ°å°±èµ°ï¼Œä¸ç®¡å‘˜å·¥æ­»æ´»</h2>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"fmt"</span>
	<span class="hljs-string">"time"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	<span class="hljs-comment">// å¯åŠ¨ä¸€ä¸ªåå°"æ‰“å·¥äºº"</span>
	<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
		<span class="hljs-keyword">for</span> {
			fmt.Println(<span class="hljs-string">"æˆ‘åœ¨é»˜é»˜æ¬ç –..."</span>)
			time.Sleep(<span class="hljs-number">1</span> * time.Second)
		}
	}()

	time.Sleep(<span class="hljs-number">3</span> * time.Second)
	fmt.Println(<span class="hljs-string">"è€æ¿è¯´ä¸‹ç­äº†ï¼"</span>)
	<span class="hljs-comment">// ä¸»ç¨‹åºç›´æ¥é€€å‡ºï¼Œæ‰“å·¥äººè¢«å¼ºåˆ¶"è’¸å‘"</span>
}
</code></pre>
<p><strong>è¾“å‡ºï¼š</strong></p>
<pre><code class="hljs language-text" lang="text">æˆ‘åœ¨é»˜é»˜æ¬ç –...
æˆ‘åœ¨é»˜é»˜æ¬ç –...
æˆ‘åœ¨é»˜é»˜æ¬ç –...
è€æ¿è¯´ä¸‹ç­äº†ï¼
ï¼ˆç¨‹åºç»“æŸï¼Œåå° goroutine è¢«æ— æƒ…æ€æ­»ï¼‰
</code></pre>
<p>âŒ <strong>é—®é¢˜</strong>ï¼šåå°ä»»åŠ¡å¯èƒ½æ­£åœ¨å†™æ–‡ä»¶ã€å‘è¯·æ±‚ã€å­˜æ•°æ®åº“â€¦â€¦ä½ ä¸€èµ°ï¼Œä»–å°±"å·¥ä¼¤"äº†ï¼</p>
<h2 data-id="heading-1">âœ… äºŒã€åˆçº§ä¼˜é›…ï¼šç”¨ channel æ‰“ä¸ªæ‹›å‘¼</h2>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"fmt"</span>
	<span class="hljs-string">"time"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	done := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">bool</span>)

	<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
		<span class="hljs-keyword">for</span> {
			<span class="hljs-keyword">select</span> {
			<span class="hljs-keyword">case</span> &lt;-done:
				fmt.Println(<span class="hljs-string">"æ”¶åˆ°ä¸‹ç­é€šçŸ¥ï¼Œæ­£åœ¨æ”¶æ‹¾æ¡Œé¢..."</span>)
				<span class="hljs-keyword">return</span> <span class="hljs-comment">// ä½“é¢é€€å‡º</span>
			<span class="hljs-keyword">default</span>:
				fmt.Println(<span class="hljs-string">"ç»§ç»­æ¬ç –..."</span>)
				time.Sleep(<span class="hljs-number">1</span> * time.Second)
			}
		}
	}()

	time.Sleep(<span class="hljs-number">3</span> * time.Second)
	<span class="hljs-built_in">close</span>(done) <span class="hljs-comment">// å‘é€"ä¸‹ç­"ä¿¡å·</span>
	time.Sleep(<span class="hljs-number">1</span> * time.Second) <span class="hljs-comment">// ç­‰å®ƒæ”¶æ‹¾å®Œ</span>
	fmt.Println(<span class="hljs-string">"å…¨å‘˜ä¸‹ç­ï¼Œå…³é—¨ï¼"</span>)
}
</code></pre>
<p><strong>è¾“å‡ºï¼š</strong></p>
<pre><code class="hljs language-text" lang="text">ç»§ç»­æ¬ç –...
ç»§ç»­æ¬ç –...
ç»§ç»­æ¬ç –...
æ”¶åˆ°ä¸‹ç­é€šçŸ¥ï¼Œæ­£åœ¨æ”¶æ‹¾æ¡Œé¢...
å…¨å‘˜ä¸‹ç­ï¼Œå…³é—¨ï¼
</code></pre>
<p>âœ… <strong>è¿›æ­¥äº†ï¼</strong> ä½† <code>time.Sleep(1 * time.Second)</code> å¤ªéšæ„â€”â€”ä¸‡ä¸€å®ƒæ”¶æ‹¾è¦ 2 ç§’å‘¢ï¼Ÿ</p>
<h2 data-id="heading-2">ğŸ§± ä¸‰ã€ä¸­çº§ä¼˜é›…ï¼šç”¨ WaitGroup ç­‰æ‰€æœ‰äººä¸‹ç­</h2>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"fmt"</span>
	<span class="hljs-string">"sync"</span>
	<span class="hljs-string">"time"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	<span class="hljs-keyword">var</span> wg sync.WaitGroup
	done := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">bool</span>)

	<span class="hljs-comment">// æ‹›å‹Ÿ 3 ä¸ªæ‰“å·¥äºº</span>
	<span class="hljs-keyword">for</span> i := <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">3</span>; i++ {
		wg.Add(<span class="hljs-number">1</span>)
		<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(id <span class="hljs-type">int</span>)</span></span> {
			<span class="hljs-keyword">defer</span> wg.Done()
			<span class="hljs-keyword">for</span> {
				<span class="hljs-keyword">select</span> {
				<span class="hljs-keyword">case</span> &lt;-done:
					fmt.Printf(<span class="hljs-string">"æ‰“å·¥äºº %dï¼šæ”¶åˆ°ï¼æ­£åœ¨å…³ç”µè„‘...\n"</span>, id)
					<span class="hljs-keyword">return</span>
				<span class="hljs-keyword">default</span>:
					fmt.Printf(<span class="hljs-string">"æ‰“å·¥äºº %dï¼šæ¬ç –ä¸­...\n"</span>, id)
					time.Sleep(<span class="hljs-number">800</span> * time.Millisecond)
				}
			}
		}(i)
	}

	time.Sleep(<span class="hljs-number">3</span> * time.Second)
	<span class="hljs-built_in">close</span>(done)
	wg.Wait() <span class="hljs-comment">// è€å¿ƒç­‰æ‰€æœ‰äººå…³ç”µè„‘</span>
	fmt.Println(<span class="hljs-string">"åŠå…¬å®¤ç¯ç­äº†ï¼ŒçœŸä¼˜é›…ï¼"</span>)
}
</code></pre>
<p><strong>è¾“å‡ºï¼š</strong></p>
<pre><code class="hljs language-text" lang="text">æ‰“å·¥äºº 1ï¼šæ¬ç –ä¸­...
æ‰“å·¥äºº 2ï¼šæ¬ç –ä¸­...
æ‰“å·¥äºº 3ï¼šæ¬ç –ä¸­...
...
æ‰“å·¥äºº 2ï¼šæ”¶åˆ°ï¼æ­£åœ¨å…³ç”µè„‘...
æ‰“å·¥äºº 1ï¼šæ”¶åˆ°ï¼æ­£åœ¨å…³ç”µè„‘...
æ‰“å·¥äºº 3ï¼šæ”¶åˆ°ï¼æ­£åœ¨å…³ç”µè„‘...
åŠå…¬å®¤ç¯ç­äº†ï¼ŒçœŸä¼˜é›…ï¼
</code></pre>
<p>âœ… <strong>ç¨³äº†ï¼</strong> ä½†ç°å®ä¸–ç•Œä¸­ï¼Œç¨‹åºå¾€å¾€ä¸æ˜¯è‡ªå·±æƒ³é€€å°±é€€â€”â€”ç”¨æˆ·ä¼šæŒ‰ Ctrl+Cï¼ŒK8s ä¼šå‘ SIGTERMï¼</p>
<h2 data-id="heading-3">ğŸ“¡ å››ã€çœŸå®ä¸–ç•Œï¼šç›‘å¬ç³»ç»Ÿä¿¡å·ï¼ˆCtrl+C ä¹Ÿä¸æ…Œï¼‰</h2>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"fmt"</span>
	<span class="hljs-string">"os"</span>
	<span class="hljs-string">"os/signal"</span>
	<span class="hljs-string">"syscall"</span>
	<span class="hljs-string">"time"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	<span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªä¿¡å·æ¥æ”¶å™¨</span>
	sigCh := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> os.Signal, <span class="hljs-number">1</span>)
	signal.Notify(sigCh, os.Interrupt, syscall.SIGTERM)

	done := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">bool</span>)
	<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
		<span class="hljs-keyword">for</span> {
			<span class="hljs-keyword">select</span> {
			<span class="hljs-keyword">case</span> &lt;-done:
				fmt.Println(<span class="hljs-string">"åå°ä»»åŠ¡ï¼šæ”¶åˆ°æŒ‡ä»¤ï¼Œæ­£åœ¨ä¿å­˜è¿›åº¦..."</span>)
				<span class="hljs-keyword">return</span>
			<span class="hljs-keyword">default</span>:
				fmt.Println(<span class="hljs-string">"åå°ä»»åŠ¡ï¼šè¿è¡Œä¸­..."</span>)
				time.Sleep(<span class="hljs-number">1</span> * time.Second)
			}
		}
	}()

	fmt.Println(<span class="hljs-string">"ç¨‹åºå·²å¯åŠ¨ï¼ŒæŒ‰ Ctrl+C ä¼˜é›…é€€å‡º"</span>)

	&lt;-sigCh <span class="hljs-comment">// é˜»å¡ç­‰å¾…ä¿¡å·ï¼ˆæ¯”å¦‚ Ctrl+Cï¼‰</span>
	fmt.Println(<span class="hljs-string">"\næ£€æµ‹åˆ°é€€å‡ºä¿¡å·ï¼å‡†å¤‡ä½“é¢å‘Šåˆ«..."</span>)

	<span class="hljs-built_in">close</span>(done)
	time.Sleep(<span class="hljs-number">1</span> * time.Second) <span class="hljs-comment">// ç®€å•ç­‰å¾…ï¼ˆåé¢ä¼šä¼˜åŒ–ï¼‰</span>
	fmt.Println(<span class="hljs-string">"å†è§ï¼Œä¸–ç•Œï¼ğŸ‘‹"</span>)
}
</code></pre>
<p><strong>æ“ä½œï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash">$ go run main.go
ç¨‹åºå·²å¯åŠ¨ï¼ŒæŒ‰ Ctrl+C ä¼˜é›…é€€å‡º
åå°ä»»åŠ¡ï¼šè¿è¡Œä¸­...
^C
æ£€æµ‹åˆ°é€€å‡ºä¿¡å·ï¼å‡†å¤‡ä½“é¢å‘Šåˆ«...
åå°ä»»åŠ¡ï¼šæ”¶åˆ°æŒ‡ä»¤ï¼Œæ­£åœ¨ä¿å­˜è¿›åº¦...
å†è§ï¼Œä¸–ç•Œï¼ğŸ‘‹
</code></pre>
<p>âœ… <strong>ç»ˆäºåƒç”Ÿäº§ç¯å¢ƒäº†ï¼</strong> ä½† time.Sleep è¿˜æ˜¯ä¸å¤Ÿä¸“ä¸šâ€¦â€¦</p>
<h2 data-id="heading-4">ğŸŒŸ äº”ã€Go å®˜æ–¹æ¨èï¼šç”¨ context ç»Ÿä¸€ç®¡ç†å–æ¶ˆ</h2>
<p>context æ˜¯ Go å¹¶å‘ç¼–ç¨‹çš„"ç‘å£«å†›åˆ€"ï¼Œå°¤å…¶é€‚åˆä¼ é€’å–æ¶ˆä¿¡å·ã€‚</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"context"</span>
	<span class="hljs-string">"fmt"</span>
	<span class="hljs-string">"os"</span>
	<span class="hljs-string">"os/signal"</span>
	<span class="hljs-string">"syscall"</span>
	<span class="hljs-string">"time"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">worker</span><span class="hljs-params">(ctx context.Context, id <span class="hljs-type">int</span>)</span></span> {
	<span class="hljs-keyword">for</span> {
		<span class="hljs-keyword">select</span> {
		<span class="hljs-keyword">case</span> &lt;-ctx.Done():
			fmt.Printf(<span class="hljs-string">"æ‰“å·¥äºº %dï¼šæ”¶åˆ°å–æ¶ˆæŒ‡ä»¤ï¼ŒåŸå› ï¼š%vï¼Œæ­£åœ¨é€€å‡º...\n"</span>, id, ctx.Err())
			<span class="hljs-keyword">return</span>
		<span class="hljs-keyword">default</span>:
			fmt.Printf(<span class="hljs-string">"æ‰“å·¥äºº %dï¼šåŠªåŠ›å·¥ä½œä¸­...\n"</span>, id)
			time.Sleep(<span class="hljs-number">1</span> * time.Second)
		}
	}
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	ctx, cancel := context.WithCancel(context.Background())
	<span class="hljs-keyword">defer</span> cancel()

	<span class="hljs-comment">// å¯åŠ¨ 3 ä¸ªæ‰“å·¥äºº</span>
	<span class="hljs-keyword">for</span> i := <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">3</span>; i++ {
		<span class="hljs-keyword">go</span> worker(ctx, i)
	}

	<span class="hljs-comment">// ç›‘å¬ç³»ç»Ÿä¿¡å·</span>
	sigCh := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> os.Signal, <span class="hljs-number">1</span>)
	signal.Notify(sigCh, os.Interrupt, syscall.SIGTERM)
	&lt;-sigCh

	fmt.Println(<span class="hljs-string">"\nå‡†å¤‡ä¼˜é›…é€€å‡º..."</span>)
	cancel() <span class="hljs-comment">// é€šçŸ¥æ‰€æœ‰æ‰“å·¥äºº</span>

	<span class="hljs-comment">// ç­‰å¾…ï¼ˆå®é™…é¡¹ç›®ä¸­åº”ç»“åˆ WaitGroupï¼‰</span>
	time.Sleep(<span class="hljs-number">2</span> * time.Second)
	fmt.Println(<span class="hljs-string">"å…¨å‘˜å®‰å…¨æ’¤ç¦»ï¼"</span>)
}
</code></pre>
<p>âœ… <strong>æ ‡å‡†åšæ³•ï¼</strong> ä½†æ³¨æ„ï¼šcontext çš„è¯­ä¹‰æ˜¯"å°½å¿«å–æ¶ˆ"ï¼Œä¸ä¿è¯å¤„ç†å®Œå‰©ä½™ä»»åŠ¡ï¼</p>
<h2 data-id="heading-5">ğŸš¨ å…­ã€é«˜èƒ½é¢„è­¦ï¼šæµæ°´çº¿ä¸­çš„"æ•°æ®å¡ä½"é™·é˜±ï¼</h2>
<p>å‡è®¾ä½ æœ‰è¿™æ ·ä¸€ä¸ªä¸‰çº§æµæ°´çº¿ï¼š</p>
<pre><code class="hljs language-text" lang="text">Producer â†’ [10ä¸ªä¸­é—´å·¥äºº] â†’ [3ä¸ªæœ€ç»ˆæ¶ˆè´¹è€…]
</code></pre>
<p>å¦‚æœæ‰€æœ‰ goroutine éƒ½ç›‘å¬ ctx.Done() å¹¶ç«‹å³é€€å‡ºï¼Œchannel é‡Œè¿˜æ²¡å¤„ç†çš„æ•°æ®å°±ä¸¢äº†ï¼</p>
<p>ğŸ’¥ <strong>è¿™å°±æ˜¯"ä¼ªä¼˜é›…é€€å‡º"</strong>â€”â€”è¡¨é¢ä½“é¢ï¼Œå®åˆ™ä¸¢æ•°æ®ï¼</p>
<h2 data-id="heading-6">ğŸ† ä¸ƒã€ç»ˆææ–¹æ¡ˆï¼šä¸¤é˜¶æ®µé€€å‡º + æµæ°´çº¿æ’ç©º</h2>
<p>æˆ‘ä»¬è¦åšåˆ°ï¼š</p>
<ul>
<li>åœæ­¢ç”Ÿäº§ï¼ˆæºå¤´åˆ‡æ–­ï¼‰</li>
<li>è®©æµæ°´çº¿è‡ªç„¶è·‘å®Œï¼ˆæ¸…ç©º channelï¼‰</li>
<li>ä¸ä¸¢ä¸€ä¸ªæ•°æ®</li>
</ul>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"fmt"</span>
	<span class="hljs-string">"os"</span>
	<span class="hljs-string">"os/signal"</span>
	<span class="hljs-string">"sync"</span>
	<span class="hljs-string">"syscall"</span>
	<span class="hljs-string">"time"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	<span class="hljs-comment">// ä¸¤çº§ç¼“å†²é€šé“</span>
	ch1 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>, <span class="hljs-number">100</span>) <span class="hljs-comment">// å­˜åŸå§‹ä»»åŠ¡</span>
	ch2 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>, <span class="hljs-number">100</span>) <span class="hljs-comment">// å­˜å¤„ç†ç»“æœ</span>

	<span class="hljs-keyword">var</span> wg sync.WaitGroup

	<span class="hljs-comment">// ========== ç¬¬ä¸€é˜¶æ®µï¼šç”Ÿäº§è€…ï¼ˆå”¯ä¸€å“åº”é€€å‡ºä¿¡å·ï¼‰==========</span>
	stopProducing := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>{})
	wg.Add(<span class="hljs-number">1</span>)
	<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
		<span class="hljs-keyword">defer</span> wg.Done()
		<span class="hljs-keyword">defer</span> <span class="hljs-built_in">close</span>(ch1) <span class="hljs-comment">// ç”Ÿäº§ç»“æŸï¼Œå…³é—­é€šé“ï¼Œé€šçŸ¥ä¸‹æ¸¸"æ²¡æ–°æ´»äº†"</span>

		<span class="hljs-keyword">for</span> taskID := <span class="hljs-number">1</span>; taskID &lt;= <span class="hljs-number">50</span>; taskID++ {
			<span class="hljs-keyword">select</span> {
			<span class="hljs-keyword">case</span> &lt;-stopProducing:
				fmt.Println(<span class="hljs-string">"ç”Ÿäº§è€…ï¼šæ”¶åˆ°åœå·¥æŒ‡ä»¤ï¼Œä¸å†æ¥æ–°å•ï¼"</span>)
				<span class="hljs-keyword">return</span>
			<span class="hljs-keyword">case</span> ch1 &lt;- taskID:
				fmt.Printf(<span class="hljs-string">"ç”Ÿäº§è€…ï¼šå‘å¸ƒä»»åŠ¡ %d\n"</span>, taskID)
				time.Sleep(<span class="hljs-number">50</span> * time.Millisecond)
			}
		}
		fmt.Println(<span class="hljs-string">"ç”Ÿäº§è€…ï¼šä»Šæ—¥ä»»åŠ¡å…¨éƒ¨å‘å¸ƒå®Œæ¯•ï¼"</span>)
	}()

	<span class="hljs-comment">// ========== ç¬¬äºŒé˜¶æ®µï¼š10ä¸ªä¸­é—´å·¥äººï¼ˆä¸å“åº”å–æ¶ˆï¼åªé é€šé“å…³é—­é€€å‡ºï¼‰==========</span>
	stage1Wg := &amp;sync.WaitGroup{}
	stage1Wg.Add(<span class="hljs-number">10</span>)
	<span class="hljs-keyword">for</span> i := <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">10</span>; i++ {
		<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(id <span class="hljs-type">int</span>)</span></span> {
			<span class="hljs-keyword">defer</span> stage1Wg.Done()
			<span class="hljs-comment">// å…³é”®ï¼šè¿™é‡Œ **ä¸ç›‘å¬ä»»ä½•å–æ¶ˆä¿¡å·**ï¼</span>
			<span class="hljs-comment">// åªè¦ ch1 æ²¡å…³ï¼Œå°±ä¸€ç›´å¹²</span>
			<span class="hljs-keyword">for</span> task := <span class="hljs-keyword">range</span> ch1 {
				result := task * <span class="hljs-number">2</span>
				fmt.Printf(<span class="hljs-string">"ä¸­é—´å·¥äºº %dï¼šå¤„ç†ä»»åŠ¡ %d â†’ äº§å‡º %d\n"</span>, id, task, result)
				ch2 &lt;- result
			}
			fmt.Printf(<span class="hljs-string">"ä¸­é—´å·¥äºº %dï¼šch1 å·²å…³ï¼Œä¸‹ç­ï¼\n"</span>, id)
		}(i)
	}

	<span class="hljs-comment">// æ‰€æœ‰ä¸­é—´å·¥äººå¹²å®Œåï¼Œå…³é—­ ch2</span>
	<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
		stage1Wg.Wait()
		<span class="hljs-built_in">close</span>(ch2)
		fmt.Println(<span class="hljs-string">"æ‰€æœ‰ä¸­é—´å·¥äººä¸‹ç­ï¼Œch2 å…³é—­ï¼"</span>)
	}()

	<span class="hljs-comment">// ========== ç¬¬ä¸‰é˜¶æ®µï¼š3ä¸ªæœ€ç»ˆæ¶ˆè´¹è€… ==========</span>
	wg.Add(<span class="hljs-number">3</span>)
	<span class="hljs-keyword">for</span> i := <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">3</span>; i++ {
		<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(id <span class="hljs-type">int</span>)</span></span> {
			<span class="hljs-keyword">defer</span> wg.Done()
			<span class="hljs-comment">// åŒæ ·ï¼Œåªé  range è‡ªåŠ¨é€€å‡º</span>
			<span class="hljs-keyword">for</span> result := <span class="hljs-keyword">range</span> ch2 {
				fmt.Printf(<span class="hljs-string">"æœ€ç»ˆæ¶ˆè´¹è€… %dï¼šæ”¶åˆ°æˆå“ %d\n"</span>, id, result)
				time.Sleep(<span class="hljs-number">30</span> * time.Millisecond)
			}
			fmt.Printf(<span class="hljs-string">"æœ€ç»ˆæ¶ˆè´¹è€… %dï¼šæ— æ–°è´§ï¼Œæ”¶å·¥ï¼\n"</span>, id)
		}(i)
	}

	<span class="hljs-comment">// ========== ç›‘å¬ç³»ç»Ÿé€€å‡ºä¿¡å· ==========</span>
	sigCh := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> os.Signal, <span class="hljs-number">1</span>)
	signal.Notify(sigCh, os.Interrupt, syscall.SIGTERM)
	&lt;-sigCh
	fmt.Println(<span class="hljs-string">"\nâš ï¸ æ”¶åˆ°ç³»ç»Ÿé€€å‡ºä¿¡å·ï¼"</span>)

	<span class="hljs-comment">// åªé€šçŸ¥ç”Ÿäº§è€…åœå·¥ï¼Œ**ä¸å¼ºåˆ¶ä¸­æ–­å·¥äºº**</span>
	<span class="hljs-built_in">close</span>(stopProducing)

	<span class="hljs-comment">// ========== ç­‰å¾…æ•´ä¸ªæµæ°´çº¿æ’ç©º ==========</span>
	fmt.Println(<span class="hljs-string">"æ­£åœ¨ç­‰å¾…æµæ°´çº¿æ¸…ç©ºæ‰€æœ‰ä»»åŠ¡..."</span>)
	wg.Wait()

	fmt.Println(<span class="hljs-string">"âœ… æ‰€æœ‰ä»»åŠ¡å¤„ç†å®Œæ¯•ï¼Œç¨‹åºä½“é¢é€€å‡ºï¼"</span>)
}
</code></pre>
<p><strong>æ¨¡æ‹Ÿä¸­é€”æŒ‰ Ctrl+C çš„è¾“å‡ºï¼š</strong></p>
<pre><code class="hljs language-text" lang="text">ç”Ÿäº§è€…ï¼šå‘å¸ƒä»»åŠ¡ 1
ä¸­é—´å·¥äºº 3ï¼šå¤„ç†ä»»åŠ¡ 1 â†’ äº§å‡º 2
æœ€ç»ˆæ¶ˆè´¹è€… 1ï¼šæ”¶åˆ°æˆå“ 2
...
ç”Ÿäº§è€…ï¼šå‘å¸ƒä»»åŠ¡ 18
^C
âš ï¸ æ”¶åˆ°ç³»ç»Ÿé€€å‡ºä¿¡å·ï¼
ç”Ÿäº§è€…ï¼šæ”¶åˆ°åœå·¥æŒ‡ä»¤ï¼Œä¸å†æ¥æ–°å•ï¼
ä¸­é—´å·¥äºº 5ï¼šå¤„ç†ä»»åŠ¡ 18 â†’ äº§å‡º 36
æœ€ç»ˆæ¶ˆè´¹è€… 2ï¼šæ”¶åˆ°æˆå“ 36
...
ä¸­é—´å·¥äºº 1ï¼šch1 å·²å…³ï¼Œä¸‹ç­ï¼
æ‰€æœ‰ä¸­é—´å·¥äººä¸‹ç­ï¼Œch2 å…³é—­ï¼
æœ€ç»ˆæ¶ˆè´¹è€… 3ï¼šæ— æ–°è´§ï¼Œæ”¶å·¥ï¼
âœ… æ‰€æœ‰ä»»åŠ¡å¤„ç†å®Œæ¯•ï¼Œç¨‹åºä½“é¢é€€å‡ºï¼
</code></pre>
<p>âœ… <strong>å®Œç¾ï¼</strong> å³ä½¿ä¸­é€”è¢«å«åœï¼Œä¹Ÿä¿è¯äº†ï¼š</p>
<ul>
<li>ä¸å†æ¥æ–°ä»»åŠ¡</li>
<li>å·²æ¥ä»»åŠ¡å…¨éƒ¨å®Œæˆ</li>
<li>ä¸ panicã€ä¸æ³„æ¼ goroutine</li>
</ul>
<h2 data-id="heading-7">ğŸ›¡ï¸ å…«ã€é˜²å¡æ­»å…œåº•ï¼šåŠ ä¸ª"è¶…æ—¶ä¿é™©"</h2>
<p>è™½ç„¶æˆ‘ä»¬å¸Œæœ›æ’ç©ºï¼Œä½†ä¸‡ä¸€æŸä¸ªä»»åŠ¡å¡æ­»å‘¢ï¼ŸåŠ ä¸ª 30 ç§’è¶…æ—¶ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// åœ¨ wg.Wait() å‰åŠ è¶…æ—¶ä¿æŠ¤</span>
done := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>{})
<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
	wg.Wait()
	<span class="hljs-built_in">close</span>(done)
}()

<span class="hljs-keyword">select</span> {
<span class="hljs-keyword">case</span> &lt;-done:
	fmt.Println(<span class="hljs-string">"ä¼˜é›…é€€å‡ºæˆåŠŸï¼"</span>)
<span class="hljs-keyword">case</span> &lt;-time.After(<span class="hljs-number">30</span> * time.Second):
	fmt.Println(<span class="hljs-string">"âŒ è¶…æ—¶ï¼å¼ºåˆ¶é€€å‡ºï¼ˆå¯èƒ½æœ‰æ•°æ®æœªå¤„ç†ï¼‰"</span>)
	os.Exit(<span class="hljs-number">1</span>)
}
</code></pre>
<h2 data-id="heading-8">ğŸ“œ ä¹ã€ä¼˜é›…é€€å‡ºé»„é‡‘æ³•åˆ™ï¼ˆèƒŒä¸‹æ¥ï¼ï¼‰</h2>






























<table><thead><tr><th>è§’è‰²</th><th>æ˜¯å¦å“åº” ctx.Done()</th><th>é€€å‡ºæ–¹å¼</th></tr></thead><tbody><tr><td>ç”Ÿäº§è€… / è¯·æ±‚å…¥å£</td><td>âœ… æ˜¯</td><td>æ”¶åˆ°ä¿¡å·ååœæ­¢æ¥æ”¶æ–°ä»»åŠ¡</td></tr><tr><td>ä¸­é—´å¤„ç†æµæ°´çº¿</td><td>âŒ å¦</td><td>åªå“åº” channel å…³é—­ï¼Œæ’ç©ºç¼“å†²</td></tr><tr><td>æœ€ç»ˆæ¶ˆè´¹è€…</td><td>âŒ å¦</td><td>for range è‡ªåŠ¨é€€å‡º</td></tr><tr><td>ä¸»ç¨‹åº</td><td>âœ… æ˜¯ï¼ˆç”¨äºè§¦å‘ç”Ÿäº§è€…åœæ­¢ï¼‰</td><td>WaitGroup + è¶…æ—¶å…œåº•</td></tr></tbody></table>
<h2 data-id="heading-9">ğŸ‰ ç»“è¯­ï¼šä¼˜é›…ï¼Œæ˜¯ä¸€ç§ä¿®å…»</h2>
<p>åœ¨ Go çš„ä¸–ç•Œé‡Œï¼Œä¼˜é›…é€€å‡ºä¸æ˜¯"èƒ½ä¸èƒ½"ï¼Œè€Œæ˜¯"æ„¿ä¸æ„¿"ã€‚</p>
<p>å¤šèŠ± 10 è¡Œä»£ç ï¼Œå°±èƒ½é¿å…çº¿ä¸Šäº‹æ•…ã€æ•°æ®ä¸¢å¤±ã€åŠå¤œå‘Šè­¦â€”â€”è¿™æ³¢ä¸äºï¼</p>
<blockquote>
<p>è®°ä½ï¼šçœŸæ­£çš„ä¼˜é›…ï¼Œä¸æ˜¯èµ°å¾—å¿«ï¼Œè€Œæ˜¯èµ°å¾—å¹²å‡€ã€‚
è½»è½»çš„æˆ‘èµ°äº†ï¼Œæ­£å¦‚æˆ‘è½»è½»çš„æ¥ï¼Œ
æŒ¥æŒ¥æ‰‹ï¼Œä¸å¸¦èµ°ä¸€ç‰‡äº‘å½©ï¼
... ...</p>
</blockquote>
<h2 data-id="heading-10">å¾€æœŸéƒ¨åˆ†æ–‡ç« åˆ—è¡¨</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fjjgtmgx%2Farticle%2Fdetails%2F154353774%3Fspm%3D1011.2415.3001.5331" target="_blank" title="https://blog.csdn.net/jjgtmgx/article/details/154353774?spm=1011.2415.3001.5331" ref="nofollow noopener noreferrer">ç”¨golangè§£æ•‘PDFæ–‡ä»¶ä¸­çš„å›¾ç‰‡åªè¦200è¡Œä»£ç ï¼</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fjjgtmgx%2Farticle%2Fdetails%2F154342421%3Fspm%3D1011.2415.3001.5331" target="_blank" title="https://blog.csdn.net/jjgtmgx/article/details/154342421?spm=1011.2415.3001.5331" ref="nofollow noopener noreferrer">200KB çš„çƒ¦æ¼ï¼ŒGo è¯­è¨€ 20 åˆ†é’Ÿæå®šï¼â€”â€” ä¸€ä¸ªç¨‹åºå‘˜çš„å›¾ç‰‡å‹ç¼©è‡ªæ•‘æŒ‡å—</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fjjgtmgx%2Farticle%2Fdetails%2F154280615%3Fspm%3D1011.2415.3001.5331" target="_blank" title="https://blog.csdn.net/jjgtmgx/article/details/154280615?spm=1011.2415.3001.5331" ref="nofollow noopener noreferrer">ä»â€œCPU çƒ§å¼€æ°´â€œåˆ°ä¼˜é›…æš‚åœï¼šGo é‡Œ sync.Cond çš„æ­£ç¡®æ‰“å¼€æ–¹å¼</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fjjgtmgx%2Farticle%2Fdetails%2F154239651%3Fspm%3D1011.2415.3001.5331" target="_blank" title="https://blog.csdn.net/jjgtmgx/article/details/154239651?spm=1011.2415.3001.5331" ref="nofollow noopener noreferrer">æ—¶ç§»ä¸–æ˜“ï¼Œç¯¡æ”¹å¤©æœºï¼šå¾ä»¥ Go è¯­ä»¤ Windows æ–‡ä»¶â€œè¿”è€è¿˜ç«¥â€œè®°</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fjjgtmgx%2Farticle%2Fdetails%2F154215423%3Fspm%3D1011.2415.3001.5331" target="_blank" title="https://blog.csdn.net/jjgtmgx/article/details/154215423?spm=1011.2415.3001.5331" ref="nofollow noopener noreferrer">golangåœ†é˜µåˆ—å›¾è®°ï¼šå¤©çµçµåœ°çµçµå›¾æ ‡æ’åœ†å½¢</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fjjgtmgx%2Farticle%2Fdetails%2F154171637%3Fspm%3D1011.2415.3001.5331" target="_blank" title="https://blog.csdn.net/jjgtmgx/article/details/154171637?spm=1011.2415.3001.5331" ref="nofollow noopener noreferrer">golangè§£å›¾è®°</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fjjgtmgx%2Farticle%2Fdetails%2F154112977%3Fspm%3D1011.2415.3001.5331" target="_blank" title="https://blog.csdn.net/jjgtmgx/article/details/154112977?spm=1011.2415.3001.5331" ref="nofollow noopener noreferrer">ä» 4.8 ç§’åˆ° 0.25 ç§’ï¼šæˆ‘æ˜¯å¦‚ä½•æŠŠ Go æ­£åˆ™åŒ¹é…æé€Ÿ 19 å€çš„ï¼Ÿ</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fjjgtmgx%2Farticle%2Fdetails%2F154079297%3Fspm%3D1011.2415.3001.5331" target="_blank" title="https://blog.csdn.net/jjgtmgx/article/details/154079297?spm=1011.2415.3001.5331" ref="nofollow noopener noreferrer">ç”¨ Go æ‰‹æ“ä¸€ä¸ªå†…ç½‘ DNS æœåŠ¡å™¨ï¼šä»æ­¤å‘Šåˆ« IP åœ°å€ï¼Œç”¨åŸŸåç•…æ¸¸å®¶åº­ç½‘ç»œï¼</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fjjgtmgx%2Farticle%2Fdetails%2F154063291%3Fspm%3D1011.2415.3001.5331" target="_blank" title="https://blog.csdn.net/jjgtmgx/article/details/154063291?spm=1011.2415.3001.5331" ref="nofollow noopener noreferrer">æˆ‘ç”¨Goå†™äº†ä¸ªåå®¹é“æ¸¸æˆï¼Œæ›¹æ“ç»ˆäºä¸ç”¨å†æ±‚å…³ç¾½äº†ï¼</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fjjgtmgx%2Farticle%2Fdetails%2F154006419%3Fspm%3D1011.2415.3001.5331" target="_blank" title="https://blog.csdn.net/jjgtmgx/article/details/154006419?spm=1011.2415.3001.5331" ref="nofollow noopener noreferrer">ç”¨ Go æ¥å£æŠŠ Excel å˜æˆæ•°æ®åº“ï¼šä¸€ä¸ªç–¯ç‹‚ä½†å¯è¡Œçš„æƒ³æ³•</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fjjgtmgx%2Farticle%2Fdetails%2F153980901%3Fspm%3D1011.2415.3001.5331" target="_blank" title="https://blog.csdn.net/jjgtmgx/article/details/153980901?spm=1011.2415.3001.5331" ref="nofollow noopener noreferrer">ç©¿å¢™æœ¯å¤§æ­ç§˜ï¼šç”¨ Go æ‰‹æ“ä¸€ä¸ª"å†…ç½‘ç©¿é€"ç¥å™¨ï¼</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fjjgtmgx%2Farticle%2Fdetails%2F153966485%3Fspm%3D1011.2124.3001.6209" target="_blank" title="https://blog.csdn.net/jjgtmgx/article/details/153966485?spm=1011.2124.3001.6209" ref="nofollow noopener noreferrer">å¸ƒéš†è¿‡æ»¤å™¨(go)ï¼šä¸€ä¸ªå¯èƒ½çŠ¯é”™ä½†ä»ä¸æ’’è°çš„å†…å­˜å¤§å¸ˆ</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fjjgtmgx%2Farticle%2Fdetails%2F153923507%3Fspm%3D1011.2124.3001.6209" target="_blank" title="https://blog.csdn.net/jjgtmgx/article/details/153923507?spm=1011.2124.3001.6209" ref="nofollow noopener noreferrer">è‡ªç”±é€šè®¯çš„é­”æ³•ï¼šGoä»é›¶å®ç°UDP/P2P èŠå¤©å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fjjgtmgx%2Farticle%2Fdetails%2F153882865%3Fspm%3D1011.2415.3001.5331" target="_blank" title="https://blog.csdn.net/jjgtmgx/article/details/153882865?spm=1011.2415.3001.5331" ref="nofollow noopener noreferrer">Goè¯­è¨€å®ç°çš„ç®€æ˜“è¿œç¨‹ä¼ å±å·¥å…·ï¼šè®©ä½ çš„å±å¹•ã€Œé£ã€èµ·æ¥</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fjjgtmgx%2Farticle%2Fdetails%2F153835711%3Fspm%3D1011.2415.3001.5331" target="_blank" title="https://blog.csdn.net/jjgtmgx/article/details/153835711?spm=1011.2415.3001.5331" ref="nofollow noopener noreferrer">å½“ä½ çš„ç¨‹åºå­¦ä¼šäº†"è¯ˆå°¸"ï¼šGo å®ç° Windows è¿›ç¨‹å®ˆæŠ¤æœ¯</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fjjgtmgx%2Farticle%2Fdetails%2F153815674%3Fspm%3D1011.2124.3001.6209" target="_blank" title="https://blog.csdn.net/jjgtmgx/article/details/153815674?spm=1011.2124.3001.6209" ref="nofollow noopener noreferrer">éªŒè¯ç è¯†åˆ«APIï¼šå‘Šåˆ«æ”¶è´¹æ¥å£ï¼Œè¿æ¥å…è´¹åˆé¤</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fjjgtmgx%2Farticle%2Fdetails%2F153771823%3Fspm%3D1011.2124.3001.6209" target="_blank" title="https://blog.csdn.net/jjgtmgx/article/details/153771823?spm=1011.2124.3001.6209" ref="nofollow noopener noreferrer">ç”¨ Go ç»™ Windows è£…ä¸ª"é¡ºé£è€³"ï¼šä¸¤åˆ†é’Ÿå†™ä¸ªå½•éŸ³å°å·¥å…·</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fjjgtmgx%2Farticle%2Fdetails%2F153727120%3Fspm%3D1011.2124.3001.6209" target="_blank" title="https://blog.csdn.net/jjgtmgx/article/details/153727120?spm=1011.2124.3001.6209" ref="nofollow noopener noreferrer">æ— å¥ˆï¼æˆ‘ç”¨goå†™äº†ä¸ªMySQLæœåŠ¡</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fjjgtmgx%2Farticle%2Fdetails%2F153704418%3Fspm%3D1011.2124.3001.6209" target="_blank" title="https://blog.csdn.net/jjgtmgx/article/details/153704418?spm=1011.2124.3001.6209" ref="nofollow noopener noreferrer">ä½¿ç”¨ Go + govcl å®ç° Windows èµ„æºç®¡ç†å™¨å¿«æ·æ–¹å¼ç®¡ç†å™¨</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fjjgtmgx%2Farticle%2Fdetails%2F153691688%3Fspm%3D1011.2124.3001.6209" target="_blank" title="https://blog.csdn.net/jjgtmgx/article/details/153691688?spm=1011.2124.3001.6209" ref="nofollow noopener noreferrer">ç”¨ Go æ‰‹æ“ä¸€ä¸ª NTP æœåŠ¡ï¼šä»"æ—¶é—´æ··ä¹±"åˆ°"ç²¾å‡†åŒæ­¥"çš„å¥‡å¹»ä¹‹æ—…</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fjjgtmgx%2Farticle%2Fdetails%2F153675992%3Fspm%3D1011.2124.3001.6209" target="_blank" title="https://blog.csdn.net/jjgtmgx/article/details/153675992?spm=1011.2124.3001.6209" ref="nofollow noopener noreferrer">ç”¨ Go æ‰‹æ“ä¸€ä¸ª Java æ„å»ºå·¥å…·ï¼šå½“ IDE ä¸åœ¨èº«è¾¹æ—¶çš„è‡ªæ•‘æŒ‡å—</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fjjgtmgx%2Farticle%2Fdetails%2F153618753%3Fspm%3D1011.2124.3001.6209" target="_blank" title="https://blog.csdn.net/jjgtmgx/article/details/153618753?spm=1011.2124.3001.6209" ref="nofollow noopener noreferrer">æ·±å…¥ç†è§£ Windows å…¨å±€é”®ç›˜é’©å­ï¼ˆHookï¼‰ï¼šæ‹¦æˆª Win é”®çš„ Go å®ç°</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fjjgtmgx%2Farticle%2Fdetails%2F153560110%3Fspm%3D1011.2124.3001.6209" target="_blank" title="https://blog.csdn.net/jjgtmgx/article/details/153560110?spm=1011.2124.3001.6209" ref="nofollow noopener noreferrer">ç”¨ Go è¯­è¨€å®ç°ã€Šå‘¨æ˜“ã€‹å¤§è¡ç­®æ³•èµ·å¦ç¨‹åº</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fjjgtmgx%2Farticle%2Fdetails%2F153535813%3Fspm%3D1011.2124.3001.6209" target="_blank" title="https://blog.csdn.net/jjgtmgx/article/details/153535813?spm=1011.2124.3001.6209" ref="nofollow noopener noreferrer">Go è¯­è¨€400è¡Œä»£ç å®ç° INI é…ç½®æ–‡ä»¶è§£æå™¨ï¼šæ”¯æŒæ³¨é‡Šã€è½¬ä¹‰ä¸ç±»å‹æ¨æ–­</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å­˜å‚¨æ ¸å¿ƒï¼šEXTæ–‡ä»¶ç³»ç»Ÿ]]></title>    <link>https://juejin.cn/post/7570899512783437887</link>    <guid>https://juejin.cn/post/7570899512783437887</guid>    <pubDate>2025-11-11T02:01:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570899512783437887" data-draft-id="7570923924365787199" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å­˜å‚¨æ ¸å¿ƒï¼šEXTæ–‡ä»¶ç³»ç»Ÿ"/> <meta itemprop="keywords" content="Linux"/> <meta itemprop="datePublished" content="2025-11-11T02:01:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¡¬æ ¸å­ç‰™"/> <meta itemprop="url" content="https://juejin.cn/user/676954895557288"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å­˜å‚¨æ ¸å¿ƒï¼šEXTæ–‡ä»¶ç³»ç»Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/676954895557288/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¡¬æ ¸å­ç‰™
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T02:01:31.000Z" title="Tue Nov 11 2025 02:01:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><hr/>
<p>å“ˆå–½ï¼Œæˆ‘æ˜¯å­ç‰™è€å¸ˆï¼Œä¸€ä¸ªæ‰‹å†™è¿‡æ“ä½œç³»ç»Ÿã€ç¼–ç¨‹è¯­è¨€ã€Javaè™šæ‹Ÿæœºã€dockerã€Ubuntuç³»ç»Ÿï¼Œç©é€Windowså†…æ ¸ã€Linuxå†…æ ¸â€¦çš„ç¡¬æ ¸ç”·äºº</p>
<p>è¦æƒ³ç©æ˜ç™½æ–‡ä»¶ç³»ç»Ÿï¼Œå¾—å…ˆç©æ˜ç™½ç£ç›˜åˆ†åŒºç»“æ„ã€‚ä»ç¡¬ç›˜è¯ç”Ÿè‡³ä»Šï¼Œæœ‰ä¸¤ç§ç£ç›˜åˆ†åŒºç»“æ„ï¼šMBRã€GPTï¼Œå¯¹æ­¤ï¼Œå‰é¢å·²ç»å†™æ–‡ç« éå¸¸è¯¦ç»†çš„å‰–æäº†ï¼Œä¸äº†è§£çš„å°ä¼™ä¼´å¯ä»¥å»çœ‹çœ‹ã€ŠMBR VS GPTã€‹</p>
<p>æœ‰äº†å‰é¢çš„åŸºç¡€ï¼Œå°±å¯ä»¥æ¥ç©æ–‡ä»¶ç³»ç»Ÿäº†ã€‚Linuxç³»ç»Ÿè¯ç”Ÿè‡³ä»Šäº†ï¼Œè¯ç”Ÿäº†å“ªäº›æ–‡ä»¶ç³»ç»Ÿå‘¢ï¼Ÿè¿™äº›</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/46f33b7b3acf4a4fbe2f82e411a24426~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56Gs5qC45a2Q54mZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763431291&amp;x-signature=OeI%2FWvewkLoy8q%2Fwp2O8JirtzLs%3D" alt="" loading="lazy"/></p>
<p>PCæˆ–æœåŠ¡å™¨ç«¯ï¼Œç›®å‰ä¸»æµç”¨çš„æ–‡ä»¶ç³»ç»Ÿæ˜¯ext4ã€Btrfsã€XFS</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3efc4e39cc7c4351b32c564047e05cc5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56Gs5qC45a2Q54mZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763431291&amp;x-signature=vIv9Dx%2BSRYF8JFkBeA%2FoBhpz558%3D" alt="" loading="lazy"/></p>
<p>æ¥çœ‹çœ‹å®ƒä»¬çš„å¯¹æ¯”</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7245af739a25492f924766d2bb68d652~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56Gs5qC45a2Q54mZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763431291&amp;x-signature=fJJHQk0505363Zgb%2BJqDzQc58oE%3D" alt="" loading="lazy"/></p>
<p>æœ¬ç¯‡æ–‡ç« ä¸»è¦åˆ†äº«extæ–‡ä»¶ç³»ç»Ÿç›¸å…³çŸ¥è¯†ï¼Œä¸»è¦æ¢è®¨extæ–‡ä»¶ç³»ç»Ÿçš„å‘å±•å²ã€extæ–‡ä»¶ç³»ç»Ÿç»“æ„çš„å˜åŒ–åŠå…¶åŸå› ã€‚XFSã€Btrfsï¼Œåé¢å†™æ–‡ç« åˆ†äº«ã€‚æ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥å…³æ³¨å…¬ä¼—å·ã€ç¡¬æ ¸å­ç‰™ã€‘ï¼Œçœ‹æ›´å¤šè®¡ç®—æœºåº•å±‚ç¡¬æ ¸æ–‡ç« </p>
<p>æœ¬ç¯‡æ–‡ç« ï¼Œenjoy</p>
<h2 data-id="heading-0">EXT1</h2>
<p>åºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸Šå›¾ï¼ŒEXT1æ–‡ä»¶ç³»ç»Ÿç»“æ„ï¼Œé•¿è¿™æ ·</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c45f90d96042434c86db7049a00c21c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56Gs5qC45a2Q54mZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763431291&amp;x-signature=ny8V9nxwBtMifTaLlvZtLoVKLc8%3D" alt="" loading="lazy"/></p>
<p>EXT1å¹¶ä¸æ˜¯ä¸€ä¸ªæ­£å¼å‘å¸ƒçš„æ–‡ä»¶ç³»ç»Ÿï¼Œæ‰€ä»¥å…³äºå®ƒçš„èµ„æ–™éå¸¸å°‘ï¼Œå®ƒçš„ç»“æ„ï¼Œä¹Ÿæ˜¯åæ¥äººæ ¹æ®EXT2çš„ç»“æ„æ¨ç†å‡ºæ¥çš„ï¼Œæ‰€ä»¥è¿™å¼ å›¾ï¼Œåªåšå¯¹æ¯”ç”¨ï¼Œå¸®åŠ©ä½ ç†è§£EXT2æ–‡ä»¶ç³»ç»Ÿç»“æ„</p>
<h2 data-id="heading-1">EXT2</h2>
<p>EXT2æ–‡ä»¶ç³»ç»Ÿçš„ç»“æ„ï¼Œé•¿è¿™æ ·</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5611e168a964f4ca225b794a8247b33~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56Gs5qC45a2Q54mZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763431291&amp;x-signature=sfaIvcvbLQM%2Fx1H74cuz7bCW%2BU4%3D" alt="" loading="lazy"/></p>
<p>EXT2æ–‡ä»¶ç³»ç»Ÿçš„ç»“æ„ï¼Œä¸ºåæ¥çš„æ–‡ä»¶ç³»ç»Ÿç»“æ„çš„è¯ç”Ÿå¥ å®šäº†åŸºç¡€ï¼Œæ˜¯ç†è§£åé¢æ–‡ä»¶ç³»ç»Ÿç»“æ„çš„åŸºç¡€ï¼Œå’±ä»¬æ¥æ·±å…¥æ¢è®¨</p>
<p>EXT2æœ€å¤§çš„ç‰¹è‰²å°±æ˜¯å¼•å…¥äº†å—ç»„ï¼Œä¸ºä»€ä¹ˆè¦å¼•å…¥å—ç»„å‘¢ï¼Ÿçœ‹ChatGPTç»™çš„ç†ç”±</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f43e41410684045a8c25b581e0f7db8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56Gs5qC45a2Q54mZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763431291&amp;x-signature=CiOuM68HSyIHRLh15HlRRUufgvs%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/05ae416a93224c17948fa03973f5f7ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56Gs5qC45a2Q54mZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763431291&amp;x-signature=OL4bB23XUMV5AO3K%2Fsjx8yAhlE0%3D" alt="" loading="lazy"/></p>
<p>ç»¼åˆæ¥è¯´ï¼ŒChatGPTç­”æ¡ˆæƒ³å‘Šè¯‰æˆ‘ä»¬çš„æ˜¯ï¼ŒEXT2å¼•å…¥å—ç»„ï¼Œå…¶ä¸€æ˜¯è§£å†³EXT1æ–‡ä»¶ç³»ç»Ÿå­˜åœ¨çš„ç¼ºé™·ï¼Œå…¶äºŒæ˜¯ä¸ºæœªæ¥å³å°†åˆ°æ¥çš„å¤šæ ¸å¤šçº¿ç¨‹æ—¶ä»£æ‰“ä¸‹æ¶æ„åŸºç¡€</p>
<p>ç§‘æŠ€è¿›åŒ–çš„èŠ‚å¥ä¸€èˆ¬æ˜¯ï¼šéœ€æ±‚å‘ç”Ÿå˜åŒ–ï¼Œå°±æœ‰äººå»ç ”ç©¶å¦‚ä½•è§£å†³ï¼Œå°±å‡ºç°äº†ç†è®ºï¼ŒæåŸºç¡€è®¾æ–½çš„è½¯ä»¶å•†ä¸ç¡¬ä»¶å•†å°±åŸºäºç†è®ºä¸€åŒå»å®ç°ï¼Œè§£å†³è¿™ä¸ªéœ€æ±‚ã€‚æœªæ¥ï¼Œç§‘æŠ€ä¸€å®šè¿˜ä¼šè¿›æ­¥ï¼Œä¸€å®šæœ‰äººç ”ç©¶ç†è®ºï¼Œä¸€å®šæœ‰äººæåŸºç¡€è®¾æ–½ã€‚æ‰€ä»¥ChatGPTé¢„æµ‹ï¼šAIæ—¶ä»£ï¼Œå†™ä¸šåŠ¡ä»£ç çš„coderéœ€æ±‚ä¼šå‡å°‘ï¼Œå†™åŸºç¡€è®¾æ–½ä»£ç çš„coderéœ€æ±‚ä¼šå¢åŠ </p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å®æˆ˜ä¸€ä¸‹ï¼Œç„¶åå†æŠ›å‡ºé—®é¢˜ï¼Œå¼•å‡ºç­”æ¡ˆ</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f9303292e7824f198978ee2eb238fa2c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56Gs5qC45a2Q54mZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763431291&amp;x-signature=Qbo7OoyXXw9PE1d7WLZDpjm4LL0%3D" alt="image.png" loading="lazy"/></p>
<p>æˆ‘åˆ›å»ºäº†ä¸€ä¸ª20Mçš„ç›˜ï¼ŒæŠŠå®ƒå½“æˆä¸€ä¸ªåˆ†åŒºæ¥ç”¨ï¼Œç»™å®ƒæ‰“ä¸ŠEXT2æ–‡ä»¶ç³»ç»Ÿï¼ŒæŸ¥çœ‹</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6493dd5c2730406a8fd0a1356f796401~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56Gs5qC45a2Q54mZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763431291&amp;x-signature=HpHIM7ZVtrzonXHwJzW2JExbIDY%3D" alt="" loading="lazy"/></p>
<p>çœ‹çº¢è‰²åºå·1ä¸2çš„ä½ç½®ï¼Œå½“å—å¤§å°æ˜¯1024Bçš„æ—¶å€™ï¼Œfirst block=1ï¼Œä¸æˆ‘ä»¬å‰é¢è¯´çš„ä¸€è‡´ï¼Œblock=0çš„ä½ç½®æ˜¯boot blockã€‚é‚£å¦‚æœblock sizeæ”¹æˆ2048Bã€4096Bå‘¢ï¼Ÿçœ‹ç»“æœ</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/29b654afb9844cbba38a1e8de2da1feb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56Gs5qC45a2Q54mZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763431291&amp;x-signature=HS4Le3s5IFtTRvP2TinN7p1Nl34%3D" alt="" loading="lazy"/></p>
<p>å¦‚æœæŠŠblock sizeæ”¹ä¸º2048Bï¼Œ4096Bï¼Œfirst block=0ï¼Œä½ æ˜¯ä¸æ˜¯æƒ³é—®ï¼šé‚£boot blockå°±ä¸è¦äº†å—ï¼Ÿéä¹Ÿï¼2048Bã€4096Bä¸æ˜¯åŒ…å«äº†1024Bå—ï¼Œæ‰€ä»¥å¦‚æœæ˜¯2048Bï¼Œè™½ç„¶first block=0ï¼Œä½†æ˜¯æ˜¯ä»ç¬¬1024Bå¼€å§‹ç”¨ï¼Œç›¸å½“äºç©ºå‡ºæ¥äº†1024B</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94c4a685be314cb1b2995309a307bc8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56Gs5qC45a2Q54mZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763431291&amp;x-signature=bLojuhjzIYw5Cly8xHpHPiSR8Pw%3D" alt="" loading="lazy"/></p>
<p>ä¸ºä»€ä¹ˆè¦ä»1024Bå¼€å§‹ç”¨å‘¢ï¼Ÿå› ä¸ºEXT2çš„è®¾è®¡è§„å®šï¼šè¶…çº§å—å¿…é¡»ä»1024Bå¼€å§‹ï¼Œgrubä¹Ÿä¼šå»è¿™ä¸ªåœ°æ–¹è¯»è¶…çº§å—ä¿¡æ¯</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ab5bf546e5ec49b2b9841bb9368e23af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56Gs5qC45a2Q54mZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763431291&amp;x-signature=%2FJiVvVg%2Femko%2FUuJ%2F9mQ%2BCg6Baw%3D" alt="" loading="lazy"/></p>
<p>å†çœ‹ä¸€ä¸ªé—®é¢˜ï¼šè¿™20Mçš„ç›˜ï¼Œè¢«åˆ’åˆ†æˆäº†å‡ ä¸ªå—ç»„å‘¢ï¼Ÿæˆ‘å…ˆä¸è´´ç­”æ¡ˆï¼Œå’±ä»¬æ¥ç®—ä¸€ç®—ï¼šä¸€ä¸ªå—ç»„å å¤šå¤§ç©ºé—´</p>
<p>çº¢è‰²åºå·3ï¼Œæ¯ä¸ªå—ç»„æœ‰8192ä¸ªblockï¼Œæ¯ä¸ªblockçš„sizeæ˜¯1024Kï¼Œä¸¤ä¸ªç›¸ä¹˜ï¼Œç»“æœæ˜¯8Mï¼Œæ‰€ä»¥20Mç¡¬ç›˜ï¼Œè¢«åˆ†æˆäº†3ä¸ªå—ç»„</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d148bb013b834658b3af05d671bf2bfd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56Gs5qC45a2Q54mZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763431291&amp;x-signature=gkHvfZRwjmbGfOMng0Y%2BeXw7Bx8%3D" alt="" loading="lazy"/></p>
<p>8192è¿™ä¸ªæ•°å­—åˆæ˜¯æ€ä¹ˆæ¥çš„å‘¢ï¼Ÿå› ä¸ºblock bitmapå ä¸€ä¸ªblockï¼Œä¸€ä¸ªblockå 1024Bï¼Œæ¯ä¸ªä½æ˜ å°„ä¸€ä¸ªblockï¼Œ1024*8=8192</p>
<p>ç†è®ºä¸Šæ¥è¯´ï¼Œæ¯ä¸ªå—ç»„ä¸­çš„inodeæ•°é‡åº”è¯¥ä¹Ÿæ˜¯8192ï¼Œå› ä¸ºinode bitmapä¹Ÿå ä¸€ä¸ªblockï¼Œä¸çŸ¥é“åº•å±‚æ˜¯æ€ä¹ˆç®—å‡ºæ¥æ˜¯1712çš„ï¼Œä¸ºäº†ChatGPTï¼Œæ²¡ç»™å‡ºæ­£ç¡®çš„ç­”æ¡ˆ</p>
<p>å°±ä»¥æ¯ä¸ªå—ç»„å¯ä»¥ä½¿ç”¨1712ä¸ªinodeæ¥ç®—ï¼Œæ¯ä¸ªinodeå 128Bï¼Œä¸¤ä¸ªç›¸ä¹˜ï¼Œå°±å¾—åˆ°å­˜æ”¾æ‰€æœ‰inodeéœ€è¦214ä¸ªblock</p>
<p>ä¸€ä¸ªå—ç»„ï¼Œå¯ä»¥ç¡®å®šçš„blockä½¿ç”¨æƒ…å†µå¦‚å›¾</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/11cb9d0c28224d9ab9abcb61a286101a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56Gs5qC45a2Q54mZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763431291&amp;x-signature=64cgLaAaDz9q6OYymytDW166jIs%3D" alt="" loading="lazy"/></p>
<p>è¿™ä¹Ÿåªæ˜¯ç”¨äº†297ä¸ªblockï¼Œgroup 0å¯ç”¨å—æ•°æ˜¯ä»312å¼€å§‹çš„ï¼Œä¸­é—´çš„14ä¸ªblockæ˜¯æ€ä¹ˆç”¨æ‰çš„ï¼Œé—®ChatGPT</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94a8b7a067ba4bafa9af80b396bf97b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56Gs5qC45a2Q54mZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763431291&amp;x-signature=esFtqqe%2BLGIFIN%2F736qkLKo1Hto%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/37c1e615455d4b0ca2600437247406a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56Gs5qC45a2Q54mZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763431291&amp;x-signature=%2BL91tlQLzgj5zGJzxHCGx%2F221EM%3D" alt="" loading="lazy"/></p>
<p>è‡³æ­¤ï¼Œæˆ‘èƒ½æƒ³åˆ°çš„å…³äºEXT2æ–‡ä»¶ç³»ç»Ÿçš„å…¨éƒ¨é—®é¢˜åŠç­”æ¡ˆï¼Œå°±å…¨éƒ¨åˆ†äº«ç»™ä½ äº†</p>
<p>å¯¹äº†ext2çš„inodeé•¿è¿™æ ·ï¼Œåˆšå¥½128B</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/96ed5dfecf23419a83ef84c6fe53d7a9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56Gs5qC45a2Q54mZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763431291&amp;x-signature=ZTAXPAkr7qedG8cFJC7LYdxXv%2BE%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">EXT3</h2>
<p>ext3ç›¸æ¯”äºext2ï¼Œæ”¹å˜äº†è¿™äº›</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8969728b113841ef851f35d5c4e4107a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56Gs5qC45a2Q54mZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763431291&amp;x-signature=HCdYGNpGQOCla444UAqIJEaxSwM%3D" alt="" loading="lazy"/></p>
<p>å…¶å®æ ¸å¿ƒçš„æ”¹å˜å°±æ˜¯å¢åŠ äº†æ—¥å¿—ï¼Œåˆ†åŒºç»“æ„æ˜¯æ²¡æœ‰å˜åŒ–çš„ï¼Œå³ä¹Ÿæ˜¯åˆ†æˆå¾ˆå¤šå—ç»„ï¼Œå—ç»„ä¸­çš„ç»“æ„ä¹ŸåŒ…å«é‚£äº›å¦‚è¶…çº§å—ã€ä¸¤ä¸ªä½å›¾ã€æ•°æ®å—â€¦</p>
<p>å…³äºext3çš„æ—¥å¿—åŠŸèƒ½ä»‹ç»</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a3fe2cdbfc8464fa13f840a82012608~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56Gs5qC45a2Q54mZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763431291&amp;x-signature=RwKKJnLxchxrMZgpdwRjQxZXuXc%3D" alt="" loading="lazy"/></p>
<p>ext3çš„æ—¥å¿—æ˜¯éšè—çš„ï¼Œæ™®é€šç”¨æˆ·åœ¨Linuxç³»ç»Ÿä¸­æ˜¯çœ‹ä¸åˆ°çš„ï¼Œåªå…è®¸rootç”¨æˆ·é€šè¿‡debugfså‘½ä»¤æ‰èƒ½çœ‹åˆ°ï¼Œå®ƒæ‰€æœ‰çš„ä¿¡æ¯éƒ½å­˜å‚¨åœ¨inode 8ä¸­ï¼Œå®æˆ˜</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd19fce2cefc46929d22f2b94fe16103~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56Gs5qC45a2Q54mZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763431291&amp;x-signature=ezvv4aay1E4K9HMHqHWFvP5iYHU%3D" alt="image.png" loading="lazy"/></p>
<p>å°±èƒ½çœ‹åˆ°äº†</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be78e553423645a49106ea2f67c0c138~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56Gs5qC45a2Q54mZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763431291&amp;x-signature=zisyKOqhUpDTx1axYeuMZ6RmBVA%3D" alt="" loading="lazy"/></p>
<p>è¦çœ‹æ‡‚è¿™é‡Œé¢çš„ä¿¡æ¯ï¼Œéœ€è¦è¡¥ä¸€ä¸ªçŸ¥è¯†ï¼šinodeä¸­æ˜¯å¦‚ä½•å­˜å‚¨æ•°æ®åº“çš„</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f00e6a906414f50b0f981b64db37ca5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56Gs5qC45a2Q54mZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763431291&amp;x-signature=wlVGECJnMmRU5ZbC5bBRyLBoXWY%3D" alt="" loading="lazy"/></p>
<p>æœ‰äº†è¿™ä¸ªåŸºç¡€ï¼Œå†å»çœ‹ChatGPTçš„ç­”æ¡ˆï¼Œå°±èƒ½çœ‹æ‡‚äº†</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99cd0efd3fcd487a85ada86a64cc8d84~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56Gs5qC45a2Q54mZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763431291&amp;x-signature=%2FYr5y0%2BNKFaUq6LMx15KHOlY9ok%3D" alt="" loading="lazy"/></p>
<p>æ—¥å¿—æ€»å…±å ç”¨1Mç©ºé—´ï¼Œä¸€ä¸ªblockæ˜¯1024Bï¼Œç›¸é™¤ï¼Œç»“æœæ˜¯1024ä¸ªblockï¼Œä½†æ˜¯æ€»å…±ç”¨äº†1029ä¸ªblockï¼Œå¤šå‡ºæ¥çš„5ä¸ªblockæ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿé—´æ¥å—ç”¨çš„</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b78ec22c2ab549a69bc5c1cdb2c6c452~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56Gs5qC45a2Q54mZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763431291&amp;x-signature=kL5frM%2FszAEYuxKqkRWbltSdyew%3D" alt="" loading="lazy"/></p>
<p>ç”»æˆå›¾æ˜¯è¿™æ ·</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f7df27ac1072437ca15b22506bda487f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56Gs5qC45a2Q54mZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763431291&amp;x-signature=WZiK%2Bn0E57in11wlH1heY0jwssw%3D" alt="" loading="lazy"/></p>
<p>ä½ æ˜¯å¦æƒ³é—®ï¼Œä¸ºä»€ä¹ˆä¸€ä¸ªblockåªèƒ½å­˜å‚¨256ä¸ªblockçš„å€¼ï¼Œå› ä¸ºä¸€ä¸ªblockçš„å€¼æ˜¯4Bï¼Œ1024é™¤ä»¥4ç­‰äº256</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/70cf991934f8426b9b495ed186ce8266~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56Gs5qC45a2Q54mZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763431291&amp;x-signature=QBjLOhGKjLqmpRkjQJ4IQLS5U6k%3D" alt="" loading="lazy"/></p>
<p>ext4ä¸ext3æœ€å¤§çš„å·®å¼‚å°±æ˜¯åœ¨è¿™é‡Œï¼Œä½¿ç”¨extentå–ä»£äº†ç›´æ¥å—é—´æ¥å—ç®—æ³•</p>
<h2 data-id="heading-3">EXT4</h2>
<p>æ¥çœ‹çœ‹ext4ä¸ext3çš„å·®å¼‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5580ee60916e4e7ea738e86a2140bfa9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56Gs5qC45a2Q54mZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763431291&amp;x-signature=LUZG4xvqCmBhTxDJJ1Vvjulls5A%3D" alt="" loading="lazy"/></p>
<p>å…¶å®æœ‰ç‚¹åƒæŠŠæ•´å—åˆ†åŒºåˆ†æˆå—ç»„è¿›è¡Œç®¡ç†ï¼Œext4å†å°†å—ç»„åˆ†æˆä¸€ä¸ªä¸ªçš„extentè¿›è¡Œç®¡ç†ã€‚æ¥ä¸‹æ¥çœ‹çœ‹extentå…·ä½“æ˜¯æ€ä¹ˆç©çš„ï¼Œå…ˆçœ‹ä½¿ç”¨æ•°æ®å§</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/zero of=fs20M.img bs=1M count=20
mkfs.ext4 fs20M.img
sudo debugfs fs20M.imgè¿›å…¥äº¤äº’ç•Œé¢
<span class="hljs-built_in">stat</span> &lt;8&gt;
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/27c28bf7db6f462bb49442756fb4ceb0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56Gs5qC45a2Q54mZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763431291&amp;x-signature=IW2moTVW9%2Bd22kUo1WubHj%2FGgjs%3D" alt="" loading="lazy"/></p>
<p>å°±ç›´æ¥åˆ†é…äº†ä¸€æ®µè¿ç»­å—ï¼Œæ²¡æœ‰å¤šä½™çš„åºŸè¯ï¼Œæ²¡æœ‰å¤æ‚çš„ç®—æ³•ï¼Œæ•ˆç‡è‚¯å®šé«˜ï¼Œåº•å±‚æ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿå¦‚å›¾</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/75d03ad051cb4940bf4248baa585c64a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56Gs5qC45a2Q54mZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763431291&amp;x-signature=a01Yk2fEZrIvX2P%2F0gMvbtPxiiA%3D" alt="" loading="lazy"/></p>
<p>å†çœ‹ext4çš„æºç ï¼Œä½ ä¼šå‘ç°æ²¡æœ‰ä¸€ä¸ªå±æ€§ä¸extentæœ‰å…³ï¼Œå®é™…ä¸Šä¹Ÿå­˜å‚¨åœ¨è¿™é‡Œ<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c8246ff2a7746368b631fcdd13a4867~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56Gs5qC45a2Q54mZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763431291&amp;x-signature=858sWxHZNwpKpNitNHSmjf0QEws%3D" alt="" loading="lazy"/></p>
<p>å½“ä½ å¯ç”¨äº†extentï¼Œè¿™ä¸ªä½ç½®å°±ç”¨æ¥å­˜å‚¨extentä¿¡æ¯ã€‚è¿™ä¸ªä½ç½®æœ‰å¤šå¤§å‘¢ï¼Ÿ4*15=60Bï¼Œå¯ä»¥å­˜å‚¨ä¸€ä¸ªheader+4ä¸ªextentï¼Œåˆšå¥½60B</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/153576f50c8541649b78e83e38a32b86~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56Gs5qC45a2Q54mZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763431291&amp;x-signature=Iu1Y7VPJL1lzurcHUT0I4v7HFQI%3D" alt="" loading="lazy"/></p>
<p>é€šè¿‡è¿™ä¸ªå‘½ä»¤å»æŸ¥çœ‹æ˜¯å¦å¯ç”¨äº†extent</p>
<pre><code class="hljs language-perl" lang="perl">dumpe2fs fs20M.img | <span class="hljs-keyword">grep</span> extent
</code></pre>
<p>ä¸€ä¸ªextentèƒ½å…³è”å¤šå¤§ç£ç›˜ç©ºé—´å‘¢ï¼Ÿ32768*1024B=32M</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/15b80248ad2c4918a83380a931c8fe18~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56Gs5qC45a2Q54mZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763431291&amp;x-signature=f8B0K4UT8zV4knZF3Wvpr5jZERg%3D" alt="" loading="lazy"/></p>
<p>ä¸€ä¸ªinodeæœ€å¤šåªèƒ½å…³è”4ä¸ªextentï¼Œä¸€ä¸ªextentæœ€å¤§æ”¯æŒ32Mç£ç›˜ç©ºé—´ï¼Œé‚£ä¸€ä¸ªinodeæœ€å¤šæ”¯æŒ128Mç£ç›˜ç©ºé—´ï¼Œé‚£è¶…è¿‡128Mçš„æ–‡ä»¶æ€ä¹ˆå­˜å‘¢ï¼Ÿè¿™é‡Œå°±ä¼šå‡çº§æˆä¸€æ£µæ ‘</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ec8d6b3bd3be443cb8d6c2100213e08f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56Gs5qC45a2Q54mZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763431291&amp;x-signature=TttadRPg7Ht38sEDWiE3MXmCASE%3D" alt="" loading="lazy"/></p>
<p>å›¾å°±å˜æˆäº†è¿™æ ·</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6393473ff2c4c9b934b5a9e9cf9c3cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56Gs5qC45a2Q54mZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763431291&amp;x-signature=sjvqwn6h%2BB612%2BDF95EpR4LRUxA%3D" alt="" loading="lazy"/></p>
<p>å¦‚æœç©ºé—´è¿˜ä¸å¤Ÿï¼Œè¿˜ä¼šç»§ç»­åˆ†è£‚æˆdepthæ›´æ·±çš„æ ‘ã€‚ç†è®ºä¸Šæ¥è¯´extentæ”¯æŒæ— é™å¤§çš„ç£ç›˜ç©ºé—´ï¼Œå³ä¸€ä¸ªæ–‡ä»¶æ”¯æŒæ— é™å¤§çš„å¤§å°ï¼Œä½†æ˜¯ext4æ–‡ä»¶ç³»ç»Ÿåšäº†é™åˆ¶ï¼Œæ ‘çš„æœ€å¤§depthæ˜¯5</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5cc60b710c6941a3a037b2f1231e5511~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56Gs5qC45a2Q54mZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763431291&amp;x-signature=O03GuUDczrIUAE%2BhumU7l6GBL9E%3D" alt="" loading="lazy"/></p>
<p>æ”¯æŒï¼Œext4çš„extentå°±å…¨éƒ¨è®²å®Œäº†</p>
<p>æœ‰äº†æœ¬ç¯‡æ–‡ç« çš„åŸºç¡€ï¼Œext2ã€ext3ã€ext4çš„æºç ï¼Œä½ çœ‹èµ·æ¥åº”è¯¥å°±ä¸ä¼šå¾ˆè´¹åŠ›äº†ï¼</p>
<p>å¦‚æœä½ æƒ³æ›´å¤šäº†è§£æˆ‘ï¼Œæ¬¢è¿å»æˆ‘å…¬ä¼—å·ã€ç¡¬æ ¸å­ç‰™ã€‘çœ‹æˆ‘ä¹‹å‰çš„æ–‡ç« åŠæˆ‘çš„å¥‹æ–—å†ç¨‹ã€‚ç™½æ‰‹èµ·å®¶ç¨‹åºå‘˜çš„èŒåœºå¿ƒå¾—ï¼Œåº”è¯¥ä¼šå¯¹ä½ æœ‰å¾ˆå¤§å¯å‘</p>
<p>è‹¥æœ‰æ”¶è·ï¼Œå°±ç‚¹ä¸ªèµå§</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[S2B-SQL UPDATE æ›´æ–°æ•°æ®å®Œå…¨æŒ‡å—-99%çš„äººå¿˜è®°WHEREå­å¥ï¼ŒSQLé«˜æ‰‹å´è¿™æ ·å†™ï¼šä»åŸºç¡€è¯­æ³•åˆ°å¤šè¡¨å…³è”çš„æ•°æ®ä¿®æ”¹åˆ©å™¨]]></title>    <link>https://juejin.cn/post/7570984257666433070</link>    <guid>https://juejin.cn/post/7570984257666433070</guid>    <pubDate>2025-11-11T01:20:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570984257666433070" data-draft-id="7570975737634439209" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="S2B-SQL UPDATE æ›´æ–°æ•°æ®å®Œå…¨æŒ‡å—-99%çš„äººå¿˜è®°WHEREå­å¥ï¼ŒSQLé«˜æ‰‹å´è¿™æ ·å†™ï¼šä»åŸºç¡€è¯­æ³•åˆ°å¤šè¡¨å…³è”çš„æ•°æ®ä¿®æ”¹åˆ©å™¨"/> <meta itemprop="keywords" content="SQL,æ•°æ®åº“"/> <meta itemprop="datePublished" content="2025-11-11T01:20:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="éƒ‘æ©èµ"/> <meta itemprop="url" content="https://juejin.cn/user/2883382090934252"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            S2B-SQL UPDATE æ›´æ–°æ•°æ®å®Œå…¨æŒ‡å—-99%çš„äººå¿˜è®°WHEREå­å¥ï¼ŒSQLé«˜æ‰‹å´è¿™æ ·å†™ï¼šä»åŸºç¡€è¯­æ³•åˆ°å¤šè¡¨å…³è”çš„æ•°æ®ä¿®æ”¹åˆ©å™¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2883382090934252/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    éƒ‘æ©èµ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T01:20:52.000Z" title="Tue Nov 11 2025 01:20:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»33åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">S2B-SQL UPDATE æ›´æ–°æ•°æ®å®Œå…¨æŒ‡å—-99%çš„äººå¿˜è®°WHEREå­å¥ï¼ŒSQLé«˜æ‰‹å´è¿™æ ·å†™ï¼šä»åŸºç¡€è¯­æ³•åˆ°å¤šè¡¨å…³è”çš„æ•°æ®ä¿®æ”¹åˆ©å™¨</h2>
<h3 data-id="heading-1">ğŸ“ æ‘˜è¦</h3>
<p>99% çš„äººæ‰§è¡Œ UPDATE æ—¶å¿˜è®° WHERE å­å¥ï¼Œå¯¼è‡´å…¨è¡¨æ•°æ®è¢«è¯¯æ”¹ï¼ŸSQL é«˜æ‰‹å´æŒæ¡ WHERE æ¡ä»¶ã€å­æŸ¥è¯¢æ›´æ–°ã€å¤šè¡¨å…³è”ç­‰æŠ€å·§ï¼Œæ•°æ®ä¿®æ”¹ç²¾å‡†é«˜æ•ˆã€‚æœ¬æ–‡æ¡£ç”¨ç”Ÿæ´»åŒ–æ¯”å–»è§£æ SQL UPDATE æ›´æ–°æ•°æ®ï¼Œä»åŸºç¡€è¯­æ³•åˆ°å¤šè¡¨å…³è”ï¼Œå¸®ä½ æŒæ¡æ•°æ®ä¿®æ”¹æ ¸å¿ƒæŠ€èƒ½ï¼Œé¿å…æ•°æ®ç¾éš¾ã€‚</p>
<hr/>
<blockquote>
<p><strong>é¢è¯•åœºæ™¯</strong>ï¼š</p>
<p><strong>é¢è¯•å®˜</strong>ï¼šè¯·ä½ è¯´è¯´ SQL UPDATE è¯­å¥çš„åŸºæœ¬ç”¨æ³•ï¼Ÿ</p>
<p><strong>æ±‚èŒè€… Aï¼ˆé”™è¯¯å›ç­”ï¼‰</strong>ï¼šUPDATE å°±æ˜¯æ›´æ–°æ•°æ®ï¼Œç›´æ¥å†™ <code>UPDATE table SET column = value</code> å°±è¡Œäº†ã€‚</p>
<p><strong>é¢è¯•å®˜</strong>ï¼šå¦‚æœè¡¨é‡Œæœ‰ 10000 æ¡æ•°æ®ï¼Œä½ è¿™æ ·å†™ä¼šæ€æ ·ï¼Ÿ</p>
<p><strong>æ±‚èŒè€… A</strong>ï¼šå‘ƒ...åº”è¯¥åªä¼šæ›´æ–°ä¸€æ¡å§ï¼Ÿ</p>
<p><strong>é¢è¯•å®˜</strong>ï¼šâŒ é”™è¯¯ï¼è¿™æ ·ä¼šæ›´æ–°æ‰€æœ‰ 10000 æ¡æ•°æ®ï¼è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ 99% çš„äººä¼šçŠ¯çš„é”™è¯¯ã€‚</p>
<p><strong>æ±‚èŒè€… Bï¼ˆæ­£ç¡®å›ç­”ï¼‰</strong>ï¼šUPDATE è¯­å¥ç”¨äºæ›´æ–°è¡¨ä¸­å·²å­˜åœ¨çš„è®°å½•ã€‚åŸºæœ¬è¯­æ³•æ˜¯ <code>UPDATE table_name SET column = value WHERE condition</code>ã€‚<strong>WHERE å­å¥éå¸¸é‡è¦</strong>ï¼Œå®ƒæŒ‡å®šå“ªäº›è®°å½•éœ€è¦æ›´æ–°ã€‚å¦‚æœçœç•¥ WHERE å­å¥ï¼Œæ‰€æœ‰è®°å½•éƒ½ä¼šè¢«æ›´æ–°ï¼Œè¿™å¯èƒ½å¯¼è‡´æ•°æ®ç¾éš¾ã€‚</p>
<p><strong>é¢è¯•å®˜</strong>ï¼šâœ… æ­£ç¡®ï¼çœ‹æ¥ä½ æŒæ¡äº† UPDATE çš„æ ¸å¿ƒè¦ç‚¹ã€‚</p>
<p>é€šè¿‡è¿™ä¸ªé¢è¯•åœºæ™¯ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒæŒæ¡ UPDATE è¯­å¥çš„å…³é”®åœ¨äºç†è§£ WHERE å­å¥çš„é‡è¦æ€§ï¼Œä»¥åŠå¦‚ä½•æ­£ç¡®ä½¿ç”¨å„ç§æ›´æ–°æŠ€å·§ã€‚è®©æˆ‘ä»¬ä¸€èµ·æ¥æ·±å…¥å­¦ä¹  SQL UPDATE è¯­å¥ï¼Œä»åŸºç¡€è¯­æ³•åˆ°å¤šè¡¨å…³è”ï¼ŒæŒæ¡æ•°æ®ä¿®æ”¹çš„æ ¸å¿ƒæŠ€èƒ½ã€‚</p>
</blockquote>
<h3 data-id="heading-2">ğŸ“‘ ç›®å½•</h3>
<ul>
<li><a href="#-%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86%E7%82%B9" title="#-%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86%E7%82%B9">ğŸ¯ å‰ç½®çŸ¥è¯†ç‚¹</a></li>
<li><a href="#-%E4%BB%80%E4%B9%88%E6%98%AF-update" title="#-%E4%BB%80%E4%B9%88%E6%98%AF-update">ğŸ” ä»€ä¹ˆæ˜¯ UPDATEï¼Ÿ</a></li>
<li><a href="#-%E9%97%AE%E9%A2%98%E6%8F%8F%E8%BF%B0" title="#-%E9%97%AE%E9%A2%98%E6%8F%8F%E8%BF%B0">â“ é—®é¢˜æè¿°</a></li>
<li><a href="#-%E9%97%AE%E9%A2%98%E8%80%83%E5%AF%9F%E7%82%B9" title="#-%E9%97%AE%E9%A2%98%E8%80%83%E5%AF%9F%E7%82%B9">ğŸ¯ é—®é¢˜è€ƒå¯Ÿç‚¹</a></li>
<li><a href="#-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B" title="#-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B">âš¡ å¿«é€Ÿä¸Šæ‰‹</a></li>
<li><a href="#%EF%B8%8F-update-%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95" title="#%EF%B8%8F-update-%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95">ğŸ—ï¸ UPDATE åŸºæœ¬è¯­æ³•</a></li>
<li><a href="#-%E5%8D%95%E8%A1%A8%E6%9B%B4%E6%96%B0" title="#-%E5%8D%95%E8%A1%A8%E6%9B%B4%E6%96%B0">ğŸ“Š å•è¡¨æ›´æ–°</a></li>
<li><a href="#-update-%E4%B8%8E%E8%A1%A8%E8%BE%BE%E5%BC%8F" title="#-update-%E4%B8%8E%E8%A1%A8%E8%BE%BE%E5%BC%8F">ğŸ”¢ UPDATE ä¸è¡¨è¾¾å¼</a></li>
<li><a href="#-update-%E4%B8%8E%E5%AD%90%E6%9F%A5%E8%AF%A2" title="#-update-%E4%B8%8E%E5%AD%90%E6%9F%A5%E8%AF%A2">ğŸ”— UPDATE ä¸å­æŸ¥è¯¢</a></li>
<li><a href="#-%E5%A4%9A%E8%A1%A8%E5%85%B3%E8%81%94%E6%9B%B4%E6%96%B0" title="#-%E5%A4%9A%E8%A1%A8%E5%85%B3%E8%81%94%E6%9B%B4%E6%96%B0">ğŸ”€ å¤šè¡¨å…³è”æ›´æ–°</a></li>
<li><a href="#-%E4%B8%8D%E5%90%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%AD%E6%B3%95%E5%B7%AE%E5%BC%82" title="#-%E4%B8%8D%E5%90%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%AD%E6%B3%95%E5%B7%AE%E5%BC%82">ğŸŒ ä¸åŒæ•°æ®åº“è¯­æ³•å·®å¼‚</a></li>
<li><a href="#%EF%B8%8F-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%E5%92%8C%E8%AD%A6%E5%91%8A" title="#%EF%B8%8F-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%E5%92%8C%E8%AD%A6%E5%91%8A">âš ï¸ æ³¨æ„äº‹é¡¹å’Œè­¦å‘Š</a></li>
<li><a href="#-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96" title="#-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96">ğŸš€ æ€§èƒ½ä¼˜åŒ–</a></li>
<li><a href="#-%E5%AF%B9%E6%AF%94%E7%A4%BA%E4%BE%8B" title="#-%E5%AF%B9%E6%AF%94%E7%A4%BA%E4%BE%8B">ğŸ†š å¯¹æ¯”ç¤ºä¾‹</a></li>
<li><a href="#-%E5%B8%B8%E8%A7%81%E9%94%99%E8%AF%AF%E4%B8%8E%E4%BF%AE%E6%AD%A3" title="#-%E5%B8%B8%E8%A7%81%E9%94%99%E8%AF%AF%E4%B8%8E%E4%BF%AE%E6%AD%A3">ğŸ› å¸¸è§é”™è¯¯ä¸ä¿®æ­£</a></li>
<li><a href="#-%E5%AE%9E%E6%88%98%E5%BA%94%E7%94%A8%E6%A1%88%E4%BE%8B" title="#-%E5%AE%9E%E6%88%98%E5%BA%94%E7%94%A8%E6%A1%88%E4%BE%8B">ğŸ’¼ å®æˆ˜åº”ç”¨æ¡ˆä¾‹</a></li>
<li><a href="#-%E6%80%BB%E7%BB%93" title="#-%E6%80%BB%E7%BB%93">ğŸ“š æ€»ç»“</a></li>
</ul>
<hr/>
<h3 data-id="heading-3">ğŸ¯ å‰ç½®çŸ¥è¯†ç‚¹</h3>
<h4 data-id="heading-4">åŸºç¡€çŸ¥è¯†ç‚¹ï¼ˆå¿…é¡»æŒæ¡ï¼‰</h4>
<ul>
<li><strong>æ•°æ®åº“è¡¨ç»“æ„</strong>ï¼šç†è§£è¡¨ã€å­—æ®µã€è®°å½•çš„æ¦‚å¿µ</li>
<li><strong>æ•°æ®ç±»å‹</strong>ï¼šäº†è§£å¸¸è§æ•°æ®ç±»å‹ï¼ˆæ•´æ•°ã€å­—ç¬¦ä¸²ã€æ—¥æœŸç­‰ï¼‰</li>
<li><strong>SQL åŸºç¡€è¯­æ³•</strong>ï¼šç†è§£ SQL è¯­å¥çš„åŸºæœ¬ç»“æ„</li>
<li><strong>WHERE å­å¥</strong>ï¼šæŒæ¡ WHERE æ¡ä»¶ç­›é€‰çš„åŸºæœ¬ç”¨æ³•ï¼ˆå‚è§ <a href="https://link.juejin.cn?target=.%2FS1D-SQL%2520WHERE%2520%25E6%259D%25A1%25E4%25BB%25B6%25E7%25AD%259B%25E9%2580%2589%25E5%25AE%258C%25E5%2585%25A8%25E6%258C%2587%25E5%258D%2597-99%2525%25E7%259A%2584%25E4%25BA%25BA%25E5%258F%25AA%25E4%25BC%259A%25E7%2594%25A8%25E7%25AD%2589%25E4%25BA%258E%25E5%2592%258C%25E5%25A4%25A7%25E4%25BA%258E%25EF%25BC%258CSQL%25E9%25AB%2598%25E6%2589%258B%25E5%258D%25B4%25E8%25BF%2599%25E6%25A0%25B7%25E5%2586%2599%25EF%25BC%259A%25E4%25BB%258E%25E5%259F%25BA%25E7%25A1%2580%25E8%25BF%2590%25E7%25AE%2597%25E7%25AC%25A6%25E5%2588%25B0%25E5%25A4%258D%25E6%259D%2582%25E6%259D%25A1%25E4%25BB%25B6%25E7%259A%2584%25E6%2595%25B0%25E6%258D%25AE%25E8%25BF%2587%25E6%25BB%25A4%25E5%2588%25A9%25E5%2599%25A8.md" target="_blank" title="./S1D-SQL%20WHERE%20%E6%9D%A1%E4%BB%B6%E7%AD%9B%E9%80%89%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97-99%25%E7%9A%84%E4%BA%BA%E5%8F%AA%E4%BC%9A%E7%94%A8%E7%AD%89%E4%BA%8E%E5%92%8C%E5%A4%A7%E4%BA%8E%EF%BC%8CSQL%E9%AB%98%E6%89%8B%E5%8D%B4%E8%BF%99%E6%A0%B7%E5%86%99%EF%BC%9A%E4%BB%8E%E5%9F%BA%E7%A1%80%E8%BF%90%E7%AE%97%E7%AC%A6%E5%88%B0%E5%A4%8D%E6%9D%82%E6%9D%A1%E4%BB%B6%E7%9A%84%E6%95%B0%E6%8D%AE%E8%BF%87%E6%BB%A4%E5%88%A9%E5%99%A8.md" ref="nofollow noopener noreferrer">S1D-SQL WHERE æ¡ä»¶ç­›é€‰å®Œå…¨æŒ‡å—</a>ï¼‰</li>
</ul>
<h4 data-id="heading-5">è¿›é˜¶çŸ¥è¯†ç‚¹ï¼ˆå»ºè®®äº†è§£ï¼‰</h4>
<ul>
<li><strong>çº¦æŸï¼ˆconstraintï¼‰</strong>ï¼šäº†è§£ä¸»é”®ï¼ˆprimary keyï¼‰ã€å¤–é”®ï¼ˆforeign keyï¼‰ã€å”¯ä¸€æ€§çº¦æŸï¼ˆunique constraintï¼‰çš„ä½œç”¨</li>
<li><strong>å­æŸ¥è¯¢ï¼ˆsubqueryï¼‰</strong>ï¼šäº†è§£å­æŸ¥è¯¢çš„åŸºæœ¬æ¦‚å¿µå’Œä½¿ç”¨æ–¹æ³•</li>
<li><strong>å¤šè¡¨å…³è”ï¼ˆJOINï¼‰</strong>ï¼šäº†è§£è¡¨ä¸è¡¨ä¹‹é—´çš„å…³è”å…³ç³»</li>
<li><strong>äº‹åŠ¡ï¼ˆtransactionï¼‰</strong>ï¼šäº†è§£äº‹åŠ¡çš„åŸºæœ¬æ¦‚å¿µï¼Œç†è§£ COMMIT å’Œ ROLLBACK çš„ä½œç”¨</li>
</ul>
<h4 data-id="heading-6">å­¦ä¹ å»ºè®®</h4>
<ul>
<li><strong>å°ç™½ï¼ˆé›¶åŸºç¡€ï¼‰</strong>ï¼šå…ˆç†è§£è¡¨çš„åŸºæœ¬æ¦‚å¿µï¼ŒæŒæ¡ UPDATE çš„åŸºæœ¬è¯­æ³•ï¼Œé‡ç‚¹ç†è§£ WHERE å­å¥çš„é‡è¦æ€§</li>
<li><strong>åˆçº§ï¼ˆåˆšå…¥é—¨ä¸ä¹…ï¼‰</strong>ï¼šå­¦ä¼šä½¿ç”¨ UPDATE æ›´æ–°å•æ¡è®°å½•å’Œå¤šæ¡è®°å½•ï¼ŒæŒæ¡ WHERE æ¡ä»¶çš„ä½¿ç”¨</li>
<li><strong>ä¸­çº§ï¼ˆå…¥é—¨ä¸€æ®µæ—¶é—´ï¼‰</strong>ï¼šæŒæ¡ UPDATE ä¸è¡¨è¾¾å¼ã€å­æŸ¥è¯¢æ›´æ–°ã€å¤šè¡¨å…³è”æ›´æ–°ç­‰é«˜çº§æŠ€å·§</li>
<li><strong>é«˜çº§ï¼ˆèµ„æ·±å¼€å‘è€…ï¼‰</strong>ï¼šç†è§£ UPDATE çš„æ€§èƒ½ä¼˜åŒ–ã€äº‹åŠ¡å¤„ç†ã€è¡Œé”ä¼˜åŒ–ç­‰é«˜çº§ç‰¹æ€§</li>
</ul>
<hr/>
<h3 data-id="heading-7">ğŸ” ä»€ä¹ˆæ˜¯ UPDATEï¼Ÿ</h3>
<h4 data-id="heading-8">æ ¸å¿ƒæ¦‚å¿µ</h4>
<p><strong>UPDATEï¼ˆæ›´æ–°ï¼‰</strong> æ˜¯ SQL ä¸­ç”¨äºä¿®æ”¹è¡¨ä¸­å·²å­˜åœ¨è®°å½•çš„è¯­å¥ã€‚</p>
<p><strong>ç”Ÿæ´»åŒ–æ¯”å–»</strong>ï¼šUPDATE å°±åƒä¿®æ”¹å›¾ä¹¦é¦†çš„ä¹¦ç±ç™»è®°å†Œï¼ˆè¡¨ï¼‰ä¸Šå·²æœ‰çš„è®°å½•ã€‚æ¯”å¦‚æŸæœ¬ä¹¦çš„å€Ÿé˜…çŠ¶æ€ä»"åœ¨é¦†"æ”¹ä¸º"å·²å€Ÿå‡º"ï¼Œæˆ–è€…æ›´æ–°ä¹¦ç±çš„å½’è¿˜æ—¥æœŸã€‚UPDATE ä¸ä¼šæ–°å¢è®°å½•ï¼Œåªä¼šä¿®æ”¹ç°æœ‰è®°å½•çš„å†…å®¹ã€‚</p>
<h4 data-id="heading-9">ä¸ºä»€ä¹ˆéœ€è¦ UPDATEï¼Ÿ</h4>
<h5 data-id="heading-10">âŒ ä¸ä½¿ç”¨ UPDATE ä¼šæ€æ ·ï¼Ÿ</h5>
<p><strong>é—®é¢˜åœºæ™¯</strong>ï¼šå­¦ç”Ÿè¡¨ä¸­æŸä¸ªå­¦ç”Ÿçš„æˆç»©å½•å…¥é”™è¯¯ï¼Œéœ€è¦ä¿®æ”¹</p>
<p><strong>ä¸ä½¿ç”¨ UPDATE</strong>ï¼š</p>
<ul>
<li>æ— æ³•ä¿®æ”¹å·²å­˜åœ¨çš„æ•°æ®</li>
<li>åªèƒ½åˆ é™¤æ—§è®°å½•ï¼Œå†æ’å…¥æ–°è®°å½•ï¼ˆç¹çä¸”å®¹æ˜“å‡ºé”™ï¼‰</li>
<li>æ— æ³•æ‰¹é‡æ›´æ–°å¤šæ¡è®°å½•</li>
<li>æ— æ³•æ ¹æ®æ¡ä»¶é€‰æ‹©æ€§æ›´æ–°</li>
</ul>
<h5 data-id="heading-11">âœ… ä½¿ç”¨ UPDATE çš„è§£å†³æ–¹æ¡ˆ</h5>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æ›´æ–°å­¦ç”Ÿè¡¨ä¸­ id ä¸º 1 çš„å­¦ç”Ÿçš„æˆç»©</span>
<span class="hljs-keyword">UPDATE</span> students 
<span class="hljs-keyword">SET</span> score <span class="hljs-operator">=</span> <span class="hljs-number">95</span> 
<span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
</code></pre>
<p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>âœ… å¯ä»¥ç›´æ¥ä¿®æ”¹å·²å­˜åœ¨çš„æ•°æ®</li>
<li>âœ… æ“ä½œç®€å•ï¼Œä¸€æ¡è¯­å¥å³å¯å®Œæˆ</li>
<li>âœ… å¯ä»¥æ‰¹é‡æ›´æ–°å¤šæ¡è®°å½•</li>
<li>âœ… å¯ä»¥æ ¹æ®æ¡ä»¶é€‰æ‹©æ€§æ›´æ–°</li>
<li>âœ… å¯ä»¥åŒæ—¶æ›´æ–°å¤šä¸ªå­—æ®µ</li>
</ul>
<hr/>
<h3 data-id="heading-12">â“ é—®é¢˜æè¿°</h3>
<h4 data-id="heading-13">çœŸå®åœºæ™¯</h4>
<p>æƒ³è±¡ä¸€ä¸‹è¿™æ ·çš„åœºæ™¯ï¼šä½ åœ¨ä¸€å®¶ç”µå•†å…¬å¸å·¥ä½œï¼Œè´Ÿè´£ç»´æŠ¤ç”¨æˆ·ä¿¡æ¯è¡¨ã€‚æŸå¤©ï¼Œäº§å“ç»ç†å‘Šè¯‰ä½ ï¼š"æˆ‘ä»¬éœ€è¦æŠŠæ‰€æœ‰ VIP ç”¨æˆ·çš„ç§¯åˆ†å¢åŠ  100 åˆ†ï¼Œå¹¶ä¸”æ›´æ–°ä»–ä»¬çš„ä¼šå‘˜ç­‰çº§ã€‚"</p>
<p><strong>æ–°æ‰‹åšæ³•</strong>ï¼š</p>
<ul>
<li>å…ˆæŸ¥è¯¢æ‰€æœ‰ VIP ç”¨æˆ·</li>
<li>ä¸€æ¡ä¸€æ¡æ‰‹åŠ¨ä¿®æ”¹æ¯æ¡è®°å½•</li>
<li>æˆ–è€…å†™ä¸€ä¸ªå¾ªç¯ï¼Œé€æ¡æ›´æ–°</li>
</ul>
<p><strong>é—®é¢˜</strong>ï¼š</p>
<ul>
<li>æ•ˆç‡ä½ä¸‹ï¼Œå¦‚æœ VIP ç”¨æˆ·æœ‰ 10000 ä¸ªï¼Œéœ€è¦æ‰§è¡Œ 10000 æ¬¡æ›´æ–°æ“ä½œ</li>
<li>å®¹æ˜“å‡ºé”™ï¼Œå¯èƒ½æ¼æ‰æŸäº›ç”¨æˆ·</li>
<li>ä»£ç å¤æ‚ï¼Œéœ€è¦å†™å¾ªç¯é€»è¾‘</li>
</ul>
<p><strong>SQL é«˜æ‰‹åšæ³•</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ä¸€æ¡ UPDATE è¯­å¥æå®š</span>
<span class="hljs-keyword">UPDATE</span> users 
<span class="hljs-keyword">SET</span> points <span class="hljs-operator">=</span> points <span class="hljs-operator">+</span> <span class="hljs-number">100</span>, 
    level <span class="hljs-operator">=</span> <span class="hljs-string">'VIP'</span> 
<span class="hljs-keyword">WHERE</span> user_type <span class="hljs-operator">=</span> <span class="hljs-string">'VIP'</span>;
</code></pre>
<p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>âœ… ä¸€æ¡è¯­å¥å®Œæˆæ‰€æœ‰æ›´æ–°</li>
<li>âœ… æ•ˆç‡é«˜ï¼Œæ•°æ®åº“è‡ªåŠ¨ä¼˜åŒ–æ‰§è¡Œ</li>
<li>âœ… ä¸ä¼šæ¼æ‰ä»»ä½•ç¬¦åˆæ¡ä»¶çš„è®°å½•</li>
<li>âœ… ä»£ç ç®€æ´ï¼Œæ˜“äºç»´æŠ¤</li>
</ul>
<h4 data-id="heading-14">æ ¸å¿ƒç—›ç‚¹</h4>
<ol>
<li><strong>å¿˜è®° WHERE å­å¥</strong>ï¼š99% çš„äººåœ¨æ‰§è¡Œ UPDATE æ—¶å¿˜è®°æ·»åŠ  WHERE æ¡ä»¶ï¼Œå¯¼è‡´å…¨è¡¨æ•°æ®è¢«è¯¯æ”¹</li>
<li><strong>ä¸çŸ¥é“å¦‚ä½•æ‰¹é‡æ›´æ–°</strong>ï¼šé¢å¯¹å¤§é‡æ•°æ®éœ€è¦æ›´æ–°æ—¶ï¼Œä¸çŸ¥é“å¦‚ä½•é«˜æ•ˆå¤„ç†</li>
<li><strong>å¤šè¡¨å…³è”æ›´æ–°å›°éš¾</strong>ï¼šéœ€è¦æ ¹æ®å…¶ä»–è¡¨çš„æ•°æ®æ¥æ›´æ–°å½“å‰è¡¨æ—¶ï¼Œä¸çŸ¥é“å¦‚ä½•å†™ SQL</li>
<li><strong>æ€§èƒ½é—®é¢˜</strong>ï¼šæ›´æ–°å¤§é‡æ•°æ®æ—¶ï¼Œä¸çŸ¥é“å¦‚ä½•ä¼˜åŒ–æ€§èƒ½</li>
</ol>
<hr/>
<h3 data-id="heading-15">ğŸ¯ é—®é¢˜è€ƒå¯Ÿç‚¹</h3>
<p>é€šè¿‡æœ¬æ–‡æ¡£çš„å­¦ä¹ ï¼Œä½ å°†æŒæ¡ä»¥ä¸‹æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼š</p>
<h4 data-id="heading-16">åŸºç¡€èƒ½åŠ› ğŸ”¥ Must</h4>
<ol>
<li><strong>UPDATE åŸºæœ¬è¯­æ³•</strong>ï¼šæŒæ¡ UPDATE è¯­å¥çš„åŸºæœ¬ç»“æ„å’Œè¯­æ³•è§„åˆ™</li>
<li><strong>WHERE å­å¥ä½¿ç”¨</strong>ï¼šç†è§£ WHERE å­å¥çš„é‡è¦æ€§ï¼ŒæŒæ¡æ¡ä»¶ç­›é€‰çš„å†™æ³•</li>
<li><strong>å•è¡¨æ›´æ–°</strong>ï¼šå­¦ä¼šæ›´æ–°å•æ¡è®°å½•ã€å¤šæ¡è®°å½•ï¼Œä»¥åŠæ›´æ–°å¤šä¸ªå­—æ®µ</li>
</ol>
<h4 data-id="heading-17">è¿›é˜¶èƒ½åŠ› â­ Should</h4>
<ol start="4">
<li><strong>è¡¨è¾¾å¼æ›´æ–°</strong>ï¼šæŒæ¡åœ¨ UPDATE ä¸­ä½¿ç”¨è¡¨è¾¾å¼è¿›è¡Œè®¡ç®—æ›´æ–°</li>
<li><strong>å­æŸ¥è¯¢æ›´æ–°</strong>ï¼šå­¦ä¼šä½¿ç”¨å­æŸ¥è¯¢æ¥æ›´æ–°æ•°æ®ï¼Œç†è§£ EXISTS æ¡ä»¶çš„é‡è¦æ€§</li>
<li><strong>å¤šè¡¨å…³è”æ›´æ–°</strong>ï¼šæŒæ¡ MySQLã€SQL Server ç­‰ä¸åŒæ•°æ®åº“çš„å¤šè¡¨å…³è”æ›´æ–°è¯­æ³•</li>
</ol>
<h4 data-id="heading-18">é«˜çº§èƒ½åŠ› ğŸ’¡ Could</h4>
<ol start="7">
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šäº†è§£ç´¢å¼•ä½¿ç”¨ã€åˆ†æ‰¹æ›´æ–°ã€äº‹åŠ¡å¤„ç†ã€è¡Œé”ä¼˜åŒ–ç­‰æ€§èƒ½ä¼˜åŒ–æŠ€å·§</li>
<li><strong>ä¸åŒæ•°æ®åº“å·®å¼‚</strong>ï¼šäº†è§£ MySQLã€Oracleã€SQL Serverã€PostgreSQL ç­‰æ•°æ®åº“çš„è¯­æ³•å·®å¼‚</li>
<li><strong>å®æˆ˜åº”ç”¨</strong>ï¼šæŒæ¡å„ç§å®é™…ä¸šåŠ¡åœºæ™¯ä¸‹çš„ UPDATE åº”ç”¨æŠ€å·§</li>
</ol>
<hr/>
<h3 data-id="heading-19">âš¡ å¿«é€Ÿä¸Šæ‰‹</h3>
<p>è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªæœ€ç®€å•çš„ä¾‹å­æ¥å¿«é€Ÿäº†è§£ UPDATE è¯­å¥çš„ä½¿ç”¨æ–¹æ³•ã€‚</p>
<h4 data-id="heading-20">æœ€ç®€å•çš„ UPDATE ç¤ºä¾‹</h4>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå­¦ç”Ÿè¡¨ <code>students</code>ï¼Œç°åœ¨éœ€è¦å°† id ä¸º 1 çš„å­¦ç”Ÿçš„æˆç»©æ›´æ–°ä¸º 95 åˆ†ã€‚</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æ›´æ–°å­¦ç”Ÿè¡¨ä¸­ id ä¸º 1 çš„å­¦ç”Ÿçš„æˆç»©</span>
<span class="hljs-keyword">UPDATE</span> students 
<span class="hljs-keyword">SET</span> score <span class="hljs-operator">=</span> <span class="hljs-number">95</span> 
<span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
</code></pre>
<p><strong>é€è¡Œä»£ç è§£é‡Š</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- UPDATE ä½œç”¨ï¼šæŒ‡å®šè¦æ›´æ–°æ•°æ®çš„è¡¨</span>
<span class="hljs-keyword">UPDATE</span> students 

<span class="hljs-comment">-- SET ä½œç”¨ï¼šæŒ‡å®šè¦æ›´æ–°çš„å­—æ®µå’Œæ–°å€¼</span>
<span class="hljs-keyword">SET</span> score <span class="hljs-operator">=</span> <span class="hljs-number">95</span> 

<span class="hljs-comment">-- WHERE ä½œç”¨ï¼šæŒ‡å®šæ›´æ–°æ¡ä»¶ï¼Œåªæ›´æ–° id ä¸º 1 çš„è®°å½•</span>
<span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
</code></pre>
<p><strong>æ‰§è¡Œç»“æœ</strong>ï¼š</p>
<ul>
<li>âœ… å¦‚æœè¡¨ä¸­å­˜åœ¨ id ä¸º 1 çš„è®°å½•ï¼Œè¯¥è®°å½•çš„ score å­—æ®µä¼šè¢«æ›´æ–°ä¸º 95</li>
<li>âœ… å¦‚æœè¡¨ä¸­ä¸å­˜åœ¨ id ä¸º 1 çš„è®°å½•ï¼Œä¸ä¼šæŠ¥é”™ï¼Œä½†ä¹Ÿä¸ä¼šæœ‰ä»»ä½•è®°å½•è¢«æ›´æ–°</li>
</ul>
<p><strong>âš ï¸ é‡è¦æé†’</strong>ï¼šWHERE å­å¥éå¸¸é‡è¦ï¼å¦‚æœçœç•¥ WHERE å­å¥ï¼Œæ‰€æœ‰è®°å½•çš„ score å­—æ®µéƒ½ä¼šè¢«æ›´æ–°ä¸º 95ï¼Œè¿™å¯èƒ½å¯¼è‡´æ•°æ®ç¾éš¾ï¼</p>
<hr/>
<h3 data-id="heading-21">ğŸ—ï¸ UPDATE åŸºæœ¬è¯­æ³•</h3>
<h4 data-id="heading-22">åŸºæœ¬è¯­æ³•ç»“æ„</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">UPDATE</span> table_name
<span class="hljs-keyword">SET</span> column1 <span class="hljs-operator">=</span> value1, column2 <span class="hljs-operator">=</span> value2, ...
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">condition</span>;
</code></pre>
<p><strong>è¯­æ³•è¯´æ˜</strong>ï¼š</p>
<ul>
<li><strong>UPDATE</strong>ï¼šæ›´æ–°å‘½ä»¤å…³é”®å­—</li>
<li><strong>table_name</strong>ï¼šè¦æ›´æ–°æ•°æ®çš„è¡¨å</li>
<li><strong>SET</strong>ï¼šè®¾ç½®å…³é”®å­—ï¼Œç”¨äºæŒ‡å®šè¦æ›´æ–°çš„å­—æ®µå’Œæ–°å€¼</li>
<li><strong>column1, column2, ...</strong>ï¼šè¦æ›´æ–°çš„å­—æ®µåç§°ï¼Œå¯ä»¥åŒæ—¶æ›´æ–°å¤šä¸ªå­—æ®µ</li>
<li><strong>value1, value2, ...</strong>ï¼šå¯¹åº”å­—æ®µçš„æ–°å€¼</li>
<li><strong>WHERE</strong>ï¼šæ¡ä»¶å…³é”®å­—ï¼ˆå¯é€‰ï¼Œä½†å¼ºçƒˆå»ºè®®ä½¿ç”¨ï¼‰</li>
<li><strong>condition</strong>ï¼šæ›´æ–°æ¡ä»¶ï¼Œç”¨äºæŒ‡å®šå“ªäº›è®°å½•éœ€è¦æ›´æ–°</li>
</ul>
<p><strong>ç”Ÿæ´»åŒ–æ¯”å–»</strong>ï¼šUPDATE å°±åƒä¿®æ”¹ç™»è®°å†Œï¼Œ<code>UPDATE table_name</code> æ˜¯"åœ¨å“ªä¸ªç™»è®°å†Œä¸Š"ï¼Œ<code>SET column = value</code> æ˜¯"æŠŠå“ªä¸ªå­—æ®µæ”¹æˆä»€ä¹ˆå€¼"ï¼Œ<code>WHERE condition</code> æ˜¯"åªä¿®æ”¹ç¬¦åˆæ¡ä»¶çš„è®°å½•"ã€‚</p>
<h4 data-id="heading-23">è¯­æ³•å˜ä½“</h4>
<p><strong>å¦ä¸€ç§è¯­æ³•æ ¼å¼ï¼ˆä¸­æ–‡æ³¨é‡Šç‰ˆï¼‰</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">UPDATE</span> è¡¨åç§° 
<span class="hljs-keyword">SET</span> åˆ—åç§° <span class="hljs-operator">=</span> æ–°å€¼ 
<span class="hljs-keyword">WHERE</span> åˆ—åç§° <span class="hljs-operator">=</span> æŸå€¼
</code></pre>
<h4 data-id="heading-24">å‚æ•°è¯¦è§£</h4>



































<table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th><th>æ˜¯å¦å¿…éœ€</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>table_name</code></td><td>è¦ä¿®æ”¹çš„è¡¨åç§°</td><td>âœ… å¿…éœ€</td><td><code>students</code></td></tr><tr><td><code>column</code></td><td>è¦ä¿®æ”¹çš„å­—æ®µåç§°</td><td>âœ… å¿…éœ€</td><td><code>score</code></td></tr><tr><td><code>value</code></td><td>è¦ä¿®æ”¹çš„æ–°å€¼</td><td>âœ… å¿…éœ€</td><td><code>95</code></td></tr><tr><td><code>WHERE condition</code></td><td>ä¿®æ”¹æ¡ä»¶</td><td>âš ï¸ å¼ºçƒˆå»ºè®®</td><td><code>WHERE id = 1</code></td></tr></tbody></table>
<p><strong>âš ï¸ é‡è¦è­¦å‘Š</strong>ï¼šWHERE å­å¥è™½ç„¶ä¸æ˜¯è¯­æ³•ä¸Šå¿…éœ€çš„ï¼Œä½†åœ¨å®é™…ä½¿ç”¨ä¸­<strong>å¼ºçƒˆå»ºè®®å¿…é¡»ä½¿ç”¨</strong>ã€‚å¦‚æœçœç•¥ WHERE å­å¥ï¼Œæ‰€æœ‰è®°å½•éƒ½å°†è¢«æ›´æ–°ï¼</p>
<hr/>
<h3 data-id="heading-25">ğŸ“Š å•è¡¨æ›´æ–°</h3>
<p>è®©æˆ‘ä»¬æ¥è¯¦ç»†å­¦ä¹ å•è¡¨æ›´æ–°çš„å„ç§ç”¨æ³•ã€‚å•è¡¨æ›´æ–°æ˜¯æœ€å¸¸ç”¨çš„ UPDATE æ“ä½œï¼ŒåŒ…æ‹¬æ›´æ–°å•æ¡è®°å½•ã€å¤šæ¡è®°å½•ç­‰åœºæ™¯ã€‚</p>
<h4 data-id="heading-26">1ï¸âƒ£ æ›´æ–°å•æ¡è®°å½•ï¼ˆå•å­—æ®µï¼‰ ğŸ”¥ Must</h4>
<p><strong>åœºæ™¯</strong>ï¼šæ›´æ–°æŸä¸ªå­¦ç”Ÿçš„æˆç»©</p>
<p><strong>è¯­æ³•</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">UPDATE</span> table_name
<span class="hljs-keyword">SET</span> <span class="hljs-keyword">column</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">value</span>
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">condition</span>;
</code></pre>
<p><strong>å®é™…ä¾‹å­</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æ›´æ–°å­¦ç”Ÿè¡¨ä¸­ id ä¸º 1 çš„å­¦ç”Ÿçš„æˆç»©ä¸º 95 åˆ†</span>
<span class="hljs-keyword">UPDATE</span> students 
<span class="hljs-keyword">SET</span> score <span class="hljs-operator">=</span> <span class="hljs-number">95</span> 
<span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
</code></pre>
<p><strong>é€è¡Œä»£ç è§£é‡Š</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- UPDATE studentsï¼šæŒ‡å®šè¦æ›´æ–° students è¡¨</span>
<span class="hljs-keyword">UPDATE</span> students 

<span class="hljs-comment">-- SET score = 95ï¼šå°† score å­—æ®µçš„å€¼è®¾ç½®ä¸º 95</span>
<span class="hljs-keyword">SET</span> score <span class="hljs-operator">=</span> <span class="hljs-number">95</span> 

<span class="hljs-comment">-- WHERE id = 1ï¼šåªæ›´æ–° id ç­‰äº 1 çš„è®°å½•</span>
<span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
</code></pre>
<p><strong>æ›´å¤šç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ç¤ºä¾‹ 1ï¼šæ›´æ–°å®¢æˆ·è¡¨ä¸­ id ä¸º 1 çš„å®¢æˆ·çš„è”ç³»äººå’ŒåŸå¸‚</span>
<span class="hljs-keyword">UPDATE</span> Customers
<span class="hljs-keyword">SET</span> ContactName <span class="hljs-operator">=</span> <span class="hljs-string">'Alfred Schmidt'</span>, City <span class="hljs-operator">=</span> <span class="hljs-string">'Frankfurt'</span>
<span class="hljs-keyword">WHERE</span> CustomerID <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

<span class="hljs-comment">-- ç¤ºä¾‹ 2ï¼šæ›´æ–°äººå‘˜è¡¨ä¸­å§“ä¸º 'Wilson' çš„äººçš„åå­—</span>
<span class="hljs-keyword">UPDATE</span> Person 
<span class="hljs-keyword">SET</span> FirstName <span class="hljs-operator">=</span> <span class="hljs-string">'Fred'</span> 
<span class="hljs-keyword">WHERE</span> LastName <span class="hljs-operator">=</span> <span class="hljs-string">'Wilson'</span>;

<span class="hljs-comment">-- ç¤ºä¾‹ 3ï¼šæ›´æ–°ç”¨æˆ·è¡¨ä¸­ id ä¸º 1 çš„ç”¨æˆ·å</span>
<span class="hljs-keyword">UPDATE</span> users
<span class="hljs-keyword">SET</span> username <span class="hljs-operator">=</span> <span class="hljs-string">'æ–°ç”¨æˆ·å'</span>
<span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
</code></pre>
<h4 data-id="heading-27">2ï¸âƒ£ æ›´æ–°å•æ¡è®°å½•ï¼ˆå¤šå­—æ®µï¼‰ ğŸ”¥ Must</h4>
<p><strong>åœºæ™¯</strong>ï¼šåŒæ—¶æ›´æ–°æŸä¸ªå­¦ç”Ÿçš„å¤šä¸ªå­—æ®µä¿¡æ¯</p>
<p><strong>è¯­æ³•</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">UPDATE</span> table_name
<span class="hljs-keyword">SET</span> column1 <span class="hljs-operator">=</span> value1, column2 <span class="hljs-operator">=</span> value2, ...
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">condition</span>;
</code></pre>
<p><strong>å®é™…ä¾‹å­</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æ›´æ–°å­¦ç”Ÿè¡¨ä¸­ id ä¸º 2 çš„å­¦ç”Ÿçš„å§“åå’Œæ€§åˆ«</span>
<span class="hljs-keyword">UPDATE</span> students 
<span class="hljs-keyword">SET</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'mike'</span>, sex <span class="hljs-operator">=</span> <span class="hljs-string">'1'</span> 
<span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-string">'2'</span>;
</code></pre>
<p><strong>é€è¡Œä»£ç è§£é‡Š</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- UPDATE studentsï¼šæŒ‡å®šè¦æ›´æ–° students è¡¨</span>
<span class="hljs-keyword">UPDATE</span> students 

<span class="hljs-comment">-- SET name = 'mike', sex = '1'ï¼šåŒæ—¶æ›´æ–° name å’Œ sex ä¸¤ä¸ªå­—æ®µ</span>
<span class="hljs-comment">-- name å­—æ®µè®¾ç½®ä¸º 'mike'ï¼Œsex å­—æ®µè®¾ç½®ä¸º '1'</span>
<span class="hljs-keyword">SET</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'mike'</span>, sex <span class="hljs-operator">=</span> <span class="hljs-string">'1'</span> 

<span class="hljs-comment">-- WHERE id = '2'ï¼šåªæ›´æ–° id ç­‰äº '2' çš„è®°å½•</span>
<span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-string">'2'</span>;
</code></pre>
<p><strong>æ›´å¤šç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ç¤ºä¾‹ 1ï¼šæ›´æ–°äººå‘˜è¡¨ä¸­å§“ä¸º 'Wilson' çš„äººçš„åœ°å€å’ŒåŸå¸‚</span>
<span class="hljs-keyword">UPDATE</span> Person 
<span class="hljs-keyword">SET</span> Address <span class="hljs-operator">=</span> <span class="hljs-string">'Zhongshan 23'</span>, City <span class="hljs-operator">=</span> <span class="hljs-string">'Nanjing'</span> 
<span class="hljs-keyword">WHERE</span> LastName <span class="hljs-operator">=</span> <span class="hljs-string">'Wilson'</span>;

<span class="hljs-comment">-- ç¤ºä¾‹ 2ï¼šæ›´æ–°å®¢æˆ·è¡¨ä¸­ id ä¸º 2 çš„å®¢æˆ·çš„å¤šä¸ªåœ°å€å­—æ®µ</span>
<span class="hljs-keyword">UPDATE</span> client
<span class="hljs-keyword">SET</span> rue <span class="hljs-operator">=</span> <span class="hljs-string">'49 Rue Ameline'</span>,
    ville <span class="hljs-operator">=</span> <span class="hljs-string">'Saint-Eustache-la-ForÃªt'</span>,
    code_postal <span class="hljs-operator">=</span> <span class="hljs-string">'76210'</span>
<span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;
</code></pre>
<h4 data-id="heading-28">3ï¸âƒ£ æ›´æ–°å¤šæ¡è®°å½• â­ Should</h4>
<p><strong>åœºæ™¯</strong>ï¼šæ‰¹é‡æ›´æ–°ç¬¦åˆæ¡ä»¶çš„æ‰€æœ‰è®°å½•</p>
<p><strong>è¯­æ³•</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">UPDATE</span> table_name
<span class="hljs-keyword">SET</span> <span class="hljs-keyword">column</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">value</span>
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">condition</span>;
</code></pre>
<p><strong>å®é™…ä¾‹å­</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æ›´æ–°æ‰€æœ‰æ¥è‡ª 'Mexico' çš„å®¢æˆ·çš„è”ç³»äºº</span>
<span class="hljs-keyword">UPDATE</span> Customers
<span class="hljs-keyword">SET</span> ContactName <span class="hljs-operator">=</span> <span class="hljs-string">'Juan'</span>
<span class="hljs-keyword">WHERE</span> Country <span class="hljs-operator">=</span> <span class="hljs-string">'Mexico'</span>;
</code></pre>
<p><strong>é€è¡Œä»£ç è§£é‡Š</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- UPDATE Customersï¼šæŒ‡å®šè¦æ›´æ–° Customers è¡¨</span>
<span class="hljs-keyword">UPDATE</span> Customers

<span class="hljs-comment">-- SET ContactName = 'Juan'ï¼šå°†æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„è®°å½•çš„ ContactName è®¾ç½®ä¸º 'Juan'</span>
<span class="hljs-keyword">SET</span> ContactName <span class="hljs-operator">=</span> <span class="hljs-string">'Juan'</span>

<span class="hljs-comment">-- WHERE Country = 'Mexico'ï¼šåªæ›´æ–° Country ç­‰äº 'Mexico' çš„è®°å½•</span>
<span class="hljs-comment">-- æ³¨æ„ï¼šè¿™é‡Œå¯èƒ½æœ‰å¤šæ¡è®°å½•ç¬¦åˆæ¡ä»¶ï¼Œéƒ½ä¼šè¢«æ›´æ–°</span>
<span class="hljs-keyword">WHERE</span> Country <span class="hljs-operator">=</span> <span class="hljs-string">'Mexico'</span>;
</code></pre>
<p><strong>æ›´å¤šç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ç¤ºä¾‹ 1ï¼šæ›´æ–° id åœ¨ 5 åˆ° 7 ä¹‹é—´çš„å­¦ç”Ÿçš„å§“åå’Œæˆç»©</span>
<span class="hljs-keyword">UPDATE</span> students 
<span class="hljs-keyword">SET</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'å°ç‰›'</span>, score <span class="hljs-operator">=</span> <span class="hljs-number">77</span> 
<span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">&gt;=</span> <span class="hljs-number">5</span> <span class="hljs-keyword">AND</span> id <span class="hljs-operator">&lt;=</span> <span class="hljs-number">7</span>;

<span class="hljs-comment">-- ç¤ºä¾‹ 2ï¼šå°†æ‰€æœ‰ä»·æ ¼ä½äº 100 çš„å•†å“ä»·æ ¼æé«˜ 10%</span>
<span class="hljs-keyword">UPDATE</span> products 
<span class="hljs-keyword">SET</span> price <span class="hljs-operator">=</span> price <span class="hljs-operator">*</span> <span class="hljs-number">1.1</span> 
<span class="hljs-keyword">WHERE</span> price <span class="hljs-operator">&lt;</span> <span class="hljs-number">100</span>;

<span class="hljs-comment">-- ç¤ºä¾‹ 3ï¼šå°†æ‰€æœ‰æˆç»©ä½äº 80 çš„å­¦ç”Ÿçš„æˆç»©åŠ  10 åˆ†</span>
<span class="hljs-keyword">UPDATE</span> students 
<span class="hljs-keyword">SET</span> score <span class="hljs-operator">=</span> score <span class="hljs-operator">+</span> <span class="hljs-number">10</span> 
<span class="hljs-keyword">WHERE</span> score <span class="hljs-operator">&lt;</span> <span class="hljs-number">80</span>;
</code></pre>
<h4 data-id="heading-29">4ï¸âƒ£ æ›´æ–°æ‰€æœ‰è®°å½•ï¼ˆå±é™©æ“ä½œï¼‰ âš ï¸</h4>
<p><strong>âš ï¸ ä¸¥é‡è­¦å‘Š</strong>ï¼šå¦‚æœä¸åŠ  WHERE æ¡ä»¶ï¼Œåˆ™æ‰€æœ‰è®°å½•éƒ½ä¼šè¢«æ›´æ–°ï¼è¿™æ˜¯ä¸€ä¸ªéå¸¸å±é™©çš„æ“ä½œï¼</p>
<p><strong>é”™è¯¯ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âŒ å±é™©ï¼è¿™ä¼šæ›´æ–°è¡¨ä¸­æ‰€æœ‰è®°å½•çš„ ContactName</span>
<span class="hljs-keyword">UPDATE</span> Customers
<span class="hljs-keyword">SET</span> ContactName <span class="hljs-operator">=</span> <span class="hljs-string">'Juan'</span>;
</code></pre>
<p><strong>æ‰§è¡Œç»“æœ</strong>ï¼šè¡¨ä¸­æ‰€æœ‰è®°å½•çš„ ContactName å­—æ®µéƒ½ä¼šè¢«æ›´æ–°ä¸º 'Juan'ï¼Œè¿™é€šå¸¸ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœï¼</p>
<p><strong>å¦ä¸€ä¸ªé”™è¯¯ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âŒ å±é™©ï¼è¿™ä¼šæ›´æ–°è¡¨ä¸­æ‰€æœ‰è®°å½•çš„ pays å­—æ®µ</span>
<span class="hljs-keyword">UPDATE</span> client
<span class="hljs-keyword">SET</span> pays <span class="hljs-operator">=</span> <span class="hljs-string">'FRANCE'</span>;
</code></pre>
<p><strong>æ‰§è¡Œç»“æœ</strong>ï¼šè¡¨ä¸­æ‰€æœ‰è®°å½•çš„ pays å­—æ®µéƒ½ä¼šè¢«æ›´æ–°ä¸º 'FRANCE'ã€‚</p>
<p><strong>âœ… æ­£ç¡®åšæ³•</strong>ï¼š</p>
<ul>
<li>åœ¨æ‰§è¡Œ UPDATE è¯­å¥å‰ï¼Œå…ˆç”¨ SELECT è¯­å¥æ¥æµ‹è¯• WHERE æ¡ä»¶æ˜¯å¦ç­›é€‰å‡ºäº†æœŸæœ›çš„è®°å½•é›†</li>
<li>å¯¹äºé‡è¦çš„æ•°æ®æ›´æ–°æ“ä½œï¼Œå»ºè®®å…ˆåœ¨æµ‹è¯•ç¯å¢ƒä¸­æ‰§è¡Œï¼Œç¡®è®¤æ— è¯¯åå†åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ‰§è¡Œ</li>
<li>åœ¨ MySQL ä¸­å¯ä»¥é€šè¿‡è®¾ç½® <code>sql_safe_updates = 1</code> æ¥å¼ºåˆ¶è¦æ±‚ WHERE æ¡ä»¶</li>
</ul>
<p><strong>MySQL å®‰å…¨æ¨¡å¼è®¾ç½®</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- å¼€å¯å®‰å…¨æ›´æ–°æ¨¡å¼ï¼Œå¼ºåˆ¶è¦æ±‚ WHERE æ¡ä»¶</span>
<span class="hljs-keyword">SET</span> sql_safe_updates <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
</code></pre>
<p>å¼€å¯åï¼Œå¦‚æœæ‰§è¡Œæ²¡æœ‰ WHERE æ¡ä»¶çš„ UPDATE è¯­å¥ï¼ŒMySQL ä¼šæŠ¥é”™ï¼Œä»è€Œé¿å…è¯¯æ“ä½œã€‚</p>
<hr/>
<h3 data-id="heading-30">ğŸ”¢ UPDATE ä¸è¡¨è¾¾å¼</h3>
<p>åœ¨ UPDATE è¯­å¥ä¸­ï¼Œæ›´æ–°å­—æ®µæ—¶å¯ä»¥ä½¿ç”¨è¡¨è¾¾å¼è¿›è¡Œè®¡ç®—ã€‚</p>
<h4 data-id="heading-31">è¡¨è¾¾å¼æ›´æ–°ç¤ºä¾‹</h4>
<p><strong>åœºæ™¯</strong>ï¼šç»™æ‰€æœ‰æˆç»©ä½äº 80 çš„å­¦ç”Ÿçš„æˆç»©åŠ  10 åˆ†</p>
<p><strong>è¯­æ³•</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">UPDATE</span> table_name
<span class="hljs-keyword">SET</span> <span class="hljs-keyword">column</span> <span class="hljs-operator">=</span> expression
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">condition</span>;
</code></pre>
<p><strong>å®é™…ä¾‹å­</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- å°†æ‰€æœ‰æˆç»©ä½äº 80 çš„å­¦ç”Ÿçš„æˆç»©åŠ  10 åˆ†</span>
<span class="hljs-keyword">UPDATE</span> students 
<span class="hljs-keyword">SET</span> score <span class="hljs-operator">=</span> score <span class="hljs-operator">+</span> <span class="hljs-number">10</span> 
<span class="hljs-keyword">WHERE</span> score <span class="hljs-operator">&lt;</span> <span class="hljs-number">80</span>;
</code></pre>
<p><strong>é€è¡Œä»£ç è§£é‡Š</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- UPDATE studentsï¼šæŒ‡å®šè¦æ›´æ–° students è¡¨</span>
<span class="hljs-keyword">UPDATE</span> students 

<span class="hljs-comment">-- SET score = score + 10ï¼šå°†å½“å‰è¡Œçš„ score å­—æ®µçš„å€¼åŠ ä¸Š 10</span>
<span class="hljs-comment">-- æ³¨æ„ï¼šè¿™é‡Œä½¿ç”¨äº†è¡¨è¾¾å¼ score + 10ï¼Œè€Œä¸æ˜¯ç›´æ¥èµ‹å€¼</span>
<span class="hljs-keyword">SET</span> score <span class="hljs-operator">=</span> score <span class="hljs-operator">+</span> <span class="hljs-number">10</span> 

<span class="hljs-comment">-- WHERE score &lt; 80ï¼šåªæ›´æ–°æˆç»©ä½äº 80 çš„è®°å½•</span>
<span class="hljs-keyword">WHERE</span> score <span class="hljs-operator">&lt;</span> <span class="hljs-number">80</span>;
</code></pre>
<p><strong>è¡¨è¾¾å¼è¯´æ˜</strong>ï¼š</p>
<ul>
<li><code>score + 10</code> æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œè¡¨ç¤ºå°†å½“å‰è®°å½•çš„ score å€¼åŠ ä¸Š 10</li>
<li>è¡¨è¾¾å¼å¯ä»¥ä½¿ç”¨ <code>+</code>ã€<code>-</code>ã€<code>*</code>ã€<code>/</code> ç­‰è¿ç®—ç¬¦</li>
<li>è¡¨è¾¾å¼å¯ä»¥å¼•ç”¨å½“å‰è®°å½•çš„å­—æ®µå€¼</li>
</ul>
<p><strong>æ›´å¤šç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ç¤ºä¾‹ 1ï¼šå°†æ‰€æœ‰ä»·æ ¼ä½äº 100 çš„å•†å“ä»·æ ¼æé«˜ 10%</span>
<span class="hljs-keyword">UPDATE</span> products 
<span class="hljs-keyword">SET</span> price <span class="hljs-operator">=</span> price <span class="hljs-operator">*</span> <span class="hljs-number">1.1</span> 
<span class="hljs-keyword">WHERE</span> price <span class="hljs-operator">&lt;</span> <span class="hljs-number">100</span>;

<span class="hljs-comment">-- ç¤ºä¾‹ 2ï¼šç»™æ‰€æœ‰ç”¨æˆ·çš„ç§¯åˆ†å¢åŠ  10 åˆ†ï¼ˆæ— æ¡ä»¶ï¼Œæ›´æ–°æ‰€æœ‰è®°å½•ï¼‰</span>
<span class="hljs-keyword">UPDATE</span> users
<span class="hljs-keyword">SET</span> points <span class="hljs-operator">=</span> points <span class="hljs-operator">+</span> <span class="hljs-number">10</span>;
</code></pre>
<p><strong>âš ï¸ æ³¨æ„äº‹é¡¹</strong>ï¼š</p>
<ul>
<li>è¡¨è¾¾å¼ä¸­çš„å­—æ®µåä¼šå¼•ç”¨å½“å‰è®°å½•çš„å€¼</li>
<li>è¡¨è¾¾å¼è®¡ç®—æ˜¯åœ¨æ›´æ–°æ—¶è¿›è¡Œçš„ï¼Œä¸æ˜¯æŸ¥è¯¢æ—¶</li>
<li>ä½¿ç”¨è¡¨è¾¾å¼æ›´æ–°æ—¶ï¼Œè¦ç¡®ä¿è¡¨è¾¾å¼çš„ç»“æœç±»å‹ä¸å­—æ®µç±»å‹å…¼å®¹</li>
</ul>
<hr/>
<h3 data-id="heading-32">ğŸ”— UPDATE ä¸å­æŸ¥è¯¢</h3>
<p>UPDATE è¯­å¥å¯ä»¥ä¸å­æŸ¥è¯¢ç»“åˆä½¿ç”¨ï¼Œæ ¹æ®å…¶ä»–è¡¨çš„æ•°æ®æ¥æ›´æ–°å½“å‰è¡¨ã€‚è¿™æ˜¯ UPDATE çš„é«˜çº§ç”¨æ³•ä¹‹ä¸€ã€‚</p>
<h4 data-id="heading-33">1ï¸âƒ£ ä½¿ç”¨å­æŸ¥è¯¢æ›´æ–°å•å­—æ®µ â­ Should</h4>
<p><strong>åœºæ™¯</strong>ï¼šæ ¹æ®éƒ¨é—¨è¡¨æ›´æ–°å‘˜å·¥è¡¨çš„éƒ¨é—¨åç§°</p>
<p><strong>è¯­æ³•</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">UPDATE</span> table1 
<span class="hljs-keyword">SET</span> column1 <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">column</span> <span class="hljs-keyword">FROM</span> table2 [<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">condition</span>])
<span class="hljs-keyword">WHERE</span> table1.column2 <span class="hljs-operator">=</span> <span class="hljs-keyword">value</span>;
</code></pre>
<p><strong>å®é™…ä¾‹å­</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æ ¹æ®éƒ¨é—¨è¡¨æ›´æ–°å‘˜å·¥è¡¨çš„éƒ¨é—¨åç§°</span>
<span class="hljs-keyword">UPDATE</span> emp e
<span class="hljs-keyword">SET</span> e.dname <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> d.dname <span class="hljs-keyword">FROM</span> dept d <span class="hljs-keyword">WHERE</span> e.deptno <span class="hljs-operator">=</span> d.deptno);
</code></pre>
<p><strong>é€è¡Œä»£ç è§£é‡Š</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- UPDATE emp eï¼šæŒ‡å®šè¦æ›´æ–° emp è¡¨ï¼Œä½¿ç”¨åˆ«å e</span>
<span class="hljs-keyword">UPDATE</span> emp e

<span class="hljs-comment">-- SET e.dname = (å­æŸ¥è¯¢)ï¼šå°† dname å­—æ®µè®¾ç½®ä¸ºå­æŸ¥è¯¢çš„ç»“æœ</span>
<span class="hljs-comment">-- å­æŸ¥è¯¢ï¼šä» dept è¡¨ä¸­æŸ¥è¯¢ä¸å½“å‰å‘˜å·¥éƒ¨é—¨ç¼–å·åŒ¹é…çš„éƒ¨é—¨åç§°</span>
<span class="hljs-keyword">SET</span> e.dname <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> d.dname <span class="hljs-keyword">FROM</span> dept d <span class="hljs-keyword">WHERE</span> e.deptno <span class="hljs-operator">=</span> d.deptno)

<span class="hljs-comment">-- æ³¨æ„ï¼šè¿™é‡Œæ²¡æœ‰ WHERE æ¡ä»¶ï¼Œä¼šæ›´æ–°æ‰€æœ‰è®°å½•</span>
<span class="hljs-comment">-- ä½†å­æŸ¥è¯¢ä¸­çš„æ¡ä»¶ e.deptno = d.deptno ç¡®ä¿äº†åªæ›´æ–°æœ‰åŒ¹é…éƒ¨é—¨çš„è®°å½•</span>
</code></pre>
<p><strong>æ›´å¤šç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ç¤ºä¾‹ 1ï¼šæ ¹æ®è®¢å•è¡¨æ›´æ–°è®¢å•çŠ¶æ€</span>
<span class="hljs-keyword">UPDATE</span> orders 
<span class="hljs-keyword">SET</span> status <span class="hljs-operator">=</span> <span class="hljs-string">'Shipped'</span> 
<span class="hljs-keyword">WHERE</span> customer_id <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> id <span class="hljs-keyword">FROM</span> customers <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'John Doe'</span>);

<span class="hljs-comment">-- ç¤ºä¾‹ 2ï¼šæ ¹æ®è¯¦æƒ…è¡¨æ›´æ–°è®¢å•è¡¨çš„è®¢å•åç§°</span>
<span class="hljs-keyword">UPDATE</span> t_order t1
<span class="hljs-keyword">SET</span> ordername <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> detailname <span class="hljs-keyword">FROM</span> t_detail 
                 <span class="hljs-keyword">WHERE</span> t_detail.detailclasses <span class="hljs-operator">=</span> t1.classes)
<span class="hljs-keyword">WHERE</span> t1.orderid <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
</code></pre>
<h4 data-id="heading-34">2ï¸âƒ£ ä½¿ç”¨å­æŸ¥è¯¢æ›´æ–°å¤šå­—æ®µ â­ Should</h4>
<p><strong>åœºæ™¯</strong>ï¼šåŒæ—¶æ ¹æ®å…¶ä»–è¡¨æ›´æ–°å¤šä¸ªå­—æ®µ</p>
<p><strong>è¯­æ³•ï¼ˆOracleï¼‰</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">UPDATE</span> table1 alias
<span class="hljs-keyword">SET</span> (column_name, column_name) <span class="hljs-operator">=</span> (
    <span class="hljs-keyword">SELECT</span> column_name, column_name 
    <span class="hljs-keyword">FROM</span> table2 
    <span class="hljs-keyword">WHERE</span> table2.column_name <span class="hljs-operator">=</span> alias.column_name
)
[<span class="hljs-keyword">WHERE</span> column_name <span class="hljs-operator">=</span> <span class="hljs-keyword">VALUE</span>]
</code></pre>
<p><strong>å®é™…ä¾‹å­</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- åŒæ—¶æ›´æ–°å­¦ç”Ÿè¡¨çš„å§“åå’Œæ€§åˆ«ï¼ˆOracle è¯­æ³•ï¼‰</span>
<span class="hljs-keyword">UPDATE</span> stu t 
<span class="hljs-keyword">SET</span> (t.NAME, t.SEX) <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> t1.NAME, t1.SEX 
                       <span class="hljs-keyword">FROM</span> stu1 t1 
                       <span class="hljs-keyword">WHERE</span> t1.ID <span class="hljs-operator">=</span> t.ID)
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">EXISTS</span>(<span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span> <span class="hljs-keyword">FROM</span> stu1 t2 <span class="hljs-keyword">WHERE</span> t2.ID <span class="hljs-operator">=</span> t.ID);
</code></pre>
<p><strong>é€è¡Œä»£ç è§£é‡Š</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- UPDATE stu tï¼šæŒ‡å®šè¦æ›´æ–° stu è¡¨ï¼Œä½¿ç”¨åˆ«å t</span>
<span class="hljs-keyword">UPDATE</span> stu t 

<span class="hljs-comment">-- SET (t.NAME, t.SEX) = (å­æŸ¥è¯¢)ï¼šåŒæ—¶æ›´æ–° NAME å’Œ SEX ä¸¤ä¸ªå­—æ®µ</span>
<span class="hljs-comment">-- å­æŸ¥è¯¢è¿”å›ä¸¤ä¸ªå­—æ®µï¼šNAME å’Œ SEX</span>
<span class="hljs-keyword">SET</span> (t.NAME, t.SEX) <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> t1.NAME, t1.SEX 
                       <span class="hljs-keyword">FROM</span> stu1 t1 
                       <span class="hljs-keyword">WHERE</span> t1.ID <span class="hljs-operator">=</span> t.ID)

<span class="hljs-comment">-- WHERE EXISTS(...)ï¼šåªæ›´æ–°åœ¨ stu1 è¡¨ä¸­å­˜åœ¨å¯¹åº” ID çš„è®°å½•</span>
<span class="hljs-comment">-- è¿™æ˜¯éå¸¸é‡è¦çš„ï¼å¦‚æœä¸åŠ  EXISTS æ¡ä»¶ï¼Œä¸åŒ¹é…çš„è®°å½•ä¼šè¢«æ›´æ–°ä¸º NULL</span>
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">EXISTS</span>(<span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span> <span class="hljs-keyword">FROM</span> stu1 t2 <span class="hljs-keyword">WHERE</span> t2.ID <span class="hljs-operator">=</span> t.ID);
</code></pre>
<p><strong>âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹</strong>ï¼š</p>
<p>å¤šè¡¨å…³è” UPDATE çš„æ—¶å€™ï¼Œ<strong>è®°å¾—è¦åŠ  EXISTS() æ¡ä»¶</strong>ï¼Œå¦åˆ™ä¸æ»¡è¶³æ¡ä»¶çš„è®°å½•è¢« UPDATE æˆ NULLã€‚</p>
<p><strong>é”™è¯¯ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âŒ é”™è¯¯ï¼æ²¡æœ‰ EXISTS æ¡ä»¶</span>
<span class="hljs-keyword">UPDATE</span> stu t 
<span class="hljs-keyword">SET</span> t.NAME <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> t1.NAME <span class="hljs-keyword">FROM</span> stu1 t1 <span class="hljs-keyword">WHERE</span> t1.ID <span class="hljs-operator">=</span> t.ID);
</code></pre>
<p><strong>é—®é¢˜</strong>ï¼šå¦‚æœ stu è¡¨ä¸­å­˜åœ¨æŸä¸ª IDï¼Œä½† stu1 è¡¨ä¸­ä¸å­˜åœ¨å¯¹åº”çš„ IDï¼Œé‚£ä¹ˆå­æŸ¥è¯¢ä¼šè¿”å› NULLï¼Œå¯¼è‡´ stu è¡¨ä¸­è¯¥è®°å½•çš„ NAME å­—æ®µè¢«æ›´æ–°ä¸º NULLã€‚</p>
<p><strong>âœ… æ­£ç¡®åšæ³•</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âœ… æ­£ç¡®ï¼æ·»åŠ äº† EXISTS æ¡ä»¶</span>
<span class="hljs-keyword">UPDATE</span> stu t 
<span class="hljs-keyword">SET</span> t.NAME <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> t1.NAME <span class="hljs-keyword">FROM</span> stu1 t1 <span class="hljs-keyword">WHERE</span> t1.ID <span class="hljs-operator">=</span> t.ID)
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">EXISTS</span>(<span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span> <span class="hljs-keyword">FROM</span> stu1 t2 <span class="hljs-keyword">WHERE</span> t2.ID <span class="hljs-operator">=</span> t.ID);
</code></pre>
<p><strong>æ›´å¤šç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ç¤ºä¾‹ 1ï¼šåŒæ—¶æ›´æ–°è®¢å•è¡¨çš„è®¢å•åç§°å’Œè®¢å•ä»·æ ¼</span>
<span class="hljs-keyword">UPDATE</span> t_order t1
<span class="hljs-keyword">SET</span> (ordername, orderprice) <span class="hljs-operator">=</span> (
    <span class="hljs-keyword">SELECT</span> detailname, totalprice 
    <span class="hljs-keyword">FROM</span> t_detail 
    <span class="hljs-keyword">WHERE</span> t_detail.detailclasses <span class="hljs-operator">=</span> t1.classes
)
<span class="hljs-keyword">WHERE</span> t1.orderid <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

<span class="hljs-comment">-- ç¤ºä¾‹ 2ï¼šåŒæ—¶æ›´æ–°è¡¨ A çš„ä¸‰ä¸ªå­—æ®µ</span>
<span class="hljs-keyword">UPDATE</span> A 
<span class="hljs-keyword">SET</span> (A1, A2, A3) <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> B1, B2, B3 <span class="hljs-keyword">FROM</span> B <span class="hljs-keyword">WHERE</span> A.ID <span class="hljs-operator">=</span> B.ID)
<span class="hljs-keyword">WHERE</span> ID <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> B.ID <span class="hljs-keyword">FROM</span> B <span class="hljs-keyword">WHERE</span> A.ID <span class="hljs-operator">=</span> B.ID);
</code></pre>
<hr/>
<h3 data-id="heading-35">ğŸ”€ å¤šè¡¨å…³è”æ›´æ–°</h3>
<p>å¤šè¡¨å…³è”æ›´æ–°æ˜¯æŒ‡æ ¹æ®å¤šä¸ªè¡¨ä¹‹é—´çš„å…³è”å…³ç³»æ¥æ›´æ–°æ•°æ®ã€‚ä¸åŒæ•°æ®åº“çš„è¯­æ³•ç•¥æœ‰ä¸åŒã€‚</p>
<h4 data-id="heading-36">1ï¸âƒ£ MySQL å¤šè¡¨å…³è”æ›´æ–° â­ Should</h4>
<p><strong>è¯­æ³•</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">UPDATE</span> table1 
<span class="hljs-keyword">INNER</span><span class="hljs-operator">|</span><span class="hljs-keyword">LEFT</span><span class="hljs-operator">|</span><span class="hljs-keyword">RIGHT</span> <span class="hljs-keyword">JOIN</span> table2 
<span class="hljs-keyword">ON</span> <span class="hljs-keyword">condition</span>
<span class="hljs-keyword">SET</span> column1 <span class="hljs-operator">=</span> value1, column2 <span class="hljs-operator">=</span> value2, ...
[<span class="hljs-keyword">WHERE</span> conditions];
</code></pre>
<p><strong>å®é™…ä¾‹å­</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æ ¹æ®ç”¨æˆ·æ”¶å…¥è¡¨æ›´æ–°ç”¨æˆ·ä½™é¢è¡¨</span>
<span class="hljs-keyword">UPDATE</span> $table1 a 
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> $table2 b
<span class="hljs-keyword">ON</span> a.user_id <span class="hljs-operator">=</span> b.user_id 
<span class="hljs-keyword">SET</span> a.balance <span class="hljs-operator">=</span> a.balance <span class="hljs-operator">+</span> b.income, b.status <span class="hljs-operator">=</span> <span class="hljs-number">1</span> 
<span class="hljs-keyword">WHERE</span> b.id <span class="hljs-operator">=</span> <span class="hljs-number">5</span> <span class="hljs-keyword">AND</span> b.status <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
</code></pre>
<p><strong>é€è¡Œä»£ç è§£é‡Š</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- UPDATE $table1 aï¼šæŒ‡å®šè¦æ›´æ–°çš„ä¸»è¡¨ï¼Œä½¿ç”¨åˆ«å a</span>
<span class="hljs-keyword">UPDATE</span> $table1 a 

<span class="hljs-comment">-- INNER JOIN $table2 b ON a.user_id = b.user_idï¼šå…³è”è¡¨2ï¼Œå…³è”æ¡ä»¶æ˜¯ user_id ç›¸ç­‰</span>
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> $table2 b
<span class="hljs-keyword">ON</span> a.user_id <span class="hljs-operator">=</span> b.user_id 

<span class="hljs-comment">-- SET a.balance = a.balance + b.income, b.status = 1ï¼šæ›´æ–°ä¸¤ä¸ªè¡¨çš„å­—æ®µ</span>
<span class="hljs-comment">-- è¡¨1çš„ balance å­—æ®µå¢åŠ è¡¨2çš„ income å€¼</span>
<span class="hljs-comment">-- è¡¨2çš„ status å­—æ®µè®¾ç½®ä¸º 1</span>
<span class="hljs-keyword">SET</span> a.balance <span class="hljs-operator">=</span> a.balance <span class="hljs-operator">+</span> b.income, b.status <span class="hljs-operator">=</span> <span class="hljs-number">1</span> 

<span class="hljs-comment">-- WHERE b.id = 5 AND b.status = 0ï¼šåªæ›´æ–°ç¬¦åˆæ¡ä»¶çš„è®°å½•</span>
<span class="hljs-keyword">WHERE</span> b.id <span class="hljs-operator">=</span> <span class="hljs-number">5</span> <span class="hljs-keyword">AND</span> b.status <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
</code></pre>
<p><strong>æ›´å¤šç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ç¤ºä¾‹ 1ï¼šä½¿ç”¨å­æŸ¥è¯¢ä½œä¸ºå…³è”è¡¨</span>
<span class="hljs-keyword">UPDATE</span> A 
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> (<span class="hljs-keyword">SELECT</span> B.B1 <span class="hljs-keyword">as</span> B1, B.B2 <span class="hljs-keyword">as</span> B2, C.C1 <span class="hljs-keyword">as</span> C1 
            <span class="hljs-keyword">FROM</span> B 
            <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> C <span class="hljs-keyword">ON</span> B.B3 <span class="hljs-operator">=</span> C.C3) <span class="hljs-keyword">as</span> t
<span class="hljs-keyword">ON</span> A.A3 <span class="hljs-operator">=</span> t.B1
<span class="hljs-keyword">SET</span> A.A1 <span class="hljs-operator">=</span> t.B2, A.A2 <span class="hljs-operator">=</span> t.C1;

<span class="hljs-comment">-- ç¤ºä¾‹ 2ï¼šæ ¹æ®å›¾ä¹¦ä¿¡æ¯å’Œéƒ¨é—¨ä¿¡æ¯æ›´æ–°ä¹¦æ¶è¡¨</span>
<span class="hljs-keyword">UPDATE</span> tb_bookcase 
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> (<span class="hljs-keyword">SELECT</span> tb_bookinfo.rid <span class="hljs-keyword">as</span> rid, tb_bookinfo.bookname, department.name 
            <span class="hljs-keyword">FROM</span> tb_bookinfo 
            <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> department <span class="hljs-keyword">ON</span> tb_bookinfo.depid <span class="hljs-operator">=</span> department.id) <span class="hljs-keyword">as</span> t
<span class="hljs-keyword">ON</span> tb_bookcase.id <span class="hljs-operator">=</span> t.rid
<span class="hljs-keyword">SET</span> tb_bookcase.bookname <span class="hljs-operator">=</span> t.bookname, tb_bookcase.departname <span class="hljs-operator">=</span> t.name;
</code></pre>
<h4 data-id="heading-37">2ï¸âƒ£ SQL Server å¤šè¡¨å…³è”æ›´æ–° â­ Should</h4>
<p><strong>è¯­æ³•</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">UPDATE</span> table1 
<span class="hljs-keyword">SET</span> column1 <span class="hljs-operator">=</span> t2.column1, 
    column2 <span class="hljs-operator">=</span> t2.column2,
    ...  
<span class="hljs-keyword">FROM</span> table1 
<span class="hljs-keyword">INNER</span><span class="hljs-operator">/</span><span class="hljs-keyword">LEFT</span><span class="hljs-operator">/</span><span class="hljs-keyword">RIGHT</span> <span class="hljs-keyword">JOIN</span> table2 
<span class="hljs-keyword">ON</span> table1.column <span class="hljs-operator">=</span> table2.column
[<span class="hljs-keyword">WHERE</span> conditions]
</code></pre>
<p><strong>å®é™…ä¾‹å­</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æ ¹æ®è¡¨ B å’Œè¡¨ C çš„æ•°æ®æ›´æ–°è¡¨ A</span>
<span class="hljs-keyword">UPDATE</span> A
<span class="hljs-keyword">SET</span> A1 <span class="hljs-operator">=</span> t2.B2, A2 <span class="hljs-operator">=</span> t2.C1
<span class="hljs-keyword">FROM</span> A 
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> (<span class="hljs-keyword">SELECT</span> B.B1, B.B2, C.C1 
            <span class="hljs-keyword">FROM</span> B 
            <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> C <span class="hljs-keyword">ON</span> B.B3 <span class="hljs-operator">=</span> C.C3) t2 
<span class="hljs-keyword">ON</span> A.A3 <span class="hljs-operator">=</span> t2.B1
<span class="hljs-keyword">WHERE</span> A.A4 <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
</code></pre>
<p><strong>é€è¡Œä»£ç è§£é‡Š</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- UPDATE Aï¼šæŒ‡å®šè¦æ›´æ–°çš„è¡¨</span>
<span class="hljs-keyword">UPDATE</span> A

<span class="hljs-comment">-- SET A1 = t2.B2, A2 = t2.C1ï¼šè®¾ç½®è¦æ›´æ–°çš„å­—æ®µ</span>
<span class="hljs-keyword">SET</span> A1 <span class="hljs-operator">=</span> t2.B2, A2 <span class="hljs-operator">=</span> t2.C1

<span class="hljs-comment">-- FROM A INNER JOIN ...ï¼šåœ¨ FROM å­å¥ä¸­æŒ‡å®šå…³è”å…³ç³»</span>
<span class="hljs-keyword">FROM</span> A 
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> (<span class="hljs-keyword">SELECT</span> B.B1, B.B2, C.C1 
            <span class="hljs-keyword">FROM</span> B 
            <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> C <span class="hljs-keyword">ON</span> B.B3 <span class="hljs-operator">=</span> C.C3) t2 
<span class="hljs-keyword">ON</span> A.A3 <span class="hljs-operator">=</span> t2.B1

<span class="hljs-comment">-- WHERE A.A4 = 1ï¼šæŒ‡å®šæ›´æ–°æ¡ä»¶</span>
<span class="hljs-keyword">WHERE</span> A.A4 <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
</code></pre>
<p><strong>æ›´å¤šç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ç¤ºä¾‹ 1ï¼šæ ¹æ®è®¢å•è¡¨å’Œè¯¦æƒ…è¡¨æ›´æ–°å¼‚å¸¸è´¹ç”¨è¡¨</span>
<span class="hljs-keyword">UPDATE</span> t_abnormal_fee
<span class="hljs-keyword">SET</span> order_code <span class="hljs-operator">=</span> t2.order_code, return_fee <span class="hljs-operator">=</span> t2.express_fee
<span class="hljs-keyword">FROM</span> t_abnormal_fee 
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> (<span class="hljs-keyword">SELECT</span> t_order.id, t_order.order_code, t_detail.express_fee 
            <span class="hljs-keyword">FROM</span> t_order 
            <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> t_detail <span class="hljs-keyword">ON</span> t_order.name <span class="hljs-operator">=</span> t_detail.name) t2 
<span class="hljs-keyword">ON</span> t_abnormal_fee.id <span class="hljs-operator">=</span> t2.id
<span class="hljs-keyword">WHERE</span> t_abnormal_fee.id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
</code></pre>
<h4 data-id="heading-38">3ï¸âƒ£ ä½¿ç”¨å­æŸ¥è¯¢è¿›è¡Œå…³è”æ›´æ–° â­ Should</h4>
<p><strong>åœºæ™¯</strong>ï¼šä½¿ç”¨å­æŸ¥è¯¢æ–¹å¼å®ç°å¤šè¡¨å…³è”æ›´æ–°</p>
<p><strong>è¯­æ³•</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">UPDATE</span> t1 
<span class="hljs-keyword">SET</span> t1.`name` <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> t2.`name` <span class="hljs-keyword">FROM</span> t2 <span class="hljs-keyword">WHERE</span> t1.id <span class="hljs-operator">=</span> t2.id)
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">EXISTS</span>(<span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span> <span class="hljs-keyword">FROM</span> t2 <span class="hljs-keyword">WHERE</span> t2.id <span class="hljs-operator">=</span> t1.id);
</code></pre>
<p><strong>å®é™…ä¾‹å­</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æ ¹æ®è¡¨ t2 æ›´æ–°è¡¨ t1 çš„ name å­—æ®µ</span>
<span class="hljs-keyword">UPDATE</span> t1 
<span class="hljs-keyword">SET</span> t1.`name` <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> t2.`name` <span class="hljs-keyword">FROM</span> t2 <span class="hljs-keyword">WHERE</span> t1.id <span class="hljs-operator">=</span> t2.id)
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">EXISTS</span>(<span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span> <span class="hljs-keyword">FROM</span> t2 <span class="hljs-keyword">WHERE</span> t2.id <span class="hljs-operator">=</span> t1.id);
</code></pre>
<p><strong>é€è¡Œä»£ç è§£é‡Š</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- UPDATE t1ï¼šæŒ‡å®šè¦æ›´æ–°çš„è¡¨</span>
<span class="hljs-keyword">UPDATE</span> t1 

<span class="hljs-comment">-- SET t1.`name` = (å­æŸ¥è¯¢)ï¼šå°† name å­—æ®µè®¾ç½®ä¸ºå­æŸ¥è¯¢çš„ç»“æœ</span>
<span class="hljs-keyword">SET</span> t1.`name` <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> t2.`name` <span class="hljs-keyword">FROM</span> t2 <span class="hljs-keyword">WHERE</span> t1.id <span class="hljs-operator">=</span> t2.id)

<span class="hljs-comment">-- WHERE EXISTS(...)ï¼šåªæ›´æ–°åœ¨ t2 è¡¨ä¸­å­˜åœ¨å¯¹åº” id çš„è®°å½•</span>
<span class="hljs-comment">-- è¿™æ˜¯éå¸¸é‡è¦çš„ï¼é¿å…å°†ä¸åŒ¹é…çš„è®°å½•æ›´æ–°ä¸º NULL</span>
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">EXISTS</span>(<span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span> <span class="hljs-keyword">FROM</span> t2 <span class="hljs-keyword">WHERE</span> t2.id <span class="hljs-operator">=</span> t1.id);
</code></pre>
<hr/>
<h3 data-id="heading-39">ğŸŒ ä¸åŒæ•°æ®åº“è¯­æ³•å·®å¼‚</h3>
<p>ä¸åŒæ•°æ®åº“å¯¹ UPDATE è¯­å¥çš„æ”¯æŒç•¥æœ‰ä¸åŒï¼Œç‰¹åˆ«æ˜¯åœ¨å¤šè¡¨å…³è”æ›´æ–°æ–¹é¢ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹ä¸»è¦æ•°æ®åº“çš„å·®å¼‚ã€‚</p>
<h4 data-id="heading-40">MySQL</h4>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>æ”¯æŒä½¿ç”¨ JOIN è¿›è¡Œå¤šè¡¨æ›´æ–°</li>
<li>å¯ä»¥é€šè¿‡è®¾ç½® <code>sql_safe_updates</code> å¼ºåˆ¶è¦æ±‚ WHERE æ¡ä»¶</li>
<li>UPDATE è¯­å¥ä¼šè¿”å›æ›´æ–°çš„è¡Œæ•°</li>
</ul>
<p><strong>å¤šè¡¨æ›´æ–°è¯­æ³•</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">UPDATE</span> table1 
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> table2 <span class="hljs-keyword">ON</span> <span class="hljs-keyword">condition</span>
<span class="hljs-keyword">SET</span> column1 <span class="hljs-operator">=</span> value1
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">condition</span>;
</code></pre>
<p><strong>å®‰å…¨æ¨¡å¼è®¾ç½®</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- å¼€å¯å®‰å…¨æ›´æ–°æ¨¡å¼ï¼Œå¼ºåˆ¶è¦æ±‚ WHERE æ¡ä»¶</span>
<span class="hljs-keyword">SET</span> sql_safe_updates <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
</code></pre>
<p><strong>è¿”å›ç»“æœç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æ›´æ–° id=1 çš„è®°å½•</span>
mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">UPDATE</span> students <span class="hljs-keyword">SET</span> name<span class="hljs-operator">=</span><span class="hljs-string">'å¤§å®'</span> <span class="hljs-keyword">WHERE</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span>;
Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.00</span> sec)
<span class="hljs-keyword">Rows</span> matched: <span class="hljs-number">1</span>  Changed: <span class="hljs-number">1</span>  Warnings: <span class="hljs-number">0</span>

<span class="hljs-comment">-- æ›´æ–° id=999 çš„è®°å½•ï¼ˆä¸å­˜åœ¨ï¼‰</span>
mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">UPDATE</span> students <span class="hljs-keyword">SET</span> name<span class="hljs-operator">=</span><span class="hljs-string">'å¤§å®'</span> <span class="hljs-keyword">WHERE</span> id<span class="hljs-operator">=</span><span class="hljs-number">999</span>;
Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.00</span> sec)
<span class="hljs-keyword">Rows</span> matched: <span class="hljs-number">0</span>  Changed: <span class="hljs-number">0</span>  Warnings: <span class="hljs-number">0</span>
</code></pre>
<h4 data-id="heading-41">Oracle</h4>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>æ”¯æŒä½¿ç”¨å­æŸ¥è¯¢æ›´æ–°å¤šå­—æ®µ</li>
<li>è¯­æ³•è¾ƒä¸ºç‰¹æ®Šï¼Œä½¿ç”¨æ‹¬å·åŒ…è£¹å¤šä¸ªå­—æ®µ</li>
</ul>
<p><strong>å¤šå­—æ®µæ›´æ–°è¯­æ³•</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">UPDATE</span> table1 alias
<span class="hljs-keyword">SET</span> (column_name, column_name) <span class="hljs-operator">=</span> (
    <span class="hljs-keyword">SELECT</span> column_name, column_name 
    <span class="hljs-keyword">FROM</span> table2 
    <span class="hljs-keyword">WHERE</span> table2.column_name <span class="hljs-operator">=</span> alias.column_name
)
[<span class="hljs-keyword">WHERE</span> column_name <span class="hljs-operator">=</span> <span class="hljs-keyword">VALUE</span>]
</code></pre>
<h4 data-id="heading-42">SQL Server</h4>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>æ”¯æŒä½¿ç”¨ FROM å­å¥è¿›è¡Œå¤šè¡¨æ›´æ–°</li>
<li>è¯­æ³•ä¸ MySQL ä¸åŒï¼ŒUPDATE å’Œ FROM åˆ†å¼€å†™</li>
</ul>
<p><strong>å¤šè¡¨æ›´æ–°è¯­æ³•</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">UPDATE</span> table1 
<span class="hljs-keyword">SET</span> column1 <span class="hljs-operator">=</span> t2.column1
<span class="hljs-keyword">FROM</span> table1 
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> table2 <span class="hljs-keyword">ON</span> <span class="hljs-keyword">condition</span>
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">condition</span>;
</code></pre>
<h4 data-id="heading-43">PostgreSQL</h4>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>æ”¯æŒä½¿ç”¨ ON CONFLICT è¿›è¡Œæ’å…¥æˆ–æ›´æ–°æ“ä½œï¼ˆUPSERTï¼‰</li>
<li>è¯­æ³•è¾ƒä¸ºçµæ´»</li>
</ul>
<p><strong>UPSERT è¯­æ³•</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> table_name (column1, column2, ...)
<span class="hljs-keyword">VALUES</span> (value1, value2, ...)
<span class="hljs-keyword">ON</span> CONFLICT (conflict_column) 
DO <span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">SET</span> column1 <span class="hljs-operator">=</span> EXCLUDED.column1;
</code></pre>
<h4 data-id="heading-44">è¯­æ³•å¯¹æ¯”è¡¨</h4>






























<table><thead><tr><th>æ•°æ®åº“</th><th>å¤šè¡¨æ›´æ–°è¯­æ³•</th><th>ç‰¹ç‚¹</th></tr></thead><tbody><tr><td>MySQL</td><td><code>UPDATE t1 JOIN t2 ON ... SET ...</code></td><td>æ”¯æŒ JOINï¼Œè¯­æ³•ç®€æ´</td></tr><tr><td>SQL Server</td><td><code>UPDATE t1 SET ... FROM t1 JOIN t2 ON ...</code></td><td>ä½¿ç”¨ FROM å­å¥</td></tr><tr><td>Oracle</td><td><code>UPDATE t1 SET (col1, col2) = (SELECT ...)</code></td><td>æ”¯æŒå¤šå­—æ®µå­æŸ¥è¯¢æ›´æ–°</td></tr><tr><td>PostgreSQL</td><td><code>UPDATE t1 SET ... FROM t2 WHERE ...</code></td><td>ç±»ä¼¼ SQL Serverï¼Œæ”¯æŒ UPSERT</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-45">âš ï¸ æ³¨æ„äº‹é¡¹å’Œè­¦å‘Š</h3>
<p>åœ¨ä½¿ç”¨ UPDATE è¯­å¥æ—¶ï¼Œæœ‰ä¸€äº›é‡è¦çš„æ³¨æ„äº‹é¡¹å’Œè­¦å‘Šéœ€è¦ç‰¢è®°ã€‚</p>
<h4 data-id="heading-46">1ï¸âƒ£ WHERE å­å¥çš„é‡è¦æ€§ âš ï¸</h4>
<p><strong>é‡è¦è­¦å‘Š</strong>ï¼šåœ¨æ›´æ–°è®°å½•æ—¶è¦æ ¼å¤–å°å¿ƒï¼å¦‚æœçœç•¥äº† WHERE å­å¥ï¼Œæ‰€æœ‰çš„è®°å½•éƒ½å°†è¢«æ›´æ–°ï¼</p>
<p><strong>é”™è¯¯ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âŒ å±é™©ï¼è¿™ä¼šæ›´æ–°æ‰€æœ‰è®°å½•</span>
<span class="hljs-keyword">UPDATE</span> Customers
<span class="hljs-keyword">SET</span> ContactName <span class="hljs-operator">=</span> <span class="hljs-string">'Juan'</span>;
</code></pre>
<p><strong>æ‰§è¡Œç»“æœ</strong>ï¼šè¡¨ä¸­æ‰€æœ‰è®°å½•çš„ ContactName å­—æ®µéƒ½ä¼šè¢«æ›´æ–°ä¸º 'Juan'ï¼Œè¿™é€šå¸¸ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœï¼</p>
<p><strong>âœ… æ­£ç¡®åšæ³•</strong>ï¼š</p>
<ul>
<li>å§‹ç»ˆä½¿ç”¨ WHERE å­å¥æŒ‡å®šæ›´æ–°æ¡ä»¶</li>
<li>åœ¨æ‰§è¡Œ UPDATE å‰ï¼Œå…ˆç”¨ SELECT è¯­å¥æµ‹è¯• WHERE æ¡ä»¶</li>
<li>åœ¨ MySQL ä¸­å¼€å¯ <code>sql_safe_updates</code> æ¨¡å¼</li>
</ul>
<p><strong>æ‰§è¡Œæ²¡æœ‰ WHERE å­å¥çš„ UPDATE è¦æ…é‡ï¼Œå†æ…é‡ï¼</strong></p>
<h4 data-id="heading-47">2ï¸âƒ£ æ›´æ–°å‰æ£€æŸ¥</h4>
<p>åœ¨æ‰§è¡Œ UPDATE è¯­å¥æ—¶ï¼ŒåŠ¡å¿…è°¨æ…ï¼Œå› ä¸ºä¸€æ—¦æ‰§è¡Œï¼Œå°±ä¼šç›´æ¥ä¿®æ”¹æ•°æ®åº“ä¸­çš„æ•°æ®ã€‚</p>
<p><strong>å»ºè®®æµç¨‹</strong>ï¼š</p>
<ol>
<li><strong>å…ˆç”¨ SELECT æµ‹è¯•</strong>ï¼š</li>
</ol>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ç¬¬ä¸€æ­¥ï¼šå…ˆç”¨ SELECT æŸ¥çœ‹ä¼šæ›´æ–°å“ªäº›è®°å½•</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> students <span class="hljs-keyword">WHERE</span> score <span class="hljs-operator">&lt;</span> <span class="hljs-number">80</span>;

<span class="hljs-comment">-- ç¬¬äºŒæ­¥ï¼šç¡®è®¤æ— è¯¯åï¼Œå†æ‰§è¡Œ UPDATE</span>
<span class="hljs-keyword">UPDATE</span> students 
<span class="hljs-keyword">SET</span> score <span class="hljs-operator">=</span> score <span class="hljs-operator">+</span> <span class="hljs-number">10</span> 
<span class="hljs-keyword">WHERE</span> score <span class="hljs-operator">&lt;</span> <span class="hljs-number">80</span>;
</code></pre>
<ol start="2">
<li>
<p><strong>æµ‹è¯•ç¯å¢ƒéªŒè¯</strong>ï¼š</p>
<ul>
<li>å¯¹äºé‡è¦çš„æ•°æ®æ›´æ–°æ“ä½œï¼Œå»ºè®®å…ˆåœ¨æµ‹è¯•ç¯å¢ƒä¸­æ‰§è¡Œ</li>
<li>ç¡®è®¤æ— è¯¯åå†åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ‰§è¡Œ</li>
</ul>
</li>
<li>
<p><strong>å¤‡ä»½æ•°æ®</strong>ï¼š</p>
<ul>
<li>æ›´æ–°é‡è¦æ•°æ®å‰ï¼Œå»ºè®®å…ˆå¤‡ä»½ç›¸å…³è¡¨</li>
<li>è¿™æ ·å¯ä»¥åœ¨å‡ºé”™æ—¶å¿«é€Ÿæ¢å¤</li>
</ul>
</li>
</ol>
<h4 data-id="heading-48">3ï¸âƒ£ å¤šè¡¨å…³è”æ›´æ–°çš„æ³¨æ„äº‹é¡¹</h4>
<p><strong>âš ï¸ é‡è¦æé†’</strong>ï¼šå¤šè¡¨å…³è” UPDATE çš„æ—¶å€™ï¼Œè®°å¾—è¦åŠ  EXISTS() æ¡ä»¶ï¼Œå¦åˆ™ä¸æ»¡è¶³æ¡ä»¶çš„è®°å½•è¢« UPDATE æˆ NULLã€‚</p>
<p><strong>é”™è¯¯ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âŒ é”™è¯¯ï¼æ²¡æœ‰ EXISTS æ¡ä»¶</span>
<span class="hljs-keyword">UPDATE</span> stu t 
<span class="hljs-keyword">SET</span> t.NAME <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> t1.NAME <span class="hljs-keyword">FROM</span> stu1 t1 <span class="hljs-keyword">WHERE</span> t1.ID <span class="hljs-operator">=</span> t.ID);
</code></pre>
<p><strong>é—®é¢˜</strong>ï¼šå¦‚æœ stu è¡¨ä¸­å­˜åœ¨æŸä¸ª IDï¼Œä½† stu1 è¡¨ä¸­ä¸å­˜åœ¨å¯¹åº”çš„ IDï¼Œé‚£ä¹ˆå­æŸ¥è¯¢ä¼šè¿”å› NULLï¼Œå¯¼è‡´ stu è¡¨ä¸­è¯¥è®°å½•çš„ NAME å­—æ®µè¢«æ›´æ–°ä¸º NULLã€‚</p>
<p><strong>âœ… æ­£ç¡®åšæ³•</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âœ… æ­£ç¡®ï¼æ·»åŠ äº† EXISTS æ¡ä»¶</span>
<span class="hljs-keyword">UPDATE</span> stu t 
<span class="hljs-keyword">SET</span> t.NAME <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> t1.NAME <span class="hljs-keyword">FROM</span> stu1 t1 <span class="hljs-keyword">WHERE</span> t1.ID <span class="hljs-operator">=</span> t.ID)
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">EXISTS</span>(<span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span> <span class="hljs-keyword">FROM</span> stu1 t2 <span class="hljs-keyword">WHERE</span> t2.ID <span class="hljs-operator">=</span> t.ID);
</code></pre>
<h4 data-id="heading-49">4ï¸âƒ£ æ— åŒ¹é…è®°å½•çš„å¤„ç†</h4>
<p>å¦‚æœ WHERE æ¡ä»¶æ²¡æœ‰åŒ¹é…åˆ°ä»»ä½•è®°å½•ï¼ŒUPDATE è¯­å¥ä¸ä¼šæŠ¥é”™ï¼Œä¹Ÿä¸ä¼šæœ‰ä»»ä½•è®°å½•è¢«æ›´æ–°ã€‚</p>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æ›´æ–° id ä¸º 999 çš„è®°å½•ï¼ˆå‡è®¾ä¸å­˜åœ¨ï¼‰</span>
<span class="hljs-keyword">UPDATE</span> students 
<span class="hljs-keyword">SET</span> score <span class="hljs-operator">=</span> <span class="hljs-number">100</span> 
<span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">999</span>;
</code></pre>
<p><strong>æ‰§è¡Œç»“æœ</strong>ï¼š</p>
<ul>
<li>âœ… ä¸ä¼šæŠ¥é”™</li>
<li>âœ… ä¸ä¼šæ›´æ–°ä»»ä½•è®°å½•</li>
<li>âœ… MySQL ä¼šè¿”å› <code>Rows matched: 0  Changed: 0</code></li>
</ul>
<p><strong>å»ºè®®</strong>ï¼šå¦‚æœéœ€è¦ç¡®è®¤æ˜¯å¦æœ‰è®°å½•è¢«æ›´æ–°ï¼Œå¯ä»¥æ£€æŸ¥ UPDATE è¯­å¥çš„è¿”å›ç»“æœã€‚</p>
<h4 data-id="heading-50">5ï¸âƒ£ è®¾ç½®å­—æ®µä¸º NULL</h4>
<p>ä¸ºäº†åˆ é™¤æŸä¸ªåˆ—çš„å€¼ï¼Œå¯è®¾ç½®å®ƒä¸º NULLï¼ˆå‡å®šè¡¨å®šä¹‰å…è®¸ NULL å€¼ï¼‰ã€‚</p>
<p><strong>è¯­æ³•</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">UPDATE</span> table_name
<span class="hljs-keyword">SET</span> column_name <span class="hljs-operator">=</span> <span class="hljs-keyword">NULL</span>
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">condition</span>;
</code></pre>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- å°†æŸä¸ªå­¦ç”Ÿçš„å¤‡æ³¨å­—æ®µæ¸…ç©º</span>
<span class="hljs-keyword">UPDATE</span> students 
<span class="hljs-keyword">SET</span> remark <span class="hljs-operator">=</span> <span class="hljs-keyword">NULL</span> 
<span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
</code></pre>
<p><strong>æ³¨æ„äº‹é¡¹</strong>ï¼š</p>
<ul>
<li>åªæœ‰å…è®¸ NULL å€¼çš„å­—æ®µæ‰èƒ½è®¾ç½®ä¸º NULL</li>
<li>å¦‚æœå­—æ®µæœ‰ NOT NULL çº¦æŸï¼Œè®¾ç½®ä¸º NULL ä¼šæŠ¥é”™</li>
</ul>
<hr/>
<h3 data-id="heading-51">ğŸš€ æ€§èƒ½ä¼˜åŒ–</h3>
<p>åœ¨å®é™…åº”ç”¨ä¸­ï¼ŒUPDATE è¯­å¥çš„æ€§èƒ½ä¼˜åŒ–éå¸¸é‡è¦ï¼Œç‰¹åˆ«æ˜¯å½“éœ€è¦æ›´æ–°å¤§é‡æ•°æ®æ—¶ã€‚</p>
<h4 data-id="heading-52">1ï¸âƒ£ ç´¢å¼•çš„ä½¿ç”¨ ğŸ’¡ Could</h4>
<p>å¯¹äº UPDATE è¯­å¥ä¸­æ¶‰åŠçš„åˆ—ï¼Œç¡®ä¿ç›¸åº”çš„åˆ—ä¸Šå»ºæœ‰ç´¢å¼•ï¼Œä»¥æé«˜æ£€ç´¢é€Ÿåº¦ã€‚</p>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- å¦‚æœç»å¸¸æ ¹æ® id æ›´æ–°è®°å½•ï¼Œç¡®ä¿ id å­—æ®µæœ‰ç´¢å¼•</span>
<span class="hljs-comment">-- åˆ›å»ºç´¢å¼•</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_students_id <span class="hljs-keyword">ON</span> students(id);

<span class="hljs-comment">-- ä½¿ç”¨ç´¢å¼•çš„ UPDATE è¯­å¥ä¼šæ›´å¿«</span>
<span class="hljs-keyword">UPDATE</span> students 
<span class="hljs-keyword">SET</span> score <span class="hljs-operator">=</span> <span class="hljs-number">95</span> 
<span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;  <span class="hljs-comment">-- id å­—æ®µæœ‰ç´¢å¼•ï¼ŒæŸ¥è¯¢é€Ÿåº¦æ›´å¿«</span>
</code></pre>
<p><strong>æ³¨æ„äº‹é¡¹</strong>ï¼š</p>
<ul>
<li>WHERE æ¡ä»¶ä¸­çš„å­—æ®µåº”è¯¥æœ‰ç´¢å¼•</li>
<li>ä½†ç´¢å¼•ä¹Ÿä¼šå½±å“ UPDATE çš„æ€§èƒ½ï¼ˆéœ€è¦æ›´æ–°ç´¢å¼•ï¼‰</li>
<li>éœ€è¦æƒè¡¡æŸ¥è¯¢é€Ÿåº¦å’Œæ›´æ–°é€Ÿåº¦</li>
</ul>
<h4 data-id="heading-53">2ï¸âƒ£ åˆ†æ‰¹æ›´æ–° ğŸ’¡ Could</h4>
<p>å½“éœ€è¦æ›´æ–°å¤§é‡æ•°æ®æ—¶ï¼Œå¯ä»¥åˆ†æ‰¹è¿›è¡Œæ›´æ–°ï¼Œé¿å…ä¸€æ¬¡æ€§æ›´æ–°è¿‡å¤šæ•°æ®å½±å“æ€§èƒ½ã€‚</p>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æ–¹å¼ 1ï¼šä½¿ç”¨ LIMIT åˆ†æ‰¹æ›´æ–°ï¼ˆMySQLï¼‰</span>
<span class="hljs-keyword">UPDATE</span> students 
<span class="hljs-keyword">SET</span> score <span class="hljs-operator">=</span> score <span class="hljs-operator">+</span> <span class="hljs-number">10</span> 
<span class="hljs-keyword">WHERE</span> score <span class="hljs-operator">&lt;</span> <span class="hljs-number">80</span>
LIMIT <span class="hljs-number">1000</span>;  <span class="hljs-comment">-- æ¯æ¬¡åªæ›´æ–° 1000 æ¡</span>

<span class="hljs-comment">-- æ–¹å¼ 2ï¼šä½¿ç”¨å¾ªç¯åˆ†æ‰¹æ›´æ–°</span>
<span class="hljs-comment">-- ç¬¬ä¸€æ¬¡æ›´æ–° id 1-1000</span>
<span class="hljs-keyword">UPDATE</span> students 
<span class="hljs-keyword">SET</span> score <span class="hljs-operator">=</span> score <span class="hljs-operator">+</span> <span class="hljs-number">10</span> 
<span class="hljs-keyword">WHERE</span> score <span class="hljs-operator">&lt;</span> <span class="hljs-number">80</span> <span class="hljs-keyword">AND</span> id <span class="hljs-keyword">BETWEEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> <span class="hljs-number">1000</span>;

<span class="hljs-comment">-- ç¬¬äºŒæ¬¡æ›´æ–° id 1001-2000</span>
<span class="hljs-keyword">UPDATE</span> students 
<span class="hljs-keyword">SET</span> score <span class="hljs-operator">=</span> score <span class="hljs-operator">+</span> <span class="hljs-number">10</span> 
<span class="hljs-keyword">WHERE</span> score <span class="hljs-operator">&lt;</span> <span class="hljs-number">80</span> <span class="hljs-keyword">AND</span> id <span class="hljs-keyword">BETWEEN</span> <span class="hljs-number">1001</span> <span class="hljs-keyword">AND</span> <span class="hljs-number">2000</span>;
</code></pre>
<p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>å‡å°‘é”è¡¨æ—¶é—´</li>
<li>é™ä½å¯¹æ•°æ®åº“æ€§èƒ½çš„å½±å“</li>
<li>å¯ä»¥éšæ—¶ä¸­æ–­å’Œæ¢å¤</li>
</ul>
<h4 data-id="heading-54">3ï¸âƒ£ äº‹åŠ¡å¤„ç† ğŸ’¡ Could</h4>
<p>åœ¨æ›´æ–°å¤§é‡æ•°æ®æ—¶ï¼Œè€ƒè™‘ä½¿ç”¨äº‹åŠ¡æ¥ç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§ã€‚</p>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- å¼€å§‹äº‹åŠ¡</span>
<span class="hljs-keyword">START</span> TRANSACTION;

<span class="hljs-comment">-- æ‰§è¡Œæ›´æ–°æ“ä½œ</span>
<span class="hljs-keyword">UPDATE</span> students 
<span class="hljs-keyword">SET</span> score <span class="hljs-operator">=</span> score <span class="hljs-operator">+</span> <span class="hljs-number">10</span> 
<span class="hljs-keyword">WHERE</span> score <span class="hljs-operator">&lt;</span> <span class="hljs-number">80</span>;

<span class="hljs-comment">-- æ£€æŸ¥æ›´æ–°ç»“æœ</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">FROM</span> students <span class="hljs-keyword">WHERE</span> score <span class="hljs-operator">&gt;=</span> <span class="hljs-number">80</span>;

<span class="hljs-comment">-- å¦‚æœç»“æœæ­£ç¡®ï¼Œæäº¤äº‹åŠ¡</span>
<span class="hljs-keyword">COMMIT</span>;

<span class="hljs-comment">-- å¦‚æœç»“æœä¸æ­£ç¡®ï¼Œå›æ»šäº‹åŠ¡</span>
<span class="hljs-comment">-- ROLLBACK;</span>
</code></pre>
<p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>ç¡®ä¿æ•°æ®ä¸€è‡´æ€§</li>
<li>å¯ä»¥å›æ»šé”™è¯¯çš„æ›´æ–°</li>
<li>ä¿è¯åŸå­æ€§æ“ä½œ</li>
</ul>
<h4 data-id="heading-55">4ï¸âƒ£ è¡Œé”ä¼˜åŒ– ğŸ’¡ Could</h4>
<p>åœ¨ MySQL ä¸­ï¼Œå½“æ‰§è¡Œ <code>UPDATE xxxx WHERE topic_id = xxx</code> æ—¶ï¼ŒMySQL ä¼šå¯¹ topic_id ç´¢å¼•åŠ è¡Œé”ã€‚</p>
<p><strong>é—®é¢˜åœºæ™¯</strong>ï¼š
åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œå¦‚æœå¤šä¸ªæ“ä½œåœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œè¡Œé”çš„æŒæœ‰æ—¶é—´ä¼šå»¶é•¿ã€‚å¯ä»¥é€šè¿‡è°ƒæ•´æ“ä½œé¡ºåºæ¥é™ä½è¡Œé”çš„æŒæœ‰ç²’åº¦ã€‚</p>
<p><strong>ä¼˜åŒ–ç¤ºä¾‹</strong>ï¼š</p>
<p><strong>åŸé€»è¾‘</strong>ï¼ˆæ€§èƒ½è¾ƒå·®ï¼‰ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">START</span> TRANSACTION;
<span class="hljs-comment">-- ç¬¬ä¸€æ­¥ï¼šUPDATEï¼ˆåŠ è¡Œé”ï¼‰</span>
<span class="hljs-keyword">UPDATE</span> topics <span class="hljs-keyword">SET</span> submit_count <span class="hljs-operator">=</span> submit_count <span class="hljs-operator">+</span> <span class="hljs-number">1</span> <span class="hljs-keyword">WHERE</span> topic_id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
<span class="hljs-comment">-- ç¬¬äºŒæ­¥ï¼šINSERTï¼ˆè¡Œé”ä¸€ç›´æŒæœ‰ï¼Œç›´åˆ°äº‹åŠ¡ç»“æŸï¼‰</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> results (topic_id, <span class="hljs-keyword">result</span>) <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>, <span class="hljs-string">'AC'</span>);
<span class="hljs-keyword">COMMIT</span>;
</code></pre>
<p><strong>ä¼˜åŒ–å</strong>ï¼ˆæ€§èƒ½æ›´å¥½ï¼‰ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">START</span> TRANSACTION;
<span class="hljs-comment">-- ç¬¬ä¸€æ­¥ï¼šINSERTï¼ˆä¸åŠ è¡Œé”æˆ–åŠ é”æ—¶é—´çŸ­ï¼‰</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> results (topic_id, <span class="hljs-keyword">result</span>) <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>, <span class="hljs-string">'AC'</span>);
<span class="hljs-comment">-- ç¬¬äºŒæ­¥ï¼šUPDATEï¼ˆè¡Œé”æŒæœ‰æ—¶é—´çŸ­ï¼‰</span>
<span class="hljs-keyword">UPDATE</span> topics <span class="hljs-keyword">SET</span> submit_count <span class="hljs-operator">=</span> submit_count <span class="hljs-operator">+</span> <span class="hljs-number">1</span> <span class="hljs-keyword">WHERE</span> topic_id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
<span class="hljs-keyword">COMMIT</span>;
</code></pre>
<p><strong>å®é™…æ¡ˆä¾‹</strong>ï¼š
é€šè¿‡è°ƒæ•´ UPDATE å’Œ INSERT çš„æ‰§è¡Œé¡ºåºï¼Œåˆ¤é¢˜ç»“æœå†™åº“çš„é€»è¾‘ä»åŸæ¥çš„ 400 TPS ç›´æ¥æ‹‰é«˜åˆ° 2000 å¤š TPSã€‚</p>
<p><strong>åŸç†</strong>ï¼š</p>
<ul>
<li>å…ˆ INSERT å† UPDATEï¼Œå¯ä»¥é™ä½è¡Œé”çš„æŒæœ‰ç²’åº¦</li>
<li>å‡å°‘é”ç«äº‰ï¼Œæé«˜å¹¶å‘æ€§èƒ½</li>
</ul>
<h4 data-id="heading-56">5ï¸âƒ£ å¤§æ•°æ®æ›´æ–°çš„æ³¨æ„äº‹é¡¹</h4>
<p>å¤§æ•°æ®æ›´æ–°è¦æ³¨æ„ï¼š</p>
<ul>
<li><strong>ç´¢å¼•</strong>ï¼šç¡®ä¿ WHERE æ¡ä»¶å­—æ®µæœ‰ç´¢å¼•</li>
<li><strong>åˆ†æ‰¹æ›´æ–°</strong>ï¼šé¿å…ä¸€æ¬¡æ€§æ›´æ–°è¿‡å¤šæ•°æ®</li>
<li><strong>äº‹åŠ¡</strong>ï¼šä½¿ç”¨äº‹åŠ¡ç¡®ä¿æ•°æ®ä¸€è‡´æ€§</li>
</ul>
<p><strong>âš ï¸ é‡è¦æé†’</strong>ï¼šå¦‚æœæ›´æ–°æ¡ä»¶ä¸ç²¾å‡†ï¼Œå¯èƒ½å¯¼è‡´å¤§é¢ç§¯é”è¡¨ï¼Œå½±å“å…¶ä»–ä¸šåŠ¡ã€‚</p>
<hr/>
<h3 data-id="heading-57">ğŸ†š å¯¹æ¯”ç¤ºä¾‹</h3>
<p>é€šè¿‡å¯¹æ¯”ç¤ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥æ›´æ¸…æ¥šåœ°çœ‹åˆ° UPDATE è¯­å¥çš„ä»·å€¼å’Œæ­£ç¡®ç”¨æ³•ã€‚</p>
<h4 data-id="heading-58">1ï¸âƒ£ ä¸ä½¿ç”¨ UPDATE vs ä½¿ç”¨ UPDATE</h4>
<p><strong>åœºæ™¯</strong>ï¼šéœ€è¦ä¿®æ”¹å­¦ç”Ÿè¡¨ä¸­æŸä¸ªå­¦ç”Ÿçš„æˆç»©</p>
<p><strong>âŒ ä¸ä½¿ç”¨ UPDATEï¼ˆç¹çä¸”å®¹æ˜“å‡ºé”™ï¼‰</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ç¬¬ä¸€æ­¥ï¼šåˆ é™¤æ—§è®°å½•</span>
<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> students <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

<span class="hljs-comment">-- ç¬¬äºŒæ­¥ï¼šæ’å…¥æ–°è®°å½•</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> students (id, name, age, score) 
<span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>, <span class="hljs-string">'å¼ ä¸‰'</span>, <span class="hljs-number">20</span>, <span class="hljs-number">95</span>);
</code></pre>
<p><strong>é—®é¢˜</strong>ï¼š</p>
<ul>
<li>éœ€è¦ä¸¤æ­¥æ“ä½œï¼Œç¹ç</li>
<li>å¦‚æœç¬¬äºŒæ­¥å¤±è´¥ï¼Œæ•°æ®ä¼šä¸¢å¤±</li>
<li>æ— æ³•ä¿è¯æ•°æ®ä¸€è‡´æ€§</li>
</ul>
<p><strong>âœ… ä½¿ç”¨ UPDATEï¼ˆç®€å•ä¸”å®‰å…¨ï¼‰</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ä¸€æ¡è¯­å¥å®Œæˆæ›´æ–°</span>
<span class="hljs-keyword">UPDATE</span> students 
<span class="hljs-keyword">SET</span> score <span class="hljs-operator">=</span> <span class="hljs-number">95</span> 
<span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
</code></pre>
<p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>ä¸€æ¡è¯­å¥å®Œæˆï¼Œç®€å•</li>
<li>åŸå­æ“ä½œï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§</li>
<li>ä¸ä¼šä¸¢å¤±æ•°æ®</li>
</ul>
<h4 data-id="heading-59">2ï¸âƒ£ é”™è¯¯å†™æ³• vs æ­£ç¡®å†™æ³•</h4>
<p><strong>åœºæ™¯</strong>ï¼šæ›´æ–°æ‰€æœ‰ VIP ç”¨æˆ·çš„ç§¯åˆ†</p>
<p><strong>âŒ é”™è¯¯å†™æ³•ï¼ˆå¿˜è®° WHERE æ¡ä»¶ï¼‰</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- å±é™©ï¼è¿™ä¼šæ›´æ–°æ‰€æœ‰ç”¨æˆ·çš„ç§¯åˆ†</span>
<span class="hljs-keyword">UPDATE</span> users 
<span class="hljs-keyword">SET</span> points <span class="hljs-operator">=</span> points <span class="hljs-operator">+</span> <span class="hljs-number">100</span>;
</code></pre>
<p><strong>é—®é¢˜</strong>ï¼š</p>
<ul>
<li>æ²¡æœ‰ WHERE æ¡ä»¶ï¼Œæ‰€æœ‰è®°å½•éƒ½ä¼šè¢«æ›´æ–°</li>
<li>å¯èƒ½å¯¼è‡´æ•°æ®ç¾éš¾</li>
</ul>
<p><strong>âœ… æ­£ç¡®å†™æ³•ï¼ˆä½¿ç”¨ WHERE æ¡ä»¶ï¼‰</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æ­£ç¡®ï¼åªæ›´æ–° VIP ç”¨æˆ·çš„ç§¯åˆ†</span>
<span class="hljs-keyword">UPDATE</span> users 
<span class="hljs-keyword">SET</span> points <span class="hljs-operator">=</span> points <span class="hljs-operator">+</span> <span class="hljs-number">100</span> 
<span class="hljs-keyword">WHERE</span> user_type <span class="hljs-operator">=</span> <span class="hljs-string">'VIP'</span>;
</code></pre>
<p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>æœ‰ WHERE æ¡ä»¶ï¼Œåªæ›´æ–°ç¬¦åˆæ¡ä»¶çš„è®°å½•</li>
<li>ç²¾å‡†æ›´æ–°ï¼Œä¸ä¼šè¯¯æ”¹å…¶ä»–æ•°æ®</li>
</ul>
<h4 data-id="heading-60">3ï¸âƒ£ æ€§èƒ½å¯¹æ¯”ç¤ºä¾‹</h4>
<p><strong>åœºæ™¯</strong>ï¼šæ›´æ–° 10000 æ¡è®°å½•çš„æˆç»©</p>
<p><strong>âŒ ä½æ•ˆæ–¹å¼ï¼ˆé€æ¡æ›´æ–°ï¼‰</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- éœ€è¦æ‰§è¡Œ 10000 æ¬¡ UPDATE è¯­å¥</span>
<span class="hljs-keyword">UPDATE</span> students <span class="hljs-keyword">SET</span> score <span class="hljs-operator">=</span> <span class="hljs-number">95</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
<span class="hljs-keyword">UPDATE</span> students <span class="hljs-keyword">SET</span> score <span class="hljs-operator">=</span> <span class="hljs-number">95</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;
<span class="hljs-keyword">UPDATE</span> students <span class="hljs-keyword">SET</span> score <span class="hljs-operator">=</span> <span class="hljs-number">95</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;
<span class="hljs-comment">-- ... é‡å¤ 10000 æ¬¡</span>
</code></pre>
<p><strong>é—®é¢˜</strong>ï¼š</p>
<ul>
<li>æ‰§è¡Œ 10000 æ¬¡ SQL è¯­å¥ï¼Œæ•ˆç‡æä½</li>
<li>ç½‘ç»œå¼€é”€å¤§</li>
<li>æ•°æ®åº“å‹åŠ›å¤§</li>
</ul>
<p><strong>âœ… é«˜æ•ˆæ–¹å¼ï¼ˆæ‰¹é‡æ›´æ–°ï¼‰</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ä¸€æ¡è¯­å¥æ›´æ–°æ‰€æœ‰è®°å½•</span>
<span class="hljs-keyword">UPDATE</span> students 
<span class="hljs-keyword">SET</span> score <span class="hljs-operator">=</span> <span class="hljs-number">95</span> 
<span class="hljs-keyword">WHERE</span> id <span class="hljs-keyword">BETWEEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> <span class="hljs-number">10000</span>;
</code></pre>
<p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>ä¸€æ¡è¯­å¥å®Œæˆï¼Œæ•ˆç‡é«˜</li>
<li>æ•°æ®åº“è‡ªåŠ¨ä¼˜åŒ–æ‰§è¡Œ</li>
<li>ç½‘ç»œå¼€é”€å°</li>
</ul>
<hr/>
<h3 data-id="heading-61">ğŸ› å¸¸è§é”™è¯¯ä¸ä¿®æ­£</h3>
<p>åœ¨ä½¿ç”¨ UPDATE è¯­å¥æ—¶ï¼Œæœ‰ä¸€äº›å¸¸è§çš„é”™è¯¯éœ€è¦æ³¨æ„å’Œé¿å…ã€‚</p>
<h4 data-id="heading-62">1ï¸âƒ£ å¿˜è®° WHERE å­å¥</h4>
<p><strong>é”™è¯¯ç°è±¡</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âŒ é”™è¯¯ï¼å¿˜è®° WHERE å­å¥</span>
<span class="hljs-keyword">UPDATE</span> students 
<span class="hljs-keyword">SET</span> score <span class="hljs-operator">=</span> <span class="hljs-number">95</span>;
</code></pre>
<p><strong>é—®é¢˜</strong>ï¼šæ‰€æœ‰å­¦ç”Ÿçš„æˆç»©éƒ½ä¼šè¢«æ›´æ–°ä¸º 95ï¼Œè¿™é€šå¸¸ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœï¼</p>
<p><strong>âœ… ä¿®æ­£æ–¹æ³•</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âœ… æ­£ç¡®ï¼æ·»åŠ  WHERE æ¡ä»¶</span>
<span class="hljs-keyword">UPDATE</span> students 
<span class="hljs-keyword">SET</span> score <span class="hljs-operator">=</span> <span class="hljs-number">95</span> 
<span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
</code></pre>
<p><strong>é¢„é˜²æªæ–½</strong>ï¼š</p>
<ul>
<li>åœ¨æ‰§è¡Œ UPDATE å‰ï¼Œå…ˆç”¨ SELECT æµ‹è¯• WHERE æ¡ä»¶</li>
<li>åœ¨ MySQL ä¸­å¼€å¯ <code>sql_safe_updates</code> æ¨¡å¼</li>
<li>å…»æˆä¹ æƒ¯ï¼Œæ¯æ¬¡å†™ UPDATE æ—¶å…ˆå†™ WHERE æ¡ä»¶</li>
</ul>
<h4 data-id="heading-63">2ï¸âƒ£ å¤šè¡¨å…³è”æ›´æ–°ç¼ºå°‘ EXISTS</h4>
<p><strong>é”™è¯¯ç°è±¡</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âŒ é”™è¯¯ï¼æ²¡æœ‰ EXISTS æ¡ä»¶</span>
<span class="hljs-keyword">UPDATE</span> stu t 
<span class="hljs-keyword">SET</span> t.NAME <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> t1.NAME <span class="hljs-keyword">FROM</span> stu1 t1 <span class="hljs-keyword">WHERE</span> t1.ID <span class="hljs-operator">=</span> t.ID);
</code></pre>
<p><strong>é—®é¢˜</strong>ï¼šå¦‚æœ stu è¡¨ä¸­å­˜åœ¨æŸä¸ª IDï¼Œä½† stu1 è¡¨ä¸­ä¸å­˜åœ¨å¯¹åº”çš„ IDï¼Œé‚£ä¹ˆè¯¥è®°å½•çš„ NAME å­—æ®µä¼šè¢«æ›´æ–°ä¸º NULLã€‚</p>
<p><strong>âœ… ä¿®æ­£æ–¹æ³•</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âœ… æ­£ç¡®ï¼æ·»åŠ  EXISTS æ¡ä»¶</span>
<span class="hljs-keyword">UPDATE</span> stu t 
<span class="hljs-keyword">SET</span> t.NAME <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> t1.NAME <span class="hljs-keyword">FROM</span> stu1 t1 <span class="hljs-keyword">WHERE</span> t1.ID <span class="hljs-operator">=</span> t.ID)
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">EXISTS</span>(<span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span> <span class="hljs-keyword">FROM</span> stu1 t2 <span class="hljs-keyword">WHERE</span> t2.ID <span class="hljs-operator">=</span> t.ID);
</code></pre>
<p><strong>é¢„é˜²æªæ–½</strong>ï¼š</p>
<ul>
<li>å¤šè¡¨å…³è”æ›´æ–°æ—¶ï¼Œå§‹ç»ˆæ·»åŠ  EXISTS æ¡ä»¶</li>
<li>æ›´æ–°å‰å…ˆç”¨ SELECT æµ‹è¯•å­æŸ¥è¯¢ç»“æœ</li>
</ul>
<h4 data-id="heading-64">3ï¸âƒ£ æ›´æ–°æ¡ä»¶ä¸ç²¾å‡†å¯¼è‡´é”è¡¨</h4>
<p><strong>é”™è¯¯ç°è±¡</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âŒ é”™è¯¯ï¼æ›´æ–°æ¡ä»¶ä¸ç²¾å‡†ï¼Œå¯èƒ½é”ä½å¤§é‡è®°å½•</span>
<span class="hljs-keyword">UPDATE</span> orders 
<span class="hljs-keyword">SET</span> status <span class="hljs-operator">=</span> <span class="hljs-string">'Shipped'</span> 
<span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> <span class="hljs-string">'Pending'</span>;  <span class="hljs-comment">-- å¦‚æœ Pending è®¢å•æœ‰ 100 ä¸‡æ¡</span>
</code></pre>
<p><strong>é—®é¢˜</strong>ï¼šå¦‚æœç¬¦åˆæ¡ä»¶çš„è®°å½•å¾ˆå¤šï¼Œå¯èƒ½å¯¼è‡´å¤§é¢ç§¯é”è¡¨ï¼Œå½±å“å…¶ä»–ä¸šåŠ¡ã€‚</p>
<p><strong>âœ… ä¿®æ­£æ–¹æ³•</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âœ… æ­£ç¡®ï¼åˆ†æ‰¹æ›´æ–°ï¼Œå‡å°‘é”è¡¨æ—¶é—´</span>
<span class="hljs-comment">-- ç¬¬ä¸€æ¬¡æ›´æ–° id 1-10000</span>
<span class="hljs-keyword">UPDATE</span> orders 
<span class="hljs-keyword">SET</span> status <span class="hljs-operator">=</span> <span class="hljs-string">'Shipped'</span> 
<span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> <span class="hljs-string">'Pending'</span> <span class="hljs-keyword">AND</span> id <span class="hljs-keyword">BETWEEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> <span class="hljs-number">10000</span>;

<span class="hljs-comment">-- ç¬¬äºŒæ¬¡æ›´æ–° id 10001-20000</span>
<span class="hljs-keyword">UPDATE</span> orders 
<span class="hljs-keyword">SET</span> status <span class="hljs-operator">=</span> <span class="hljs-string">'Shipped'</span> 
<span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> <span class="hljs-string">'Pending'</span> <span class="hljs-keyword">AND</span> id <span class="hljs-keyword">BETWEEN</span> <span class="hljs-number">10001</span> <span class="hljs-keyword">AND</span> <span class="hljs-number">20000</span>;
</code></pre>
<p><strong>é¢„é˜²æªæ–½</strong>ï¼š</p>
<ul>
<li>æ›´æ–°å¤§é‡æ•°æ®æ—¶ï¼Œä½¿ç”¨åˆ†æ‰¹æ›´æ–°</li>
<li>æ·»åŠ æ›´ç²¾ç¡®çš„ WHERE æ¡ä»¶</li>
<li>åœ¨ä¸šåŠ¡ä½å³°æœŸæ‰§è¡Œå¤§æ‰¹é‡æ›´æ–°</li>
</ul>
<h4 data-id="heading-65">4ï¸âƒ£ è¡¨è¾¾å¼ç±»å‹ä¸åŒ¹é…</h4>
<p><strong>é”™è¯¯ç°è±¡</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âŒ é”™è¯¯ï¼å­—ç¬¦ä¸²å’Œæ•°å­—ç›´æ¥ç›¸åŠ </span>
<span class="hljs-keyword">UPDATE</span> students 
<span class="hljs-keyword">SET</span> name <span class="hljs-operator">=</span> name <span class="hljs-operator">+</span> <span class="hljs-number">10</span> 
<span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
</code></pre>
<p><strong>é—®é¢˜</strong>ï¼šå­—ç¬¦ä¸²å’Œæ•°å­—ç±»å‹ä¸åŒ¹é…ï¼Œå¯èƒ½å¯¼è‡´é”™è¯¯æˆ–æ„å¤–ç»“æœã€‚</p>
<p><strong>âœ… ä¿®æ­£æ–¹æ³•</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âœ… æ­£ç¡®ï¼ç¡®ä¿è¡¨è¾¾å¼ç±»å‹åŒ¹é…</span>
<span class="hljs-keyword">UPDATE</span> students 
<span class="hljs-keyword">SET</span> score <span class="hljs-operator">=</span> score <span class="hljs-operator">+</span> <span class="hljs-number">10</span> 
<span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
</code></pre>
<p><strong>é¢„é˜²æªæ–½</strong>ï¼š</p>
<ul>
<li>ç¡®ä¿ SET å­å¥ä¸­çš„è¡¨è¾¾å¼ç±»å‹ä¸å­—æ®µç±»å‹å…¼å®¹</li>
<li>ä½¿ç”¨ç±»å‹è½¬æ¢å‡½æ•°ï¼ˆå¦‚ CASTã€CONVERTï¼‰ç¡®ä¿ç±»å‹ä¸€è‡´</li>
</ul>
<hr/>
<h3 data-id="heading-66">ğŸ’¼ å®æˆ˜åº”ç”¨æ¡ˆä¾‹</h3>
<p>è®©æˆ‘ä»¬é€šè¿‡ä¸€äº›å®é™…çš„åº”ç”¨æ¡ˆä¾‹æ¥åŠ æ·±å¯¹ UPDATE è¯­å¥çš„ç†è§£ã€‚</p>
<h4 data-id="heading-67">æ¡ˆä¾‹ 1ï¼šæ›´æ–°ç”¨æˆ·ä¿¡æ¯</h4>
<p><strong>åœºæ™¯</strong>ï¼šç”¨æˆ·ä¿®æ”¹ä¸ªäººèµ„æ–™ï¼Œéœ€è¦æ›´æ–°ç”¨æˆ·è¡¨ä¸­çš„ä¿¡æ¯</p>
<p><strong>SQL è¯­å¥</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æ›´æ–°ç”¨æˆ·è¡¨ä¸­ id ä¸º 1 çš„ç”¨æˆ·å</span>
<span class="hljs-keyword">UPDATE</span> users
<span class="hljs-keyword">SET</span> username <span class="hljs-operator">=</span> <span class="hljs-string">'æ–°ç”¨æˆ·å'</span>
<span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<ul>
<li>è¿™æ˜¯æœ€å¸¸è§çš„ UPDATE åº”ç”¨åœºæ™¯</li>
<li>é€šå¸¸ç”¨äºç”¨æˆ·ä¿®æ”¹ä¸ªäººä¿¡æ¯ã€ç®¡ç†å‘˜ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ç­‰</li>
</ul>
<h4 data-id="heading-68">æ¡ˆä¾‹ 2ï¼šæ‰¹é‡å¢åŠ ç§¯åˆ†</h4>
<p><strong>åœºæ™¯</strong>ï¼šæ´»åŠ¨æœŸé—´ï¼Œç»™æ‰€æœ‰ç”¨æˆ·å¢åŠ  10 ç§¯åˆ†</p>
<p><strong>SQL è¯­å¥</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ç»™æ‰€æœ‰ç”¨æˆ·çš„ç§¯åˆ†å¢åŠ  10 åˆ†</span>
<span class="hljs-keyword">UPDATE</span> users
<span class="hljs-keyword">SET</span> points <span class="hljs-operator">=</span> points <span class="hljs-operator">+</span> <span class="hljs-number">10</span>;
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨è¡¨è¾¾å¼æ›´æ–°ï¼Œå°†å½“å‰ç§¯åˆ†åŠ ä¸Š 10</li>
<li>æ²¡æœ‰ WHERE æ¡ä»¶ï¼Œæ›´æ–°æ‰€æœ‰è®°å½•</li>
<li>é€‚ç”¨äºå…¨ç”¨æˆ·æ´»åŠ¨å¥–åŠ±</li>
</ul>
<h4 data-id="heading-69">æ¡ˆä¾‹ 3ï¼šæ ¹æ®æ¡ä»¶æ›´æ–°çŠ¶æ€</h4>
<p><strong>åœºæ™¯</strong>ï¼šå°†æŸä¸ªå®¢æˆ·çš„æ‰€æœ‰è®¢å•çŠ¶æ€æ›´æ–°ä¸º"å·²å‘è´§"</p>
<p><strong>SQL è¯­å¥</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æ›´æ–°å®¢æˆ· id ä¸º 1 çš„æ‰€æœ‰è®¢å•çŠ¶æ€</span>
<span class="hljs-keyword">UPDATE</span> orders
<span class="hljs-keyword">SET</span> status <span class="hljs-operator">=</span> <span class="hljs-string">'Shipped'</span>
<span class="hljs-keyword">WHERE</span> customer_id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨ WHERE æ¡ä»¶ç­›é€‰ç‰¹å®šå®¢æˆ·çš„è®¢å•</li>
<li>å¯èƒ½æ›´æ–°å¤šæ¡è®°å½•</li>
<li>é€‚ç”¨äºæ‰¹é‡çŠ¶æ€æ›´æ–°</li>
</ul>
<h4 data-id="heading-70">æ¡ˆä¾‹ 4ï¼šä½¿ç”¨è¡¨è¾¾å¼æ›´æ–°ä»·æ ¼</h4>
<p><strong>åœºæ™¯</strong>ï¼šå°†æ‰€æœ‰ä»·æ ¼ä½äº 100 çš„å•†å“ä»·æ ¼æé«˜ 10%</p>
<p><strong>SQL è¯­å¥</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- å°†ä»·æ ¼ä½äº 100 çš„å•†å“ä»·æ ¼æé«˜ 10%</span>
<span class="hljs-keyword">UPDATE</span> products
<span class="hljs-keyword">SET</span> price <span class="hljs-operator">=</span> price <span class="hljs-operator">*</span> <span class="hljs-number">1.1</span>
<span class="hljs-keyword">WHERE</span> price <span class="hljs-operator">&lt;</span> <span class="hljs-number">100</span>;
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨è¡¨è¾¾å¼ <code>price * 1.1</code> è®¡ç®—æ–°ä»·æ ¼</li>
<li>WHERE æ¡ä»¶ç­›é€‰ä»·æ ¼ä½äº 100 çš„å•†å“</li>
<li>é€‚ç”¨äºä»·æ ¼è°ƒæ•´ã€æŠ˜æ‰£è®¡ç®—ç­‰åœºæ™¯</li>
</ul>
<h4 data-id="heading-71">æ¡ˆä¾‹ 5ï¼šå…³è”è¡¨æ›´æ–°</h4>
<p><strong>åœºæ™¯</strong>ï¼šæ ¹æ®éƒ¨é—¨è¡¨æ›´æ–°å‘˜å·¥è¡¨çš„éƒ¨é—¨åç§°</p>
<p><strong>SQL è¯­å¥</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æ ¹æ®éƒ¨é—¨è¡¨æ›´æ–°å‘˜å·¥è¡¨çš„éƒ¨é—¨åç§°</span>
<span class="hljs-keyword">UPDATE</span> emp e
<span class="hljs-keyword">SET</span> e.dname <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> d.dname <span class="hljs-keyword">FROM</span> dept d <span class="hljs-keyword">WHERE</span> e.deptno <span class="hljs-operator">=</span> d.deptno);
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨å­æŸ¥è¯¢ä»éƒ¨é—¨è¡¨è·å–éƒ¨é—¨åç§°</li>
<li>æ ¹æ®éƒ¨é—¨ç¼–å·å…³è”ä¸¤ä¸ªè¡¨</li>
<li>é€‚ç”¨äºæ•°æ®åŒæ­¥ã€æ•°æ®ä¿®å¤ç­‰åœºæ™¯</li>
</ul>
<h4 data-id="heading-72">æ¡ˆä¾‹ 6ï¼šçº¿ä¸Šè°ƒä¼˜æ¡ˆä¾‹ï¼ˆTPS ä¼˜åŒ–ï¼‰</h4>
<p><strong>ä¸šåŠ¡èƒŒæ™¯</strong>ï¼šä¸€ä¸ªç±»ä¼¼äºåŠ›æ‰£åœ¨çº¿åšé¢˜çš„ä»£ç è¯„æµ‹æ¨¡å—ï¼Œç”¨æˆ·æäº¤åˆ¤é¢˜ä»»åŠ¡åï¼Œåå°ä¼šè¿›è¡Œå¼‚æ­¥åˆ¤é¢˜ã€‚</p>
<p><strong>é—®é¢˜</strong>ï¼šå¤§é‡çš„ç”¨æˆ·åœ¨å‰ç«¯æäº¤åï¼Œä¸€ç›´éƒ½è½®è¯¢ä¸åˆ°åˆ¤é¢˜ç»“æœã€‚åˆ¤é¢˜ç»“æœå†™åº“é€»è¾‘è€—æ—¶ 1 ç§’å¤šã€‚</p>
<p><strong>åŸå› åˆ†æ</strong>ï¼š</p>
<ul>
<li>æ›´æ–°è¿™é“é¢˜çš„æäº¤æ•°é‡ã€æ­£ç¡®ç‡ç­‰æ“ä½œå æ®äº† 80% çš„è€—æ—¶</li>
<li>å½“æ‰§è¡Œ <code>UPDATE xxxx WHERE topic_id = xxx</code> æ—¶ï¼ŒMySQL ä¼šå¯¹ topic_id ç´¢å¼•åŠ è¡Œé”</li>
<li>ç”±äºç¬¬ä¸€ä¸ªæ­¥éª¤å’Œç¬¬äºŒä¸ªæ­¥éª¤åˆåœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå½“é«˜å¹¶å‘æ—¶ï¼Œç”¨æˆ·åšé¢˜æ˜¯å¤šå¯¹ä¸€çš„å…³ç³»ï¼Œå¤§é‡ç”¨æˆ·å¯èƒ½éƒ½åœ¨å†™ä¸€é“é¢˜ï¼Œé€ æˆé¢˜ç›® ID çš„è¡Œé”ç«äº‰æ¿€çƒˆ</li>
<li>æ›´æ–°é¢˜ç›®æäº¤æ•°ã€æ­£ç¡®ç‡çš„è¡Œé”åœ¨æ›´æ–°å®Œåä¸ä¼šé‡Šæ”¾ï¼Œè¿˜éœ€ç­‰å¾…ç¬¬äºŒæ­¥å°†ç»“æœå†™åº“å®Œåï¼ˆç­‰äº‹åŠ¡æ‰§è¡Œå®Œåï¼‰ï¼Œè¿™æ ·è¡Œé”çš„æ— æ•ˆæŒæœ‰æ—¶é—´æˆ–è€…å«è¡Œé”çš„æŒæœ‰ç²’åº¦å°±å¢åŠ äº†</li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š
å°† 1ã€2 ä¸¤ä¸ªæ­¥éª¤äº¤æ¢ä¸‹é¡ºåºï¼š</p>
<ul>
<li>åŸé€»è¾‘ï¼šå…ˆ UPDATEï¼Œå† INSERT</li>
<li>ä¼˜åŒ–åï¼šå…ˆ INSERTï¼Œå† UPDATE</li>
</ul>
<p>è¿™æ ·å¯ä»¥é™ä½è¡Œé”çš„æŒæœ‰ç²’åº¦ã€‚</p>
<p><strong>æ•ˆæœ</strong>ï¼šåˆ¤é¢˜ç»“æœå†™åº“çš„é€»è¾‘ä»åŸæ¥çš„ 400 TPS ç›´æ¥æ‹‰é«˜åˆ° 2000 å¤š TPSã€‚</p>
<hr/>
<h3 data-id="heading-73">ğŸ“š æ€»ç»“</h3>
<p>é€šè¿‡æœ¬æ–‡æ¡£çš„å­¦ä¹ ï¼Œæˆ‘ä»¬æŒæ¡äº† SQL UPDATE è¯­å¥çš„æ ¸å¿ƒçŸ¥è¯†ç‚¹å’Œå®ç”¨æŠ€å·§ã€‚è®©æˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹å…³é”®è¦ç‚¹ï¼š</p>
<h4 data-id="heading-74">æ ¸å¿ƒè¦ç‚¹å›é¡¾</h4>
<ol>
<li>
<p><strong>UPDATE åŸºæœ¬è¯­æ³•</strong> ğŸ”¥ Must</p>
<ul>
<li><code>UPDATE table_name SET column = value WHERE condition</code></li>
<li>WHERE å­å¥éå¸¸é‡è¦ï¼Œçœç•¥ä¼šå¯¼è‡´æ‰€æœ‰è®°å½•è¢«æ›´æ–°</li>
</ul>
</li>
<li>
<p><strong>å•è¡¨æ›´æ–°</strong> ğŸ”¥ Must</p>
<ul>
<li>æ›´æ–°å•æ¡è®°å½•ï¼šä½¿ç”¨ç²¾ç¡®çš„ WHERE æ¡ä»¶</li>
<li>æ›´æ–°å¤šæ¡è®°å½•ï¼šä½¿ç”¨èŒƒå›´æˆ–æ¡ä»¶ WHERE å­å¥</li>
<li>æ›´æ–°å¤šä¸ªå­—æ®µï¼šåœ¨ SET å­å¥ä¸­ç”¨é€—å·åˆ†éš”</li>
</ul>
</li>
<li>
<p><strong>è¡¨è¾¾å¼æ›´æ–°</strong> â­ Should</p>
<ul>
<li>å¯ä»¥åœ¨ SET å­å¥ä¸­ä½¿ç”¨è¡¨è¾¾å¼è¿›è¡Œè®¡ç®—</li>
<li>å¦‚ï¼š<code>SET score = score + 10</code></li>
</ul>
</li>
<li>
<p><strong>å­æŸ¥è¯¢æ›´æ–°</strong> â­ Should</p>
<ul>
<li>ä½¿ç”¨å­æŸ¥è¯¢æ ¹æ®å…¶ä»–è¡¨çš„æ•°æ®æ›´æ–°å½“å‰è¡¨</li>
<li>å¤šè¡¨å…³è”æ›´æ–°æ—¶ï¼Œè®°å¾—æ·»åŠ  EXISTS æ¡ä»¶</li>
</ul>
</li>
<li>
<p><strong>å¤šè¡¨å…³è”æ›´æ–°</strong> â­ Should</p>
<ul>
<li>MySQLï¼šä½¿ç”¨ JOIN è¯­æ³•</li>
<li>SQL Serverï¼šä½¿ç”¨ FROM å­å¥</li>
<li>Oracleï¼šä½¿ç”¨å¤šå­—æ®µå­æŸ¥è¯¢</li>
</ul>
</li>
<li>
<p><strong>æ€§èƒ½ä¼˜åŒ–</strong> ğŸ’¡ Could</p>
<ul>
<li>ä½¿ç”¨ç´¢å¼•æé«˜æŸ¥è¯¢é€Ÿåº¦</li>
<li>åˆ†æ‰¹æ›´æ–°å¤§é‡æ•°æ®</li>
<li>ä½¿ç”¨äº‹åŠ¡ç¡®ä¿æ•°æ®ä¸€è‡´æ€§</li>
<li>è°ƒæ•´æ“ä½œé¡ºåºé™ä½è¡Œé”æŒæœ‰ç²’åº¦</li>
</ul>
</li>
</ol>
<h4 data-id="heading-75">å…³é”®æ³¨æ„äº‹é¡¹</h4>
<ul>
<li>âš ï¸ <strong>WHERE å­å¥çš„é‡è¦æ€§</strong>ï¼šæ‰§è¡Œæ²¡æœ‰ WHERE å­å¥çš„ UPDATE è¦æ…é‡ï¼Œå†æ…é‡</li>
<li>âš ï¸ <strong>æ›´æ–°å‰æ£€æŸ¥</strong>ï¼šå…ˆç”¨ SELECT æµ‹è¯• WHERE æ¡ä»¶ï¼Œç¡®è®¤æ— è¯¯åå†æ‰§è¡Œ UPDATE</li>
<li>âš ï¸ <strong>å¤šè¡¨å…³è”æ›´æ–°</strong>ï¼šè®°å¾—è¦åŠ  EXISTS() æ¡ä»¶ï¼Œé¿å…å­—æ®µè¢«æ›´æ–°ä¸º NULL</li>
<li>âš ï¸ <strong>å¤§æ•°æ®æ›´æ–°</strong>ï¼šæ³¨æ„ç´¢å¼•ã€åˆ†æ‰¹æ›´æ–°ã€äº‹åŠ¡å¤„ç†</li>
</ul>
<h4 data-id="heading-76">å­¦ä¹ è·¯å¾„å»ºè®®</h4>
<ol>
<li><strong>åŸºç¡€é˜¶æ®µ</strong>ï¼šæŒæ¡ UPDATE åŸºæœ¬è¯­æ³•å’Œ WHERE å­å¥ä½¿ç”¨</li>
<li><strong>è¿›é˜¶é˜¶æ®µ</strong>ï¼šå­¦ä¹ è¡¨è¾¾å¼æ›´æ–°ã€å­æŸ¥è¯¢æ›´æ–°ã€å¤šè¡¨å…³è”æ›´æ–°</li>
<li><strong>é«˜çº§é˜¶æ®µ</strong>ï¼šæŒæ¡æ€§èƒ½ä¼˜åŒ–æŠ€å·§ï¼Œç†è§£ä¸åŒæ•°æ®åº“çš„è¯­æ³•å·®å¼‚</li>
</ol>
<h4 data-id="heading-77">å†™åœ¨æœ€å</h4>
<p>UPDATE è¯­å¥æ˜¯æ•°æ®åº“ä¸­éå¸¸é‡è¦çš„æ“ä½œä¹‹ä¸€ï¼Œé€šè¿‡çµæ´»è¿ç”¨ UPDATE è¯­å¥ï¼Œæˆ‘ä»¬å¯ä»¥é«˜æ•ˆåœ°å¯¹æ•°æ®åº“ä¸­çš„æ•°æ®è¿›è¡Œæ›´æ–°ã€‚åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œæ›´æ–°æ•°æ®ï¼ˆUPDATEï¼‰æ˜¯ä»…æ¬¡äº SELECT çš„å¸¸ç”¨ SQL æ“ä½œã€‚</p>
<p>æŒæ¡ UPDATE è¯­å¥çš„å…³é”®åœ¨äºï¼š</p>
<ul>
<li>ç†è§£ WHERE å­å¥çš„é‡è¦æ€§</li>
<li>æŒæ¡å„ç§æ›´æ–°æŠ€å·§</li>
<li>æ³¨æ„æ€§èƒ½ä¼˜åŒ–</li>
<li>é¿å…å¸¸è§é”™è¯¯</li>
</ul>
<p>å¸Œæœ›æœ¬æ–‡æ¡£èƒ½å¤Ÿå¸®åŠ©ä½ æŒæ¡ SQL UPDATE è¯­å¥çš„æ ¸å¿ƒæŠ€èƒ½ï¼Œåœ¨å®é™…å·¥ä½œä¸­çµæ´»è¿ç”¨ï¼Œæé«˜å¼€å‘æ•ˆç‡ï¼Œé¿å…æ•°æ®ç¾éš¾ã€‚è®©æˆ‘ä»¬ä¸€èµ·åœ¨ SQL å­¦ä¹ çš„é“è·¯ä¸Šä¸æ–­è¿›æ­¥ï¼ ğŸ’ªğŸš€</p>
<hr/>
<p><strong>ä½œè€…</strong>ï¼šéƒ‘æ©èµ<br/>
<strong>æœºæ„</strong>ï¼šå¦é—¨å·¥å­¦é™¢äººå·¥æ™ºèƒ½åˆ›ä½œåŠ<br/>
<strong>æ—¥æœŸ</strong>ï¼š2025 å¹´ 11 æœˆ 11 æ—¥</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[[å¤§å‚å®è·µ] å°‘å³æ˜¯å¤šï¼šZendesk é•¿æ—¶é—´ä½œä¸šæ‰§è¡Œä¼˜åŒ–]]></title>    <link>https://juejin.cn/post/7571176484514578484</link>    <guid>https://juejin.cn/post/7571176484514578484</guid>    <pubDate>2025-11-11T01:27:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571176484514578484" data-draft-id="7570980232562065460" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="[å¤§å‚å®è·µ] å°‘å³æ˜¯å¤šï¼šZendesk é•¿æ—¶é—´ä½œä¸šæ‰§è¡Œä¼˜åŒ–"/> <meta itemprop="keywords" content="æ¶æ„"/> <meta itemprop="datePublished" content="2025-11-11T01:27:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¿å‡¡"/> <meta itemprop="url" content="https://juejin.cn/user/290747765274222"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            [å¤§å‚å®è·µ] å°‘å³æ˜¯å¤šï¼šZendesk é•¿æ—¶é—´ä½œä¸šæ‰§è¡Œä¼˜åŒ–
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/290747765274222/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¿å‡¡
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T01:27:07.000Z" title="Tue Nov 11 2025 01:27:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»16åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><em>æœ¬æ–‡ä»‹ç»äº† Zendesk æ„å»ºæ•°æ®è¿ç§»å™¨è¿›è¡Œé•¿æ—¶é—´å¤§è§„æ¨¡è´¦æˆ·æ•°æ®è¿ç§»çš„å®è·µï¼Œä»¥åŠé€‰æ‹©è¿™ç§ä½œä¸šæ‰§è¡Œæ–¹å¼çš„æƒè¡¡å’Œå–èˆã€‚åŸæ–‡ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fzendesk.engineering%2Fless-is-more-improving-job-execution-by-ditching-the-job-executor-d00eff680de4" title="https://zendesk.engineering/less-is-more-improving-job-execution-by-ditching-the-job-executor-d00eff680de4" target="_blank" ref="nofollow noopener noreferrer">Less is More: Improving job execution by ditching the job executor</a></em></p>
</blockquote>
<p>æœ¬æ–‡æ¦‚è¿°äº†æˆ‘ä»¬æ‰€åšçš„æ¶æ„è°ƒæ•´ï¼Œè¿™äº›è°ƒæ•´æå¤§ç®€åŒ–äº†é•¿æ—¶é—´è¿è¡Œä»»åŠ¡çš„æ‰§è¡Œæ¨¡å¼ã€‚</p>
<p>é€šè¿‡åˆ©ç”¨å®¢æˆ·ç«¯è¡Œä¸ºï¼Œç³»ç»Ÿä¸ä»…æå‡äº†æ•´ä½“åŠŸèƒ½ï¼Œè¿˜æ¶ˆé™¤äº†åˆ†å¸ƒå¼ä»»åŠ¡æ‰§è¡Œä¸­çš„è¯¸å¤šå¤æ‚é—®é¢˜ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/20baecaaff9b4fd58e4cc11cd38fa76c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-e5Yeh:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763429227&amp;x-signature=yGfIR4tTuW2fnY18jN7%2B4u7vyOs%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">èƒŒæ™¯ï¼šZendesk çš„è´¦æˆ·è¿ç§»</h2>
<p>åœ¨ Zendesk çš„åå°ç³»ç»Ÿï¼Œæ¯ä¸ªå®¢æˆ·è´¦æˆ·çš„ç›¸å…³æ•°æ®éƒ½å­˜æ”¾åœ¨å…¨çƒå„åœ°çš„æŸä¸ªæ•°æ®ä¸­å¿ƒã€‚æˆ‘ä»¬ä¸æƒ³è®©è´¦æˆ·æ°¸è¿œåœç•™åœ¨å…¶åˆ›å»ºæ—¶æ‰€åœ¨çš„åŸå§‹æ•°æ®ä¸­å¿ƒï¼Œå› æ­¤é€šè¿‡å®Œå–„çš„è´¦æˆ·è¿ç§»å·¥å…·ï¼Œèƒ½å¤Ÿä»¥å‡ ä¹é›¶åœæœºæ—¶é—´çš„æ–¹å¼å°†è´¦æˆ·è¿ç§»åˆ°æ–°çš„æ•°æ®ä¸­å¿ƒã€‚</p>
<p>è¯¥å·¥å…·éå¸¸æœ‰ç”¨ï¼Œæ—¢å¯¹å®¢æˆ·æœ‰ç›Šï¼Œä¹Ÿå¯¹æˆ‘ä»¬è‡ªèº«æœ‰ç›Šã€‚æœ€åˆæ˜¯ä¸ºå°†å•ä¸€ Rackspace éƒ¨ç½²æ‰©å±•åˆ°å¤šä¸ªæ•°æ®ä¸­å¿ƒè€Œè®¾è®¡ï¼Œå¤šå¹´åï¼Œå®ƒå†æ¬¡åœ¨å°†æ•°æ®ä¸­å¿ƒè¿ç§»è‡³ AWS æ—¶å‘æŒ¥äº†å…³é”®ä½œç”¨ã€‚ç›®å‰ä»è¢«ç”¨äºåœ¨å„ä¸ªæ•°æ®ä¸­å¿ƒä¹‹é—´å¹³è¡¡å®¹é‡å’Œå…¶ä»–æŒ‡æ ‡ï¼Œè€Œä¸”æœ€è¿‘åœ¨å°†æ”¶è´­å…¬å¸çš„æœåŠ¡è¿ç§»åˆ°æˆ‘ä»¬çš„å…±äº«åŸºç¡€è®¾æ–½æ–¹é¢ä¹Ÿå‘æŒ¥äº†é‡è¦ä½œç”¨ã€‚</p>
<p>è´¦æˆ·è¿ç§»å·¥å…·åŒ…å«ä¸­å¤®åè°ƒå™¨ä»¥åŠè‹¥å¹²æ•°æ®è¿ç§»å™¨ã€‚åè°ƒå™¨è´Ÿè´£ç®¡ç†æ•´ä¸ªè´¦æˆ·è¿ç§»ç”Ÿå‘½å‘¨æœŸï¼Œéšç€è¿ç§»è¿›ç¨‹çš„æ¨è¿›ï¼Œä¼šåè°ƒå„ä¸ªç³»ç»Ÿã€‚è€Œå®é™…è¿›è¡Œæ•°æ®ä¼ è¾“å·¥ä½œçš„é€šå¸¸æ˜¯æ•°æ®è¿ç§»å™¨ï¼Œæˆ‘ä»¬æ”¯æŒçš„æ¯ä¸ªæ•°æ®å­˜å‚¨ç±»å‹éƒ½é…å¤‡æœ‰ä¸€ä¸ªæ•°æ®è¿ç§»å™¨ã€‚</p>
<h2 data-id="heading-1">æ¬¢è¿åŠ å…¥!è¯·å°†ç‰©å“æ”¾ç½®åœ¨ Zendesk åŸºç¡€è®¾æ–½å†…</h2>
<p>æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬æ”¶è´­äº†ä¸€å®¶ä½¿ç”¨ä¸åŒæ•°æ®åº“ç³»ç»Ÿçš„å…¬å¸æ—¶ï¼Œå°±ä¼šé¢ä¸´éš¾é¢˜ã€‚</p>
<p>æœ€ç®€å•ä¸”ç›´æ¥çš„è§£å†³åŠæ³•æ˜¯â€œæˆ‘ä»¬èƒ½ä¸èƒ½ä¸è¿™ä¹ˆåšï¼Ÿâ€å¦‚æœæœ‰å·²è¢«è®¤å¯ä¸”åŒæ ·é€‚ç”¨çš„æ•°æ®å­˜å‚¨æ–¹æ¡ˆï¼Œæˆ‘ä»¬å°†è½¬è€Œä½¿ç”¨è¯¥æ–¹æ¡ˆã€‚</p>
<p>å¦‚æœè¿™ç§æ–¹å¼ä¸å¯è¡Œï¼Œä¸”éœ€è¦è¿ç§»æ•°æ®çš„è¯ï¼Œé‚£ä¹ˆé€šå¸¸å°±éœ€è¦æ–°çš„æ•°æ®è¿ç§»å·¥å…·ã€‚è¿™æ˜¯ä¸€é¡¹ç¹é‡å·¥ä½œï¼Œæ‰€ä»¥æˆ‘ä»¬å¾ˆä¸æƒ…æ„¿å»è¿›è¡Œè¿™é¡¹å·¥ä½œï¼Œä½†è®©æ•°æ®æ°¸è¿œæ»ç•™åœ¨æ ¸å¿ƒ Zendesk åŸºç¡€è®¾æ–½ä¹‹å¤–ä¼šä½¿å¾—æƒ…å†µå˜å¾—å¤æ‚ï¼Œå¹¶ä¸”è¿˜ä¼šä½¿æ‰€æ”¶è´­çš„äº§å“å¤±å»è®¸å¤šç»„ç»‡å±‚é¢çš„ç›Šå¤„ã€‚</p>
<p>å› æ­¤ï¼Œåœ¨å°†æ”¶è´­é¡¹ç›®æ•´åˆåˆ°å…±äº«åŸºç¡€è®¾æ–½ä¸­æ—¶ï¼Œæ„å»ºæ•°æ®ä¼ è¾“ç³»ç»Ÿçš„å¤æ‚æ€§ä¼šäº§ç”Ÿé‡å¤§å½±å“ã€‚</p>
<h2 data-id="heading-2">æ•°æ®è¿ç§»å™¨æ˜¯ä½œä¸šæ‰§è¡ŒæœåŠ¡å™¨</h2>
<p>æ•°æ®ä¼ è¾“çš„å…·ä½“ç»†èŠ‚æ—¢é‡è¦åˆæœ‰è¶£ï¼Œä½†ä»Šå¤©æˆ‘ä»¬è¦å…³æ³¨çš„æ˜¯ä»»åŠ¡ç®¡ç†ï¼Œå› ä¸ºæ•°æ®ä¼ è¾“å·¥å…·å°±æ˜¯é€šè¿‡æ‰§è¡Œä»»åŠ¡æ¥å·¥ä½œçš„ã€‚é‚£ä¹ˆï¼Œä»€ä¹ˆæ ·çš„äº‹æƒ…å¯ä»¥è¢«ç§°ä¸ºâ€œä»»åŠ¡â€å‘¢ï¼Ÿåœ¨æˆ‘çœ‹æ¥ï¼Œä»»åŠ¡çš„æ ¸å¿ƒç‰¹å¾æ˜¯ï¼š</p>
<ul>
<li><strong>é•¿æœŸè¿è¡Œ</strong>ï¼ˆå¦‚æœè¿è¡Œæ—¶é—´è¾ƒçŸ­ï¼Œé‚£å¯èƒ½åªæ˜¯ä¸€ä¸ªè¯·æ±‚è€Œå·²ï¼‰ï¼Œå¹¶ä¸”</li>
<li>ä¼šè¿›è¡Œ<strong>å®Œæˆæƒ…å†µç›‘æ§</strong>ï¼ˆå¦‚æœæ— éœ€ç­‰å¾…å…¶å®Œæˆï¼Œé‚£ä¹ˆåªéœ€è§¦å‘äº‹ä»¶æˆ–é€šçŸ¥ï¼Œç„¶åç¦»å¼€å³å¯ï¼‰</li>
</ul>
<p>é™¤äº†è¿™äº›å¸¸è§ç‰¹æ€§ä¹‹å¤–ï¼Œæ•°æ®è¿ç§»ä»»åŠ¡é€šå¸¸éƒ½æ˜¯<strong>æŒç»­è¿›è¡Œ</strong>çš„ï¼Œä¼šå°†æ•°æ®ä»æºç³»ç»Ÿå¤åˆ¶åˆ°ç›®æ ‡ç³»ç»Ÿï¼Œéšç€æ–°å˜åŒ–çš„å‡ºç°è€Œä¿æŒåŒæ­¥ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¼šè®©å®ƒä»¬ä¸€ç›´è¿è¡Œï¼Œç›´åˆ°æ•´ä¸ªè´¦æˆ·è¿ç§»å®Œæˆã€‚</p>
<h2 data-id="heading-3">å…¸å‹ä½œä¸šç³»ç»Ÿ API</h2>
<p>å¦‚æœæœ‰ä½œä¸šï¼Œå¯èƒ½éœ€è¦è¿è¡Œä½œä¸šç³»ç»Ÿã€‚å¯¹äºä½œä¸šï¼Œç¼–æ’å™¨æ˜¯è¯·æ±‚ä½œä¸šè¿è¡Œçš„å®¢æˆ·ç«¯ï¼Œè€Œæ•°æ®ç§»åŠ¨å™¨æ˜¯å®ç°ä½œä¸šçš„æœåŠ¡å™¨ã€‚</p>
<p>å¤§å¤šæ•°ç”¨äºé•¿æ—¶é—´è¿è¡Œä½œä¸šçš„ç³»ç»Ÿï¼ˆåŒ…æ‹¬æˆ‘ä»¬çš„åˆå§‹å®ç°ï¼‰éƒ½æœ‰ç±»ä¼¼äºè¿™æ ·çš„ APIï¼š</p>
<ul>
<li><code>StartJob(config) -&gt; jobId</code></li>
<li><code>GetStatus(jobId) -&gt; status</code></li>
<li><code>StopJob(jobId)</code></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/41be636143ca4296935b867366a5096a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-e5Yeh:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763429227&amp;x-signature=1MLhSCqI%2BQCIQfHd21t1dnrhcuM%3D" alt="" loading="lazy"/></p>
<p>API æ„é€ ç®€å•ï¼Œä½†è¦æˆä¸ºé€‚åˆæ‰§è¡Œæ•°æ®è¿ç§»ä»»åŠ¡çš„å·¥å…·ï¼Œå¿…é¡»æ»¡è¶³ä¸€ç³»åˆ—è¦æ±‚ã€‚</p>
<p><strong>æŒä¹…æ€§</strong></p>
<p>æ‰€æœ‰ä»»åŠ¡ç»ä¸é—å¤±ï¼å¦‚æœå®¢æˆ·åˆ›å»ºäº†ä»»åŠ¡ï¼Œé‚£ä¹ˆæœåŠ¡å™¨åœ¨å‘ç”Ÿå´©æºƒæˆ–é‡å¯æ—¶ä¹Ÿå¿…é¡»ä¸ä¼šå¿˜è®°è¿™ä¸ªä»»åŠ¡ã€‚</p>
<p><strong>å®¹é”™æ€§</strong></p>
<p>ä½œä¸šå¯ä»¥è¿è¡Œå¾ˆé•¿æ—¶é—´ï¼Œè€Œ Kubernetes å®¹å™¨å¹¶éæ°¸è¿œå­˜åœ¨ã€‚å¦‚æœæŸä¸ªå®¹å™¨å´©æºƒæˆ–è¢«æ›¿æ¢ï¼Œä½œä¸šå°±éœ€è¦é€šè¿‡è®©å¦ä¸€ä¸ªå®¹å™¨æ¥æ›¿æ¥ç»§ç»­è¿›è¡Œã€‚</p>
<p><strong>æ¢å¤</strong></p>
<p>ä¸­æ–­ä¸åº”å¯¼è‡´å·¥ä½œé‡æ–°å¼€å§‹ï¼Œå·¥ä½œåº”ä»ï¼ˆæ¥è¿‘ï¼‰ä¸Šæ¬¡åœæ­¢çš„åœ°æ–¹ç»§ç»­è¿›è¡Œã€‚</p>
<p><strong>å”¯ä¸€æ€§</strong></p>
<p>æˆ‘ä»¬ä¸å¸Œæœ›ä¸¤ä¸ªå®ä¾‹åœ¨åŒä¸€æ—¶é—´æ‰§è¡Œç›¸åŒçš„ä»»åŠ¡ã€‚</p>
<p><strong>æ‚¬ç½®ä»»åŠ¡</strong></p>
<p>å¦‚æœå®¢æˆ·å‡ºäºä»»ä½•åŸå› å¿˜è®°äº†æŸä¸ªä»»åŠ¡ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›ä¸€ç›´æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ï¼Œå› ä¸ºè¿™æ—¢æµªè´¹èµ„æºï¼Œè¿˜å¯èƒ½åœ¨å®¢æˆ·æ„æ–™ä¹‹å¤–çš„æƒ…å†µä¸‹å¼•å‘é—®é¢˜ï¼Œå› æ­¤éœ€è¦æ£€æµ‹åˆ°è¿™äº›æ‚¬ç½®ä»»åŠ¡å¹¶åœæ­¢æ‰§è¡Œã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/348e220eeca14075b8c9d95282a4eb81~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-e5Yeh:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763429227&amp;x-signature=Qdv96AwPZeW3G%2FA%2FVn6LjchXv5g%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">ä»»åŠ¡æ‰§è¡Œæ¶æ„</h2>
<p>åŸºäºä¸Šè¿° API å’Œéœ€æ±‚ï¼Œæ˜¾è€Œæ˜“è§çš„æ¶æ„åŒ…å«æ•°æ®åº“å’Œä¸€ä¸ªé” APIã€‚è¯¥é” API å¯èƒ½ä¼šå¤ç”¨ç›¸åŒåº•å±‚æ•°æ®å­˜å‚¨ï¼Œä¹Ÿå¯èƒ½æ˜¯ç‹¬ç«‹ç³»ç»Ÿï¼Œå¦‚ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.consul.io" title="https://www.consul.io" target="_blank" ref="nofollow noopener noreferrer">Consul</a> æˆ– <a href="https://link.juejin.cn?target=https%3A%2F%2Fetcd.io" title="https://etcd.io" target="_blank" ref="nofollow noopener noreferrer">etcd</a>ã€‚</p>
<p>å½“ä½œä¸šè¢«åˆ›å»ºæ—¶ï¼Œä¼šå°†å…¶ä¿å­˜åœ¨æ•°æ®åº“ä¸­ï¼ˆä»¥ç¡®ä¿<strong>æŒä¹…æ€§</strong>ï¼‰ï¼Œå¹¶ä¸”å…¶å½“å‰çŠ¶æ€ä¼šå®šæœŸè¿›è¡Œä¿å­˜ï¼ˆä»¥ä¾¿äº<strong>æ¢å¤</strong>ï¼‰ã€‚å½“è¿›ç¨‹æ­£åœ¨æ‰§è¡ŒæŸä¸ªä½œä¸šæ—¶ï¼Œé¦–å…ˆä¼šè·å–è¯¥ä½œä¸šçš„é”ï¼ˆä»¥ç¡®ä¿<strong>å”¯ä¸€æ€§</strong>ï¼‰ã€‚å¦‚æœæ•°æ®å­˜å‚¨ä¸­å­˜åœ¨æœªå®Œæˆçš„ä½œä¸šä½†æ²¡æœ‰æ´»è·ƒé”ï¼Œé‚£ä¹ˆè¿™äº›ä½œä¸šå°±å¯ä»¥ç”±å·¥ä½œè¿›ç¨‹æ¥æ¥ç®¡ï¼ˆä»¥å®ç°<strong>å®¹é”™</strong>ï¼‰ã€‚</p>
<p>æˆ‘ä»¬ç”¨ 3 ä¸ªæœåŠ¡å™¨å®ä¾‹ã€1 ä¸ªä½œä¸šæ•°æ®åº“ä»¥åŠ 1 ä¸ªé”æœåŠ¡å°†è¿™ä¸€åˆ‡æ•´åˆèµ·æ¥ã€‚ä»¥ä¸‹æ˜¯æ‰§è¡Œä¸€ä¸ªç¤ºä¾‹ä½œä¸šçš„æ­¥éª¤åºåˆ—ï¼Œå…¶ä¸­åŒ…æ‹¬åœ¨å¦ä¸€ä¸ªæœåŠ¡å™¨å®ä¾‹ä¸Šçš„æ¢å¤æ“ä½œï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc4b11b60fde42a6ac0ac303dae32501~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-e5Yeh:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763429227&amp;x-signature=sCtDvFBhw%2BShw2OL8CEHAAle8kM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">å·¥ä½œå®Œæˆäº†å—ï¼Ÿ</h2>
<p>å—¯ï¼Œæˆ‘ä»¬æ­£åœ¨æ¥è¿‘ç›®æ ‡ï¼Œä¸è¿‡ä»æœ‰ä¸€äº›é—®é¢˜éœ€è¦è§£å†³ã€‚</p>
<p><strong>æ‚¬ç½®ä»»åŠ¡</strong>ï¼šå¦‚æœä¸ä»‹æ„åœ¨å®¢æˆ·ç«¯ç¦»å¼€åè®©ä»»åŠ¡ç»§ç»­è¿è¡Œä¸€æ®µæ—¶é—´çš„è¯ï¼Œè¿™ä¸ªé—®é¢˜å…¶å®å¹¶ä¸éš¾è§£å†³ã€‚æˆ‘ä»¬å†³å®šåªæœ‰åœ¨å®¢æˆ·ç«¯è¦æ±‚æŸ¥çœ‹ä»»åŠ¡çŠ¶æ€æ—¶æ‰æ‰§è¡Œéæ´»è·ƒä»»åŠ¡ã€‚å¦‚æœå®¢æˆ·ç«¯ä¸å†è°ƒç”¨ <code>GetStatus</code> å‡½æ•°ï¼Œå½“å‰å®¹å™¨ä»ä¼šç»§ç»­è¿è¡Œè¯¥ä»»åŠ¡ï¼Œç›´åˆ°å®¹å™¨ç»ˆæ­¢ï¼Œä½†æ­¤åè¯¥ä»»åŠ¡å°†ä¸å†æ‰§è¡Œã€‚</p>
<p><strong>é‡å¤ä»»åŠ¡</strong>ï¼šå¦‚æœå®¢æˆ·ç«¯åˆ›å»ºäº†ä¸€ä¸ªä»»åŠ¡ï¼Œä½†ç”±äºå‡ºç°é”™è¯¯å¯¼è‡´æ— æ³•å¤„ç†å“åº”ï¼Œé‚£ä¹ˆå°±ä¼šäº§ç”Ÿä¸€ä¸ªç«‹å³å¤±æ•ˆçš„ä»»åŠ¡ã€‚æˆ‘ä»¬ä¸ä¼šæ°¸è¿œåœ¨å®ƒä¸Šé¢æµªè´¹èµ„æºï¼Œä½†å¯èƒ½ä¼šæŒç»­æ‰§è¡Œè¯¥ä»»åŠ¡æ•°å°æ—¶ä¹‹ä¹…ã€‚åœ¨å¤„ç†æ•°æ®æ–¹é¢ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªä»»åŠ¡åœ¨å¤„ç†ç›¸åŒçš„æ•°æ®ï¼Œè¿˜å¯èƒ½ä¼šå¯¼è‡´å†™å…¥å†²çªå’Œä¼ è¾“å¤±è´¥ã€‚</p>
<hr/>
<h2 data-id="heading-6">è¦ç‚¹ï¼šå¹‚ç­‰æ€§å¯†é’¥</h2>
<p>æœ‰ä¸€ç§å¸¸è§ä¸”éå¸¸æœ‰æ•ˆçš„é˜²æ­¢é‡å¤ä»»åŠ¡çš„æ–¹æ³•ï¼Œç§°ä¸º<strong>å¹‚ç­‰æ€§å¯†é’¥ï¼ˆidempotency keyï¼‰</strong>ã€‚è¿™ç§æŠ€æœ¯åœ¨è¯¸å¦‚ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.stripe.com%2Fapi%2Fidempotent_requests" title="https://docs.stripe.com/api/idempotent_requests" target="_blank" ref="nofollow noopener noreferrer">Stripe</a> å’Œ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.squareup.com%2Fdocs%2Fbuild-basics%2Fcommon-api-patterns%2Fidempotency" title="https://developer.squareup.com/docs/build-basics/common-api-patterns/idempotency" target="_blank" ref="nofollow noopener noreferrer">Square</a> è¿™æ ·çš„æ”¯ä»˜ API ä¸­éå¸¸å¸¸è§ï¼Œå› ä¸ºäººä»¬å€¾å‘äºæ¯æ¬¡è´­ä¹°åªæ”¯ä»˜ä¸€æ¬¡ã€‚</p>
<p>å°†æ­¤æ¦‚å¿µåº”ç”¨äºå·¥ä½œæµç¨‹ä¸­æ—¶ï¼Œå…¶å«ä¹‰æ˜¯ï¼šå®¢æˆ·ç«¯ä¸ºè¦åˆ›å»ºçš„æ¯ä¸ªå·¥ä½œç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„å¯†é’¥ï¼Œå¹¶å°†å…¶ä½œä¸º <code>StartJob</code> çš„ä¸€éƒ¨åˆ†å‘é€ã€‚å¦‚æœæœåŠ¡å™¨æ”¶åˆ°ä¸¤ä¸ªå…·æœ‰ç›¸åŒâ€œå¹‚ç­‰æ€§å¯†é’¥â€çš„è¯·æ±‚ï¼Œå°±çŸ¥é“å®¢æˆ·ç«¯æ‰€æŒ‡çš„æ­£æ˜¯åŒä¸€ä¸ªå·¥ä½œã€‚å› æ­¤ï¼Œå®¢æˆ·ç«¯å¯ä»¥å¤šæ¬¡è°ƒç”¨ <code>StartJob</code> æ“ä½œï¼ˆæœ€å¤š 10 æ¬¡ï¼‰ï¼Œè€ŒæœåŠ¡å™¨åˆ™çŸ¥é“åªéœ€å¯åŠ¨ä¸€æ¬¡å³å¯ã€‚</p>
<p>è¿™ç§è´£ä»»åˆ†é…æ–¹å¼ååˆ†å·§å¦™ï¼Œå› ä¸ºæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å„è‡ªåªéœ€å®ç°è‡ªå·±çš„éƒ¨åˆ†å³å¯ï¼Œè€Œä¸¤è€…ç»“åˆåœ¨ä¸€èµ·å°±èƒ½å½¢æˆæœ‰æ•ˆé˜²æ­¢é‡å¤ä»»åŠ¡çš„å¯é è§£å†³æ–¹æ¡ˆã€‚</p>
<p>ä½†å®¢æˆ·ç«¯èƒ½åšçš„è¿œä¸æ­¢è¿™äº› â€”â€” äº‹å®è¯æ˜ï¼Œè¿˜å¯ä»¥é€šè¿‡åˆ©ç”¨å®¢æˆ·ç«¯èƒ½å¤Ÿè½»æ¾æä¾›çš„ç‰¹æ€§æ¥è§£å†³è®¸å¤šé—®é¢˜ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c363e96145a94f56aa1d1e45285e9ef8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-e5Yeh:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763429227&amp;x-signature=jaIHkQbHDpjrC3u%2BXJs%2BnQQ0A3U%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">æå…¶ç®€æ´çš„ç•Œé¢</h2>
<p>ä¹‹å‰ï¼Œæˆ‘è¯´å¦‚æœä»»åŠ¡æ—¶é—´å¾ˆçŸ­ï¼Œå¯èƒ½å°±åªæ˜¯ä¸€ä¸ªè¯·æ±‚è€Œå·²ã€‚é‚£ä¹ˆï¼Œå¦‚æœä»»åŠ¡æœ¬èº«å°±æ˜¯è¯·æ±‚å‘¢ï¼Ÿè¿™ç§æƒ…å†µå­˜åœ¨ä¸¤ä¸ªæ˜æ˜¾é—®é¢˜ï¼š</p>
<ol>
<li>å®¢æˆ·ç«¯å¸Œæœ›åœ¨ä»»åŠ¡è¿è¡ŒæœŸé—´èƒ½å¤Ÿäº†è§£å…¶çŠ¶æ€ã€‚</li>
<li>è¯·æ±‚æ˜¯è„†å¼±çš„ â€”â€” ä½ ä¸èƒ½æŒ‡æœ›å•ä¸ªè¯·æ±‚èƒ½å¤ŸæŒç»­è¶³å¤Ÿé•¿çš„æ—¶é—´æ¥å®Œæˆä¸€é¡¹ä»»åŠ¡ã€‚</li>
</ol>
<p>ç¬¬ä¸€ä¸ªé—®é¢˜ï¼ˆäº†è§£ä»»åŠ¡çŠ¶æ€ï¼‰å¯ä»¥é€šè¿‡æµå¼å“åº”æ¥è§£å†³ã€‚æˆ‘ä»¬ç”¨ GRPCï¼Œä½†æµå¼ HTTP ä¹Ÿèƒ½å¾ˆå¥½å‘æŒ¥ä½œç”¨ã€‚æœåŠ¡å™¨å¯ä»¥éšæ—¶å‘å‡ºæ–°çš„çŠ¶æ€ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯ä¼šç«‹å³æ¥æ”¶åˆ°ã€‚è¿™æ¯”è®©å®¢æˆ·ç«¯å®šæœŸæŸ¥è¯¢ä»»åŠ¡çŠ¶æ€è¦ç®€å•ä¸”å“åº”æ›´å¿«ã€‚</p>
<p>è‡³äºè¿æ¥çš„è„†å¼±æ€§é—®é¢˜ï¼Œæˆ‘ä»¬çš„ä»»åŠ¡åŸæœ¬å°±éœ€è¦å…·å¤‡å¯æ¢å¤æ€§ã€‚å› æ­¤ï¼Œå¦‚æœè¿æ¥ä¸­æ–­ï¼Œå®¢æˆ·ç«¯å¯ä»¥å‘å‡ºä¸€ä¸ªæ–°çš„é•¿æœŸæœ‰æ•ˆçš„ <code>RunJob</code> è¯·æ±‚ï¼ˆä½¿ç”¨ç›¸åŒçš„é‡å¤æ€§å¯†é’¥å’Œé…ç½®ï¼‰ï¼Œè€ŒæœåŠ¡å™¨åˆ™å¯ä»¥æ ¹æ®å…¶æœ€æ–°çŠ¶æ€ç»§ç»­æ‰§è¡Œè¯¥ä»»åŠ¡ã€‚</p>
<p>æŒ‰ç…§è¿™ç§è®¾ç½®ï¼Œä»¥ä¸‹æ˜¯ä»»åŠ¡æ‰§è¡Œçš„æµç¨‹ç¤ºä¾‹ï¼ˆåŒ…æ‹¬åœ¨ä¸åŒæœåŠ¡å™¨å®ä¾‹ä¸Šé‡æ–°å¯åŠ¨ä»»åŠ¡çš„æƒ…å†µï¼‰ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/01db9f1a281e4a008c7f5264fd72f0a4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-e5Yeh:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763429227&amp;x-signature=58jdSGcyCqJHvMG4w9La5%2BR%2BAHE%3D" alt="" loading="lazy"/></p>
<p>æ²¡é”™ï¼Œæˆ‘ä»¬<strong>ç§»é™¤äº†æœåŠ¡å™¨çš„é” API å’Œä»»åŠ¡å­˜å‚¨åŠŸèƒ½</strong>ã€‚</p>
<p><em>ç»†å¿ƒçš„è¯»è€…å¯èƒ½ä¼šæ€€ç–‘æˆ‘æ˜¯åœ¨æ•…æ„éšç’ä¸€äº›æƒ…å†µï¼Œå°†è¿™äº›è´£ä»»è½¬å«ç»™äº†å®¢æˆ·ç«¯ï¼ˆè€Œå®¢æˆ·ç«¯åŸºç¡€è®¾æ–½å¹¶æœªåœ¨å›¾ä¸­å±•ç¤ºï¼‰ã€‚ç»§ç»­é˜…è¯»ï¼Œå°±ä¼šæ˜ç™½è¿™å…¶å®æ˜¯ä¸€ç§æœ‰æ„ä¸ºä¹‹çš„å¥½å¤„ï¼Œè€Œéä¸æ­£å½“çš„è´¦ç›®æ“ä½œã€‚</em></p>
<h2 data-id="heading-8">å¤ªå®Œç¾äº† ğŸŒ…</h2>
<p>æˆ‘é€šå¸¸ä¸ä¼šå¯¹åºåˆ—å›¾äº§ç”Ÿè¿‡å¤šçš„æ„Ÿæƒ…ååº”ï¼Œä½†ä»¤äººæƒŠè®¶çš„æ˜¯ï¼Œè¿™ä¸ªç®€å•çš„ API é‡æ„ç«Ÿç„¶å¦‚æ­¤å®Œç¾æ»¡è¶³äº†éœ€æ±‚ã€‚æˆ‘æ¥åˆ—ä¸¾ä¸€ä¸‹å…¶ä¸­çš„ä¼˜ç‚¹ï¼š</p>
<h5 data-id="heading-9">ä¸å­˜åœ¨â€œæ‚¬ç½®ä»»åŠ¡â€è¿™ç§è¯´æ³•</h5>
<p>åœ¨è¿™ç§æ¨¡å¼ä¸­ï¼Œå·¥ä½œä»…åœ¨å®¢æˆ·ä¸»åŠ¨ç­‰å¾…æ—¶æ‰ä¼šè¿›è¡Œï¼Œé€šè¿‡ä¿æŒè¿æ¥å¤„äºå¼€å¯çŠ¶æ€æ¥ä½“ç°è¿™ä¸€ç‚¹ï¼Œä¸€æ—¦è¿æ¥æ–­å¼€ï¼Œå·¥ä½œå°±ä¼šåœæ­¢ã€‚</p>
<p>è¿™ä¸<a href="https://link.juejin.cn?target=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FStructured_concurrency" title="https://en.wikipedia.org/wiki/Structured_concurrency" target="_blank" ref="nofollow noopener noreferrer">ç»“æ„åŒ–å¹¶å‘</a>æœ‰ç€å¾ˆå¥½çš„ç›¸ä¼¼ä¹‹å¤„ï¼Œæˆ‘å¯¹è¿™ç§ç»“æ„åŒ–å¹¶å‘æ–¹å¼éå¸¸èµèµã€‚ç»“æ„åŒ–å¹¶å‘é€šè¿‡é˜²æ­¢å¼‚æ­¥å­ä»»åŠ¡çš„ç”Ÿå‘½å‘¨æœŸè¶…è¿‡å…¶çˆ¶ä»»åŠ¡æ¥é¿å…å‡ºç°å¤±æ§çº¿ç¨‹ã€‚é€šè¿‡ä¿æŒè¯·æ±‚å¤„äºæ‰“å¼€çŠ¶æ€ï¼Œè¿«ä½¿å®¢æˆ·ç«¯ä¸»åŠ¨ç­‰å¾…ï¼Œä»è€Œå®ç°äº†ä¸é˜²æ­¢å¤±æ§ä»»åŠ¡ç±»ä¼¼çš„å®‰å…¨ä¿æŠ¤æœºåˆ¶ã€‚</p>
<h5 data-id="heading-10">ä»»åŠ¡åˆ†é…</h5>
<p>å®¢æˆ·ç«¯æ¯æ¬¡ä»…æ‰§è¡Œä¸€ä¸ªè¯·æ±‚ã€‚æˆ‘ä»¬åŸæœ¬ä¾é åˆ†å¸ƒå¼é”æ¥ç¡®ä¿åªæœ‰ä¸€ä¸ªè¿›ç¨‹æ‰§è¡ŒæŸä¸ªç‰¹å®šä»»åŠ¡ã€‚ä½†å¦‚æœå·¥ä½œä»…åœ¨å®¢æˆ·ç«¯æœ‰æ´»è·ƒè¯·æ±‚æ—¶è¿›è¡Œï¼Œå¹¶ä¸”å®¢æˆ·ç«¯åªæœ‰ä¸€ä¸ªæ´»è·ƒè¯·æ±‚ï¼Œå°±ä¸éœ€è¦æ˜ç¡®çš„åˆ†é…ï¼Œè€Œåªéœ€åœ¨æ¥æ”¶è¯·æ±‚çš„å®ä¾‹ä¸Šæ‰§è¡Œå·¥ä½œå³å¯ã€‚</p>
<h5 data-id="heading-11">é”™è¯¯ä¸é‡è¯•</h5>
<p>è´¦æˆ·è¿ç§»ä»»åŠ¡æ˜¯è€—æ—¶çš„ï¼Œå¹¶ä¸”å¯èƒ½æ—¢æ˜‚è´µåˆé‡è¦ã€‚ä¹‹å‰çš„ç³»ç»Ÿé»˜è®¤æƒ…å†µä¸‹è¾ƒä¸ºè„†å¼±ï¼šä»»ä½•é”™è¯¯éƒ½ä¼šå¯¼è‡´ä»»åŠ¡å¤±è´¥ï¼Œç›´åˆ°æ•°æ®ç§»åŠ¨å™¨å®ç°å¯é çš„é”™è¯¯é‡è¯•æœºåˆ¶ï¼ˆåŒ…æ‹¬å…³äºå¦‚ä½•å»¶é•¿ç­‰å¾…æ—¶é—´ä»¥åŠä½•æ—¶æ”¾å¼ƒçš„é€»è¾‘ï¼‰ã€‚</p>
<p>é€šè¿‡è¿™ä¸ªæ¥å£ï¼Œä»»ä½•é”™è¯¯éƒ½ä¼šé»˜è®¤å¯¼è‡´è¯·æ±‚å¤±è´¥ã€‚ä½†å®¢æˆ·ç«¯å·²ç»èƒ½å¤Ÿå¤„ç†å¤±è´¥çš„è¯·æ±‚äº†ï¼Œå¯ä»¥è®©å®¢æˆ·ç«¯åœ¨ä½•æ—¶é‡è¯•ä»¥åŠä½•æ—¶æ”¾å¼ƒæ–¹é¢å°½å¯èƒ½çµæ´»è‡ªä¸»ï¼ŒåŒæ—¶ä¿æŒæœåŠ¡å™¨çš„å®ç°ç®€å•ã€‚</p>
<p>å®é™…ä¸Šï¼Œå¦‚æœä¸€é¡¹æ“ä½œè¢«åˆ¤å®šä¸ºé‡è¦çš„è¯ï¼Œå®¢æˆ·ç«¯ä¼šè½¬è€Œå‘äººå·¥å¯»æ±‚å¸®åŠ©ã€‚ä¸åœ¨å‡ºç°å¤ªå¤šé”™è¯¯åå°±æ”¾å¼ƒä¸åŒï¼Œå®¢æˆ·ç«¯ä¼šåœæ­¢é‡è¯•ï¼Œå¹¶ç­‰å¾…äººå·¥æ“ä½œå‘˜æ¥ç»ˆæ­¢æˆ–æ¢å¤è¯¥æ“ä½œã€‚åŒæ ·ï¼Œè¿™å¹¶ä¸éœ€è¦æœåŠ¡å™¨æä¾›ä»»ä½•ç‰¹å®šæ”¯æŒã€‚</p>
<h5 data-id="heading-12">è´Ÿè½½å‡è¡¡</h5>
<p>è¿™ç®—æ˜¯ä¸€ä¸ªæ¯”è¾ƒé¥è¿œçš„ç›®æ ‡ï¼Œå› ä¸ºå¾ˆéš¾å®ç°ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œå¦‚æœæœ‰ 10 ä¸ªå®ä¾‹å’Œ 100 ä¸ªä»»åŠ¡ï¼Œæˆ‘ä»¬å¸Œæœ›æ¯ä¸ªå®ä¾‹èƒ½åŒæ—¶å¤„ç† 10 ä¸ªä»»åŠ¡ã€‚æœ‰ä¸€äº›ç®€å•æŠ€å·§å¯ä»¥å®ç°ä¸€å®šç¨‹åº¦çš„å¹³è¡¡ï¼Œæ¯”å¦‚åœ¨æ¥å–æœªè¢«å ç”¨çš„ä»»åŠ¡ä¹‹å‰å…ˆçŸ­æš‚ä¼‘æ¯ä¸€ä¸‹ã€‚å¦‚æœä¼‘æ¯æ—¶é—´ä¸å·²ç»è¿è¡Œçš„ä»»åŠ¡æ•°é‡æˆæ­£æ¯”ï¼Œé‚£ä¹ˆç©ºé—²å®ä¾‹ä¼šæ¯”å¿™ç¢Œå®ä¾‹æ›´é¢‘ç¹çš„æ¥å–ä»»åŠ¡ã€‚</p>
<p>ä½†å½“è¿æ¥æ•°é‡æˆä¸ºå·¥ä½œæ•°é‡çš„å¯é æŒ‡æ ‡æ—¶ï¼Œå¹³è¡¡é—®é¢˜å°±å˜å¾—ç®€å•å¤šäº†ï¼Œå› ä¸ºè¿™å°±æ˜¯è´Ÿè½½å‡è¡¡å™¨æ‰€åšçš„äº‹æƒ… â€”â€” <a href="https://link.juejin.cn?target=https%3A%2F%2Fistio.io%2Flatest%2Fdocs%2Fconcepts%2Ftraffic-management%2F%23load-balancing-options" title="https://istio.io/latest/docs/concepts/traffic-management/#load-balancing-options" target="_blank" ref="nofollow noopener noreferrer">Istio çš„é»˜è®¤è®¾ç½®</a>æ˜¯å°†æµé‡å‘é€åˆ°è¯·æ±‚æ´»è·ƒåº¦æœ€ä½çš„å®ä¾‹ã€‚è¿™åœ¨å·¥ä½œå®Œæˆæ—¶ä¸ä¼šä¸»åŠ¨é‡æ–°å¹³è¡¡å·¥ä½œï¼Œä½†é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜èƒ½å®ç°æœ€ä¼˜å¹³è¡¡ï¼Œè€Œä¸”æ˜¯å…è´¹çš„ã€‚</p>
<h5 data-id="heading-13">å­˜å‚¨çŠ¶æ€</h5>
<p>è¿™æˆ–è®¸æ˜¯æˆ‘ä»¬è¿‡åº¦ä¾èµ–å®¢æˆ·ç«¯çš„åœ°æ–¹ â€”â€” æˆ‘ä»¬æŠŠçŠ¶æ€äº¤ç»™å®¢æˆ·ç«¯ï¼Œè®©å…¶è‡ªè¡Œè¿›è¡Œå­˜å‚¨ã€‚</p>
<p>ä½œä¸ºæµå¼ä¼ è¾“å“åº”çš„ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªä¸å¯è¯»çš„å­—èŠ‚å­—æ®µ <code>persist_state</code>ã€‚æ”¶åˆ°è¯¥å­—æ®µåï¼Œå®¢æˆ·ç«¯ä¼šå°†å…¶å­˜å‚¨åœ¨æŸä¸ªä½ç½®ã€‚åœ¨æ¯æ¬¡å‘èµ·è¯·æ±‚æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šåœ¨ <code>RunJob</code> è¯·æ±‚ä¸­å°†æœ€è¿‘å­˜å‚¨çš„çŠ¶æ€ä½œä¸º <code>persist_state</code> å­—æ®µçš„å€¼ã€‚</p>
<p>è¿™æ„å‘³ç€æœåŠ¡å™¨å¯ä»¥å®Œå…¨å®ç°æ— çŠ¶æ€åŒ–ï¼Œè¿™å¯¹äºéœ€è¦å¤„ç†æŒä¹…åŒ–æ•°æ®çš„æœåŠ¡æ¥è¯´æ˜¯ä¸€ç§å¥‡ç‰¹çš„ç‰¹æ€§ã€‚ä½†è¿™äº›æ•°æ®å±äºæ­£åœ¨è¿ç§»çš„æœåŠ¡ï¼Œä¸é€‚åˆç”¨ä½œæˆ‘ä»¬è‡ªå·±çš„ä½œä¸šå­˜å‚¨åº“ã€‚</p>
<p>å¯¹æˆ‘ä»¬è€Œè¨€ï¼Œè¿™æ ·åšæ˜¯å€¼å¾—çš„ï¼Œå› ä¸ºæˆ‘ä»¬æ‹¥æœ‰çš„æœåŠ¡å™¨æ•°é‡è¿œè¿œå¤šäºå®¢æˆ·ç«¯æ•°é‡ï¼ˆåœ¨æœªæ¥å¯é¢„è§çš„æ—¶æœŸå†…ï¼Œåªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯ï¼‰ï¼Œè€Œä¸”ä¸€ä¸ªå®Œå…¨æ— çŠ¶æ€çš„æœåŠ¡å™¨æ‰€å¸¦æ¥çš„å¥½å¤„è¶³ä»¥å¼¥è¡¥è®©å®¢æˆ·ç«¯ä¿å­˜çŠ¶æ€æ‰€å¸¦æ¥çš„é¢å¤–å·¥ä½œé‡ã€‚</p>
<p>ä½ å®Œå…¨å¯ä»¥é‡‡çº³æœ¬æ–‡å…¶ä½™è§‚ç‚¹ï¼Œè€Œæ— éœ€è®©å®¢æˆ·ç«¯æŒæ§çŠ¶æ€ã€‚è€Œä¸”ï¼Œé™¤éå®Œå…¨ä¿¡ä»»å®¢æˆ·ç«¯ï¼Œå¦åˆ™åˆ‡å‹¿è¿™æ ·åšã€‚æˆ‘ä»¬é€‰æ‹©å……åˆ†ä¿¡ä»»å®¢æˆ·ç«¯ï¼Œä»¥è‡³äºä¼šæ•…æ„ç ´åå…¶è‡ªèº«æ•°æ®ï¼ˆä¾‹å¦‚ï¼Œå‘æˆ‘ä»¬å‘é€è™šå‡çŠ¶æ€ï¼Œå¯èƒ½ä¼šå¯¼è‡´è·³è¿‡ä¼ è¾“è¿‡ç¨‹ä¸­çš„æŸäº›éƒ¨åˆ†ï¼‰ã€‚ä½†æˆ‘ä»¬ä¸ä¼šåœ¨çŠ¶æ€ä¸­æš´éœ²ä»»ä½•ä¸æˆæƒç›¸å…³çš„æ•æ„Ÿæ•°æ®ï¼Œä»¥å…è®©å®¢æˆ·ç«¯èƒ½å¤Ÿé€šè¿‡å…¶ä¸æ‹¥æœ‰çš„æ•°æ®å­˜å‚¨ç³»ç»Ÿæ–½åŠ å½±å“ã€‚</p>
<p>ä»¤äººæƒŠè®¶çš„æ˜¯ï¼Œå¯¹æ— çŠ¶æ€æ•°æ®ä¼ è¾“å™¨çš„éœ€æ±‚æ­£æ˜¯æ•´ä¸ªè®¾è®¡çš„æœ€åˆåŠ¨æœºï¼Œå› ä¸ºæ— çŠ¶æ€ç³»ç»Ÿæ˜¯é™ä½å¤æ‚æ€§æ—¶è‡ªç„¶è€Œç„¶çš„æƒ³æ³•ã€‚å›è¿‡å¤´æ¥çœ‹ï¼Œåˆ é™¤çŠ¶æ€å­˜å‚¨å¯èƒ½æ˜¯æœ€ä¸é‡è¦çš„å¥½å¤„ â€”â€” å¦‚æœä¸å¿…æ‹…å¿ƒæ‰€æœ‰çš„åˆ†å¸ƒå¼åè°ƒéš¾é¢˜ï¼Œå†™å…¥æ•°æ®åº“å…¶å®ä¹Ÿä¸æ˜¯é‚£ä¹ˆå›°éš¾ã€‚</p>
<hr/>
<h2 data-id="heading-14">ä¸ºä»€ä¹ˆï¼ˆä»¥åŠä½•æ—¶ï¼‰è¿™ç§æ–¹æ³•èƒ½å¥æ•ˆå‘¢ï¼Ÿ</h2>
<p>å½“ç„¶ï¼Œè¿™ä¸€åˆ‡åªæœ‰åœ¨å®¢æˆ·ç«¯å…·å¤‡è¯¸å¦‚â€œä¸ä¼šå¿˜è®°å¤„ç†ä»»åŠ¡â€ä»¥åŠâ€œæ¯æ¬¡å¤„ç†ä¸€ä¸ªä»»åŠ¡æ—¶åªæå‡ºä¸€ä¸ªè¯·æ±‚â€è¿™æ ·çš„è‰¯å¥½ä¹ æƒ¯æ—¶æ‰ä¼šæœ‰æ•ˆã€‚è¿™â€¦â€¦å¬èµ·æ¥åƒæ˜¯ä½œä¸šæ‰§è¡Œå™¨çš„å·¥ä½œå—ï¼Ÿ</p>
<p>å—¯ï¼Œè´¦æˆ·ç®¡ç†åè°ƒå™¨å®é™…ä¸Šå°±æ˜¯ä¸€ç§è¢«èµ‹äºˆäº†æ›´é«˜èŒè´£çš„ä½œä¸šæ‰§è¡Œå™¨ï¼Œå…¶å¤§éƒ¨åˆ†å·¥ä½œå†…å®¹åŒ…æ‹¬è¿è¡Œå„ç§å†…éƒ¨ä½œä¸šå¹¶è®°å½•å…¶çŠ¶æ€ã€‚è¿™é‡Œæ‰€æè¿°çš„æ–¹æ³•å¹¶æ²¡æœ‰æ¶ˆé™¤å¯¹ä½œä¸šæ‰§è¡Œå™¨çš„éœ€è¦ï¼Œä½†æ„å‘³ç€å¯ä»¥å°†å•ä¸€ä½œä¸šæ‰§è¡Œå™¨åº”ç”¨äºç³»ç»Ÿæœ€å¤–å±‚ã€‚æˆ‘ä»¬å¹¶éç›´æ¥ä¸ä½œä¸šç³»ç»Ÿè¿›è¡Œé›†æˆï¼Œè€Œæ˜¯é€šè¿‡æ„å»ºæ¥å£æ¥åˆ©ç”¨å®ƒæ‰€æä¾›çš„æœ‰ç”¨ç‰¹æ€§ã€‚</p>
<p>è¿™æ˜¾ç„¶æœ‰åˆ©äºç®€åŒ–ç°æœ‰æ•°æ®ä¼ è¾“ç³»ç»Ÿï¼Œä½¿å®ƒä»¬æ— éœ€å†è´Ÿè´£ç®¡ç†ä»»åŠ¡ï¼ˆä»¥åŠç”±æ­¤å¸¦æ¥çš„ä»»ä½•å¤æ‚æ€§æˆ–æ•…éšœï¼‰ã€‚ä½†æ›´é‡è¦çš„æ˜¯é‚£äº›å°šæœªç¼–å†™çš„æ•°æ®ä¼ è¾“ç¨‹åºã€‚ç°åœ¨ï¼Œå½“æˆ‘ä»¬éœ€è¦ä¸ºä¸€å®¶è¢«æ”¶è´­å…¬å¸çš„æ•°æ®å­˜å‚¨ç³»ç»Ÿç¼–å†™æ•°æ®ä¼ è¾“ç¨‹åºæ—¶ï¼Œå¤§éƒ¨åˆ†å·¥ä½œä»…ä»…æ˜¯è¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œè€Œæ— éœ€æ„å»ºå¯é çš„ä»»åŠ¡æ‰§è¡Œç³»ç»Ÿã€‚</p>
<h2 data-id="heading-15">æ¬¢å‘¼â€œè€¦åˆâ€å§ï¼Ÿ ğŸ”—</h2>
<p>äººä»¬å¾€å¾€ä¼šå€¾å‘äºæ„å»ºæ¨¡å—åŒ–ã€è§£è€¦ã€ç‹¬ç«‹ä¸”å…·å¤‡æ‰€æœ‰é‚£äº›è®©äººæ„Ÿè§‰è‰¯å¥½çš„ç‰¹è´¨ï¼ˆä½†å…¶å®æ²¡äººåº”è¯¥è®¨åŒè¿™äº›ç‰¹è´¨ï¼‰çš„ç³»ç»Ÿã€‚</p>
<p>äº‹å®ä¸Šï¼Œ<a href="https://link.juejin.cn?target=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FConway%2527s_law" title="https://en.wikipedia.org/wiki/Conway%27s_law" target="_blank" ref="nofollow noopener noreferrer">åº·å¨å®šå¾‹</a>è¡¨æ˜ï¼Œå¦‚æœå°†â€œæ•°æ®ä¼ è¾“å™¨â€ä½œä¸ºç‹¬ç«‹ç³»ç»Ÿå’Œå›¢é˜Ÿæ¥è®¾ç«‹ï¼Œäººä»¬è‡ªç„¶ä¼šå€¾å‘äºå°†å…¶æ„å»ºä¸ºä¸€ä¸ªç‹¬ç«‹ç³»ç»Ÿï¼Œå°±åƒæˆ‘ä»¬æ‰€åšçš„é‚£æ ·ã€‚ä½†é€šè¿‡é‡‡ç”¨è½»é‡çº§è€¦åˆæ–¹å¼ï¼Œå¯ä»¥å®ç°å·¨å¤§çš„æ•ˆç‡æå‡ã€‚è€Œè¿™ç§è€¦åˆæ–¹å¼ç¡®å®æ˜¯éå¸¸è½»é‡çº§çš„ï¼Œåªæ˜¯åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ç¡®å®šäº†ä¸€å¥—ç‰¹å®šçš„åè®®ï¼Œä»è€Œæ„å»ºå‡ºäº†æ•´ä½“ä¸Šæœ€ç¨³å›ºã€å¤æ‚åº¦æœ€ä½çš„ç³»ç»Ÿã€‚</p>
<hr/>
<h2 data-id="heading-16">ç»“è¯­ï¼šâ€œä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨[æˆ‘æœ€å–œæ¬¢çš„ä½œä¸šç³»ç»Ÿ]å‘¢ï¼Ÿâ€</h2>
<p>ç”±äºä¸äº†è§£å…·ä½“ç»†èŠ‚ï¼Œæˆ–è®¸æœ¬å¯ä»¥è¿™ä¹ˆåšï¼é‰´äºæˆ‘ä»¬çš„éœ€æ±‚æ¶‰åŠå¤šç§ä¸åŒç¼–ç¨‹è¯­è¨€ï¼Œæ²¡æœ‰ä¸€ç§ç³»ç»Ÿèƒ½å®Œå…¨æ»¡è¶³éœ€æ±‚ï¼Œä¹Ÿæ²¡æœ‰ç°æˆç³»ç»Ÿå…·å¤‡æˆ‘ä»¬æ‰€éœ€è¦çš„æ‰€æœ‰åŠŸèƒ½ã€‚æˆ‘ç¡®ä¿¡å¯ä»¥é€šè¿‡å„ç§æ–¹æ³•æ¥å®ç°ï¼Œåªéœ€æ·»åŠ é¢å¤–ä»£ç æ¥æ•´åˆæˆ–å¢å¼ºç¼ºå¤±çš„åŠŸèƒ½å³å¯ã€‚ä½†æœ‰ä»€ä¹ˆæ¯”ç¼–å†™ä¸€å †ä»£ç æ›´å¥½çš„å‘¢ï¼Ÿé‚£å°±æ˜¯ä¸åšè¿™äº›ï¼</p>
<h2 data-id="heading-17">æ„Ÿè°¢é˜…è¯»ï¼</h2>
<p>æˆ‘å¸Œæœ›ä½ ä¼šè§‰å¾—è¿™ç§é’ˆå¯¹ä½œä¸šç³»ç»Ÿ API çš„æ›¿ä»£æ–¹æ³•é¢‡å…·å¸å¼•åŠ›ã€‚å®ƒæœªå¿…é€‚ç”¨äºæ¯ä¸€ä¸ªç±»ä¼¼å·¥ä½œçš„ç³»ç»Ÿï¼Œå…³é”®åœ¨äºï¼Œå¦‚æœä»ç»™å®šç³»ç»Ÿçš„æ•´ä½“ç¯å¢ƒä»¥åŠå…¶ä½¿ç”¨æ–¹å¼çš„è§’åº¦å»æ€è€ƒï¼Œæœ‰æ—¶èƒ½å¤Ÿæ‰¾åˆ°ä¸€ç§å¤æ‚ç¨‹åº¦ä½å¾—å¤šçš„è§£å†³æ–¹æ¡ˆï¼Œè¿™ç¡®å®å¾ˆç¾å¦™ã€‚</p>
<hr/>
<blockquote>
<p>ä½ å¥½ï¼Œæˆ‘æ˜¯ä¿å‡¡ï¼Œåœ¨Motorolaåšè¿‡ç ”å‘ï¼Œç°åœ¨åœ¨MaveniråšæŠ€æœ¯å·¥ä½œï¼Œå¯¹é€šä¿¡ã€ç½‘ç»œã€åç«¯æ¶æ„ã€äº‘åŸç”Ÿã€DevOpsã€CICDã€åŒºå—é“¾ã€AIç­‰æŠ€æœ¯å§‹ç»ˆä¿æŒç€æµ“åšçš„å…´è¶£ï¼Œå¹³æ—¶å–œæ¬¢é˜…è¯»ã€æ€è€ƒï¼Œç›¸ä¿¡æŒç»­å­¦ä¹ ã€ç»ˆèº«æˆé•¿ï¼Œæ¬¢è¿ä¸€èµ·äº¤æµå­¦ä¹ ã€‚ä¸ºäº†æ–¹ä¾¿å¤§å®¶ä»¥åèƒ½ç¬¬ä¸€æ—¶é—´çœ‹åˆ°æ–‡ç« ï¼Œè¯·æœ‹å‹ä»¬å…³æ³¨å…¬ä¼—å·"DeepNoMind"ï¼Œå¹¶è®¾ä¸ªæ˜Ÿæ ‡å§ï¼Œå¦‚æœèƒ½ä¸€é”®ä¸‰è¿(è½¬å‘ã€ç‚¹èµã€åœ¨çœ‹)ï¼Œåˆ™èƒ½ç»™æˆ‘å¸¦æ¥æ›´å¤šçš„æ”¯æŒå’ŒåŠ¨åŠ›ï¼Œæ¿€åŠ±æˆ‘æŒç»­å†™ä¸‹å»ï¼Œå’Œå¤§å®¶å…±åŒæˆé•¿è¿›æ­¥ï¼</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±å…¥ç†è§£ DispatchQueue.sync çš„æ­»é”é™·é˜±ï¼šåŸç†ã€æ¡ˆä¾‹ä¸æœ€ä½³å®è·µ]]></title>    <link>https://juejin.cn/post/7570976274236915758</link>    <guid>https://juejin.cn/post/7570976274236915758</guid>    <pubDate>2025-11-11T00:06:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570976274236915758" data-draft-id="7550959642794491944" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±å…¥ç†è§£ DispatchQueue.sync çš„æ­»é”é™·é˜±ï¼šåŸç†ã€æ¡ˆä¾‹ä¸æœ€ä½³å®è·µ"/> <meta itemprop="keywords" content="Swift"/> <meta itemprop="datePublished" content="2025-11-11T00:06:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="unravel2025"/> <meta itemprop="url" content="https://juejin.cn/user/1116759541421880"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±å…¥ç†è§£ DispatchQueue.sync çš„æ­»é”é™·é˜±ï¼šåŸç†ã€æ¡ˆä¾‹ä¸æœ€ä½³å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759541421880/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    unravel2025
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T00:06:19.000Z" title="Tue Nov 11 2025 00:06:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸ºä»€ä¹ˆè¦è°ˆâ€œæ­»é”â€</h2>
<p>åœ¨ Swift å¹¶å‘ç¼–ç¨‹ä¸­ï¼Œ<code>DispatchQueue.sync</code> ä»¥â€œé˜»å¡å¼åŒæ­¥â€è‘—ç§°ï¼šç®€å•ã€ç›´è§‚ã€çº¿ç¨‹å®‰å…¨ï¼Œå´ä¹Ÿæœ€å®¹æ˜“è®©ç”Ÿäº§ç¯å¢ƒç›´æ¥å´©æºƒã€‚</p>
<h2 data-id="heading-1">ä»€ä¹ˆæ˜¯æ­»é”ï¼ˆDeadlockï¼‰</h2>





















<table><thead><tr><th>ç»´åº¦</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>å®šä¹‰</td><td>ä¸¤ä¸ªï¼ˆæˆ–å¤šä¸ªï¼‰æ‰§è¡Œå•å…ƒäº’ç›¸ç­‰å¾…å¯¹æ–¹é‡Šæ”¾èµ„æºï¼Œå¯¼è‡´æ°¸è¿œé˜»å¡ã€‚</td></tr><tr><td>åœ¨ GCD ä¸­çš„è¡¨ç°</td><td>çº¿ç¨‹ A é€šè¿‡ <code>sync</code> æäº¤ä»»åŠ¡åˆ°é˜Ÿåˆ— Qï¼Œè€Œé˜Ÿåˆ— Q æ­£åœ¨ç­‰å¾…çº¿ç¨‹ A å®Œæˆ â†’ å¾ªç¯ç­‰å¾… â†’ è§¦å‘ <code>EXC_BAD_INSTRUCTION</code> å´©æºƒã€‚</td></tr><tr><td>å¸¸è§ç»“æœ</td><td>ä¸»çº¿ç¨‹å¡æ­»ã€App ç§’é€€ï¼›Crash æ—¥å¿—ä¸­å‡ºç° <code>0x8badf00d</code>ï¼ˆåº”ç”¨æ— å“åº”ï¼‰æˆ– <code>EXC_I386_INVOP</code>ï¼ˆéæ³•æ“ä½œï¼‰ç­‰é”™è¯¯ç ã€‚</td></tr></tbody></table>
<p>é¤å…æ¯”å–»</p>
<ul>
<li>waiterï¼ˆæœåŠ¡å‘˜ï¼‰åŒæ­¥ä¸‹è®¢å•ç»™ chefï¼ˆå¨å¸ˆï¼‰ï¼›</li>
<li>chef éœ€è¦ waiter å›å»é—®é¡¾å®¢å£å‘³ï¼ŒåˆåŒæ­¥æ´¾ä»»åŠ¡ç»™ waiterï¼›</li>
<li>ä¸¤äººäº’ç›¸ç­‰ï¼Œé¤å…åœæ‘† â†’ æ­»é”ã€‚</li>
</ul>
<h2 data-id="heading-2">Swift æœ€å°æ­»é”ç¤ºä¾‹</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> Foundation

<span class="hljs-comment">// 1. åŒé˜Ÿåˆ—åµŒå¥— sync â†’ ç«‹å³å´©æºƒ</span>
<span class="hljs-keyword">let</span> queue <span class="hljs-operator">=</span> <span class="hljs-type">DispatchQueue</span>(label: <span class="hljs-string">"com.demo.queue"</span>)
queue.sync {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"å¤–å±‚ sync"</span>)
    queue.sync {          <span class="hljs-comment">// âŒ åœ¨è¿™é‡Œæ­»é”</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"æ°¸è¿œè¿›ä¸æ¥"</span>)
    }
}
</code></pre>
<p>è¿è¡Œåæ§åˆ¶å°åªä¼šæ‰“å° <code>å¤–å±‚ sync</code>ï¼Œéšå App å´©æºƒã€‚</p>
<p>åŸå› ï¼š</p>
<ul>
<li>å¤–å±‚é—­åŒ…å·²å ç”¨é˜Ÿåˆ—å”¯ä¸€çº¿ç¨‹ï¼›</li>
<li>å†…å±‚ <code>sync</code> è¦æ±‚åŒä¸€æ¡çº¿ç¨‹å†æ¬¡è¿›å…¥ â†’ æ— æ³•æ»¡è¶³ â†’ æ­»é”ã€‚</li>
</ul>
<h2 data-id="heading-3">åŒé˜Ÿåˆ—äº¤å‰æ­»é”ï¼ˆæ›´æ¥è¿‘çœŸå®ä¸šåŠ¡ï¼‰</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">let</span> waiter <span class="hljs-operator">=</span> <span class="hljs-type">DispatchQueue</span>(label: <span class="hljs-string">"waiter"</span>)
<span class="hljs-keyword">let</span> chef   <span class="hljs-operator">=</span> <span class="hljs-type">DispatchQueue</span>(label: <span class="hljs-string">"chef"</span>)

<span class="hljs-comment">// æ¨¡æ‹Ÿä¸‹å•æµç¨‹</span>
waiter.sync {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"â‘  Waiterï¼šåŒæ­¥ä¸‹å•ç»™ Chef"</span>)
    
    chef.sync {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"â‘¡ Chefï¼šåŒæ­¥è¦æ±‚ Waiter å»é—®å£å‘³"</span>)
        
        waiter.sync {     <span class="hljs-comment">// âŒ äº¤å‰ç­‰å¾…</span>
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"â‘¢ Waiterï¼šæ°¸è¿œæ— æ³•æ‰§è¡Œ"</span>)
        }
    }
}
</code></pre>
<p>å´©æºƒç‚¹ï¼šâ‘¢ å¤„ waiter é˜Ÿåˆ—å·²è¢«â‘ å ç”¨ï¼Œè€Œâ‘ åˆåœ¨ç­‰â‘¡ â†’ å¾ªç¯ç­‰å¾…ã€‚</p>
<h2 data-id="heading-4">å¦‚ä½•â€œä¸€é”®â€è§£å†³â€”â€”æŠŠä»»æ„ä¸€ä¸ª sync æ”¹æˆ async</h2>

























<table><thead><tr><th>ä¿®æ”¹æ–¹æ¡ˆ</th><th>ä»£ç ç‰‡æ®µ</th><th>æ˜¯å¦æ­»é”</th></tr></thead><tbody><tr><td>â‘  â†’ async</td><td><code>waiter.async { â€¦ }</code></td><td>âŒ</td></tr><tr><td>â‘¡ â†’ async</td><td><code>chef.async { â€¦ }</code></td><td>âŒ</td></tr><tr><td>â‘¢ â†’ async</td><td><code>waiter.async { â€¦ }</code></td><td>âŒ</td></tr></tbody></table>
<p>ç»“è®ºï¼š åªè¦æ‰“ç ´â€œå¾ªç¯ç­‰å¾…é“¾â€ä¸­çš„ä»»æ„ä¸€ä¸ªç¯ï¼Œæ­»é”å³åˆ»è§£é™¤ã€‚</p>
<p>åœ¨çœŸå®é¡¹ç›®ä¸­ï¼Œä¼˜å…ˆæŠŠâ€œåå‘è°ƒç”¨â€åšæˆ async å³å¯ã€‚</p>
<h2 data-id="heading-5">å·¥ç¨‹ä¸­æœ€å®¹æ˜“è¸©çš„â€œéšæ€§æ­»é”â€</h2>
<ol>
<li>å¯¹å¤–æš´éœ² sync æ¥å£</li>
</ol>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ImageCache</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> queue <span class="hljs-operator">=</span> <span class="hljs-type">DispatchQueue</span>(label: <span class="hljs-string">"cache"</span>)
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> storage: [<span class="hljs-type">String</span>: <span class="hljs-type">UIImage</span>] <span class="hljs-operator">=</span> [:]
    
    <span class="hljs-comment">// âŒ å±é™©ï¼šæŠŠå†…éƒ¨é˜Ÿåˆ— sync æš´éœ²ç»™å¤–éƒ¨</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">read</span>&lt;<span class="hljs-type">T</span>&gt;(<span class="hljs-keyword">_</span> <span class="hljs-params">closure</span>: () -&gt; <span class="hljs-type">T</span>) -&gt; <span class="hljs-type">T</span> {
        <span class="hljs-keyword">return</span> queue.sync(execute: closure)   <span class="hljs-comment">// é—­åŒ…é‡Œå¯èƒ½å†è°ƒ read()</span>
    }
}
</code></pre>
<p>é—®é¢˜ï¼šè°ƒç”¨æ–¹å¯èƒ½åœ¨é—­åŒ…é‡Œå†æ¬¡è°ƒç”¨ <code>read()</code> â†’ é€’å½’åŒæ­¥ â†’ æ­»é”ã€‚</p>
<p>è§£å†³ï¼š</p>
<ul>
<li>ç»ä¸å¯¹å¤–æš´éœ² syncï¼›</li>
</ul>
<ol start="2">
<li>ä¸»çº¿ç¨‹ sync åˆ°ä¸»é˜Ÿåˆ—</li>
</ol>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-type">DispatchQueue</span>.main.sync {   <span class="hljs-comment">// âŒ 100 % æ­»é”</span>
    <span class="hljs-comment">// ä»£ç æ°¸è¿œä¸ä¼šè¿›æ¥</span>
}
</code></pre>
<p>åœºæ™¯ï¼šåœ¨åå°çº¿ç¨‹è®¡ç®—å®Œåï¼Œæƒ³â€œç«‹åˆ»â€å›ä¸»çº¿ç¨‹åˆ·æ–° UIï¼Œå´æ‰‹æ»‘å†™æˆ <code>sync</code>ã€‚</p>
<p>æ­£ç¡®å§¿åŠ¿ï¼š</p>
<p>æ°¸è¿œç”¨ <code>DispatchQueue.main.async { ... }</code>ã€‚</p>
<h2 data-id="heading-6">sync çš„æ­£ç¡®æ‰“å¼€æ–¹å¼â€”â€”â€œç§æœ‰é˜Ÿåˆ— + åŸå­è®¿é—®â€</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">/// çº¿ç¨‹å®‰å…¨çš„æ—¥æœŸæ ¼å¼åŒ–å™¨ç¼“å­˜</span>
<span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DateFormatterCache</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> formatters: [<span class="hljs-type">String</span>: <span class="hljs-type">DateFormatter</span>] <span class="hljs-operator">=</span> [:]
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> queue <span class="hljs-operator">=</span> <span class="hljs-type">DispatchQueue</span>(label: <span class="hljs-string">"cache.<span class="hljs-subst">\(UUID().uuidString)</span>"</span>)
    
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">formatter</span>(<span class="hljs-params">using</span> <span class="hljs-params">format</span>: <span class="hljs-type">String</span>) -&gt; <span class="hljs-type">DateFormatter</span> {
        <span class="hljs-comment">// 1. åªåœ¨æ­¤ç§æœ‰é˜Ÿåˆ—é‡ŒåŒæ­¥ï¼Œå¤–éƒ¨æ— æ³•é€’å½’æ ¹é™¤</span>
        <span class="hljs-keyword">return</span> queue.sync { [<span class="hljs-keyword">unowned</span> <span class="hljs-keyword">self</span>] <span class="hljs-keyword">in</span>
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> cached <span class="hljs-operator">=</span> formatters[format] {
                <span class="hljs-keyword">return</span> cached
            }
            <span class="hljs-keyword">let</span> df <span class="hljs-operator">=</span> <span class="hljs-type">DateFormatter</span>()
            df.locale <span class="hljs-operator">=</span> <span class="hljs-type">Locale</span>(identifier: <span class="hljs-string">"en_US_POSIX"</span>)
            df.dateFormat <span class="hljs-operator">=</span> format
            formatters[format] <span class="hljs-operator">=</span> df
            <span class="hljs-keyword">return</span> df
        }
    }
}
</code></pre>
<p>ä¸ºä»€ä¹ˆè¿™é‡Œä¸ä¼šæ­»é”ï¼Ÿ</p>
<ul>
<li><code>queue</code> ç§æœ‰ï¼Œå¤–éƒ¨æ— æ³•ç›´æ¥å¾€å®ƒå¡ sync ä»»åŠ¡ï¼›</li>
<li>å‡½æ•°å†…éƒ¨æ— é€’å½’è°ƒç”¨ï¼›</li>
<li>é—­åŒ…æ‰§è¡Œæ—¶é—´æçŸ­ï¼Œä¸ä¼šé˜»å¡ç”¨æˆ·å¯è§çº¿ç¨‹ã€‚</li>
</ul>
<p>checklist âœ…</p>





















<table><thead><tr><th>ä½¿ç”¨ sync å‰è‡ªé—®</th><th>å›ç­”</th></tr></thead><tbody><tr><td>é˜Ÿåˆ—æ˜¯å¦ç§æœ‰ï¼Ÿ</td><td>âœ…</td></tr><tr><td>é—­åŒ…é‡Œè¿˜ä¼š sync åˆ°åŒé˜Ÿåˆ—å—ï¼Ÿ</td><td>âŒ</td></tr><tr><td>é˜»å¡æ˜¯å¦å½±å“ä¸»çº¿ç¨‹/ç”¨æˆ·æ»‘åŠ¨ï¼Ÿ</td><td>âŒ</td></tr></tbody></table>
<h2 data-id="heading-7">å°è£…ä¸€ä¸ªâ€œé˜²æ­»é”â€çš„è¯»å†™é”</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">/// è¯»å†™é”ï¼šå†™æ“ä½œ barrierï¼Œè¯»æ“ä½œå¹¶å‘</span>
<span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RWLock</span>&lt;<span class="hljs-title class_">T</span>&gt; {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> value: <span class="hljs-type">T</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> queue: <span class="hljs-type">DispatchQueue</span>
    
    <span class="hljs-keyword">init</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">initial</span>: <span class="hljs-type">T</span>) {
        value <span class="hljs-operator">=</span> initial
        queue <span class="hljs-operator">=</span> <span class="hljs-type">DispatchQueue</span>(label: <span class="hljs-string">"rw.<span class="hljs-subst">\(UUID().uuidString)</span>"</span>, attributes: .concurrent)
    }
    
    <span class="hljs-comment">// è¯»ï¼šå¹¶å‘</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">read</span>&lt;<span class="hljs-type">U</span>&gt;(<span class="hljs-keyword">_</span> <span class="hljs-params">closure</span>: (<span class="hljs-type">T</span>) <span class="hljs-keyword">throws</span> -&gt; <span class="hljs-type">U</span>) <span class="hljs-keyword">rethrows</span> -&gt; <span class="hljs-type">U</span> {
        <span class="hljs-keyword">try</span> queue.sync { <span class="hljs-keyword">try</span> closure(value) }
    }
    
    <span class="hljs-comment">// å†™ï¼šbarrier</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">write</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">closure</span>: <span class="hljs-keyword">@escaping</span> (<span class="hljs-keyword">inout</span> <span class="hljs-type">T</span>) -&gt; <span class="hljs-type">Void</span>) {
        queue.async(flags: .barrier) { closure(<span class="hljs-operator">&amp;</span><span class="hljs-keyword">self</span>.value) }
    }
}
</code></pre>
<p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>è¯»å¹¶è¡Œã€å†™ä¸²è¡Œï¼›</li>
<li>å¤–éƒ¨æ— æ³•æ‹¿åˆ° <code>queue</code> å¼•ç”¨ï¼Œå½»åº•æœç»é€’å½’ syncï¼›</li>
<li>æ‰€æœ‰å†™æ“ä½œæ˜¯ <code>async</code>ï¼Œä¸ä¼šé˜»å¡è°ƒç”¨æ–¹ã€‚</li>
</ul>
<h2 data-id="heading-8">æ€»ç»“â€”â€”ä¸€å¥è¯è®°ä½</h2>
<p><strong>é™¤éä½ åœ¨åšåŸå­è®¿é—®ï¼Œä¸”é˜Ÿåˆ—ç§æœ‰ã€æ— é€’å½’ï¼Œå¦åˆ™ä¸€å¾‹ç”¨ asyncã€‚</strong></p>
<h2 data-id="heading-9">æ‰©å±•é˜…è¯» &amp; ä¸‹ä¸€æ­¥</h2>
<ol>
<li>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.apple.com%2Fdocumentation%2Fdispatch%2Fdispatchqueue%2F1452870-sync" target="_blank" title="https://developer.apple.com/documentation/dispatch/dispatchqueue/1452870-sync" ref="nofollow noopener noreferrer">DispatchQueue.sync</a></li>
<li>WWDC 2022 â€“ Visualize and eliminate hangs with Instruments</li>
<li>Swift Concurrency æ—¶ä»£ï¼š
<ul>
<li>ç”¨ <code>actor</code> æ›¿ä»£â€œç§æœ‰é˜Ÿåˆ— + syncâ€ï¼›</li>
<li>ç”¨ <code>AsyncSequence</code> åšâ€œå¼‚æ­¥å›è°ƒé“¾â€ï¼Œå¤©ç„¶é¿å…æ­»é”ã€‚</li>
</ul>
</li>
</ol>
<h2 data-id="heading-10">å­¦ä¹ èµ„æ–™</h2>
<ol>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.donnywals.com%2Funderstanding-how-dispatchqueue-sync-can-cause-deadlocks%2F" target="_blank" title="https://www.donnywals.com/understanding-how-dispatchqueue-sync-can-cause-deadlocks/" ref="nofollow noopener noreferrer">www.donnywals.com/understandiâ€¦</a></li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€å‰ç«¯æ•ˆç‡å·¥å…·ã€‘å†ä¹Ÿä¸ç”¨ APIfox è”è°ƒï¼é›¶ä¾µå…¥ Mockï¼Œå…¨ç¨‹ä¸æ”¹ä»£ç ã€ä¸å¼€ä»£ç†]]></title>    <link>https://juejin.cn/post/7570984257666056238</link>    <guid>https://juejin.cn/post/7570984257666056238</guid>    <pubDate>2025-11-11T00:15:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570984257666056238" data-draft-id="7569813790533730323" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€å‰ç«¯æ•ˆç‡å·¥å…·ã€‘å†ä¹Ÿä¸ç”¨ APIfox è”è°ƒï¼é›¶ä¾µå…¥ Mockï¼Œå…¨ç¨‹ä¸æ”¹ä»£ç ã€ä¸å¼€ä»£ç†"/> <meta itemprop="keywords" content="å‰ç«¯,æµè§ˆå™¨,JavaScript"/> <meta itemprop="datePublished" content="2025-11-11T00:15:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸ä¸€æ ·çš„å°‘å¹´_"/> <meta itemprop="url" content="https://juejin.cn/user/3035079961218551"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€å‰ç«¯æ•ˆç‡å·¥å…·ã€‘å†ä¹Ÿä¸ç”¨ APIfox è”è°ƒï¼é›¶ä¾µå…¥ Mockï¼Œå…¨ç¨‹ä¸æ”¹ä»£ç ã€ä¸å¼€ä»£ç†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3035079961218551/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸ä¸€æ ·çš„å°‘å¹´_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T00:15:35.000Z" title="Tue Nov 11 2025 00:15:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    22
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»16åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>ä¸Šå‘¨å››ä¸‹åˆï¼Œæˆ‘æ­£åœ¨è°ƒæ ·å¼ï¼Œçªç„¶ç”µè„‘é£æ‰‡å¼€å§‹å’†å“®ã€‚</p>
<p>æ‰“å¼€ä»»åŠ¡ç®¡ç†å™¨ï¼š<strong>å†…å­˜å ç”¨ 15.5G / 16G</strong>ã€‚</p>
<p>æˆ‘äººå‚»äº†ï¼Œ16G å†…å­˜å¼€å‘ä¸ªå‰ç«¯é¡¹ç›®è¿˜èƒ½å¡ï¼Ÿ</p>
<p>ä»”ç»†ä¸€çœ‹ï¼š</p>
<ul>
<li><strong>VSCode</strong>ï¼š2.1Gï¼ˆè·‘ç€é¡¹ç›®ï¼Œæ­£å¸¸ï¼‰</li>
<li><strong>Chrome 30 ä¸ªæ ‡ç­¾é¡µ</strong>ï¼š4.5Gï¼ˆæ˜é‡‘ã€Stack Overflowã€GitHubã€æ–‡æ¡£...èƒ½ç†è§£ï¼‰</li>
<li><strong>APIfox</strong>ï¼š1.5Gï¼ˆï¼Ÿï¼Ÿï¼Ÿï¼‰</li>
<li><strong>å¾®ä¿¡ + ä¼ä¸šå¾®ä¿¡</strong>ï¼š1.1Gï¼ˆæ²¡åŠæ³•ï¼Œå·¥ä½œè¦ç”¨ï¼‰</li>
<li><strong>å…¶ä»–è‹¥å¹²è¿›ç¨‹â€¦</strong>ï¼š...</li>
</ul>
<p><strong>APIfoxè¿™ä¸€ä¸ªå·¥å…·ï¼Œå äº† 1.5Gï¼Ÿ</strong></p>
<p>å…³é”®æ˜¯ï¼Œæˆ‘åªæ˜¯æƒ³ Mock å‡ ä¸ªæ¥å£è€Œå·²ï¼Œä¸ºä»€ä¹ˆè¦ï¼š</p>
<ul>
<li>è£…ä¸€ä¸ª 500M+ çš„å®¢æˆ·ç«¯</li>
<li>å¼€ä»£ç†ï¼ˆè¿˜å¾—è®°å¾—å…³ï¼‰</li>
<li>æ¥å›åˆ‡çª—å£ï¼ˆæµè§ˆå™¨ â†’ APIfox â†’ VSCodeï¼‰</li>
<li>å ç”¨ 1.5G å†…å­˜</li>
</ul>
<p>æˆ‘è¯•è¿‡å…¶ä»–æ–¹æ¡ˆï¼š</p>
<ul>
<li><strong>åœ¨ä»£ç é‡Œå†™æ­» Mock æ•°æ®</strong> â†’ æœ‰æ—¶å€™å¿˜è®°åˆ æ‰ï¼Œä¸Šçº¿å·®ç‚¹å¸¦ç€å‡æ•°æ®å†²è¿›ç”Ÿäº§</li>
<li><strong>ç”¨ Mock.js</strong> â†’ é…ç½®å¤ªéº»çƒ¦ï¼Œè¿˜è¦æ”¹ä»£ç </li>
</ul>
<p>æˆ‘æƒ³è¦çš„æ˜¯ï¼šä¸è£…å®¢æˆ·ç«¯ã€ä¸æ”¹ä»£ç ã€ä¸å¼€ä»£ç†ã€ä¸è€—å†…å­˜ã€ä¸€é”®åˆ‡æ¢ Mock å¼€å…³
ã€‚
äºæ˜¯ï¼Œæˆ‘èŠ±äº†ä¸€ä¸ªå‘¨æœ«ï¼Œåšäº†ä¸€ä¸ªchromeæµè§ˆå™¨æ’ä»¶ã€‚</p>
<p><strong>ç°åœ¨mockä¸ç”¨ APIfoxï¼Œå†…å­˜å ç”¨é™äº†ä¸å°‘ï¼Œç”µè„‘é¡ºå¤šäº†ï¼Œæµè§ˆå™¨é‡Œä¸€é”® Mockï¼Œè°ƒè¯•åˆå¿«åˆçœå¿ƒã€‚</strong></p>
</blockquote>
<h2 data-id="heading-0">æ•ˆæœæ¼”ç¤º:  ä¸‹é¢æ˜¯æ’ä»¶åœ¨æ‹¦æˆª fetch/xhr è¯·æ±‚å¹¶è¿”å› Mock æ•°æ®æ—¶çš„æ¼”ç¤ºï¼š</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ff5b4c2ddc4432491f849c8b01888f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763425628&amp;x-signature=vX5kaq6xW7Qc79Dwj3h56zjZo7k%3D" alt="mockæ’ä»¶æ•ˆæœ.gif" loading="lazy"/></p>
<h2 data-id="heading-1">æ’ä»¶åŠŸèƒ½é¢„è§ˆ</h2>
<ul>
<li>æ‹¦æˆªé¡µé¢çš„ <code>fetch</code>ã€<code>xhr</code> è¯·æ±‚</li>
<li>è§„åˆ™æ”¯æŒæ¨¡ç³ŠåŒ¹é…å’Œå®Œå…¨åŒ¹é…</li>
<li>æ”¯æŒæŒ‰ HTTP æ–¹æ³•è¿‡æ»¤ï¼ˆGET/POST/PUT/DELETEï¼‰</li>
<li>è‡ªå®šä¹‰è¿”å› JSON æ•°æ®</li>
<li><code>æŒç»­ä¼˜åŒ–ä¸­ï¼šæ€§èƒ½ã€åŒ¹é…è§„åˆ™å’Œç”¨æˆ·ä½“éªŒä¼šä¸æ–­è¿­ä»£ï¼Œæ¬¢è¿åé¦ˆä¸å»ºè®®</code></li>
</ul>
<h2 data-id="heading-2">æ ¹æœ¬åŸç†ï¼šåŠ«æŒæµè§ˆå™¨çš„ç½‘ç»œè¯·æ±‚æ–¹æ³•</h2>
<h3 data-id="heading-3">ä¸€å¥è¯æ€»ç»“</h3>
<p><strong>åœ¨ç½‘é¡µåŠ è½½å‰ï¼Œå·å·æ›¿æ¢æ‰æµè§ˆå™¨åŸç”Ÿçš„</strong> <strong><code>fetch</code></strong> <strong>å’Œ</strong> <strong><code>XMLHttpRequest</code></strong> <strong>ï¼Œè®©æ‰€æœ‰ç½‘ç»œè¯·æ±‚å…ˆç»è¿‡æˆ‘ä»¬çš„"æ£€æŸ¥ç«™"ï¼Œç¬¦åˆè§„åˆ™çš„å°±è¿”å›å‡æ•°æ®ï¼Œä¸ç¬¦åˆçš„å°±æ”¾è¡Œã€‚</strong></p>
<h3 data-id="heading-4">åŸç†:</h3>
<pre><code class="hljs language-sql" lang="sql">æ­£å¸¸æƒ…å†µï¼š
ç½‘é¡µä»£ç  â†’ <span class="hljs-keyword">fetch</span>(<span class="hljs-string">'/api/user'</span>) â†’ æµè§ˆå™¨å‘é€çœŸå®è¯·æ±‚ â†’ æœåŠ¡å™¨

æ’ä»¶ä»‹å…¥åï¼š
ç½‘é¡µä»£ç  â†’ <span class="hljs-keyword">fetch</span>(<span class="hljs-string">'/api/user'</span>) 
           â†“
       æˆ‘ä»¬çš„å‡ <span class="hljs-keyword">fetch</span>ï¼ˆæ£€æŸ¥æ˜¯å¦éœ€è¦ Mockï¼‰
           â†“
    éœ€è¦ Mockï¼Ÿ
    â”œâ”€ æ˜¯ â†’ ç›´æ¥è¿”å›å‡æ•°æ® âœ…
    â””â”€ å¦ â†’ è°ƒç”¨çœŸæ­£çš„ <span class="hljs-keyword">fetch</span> å‘é€è¯·æ±‚ â†’ æœåŠ¡å™¨
</code></pre>
<h3 data-id="heading-5">å…·ä½“å®ç°ï¼ˆç®€åŒ–ç‰ˆï¼‰</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 1. ä¿å­˜åŸå§‹æ–¹æ³•</span>
<span class="hljs-keyword">const</span> çœŸæ­£çš„fetch = <span class="hljs-variable language_">window</span>.<span class="hljs-property">fetch</span>;

<span class="hljs-comment">// 2. æ›¿æ¢æˆæˆ‘ä»¬çš„æ–¹æ³•</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-property">fetch</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">url</span>) {
  <span class="hljs-comment">// 3. æ£€æŸ¥æ˜¯å¦éœ€è¦ Mock</span>
  <span class="hljs-keyword">if</span> (url.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'/api/user'</span>)) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ‹¦æˆªæˆåŠŸï¼è¿”å›å‡æ•°æ®'</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>({
      <span class="hljs-attr">json</span>: <span class="hljs-function">() =&gt;</span> ({ <span class="hljs-attr">name</span>: <span class="hljs-string">'Mock User'</span> })
    });
  }
  
  <span class="hljs-comment">// 4. ä¸éœ€è¦ Mockï¼Œè°ƒç”¨åŸå§‹æ–¹æ³•</span>
  <span class="hljs-keyword">return</span> çœŸæ­£çš„<span class="hljs-title function_">fetch</span>(url);
};
</code></pre>
<p><strong>å…³é”®ç‚¹ï¼š</strong></p>
<ul>
<li>å¿…é¡»å…ˆä¿å­˜åŸå§‹æ–¹æ³•ï¼Œå¦åˆ™æ— æ³•å‘é€çœŸå®è¯·æ±‚</li>
<li>å¿…é¡»åœ¨ç½‘é¡µåŠ è½½å‰æ‰§è¡Œï¼Œå¦åˆ™æ‹¦æˆªä¸åˆ°æ—©æœŸè¯·æ±‚</li>
<li>XMLHttpRequest åŒç†ï¼Œé‡å†™ <code>open</code> å’Œ <code>send</code> æ–¹æ³•</li>
</ul>
<h2 data-id="heading-6">é¡¹ç›®ç»“æ„</h2>
<pre><code class="hljs language-bash" lang="bash">quick-mock/
â”œâ”€â”€ manifest.json      <span class="hljs-comment"># æ’ä»¶é…ç½®æ–‡ä»¶</span>
â”œâ”€â”€ popup.html         <span class="hljs-comment"># å¼¹çª—é¡µé¢</span>
â”œâ”€â”€ popup.css          <span class="hljs-comment"># å¼¹çª—æ ·å¼</span>
â”œâ”€â”€ popup.js           <span class="hljs-comment"># å¼¹çª—é€»è¾‘</span>
â”œâ”€â”€ content.js         <span class="hljs-comment"># å†…å®¹è„šæœ¬ </span>
â””â”€â”€ injected.js        <span class="hljs-comment"># æ³¨å…¥è„šæœ¬ </span>
</code></pre>
<p>ğŸš€ <em><strong>æµè§ˆé¡¹ç›®çš„å®Œæ•´ä»£ç å¯ä»¥ç‚¹å‡»è¿™é‡Œ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTeernage%2Fquick-mock" target="_blank" title="https://github.com/Teernage/quick-mock" ref="nofollow noopener noreferrer">github.com/Teernage/quâ€¦</a>ï¼Œå¦‚æœå¯¹ä½ æœ‰å¸®åŠ©æ¬¢è¿Starã€‚</strong></em></p>
<h2 data-id="heading-7">æ–‡ä»¶åˆ†å·¥ï¼š6 ä¸ªæ–‡ä»¶çš„è§’è‰²</h2>
<h3 data-id="heading-8">ç•Œé¢å±‚ï¼ˆç”¨æˆ·äº¤äº’ï¼‰</h3>
<h4 data-id="heading-9">1. <strong>popup.html</strong> - æ’ä»¶çš„"è„¸é¢"-   ä½œç”¨ï¼šç”¨æˆ·ç‚¹å‡»æ’ä»¶å›¾æ ‡çœ‹åˆ°çš„å¼¹çª—ç•Œé¢</h4>
<ul>
<li>åŒ…å«ï¼šè¾“å…¥æ¡†ã€æŒ‰é’®ã€è§„åˆ™åˆ—è¡¨</li>
</ul>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"popup.css"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"header"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>API Mock<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>è½»é‡çº§æ¥å£æ¨¡æ‹Ÿå·¥å…·<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn-open-tab"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"openTab"</span>&gt;</span>åœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input-group"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>URL åŒ¹é…è§„åˆ™<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"url-row"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"matchMode"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"match-mode-select"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"contains"</span>&gt;</span>åŒ…å«<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"exact"</span>&gt;</span>å®Œæ•´åŒ¹é…<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"url"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"è¾“å…¥ URL æˆ–å…³é”®è¯"</span> /&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input-group"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>è¯·æ±‚æ–¹æ³•<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"method"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"ALL"</span>&gt;</span>ALL<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"GET"</span>&gt;</span>GET<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"POST"</span>&gt;</span>POST<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"PUT"</span>&gt;</span>PUT<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"DELETE"</span>&gt;</span>DELETE<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input-group"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>Mock æ•°æ® (JSON)<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">textarea</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"data"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">'{"code": 0, "data": {}}'</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">textarea</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn-group"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"add"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn-primary"</span>&gt;</span>æ·»åŠ è§„åˆ™<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"clear"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn-secondary"</span>&gt;</span>æ¸…ç©ºå…¨éƒ¨<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"rules-header"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>å·²æ·»åŠ è§„åˆ™<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"rules-count"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"count"</span>&gt;</span>0 æ¡<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"rules"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"popup.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h4 data-id="heading-10">2. <strong>popup.css</strong> - ç•Œé¢æ ·å¼</h4>
<pre><code class="hljs language-css" lang="css">* {
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">box-sizing</span>: border-box;
}

<span class="hljs-selector-tag">body</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">480px</span>;
  <span class="hljs-attribute">min-height</span>: <span class="hljs-number">480px</span>;
  <span class="hljs-attribute">font-family</span>: -apple-system, BlinkMacSystemFont, <span class="hljs-string">'SF Pro Text'</span>, <span class="hljs-string">'PingFang SC'</span>,
    sans-serif;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#fafafa</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#1d1d1f</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">13px</span>;
}

<span class="hljs-selector-class">.header</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span> <span class="hljs-number">18px</span> <span class="hljs-number">18px</span>;
  <span class="hljs-attribute">background</span>: transparent;
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">justify-content</span>: space-between;
  <span class="hljs-attribute">align-items</span>: start;
}

<span class="hljs-selector-class">.header</span> <span class="hljs-selector-tag">h1</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">18px</span>;
  <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">600</span>;
  <span class="hljs-attribute">letter-spacing</span>: -<span class="hljs-number">0.3px</span>;
  <span class="hljs-attribute">color</span>: white;
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">135deg</span>, <span class="hljs-number">#6b7cff</span> <span class="hljs-number">0%</span>, <span class="hljs-number">#8b9aff</span> <span class="hljs-number">100%</span>);
  <span class="hljs-attribute">display</span>: inline-block;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">2px</span> <span class="hljs-number">11px</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">6px</span>;
}

<span class="hljs-selector-class">.header</span> <span class="hljs-selector-tag">p</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#8e8e93</span>;
  <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">400</span>;
  <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">2px</span>;
}

<span class="hljs-selector-class">.btn-open-tab</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">6px</span> <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">background</span>: white;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#6b7cff</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#e0e0e0</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">6px</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">11px</span>;
  <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">500</span>;
  <span class="hljs-attribute">cursor</span>: pointer;
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.2s</span>;
  <span class="hljs-attribute">white-space</span>: nowrap;
}

<span class="hljs-selector-class">.btn-open-tab</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f5f5f7</span>;
  <span class="hljs-attribute">border-color</span>: <span class="hljs-number">#6b7cff</span>;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">1px</span>);
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">8px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">107</span>, <span class="hljs-number">124</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.15</span>);
}

<span class="hljs-selector-class">.btn-open-tab</span><span class="hljs-selector-pseudo">:active</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">0</span>);
}

<span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">14px</span> <span class="hljs-number">14px</span>;
}

<span class="hljs-selector-class">.card</span> {
  <span class="hljs-attribute">background</span>: white;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">14px</span>;
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#e8e8e8</span>;
}

<span class="hljs-selector-class">.input-group</span> {
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">10px</span>;
}

<span class="hljs-selector-class">.input-group</span><span class="hljs-selector-pseudo">:last-of-type</span> {
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">12px</span>;
}

<span class="hljs-selector-class">.input-group</span> <span class="hljs-selector-tag">label</span> {
  <span class="hljs-attribute">display</span>: block;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">500</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#8e8e93</span>;
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">5px</span>;
}

<span class="hljs-comment">/* URL è¾“å…¥è¡Œ */</span>
<span class="hljs-selector-class">.url-row</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">6px</span>;
  <span class="hljs-attribute">align-items</span>: center;
}

<span class="hljs-selector-class">.match-mode-select</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">85px</span>;
  <span class="hljs-attribute">flex-shrink</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#e0e0e0</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">7px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span> <span class="hljs-number">6px</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">background</span>: white;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#1d1d1f</span>;
  <span class="hljs-attribute">cursor</span>: pointer;
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.2s</span>;
}

<span class="hljs-selector-class">.match-mode-select</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">border-color</span>: <span class="hljs-number">#6b7cff</span>;
}

<span class="hljs-selector-class">.match-mode-select</span><span class="hljs-selector-pseudo">:focus</span> {
  <span class="hljs-attribute">outline</span>: none;
  <span class="hljs-attribute">border-color</span>: <span class="hljs-number">#6b7cff</span>;
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">3px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">107</span>, <span class="hljs-number">124</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.1</span>);
}

<span class="hljs-selector-tag">input</span>,
<span class="hljs-selector-tag">textarea</span>,
select {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#e0e0e0</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">7px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span> <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">13px</span>;
  <span class="hljs-attribute">background</span>: white;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#1d1d1f</span>;
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.2s</span>;
}

<span class="hljs-selector-tag">input</span><span class="hljs-selector-pseudo">:focus</span>,
<span class="hljs-selector-tag">textarea</span><span class="hljs-selector-pseudo">:focus</span>,
select<span class="hljs-selector-pseudo">:focus</span> {
  <span class="hljs-attribute">outline</span>: none;
  <span class="hljs-attribute">border-color</span>: <span class="hljs-number">#6b7cff</span>;
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">3px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">107</span>, <span class="hljs-number">124</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.1</span>);
}

<span class="hljs-selector-tag">textarea</span> {
  <span class="hljs-attribute">min-height</span>: <span class="hljs-number">80px</span>;
  <span class="hljs-attribute">resize</span>: vertical;
  <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'SF Mono'</span>, Monaco, Consolas, monospace;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.5</span>;
}

<span class="hljs-selector-class">.btn-group</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">8px</span>;
}

<span class="hljs-selector-class">.btn-primary</span>,
<span class="hljs-selector-class">.btn-secondary</span> {
  <span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">9px</span> <span class="hljs-number">0</span>;
  <span class="hljs-attribute">border</span>: none;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">7px</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">13px</span>;
  <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">500</span>;
  <span class="hljs-attribute">cursor</span>: pointer;
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.2s</span>;
}

<span class="hljs-selector-class">.btn-primary</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">135deg</span>, <span class="hljs-number">#6b7cff</span> <span class="hljs-number">0%</span>, <span class="hljs-number">#8b9aff</span> <span class="hljs-number">100%</span>);
  <span class="hljs-attribute">color</span>: white;
}

<span class="hljs-selector-class">.btn-primary</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">1px</span>);
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">4px</span> <span class="hljs-number">12px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">107</span>, <span class="hljs-number">124</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.3</span>);
}

<span class="hljs-selector-class">.btn-primary</span><span class="hljs-selector-pseudo">:active</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">0</span>);
}

<span class="hljs-selector-class">.btn-secondary</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f5f5f7</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#1d1d1f</span>;
}

<span class="hljs-selector-class">.btn-secondary</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#e8e8ea</span>;
}

<span class="hljs-selector-class">.rules-header</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">justify-content</span>: space-between;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">4px</span> <span class="hljs-number">8px</span>;
}

<span class="hljs-selector-class">.rules-header</span> <span class="hljs-selector-tag">h2</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
  <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">600</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#1d1d1f</span>;
}

<span class="hljs-selector-class">.rules-count</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">11px</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#8e8e93</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f5f5f7</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">2px</span> <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">10px</span>;
}

<span class="hljs-selector-id">#rules</span> {
  <span class="hljs-attribute">max-height</span>: <span class="hljs-number">300px</span>;
  <span class="hljs-attribute">overflow-y</span>: auto;
}

<span class="hljs-selector-class">.rule-item</span> {
  <span class="hljs-attribute">background</span>: white;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#e8e8e8</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.2s</span>;
}

<span class="hljs-comment">/*  æ·»åŠ ç¦ç”¨çŠ¶æ€æ ·å¼ */</span>
<span class="hljs-selector-class">.rule-item</span><span class="hljs-selector-class">.disabled</span> {
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.5</span>;
}

<span class="hljs-selector-class">.rule-item</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">border-color</span>: <span class="hljs-number">#6b7cff</span>;
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">8px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">107</span>, <span class="hljs-number">124</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.1</span>);
}

<span class="hljs-selector-class">.rule-header</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">justify-content</span>: space-between;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">6px</span>;
}

<span class="hljs-selector-class">.rule-url</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">6px</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#1d1d1f</span>;
  <span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span>;
  <span class="hljs-attribute">min-width</span>: <span class="hljs-number">0</span>;
}

<span class="hljs-selector-class">.rule-url</span> <span class="hljs-selector-tag">span</span><span class="hljs-selector-pseudo">:last-child</span> {
  <span class="hljs-attribute">overflow</span>: hidden;
  <span class="hljs-attribute">text-overflow</span>: ellipsis;
  <span class="hljs-attribute">white-space</span>: nowrap;
}

<span class="hljs-selector-class">.method-badge</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">2px</span> <span class="hljs-number">6px</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">600</span>;
  <span class="hljs-attribute">flex-shrink</span>: <span class="hljs-number">0</span>;
}

<span class="hljs-selector-class">.method-all</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#e0e7ff</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#4338ca</span>;
}

<span class="hljs-selector-class">.method-get</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#d1fae5</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#065f46</span>;
}

<span class="hljs-selector-class">.method-post</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#fef3c7</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#92400e</span>;
}

<span class="hljs-selector-class">.method-put</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#dbeafe</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#1e40af</span>;
}

<span class="hljs-selector-class">.method-delete</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#fee2e2</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#991b1b</span>;
}

<span class="hljs-selector-class">.match-mode-badge</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">2px</span> <span class="hljs-number">6px</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">500</span>;
  <span class="hljs-attribute">flex-shrink</span>: <span class="hljs-number">0</span>;
}

<span class="hljs-selector-class">.match-mode-contains</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f3f4f6</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#6b7280</span>;
}

<span class="hljs-selector-class">.match-mode-exact</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#e0e7ff</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#4338ca</span>;
}



<span class="hljs-comment">/* æ–°çš„å¼€å…³æ ·å¼ */</span>
<span class="hljs-selector-class">.rule-toggle-wrapper</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">6px</span>;
}

<span class="hljs-comment">/* éšè— checkbox */</span>
<span class="hljs-selector-class">.rule-toggle-checkbox</span> {
  <span class="hljs-attribute">display</span>: none;
}

<span class="hljs-selector-class">.toggleSwitch</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">justify-content</span>: center;
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">36px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgb</span>(<span class="hljs-number">82</span>, <span class="hljs-number">82</span>, <span class="hljs-number">82</span>);
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">cursor</span>: pointer;
  <span class="hljs-attribute">transition-duration</span>: .<span class="hljs-number">2s</span>;
  <span class="hljs-attribute">flex-shrink</span>: <span class="hljs-number">0</span>;
}

<span class="hljs-selector-class">.toggleSwitch</span><span class="hljs-selector-pseudo">::after</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-string">""</span>;
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">6px</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">6px</span>;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">background-color</span>: transparent;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>;
  <span class="hljs-attribute">transition-duration</span>: .<span class="hljs-number">2s</span>;
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">3px</span> <span class="hljs-number">1px</span> <span class="hljs-number">5px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">8</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8</span>, <span class="hljs-number">0.26</span>);
  <span class="hljs-attribute">border</span>: <span class="hljs-number">4px</span> solid white;

}

<span class="hljs-selector-class">.rule-toggle-checkbox</span><span class="hljs-selector-pseudo">:checked</span>+<span class="hljs-selector-class">.toggleSwitch</span><span class="hljs-selector-pseudo">::after</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(<span class="hljs-number">100%</span>);
  <span class="hljs-attribute">transition-duration</span>: .<span class="hljs-number">2s</span>;
  <span class="hljs-attribute">background-color</span>: white;
}

<span class="hljs-selector-class">.rule-toggle-checkbox</span><span class="hljs-selector-pseudo">:checked</span>+<span class="hljs-selector-class">.toggleSwitch</span> {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgb</span>(<span class="hljs-number">148</span>, <span class="hljs-number">118</span>, <span class="hljs-number">255</span>);
  <span class="hljs-attribute">transition-duration</span>: .<span class="hljs-number">2s</span>;
}

<span class="hljs-comment">/* ç¦ç”¨çŠ¶æ€æ—¶çš„å¼€å…³æ ·å¼ */</span>
<span class="hljs-selector-class">.disabled</span> <span class="hljs-selector-class">.toggleSwitch</span> {
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.6</span>;
}

<span class="hljs-selector-class">.btn-delete</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">4px</span> <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#fee2e2</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#991b1b</span>;
  <span class="hljs-attribute">border</span>: none;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">5px</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">11px</span>;
  <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">500</span>;
  <span class="hljs-attribute">cursor</span>: pointer;
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.2s</span>;
  <span class="hljs-attribute">flex-shrink</span>: <span class="hljs-number">0</span>;
}

<span class="hljs-selector-class">.btn-delete</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#fecaca</span>;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">1px</span>);
}

<span class="hljs-selector-class">.btn-delete</span><span class="hljs-selector-pseudo">:active</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">0</span>);
}

<span class="hljs-selector-class">.rule-data</span> {
  <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'SF Mono'</span>, Monaco, Consolas, monospace;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">11px</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#6b7280</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f9fafb</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">6px</span> <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">5px</span>;
  <span class="hljs-attribute">overflow-x</span>: auto;
  <span class="hljs-attribute">white-space</span>: pre-wrap;
  <span class="hljs-attribute">word-break</span>: break-all;
}

<span class="hljs-selector-class">.empty-state</span> {
  <span class="hljs-attribute">text-align</span>: center;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">40px</span> <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#8e8e93</span>;
}

<span class="hljs-selector-class">.empty-state</span> svg {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">48px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">48px</span>;
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.3</span>;
}

<span class="hljs-selector-class">.empty-state</span> <span class="hljs-selector-tag">p</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">13px</span>;
}

<span class="hljs-selector-class">.toast</span> {
  <span class="hljs-attribute">position</span>: fixed;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">50%</span>;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">50%</span>;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translate</span>(-<span class="hljs-number">50%</span>, -<span class="hljs-number">50%</span>);
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.85</span>);
  <span class="hljs-attribute">color</span>: white;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span> <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">13px</span>;
  <span class="hljs-attribute">z-index</span>: <span class="hljs-number">10000</span>;
  <span class="hljs-attribute">animation</span>: fadeInOut <span class="hljs-number">1.5s</span> ease-in-out;
}

<span class="hljs-keyword">@keyframes</span> fadeInOut {

  <span class="hljs-number">0%</span>,
  <span class="hljs-number">100%</span> {
    <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;
  }

  <span class="hljs-number">10%</span>,
  <span class="hljs-number">90%</span> {
    <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;
  }
}

<span class="hljs-comment">/* æŠ˜å å±•å¼€ç›¸å…³æ ·å¼ */</span>
<span class="hljs-selector-class">.rule-data-wrapper</span> {
  <span class="hljs-attribute">position</span>: relative;
}

<span class="hljs-selector-class">.rule-data</span> {
  <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'SF Mono'</span>, Monaco, Consolas, monospace;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">11px</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#6b7280</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f9fafb</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">6px</span> <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">5px</span>;
  <span class="hljs-attribute">overflow</span>: hidden;
  <span class="hljs-attribute">white-space</span>: pre-wrap;
  <span class="hljs-attribute">word-break</span>: break-all;
  <span class="hljs-attribute">max-height</span>: <span class="hljs-number">60px</span>;
  <span class="hljs-attribute">transition</span>: max-height <span class="hljs-number">0.3s</span> ease;
}

<span class="hljs-selector-class">.rule-data</span><span class="hljs-selector-class">.expanded</span> {
  <span class="hljs-attribute">max-height</span>: none;
}

<span class="hljs-selector-class">.btn-toggle-data</span> {
  <span class="hljs-attribute">display</span>: inline-flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">6px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">4px</span> <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f5f5f7</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#6b7280</span>;
  <span class="hljs-attribute">border</span>: none;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">5px</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">11px</span>;
  <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">500</span>;
  <span class="hljs-attribute">cursor</span>: pointer;
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.2s</span>;
}

<span class="hljs-selector-class">.btn-toggle-data</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#e8e8ea</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#1d1d1f</span>;
}

<span class="hljs-selector-class">.btn-toggle-data</span> svg {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.2s</span>;
}

<span class="hljs-selector-class">.btn-toggle-data</span><span class="hljs-selector-class">.expanded</span> svg {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotate</span>(<span class="hljs-number">180deg</span>);
}

<span class="hljs-comment">/* æ¸å˜é®ç½©æ•ˆæœ */</span>
<span class="hljs-selector-class">.rule-data</span><span class="hljs-selector-pseudo">:not</span>(<span class="hljs-selector-class">.expanded</span>)<span class="hljs-selector-pseudo">::after</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-string">''</span>;
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(to bottom, transparent, <span class="hljs-number">#f9fafb</span>);
  <span class="hljs-attribute">pointer-events</span>: none;
}
</code></pre>
<h4 data-id="heading-11">3. <strong>popup.js</strong> - ç•Œé¢é€»è¾‘</h4>
<p>ä½œç”¨ï¼šå¤„ç†ç”¨æˆ·é…ç½®mockæ“ä½œ</p>
<p>åŠŸèƒ½ï¼š</p>
<ul>
<li>ç‚¹å‡»"æ·»åŠ è§„åˆ™" â†’ ä¿å­˜åˆ° chrome.storage</li>
<li>ç‚¹å‡»"åˆ é™¤" â†’ ä» chrome.storage ç§»é™¤</li>
<li>æ¸²æŸ“è§„åˆ™åˆ—è¡¨</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">let</span> rules = [];

<span class="hljs-keyword">const</span> openTabBtn = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'openTab'</span>);

<span class="hljs-comment">// åœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€</span>
openTabBtn.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">open</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>);
});

<span class="hljs-comment">// æ¢å¤è¾“å…¥æ¡†å†…å®¹</span>
chrome.<span class="hljs-property">storage</span>.<span class="hljs-property">local</span>.<span class="hljs-title function_">get</span>([<span class="hljs-string">'mockRules'</span>, <span class="hljs-string">'draftInput'</span>], <span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {
  rules = result.<span class="hljs-property">mockRules</span> || [];
  rules = rules.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">rule</span>) =&gt;</span> ({
    ...rule,
    <span class="hljs-attr">matchMode</span>: rule.<span class="hljs-property">matchMode</span> || <span class="hljs-string">'contains'</span>,
    <span class="hljs-attr">enabled</span>: rule.<span class="hljs-property">enabled</span> !== <span class="hljs-literal">false</span>, <span class="hljs-comment">//  é»˜è®¤å¯ç”¨</span>
  }));
  <span class="hljs-title function_">renderRules</span>();

  <span class="hljs-comment">// æ¢å¤è‰ç¨¿</span>
  <span class="hljs-keyword">const</span> draft = result.<span class="hljs-property">draftInput</span> || {};
  <span class="hljs-keyword">if</span> (draft.<span class="hljs-property">url</span>) <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'url'</span>).<span class="hljs-property">value</span> = draft.<span class="hljs-property">url</span>;
  <span class="hljs-keyword">if</span> (draft.<span class="hljs-property">method</span>) <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'method'</span>).<span class="hljs-property">value</span> = draft.<span class="hljs-property">method</span>;
  <span class="hljs-keyword">if</span> (draft.<span class="hljs-property">matchMode</span>)
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'matchMode'</span>).<span class="hljs-property">value</span> = draft.<span class="hljs-property">matchMode</span>;
  <span class="hljs-keyword">if</span> (draft.<span class="hljs-property">data</span>) <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'data'</span>).<span class="hljs-property">value</span> = draft.<span class="hljs-property">data</span>;
});

<span class="hljs-comment">// ç›‘å¬è¾“å…¥æ¡†å˜åŒ–ï¼Œè‡ªåŠ¨ä¿å­˜è‰ç¨¿</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">saveDraft</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> draft = {
    <span class="hljs-attr">url</span>: <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'url'</span>).<span class="hljs-property">value</span>.<span class="hljs-title function_">trim</span>(),
    <span class="hljs-attr">method</span>: <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'method'</span>).<span class="hljs-property">value</span>,
    <span class="hljs-attr">matchMode</span>: <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'matchMode'</span>).<span class="hljs-property">value</span>,
    <span class="hljs-attr">data</span>: <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'data'</span>).<span class="hljs-property">value</span>.<span class="hljs-title function_">trim</span>(),
  };
  chrome.<span class="hljs-property">storage</span>.<span class="hljs-property">local</span>.<span class="hljs-title function_">set</span>({ <span class="hljs-attr">draftInput</span>: draft });
}

<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'url'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'input'</span>, saveDraft);
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'method'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'change'</span>, saveDraft);
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'matchMode'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'change'</span>, saveDraft);
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'data'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'input'</span>, saveDraft);

<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'add'</span>).<span class="hljs-property">onclick</span> = <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> url = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'url'</span>).<span class="hljs-property">value</span>.<span class="hljs-title function_">trim</span>();
  <span class="hljs-keyword">const</span> method = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'method'</span>).<span class="hljs-property">value</span>;
  <span class="hljs-keyword">const</span> matchMode = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'matchMode'</span>).<span class="hljs-property">value</span>;
  <span class="hljs-keyword">const</span> data = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'data'</span>).<span class="hljs-property">value</span>.<span class="hljs-title function_">trim</span>();

  <span class="hljs-keyword">if</span> (!url || !data) {
    <span class="hljs-title function_">showToast</span>(<span class="hljs-string">'è¯·å¡«å†™å®Œæ•´ä¿¡æ¯'</span>);
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-keyword">try</span> {
    <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(data);
    <span class="hljs-comment">//  æ·»åŠ  enabled: true</span>
    rules.<span class="hljs-title function_">push</span>({ url, method, matchMode, data, <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span> });
    chrome.<span class="hljs-property">storage</span>.<span class="hljs-property">local</span>.<span class="hljs-title function_">set</span>({ <span class="hljs-attr">mockRules</span>: rules });

    <span class="hljs-comment">// æ¸…ç©ºè¾“å…¥æ¡†å’Œå­˜å‚¨</span>
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'url'</span>).<span class="hljs-property">value</span> = <span class="hljs-string">''</span>;
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'data'</span>).<span class="hljs-property">value</span> = <span class="hljs-string">''</span>;
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'method'</span>).<span class="hljs-property">value</span> = <span class="hljs-string">'ALL'</span>;
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'matchMode'</span>).<span class="hljs-property">value</span> = <span class="hljs-string">'contains'</span>;
    chrome.<span class="hljs-property">storage</span>.<span class="hljs-property">local</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">'draftInput'</span>);

    <span class="hljs-title function_">renderRules</span>();
    <span class="hljs-title function_">showToast</span>(<span class="hljs-string">'âœ“ æ·»åŠ æˆåŠŸ'</span>);
  } <span class="hljs-keyword">catch</span> (e) {
    <span class="hljs-title function_">showToast</span>(<span class="hljs-string">'JSON æ ¼å¼é”™è¯¯'</span>);
  }
};

<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'clear'</span>).<span class="hljs-property">onclick</span> = <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (rules.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">confirm</span>(<span class="hljs-string">'ç¡®å®šæ¸…ç©ºæ‰€æœ‰è§„åˆ™ï¼Ÿ'</span>)) {
    rules = [];
    chrome.<span class="hljs-property">storage</span>.<span class="hljs-property">local</span>.<span class="hljs-title function_">set</span>({ <span class="hljs-attr">mockRules</span>: [] });
    <span class="hljs-title function_">renderRules</span>();
    <span class="hljs-title function_">showToast</span>(<span class="hljs-string">'âœ“ å·²æ¸…ç©º'</span>);
  }
};

<span class="hljs-comment">//  æ·»åŠ å¼€å…³è§„åˆ™å‡½æ•°</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-property">toggleRule</span> = <span class="hljs-function">(<span class="hljs-params">index</span>) =&gt;</span> {
  rules[index].<span class="hljs-property">enabled</span> = !rules[index].<span class="hljs-property">enabled</span>;
  chrome.<span class="hljs-property">storage</span>.<span class="hljs-property">local</span>.<span class="hljs-title function_">set</span>({ <span class="hljs-attr">mockRules</span>: rules });
  <span class="hljs-title function_">renderRules</span>();
  <span class="hljs-keyword">const</span> status = rules[index].<span class="hljs-property">enabled</span> ? <span class="hljs-string">'å·²å¯ç”¨'</span> : <span class="hljs-string">'å·²ç¦ç”¨'</span>;
  <span class="hljs-title function_">showToast</span>(<span class="hljs-string">`âœ“ <span class="hljs-subst">${status}</span>`</span>);
};

<span class="hljs-keyword">function</span> <span class="hljs-title function_">renderRules</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> container = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'rules'</span>);
  <span class="hljs-keyword">const</span> count = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'count'</span>);
  count.<span class="hljs-property">textContent</span> = <span class="hljs-string">`<span class="hljs-subst">${rules.length}</span> æ¡`</span>;

  <span class="hljs-keyword">if</span> (rules.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
    container.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`
      &lt;div class="empty-state"&gt;
        &lt;svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"&gt;
          &lt;rect x="3" y="3" width="18" height="18" rx="2"/&gt;
          &lt;path d="M9 9h6M9 15h6"/&gt;
        &lt;/svg&gt;
        &lt;p&gt;æš‚æ—  Mock è§„åˆ™&lt;/p&gt;
      &lt;/div&gt;
    `</span>;
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-keyword">const</span> matchModeText = {
    <span class="hljs-attr">contains</span>: <span class="hljs-string">'åŒ…å«'</span>,
    <span class="hljs-attr">exact</span>: <span class="hljs-string">'å®Œæ•´'</span>,
  };

  container.<span class="hljs-property">innerHTML</span> = rules
    .<span class="hljs-title function_">map</span>(
      <span class="hljs-function">(<span class="hljs-params">rule, i</span>) =&gt;</span> <span class="hljs-string">`
    &lt;div class="rule-item <span class="hljs-subst">${rule.enabled === <span class="hljs-literal">false</span> ? <span class="hljs-string">'disabled'</span> : <span class="hljs-string">''</span>}</span>"&gt;
      &lt;div class="rule-header"&gt;
        &lt;div class="rule-url"&gt;
          &lt;span class="method-badge method-<span class="hljs-subst">${(rule.method || <span class="hljs-string">'ALL'</span>).toLowerCase()}</span>"&gt;<span class="hljs-subst">${rule.method || <span class="hljs-string">'ALL'</span>}</span>&lt;/span&gt;
          &lt;span class="match-mode-badge match-mode-<span class="hljs-subst">${rule.matchMode || <span class="hljs-string">'contains'</span>}</span>"&gt;<span class="hljs-subst">${matchModeText[rule.matchMode] || <span class="hljs-string">'åŒ…å«'</span>}</span>&lt;/span&gt;
          &lt;span&gt;<span class="hljs-subst">${escapeHtml(rule.url)}</span>&lt;/span&gt;
        &lt;/div&gt;
        &lt;div style="display: flex; gap: 6px; align-items: center;"&gt;
          &lt;div class="rule-toggle-wrapper"&gt;
            &lt;input 
              type="checkbox" 
              class="rule-toggle-checkbox" 
              id="toggle-<span class="hljs-subst">${i}</span>" 
              data-index="<span class="hljs-subst">${i}</span>"
              <span class="hljs-subst">${rule.enabled !== <span class="hljs-literal">false</span> ? <span class="hljs-string">'checked'</span> : <span class="hljs-string">''</span>}</span>
            &gt;
            &lt;label for="toggle-<span class="hljs-subst">${i}</span>" class="toggleSwitch"&gt;&lt;/label&gt;
          &lt;/div&gt;
          &lt;button class="btn-delete" data-index="<span class="hljs-subst">${i}</span>"&gt;åˆ é™¤&lt;/button&gt;
        &lt;/div&gt;
      &lt;/div&gt;
      &lt;div class="rule-data-wrapper"&gt;
        &lt;div class="rule-data" data-index="<span class="hljs-subst">${i}</span>"&gt;<span class="hljs-subst">${escapeHtml(rule.data)}</span>&lt;/div&gt;
        <span class="hljs-subst">${rule.data.length &gt; <span class="hljs-number">100</span> ? <span class="hljs-string">`
          &lt;button class="btn-toggle-data" data-index="<span class="hljs-subst">${i}</span>"&gt;
            &lt;span class="toggle-text"&gt;å±•å¼€&lt;/span&gt;
            &lt;svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"&gt;
              &lt;polyline points="6 9 12 15 18 9"&gt;&lt;/polyline&gt;
            &lt;/svg&gt;
          &lt;/button&gt;
        `</span> : <span class="hljs-string">''</span>}</span>
      &lt;/div&gt;
    &lt;/div&gt;
  `</span>
    )
    .<span class="hljs-title function_">join</span>(<span class="hljs-string">''</span>);

  <span class="hljs-comment">// å¼€å…³æŒ‰é’®äº‹ä»¶ï¼ˆæ›¿æ¢åŸæ¥çš„ .btn-toggle äº‹ä»¶ï¼‰</span>
  container.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'.rule-toggle-checkbox'</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">checkbox</span>) =&gt;</span> {
    checkbox.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'change'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> index = <span class="hljs-title class_">Number</span>(e.<span class="hljs-property">target</span>.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">'data-index'</span>));
      <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Number</span>.<span class="hljs-built_in">isNaN</span>(index)) {
        <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">toggleRule</span>(index);
      }
    });
  });

  <span class="hljs-comment">// åˆ é™¤æŒ‰é’®äº‹ä»¶</span>
  container.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'.btn-delete'</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">btn</span>) =&gt;</span> {
    btn.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">const</span> index = <span class="hljs-title class_">Number</span>(btn.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">'data-index'</span>));
      <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Number</span>.<span class="hljs-built_in">isNaN</span>(index)) {
        rules.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>);
        chrome.<span class="hljs-property">storage</span>.<span class="hljs-property">local</span>.<span class="hljs-title function_">set</span>({ <span class="hljs-attr">mockRules</span>: rules });
        <span class="hljs-title function_">renderRules</span>();
        <span class="hljs-title function_">showToast</span>(<span class="hljs-string">'âœ“ å·²åˆ é™¤'</span>);
      }
    });
  });

  <span class="hljs-comment">// æŠ˜å å±•å¼€æŒ‰é’®äº‹ä»¶</span>
  container.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'.btn-toggle-data'</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">btn</span>) =&gt;</span> {
    btn.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">const</span> index = <span class="hljs-title class_">Number</span>(btn.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">'data-index'</span>));
      <span class="hljs-keyword">const</span> dataElement = container.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">`.rule-data[data-index="<span class="hljs-subst">${index}</span>"]`</span>);
      <span class="hljs-keyword">const</span> isExpanded = dataElement.<span class="hljs-property">classList</span>.<span class="hljs-title function_">contains</span>(<span class="hljs-string">'expanded'</span>);

      dataElement.<span class="hljs-property">classList</span>.<span class="hljs-title function_">toggle</span>(<span class="hljs-string">'expanded'</span>);
      btn.<span class="hljs-property">classList</span>.<span class="hljs-title function_">toggle</span>(<span class="hljs-string">'expanded'</span>);
      btn.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.toggle-text'</span>).<span class="hljs-property">textContent</span> = isExpanded ? <span class="hljs-string">'å±•å¼€'</span> : <span class="hljs-string">'æ”¶èµ·'</span>;
    });
  });
}



<span class="hljs-keyword">function</span> <span class="hljs-title function_">escapeHtml</span>(<span class="hljs-params">text</span>) {
  <span class="hljs-keyword">const</span> div = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
  div.<span class="hljs-property">textContent</span> = text;
  <span class="hljs-keyword">return</span> div.<span class="hljs-property">innerHTML</span>;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">showToast</span>(<span class="hljs-params">message</span>) {
  <span class="hljs-keyword">const</span> toast = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
  toast.<span class="hljs-property">className</span> = <span class="hljs-string">'toast'</span>;
  toast.<span class="hljs-property">textContent</span> = message;
  <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(toast);
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> toast.<span class="hljs-title function_">remove</span>(), <span class="hljs-number">1500</span>);
}

</code></pre>
<h3 data-id="heading-12">æ ¸å¿ƒå±‚ï¼ˆæ‹¦æˆªé€»è¾‘ï¼‰</h3>
<h4 data-id="heading-13">4. <strong>content.js</strong> - "ä¸­é—´äºº"</h4>
<p>ä½œç”¨ï¼šè¿æ¥æ’ä»¶å’Œç½‘é¡µçš„æ¡¥æ¢</p>
<p>èƒ½åŠ›ï¼š</p>
<ul>
<li>å¯ä»¥è®¿é—® Chrome APIï¼ˆè¯»å– chrome.storageï¼‰</li>
<li>å¯ä»¥è®¿é—®ç½‘é¡µ DOM</li>
<li>ä¸èƒ½è®¿é—®ç½‘é¡µçš„ JavaScript ç¯å¢ƒï¼ˆwindow.fetchï¼‰</li>
</ul>
<p>èŒè´£ï¼š</p>
<ol>
<li>æŠŠ injected.js æ³¨å…¥åˆ°ç½‘é¡µ</li>
<li>è¯»å–ç”¨æˆ·é…ç½®çš„ Mock è§„åˆ™</li>
<li>é€šè¿‡ postMessage ä¸ injected.js é€šä¿¡</li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * åœ¨é¡µé¢ä¸­æ³¨å…¥æ‰©å±•çš„ injected.js è„šæœ¬ã€‚
 * ä½¿ç”¨ chrome.runtime.getURL è·å–æ‰©å±•å†…èµ„æºçš„ç»å¯¹ URLã€‚
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> script = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'script'</span>);
  script.<span class="hljs-property">src</span> = chrome.<span class="hljs-property">runtime</span>.<span class="hljs-title function_">getURL</span>(<span class="hljs-string">'injected.js'</span>);
  (<span class="hljs-variable language_">document</span>.<span class="hljs-property">head</span> || <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>).<span class="hljs-title function_">appendChild</span>(script);
}

<span class="hljs-title function_">init</span>();

<span class="hljs-comment">/**
 * å®‰å…¨è¯»å–æœ¬åœ°å­˜å‚¨ä¸­çš„ mock è§„åˆ™ã€‚
 * è‹¥æ‰©å±•æœªåŠ è½½æˆ– API ä¸å¯ç”¨ã€æˆ–è¯»å–å¤±è´¥ï¼Œè¿”å›ç©ºæ•°ç»„ã€‚
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Array</span>}  - mock è§„åˆ™æ•°ç»„ã€‚
 */</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getMockRulesSafely</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">if</span> (!chrome?.<span class="hljs-property">runtime</span>?.<span class="hljs-property">id</span> || !chrome?.<span class="hljs-property">storage</span>?.<span class="hljs-property">local</span>) <span class="hljs-keyword">return</span> [];
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> chrome.<span class="hljs-property">storage</span>.<span class="hljs-property">local</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'mockRules'</span>);
    <span class="hljs-keyword">if</span> (chrome.<span class="hljs-property">runtime</span>.<span class="hljs-property">lastError</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'[Mock] è¯»å–å­˜å‚¨å¤±è´¥:'</span>, chrome.<span class="hljs-property">runtime</span>.<span class="hljs-property">lastError</span>);
      <span class="hljs-keyword">return</span> [];
    }
    <span class="hljs-keyword">const</span> rules = result.<span class="hljs-property">mockRules</span> || [];
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(rules) ? rules : [];
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'[Mock] è¯»å–å­˜å‚¨å¼‚å¸¸:'</span>, err);
    <span class="hljs-keyword">return</span> [];
  }
}

<span class="hljs-comment">/**
 * æ ¹æ®åŒ¹é…æ¨¡å¼å¯¹ URL è¿›è¡ŒåŒ¹é…ã€‚
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">*</span>} <span class="hljs-variable">url</span>  - è¯·æ±‚çš„ URLã€‚
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">*</span>} <span class="hljs-variable">pattern</span>  - åŒ¹é…è§„åˆ™ã€‚
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">*</span>} <span class="hljs-variable">mode</span>  - åŒ¹é…æ¨¡å¼
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">boolean</span>}  - åŒ¹é…ç»“æœã€‚
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">matchUrl</span>(<span class="hljs-params">url, pattern, mode</span>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">switch</span> (mode) {
      <span class="hljs-keyword">case</span> <span class="hljs-string">'exact'</span>:
        <span class="hljs-keyword">return</span> url === pattern;
      <span class="hljs-keyword">case</span> <span class="hljs-string">'contains'</span>:
      <span class="hljs-attr">default</span>:
        <span class="hljs-keyword">return</span> url.<span class="hljs-title function_">includes</span>(pattern);
    }
  } <span class="hljs-keyword">catch</span> (e) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'[Mock] URL åŒ¹é…å¤±è´¥:'</span>, e);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }
}

<span class="hljs-comment">/**
 * ç›‘å¬æ¥è‡ª content-script çš„æ¶ˆæ¯ã€‚
 * è‹¥æ¶ˆæ¯ç±»å‹ä¸º MOCK_REQUESTï¼Œåˆ™æ ¹æ® URL å’Œ method åŒ¹é…è§„åˆ™ï¼Œè¿”å›å¯¹åº”çš„ mock æ•°æ®ã€‚
 */</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'message'</span>, <span class="hljs-keyword">async</span> (event) =&gt; {
  <span class="hljs-keyword">if</span> (event.<span class="hljs-property">data</span>.<span class="hljs-property">type</span> !== <span class="hljs-string">'MOCK_REQUEST'</span>) <span class="hljs-keyword">return</span>;

  <span class="hljs-keyword">const</span> { url, method, id } = event.<span class="hljs-property">data</span>;
  <span class="hljs-keyword">const</span> rules = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getMockRulesSafely</span>();

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> rule <span class="hljs-keyword">of</span> rules) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// æ·»åŠ å¯ç”¨çŠ¶æ€æ£€æŸ¥</span>
      <span class="hljs-keyword">if</span> (rule.<span class="hljs-property">enabled</span> === <span class="hljs-literal">false</span>) <span class="hljs-keyword">continue</span>;

      <span class="hljs-keyword">const</span> matchMode = rule.<span class="hljs-property">matchMode</span> || <span class="hljs-string">'contains'</span>;
      <span class="hljs-keyword">const</span> urlMatch = <span class="hljs-title function_">matchUrl</span>(url, rule.<span class="hljs-property">url</span>, matchMode);
      <span class="hljs-keyword">const</span> methodMatch = rule.<span class="hljs-property">method</span> === <span class="hljs-string">'ALL'</span> || rule.<span class="hljs-property">method</span> === method;

      <span class="hljs-keyword">if</span> (urlMatch &amp;&amp; methodMatch) {
        <span class="hljs-keyword">let</span> mockData = rule.<span class="hljs-property">data</span>;
        <span class="hljs-keyword">try</span> {
          mockData = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(rule.<span class="hljs-property">data</span>);
        } <span class="hljs-keyword">catch</span> (e) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'[Mock] JSON è§£æå¤±è´¥ï¼Œä½¿ç”¨åŸå§‹å­—ç¬¦ä¸²'</span>);
        }

        <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">postMessage</span>(
          {
            <span class="hljs-attr">type</span>: <span class="hljs-string">'MOCK_RESPONSE'</span>,
            id,
            <span class="hljs-attr">shouldMock</span>: <span class="hljs-literal">true</span>,
            mockData,
            <span class="hljs-attr">status</span>: <span class="hljs-number">200</span>,
            <span class="hljs-attr">headers</span>: { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> },
          },
          <span class="hljs-string">'*'</span>
        );
        <span class="hljs-keyword">return</span>;
      }
    } <span class="hljs-keyword">catch</span> (e) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'[Mock] è§„åˆ™å¤„ç†å¤±è´¥:'</span>, e);
      <span class="hljs-keyword">continue</span>;
    }
  }

  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">postMessage</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">'MOCK_RESPONSE'</span>, id, <span class="hljs-attr">shouldMock</span>: <span class="hljs-literal">false</span> }, <span class="hljs-string">'*'</span>);
});

</code></pre>
<h4 data-id="heading-14">5. <strong>injected.js</strong> - "åŠ«åŒª"</h4>
<p>ä½œç”¨ï¼šçœŸæ­£æ‰§è¡Œæ‹¦æˆªçš„ä»£ç </p>
<p>èƒ½åŠ›ï¼š</p>
<ul>
<li>
<p><code>å¯ä»¥</code>è®¿é—®ç½‘é¡µçš„ JavaScript ç¯å¢ƒï¼ˆwindow.fetchï¼‰</p>
</li>
<li>
<p><code>å¯ä»¥</code>é‡å†™ fetch å’Œ XMLHttpRequest</p>
</li>
<li>
<p><code>ä¸èƒ½</code>è®¿é—® Chrome APIï¼ˆchrome.storageï¼‰</p>
</li>
</ul>
<p>èŒè´£ï¼š</p>
<ol>
<li>é‡å†™ window.fetch</li>
<li>é‡å†™ XMLHttpRequest.prototype.open/send</li>
<li>æ‹¦æˆªè¯·æ±‚ï¼Œè¯¢é—® content.js æ˜¯å¦éœ€è¦ Mock</li>
<li>æ ¹æ®å›å¤å†³å®šè¿”å›å‡æ•°æ®è¿˜æ˜¯çœŸå®è¯·æ±‚</li>
</ol>
<pre><code class="hljs language-js" lang="js">(<span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-comment">//  ä¿å­˜åŸå§‹æ–¹æ³•</span>
  <span class="hljs-keyword">const</span> originalFetch = <span class="hljs-variable language_">window</span>.<span class="hljs-property">fetch</span>;
  <span class="hljs-keyword">const</span> originalXHROpen = <span class="hljs-title class_">XMLHttpRequest</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">open</span>;
  <span class="hljs-keyword">const</span> originalXHRSend = <span class="hljs-title class_">XMLHttpRequest</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">send</span>;
  <span class="hljs-keyword">const</span> pendingRequests = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(); <span class="hljs-comment">// å­˜å‚¨ç­‰å¾…å“åº”çš„è¯·æ±‚ï¼ˆkey: id, value: resolve å‡½æ•°ï¼‰</span>
  <span class="hljs-keyword">let</span> requestId = <span class="hljs-number">0</span>; <span class="hljs-comment">// æ¯ä¸ªè¯·æ±‚ID</span>

  <span class="hljs-comment">/**
   * ç›‘å¬æ¥è‡ª content-script çš„ mock å“åº”ã€‚
   * è‹¥æ¶ˆæ¯ç±»å‹ä¸º MOCK_RESPONSEï¼Œæ ¹æ®è¯·æ±‚IDåŒ¹é…å¹¶è°ƒç”¨å¯¹åº”çš„ resolve å‡½æ•°ã€‚
   */</span>
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'message'</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (event.<span class="hljs-property">data</span>.<span class="hljs-property">type</span> !== <span class="hljs-string">'MOCK_RESPONSE'</span>) <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">const</span> { id, shouldMock, mockData, status, headers } = event.<span class="hljs-property">data</span>;
    <span class="hljs-keyword">const</span> resolve = pendingRequests.<span class="hljs-title function_">get</span>(id);

    <span class="hljs-keyword">if</span> (resolve) {
      <span class="hljs-title function_">resolve</span>({ shouldMock, mockData, status, headers });
      pendingRequests.<span class="hljs-title function_">delete</span>(id);
    }
  });

  <span class="hljs-comment">/**
   * è§„èŒƒåŒ– URLã€‚
   * è‹¥è¾“å…¥ä¸ºå­—ç¬¦ä¸²ï¼Œç›´æ¥è¿”å›ï¼›
   * è‹¥è¾“å…¥ä¸ºå¯¹è±¡ä¸”åŒ…å« url å±æ€§ï¼Œè¿”å›è¯¥å±æ€§å€¼ï¼›å¦åˆ™è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">*</span>} <span class="hljs-variable">input</span>  - è¯·æ±‚çš„ URL æˆ–åŒ…å« URL çš„å¯¹è±¡ã€‚
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">string</span>}  - è§„èŒƒåŒ–åçš„ URLã€‚
   */</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">normalizeUrl</span>(<span class="hljs-params">input</span>) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> input === <span class="hljs-string">'string'</span>) <span class="hljs-keyword">return</span> input;
      <span class="hljs-keyword">if</span> (input &amp;&amp; <span class="hljs-keyword">typeof</span> input === <span class="hljs-string">'object'</span> &amp;&amp; <span class="hljs-string">'url'</span> <span class="hljs-keyword">in</span> input) {
        <span class="hljs-keyword">return</span> input.<span class="hljs-property">url</span>;
      }
    } <span class="hljs-keyword">catch</span> (_) {}
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">String</span>(input);
  }

  <span class="hljs-comment">/**
   * è·å–è¯·æ±‚æ–¹æ³•
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">*</span>} <span class="hljs-variable">url</span>  - è¯·æ±‚çš„ URL æˆ–åŒ…å« URL çš„å¯¹è±¡ã€‚
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">*</span>} <span class="hljs-variable">options</span>  - è¯·æ±‚çš„é€‰é¡¹ã€‚
   * <span class="hljs-doctag">@returns</span>
   */</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">getMethod</span>(<span class="hljs-params">url, options</span>) {
    <span class="hljs-keyword">if</span> (url &amp;&amp; <span class="hljs-keyword">typeof</span> url === <span class="hljs-string">'object'</span> &amp;&amp; <span class="hljs-string">'method'</span> <span class="hljs-keyword">in</span> url) {
      <span class="hljs-keyword">return</span> url.<span class="hljs-property">method</span>.<span class="hljs-title function_">toUpperCase</span>();
    }
    <span class="hljs-keyword">return</span> (options?.<span class="hljs-property">method</span> || <span class="hljs-string">'GET'</span>).<span class="hljs-title function_">toUpperCase</span>();
  }

  <span class="hljs-comment">/**
   *  å‘é€ Mock è¯·æ±‚åˆ° content-scriptã€‚
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">*</span>} <span class="hljs-variable">url</span> - è¯·æ±‚çš„ URL æˆ–åŒ…å« URL çš„å¯¹è±¡ã€‚
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">*</span>} <span class="hljs-variable">method</span> - è¯·æ±‚çš„æ–¹æ³•ã€‚
   * <span class="hljs-doctag">@returns</span>
   */</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">sendMockRequest</span>(<span class="hljs-params">url, method</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> id = requestId++;
      pendingRequests.<span class="hljs-title function_">set</span>(id, resolve);

      <span class="hljs-keyword">const</span> safeUrl = <span class="hljs-title function_">normalizeUrl</span>(url);

      <span class="hljs-keyword">try</span> {
        <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">postMessage</span>(
          {
            <span class="hljs-attr">type</span>: <span class="hljs-string">'MOCK_REQUEST'</span>,
            <span class="hljs-attr">url</span>: safeUrl,
            method,
            id,
          },
          <span class="hljs-string">'*'</span>
        );
      } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-keyword">if</span> (pendingRequests.<span class="hljs-title function_">has</span>(id)) {
          <span class="hljs-title function_">resolve</span>({ <span class="hljs-attr">shouldMock</span>: <span class="hljs-literal">false</span> });
          pendingRequests.<span class="hljs-title function_">delete</span>(id);
        }
        <span class="hljs-keyword">return</span>;
      }
      <span class="hljs-comment">// è¶…æ—¶ä¿æŠ¤ï¼š100ms å†…æ²¡æ”¶åˆ°å“åº”ï¼Œè‡ªåŠ¨æ”¾è¡Œï¼ˆå‘é€çœŸå®è¯·æ±‚ï¼‰</span>
      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">if</span> (pendingRequests.<span class="hljs-title function_">has</span>(id)) {
          <span class="hljs-title function_">resolve</span>({ <span class="hljs-attr">shouldMock</span>: <span class="hljs-literal">false</span> });
          pendingRequests.<span class="hljs-title function_">delete</span>(id);
        }
      }, <span class="hljs-number">100</span>);
    });
  }

  <span class="hljs-comment">// ========== Fetch æ‹¦æˆª ==========</span>
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">fetch</span> = <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">url, options = {}</span>) {
    <span class="hljs-keyword">const</span> method = <span class="hljs-title function_">getMethod</span>(url, options);
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">sendMockRequest</span>(url, method);

    <span class="hljs-keyword">if</span> (response.<span class="hljs-property">shouldMock</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(response.<span class="hljs-property">mockData</span>), {
        <span class="hljs-attr">status</span>: response.<span class="hljs-property">status</span>,
        <span class="hljs-attr">headers</span>: response.<span class="hljs-property">headers</span>,
      });
    }

    <span class="hljs-keyword">return</span> originalFetch.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-variable language_">arguments</span>);
  };

  <span class="hljs-comment">// ========== XMLHttpRequest æ‹¦æˆª ==========</span>
  <span class="hljs-title class_">XMLHttpRequest</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">open</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">method, url, ...rest</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_mockMethod</span> = method.<span class="hljs-title function_">toUpperCase</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_mockUrl</span> = url;
    <span class="hljs-keyword">return</span> originalXHROpen.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, [method, url, ...rest]);
  };

  <span class="hljs-title class_">XMLHttpRequest</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">send</span> = <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">body</span>) {
    <span class="hljs-keyword">const</span> method = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_mockMethod</span> || <span class="hljs-string">'GET'</span>;
    <span class="hljs-keyword">const</span> url = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_mockUrl</span>;

    <span class="hljs-keyword">if</span> (!url) {
      <span class="hljs-keyword">return</span> originalXHRSend.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-variable language_">arguments</span>);
    }

    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">sendMockRequest</span>(url, method);

    <span class="hljs-keyword">if</span> (response.<span class="hljs-property">shouldMock</span>) {
      <span class="hljs-comment">// æ¨¡æ‹Ÿ XHR å“åº”</span>
      <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-string">'readyState'</span>, { <span class="hljs-attr">writable</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">4</span> });
      <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-string">'status'</span>, {
        <span class="hljs-attr">writable</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">value</span>: response.<span class="hljs-property">status</span>,
      });
      <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-string">'statusText'</span>, {
        <span class="hljs-attr">writable</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">value</span>: <span class="hljs-string">'OK'</span>,
      });
      <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-string">'responseText'</span>, {
        <span class="hljs-attr">writable</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">value</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(response.<span class="hljs-property">mockData</span>),
      });
      <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-string">'response'</span>, {
        <span class="hljs-attr">writable</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">value</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(response.<span class="hljs-property">mockData</span>),
      });

      <span class="hljs-comment">// è§¦å‘äº‹ä»¶</span>
      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">onreadystatechange</span>) {
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onreadystatechange</span>();
        }
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">onload</span>) {
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onload</span>();
        }
      }, <span class="hljs-number">0</span>);

      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">return</span> originalXHRSend.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-variable language_">arguments</span>);
  };
})();
</code></pre>
<h3 data-id="heading-15">é…ç½®å±‚</h3>
<h4 data-id="heading-16">6. <strong>manifest.json</strong> - æ’ä»¶çš„"èº«ä»½è¯"</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"manifest_version"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"API Mock Tool"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"permissions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"storage"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"activeTab"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"action"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"default_popup"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"popup.html"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"content_scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"matches"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"&lt;all_urls&gt;"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"js"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"content.js"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"run_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"document_start"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"web_accessible_resources"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"resources"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"injected.js"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"matches"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"&lt;all_urls&gt;"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>

</code></pre>
<h3 data-id="heading-17">å®‰è£…æ‰©å±•</h3>
<ol>
<li>æ‰“å¼€Chromeæµè§ˆå™¨</li>
<li>åœ°å€æ è¾“å…¥ï¼š<code>chrome://extensions/</code></li>
<li>æ‰“å¼€å³ä¸Šè§’"å¼€å‘è€…æ¨¡å¼"</li>
<li>ç‚¹å‡»"åŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åº"</li>
<li>é€‰æ‹©åˆšæ‰çš„æ–‡ä»¶å¤¹</li>
<li>æå®šï¼æ‰©å±•å®‰è£…å®Œæˆï¼</li>
</ol>
<h4 data-id="heading-18">å®‰è£…æ“ä½œæ¼”ç¤ºï¼š</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b3757cfb50c944109f1055b036e06ff1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763425628&amp;x-signature=Gr0RSqoaKXZZn5aVjWGVkWYgLaQ%3D" alt="å®‰è£…mockæ’ä»¶.gif" loading="lazy"/></p>
<h2 data-id="heading-19">æ–‡ä»¶åä½œæµç¨‹ï¼ˆå®Œæ•´é“¾è·¯ï¼‰</h2>
<h3 data-id="heading-20">ç¬¬ä¸€é˜¶æ®µï¼šç”¨æˆ·é…ç½®è§„åˆ™</h3>
<pre><code class="hljs language-c" lang="c">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·æ“ä½œ    â”‚ åœ¨ popup.html è¾“å…¥ Mock è§„åˆ™
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  popup.js   â”‚ ç‚¹å‡»<span class="hljs-string">"æ·»åŠ "</span>æŒ‰é’®
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ chrome.storage.local.<span class="hljs-built_in">set</span>({ mockRules: [...] })
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Chrome Storageâ”‚ æŒä¹…åŒ–å­˜å‚¨è§„åˆ™ï¼ˆå…³é—­æµè§ˆå™¨ä¹Ÿä¸ä¸¢å¤±ï¼‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 data-id="heading-21">ç¬¬äºŒé˜¶æ®µï¼šé¡µé¢åŠ è½½æ—¶æ³¨å…¥è„šæœ¬</h3>
<pre><code class="hljs language-ini" lang="ini">ç”¨æˆ·æ‰“å¼€ç½‘é¡µï¼ˆå¦‚ https://example.comï¼‰
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚manifest.jsonâ”‚ æ£€æµ‹åˆ°åŒ¹é…çš„ URL
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ è‡ªåŠ¨æ³¨å…¥
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ content.js  â”‚ åœ¨ç½‘é¡µä¸Šä¸‹æ–‡è¿è¡Œï¼ˆä½†åœ¨éš”ç¦»æ²™ç®±ï¼‰
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ åˆ›å»º &lt;script&gt; æ ‡ç­¾
       â”‚ <span class="hljs-attr">script.src</span> = chrome.runtime.getURL(<span class="hljs-string">'injected.js'</span>)
       â”‚ document.head.appendChild(script)
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ injected.js â”‚ åœ¨ç½‘é¡µçœŸå®ç¯å¢ƒè¿è¡Œ
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ <span class="hljs-attr">window.fetch</span> = æˆ‘ä»¬çš„å‡fetch<span class="hljs-comment">;</span>
       â†“
    æ‹¦æˆªå°±ç»ªï¼
</code></pre>
<h3 data-id="heading-22">ç¬¬ä¸‰é˜¶æ®µï¼šæ‹¦æˆªè¯·æ±‚ï¼ˆå®æ—¶é€šä¿¡ï¼‰</h3>
<pre><code class="hljs language-php" lang="php">ç½‘é¡µä»£ç æ‰§è¡Œï¼š<span class="hljs-title function_ invoke__">fetch</span>(<span class="hljs-string">'/api/user'</span>)
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ injected.js         
â”‚ æˆ‘ä»¬çš„å‡ fetch è¢«è°ƒç”¨ 
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ window.<span class="hljs-title function_ invoke__">postMessage</span>({
       â”‚   <span class="hljs-attr">type</span>: <span class="hljs-string">'MOCK_REQUEST'</span>,
       â”‚   <span class="hljs-attr">url</span>: <span class="hljs-string">'/api/user'</span>,
       â”‚   <span class="hljs-attr">method</span>: <span class="hljs-string">'GET'</span>
       â”‚ })
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ content.js          â”‚ ç›‘å¬ message äº‹ä»¶
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ <span class="hljs-number">1</span>. è¯»å– chrome.storage.local
       â”‚ <span class="hljs-number">2</span>. éå†è§„åˆ™ï¼Œæ£€æŸ¥æ˜¯å¦åŒ¹é…
       â”‚ <span class="hljs-number">3</span>. æ‰¾åˆ°åŒ¹é…è§„åˆ™
       â†“
       â”‚ window.<span class="hljs-title function_ invoke__">postMessage</span>({
       â”‚   <span class="hljs-attr">type</span>: <span class="hljs-string">'MOCK_RESPONSE'</span>,
       â”‚   <span class="hljs-attr">shouldMock</span>: <span class="hljs-literal">true</span>,
       â”‚   <span class="hljs-attr">mockData</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'Mock User'</span> }
       â”‚ })
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ injected.js         â”‚ æ”¶åˆ°å›å¤
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ <span class="hljs-keyword">if</span> (shouldMock) {
       â”‚   <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(JSON.<span class="hljs-title function_ invoke__">stringify</span>(mockData));
       â”‚ } <span class="hljs-keyword">else</span> {
       â”‚   <span class="hljs-keyword">return</span> çœŸ<span class="hljs-title function_ invoke__">fetch</span>(url); <span class="hljs-comment">// è°ƒç”¨åŸå§‹æ–¹æ³•</span>
       â”‚ }
       â†“
ç½‘é¡µä»£ç æ”¶åˆ°å“åº”ï¼š{ name: <span class="hljs-string">'Mock User'</span> }
</code></pre>
<h2 data-id="heading-23">ä¸ºä»€ä¹ˆè¦åˆ† content.js å’Œ injected.jsï¼Ÿ</h2>
<h3 data-id="heading-24">åªç”¨ Content Script è¡Œä¸è¡Œï¼Ÿ</h3>
<p><strong>ä¸è¡Œï¼</strong> å› ä¸º Content Script è¿è¡Œåœ¨éš”ç¦»çš„æ²™ç®±ä¸­ï¼Œæ— æ³•è®¿é—®ç½‘é¡µçš„ <code>window.fetch</code>ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// content.js ä¸­è¿™æ ·åšæ˜¯æ— æ•ˆçš„ï¼</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-property">fetch</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) { 
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ‹¦æˆªå¤±è´¥ï¼'</span>); <span class="hljs-comment">// ç½‘é¡µçœ‹ä¸åˆ°è¿™ä¸ªä¿®æ”¹</span>
}
</code></pre>
<h3 data-id="heading-25">åªç”¨ Injected Script è¡Œä¸è¡Œï¼Ÿ</h3>
<p><strong>ä¸è¡Œï¼</strong> å› ä¸º Injected Script æ— æ³•è®¿é—® <code>chrome.storage</code> ç­‰ Chrome APIï¼Œæ— æ³•è¯»å–ç”¨æˆ·é…ç½®çš„ Mock è§„åˆ™ã€‚</p>
<pre><code class="hljs language-scss" lang="scss">### æ­£ç¡®æ–¹æ¡ˆï¼šä¸¤è€…é…åˆ

ç”¨æˆ·é…ç½® Mock è§„åˆ™
â†“
å­˜å‚¨åˆ° chrome<span class="hljs-selector-class">.storage</span> (Popup)
â†“
è¯»å–è§„åˆ™ (Content Script) â† å¯ä»¥è®¿é—® Chrome API
â†“
é€šè¿‡ postMessage é€šä¿¡
â†“
æ‹¦æˆª fetch (Injected Script) â† å¯ä»¥ä¿®æ”¹ window<span class="hljs-selector-class">.fetch</span>
</code></pre>
<h3 data-id="heading-26">é€šä¿—æ¯”å–»</h3>
<pre><code class="hljs language-markdown" lang="markdown">content.js = é“¶è¡Œé‡‘åº“ç®¡ç†å‘˜
<span class="hljs-bullet">  -</span> æœ‰é’¥åŒ™ï¼ˆChrome API æƒé™ï¼‰
<span class="hljs-bullet">  -</span> èƒ½è¯»å–ä¿é™©ç®±ï¼ˆchrome.storageï¼‰
<span class="hljs-bullet">  -</span> ä½†ä¸èƒ½ç›´æ¥æ¥è§¦å®¢æˆ·ï¼ˆç½‘é¡µ JavaScriptï¼‰

injected.js = é“¶è¡Œå¤§å ‚ç»ç†
<span class="hljs-bullet">  -</span> ç›´æ¥é¢å¯¹å®¢æˆ·ï¼ˆç½‘é¡µä»£ç ï¼‰
<span class="hljs-bullet">  -</span> èƒ½æ‹¦æˆªå®¢æˆ·è¯·æ±‚ï¼ˆé‡å†™ fetchï¼‰
<span class="hljs-bullet">  -</span> ä½†æ²¡æœ‰é‡‘åº“é’¥åŒ™ï¼ˆæ— æ³•è®¿é—® chrome.storageï¼‰

è§£å†³æ–¹æ¡ˆï¼šä¸¤äººç”¨å¯¹è®²æœºï¼ˆpostMessageï¼‰é€šä¿¡
  å®¢æˆ·å‘èµ·è¯·æ±‚ â†’ å¤§å ‚ç»ç†æ‹¦æˆª â†’ å¯¹è®²æœºé—®ç®¡ç†å‘˜"è¦ä¸è¦æ”¾è¡Œ"
  â†’ ç®¡ç†å‘˜æŸ¥ä¿é™©ç®± â†’ å›å¤"ä¸æ”¾è¡Œï¼Œç»™å‡é’" â†’ å¤§å ‚ç»ç†è¿”å›å‡é’
</code></pre>
<h2 data-id="heading-27">å…³é”®æŠ€æœ¯ç‚¹æ€»ç»“</h2>
<h3 data-id="heading-28">1. <strong>ä¸ºä»€ä¹ˆè¦ç”¨</strong> <strong><code>run_at: "document_start"</code></strong> <strong>ï¼Ÿ</strong></h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// manifest.json</span>
<span class="hljs-attr">"run_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"document_start"</span>  <span class="hljs-comment">// åœ¨ HTML è§£æå‰è¿è¡Œ</span>
</code></pre>
<p><strong>åŸå› ï¼š</strong> å¦‚æœç½‘é¡µåœ¨æ’ä»¶åŠ è½½å‰å°±æ‰§è¡Œäº† <code>fetch('/api/data')</code>ï¼Œæˆ‘ä»¬å°±æ‹¦æˆªä¸åˆ°äº†ã€‚</p>
<h3 data-id="heading-29">2. <strong>ä¸ºä»€ä¹ˆè¦ç”¨</strong> <strong><code>web_accessible_resources</code></strong> <strong>ï¼Ÿ</strong></h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// manifest.json</span>
<span class="hljs-attr">"web_accessible_resources"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"resources"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"injected.js"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"matches"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"&lt;all_urls&gt;"</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
</code></pre>
<p><strong>åŸå› ï¼š</strong> é»˜è®¤æƒ…å†µä¸‹ï¼Œç½‘é¡µæ— æ³•åŠ è½½æ’ä»¶å†…éƒ¨çš„æ–‡ä»¶ï¼ˆè·¨åŸŸé™åˆ¶ï¼‰ã€‚è¿™ä¸ªé…ç½®ç›¸å½“äºç»™ <code>injected.js</code> å¼€äº†"ç»¿è‰²é€šé“"ã€‚</p>
<h3 data-id="heading-30">3. <strong>ä¸ºä»€ä¹ˆç”¨</strong> <strong><code>postMessage</code></strong> <strong>è€Œä¸æ˜¯å…¨å±€å˜é‡ï¼Ÿ</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// âŒ é”™è¯¯åšæ³•</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-property">mockRules</span> = [...];  <span class="hljs-comment">// content.js è®¾ç½®</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">mockRules</span>);  <span class="hljs-comment">// injected.js è¯»å–ï¼ˆè¯»ä¸åˆ°ï¼ï¼‰</span>

<span class="hljs-comment">// âœ… æ­£ç¡®åšæ³•</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">postMessage</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">'MOCK_REQUEST'</span> }, <span class="hljs-string">'*'</span>);  <span class="hljs-comment">// injected.js å‘é€</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'message'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> { ... });  <span class="hljs-comment">// content.js æ¥æ”¶</span>
</code></pre>
<p><strong>åŸå› ï¼š</strong> content.js å’Œ injected.js è™½ç„¶åœ¨åŒä¸€ä¸ªç½‘é¡µï¼Œä½† JavaScript ç¯å¢ƒæ˜¯éš”ç¦»çš„ï¼Œå°±åƒä¸¤ä¸ªå¹³è¡Œä¸–ç•Œï¼Œåªèƒ½é€šè¿‡ <code>postMessage</code> è¿™ä¸ª"ä¼ é€é—¨"é€šä¿¡ã€‚</p>
<h3 data-id="heading-31">4. <strong>ä¸ºä»€ä¹ˆè¦ä¿å­˜åŸå§‹ fetchã€xhrï¼Ÿ</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> originalFetch = <span class="hljs-variable language_">window</span>.<span class="hljs-property">fetch</span>;  <span class="hljs-comment">//  å¿…é¡»å…ˆä¿å­˜</span>

<span class="hljs-variable language_">window</span>.<span class="hljs-property">fetch</span> = <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">url</span>) {
  <span class="hljs-keyword">if</span> (needMock) {
    <span class="hljs-keyword">return</span> mockResponse;
  }
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">originalFetch</span>(url);  <span class="hljs-comment">//  ä¸ Mock æ—¶è°ƒç”¨åŸå§‹æ–¹æ³•</span>
};
</code></pre>
<p><strong>åŸå› ï¼š</strong> å¦‚æœä¸ä¿å­˜ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½ä¼šè¢«æ‹¦æˆªï¼Œæ— æ³•å‘é€çœŸå®è¯·æ±‚ã€‚</p>
<h2 data-id="heading-32">æ€»ç»“</h2>
<h3 data-id="heading-33">æ ¸å¿ƒè¦ç‚¹</h3>
<ol>
<li><strong>æ ¹æœ¬åŸç†</strong>ï¼šé‡å†™ <code>window.fetch</code> å’Œ <code>XMLHttpRequest</code>ï¼Œåœ¨ç½‘é¡µä»£ç æ‰§è¡Œå‰åŠ«æŒè¯·æ±‚</li>
<li><strong>ä¸ºä»€ä¹ˆåˆ†ä¸¤ä¸ªè„šæœ¬</strong>ï¼šcontent.js èƒ½è¯»æ’ä»¶é…ç½®ï¼Œinjected.js èƒ½æ‹¦æˆªè¯·æ±‚</li>
<li><strong>æ€ä¹ˆé€šä¿¡</strong>ï¼š<code>postMessage</code>ï¼ˆå”¯ä¸€æ–¹å¼ï¼‰</li>
<li><strong>ä»€ä¹ˆæ—¶å€™æ³¨å…¥</strong>ï¼š<code>document_start</code>ï¼ˆè¶Šæ—©è¶Šå¥½ï¼‰</li>
<li><strong>ä¸ºä»€ä¹ˆèƒ½æ‹¦æˆª</strong>ï¼šåœ¨ç½‘é¡µä»£ç æ‰§è¡Œå‰å°±æ›¿æ¢äº†åŸç”Ÿæ–¹æ³•</li>
</ol>
<h3 data-id="heading-34">é€‚ç”¨åœºæ™¯</h3>
<ul>
<li>å‰ç«¯å¼€å‘æ—¶ï¼Œåç«¯æ¥å£è¿˜æ²¡å¥½</li>
<li>è°ƒè¯•çº¿ä¸Š Bugï¼Œæƒ³ä¸´æ—¶æ”¹è¿”å›æ•°æ®</li>
<li>æ¼”ç¤º Demoï¼Œä¸æƒ³ä¾èµ–çœŸå®æœåŠ¡å™¨</li>
<li>è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œéœ€è¦ç¨³å®šçš„ Mock æ•°æ®</li>
<li>æ¥å£æ–‡æ¡£ä¸å®Œå–„ï¼Œæƒ³è‡ªå·±é€ æ•°æ®æµ‹è¯•</li>
</ul>
<h3 data-id="heading-35">æœ€å</h3>
<p>å¦‚æœè¿™ä¸ªæ’ä»¶å¸®åˆ°äº†ä½ ï¼Œæ¬¢è¿ï¼š</p>
<ul>
<li>å¦‚æœè§‰å¾—å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ç‚¹èµ ğŸ‘ æ”¶è— â­ å…³æ³¨ ğŸ”” æ”¯æŒä¸€ä¸‹ï¼</li>
<li>â­ <strong>GitHub Star æ”¯æŒ</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTeernage%2Fquick-mock" target="_blank" title="https://github.com/Teernage/quick-mock" ref="nofollow noopener noreferrer">github.com/Teernage/quâ€¦</a></li>
<li>ğŸ’¬ <strong>è¯„è®ºåŒºèŠèŠä½ çš„ä½¿ç”¨åœºæ™¯</strong></li>
</ul>
<p>è¿™ä¸ªæ’ä»¶ä¼šæŒç»­ä¼˜åŒ–ï¼Œæ”¯æŒæ›´ä¸°å¯Œçš„é…ç½®é¡¹ã€æ›´å¥½çš„äº¤äº’ç­‰</p>
<p><strong>å¦‚æœä½ æœ‰å¥½çš„æƒ³æ³•ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºæˆ– GitHub Issue æå‡ºï¼</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript æ€§èƒ½ä¼˜åŒ–å®æˆ˜ï¼šæˆ‘é€šè¿‡è¿™7ä¸ªæŠ€å·§å°†é¡µé¢åŠ è½½é€Ÿåº¦æå‡äº†65%]]></title>    <link>https://juejin.cn/post/7570984341414313999</link>    <guid>https://juejin.cn/post/7570984341414313999</guid>    <pubDate>2025-11-11T00:16:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570984341414313999" data-draft-id="7570940025581518888" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript æ€§èƒ½ä¼˜åŒ–å®æˆ˜ï¼šæˆ‘é€šè¿‡è¿™7ä¸ªæŠ€å·§å°†é¡µé¢åŠ è½½é€Ÿåº¦æå‡äº†65%"/> <meta itemprop="keywords" content="åç«¯,å‰ç«¯,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-11-11T00:16:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IT_é™ˆå¯’"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript æ€§èƒ½ä¼˜åŒ–å®æˆ˜ï¼šæˆ‘é€šè¿‡è¿™7ä¸ªæŠ€å·§å°†é¡µé¢åŠ è½½é€Ÿåº¦æå‡äº†65%
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IT_é™ˆå¯’
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T00:16:38.000Z" title="Tue Nov 11 2025 00:16:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>JavaScript æ€§èƒ½ä¼˜åŒ–å®æˆ˜ï¼šæˆ‘é€šè¿‡è¿™7ä¸ªæŠ€å·§å°†é¡µé¢åŠ è½½é€Ÿåº¦æå‡äº†65%</strong></h2>
<h3 data-id="heading-1">å¼•è¨€</h3>
<p>åœ¨ç°ä»£Webå¼€å‘ä¸­ï¼Œæ€§èƒ½ä¼˜åŒ–æ˜¯ä¸€ä¸ªæ°¸æ’çš„è¯é¢˜ã€‚éšç€ç”¨æˆ·å¯¹é¡µé¢åŠ è½½é€Ÿåº¦çš„è¦æ±‚è¶Šæ¥è¶Šé«˜ï¼ŒJavaScriptçš„æ€§èƒ½ä¼˜åŒ–æ˜¾å¾—å°¤ä¸ºé‡è¦ã€‚æœ€è¿‘ï¼Œæˆ‘åœ¨ä¸€ä¸ªå¤§å‹ç”µå•†é¡¹ç›®ä¸­é€šè¿‡å®æ–½7ä¸ªå…³é”®çš„JavaScriptä¼˜åŒ–æŠ€å·§ï¼ŒæˆåŠŸå°†é¡µé¢åŠ è½½é€Ÿåº¦æå‡äº†65%ã€‚æœ¬æ–‡å°†è¯¦ç»†åˆ†äº«è¿™äº›å®æˆ˜ç»éªŒï¼Œå¸Œæœ›èƒ½ä¸ºå¼€å‘è€…æä¾›æœ‰ä»·å€¼çš„å‚è€ƒã€‚</p>
<h3 data-id="heading-2">ä¸ºä»€ä¹ˆJavaScriptæ€§èƒ½ä¼˜åŒ–å¦‚æ­¤é‡è¦ï¼Ÿ</h3>
<p>JavaScriptæ˜¯ç°ä»£Webåº”ç”¨çš„æ ¸å¿ƒæŠ€æœ¯ä¹‹ä¸€ï¼Œä½†å…¶æ‰§è¡Œæ•ˆç‡ç›´æ¥å½±å“é¡µé¢çš„å“åº”é€Ÿåº¦å’Œç”¨æˆ·ä½“éªŒã€‚æ ¹æ®Googleçš„ç ”ç©¶ï¼Œé¡µé¢åŠ è½½æ—¶é—´æ¯å¢åŠ 1ç§’ï¼Œè·³å‡ºç‡å°±ä¼šå¢åŠ 32%ã€‚æ­¤å¤–ï¼Œç§»åŠ¨è®¾å¤‡ä¸Šçš„æ€§èƒ½é—®é¢˜æ›´åŠ çªå‡ºï¼Œå› ä¸ºå®ƒä»¬çš„å¤„ç†èƒ½åŠ›å’Œç½‘ç»œæ¡ä»¶å¾€å¾€ä¸å¦‚æ¡Œé¢è®¾å¤‡ã€‚</p>
<h3 data-id="heading-3">ä¸»ä½“ï¼š7ä¸ªå…³é”®çš„æ€§èƒ½ä¼˜åŒ–æŠ€å·§</h3>
<h4 data-id="heading-4">1. <strong>ä»£ç åˆ†å‰²ï¼ˆCode Splittingï¼‰</strong></h4>
<p><strong>é—®é¢˜ï¼š</strong><br/>
ä¼ ç»Ÿçš„æ‰“åŒ…æ–¹å¼ï¼ˆå¦‚Webpackçš„é»˜è®¤é…ç½®ï¼‰ä¼šå°†æ‰€æœ‰JavaScriptä»£ç æ‰“åŒ…æˆä¸€ä¸ªå·¨å¤§çš„bundleæ–‡ä»¶ã€‚è¿™ä¼šæ˜¾è‘—å¢åŠ é¦–å±åŠ è½½æ—¶é—´ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong><br/>
ä½¿ç”¨åŠ¨æ€å¯¼å…¥ï¼ˆDynamic Importsï¼‰å’Œè·¯ç”±çº§ä»£ç åˆ†å‰²ï¼ˆRoute-based Code Splittingï¼‰ï¼Œå°†ä»£ç æ‹†åˆ†ä¸ºå¤šä¸ªå°å—ï¼ŒæŒ‰éœ€åŠ è½½ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åŠ¨æ€å¯¼å…¥ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable language_">module</span> = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./module.js'</span>);
</code></pre>
<p><strong>æ•ˆæœï¼š</strong><br/>
é¦–å±åŠ è½½æ—¶é—´å‡å°‘äº†30%ï¼Œå› ä¸ºæµè§ˆå™¨åªéœ€è¦ä¸‹è½½å’Œæ‰§è¡Œå½“å‰é¡µé¢æ‰€éœ€çš„ä»£ç ã€‚</p>
<h4 data-id="heading-5">2. <strong>Tree Shaking</strong></h4>
<p><strong>é—®é¢˜ï¼š</strong><br/>
é¡¹ç›®ä¸­å¼•å…¥äº†è®¸å¤šæœªä½¿ç”¨çš„åº“æˆ–æ¨¡å—ä»£ç ï¼Œå¯¼è‡´æ‰“åŒ…ä½“ç§¯è†¨èƒ€ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong><br/>
ä½¿ç”¨ES6æ¨¡å—è¯­æ³•ï¼ˆ<code>import/export</code>ï¼‰å¹¶é…ç½®æ„å»ºå·¥å…·ï¼ˆå¦‚Webpackã€Rollupï¼‰å¯ç”¨Tree ShakingåŠŸèƒ½ã€‚ç¡®ä¿ç¬¬ä¸‰æ–¹åº“ä¹Ÿæ”¯æŒES6æ¨¡å—ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Webpacké…ç½®ç¤ºä¾‹</span>
<span class="hljs-attr">optimization</span>: {
  <span class="hljs-attr">usedExports</span>: <span class="hljs-literal">true</span>,
}
</code></pre>
<p><strong>æ•ˆæœï¼š</strong><br/>
æ‰“åŒ…ä½“ç§¯å‡å°‘äº†çº¦25%ï¼Œæ˜¾è‘—é™ä½äº†ä¼ è¾“å’Œè§£ææ—¶é—´ã€‚</p>
<h4 data-id="heading-6">3. <strong>æ‡’åŠ è½½éå…³é”®èµ„æº</strong></h4>
<p><strong>é—®é¢˜ï¼š</strong><br/>
éå…³é”®çš„JavaScriptèµ„æºï¼ˆå¦‚åˆ†æè„šæœ¬ã€å¹¿å‘Šè„šæœ¬ï¼‰é˜»å¡äº†ä¸»çº¿ç¨‹çš„æ¸²æŸ“ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong><br/>
ä½¿ç”¨<code>defer</code>æˆ–<code>async</code>å±æ€§åŠ è½½éå…³é”®è„šæœ¬ï¼Œæˆ–å°†å®ƒä»¬å»¶è¿Ÿåˆ°é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œã€‚</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">defer</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"analytics.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">async</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"ads.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><strong>æ•ˆæœï¼š</strong><br/>
ä¸»çº¿ç¨‹çš„é˜»å¡æ—¶é—´å‡å°‘äº†40%ï¼Œç”¨æˆ·æ„ŸçŸ¥çš„åŠ è½½é€Ÿåº¦å¤§å¹…æå‡ã€‚</p>
<h4 data-id="heading-7">4. <strong>å‡å°‘DOMæ“ä½œ</strong></h4>
<p><strong>é—®é¢˜ï¼š</strong><br/>
é¢‘ç¹çš„DOMæ“ä½œä¼šå¯¼è‡´å›æµï¼ˆReflowï¼‰å’Œé‡ç»˜ï¼ˆRepaintï¼‰ï¼Œä¸¥é‡æ‹–æ…¢é¡µé¢æ€§èƒ½ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<ul>
<li>ä½¿ç”¨æ–‡æ¡£ç‰‡æ®µï¼ˆ<code>DocumentFragment</code>ï¼‰æ‰¹é‡æ“ä½œDOMã€‚</li>
<li>é¿å…åœ¨å¾ªç¯ä¸­ç›´æ¥æ“ä½œDOMã€‚</li>
<li>ä½¿ç”¨è™šæ‹ŸDOMåº“ï¼ˆå¦‚Reactã€Vueï¼‰ã€‚</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// DocumentFragmentç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> fragment = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createDocumentFragment</span>();
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
  <span class="hljs-keyword">const</span> div = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
  fragment.<span class="hljs-title function_">appendChild</span>(div);
}
<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(fragment);
</code></pre>
<p><strong>æ•ˆæœï¼š</strong>
äº¤äº’æ€§èƒ½æå‡äº†35%ï¼Œå°¤å…¶æ˜¯åœ¨ä½ç«¯è®¾å¤‡ä¸Šè¡¨ç°æ›´æ˜æ˜¾ã€‚</p>
<h4 data-id="heading-8">5. <strong>åˆ©ç”¨Web Workerså¤„ç†å¯†é›†å‹ä»»åŠ¡</strong></h4>
<p><strong>é—®é¢˜ï¼š</strong>
å¤æ‚çš„è®¡ç®—ä»»åŠ¡ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œå¯¼è‡´é¡µé¢å¡é¡¿æˆ–æ— å“åº”ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong>
å°†CPUå¯†é›†å‹ä»»åŠ¡ï¼ˆå¦‚æ•°æ®å¤„ç†ã€å›¾åƒå¤„ç†ï¼‰äº¤ç»™Web Workersæ‰§è¡Œã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Web Workerç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> worker = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Worker</span>(<span class="hljs-string">'task.js'</span>);
worker.<span class="hljs-title function_">postMessage</span>(data);
worker.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e.<span class="hljs-property">data</span>);
};
</code></pre>
<p>æ•ˆæœï¼š
ä¸»çº¿ç¨‹çš„è´Ÿè½½é™ä½äº†50%ï¼Œç”¨æˆ·äº¤äº’æ›´åŠ æµç•…ã€‚</p>
<h4 data-id="heading-9">6. <strong>ç¼“å­˜ä¸è®°å¿†åŒ–</strong></h4>
<p>é—®é¢˜ï¼š
é‡å¤è®¡ç®—ç›¸åŒçš„æ•°æ®æˆ–é¢‘ç¹å‘èµ·ç›¸åŒçš„APIè¯·æ±‚ä¼šæµªè´¹èµ„æºã€‚
è§£å†³æ–¹æ¡ˆï¼š</p>
<ul>
<li>APIè¯·æ±‚ç»“æœç¼“å­˜åˆ°å†…å­˜æˆ–IndexedDBä¸­ã€‚</li>
<li>JavaScriptå‡½æ•°ä½¿ç”¨è®°å¿†åŒ–æŠ€æœ¯ç¼“å­˜è®¡ç®—ç»“æœã€‚</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// APIç¼“å­˜ç¤ºä¾‹</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchData</span>(<span class="hljs-params">key</span>) {
 <span class="hljs-keyword">if</span> (!cache[key]) {
   cache[key] = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/<span class="hljs-subst">${key}</span>`</span>);
 }
 <span class="hljs-keyword">return</span> cache[key];
}

<span class="hljs-comment">// Memoizationç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">memoize</span> = (<span class="hljs-params">fn</span>) =&gt; {
 <span class="hljs-keyword">const</span> cache = {};
 <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">...args</span>) =&gt;</span> {
   <span class="hljs-keyword">const</span> key = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(args);
   <span class="hljs-keyword">if</span> (!cache[key]) cache[key] = <span class="hljs-title function_">fn</span>(...args);
   <span class="hljs-keyword">return</span> cache[key];
 };
};
</code></pre>
<p>æ•ˆæœï¼š
APIå“åº”æ—¶é—´å¹³å‡ç¼©çŸ­äº†60%ï¼Œå¤æ‚è®¡ç®—çš„é‡å¤æ‰§è¡Œæ—¶é—´å‡å°‘äº†70%ã€‚</p>
<p>####7.<strong>ä¼˜åŒ–äº‹ä»¶å¤„ç†</strong>
é—®é¢˜ï¼š
é«˜é¢‘è§¦å‘çš„äº‹ä»¶ç›‘å¬å™¨ä¼šå¼•èµ·å¤§é‡ä¸å¿…è¦çš„å‡½æ•°è°ƒç”¨å½±å“æ€§èƒ½ã€‚
è§£å†³æ–¹æ¡ˆï¼š
-èŠ‚æµ(throttling)
é˜²æŠ–(debouncing)
è¢«åŠ¨äº‹ä»¶ç›‘å¬å™¨(passiveeventlisteners)</p>
<pre><code class="hljs language-javascript//" lang="javascript//">èŠ‚æµç¤ºä¾‹functionthrottle(func,limit){
 letlastRan;
returnfunction(){
if(!lastRan||Date.now()-lastRan&gt;=limit){
func.apply(this,arguments);lastRan=Date.now();}};}
//
é˜²æŠ–ç¤ºä¾‹functiondebounce(func,delay){lettimeoutId;
returnfunction(){clearTimeout(timeoutId);timeoutId=setTimeout(()=&gt;func.apply(this,arguments),delay);};}
</code></pre>
<p>æ•ˆæœ:
æ»šåŠ¨äº‹ä»¶çš„CPUå ç”¨ç‡ä¸‹é™äº†80%,è§¦æ‘¸äº‹ä»¶çš„å¤„ç†å»¶è¿Ÿæ˜¾è‘—é™ä½.</p>
<p>###æ€»ç»“</p>
<p>é€šè¿‡å®æ–½ä»¥ä¸Š7ä¸ªJavaScriptæ€§èƒ½ä¼˜åŒ–æŠ€å·§,æˆ‘ä»¬æˆåŠŸåœ°å°†é¡¹ç›®çš„é¡µé¢åŠ è½½é€Ÿåº¦æå‡äº†65%,åŒæ—¶è¿˜æ”¹å–„äº†äº¤äº’æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒ.è¿™äº›æ–¹æ³•æ¶µç›–äº†ä»ä»£ç ç»“æ„åˆ°è¿è¡Œæ—¶ä¼˜åŒ–çš„å„ä¸ªæ–¹é¢,å…·æœ‰å¹¿æ³›çš„é€‚ç”¨æ€§.</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯,æ€§èƒ½ä¼˜åŒ–æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹è€Œéä¸€æ¬¡æ€§å·¥ä½œ.Webç”Ÿæ€åœ¨ä¸æ–­å˜åŒ–,æ–°çš„æŠ€æœ¯å’Œå·¥å…·ä¹Ÿä¼šä¸æ–­æ¶Œç°.å› æ­¤å»ºè®®å®šæœŸè¿›è¡Œæ€§èƒ½å®¡è®¡(Puppeteer,Lighthouseç­‰å·¥å…·),å¹¶æ ¹æ®é¡¹ç›®ç‰¹ç‚¹é€‰æ‹©æœ€é€‚åˆçš„ä¼˜åŒ–ç­–ç•¥.</p>
<p>æœ€åè¦å¼ºè°ƒçš„æ˜¯:ä»»ä½•ä¼˜åŒ–éƒ½åº”è¯¥å»ºç«‹åœ¨æ­£ç¡®æµ‹é‡æ•°æ®çš„åŸºç¡€ä¸Š."è¿‡æ—©ä¼˜åŒ–æ˜¯ä¸‡æ¶ä¹‹æº",æˆ‘ä»¬åº”è¯¥ä¼˜å…ˆè§£å†³çœŸæ­£å½±å“ç”¨æˆ·ä½“éªŒçš„æ€§èƒ½ç“¶é¢ˆ</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Swift å¹¶å‘ï¼šæˆ‘åˆ°åº•è¯¥ä¸è¯¥ç”¨ Actorï¼Ÿâ€”â€”ä¸€å¼ å†³ç­–å›¾å¸®ä½ æ‹æ¿]]></title>    <link>https://juejin.cn/post/7570932873131999259</link>    <guid>https://juejin.cn/post/7570932873131999259</guid>    <pubDate>2025-11-11T00:20:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570932873131999259" data-draft-id="7547552301117390902" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Swift å¹¶å‘ï¼šæˆ‘åˆ°åº•è¯¥ä¸è¯¥ç”¨ Actorï¼Ÿâ€”â€”ä¸€å¼ å†³ç­–å›¾å¸®ä½ æ‹æ¿"/> <meta itemprop="keywords" content="Swift"/> <meta itemprop="datePublished" content="2025-11-11T00:20:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="unravel2025"/> <meta itemprop="url" content="https://juejin.cn/user/1116759541421880"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Swift å¹¶å‘ï¼šæˆ‘åˆ°åº•è¯¥ä¸è¯¥ç”¨ Actorï¼Ÿâ€”â€”ä¸€å¼ å†³ç­–å›¾å¸®ä½ æ‹æ¿
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759541421880/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    unravel2025
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T00:20:01.000Z" title="Tue Nov 11 2025 00:20:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Actor æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆä¸€å¥è¯ç‰ˆï¼‰</h2>
<p>Actor = è‡ªå¸¦å¤§é—¨çš„æˆ¿é—´ï¼šä¸€æ¬¡åªèƒ½è¿›ä¸€ä¸ªäººï¼Œè¿›é—¨è¦â€œç­‰é’¥åŒ™â€ï¼ˆ<code>await</code>ï¼‰ã€‚</p>
<p>å®ƒå­˜åœ¨çš„å”¯ä¸€ç†ç”±ï¼šä¿æŠ¤é Sendable çš„å¯å˜çŠ¶æ€ã€‚</p>
<h2 data-id="heading-1">Actor vs Classï¼šåªå·®ä¸€ä¸ªéš”ç¦»åŸŸ</h2>



































<table><thead><tr><th>ç»´åº¦</th><th>Class</th><th>Actor</th></tr></thead><tbody><tr><td>å¼•ç”¨è¯­ä¹‰</td><td>âœ…</td><td>âœ…</td></tr><tr><td>ç»§æ‰¿</td><td>âœ…</td><td>âŒ</td></tr><tr><td>éš”ç¦»åŸŸ</td><td>âŒï¼ˆè°éƒ½èƒ½åŒæ­¥è®¿é—®ï¼‰</td><td>âœ…ï¼ˆå¿…é¡»Â <code>await</code>è¿›é—¨ï¼‰</td></tr><tr><td>çº¿ç¨‹å®‰å…¨</td><td>æ‰‹åŠ¨é”/é˜Ÿåˆ—</td><td>ç¼–è¯‘å™¨ä¿è¯</td></tr><tr><td>åŒæ­¥è°ƒç”¨</td><td>ä»»æ„</td><td>å¤–éƒ¨ç¦æ­¢</td></tr></tbody></table>
<p>æŠŠ Actor æƒ³æˆâ€œè¿œç¨‹æœåŠ¡â€ï¼š æ•°æ®åœ¨â€œæœåŠ¡å™¨â€é‡Œï¼Œä½ è¦å‘è¯·æ±‚ï¼ˆ<code>await</code>ï¼‰æ‰èƒ½è¯»å†™ã€‚</p>
<h2 data-id="heading-2">å†³ç­–ä¸‰è¦ç´ ï¼šç¼ºä¸€ä¸å¯ï¼</h2>
<p>åªæœ‰åŒæ—¶æ»¡è¶³ä¸‹é¢ 3 æ¡ï¼Œæ‰å€¼å¾—ä¸Š Actorï¼š</p>
<ol>
<li>
<p>æœ‰é Sendable çŠ¶æ€</p>
<p>ï¼ˆçº¯ Sendable ç»“æ„ä½“/ç±» â†’ æ— éœ€ä¿æŠ¤ï¼‰</p>
</li>
<li>
<p>æ“ä½œå¿…é¡»åŸå­æ€§</p>
<p>ï¼ˆè¯»-æ”¹-å†™å¿…é¡»æ‰“åŒ…ï¼Œä¸èƒ½ä¸­é€”è¢«æ’ï¼‰</p>
</li>
<li>
<p>è¿™äº›åŸå­æ“ä½œ</p>
<p>ä¸èƒ½åœ¨ç°æœ‰ Actor ä¸Šå®Œæˆï¼ˆå¦‚ MainActorï¼‰</p>
</li>
</ol>





















<table><thead><tr><th>ç¼ºä¸€æ¡ â†’ ç”¨åˆ«çš„æ–¹å¼</th><th>åŸå› </th></tr></thead><tbody><tr><td>åªæœ‰ â‘  ç¼º â‘¡</td><td>ç”¨Â <code>Sendable</code>+ å€¼ç±»å‹å³å¯</td></tr><tr><td>æœ‰ â‘ â‘¡ ä½†èƒ½åœ¨ MainActor åš</td><td>ç›´æ¥æ ‡Â <code>@MainActor</code>ï¼Œè¿˜èƒ½åŒæ­¥è®¿é—® UI</td></tr><tr><td>ä¸ºäº†â€œé¿å¼€ä¸»çº¿ç¨‹â€è€Œé€  Actor</td><td>åæ¨¡å¼ï¼ç”¨Â <code>@concurrent</code>/Â <code>Task.detached</code>å³å¯</td></tr></tbody></table>
<h2 data-id="heading-3">åä¾‹é›†åˆï¼šè¿™äº› Actor éƒ½â€œå¸ˆå‡ºæ— åâ€</h2>
<p>âŒ ç½‘ç»œå®¢æˆ·ç«¯ Actor</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">actor</span> <span class="hljs-title class_">APIClient</span> {
    <span class="hljs-comment">// å…¨æ˜¯ Sendableï¼šURLSessionã€tokenString</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">request</span>() <span class="hljs-keyword">async</span> -&gt; <span class="hljs-type">Data</span> { <span class="hljs-operator">...</span> }
}
</code></pre>
<ul>
<li>çŠ¶æ€å·² Sendable â†’ æ— éœ€ä¿æŠ¤</li>
<li>å‰¯ä½œç”¨åªæ˜¯â€œä¸æƒ³è·‘ä¸»çº¿ç¨‹â€â†’ ç”¨ <code>@concurrent</code> å‡½æ•°å³å¯</li>
<li>ç»“æœï¼šäººä¸ºåŠ é”ï¼Œè§£ç éƒ½æ— æ³•å¹¶å‘</li>
</ul>
<p>âŒ â€œçœ‹ä¸æ‡‚å¹¶å‘æŠ¥é”™â€å°±å¥— Actor</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-meta">@globalActor</span> <span class="hljs-keyword">actor</span> <span class="hljs-title class_">MyRandomActor</span> {
    <span class="hljs-comment">// ç©ºçŠ¶æ€ï¼Œåªä¸ºæ¶ˆ Sendable è­¦å‘Š</span>
}
</code></pre>
<p>â†’ æ°¸è¿œåˆ«ç”¨ Actor å½“åˆ›å¯è´´ï¼</p>
<p>å…ˆç†è§£è­¦å‘Šï¼Œå†é€‰å·¥å…·ï¼ˆ<code>Sendable</code>ã€<code>@MainActor</code>ã€<code>@concurrent</code>ï¼‰ã€‚</p>
<h2 data-id="heading-4">æ­£ä¾‹ï¼šçœŸæ­£éœ€è¦ Actor çš„åœºæ™¯</h2>
<p>âœ… æœ¬åœ°é Sendable ç¼“å­˜</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">actor</span> <span class="hljs-title class_">ImageCache</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> store: [<span class="hljs-type">URL</span>: <span class="hljs-type">UIImage</span>] <span class="hljs-operator">=</span> [:]   <span class="hljs-comment">// UIImage é Sendable</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">image</span>(<span class="hljs-params">for</span> <span class="hljs-params">url</span>: <span class="hljs-type">URL</span>) <span class="hljs-keyword">async</span> -&gt; <span class="hljs-type">UIImage</span>? {
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> img <span class="hljs-operator">=</span> store[url] { <span class="hljs-keyword">return</span> img }
        <span class="hljs-keyword">let</span> data <span class="hljs-operator">=</span> <span class="hljs-keyword">try</span> <span class="hljs-keyword">await</span> <span class="hljs-type">URLSession</span>.shared.data(from: url).<span class="hljs-number">0</span>
        <span class="hljs-keyword">let</span> img <span class="hljs-operator">=</span> <span class="hljs-type">UIImage</span>(data: data)<span class="hljs-operator">!</span>
        store[url] <span class="hljs-operator">=</span> img
        <span class="hljs-keyword">return</span> img
    }
}
</code></pre>
<ul>
<li>çŠ¶æ€é Sendable</li>
<li>è¯»-å†™-ç¼“å­˜å¿…é¡»åŸå­</li>
<li>MainActor ä¸é€‚åˆï¼ˆç½‘ç»œ+è§£ç è€—æ—¶ï¼‰</li>
</ul>
<p>âœ… åè®®å¼ºåˆ¶ Sendable</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">DataSource</span>: <span class="hljs-title class_">Sendable</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">fetch</span>() <span class="hljs-keyword">async</span> -&gt; [<span class="hljs-type">Item</span>]
}
</code></pre>
<ul>
<li>å®ç°å±‚å«é Sendable çŠ¶æ€ â†’ åªèƒ½ç”¨ Actor æ»¡è¶³ Sendable</li>
</ul>
<h2 data-id="heading-5">å†³ç­–æµç¨‹å›¾</h2>
<pre><code class="hljs language-arduino" lang="arduino">éœ€è¦å…±äº«å¯å˜çŠ¶æ€ï¼Ÿ
â”œâ”€ å¦ â†’ ç”¨ <span class="hljs-keyword">struct</span> / <span class="hljs-keyword">class</span>ï¼ˆSendableï¼‰
â”œâ”€ æ˜¯ â†’ çŠ¶æ€ Sendableï¼Ÿ
â”‚   â”œâ”€ æ˜¯ â†’ ç”¨ Sendable å€¼ç±»å‹æˆ–é”è‡ªç”±ç±»
â”‚   â””â”€ å¦ â†’ æ“ä½œå¿…é¡»åŸå­ï¼Ÿ
â”‚       â”œâ”€ å¦ â†’ æ‹†æˆ Sendable ç‰‡æ®µ
â”‚       â””â”€ æ˜¯ â†’ èƒ½åœ¨ MainActor å®Œæˆï¼Ÿ
â”‚           â”œâ”€ æ˜¯ â†’ @MainActor
â”‚           â””â”€ å¦ â†’ **ä¸Š Actor** âœ…
</code></pre>
<p>å£è¯€ï¼š</p>
<p>â€œSendable å…ˆï¼ŒMainActor å…¶æ¬¡ï¼Œæ–° Actor æœ€åã€‚â€</p>
<h2 data-id="heading-6">åŒæ­¥è®¿é—®çº¢çº¿ï¼šActor = â€œè¿œç¨‹æœåŠ¡â€</h2>
<p>å¤–éƒ¨è°ƒç”¨å¿…é¡»å¼‚æ­¥ï¼š</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">actor</span> <span class="hljs-title class_">Counter</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">increment</span>() { value <span class="hljs-operator">+=</span> <span class="hljs-number">1</span> }
}

<span class="hljs-comment">// å¤–éƒ¨</span>
<span class="hljs-keyword">await</span> counter.increment()   <span class="hljs-comment">// âœ…</span>
counter.increment()         <span class="hljs-comment">// âŒ ç¼–è¯‘å¤±è´¥</span>
</code></pre>
<p>â†’ å¦‚æœä½ æ— æ³•å®¹å¿è¿™ç§å¼‚æ­¥æ¥å£ï¼ˆä¾‹å¦‚å®æ—¶éŸ³é¢‘å›è°ƒï¼‰ï¼Œ</p>
<p>æ ¹æœ¬ä¸è¯¥ç”¨ Actor â€”â€” è€ƒè™‘é”ã€åŸå­ç±»æˆ– <code>@concurrent</code> å‡½æ•°ã€‚</p>
<h2 data-id="heading-7">å¸¸è§è¯¯è§£é€Ÿç­”</h2>

























<table><thead><tr><th>è¯¯è§£</th><th>çœŸç›¸</th></tr></thead><tbody><tr><td>â€œActor è®©å¹¶å‘æ›´å¿«â€</td><td>å®ƒæ›´å®‰å…¨è€Œéæ›´å¿«ï¼›å¼‚æ­¥æ’é˜Ÿå¯èƒ½æ›´æ…¢</td></tr><tr><td>â€œæŠŠç±»æ”¹æˆ actor å°±èƒ½æ¶ˆå¹¶å‘è­¦å‘Šâ€</td><td>æ²»æ ‡ä¸æ²»æœ¬ï¼›å…ˆç†è§£ Sendable è¦æ±‚</td></tr><tr><td>â€œç½‘ç»œå±‚å¿…é¡» actorâ€</td><td>è‹¥çŠ¶æ€ Sendableï¼Œç”¨Â <code>@concurrent</code>å‡½æ•°/ä»»åŠ¡å³å¯</td></tr><tr><td>â€œactor é‡Œæ‰€æœ‰ä»£ç éƒ½å¼‚æ­¥â€</td><td>å†…éƒ¨å¯å®Œå…¨åŒæ­¥ï¼›åªæœ‰å¤–éƒ¨è°ƒç”¨éœ€ await</td></tr></tbody></table>
<h2 data-id="heading-8">ä¸€å¥è¯æ€»ç»“</h2>
<p>â€œActor æ˜¯ä¿æŠ¤â€˜é Sendable å¯å˜çŠ¶æ€â€™çš„æ˜‚è´µä¿é™©ç®±â€”â€” ç¡®è®¤ä½ çœŸçš„æœ‰å®è´ï¼Œä¸”åˆ«å¤„æ”¾ä¸ä¸‹ï¼Œå†æŠŠå®ƒè¯·å›å®¶ã€‚â€</p>
<p>è®°ä½ä¸‰è¦ç´ ï¼š</p>
<ol>
<li>é Sendable çŠ¶æ€</li>
<li>å¿…é¡»åŸå­æ“ä½œ</li>
<li>ç°æœ‰ Actor å¸®ä¸ä¸Š</li>
</ol>
<p>åŒæ—¶æ»¡è¶³ â†’ ç”¨ Actorï¼›ç¼ºä¸€æ¡ â†’ æ‰¾æ›´ç®€å•çš„å·¥å…·ã€‚</p>
<p>è®© Actor ç•™åœ¨çœŸæ­£éœ€è¦ä¸²è¡Œå¤§é—¨çš„åœ°æ–¹ï¼Œåˆ«æŠŠè¿œç¨‹æœåŠ¡çš„å¤æ‚åº¦ï¼Œå¸¦è¿›æœ¬å¯å¹¶è¡Œçš„å°èŠ±å›­ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[flutterå›¾ç‰‡é€‰æ‹©åº“multi_image_picker_pluså’Œimage_pickerçš„å¯¹æ¯”å’Œä½¿ç”¨è§£æ]]></title>    <link>https://juejin.cn/post/7570923924365230143</link>    <guid>https://juejin.cn/post/7570923924365230143</guid>    <pubDate>2025-11-11T00:24:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570923924365230143" data-draft-id="7560992984017322019" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="flutterå›¾ç‰‡é€‰æ‹©åº“multi_image_picker_pluså’Œimage_pickerçš„å¯¹æ¯”å’Œä½¿ç”¨è§£æ"/> <meta itemprop="keywords" content="Flutter,Android,iOS"/> <meta itemprop="datePublished" content="2025-11-11T00:24:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é¹å¤šå¤š"/> <meta itemprop="url" content="https://juejin.cn/user/747323639737191"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            flutterå›¾ç‰‡é€‰æ‹©åº“multi_image_picker_pluså’Œimage_pickerçš„å¯¹æ¯”å’Œä½¿ç”¨è§£æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/747323639737191/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é¹å¤šå¤š
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T00:24:37.000Z" title="Tue Nov 11 2025 00:24:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:2;font-weight:400;font-size:15px;overflow-x:hidden;color:#333;letter-spacing:1.2px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child{margin-top:-1.5rem;margin-bottom:1rem}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{content:"#";display:inline-block;color:#3eaf7c;padding-right:.23em}.markdown-body h1{position:relative;font-size:2.5rem;margin-bottom:5px}.markdown-body h1:before{font-size:2.5rem}.markdown-body h2{padding-bottom:.5rem;font-size:2.2rem;border-bottom:1px solid #ececec}.markdown-body h3{font-size:1.5rem;padding-bottom:0}.markdown-body h4{font-size:1.25rem}.markdown-body h5{font-size:1rem}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body strong{color:#3eaf7c}.markdown-body img{max-width:100%;border-radius:2px;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #3eaf7c;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;overflow-x:auto;padding:.2rem .5rem;margin:0;color:#3eaf7c;font-size:.85em;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:.5rem solid #3eaf7c}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{font-weight:500;text-decoration:none;color:#3eaf7c;margin:0 5px}.markdown-body a:active,.markdown-body a:hover{text-decoration:none;border-bottom:1.5px solid #3eaf7c}.markdown-body a[href^=http]:after{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTQiIGhlaWdodD0iMTQiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04MzIgMTI4SDY0MHY2NGgxNDYuNzUyTDUyMS4zNzYgNDU3LjM3Nmw0NS4yNDggNDUuMjQ4TDgzMiAyMzcuMjQ4VjM4NGg2NFYxMjh6IiBmaWxsPSIjM2VhZjdjIi8+PHBhdGggZD0iTTc2OCA4MzJIMTkyVjI1NmgzNTJ2LTY0SDE2MGEzMiAzMiAwIDAwLTMyIDMydjY0MGEzMiAzMiAwIDAwMzIgMzJoNjQwYTMyIDMyIDAgMDAzMi0zMlY0ODBoLTY0djM1MnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");margin-left:2px}.markdown-body a[href^="#"]:before{content:"#"}.markdown-body table{display:inline-block!important;font-size:13px;width:auto;max-width:100%;overflow:auto;border:1px solid #3eaf7c;border-collapse:collapse}.markdown-body thead{background:#3eaf7c;color:#fff;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:4px 8px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#7b7878;padding:1px 23px;border-left:.5rem solid;border-color:#42b983;background-color:rgba(66,184,131,.1);position:relative;margin:14px 8px 0}.markdown-body blockquote:before{display:inline-block;position:absolute;content:url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUiIGhlaWdodD0iMjUiIHZpZXdCb3g9IjAgMCAyNyAyNyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxLjg2MiAxLjg2MikiIGZpbGwtcnVsZT0ibm9uemVybyIgZmlsbD0ibm9uZSI+PGNpcmNsZSBzdHJva2U9IiNGRkYiIHN0cm9rZS13aWR0aD0iMS43MjQiIGZpbGw9IiM0MkI5ODMiIGN4PSIxMS42MzgiIGN5PSIxMS42MzgiIHI9IjExLjYzOCIvPjxwYXRoIGQ9Ik0xNC45NzggNi4yN0E1LjAwNiA1LjAwNiAwIDAwNi42NyA5LjQ2OGE0LjkwMSA0LjkwMSAwIDAwMS43NzMgNC4zNjJjLjMyMy4yNTguNTE0LjY0Ny41MjIgMS4wNnYxLjA2YTIuNjg1IDIuNjg1IDAgMDA1LjM3IDB2LTEuMDA4Yy4wMDItLjM5OC4xNzMtLjc3Ny40Ny0xLjA0MmE1LjAyMyA1LjAyMyAwIDAwLjE3My03LjYzem0tMy4zMzcgMTAuOTY3YTEuMzA0IDEuMzA0IDAgMDEtMS4yODYtMS4yODd2LS4yNzhoMi41NzJ2LjI2MWMwIC43MTMtLjU3MyAxLjI5NC0xLjI4NiAxLjMwNHptMi4yNi00LjQxNWMtLjQ0LjM4My0uNzUuODkzLS44ODcgMS40NmgtMi43NDZhMi44NjggMi44NjggMCAwMC0uOTM4LTEuNTNoLS4wMThhMy40NzYgMy40NzYgMCAwMS0xLjI2OS0zLjE0NSAzLjYxNSAzLjYxNSAwIDAxNy4xOTYuNCAzLjY1IDMuNjUgMCAwMS0xLjMzOCAyLjgxNXoiIGZpbGw9IiNGRkYiLz48L2c+PC9zdmc+");width:25px;height:25px;left:-16px;top:12px}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{outline:none;border:none;border-left:4px solid #3eaf7c;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary::-webkit-details-marker{color:#3eaf7c}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ol li::marker{color:#3eaf7c}.markdown-body ul li{list-style:none;padding-left:10px}.markdown-body ul li::marker{content:"â€¢";color:#3eaf7c}.markdown-body ul li.task-list-item:before{content:"";margin-right:0}.markdown-body input[type=checkbox]{vertical-align:text-bottom;box-shadow:inset 0 0 0 10px #fff}.markdown-body input[type=checkbox]:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04NzcuMDU2IDE0Ni45NDR2NzMwLjExMkgxNDYuOTQ0VjE0Ni45NDRoNzMwLjExMnptMC0xMDQuMjc3SDE0Ni45NDRjLTU3LjYyOCAwLTEwNC4yNzcgNDYuNjQ5LTEwNC4yNzcgMTA0LjI3N3Y3MzAuMTEyYzAgNTcuNjI4IDQ2LjY0OSAxMDQuMjc3IDEwNC4yNzcgMTA0LjI3N2g3MzAuMTEyYzU3LjYyOCAwIDEwNC4yNzctNDYuNjQ5IDEwNC4yNzctMTA0LjI3N1YxNDYuOTQ0YzAtNTcuNjI4LTQ2LjY0OS0xMDQuMjc3LTEwNC4yNzctMTA0LjI3N3oiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}.markdown-body input[type=checkbox]:checked:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTUiIGhlaWdodD0iMTUiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik05MTAuMjA4IDBIMTEzLjc2QTExNC4xMTIgMTE0LjExMiAwIDAwLS4wMzIgMTEzLjc5MlY5MTAuMjRjMCA2Mi41OTIgNTEuMiAxMTMuNzkyIDExMy43OTIgMTEzLjc5Mmg3OTYuNDQ4YzYyLjU5MiAwIDExMy43OTItNTEuMiAxMTMuNzkyLTExMy43OTJWMTEzLjc5MkMxMDI0IDUxLjIgOTcyLjggMCA5MTAuMjA4IDB6bS01MTIgNzk2LjQ0OEwxMTMuNzYgNTEybDc5LjY0OC03OS42NDggMjA0LjggMjA0LjhMODMwLjU2IDIwNC44bDc5LjY0OCA3OS42NDgtNTEyIDUxMnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="agate">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#333;color:#fff}.hljs-name,.hljs-strong{font-weight:700}.hljs-code,.hljs-emphasis{font-style:italic}.hljs-tag{color:#62c8f3}.hljs-selector-class,.hljs-selector-id,.hljs-template-variable,.hljs-variable{color:#ade5fc}.hljs-bullet,.hljs-string{color:#a2fca2}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-quote,.hljs-section,.hljs-title,.hljs-type{color:#ffa}.hljs-bullet,.hljs-number,.hljs-symbol{color:#d36363}.hljs-keyword,.hljs-literal,.hljs-selector-tag{color:#fcc28c}.hljs-code,.hljs-comment,.hljs-deletion{color:#888}.hljs-link,.hljs-regexp{color:#c6b4f0}.hljs-meta{color:#fc9b9b}.hljs-deletion{background-color:#fc9b9b;color:#333}.hljs-addition{background-color:#a2fca2;color:#333}.hljs a{color:inherit}.hljs a:focus,.hljs a:hover{color:inherit;text-decoration:underline}</style><p>åœ¨Flutteråº”ç”¨å¼€å‘ä¸­ï¼Œå›¾ç‰‡é€‰æ‹©æ˜¯é«˜é¢‘åœºæ™¯ï¼Œæ— è®ºæ˜¯å¤´åƒä¸Šä¼ ã€ç›¸å†Œé€‰å›¾è¿˜æ˜¯æ‹ç…§åŠŸèƒ½ï¼Œéƒ½éœ€è¦å¯é çš„å›¾ç‰‡é€‰æ‹©ç»„ä»¶æ”¯æ’‘ã€‚ç›®å‰ç¤¾åŒºä¸­æœ€å¸¸ç”¨çš„ä¸¤æ¬¾ç»„ä»¶åˆ†åˆ«æ˜¯<strong>multi_image_picker_plus</strong>å’Œå®˜æ–¹ç»´æŠ¤çš„<strong>image_picker</strong>ã€‚æœ¬æ–‡å°†ä»æ ¸å¿ƒå±æ€§ã€APIæ¥å£ã€ä½¿ç”¨æµç¨‹ã€åŠŸèƒ½å·®å¼‚åŠä¼˜ç¼ºç‚¹ç­‰ç»´åº¦è¿›è¡Œå…¨é¢è§£æï¼Œå¸®åŠ©å¼€å‘è€…æ ¹æ®ä¸šåŠ¡éœ€æ±‚ç²¾å‡†é€‰å‹ã€‚</p>
<h2 data-id="heading-0">1. ç»„ä»¶åŸºç¡€è®¤çŸ¥</h2>
<p>åœ¨æ·±å…¥ç»†èŠ‚å‰ï¼Œå…ˆæ˜ç¡®ä¸¤æ¬¾ç»„ä»¶çš„æ ¸å¿ƒå®šä½ï¼Œä¸ºåç»­å¯¹æ¯”å»ºç«‹åŸºç¡€ï¼Œå¦‚ä¸‹ï¼š</p>
<ul>
<li>
<p><strong>image_picker</strong>ï¼šFlutterå®˜æ–¹å›¢é˜Ÿç»´æŠ¤çš„å›¾ç‰‡/è§†é¢‘é€‰æ‹©ç»„ä»¶ï¼Œä¸»æ‰“è½»é‡ã€ç¨³å®šï¼Œæ”¯æŒæ‹ç…§å’Œå•å¼ /å¤šå¼ å›¾ç‰‡é€‰æ‹©ï¼Œé€‚é…iOSå’ŒAndroidåŒå¹³å°ï¼Œæ˜¯å®˜æ–¹æ¨èçš„åŸºç¡€é€‰æ‹©ã€‚</p>
</li>
<li>
<p><strong>multi_image_picker_plus</strong>ï¼šç¬¬ä¸‰æ–¹å¼€æºç»„ä»¶ï¼ŒåŸºäºæ—©æœŸçš„multi_image_pickerè¿­ä»£ä¼˜åŒ–ï¼Œä¸“æ³¨äº<strong>å¤šå›¾é€‰æ‹©åœºæ™¯</strong>ï¼Œæä¾›æ›´ä¸°å¯Œçš„é€‰å›¾äº¤äº’å’Œå›¾ç‰‡å¤„ç†èƒ½åŠ›ï¼Œæ‰©å±•æ€§æ›´å¼ºã€‚</p>
</li>
</ul>
<h2 data-id="heading-1">2. æ ¸å¿ƒå±æ€§ä¸APIè§£æ</h2>
<p>ä¸¤æ¬¾ç»„ä»¶çš„å±æ€§å’ŒAPIè®¾è®¡å›´ç»•å…¶å®šä½å±•å¼€ï¼Œimage_pickerä¾§é‡ç®€æ´æ˜“ç”¨ï¼Œmulti_image_picker_plusä¾§é‡å¤šå›¾åœºæ™¯çš„ç²¾ç»†åŒ–æ§åˆ¶ã€‚</p>
<h3 data-id="heading-2">2.1. image_picker æ ¸å¿ƒè§£æ</h3>
<p>image_pickerçš„APIè®¾è®¡æç®€ï¼Œé€šè¿‡é™æ€æ–¹æ³•ç›´æ¥è°ƒç”¨ï¼Œæ ¸å¿ƒå±æ€§é›†ä¸­åœ¨é€‰æ‹©å‚æ•°çš„é…ç½®ä¸Šã€‚</p>
<h4 data-id="heading-3">2.1.1. å…³é”®å±æ€§</h4>









































<table><thead><tr><th>å±æ€§å</th><th>ç±»å‹</th><th>ä½œç”¨</th><th>å¹³å°æ”¯æŒ</th></tr></thead><tbody><tr><td>source</td><td>ImageSource</td><td>æŒ‡å®šå›¾ç‰‡æ¥æºï¼Œå¯é€‰galleryï¼ˆç›¸å†Œï¼‰æˆ–cameraï¼ˆç›¸æœºï¼‰</td><td>iOS/Android</td></tr><tr><td>imageQuality</td><td>int (0-100)</td><td>å‹ç¼©åå›¾ç‰‡è´¨é‡ï¼Œæ•°å€¼è¶Šé«˜è´¨é‡è¶Šå¥½ï¼Œä»…Androidæ”¯æŒ</td><td>Android</td></tr><tr><td>maxWidth/maxHeight</td><td>double</td><td>å‹ç¼©åå›¾ç‰‡çš„æœ€å¤§å®½é«˜ï¼Œè¶…è¿‡åˆ™ç­‰æ¯”ç¼©æ”¾</td><td>iOS/Android</td></tr><tr><td>requestFullMetadata</td><td>bool</td><td>æ˜¯å¦è¯·æ±‚å›¾ç‰‡å…ƒæ•°æ®ï¼ˆå¦‚æ‹æ‘„æ—¶é—´ã€ä½ç½®ï¼‰ï¼Œé»˜è®¤false</td><td>iOS/Android</td></tr><tr><td>preferredCameraDevice</td><td>CameraDevice</td><td>æŒ‡å®šç›¸æœºè®¾å¤‡ï¼Œå¯é€‰rearï¼ˆåç½®ï¼‰æˆ–frontï¼ˆå‰ç½®ï¼‰</td><td>iOS/Android</td></tr></tbody></table>
<h4 data-id="heading-4">2.1.2. æ ¸å¿ƒAPI</h4>
<p>image_pickerçš„æ ¸å¿ƒAPIå°è£…åœ¨<code>ImagePicker</code>ç±»ä¸­ï¼Œä¸»è¦æä¾›å›¾ç‰‡å’Œè§†é¢‘é€‰æ‹©æ–¹æ³•ï¼Œæ”¯æŒå•å¼ å’Œå¤šå¼ é€‰æ‹©ï¼š</p>
<ol>
<li><strong>å•å¼ å›¾ç‰‡é€‰æ‹©</strong>ï¼š</li>
</ol>
<pre><code class="hljs language-dart" lang="dart">Future&lt;XFile?&gt; pickImage({
  <span class="hljs-keyword">required</span> ImageSource source,
  <span class="hljs-built_in">double?</span> maxWidth,
  <span class="hljs-built_in">double?</span> maxHeight,
  <span class="hljs-built_in">int?</span> imageQuality,
  <span class="hljs-built_in">bool</span> requestFullMetadata = <span class="hljs-keyword">false</span>,
})
</code></pre>
<ol start="2">
<li><strong>å¤šå¼ å›¾ç‰‡é€‰æ‹©</strong>ï¼š</li>
</ol>
<pre><code class="hljs language-dart" lang="dart">Future&lt;<span class="hljs-built_in">List</span>&lt;XFile&gt;?&gt; pickMultiImage({
  <span class="hljs-built_in">double?</span> maxWidth,
  <span class="hljs-built_in">double?</span> maxHeight,
  <span class="hljs-built_in">int?</span> imageQuality,
  <span class="hljs-built_in">bool</span> requestFullMetadata = <span class="hljs-keyword">false</span>,
})
</code></pre>
<ol start="3">
<li><strong>æ‹ç…§</strong>ï¼š</li>
</ol>
<pre><code class="hljs language-dart" lang="dart">Future&lt;XFile?&gt; pickImage(
  source: ImageSource.camera, <span class="hljs-comment">// æŒ‡å®šç›¸æœºæ¥æº</span>
  preferredCameraDevice: CameraDevice.front, <span class="hljs-comment">// å¯é€‰å‰ç½®ç›¸æœº</span>
)
</code></pre>
<ol start="4">
<li><strong>è·å–å›¾ç‰‡ä¸´æ—¶è·¯å¾„</strong>ï¼šé€šè¿‡è¿”å›çš„<code>XFile</code>å¯¹è±¡çš„<code>path</code>å±æ€§è·å–ï¼Œå¯ç”¨äºé¢„è§ˆæˆ–ä¸Šä¼ ã€‚</li>
</ol>
<h3 data-id="heading-5">2.2. multi_image_picker_plus æ ¸å¿ƒè§£æ</h3>
<p>multi_image_picker_plusä¸“ä¸ºå¤šå›¾åœºæ™¯è®¾è®¡ï¼ŒAPIæ”¯æŒæ‰¹é‡é€‰æ‹©ã€é¢„è§ˆã€ç¼–è¾‘ç­‰åŠŸèƒ½ï¼Œå±æ€§é…ç½®æ›´ç»†è‡´ï¼Œæ”¯æŒè‡ªå®šä¹‰é€‰å›¾ç•Œé¢é£æ ¼ã€‚</p>
<h4 data-id="heading-6">2.2.1. å…³é”®å±æ€§</h4>





















































<table><thead><tr><th>å±æ€§å</th><th>ç±»å‹</th><th>ä½œç”¨</th><th>å¹³å°æ”¯æŒ</th></tr></thead><tbody><tr><td>maxImages</td><td>int</td><td>æœ€å¤§é€‰æ‹©å›¾ç‰‡æ•°é‡ï¼Œå¿…å¡«å‚æ•°</td><td>iOS/Android</td></tr><tr><td>selectedAssets</td><td>List</td><td>å·²é€‰æ‹©çš„å›¾ç‰‡åˆ—è¡¨ï¼Œç”¨äºå›æ˜¾å·²é€‰å†…å®¹</td><td>iOS/Android</td></tr><tr><td>enableCamera</td><td>bool</td><td>æ˜¯å¦æ˜¾ç¤ºç›¸æœºå…¥å£ï¼Œæ”¯æŒé€‰å›¾æ—¶ç›´æ¥æ‹ç…§</td><td>iOS/Android</td></tr><tr><td>cupertinoOptions</td><td>CupertinoOptions</td><td>iOSç«¯è‡ªå®šä¹‰é…ç½®ï¼ˆå¦‚æ ‡é¢˜ã€å–æ¶ˆæŒ‰é’®æ–‡å­—ï¼‰</td><td>iOS</td></tr><tr><td>materialOptions</td><td>MaterialOptions</td><td>Androidç«¯è‡ªå®šä¹‰é…ç½®ï¼ˆå¦‚ä¸»é¢˜è‰²ã€ç½‘æ ¼åˆ—æ•°ï¼‰</td><td>Android</td></tr><tr><td>compressQuality</td><td>int (0-100)</td><td>å›¾ç‰‡å‹ç¼©è´¨é‡ï¼ŒåŒå¹³å°å‡æ”¯æŒ</td><td>iOS/Android</td></tr><tr><td>compressSize</td><td>int</td><td>å›¾ç‰‡å‹ç¼©åæœ€å¤§å°ºå¯¸ï¼ˆKBï¼‰ï¼Œè¶…è¿‡åˆ™è¿›ä¸€æ­¥å‹ç¼©</td><td>iOS/Android</td></tr></tbody></table>
<h4 data-id="heading-7">2.2.2. æ ¸å¿ƒAPI</h4>
<p>multi_image_picker_plusçš„æ ¸å¿ƒæ˜¯<code>MultiImagePicker</code>ç±»ï¼Œé€šè¿‡<code>pickImages</code>æ–¹æ³•è§¦å‘é€‰å›¾ï¼Œè¿”å›<code>Asset</code>å¯¹è±¡åˆ—è¡¨ï¼ˆåŒ…å«å›¾ç‰‡è¯¦æƒ…ï¼‰ï¼Œå…³é”®APIå¦‚ä¸‹ï¼š</p>
<ol>
<li><strong>å¤šå›¾é€‰æ‹©</strong>ï¼š</li>
</ol>
<pre><code class="hljs language-dart" lang="dart">Future&lt;<span class="hljs-built_in">List</span>&lt;Asset&gt;&gt; pickImages({
  <span class="hljs-keyword">required</span> <span class="hljs-built_in">int</span> maxImages,
  <span class="hljs-built_in">List</span>&lt;Asset&gt; selectedAssets = <span class="hljs-keyword">const</span> [],
  <span class="hljs-built_in">bool</span> enableCamera = <span class="hljs-keyword">true</span>,
  CupertinoOptions cupertinoOptions = <span class="hljs-keyword">const</span> CupertinoOptions(),
  MaterialOptions materialOptions = <span class="hljs-keyword">const</span> MaterialOptions(),
  <span class="hljs-built_in">int</span> compressQuality = <span class="hljs-number">80</span>,
  <span class="hljs-built_in">int?</span> compressSize,
})
</code></pre>
<ol start="2">
<li>
<p><strong>Assetå¯¹è±¡æ ¸å¿ƒæ–¹æ³•</strong>ï¼š
<code>getByteData({int? width, int? height})</code>ï¼šè·å–å›¾ç‰‡å­—èŠ‚æ•°æ®ï¼Œæ”¯æŒæŒ‡å®šå®½é«˜ç¼©æ”¾</p>
</li>
<li>
<p><code>getImageByteData()</code>ï¼šè·å–åŸå§‹å›¾ç‰‡å­—èŠ‚æ•°æ®</p>
</li>
<li>
<p><code>getThumbByteData(int width, int height)</code>ï¼šè·å–ç¼©ç•¥å›¾å­—èŠ‚æ•°æ®</p>
</li>
<li>
<p><code>getMetadata()</code>ï¼šè·å–å›¾ç‰‡å…ƒæ•°æ®ï¼ˆå°ºå¯¸ã€ç±»å‹ã€æ‹æ‘„æ—¶é—´ç­‰ï¼‰</p>
</li>
<li>
<p><strong>é¢„è§ˆå·²é€‰å›¾ç‰‡</strong>ï¼šé€šè¿‡<code>AssetPreview</code>ç»„ä»¶å¯ç›´æ¥é¢„è§ˆ<code>Asset</code>åˆ—è¡¨ï¼Œæ— éœ€é¢å¤–å¤„ç†è·¯å¾„ã€‚</p>
</li>
</ol>
<h2 data-id="heading-8">3. å®é™…ä½¿ç”¨æµç¨‹å¯¹æ¯”</h2>
<p>ä¸¤æ¬¾ç»„ä»¶çš„é›†æˆæµç¨‹ç›¸ä¼¼ï¼Œä½†åœ¨å¤šå›¾å¤„ç†å’Œè‡ªå®šä¹‰åœºæ™¯ä¸‹å­˜åœ¨å·®å¼‚ï¼Œä»¥ä¸‹æ˜¯å®Œæ•´é›†æˆæ­¥éª¤å¯¹æ¯”ã€‚</p>
<h3 data-id="heading-9">3.1. image_picker é›†æˆæ­¥éª¤</h3>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªåŸºæœ¬ä¾‹å­çš„é›†æˆæ­¥éª¤ï¼š</p>
<h4 data-id="heading-10">3.1.1. æ·»åŠ ä¾èµ–</h4>
<p>åœ¨<code>pubspec.yaml</code>ä¸­æ·»åŠ ä¾èµ–å¹¶æ‰§è¡Œ<code>pub get</code>ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">image_picker:</span> <span class="hljs-string">^1.1.1</span>
</code></pre>
<h4 data-id="heading-11">3.1.2. å¹³å°é…ç½®</h4>
<p>iOSï¼šåœ¨<code>Info.plist</code>ä¸­æ·»åŠ æƒé™æè¿°ï¼š</p>
<pre><code class="hljs language-plist" lang="plist"><span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>NSPhotoLibraryUsageDescription<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>éœ€è¦è®¿é—®ç›¸å†Œä»¥é€‰æ‹©å›¾ç‰‡<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>NSCameraUsageDescription<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>éœ€è¦è®¿é—®ç›¸æœºä»¥æ‹æ‘„å›¾ç‰‡<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
</code></pre>
<p>Androidï¼šåœ¨<code>AndroidManifest.xml</code>ä¸­æ·»åŠ æƒé™ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.READ_EXTERNAL_STORAGE"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.CAMERA"</span>/&gt;</span>
<span class="hljs-comment">&lt;!-- Android 13+ éœ€æ·»åŠ è¯»å†™åª’ä½“æƒé™ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.READ_MEDIA_IMAGES"</span>/&gt;</span>
</code></pre>
<h4 data-id="heading-12">3.1.3. æ ¸å¿ƒä»£ç å®ç°</h4>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:image_picker/image_picker.dart'</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ImagePickerDemo</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-meta">@override</span>
  _ImagePickerDemoState createState() =&gt; _ImagePickerDemoState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_ImagePickerDemoState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">ImagePickerDemo</span>&gt; </span>{
  <span class="hljs-keyword">final</span> ImagePicker _picker = ImagePicker();
  <span class="hljs-built_in">List</span>&lt;XFile&gt; _selectedImages = [];

  <span class="hljs-comment">// é€‰æ‹©å¤šå¼ å›¾ç‰‡</span>
  Future&lt;<span class="hljs-keyword">void</span>&gt; _pickMultiImages() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;XFile&gt;? images = <span class="hljs-keyword">await</span> _picker.pickMultiImage(
      imageQuality: <span class="hljs-number">80</span>, <span class="hljs-comment">// å‹ç¼©è´¨é‡</span>
      maxWidth: <span class="hljs-number">1080</span>, <span class="hljs-comment">// æœ€å¤§å®½åº¦</span>
    );
    <span class="hljs-keyword">if</span> (images != <span class="hljs-keyword">null</span>) {
      setState(() =&gt; _selectedImages = images);
    }
  }

  <span class="hljs-comment">// æ‹ç…§</span>
  Future&lt;<span class="hljs-keyword">void</span>&gt; _takePhoto() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">final</span> XFile? photo = <span class="hljs-keyword">await</span> _picker.pickImage(
      source: ImageSource.camera,
      preferredCameraDevice: CameraDevice.front,
    );
    <span class="hljs-keyword">if</span> (photo != <span class="hljs-keyword">null</span>) {
      setState(() =&gt; _selectedImages.add(photo));
    }
  }

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Scaffold(
      appBar: AppBar(title: Text(<span class="hljs-string">"ImagePickerç¤ºä¾‹"</span>)),
      body: GridView.count(
        crossAxisCount: <span class="hljs-number">3</span>,
        children: [
          <span class="hljs-comment">// é€‰æ‹©æŒ‰é’®</span>
          IconButton(onPressed: _pickMultiImages, icon: Icon(Icons.photo_library)),
          IconButton(onPressed: _takePhoto, icon: Icon(Icons.camera)),
          <span class="hljs-comment">// å·²é€‰å›¾ç‰‡é¢„è§ˆ</span>
          ..._selectedImages.map((image) =&gt; Image.file(File(image.path))),
        ],
      ),
    );
  }
}
</code></pre>
<h3 data-id="heading-13">3.2 multi_image_picker_plus é›†æˆæ­¥éª¤</h3>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªåŸºæœ¬ä¾‹å­çš„é›†æˆæ­¥éª¤ï¼š</p>
<h4 data-id="heading-14">3.2.1. æ·»åŠ ä¾èµ–</h4>
<p>åœ¨<code>pubspec.yaml</code>ä¸­æ·»åŠ ä¾èµ–å¹¶æ‰§è¡Œ<code>pub get</code>ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">multi_image_picker_plus:</span> <span class="hljs-string">^1.0.5</span>
</code></pre>
<h4 data-id="heading-15">3.2.2. å¹³å°é…ç½®</h4>
<p>iOSï¼šåœ¨<code>Info.plist</code>ä¸­æ·»åŠ ç›¸å†Œå’Œç›¸æœºæƒé™æè¿°ã€‚</p>
<pre><code class="hljs language-plist" lang="plist"><span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>NSPhotoLibraryUsageDescription<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>éœ€è¦è®¿é—®ç›¸å†Œä»¥é€‰æ‹©å›¾ç‰‡<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>NSCameraUsageDescription<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>éœ€è¦è®¿é—®ç›¸æœºä»¥æ‹æ‘„å›¾ç‰‡<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
</code></pre>
<p>Androidï¼šåœ¨<code>AndroidManifest.xml</code>ä¸­æ·»åŠ æƒé™ï¼Œå¹¶é…ç½®ä¸»é¢˜ï¼ˆå¯é€‰ï¼‰ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.READ_EXTERNAL_STORAGE"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.CAMERA"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.WRITE_EXTERNAL_STORAGE"</span> <span class="hljs-attr">android:maxSdkVersion</span>=<span class="hljs-string">"32"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">application</span> <span class="hljs-attr">...</span> <span class="hljs-attr">android:theme</span>=<span class="hljs-string">"@style/Theme.AppCompat.Light"</span>/&gt;</span>
</code></pre>
<h4 data-id="heading-16">3.2.3. æ ¸å¿ƒä»£ç å®ç°</h4>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:multi_image_picker_plus/multi_image_picker_plus.dart'</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MultiImagePickerDemo</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-meta">@override</span>
  _MultiImagePickerDemoState createState() =&gt; _MultiImagePickerDemoState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_MultiImagePickerDemoState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">MultiImagePickerDemo</span>&gt; </span>{
  <span class="hljs-built_in">List</span>&lt;Asset&gt; _selectedAssets = [];

  <span class="hljs-comment">// é€‰æ‹©å¤šå›¾</span>
  Future&lt;<span class="hljs-keyword">void</span>&gt; _pickImages() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-built_in">List</span>&lt;Asset&gt; resultList = <span class="hljs-keyword">await</span> MultiImagePicker.pickImages(
        maxImages: <span class="hljs-number">9</span>, <span class="hljs-comment">// æœ€å¤šé€‰9å¼ </span>
        selectedAssets: _selectedAssets, <span class="hljs-comment">// å›æ˜¾å·²é€‰</span>
        enableCamera: <span class="hljs-keyword">true</span>, <span class="hljs-comment">// æ˜¾ç¤ºç›¸æœºå…¥å£</span>
        compressQuality: <span class="hljs-number">80</span>, <span class="hljs-comment">// å‹ç¼©è´¨é‡</span>
        materialOptions: MaterialOptions(
          actionBarColor: <span class="hljs-string">"#2196F3"</span>, <span class="hljs-comment">// æ ‡é¢˜æ é¢œè‰²</span>
          statusBarColor: <span class="hljs-string">"#2196F3"</span>, <span class="hljs-comment">// çŠ¶æ€æ é¢œè‰²</span>
          gridColumnCount: <span class="hljs-number">4</span>, <span class="hljs-comment">// ç½‘æ ¼åˆ—æ•°</span>
        ),
      );
      setState(() =&gt; _selectedAssets = resultList);
    } <span class="hljs-keyword">on</span> Exception <span class="hljs-keyword">catch</span> (e) {
      <span class="hljs-built_in">print</span>(<span class="hljs-string">"é€‰å›¾å¼‚å¸¸ï¼š<span class="hljs-subst">$e</span>"</span>);
    }
  }

  <span class="hljs-comment">// é¢„è§ˆå›¾ç‰‡</span>
  <span class="hljs-keyword">void</span> _previewImages() {
    <span class="hljs-keyword">if</span> (_selectedAssets.isNotEmpty) {
      Navigator.push(
        context,
        MaterialPageRoute(
          builder: (context) =&gt; AssetPreview(
            assets: _selectedAssets,
            startIndex: <span class="hljs-number">0</span>,
          ),
        ),
      );
    }
  }

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Scaffold(
      appBar: AppBar(title: Text(<span class="hljs-string">"MultiImagePickerPlusç¤ºä¾‹"</span>)),
      body: Column(
        children: [
          ElevatedButton(onPressed: _pickImages, child: Text(<span class="hljs-string">"é€‰æ‹©å›¾ç‰‡"</span>)),
          ElevatedButton(onPressed: _previewImages, child: Text(<span class="hljs-string">"é¢„è§ˆå›¾ç‰‡"</span>)),
          Expanded(
            child: GridView.count(
              crossAxisCount: <span class="hljs-number">4</span>,
              children: _selectedAssets.map((asset) =&gt;
                AssetThumb(
                  asset: asset,
                  width: <span class="hljs-number">100</span>,
                  height: <span class="hljs-number">100</span>,
                )
              ).toList(),
            ),
          ),
        ],
      ),
    );
  }
}
</code></pre>
<h2 data-id="heading-17">4. æ ¸å¿ƒå·®å¼‚ä¸ä¼˜ç¼ºç‚¹å¯¹æ¯”</h2>
<p>åŸºäºä¸Šè¿°è§£æï¼Œä¸¤æ¬¾ç»„ä»¶åœ¨åŠŸèƒ½ã€æ€§èƒ½ã€æ‰©å±•æ€§ç­‰æ–¹é¢å­˜åœ¨æ˜¾è‘—å·®å¼‚ï¼Œä»¥ä¸‹ä»å¤šä¸ªç»´åº¦è¿›è¡Œå¯¹æ¯”ï¼š</p>
<h3 data-id="heading-18">4.1 æ ¸å¿ƒåŠŸèƒ½å·®å¼‚</h3>













































<table><thead><tr><th>åŠŸèƒ½ç‚¹</th><th>image_picker</th><th>multi_image_picker_plus</th></tr></thead><tbody><tr><td>å¤šå›¾é€‰æ‹©</td><td>æ”¯æŒï¼Œä½†æ— é€‰å›¾æ•°é‡å®æ—¶æç¤º</td><td>åŸç”Ÿæ”¯æŒï¼Œæ˜¾ç¤ºå·²é€‰æ•°é‡å’Œå‰©ä½™å¯é€‰é¡¹</td></tr><tr><td>é€‰å›¾æ—¶æ‹ç…§</td><td>éœ€å•ç‹¬è°ƒç”¨ç›¸æœºAPIï¼Œæ— æ³•åœ¨é€‰å›¾ç•Œé¢ç›´æ¥æ‹ç…§</td><td>æ”¯æŒåœ¨é€‰å›¾ç•Œé¢å†…ç½®ç›¸æœºå…¥å£ï¼Œæ‹ç…§åç›´æ¥åŠ å…¥å·²é€‰</td></tr><tr><td>ç•Œé¢è‡ªå®šä¹‰</td><td>æ— ï¼Œä½¿ç”¨ç³»ç»ŸåŸç”Ÿé€‰å›¾ç•Œé¢</td><td>æ”¯æŒåŒå¹³å°ä¸»é¢˜ã€é¢œè‰²ã€ç½‘æ ¼åˆ—æ•°ç­‰è‡ªå®šä¹‰</td></tr><tr><td>å›¾ç‰‡é¢„è§ˆ</td><td>éœ€é€šè¿‡Fileè·¯å¾„è‡ªè¡Œå®ç°é¢„è§ˆç»„ä»¶</td><td>æä¾›AssetPreviewç»„ä»¶ï¼Œç›´æ¥é¢„è§ˆAssetåˆ—è¡¨</td></tr><tr><td>å‹ç¼©æ§åˆ¶</td><td>ä»…æ”¯æŒè´¨é‡å’Œå®½é«˜å‹ç¼©ï¼ŒAndroid/iOSå·®å¼‚å¤§</td><td>æ”¯æŒè´¨é‡ã€å°ºå¯¸ã€å¤§å°ä¸‰é‡å‹ç¼©ï¼ŒåŒå¹³å°ç»Ÿä¸€</td></tr><tr><td>å…ƒæ•°æ®è·å–</td><td>éœ€å¼€å¯requestFullMetadataï¼Œä»…è¿”å›åŸºç¡€ä¿¡æ¯</td><td>åŸç”Ÿæ”¯æŒï¼Œå¯è·å–å°ºå¯¸ã€ç±»å‹ã€æ‹æ‘„æ—¶é—´ç­‰è¯¦ç»†ä¿¡æ¯</td></tr><tr><td>è§†é¢‘é€‰æ‹©</td><td>æ”¯æŒå•è§†é¢‘/å¤šè§†é¢‘é€‰æ‹©</td><td>ä»…æ”¯æŒå›¾ç‰‡é€‰æ‹©ï¼Œä¸æ”¯æŒè§†é¢‘</td></tr></tbody></table>
<h3 data-id="heading-19">4.2 ä¼˜ç¼ºç‚¹å¯¹æ¯”</h3>
<p>ä»¥ä¸‹åˆ†ç±»å‹ç»´åº¦è¿›è¡Œå¯¹æ¯”:</p>
<h4 data-id="heading-20">4.2.1. image_pickerçš„ä¼˜ç¼ºç‚¹</h4>
<ul>
<li>
<p><strong>ä¼˜ç‚¹</strong>ï¼š
å®˜æ–¹ç»´æŠ¤ï¼Œç¨³å®šæ€§é«˜ï¼Œä¸Flutterç‰ˆæœ¬å…¼å®¹æ€§å¥½</p>
</li>
<li>
<p>è½»é‡ç®€æ´ï¼ŒAPIå­¦ä¹ æˆæœ¬ä½ï¼Œå¿«é€Ÿé›†æˆ</p>
</li>
<li>
<p>æ”¯æŒè§†é¢‘é€‰æ‹©ï¼Œæ»¡è¶³å›¾æ–‡+è§†é¢‘æ··åˆåœºæ™¯</p>
</li>
<li>
<p>ç³»ç»ŸåŸç”Ÿç•Œé¢ï¼Œç”¨æˆ·ç†Ÿæ‚‰åº¦é«˜ï¼Œäº¤äº’ä¸€è‡´æ€§å¥½</p>
</li>
</ul>
<p><strong>ç¼ºç‚¹</strong>ï¼š
å¤šå›¾é€‰æ‹©ä½“éªŒå·®ï¼Œæ— å®æ—¶æ•°é‡æç¤ºå’Œå·²é€‰å›æ˜¾ä¼˜åŒ–</p>
<p>ç•Œé¢æ— æ³•è‡ªå®šä¹‰ï¼Œæ— æ³•åŒ¹é…APPæ•´ä½“è®¾è®¡é£æ ¼</p>
<p>å‹ç¼©å’Œé¢„è§ˆéœ€è‡ªè¡Œå¤„ç†ï¼Œå¼€å‘æ•ˆç‡ä½</p>
<p>Androidå’ŒiOSå‹ç¼©é€»è¾‘ä¸ä¸€è‡´ï¼Œéœ€é¢å¤–é€‚é…</p>
<h4 data-id="heading-21">4.2.2. multi_image_picker_plusçš„ä¼˜ç¼ºç‚¹</h4>
<ul>
<li>
<p><strong>ä¼˜ç‚¹</strong>ï¼š
å¤šå›¾é€‰æ‹©ä½“éªŒæä½³ï¼Œæ”¯æŒå·²é€‰å›æ˜¾ã€æ•°é‡æ§åˆ¶ã€å†…ç½®ç›¸æœº</p>
</li>
<li>
<p>ä¸°å¯Œçš„è‡ªå®šä¹‰èƒ½åŠ›ï¼Œå¯åŒ¹é…APPä¸»é¢˜é£æ ¼</p>
</li>
<li>
<p>æä¾›AssetPreviewã€AssetThumbç­‰ç»„ä»¶ï¼Œå‡å°‘é‡å¤å¼€å‘</p>
</li>
<li>
<p>ç»Ÿä¸€çš„å‹ç¼©é€»è¾‘ï¼ŒåŒå¹³å°è¡¨ç°ä¸€è‡´</p>
</li>
<li>
<p>Assetå¯¹è±¡å°è£…å®Œå–„ï¼Œä¾¿äºå›¾ç‰‡å¤„ç†å’Œä¸Šä¼ </p>
</li>
</ul>
<p><strong>ç¼ºç‚¹</strong>ï¼š
ç¬¬ä¸‰æ–¹ç»´æŠ¤ï¼Œç‰ˆæœ¬æ›´æ–°é€Ÿåº¦å¯èƒ½æ»åäºFlutteræ–°ç‰ˆæœ¬</p>
<p>ä¸æ”¯æŒè§†é¢‘é€‰æ‹©ï¼Œéœ€é¢å¤–é›†æˆå…¶ä»–ç»„ä»¶</p>
<p>è‡ªå®šä¹‰é…ç½®é¡¹å¤šï¼Œåˆæ¬¡é›†æˆéœ€ç†Ÿæ‚‰æ›´å¤šå‚æ•°</p>
<p>åŒ…ä½“ç§¯ç•¥å¤§äºimage_picker</p>
<h2 data-id="heading-22">5. é€‰å‹å»ºè®®</h2>
<p>æ ¹æ®ä¸šåŠ¡åœºæ™¯çš„ä¸åŒï¼Œä¸¤æ¬¾ç»„ä»¶çš„é€‚ç”¨åœºæ™¯å­˜åœ¨æ˜æ˜¾åŒºåˆ†ï¼Œå»ºè®®æŒ‰ä»¥ä¸‹åŸåˆ™é€‰å‹ï¼š</p>
<ol>
<li>
<p><strong>ä¼˜å…ˆé€‰æ‹© image_picker çš„åœºæ™¯</strong>ï¼š
ç®€å•çš„å•å›¾é€‰æ‹©æˆ–æ‹ç…§åœºæ™¯ï¼ˆå¦‚å¤´åƒä¸Šä¼ ï¼‰</p>
</li>
<li>
<p>éœ€è¦åŒæ—¶æ”¯æŒå›¾ç‰‡å’Œè§†é¢‘é€‰æ‹©çš„åœºæ™¯</p>
</li>
<li>
<p>å¯¹åŒ…ä½“ç§¯æ•æ„Ÿï¼Œè¿½æ±‚è½»é‡é›†æˆçš„åœºæ™¯</p>
</li>
<li>
<p>é‡è§†å®˜æ–¹ç»´æŠ¤ä¿éšœï¼Œéœ€é•¿æœŸç¨³å®šæ€§çš„åœºæ™¯</p>
</li>
<li>
<p><strong>ä¼˜å…ˆé€‰æ‹© multi_image_picker_plus çš„åœºæ™¯</strong>ï¼š
æ ¸å¿ƒåœºæ™¯ä¸ºå¤šå›¾é€‰æ‹©ï¼ˆå¦‚æœ‹å‹åœˆã€ç›¸å†Œä¸Šä¼ ï¼‰</p>
</li>
<li>
<p>å¯¹é€‰å›¾ç•Œé¢é£æ ¼æœ‰è‡ªå®šä¹‰éœ€æ±‚ï¼Œéœ€åŒ¹é…APPä¸»é¢˜</p>
</li>
<li>
<p>éœ€è¦ä¼˜åŒ–å¤šå›¾é€‰å›¾ä½“éªŒï¼ˆå¦‚å·²é€‰å›æ˜¾ã€å†…ç½®ç›¸æœºï¼‰</p>
</li>
<li>
<p>éœ€è¦å¿«é€Ÿå®ç°å›¾ç‰‡é¢„è§ˆã€ç¼©ç•¥å›¾å±•ç¤ºçš„åœºæ™¯</p>
</li>
</ol>
<h2 data-id="heading-23">6. æ€»ç»“</h2>
<p>image_pickerå’Œmulti_image_picker_pluså„æœ‰ä¾§é‡ï¼š</p>
<ul>
<li>image_pickeræ˜¯å®˜æ–¹èƒŒä¹¦çš„"åŸºç¡€æ¬¾"ï¼Œèƒœåœ¨ç¨³å®šè½»é‡ã€æ”¯æŒè§†é¢‘ï¼›</li>
<li>multi_image_picker_plusæ˜¯å¤šå›¾åœºæ™¯çš„"ä¸“ä¸šæ¬¾"ï¼Œèµ¢åœ¨ä½“éªŒä¼˜åŒ–å’Œè‡ªå®šä¹‰èƒ½åŠ›ã€‚</li>
</ul>
<p>å¼€å‘è€…åœ¨å®é™…å¼€å‘ä¸­éœ€ç»“åˆä¸šåŠ¡éœ€æ±‚çš„æ ¸å¿ƒç—›ç‚¹ï¼Œæƒè¡¡ç¨³å®šæ€§ã€åŠŸèƒ½å®Œæ•´æ€§å’Œå¼€å‘æ•ˆç‡ï¼Œé€‰æ‹©æœ€é€‚åˆçš„ç»„ä»¶ã€‚è‹¥éœ€åŒæ—¶æ”¯æŒå¤šå›¾å’Œè§†é¢‘ï¼Œå¯è€ƒè™‘ä¸¤è€…ç»“åˆä½¿ç”¨ã€‚ç”¨multi_image_picker_pluså¤„ç†å¤šå›¾ï¼Œè€Œimage_pickerè¡¥å……è§†é¢‘é€‰æ‹©èƒ½åŠ›ã€‚</p>
<hr/>
<blockquote>
<p>æœ¬æ¬¡åˆ†äº«å°±åˆ°è¿™å„¿å•¦ï¼Œæˆ‘æ˜¯é¹å¤šå¤šï¼Œæ·±è€•å‰ç«¯çš„æŠ€æœ¯åˆ›ä½œè€…ï¼Œå¦‚æœæ‚¨çœ‹äº†è§‰å¾—æœ‰å¸®åŠ©ï¼Œæ¬¢è¿è¯„è®ºï¼Œå…³æ³¨ï¼Œç‚¹èµï¼Œè½¬å‘ï¼Œæˆ‘ä»¬ä¸‹æ¬¡è§~</p>
</blockquote>
<p>PSï¼šåœ¨æœ¬é¡µæŒ‰F12ï¼Œåœ¨consoleä¸­è¾“å…¥document.getElementsByClassName('panel-btn')[0].click();æœ‰æƒŠå–œå“¦~</p>
<p><code>å¾€æœŸæ–‡ç« </code></p>
<ul>
<li><a href="https://juejin.cn/post/7568136081302978623" target="_blank" title="https://juejin.cn/post/7568136081302978623">è§£é”flutterå¼¹çª—æ–°å§¿åŠ¿ï¼šdialog-flutter_smart_dialogæ’ä»¶è§£è¯»+æ¡ˆä¾‹</a></li>
<li><a href="https://juejin.cn/post/7559089440901545999" target="_blank" title="https://juejin.cn/post/7559089440901545999">flutter-åˆ‡æ¢çŠ¶æ€æ˜¾ç¤ºä¸åŒç»„ä»¶10ç§å®ç°æ–¹æ¡ˆå…¨è§£æ</a></li>
<li><a href="https://juejin.cn/post/7555079970491318308" target="_blank" title="https://juejin.cn/post/7555079970491318308">flutter-è¯¦è§£æ§åˆ¶ç»„ä»¶æ˜¾ç¤ºçš„ä¸¤ç§æ–¹å¼Offstageä¸Visibility</a></li>
<li><a href="https://juejin.cn/post/7535358416182788122" target="_blank" title="https://juejin.cn/post/7535358416182788122">flutter-ä½¿ç”¨AnimatedDefaultTextStyleå®ç°æ–‡æœ¬åŠ¨ç”»</a></li>
<li><a href="https://juejin.cn/post/7537339432291434496" target="_blank" title="https://juejin.cn/post/7537339432291434496">flutter-ä½¿ç”¨SafeAreaç»„ä»¶å¤„ç†å„æœºå‹çš„å®‰å…¨è·ç¦»</a></li>
<li><a href="https://juejin.cn/spost/7537593417099149321" target="_blank" title="https://juejin.cn/spost/7537593417099149321">flutter-å®ç°æ¸å˜è‰²è¾¹æ¡†èƒŒæ™¯ä»¥åŠæ¸å˜è‰²æ–‡å­—</a></li>
<li><a href="https://juejin.cn/post/7543474419240370185" target="_blank" title="https://juejin.cn/post/7543474419240370185">flutter-ä½¿ç”¨confettiåˆ¶ä½œç‚«é…·çº¸å±‘çˆ†ç‚¸ç²’å­åŠ¨ç”»</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æŸå›¢äº’è”ç½‘å¤§å‚çš„ç½‘ç»œåè®®ä¸æ•°æ®ä¼ è¾“]]></title>    <link>https://juejin.cn/post/7570975737634275369</link>    <guid>https://juejin.cn/post/7570975737634275369</guid>    <pubDate>2025-11-11T00:41:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570975737634275369" data-draft-id="7570903763722043402" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æŸå›¢äº’è”ç½‘å¤§å‚çš„ç½‘ç»œåè®®ä¸æ•°æ®ä¼ è¾“"/> <meta itemprop="keywords" content="åç«¯,é¢è¯•,æ¶æ„"/> <meta itemprop="datePublished" content="2025-11-11T00:41:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="360_go_php"/> <meta itemprop="url" content="https://juejin.cn/user/2436173498956695"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æŸå›¢äº’è”ç½‘å¤§å‚çš„ç½‘ç»œåè®®ä¸æ•°æ®ä¼ è¾“
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2436173498956695/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    360_go_php
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T00:41:31.000Z" title="Tue Nov 11 2025 00:41:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>â€‹</p>
<p>éšç€äº’è”ç½‘çš„å‘å±•ï¼Œç½‘ç»œåè®®çš„å¤æ‚æ€§ä¸é‡è¦æ€§æ—¥ç›Šæå‡ã€‚äº’è”ç½‘å¤§å‚ï¼Œå°¤å…¶æ˜¯å¦‚æŸå›¢è¿™æ ·çš„äº’è”ç½‘å…¬å¸ï¼Œä¾èµ–äºé«˜æ•ˆã€ç¨³å®šã€å®‰å…¨çš„æ•°æ®ä¼ è¾“æœºåˆ¶æ¥ç¡®ä¿ç”¨æˆ·ä½“éªŒå’Œä¸šåŠ¡ç¨³å®šã€‚æœ¬æ–‡å°†ç®€è¦ä»‹ç»ä¸€äº›ç½‘ç»œåè®®ç›¸å…³çš„æ¦‚å¿µå’ŒæŠ€æœ¯ï¼Œä»¥åŠå®ƒä»¬åœ¨ç°ä»£äº’è”ç½‘æ¶æ„ä¸­çš„åº”ç”¨ã€‚<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/464ad972ff2e49898272275111aea0b1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763426491&amp;x-signature=HguZq4HcjLqgXH1%2FYQYq4t28aTc%3D" alt="" loading="lazy"/><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>â€‹ç¼–è¾‘</p>
<hr/>
<h4 data-id="heading-0">1. <strong>ä¸‰æ¬¡æ¡æ‰‹ï¼ˆTCPè¿æ¥å»ºç«‹è¿‡ç¨‹ï¼‰</strong><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e936389df78a417b907a77e92b8f0347~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763426491&amp;x-signature=Djj%2FDvMQaeDdmXszriONVEuoH7Q%3D" alt="" loading="lazy"/><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>â€‹ç¼–è¾‘</h4>
<p>ä¸‰æ¬¡æ¡æ‰‹ï¼ˆThree-Way Handshakeï¼‰æ˜¯å»ºç«‹TCPè¿æ¥çš„è¿‡ç¨‹ã€‚åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ï¼Œå¿…é¡»é€šè¿‡ä¸‰æ¬¡äº¤æ¢æ•°æ®æ¥ç¡®ä¿åŒæ–¹éƒ½èƒ½å¤Ÿæ¥æ”¶å’Œå‘é€æ•°æ®ã€‚å…·ä½“è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li><strong>ç¬¬ä¸€æ¬¡æ¡æ‰‹</strong>ï¼šå®¢æˆ·ç«¯å‘é€ä¸€ä¸ªSYNï¼ˆåŒæ­¥ï¼‰è¯·æ±‚åŒ…åˆ°æœåŠ¡å™¨ï¼Œè¡¨ç¤ºè¯·æ±‚å»ºç«‹è¿æ¥ã€‚</li>
<li><strong>ç¬¬äºŒæ¬¡æ¡æ‰‹</strong>ï¼šæœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯çš„SYNè¯·æ±‚åï¼Œå›å¤ä¸€ä¸ªSYN-ACKåŒ…ï¼Œè¡¨ç¤ºåŒæ„å»ºç«‹è¿æ¥ã€‚</li>
<li><strong>ç¬¬ä¸‰æ¬¡æ¡æ‰‹</strong>ï¼šå®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„SYN-ACKåŒ…åï¼Œå†å‘é€ä¸€ä¸ªACKï¼ˆç¡®è®¤ï¼‰åŒ…ï¼Œè¡¨ç¤ºè¿æ¥æˆåŠŸå»ºç«‹ã€‚</li>
</ul>
<p>é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹ï¼ŒåŒæ–¹ç¡®è®¤äº†å½¼æ­¤çš„æ¥æ”¶èƒ½åŠ›ï¼Œç¡®ä¿è¿æ¥çš„å¯é æ€§ã€‚</p>
<h4 data-id="heading-1">2. <strong>å››æ¬¡æŒ¥æ‰‹ï¼ˆTCPè¿æ¥æ–­å¼€è¿‡ç¨‹ï¼‰</strong></h4>
<p>å››æ¬¡æŒ¥æ‰‹ï¼ˆFour-Way Handshakeï¼‰æ˜¯æ–­å¼€TCPè¿æ¥çš„è¿‡ç¨‹ã€‚åœ¨TCPè¿æ¥å…³é—­æ—¶ï¼ŒåŒæ–¹éœ€è¦è¿›è¡Œå››æ¬¡æ•°æ®äº¤æ¢ï¼š</p>
<ul>
<li><strong>ç¬¬ä¸€æ¬¡æŒ¥æ‰‹</strong>ï¼šå®¢æˆ·ç«¯å‘é€ä¸€ä¸ªFINï¼ˆç»“æŸï¼‰åŒ…ï¼Œè¡¨ç¤ºå¸Œæœ›æ–­å¼€è¿æ¥ã€‚</li>
<li><strong>ç¬¬äºŒæ¬¡æŒ¥æ‰‹</strong>ï¼šæœåŠ¡å™¨æ”¶åˆ°FINåŒ…åï¼Œå›å¤ä¸€ä¸ªACKåŒ…ï¼Œç¡®è®¤æ¥æ”¶åˆ°æ–­å¼€è¯·æ±‚ã€‚</li>
<li><strong>ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹</strong>ï¼šæœåŠ¡å™¨å‘é€ä¸€ä¸ªFINåŒ…ï¼Œè¡¨ç¤ºæœåŠ¡å™¨ä¹Ÿå‡†å¤‡å¥½å…³é—­è¿æ¥ã€‚</li>
<li><strong>ç¬¬å››æ¬¡æŒ¥æ‰‹</strong>ï¼šå®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„FINåŒ…åï¼Œå›å¤ä¸€ä¸ªACKåŒ…ï¼Œè¿æ¥æ­£å¼å…³é—­ã€‚</li>
</ul>
<p>å››æ¬¡æŒ¥æ‰‹ç¡®ä¿äº†è¿æ¥çš„åŒæ–¹éƒ½èƒ½å¤Ÿæ­£å¸¸å…³é—­è¿æ¥ï¼Œé¿å…æ•°æ®ä¸¢å¤±ã€‚</p>
<h4 data-id="heading-2">3. <strong>æ»‘åŠ¨çª—å£ä¸æ‹¥å¡æ§åˆ¶</strong><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a741938f7e847f8b331fd810720da45~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763426491&amp;x-signature=yHm8BOC%2FCmBMzSoxjWXk81BAZyQ%3D" alt="" loading="lazy"/><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>â€‹ç¼–è¾‘</h4>
<p>TCPåè®®èƒ½å¤Ÿä¿è¯æ•°æ®ä¼ è¾“çš„å¯é æ€§ï¼Œä¸»è¦é€šè¿‡æ»‘åŠ¨çª—å£å’Œæ‹¥å¡æ§åˆ¶æœºåˆ¶ã€‚<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1282b7162121441c9899a6c9c8be0d94~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763426491&amp;x-signature=NaRjaQSfJv7Ie5AKUWK30oMXPDA%3D" alt="" loading="lazy"/><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>â€‹ç¼–è¾‘</p>
<ul>
<li><strong>æ»‘åŠ¨çª—å£</strong>ï¼šTCPä½¿ç”¨æ»‘åŠ¨çª—å£æœºåˆ¶æ¥æ§åˆ¶æ•°æ®æµçš„é€Ÿç‡ã€‚çª—å£çš„å¤§å°ä¼šæ ¹æ®ç½‘ç»œçš„æƒ…å†µåŠ¨æ€è°ƒæ•´ï¼Œç¡®ä¿å‘é€æ–¹ä¸ä¼šå› ä¸ºå‘é€è¿‡å¿«è€Œè®©æ¥æ”¶æ–¹çš„ç¼“å†²åŒºæº¢å‡ºã€‚</li>
<li><strong>æ‹¥å¡æ§åˆ¶</strong>ï¼šTCPåè®®é€šè¿‡æ§åˆ¶å‘é€é€Ÿç‡æ¥é¿å…ç½‘ç»œæ‹¥å¡ï¼Œé¿å…å› ç½‘ç»œé˜»å¡å¯¼è‡´çš„æ•°æ®ä¸¢å¤±ã€‚ä¸»è¦çš„æ‹¥å¡æ§åˆ¶ç®—æ³•åŒ…æ‹¬æ…¢å¯åŠ¨ã€æ‹¥å¡é¿å…ã€å¿«é‡ä¼ å’Œå¿«æ¢å¤ç­‰ã€‚<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/34150f4bef0d41c1afc594f0cc302bed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763426491&amp;x-signature=Dc5HK7%2FQ9l5fibPvhTIXMb7HjdU%3D" alt="" loading="lazy"/><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>â€‹ç¼–è¾‘</li>
</ul>
<p>é€šè¿‡è¿™ä¸¤è€…çš„é…åˆï¼ŒTCPèƒ½å¤Ÿå®ç°å¯é çš„ä¼ è¾“ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤±å’Œç½‘ç»œæ‹¥å¡ã€‚</p>
<h4 data-id="heading-3">4. <strong>ä¸ƒå±‚æ¨¡å‹ï¼ˆOSIæ¨¡å‹ï¼‰</strong></h4>
<p>OSIï¼ˆå¼€æ”¾ç³»ç»Ÿäº’è”ï¼‰æ¨¡å‹æ˜¯ä¸€ä¸ªæ ‡å‡†åŒ–çš„ç½‘ç»œåè®®æ¨¡å‹ï¼Œå°†ç½‘ç»œé€šä¿¡è¿‡ç¨‹åˆ†ä¸ºä¸ƒä¸ªå±‚æ¬¡ï¼š</p>
<ol>
<li><strong>ç‰©ç†å±‚</strong>ï¼šè´Ÿè´£ç¡¬ä»¶è®¾å¤‡çš„ä¼ è¾“ä»‹è´¨å’Œæ•°æ®ä¼ è¾“ã€‚</li>
<li><strong>æ•°æ®é“¾è·¯å±‚</strong>ï¼šé€šè¿‡MACåœ°å€æä¾›è®¾å¤‡é—´çš„é“¾è·¯æ§åˆ¶ã€‚</li>
<li><strong>ç½‘ç»œå±‚</strong>ï¼šè´Ÿè´£æ•°æ®åŒ…çš„è·¯ç”±é€‰æ‹©å’Œè½¬å‘ï¼ˆå¦‚IPåè®®ï¼‰ã€‚</li>
<li><strong>ä¼ è¾“å±‚</strong>ï¼šä¿è¯æ•°æ®çš„å¯é ä¼ è¾“ï¼ˆå¦‚TCP/UDPï¼‰ã€‚</li>
<li><strong>ä¼šè¯å±‚</strong>ï¼šå»ºç«‹å’Œç®¡ç†ä¼šè¯è¿æ¥ã€‚</li>
<li><strong>è¡¨ç¤ºå±‚</strong>ï¼šæ•°æ®çš„æ ¼å¼è½¬æ¢ã€åŠ å¯†ã€è§£å¯†ç­‰ã€‚</li>
<li><strong>åº”ç”¨å±‚</strong>ï¼šç›´æ¥ä¸ç”¨æˆ·äº¤äº’çš„åè®®ï¼ˆå¦‚HTTPã€FTPç­‰ï¼‰ã€‚</li>
</ol>
<h4 data-id="heading-4">5. <strong>HTTPå’ŒHTTPSçš„åŒºåˆ«</strong></h4>
<p>HTTPï¼ˆè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰å’ŒHTTPSï¼ˆå®‰å…¨è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰çš„ä¸»è¦åŒºåˆ«åœ¨äºå®‰å…¨æ€§ï¼š</p>
<ul>
<li><strong>HTTP</strong>ï¼šæ•°æ®ä¼ è¾“æ˜¯æ˜æ–‡çš„ï¼Œå®¹æ˜“è¢«çªƒå¬å’Œç¯¡æ”¹ã€‚</li>
<li><strong>HTTPS</strong>ï¼šåœ¨HTTPçš„åŸºç¡€ä¸Šï¼Œä½¿ç”¨SSL/TLSåè®®å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œç¡®ä¿æ•°æ®çš„ä¼ è¾“å®‰å…¨æ€§å’Œå®Œæ•´æ€§ã€‚</li>
</ul>
<p>å› æ­¤ï¼ŒHTTPSé€‚ç”¨äºéœ€è¦ä¿è¯æ•°æ®å®‰å…¨æ€§çš„ç½‘ç«™ï¼Œå¦‚ç½‘é“¶ã€ç”µå­å•†åŠ¡ç­‰ã€‚</p>
<h4 data-id="heading-5">6. <strong>GETå’ŒPOSTçš„åŒºåˆ«</strong></h4>
<ul>
<li><strong>GET</strong>ï¼šé€šè¿‡URLä¼ é€’æ•°æ®ï¼Œæ•°æ®ä¼šæš´éœ²åœ¨æµè§ˆå™¨åœ°å€æ ä¸­ï¼Œé€‚ç”¨äºè·å–æ•°æ®ï¼Œä¸ä¼šæœ‰å‰¯ä½œç”¨ã€‚GETè¯·æ±‚çš„é•¿åº¦æœ‰é™åˆ¶ï¼Œé€šå¸¸ç”¨äºæŸ¥è¯¢æ“ä½œã€‚</li>
<li><strong>POST</strong>ï¼šé€šè¿‡è¯·æ±‚ä½“ä¼ é€’æ•°æ®ï¼Œæ•°æ®ä¸ä¼šæš´éœ²åœ¨URLä¸­ï¼Œé€‚ç”¨äºå‘é€æ•°æ®ï¼Œå¯èƒ½ä¼šå¼•å‘å‰¯ä½œç”¨ï¼Œå¦‚æäº¤è¡¨å•ã€‚POSTæ²¡æœ‰é•¿åº¦é™åˆ¶ï¼Œé€šå¸¸ç”¨äºæäº¤æ•°æ®ã€‚</li>
</ul>
<h4 data-id="heading-6">7. <strong>ä¸€æ¬¡URLè¯·æ±‚çš„è¿‡ç¨‹</strong></h4>
<p>ä¸€æ¬¡URLè¯·æ±‚çš„è¿‡ç¨‹æ¶‰åŠå¤šä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li><strong>DNSè§£æ</strong>ï¼šæµè§ˆå™¨å‘DNSæœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œè§£æURLä¸­çš„åŸŸåï¼Œå¾—åˆ°IPåœ°å€ã€‚</li>
<li><strong>å»ºç«‹TCPè¿æ¥</strong>ï¼šé€šè¿‡ä¸‰æ¬¡æ¡æ‰‹ï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥ã€‚</li>
<li><strong>å‘é€HTTPè¯·æ±‚</strong>ï¼šå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€HTTPè¯·æ±‚ï¼ŒåŒ…å«è¯·æ±‚çš„èµ„æºè·¯å¾„ã€å¤´éƒ¨ä¿¡æ¯ç­‰ã€‚</li>
<li><strong>æœåŠ¡å™¨å“åº”</strong>ï¼šæœåŠ¡å™¨æ ¹æ®è¯·æ±‚è¿”å›æ•°æ®ï¼Œé€šå¸¸æ˜¯HTMLã€å›¾ç‰‡æˆ–JSONç­‰æ ¼å¼ã€‚</li>
<li><strong>å…³é—­è¿æ¥</strong>ï¼šé€šè¿‡å››æ¬¡æŒ¥æ‰‹ï¼Œå…³é—­TCPè¿æ¥ã€‚</li>
</ol>
<h4 data-id="heading-7">8. <strong>Cookieå’ŒSessionçš„åŒºåˆ«åŠä½¿ç”¨</strong></h4>
<ul>
<li><strong>Cookie</strong>ï¼šå­˜å‚¨åœ¨å®¢æˆ·ç«¯æµè§ˆå™¨ä¸­çš„å°æ•°æ®å—ï¼Œå¯ä»¥ä¿å­˜ç”¨æˆ·çš„çŠ¶æ€ä¿¡æ¯ï¼Œå¦‚ç™»å½•çŠ¶æ€ã€‚æ¯æ¬¡è¯·æ±‚æ—¶éƒ½ä¼šéšåŒå‘é€ã€‚</li>
<li><strong>Session</strong>ï¼šå­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯çš„ç”¨æˆ·ä¼šè¯ä¿¡æ¯ï¼Œé€šè¿‡Session IDä¸å®¢æˆ·ç«¯å…³è”ã€‚Sessionæ›´å®‰å…¨ï¼Œé€šå¸¸ç”¨äºä¿å­˜æ•æ„Ÿæ•°æ®ã€‚</li>
</ul>
<h4 data-id="heading-8">9. <strong>HTTPSå®ç°è¿‡ç¨‹</strong></h4>
<p>HTTPSçš„å®ç°è¿‡ç¨‹ä¸»è¦é€šè¿‡SSL/TLSåè®®æ¥åŠ å¯†å’ŒéªŒè¯æ•°æ®ï¼š</p>
<ol>
<li>å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šè¯·æ±‚æœåŠ¡å™¨çš„SSLè¯ä¹¦ã€‚</li>
<li>æœåŠ¡å™¨é€šè¿‡è¯ä¹¦å‘å®¢æˆ·ç«¯æä¾›å…¬é’¥ï¼Œå®¢æˆ·ç«¯ä½¿ç”¨å…¬é’¥åŠ å¯†å¯¹ç§°å¯†é’¥å¹¶å‘é€ç»™æœåŠ¡å™¨ã€‚</li>
<li>æœåŠ¡å™¨ä½¿ç”¨ç§é’¥è§£å¯†å¯¹ç§°å¯†é’¥ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä½¿ç”¨å¯¹ç§°åŠ å¯†æ¥åŠ å¯†åç»­çš„æ•°æ®ä¼ è¾“ã€‚</li>
</ol>
<h4 data-id="heading-9">10. <strong>å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†</strong></h4>
<ul>
<li><strong>å¯¹ç§°åŠ å¯†</strong>ï¼šåŠ å¯†å’Œè§£å¯†ä½¿ç”¨ç›¸åŒçš„å¯†é’¥ã€‚ä¼˜ç‚¹æ˜¯é€Ÿåº¦å¿«ï¼Œç¼ºç‚¹æ˜¯å¯†é’¥åˆ†é…å­˜åœ¨é£é™©ã€‚</li>
<li><strong>éå¯¹ç§°åŠ å¯†</strong>ï¼šä½¿ç”¨å…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯†ã€‚ä¼˜ç‚¹æ˜¯å®‰å…¨æ€§é«˜ï¼Œä½†åŠ å¯†è§£å¯†é€Ÿåº¦è¾ƒæ…¢ã€‚</li>
</ul>
<h4 data-id="heading-10">11. <strong>TCPå’ŒUDPçš„åŒºåˆ«</strong></h4>
<ul>
<li><strong>TCP</strong>ï¼šé¢å‘è¿æ¥çš„åè®®ï¼Œä¿è¯æ•°æ®å¯é æ€§ï¼Œç¡®ä¿æ•°æ®æŒ‰é¡ºåºåˆ°è¾¾ã€‚é€‚ç”¨äºå¯¹å¯é æ€§è¦æ±‚é«˜çš„åº”ç”¨ï¼ˆå¦‚ç½‘é¡µæµè§ˆã€æ–‡ä»¶ä¼ è¾“ï¼‰ã€‚</li>
<li><strong>UDP</strong>ï¼šæ— è¿æ¥çš„åè®®ï¼Œä¸ä¿è¯æ•°æ®å¯é æ€§ï¼Œé€‚ç”¨äºå¯¹é€Ÿåº¦è¦æ±‚é«˜ä¸”å¯ä»¥å®¹å¿ä¸¢åŒ…çš„åº”ç”¨ï¼ˆå¦‚è§†é¢‘æµã€åœ¨çº¿æ¸¸æˆï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-11">12. <strong>DNSè§£æè¿‡ç¨‹</strong></h4>
<p>DNSè§£æè¿‡ç¨‹åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li><strong>æµè§ˆå™¨æŸ¥è¯¢æœ¬åœ°DNSç¼“å­˜</strong>ï¼šé¦–å…ˆæ£€æŸ¥æœ¬åœ°æ˜¯å¦å·²æœ‰è¯¥åŸŸåçš„è§£æç»“æœã€‚</li>
<li><strong>æŸ¥è¯¢DNSæœåŠ¡å™¨</strong>ï¼šå¦‚æœæ²¡æœ‰ç¼“å­˜ï¼Œæµè§ˆå™¨ä¼šå‘é…ç½®çš„DNSæœåŠ¡å™¨å‘é€è¯·æ±‚ã€‚</li>
<li><strong>é€’å½’æŸ¥è¯¢</strong>ï¼šDNSæœåŠ¡å™¨å¯èƒ½ä¼šè½¬å‘è¯·æ±‚åˆ°å…¶ä»–DNSæœåŠ¡å™¨ï¼Œç›´åˆ°æ‰¾åˆ°æƒå¨DNSæœåŠ¡å™¨ã€‚</li>
<li><strong>è¿”å›IPåœ°å€</strong>ï¼šæƒå¨DNSæœåŠ¡å™¨è¿”å›åŸŸåå¯¹åº”çš„IPåœ°å€ï¼Œæµè§ˆå™¨ä½¿ç”¨è¯¥IPåœ°å€ä¸ç›®æ ‡æœåŠ¡å™¨å»ºç«‹è¿æ¥ã€‚</li>
</ol>
<hr/>
<p>é€šè¿‡ç†è§£è¿™äº›ç½‘ç»œåè®®ä¸æ•°æ®ä¼ è¾“æœºåˆ¶ï¼ŒæŸå›¢äº’è”ç½‘å¤§å‚èƒ½å¤Ÿç¡®ä¿å…¶å¹³å°çš„é«˜æ•ˆæ€§ã€å®‰å…¨æ€§ä»¥åŠç”¨æˆ·ä½“éªŒã€‚è¿™äº›æŠ€æœ¯ä¸ä»…åœ¨æ—¥å¸¸çš„æ•°æ®äº¤äº’ä¸­è‡³å…³é‡è¦ï¼Œè€Œä¸”ä¸ºæ„å»ºç°ä»£äº’è”ç½‘æ¶æ„æä¾›äº†åšå®çš„åŸºç¡€ã€‚</p>
<p>â€‹</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C#.NET å¼€å‘å¿…å¤‡ï¼šå¸¸ç”¨ç‰¹æ€§ä¸æ³¨è§£ç”¨æ³•å¤§å…¨]]></title>    <link>https://juejin.cn/post/7570935965436297231</link>    <guid>https://juejin.cn/post/7570935965436297231</guid>    <pubDate>2025-11-11T00:43:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570935965436297231" data-draft-id="7570940025581617192" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C#.NET å¼€å‘å¿…å¤‡ï¼šå¸¸ç”¨ç‰¹æ€§ä¸æ³¨è§£ç”¨æ³•å¤§å…¨"/> <meta itemprop="keywords" content="C#,.NET"/> <meta itemprop="datePublished" content="2025-11-11T00:43:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å”é’æ«"/> <meta itemprop="url" content="https://juejin.cn/user/3737995266234280"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C#.NET å¼€å‘å¿…å¤‡ï¼šå¸¸ç”¨ç‰¹æ€§ä¸æ³¨è§£ç”¨æ³•å¤§å…¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3737995266234280/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å”é’æ«
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T00:43:13.000Z" title="Tue Nov 11 2025 00:43:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">ç‰¹æ€§åŸºç¡€</h3>
<h4 data-id="heading-1">ä»€ä¹ˆæ˜¯ç‰¹æ€§</h4>
<p>ç‰¹æ€§æ˜¯é™„åŠ åˆ°ä»£ç å…ƒç´ ï¼ˆç¨‹åºé›†ã€ç±»å‹ã€æˆå‘˜ã€å‚æ•°ç­‰ï¼‰ä¸Šçš„å…ƒæ•°æ®ã€‚ç¼–è¯‘åå†™å…¥ ILï¼Œå¯åœ¨è¿è¡Œæ—¶é€šè¿‡åå°„è¯»å–æˆ–ç”±è¿è¡Œæ—¶/æ¡†æ¶è¯†åˆ«å¹¶åšç›¸åº”å¤„ç†ã€‚</p>
<h4 data-id="heading-2">å®šä¹‰ç‰¹æ€§</h4>
<p>è‡ªå®šä¹‰ç‰¹æ€§éœ€ç»§æ‰¿è‡ª <code>System.Attribute</code>ï¼Œå¹¶å¯é€šè¿‡ <code>AttributeUsage</code> é™åˆ¶å…¶ä½œç”¨ç›®æ ‡å’Œå…è®¸å¤šé‡ä½¿ç”¨ã€‚</p>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">AttributeUsage(AttributeTargets.Class | AttributeTargets.Method, AllowMultiple = false, Inherited = true)</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MyCustomAttribute</span> : <span class="hljs-title">Attribute</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Name { <span class="hljs-keyword">get</span>; }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MyCustomAttribute</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> name</span>)</span> =&gt; Name = name;
}
</code></pre>
<h3 data-id="heading-3">CLR å†…ç½®é€šç”¨ç‰¹æ€§</h3>


















































<table><thead><tr><th>ç‰¹æ€§</th><th>ä½œç”¨</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>[Obsolete]</code></td><td>æ ‡è®°å·²åºŸå¼ƒçš„ APIï¼Œè°ƒç”¨æ—¶æŠ¥ç¼–è¯‘è­¦å‘Šæˆ–é”™è¯¯</td><td><code>[Obsolete("Use NewMethod instead", true)] public void Old() { }</code></td></tr><tr><td><code>[Serializable]</code></td><td>æ ‡è®°å¯é€šè¿‡äºŒè¿›åˆ¶/SOAP åºåˆ—åŒ–</td><td><code>[Serializable] public class Person { ... }</code></td></tr><tr><td><code>[NonSerialized]</code></td><td>ä¸ <code>[Serializable]</code> é…åˆä½¿ç”¨ï¼Œæ ‡è®°å­—æ®µä¸å‚ä¸åºåˆ—åŒ–</td><td><code>[NonSerialized] private int _tempCache;</code></td></tr><tr><td><code>[DebuggerStepThrough]</code></td><td>è°ƒè¯•æ—¶è·³è¿‡è¯¥æ–¹æ³•æˆ–ç±»ï¼Œä¸å•æ­¥è¿›å…¥</td><td><code>[DebuggerStepThrough] void Helper() { ... }</code></td></tr><tr><td><code>[DebuggerDisplay]</code></td><td>è‡ªå®šä¹‰è°ƒè¯•å™¨ä¸­æ˜¾ç¤ºçš„ä¿¡æ¯</td><td><code>[DebuggerDisplay("{Id} - {Name}")] public class User { ... }</code></td></tr><tr><td><code>[CallerMemberName]</code></td><td>å‚æ•°è£…é¥°ï¼Œè·å–è°ƒç”¨è€…çš„æ–¹æ³•å</td><td><code>void Log([CallerMemberName] string caller = null) { ... }</code></td></tr><tr><td><code>[CallerFilePath]</code></td><td>è·å–è°ƒç”¨è€…æºæ–‡ä»¶è·¯å¾„</td><td>åŒä¸Š</td></tr><tr><td><code>[CallerLineNumber]</code></td><td>è·å–è°ƒç”¨è€…è¡Œå·</td><td>åŒä¸Š</td></tr></tbody></table>
<h3 data-id="heading-4">æ•°æ®ç»‘å®šä¸éªŒè¯ï¼ˆData Annotationsï¼‰</h3>
<p>ä½äº <code>System.ComponentModel.DataAnnotations</code>ï¼Œå¸¸ç”¨äº <code>ASP.NET MVC / EF Core / Blazor</code> ç­‰æ¡†æ¶ï¼š</p>


















































<table><thead><tr><th>ç‰¹æ€§</th><th>ä½œç”¨</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>[Required]</code></td><td>å±æ€§ä¸èƒ½ä¸ºç©º</td><td><code>[Required] public string Name { get; set; }</code></td></tr><tr><td><code>[StringLength]</code></td><td>é™åˆ¶å­—ç¬¦ä¸²æœ€å¤§/æœ€å°é•¿åº¦</td><td><code>[StringLength(100, MinimumLength = 5)]</code></td></tr><tr><td><code>[Range]</code></td><td>æ•°å€¼æˆ–æ—¥æœŸèŒƒå›´éªŒè¯</td><td><code>[Range(1, 100)] public int Age { get; set; }</code></td></tr><tr><td><code>[RegularExpression]</code></td><td>æ­£åˆ™è¡¨è¾¾å¼æ ¡éªŒ</td><td><code>[RegularExpression(@"^\d{3}-\d{4}$")] public string Phone;</code></td></tr><tr><td><code>[EmailAddress]</code></td><td>ç”µå­é‚®ä»¶æ ¼å¼éªŒè¯</td><td><code>[EmailAddress] public string Email { get; set; }</code></td></tr><tr><td><code>[Key]</code></td><td>æ ‡è®°å®ä½“ä¸»é”®ï¼ˆEF Coreï¼‰</td><td><code>[Key] public int Id { get; set; }</code></td></tr><tr><td><code>[Timestamp]</code></td><td>å¹¶å‘æ£€æŸ¥ï¼ˆè¡Œç‰ˆæœ¬å·ï¼‰</td><td><code>[Timestamp] public byte[] RowVersion { get; set; }</code></td></tr><tr><td><code>[Display(Name="...")]</code></td><td>æŒ‡å®šæ˜¾ç¤ºåç§°</td><td><code>[Display(Name="ç”¨æˆ·å")] public string UserName { get; set; }</code></td></tr></tbody></table>
<h3 data-id="heading-5">åºåˆ—åŒ–ä¸ Web API</h3>
<h4 data-id="heading-6">JSON.NET / System.Text.Json</h4>

























<table><thead><tr><th>ç‰¹æ€§</th><th>ä½œç”¨</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>[JsonIgnore]</code></td><td>å¿½ç•¥å±æ€§åºåˆ—åŒ–</td><td><code>[JsonIgnore] public string InternalNote { get; set; }</code></td></tr><tr><td><code>[JsonProperty("name")]</code></td><td>æŒ‡å®š JSON å­—æ®µåç§°ï¼ˆNewtonsoftï¼‰</td><td><code>[JsonProperty("user_name")] public string Name { get; set; }</code></td></tr><tr><td><code>[JsonPropertyName("name")]</code></td><td>æŒ‡å®š JSON å­—æ®µåç§°ï¼ˆSystem.Text.Jsonï¼‰</td><td><code>[JsonPropertyName("user_name")] public string Name { get; set; }</code></td></tr></tbody></table>
<h4 data-id="heading-7">XML åºåˆ—åŒ–</h4>





















<table><thead><tr><th>ç‰¹æ€§</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><code>[XmlElement("Name")]</code></td><td>æŒ‡å®šå…ƒç´ å</td></tr><tr><td><code>[XmlAttribute]</code></td><td>åºåˆ—åŒ–ä¸º XML å±æ€§</td></tr><tr><td><code>[XmlIgnore]</code></td><td>å¿½ç•¥å­—æ®µ</td></tr></tbody></table>
<h3 data-id="heading-8">ä¾èµ–æ³¨å…¥ä¸æ¡†æ¶é›†æˆ</h3>
<h4 data-id="heading-9">ASP.NET Core</h4>





























<table><thead><tr><th>ç‰¹æ€§</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><code>[ApiController]</code></td><td>å¯ç”¨è‡ªåŠ¨å‚æ•°ç»‘å®šã€400 å“åº”ç­‰ Web API ç‰¹æ€§</td></tr><tr><td><code>[Route("api/[controller]")]</code></td><td>å®šä¹‰æ§åˆ¶å™¨è·¯ç”±</td></tr><tr><td><code>[HttpGet]</code>, <code>[HttpPost]</code> ç­‰</td><td>æ ‡è®° Action æ”¯æŒçš„ HTTP åŠ¨è¯</td></tr><tr><td><code>[FromServices]</code></td><td>ä» DI å®¹å™¨ä¸­è§£æå‚æ•°</td></tr><tr><td><code>[FromQuery]</code>, <code>[FromBody]</code> ç­‰</td><td>æŒ‡å®šå‚æ•°ç»‘å®šæ¥æº</td></tr></tbody></table>
<h3 data-id="heading-10">çº¿ç¨‹ä¸å¹¶å‘</h3>





















<table><thead><tr><th>ç‰¹æ€§</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><code>[MethodImpl(MethodImplOptions.Synchronized)]</code></td><td>å°†æ–¹æ³•é”å®šä¸ºå•çº¿ç¨‹è®¿é—®</td></tr><tr><td><code>[ThreadStatic]</code></td><td>æ ‡è®°å­—æ®µä¸ºçº¿ç¨‹é™æ€ï¼Œæ¯çº¿ç¨‹ç‹¬ç«‹å®ä¾‹</td></tr><tr><td><code>[AsyncStateMachine]</code></td><td>ç¼–è¯‘å™¨ç”Ÿæˆï¼Œç”¨äºæ ‡è®° async æ–¹æ³•</td></tr></tbody></table>
<h3 data-id="heading-11">å¹³å°å…¼å®¹ä¸ç‰ˆæœ¬</h3>





















<table><thead><tr><th>ç‰¹æ€§</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><code>[SupportedOSPlatform]</code></td><td>æŒ‡ç¤º API åœ¨æŒ‡å®šå¹³å°å¯ç”¨ï¼ˆ.NET 5+ï¼‰</td></tr><tr><td><code>[UnsupportedOSPlatform]</code></td><td>æŒ‡ç¤º API åœ¨æŒ‡å®šå¹³å°ä¸å¯ç”¨</td></tr><tr><td><code>[ObsoletedOSPlatform]</code></td><td>æ ‡è®° API åœ¨å¹³å°ä¸Šçš„è¿‡æ—¶ç‰ˆæœ¬</td></tr></tbody></table>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">SupportedOSPlatform(<span class="hljs-string">"windows"</span>)</span>]
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">WindowsOnly</span>()</span> { â€¦ }
</code></pre>
<h3 data-id="heading-12">è‡ªå®šä¹‰ç‰¹æ€§</h3>
<ul>
<li>
<p>å®šä¹‰ï¼šç»§æ‰¿ <code>Attribute</code></p>
</li>
<li>
<p>é™åˆ¶ä½œç”¨ç›®æ ‡ï¼šä½¿ç”¨ <code>[AttributeUsage]</code></p>
</li>
<li>
<p>è¯»å–ï¼šé€šè¿‡åå°„è·å– <code>MemberInfo.GetCustomAttributes&lt;T&gt;()</code></p>
</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">AttributeUsage(AttributeTargets.Method, AllowMultiple = true)</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">AuditAttribute</span> : <span class="hljs-title">Attribute</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Operation { <span class="hljs-keyword">get</span>; }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">AuditAttribute</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> operation</span>)</span> =&gt; Operation = operation;
}

<span class="hljs-comment">// åœ¨æ–¹æ³•ä¸Šä½¿ç”¨</span>
[<span class="hljs-meta">Audit(<span class="hljs-string">"Create"</span>), Audit(<span class="hljs-string">"Validate"</span>)</span>]
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">CreateUser</span>()</span> { â€¦ }
</code></pre>
<h3 data-id="heading-13">ä¼˜ç¼ºç‚¹</h3>
<p>ä¼˜ç‚¹</p>
<ul>
<li>
<p>å£°æ˜å¼ç¼–ç¨‹ï¼šç®€åŒ–é…ç½®ï¼Œä»£ç æ›´æ¸…æ™°ã€‚</p>
</li>
<li>
<p>æ¡†æ¶é›†æˆï¼šä¸ <code>ASP.NET Core</code>ã€<code>EF Core</code> ç­‰æ— ç¼åä½œã€‚</p>
</li>
<li>
<p>å¯æ‰©å±•æ€§ï¼šæ”¯æŒè‡ªå®šä¹‰ç‰¹æ€§ï¼Œæ‰©å±•åŠŸèƒ½ã€‚</p>
</li>
<li>
<p>è·¨åœºæ™¯æ”¯æŒï¼šé€‚ç”¨ <code>Web</code>ã€æ•°æ®åº“ã€æµ‹è¯•ç­‰ã€‚</p>
</li>
</ul>
<p>ç¼ºç‚¹</p>
<ul>
<li>
<p>åå°„æ€§èƒ½ï¼šè‡ªå®šä¹‰ç‰¹æ€§ä½¿ç”¨åå°„å¯èƒ½å½±å“æ€§èƒ½ã€‚</p>
</li>
<li>
<p>é…ç½®å¤æ‚ï¼šå¤§é‡ç‰¹æ€§å¯èƒ½å¯¼è‡´ä»£ç éš¾ä»¥ç»´æŠ¤ã€‚</p>
</li>
<li>
<p>è°ƒè¯•éš¾åº¦ï¼šç‰¹æ€§è¡Œä¸ºéœ€é€šè¿‡åå°„æˆ–æ—¥å¿—è°ƒè¯•ã€‚</p>
</li>
<li>
<p>ä¾èµ–æ¡†æ¶ï¼šéƒ¨åˆ†ç‰¹æ€§ï¼ˆå¦‚ <code>[Route]</code>ï¼‰ç‰¹å®šäºæ¡†æ¶ã€‚</p>
</li>
</ul>
<h3 data-id="heading-14">ä½¿ç”¨åœºæ™¯</h3>
<ul>
<li>
<p><code>Web API</code>ï¼š</p>
<ul>
<li>
<p>ä½¿ç”¨ <code>[Route]ã€[HttpGet]</code> ç­‰å®šä¹‰ <code>RESTful</code> ç«¯ç‚¹ã€‚</p>
</li>
<li>
<p>ç¤ºä¾‹ï¼šç”¨æˆ·ç®¡ç† <code>API</code>ã€‚</p>
</li>
</ul>
</li>
<li>
<p>æ•°æ®åº“æ˜ å°„ï¼š</p>
<ul>
<li>
<p>ä½¿ç”¨ <code>[Key]ã€[Required]</code> é…ç½® <code>EF Core</code> æ¨¡å‹ã€‚</p>
</li>
<li>
<p>ç¤ºä¾‹ï¼šæ‰¹æ¬¡è¡¨å¤´å’Œæ˜ç»†è¡¨ã€‚</p>
</li>
</ul>
</li>
<li>
<p>æ¨¡å‹éªŒè¯ï¼š</p>
<ul>
<li>
<p>ä½¿ç”¨ <code>[Required]ã€[StringLength]</code> éªŒè¯è¾“å…¥ã€‚</p>
</li>
<li>
<p>ç¤ºä¾‹ï¼šå¯¼å…¥æ•°æ®éªŒè¯ã€‚</p>
</li>
</ul>
</li>
<li>
<p>å®‰å…¨æ§åˆ¶ï¼š</p>
<ul>
<li>
<p>ä½¿ç”¨ <code>[Authorize]ã€[ValidateAntiForgeryToken]</code> ä¿æŠ¤ç«¯ç‚¹ã€‚</p>
</li>
<li>
<p>ç¤ºä¾‹ï¼šç®¡ç†å‘˜å¯¼å…¥æ¥å£ã€‚</p>
</li>
</ul>
</li>
<li>
<p>æ—¥å¿—å’Œç›‘æ§ï¼š</p>
<ul>
<li>
<p>ä½¿ç”¨è‡ªå®šä¹‰ç‰¹æ€§ï¼ˆå¦‚ <code>[LogExecutionTime]</code>ï¼‰è®°å½•æ€§èƒ½ã€‚</p>
</li>
<li>
<p>ç¤ºä¾‹ï¼šç›‘æ§å¯¼å…¥æ—¶é—´ã€‚</p>
</li>
</ul>
</li>
<li>
<p>æµ‹è¯•ï¼š</p>
<ul>
<li>
<p>ä½¿ç”¨ <code>[Test]ã€[Fact]</code> ç¼–å†™å•å…ƒæµ‹è¯•ã€‚</p>
</li>
<li>
<p>ç¤ºä¾‹ï¼šæµ‹è¯•å¯¼å…¥é€»è¾‘ã€‚</p>
</li>
</ul>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æŸå¤šå¤šé¢è¯•ç›¸å…³æ“ä½œç³»ç»Ÿã€åˆ†å¸ƒå¼äº‹åŠ¡ã€æ¶ˆæ¯é˜Ÿåˆ—åŠ Linux å†…å­˜å›æ”¶ç­–ç•¥]]></title>    <link>https://juejin.cn/post/7570923924365295679</link>    <guid>https://juejin.cn/post/7570923924365295679</guid>    <pubDate>2025-11-11T00:41:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570923924365295679" data-draft-id="7570897638440845339" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æŸå¤šå¤šé¢è¯•ç›¸å…³æ“ä½œç³»ç»Ÿã€åˆ†å¸ƒå¼äº‹åŠ¡ã€æ¶ˆæ¯é˜Ÿåˆ—åŠ Linux å†…å­˜å›æ”¶ç­–ç•¥"/> <meta itemprop="keywords" content="åç«¯,é¢è¯•,æ¶æ„"/> <meta itemprop="datePublished" content="2025-11-11T00:41:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="360_go_php"/> <meta itemprop="url" content="https://juejin.cn/user/2436173498956695"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æŸå¤šå¤šé¢è¯•ç›¸å…³æ“ä½œç³»ç»Ÿã€åˆ†å¸ƒå¼äº‹åŠ¡ã€æ¶ˆæ¯é˜Ÿåˆ—åŠ Linux å†…å­˜å›æ”¶ç­–ç•¥
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2436173498956695/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    360_go_php
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T00:41:51.000Z" title="Tue Nov 11 2025 00:41:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>â€‹</p>
<p>åœ¨ç”µå•†å¹³å°å¦‚æŸå¤šå¤šçš„ç³»ç»Ÿæ¶æ„ä¸­ï¼Œæ“ä½œç³»ç»Ÿã€åˆ†å¸ƒå¼äº‹åŠ¡ã€æ¶ˆæ¯é˜Ÿåˆ—å’Œ Linux å†…å­˜å›æ”¶ç­‰æŠ€æœ¯æ˜¯ä¿è¯ç³»ç»Ÿé«˜æ•ˆè¿è¡Œçš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚æœ¬æ–‡å°†å›´ç»•è¿™äº›æŠ€æœ¯çŸ¥è¯†ç‚¹è¿›è¡Œæ€»ç»“ï¼Œå¹¶å›ç­”ç›¸å…³çš„é¢è¯•é—®é¢˜ã€‚</p>
<hr/>
<h4 data-id="heading-0"><strong>æ“ä½œç³»ç»Ÿç›¸å…³é—®é¢˜</strong></h4>
<h5 data-id="heading-1">1. <strong>çº¿ç¨‹å’Œè¿›ç¨‹çš„åŒºåˆ«</strong><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f5bc64531c0a45229962d0bfc86f3e59~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763426510&amp;x-signature=DyhFK7PHcGGIEl4meDbQkK9GBbY%3D" alt="" loading="lazy"/><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>â€‹ç¼–è¾‘</h5>
<ul>
<li>
<p><strong>è¿›ç¨‹</strong>ï¼š<br/>
- æ˜¯æ“ä½œç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„åŸºæœ¬å•ä½ã€‚<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ffa30b9c6014675ac295880a6081bd8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763426510&amp;x-signature=rvG5vMRUZruKT5gxzzC8tOsZaH4%3D" alt="" loading="lazy"/><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>â€‹ç¼–è¾‘<br/>
- æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„åœ°å€ç©ºé—´ã€ä»£ç ã€æ•°æ®å’Œç³»ç»Ÿèµ„æºï¼ˆå¦‚æ–‡ä»¶æè¿°ç¬¦ï¼‰ã€‚<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c13a19efe99f41ce91204d8e61b44eeb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763426510&amp;x-signature=MyE7UrhlcgyD2vjA9xgaDBjJkKE%3D" alt="" loading="lazy"/><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>â€‹ç¼–è¾‘<br/>
- è¿›ç¨‹é—´çš„é€šä¿¡é€šå¸¸éœ€è¦é€šè¿‡ IPCï¼ˆè¿›ç¨‹é—´é€šä¿¡ï¼‰æœºåˆ¶ï¼ˆå¦‚ç®¡é“ã€å…±äº«å†…å­˜ã€æ¶ˆæ¯é˜Ÿåˆ—ï¼‰è¿›è¡Œã€‚</p>
</li>
<li>
<p><strong>çº¿ç¨‹</strong>ï¼š<br/>
- æ˜¯è¿›ç¨‹ä¸­çš„æ‰§è¡Œå•å…ƒï¼Œå¤šä¸ªçº¿ç¨‹å…±äº«åŒä¸€è¿›ç¨‹çš„åœ°å€ç©ºé—´ã€å †æ ˆç­‰èµ„æºã€‚<br/>
- çº¿ç¨‹é—´çš„é€šä¿¡æ¯”è¿›ç¨‹é—´é€šä¿¡æ›´é«˜æ•ˆï¼Œå› ä¸ºå®ƒä»¬å…±äº«åŒä¸€å†…å­˜ç©ºé—´ï¼Œä½†ä¹Ÿæ›´å®¹æ˜“å¼•å‘ç«äº‰æ¡ä»¶å’Œæ­»é”ã€‚<br/>
- çº¿ç¨‹é€šå¸¸ç”¨äºå¹¶å‘æ‰§è¡Œï¼Œå¯ä»¥æé«˜ç¨‹åºçš„å¹¶è¡Œåº¦ï¼Œç‰¹åˆ«é€‚ç”¨äº CPU å¯†é›†å‹æˆ– IO å¯†é›†å‹ä»»åŠ¡ã€‚</p>
</li>
</ul>
<p><strong>åŒºåˆ«</strong>ï¼š</p>
<ul>
<li><strong>èµ„æºéš”ç¦»</strong>ï¼šè¿›ç¨‹ä¹‹é—´å®Œå…¨ç‹¬ç«‹ï¼Œçº¿ç¨‹ä¹‹é—´å…±äº«åŒä¸€è¿›ç¨‹çš„å†…å­˜ç©ºé—´ã€‚<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/546c2cac483040a3a54f10d923568fef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763426510&amp;x-signature=p0Y2FypNP%2FJoGD98ErMe8WslaqE%3D" alt="" loading="lazy"/><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>â€‹ç¼–è¾‘</li>
<li><strong>åˆ›å»ºå’Œé”€æ¯</strong>ï¼šè¿›ç¨‹çš„åˆ›å»ºå’Œé”€æ¯æ¯”çº¿ç¨‹æ›´åŠ è€—è´¹èµ„æºï¼Œå› ä¸ºè¿›ç¨‹éœ€è¦åˆ†é…ç‹¬ç«‹çš„èµ„æºï¼›çº¿ç¨‹çš„åˆ›å»ºå’Œé”€æ¯å¼€é”€è¾ƒå°ã€‚</li>
<li><strong>é€šä¿¡æ–¹å¼</strong>ï¼šè¿›ç¨‹é—´é€šä¿¡è¾ƒä¸ºå¤æ‚ï¼Œéœ€è¦é€šè¿‡ IPCï¼›çº¿ç¨‹é—´é€šä¿¡ç›¸å¯¹ç®€å•ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡å…±äº«å†…å­˜æˆ–å…¶ä»–åŒæ­¥æœºåˆ¶è¿›è¡Œã€‚</li>
</ul>
<h5 data-id="heading-2">2. <strong>åˆ†æ®µå’Œåˆ†é¡µå†…å­˜ç®¡ç†</strong><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7dc80da6dc9e4c71a285b040fff574e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763426510&amp;x-signature=AOsr3x6UHhgFOPIYgHiiqX5NtVw%3D" alt="" loading="lazy"/><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>â€‹ç¼–è¾‘</h5>
<ul>
<li><strong>åˆ†æ®µç®¡ç†</strong>ï¼šå°†ç¨‹åºçš„å†…å­˜åˆ’åˆ†ä¸ºä¸åŒå¤§å°çš„æ®µï¼Œå¦‚ä»£ç æ®µã€æ•°æ®æ®µã€å †æ ˆæ®µç­‰ï¼Œæ¯ä¸ªæ®µéƒ½æœ‰è‡ªå·±çš„åŸºåœ°å€å’Œé•¿åº¦ã€‚åˆ†æ®µæä¾›äº†æ›´ä¸ºçµæ´»çš„å†…å­˜ç®¡ç†ï¼Œé€‚ç”¨äºåŠ¨æ€å˜åŒ–çš„ç¨‹åºã€‚<br/>
</li>
<li><strong>åˆ†é¡µç®¡ç†</strong>ï¼šå°†ç‰©ç†å†…å­˜å’Œé€»è¾‘å†…å­˜éƒ½åˆ†æˆå›ºå®šå¤§å°çš„å—ï¼ˆé¡µå’Œé¡µæ¡†ï¼‰ã€‚åˆ†é¡µæ¶ˆé™¤äº†å†…å­˜ç¢ç‰‡é—®é¢˜ï¼Œä½¿å¾—å†…å­˜çš„ç®¡ç†æ›´åŠ é«˜æ•ˆã€‚æ¯ä¸ªè¿›ç¨‹æ‹¥æœ‰ç‹¬ç«‹çš„é¡µè¡¨æ¥æ˜ å°„è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€ã€‚</li>
</ul>
<p><strong>åŒºåˆ«</strong>ï¼š</p>
<ul>
<li><strong>çµæ´»æ€§</strong>ï¼šåˆ†æ®µç®¡ç†å¯ä»¥å¤„ç†ä¸åŒå¤§å°çš„å†…å­˜å—ï¼Œè€Œåˆ†é¡µç®¡ç†åˆ™ä½¿ç”¨å›ºå®šå¤§å°çš„å†…å­˜å—ã€‚</li>
<li><strong>å†…å­˜ç¢ç‰‡</strong>ï¼šåˆ†é¡µç®¡ç†å¯ä»¥é¿å…å¤–éƒ¨ç¢ç‰‡ï¼Œä½†å¯èƒ½å­˜åœ¨å†…éƒ¨ç¢ç‰‡ï¼›åˆ†æ®µç®¡ç†åˆ™å¯ä»¥çµæ´»åœ°é¿å…å†…éƒ¨ç¢ç‰‡ï¼Œä½†å¯èƒ½å­˜åœ¨å¤–éƒ¨ç¢ç‰‡ã€‚</li>
</ul>
<h5 data-id="heading-3">3. <strong>ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„åŒºåˆ«</strong></h5>
<ul>
<li><strong>ç”¨æˆ·æ€</strong>ï¼šæŒ‡ç¨‹åºè¿è¡Œæ—¶ï¼Œç”¨æˆ·åº”ç”¨ç¨‹åºæ‰§è¡Œçš„çŠ¶æ€ã€‚åœ¨ç”¨æˆ·æ€ä¸‹ï¼Œç¨‹åºæ— æ³•ç›´æ¥è®¿é—®ç¡¬ä»¶èµ„æºå’Œæ ¸å¿ƒæ“ä½œç³»ç»ŸåŠŸèƒ½ï¼Œå¿…é¡»é€šè¿‡ç³»ç»Ÿè°ƒç”¨æ¥è¯·æ±‚å†…æ ¸æœåŠ¡ã€‚<br/>
</li>
<li><strong>å†…æ ¸æ€</strong>ï¼šæŒ‡æ“ä½œç³»ç»Ÿæ ¸å¿ƒéƒ¨åˆ†æ‰§è¡Œçš„çŠ¶æ€ï¼Œå…·æœ‰å®Œå…¨çš„æ§åˆ¶æƒé™ï¼Œå¯ä»¥ç›´æ¥è®¿é—®ç¡¬ä»¶èµ„æºå’Œç®¡ç†ç³»ç»Ÿèµ„æºã€‚å†…æ ¸æ€è¿è¡Œæ—¶ï¼Œæ“ä½œç³»ç»Ÿå¯ä»¥æ‰§è¡Œæ¶‰åŠç¡¬ä»¶æ“ä½œå’Œèµ„æºç®¡ç†çš„ä»»åŠ¡ã€‚</li>
</ul>
<p><strong>åŒºåˆ«</strong>ï¼š</p>
<ul>
<li><strong>æƒé™</strong>ï¼šç”¨æˆ·æ€æƒé™æœ‰é™ï¼Œå†…æ ¸æ€æƒé™æ›´é«˜ï¼Œå¯ä»¥ç›´æ¥æ“ä½œç¡¬ä»¶èµ„æºã€‚</li>
<li><strong>åˆ‡æ¢æˆæœ¬</strong>ï¼šä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€éœ€è¦è¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå¼€é”€è¾ƒå¤§ã€‚</li>
</ul>
<hr/>
<h4 data-id="heading-4"><strong>åˆ†å¸ƒå¼äº‹åŠ¡</strong></h4>
<h5 data-id="heading-5">1. <strong>å¦‚ä½•è®¾è®¡ä¸€ä¸ªäºŒé˜¶æ®µæäº¤ï¼ˆ2PCï¼‰åè®®</strong></h5>
<p>äºŒé˜¶æ®µæäº¤ï¼ˆ2PCï¼‰åè®®ç”¨äºè§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„äº‹åŠ¡ä¸€è‡´æ€§é—®é¢˜ã€‚å®ƒçš„åŸºæœ¬æµç¨‹åŒ…æ‹¬ä¸¤ä¸ªé˜¶æ®µï¼š</p>
<ul>
<li>
<p><strong>é˜¶æ®µä¸€ï¼šå‡†å¤‡é˜¶æ®µï¼ˆPrepare Phaseï¼‰</strong>ï¼š<br/>
- ä¸»åè°ƒè€…ï¼ˆé€šå¸¸æ˜¯äº‹åŠ¡åè°ƒå™¨ï¼‰å‘æ‰€æœ‰å‚ä¸è€…å‘é€æäº¤è¯·æ±‚ï¼Œå¹¶ç­‰å¾…å„ä¸ªå‚ä¸è€…çš„å“åº”ã€‚<br/>
- æ¯ä¸ªå‚ä¸è€…åˆ¤æ–­æ˜¯å¦èƒ½å¤Ÿæäº¤äº‹åŠ¡ï¼ˆå¦‚æ£€æŸ¥æœ¬åœ°äº‹åŠ¡çš„æ‰§è¡Œæƒ…å†µã€é”èµ„æºç­‰ï¼‰ï¼Œç„¶åå‘é€ "å‡†å¤‡æäº¤" æˆ– "æ‹’ç»" ç»™åè°ƒè€…ã€‚</p>
</li>
<li>
<p><strong>é˜¶æ®µäºŒï¼šæäº¤é˜¶æ®µï¼ˆCommit Phaseï¼‰</strong>ï¼š<br/>
- å¦‚æœæ‰€æœ‰å‚ä¸è€…éƒ½è¿”å› "å‡†å¤‡æäº¤"ï¼Œåè°ƒè€…ä¼šå‘é€ "æäº¤" å‘½ä»¤ï¼Œå‚ä¸è€…æ­£å¼æäº¤äº‹åŠ¡ã€‚<br/>
- å¦‚æœä»»ä½•ä¸€ä¸ªå‚ä¸è€…è¿”å› "æ‹’ç»" æˆ–è€…åœ¨ç­‰å¾…è¿‡ç¨‹ä¸­å‡ºç°æ•…éšœï¼Œåè°ƒè€…ä¼šå‘é€ "å›æ»š" å‘½ä»¤ï¼Œæ‰€æœ‰å‚ä¸è€…å›æ»šäº‹åŠ¡ã€‚</p>
</li>
</ul>
<p><strong>è®¾è®¡å…³é”®ç‚¹</strong>ï¼š</p>
<ul>
<li><strong>ä¸€è‡´æ€§</strong>ï¼šå¿…é¡»ç¡®ä¿æ‰€æœ‰å‚ä¸è€…ä¸€è‡´åŒæ„æäº¤æˆ–å›æ»šï¼Œä¿è¯äº‹åŠ¡çš„åŸå­æ€§ã€‚</li>
<li><strong>å®¹é”™</strong>ï¼šå¿…é¡»è€ƒè™‘ç½‘ç»œæ•…éšœã€èŠ‚ç‚¹å´©æºƒç­‰å¼‚å¸¸æƒ…å†µï¼Œç¡®ä¿åœ¨ç³»ç»Ÿæ¢å¤åèƒ½å¤Ÿç»§ç»­å®Œæˆäº‹åŠ¡ã€‚</li>
</ul>
<hr/>
<h4 data-id="heading-6"><strong>æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰</strong></h4>
<h5 data-id="heading-7">1. <strong>æ¶ˆæ¯é˜Ÿåˆ—æœ‰ä»€ä¹ˆå¥½å¤„</strong></h5>
<p>æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰æ˜¯ç”¨äºä¸åŒç³»ç»Ÿæˆ–åº”ç”¨ä¹‹é—´ä¼ é€’æ¶ˆæ¯çš„ä¸€ç§å¼‚æ­¥é€šä¿¡æ–¹å¼ã€‚å…¶ä¸»è¦ä¼˜ç‚¹åŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>è§£è€¦</strong>ï¼šç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¸éœ€è¦ç›´æ¥é€šä¿¡ï¼Œé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—è¿›è¡Œä¸­ä»‹ï¼Œç³»ç»Ÿä¹‹é—´æ¾è€¦åˆï¼Œä¾¿äºæ‰©å±•å’Œç»´æŠ¤ã€‚</li>
<li><strong>å¼‚æ­¥å¤„ç†</strong>ï¼šæ¶ˆè´¹è€…å¯ä»¥å¼‚æ­¥æ¶ˆè´¹æ¶ˆæ¯ï¼Œç”Ÿäº§è€…ä¸éœ€è¦ç­‰å¾…æ¶ˆè´¹è€…çš„å¤„ç†ç»“æœï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„ååé‡ã€‚</li>
<li><strong>æµé‡å‰Šå³°</strong>ï¼šåœ¨é«˜å¹¶å‘æƒ…å†µä¸‹ï¼Œæ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥å¹³æ»‘æµé‡æ³¢åŠ¨ï¼Œé˜²æ­¢ç³»ç»Ÿè¿‡è½½ã€‚</li>
<li><strong>å¯é æ€§ä¿éšœ</strong>ï¼šé€šè¿‡æ¶ˆæ¯æŒä¹…åŒ–æœºåˆ¶ï¼Œç¡®ä¿æ¶ˆæ¯åœ¨ç½‘ç»œå¼‚å¸¸æˆ–ç³»ç»Ÿå´©æºƒæ—¶ä¸ä¸¢å¤±ã€‚</li>
</ul>
<hr/>
<h4 data-id="heading-8"><strong>Linux å†…å­˜å›æ”¶ç­–ç•¥</strong></h4>
<h5 data-id="heading-9">1. <strong>Linux å†…å­˜å›æ”¶ç­–ç•¥</strong></h5>
<p>Linux ä½¿ç”¨çš„å†…å­˜å›æ”¶ç­–ç•¥åŒ…æ‹¬ï¼š</p>
<ul>
<li>
<p><strong>è™šæ‹Ÿå†…å­˜ç®¡ç†</strong>ï¼šLinux ä¼šå°†ä¸€éƒ¨åˆ†å†…å­˜æ ‡è®°ä¸ºè™šæ‹Ÿå†…å­˜ï¼Œå¹¶å°†ä¸å¸¸ç”¨çš„æ•°æ®æˆ–é¡µé¢äº¤æ¢åˆ°ç£ç›˜ï¼ˆäº¤æ¢ç©ºé—´ï¼‰ï¼Œä»¥é‡Šæ”¾ç‰©ç†å†…å­˜ã€‚<br/>
</p>
</li>
<li>
<p><strong>é¡µé¢å›æ”¶ï¼ˆPage Reclaimingï¼‰</strong>ï¼šå½“ç³»ç»Ÿå†…å­˜ç´§å¼ æ—¶ï¼ŒLinux ä¼šé€‰æ‹©å›æ”¶ä¸æ´»è·ƒçš„é¡µé¢ï¼Œå¦‚æ¸…ç†æ–‡ä»¶ç¼“å­˜ã€å›æ”¶æœªä½¿ç”¨çš„å†…å­˜é¡µç­‰ã€‚</p>
</li>
<li>
<p><strong>å†…å­˜å‹ç¼©ï¼ˆZswapã€Zramï¼‰</strong>ï¼šé€šè¿‡å†…å­˜å‹ç¼©æŠ€æœ¯ï¼Œå°†æ•°æ®å‹ç¼©å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œä»è€Œå»¶ç¼“æˆ–å‡å°‘ç£ç›˜äº¤æ¢çš„éœ€è¦ã€‚</p>
</li>
<li>
<p><strong>OOM Killer</strong>ï¼šå½“ç³»ç»Ÿå†…å­˜ä¸è¶³æ—¶ï¼Œå†…æ ¸ä¼šé€šè¿‡ OOMï¼ˆOut Of Memoryï¼‰æ€æ‰‹ç»“æŸæŸäº›è¿›ç¨‹ä»¥é‡Šæ”¾å†…å­˜ï¼Œé€šå¸¸ä¼šä¼˜å…ˆæ€æ­»å ç”¨å†…å­˜è¾ƒå¤§çš„è¿›ç¨‹ã€‚</p>
</li>
</ul>
<hr/>
<h3 data-id="heading-10">æ€»ç»“</h3>
<p>æœ¬æ–‡å›ç­”äº†åœ¨æŸå¤šå¤šé¢è¯•ä¸­å¯èƒ½é‡åˆ°çš„æ“ä½œç³»ç»Ÿã€åˆ†å¸ƒå¼äº‹åŠ¡ã€æ¶ˆæ¯é˜Ÿåˆ—ä»¥åŠ Linux å†…å­˜å›æ”¶ç­–ç•¥çš„ç›¸å…³é—®é¢˜ã€‚æŒæ¡è¿™äº›æŠ€æœ¯åŸç†ä¸ä»…æœ‰åŠ©äºé€šè¿‡é¢è¯•ï¼Œè¿˜èƒ½ä¸ºåç»­çš„å·¥ä½œå¥ å®šåšå®çš„åŸºç¡€ã€‚</p>
<p>â€‹</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redisï¼ˆ116ï¼‰Redisçš„å†…å­˜ç®¡ç†å¦‚ä½•å®ç°ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7570984341414182927</link>    <guid>https://juejin.cn/post/7570984341414182927</guid>    <pubDate>2025-11-10T23:06:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570984341414182927" data-draft-id="7570984341414166543" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redisï¼ˆ116ï¼‰Redisçš„å†…å­˜ç®¡ç†å¦‚ä½•å®ç°ï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-10T23:06:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redisï¼ˆ116ï¼‰Redisçš„å†…å­˜ç®¡ç†å¦‚ä½•å®ç°ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T23:06:41.000Z" title="Mon Nov 10 2025 23:06:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Redis çš„å†…å­˜ç®¡ç†æ¶‰åŠå¤šä¸ªæ–¹é¢ï¼ŒåŒ…æ‹¬å†…å­˜åˆ†é…ç­–ç•¥ã€æ•°æ®å‹ç¼©ã€æŒä¹…åŒ–ã€å†…å­˜æ¸…ç†ç­–ç•¥ç­‰ã€‚é€šè¿‡åˆç†é…ç½®å’Œä½¿ç”¨ Redisï¼Œå¯ä»¥æœ‰æ•ˆç®¡ç†å’Œä¼˜åŒ–å†…å­˜ä½¿ç”¨ï¼Œä»è€Œæå‡ Redis çš„æ€§èƒ½å’Œç¨³å®šæ€§ã€‚ä»¥ä¸‹æ˜¯ Redis å†…å­˜ç®¡ç†çš„è¯¦ç»†è®²è§£ï¼Œå¹¶ç»“åˆå…·ä½“ä»£ç ç¤ºä¾‹è¿›è¡Œè¯´æ˜ã€‚</p>
<h3 data-id="heading-0">1. å†…å­˜åˆ†é…å™¨</h3>
<p>Redis é»˜è®¤ä½¿ç”¨ <code>jemalloc</code> ä½œä¸ºå†…å­˜åˆ†é…å™¨ï¼Œè¿™æ˜¯å› ä¸º <code>jemalloc</code> åœ¨å†…å­˜ç¢ç‰‡ç®¡ç†æ–¹é¢è¡¨ç°ä¼˜å¼‚ã€‚ä½ å¯ä»¥åœ¨ç¼–è¯‘ Redis æ—¶é€‰æ‹©ä½¿ç”¨ä¸åŒçš„å†…å­˜åˆ†é…å™¨ï¼Œä¾‹å¦‚ <code>libc</code> æˆ– <code>tcmalloc</code>ã€‚</p>
<h4 data-id="heading-1">æŸ¥çœ‹å½“å‰å†…å­˜åˆ†é…å™¨</h4>
<p>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ Redis ä½¿ç”¨çš„å†…å­˜åˆ†é…å™¨ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">redis-server --version
</code></pre>
<h3 data-id="heading-2">2. å†…å­˜é™åˆ¶</h3>
<p>Redis æä¾›äº† <code>maxmemory</code> é€‰é¡¹æ¥é™åˆ¶ Redis å®ä¾‹ä½¿ç”¨çš„æœ€å¤§å†…å­˜ã€‚è®¾ç½® <code>maxmemory</code> é€‰é¡¹å¯ä»¥æœ‰æ•ˆé˜²æ­¢ Redis å ç”¨è¿‡å¤šå†…å­˜ï¼š</p>
<pre><code class="hljs language-conf" lang="conf">maxmemory 4gb
</code></pre>
<h3 data-id="heading-3">3. å†…å­˜æ¸…ç†ç­–ç•¥</h3>
<p>å½“å†…å­˜ä½¿ç”¨è¾¾åˆ° <code>maxmemory</code> é™åˆ¶æ—¶ï¼ŒRedis å¯ä»¥æ ¹æ®é…ç½®çš„å†…å­˜æ¸…ç†ç­–ç•¥æ¥ç§»é™¤ä¸€äº›é”®ä»¥é‡Šæ”¾å†…å­˜ã€‚å¸¸è§çš„å†…å­˜æ¸…ç†ç­–ç•¥åŒ…æ‹¬ï¼š</p>
<ul>
<li><code>volatile-lru</code>ï¼šç§»é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„é”®ï¼ˆä»…é™äºè®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ï¼‰ã€‚</li>
<li><code>allkeys-lru</code>ï¼šç§»é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„é”®ï¼ˆé€‚ç”¨äºæ‰€æœ‰é”®ï¼‰ã€‚</li>
<li><code>volatile-random</code>ï¼šéšæœºç§»é™¤ä¸€äº›é”®ï¼ˆä»…é™äºè®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ï¼‰ã€‚</li>
<li><code>allkeys-random</code>ï¼šéšæœºç§»é™¤ä¸€äº›é”®ï¼ˆé€‚ç”¨äºæ‰€æœ‰é”®ï¼‰ã€‚</li>
<li><code>volatile-ttl</code>ï¼šç§»é™¤ä¸€äº›å°†è¦è¿‡æœŸçš„é”®ã€‚</li>
<li><code>noeviction</code>ï¼šä¸ç§»é™¤ä»»ä½•é”®ï¼Œå½“å†…å­˜ä¸è¶³æ—¶è¿”å›é”™è¯¯ã€‚</li>
</ul>
<pre><code class="hljs language-conf" lang="conf">maxmemory-policy allkeys-lru
</code></pre>
<h3 data-id="heading-4">4. æ•°æ®å‹ç¼©</h3>
<p>Redis æä¾›äº† <code>hash-max-ziplist-entries</code> å’Œ <code>hash-max-ziplist-value</code> å‚æ•°ï¼Œç”¨äºåœ¨å­˜å‚¨å°å“ˆå¸Œå¯¹è±¡æ—¶ä¼˜åŒ–å†…å­˜ä½¿ç”¨ã€‚è¿™äº›å‚æ•°æŒ‡å®šäº†ä½•æ—¶å°†å“ˆå¸Œå¯¹è±¡è½¬æ¢ä¸º ziplist æ ¼å¼å­˜å‚¨ï¼Œä»¥å‡å°‘å†…å­˜å ç”¨ã€‚</p>
<pre><code class="hljs language-conf" lang="conf">hash-max-ziplist-entries 512
hash-max-ziplist-value 64
</code></pre>
<h3 data-id="heading-5">5. å†…å­˜ç»Ÿè®¡</h3>
<p>Redis æä¾›äº†å¤šç§å‘½ä»¤æ¥æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹å†…å­˜ä½¿ç”¨ä¿¡æ¯</span>
redis-cli info memory

<span class="hljs-comment"># æŸ¥çœ‹æŸä¸ªé”®çš„å†…å­˜ä½¿ç”¨æƒ…å†µ</span>
redis-cli memory usage key_name
</code></pre>
<h3 data-id="heading-6">6. æŒä¹…åŒ–é…ç½®</h3>
<p>Redis æä¾›äº† RDB å’Œ AOF ä¸¤ç§æŒä¹…åŒ–æ–¹å¼ã€‚åˆç†é…ç½®æŒä¹…åŒ–ï¼Œå¯ä»¥å¹³è¡¡æ€§èƒ½å’Œæ•°æ®å®‰å…¨ã€‚</p>
<h4 data-id="heading-7">RDB æŒä¹…åŒ–</h4>
<p>RDB æŒä¹…åŒ–å¯ä»¥é€šè¿‡é…ç½® <code>save</code> é€‰é¡¹æ¥æ§åˆ¶è‡ªåŠ¨ä¿å­˜å¿«ç…§çš„é¢‘ç‡ï¼š</p>
<pre><code class="hljs language-conf" lang="conf">save 900 1
save 300 10
save 60 10000
</code></pre>
<h4 data-id="heading-8">AOF æŒä¹…åŒ–</h4>
<p>AOF æŒä¹…åŒ–å¯ä»¥é€šè¿‡é…ç½® <code>appendonly</code> å’Œ <code>appendfsync</code> é€‰é¡¹æ¥æ§åˆ¶å†™å…¥æ—¥å¿—çš„é¢‘ç‡ï¼š</p>
<pre><code class="hljs language-conf" lang="conf">appendonly yes
appendfsync everysec
</code></pre>
<h3 data-id="heading-9">7. å†…å­˜ä¼˜åŒ–</h3>
<h4 data-id="heading-10">ä½¿ç”¨åˆé€‚çš„æ•°æ®ç»“æ„</h4>
<p>é€‰æ‹©åˆé€‚çš„æ•°æ®ç»“æ„å¯ä»¥æ˜¾è‘—ä¼˜åŒ–å†…å­˜ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li>å¯¹äºè®¡æ•°å™¨ä½¿ç”¨ <code>INCR</code> æˆ– <code>DECR</code>ã€‚</li>
<li>å¯¹äºå°é›†åˆä½¿ç”¨ <code>HASH</code>ã€‚</li>
<li>å¯¹äºæœ‰åºé›†åˆä½¿ç”¨ <code>ZSET</code>ã€‚</li>
</ul>
<h4 data-id="heading-11">ä½¿ç”¨åˆç†çš„é”®å’Œå€¼</h4>
<p>é¿å…ä½¿ç”¨è¿‡é•¿çš„é”®åå’Œå€¼ï¼Œå¯ä»¥æ˜¾è‘—å‡å°‘å†…å­˜ä½¿ç”¨ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Java Jedis ç¤ºä¾‹</span>
jedis.set(<span class="hljs-string">"k1"</span>, <span class="hljs-string">"v1"</span>);
</code></pre>
<h3 data-id="heading-12">8. å†…å­˜ç¢ç‰‡ç®¡ç†</h3>
<p>å†…å­˜ç¢ç‰‡å¯èƒ½å¯¼è‡´ Redis å®é™…å†…å­˜ä½¿ç”¨è¶…è¿‡é¢„æœŸã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥åˆ†æå’Œä¼˜åŒ–å†…å­˜ç¢ç‰‡ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹å†…å­˜ç¢ç‰‡ç‡</span>
redis-cli info memory | grep fragmentation_ratio

<span class="hljs-comment"># è§¦å‘æ‰‹åŠ¨åƒåœ¾å›æ”¶</span>
redis-cli memory purge
</code></pre>
<h3 data-id="heading-13">9. å†…å­˜ç›‘æ§ä¸æŠ¥è­¦</h3>
<p>ä½¿ç”¨ Redis è‡ªå¸¦çš„ç›‘æ§å·¥å…·å’Œå¤–éƒ¨ç›‘æ§å·¥å…·ï¼ˆå¦‚ Prometheus + Grafanaï¼‰æ¥ç›‘æ§ Redis å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œå¹¶é…ç½®æŠ¥è­¦æœºåˆ¶ã€‚</p>
<h3 data-id="heading-14">10. ä»£ç ç¤ºä¾‹</h3>
<p>ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„å†…å­˜ç®¡ç†ç›¸å…³ä»£ç ç¤ºä¾‹ï¼š</p>
<h4 data-id="heading-15">è®¾ç½®é”®å’Œè¿‡æœŸæ—¶é—´</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisMemoryManagement</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">6379</span>)) {
            <span class="hljs-comment">// è®¾ç½®é”®å’Œå€¼</span>
            jedis.set(<span class="hljs-string">"key1"</span>, <span class="hljs-string">"value1"</span>);

            <span class="hljs-comment">// è®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´</span>
            jedis.setex(<span class="hljs-string">"key2"</span>, <span class="hljs-number">3600</span>, <span class="hljs-string">"value2"</span>); <span class="hljs-comment">// 1å°æ—¶åè¿‡æœŸ</span>

            <span class="hljs-comment">// è·å–é”®çš„å†…å­˜ä½¿ç”¨æƒ…å†µ</span>
            <span class="hljs-type">Long</span> <span class="hljs-variable">memoryUsage</span> <span class="hljs-operator">=</span> jedis.memoryUsage(<span class="hljs-string">"key1"</span>);
            System.out.println(<span class="hljs-string">"Memory usage of key1: "</span> + memoryUsage);
        }
    }
}
</code></pre>
<h4 data-id="heading-16">é…ç½®æŒä¹…åŒ–</h4>
<pre><code class="hljs language-conf" lang="conf"># redis.conf
save 900 1
save 300 10
save 60 10000

appendonly yes
appendfsync everysec
</code></pre>
<h3 data-id="heading-17">11. å…¶ä»–å†…å­˜ç®¡ç†ç­–ç•¥</h3>
<h4 data-id="heading-18">Lazy Freeingï¼ˆæƒ°æ€§åˆ é™¤ï¼‰</h4>
<p>åœ¨åˆ é™¤å¤§å‹é”®æˆ–é‡Šæ”¾å¤§å¯¹è±¡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ Redis çš„æƒ°æ€§åˆ é™¤ç‰¹æ€§ï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹ï¼š</p>
<pre><code class="hljs language-conf" lang="conf">lazyfree-lazy-eviction yes
lazyfree-lazy-expire yes
lazyfree-lazy-server-del yes
</code></pre>
<h4 data-id="heading-19">å†…å­˜ä¼˜åŒ–å‚è€ƒé…ç½®</h4>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç»¼åˆçš„ Redis å†…å­˜ç®¡ç†é…ç½®ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-conf" lang="conf"># redis.conf

# å†…å­˜åˆ†é…å™¨
malloc-lib /usr/lib/libjemalloc.so

# æœ€å¤§å†…å­˜é™åˆ¶
maxmemory 4gb
maxmemory-policy allkeys-lru

# æ•°æ®å‹ç¼©
hash-max-ziplist-entries 512
hash-max-ziplist-value 64

# å†…å­˜æ¸…ç†ç­–ç•¥
lazyfree-lazy-eviction yes
lazyfree-lazy-expire yes
lazyfree-lazy-server-del yes

# æŒä¹…åŒ–é…ç½®
save 900 1
save 300 10
save 60 10000
appendonly yes
appendfsync everysec

# ç½‘ç»œé…ç½®
tcp-keepalive 60

# æœ€å¤§å®¢æˆ·ç«¯è¿æ¥æ•°
maxclients 20000
</code></pre>
<h3 data-id="heading-20">æ€»ç»“</h3>
<p>Redis çš„å†…å­˜ç®¡ç†æ¶‰åŠå¤šä¸ªæ–¹é¢ï¼ŒåŒ…æ‹¬å†…å­˜åˆ†é…ã€å†…å­˜é™åˆ¶ã€å†…å­˜æ¸…ç†ç­–ç•¥ã€æ•°æ®å‹ç¼©ã€å†…å­˜ç¢ç‰‡ç®¡ç†ã€æŒä¹…åŒ–é…ç½®ã€åˆç†é€‰æ‹©æ•°æ®ç»“æ„å’Œé”®å€¼ã€æƒ°æ€§åˆ é™¤ç­‰ã€‚é€šè¿‡åˆç†é…ç½®å’Œä½¿ç”¨ Redisï¼Œå¯ä»¥æœ‰æ•ˆç®¡ç†å’Œä¼˜åŒ–å†…å­˜ä½¿ç”¨ï¼Œä»è€Œæå‡ Redis çš„æ€§èƒ½å’Œç¨³å®šæ€§ã€‚ç»“åˆä¸Šè¿°æ–¹æ³•å’Œé…ç½®ç¤ºä¾‹ï¼Œå¯ä»¥å¸®åŠ©ä½ åœ¨å®é™…åº”ç”¨ä¸­æ›´å¥½åœ°ç®¡ç† Redis å†…å­˜ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redisï¼ˆ117ï¼‰Redisçš„åˆ†å¸ƒå¼é”å¦‚ä½•ä½¿ç”¨ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7570940025581371432</link>    <guid>https://juejin.cn/post/7570940025581371432</guid>    <pubDate>2025-11-10T23:07:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570940025581371432" data-draft-id="7570984341414199311" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redisï¼ˆ117ï¼‰Redisçš„åˆ†å¸ƒå¼é”å¦‚ä½•ä½¿ç”¨ï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-10T23:07:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redisï¼ˆ117ï¼‰Redisçš„åˆ†å¸ƒå¼é”å¦‚ä½•ä½¿ç”¨ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T23:07:42.000Z" title="Mon Nov 10 2025 23:07:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œåˆ†å¸ƒå¼é”æ˜¯ä¸€ç§å…³é”®çš„å·¥å…·ï¼Œç”¨äºç¡®ä¿å¤šä¸ªè¿›ç¨‹åœ¨ä¸åŒæœºå™¨ä¸Šèƒ½å¤Ÿå®‰å…¨åœ°è®¿é—®å…±äº«èµ„æºã€‚Redis æä¾›äº†ä¸€ç§ç®€å•ä¸”é«˜æ•ˆçš„æ–¹å¼æ¥å®ç°åˆ†å¸ƒå¼é”ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨ Redis å®ç°åˆ†å¸ƒå¼é”çš„è¯¦ç»†ä»‹ç»å’Œä»£ç ç¤ºä¾‹ã€‚</p>
<h3 data-id="heading-0">1. åˆ†å¸ƒå¼é”çš„åŸºæœ¬åŸç†</h3>
<p>Redis åˆ†å¸ƒå¼é”çš„åŸºæœ¬åŸç†æ˜¯ä½¿ç”¨ Redis çš„ <code>SET</code> å‘½ä»¤æ¥å°è¯•è®¾ç½®ä¸€ä¸ªé”®ï¼Œå¦‚æœè¯¥é”®ä¸å­˜åœ¨ï¼Œåˆ™è¡¨ç¤ºè·å–é”æˆåŠŸã€‚ä¸ºäº†é˜²æ­¢æ­»é”ï¼Œéœ€è¦ä¸ºé”è®¾ç½®è¿‡æœŸæ—¶é—´ã€‚</p>
<h3 data-id="heading-1">2. ä½¿ç”¨ Jedis å®ç° Redis åˆ†å¸ƒå¼é”</h3>
<p>ä»¥ä¸‹æ˜¯ä½¿ç”¨ Jedis å®¢æˆ·ç«¯åœ¨ Java ä¸­å®ç° Redis åˆ†å¸ƒå¼é”çš„å®Œæ•´ç¤ºä¾‹ã€‚</p>
<h4 data-id="heading-2">ä¾èµ–æ·»åŠ </h4>
<p>åœ¨ä½ çš„ Maven é¡¹ç›®ä¸­æ·»åŠ  Jedis ä¾èµ–ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>redis.clients<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jedis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.7.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h4 data-id="heading-3">åˆ†å¸ƒå¼é”å®ç°ç±»</h4>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ Redis åˆ†å¸ƒå¼é”å®ç°ç±»ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;
<span class="hljs-keyword">import</span> redis.clients.jedis.params.SetParams;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisDistributedLock</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Jedis jedis;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String lockKey;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> expireTime;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RedisDistributedLock</span><span class="hljs-params">(Jedis jedis, String lockKey, <span class="hljs-type">long</span> expireTime)</span> {
        <span class="hljs-built_in">this</span>.jedis = jedis;
        <span class="hljs-built_in">this</span>.lockKey = lockKey;
        <span class="hljs-built_in">this</span>.expireTime = expireTime;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">acquireLock</span><span class="hljs-params">(String lockValue)</span> {
        <span class="hljs-type">SetParams</span> <span class="hljs-variable">params</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SetParams</span>().nx().px(expireTime);
        <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> jedis.set(lockKey, lockValue, params);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"OK"</span>.equals(result);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">releaseLock</span><span class="hljs-params">(String lockValue)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">script</span> <span class="hljs-operator">=</span> <span class="hljs-string">"if redis.call('get', KEYS[1]) == ARGV[1] then "</span> +
                        <span class="hljs-string">"return redis.call('del', KEYS[1]) "</span> +
                        <span class="hljs-string">"else return 0 end"</span>;
        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> jedis.eval(script, <span class="hljs-number">1</span>, lockKey, lockValue);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"1"</span>.equals(result.toString());
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">6379</span>)) {
            <span class="hljs-type">String</span> <span class="hljs-variable">lockKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"myLock"</span>;
            <span class="hljs-type">String</span> <span class="hljs-variable">lockValue</span> <span class="hljs-operator">=</span> <span class="hljs-string">"myUniqueValue"</span>;
            <span class="hljs-type">long</span> <span class="hljs-variable">expireTime</span> <span class="hljs-operator">=</span> <span class="hljs-number">30000</span>; <span class="hljs-comment">// 30 seconds</span>

            <span class="hljs-type">RedisDistributedLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedisDistributedLock</span>(jedis, lockKey, expireTime);

            <span class="hljs-comment">// Acquire lock</span>
            <span class="hljs-keyword">if</span> (lock.acquireLock(lockValue)) {
                System.out.println(<span class="hljs-string">"Lock acquired!"</span>);

                <span class="hljs-comment">// Do your critical section work here</span>

                <span class="hljs-comment">// Release lock</span>
                <span class="hljs-keyword">if</span> (lock.releaseLock(lockValue)) {
                    System.out.println(<span class="hljs-string">"Lock released!"</span>);
                } <span class="hljs-keyword">else</span> {
                    System.out.println(<span class="hljs-string">"Failed to release lock!"</span>);
                }
            } <span class="hljs-keyword">else</span> {
                System.out.println(<span class="hljs-string">"Failed to acquire lock!"</span>);
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-4">3. è¯¦ç»†è§£é‡Š</h3>
<ul>
<li>
<p><strong>acquireLock æ–¹æ³•</strong>ï¼šè¯¥æ–¹æ³•å°è¯•è·å–é”ã€‚ä½¿ç”¨ <code>SET</code> å‘½ä»¤å’Œ <code>NX</code>ï¼ˆä»…å½“é”®ä¸å­˜åœ¨æ—¶è®¾ç½®ï¼‰å’Œ <code>PX</code>ï¼ˆè®¾ç½®è¿‡æœŸæ—¶é—´ï¼‰å‚æ•°æ¥ç¡®ä¿è®¾ç½®é”æ—¶çš„åŸå­æ€§ã€‚è¿”å› <code>true</code> è¡¨ç¤ºè·å–é”æˆåŠŸï¼Œè¿”å› <code>false</code> è¡¨ç¤ºè·å–é”å¤±è´¥ã€‚</p>
</li>
<li>
<p><strong>releaseLock æ–¹æ³•</strong>ï¼šè¯¥æ–¹æ³•é‡Šæ”¾é”ã€‚ä½¿ç”¨ Lua è„šæœ¬æ¥ç¡®ä¿é‡Šæ”¾é”çš„åŸå­æ€§ï¼Œç¡®ä¿åªæœ‰æŒæœ‰é”çš„å®¢æˆ·ç«¯æ‰èƒ½é‡Šæ”¾é”ã€‚Lua è„šæœ¬æ£€æŸ¥å½“å‰é”çš„å€¼æ˜¯å¦ä¸ä¼ å…¥çš„å€¼åŒ¹é…ï¼Œå¦‚æœåŒ¹é…åˆ™åˆ é™¤é”ã€‚</p>
</li>
</ul>
<h3 data-id="heading-5">4. æ³¨æ„äº‹é¡¹</h3>
<ol>
<li>
<p><strong>é”çš„è¿‡æœŸæ—¶é—´</strong>ï¼šç¡®ä¿é”çš„è¿‡æœŸæ—¶é—´è¶³å¤Ÿé•¿ï¼Œå¯ä»¥è¦†ç›–æ‰€æœ‰å¯èƒ½çš„æ“ä½œæ—¶é—´ï¼Œä½†ä¹Ÿä¸èƒ½å¤ªé•¿ï¼Œä»¥é˜²æ­¢æ­»é”ã€‚</p>
</li>
<li>
<p><strong>å”¯ä¸€æ ‡è¯†</strong>ï¼šç¡®ä¿æ¯ä¸ªå®¢æˆ·ç«¯è®¾ç½®çš„ <code>lockValue</code> å”¯ä¸€ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿åªæœ‰æŒæœ‰é”çš„å®¢æˆ·ç«¯æ‰èƒ½é‡Šæ”¾é”ã€‚</p>
</li>
<li>
<p><strong>å®¹é”™å¤„ç†</strong>ï¼šåœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿˜éœ€è¦è€ƒè™‘ç½‘ç»œåˆ†åŒºã€Redis æ•…éšœç­‰æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨ Redlock ç®—æ³•æ¥å¢å¼ºå¯é æ€§ã€‚</p>
</li>
</ol>
<h3 data-id="heading-6">5. ä½¿ç”¨ Redlock ç®—æ³•</h3>
<p>Redlock æ˜¯ Redis æä¾›çš„ä¸€ç§åˆ†å¸ƒå¼é”ç®—æ³•ï¼Œæ—¨åœ¨æé«˜åˆ†å¸ƒå¼ç¯å¢ƒä¸‹é”çš„å¯é æ€§ã€‚å…¶åŸºæœ¬æ€æƒ³æ˜¯åœ¨å¤šä¸ªç‹¬ç«‹çš„ Redis å®ä¾‹ä¸Šå°è¯•è·å–é”ï¼Œä»¥æé«˜å®¹é”™æ€§ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä½¿ç”¨ Redlock ç®—æ³•çš„å®ç°ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;
<span class="hljs-keyword">import</span> redis.clients.jedis.JedisPool;
<span class="hljs-keyword">import</span> redis.clients.jedis.params.SetParams;

<span class="hljs-keyword">import</span> java.util.Arrays;
<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> java.util.UUID;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisRedlock</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;JedisPool&gt; jedisPools;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> expireTime;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> retryDelay;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> retryCount;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RedisRedlock</span><span class="hljs-params">(List&lt;JedisPool&gt; jedisPools, <span class="hljs-type">long</span> expireTime, <span class="hljs-type">long</span> retryDelay, <span class="hljs-type">int</span> retryCount)</span> {
        <span class="hljs-built_in">this</span>.jedisPools = jedisPools;
        <span class="hljs-built_in">this</span>.expireTime = expireTime;
        <span class="hljs-built_in">this</span>.retryDelay = retryDelay;
        <span class="hljs-built_in">this</span>.retryCount = retryCount;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">acquireLock</span><span class="hljs-params">(String lockKey)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">lockValue</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString();
        <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> jedisPools.size();
        <span class="hljs-type">int</span> <span class="hljs-variable">quorum</span> <span class="hljs-operator">=</span> n / <span class="hljs-number">2</span> + <span class="hljs-number">1</span>;

        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; retryCount; i++) {
            <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
            <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();

            <span class="hljs-keyword">for</span> (JedisPool pool : jedisPools) {
                <span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> pool.getResource()) {
                    <span class="hljs-type">SetParams</span> <span class="hljs-variable">params</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SetParams</span>().nx().px(expireTime);
                    <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> jedis.set(lockKey, lockValue, params);
                    <span class="hljs-keyword">if</span> (<span class="hljs-string">"OK"</span>.equals(result)) {
                        count++;
                    }
                }
            }

            <span class="hljs-type">long</span> <span class="hljs-variable">elapsedTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis() - startTime;
            <span class="hljs-keyword">if</span> (count &gt;= quorum &amp;&amp; elapsedTime &lt;= expireTime) {
                <span class="hljs-keyword">return</span> lockValue;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">for</span> (JedisPool pool : jedisPools) {
                    <span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> pool.getResource()) {
                        <span class="hljs-keyword">if</span> (lockValue.equals(jedis.get(lockKey))) {
                            jedis.del(lockKey);
                        }
                    }
                }
            }

            <span class="hljs-keyword">try</span> {
                Thread.sleep(retryDelay);
            } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                Thread.currentThread().interrupt();
            }
        }

        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">releaseLock</span><span class="hljs-params">(String lockKey, String lockValue)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">script</span> <span class="hljs-operator">=</span> <span class="hljs-string">"if redis.call('get', KEYS[1]) == ARGV[1] then "</span> +
                        <span class="hljs-string">"return redis.call('del', KEYS[1]) "</span> +
                        <span class="hljs-string">"else return 0 end"</span>;
        <span class="hljs-type">boolean</span> <span class="hljs-variable">success</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;

        <span class="hljs-keyword">for</span> (JedisPool pool : jedisPools) {
            <span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> pool.getResource()) {
                <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> jedis.eval(script, Arrays.asList(lockKey), Arrays.asList(lockValue));
                <span class="hljs-keyword">if</span> (<span class="hljs-string">"1"</span>.equals(result.toString())) {
                    success = <span class="hljs-literal">true</span>;
                }
            }
        }

        <span class="hljs-keyword">return</span> success;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        List&lt;JedisPool&gt; jedisPools = Arrays.asList(
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisPool</span>(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">6379</span>),
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisPool</span>(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">6380</span>),
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisPool</span>(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">6381</span>)
        );

        <span class="hljs-type">long</span> <span class="hljs-variable">expireTime</span> <span class="hljs-operator">=</span> <span class="hljs-number">30000</span>; <span class="hljs-comment">// 30 seconds</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">retryDelay</span> <span class="hljs-operator">=</span> <span class="hljs-number">200</span>; <span class="hljs-comment">// 200 milliseconds</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">retryCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;

        <span class="hljs-type">RedisRedlock</span> <span class="hljs-variable">redlock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedisRedlock</span>(jedisPools, expireTime, retryDelay, retryCount);

        <span class="hljs-type">String</span> <span class="hljs-variable">lockKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"myLock"</span>;
        <span class="hljs-type">String</span> <span class="hljs-variable">lockValue</span> <span class="hljs-operator">=</span> redlock.acquireLock(lockKey);

        <span class="hljs-keyword">if</span> (lockValue != <span class="hljs-literal">null</span>) {
            System.out.println(<span class="hljs-string">"Lock acquired!"</span>);

            <span class="hljs-comment">// Do your critical section work here</span>

            <span class="hljs-keyword">if</span> (redlock.releaseLock(lockKey, lockValue)) {
                System.out.println(<span class="hljs-string">"Lock released!"</span>);
            } <span class="hljs-keyword">else</span> {
                System.out.println(<span class="hljs-string">"Failed to release lock!"</span>);
            }
        } <span class="hljs-keyword">else</span> {
            System.out.println(<span class="hljs-string">"Failed to acquire lock!"</span>);
        }
    }
}
</code></pre>
<h3 data-id="heading-7">æ€»ç»“</h3>
<p>Redis åˆ†å¸ƒå¼é”æ˜¯ä¸€ç§æœ‰æ•ˆçš„å·¥å…·ï¼Œç”¨äºåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­å®ç°äº’æ–¥è®¿é—®ã€‚é€šè¿‡ä½¿ç”¨ Jedis å®¢æˆ·ç«¯ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å®ç°åŸºæœ¬çš„åˆ†å¸ƒå¼é”åŠŸèƒ½ã€‚è€Œ Redlock ç®—æ³•åˆ™æä¾›äº†ä¸€ç§æ›´å¯é çš„åˆ†å¸ƒå¼é”å®ç°ï¼Œé€‚ç”¨äºå¯¹å®¹é”™æ€§è¦æ±‚è¾ƒé«˜çš„åœºæ™¯ã€‚åˆç†é…ç½®å’Œä½¿ç”¨åˆ†å¸ƒå¼é”ï¼Œå¯ä»¥æ˜¾è‘—æé«˜åˆ†å¸ƒå¼ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œä¸€è‡´æ€§ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸ºä»€ä¹ˆæˆ‘ä»¬ä» Python è¿ç§»åˆ° Node.js]]></title>    <link>https://juejin.cn/post/7570932873131950107</link>    <guid>https://juejin.cn/post/7570932873131950107</guid>    <pubDate>2025-11-10T23:28:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570932873131950107" data-draft-id="7436003502298447912" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸ºä»€ä¹ˆæˆ‘ä»¬ä» Python è¿ç§»åˆ° Node.js"/> <meta itemprop="keywords" content="å‰ç«¯,åç«¯,Node.js"/> <meta itemprop="datePublished" content="2025-11-10T23:28:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Moment"/> <meta itemprop="url" content="https://juejin.cn/user/3782764966460398"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸ºä»€ä¹ˆæˆ‘ä»¬ä» Python è¿ç§»åˆ° Node.js
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3782764966460398/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Moment
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T23:28:21.000Z" title="Mon Nov 10 2025 23:28:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"ã€Œ";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"ã€";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"Â»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"âœ“";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p>æœ€è¿‘åœ¨ä½¿ç”¨ NestJs å’Œ NextJs åœ¨åšä¸€ä¸ªååŒæ–‡æ¡£ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxun082%2FDocFlow" target="_blank" title="https://github.com/xun082/DocFlow" ref="nofollow noopener noreferrer">DocFlow</a>ï¼Œå¦‚æœæ„Ÿå…´è¶£ï¼Œæ¬¢è¿ starï¼Œæœ‰ä»»ä½•ç–‘é—®ï¼Œæ¬¢è¿åŠ æˆ‘å¾®ä¿¡è¿›è¡Œå’¨è¯¢ <code>yunmz777</code></p>
<p>æˆ‘ä»¬åšäº†ä¸€ä»¶å¤§äº‹ï¼šåœ¨ä¸Šçº¿ä»…ä¸€å‘¨åï¼Œæˆ‘ä»¬å†³å®šå°†åç«¯å½»åº•ä» Python è½¬ç§»åˆ° Node.jsã€‚è¿™ä¸€å†³å®šçš„æ ¸å¿ƒåŸå› æ˜¯ æ‰©å±•æ€§ã€‚</p>
<p>å½“æ—¶ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿè¿˜å¾ˆå°ï¼Œç”¨æˆ·é‡ä¹Ÿä¸å¤§ï¼Œæ‰€ä»¥è¿™ä¸ªå†³å®šçœ‹èµ·æ¥æ—¢å†’é™©åˆå¤§èƒ†ï¼Œä½†ä»é•¿è¿œæ¥çœ‹ï¼Œæˆ‘ä»¬è®¤ä¸ºè¿™æœ‰åŠ©äºè§£å†³æ½œåœ¨çš„æŠ€æœ¯ç“¶é¢ˆã€‚</p>
<h2 data-id="heading-0">é—®é¢˜çš„æ ¹æºï¼šPython å¼‚æ­¥ç¼–ç¨‹çš„å¤æ‚æ€§</h2>
<p>æˆ‘æ˜¯ Django çš„å¿ å®ç²‰ä¸ï¼Œå®ƒè®©æˆ‘èƒ½å¤Ÿå¿«é€Ÿæ„å»ºåº”ç”¨ï¼Œå¹¶ä¸”æä¾›äº†å¾ˆå¤šä¾¿åˆ©çš„å·¥å…·ã€‚ç„¶è€Œï¼Œéšç€æˆ‘ä»¬é¡¹ç›®çš„ä¸æ–­æ¨è¿›ï¼Œæˆ‘ä»¬å‘ç°ï¼ŒPython åœ¨å¤„ç†å¼‚æ­¥æ“ä½œæ—¶å­˜åœ¨å¾ˆå¤šé—®é¢˜ï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦å¤§é‡å¹¶å‘è¯·æ±‚çš„æƒ…å†µä¸‹ã€‚</p>
<p>åœ¨æˆ‘ä»¬éœ€è¦å¼‚æ­¥æ‰§è¡Œå¤šä¸ª I/O æ“ä½œæ—¶ï¼ŒPython çš„å¼‚æ­¥ç¼–ç¨‹å˜å¾—æå…¶æ··ä¹±ã€‚è™½ç„¶ Python ä¹Ÿæœ‰å¼‚æ­¥æ”¯æŒï¼Œä½†ç”±äºå…¶å¼‚æ­¥æ¨¡å‹æ˜¯åæ¥åŠ å…¥çš„ï¼Œå¯¼è‡´å…¶ç¨³å®šæ€§å’Œæ€§èƒ½å¹¶ä¸ç†æƒ³ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒJavaScript å’Œ Go çš„å¼‚æ­¥æ¨¡å‹æ›´åŠ ç›´è§‚ä¸”é«˜æ•ˆã€‚å¯¹äº Python æ¥è¯´ï¼Œè¦ä½¿å¼‚æ­¥ç¼–ç¨‹æ­£å¸¸å·¥ä½œï¼Œéœ€è¦å¤§é‡äº†è§£åº•å±‚å®ç°ï¼Œå¹¶ä¸”ä¼šå—åˆ°è¯¸å¤šé™åˆ¶ã€‚</p>
<h3 data-id="heading-1">Python å¼‚æ­¥çš„æŒ‘æˆ˜ï¼š</h3>
<ul>
<li>Python æ²¡æœ‰åŸç”Ÿå¼‚æ­¥æ–‡ä»¶ I/O æ”¯æŒã€‚</li>
<li>Django å¯¹å¼‚æ­¥çš„æ”¯æŒå¹¶ä¸å®Œå–„ï¼Œå°¤å…¶æ˜¯ ORMï¼ˆå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰éƒ¨åˆ†ã€‚</li>
<li>ä¸ºäº†å®ç°å¼‚æ­¥åŠŸèƒ½ï¼Œå¼€å‘è€…å¿…é¡»ä½¿ç”¨å¦‚ <code>async_to_sync</code> å’Œ <code>sync_to_async</code> è¿™æ ·çš„å·¥å…·ï¼Œå¢åŠ äº†ä»£ç å¤æ‚æ€§ã€‚</li>
<li>å¼‚æ­¥æ“ä½œçš„æ€§èƒ½ä¾èµ–äºè¿è¡Œç¯å¢ƒï¼Œå¦‚ Gunicorn çš„å·¥ä½œæ¨¡å¼ç­‰ï¼Œè¿™ä½¿å¾—åœ¨ Python ä¸­å†™å‡ºé«˜æ•ˆçš„å¼‚æ­¥ä»£ç å˜å¾—æ›´åŠ å›°éš¾ã€‚</li>
</ul>
<h2 data-id="heading-2">ä¸ºä»€ä¹ˆé€‰æ‹© Node.jsï¼Ÿ</h2>
<p>åœ¨é¢å¯¹ Python å¼‚æ­¥ç¼–ç¨‹çš„å›°å¢ƒæ—¶ï¼Œæˆ‘ä»¬å†³å®šè½¬å‘ Node.jsã€‚Node.js æœ¬èº«å°±ä¸ºå¼‚æ­¥æ“ä½œæä¾›äº†å¾ˆå¥½çš„æ”¯æŒï¼Œå®ƒçš„äº‹ä»¶å¾ªç¯æœºåˆ¶ä½¿å¾—å¹¶å‘å¤„ç†å˜å¾—æ›´åŠ é«˜æ•ˆã€‚</p>
<p>è™½ç„¶æˆ‘ä»¬æ›¾è€ƒè™‘è¿‡ä½¿ç”¨ Python ä¸­çš„ FastAPIï¼Œå®ƒçš„å¼‚æ­¥æ”¯æŒç¡®å®æ¯” Django å¼ºï¼Œä½†æˆ‘ä»¬æœ€ç»ˆè¿˜æ˜¯é€‰æ‹©äº† Node.jsï¼Œå› ä¸ºå®ƒæ›´ç¬¦åˆæˆ‘ä»¬å¯¹æœªæ¥å¯æ‰©å±•æ€§çš„éœ€æ±‚ã€‚Node.js çš„äº‹ä»¶å¾ªç¯æœºåˆ¶å’Œä¸°å¯Œçš„ç”Ÿæ€ç³»ç»Ÿä½¿å¾—å®ƒéå¸¸é€‚åˆæˆ‘ä»¬çš„ä¸šåŠ¡éœ€æ±‚ã€‚</p>
<h2 data-id="heading-3">è¿ç§»çš„æ”¶ç›Š</h2>
<ol>
<li>
<p>æ€§èƒ½æå‡
æˆ‘ä»¬çš„æµ‹è¯•æ˜¾ç¤ºï¼Œåœ¨è¿ç§»åˆ° Node.js åï¼Œååé‡æé«˜äº†çº¦ 3 å€ã€‚éšç€æˆ‘ä»¬åœ¨ Node.js ä¸­å®ç°æ›´å¤šå¹¶å‘æ“ä½œï¼ˆå¦‚æ–‡æ¡£ chunking å’Œé‡æ–°æ’åºï¼‰ï¼Œæˆ‘ä»¬é¢„æœŸæ€§èƒ½è¿˜ä¼šç»§ç»­æå‡ã€‚</p>
</li>
<li>
<p>å¼€å‘æ•ˆç‡
Node.js çš„äº‹ä»¶é©±åŠ¨æ¨¡å‹è®©æˆ‘ä»¬èƒ½å¤Ÿæ›´å¥½åœ°å¤„ç†é«˜å¹¶å‘ä»»åŠ¡ï¼Œè€Œæ— éœ€æ‹…å¿ƒåƒ Python é‚£æ ·çš„å¼‚æ­¥é™·é˜±ã€‚æˆ‘ä»¬èƒ½æ›´å¿«é€Ÿåœ°å®ç°æ–°åŠŸèƒ½ï¼ŒåŒæ—¶å‡å°‘äº†å› åº•å±‚å¼‚æ­¥é—®é¢˜å¸¦æ¥çš„é˜»ç¢ã€‚</p>
</li>
<li>
<p>ç»Ÿä¸€ä»£ç åº“
è¿ç§»åˆ° Node.js åï¼Œæˆ‘ä»¬å°†åŸæœ¬åˆ†å¼€çš„åå° worker å’Œ Web æœåŠ¡å™¨æ•´åˆåˆ°ä¸€ä¸ªä»£ç åº“ä¸­ï¼Œå‡å°‘äº†é‡å¤ä»£ç ï¼Œæå‡äº†ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œä¸€è‡´æ€§ã€‚</p>
</li>
<li>
<p>æ›´å¥½çš„æµ‹è¯•å’Œé‡æ„
è¿ç§»è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å†™äº†å¤§é‡æ–°çš„æµ‹è¯•ï¼Œç¡®ä¿æ–°ç³»ç»ŸæŒ‰é¢„æœŸå·¥ä½œã€‚è¿™ä¹Ÿä¿ƒä½¿æˆ‘ä»¬å¯¹ç°æœ‰ä»£ç è¿›è¡Œäº†é‡æ„ï¼Œæå‡äº†ä»£ç è´¨é‡ã€‚</p>
</li>
</ol>
<h2 data-id="heading-4">è¿ç§»çš„æŒ‘æˆ˜</h2>
<ol>
<li>
<p>å¤±å» Django çš„ä¾¿åˆ©
Django æ˜¯ä¸€ä¸ªæˆç†Ÿçš„æ¡†æ¶ï¼Œå®ƒæä¾›äº†å¾ˆå¤šç°æˆçš„åŠŸèƒ½ï¼Œä¾‹å¦‚ ORM å’Œä¸­é—´ä»¶ã€‚è¿ç§»åˆ° Node.js åï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±æ‰‹åŠ¨å®ç°å¾ˆå¤šåŠŸèƒ½ï¼Œè™½ç„¶å¯ä»¥ä½¿ç”¨ Express ç­‰æ¡†æ¶ï¼Œä½†ä¸ Django çš„è‡ªåŠ¨åŒ–åŠŸèƒ½ç›¸æ¯”ï¼Œä»æœ‰ä¸€äº›ç¼ºå¤±ã€‚</p>
</li>
<li>
<p>Python ç”Ÿæ€çš„ä¸§å¤±
è™½ç„¶æˆ‘ä»¬å·²ç»è½¬å‘äº† Node.jsï¼Œä½†åœ¨æœºå™¨å­¦ä¹ å’Œäººå·¥æ™ºèƒ½å·¥å…·ï¼ˆå¦‚ RAG å’Œ agentï¼‰æ–¹é¢ï¼ŒPython ä»ç„¶æ˜¯æœ€å¼ºçš„è¯­è¨€ã€‚æˆ‘ä»¬ç›®å‰å¯ä»¥æ¥å—è¿™ä¸ªæ”¹å˜ï¼Œä½†ä¸æ’é™¤æœªæ¥å¯èƒ½ä¼šé‡æ–°ä½¿ç”¨ Pythonã€‚</p>
</li>
</ol>
<h2 data-id="heading-5">æ€»ç»“</h2>
<p>è¿™æ¬¡è¿ç§»å¸¦æ¥äº†æ˜¾è‘—çš„æ€§èƒ½æå‡å’Œå¼€å‘æ•ˆç‡çš„æå‡ï¼ŒåŒæ—¶æˆ‘ä»¬ä¹Ÿå­¦åˆ°äº†å¾ˆå¤šã€‚è™½ç„¶è¿‡ç¨‹ä¸­é¢ä¸´äº†å¾ˆå¤šæŒ‘æˆ˜ï¼Œä½†æ•´ä½“æ¥çœ‹ï¼Œæˆ‘ä»¬å¯¹è¿™æ¬¡å†³å®šæ„Ÿåˆ°éå¸¸æ»¡æ„ã€‚</p>
<p>å¦‚æœä½ ä¹Ÿæ­£åœ¨é¢ä¸´ç±»ä¼¼çš„é€‰æ‹©ï¼Œè¿ç§»åˆ° Node.js æˆ–è®¸æ˜¯ä¸€ä¸ªå€¼å¾—è€ƒè™‘çš„é€‰é¡¹ï¼Œå°¤å…¶æ˜¯åœ¨ä½ å¯¹é«˜å¹¶å‘å’Œæ‰©å±•æ€§æœ‰è¾ƒé«˜è¦æ±‚çš„æƒ…å†µä¸‹ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vueç»„ä»¶é€šä¿¡ä¸å†éš¾ï¼è¿™8ç§æ–¹å¼è®©ä½ å½»åº•ææ‡‚çˆ¶å­å…„å¼Ÿä¼ å€¼]]></title>    <link>https://juejin.cn/post/7570923924365180991</link>    <guid>https://juejin.cn/post/7570923924365180991</guid>    <pubDate>2025-11-10T23:29:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570923924365180991" data-draft-id="7570899512782929983" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vueç»„ä»¶é€šä¿¡ä¸å†éš¾ï¼è¿™8ç§æ–¹å¼è®©ä½ å½»åº•ææ‡‚çˆ¶å­å…„å¼Ÿä¼ å€¼"/> <meta itemprop="keywords" content="Vue.js,å‰ç«¯,JavaScript"/> <meta itemprop="datePublished" content="2025-11-10T23:29:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è‰¯å±±æœ‰é£æ¥"/> <meta itemprop="url" content="https://juejin.cn/user/3940246036939358"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vueç»„ä»¶é€šä¿¡ä¸å†éš¾ï¼è¿™8ç§æ–¹å¼è®©ä½ å½»åº•ææ‡‚çˆ¶å­å…„å¼Ÿä¼ å€¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3940246036939358/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è‰¯å±±æœ‰é£æ¥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T23:29:25.000Z" title="Mon Nov 10 2025 23:29:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä½ æ˜¯ä¸æ˜¯ç»å¸¸é‡åˆ°è¿™æ ·çš„åœºæ™¯ï¼Ÿçˆ¶ç»„ä»¶çš„æ•°æ®è¦ä¼ ç»™å­ç»„ä»¶ï¼Œå­ç»„ä»¶çš„äº‹ä»¶è¦é€šçŸ¥çˆ¶ç»„ä»¶ï¼Œå…„å¼Ÿç»„ä»¶ä¹‹é—´è¦å…±äº«çŠ¶æ€...æ¯æ¬¡å†™Vueç»„ä»¶é€šä¿¡éƒ½è§‰å¾—å¤´å¤§ï¼Œä¸çŸ¥é“ç”¨å“ªç§æ–¹å¼æœ€åˆé€‚ï¼Ÿ</p>
<p>åˆ«æ‹…å¿ƒï¼ä»Šå¤©æˆ‘å°±å¸¦ä½ å½»åº•ææ‡‚Vueç»„ä»¶é€šä¿¡çš„8ç§æ ¸å¿ƒæ–¹å¼ï¼Œæ¯ç§æ–¹å¼éƒ½æœ‰è¯¦ç»†çš„ä»£ç ç¤ºä¾‹å’Œé€‚ç”¨åœºæ™¯åˆ†æã€‚çœ‹å®Œè¿™ç¯‡æ–‡ç« ï¼Œä½ å°±èƒ½æ ¹æ®å…·ä½“ä¸šåŠ¡åœºæ™¯é€‰æ‹©æœ€åˆé€‚çš„é€šä¿¡æ–¹æ¡ˆï¼Œå†ä¹Ÿä¸ç”¨ä¸ºç»„ä»¶é—´ä¼ å€¼å‘æ„äº†ï¼</p>
<h2 data-id="heading-0">Propsï¼šæœ€åŸºç¡€çš„çˆ¶å­é€šä¿¡</h2>
<p>Propsæ˜¯Vueä¸­æœ€åŸºç¡€ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„çˆ¶å­ç»„ä»¶é€šä¿¡æ–¹å¼ã€‚çˆ¶ç»„ä»¶é€šè¿‡å±æ€§å‘ä¸‹ä¼ é€’æ•°æ®ï¼Œå­ç»„ä»¶é€šè¿‡propsé€‰é¡¹æ¥æ”¶ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å­ç»„ä»¶ ChildComponent.vue</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>å­ç»„ä»¶æ¥æ”¶åˆ°çš„æ¶ˆæ¯ï¼š{{ message }}<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>ç”¨æˆ·å¹´é¾„ï¼š{{ userInfo.age }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-comment">// å®šä¹‰propsï¼Œå¯ä»¥æŒ‡å®šç±»å‹å’Œé»˜è®¤å€¼</span>
  <span class="hljs-attr">props</span>: {
    <span class="hljs-attr">message</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,
      <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>  <span class="hljs-comment">// å¿…é¡»ä¼ é€’è¿™ä¸ªprop</span>
    },
    <span class="hljs-attr">userInfo</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-title class_">Object</span>,
      <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> ({})  <span class="hljs-comment">// é»˜è®¤ç©ºå¯¹è±¡</span>
    }
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>

<span class="hljs-comment">// çˆ¶ç»„ä»¶ ParentComponent.vue</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">child-component</span> 
      <span class="hljs-attr">:message</span>=<span class="hljs-string">"parentMessage"</span> 
      <span class="hljs-attr">:user-info</span>=<span class="hljs-string">"userData"</span>
    /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ChildComponent</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./ChildComponent.vue'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">components</span>: { <span class="hljs-title class_">ChildComponent</span> },
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">parentMessage</span>: <span class="hljs-string">'æ¥è‡ªçˆ¶ç»„ä»¶çš„é—®å€™'</span>,
      <span class="hljs-attr">userData</span>: {
        <span class="hljs-attr">name</span>: <span class="hljs-string">'å°æ˜'</span>,
        <span class="hljs-attr">age</span>: <span class="hljs-number">25</span>
      }
    }
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<p>é€‚ç”¨åœºæ™¯ï¼šç®€å•çš„çˆ¶å­ç»„ä»¶æ•°æ®ä¼ é€’ï¼Œæ•°æ®æµæ¸…æ™°æ˜ç¡®ã€‚ä½†è¦æ³¨æ„ï¼Œpropsæ˜¯å•å‘æ•°æ®æµï¼Œå­ç»„ä»¶ä¸èƒ½ç›´æ¥ä¿®æ”¹propsã€‚</p>
<h2 data-id="heading-1">$emitï¼šå­ç»„ä»¶å‘çˆ¶ç»„ä»¶é€šä¿¡</h2>
<p>å½“å­ç»„ä»¶éœ€è¦å‘çˆ¶ç»„ä»¶ä¼ é€’æ•°æ®æˆ–è§¦å‘çˆ¶ç»„ä»¶çš„æŸä¸ªæ–¹æ³•æ—¶ï¼Œå°±éœ€è¦ç”¨åˆ°$emitã€‚å­ç»„ä»¶é€šè¿‡è§¦å‘è‡ªå®šä¹‰äº‹ä»¶ï¼Œçˆ¶ç»„ä»¶é€šè¿‡v-onç›‘å¬è¿™äº›äº‹ä»¶ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å­ç»„ä»¶ SubmitButton.vue</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"handleClick"</span>&gt;</span>
    æäº¤è¡¨å•
  <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"/>) {
      <span class="hljs-comment">// è§¦å‘è‡ªå®šä¹‰äº‹ä»¶ï¼Œå¹¶ä¼ é€’æ•°æ®</span>
      <span class="hljs-variable language_">this</span>.$emit(<span class="hljs-string">'form-submit'</span>, {
        <span class="hljs-attr">timestamp</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(),
        <span class="hljs-attr">formData</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">formData</span>
      })
    }
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>

<span class="hljs-comment">// çˆ¶ç»„ä»¶ FormContainer.vue</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">submit-button</span> @<span class="hljs-attr">form-submit</span>=<span class="hljs-string">"handleFormSubmit"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> <span class="hljs-title class_">SubmitButton</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./SubmitButton.vue'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">components</span>: { <span class="hljs-title class_">SubmitButton</span> },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">handleFormSubmit</span>(<span class="hljs-params">payload</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ¥æ”¶åˆ°å­ç»„ä»¶çš„æ•°æ®ï¼š'</span>, payload)
      <span class="hljs-comment">// è¿™é‡Œå¯ä»¥å¤„ç†è¡¨å•æäº¤é€»è¾‘</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">submitToServer</span>(payload.<span class="hljs-property">formData</span>)
    }
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<p>é€‚ç”¨åœºæ™¯ï¼šå­ç»„ä»¶éœ€è¦é€šçŸ¥çˆ¶ç»„ä»¶æŸä¸ªäº‹ä»¶å‘ç”Ÿï¼Œæˆ–è€…éœ€è¦ä¼ é€’æ•°æ®ç»™çˆ¶ç»„ä»¶å¤„ç†ã€‚</p>
<h2 data-id="heading-2">refï¼šç›´æ¥è®¿é—®å­ç»„ä»¶å®ä¾‹</h2>
<p>é€šè¿‡refå±æ€§ï¼Œçˆ¶ç»„ä»¶å¯ä»¥ç›´æ¥è®¿é—®å­ç»„ä»¶çš„å®ä¾‹ï¼Œè°ƒç”¨å…¶æ–¹æ³•æˆ–è®¿é—®å…¶æ•°æ®ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å­ç»„ä»¶ CustomInput.vue</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> 
    <span class="hljs-attr">ref</span>=<span class="hljs-string">"inputRef"</span> 
    <span class="hljs-attr">v-model</span>=<span class="hljs-string">"inputValue"</span> 
    <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span>
  /&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">inputValue</span>: <span class="hljs-string">''</span>
    }
  },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-comment">// å­ç»„ä»¶çš„è‡ªå®šä¹‰æ–¹æ³•</span>
    <span class="hljs-title function_">focus</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">$refs</span>.<span class="hljs-property">inputRef</span>.<span class="hljs-title function_">focus</span>()
    },
    <span class="hljs-title function_">clear</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">inputValue</span> = <span class="hljs-string">''</span>
    },
    <span class="hljs-title function_">getValue</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">inputValue</span>
    }
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>

<span class="hljs-comment">// çˆ¶ç»„ä»¶ ParentComponent.vue</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">custom-input</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"myInput"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"handleFocus"</span>&gt;</span>èšç„¦è¾“å…¥æ¡†<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"handleClear"</span>&gt;</span>æ¸…ç©ºè¾“å…¥æ¡†<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> <span class="hljs-title class_">CustomInput</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./CustomInput.vue'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">components</span>: { <span class="hljs-title class_">CustomInput</span> },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">handleFocus</span>(<span class="hljs-params"/>) {
      <span class="hljs-comment">// é€šè¿‡refç›´æ¥è°ƒç”¨å­ç»„ä»¶çš„æ–¹æ³•</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">$refs</span>.<span class="hljs-property">myInput</span>.<span class="hljs-title function_">focus</span>()
    },
    <span class="hljs-title function_">handleClear</span>(<span class="hljs-params"/>) {
      <span class="hljs-comment">// è°ƒç”¨å­ç»„ä»¶çš„æ¸…ç©ºæ–¹æ³•</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">$refs</span>.<span class="hljs-property">myInput</span>.<span class="hljs-title function_">clear</span>()
      
      <span class="hljs-comment">// ä¹Ÿå¯ä»¥ç›´æ¥è®¿é—®å­ç»„ä»¶çš„æ•°æ®ï¼ˆä¸æ¨èï¼‰</span>
      <span class="hljs-comment">// this.$refs.myInput.inputValue = ''</span>
    }
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<p>é€‚ç”¨åœºæ™¯ï¼šéœ€è¦ç›´æ¥æ“ä½œå­ç»„ä»¶çš„DOMå…ƒç´ æˆ–è°ƒç”¨å­ç»„ä»¶æ–¹æ³•çš„åœºæ™¯ã€‚ä½†è¦è°¨æ…ä½¿ç”¨ï¼Œé¿å…ç ´åç»„ä»¶çš„å°è£…æ€§ã€‚</p>
<h2 data-id="heading-3">Event Busï¼šä»»æ„ç»„ä»¶é—´é€šä¿¡</h2>
<p>Event Busé€šè¿‡åˆ›å»ºä¸€ä¸ªç©ºçš„Vueå®ä¾‹ä½œä¸ºäº‹ä»¶ä¸­å¿ƒï¼Œå®ç°ä»»æ„ç»„ä»¶é—´çš„é€šä¿¡ï¼Œç‰¹åˆ«é€‚åˆéçˆ¶å­ç»„ä»¶çš„æƒ…å†µã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// event-bus.js - åˆ›å»ºäº‹ä»¶æ€»çº¿</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">EventBus</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>()

<span class="hljs-comment">// ç»„ä»¶A - äº‹ä»¶å‘é€è€…</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"sendMessage"</span>&gt;</span>å‘é€å…¨å±€æ¶ˆæ¯<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">EventBus</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./event-bus'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">sendMessage</span>(<span class="hljs-params"/>) {
      <span class="hljs-comment">// è§¦å‘å…¨å±€äº‹ä»¶</span>
      <span class="hljs-title class_">EventBus</span>.$emit(<span class="hljs-string">'global-message'</span>, {
        <span class="hljs-attr">text</span>: <span class="hljs-string">'Hello from Component A!'</span>,
        <span class="hljs-attr">from</span>: <span class="hljs-string">'ComponentA'</span>
      })
    }
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>

<span class="hljs-comment">// ç»„ä»¶B - äº‹ä»¶ç›‘å¬è€…</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>æœ€æ–°æ¶ˆæ¯ï¼š{{ latestMessage }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">EventBus</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./event-bus'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">latestMessage</span>: <span class="hljs-string">''</span>
    }
  },
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// ç›‘å¬å…¨å±€äº‹ä»¶</span>
    <span class="hljs-title class_">EventBus</span>.$on(<span class="hljs-string">'global-message'</span>, <span class="hljs-function">(<span class="hljs-params">payload</span>) =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">latestMessage</span> = <span class="hljs-string">`<span class="hljs-subst">${payload.<span class="hljs-keyword">from</span>}</span> è¯´ï¼š<span class="hljs-subst">${payload.text}</span>`</span>
    })
  },
  <span class="hljs-title function_">beforeDestroy</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// ç»„ä»¶é”€æ¯å‰ç§»é™¤äº‹ä»¶ç›‘å¬ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼</span>
    <span class="hljs-title class_">EventBus</span>.$off(<span class="hljs-string">'global-message'</span>)
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<p>é€‚ç”¨åœºæ™¯ï¼šç®€å•çš„è·¨ç»„ä»¶é€šä¿¡ï¼Œå°å‹é¡¹ç›®ä¸­çš„çŠ¶æ€ç®¡ç†ã€‚ä½†åœ¨å¤æ‚é¡¹ç›®ä¸­å»ºè®®ä½¿ç”¨Vuexæˆ–Piniaã€‚</p>
<h2 data-id="heading-4">provide/injectï¼šä¾èµ–æ³¨å…¥</h2>
<p>provideå’Œinjectä¸»è¦ç”¨äºé«˜é˜¶ç»„ä»¶å¼€å‘ï¼Œå…è®¸ç¥–å…ˆç»„ä»¶å‘å…¶æ‰€æœ‰å­å­™åä»£æ³¨å…¥ä¾èµ–ï¼Œè€Œä¸éœ€è¦å±‚å±‚ä¼ é€’propsã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç¥–å…ˆç»„ä»¶ Ancestor.vue</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">middle-component</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-comment">// æä¾›æ•°æ®å’Œæ–¹æ³•</span>
  <span class="hljs-title function_">provide</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-comment">// æä¾›å“åº”å¼æ•°æ®</span>
      <span class="hljs-attr">appTheme</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">theme</span>,
      <span class="hljs-comment">// æä¾›æ–¹æ³•</span>
      <span class="hljs-attr">changeTheme</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">changeTheme</span>,
      <span class="hljs-comment">// æä¾›å¸¸é‡</span>
      <span class="hljs-attr">appName</span>: <span class="hljs-string">'æˆ‘çš„Vueåº”ç”¨'</span>
    }
  },
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">theme</span>: <span class="hljs-string">'dark'</span>
    }
  },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">changeTheme</span>(<span class="hljs-params">newTheme</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">theme</span> = newTheme
    }
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>

<span class="hljs-comment">// æ·±å±‚å­ç»„ä»¶ DeepChild.vue</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">"`theme-${appTheme}`"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>åº”ç”¨åç§°ï¼š{{ appName }}<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"changeTheme('light')"</span>&gt;</span>åˆ‡æ¢äº®è‰²ä¸»é¢˜<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"changeTheme('dark')"</span>&gt;</span>åˆ‡æ¢æš—è‰²ä¸»é¢˜<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-comment">// æ³¨å…¥ç¥–å…ˆç»„ä»¶æä¾›çš„æ•°æ®</span>
  <span class="hljs-attr">inject</span>: [<span class="hljs-string">'appTheme'</span>, <span class="hljs-string">'changeTheme'</span>, <span class="hljs-string">'appName'</span>],
  
  <span class="hljs-comment">// ä¹Ÿå¯ä»¥æŒ‡å®šé»˜è®¤å€¼å’Œæ¥æº</span>
  <span class="hljs-comment">// inject: {</span>
  <span class="hljs-comment">//   theme: {</span>
  <span class="hljs-comment">//     from: 'appTheme',</span>
  <span class="hljs-comment">//     default: 'light'</span>
  <span class="hljs-comment">//   }</span>
  <span class="hljs-comment">// }</span>
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<p>é€‚ç”¨åœºæ™¯ï¼šç»„ä»¶å±‚çº§å¾ˆæ·±ï¼Œéœ€è¦é¿å…propsé€å±‚ä¼ é€’çš„éº»çƒ¦ã€‚å¸¸ç”¨äºå¼€å‘ç»„ä»¶åº“æˆ–å¤§å‹åº”ç”¨çš„åŸºç¡€é…ç½®ã€‚</p>
<h2 data-id="heading-5"><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>t</mi><mi>t</mi><mi>r</mi><mi>s</mi><mi mathvariant="normal">/</mi></mrow><annotation encoding="application/x-tex">attrs/</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">a</span><span class="mord mathnormal">tt</span><span class="mord mathnormal">rs</span><span class="mord">/</span></span></span></span></span>listenersï¼šè·¨å±‚çº§å±æ€§ä¼ é€’</h2>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>t</mi><mi>t</mi><mi>r</mi><mi>s</mi><mtext>åŒ…å«äº†çˆ¶ç»„ä»¶ä¼ å…¥çš„æ‰€æœ‰é</mtext><mi>p</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>s</mi><mtext>å±æ€§ï¼Œ</mtext></mrow><annotation encoding="application/x-tex">attrsåŒ…å«äº†çˆ¶ç»„ä»¶ä¼ å…¥çš„æ‰€æœ‰épropså±æ€§ï¼Œ</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"/><span class="mord mathnormal">a</span><span class="mord mathnormal">tt</span><span class="mord mathnormal">rs</span><span class="mord cjk_fallback">åŒ…å«äº†çˆ¶ç»„ä»¶ä¼ å…¥çš„æ‰€æœ‰é</span><span class="mord mathnormal">p</span><span class="mord mathnormal">ro</span><span class="mord mathnormal">p</span><span class="mord mathnormal">s</span><span class="mord cjk_fallback">å±æ€§ï¼Œ</span></span></span></span></span>listenersåŒ…å«äº†çˆ¶ç»„ä»¶ä¼ å…¥çš„æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨ï¼Œå¯ä»¥ç”¨äºåˆ›å»ºé«˜é˜¶ç»„ä»¶ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¸­é—´ç»„ä»¶ MiddleComponent.vue</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- ä¼ é€’æ‰€æœ‰å±æ€§å’Œäº‹ä»¶åˆ°å­ç»„ä»¶ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">child-component</span> <span class="hljs-attr">v-bind</span>=<span class="hljs-string">"$attrs"</span> <span class="hljs-attr">v-on</span>=<span class="hljs-string">"$listeners"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ChildComponent</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./ChildComponent.vue'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">components</span>: { <span class="hljs-title class_">ChildComponent</span> },
  <span class="hljs-attr">inheritAttrs</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// ä¸è®©å±æ€§ç»‘å®šåˆ°æ ¹å…ƒç´ </span>
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'$attrs:'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">$attrs</span>) <span class="hljs-comment">// æ‰€æœ‰épropså±æ€§</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'$listeners:'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">$listeners</span>) <span class="hljs-comment">// æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨</span>
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>

<span class="hljs-comment">// æœ€ç»ˆå­ç»„ä»¶ ChildComponent.vue</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
    <span class="hljs-attr">v-bind</span>=<span class="hljs-string">"$attrs"</span>
    <span class="hljs-attr">v-on</span>=<span class="hljs-string">"$listeners"</span>
    <span class="hljs-attr">class</span>=<span class="hljs-string">"custom-input"</span>
  /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// å¯ä»¥ç›´æ¥ä½¿ç”¨çˆ¶ç»„ä»¶ä¼ é€’çš„æ‰€æœ‰å±æ€§å’Œäº‹ä»¶</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ¥æ”¶åˆ°çš„å±æ€§ï¼š'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">$attrs</span>)
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>

<span class="hljs-comment">// çˆ¶ç»„ä»¶ä½¿ç”¨</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">middle-component</span>
    <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"è¯·è¾“å…¥å†…å®¹"</span>
    <span class="hljs-attr">maxlength</span>=<span class="hljs-string">"20"</span>
    @<span class="hljs-attr">focus</span>=<span class="hljs-string">"handleFocus"</span>
    @<span class="hljs-attr">blur</span>=<span class="hljs-string">"handleBlur"</span>
  /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>
</code></pre>
<p>é€‚ç”¨åœºæ™¯ï¼šåˆ›å»ºåŒ…è£…ç»„ä»¶ã€é«˜é˜¶ç»„ä»¶ï¼Œéœ€è¦é€ä¼ å±æ€§å’Œäº‹ä»¶çš„åœºæ™¯ã€‚</p>
<h2 data-id="heading-6">Vuexï¼šé›†ä¸­å¼çŠ¶æ€ç®¡ç†</h2>
<p>Vuexæ˜¯Vueçš„å®˜æ–¹çŠ¶æ€ç®¡ç†åº“ï¼Œé€‚ç”¨äºä¸­å¤§å‹å¤æ‚åº”ç”¨çš„çŠ¶æ€ç®¡ç†ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// store/index.js</span>
<span class="hljs-keyword">import</span> { createStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'vuex'</span>

<span class="hljs-keyword">const</span> store = <span class="hljs-title function_">createStore</span>({
  <span class="hljs-title function_">state</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">user</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span>
    }
  },
  <span class="hljs-attr">mutations</span>: {
    <span class="hljs-comment">// åŒæ­¥ä¿®æ”¹çŠ¶æ€</span>
    <span class="hljs-title function_">increment</span>(<span class="hljs-params">state</span>) {
      state.<span class="hljs-property">count</span>++
    },
    <span class="hljs-title function_">setUser</span>(<span class="hljs-params">state, user</span>) {
      state.<span class="hljs-property">user</span> = user
    },
    <span class="hljs-title function_">setLoading</span>(<span class="hljs-params">state, loading</span>) {
      state.<span class="hljs-property">loading</span> = loading
    }
  },
  <span class="hljs-attr">actions</span>: {
    <span class="hljs-comment">// å¼‚æ­¥æ“ä½œ</span>
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">login</span>(<span class="hljs-params">{ commit }, credentials</span>) {
      <span class="hljs-title function_">commit</span>(<span class="hljs-string">'setLoading'</span>, <span class="hljs-literal">true</span>)
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> api.<span class="hljs-title function_">login</span>(credentials)
        <span class="hljs-title function_">commit</span>(<span class="hljs-string">'setUser'</span>, user)
        <span class="hljs-keyword">return</span> user
      } <span class="hljs-keyword">finally</span> {
        <span class="hljs-title function_">commit</span>(<span class="hljs-string">'setLoading'</span>, <span class="hljs-literal">false</span>)
      }
    }
  },
  <span class="hljs-attr">getters</span>: {
    <span class="hljs-comment">// è®¡ç®—å±æ€§</span>
    <span class="hljs-attr">isLoggedIn</span>: <span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> !!state.<span class="hljs-property">user</span>,
    <span class="hljs-attr">doubleCount</span>: <span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> state.<span class="hljs-property">count</span> * <span class="hljs-number">2</span>
  }
})

<span class="hljs-comment">// ç»„ä»¶ä¸­ä½¿ç”¨</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>è®¡æ•°å™¨ï¼š{{ count }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>åŒå€è®¡æ•°ï¼š{{ doubleCount }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"isLoggedIn"</span>&gt;</span>æ¬¢è¿ï¼Œ{{ user.name }}ï¼<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"increment"</span>&gt;</span>å¢åŠ <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"login"</span> <span class="hljs-attr">:disabled</span>=<span class="hljs-string">"loading"</span>&gt;</span>
      {{ loading ? 'ç™»å½•ä¸­...' : 'ç™»å½•' }}
    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { mapState, mapGetters, mapMutations, mapActions } <span class="hljs-keyword">from</span> <span class="hljs-string">'vuex'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">computed</span>: {
    <span class="hljs-comment">// æ˜ å°„stateå’Œgettersåˆ°è®¡ç®—å±æ€§</span>
    ...<span class="hljs-title function_">mapState</span>([<span class="hljs-string">'count'</span>, <span class="hljs-string">'user'</span>, <span class="hljs-string">'loading'</span>]),
    ...<span class="hljs-title function_">mapGetters</span>([<span class="hljs-string">'doubleCount'</span>, <span class="hljs-string">'isLoggedIn'</span>])
  },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-comment">// æ˜ å°„mutationså’Œactionsåˆ°æ–¹æ³•</span>
    ...<span class="hljs-title function_">mapMutations</span>([<span class="hljs-string">'increment'</span>]),
    ...<span class="hljs-title function_">mapActions</span>([<span class="hljs-string">'login'</span>])
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<p>é€‚ç”¨åœºæ™¯ï¼šä¸­å¤§å‹å¤æ‚åº”ç”¨ï¼Œå¤šä¸ªç»„ä»¶éœ€è¦å…±äº«çŠ¶æ€ï¼Œéœ€è¦ä¸¥æ ¼çš„çŠ¶æ€ç®¡ç†æµç¨‹ã€‚</p>
<h2 data-id="heading-7">Piniaï¼šæ–°ä¸€ä»£çŠ¶æ€ç®¡ç†</h2>
<p>Piniaæ˜¯Vueå®˜æ–¹æ¨èçš„æ–°ä¸€ä»£çŠ¶æ€ç®¡ç†åº“ï¼Œç›¸æ¯”Vuexæ›´åŠ è½»é‡ã€ç›´è§‚ï¼Œå¹¶ä¸”å®Œç¾æ”¯æŒTypeScriptã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// stores/counter.js</span>
<span class="hljs-keyword">import</span> { defineStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useCounterStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'counter'</span>, {
  <span class="hljs-attr">state</span>: <span class="hljs-function">() =&gt;</span> ({
    <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'æˆ‘çš„è®¡æ•°å™¨'</span>
  }),
  
  <span class="hljs-attr">getters</span>: {
    <span class="hljs-attr">doubleCount</span>: <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> state.<span class="hljs-property">count</span> * <span class="hljs-number">2</span>,
    <span class="hljs-comment">// ä½¿ç”¨thisè®¿é—®å…¶ä»–getter</span>
    <span class="hljs-title function_">doubleCountPlusOne</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">doubleCount</span> + <span class="hljs-number">1</span>
    }
  },
  
  <span class="hljs-attr">actions</span>: {
    <span class="hljs-title function_">increment</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++
    },
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">incrementAsync</span>(<span class="hljs-params"/>) {
      <span class="hljs-comment">// å¼‚æ­¥action</span>
      <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">1000</span>))
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">increment</span>()
    },
    <span class="hljs-title function_">reset</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> = <span class="hljs-number">0</span>
    }
  }
})

<span class="hljs-comment">// ç»„ä»¶ä¸­ä½¿ç”¨</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>{{ name }}<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>å½“å‰è®¡æ•°ï¼š{{ count }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>åŒå€è®¡æ•°ï¼š{{ doubleCount }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"increment"</span>&gt;</span>å¢åŠ <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"incrementAsync"</span>&gt;</span>å¼‚æ­¥å¢åŠ <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"reset"</span>&gt;</span>é‡ç½®<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { useCounterStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/stores/counter'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title function_">setup</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> counterStore = <span class="hljs-title function_">useCounterStore</span>()
    
    <span class="hljs-comment">// å¯ä»¥ç›´æ¥è§£æ„ï¼Œä½†ä¼šå¤±å»å“åº”å¼</span>
    <span class="hljs-comment">// ä½¿ç”¨storeToRefsä¿æŒå“åº”å¼</span>
    <span class="hljs-keyword">const</span> { name, count, doubleCount } = counterStore
    
    <span class="hljs-keyword">return</span> {
      <span class="hljs-comment">// stateå’Œgetters</span>
      name,
      count,
      doubleCount,
      <span class="hljs-comment">// actions</span>
      <span class="hljs-attr">increment</span>: counterStore.<span class="hljs-property">increment</span>,
      <span class="hljs-attr">incrementAsync</span>: counterStore.<span class="hljs-property">incrementAsync</span>,
      <span class="hljs-attr">reset</span>: counterStore.<span class="hljs-property">reset</span>
    }
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>

<span class="hljs-comment">// åœ¨å¤šä¸ªstoreä¹‹é—´äº¤äº’</span>
<span class="hljs-keyword">import</span> { useUserStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/stores/user'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useCartStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'cart'</span>, {
  <span class="hljs-attr">actions</span>: {
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">checkout</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">const</span> userStore = <span class="hljs-title function_">useUserStore</span>()
      
      <span class="hljs-keyword">if</span> (!userStore.<span class="hljs-property">isLoggedIn</span>) {
        <span class="hljs-keyword">await</span> userStore.<span class="hljs-title function_">login</span>()
      }
      
      <span class="hljs-comment">// ç»“è´¦é€»è¾‘...</span>
    }
  }
})
</code></pre>
<p>é€‚ç”¨åœºæ™¯ï¼šç°ä»£Vueåº”ç”¨çš„çŠ¶æ€ç®¡ç†ï¼Œç‰¹åˆ«æ˜¯éœ€è¦TypeScriptæ”¯æŒå’Œæ›´ç®€æ´APIçš„é¡¹ç›®ã€‚</p>
<h2 data-id="heading-8">å®æˆ˜åœºæ™¯é€‰æ‹©æŒ‡å—</h2>
<p>ç°åœ¨ä½ å·²ç»äº†è§£äº†8ç§Vueç»„ä»¶é€šä¿¡æ–¹å¼ï¼Œä½†åœ¨å®é™…å¼€å‘ä¸­è¯¥å¦‚ä½•é€‰æ‹©å‘¢ï¼Ÿæˆ‘æ¥ç»™ä½ ä¸€äº›å®ç”¨å»ºè®®ï¼š</p>
<p>å¦‚æœæ˜¯ç®€å•çš„çˆ¶å­ç»„ä»¶é€šä¿¡ï¼Œä¼˜å…ˆè€ƒè™‘propså’Œ$emitï¼Œè¿™æ˜¯æœ€ç›´æ¥çš„æ–¹å¼ã€‚</p>
<p>å½“ç»„ä»¶å±‚çº§è¾ƒæ·±ï¼Œéœ€è¦é¿å…propsé€å±‚ä¼ é€’æ—¶ï¼Œprovide/injectæ˜¯ä¸é”™çš„é€‰æ‹©ã€‚</p>
<p>å¯¹äºéçˆ¶å­ç»„ä»¶é—´çš„ç®€å•é€šä¿¡ï¼ŒEvent Buså¯ä»¥å¿«é€Ÿè§£å†³é—®é¢˜ï¼Œä½†è¦æ³¨æ„äº‹ä»¶ç®¡ç†ã€‚</p>
<p>åœ¨éœ€è¦åˆ›å»ºé«˜é˜¶ç»„ä»¶æˆ–åŒ…è£…ç»„ä»¶æ—¶ï¼Œ<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>t</mi><mi>t</mi><mi>r</mi><mi>s</mi><mtext>å’Œ</mtext></mrow><annotation encoding="application/x-tex">attrså’Œ</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">a</span><span class="mord mathnormal">tt</span><span class="mord mathnormal">rs</span><span class="mord cjk_fallback">å’Œ</span></span></span></span></span>listenersèƒ½å¤§å¤§ç®€åŒ–ä»£ç ã€‚</p>
<p>å¯¹äºä¸­å¤§å‹å¤æ‚åº”ç”¨ï¼Œéœ€è¦é›†ä¸­ç®¡ç†çŠ¶æ€æ—¶ï¼ŒVuexæˆ–Piniaæ˜¯å¿…å¤‡çš„ã€‚ä¸ªäººæ›´æ¨èPiniaï¼Œå› ä¸ºå®ƒæ›´ç°ä»£ã€æ›´ç®€æ´ã€‚</p>
<p>å¦‚æœéœ€è¦ç›´æ¥æ“ä½œå­ç»„ä»¶ï¼Œrefæä¾›äº†æœ€ç›´æ¥çš„æ–¹å¼ï¼Œä½†è¦è°¨æ…ä½¿ç”¨ä»¥ä¿æŒç»„ä»¶çš„å°è£…æ€§ã€‚</p>
<p>è®°ä½ï¼Œæ²¡æœ‰æœ€å¥½çš„é€šä¿¡æ–¹å¼ï¼Œåªæœ‰æœ€é€‚åˆå½“å‰åœºæ™¯çš„æ–¹å¼ã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå¾€å¾€æ˜¯å¤šç§æ–¹å¼ç»“åˆä½¿ç”¨ã€‚</p>
<h2 data-id="heading-9">å†™åœ¨æœ€å</h2>
<p>ç»„ä»¶é€šä¿¡æ˜¯Vueå¼€å‘ä¸­çš„æ ¸å¿ƒæŠ€èƒ½ï¼ŒæŒæ¡è¿™äº›é€šä¿¡æ–¹å¼å°±åƒæŒæ¡äº†ç»„ä»¶é—´çš„"å¯¹è¯è¯­è¨€"ã€‚ä»ç®€å•çš„props/$emitåˆ°å¤æ‚çš„PiniaçŠ¶æ€ç®¡ç†ï¼Œæ¯ç§æ–¹å¼éƒ½æœ‰å…¶ç‹¬ç‰¹çš„ä»·å€¼å’Œé€‚ç”¨åœºæ™¯ã€‚</p>
<p>å…³é”®æ˜¯è¦ç†è§£æ¯ç§æ–¹å¼çš„åŸç†å’Œä¼˜ç¼ºç‚¹ï¼Œåœ¨å®é™…å¼€å‘ä¸­æ ¹æ®ç»„ä»¶å…³ç³»ã€æ•°æ®æµå¤æ‚åº¦ã€é¡¹ç›®è§„æ¨¡ç­‰å› ç´ åšå‡ºåˆé€‚çš„é€‰æ‹©ã€‚</p>
<p>ä½ ç°åœ¨å¯¹Vueç»„ä»¶é€šä¿¡æ˜¯ä¸æ˜¯æœ‰äº†æ›´æ¸…æ™°çš„è®¤è¯†ï¼Ÿåœ¨å®é™…é¡¹ç›®ä¸­ï¼Œä½ æœ€å–œæ¬¢ç”¨å“ªç§é€šä¿¡æ–¹å¼ï¼Ÿæœ‰æ²¡æœ‰é‡åˆ°è¿‡ç‰¹åˆ«çš„é€šä¿¡éš¾é¢˜ï¼Ÿæ¬¢è¿åœ¨è¯„è®ºåŒºåˆ†äº«ä½ çš„ç»éªŒå’Œå¿ƒå¾—ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸ“˜ å…¨é¢è§£æï¼šJavaScript æ—¶é—´æ ¼å¼åŒ– API å®æˆ˜æŒ‡å—]]></title>    <link>https://juejin.cn/post/7570932873131966491</link>    <guid>https://juejin.cn/post/7570932873131966491</guid>    <pubDate>2025-11-10T23:31:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570932873131966491" data-draft-id="7570978150009667622" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸ“˜ å…¨é¢è§£æï¼šJavaScript æ—¶é—´æ ¼å¼åŒ– API å®æˆ˜æŒ‡å—"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-10T23:31:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="excel"/> <meta itemprop="url" content="https://juejin.cn/user/2911162520062862"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸ“˜ å…¨é¢è§£æï¼šJavaScript æ—¶é—´æ ¼å¼åŒ– API å®æˆ˜æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2911162520062862/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    excel
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T23:31:09.000Z" title="Mon Nov 10 2025 23:31:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>â€”â€”ä» <code>toUTCString()</code> åˆ° <code>Intl.DateTimeFormat</code> çš„æ·±åº¦ç†è§£</p>
<p>æ—¶é—´ä¸æ—¥æœŸï¼Œæ˜¯å‰ç«¯å¼€å‘ä¸­æœ€å®¹æ˜“â€œè¸©å‘â€çš„éƒ¨åˆ†ã€‚ä¸åŒæµè§ˆå™¨ã€ä¸åŒåŒºåŸŸã€ç”šè‡³ä¸åŒç³»ç»Ÿè¯­è¨€ï¼Œéƒ½ä¼šé€ æˆè¾“å‡ºä¸ä¸€è‡´ã€‚<br/>
æœ¬æ–‡å°†ç³»ç»Ÿè§£æ JavaScript æä¾›çš„æ—¶é—´æ ¼å¼åŒ–æ–¹æ³•ï¼Œå¸®ä½ å½»åº•ææ‡‚å®ƒä»¬çš„å·®å¼‚ã€ç”¨é€”ä¸æ­£ç¡®ä½¿ç”¨æ–¹å¼ã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€èƒŒæ™¯ï¼šä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¹ˆå¤šæ—¶é—´æ ¼å¼åŒ–æ–¹æ³•ï¼Ÿ</h2>
<p>JavaScript çš„æ—¶é—´ç³»ç»ŸåŸºäº <strong>ECMAScript æ—¶é—´æ ‡å‡†</strong>ï¼Œæ—¶é—´ç‚¹ä»¥ UTC ä¸ºåŸºå‡†ï¼ˆUnix Epochï¼š1970-01-01 00:00:00 UTCï¼‰ã€‚<br/>
ä½†ç”±äºå‰ç«¯ä»£ç è¿è¡Œåœ¨ä¸åŒåœ°åŸŸçš„ç”¨æˆ·è®¾å¤‡ä¸­ï¼Œæ‰€ä»¥ï¼š</p>
<ul>
<li>ä¸€éƒ¨åˆ†æ–¹æ³•è¾“å‡º<strong>å›½é™…æ ‡å‡†æ ¼å¼</strong>ï¼ˆæœºå™¨å¯è¯»ï¼‰ï¼›</li>
<li>ä¸€éƒ¨åˆ†æ–¹æ³•è¾“å‡º<strong>æœ¬åœ°åŒ–æ ¼å¼</strong>ï¼ˆç”¨æˆ·å¯è¯»ï¼‰ï¼›</li>
<li>ä¸€éƒ¨åˆ†æ–¹æ³•æ”¯æŒ<strong>è‡ªå®šä¹‰åŒºåŸŸã€æ—¶åŒºå’Œæ ¼å¼</strong>ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-1">äºŒã€æ ¸å¿ƒ API æ€»è§ˆè¡¨</h2>





























































<table><thead><tr><th>æ–¹æ³•</th><th>æ—¶åŒº</th><th>æ˜¯å¦æœ¬åœ°åŒ–</th><th>æ˜¯å¦å¯å®šåˆ¶</th><th>è¾“å‡ºç¤ºä¾‹</th><th>ä¸»è¦ç”¨é€”</th></tr></thead><tbody><tr><td><code>toString()</code></td><td>æœ¬åœ°æ—¶é—´</td><td>å¦</td><td>å¦</td><td><code>"Tue Nov 11 2025 17:00:00 GMT+0800 (China Standard Time)"</code></td><td>è°ƒè¯•/é»˜è®¤è¾“å‡º</td></tr><tr><td><code>toUTCString()</code></td><td>UTC</td><td>å¦</td><td>å¦</td><td><code>"Tue, 11 Nov 2025 09:00:00 GMT"</code></td><td>æ ‡å‡†åŒ–è¾“å‡ºï¼ˆæ—¥å¿—/HTTPï¼‰</td></tr><tr><td><code>toGMTString()</code></td><td>UTC</td><td>å¦</td><td>å¦</td><td><code>"Tue, 11 Nov 2025 09:00:00 GMT"</code></td><td>å†å²é—ç•™ï¼ˆä¸æ¨èï¼‰</td></tr><tr><td><code>toISOString()</code></td><td>UTC</td><td>å¦</td><td>å¦</td><td><code>"2025-11-11T09:00:00.000Z"</code></td><td>æ•°æ®äº¤æ¢ï¼ˆJSON/HTTPï¼‰</td></tr><tr><td><code>toLocaleString()</code></td><td>æœ¬åœ°æ—¶åŒº</td><td>âœ… æ˜¯</td><td>âœ… æ˜¯</td><td><code>"2025/11/11 17:00:00"</code></td><td>ç”¨æˆ·ç•Œé¢æ˜¾ç¤º</td></tr><tr><td><code>Intl.DateTimeFormat</code></td><td>ä»»æ„æŒ‡å®š</td><td>âœ… æ˜¯</td><td>âœ… æ˜¯</td><td><code>"11 November 2025, 17:00:00"</code></td><td>å®Œå…¨å¯æ§æœ¬åœ°åŒ–è¾“å‡º</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-2">ä¸‰ã€é€ä¸ªè¯¦è§£ä¸ä»£ç ç¤ºä¾‹</h2>
<hr/>
<h3 data-id="heading-3">â‘  <code>toUTCString()</code></h3>
<p><strong>ç”¨é€”</strong>ï¼šè¾“å‡º UTC æ—¶é—´çš„ RFC1123 æ ‡å‡†æ ¼å¼<br/>
<strong>è¯­æ³•</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">date.toUTCString()<span class="hljs-comment">;</span>
</code></pre>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> d = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2025-11-11T09:00:00Z'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(d.<span class="hljs-title function_">toUTCString</span>());
<span class="hljs-comment">// "Tue, 11 Nov 2025 09:00:00 GMT"</span>
</code></pre>
<p><strong>ç‰¹æ€§ï¼š</strong></p>
<ul>
<li>è¾“å‡ºå›ºå®šæ ¼å¼ï¼Œä¸å¯é…ç½®ï¼›</li>
<li>å¸¸ç”¨äºæ—¥å¿—ã€HTTP Headerï¼›</li>
<li>ä¸å—ç³»ç»ŸåŒºåŸŸå½±å“ã€‚</li>
</ul>
<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// è®¾ç½® HTTP å“åº”å¤´</span>
response.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Expires'</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() + <span class="hljs-number">3600000</span>).<span class="hljs-title function_">toUTCString</span>());
</code></pre>
<hr/>
<h3 data-id="heading-4">â‘¡ <code>toGMTString()</code>ï¼ˆå·²åºŸå¼ƒï¼‰</h3>
<p><strong>ç”¨é€”</strong>ï¼š<code>toUTCString()</code> çš„æ—§ç‰ˆæœ¬ï¼Œæ—©æœŸ Netscape/IE å…¼å®¹æ¥å£ã€‚<br/>
<strong>è¯­æ³•ï¼š</strong></p>
<pre><code class="hljs language-ini" lang="ini">date.toGMTString()<span class="hljs-comment">;</span>
</code></pre>
<p><strong>è¯´æ˜ï¼š</strong></p>
<ul>
<li>åœ¨ç°ä»£æµè§ˆå™¨ä¸­è¡Œä¸ºä¸ <code>toUTCString()</code> ç›¸åŒï¼›</li>
<li>ECMAScript å·²æ ‡è®°ä¸º <strong>deprecated</strong>ï¼›</li>
<li>ä¸æ¨èä½¿ç”¨ï¼Œä»…å…¼å®¹è€é¡¹ç›®ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-5">â‘¢ <code>toLocaleString()</code></h3>
<p><strong>ç”¨é€”</strong>ï¼šè¾“å‡ºä¸ç”¨æˆ·åœ°åŒºè¯­è¨€ç›¸ç¬¦çš„æœ¬åœ°åŒ–æ—¶é—´å­—ç¬¦ä¸²ã€‚<br/>
<strong>è¯­æ³•ï¼š</strong></p>
<pre><code class="hljs language-ini" lang="ini">date.toLocaleString(<span class="hljs-section">[locales]</span>, <span class="hljs-section">[options]</span>)<span class="hljs-comment">;</span>
</code></pre>
<p><strong>å‚æ•°è¯´æ˜ï¼š</strong></p>




















<table><thead><tr><th>å‚æ•°</th><th>ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>locales</code></td><td>string æˆ– string[]</td><td>è¯­è¨€ä»£ç ï¼ˆå¦‚ <code>'zh-CN'</code>, <code>'en-US'</code>ï¼‰</td></tr><tr><td><code>options</code></td><td>object</td><td>æ ¼å¼åŒ–é€‰é¡¹</td></tr></tbody></table>
<p><strong>å¸¸ç”¨é€‰é¡¹ï¼š</strong></p>
<pre><code class="hljs language-sql" lang="sql">{
  timeZone: <span class="hljs-string">'Asia/Shanghai'</span>, <span class="hljs-operator">/</span><span class="hljs-operator">/</span> æŒ‡å®šæ—¶åŒº
  <span class="hljs-keyword">year</span>: <span class="hljs-string">'numeric'</span>,
  <span class="hljs-keyword">month</span>: <span class="hljs-string">'2-digit'</span>,
  <span class="hljs-keyword">day</span>: <span class="hljs-string">'2-digit'</span>,
  <span class="hljs-keyword">hour</span>: <span class="hljs-string">'2-digit'</span>,
  <span class="hljs-keyword">minute</span>: <span class="hljs-string">'2-digit'</span>,
  <span class="hljs-keyword">second</span>: <span class="hljs-string">'2-digit'</span>,
  hour12: <span class="hljs-literal">false</span>
}
</code></pre>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> d = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2025-11-11T09:00:00Z'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(d.<span class="hljs-title function_">toLocaleString</span>(<span class="hljs-string">'zh-CN'</span>, { <span class="hljs-attr">timeZone</span>: <span class="hljs-string">'Asia/Shanghai'</span> }));
<span class="hljs-comment">// "2025/11/11 17:00:00"</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(d.<span class="hljs-title function_">toLocaleString</span>(<span class="hljs-string">'en-US'</span>, { <span class="hljs-attr">timeZone</span>: <span class="hljs-string">'America/New_York'</span> }));
<span class="hljs-comment">// "11/11/2025, 4:00:00 AM"</span>
</code></pre>
<p>âœ… <strong>å¯æœ¬åœ°åŒ–ã€å¯æ§ã€æœ€çµæ´»ã€‚</strong></p>
<hr/>
<h3 data-id="heading-6">â‘£ <code>toISOString()</code></h3>
<p><strong>ç”¨é€”</strong>ï¼šè¾“å‡º ISO 8601 æ ‡å‡†çš„ UTC æ—¶é—´å­—ç¬¦ä¸²ã€‚<br/>
<strong>è¯­æ³•ï¼š</strong></p>
<pre><code class="hljs language-ini" lang="ini">date.toISOString()<span class="hljs-comment">;</span>
</code></pre>
<p><strong>è¾“å‡ºç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2025-11-11T09:00:00Z'</span>).<span class="hljs-title function_">toISOString</span>();
<span class="hljs-comment">// "2025-11-11T09:00:00.000Z"</span>
</code></pre>
<p><strong>ç‰¹æ€§ï¼š</strong></p>
<ul>
<li>è¾“å‡ºå›ºå®šæ ¼å¼ï¼›</li>
<li>ç²¾ç¡®åˆ°æ¯«ç§’ï¼›</li>
<li>å¸¸ç”¨äº JSON / æ•°æ®äº¤æ¢ï¼›</li>
<li>Node.js å’Œåç«¯ç³»ç»Ÿé«˜åº¦å…¼å®¹ã€‚</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-css" lang="css">JSON<span class="hljs-selector-class">.stringify</span>({ createdAt: new <span class="hljs-built_in">Date</span>().<span class="hljs-built_in">toISOString</span>() });
</code></pre>
<hr/>
<h3 data-id="heading-7">â‘¤ <code>Intl.DateTimeFormat</code></h3>
<p><strong>ç”¨é€”</strong>ï¼šæä¾›å¼ºå¤§çš„å›½é™…åŒ–æ—¶é—´æ ¼å¼åŒ–èƒ½åŠ›ã€‚<br/>
<strong>è¯­æ³•ï¼š</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Intl</span>.<span class="hljs-title class_">DateTimeFormat</span>(locales, options).<span class="hljs-title function_">format</span>(date);
</code></pre>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> d = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2025-11-11T09:00:00Z'</span>);
<span class="hljs-keyword">const</span> fmt = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intl</span>.<span class="hljs-title class_">DateTimeFormat</span>(<span class="hljs-string">'en-GB'</span>, {
  <span class="hljs-attr">timeZone</span>: <span class="hljs-string">'UTC'</span>,
  <span class="hljs-attr">dateStyle</span>: <span class="hljs-string">'full'</span>,
  <span class="hljs-attr">timeStyle</span>: <span class="hljs-string">'long'</span>
});
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fmt.<span class="hljs-title function_">format</span>(d));
<span class="hljs-comment">// "Tuesday, 11 November 2025 at 09:00:00 GMT"</span>
</code></pre>
<p><strong>æ›´ç»†ç²’åº¦æ§åˆ¶ï¼š</strong></p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">custom</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intl</span>.<span class="hljs-title function_ invoke__">DateTimeFormat</span>(<span class="hljs-string">'zh-CN'</span>, {
  <span class="hljs-attr">timeZone</span>: <span class="hljs-string">'Asia/Shanghai'</span>,
  <span class="hljs-attr">year</span>: <span class="hljs-string">'numeric'</span>,
  <span class="hljs-attr">month</span>: <span class="hljs-string">'long'</span>,
  <span class="hljs-attr">day</span>: <span class="hljs-string">'numeric'</span>,
  <span class="hljs-attr">weekday</span>: <span class="hljs-string">'long'</span>,
  <span class="hljs-attr">hour</span>: <span class="hljs-string">'2-digit'</span>,
  <span class="hljs-attr">minute</span>: <span class="hljs-string">'2-digit'</span>
});
console.<span class="hljs-title function_ invoke__">log</span>(custom.<span class="hljs-title function_ invoke__">format</span>(d));
<span class="hljs-comment">// "2025å¹´11æœˆ11æ—¥æ˜ŸæœŸäºŒ 17:00"</span>
</code></pre>
<p>âœ… æ”¯æŒï¼š</p>
<ul>
<li>æ—¶åŒºåˆ‡æ¢ï¼›</li>
<li>å¤šè¯­è¨€ï¼›</li>
<li>é•¿çŸ­æ—¥æœŸæ ¼å¼ï¼›</li>
<li>æ˜ŸæœŸæ˜¾ç¤ºï¼›</li>
<li>æœ¬åœ°åŒ–æ•°å­—ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-8">å››ã€å¯¹æ¯”å®æµ‹ï¼šåŒä¸€ä¸ªæ—¶é—´ï¼Œä¸åŒè¾“å‡º</h2>
<pre><code class="hljs language-vbscript" lang="vbscript"><span class="hljs-keyword">const</span> d = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-comment">'2025-11-11T09:00:00Z');</span>

console.<span class="hljs-built_in">log</span>(d.<span class="hljs-keyword">to</span><span class="hljs-built_in">String</span>());         // <span class="hljs-string">"Tue Nov 11 2025 17:00:00 GMT+0800 (China Standard Time)"</span>
console.<span class="hljs-built_in">log</span>(d.toUTC<span class="hljs-built_in">String</span>());      // <span class="hljs-string">"Tue, 11 Nov 2025 09:00:00 GMT"</span>
console.<span class="hljs-built_in">log</span>(d.toISO<span class="hljs-built_in">String</span>());      // <span class="hljs-string">"2025-11-11T09:00:00.000Z"</span>
console.<span class="hljs-built_in">log</span>(d.toLocale<span class="hljs-built_in">String</span>());   // <span class="hljs-string">"2025/11/11 17:00:00"</span>
console.<span class="hljs-built_in">log</span>(
  <span class="hljs-keyword">new</span> Intl.DateTimeFormat(<span class="hljs-comment">'en-US', { timeZone: 'UTC' }).format(d)</span>
);                                 // <span class="hljs-string">"11/11/2025"</span>
</code></pre>
<p>ğŸ“Š <strong>æ€»ç»“å›¾ç¤ºï¼š</strong></p>









































<table><thead><tr><th>æ–¹æ³•</th><th>æ—¶åŒº</th><th>è¾“å‡ºå¯å®šåˆ¶</th><th>æ¨èç”¨é€”</th></tr></thead><tbody><tr><td><code>toUTCString()</code></td><td>UTC</td><td>âŒ</td><td>æœºå™¨å¯è¯»ã€HTTP Header</td></tr><tr><td><code>toGMTString()</code></td><td>UTC</td><td>âŒ</td><td>å·²åºŸå¼ƒ</td></tr><tr><td><code>toLocaleString()</code></td><td>æœ¬åœ°æ—¶åŒº</td><td>âœ…</td><td>ç”¨æˆ·ç•Œé¢å±•ç¤º</td></tr><tr><td><code>toISOString()</code></td><td>UTC</td><td>âŒ</td><td>æ•°æ®åºåˆ—åŒ–ã€å­˜å‚¨</td></tr><tr><td><code>Intl.DateTimeFormat</code></td><td>ä»»æ„</td><td>âœ…âœ…âœ…</td><td>æœ€å¼ºå›½é™…åŒ–æ§åˆ¶</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-9">äº”ã€æ½œåœ¨é—®é¢˜ä¸å®æˆ˜å»ºè®®</h2>






























<table><thead><tr><th>é—®é¢˜</th><th>è¯´æ˜</th><th>å»ºè®®</th></tr></thead><tbody><tr><td>ä¸åŒæµè§ˆå™¨æ ¼å¼å·®å¼‚</td><td>ç‰¹åˆ«æ˜¯ <code>toLocaleString()</code></td><td>æ˜¾å¼æŒ‡å®š locale + timeZone</td></tr><tr><td>æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æ—¶åŒºä¸ä¸€è‡´</td><td>SSR è¾“å‡º UTCã€CSR è¾“å‡ºæœ¬åœ°</td><td>ç»Ÿä¸€ timeZoneï¼ˆå¦‚ 'UTC' æˆ– 'Asia/Shanghai'ï¼‰</td></tr><tr><td>æƒ³ç»Ÿä¸€æ ¼å¼è¾“å‡º</td><td><code>toUTCString()</code> å¤ªå›ºå®š</td><td>æ”¹ç”¨ <code>Intl.DateTimeFormat</code> æˆ– <code>dayjs</code></td></tr><tr><td>ç§»åŠ¨ç«¯å·®å¼‚</td><td>ICU ç‰ˆæœ¬ä¸åŒ</td><td>é¿å…ä¾èµ–ç³»ç»Ÿé»˜è®¤æ ¼å¼</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-10">å…­ã€å®è·µæ¡ˆä¾‹ï¼šç»Ÿä¸€æ ¼å¼åŒ–å‡½æ•°å°è£…</h2>
<pre><code class="hljs language-php" lang="php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">formatDate</span>(<span class="hljs-params">date, opts = {}</span>) </span>{
  <span class="hljs-keyword">const</span> {
    locale = <span class="hljs-string">'zh-CN'</span>,
    timeZone = <span class="hljs-string">'Asia/Shanghai'</span>,
    options = {}
  } = opts;

  <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">fmt</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intl</span>.<span class="hljs-title function_ invoke__">DateTimeFormat</span>(locale, {
    timeZone,
    <span class="hljs-attr">year</span>: <span class="hljs-string">'numeric'</span>,
    <span class="hljs-attr">month</span>: <span class="hljs-string">'2-digit'</span>,
    <span class="hljs-attr">day</span>: <span class="hljs-string">'2-digit'</span>,
    <span class="hljs-attr">hour</span>: <span class="hljs-string">'2-digit'</span>,
    <span class="hljs-attr">minute</span>: <span class="hljs-string">'2-digit'</span>,
    <span class="hljs-attr">second</span>: <span class="hljs-string">'2-digit'</span>,
    <span class="hljs-attr">hour12</span>: <span class="hljs-literal">false</span>,
    ...options
  });
  <span class="hljs-keyword">return</span> fmt.<span class="hljs-title function_ invoke__">format</span>(date);
}

console.<span class="hljs-title function_ invoke__">log</span>(<span class="hljs-title function_ invoke__">formatDate</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(), { <span class="hljs-attr">timeZone</span>: <span class="hljs-string">'UTC'</span> }));
<span class="hljs-comment">// è¾“å‡ºå¦‚ï¼š2025/11/11 09:00:00</span>
</code></pre>
<hr/>
<h2 data-id="heading-11">ä¸ƒã€ç»“è¯­ï¼šé€‰æ‹©å»ºè®®æ€»ç»“</h2>

























<table><thead><tr><th>åœºæ™¯</th><th>æ¨è API</th></tr></thead><tbody><tr><td>æœºå™¨é€šä¿¡ / JSON / HTTP</td><td><code>toISOString()</code> / <code>toUTCString()</code></td></tr><tr><td>ç”¨æˆ·ç•Œé¢æ˜¾ç¤ºï¼ˆå›½é™…åŒ–ï¼‰</td><td><code>toLocaleString()</code> æˆ– <code>Intl.DateTimeFormat</code></td></tr><tr><td>è·¨åŒºåŸŸä¸€è‡´æ€§ï¼ˆå‰åç«¯ï¼‰</td><td>å›ºå®šä½¿ç”¨ UTC + æ ¼å¼åŒ–æ§åˆ¶</td></tr><tr><td>éœ€è¦çµæ´»æ ¼å¼</td><td>ä½¿ç”¨ <code>Intl.DateTimeFormat</code> æˆ– <code>dayjs</code></td></tr></tbody></table>
<blockquote>
<p><strong>ä¸€å¥è¯æ€»ç»“ï¼š</strong></p>
<ul>
<li><code>toUTCString()</code>ï¼šæ ‡å‡†åŒ– UTC æ–‡æœ¬è¾“å‡º</li>
<li><code>toLocaleString()</code>ï¼šæœ¬åœ°åŒ–ç”¨æˆ·ç•Œé¢è¾“å‡º</li>
<li><code>toISOString()</code>ï¼šæ•°æ®ä¼ è¾“æ ‡å‡†è¾“å‡º</li>
<li><code>Intl.DateTimeFormat</code>ï¼šå›½é™…åŒ–ä¸è‡ªå®šä¹‰æ ¼å¼é¦–é€‰</li>
</ul>
</blockquote>
<hr/>
<p><strong>æœ¬æ–‡éƒ¨åˆ†å†…å®¹å€ŸåŠ© AI è¾…åŠ©ç”Ÿæˆï¼Œå¹¶ç”±ä½œè€…æ•´ç†å®¡æ ¸ã€‚</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Skip Fuseç°åœ¨å¯¹ç‹¬ç«‹å¼€å‘è€…å…è´¹ï¼ -- è‚˜å­çš„ Swift å‘¨æŠ¥ #0110]]></title>    <link>https://juejin.cn/post/7571060853354397706</link>    <guid>https://juejin.cn/post/7571060853354397706</guid>    <pubDate>2025-11-10T23:51:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571060853354397706" data-draft-id="7569960869960384558" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Skip Fuseç°åœ¨å¯¹ç‹¬ç«‹å¼€å‘è€…å…è´¹ï¼ -- è‚˜å­çš„ Swift å‘¨æŠ¥ #0110"/> <meta itemprop="keywords" content="Swift,SwiftUI,Android"/> <meta itemprop="datePublished" content="2025-11-10T23:51:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸œå¡è‚˜å­"/> <meta itemprop="url" content="https://juejin.cn/user/1548526032528727"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Skip Fuseç°åœ¨å¯¹ç‹¬ç«‹å¼€å‘è€…å…è´¹ï¼ -- è‚˜å­çš„ Swift å‘¨æŠ¥ #0110
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1548526032528727/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸œå¡è‚˜å­
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T23:51:42.000Z" title="Mon Nov 10 2025 23:51:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d496c218bf294f099d0095add69c9539~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5Z2h6IKY5a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763423502&amp;x-signature=OMBm0tFy%2FRq2TKfkWoEhv1y%2FKZA%3D" alt="issue110.webp" loading="lazy"/></p>
<blockquote>
<p>ğŸ“® æƒ³æŒç»­å…³æ³¨ Swift æŠ€æœ¯å‰æ²¿ï¼Ÿ</p>
<p>æ¯å‘¨ä¸€æœŸã€Šè‚˜å­çš„ Swift å‘¨æŠ¥ã€‹ï¼Œä¸ºä½ ç²¾é€‰æœ¬å‘¨æœ€å€¼å¾—å…³æ³¨çš„ Swiftã€SwiftUI æŠ€æœ¯æ–‡ç« ã€å¼€æºé¡¹ç›®å’Œç¤¾åŒºåŠ¨æ€ã€‚</p>
<ul>
<li>ğŸ“¬ åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fweekly.fatbobman.com" target="_blank" title="https://weekly.fatbobman.com" ref="nofollow noopener noreferrer">weekly.fatbobman.com</a> å…è´¹è®¢é˜…</li>
<li>ğŸ’¬ åŠ å…¥ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdiscord.com%2Finvite%2F7FedN5E2QQ" target="_blank" title="https://discord.com/invite/7FedN5E2QQ" ref="nofollow noopener noreferrer">Discord</a> ä¸ä¸­æ–‡ Swift å¼€å‘è€…æ·±å…¥äº¤æµ</li>
<li>ğŸ“š è®¿é—® <a href="https://link.juejin.cn?target=http%3A%2F%2Ffatbobman.com" target="_blank" title="http://fatbobman.com" ref="nofollow noopener noreferrer">fatbobman.com</a> æŸ¥çœ‹æ•°ç™¾ç¯‡æ·±åº¦åŸåˆ›æ•™ç¨‹Â </li>
</ul>
<p>ä¸€èµ·æ„å»ºæ›´å¥½çš„ Swift åº”ç”¨ï¼ğŸš€</p>
</blockquote>
<h2 data-id="heading-0">Skip Fuseç°åœ¨å¯¹ç‹¬ç«‹å¼€å‘è€…å…è´¹ï¼</h2>
<p>åœ¨ Swift ç¤¾åŒº<a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fweekly%2Fissue-108%2F%3Futm_source%3Dfatbobman%2520weekly%2520issue%2520110%26utm_medium%3Dweb" target="_blank" title="https://fatbobman.com/zh/weekly/issue-108/?utm_source=fatbobman%20weekly%20issue%20110&amp;utm_medium=web" ref="nofollow noopener noreferrer">å‘å¸ƒå®˜æ–¹ Android ç‰ˆ SDK</a> ä¸ä¹…ä¹‹åï¼ŒSkip å®£å¸ƒå…¶ <a href="https://link.juejin.cn?target=https%3A%2F%2Fskip.tools%2Fblog%2Fskip-fuse-free-for-indies%2F%3Futm_source%3Dfatbobman%2520weekly%2520issue%2520110%26utm_medium%3Dweb" target="_blank" title="https://skip.tools/blog/skip-fuse-free-for-indies/?utm_source=fatbobman%20weekly%20issue%20110&amp;utm_medium=web" ref="nofollow noopener noreferrer">Skip Fuse ç‰ˆæœ¬å°†å¯¹ç¬¦åˆæ¡ä»¶çš„ç‹¬ç«‹å¼€å‘è€…å…è´¹å¼€æ”¾</a>ï¼Œç”¨äºæ„å»º Android åº”ç”¨ã€‚</p>
<p>ä¸è¿‡å»ä¸€å¹´å¤šç‹¬ç«‹å¼€å‘è€…å¯å…è´¹ä½¿ç”¨çš„ Skip Lite ç›¸æ¯”ï¼ŒSkip Fuse å¸¦æ¥äº†å®è´¨æ€§çš„æŠ€æœ¯å˜é©ã€‚Skip Lite çš„åŸç†æ˜¯å°† Swift ä»£ç è½¬è¯‘ä¸º Kotlinï¼Œè€Œ Skip Fuse åˆ™ç›´æ¥åˆ©ç”¨ Swift å®˜æ–¹ Android SDK è¿›è¡Œäº¤å‰ç¼–è¯‘ï¼Œå°† Swift æºç ç¼–è¯‘ä¸ºå¯åœ¨ Android å¹³å°ä¸ŠåŸç”Ÿè¿è¡Œçš„ ARM äºŒè¿›åˆ¶æ–‡ä»¶ã€‚è¿™æ„å‘³ç€å¼€å‘è€…ä¸å†å±€é™äºâ€œå…·æœ‰ Skip æ„ŸçŸ¥â€çš„ä¾èµ–åŒ…ï¼Œè€Œå¯ä»¥ä½¿ç”¨ä»»ä½•èƒ½åœ¨ Android ä¸Šç¼–è¯‘çš„ Swift åŒ…ã€‚</p>
<p>æ ¹æ® <a href="https://link.juejin.cn?target=https%3A%2F%2Fswift-everywhere.org%2F%3Futm_source%3Dfatbobman%2520weekly%2520issue%2520110%26utm_medium%3Dweb" target="_blank" title="https://swift-everywhere.org/?utm_source=fatbobman%20weekly%20issue%20110&amp;utm_medium=web" ref="nofollow noopener noreferrer">Swift Everywhere</a> çš„ç»Ÿè®¡ï¼Œç›®å‰å·²æœ‰è¶…è¿‡ 2000 ä¸ª Swift Package æ”¯æŒ Android å¹³å°ï¼Œå…¶ä¸­åŒ…æ‹¬ Alamofireã€SwiftSoupã€swift-sqlcipher ç­‰å¸¸ç”¨åº“ã€‚æ¢å¥è¯è¯´ï¼ŒFuse æ¨¡å¼è®©å¼€å‘è€…èƒ½å¤Ÿå……åˆ†åˆ©ç”¨æ ‡å‡† SwiftPM ç”Ÿæ€ã€‚è¿™ä¸ä»…æ˜¾è‘—æ‹“å®½äº†å¯ç”¨ä¾èµ–çš„èŒƒå›´ï¼Œä¹Ÿé™ä½äº†é¡¹ç›®è¿ç§»ä¸ç»´æŠ¤çš„å¤æ‚åº¦ã€‚</p>
<p>åœ¨æ¶æ„å±‚é¢ä¸Šï¼ŒSkip Fuse é‡‡ç”¨äº†æ··åˆå®ç°æ–¹æ¡ˆï¼šä¸šåŠ¡é€»è¾‘éƒ¨åˆ†ç”±åŸç”Ÿ Swift ç›´æ¥ç¼–è¯‘æ‰§è¡Œï¼Œè€Œ UI å±‚çš„ SwiftUI DSL åˆ™åœ¨æ„å»ºè¿‡ç¨‹ä¸­ç”± Skip Fuse UI æ¨¡å—æ˜ å°„ä¸º Jetpack Compose ä»£ç ï¼Œä»è€Œåœ¨ Android ä¸Šå‘ˆç°å‡ºå®Œå…¨åŸç”Ÿçš„ç”¨æˆ·ä½“éªŒã€‚è¿™ç§åšæ³•æ—¢ä¿ç•™äº† SwiftUI çš„å£°æ˜å¼è¯­æ³•ï¼Œåˆéµå¾ªäº† Android å¹³å°çš„è®¾è®¡è§„èŒƒã€‚</p>
<p>æ­¤æ¬¡æ”¿ç­–è°ƒæ•´ï¼Œæˆ–è®¸ä¼šè®©è®¸å¤šç‹¬ç«‹å¼€å‘è€…å’Œä¸­å°å›¢é˜Ÿåœ¨æŠ€æœ¯é€‰å‹ä¸Šæ›´å€¾å‘äºå…·å¤‡è·¨å¹³å°æ½œåŠ›çš„æ–¹æ¡ˆã€‚å³ä¾¿ç»§ç»­ä¸»è¦é¢å‘ Apple ç”Ÿæ€è¿›è¡Œå¼€å‘ï¼ˆä½¿ç”¨è‹¹æœç§æœ‰æ¡†æ¶ï¼‰ï¼Œä¹Ÿå¯èƒ½å¼€å§‹åœ¨æ¶æ„ä¸­åŠ å…¥æŠ½è±¡å±‚ï¼Œä¸ºæœªæ¥çš„å¤šå¹³å°æ‹“å±•é¢„ç•™ç©ºé—´ã€‚</p>
<p>å½“ç„¶ï¼ŒSkip å¯¹â€œç‹¬ç«‹å¼€å‘è€…â€çš„å®šä¹‰ä¹Ÿæœ‰æ˜ç¡®é™åˆ¶ï¼šä»…é€‚ç”¨äºä¸ªäººæˆ–ä¸è¶…è¿‡ä¸¤äººçš„å›¢é˜Ÿï¼Œå¹´æ”¶å…¥éœ€ä½äº 30,000 ç¾å…ƒï¼Œå¹¶ä¸”å…è´¹è®¸å¯ä»…å…è®¸å‘å¸ƒä¸€ä¸ªé—­æºå•†ä¸šåº”ç”¨ï¼ˆå¼€æºé¡¹ç›®æ•°é‡ä¸é™ï¼‰ã€‚å³ä¾¿å¦‚æ­¤ï¼Œè¿™ä¸€æ”¿ç­–ä»ä¸º Swift å¼€å‘è€…ä»¥è¿‘ä¹é›¶æˆæœ¬çš„æ–¹å¼è¿›å…¥ Android å¸‚åœºæ‰“å¼€äº†å¤§é—¨ï¼Œä¸ºä»–ä»¬åœ¨è¿™ä¸€åºå¤§å¹³å°ä¸Šæ¢ç´¢æ–°çš„å¯èƒ½ä¸æ”¶å…¥æ¥æºæä¾›äº†å¥‘æœºã€‚</p>
<p>å°½ç®¡æœªæ¥è¿˜ä¼šå‡ºç°æ›´å¤šé¢å‘ Swift çš„è·¨å¹³å°å¼€å‘æ–¹æ¡ˆï¼Œä½† Skip å·²ç»ä¸º Swift åœ¨ Android ç”Ÿæ€ä¸­çš„è½åœ°æä¾›äº†ä¸€æ¡æ¸…æ™°ã€å¯è¡Œçš„è·¯å¾„ã€‚ç¤¾åŒºä¹Ÿæ­£æœŸå¾…ç€ç±»ä¼¼ Skip è¿™æ ·æˆç†Ÿçš„è·¨å¹³å°æ–¹æ¡ˆèƒ½å¤Ÿæ‰©å±•è‡³ Linuxã€Windows ä¹ƒè‡³åµŒå…¥å¼å¹³å°ï¼Œä¸º Swift çš„å¤šå¹³å°å‘å±•å¥ å®šæ›´åšå®çš„åŸºç¡€ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fweekly%2Fissue-110%2F" target="_blank" title="https://fatbobman.com/zh/weekly/issue-110/" ref="nofollow noopener noreferrer">æœ¬æœŸå†…å®¹</a> | <a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fweekly%2Fissue-109%2F" target="_blank" title="https://fatbobman.com/zh/weekly/issue-109/" ref="nofollow noopener noreferrer">å‰ä¸€æœŸå†…å®¹</a> | <a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fweekly%2F" target="_blank" title="https://fatbobman.com/zh/weekly/" ref="nofollow noopener noreferrer">å…¨éƒ¨å‘¨æŠ¥åˆ—è¡¨</a></p>
<h2 data-id="heading-1">è¿‘æœŸæ¨è</h2>
<h3 data-id="heading-2"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0110-01" target="_blank" title="https://l.fatbobman.com/w0110-01" ref="nofollow noopener noreferrer">SwiftData çš„ä¼˜é›…å–æ¶ˆç¼–è¾‘æ–¹æ¡ˆï¼šä»æ··ä¹±åˆ°è‰ºæœ¯ (The Art of SwiftData in 2025: From Scattered Pieces to a Masterpiece)</a></h3>
<p>ç”±äºå–æ¶ˆäº†çˆ¶å­ä¸Šä¸‹æ–‡çš„æ¦‚å¿µï¼ŒSwiftData åœ¨å®ç°â€œå¯æ’¤é”€ä¿®æ”¹â€æ–¹é¢å˜å¾—æ›´åŠ æ£˜æ‰‹ã€‚<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.linkedin.com%2Fin%2Fmathisgnt%2F" target="_blank" title="https://www.linkedin.com/in/mathisgnt/" ref="nofollow noopener noreferrer">Mathis Gaignet</a> åœ¨è¿™ç¯‡é•¿æ–‡ä¸­ï¼Œé€šè¿‡æ„å»ºä¸€ä¸ªä¸“ç”¨äºç¼–è¾‘çŠ¶æ€çš„ç‹¬ç«‹ <code>ModelContext</code>ï¼Œé˜è¿°äº†åœ¨ SwiftData ä¸­å®ç°â€œå¯æ’¤é”€ã€å¯å¤ç”¨ã€ä½æ ·æ¿â€å¢æ”¹ï¼ˆUpsertï¼‰æ¶æ„çš„æ€è·¯ï¼Œç”¨ä»¥å–ä»£æ•£ä¹±çš„è¡¨å•çŠ¶æ€ä¸è„†å¼±çš„å›æ»šæ–¹æ¡ˆã€‚</p>
<p>ä½œè€…å¹¶æœªç›´æ¥ç»™å‡ºâ€œæ ‡å‡†ç­”æ¡ˆâ€ï¼Œè€Œæ˜¯å®Œæ•´å±•ç¤ºäº†ä»é—®é¢˜å‘ç°åˆ°æ–¹æ¡ˆæ¼”è¿›çš„æ€è€ƒè·¯å¾„ã€‚æ–‡ç« æ·±å…¥è§£æäº† <code>@Model</code>ã€<code>@Query</code> å®çš„åº•å±‚æœºåˆ¶ï¼Œæ­ç¤ºäº† <code>PersistentIdentifier</code> çš„ä¸´æ—¶ä¸æ°¸ä¹…çŠ¶æ€é™·é˜±ï¼Œä»¥åŠä¸Šä¸‹æ–‡åŒæ­¥å»¶è¿Ÿå¯¼è‡´çš„éšè”½ Bugã€‚è¿™ç§æ¢ç´¢å¼çš„å†™ä½œæ–¹å¼ï¼Œä½¿è¯»è€…ä¸ä»…æ˜ç™½â€œæ€ä¹ˆåšâ€ï¼Œæ›´ç†è§£â€œä¸ºä»€ä¹ˆè¿™æ ·åšâ€ã€‚</p>
<hr/>
<h3 data-id="heading-3"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0110-02" target="_blank" title="https://l.fatbobman.com/w0110-02" ref="nofollow noopener noreferrer">ä» SPM é¡¹ç›®ç®¡ç†è¿ç§»åˆ° Tuist é¡¹ç›®ç®¡ç† (Back Market x Tuist - Part I: Why We Moved Our iOS Project To Tuist)</a></h3>
<p>åœ¨ Swift é¡¹ç›®ä¸­ï¼ŒSPM é™¤äº†è´Ÿè´£ä»£ç æ¨¡å—åŒ–ï¼Œä¹Ÿæ‰¿æ‹…äº†é¡¹ç›®ç»“æ„ç®¡ç†çš„èŒè´£ã€‚ç„¶è€Œï¼Œéšç€é¡¹ç›®è§„æ¨¡çš„æ‰©å¤§ï¼Œè¿™ç§æ–¹å¼çš„å±€é™é€æ¸æ˜¾ç°ï¼šä¾èµ–è§£æé¢‘ç¹ã€ç¼ºä¹æ„å»ºè®¾ç½®å’Œè‡ªå®šä¹‰é˜¶æ®µã€æ— æ³•è¿è¡Œè„šæœ¬ã€xcodeproj æ–‡ä»¶æ˜“å†²çªã€æ¨¡å—é—´è§„åˆ™éš¾ä»¥ç»Ÿä¸€ï¼Œä¸” SPM æ’ä»¶èƒ½åŠ›æœ‰é™ã€‚<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.linkedin.com%2Fin%2Falbsala%2F" target="_blank" title="https://www.linkedin.com/in/albsala/" ref="nofollow noopener noreferrer">Alberto Salas</a> åœ¨æœ¬æ–‡ä¸­ä»‹ç»äº†å…¶å›¢é˜Ÿå¦‚ä½•å°†é¡¹ç›®ç»“æ„ç®¡ç†ä» SPM Packages è¿ç§»è‡³ Tuist Targetsï¼Œå¹¶ç³»ç»Ÿæ¢³ç†äº†é—®é¢˜æˆå› ã€æ¢ç´¢è·¯å¾„ä¸å†³ç­–è¿‡ç¨‹ã€‚åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0110-11" target="_blank" title="https://l.fatbobman.com/w0110-11" ref="nofollow noopener noreferrer">Part II</a> ä¸­ï¼Œä»–è¿›ä¸€æ­¥åˆ†äº«äº†å¦‚ä½•åœ¨ä¸é˜»å¡æ—¥å¸¸å¼€å‘çš„å‰æä¸‹å®Œæˆè¿ç§»ï¼Œå¹¶é‡åŒ–äº†æ„å»ºæ€§èƒ½çš„æå‡ã€‚</p>
<blockquote>
<p>æœ¬æ–‡å¹¶éè¦æŠ›å¼ƒ SPMï¼Œè€Œæ˜¯å°†é¡¹ç›®ç»“æ„ä¸ç”Ÿæˆå·¥ä½œäº¤ç”± Tuist æ¥ç®¡ï¼Œä¾èµ–ç®¡ç†ä¾ç„¶ç”± SPM è´Ÿè´£ã€‚æ–‡ç« è¿˜æ¯”è¾ƒäº† SPMã€Bazel ä¸ Tuist çš„ä¸åŒå–èˆã€‚ä½œè€…æŒ‡å‡ºï¼ŒBazel åŠŸèƒ½æ›´å¼ºå¤§ï¼Œä½†æœ€ç»ˆé€‰æ‹© Tuistï¼Œæ˜¯å› ä¸ºå®ƒæ›´ç¬¦åˆå›¢é˜Ÿèƒ½åŠ›ä¸é¡¹ç›®ç‰¹æ€§ã€‚è¿™ä¹Ÿæé†’æˆ‘ä»¬ï¼Œå·¥å…·é€‰å‹çš„å…³é”®ä¸åœ¨â€œæœ€å¼ºâ€ï¼Œè€Œåœ¨â€œæœ€åˆé€‚â€â€”â€”å°¤å…¶å¯¹äºä¸­å°å‹å›¢é˜Ÿï¼Œå¯è‡ªä¸»æŒæ§ã€æ˜“äºç»´æŠ¤çš„æ–¹æ¡ˆå¾€å¾€æ›´å…·é•¿æœŸä»·å€¼ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-4"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0110-03" target="_blank" title="https://l.fatbobman.com/w0110-03" ref="nofollow noopener noreferrer">è®©åº”ç”¨æ›´æ‡‚ç”¨æˆ·è¯­è¨€ï¼šLanguage Discovery çš„ä¸ªæ€§åŒ–æ–°æœºåˆ¶ (Making Apps More Personal with Language Discovery)</a></h3>
<p>ä¼ ç»Ÿçš„â€œé€‰æ‹©ä¸»è¦è¯­è¨€â€(<code>Locale.preferredLanguages</code>) æ¨¡å¼å‡è®¾æ¯ä½ç”¨æˆ·éƒ½æœ‰å•ä¸€è¯­è¨€åå¥½ï¼Œä½†ç°å®ä¸­äººä»¬å¾€å¾€åœ¨ä¸åŒæƒ…å¢ƒä¸‹ä½¿ç”¨å¤šç§è¯­è¨€â€”â€”ä¾‹å¦‚åœ¨å·¥ä½œä¸­ä½¿ç”¨è‹±è¯­ã€åœ¨ç¤¾äº¤ä¸­ä½¿ç”¨æ³•è¯­ã€åœ¨åª’ä½“æ¶ˆè´¹ä¸­ä½¿ç”¨è¥¿ç­ç‰™è¯­ã€‚è‹¹æœåœ¨ iOS 26 ä¸­æ·»åŠ äº† <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.apple.com%2Fvideos%2Fplay%2Fwwdc2025%2F222%2F" target="_blank" title="https://developer.apple.com/videos/play/wwdc2025/222/" ref="nofollow noopener noreferrer">Language Discovery</a> åŠŸèƒ½ï¼Œé€šè¿‡è®¾å¤‡ç«¯çš„æœºå™¨å­¦ä¹ ï¼Œåœ¨ç¡®ä¿éšç§çš„å‰æä¸‹ï¼ŒåŸºäºç”¨æˆ·çš„è¾“å…¥æ¨¡å¼ã€å†…å®¹æ¶ˆè´¹ã€æ²Ÿé€šè¯­è¨€ä»¥åŠåº”ç”¨åå¥½ç­‰è¡Œä¸ºæ•°æ®ï¼Œè‡ªåŠ¨æ¨æ–­ç”¨æˆ·çš„è¯­è¨€ä½¿ç”¨ä¹ æƒ¯ã€‚<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.linkedin.com%2Fin%2Fletizia-granata%2F" target="_blank" title="https://www.linkedin.com/in/letizia-granata/" ref="nofollow noopener noreferrer">Letizia Granata</a> åœ¨æ–‡ä¸­ä»‹ç»äº†è¿™ä¸€æ™ºèƒ½è¯†åˆ«ç”¨æˆ·è¯­è¨€åå¥½çš„ç³»ç»Ÿæœºåˆ¶ã€‚</p>
<blockquote>
<p>é€šè¿‡ Language Discoveryï¼Œåº”ç”¨å¯ä»¥æ›´å‡†ç¡®åœ°å“åº”ç”¨æˆ·çš„è¯­è¨€ä¸æ–‡åŒ–èƒŒæ™¯ï¼Œä»è€Œåœ¨æœ¬åœ°åŒ–å±‚é¢å®ç°ä¸ªæ€§åŒ–ã€‚è¿™é¡¹åŠŸèƒ½æ ‡å¿—ç€è‹¹æœåœ¨å¤šè¯­è¨€æ”¯æŒä¸Šçš„ä¸€æ¬¡é‡è¦è½¬å˜ï¼šä»è¢«åŠ¨é…ç½®èµ°å‘ä¸»åŠ¨ç†è§£ï¼Œä»å•ä¸€è¯­è¨€åˆ°å¤šè¯­å…±å­˜ï¼Œä¸ºå¼€å‘è€…æä¾›äº†æ‰“é€ æ›´åŒ…å®¹ã€æ›´çœŸå®åº”ç”¨ä½“éªŒçš„æ–°åŸºç¡€ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-5"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0110-04" target="_blank" title="https://l.fatbobman.com/w0110-04" ref="nofollow noopener noreferrer">å…³äº Xcode 26.1 CPU å¼‚å¸¸å ç”¨çš„æé†’å’Œä¸´æ—¶è§£å†³æ–¹æ¡ˆ</a></h3>
<p>iOS å¼€å‘è€… <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.linkedin.com%2Fin%2Fartem-mirzabekian%2F" target="_blank" title="https://www.linkedin.com/in/artem-mirzabekian/" ref="nofollow noopener noreferrer">Artem Mirzabekian</a> æŒ‡å‡ºï¼ŒXcode 26.1 åœ¨è¿è¡Œ iOS 26.1 æ¨¡æ‹Ÿå™¨æ—¶ä¼šå‡ºç°å¼‚å¸¸çš„ CPU å ç”¨é—®é¢˜ã€‚åŸå› æ˜¯ iOS 26.1 æ¨¡æ‹Ÿå™¨ä¸­ä¸å£çº¸æ¸²æŸ“ç›¸å…³çš„ <code>MercuryPosterExtension</code> è¿›ç¨‹æŒç»­å´©æºƒå¹¶é‡å¯ï¼Œå¯¼è‡´ CPU å¼‚å¸¸å ç”¨ã€‚Xcode 26.2ï¼ˆbeta ç‰ˆï¼‰ç›®å‰ä¹Ÿå—å½±å“ã€‚</p>
<p>ä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ iOS 26.0 æ¨¡æ‹Ÿå™¨ï¼Œæˆ–åœ¨ iOS 26.1 æ¨¡æ‹Ÿå™¨ä¸­æ›´æ¢å£çº¸å¹¶åˆ é™¤é»˜è®¤çš„çº¯é»‘å£çº¸ã€‚</p>
<hr/>
<h3 data-id="heading-6">Swift 6 å¹¶å‘æ¨¡å‹ï¼šæŠ€æœ¯æŒ‘æˆ˜ä¸ç¤¾åŒºäº‰è®®</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fmjtsai" target="_blank" title="https://x.com/mjtsai" ref="nofollow noopener noreferrer">Michael Tsai</a> æ±‡æ€»äº†ä¸¤ç»„å…³äº Swift 6 å¹¶å‘çš„é‡è¦è®¨è®ºã€‚<a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0110-05" target="_blank" title="https://l.fatbobman.com/w0110-05" ref="nofollow noopener noreferrer">ç¬¬ä¸€ç¯‡</a> å…³æ³¨ Swift 6.2 æ¨å‡ºçš„ â€œApproachable Concurrencyâ€ æ”¹è¿›ï¼›<a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0110-06" target="_blank" title="https://l.fatbobman.com/w0110-06" ref="nofollow noopener noreferrer">ç¬¬äºŒç¯‡</a> åˆ™èšç„¦å…·ä½“æŠ€æœ¯è®®é¢˜ï¼Œå¦‚ <code>MainActor.assumeIsolated</code> ä¸ <code>@preconcurrency</code> çš„å®é™…ä½¿ç”¨ä¸é™åˆ¶ï¼›</p>
<p>ç¤¾åŒºè§‚ç‚¹å‘ˆç°æ˜æ˜¾åˆ†åŒ–ã€‚æ”¯æŒè€…è®¤ä¸ºï¼Œé»˜è®¤ä¸»çº¿ç¨‹éš”ç¦»æœ‰æ•ˆé˜²æ­¢äº†â€œæ„å¤–è·‘åˆ°åå°çº¿ç¨‹â€çš„å¸¸è§é—®é¢˜ï¼Œé™ä½äº†åˆå­¦è€…ä¸ UI å¯†é›†å‹é¡¹ç›®çš„ä¸Šæ‰‹éš¾åº¦ï¼Œä¸€äº›å›¢é˜Ÿå·²ç»æˆåŠŸå®Œæˆå¤§å‹åº”ç”¨çš„è¿ç§»ã€‚è´¨ç–‘è€…åˆ™æŒ‡å‡ºï¼Œå®Œæ•´çš„ UIKit åº”ç”¨ä»éš¾ä»¥å…¨é¢é‡‡ç”¨ Swift 6 æ¨¡å¼ï¼Œä¸ Core Data å’Œç¬¬ä¸‰æ–¹æ¡†æ¶çš„é›†æˆé—®é¢˜é¢‘å‡ºï¼Œé”™è¯¯ä¿¡æ¯æ™¦æ¶©éš¾æ‡‚ï¼Œè€Œè¯­è¨€çš„æŒç»­æ¼”è¿›ä¹Ÿè®©ä»£ç ä¸æ–­è€åŒ–ã€‚æ›´æ¿€è¿›çš„å£°éŸ³ç”šè‡³è®¤ä¸ºå½“å‰å¹¶å‘æ¨¡å‹å·²æˆä¸ºâ€œæ— æ³•ååŒè¿ä½œçš„æ‹¼å‡‘ä½“ç³»â€ï¼Œéœ€è¦ä¸€æ¬¡â€œå½»åº•é‡ç½®â€ã€‚</p>
<p>æ•´ä½“å…±è¯†æ˜¯ï¼šSwift 6 å¹¶å‘æœºåˆ¶çš„æ”¶ç›Šé«˜åº¦ä¾èµ–é¡¹ç›®çš„å¹¶å‘å¤æ‚åº¦â€”â€”å¯¹å•çº¿ç¨‹æˆ– UI é©±åŠ¨å‹åº”ç”¨å¸®åŠ©æ˜¾è‘—ï¼Œä½†å¯¹äºå¹¶å‘å¯†é›†æˆ–ç³»ç»Ÿè€¦åˆåº¦é«˜çš„é¡¹ç›®ï¼Œè¿ç§»ä»å……æ»¡æŒ‘æˆ˜ã€‚</p>
<hr/>
<h3 data-id="heading-7"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0110-07" target="_blank" title="https://l.fatbobman.com/w0110-07" ref="nofollow noopener noreferrer">æ·±å…¥è§£æ visionOS ä¸Šçš„åŠ¨ç”»æœºåˆ¶ (Deep Dive into Animation on visionOS)</a></h3>
<p>ç©ºé—´è®¡ç®—ä¸ä»…æ”¹å˜äº†ç”¨æˆ·ä½“éªŒï¼Œä¹Ÿå¯¹å¼€å‘è€…æå‡ºäº†æ›´é«˜çš„è¦æ±‚â€”â€”è®¸å¤šåœ¨å¹³é¢ç•Œé¢ä¸­è¡Œä¹‹æœ‰æ•ˆçš„æŠ€å·§ï¼Œåœ¨ä¸‰ç»´ç©ºé—´ä¸­å·²ä¸å†é€‚ç”¨ã€‚<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.linkedin.com%2Fin%2Felkraneo%2F" target="_blank" title="https://www.linkedin.com/in/elkraneo/" ref="nofollow noopener noreferrer">Cristian DÃ­az</a> ä»â€œç©ºé—´äº¤äº’çš„å¯æ„ŸçŸ¥æ€§ä¸èˆ’é€‚æ€§â€å‡ºå‘ï¼Œæå‡ºäº†ä¸€ä¸ªåŠ¨ç”»å†³ç­–æ¡†æ¶ï¼šè°åˆ›ä½œåŠ¨ç”»ï¼ˆè®¾è®¡å¸ˆé¢„åˆ¶ vs. è¿è¡Œæ—¶ç”Ÿæˆï¼‰ã€ä»€ä¹ˆéœ€è¦åŠ¨ç”»ï¼ˆSwiftUI çª—å£ vs. RealityKit å®ä½“ï¼‰ã€å¤æ‚åº¦å¦‚ä½•ï¼ˆå¾®äº¤äº’ vs. ç¼–æ’è¡¨æ¼”)ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼Œä»–ç³»ç»Ÿæ¢³ç†äº† visionOS çš„äº”æ¡æ¸²æŸ“è·¯å¾„ä¸åç§åŠ¨ç”»æœºåˆ¶ï¼Œä¸ºæ¯ç§æ–¹æ¡ˆæ˜ç¡®åˆ—å‡ºé€‚ç”¨åœºæ™¯ã€é¿å…æƒ…å½¢ä¸å®ç°è¦ç‚¹ã€‚</p>
<blockquote>
<p>å³ä¾¿ä½ å¹¶é visionOS å¼€å‘è€…ï¼Œä¹Ÿèƒ½ä»è¿™ç¯‡æ–‡ç« ä¸­å—ç›Šã€‚Cristian ä»¥â€œä»æ„ŸçŸ¥éœ€æ±‚æ¨å¯¼æŠ€æœ¯é€‰æ‹©â€çš„æ–¹å¼è¯ é‡Šäº†åŠ¨ç”»è®¾è®¡æ€ç»´ï¼Œè¿™ç§æ–¹æ³•åŒæ ·é€‚ç”¨äºå…¶ä»–å¹³å°å’Œç•Œé¢çš„åŠ¨æ€è®¾è®¡ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-8"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0110-08" target="_blank" title="https://l.fatbobman.com/w0110-08" ref="nofollow noopener noreferrer">ä½¿ç”¨ Instruments æ‰¾å‡º SwiftUI ä¸­æ›´æ–°æœ€é¢‘ç¹çš„è§†å›¾ (Find the SwiftUI Views that Update the Most Using Instruments)</a></h3>
<p>Xcode 26 ä¸º Instruments æ–°å¢äº† SwiftUI ä¸“ç”¨çš„åˆ†æå·¥å…·ï¼Œå¯ç»Ÿè®¡è§†å›¾çš„æ›´æ–°æ¬¡æ•°ä¸è€—æ—¶ï¼Œå¹¶é€šè¿‡ All Updates Summary ä¸ Cause &amp; Effect Graph å®šä½å“ªäº›è§†å›¾â€œæ›´æ–°è¿‡äºé¢‘ç¹â€ä»¥åŠå…·ä½“è§¦å‘é“¾è·¯ã€‚<a href="https://link.juejin.cn?target=https%3A%2F%2Fmastodon.world%2F%40swiftdevjournal" target="_blank" title="https://mastodon.world/@swiftdevjournal" ref="nofollow noopener noreferrer">Mark Szymczyk</a> ä»¥å®æ“ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•åˆ›å»º SwiftUI Profiling ä¼šè¯ã€æŒ‰æ›´æ–°æ¬¡æ•°/è€—æ—¶æ’åºè§†å›¾ï¼Œå¹¶ç”¨å› æœå›¾è¿½è¸ªæ›´æ–°æ¥æºã€‚</p>
<blockquote>
<p>æ’æŸ¥ç—‡çŠ¶ä¹‹å¤–ï¼Œæ›´åº”ç†è§£ SwiftUI çš„åˆ·æ–°åŸç†ï¼Œæ‰èƒ½ä»æºå¤´å‡å°‘æ— æ•ˆé‡ç»˜ã€‚åœ¨æˆ‘çš„æ–‡ç« <a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fposts%2Funderstanding-swiftui-view-update-mechanism%2F%3Futm_source%3Dfatbobman%2520weekly%2520issue%2520110%26utm_medium%3Dweb" target="_blank" title="https://fatbobman.com/zh/posts/understanding-swiftui-view-update-mechanism/?utm_source=fatbobman%20weekly%20issue%20110&amp;utm_medium=web" ref="nofollow noopener noreferrer">ç†è§£ SwiftUI çš„è§†å›¾åˆ·æ–°æœºåˆ¶ï¼šä» TimelineView åˆ·æ–°é—®é¢˜è°ˆèµ·</a>ä¸­ï¼Œå€Ÿç”± TimelineView ä¸ªæ¡ˆç³»ç»Ÿé˜è¿°äº†è§†å›¾å£°æ˜ã€å“åº”æœºåˆ¶ä¸é€’å½’æ›´æ–°çš„åˆ¤å®šé€»è¾‘ã€‚åªæœ‰ææ¸…â€œä¸ºä»€ä¹ˆè§†å›¾ä¼šæ›´æ–°â€ã€â€œç³»ç»Ÿå¦‚ä½•å†³å®šæ˜¯å¦é‡ç®—è§†å›¾å£°æ˜å€¼â€ï¼Œä¼˜åŒ–æ‰ä¸ä¼šæ²¦ä¸ºè¡¥ä¸å¼ä¿®ä¿®è¡¥è¡¥ã€‚</p>
</blockquote>
<h2 data-id="heading-9">å·¥å…·</h2>
<h3 data-id="heading-10"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0110-09" target="_blank" title="https://l.fatbobman.com/w0110-09" ref="nofollow noopener noreferrer">imessage-kitï¼šåœ¨ AI Agent ä¸­æä¾›æ¶ˆæ¯é›†æˆèƒ½åŠ›</a></h3>
<p>imessage-kit æ˜¯ä¸€ä¸ªç”± <a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fphoton_hq" target="_blank" title="https://x.com/photon_hq" ref="nofollow noopener noreferrer">Photon</a> å¼€å‘çš„åŠŸèƒ½å¼ºå¤§çš„ iMessage å¼€æº SDKï¼Œéå¸¸é€‚åˆå°† iMessage é›†æˆåˆ° AI æ™ºèƒ½ä½“æˆ–è‡ªåŠ¨åŒ–å·¥ä½œæµä¸­ã€‚å…¶ä¸»è¦åŠŸèƒ½æœ‰:</p>
<ul>
<li><strong>ç°ä»£åŒ–çš„ API</strong>ï¼šæä¾›ä¼˜é›…çš„é“¾å¼è°ƒç”¨ï¼ˆFluent APIï¼‰ï¼Œå¯ä»¥è½»æ¾å®ç°â€œæ”¶åˆ°æ¶ˆæ¯ Aï¼Œåˆ™å›å¤ Bâ€çš„é€»è¾‘ã€‚</li>
<li><strong>åŠŸèƒ½å…¨é¢</strong>ï¼šä¸ä»…æ”¯æŒæ”¶å‘æ–‡æœ¬ï¼Œè¿˜èƒ½å¤„ç†å›¾ç‰‡ã€å„ç±»æ–‡ä»¶ï¼Œå¹¶èƒ½å®æ—¶ç›‘æ§æ–°æ¶ˆæ¯ã€‚</li>
<li><strong>ç±»å‹å®‰å…¨ä¸è·¨è¿è¡Œæ—¶</strong>ï¼šå®Œå…¨ä½¿ç”¨ TypeScript ç¼–å†™ï¼Œç±»å‹æ”¯æŒè‰¯å¥½ï¼Œå¹¶åŒæ—¶å…¼å®¹ Node.js å’Œ Bunã€‚</li>
<li><strong>AI é›†æˆå‹å¥½</strong>ï¼šå®˜æ–¹å®šä½å°±æ˜¯ä¸º AI Agent æä¾›æ¶ˆæ¯é›†æˆèƒ½åŠ›ï¼Œæ˜¯è¿æ¥ç‰©ç†ä¸–ç•Œå’Œ AI çš„ä¸€ä¸ªæœ‰è¶£å°è¯•ã€‚</li>
</ul>
<p>å®ƒé€šè¿‡ç›´æ¥è¯»å– iMessage æ•°æ®åº“(<code>chat.db</code>)å¹¶ç»“åˆ AppleScript å®ç°è‡ªåŠ¨åŒ–,å› æ­¤ä»…é™ macOS ä½¿ç”¨ï¼Œä¸”éœ€è¦æˆäºˆåº”ç”¨"å®Œå…¨ç£ç›˜è®¿é—®æƒé™"ã€‚</p>
<blockquote>
<p>è¯¥åº“é‡‡ç”¨ SSPL-1.0 è®¸å¯è¯ï¼Œç¦æ­¢ç”¨äºåˆ›å»ºç«äº‰äº§å“ï¼ˆå¦‚å…¶ä»–æ¶ˆæ¯ SDK/APIï¼‰ï¼Œä½†å…è®¸ç”¨äºå†…éƒ¨ä¸šåŠ¡ã€ä¸ªäººé¡¹ç›®å’Œæ•™è‚²ç”¨é€”ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒPhoton è¿˜æä¾›é«˜çº§ç‰ˆæœ¬ï¼Œæ”¯æŒçº¿ç¨‹å›å¤ã€æ¶ˆæ¯æ’¤å›/ç¼–è¾‘ã€å®æ—¶è¾“å…¥æŒ‡ç¤ºå™¨ç­‰åŠŸèƒ½ï¼Œä»¥åŠä¼ä¸šçº§æ‰˜ç®¡æœåŠ¡ã€‚æ›´å¤šå†…å®¹å¯ä»¥åœ¨å…¶<a href="https://link.juejin.cn?target=https%3A%2F%2Fphoton.codes%2F%3Futm_source%3Dfatbobman%2520weekly%2520issue%2520110%26utm_medium%3Dweb" target="_blank" title="https://photon.codes/?utm_source=fatbobman%20weekly%20issue%20110&amp;utm_medium=web" ref="nofollow noopener noreferrer">å®˜ç½‘</a>è·å–ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-11"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0110-10" target="_blank" title="https://l.fatbobman.com/w0110-10" ref="nofollow noopener noreferrer">SwiftUI-DetectGestureUtilï¼šä¸ºå•ä¸ª SwiftUI è§†å›¾ç»‘å®šå¤šä¸ªè‡ªå®šä¹‰æ‰‹åŠ¿</a></h3>
<p>åœ¨ SwiftUI ä¸­ï¼Œè®©åŒä¸€ä¸ªè§†å›¾åŒæ—¶è¯†åˆ«å¤šä¸ªæ‰‹åŠ¿ä¸€ç›´æ˜¯ä¸ªæ£˜æ‰‹çš„é—®é¢˜ã€‚ç”± <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FSaw-000" target="_blank" title="https://github.com/Saw-000" ref="nofollow noopener noreferrer">Saw-000</a> å¼€å‘çš„ SwiftUI-DetectGestureUtil é€šè¿‡å¼•å…¥ç‹¬ç«‹çš„â€œæ£€æµ‹é˜¶æ®µâ€ï¼Œè®©å¼€å‘è€…èƒ½åœ¨å¤šä¸ªè‡ªå®šä¹‰æ‰‹åŠ¿ä¸­åªç¡®è®¤å…¶ä¸­ä¸€ä¸ªï¼Œä»è€Œç»•å¼€ç³»ç»Ÿé»˜è®¤ç»„åˆæ–¹å¼ï¼ˆsimultaneousã€sequencedã€exclusiveï¼‰å¸¦æ¥çš„çº¦æŸï¼Œå®ç°æ›´è‡ªç„¶çš„å¤šæ‰‹åŠ¿äº¤äº’ã€‚</p>
<p>å®ƒå°†æ‰‹åŠ¿è¯†åˆ«æµç¨‹æ¸…æ™°åœ°æ‹†åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š</p>
<ul>
<li><strong>æ£€æµ‹é˜¶æ®µ</strong>(<code>detectGesture</code>)ï¼šåœ¨æ‰‹åŠ¿å‘ç”Ÿçš„æ•´ä¸ªå‘¨æœŸå†…æŒç»­æ›´æ–°çŠ¶æ€ï¼Œç›´åˆ°æŸä¸€è‡ªå®šä¹‰è§„åˆ™åŒ¹é…å¹¶è¿”å›æ‰‹åŠ¿ç±»å‹</li>
<li><strong>å¤„ç†é˜¶æ®µ</strong>(<code>handleGesture</code>)ï¼šåœ¨è¯†åˆ«å®ŒæˆåæŒç»­è¿½è¸ªæ‰‹åŠ¿è¿›å±•,é€šè¿‡ <code>.yet</code> ä¸ <code>.finished</code> æ˜ç¡®æ§åˆ¶ç”Ÿå‘½å‘¨æœŸ</li>
</ul>
<p>è¿™ä¸€æ¨¡å‹ä¸ºæ„å»ºå¤æ‚äº¤äº’ï¼ˆå¦‚â€œåŒå‡» + æ‹–åŠ¨â€ã€â€œåœ†å½¢ç»˜åˆ¶â€ã€â€œè‡ªå®šä¹‰ç¬”è¿¹æ£€æµ‹â€ï¼‰æä¾›äº†æ–°çš„æ€è·¯ã€‚å€ŸåŠ© <code>DetectGestureState</code>ï¼Œå¼€å‘è€…å¯åœ¨ä¸€æ¬¡æ‰‹åŠ¿å‘¨æœŸå†…è·å¾—æ‰€æœ‰è§¦ç‚¹ã€æ—¶é—´ä¸å‡ ä½•ä¿¡æ¯ï¼Œå®ç°è¿œè¶… SwiftUI åŸç”Ÿ Gesture API çš„è¡¨è¾¾åŠ›ä¸ç²¾åº¦ã€‚</p>
<h2 data-id="heading-12">å¾€æœŸå†…å®¹</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fhttps%3A%2F%2Ffatbobman.com%2Fzh%2Fweekly%2Fissue-109%2F" target="_blank" title="https://https://fatbobman.com/zh/weekly/issue-109/" ref="nofollow noopener noreferrer">æƒŠé™©ä½†å¹¸è¿ï¼Œä¸¤æ¬¡ï¼ - #109</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fweekly%2Fissue-108%2F" target="_blank" title="https://fatbobman.com/zh/weekly/issue-108/" ref="nofollow noopener noreferrer">Swift å®˜æ–¹å‘å¸ƒ Android SDK - #108</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fweekly%2Fissue-107%2F" target="_blank" title="https://fatbobman.com/zh/weekly/issue-107/" ref="nofollow noopener noreferrer">å» Apple Store ä¿®æ‰‹æœº - #107</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fweekly%2Fissue-106%2F" target="_blank" title="https://fatbobman.com/zh/weekly/issue-106/" ref="nofollow noopener noreferrer">é«˜é€šæ”¶è´­ Arduinoï¼šå†å²çš„è½®å› - #106</a></li>
</ul>
<h2 data-id="heading-13">THANK YOU</h2>
<p>å¦‚æœä½ è§‰å¾—è¿™ä»½å‘¨æŠ¥æˆ–è€…æˆ‘çš„æ–‡ç« å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œæ¬¢è¿Â <strong>ç‚¹èµ</strong>Â å¹¶å°†å…¶Â <strong>è½¬å‘</strong>Â ç»™æ›´å¤šçš„æœ‹å‹ã€‚</p>
<blockquote>
<p>ğŸ“® æƒ³æŒç»­å…³æ³¨ Swift æŠ€æœ¯å‰æ²¿ï¼Ÿ</p>
<p>æ¯å‘¨ä¸€æœŸã€Šè‚˜å­çš„ Swift å‘¨æŠ¥ã€‹ï¼Œä¸ºä½ ç²¾é€‰æœ¬å‘¨æœ€å€¼å¾—å…³æ³¨çš„ Swiftã€SwiftUI æŠ€æœ¯æ–‡ç« ã€å¼€æºé¡¹ç›®å’Œç¤¾åŒºåŠ¨æ€ã€‚</p>
<ul>
<li>ğŸ“¬ åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fweekly.fatbobman.com" target="_blank" title="https://weekly.fatbobman.com" ref="nofollow noopener noreferrer">weekly.fatbobman.com</a> å…è´¹è®¢é˜…</li>
<li>ğŸ’¬ åŠ å…¥ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdiscord.com%2Finvite%2F7FedN5E2QQ" target="_blank" title="https://discord.com/invite/7FedN5E2QQ" ref="nofollow noopener noreferrer">Discord</a> ä¸ä¸­æ–‡ Swift å¼€å‘è€…æ·±å…¥äº¤æµ</li>
<li>ğŸ“š è®¿é—® <a href="https://link.juejin.cn?target=http%3A%2F%2Ffatbobman.com" target="_blank" title="http://fatbobman.com" ref="nofollow noopener noreferrer">fatbobman.com</a> æŸ¥çœ‹æ•°ç™¾ç¯‡æ·±åº¦åŸåˆ›æ•™ç¨‹Â </li>
</ul>
<p>ä¸€èµ·æ„å»ºæ›´å¥½çš„ Swift åº”ç”¨ï¼ğŸš€</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é‡æ¸© Java 21 ä¹‹å‘é‡ API]]></title>    <link>https://juejin.cn/post/7570908785293950995</link>    <guid>https://juejin.cn/post/7570908785293950995</guid>    <pubDate>2025-11-11T00:00:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570908785293950995" data-draft-id="7570923924365197375" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é‡æ¸© Java 21 ä¹‹å‘é‡ API"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-11-11T00:00:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ—¥ä¹ ä¸€æŠ€"/> <meta itemprop="url" content="https://juejin.cn/user/3913917125896190"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é‡æ¸© Java 21 ä¹‹å‘é‡ API
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3913917125896190/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ—¥ä¹ ä¸€æŠ€
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.1 åˆå­¦ä¹ç»ƒ
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.1 åˆå­¦ä¹ç»ƒ" title="VIP.1 åˆå­¦ä¹ç»ƒ" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T00:00:25.000Z" title="Tue Nov 11 2025 00:00:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>å‘é‡ API</strong> æœ€åˆç”± <a href="https://link.juejin.cn?target=https%3A%2F%2Fopenjdk.java.net%2Fjeps%2F338" target="_blank" title="https://openjdk.java.net/jeps/338" ref="nofollow noopener noreferrer">JEP 338</a> æå‡ºï¼Œå¹¶ä½œä¸ºå­µåŒ– API é›†æˆåˆ° Java 16 ä¸­ï¼Œåœ¨ Java 17 åˆ° 20 ä¸­ï¼Œåˆç»è¿‡äº† <a href="https://link.juejin.cn?target=https%3A%2F%2Fopenjdk.java.net%2Fjeps%2F414" target="_blank" title="https://openjdk.java.net/jeps/414" ref="nofollow noopener noreferrer">JEP 414</a>ã€<a href="https://link.juejin.cn?target=https%3A%2F%2Fopenjdk.java.net%2Fjeps%2F417" target="_blank" title="https://openjdk.java.net/jeps/417" ref="nofollow noopener noreferrer">JEP 417</a>ã€<a href="https://link.juejin.cn?target=https%3A%2F%2Fopenjdk.java.net%2Fjeps%2F426" target="_blank" title="https://openjdk.java.net/jeps/426" ref="nofollow noopener noreferrer">JEP 426</a>ã€<a href="https://link.juejin.cn?target=https%3A%2F%2Fopenjdk.org%2Fjeps%2F438" target="_blank" title="https://openjdk.org/jeps/438" ref="nofollow noopener noreferrer">JEP 438</a> å››æ¬¡çš„å­µåŒ–ï¼Œè¿™æ¬¡åœ¨ Java 21 ä¸­ï¼Œå·²ç»æ˜¯ç¬¬å…­æ¬¡å­µåŒ–äº†ã€‚</p>
<p><strong>å‘é‡ API</strong> åˆè¢«ç§°ä¸º <strong>Vector API</strong>ï¼Œè¦æ³¨æ„ï¼Œè¿™é‡Œè®²çš„å¹¶ä¸æ˜¯ Java ä¸­çš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.oracle.com%2Fjavase%2F8%2Fdocs%2Fapi%2Fjava%2Futil%2FVector.html" target="_blank" title="https://docs.oracle.com/javase/8/docs/api/java/util/Vector.html" ref="nofollow noopener noreferrer">Vector é›†åˆç±»</a>ï¼Œè€Œæ˜¯ä¸€ç§ä¸“é—¨ç”¨äºå‘é‡è®¡ç®—çš„å…¨æ–° APIã€‚å°½ç®¡è¿™ä¸ª API è¿˜åœ¨å­µåŒ–æœŸï¼Œå¹¶æ²¡æœ‰æ­£å¼å‘å¸ƒï¼Œä½†æ˜¯è¿™é¡¹æŠ€æœ¯å¾ˆå€¼å¾—æˆ‘ä»¬æå‰å­¦ä¹ å’Œäº†è§£ï¼Œå› ä¸ºè¿™é¡¹æŠ€æœ¯ä»£è¡¨äº† Java è¯­è¨€å‘å±•çš„ä¸€ä¸ªé‡è¦æ–¹å‘ï¼Œåœ¨æœªæ¥ä¸€å®šä¼šæœ‰ç€é‡è¦çš„å½±å“ã€‚éšç€ç”Ÿæˆå¼äººå·¥æ™ºèƒ½çš„å‘å±•ï¼ŒEmbedding æŠ€æœ¯ä¹Ÿå¦‚æ—¥ä¸­å¤©ï¼Œå®ƒå°†å„ç§ç±»å‹çš„æ•°æ®ï¼ˆå¦‚æ–‡æœ¬ã€å›¾åƒã€å£°éŸ³ç­‰ï¼‰è½¬æ¢ä¸ºé«˜ç»´æ•°å€¼å‘é‡ï¼Œä»è€Œå®ç°å¯¹æ•°æ®ç‰¹å¾å’Œè¯­ä¹‰ä¿¡æ¯çš„è¡¨ç¤ºã€‚Embedding æŠ€æœ¯åœ¨ä¸ªæ€§åŒ–æ¨èã€å¤šæ¨¡æ€æ£€ç´¢å’Œè‡ªç„¶è¯­è¨€å¤„ç†ç­‰é¢†åŸŸä¸­å‘æŒ¥ç€é‡è¦ä½œç”¨ï¼Œè€Œè¿™äº›åœºæ™¯éƒ½ç¦»ä¸å¼€å‘é‡è®¡ç®—ã€‚</p>
<h2 data-id="heading-0">ä»€ä¹ˆæ˜¯å‘é‡ï¼Ÿ</h2>
<p>å‘é‡æ˜¯æ•°å­¦å’Œç‰©ç†å­¦ä¸­çš„ä¸€ä¸ªåŸºæœ¬æ¦‚å¿µï¼Œå…·æœ‰å¤§å°å’Œæ–¹å‘ä¸¤ä¸ªå±æ€§ï¼Œæ¯”å¦‚ç‰©ç†å­¦ä¸­çš„åŠ›å°±æ˜¯å‘é‡ã€‚å‘é‡å¯ä»¥æœ‰å¤šç§ä¸åŒçš„è¡¨ç¤ºæ–¹å¼ï¼š</p>
<ul>
<li>åœ¨ä»£æ•°ä¸­ï¼Œä¸€èˆ¬å°åˆ·ç”¨é»‘ä½“çš„å°å†™è‹±æ–‡å­—æ¯æ¥è¡¨ç¤ºï¼ˆæ¯”å¦‚ <strong>a</strong>ã€<strong>b</strong>ã€<strong>c</strong> ç­‰ï¼‰ï¼Œæ‰‹å†™ç”¨åœ¨ aã€bã€c ç­‰å­—æ¯ä¸ŠåŠ ä¸€ç®­å¤´ï¼ˆâ†’ï¼‰è¡¨ç¤ºï¼›</li>
<li>åœ¨å‡ ä½•ä¸­ï¼Œå‘é‡å¯ä»¥å½¢è±¡åŒ–åœ°è¡¨ç¤ºä¸ºå¸¦ç®­å¤´çš„çº¿æ®µï¼Œç®­å¤´æ‰€æŒ‡çš„æ–¹å‘ä»£è¡¨å‘é‡çš„æ–¹å‘ï¼Œçº¿æ®µé•¿åº¦åˆ™ä»£è¡¨å‘é‡çš„å¤§å°ï¼›</li>
<li>åœ¨åæ ‡ç³»ä¸­ï¼Œå‘é‡å¯ä»¥ç”¨ç‚¹çš„åæ ‡ä½ç½®æ¥è¡¨ç¤ºï¼Œæ¯”å¦‚å¹³é¢ç›´è§’åæ ‡ç³»ä¸­çš„å‘é‡å¯ä»¥è®°ä¸º <code>(x, y)</code>ï¼Œç©ºé—´ç›´è§’åæ ‡ç³»ä¸­çš„å‘é‡å¯ä»¥è®°ä¸º <code>(x, y, z)</code>ï¼Œå¤šç»´ç©ºé—´ä»¥æ­¤ç±»æ¨ï¼›æ­¤å¤–ï¼Œå‘é‡ä¹Ÿå¯ä»¥ä½¿ç”¨çŸ©é˜µæ¥è¡¨ç¤ºï¼›</li>
<li>åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œå‘é‡å¯ä»¥è¢«ç†è§£ä¸ºä¸€ä¸ªæ•°å­—åˆ—è¡¨æˆ–æ•°ç»„ï¼Œè¿™åœ¨ç¼–ç¨‹è¯­è¨€ä¸­å°¤ä¸ºå¸¸è§ã€‚</li>
</ul>
<p>å’Œå‘é‡è¿™ä¸ªæ¦‚å¿µç›¸å¯¹åº”çš„ï¼Œè¿˜æœ‰æ ‡é‡ã€çŸ©é˜µã€å¼ é‡ç­‰æ¦‚å¿µï¼Œè¿™å‡ ä¸ªæ¦‚å¿µå¯ä»¥ä»£è¡¨ä¸åŒçš„ç»´åº¦ï¼Œä¸€èˆ¬ç”¨ç‚¹çº¿é¢ä½“æ¥ç±»æ¯”ï¼š</p>
<ul>
<li>ç‚¹â€”â€”æ ‡é‡ï¼ˆscalarï¼‰</li>
<li>çº¿â€”â€”å‘é‡ï¼ˆvectorï¼‰</li>
<li>é¢â€”â€”çŸ©é˜µï¼ˆmatrixï¼‰</li>
<li>ä½“â€”â€”å¼ é‡ï¼ˆtensorï¼‰</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/865c9ad3f89b479db11f90259960a725~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763424025&amp;x-signature=dfF%2FTddksEU9Lv3R9IDeyFYB16Y%3D" alt="vector.png" loading="lazy"/></p>
<h2 data-id="heading-1">æ ‡é‡è®¡ç®— vs. å‘é‡è®¡ç®—</h2>
<p>æ ‡é‡å°±æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œåœ¨ Java ä¸­é€šå¸¸å¯ä»¥è¡¨ç¤ºä¸ºä¸€ä¸ªæ•´æ•°æˆ–æµ®ç‚¹æ•°ç­‰ï¼Œæˆ‘ä»¬æ‰€ç†ŸçŸ¥çš„ç®—æœ¯è¿ç®—åŸºæœ¬ä¸Šéƒ½æ˜¯ä½œç”¨äºæ ‡é‡ä¹‹ä¸Šçš„ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä»£ç å¯¹ <code>a</code> å’Œ <code>b</code> ä¸¤ä¸ªæ ‡é‡æ±‚å’Œï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
<span class="hljs-type">int</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
<span class="hljs-type">int</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> a + b;
</code></pre>
<p>å¦‚æœå°† <code>a</code> å’Œ <code>b</code> æ¢æˆå‘é‡ï¼Œä¹Ÿå°±æ˜¯æ•°ç»„ï¼Œè¯¥å¦‚ä½•æ±‚å’Œå‘¢ï¼Ÿæœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨ <code>for</code> å¾ªç¯ä¾æ¬¡ç›¸åŠ æ•°ç»„ä¸­å¯¹åº”çš„å…ƒç´ ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">int</span>[] a = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[] {<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>};
<span class="hljs-type">int</span>[] b = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[] {<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>};
<span class="hljs-type">int</span>[] c = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">4</span>];
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; a.length; i++) {
  c[i] = a[i] + b[i];
}
</code></pre>
<p>å¾ˆæ˜¾ç„¶è¿™ä¸æ˜¯ä»€ä¹ˆé«˜æ˜çš„åšæ³•ï¼Œä»”ç»†è§‚å¯Ÿä¸Šé¢çš„ä»£ç å°±ä¼šå‘ç°ï¼Œå¯¹äºæ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ çš„ç›¸åŠ æ˜¯äº’ä¸å½±å“çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬èƒ½ä¸èƒ½å¹¶è¡Œè®¡ç®—å‘¢ï¼Ÿä¸€ç§æœ‰æ•ˆçš„è§£å†³æ–¹æ³•æ˜¯ä½¿ç”¨ <strong>å¹¶è¡Œæµï¼ˆParallel Streamï¼‰</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java">IntStream.range(<span class="hljs-number">0</span>, a.length)
  .parallel()
  .forEach(i -&gt; c[i] = a[i] + b[i]);
</code></pre>
<p>å¦ä¸€ç§è§£å†³æ–¹æ³•å°±æ˜¯æˆ‘ä»¬å°†è¦å­¦ä¹ çš„ <strong>å‘é‡ APIï¼ˆVector APIï¼‰</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">IntVector</span> <span class="hljs-variable">aVector</span> <span class="hljs-operator">=</span> IntVector.fromArray(IntVector.SPECIES_128, a, <span class="hljs-number">0</span>);
<span class="hljs-type">IntVector</span> <span class="hljs-variable">bVector</span> <span class="hljs-operator">=</span> IntVector.fromArray(IntVector.SPECIES_128, b, <span class="hljs-number">0</span>);
<span class="hljs-type">IntVector</span> <span class="hljs-variable">cVector</span> <span class="hljs-operator">=</span> aVector.add(bVector);
</code></pre>
<p>æ³¨æ„ï¼Œç”±äºå‘é‡ API å¹¶æ²¡æœ‰æ­£å¼å‘å¸ƒï¼Œè¿è¡Œæ—¶éœ€è¦æ‰‹åŠ¨åŠ ä¸Š <code>jdk.incubator.vector</code> æ¨¡å—ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">$ java --add-modules jdk.incubator.vector VectorDemo.java
</code></pre>
<p>å‘é‡ API å®šä¹‰äº†ä¸“é—¨çš„å‘é‡ç±»ï¼Œæ¯”å¦‚è¿™é‡Œçš„ <code>IntVector</code>ï¼Œå¹¶æä¾›äº† <code>fromArray</code> æ–¹æ³•æ–¹ä¾¿æˆ‘ä»¬å°†æ•°ç»„è½¬æ¢ä¸ºå‘é‡ï¼Œç„¶åå†é€šè¿‡ <code>aVector.add(bVector)</code> æ‰§è¡Œä¸¤ä¸ªå‘é‡çš„åŠ æ³•è¿ç®—ã€‚</p>
<p>é™¤äº†åŠ æ³•è¿ç®—ï¼Œå‘é‡ API è¿˜æä¾›äº†ä¸€ç»„æ–¹æ³•æ¥æ‰§è¡Œå„ç§å…¶ä»–çš„å‘é‡è®¡ç®—ï¼š</p>
<ul>
<li>ç®—æœ¯è¿ç®—ï¼ˆArithmetic Operationsï¼‰
<ul>
<li>åŠ æ³•ï¼š<code>vector1.add(vector2)</code></li>
<li>å‡æ³•ï¼š<code>vector1.sub(vector2)</code></li>
<li>ä¹˜æ³•ï¼š<code>vector1.mul(vector2)</code></li>
<li>é™¤æ³•ï¼š<code>vector1.div(vector2)</code></li>
</ul>
</li>
<li>é€å…ƒç´ æ“ä½œï¼ˆElement-Wise Operationsï¼‰
<ul>
<li>ç»å¯¹å€¼ï¼š<code>vector.abs()</code></li>
<li>è´Ÿæ•°ï¼š<code>vector.neg()</code></li>
<li>å¹³æ–¹æ ¹ï¼š<code>vector.sqrt()</code></li>
<li>æŒ‡æ•°ï¼š<code>vector.exp()</code></li>
<li>å¯¹æ•°ï¼š<code>vector.log()</code></li>
</ul>
</li>
<li>è§„çº¦è¿ç®—ï¼ˆReductionsï¼‰
<ul>
<li>å…ƒç´ ä¹‹å’Œï¼š<code>vector.reduce(VectorOperators.ADD)</code></li>
<li>æœ€å°å…ƒç´ ï¼š<code>vector.reduce(VectorOperators.MIN)</code></li>
<li>æœ€å¤§å…ƒç´ ï¼š<code>vector.reduce(VectorOperators.MAX)</code></li>
<li>å¹³å‡å€¼ï¼š<code>vector.reduce(VectorOperators.ADD).mul(1.0 / vector.length())</code></li>
</ul>
</li>
<li>é€»è¾‘è¿ç®—ï¼ˆLogical Operationsï¼‰
<ul>
<li>ä¸ï¼š<code>vector1.and(vector2)</code></li>
<li>æˆ–ï¼š<code>vector1.or(vector2)</code></li>
<li>éï¼š<code>vector.not()</code></li>
</ul>
</li>
<li>æ¯”è¾ƒæ“ä½œï¼ˆComparisonsï¼‰
<ul>
<li>ç­‰äºï¼š<code>vector1.eq(vector2)</code></li>
<li>å°äºï¼š<code>vector1.lt(vector2)</code></li>
<li>å¤§äºï¼š<code>vector1.compare(VectorOperators.GT, vector2)</code></li>
</ul>
</li>
</ul>
<h2 data-id="heading-2">å•æŒ‡ä»¤å¤šæ•°æ®ï¼ˆSIMDï¼‰</h2>
<p>ä½¿ç”¨å‘é‡ API æ¥æ‰§è¡Œå‘é‡è®¡ç®—ï¼Œä¸ä»…ä»£ç ç²¾ç®€ï¼Œå®¹æ˜“ç†è§£ï¼Œè€Œä¸”å®ƒè¿˜æœ‰å¦ä¸€ä¸ªå¥½å¤„ï¼Œé‚£å°±æ˜¯æ€§èƒ½æå‡ã€‚å°½ç®¡ä½¿ç”¨å¹¶è¡Œæµä¹Ÿèƒ½æå‡ä¸€å®šçš„æ€§èƒ½ï¼Œä½†æ˜¯å¹¶è¡Œæµå’Œå‘é‡ API æ˜¯ä¸¤ç§å®Œå…¨ä¸åŒçš„ä¼˜åŒ–æŠ€æœ¯ï¼Œå‰è€…ä½¿ç”¨å¤šçº¿ç¨‹åœ¨ä¸åŒçš„ CPU æ ¸ä¸Šå¹¶è¡Œè®¡ç®—ï¼Œè€Œåè€…é€šè¿‡ SIMD æŠ€æœ¯ï¼Œåœ¨å•ä¸ª CPU å‘¨æœŸå†…å¯¹å¤šä¸ªæ•°æ®åŒæ—¶æ‰§è¡Œç›¸åŒæ“ä½œï¼Œä»è€Œè¾¾åˆ°å¹¶è¡Œè®¡ç®—çš„ç›®çš„ã€‚</p>
<p><strong>SIMDï¼ˆSingle Instruction, Multiple Dataï¼Œå•æŒ‡ä»¤å¤šæ•°æ®ï¼‰</strong> æ˜¯ä¸€ç§å¹¶è¡Œå¤„ç†æŠ€æœ¯ï¼Œå®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†ä¸€ä¸ªæ§åˆ¶å™¨ä¸å¤šä¸ªå¤„ç†å•å…ƒç»“åˆåœ¨ä¸€èµ·ï¼Œä½¿å¾—è¿™äº›å¤„ç†å•å…ƒå¯ä»¥é’ˆå¯¹ä¸åŒçš„æ•°æ®åŒæ—¶æ‰§è¡Œç›¸åŒçš„æ“ä½œï¼Œç®€å•æ¥è¯´å°±æ˜¯ä¸€ä¸ªæŒ‡ä»¤èƒ½å¤ŸåŒæ—¶å¤„ç†å¤šä¸ªæ•°æ®ã€‚è¿™ä¸ä¼ ç»Ÿçš„ <strong>SISDï¼ˆSingle Instruction, Single Dataï¼Œå•æŒ‡ä»¤å•æ•°æ®ï¼‰</strong> å½¢æˆå¯¹æ¯”ï¼Œåœ¨åè€…ä¸­ï¼Œä¸€ä¸ªæŒ‡ä»¤åªèƒ½å¤„ç†ä¸€ä¸ªæ•°æ®ã€‚</p>
<p>åœ¨ä¸Šé¢é‚£ä¸ªå‘é‡æ±‚å’Œçš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å…ˆæ˜¯ä½¿ç”¨ <code>for</code> å¾ªç¯å®ç°ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; a.length; i++) {
  c[i] = a[i] + b[i];
}
</code></pre>
<p>æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ å°†ä½¿ç”¨ï¼ˆå¤§è‡´ï¼‰1 ä¸ª CPU æŒ‡ä»¤è¿›è¡Œè®¡ç®—ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦ 4 ä¸ªæŒ‡ä»¤æˆ– 4 ä¸ª CPU å‘¨æœŸæ‰èƒ½å®Œæˆè®¡ç®—ï¼Œè¿™å°±æ˜¯å…¸å‹çš„ SISDã€‚è€Œä½¿ç”¨å‘é‡ API å¯ä»¥å°†å‘é‡çš„è®¡ç®—ç¼–è¯‘ä¸ºå¯¹åº” CPU æ¶æ„ä¸Šçš„ SIMD æŒ‡ä»¤é›†ï¼Œåªè¦ 1 ä¸ªæŒ‡ä»¤å³å¯å®Œæˆå‘é‡è®¡ç®—ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d501a8c58b7d4e2b9b5ab5f0e9a4e92d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763424025&amp;x-signature=Dg2Hl9n39B8Tf52KogAz%2F5SeNV8%3D" alt="simd.png" loading="lazy"/></p>
<p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè®¸å¤šç°ä»£å¤„ç†å™¨éƒ½æ”¯æŒ SIMD æŒ‡ä»¤é›†ï¼Œå¦‚ Intel çš„ <strong>MMX</strong>ã€<strong>SSE</strong> å’Œ <strong>AVX</strong>ï¼ŒARM çš„ <strong>NEON</strong> å’Œ <strong>SVE</strong> ç­‰ï¼Œè¿™äº›æŒ‡ä»¤é›†èƒ½å¤Ÿæ˜¾è‘—æå‡ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦å¤§é‡æ•°å€¼è®¡ç®—çš„åœºæ™¯ä¸‹ã€‚ä¸è¿‡ä½¿ç”¨è¿™äº›æŒ‡ä»¤é›†çš„é—¨æ§›å¹¶ä¸ä½ï¼Œé€šå¸¸æ¶‰åŠåˆ°æ±‡ç¼–è¯­è¨€æˆ–ä¸€äº›ç‰¹æ®Šçš„å‡½æ•°åº“ï¼Œæ¯”å¦‚ Intel çš„è·¨å¹³å°å‡½æ•°åº“ <a href="https://link.juejin.cn?target=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FIntegrated_Performance_Primitives" target="_blank" title="https://en.wikipedia.org/wiki/Integrated_Performance_Primitives" ref="nofollow noopener noreferrer">IPPï¼ˆIntegrated Performance Primitivesï¼‰</a> æˆ–ä½¿ç”¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FIntrinsic_function" target="_blank" title="https://en.wikipedia.org/wiki/Intrinsic_function" ref="nofollow noopener noreferrer">å†…ç½®å‡½æ•° (Intrinsic function)</a> ç­‰ã€‚</p>
<p>ç›¸æ¯”äºä¼ ç»Ÿçš„æ‰‹å†™ SIMD ä»£ç ï¼ŒJava çš„å‘é‡ API æä¾›äº†æ›´é«˜çš„å¯è¯»æ€§å’Œç»´æŠ¤æ€§ï¼Œå¼€å‘è€…å¯ä»¥ä½¿ç”¨ç†Ÿæ‚‰çš„ Java è¯­æ³•å’Œç±»å‹ç³»ç»Ÿï¼Œæ— éœ€å¤„ç†åº•å±‚å¯„å­˜å™¨å’ŒæŒ‡ä»¤ï¼Œç¼–å†™å‡ºç®€æ´æ˜äº†çš„ã€å¹³å°æ— å…³çš„ã€é«˜æ€§èƒ½çš„å‘é‡è®¡ç®—ä»£ç ã€‚</p>
<p>å…¶å®ï¼Œåœ¨å‘é‡ API æå‡ºä¹‹å‰ï¼ŒJava å·²ç»åœ¨ SIMD ä¸Šæ¢ç´¢äº†å¾ˆé•¿ä¸€æ®µæ—¶é—´äº†ï¼Œæ¯”å¦‚ HotSpot çš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fcr.openjdk.org%2F~vlivanov%2Ftalks%2F2017_Vectorization_in_HotSpot_JVM.pdf" target="_blank" title="https://cr.openjdk.org/~vlivanov/talks/2017_Vectorization_in_HotSpot_JVM.pdf" ref="nofollow noopener noreferrer">è‡ªåŠ¨å‘é‡åŒ–ï¼ˆAuto-Vectorizationï¼‰</a> åŠŸèƒ½ï¼Œå®ƒå°†æ ‡é‡æ“ä½œè½¬æ¢ä¸º <strong>è¶…å­—æ“ä½œï¼ˆSuperWord Operationsï¼‰</strong>ï¼Œç„¶åå†æ˜ å°„åˆ° SIMD æŒ‡ä»¤ã€‚ç„¶è€Œï¼Œè¿™ä¸ªè¿‡ç¨‹å®Œå…¨ä¾èµ– JITï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆå¯é çš„æ–¹æ³•æ¥ä¿è¯ç¼–å†™çš„ä»£ç ä¸€å®šå¯ä»¥ä½¿ç”¨ SIMD æŒ‡ä»¤ä¼˜åŒ–ï¼Œæœ‰äº›ä»£ç ç”šè‡³æ ¹æœ¬æ— æ³•è¿›è¡Œä¼˜åŒ–ï¼Œå¼€å‘äººå‘˜å¿…é¡»æ·±å…¥äº†è§£ HotSpot çš„è‡ªåŠ¨å‘é‡åŒ–ç®—æ³•åŠå…¶é™åˆ¶ï¼Œæ‰èƒ½å®ç°å¯é çš„æ€§èƒ½æå‡ã€‚å‘é‡ API ä½¿å¾—è¿™ä¸ªè¿‡ç¨‹å®Œå…¨ç”±å¼€å‘äººå‘˜è‡ªå·±æ§åˆ¶ï¼Œå› æ­¤å¯ä»¥å†™å‡ºæ›´åŠ å¯é¢„æµ‹ã€æ›´åŠ ç¨³å¥çš„ä»£ç ã€‚</p>
<blockquote>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>-XX:-UseSuperWord</code> å‚æ•°å…³é—­ HotSpot çš„è‡ªåŠ¨å‘é‡åŒ–åŠŸèƒ½ã€‚</p>
</blockquote>
<h2 data-id="heading-3">ä½¿ç”¨å‘é‡ API</h2>
<p>åœ¨å­¦ä¹ äº†å‘é‡çš„åŸºç¡€çŸ¥è¯†ä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†ç»§ç»­æ·±å…¥å­¦ä¹ å‘é‡ API çš„ä½¿ç”¨ã€‚</p>
<p>ä¸Šé¢ä»‹ç»å‘é‡è®¡ç®—æ—¶ï¼Œæˆ‘ä»¬å·²ç»å­¦ä¹ äº†å‘é‡ API çš„åŸºæœ¬ç”¨æ³•ï¼Œä½¿ç”¨ <code>IntVector</code> å®ç°ä¸¤ä¸ªå‘é‡ç›¸åŠ ã€‚è¿™ä¸ªç¤ºä¾‹ä¸ºäº†æ˜“äºç†è§£ï¼Œåšäº†ç®€å•å¤„ç†ï¼Œå¹¶æ²¡æœ‰è€ƒè™‘åœ¨å®é™…ä½¿ç”¨æ—¶çš„è¾¹ç•Œæƒ…å†µï¼Œå‡è®¾æˆ‘ä»¬å°† <code>a</code> å’Œ <code>b</code> ä¸¤ä¸ªæ•°ç»„æ”¹æˆ 10 ä¸ªæ•°å­—ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">int</span>[] a = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[] {<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>};
<span class="hljs-type">int</span>[] b = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[] {<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>};
<span class="hljs-type">IntVector</span> <span class="hljs-variable">aVector</span> <span class="hljs-operator">=</span> IntVector.fromArray(IntVector.SPECIES_128, a, <span class="hljs-number">0</span>);
<span class="hljs-type">IntVector</span> <span class="hljs-variable">bVector</span> <span class="hljs-operator">=</span> IntVector.fromArray(IntVector.SPECIES_128, b, <span class="hljs-number">0</span>);
<span class="hljs-type">IntVector</span> <span class="hljs-variable">cVector</span> <span class="hljs-operator">=</span> aVector.add(bVector);
</code></pre>
<p>è¿è¡Œåå¾—åˆ°çš„ç»“æœ <code>c</code> ä»ç„¶æ˜¯ <code>[2, 4, 6, 8]</code>ï¼Œåé¢æ–°åŠ çš„æ•°å­—å¹¶æ²¡æœ‰è®¡ç®—ã€‚è¿™æ˜¯å› ä¸ºæ¯ä¸ªå‘é‡çš„å­˜å‚¨ç©ºé—´æœ‰é™ï¼Œå¹¶ä¸èƒ½ä¸€æ¬¡å­˜ä¸‹æ‰€æœ‰çš„æ•°æ®ã€‚è¿™é‡Œæ¶‰åŠå‘é‡ API çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼š<strong>å‘é‡ç§ç±»ï¼ˆVector Speciesï¼‰</strong>ï¼Œå®ƒæ˜¯ <strong>æ•°æ®ç±»å‹ï¼ˆData Typesï¼‰</strong> å’Œ <strong>å‘é‡å½¢çŠ¶ï¼ˆVector Shapesï¼‰</strong> çš„ç»„åˆï¼›æ‰€è°“æ•°æ®ç±»å‹å°±æ˜¯ Java çš„åŸºç¡€ç±»å‹ï¼Œæ¯”å¦‚ byteã€shortã€intã€long è¿™äº›æ•´æ•°ç±»å‹å’Œ floatã€double æµ®ç‚¹ç±»å‹ï¼Œè€Œæ‰€è°“å‘é‡å½¢çŠ¶å°±æ˜¯å‘é‡çš„ä½å¤§å°æˆ–ä½æ•°ï¼›æ¯”å¦‚è¿™é‡Œçš„å‘é‡ç§ç±»ä¸º <code>IntVector.SPECIES_128</code>ï¼Œå®ƒä»£è¡¨æ•°æ®ç±»å‹ä¸º intï¼Œå‘é‡å½¢çŠ¶ä¸º 128 ä½ï¼›è€Œæˆ‘ä»¬çŸ¥é“ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ int å€¼çš„å¤§å°ä¸º 32 ä½ï¼Œæ‰€ä»¥è¿™ä¸ªå‘é‡ä¸€æ¬¡åªèƒ½å­˜å‚¨ <code>128/32 = 4</code> ä¸ª int å€¼ï¼Œè¿™ä¹Ÿè¢«å½¢è±¡åœ°ç§°ä¸º <strong>é€šé“ï¼ˆLanesï¼‰</strong>ï¼Œè¡¨ç¤ºå‘é‡ä¸€æ¬¡å¯ä»¥å¤„ç†çš„æ•°æ®ä¸ªæ•°ã€‚</p>
<p>çŸ¥é“è¿™ä¸€ç‚¹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å†™å‡ºæ›´åŠ é€šç”¨çš„å‘é‡è®¡ç®—ä»£ç äº†ã€‚é¦–å…ˆæˆ‘ä»¬éœ€è¦å°†æ•°æ®æŒ‰é€šé“æ•°åˆ†ç»„ï¼Œç„¶åä¸€ç»„ä¸€ç»„çš„è¿›è¡Œå¤„ç†ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">int</span>[] a = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[] {<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>};
<span class="hljs-type">int</span>[] b = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[] {<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>};
<span class="hljs-type">int</span>[] c = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">10</span>];
<span class="hljs-type">int</span> <span class="hljs-variable">lanes</span> <span class="hljs-operator">=</span> IntVector.SPECIES_128.length();
<span class="hljs-type">int</span> <span class="hljs-variable">loopBound</span> <span class="hljs-operator">=</span> IntVector.SPECIES_128.loopBound(a.length);
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; loopBound; i += lanes) {
  <span class="hljs-type">IntVector</span> <span class="hljs-variable">aVector</span> <span class="hljs-operator">=</span> IntVector.fromArray(IntVector.SPECIES_128, a, i);
  <span class="hljs-type">IntVector</span> <span class="hljs-variable">bVector</span> <span class="hljs-operator">=</span> IntVector.fromArray(IntVector.SPECIES_128, b, i);
  <span class="hljs-type">IntVector</span> <span class="hljs-variable">cVector</span> <span class="hljs-operator">=</span> aVector.add(bVector);
  cVector.intoArray(c, i);
}
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> loopBound; i &lt; a.length; i++) {
  c[i] = a[i] + b[i];
}
IntStream.of(c).forEach(x -&gt; System.out.println(x));
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°ï¼Œåœ¨éå†æ—¶ i æ¯æ¬¡å¢åŠ  <code>lanes</code>ï¼Œå®ƒçš„å€¼ç­‰äº <code>IntVector.SPECIES_128.length()</code>ï¼Œä¹Ÿå°±æ˜¯é€šé“æ•°ï¼Œä¸€èˆ¬æ¥è¯´è¯¥å€¼ç­‰äº 4ï¼Œæ‰€ä»¥æˆ‘ä»¬æ˜¯æŒ‰ 4 ä¸ªä¸€ç»„è¿›è¡Œå¤„ç†çš„ã€‚ä½†æ˜¯è¦æ³¨æ„æ•°æ®ä¸ä¸€å®šèƒ½è¢«é€šé“æ•°å®Œå…¨æ•´é™¤ï¼Œæ¯”å¦‚è¿™é‡Œ 10 ä¸ªæ•°å­—ï¼Œå‰ 8 ä¸ªå¯ä»¥åˆ†ä¸ºä¸¤ç»„å¤„ç†æ‰ï¼Œè¿˜å‰©ä¸‹ 2 ä¸ªæ€ä¹ˆåŠå‘¢ï¼Ÿè¿™æ—¶æˆ‘ä»¬åªèƒ½ä½¿ç”¨æœ€åŸå§‹çš„æ ‡é‡è®¡ç®—æ¥å¤„ç†äº†ã€‚</p>
<p>æ­¤å¤–ï¼Œåœ¨å®é™…ç¼–ç æ—¶å‘é‡ç§ç±»ä¸å»ºè®®å†™æ­»ï¼Œå¯ä»¥ä½¿ç”¨ <code>IntVector.SPECIES_PREFERRED</code> æ›¿ä»£ï¼Œå®ƒä¼šæ ¹æ®å¹³å°è‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„å‘é‡ç§ç±»ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> VectorSpecies&lt;Integer&gt; SPECIES = IntVector.SPECIES_PREFERRED;
</code></pre>
<p>å¯ä»¥çœ‹å‡ºå°½ç®¡å‘é‡ API çš„ä½¿ç”¨æœ‰ä¸å°‘å¥½å¤„ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿéœ€è¦è°¨æ…å¯¹å¾…ï¼š</p>
<ul>
<li>é¦–å…ˆï¼Œåœ¨ä½¿ç”¨å‘é‡ API æ—¶ï¼Œæ•°æ®å¯¹é½æ˜¯ä¸€ä¸ªé‡è¦çš„è€ƒè™‘å› ç´ ï¼Œä¸å¯¹é½çš„æ•°æ®è®¿é—®å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚å¼€å‘è€…éœ€è¦ç¡®ä¿æ•°æ®åœ¨å†…å­˜ä¸­çš„å¯¹é½æ–¹å¼ï¼Œä»¥å……åˆ†å‘æŒ¥ SIMD æŒ‡ä»¤çš„ä¼˜åŠ¿ï¼›</li>
<li>å¦å¤–ï¼Œå‘é‡ API æœ‰ç¡¬ä»¶ä¾èµ–æ€§ï¼Œå®ƒä¾èµ–äºåº•å±‚ç¡¬ä»¶æ”¯æŒçš„ SIMD æŒ‡ä»¤é›†ï¼Œè®¸å¤šåŠŸèƒ½å¯èƒ½åœ¨å…¶ä»–å¹³å°å’Œæ¶æ„ä¸Šä¸å¯ç”¨ï¼Œæ€§èƒ½ä¹Ÿå¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚å¼€å‘è€…éœ€è¦äº†è§£ç›®æ ‡å¹³å°çš„ç‰¹æ€§ï¼Œå¹¶è¿›è¡Œé€‚å½“çš„æ€§èƒ½ä¼˜åŒ–ã€‚</li>
</ul>
<h2 data-id="heading-4">å°ç»“</h2>
<p>ä»Šå¤©æˆ‘ä»¬å­¦ä¹ äº† Java 21 ä¸­çš„ <strong>å‘é‡ APIï¼ˆVector APIï¼‰</strong>ï¼Œè¿™ä¸ªç‰¹æ€§ä» Java 16 å¼€å§‹å°±å·²å¼•å…¥ï¼Œä¸€ç›´åœ¨ä¸æ–­æ¼”è¿›å’Œå®Œå–„ã€‚å­¦ä¹ å†…å®¹æ€»ç»“å¦‚ä¸‹ï¼š</p>
<ol>
<li><strong>å‘é‡è®¡ç®—åŸºç¡€</strong> - å‘é‡æ˜¯æ•°å­¦å’Œç‰©ç†å­¦ä¸­çš„åŸºæœ¬æ¦‚å¿µï¼Œåœ¨è®¡ç®—æœºç§‘å­¦ä¸­è¢«è¡¨ç¤ºä¸ºæ•°ç»„æˆ–åˆ—è¡¨ã€‚å‘é‡è®¡ç®—ç›¸æ¯”æ ‡é‡è®¡ç®—ï¼Œé€šè¿‡ä¸€æ¬¡æ€§å¤„ç†å¤šä¸ªæ•°æ®å…ƒç´ ï¼Œæ˜¾è‘—æé«˜äº†è®¡ç®—æ•ˆç‡ï¼Œè¿™æ­£æ˜¯ç°ä»£é«˜æ€§èƒ½è®¡ç®—çš„å…³é”®æ‰€åœ¨ï¼›</li>
<li><strong>SIMD ä¼˜åŠ¿</strong> - å‘é‡ API å……åˆ†åˆ©ç”¨ç°ä»£å¤„ç†å™¨çš„ SIMDï¼ˆå•æŒ‡ä»¤å¤šæ•°æ®ï¼‰æŒ‡ä»¤é›†ç‰¹æ€§ï¼Œå¦‚ Intel çš„ AVX å’Œ ARM çš„ NEONï¼Œç›¸æ¯”äºæ‰‹å†™æ±‡ç¼–æˆ–ä½¿ç”¨ä½çº§ Unsafe APIï¼Œå‘é‡ API æä¾›äº†æ›´é«˜çš„å¯è¯»æ€§ã€æ›´å¥½çš„å¯ç»´æŠ¤æ€§å’Œæ›´å¯é çš„æ€§èƒ½ä¿è¯ï¼›</li>
<li><strong>å‘é‡ API çš„ä½¿ç”¨</strong>ï¼šè™½ç„¶å‘é‡ API å¸¦æ¥äº†æ€§èƒ½æå‡ï¼Œä½†æˆ‘ä»¬åœ¨ä½¿ç”¨æ—¶ä¹Ÿéœ€è¦å…³æ³¨æ•°æ®å¯¹é½ã€ç¡¬ä»¶ä¾èµ–æ€§ç­‰é—®é¢˜ï¼Œéœ€è¦æ ¹æ®ç›®æ ‡å¹³å°çš„ç‰¹æ€§è¿›è¡Œé€‚å½“çš„ä¼˜åŒ–ï¼Œè¿™æ ·æ‰èƒ½å……åˆ†å‘æŒ¥å‘é‡è®¡ç®—çš„ä¼˜åŠ¿ï¼›</li>
</ol>
<p>éšç€ç”Ÿæˆå¼äººå·¥æ™ºèƒ½çš„å¿«é€Ÿå‘å±•ï¼ŒEmbedding æŠ€æœ¯å’Œå‘é‡è®¡ç®—åœ¨æ¨èç³»ç»Ÿã€å¤šæ¨¡æ€æ£€ç´¢ã€è‡ªç„¶è¯­è¨€å¤„ç†ç­‰é¢†åŸŸçš„åº”ç”¨æ—¥ç›Šå¹¿æ³›ï¼Œå‘é‡ API ä¸º Java åœ¨è¿™äº›é¢†åŸŸçš„åº”ç”¨æä¾›äº†åŸºç¡€ï¼Œæœ‰æœ›æ¨åŠ¨ Java åœ¨ AI å’Œæ•°æ®ç§‘å­¦é¢†åŸŸçš„è¿›ä¸€æ­¥å‘å±•ã€‚</p>
<h2 data-id="heading-5">æ¬¢è¿å…³æ³¨</h2>
<p>å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹æ‚¨æœ‰æ‰€å¸®åŠ©ï¼Œæ¬¢è¿å…³æ³¨æˆ‘çš„åŒåå…¬ä¼—å·ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fi-study-everyday.online%2Fabout-me.html" target="_blank" title="https://i-study-everyday.online/about-me.html" ref="nofollow noopener noreferrer">æ—¥ä¹ ä¸€æŠ€ï¼Œæ¯å¤©å­¦ä¸€ç‚¹æ–°æŠ€æœ¯</a>ã€‚</p>
<p>æˆ‘ä¼šæ¯å¤©èŠ±ä¸€ä¸ªå°æ—¶ï¼Œè®°å½•ä¸‹æˆ‘å­¦ä¹ çš„ç‚¹ç‚¹æ»´æ»´ã€‚å†…å®¹åŒ…æ‹¬ä½†ä¸é™äºï¼š</p>
<ul>
<li>æŸä¸ªäº§å“çš„ä½¿ç”¨å°çªé—¨</li>
<li>å¼€æºé¡¹ç›®çš„å®è·µå’Œå¿ƒå¾—</li>
<li>æŠ€æœ¯ç‚¹çš„ç®€å•è§£è¯»</li>
</ul>
<p>ç›®æ ‡æ˜¯è®©å¤§å®¶ç”¨5åˆ†é’Ÿè¯»å®Œå°±èƒ½æœ‰æ‰€æ”¶è·ï¼Œä¸éœ€è¦å¤ªè´¹åŠ²ï¼Œä½†å´å¯ä»¥è½»æ¾è·å–ä¸€äº›å¹²è´§ã€‚ä¸ç®¡ä½ æ˜¯æŠ€æœ¯æ–°æ‰‹è¿˜æ˜¯è€é¸Ÿï¼Œæ¬¢è¿ç»™æˆ‘æå»ºè®®ï¼Œå¦‚æœæœ‰æƒ³å­¦ä¹ çš„æŠ€æœ¯ï¼Œä¹Ÿæ¬¢è¿äº¤æµï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Guava è¿­ä»£å™¨å¢å¼ºç±»ä»‹ç»]]></title>    <link>https://juejin.cn/post/7570903763722453002</link>    <guid>https://juejin.cn/post/7570903763722453002</guid>    <pubDate>2025-11-10T16:17:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570903763722453002" data-draft-id="7570897638441320475" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Guava è¿­ä»£å™¨å¢å¼ºç±»ä»‹ç»"/> <meta itemprop="keywords" content="åç«¯,Java,è®¾è®¡æ¨¡å¼"/> <meta itemprop="datePublished" content="2025-11-10T16:17:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ¡¦è¯´ç¼–ç¨‹"/> <meta itemprop="url" content="https://juejin.cn/user/2212689394274136"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Guava è¿­ä»£å™¨å¢å¼ºç±»ä»‹ç»
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2212689394274136/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ¡¦è¯´ç¼–ç¨‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T16:17:00.000Z" title="Mon Nov 10 2025 16:17:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Guava åº“ä¸º Java å¼€å‘è€…æä¾›äº†ä¸€ç³»åˆ—å¼ºå¤§çš„è¿­ä»£å™¨å¢å¼ºå·¥å…·ï¼Œå®ƒä»¬ç®€åŒ–äº†å¤æ‚è¿­ä»£æ¨¡å¼çš„å®ç°ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨ Guava çš„ PeekingIteratorã€AbstractIterator å’Œ AbstractSequentialIteratorã€‚</p>
<h3 data-id="heading-0">1. PeekingIteratorï¼šæ´å¯Ÿå…ˆæœº</h3>
<p>æ ‡å‡†çš„ Iterator æ¥å£ä»…æä¾› hasNext() å’Œ next() æ–¹æ³•ï¼Œè¿™åœ¨æŸäº›åœºæ™¯ä¸‹æ˜¾å¾—åŠ›ä¸ä»å¿ƒã€‚å½“éœ€è¦â€œé¢„è¯»â€ä¸‹ä¸€ä¸ªå…ƒç´ ä»¥åšå‡ºå†³ç­–ï¼Œä½†åˆä¸æƒ³ç«‹å³æ¶ˆè€—å®ƒæ—¶ï¼ŒPeekingIterator åº”è¿è€Œç”Ÿã€‚</p>
<p><strong>æ ¸å¿ƒåŠŸèƒ½ï¼š</strong></p>
<ul>
<li><code>Iterators.peekingIterator(Iterator)</code> æ–¹æ³•ç”¨äºå°†ç°æœ‰çš„ <code>Iterator</code> åŒ…è£…æˆä¸€ä¸ª <code>PeekingIterator</code>ã€‚</li>
<li>å…¶æ ¸å¿ƒæ–¹æ³•æ˜¯ <code>peek()</code>ï¼Œå…è®¸åœ¨ä¸æ¨è¿›è¿­ä»£å™¨çš„æƒ…å†µä¸‹ï¼ŒæŸ¥çœ‹ä¸‹ä¸€ä¸ªè°ƒç”¨ <code>next()</code> æ—¶å°†è¿”å›çš„å…ƒç´ ã€‚</li>
</ul>
<p><strong>å®ƒå¸¦æ¥çš„ä¾¿åˆ©ï¼š</strong></p>
<p>PeekingIterator çš„ <code>peek()</code> æ–¹æ³•èƒ½å¤Ÿæ”¯æŒæ›´çµæ´»çš„è¿­ä»£é€»è¾‘ï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦æ ¹æ®å½“å‰å…ƒç´ å’Œâ€œä¸‹ä¸€ä¸ªâ€å…ƒç´ å…³ç³»è¿›è¡Œåˆ¤æ–­çš„åœºæ™¯ä¸­ã€‚å®ƒå…è®¸åœ¨ä¸€æ¬¡è¿­ä»£è¿‡ç¨‹ä¸­å®Œæˆå¤æ‚çš„é€»è¾‘åˆ¤æ–­å’Œæ•°æ®å¤„ç†ï¼Œé¿å…äº†ä¼ ç»Ÿæ–¹æ³•ä¸­å¯èƒ½å‡ºç°çš„å†—ä½™ <code>next()</code> è°ƒç”¨æˆ–é¢å¤–çš„çŠ¶æ€å˜é‡ç®¡ç†ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼šæ¶ˆé™¤è¿ç»­é‡å¤å…ƒç´ </strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PeekingIteratorExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        List&lt;Integer&gt; source = Arrays.asList(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>);
        List&lt;Integer&gt; result = Lists.newArrayList();

        PeekingIterator&lt;Integer&gt; iter = Iterators.peekingIterator(source.iterator());

        <span class="hljs-keyword">while</span> (iter.hasNext()) {
            <span class="hljs-type">Integer</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> iter.next(); <span class="hljs-comment">// è·å–å½“å‰å…ƒç´ </span>
            result.add(current); <span class="hljs-comment">// å°†å½“å‰å…ƒç´ æ·»åŠ åˆ°ç»“æœ</span>

            <span class="hljs-comment">// åˆ©ç”¨ peek() æå‰åˆ¤æ–­ï¼Œå¦‚æœä¸‹ä¸€ä¸ªå…ƒç´ ä¸å½“å‰å…ƒç´ é‡å¤ï¼Œåˆ™è·³è¿‡ã€‚</span>
            <span class="hljs-keyword">while</span> (iter.hasNext() &amp;&amp; iter.peek().equals(current)) {
                iter.next(); <span class="hljs-comment">// è·³è¿‡è¿™ä¸ªé‡å¤å…ƒç´ </span>
            }
        }
        System.out.println(<span class="hljs-string">"Original: "</span> + source);
        System.out.println(<span class="hljs-string">"Deduplicated: "</span> + result); <span class="hljs-comment">// Output: [1, 2, 3, 4, 5]</span>
    }
}
</code></pre>
<p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä»…å¯¹ <code>source</code> åˆ—è¡¨è¿›è¡Œäº†ä¸€æ¬¡é€»è¾‘éå†ã€‚PeekingIterator ä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿåœ¨å¤„ç† <code>current</code> å…ƒç´ çš„åŒæ—¶ï¼Œé¢„åˆ¤å¹¶è·³è¿‡æ‰€æœ‰åç»­çš„é‡å¤é¡¹ï¼Œè€Œæ— éœ€å°†å®ƒä»¬å­˜å‚¨åˆ°ä»»ä½•ä¸­é—´ç»“æ„æˆ–è¿›è¡Œåç»­çš„å»é‡å¤„ç†ã€‚è¿™ç®€åŒ–äº†å»é‡é€»è¾‘çš„å®ç°ã€‚</p>
<p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong> ç”± <code>Iterators.peekingIterator</code> è¿”å›çš„ <code>PeekingIterator</code> ä¸æ”¯æŒåœ¨è°ƒç”¨ <code>peek()</code> ä¹‹åæ‰§è¡Œ <code>remove()</code> æ“ä½œã€‚</p>
<h3 data-id="heading-1">2. AbstractIteratorï¼šä¸€ä¸ªæ–¹æ³•å®šä¹‰è¿­ä»£å™¨</h3>
<p>å½“éœ€è¦å®ç°ä¸€ä¸ªè‡ªå®šä¹‰çš„ Iteratorï¼Œä¾‹å¦‚å¯¹æ•°æ®è¿›è¡Œè¿‡æ»¤ã€è½¬æ¢æˆ–ä»å¤æ‚æ•°æ®æºä¸­æå–æ—¶ï¼Œæ‰‹åŠ¨ç®¡ç† <code>hasNext()</code> å’Œ <code>next()</code> çš„å†…éƒ¨çŠ¶æ€ä¼šå¼•å…¥å¤§é‡æ ·æ¿ä»£ç ã€‚AbstractIterator æå¤§åœ°ç®€åŒ–äº†è¿™ä¸€è¿‡ç¨‹ã€‚</p>
<p><strong>æ ¸å¿ƒåŠŸèƒ½ï¼š</strong></p>
<ul>
<li>å¼€å‘è€…åªéœ€å®ç°ä¸€ä¸ªæ–¹æ³•ï¼š<code>computeNext()</code>ã€‚æ­¤æ–¹æ³•è´Ÿè´£è®¡ç®—å¹¶è¿”å›åºåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªå€¼ã€‚</li>
<li>å½“è¿­ä»£åºåˆ—å®Œæˆæ—¶ï¼Œ<code>computeNext()</code> åº”è¿”å› <code>endOfData()</code> ä»¥æ ‡è®°è¿­ä»£ç»“æŸã€‚</li>
</ul>
<p><strong>å®ƒå¸¦æ¥çš„ä¾¿åˆ©ï¼š</strong></p>
<p>AbstractIterator é‡‡ç”¨æƒ°æ€§æ±‚å€¼ï¼ˆlazy evaluationï¼‰æœºåˆ¶ã€‚å®ƒç¡®ä¿ <code>computeNext()</code> æ–¹æ³•ä»…åœ¨çœŸæ­£éœ€è¦ä¸‹ä¸€ä¸ªå…ƒç´ ï¼ˆå³ <code>next()</code> è¢«è°ƒç”¨æ—¶ï¼‰æ‰ä¼šè¢«æ‰§è¡Œã€‚è¿™ä½¿å¾—è¿­ä»£å™¨èƒ½å¤ŸæŒ‰éœ€ç”Ÿæˆå…ƒç´ ï¼Œé¿å…äº†åœ¨è¿­ä»£å™¨æœªè¢«å®Œå…¨æ¶ˆè´¹æ—¶è¿›è¡Œä¸å¿…è¦çš„è®¡ç®—ã€‚åŒæ—¶ï¼ŒGuava è´Ÿè´£å¤„ç† <code>hasNext()</code> å’Œ <code>next()</code> ä¹‹é—´çš„çŠ¶æ€åŒæ­¥ï¼Œç®€åŒ–äº†è‡ªå®šä¹‰è¿­ä»£å™¨çš„å®ç°ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼šæƒ°æ€§è¿‡æ»¤ Null å€¼</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AbstractIteratorExample</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Iterator&lt;String&gt; <span class="hljs-title function_">skipNulls</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Iterator&lt;String&gt; in)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbstractIterator</span>&lt;String&gt;() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">protected</span> String <span class="hljs-title function_">computeNext</span><span class="hljs-params">()</span> {
                <span class="hljs-keyword">while</span> (in.hasNext()) {
                    <span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> in.next();
                    <span class="hljs-keyword">if</span> (s != <span class="hljs-literal">null</span>) {
                        <span class="hljs-keyword">return</span> s; <span class="hljs-comment">// æ‰¾åˆ°é null å…ƒç´ ï¼Œè¿”å›</span>
                    }
                }
                <span class="hljs-keyword">return</span> endOfData(); <span class="hljs-comment">// å†…éƒ¨è¿­ä»£å™¨è€—å°½ï¼Œè¿”å› endOfData()</span>
            }
        };
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        List&lt;String&gt; source = Arrays.asList(<span class="hljs-string">"hello"</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">"world"</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">"guava"</span>, <span class="hljs-string">"java"</span>);
        Iterator&lt;String&gt; filteredIterator = skipNulls(source.iterator());

        System.out.println(<span class="hljs-string">"Filtered elements (only consuming first 3):"</span>);
        <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-keyword">while</span> (filteredIterator.hasNext() &amp;&amp; count &lt; <span class="hljs-number">3</span>) { <span class="hljs-comment">// å‡è®¾æˆ‘ä»¬åªæ¶ˆè´¹å‰3ä¸ªå…ƒç´ </span>
            System.out.println(filteredIterator.next());
            count++;
        }
        <span class="hljs-comment">// Output:</span>
        <span class="hljs-comment">// hello</span>
        <span class="hljs-comment">// world</span>
        <span class="hljs-comment">// guava</span>
    }
}
</code></pre>
<p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œå³ä½¿ <code>source</code> åˆ—è¡¨ä¸­æœ‰æ›´å¤šå…ƒç´ ï¼Œæˆ‘ä»¬åªæ¶ˆè´¹äº†å‰ 3 ä¸ªéç©ºå­—ç¬¦ä¸²ã€‚AbstractIterator ç¡®ä¿äº† <code>in.next()</code> å’Œ <code>if (s != null)</code> è¿™æ ·çš„æ“ä½œä»…æ‰§è¡Œäº†åˆšå¥½è¶³ä»¥æ‰¾åˆ°è¿™ 3 ä¸ªå…ƒç´ æ‰€éœ€çš„æœ€å°æ¬¡æ•°ã€‚è¿™ç§æŒ‰éœ€è®¡ç®—çš„æ¨¡å¼ï¼Œä½¿å¾—è¿­ä»£å™¨åªåœ¨éœ€è¦æ—¶æ‰å¤„ç†æ•°æ®ã€‚</p>
<p><strong>é™åˆ¶ï¼š</strong> AbstractIterator ç»§æ‰¿è‡ª <code>UnmodifiableIterator</code>ï¼Œè¿™æ„å‘³ç€å®ƒç¦æ­¢å®ç° <code>remove()</code> æ–¹æ³•ã€‚å¦‚æœæ‚¨çš„è¿­ä»£å™¨å¿…é¡»æ”¯æŒ <code>remove()</code>ï¼Œåˆ™ä¸åº”ç»§æ‰¿ AbstractIteratorã€‚</p>
<pre><code class="hljs language-java" lang="java"/></pre>
<h3 data-id="heading-2">3. AbstractSequentialIterator</h3>
<p>å¯¹äºé‚£äº›ä¸‹ä¸€ä¸ªå€¼å¾ˆå®¹æ˜“æ ¹æ®å‰ä¸€ä¸ªå€¼è®¡ç®—å‡ºæ¥çš„è¿­ä»£å™¨ï¼ŒAbstractSequentialIterator æä¾›äº†ä¸€ç§è¡¨è¾¾è¿­ä»£çš„æ›¿ä»£æ–¹å¼ã€‚</p>
<p><strong>æ ¸å¿ƒåŠŸèƒ½ï¼š</strong></p>
<ul>
<li>å¼€å‘è€…å®ç°çš„æ–¹æ³•æ˜¯ <code>computeNext(T previous)</code>ï¼Œå®ƒæ¥å—åºåˆ—ä¸­çš„å‰ä¸€ä¸ªå€¼ä½œä¸ºå‚æ•°ã€‚</li>
<li>å¿…é¡»åœ¨æ„é€ å‡½æ•°ä¸­æä¾›ä¸€ä¸ªåˆå§‹å€¼ï¼ˆæˆ–è€…å¦‚æœè¿­ä»£å™¨åº”ç«‹å³ç»ˆæ­¢ï¼Œåˆ™ä¼ å…¥ <code>null</code>ï¼‰ã€‚</li>
<li><code>computeNext()</code> æ–¹æ³•çº¦å®šï¼Œè¿”å› <code>null</code> æ„å‘³ç€è¿­ä»£ç»“æŸã€‚</li>
</ul>
<p><strong>å®ƒå¸¦æ¥çš„ä¾¿åˆ©ï¼š</strong></p>
<p>AbstractSequentialIterator é€‚ç”¨äºé‚£äº›ä¸‹ä¸€ä¸ªå€¼å¯ä»¥æ ¹æ®å‰ä¸€ä¸ªå€¼è®¡ç®—å‡ºæ¥çš„åºåˆ—ã€‚å®ƒé€šè¿‡**æŒ‰éœ€ç”Ÿæˆï¼ˆon-demand generationï¼‰**æœºåˆ¶ï¼Œä»…åœ¨ <code>next()</code> è¢«è°ƒç”¨æ—¶æ‰è®¡ç®—ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚è¿™ä½¿å¾—å®ƒéå¸¸é€‚åˆå¤„ç†å¯èƒ½éå¸¸é•¿ç”šè‡³æ— é™çš„åºåˆ—ï¼Œå› ä¸ºå®ƒé¿å…äº†é¢„å…ˆè®¡ç®—å’Œå­˜å‚¨æ•´ä¸ªåºåˆ—ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼šæƒ°æ€§è®¡ç®— 2 çš„å¹‚æ¬¡</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AbstractSequentialIteratorExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// ä»1å¼€å§‹ç”Ÿæˆ2çš„å¹‚æ¬¡æ–¹ï¼Œç›´åˆ°è¾¾åˆ° 1 &lt;&lt; 30</span>
        Iterator&lt;Integer&gt; powersOfTwo = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbstractSequentialIterator</span>&lt;Integer&gt;(<span class="hljs-number">1</span>) {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">protected</span> Integer <span class="hljs-title function_">computeNext</span><span class="hljs-params">(Integer previous)</span> {
                <span class="hljs-comment">// å¦‚æœ previous å·²ç»è¾¾åˆ°æœ€å¤§å€¼ï¼Œåˆ™è¿”å› null ç»“æŸè¿­ä»£</span>
                <span class="hljs-keyword">return</span> (previous == <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">30</span>) ? <span class="hljs-literal">null</span> : previous * <span class="hljs-number">2</span>;
            }
        };

        System.out.println(<span class="hljs-string">"Powers of two (only consuming first 7):"</span>);
        <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-keyword">while</span> (powersOfTwo.hasNext() &amp;&amp; count &lt; <span class="hljs-number">7</span>) { <span class="hljs-comment">// å‡è®¾æˆ‘ä»¬åªæ¶ˆè´¹å‰7ä¸ªå…ƒç´ </span>
            System.out.println(powersOfTwo.next());
            count++;
        }
        <span class="hljs-comment">// Output: 1, 2, 4, 8, 16, 32, 64</span>
    }
}
</code></pre>
<p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä»…æ¶ˆè´¹äº†åºåˆ—çš„å‰ 7 ä¸ªå…ƒç´ ã€‚AbstractSequentialIterator ç¡®ä¿äº†åªæœ‰è¿™ 7 æ¬¡ä¹˜æ³•æ“ä½œè¢«æ‰§è¡Œï¼Œå¹¶ä¸”åœ¨å†…å­˜ä¸­åªç»´æŠ¤äº†å½“å‰ <code>previous</code> å…ƒç´ çš„çŠ¶æ€ã€‚è¿™ç§æƒ°æ€§ç”Ÿæˆæ–¹å¼ï¼Œé¿å…äº†å¯¹æ•´ä¸ªåºåˆ—è¿›è¡Œé¢„è®¡ç®—å’Œå­˜å‚¨çš„éœ€è¦ã€‚</p>
<p><strong>å…³é”®é™åˆ¶ï¼š</strong> ç”±äºè¿”å› <code>null</code> æ ‡å¿—ç€è¿­ä»£çš„ç»“æŸï¼Œå› æ­¤ AbstractSequentialIterator ä¸èƒ½ç”¨äºå®ç°ä¸€ä¸ªå¯ä»¥åˆæ³•è¿”å› <code>null</code> å…ƒç´ çš„è¿­ä»£å™¨ã€‚</p>
<p>ç¬”è€…é‡åˆ°ä¸€ä¸ªæŒ‰éœ€æ·±æ‹·è´çš„éœ€æ±‚ï¼Œç®€å•æè¿°ä¸ºï¼šå·²è·å¾—å¯¹è±¡aï¼Œéœ€è¦æ·±æ‹·è´è‹¥å¹²ä»½ï¼ŒåŒæ—¶éœ€è¦æ ‡è®°åºå·ï¼Œaå·²ç»å®ç°deepCopyæ–¹æ³•ã€‚å®ç°å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å®ç°1</span>
<span class="hljs-type">A</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> getA();
<span class="hljs-type">boolean</span> <span class="hljs-variable">first</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> x: request.getXList()) {
    <span class="hljs-comment">// ...</span>
    <span class="hljs-keyword">if</span> (a != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">if</span> (first) {
            x.setA(a);
            first = <span class="hljs-literal">false</span>;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-type">A</span> <span class="hljs-variable">newA</span> <span class="hljs-operator">=</span> a.deepCopy();
            newA.seq++;
            x.setA(newA);
        }
    }
    <span class="hljs-comment">// ...</span>
}

<span class="hljs-comment">// å®ç°2ï¼Œä¿®æ”¹å¼•ç”¨a</span>
<span class="hljs-type">A</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> getA();
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> x: request.getXList()) {
    <span class="hljs-comment">// ...</span>
    <span class="hljs-keyword">if</span> (a != <span class="hljs-literal">null</span>) {
        x.setA(a);
        a = a.deepCopy(); <span class="hljs-comment">//ä¼šå¤šå¤åˆ¶ä¸€æ¬¡</span>
        a.seq++;
    }
    <span class="hljs-comment">// ...</span>
}

<span class="hljs-comment">// æ–°å®ç°</span>
<span class="hljs-type">A</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> getA();
<span class="hljs-comment">// copy iter</span>
Iterator&lt;A&gt; aIter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbstractSequentialIterator</span>&lt;&gt;(a) {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> A <span class="hljs-title function_">computeNext</span><span class="hljs-params">(A prev)</span> {
        <span class="hljs-type">A</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> prev.deepCopy();
        result.seq++;
        <span class="hljs-keyword">return</span> result;
    }
};
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> x: request.getXList()) {
    <span class="hljs-comment">// ...</span>
    <span class="hljs-keyword">if</span> (a != <span class="hljs-literal">null</span>) {
        x.setA(aIter.next());
    }
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>å’ŒåŸæœ‰å®ç°ç›¸æ¯”ï¼Œæ–°å®ç°æŠ½å–å‡ºäº†Açš„è¿­ä»£é€»è¾‘ï¼Œæ›´å¥½ç†è§£ã€‚</p>
<h3 data-id="heading-3">æ€»ç»“</h3>
<p>Guava çš„ PeekingIteratorã€AbstractIterator å’Œ AbstractSequentialIterator ä¸º Java å¼€å‘è€…æä¾›äº†å¼ºå¤§çš„å·¥å…·ï¼Œç”¨äºç®€åŒ–å’Œå¢å¼ºè¿­ä»£å™¨çš„ä½¿ç”¨ã€‚å®ƒä»¬é€šè¿‡ä»¥ä¸‹æ–¹å¼æå‡ä»£ç çš„å¥å£®æ€§å’Œå¯ç»´æŠ¤æ€§ï¼š</p>
<ul>
<li><strong>PeekingIteratorï¼š</strong> å…è®¸åœ¨å•æ¬¡éå†ä¸­è¿›è¡Œé¢„åˆ¤å’Œå¤æ‚é€»è¾‘å¤„ç†ï¼Œå‡å°‘äº†çŠ¶æ€ç®¡ç†å’Œå†—ä½™æ“ä½œã€‚</li>
<li><strong>AbstractIteratorï¼š</strong> å¼ºåˆ¶æƒ°æ€§æ±‚å€¼ï¼Œç®€åŒ–äº†è‡ªå®šä¹‰è¿­ä»£å™¨çš„å®ç°ï¼Œå¹¶æŒ‰éœ€å¤„ç†æ•°æ®ã€‚</li>
<li><strong>AbstractSequentialIteratorï¼š</strong> å®ç°æŒ‰éœ€ç”Ÿæˆåºåˆ—ï¼Œé€‚ç”¨äºå¤„ç†é•¿åºåˆ—ï¼Œé¿å…äº†ä¸å¿…è¦çš„é¢„è®¡ç®—å’Œå­˜å‚¨ã€‚</li>
</ul>
<p>åœ¨å¤„ç†æ•°æ®æµã€æ„å»ºæ•°æ®ç®¡é“æˆ–å®ç°å¤æ‚ä¸šåŠ¡é€»è¾‘æ—¶ï¼Œåˆç†åˆ©ç”¨è¿™äº›è¿­ä»£å™¨ï¼Œå¯ä»¥ä½¿ä»£ç æ›´åŠ æ¸…æ™°ã€çµæ´»ï¼Œå¹¶æ›´å¥½åœ°ç®¡ç†èµ„æºã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æµ‹è¯•è‡ªåŠ¨åŒ–Replayï¼šè®©æ•°æ®åº“è¿ç§»æµ‹è¯•å›å½’çœŸå®åœºæ™¯çš„ä¸€æŠŠâ€œåˆ©å™¨â€]]></title>    <link>https://juejin.cn/post/7570903763722321930</link>    <guid>https://juejin.cn/post/7570903763722321930</guid>    <pubDate>2025-11-10T15:05:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570903763722321930" data-draft-id="7570912420568367114" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æµ‹è¯•è‡ªåŠ¨åŒ–Replayï¼šè®©æ•°æ®åº“è¿ç§»æµ‹è¯•å›å½’çœŸå®åœºæ™¯çš„ä¸€æŠŠâ€œåˆ©å™¨â€"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-10T15:05:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æˆ‘æ˜¯æ°å°¼"/> <meta itemprop="url" content="https://juejin.cn/user/4200579899599495"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æµ‹è¯•è‡ªåŠ¨åŒ–Replayï¼šè®©æ•°æ®åº“è¿ç§»æµ‹è¯•å›å½’çœŸå®åœºæ™¯çš„ä¸€æŠŠâ€œåˆ©å™¨â€
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4200579899599495/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æˆ‘æ˜¯æ°å°¼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T15:05:41.000Z" title="Mon Nov 10 2025 15:05:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æµ‹è¯•è‡ªåŠ¨åŒ–Replayï¼šè®©æ•°æ®åº“è¿ç§»æµ‹è¯•å›å½’çœŸå®åœºæ™¯çš„ä¸€æŠŠâ€œåˆ©å™¨â€</h2>
<p>åœ¨å½“å‰æ•°æ®åº“å›½äº§åŒ–çš„å¤§è¶‹åŠ¿ä¸‹ï¼Œè¶Šæ¥è¶Šå¤šçš„ä¼ä¸šå¼€å§‹ä»ä¼ ç»Ÿè¿›å£æ•°æ®åº“å‘å›½äº§æ•°æ®åº“è¿›è¡Œæ›¿ä»£ã€‚ç„¶è€Œï¼ŒçœŸæ­£å½±å“è¿ç§»è¿›åº¦çš„å¾€å¾€ä¸æ˜¯æ•°æ®è¿ç§»æœ¬èº«ï¼Œè€Œæ˜¯ <strong>æµ‹è¯•éªŒè¯ç¯èŠ‚</strong>ã€‚</p>
<p>å¦‚æœæµ‹è¯•ä¸èƒ½è¦†ç›–çœŸå®ä¸šåŠ¡åœºæ™¯ï¼Œè¿ç§»åçš„ç³»ç»Ÿä¸Šçº¿åå¾ˆå¯èƒ½å‡ºç°ï¼š</p>
<ul>
<li>æ€§èƒ½æ˜æ˜¾ä¸‹é™</li>
<li>å¹¶å‘å†²çªå’Œæ…¢æŸ¥è¯¢é¢‘å‘</li>
<li>æ•°æ®ä¸€è‡´æ€§å¼‚å¸¸éš¾ä»¥å®šä½</li>
</ul>
<p>å¾ˆå¤šä¼ä¸šè¿ç§»é¡¹ç›®å»¶æœŸ 1~3 ä¸ªæœˆï¼Œæ ¹æœ¬åŸå› éƒ½æŒ‡å‘äº†åŒä¸€ä¸ªé—®é¢˜ï¼š<strong>æµ‹è¯•ä¸å¤ŸçœŸå®</strong>ã€‚</p>
<p>é‚£ä¹ˆï¼Œæ˜¯å¦æœ‰åŠæ³•æŠŠâ€œç”Ÿäº§ç¯å¢ƒæ­£åœ¨å‘ç”Ÿçš„çœŸå®è¡Œä¸ºâ€ï¼Œç›´æ¥æ¬è¿›æµ‹è¯•ç¯å¢ƒä¸­æ¥å¤ç°ï¼Ÿ
è¿™ä¾¿æ˜¯æœ¬æ–‡è¦ä»‹ç»çš„å®è·µæ–¹å‘ï¼š<strong>ç”Ÿäº§è´Ÿè½½å›æ”¾ï¼ˆReplayï¼‰æŠ€æœ¯</strong>ã€‚</p>
<hr/>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/61cb0ad2efe74364b0b6762d536b7b81~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763391940&amp;x-signature=Dc6XybQ1Aqqp1rO2fgcVtBIiyKs%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h3 data-id="heading-1"><strong>ä¸€ã€è¿ç§»æµ‹è¯•ä¸ºä½•æ€»æ˜¯éš¾ä»¥åšå¥½ï¼Ÿ</strong></h3>
<p>æ•°æ®åº“è¿ç§»æµ‹è¯•ï¼Œä¼ ç»Ÿæ–¹å¼å¤šä¾èµ–äººåŠ›ç¼–å†™ SQLã€è„šæœ¬æ¨¡æ‹Ÿä¸šåŠ¡åœºæ™¯ï¼Œä½†è¿™ç±»æ‰‹æ®µå­˜åœ¨å¤©ç„¶é™åˆ¶ï¼š</p>





















<table><thead><tr><th>é—®é¢˜</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>åœºæ™¯è¦†ç›–ä¸è¶³</strong></td><td>äººå·¥ç”¨ä¾‹åªå…³æ³¨æ ¸å¿ƒæµç¨‹ï¼ŒçœŸå®ç¯å¢ƒä¸­å¤§é‡è¾¹ç¼˜å¹¶å‘åœºæ™¯æ— æ³•è¦†ç›–</td></tr><tr><td><strong>æ€§èƒ½æµ‹è¯•å¤±çœŸ</strong></td><td>è‡ªåˆ¶å‹åŠ›è„šæœ¬æ— æ³•å¤ç°ä¸šåŠ¡å³°å€¼ç‰¹å¾ä¸å¹¶å‘æ¨¡å‹</td></tr><tr><td><strong>å›å½’æµ‹è¯•æˆæœ¬é«˜</strong></td><td>é…ç½®å˜æ›´ / å‚æ•°è°ƒä¼˜åï¼Œéœ€è¦é‡å¤å¤§é‡éªŒè¯å·¥ä½œ</td></tr></tbody></table>
<p>ç®€å•æ¥è¯´ï¼š<strong>ä½ æµ‹åˆ°çš„ç³»ç»Ÿå’Œä½ è¦ä¸Šçº¿çš„ç³»ç»Ÿä¸æ˜¯åŒä¸€ä¸ªç³»ç»Ÿã€‚</strong></p>
<p>å°±åƒæœ‰å¥è¯è¯´çš„ï¼š</p>
<blockquote>
<p><em>â€œåœ¨å®éªŒå®¤è·‘å¾—å†é¡ºï¼Œä¹Ÿä¸ä»£è¡¨èƒ½æ‰›ä½åŒåä¸€ã€‚â€</em></p>
</blockquote>
<p>è¿ç§»æµ‹è¯•ç¼ºçš„ï¼Œå°±æ˜¯ <strong>çœŸå®ä¸šåŠ¡è´Ÿè½½æœ¬èº«</strong>ã€‚</p>
<hr/>
<h3 data-id="heading-2"><strong>äºŒã€è§£å†³æ€è·¯ï¼šæŠŠç”Ÿäº§ç¯å¢ƒâ€œå½•ä¸‹æ¥ï¼Œå†æ”¾ä¸€éâ€</strong></h3>
<p>ä¸ºäº†è®©æµ‹è¯•è´´è¿‘çœŸå®ä¸šåŠ¡ï¼ŒæŠ€æœ¯å›¢é˜Ÿé‡‡ç”¨äº† <strong>KReplay ç”Ÿäº§è´Ÿè½½å›æ”¾å·¥å…·</strong>ï¼Œå…¶æ ¸å¿ƒæ€è·¯å¯æ¦‚æ‹¬ä¸ºå››æ­¥ï¼š</p>
<blockquote>
<p><strong>é‡‡ â†’ è½¬ â†’ æ”¾ â†’ æ ¸</strong></p>
<p>å³ï¼šé‡‡é›†çœŸå®æµé‡ â†’ è½¬æ¢é€‚é… â†’ å›æ”¾æ‰§è¡Œ â†’ ç»“æœæ¯”å¯¹</p>
</blockquote>
<h4 data-id="heading-3"><strong>1. ä¸šåŠ¡è´Ÿè½½é‡‡é›†ï¼ˆCaptureï¼‰</strong></h4>
<p>ä»æ—§æ•°æ®åº“ï¼ˆå¦‚ Oracleï¼‰ä¸­æŒç»­è®°å½•çœŸå®ä¸šåŠ¡æ“ä½œï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>SQL è¯­å¥ + å…¥å‚å˜é‡</li>
<li>ä¼šè¯ IDã€äº‹åŠ¡è¾¹ç•Œ</li>
<li>æ‰§è¡Œæ—¶åºä¸å¹¶å‘å…³ç³»</li>
</ul>
<p>ç¤ºä¾‹ï¼ˆOracle ç«¯å¼€å¯è´Ÿè½½é‡‡é›†ï¼‰ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">BEGIN</span>
  DBMS_WORKLOAD_CAPTURE.START_CAPTURE(
    name <span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> <span class="hljs-string">'daily_load_capture'</span>,
    dir  <span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> <span class="hljs-string">'CAP_DIR'</span>,
    duration <span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">72000</span>   <span class="hljs-comment">-- é‡‡é›† 20å°æ—¶</span>
  );
<span class="hljs-keyword">END</span>;
<span class="hljs-operator">/</span>
</code></pre>
<p>æ­¤è¿‡ç¨‹å¯¹ç”Ÿäº§ç¯å¢ƒå½±å“æä½ï¼ˆCPU &lt; 5%ï¼‰ï¼Œå¯å®‰å…¨è¿è¡Œã€‚</p>
<hr/>
<h4 data-id="heading-4"><strong>2. è´Ÿè½½è½¬æ¢ï¼ˆConvertï¼‰</strong></h4>
<p>ç”±äºä¸åŒæ•°æ®åº“åœ¨è¯­æ³•ã€ç±»å‹ã€å‡½æ•°ä¸Šå­˜åœ¨å·®å¼‚ï¼Œéœ€è¦è‡ªåŠ¨è½¬æ¢ï¼š</p>





















<table><thead><tr><th>Oracle</th><th>KingbaseES</th></tr></thead><tbody><tr><td><code>ROWNUM</code></td><td><code>LIMIT</code></td></tr><tr><td><code>NVL(a,b)</code></td><td><code>COALESCE(a,b)</code></td></tr><tr><td><code>DATE</code> ç²¾åº¦</td><td><code>TIMESTAMP</code> ç²¾åº¦æ‰©å±•</td></tr></tbody></table>
<p>è¯¥æ­¥éª¤ç”±å·¥å…·è‡ªåŠ¨å®Œæˆï¼Œå®æµ‹è‡ªåŠ¨åŒ–é€‚é…ç‡å¯è¾¾ <strong>99%+</strong>ï¼Œå¤§å¹…å‡å°‘äººå·¥æ”¹å†™ã€‚</p>
<hr/>
<h4 data-id="heading-5"><strong>3. é«˜ä¿çœŸè´Ÿè½½å›æ”¾ï¼ˆReplayï¼‰</strong></h4>
<p>è½¬æ¢åçš„è´Ÿè½½åœ¨æ–°æ•°æ®åº“ä¸ŠæŒ‰åŸå§‹æ‰§è¡ŒèŠ‚å¥å¤ç°ã€‚</p>
<p>æ”¯æŒä¸‰ç§æ¨¡å¼ï¼š</p>





















<table><thead><tr><th>æ¨¡å¼</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td>åŸé€Ÿå›æ”¾</td><td>éªŒè¯ç¨³å®šæ€§</td></tr><tr><td>åŠ é€Ÿå›æ”¾ï¼ˆä¾‹å¦‚ Ã—2ï¼‰</td><td>çŸ­æ—¶é—´å†…å‹æµ‹æ€§èƒ½ç“¶é¢ˆ</td></tr><tr><td>å‡é€Ÿå›æ”¾ï¼ˆä¾‹å¦‚ Ã·2ï¼‰</td><td>ç”¨äºå®šä½å¤æ‚æ…¢ SQL / é”ç­‰å¾…é—®é¢˜</td></tr></tbody></table>
<p>åŒæ—¶ç”Ÿæˆ <strong>KWR æ€§èƒ½åˆ†ææŠ¥å‘Š</strong>ï¼ˆç±»ä¼¼ Oracle AWRï¼‰ï¼Œè¦†ç›–ï¼š</p>
<ul>
<li>I/O å‹åŠ›æƒ…å†µ</li>
<li>ç¼“å­˜å‘½ä¸­ç‡</li>
<li>é”ç­‰å¾…å…³ç³»</li>
<li>Top SQL åˆ†å¸ƒ</li>
</ul>
<p>è®© DBA èƒ½å¤Ÿç›´è§‚çœ‹åˆ°æ€§èƒ½å·®å¼‚æ ¹å› ã€‚</p>
<hr/>
<h4 data-id="heading-6"><strong>4. æ•°æ®ä¸€è‡´æ€§æ¯”å¯¹ï¼ˆValidateï¼‰</strong></h4>
<p>é€šè¿‡ <strong>KDTS æ•°æ®æ¯”å¯¹å·¥å…·</strong>ï¼Œå®ç°æºåº“ä¸ç›®æ ‡åº“çš„æ•°æ®ç»“æ„ &amp; å†…å®¹åŒå‘éªŒè¯ï¼š</p>
<ul>
<li>è¡¨è¡Œæ•°æ˜¯å¦ä¸€è‡´</li>
<li>å­—æ®µå€¼é€æ¡æ¯”å¯¹ï¼ˆå« BLOB / CLOBï¼‰</li>
<li>ç´¢å¼• / å¤–é”® / è§¦å‘å™¨ç­‰å…ƒä¿¡æ¯æ£€æŸ¥</li>
</ul>
<p>ä¸€æ—¦å‘ç°å·®å¼‚ï¼Œè‡ªåŠ¨ç”Ÿæˆå·®å¼‚æŠ¥å‘Šï¼Œå®šä½åˆ°è¡¨ + è¡Œ + å­—æ®µã€‚</p>
<p>ä¸å†éœ€è¦ç†¬å¤œæŸ¥æ—¥å¿—ã€å†™è„šæœ¬ã€åšäººå·¥æŠ½æŸ¥ã€‚</p>
<hr/>
<h3 data-id="heading-7"><strong>ä¸‰ã€å®æˆ˜æ¡ˆä¾‹ï¼šæŸå¤§å‹æ±½è½¦åˆ¶é€ é›†å›¢ ERP è¿ç§»</strong></h3>






























<table><thead><tr><th>æŒ‡æ ‡</th><th>å¼•å…¥ Replay å‰</th><th>å¼•å…¥å</th></tr></thead><tbody><tr><td>æµ‹è¯•å‘¨æœŸ</td><td>6 å‘¨</td><td><strong>3 å‘¨ï¼ˆç¼©çŸ­ 50%ï¼‰</strong></td></tr><tr><td>åœºæ™¯è¦†ç›–ç‡</td><td>çº¦ 40%</td><td><strong>è¾¾åˆ° 100%ï¼ˆçœŸå®ä¸šåŠ¡å…¨é‡å¤ç°ï¼‰</strong></td></tr><tr><td>äººå·¥æµ‹è¯•å·¥ä½œé‡</td><td>é«˜</td><td><strong>å‡å°‘ 70%+</strong></td></tr><tr><td>ä¸Šçº¿é£é™©</td><td>è¿ç§»åä»éœ€çº¿ä¸Šè§‚å¯Ÿ</td><td><strong>è¿ç§»å‰é£é™©å¯æå‰æš´éœ²ä¸ä¿®å¤</strong></td></tr></tbody></table>
<p>ä¸€å¥è¯ï¼š
<strong>ä»–ä»¬ä¸å†â€œé è¿æ°”ä¸Šçº¿â€ï¼Œè€Œæ˜¯â€œä¸Šçº¿å‰å°±çŸ¥é“ä¼šä¸ä¼šå‡ºäº‹â€ã€‚</strong></p>
<hr/>
<h3 data-id="heading-8"><strong>å››ã€æ€»ç»“ï¼šè¿ç§»æµ‹è¯•çš„æœªæ¥å±äºâ€œçœŸå®éªŒè¯â€</strong></h3>
<p>ä¼ ç»Ÿè¿ç§»æµ‹è¯•çš„ä¸Šé™æ˜¯â€œå¯ç”¨â€ï¼Œè€Œç”Ÿäº§è´Ÿè½½å›æ”¾çš„ç›®æ ‡æ˜¯ <strong>â€œå¯æ”¾å¿ƒä¸Šçº¿â€</strong>ã€‚</p>
<h4 data-id="heading-9"><strong>Replay æŠ€æœ¯å¸¦æ¥çš„æ”¹å˜</strong></h4>
<p>âœ… æµ‹è¯•ä»â€œæ¨¡æ‹Ÿâ€å‡çº§ä¸ºâ€œå®æˆ˜å¤åˆ»â€
âœ… æ€§èƒ½ç“¶é¢ˆèƒ½æå‰æš´éœ²ï¼Œè€Œä¸æ˜¯ä¸Šçº¿åæŠ¥è­¦
âœ… å›å½’æµ‹è¯•ä¸å†æ˜¯è€—æ—¶é»‘æ´
âœ… è¿ç§»æˆåŠŸç‡æ˜¾è‘—æå‡</p>
<p>éšç€ AI ä¸è‡ªåŠ¨è¯Šæ–­èƒ½åŠ›é€æ­¥èå…¥ï¼Œæœªæ¥è´Ÿè½½å›æ”¾å°†ä¸ä»…èƒ½â€œå¤ç°é—®é¢˜â€ï¼Œè¿˜å°†èƒ½â€œæå‰é¢„æµ‹é—®é¢˜â€ã€‚</p>
<blockquote>
<p><strong>æµ‹è¯•ä¸å†åªæ˜¯éªŒè¯ï¼Œè€Œæ˜¯å†³ç­–å¯ä¿¡æ€§çš„æ ¸å¿ƒä¾æ®ã€‚</strong></p>
</blockquote>
<p>åœ¨æ•°æ®åº“å›½äº§åŒ–è¿ç§»è¿›å…¥æ·±æ°´åŒºçš„ä»Šå¤©ï¼Œé—®é¢˜ä¸å†åªæ˜¯â€œèƒ½å¦å¹³æ›¿â€ï¼Œè€Œæ˜¯ èƒ½å¦ç¨³å®šä¸Šçº¿ã€å¯æ§è¿ç»´ã€é•¿æœŸå¯é è¿è¡Œã€‚ä¼ ç»Ÿæµ‹è¯•æ–¹å¼ç”±äºè„±ç¦»çœŸå®ä¸šåŠ¡ç¯å¢ƒï¼Œæ— æ³•æœ‰æ•ˆæš´éœ²æ½œåœ¨æ€§èƒ½ç“¶é¢ˆå’Œå…¼å®¹æ€§é£é™©ï¼Œå·²é€æ¸æˆä¸ºè¿ç§»é¡¹ç›®çš„ä¸»è¦é˜»ç¢ã€‚è€Œä»¥ KReplay ä¸ºä»£è¡¨çš„ ç”Ÿäº§è´Ÿè½½å›æ”¾æŠ€æœ¯ï¼Œé€šè¿‡â€œçœŸå®è´Ÿè½½é‡‡é›† + è‡ªåŠ¨åŒ–è½¬æ¢ + é«˜ä¿çœŸå›æ”¾ + å®Œæ•´ç»“æœæ¯”å¯¹â€çš„é—­ç¯èƒ½åŠ›ï¼Œè®©æµ‹è¯•ä»â€œé™æ€éªŒè¯â€èµ°å‘â€œçœŸå®é¢„æ¼”â€ï¼Œæ˜¾è‘—æå‡äº†è¿ç§»æ•ˆç‡ã€å¯æ§æ€§ä¸ç³»ç»Ÿä¸Šçº¿æˆåŠŸç‡ã€‚</p>
<p>äº‹å®è¯æ˜ï¼ŒçœŸå®è´Ÿè½½æœ¬èº«å°±æ˜¯æœ€å¥½çš„æµ‹è¯•ç”¨ä¾‹ã€‚åœ¨å¯é¢„è§çš„æœªæ¥ï¼Œä¼ä¸šçº§ç³»ç»Ÿçš„è¿ç§»ä¸å›å½’éªŒè¯å°†è¶Šæ¥è¶Šä¾èµ–è¿™ç±»åœºæ™¯å¤åˆ»ä¸æ™ºèƒ½åˆ†æçš„æŠ€æœ¯ä½“ç³»ã€‚å¯¹äºæ­£åœ¨æ¨è¿›æ•°æ®åº“å›½äº§åŒ–æˆ–å¤§å‹ç³»ç»Ÿå¹³å°è¿ç§»çš„ä¼ä¸šè€Œè¨€ï¼Œå°½æ—©å°†ç”Ÿäº§çº§å›æ”¾èƒ½åŠ›çº³å…¥æµ‹è¯•ä½“ç³»ï¼Œå°†ä¸åªæ˜¯æå‡æ•ˆç‡çš„é€‰æ‹©ï¼Œæ›´æ˜¯é™ä½é£é™©ã€ä¿éšœä¸šåŠ¡è¿ç»­æ€§çš„å…³é”®ä¸€æ­¥ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[FastAPI Ã— Loguruï¼šä»â€œèƒ½è·‘â€åˆ°â€œå¯è¿ç»´â€çš„æ—¥å¿—å®æˆ˜]]></title>    <link>https://juejin.cn/post/7570912420568350730</link>    <guid>https://juejin.cn/post/7570912420568350730</guid>    <pubDate>2025-11-10T14:57:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570912420568350730" data-draft-id="7570912420568334346" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="FastAPI Ã— Loguruï¼šä»â€œèƒ½è·‘â€åˆ°â€œå¯è¿ç»´â€çš„æ—¥å¿—å®æˆ˜"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-10T14:57:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Javaç§æ•™"/> <meta itemprop="url" content="https://juejin.cn/user/3394924618197325"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            FastAPI Ã— Loguruï¼šä»â€œèƒ½è·‘â€åˆ°â€œå¯è¿ç»´â€çš„æ—¥å¿—å®æˆ˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3394924618197325/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Javaç§æ•™
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T14:57:18.000Z" title="Mon Nov 10 2025 14:57:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>ä¸€å¥è¯æ€»ç»“<br/>
æŠŠæ•£è½åœ¨ Uvicorn / FastAPI / ä¸šåŠ¡ä»£ç é‡Œçš„æ‰€æœ‰æ—¥å¿—ï¼Œ<strong>å…¨éƒ¨æ”¶æ•›åˆ° Loguru ä¸€ä¸ªç®¡é“</strong>ï¼Œç»Ÿä¸€æ ¼å¼ã€ç»Ÿä¸€åˆ†çº§ã€ç»Ÿä¸€è½ç›˜ï¼Œå¹¶è§£å†³é‡å¤è¾“å‡ºã€å¼‚æ­¥å®‰å…¨ã€è¯·æ±‚æº¯æºä¸‰å¤§ç—›ç‚¹ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">1. ä¸ºä»€ä¹ˆè¦â€œå¤šæ­¤ä¸€ä¸¾â€ï¼Ÿ</h2>






























<table><thead><tr><th>ç—›ç‚¹</th><th>åŸç”Ÿ logging çš„è¡¨ç°</th><th>Loguru çš„æ”¹è¿›</th></tr></thead><tbody><tr><td><strong>é‡å¤è¾“å‡º</strong></td><td>Uvicorn ä¸ FastAPI å„ç”¨å„çš„ Handlerï¼Œä¸€æ¡è¯·æ±‚åœ¨ç»ˆç«¯å‡ºç° 2~3 æ¬¡</td><td>æ‹¦æˆªæ ‡å‡†åº“ï¼Œå½»åº•å¹²æ‰é‡å¤ Handler</td></tr><tr><td><strong>æ ¼å¼ä¸ç»Ÿä¸€</strong></td><td>access æ—¥å¿—æ— é¢œè‰²ï¼Œä¸šåŠ¡æ—¥å¿—éš¾åŠ å­—æ®µ</td><td>ä¸€ä»½æ¨¡æ¿æ§åˆ¶æ‰€æœ‰ç›®çš„åœ°ï¼Œæ”¯æŒå½©è‰²/JSON</td></tr><tr><td><strong>å¼‚æ­¥å®‰å…¨</strong></td><td>å¤š worker ä¸‹æ–‡ä»¶é”ç«äº‰ï¼Œå‡ºç°é”™ä¹±</td><td><code>enqueue=True</code> å†…éƒ¨é˜Ÿåˆ— + åç¨‹å®‰å…¨</td></tr><tr><td><strong>å¯è§‚æµ‹æ€§</strong></td><td>æŠ¥é”™æ—¶åªèƒ½çœ‹åˆ°æ¡†æ¶æ ˆï¼Œæ‰¾ä¸åˆ°ä¸šåŠ¡å‚æ•°</td><td>ä¸­é—´ä»¶æ³¨å…¥ request_idï¼Œä¸€æ¬¡ grep å®šä½å…¨é“¾è·¯</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-1">2. æœ€å°å¯è¿è¡Œç‰ˆæœ¬ï¼ˆMVPï¼‰</h2>
<p><strong>å®‰è£…ä¾èµ–</strong></p>
<pre><code class="hljs language-bash" lang="bash">pip install fastapi uvicorn[standard] loguru
</code></pre>
<p><strong>main.py</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI
<span class="hljs-keyword">from</span> loguru <span class="hljs-keyword">import</span> logger
<span class="hljs-keyword">import</span> uvicorn, sys

<span class="hljs-comment"># 1. ç§»é™¤é»˜è®¤ handlerï¼Œé˜²æ­¢é‡å¤</span>
logger.remove()
logger.add(sys.stdout,
           colorize=<span class="hljs-literal">True</span>,
           <span class="hljs-built_in">format</span>=<span class="hljs-string">"&lt;green&gt;{time:HH:mm:ss}&lt;/green&gt; | &lt;lvl&gt;{level: &lt;8}&lt;/lvl&gt; | {message}"</span>)

app = FastAPI()

<span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/ping"</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">ping</span>():
    logger.info(<span class="hljs-string">"pong"</span>)
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"msg"</span>: <span class="hljs-string">"pong"</span>}

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-comment"># 2. å…³é”®ï¼šç¦ç”¨ uvicorn çš„é»˜è®¤æ—¥å¿—é…ç½®</span>
    uvicorn.run(<span class="hljs-string">"main:app"</span>, host=<span class="hljs-string">"0.0.0.0"</span>, port=<span class="hljs-number">8000</span>, log_config=<span class="hljs-literal">None</span>)
</code></pre>
<blockquote>
<p>ç»ˆç«¯ç°åœ¨åªæœ‰ä¸€è¡Œå¸¦é¢œè‰²çš„ <code>pong</code>ï¼Œä¸–ç•Œå®‰é™äº†ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-2">3. ç”Ÿäº§çº§è„šæ‰‹æ¶ï¼šä¸ƒæ­¥ç»Ÿä¸€æ—¥å¿—</h2>
<p>æŠŠä¸‹é¢ä»£ç æ”¾åˆ° <code>app/core/logging.py</code>ï¼Œé¡¹ç›®å¯åŠ¨æ—¶ä¸€æ¬¡ <code>setup_logging()</code> å³å¯ã€‚</p>













































<table><thead><tr><th>æ­¥éª¤</th><th>ç›®çš„</th><th>å…³é”®å‚æ•°</th></tr></thead><tbody><tr><td>â‘  æ¸…ç©ºé»˜è®¤</td><td>é˜²æ­¢é‡å¤</td><td><code>logger.remove()</code></td></tr><tr><td>â‘¡ å½©è‰²ç»ˆç«¯</td><td>å¼€å‘è°ƒè¯•</td><td><code>colorize=True</code></td></tr><tr><td>â‘¢ æ–‡ä»¶è½®è½¬</td><td>é¿å…æ‰“çˆ†ç£ç›˜</td><td><code>rotation="100 MB", retention="30 days"</code></td></tr><tr><td>â‘£ é”™è¯¯åˆ†æµ</td><td>error.log å•ç‹¬åˆ†æ</td><td><code>level="ERROR"</code></td></tr><tr><td>â‘¤ å¼‚æ­¥å†™å…¥</td><td>é«˜å¹¶å‘ä¸é˜»å¡</td><td><code>enqueue=True</code></td></tr><tr><td>â‘¥ æ‹¦æˆªæ ‡å‡†åº“</td><td>æ”¶ç¼– Uvicorn</td><td><code>InterceptHandler</code></td></tr><tr><td>â‘¦ æ³¨å…¥ request_id</td><td>å…¨é“¾è·¯è¿½è¸ª</td><td><code>bind(request_id=...)</code></td></tr></tbody></table>
<p><strong>å®Œæ•´ä»£ç ï¼ˆå¯ç›´æ¥å¤ç”¨ï¼‰</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> logging, sys, os
<span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path
<span class="hljs-keyword">from</span> loguru <span class="hljs-keyword">import</span> logger
<span class="hljs-keyword">from</span> contextvars <span class="hljs-keyword">import</span> ContextVar

<span class="hljs-comment"># å…¨é“¾è·¯ request_id</span>
request_id: ContextVar[<span class="hljs-built_in">str</span>] = ContextVar(<span class="hljs-string">"request_id"</span>, default=<span class="hljs-string">"-"</span>)

<span class="hljs-keyword">class</span> <span class="hljs-title class_">InterceptHandler</span>(logging.Handler):
    <span class="hljs-string">"""æŠŠæ ‡å‡†åº“æ—¥å¿—æ— ç¼è½¬åˆ° loguru"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">emit</span>(<span class="hljs-params">self, record: logging.LogRecord</span>):
        <span class="hljs-keyword">try</span>:
            level = logger.level(record.levelname).name
        <span class="hljs-keyword">except</span> ValueError:
            level = record.levelno
        frame, depth = logging.currentframe(), <span class="hljs-number">2</span>
        <span class="hljs-keyword">while</span> frame <span class="hljs-keyword">and</span> frame.f_code.co_filename == logging.__file__:
            frame = frame.f_back
            depth += <span class="hljs-number">1</span>
        logger.opt(depth=depth, exception=record.exc_info).log(
            level, record.getMessage()
        )

<span class="hljs-keyword">def</span> <span class="hljs-title function_">setup_logging</span>():
    log_dir = Path(<span class="hljs-string">"logs"</span>)
    log_dir.mkdir(exist_ok=<span class="hljs-literal">True</span>)

    <span class="hljs-comment"># ç»Ÿä¸€æ ¼å¼</span>
    fmt = (<span class="hljs-string">"&lt;green&gt;{time:YYYY-MM-DD HH:mm:ss.SSS}&lt;/green&gt; | "</span>
           <span class="hljs-string">"{extra[request_id]} | &lt;lvl&gt;{level: &lt;8}&lt;/lvl&gt; | "</span>
           <span class="hljs-string">"&lt;cyan&gt;{name}&lt;/cyan&gt;:&lt;cyan&gt;{function}&lt;/cyan&gt;:&lt;cyan&gt;{line}&lt;/cyan&gt; - &lt;lvl&gt;{message}&lt;/lvl&gt;"</span>)

    logger.remove()
    logger.add(sys.stdout, <span class="hljs-built_in">format</span>=fmt, level=<span class="hljs-string">"INFO"</span>, colorize=<span class="hljs-literal">True</span>)
    logger.add(log_dir / <span class="hljs-string">"app.log"</span>, rotation=<span class="hljs-string">"100 MB"</span>, retention=<span class="hljs-string">"30 days"</span>, enqueue=<span class="hljs-literal">True</span>, <span class="hljs-built_in">format</span>=fmt)
    logger.add(log_dir / <span class="hljs-string">"error.log"</span>, level=<span class="hljs-string">"ERROR"</span>, rotation=<span class="hljs-string">"100 MB"</span>, retention=<span class="hljs-string">"30 days"</span>, enqueue=<span class="hljs-literal">True</span>, <span class="hljs-built_in">format</span>=fmt)

    <span class="hljs-comment"># æ”¶ç¼–ä¸‰æ–¹åº“</span>
    logging.basicConfig(handlers=[InterceptHandler()], level=logging.INFO)
    <span class="hljs-keyword">for</span> name <span class="hljs-keyword">in</span> [<span class="hljs-string">"uvicorn"</span>, <span class="hljs-string">"uvicorn.access"</span>, <span class="hljs-string">"uvicorn.error"</span>, <span class="hljs-string">"fastapi"</span>]:
        _log = logging.getLogger(name)
        _log.handlers = [InterceptHandler()]
        _log.propagate = <span class="hljs-literal">False</span>
</code></pre>
<p><strong>FastAPI ä¸­é—´ä»¶ï¼šè‡ªåŠ¨æ³¨å…¥ request_id</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> Request
<span class="hljs-keyword">import</span> uuid

<span class="hljs-meta">@app.middleware(<span class="hljs-params"><span class="hljs-string">"http"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">add_request_id</span>(<span class="hljs-params">request: Request, call_next</span>):
    rid = request.headers.get(<span class="hljs-string">"X-Request-ID"</span>) <span class="hljs-keyword">or</span> <span class="hljs-built_in">str</span>(uuid.uuid4())
    request_id.<span class="hljs-built_in">set</span>(rid)
    <span class="hljs-keyword">with</span> logger.contextualize(request_id=rid):
        logger.info(<span class="hljs-string">f"<span class="hljs-subst">{request.method}</span> <span class="hljs-subst">{request.url.path}</span>"</span>)
        response = <span class="hljs-keyword">await</span> call_next(request)
    response.headers[<span class="hljs-string">"X-Request-ID"</span>] = rid
    <span class="hljs-keyword">return</span> response
</code></pre>
<blockquote>
<p>ä¸€æ¬¡ <code>grep &lt;request_id&gt;</code> å³å¯æŠŠ access + ä¸šåŠ¡ + é”™è¯¯ æ—¥å¿—å…¨éƒ¨æ‹‰å‡ºæ¥ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-3">4. å¸¸è§é—®é¢˜ FAQ</h2>






























<table><thead><tr><th>ç°è±¡</th><th>æ ¹å› </th><th>è§£æ³•</th></tr></thead><tbody><tr><td>ç»ˆç«¯ä»ç„¶å‡ºç°åŒä»½</td><td>æ—§ handler æœªæ¸…å¹²å‡€</td><td>ç¡®ä¿ <code>logger.remove()</code> åœ¨æ–°å¢ add ä¹‹å‰æ‰§è¡Œ</td></tr><tr><td>å¤šè¿›ç¨‹æ—¥å¿—é”™ä¹±</td><td>æœªå¼€å¼‚æ­¥é˜Ÿåˆ—</td><td>æ‰€æœ‰ <code>logger.add(..., enqueue=True)</code></td></tr><tr><td>422 æŠ¥é”™æ— è¯·æ±‚ä½“</td><td>æ¡†æ¶æå‰æŠ›é”™</td><td>åœ¨ä¸­é—´ä»¶é‡Œ <code>try/except</code> å¹¶ <code>logger.bind(body=...)</code></td></tr><tr><td>æ—¥å¿—æ–‡ä»¶ä¸­æ–‡ä¹±ç </td><td>Windows é»˜è®¤ GBK</td><td>æ˜¾å¼ <code>encoding="utf-8"</code></td></tr></tbody></table>
<hr/>
<h2 data-id="heading-4">5. ä¸€é”®å¯åŠ¨è„šæœ¬</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># run.py</span>
<span class="hljs-keyword">import</span> uvicorn, asyncio
<span class="hljs-keyword">from</span> app.core.logging <span class="hljs-keyword">import</span> setup_logging

<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    <span class="hljs-keyword">await</span> setup_logging()
    config = uvicorn.Config(<span class="hljs-string">"app.main:app"</span>, host=<span class="hljs-string">"0.0.0.0"</span>, port=<span class="hljs-number">8000</span>, log_config=<span class="hljs-literal">None</span>)
    server = uvicorn.Server(config)
    <span class="hljs-keyword">await</span> server.serve()

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    asyncio.run(main())
</code></pre>
<blockquote>
<p>æŠŠ <code>log_config=None</code> å†™æ­»ï¼Œå½»åº•æ–­ç» Uvicorn è‡ªå»º handler çš„æœºä¼šã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-5">6. ç»“è¯­</h2>
<p>æ—¥å¿—ä¸æ˜¯â€œæ‰“å°å­—ç¬¦ä¸²â€ï¼Œè€Œæ˜¯<strong>å¯è§‚æµ‹æ€§çš„åœ°åŸº</strong>ã€‚<br/>
ç”¨ Loguru æŠŠæ ¼å¼ã€åˆ†çº§ã€è½®è½¬ã€è¿½è¸ªä¸€æ¬¡åšåˆ°ä½ï¼Œä»¥åæŸ¥é—®é¢˜åªéœ€å¸¦ä¸Š <code>request_id</code> å’Œ <code>grep</code>ï¼Œå†ä¹Ÿä¸ç”¨é¢å¯¹æ»¡å±é‡å¤ã€æ ¼å¼ä¹±ç³Ÿç³Ÿçš„ç»ˆç«¯å‘å‘†ã€‚Happy logging!</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[FastAPI Ã— SQLAlchemy 2.0 Asyncï¼šä»â€œèƒ½è·‘â€åˆ°â€œå¯å‹æµ‹â€çš„å®Œæ•´å·¥ç¨‹å®è·µ]]></title>    <link>https://juejin.cn/post/7570903763722289162</link>    <guid>https://juejin.cn/post/7570903763722289162</guid>    <pubDate>2025-11-10T15:02:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570903763722289162" data-draft-id="7570897638441238555" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="FastAPI Ã— SQLAlchemy 2.0 Asyncï¼šä»â€œèƒ½è·‘â€åˆ°â€œå¯å‹æµ‹â€çš„å®Œæ•´å·¥ç¨‹å®è·µ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-10T15:02:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Javaç§æ•™"/> <meta itemprop="url" content="https://juejin.cn/user/3394924618197325"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            FastAPI Ã— SQLAlchemy 2.0 Asyncï¼šä»â€œèƒ½è·‘â€åˆ°â€œå¯å‹æµ‹â€çš„å®Œæ•´å·¥ç¨‹å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3394924618197325/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Javaç§æ•™
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T15:02:02.000Z" title="Mon Nov 10 2025 15:02:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>ä¸€å¥è¯æ€»ç»“<br/>
ç”¨ <strong>SQLAlchemy 2.0 AsyncIO</strong> æ¨¡å¼ï¼ŒæŠŠ FastAPI çš„å¹¶å‘ä¼˜åŠ¿å…‘ç°æˆ <strong>çœŸæ­£çš„æ•°æ®åº“åå</strong>ï¼›å†å ä¸Šè¿æ¥æ± ã€äº‹åŠ¡ã€è¿ç§»ã€æµ‹è¯•å››ä»¶å¥—ï¼Œ<strong>ç›´æ¥ä¸Šçº¿ä¸è¸©å‘</strong>ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">1. ä¸ºä»€ä¹ˆè¦â€œå¼‚æ­¥ ORMâ€ï¼Ÿ</h2>

























<table><thead><tr><th>åœºæ™¯</th><th>åŒæ­¥ SQLAlchemy</th><th>å¼‚æ­¥ SQLAlchemy</th></tr></thead><tbody><tr><td>100 ä¸ªå¹¶å‘ä¸Šä¼ </td><td>å¼€ 100 çº¿ç¨‹ â†’ 100 ä¸ªè¿æ¥ â†’ DB è¢«æ‰“çˆ†</td><td>å•çº¿ç¨‹ 20 è¿æ¥å³å¯è·‘æ»¡ CPU</td></tr><tr><td>è¯·æ±‚ç­‰å¾… I/O</td><td>çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ 8 ms</td><td>åç¨‹åˆ‡æ¢ 0.3 ms</td></tr><tr><td>ä»£ç é£æ ¼</td><td>åˆ°å¤„ <code>run_in_threadpool</code></td><td>åŸç”Ÿ <code>await</code> ä¸€è·¯åˆ°åº•</td></tr></tbody></table>
<blockquote>
<p>ä¸€å¥è¯ï¼š<strong>åŒæ­¥æ¨¡å¼æŠŠ FastAPI çš„å¼‚æ­¥äº‹ä»¶å¾ªç¯æ‹–å›è§£æ”¾å‰</strong>ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-1">2. æœ€å°å¯è¿è¡Œç‰ˆæœ¬ï¼ˆMVPï¼‰</h2>
<p><strong>å®‰è£…ä¾èµ–</strong></p>
<pre><code class="hljs language-bash" lang="bash">pip install <span class="hljs-string">"fastapi[all]"</span> \
            <span class="hljs-string">"sqlalchemy[asyncio]&gt;=2.0"</span> \
            asyncpg alembic pydantic[email]
</code></pre>
<blockquote>
<p>æ•°æ®åº“ä»¥ PostgreSQL ä¸ºä¾‹ï¼ŒMySQL æ¢æˆ <code>asyncmy</code> å³å¯ã€‚</p>
</blockquote>
<p><strong>é¡¹ç›®éª¨æ¶</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">app/
 â”œâ”€ api/
 â”‚   â””â”€ user.py
 â”œâ”€ core/
 â”‚   â”œâ”€ db.py
 â”‚   â””â”€ config.py
 â”œâ”€ models/
 â”‚   â””â”€ user.py
 â”œâ”€ schemas/
 â”‚   â””â”€ user.py
 â””â”€ main.py
</code></pre>
<hr/>
<h2 data-id="heading-2">3. æ ¸å¿ƒä»£ç ï¼šSession ç”Ÿå‘½å‘¨æœŸä¸€æ¡é¾™</h2>
<p><strong>app/core/config.py</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseSettings

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Settings</span>(<span class="hljs-title class_ inherited__">BaseSettings</span>):
    database_url: <span class="hljs-built_in">str</span> = <span class="hljs-string">"postgresql+asyncpg://user:pass@localhost:5432/demo"</span>
    pool_size: <span class="hljs-built_in">int</span> = <span class="hljs-number">20</span>
    max_overflow: <span class="hljs-built_in">int</span> = <span class="hljs-number">0</span>
    echo_sql: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span>

    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Config</span>:
        env_file = <span class="hljs-string">".env"</span>

settings = Settings()
</code></pre>
<p><strong>app/core/db.py</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> sqlalchemy.ext.asyncio <span class="hljs-keyword">import</span> (
    AsyncEngine, AsyncSession, async_sessionmaker, create_async_engine
)

<span class="hljs-keyword">class</span> <span class="hljs-title class_">AsyncDatabaseSession</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, url: <span class="hljs-built_in">str</span>, *, pool_size: <span class="hljs-built_in">int</span> = <span class="hljs-number">20</span>, max_overflow: <span class="hljs-built_in">int</span> = <span class="hljs-number">0</span>, echo: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span></span>):
        self.engine: AsyncEngine = create_async_engine(
            url,
            pool_size=pool_size,
            max_overflow=max_overflow,
            echo=echo,
            pool_pre_ping=<span class="hljs-literal">True</span>,          <span class="hljs-comment"># å¿ƒè·³ä¿æ´»</span>
        )
        self.session_factory = async_sessionmaker(
            self.engine,
            expire_on_commit=<span class="hljs-literal">False</span>,      <span class="hljs-comment"># é˜²æ­¢æ‡’åŠ è½½å¼‚å¸¸</span>
            class_=AsyncSession,
        )

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">close</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">await</span> self.engine.dispose()

db = AsyncDatabaseSession(
    settings.database_url,
    pool_size=settings.pool_size,
    echo=settings.echo_sql,
)
</code></pre>
<p><strong>main.py</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI
<span class="hljs-keyword">from</span> app.core.db <span class="hljs-keyword">import</span> db
<span class="hljs-keyword">from</span> app.api <span class="hljs-keyword">import</span> user

app = FastAPI(title=<span class="hljs-string">"Async SQLAlchemy Demo"</span>)

app.include_router(user.router)

<span class="hljs-meta">@app.on_event(<span class="hljs-params"><span class="hljs-string">"startup"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">startup</span>():
    <span class="hljs-comment"># å¯é€‰ï¼šå»ºè¡¨</span>
    <span class="hljs-comment"># from app.models import Base</span>
    <span class="hljs-comment"># async with db.engine.begin() as conn:</span>
    <span class="hljs-comment">#     await conn.run_sync(Base.metadata.create_all)</span>
    <span class="hljs-keyword">pass</span>

<span class="hljs-meta">@app.on_event(<span class="hljs-params"><span class="hljs-string">"shutdown"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">shutdown</span>():
    <span class="hljs-keyword">await</span> db.close()
</code></pre>
<hr/>
<h2 data-id="heading-3">4. ä¾èµ–æ³¨å…¥ï¼šæ¯æ¬¡è¯·æ±‚ä¸€ä¸ª Sessionï¼Œè‡ªåŠ¨å›æ»š</h2>
<p><strong>app/core/deps.py</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> AsyncGenerator
<span class="hljs-keyword">from</span> app.core.db <span class="hljs-keyword">import</span> db
<span class="hljs-keyword">from</span> sqlalchemy.ext.asyncio <span class="hljs-keyword">import</span> AsyncSession
<span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> Depends

<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_session</span>() -&gt; AsyncGenerator[AsyncSession, <span class="hljs-literal">None</span>]:
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> db.session_factory() <span class="hljs-keyword">as</span> session:
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">yield</span> session
        <span class="hljs-keyword">except</span> Exception:
            <span class="hljs-keyword">await</span> session.rollback()
            <span class="hljs-keyword">raise</span>
        <span class="hljs-keyword">finally</span>:
            <span class="hljs-keyword">await</span> session.close()
</code></pre>
<blockquote>
<p>ç”¨ <code>yield</code> + <code>rollback</code> ä¿è¯<strong>è¯·æ±‚çº§äº‹åŠ¡</strong>ï¼›æŠ›å¼‚å¸¸è‡ªåŠ¨å›æ»šï¼Œæ­£å¸¸åˆ™ commitã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-4">5. Model / Schema / CRUD ä¸€æ¡é¾™</h2>
<p><strong>app/models/user.py</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> sqlalchemy <span class="hljs-keyword">import</span> String
<span class="hljs-keyword">from</span> sqlalchemy.orm <span class="hljs-keyword">import</span> DeclarativeBase, Mapped, mapped_column

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span>(<span class="hljs-title class_ inherited__">DeclarativeBase</span>):
    <span class="hljs-keyword">pass</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-title class_ inherited__">Base</span>):
    __tablename__ = <span class="hljs-string">"users"</span>

    <span class="hljs-built_in">id</span>: Mapped[<span class="hljs-built_in">int</span>] = mapped_column(primary_key=<span class="hljs-literal">True</span>, index=<span class="hljs-literal">True</span>)
    email: Mapped[<span class="hljs-built_in">str</span>] = mapped_column(String(<span class="hljs-number">320</span>), unique=<span class="hljs-literal">True</span>, index=<span class="hljs-literal">True</span>)
    full_name: Mapped[<span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span>]
</code></pre>
<p><strong>app/schemas/user.py</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel, EmailStr

<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserCreate</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    email: EmailStr
    full_name: <span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserRead</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    <span class="hljs-built_in">id</span>: <span class="hljs-built_in">int</span>
    email: EmailStr
    full_name: <span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span>

    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Config</span>:
        orm_mode = <span class="hljs-literal">True</span>
</code></pre>
<p><strong>app/api/user.py</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> APIRouter, Depends, HTTPException
<span class="hljs-keyword">from</span> sqlalchemy.ext.asyncio <span class="hljs-keyword">import</span> AsyncSession
<span class="hljs-keyword">from</span> sqlalchemy <span class="hljs-keyword">import</span> select
<span class="hljs-keyword">from</span> app.models <span class="hljs-keyword">import</span> User
<span class="hljs-keyword">from</span> app.schemas <span class="hljs-keyword">import</span> UserCreate, UserRead
<span class="hljs-keyword">from</span> app.core.deps <span class="hljs-keyword">import</span> get_session

router = APIRouter(prefix=<span class="hljs-string">"/users"</span>, tags=[<span class="hljs-string">"users"</span>])

<span class="hljs-meta">@router.post(<span class="hljs-params"><span class="hljs-string">""</span>, response_model=UserRead</span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_user</span>(<span class="hljs-params">payload: UserCreate, session: AsyncSession = Depends(<span class="hljs-params">get_session</span>)</span>):
    user = User(**payload.<span class="hljs-built_in">dict</span>())
    session.add(user)
    <span class="hljs-keyword">await</span> session.flush()          <span class="hljs-comment"># è·å– id</span>
    <span class="hljs-keyword">await</span> session.commit()
    <span class="hljs-keyword">await</span> session.refresh(user)
    <span class="hljs-keyword">return</span> user

<span class="hljs-meta">@router.get(<span class="hljs-params"><span class="hljs-string">"/{uid}"</span>, response_model=UserRead</span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_user</span>(<span class="hljs-params">uid: <span class="hljs-built_in">int</span>, session: AsyncSession = Depends(<span class="hljs-params">get_session</span>)</span>):
    user = <span class="hljs-keyword">await</span> session.get(User, uid)
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> user:
        <span class="hljs-keyword">raise</span> HTTPException(<span class="hljs-number">404</span>, <span class="hljs-string">"User not found"</span>)
    <span class="hljs-keyword">return</span> user
</code></pre>
<hr/>
<h2 data-id="heading-5">6. è¿ç§»ï¼šAlembic åŒæ ·èƒ½å¼‚æ­¥</h2>
<p><strong>åˆå§‹åŒ–</strong></p>
<pre><code class="hljs language-bash" lang="bash">alembic init -t async migrations
</code></pre>
<p><strong>ä¿®æ”¹ <code>alembic.ini</code> ä¸­çš„ <code>sqlalchemy.url</code> ä¸º <code>postgresql+asyncpg://...</code></strong></p>
<p><strong>migrations/env.py</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> app.core.config <span class="hljs-keyword">import</span> settings
<span class="hljs-keyword">from</span> app.models <span class="hljs-keyword">import</span> Base
target_metadata = Base.metadata

<span class="hljs-keyword">def</span> <span class="hljs-title function_">do_run_migrations</span>(<span class="hljs-params">connection</span>):
    context.configure(connection=connection, target_metadata=target_metadata)
    <span class="hljs-keyword">with</span> context.begin_transaction():
        context.run_migrations()

<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">run_async_migrations</span>():
    <span class="hljs-keyword">from</span> sqlalchemy.ext.asyncio <span class="hljs-keyword">import</span> AsyncEngine
    connectable = AsyncEngine(create_async_engine(settings.database_url))
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> connectable.connect() <span class="hljs-keyword">as</span> connection:
        <span class="hljs-keyword">await</span> connection.run_sync(do_run_migrations)
    <span class="hljs-keyword">await</span> connectable.dispose()
</code></pre>
<p><strong>ç”Ÿæˆ / å‡çº§</strong></p>
<pre><code class="hljs language-bash" lang="bash">alembic revision --autogenerate -m <span class="hljs-string">"init"</span>
alembic upgrade <span class="hljs-built_in">head</span>
</code></pre>
<hr/>
<h2 data-id="heading-6">7. æµ‹è¯•ï¼špytest-asyncio + å¼‚æ­¥æ•°æ®åº“äº‹åŠ¡</h2>
<p><strong>tests/conftest.py</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pytest
<span class="hljs-keyword">from</span> httpx <span class="hljs-keyword">import</span> AsyncClient
<span class="hljs-keyword">from</span> app.main <span class="hljs-keyword">import</span> app
<span class="hljs-keyword">from</span> app.core.db <span class="hljs-keyword">import</span> db <span class="hljs-keyword">as</span> db_instance
<span class="hljs-keyword">from</span> sqlalchemy.pool <span class="hljs-keyword">import</span> StaticPool
<span class="hljs-keyword">from</span> sqlalchemy.ext.asyncio <span class="hljs-keyword">import</span> AsyncEngine, create_async_engine

<span class="hljs-meta">@pytest.fixture(<span class="hljs-params">scope=<span class="hljs-string">"session"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">engine</span>() -&gt; AsyncEngine:
    <span class="hljs-comment"># å†…å­˜ SQLite ä¹Ÿå¯ä»¥å¼‚æ­¥ï¼Œä½† PostgreSQL æ›´çœŸå®</span>
    engine = create_async_engine(
        <span class="hljs-string">"postgresql+asyncpg://test:test@localhost:5432/test"</span>,
        poolclass=StaticPool,
    )
    <span class="hljs-keyword">yield</span> engine
    <span class="hljs-keyword">await</span> engine.dispose()

<span class="hljs-meta">@pytest.fixture</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">session</span>(<span class="hljs-params">engine: AsyncEngine</span>):
    conn = <span class="hljs-keyword">await</span> engine.begin()
    sess = db_instance.session_factory(bind=conn)
    <span class="hljs-keyword">yield</span> sess
    <span class="hljs-keyword">await</span> sess.close()
    <span class="hljs-keyword">await</span> conn.rollback()
    <span class="hljs-keyword">await</span> conn.close()

<span class="hljs-meta">@pytest.fixture</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">client</span>() -&gt; AsyncGenerator[AsyncClient, <span class="hljs-literal">None</span>]:
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> AsyncClient(app=app, base_url=<span class="hljs-string">"http://test"</span>) <span class="hljs-keyword">as</span> c:
        <span class="hljs-keyword">yield</span> c
</code></pre>
<p><strong>tests/test_user.py</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pytest
<span class="hljs-keyword">from</span> sqlalchemy <span class="hljs-keyword">import</span> select
<span class="hljs-keyword">from</span> app.models <span class="hljs-keyword">import</span> User

<span class="hljs-meta">@pytest.mark.asyncio</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_create_user</span>(<span class="hljs-params">client, session</span>):
    res = <span class="hljs-keyword">await</span> client.post(<span class="hljs-string">"/users"</span>, json={<span class="hljs-string">"email"</span>: <span class="hljs-string">"a@b.com"</span>, <span class="hljs-string">"full_name"</span>: <span class="hljs-string">"abc"</span>})
    <span class="hljs-keyword">assert</span> res.status_code == <span class="hljs-number">201</span>
    data = res.json()
    <span class="hljs-keyword">assert</span> data[<span class="hljs-string">"email"</span>] == <span class="hljs-string">"a@b.com"</span>

    user = <span class="hljs-keyword">await</span> session.get(User, data[<span class="hljs-string">"id"</span>])
    <span class="hljs-keyword">assert</span> user <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>
</code></pre>
<hr/>
<h2 data-id="heading-7">8. æ€§èƒ½è°ƒä¼˜ checklist</h2>



































<table><thead><tr><th>å‚æ•°</th><th>å»ºè®®å€¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>pool_size</code></td><td>CPU æ ¸å¿ƒ Ã— 2</td><td>20 å¹¶å‘å·²èƒ½å‹åˆ° 10k RPS</td></tr><tr><td><code>max_overflow</code></td><td>0</td><td>é˜²æ­¢çªå‘è¿æ¥æ‰“çˆ† DB</td></tr><tr><td><code>pool_pre_ping=True</code></td><td>å¿…é¡»</td><td>ç½‘ç»œé—ªæ–­åè‡ªåŠ¨é‡è¿</td></tr><tr><td><code>expire_on_commit=False</code></td><td>å¿…é¡»</td><td>å¦åˆ™ commit åå±æ€§å¤±æ•ˆ</td></tr><tr><td><code>echo=False</code></td><td>ç”Ÿäº§å…³é—­</td><td>å‡å°‘åºåˆ—åŒ–å¼€é”€</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-8">9. å¸¸è§é”™è¯¯é€ŸæŸ¥è¡¨</h2>






























<table><thead><tr><th>å¼‚å¸¸</th><th>åŸå› </th><th>è§£æ³•</th></tr></thead><tbody><tr><td><code>greenlet_spawn has not been called</code></td><td>ç”¨äº†åŒæ­¥å¼•æ“</td><td><code>create_async_engine</code></td></tr><tr><td><code>DetachedInstanceError</code></td><td>ä¼šè¯å…³é—­åè®¿é—®å±æ€§</td><td><code>expire_on_commit=False</code> + <code>await session.refresh()</code></td></tr><tr><td><code>InterfaceError: connection already closed</code></td><td>åç¨‹é—´å¤ç”¨ Session</td><td>ä¸€ä¸ªè¯·æ±‚ä¸€ä¸ª Sessionï¼Œç¦æ­¢å…¨å±€å•ä¾‹</td></tr><tr><td><code>ImportError: asyncmy</code></td><td>MySQL é©±åŠ¨æœªè£…</td><td><code>pip install asyncmy</code></td></tr></tbody></table>
<hr/>
<h2 data-id="heading-9">10. ç»“è¯­</h2>
<p>FastAPI çš„å¼‚æ­¥ç”Ÿæ€é‡Œï¼Œ<strong>æ•°æ®åº“æ˜¯æœ€åä¸€é“é—¸é—¨</strong>ã€‚<br/>
ç”¨ä¸Š SQLAlchemy 2.0 AsyncIO ä¹‹åï¼Œ<strong>I/O ç­‰å¾…ä¸å†æ˜¯ç“¶é¢ˆ</strong>ï¼Œå‹æµ‹æ›²çº¿ç›´æ¥å¤šä¸€ä¸ªé‡çº§ã€‚<br/>
æŠŠæœ¬æ–‡çš„ <code>db.py</code> + <code>deps.py</code> å¤åˆ¶èµ°ï¼Œ<strong>10 åˆ†é’Ÿå°±èƒ½è®©è€é¡¹ç›®åŸåœ°èµ·é£</strong>ã€‚Happy async coding!</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€ç©¿è¶ŠEffective C++ã€‘æ¡æ¬¾16ï¼šæˆå¯¹ä½¿ç”¨newå’Œdeleteæ—¶è¦é‡‡ç”¨ç›¸åŒå½¢å¼â€”â€”å†…å­˜ç®¡ç†çš„ç²¾ç¡®åŒ¹é…åŸåˆ™]]></title>    <link>https://juejin.cn/post/7570909641682780200</link>    <guid>https://juejin.cn/post/7570909641682780200</guid>    <pubDate>2025-11-10T13:14:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570909641682780200" data-draft-id="7570940025580568616" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€ç©¿è¶ŠEffective C++ã€‘æ¡æ¬¾16ï¼šæˆå¯¹ä½¿ç”¨newå’Œdeleteæ—¶è¦é‡‡ç”¨ç›¸åŒå½¢å¼â€”â€”å†…å­˜ç®¡ç†çš„ç²¾ç¡®åŒ¹é…åŸåˆ™"/> <meta itemprop="keywords" content="C++,é¢è¯•"/> <meta itemprop="datePublished" content="2025-11-10T13:14:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ²æ€¡æ—¸"/> <meta itemprop="url" content="https://juejin.cn/user/2875978146656750"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€ç©¿è¶ŠEffective C++ã€‘æ¡æ¬¾16ï¼šæˆå¯¹ä½¿ç”¨newå’Œdeleteæ—¶è¦é‡‡ç”¨ç›¸åŒå½¢å¼â€”â€”å†…å­˜ç®¡ç†çš„ç²¾ç¡®åŒ¹é…åŸåˆ™
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2875978146656750/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ²æ€¡æ—¸
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T13:14:55.000Z" title="Mon Nov 10 2025 13:14:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>è¿™ä¸ªæ¡æ¬¾æ­ç¤ºäº†C++åŠ¨æ€å†…å­˜ç®¡ç†ä¸­æœ€åŸºæœ¬ä½†å¸¸è¢«å¿½è§†çš„è§„åˆ™ï¼šnew/deleteå½¢å¼å¿…é¡»ä¸¥æ ¼åŒ¹é…ã€‚ç†è§£è¿™ä¸€åŸåˆ™æ˜¯é¿å…å†…å­˜æ³„æ¼å’Œæœªå®šä¹‰è¡Œä¸ºçš„å…³é”®ã€‚</p>
<hr/>
<h3 data-id="heading-0"><strong>æ€ç»´å¯¼å›¾ï¼šnew/deleteé…å¯¹ä½¿ç”¨çš„å®Œæ•´ä½“ç³»</strong></h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/294e89093b45496b8b2215e315e05f97~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKQ5oCh5pe4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763385295&amp;x-signature=p68QUDVmtXnFF9vTKtJN7M3os1U%3D" alt="16æˆå¯¹ä½¿ç”¨newå’Œdeleteçš„ç›¸åŒå½¢å¼.png" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-1"><strong>å…³é”®æ´è§ä¸è¡ŒåŠ¨æŒ‡å—</strong></h3>
<h4 data-id="heading-2"><strong>å¿…é¡»éµå®ˆçš„æ ¸å¿ƒåŸåˆ™ï¼š</strong></h4>
<ol>
<li><strong>ä¸¥æ ¼å½¢å¼åŒ¹é…</strong>ï¼š<code>new</code>é…<code>delete</code>ï¼Œ<code>new[]</code>é…<code>delete[]</code></li>
<li><strong>é¿å…å¤šæ€æ•°ç»„</strong>ï¼šä¸è¦é€šè¿‡åŸºç±»æŒ‡é’ˆåˆ é™¤æ´¾ç”Ÿç±»æ•°ç»„</li>
<li><strong>ä½¿ç”¨æ ‡å‡†åº“</strong>ï¼šä¼˜å…ˆä½¿ç”¨å®¹å™¨å’Œæ™ºèƒ½æŒ‡é’ˆæ›¿ä»£æ‰‹åŠ¨å†…å­˜ç®¡ç†</li>
<li><strong>æ˜ç¡®ç±»å‹ä¿¡æ¯</strong>ï¼šä½¿ç”¨æ¸…æ™°çš„ç±»å‹åˆ«åï¼Œé¿å…æ··æ·†</li>
</ol>
<h4 data-id="heading-3"><strong>ç°ä»£C++å¼€å‘å»ºè®®ï¼š</strong></h4>
<ol>
<li><strong>ç¦æ­¢è£¸new/delete</strong>ï¼šåœ¨ä»£ç è§„èŒƒä¸­æ˜ç¡®ç¦æ­¢æ‰‹åŠ¨å†…å­˜ç®¡ç†</li>
<li><strong>ä½¿ç”¨make_unique/make_shared</strong>ï¼šå·¥å‚å‡½æ•°è‡ªåŠ¨é€‰æ‹©æ­£ç¡®çš„åˆ†é…å½¢å¼</li>
<li><strong>å®¹å™¨ä¼˜å…ˆåŸåˆ™</strong>ï¼šä½¿ç”¨<code>std::vector</code>ã€<code>std::array</code>æ›¿ä»£åŠ¨æ€æ•°ç»„</li>
<li><strong>é™æ€åˆ†æé›†æˆ</strong>ï¼šåœ¨CI/CDæµæ°´çº¿ä¸­é›†æˆå†…å­˜æ£€æµ‹å·¥å…·</li>
</ol>
<h4 data-id="heading-4"><strong>è®¾è®¡åŸåˆ™æ€»ç»“ï¼š</strong></h4>
<ol>
<li><strong>RAIIåŸåˆ™</strong>ï¼šèµ„æºè·å–å³åˆå§‹åŒ–ï¼Œåˆ©ç”¨ææ„å‡½æ•°è‡ªåŠ¨é‡Šæ”¾</li>
<li><strong>é›¶è§„åˆ™</strong>ï¼šè®©ç¼–è¯‘å™¨ç”Ÿæˆæ­£ç¡®çš„æ‹·è´æ§åˆ¶æˆå‘˜</li>
<li><strong>æ˜ç¡®æ‰€æœ‰æƒ</strong>ï¼šä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆæ˜ç¡®è¡¨è¾¾èµ„æºæ‰€æœ‰æƒè¯­ä¹‰</li>
<li><strong>é˜²å¾¡æ€§ç¼–ç¨‹</strong>ï¼šå‡è®¾æ‰€æœ‰æ‰‹åŠ¨å†…å­˜ç®¡ç†éƒ½å¯èƒ½å‡ºé”™</li>
</ol>
<h4 data-id="heading-5"><strong>éœ€è¦è­¦æƒ•çš„é™·é˜±ï¼š</strong></h4>
<ol>
<li><strong>typedeféšè—çš„æ•°ç»„</strong>ï¼šç±»å‹åˆ«åå¯èƒ½éšè—æ•°ç»„æœ¬è´¨</li>
<li><strong>å¤šæ€æ•°ç»„åˆ é™¤</strong>ï¼šé€šè¿‡åŸºç±»æŒ‡é’ˆåˆ é™¤æ´¾ç”Ÿç±»æ•°ç»„</li>
<li><strong>è·¨æ¨¡å—è¾¹ç•Œ</strong>ï¼šåœ¨ä¸åŒDLLä¸­åˆ†é…å’Œé‡Šæ”¾å†…å­˜</li>
<li><strong>å¼‚å¸¸å®‰å…¨</strong>ï¼šåœ¨å¼‚å¸¸å‘ç”Ÿæ—¶ç¡®ä¿èµ„æºæ­£ç¡®é‡Šæ”¾</li>
</ol>
<p><strong>æœ€ç»ˆå»ºè®®ï¼š</strong> å°†new/deleteé…å¯¹è§„åˆ™è§†ä¸ºC++å†…å­˜ç®¡ç†çš„"ç‰©ç†å®šå¾‹"ã€‚åŸ¹å…»"è‡ªåŠ¨ç®¡ç†æ€ç»´"â€”â€”åœ¨éœ€è¦åŠ¨æ€å†…å­˜æ—¶é¦–å…ˆé—®è‡ªå·±ï¼š"èƒ½å¦ç”¨æ ‡å‡†åº“å®¹å™¨æˆ–æ™ºèƒ½æŒ‡é’ˆæ›¿ä»£æ‰‹åŠ¨ç®¡ç†ï¼Ÿ" è¿™ç§é¢„é˜²æ€§çš„æ€è€ƒæ–¹å¼æ˜¯æ„å»ºå¥å£®C++ç³»ç»Ÿçš„å…³é”®ã€‚</p>
<p>è®°ä½ï¼š<strong>åœ¨C++å†…å­˜ç®¡ç†ä¸­ï¼Œæ­£ç¡®çš„é…å¯¹ä¸æ˜¯æœ€ä½³å®è·µï¼Œè€Œæ˜¯é¿å…ç¾éš¾çš„åŸºæœ¬è¦æ±‚ã€‚</strong> æ¡æ¬¾16æ•™ä¼šæˆ‘ä»¬çš„ä¸ä»…æ˜¯ä¸€ä¸ªè¯­æ³•è§„åˆ™ï¼Œæ›´æ˜¯å¯¹C++å†…å­˜æ¨¡å‹æ·±åˆ»ç†è§£çš„ä½“ç°ã€‚</p>
<hr/>
<h3 data-id="heading-6"><strong>æ·±å…¥è§£æï¼šå†…å­˜å¸ƒå±€çš„æ ¸å¿ƒå·®å¼‚</strong></h3>
<h4 data-id="heading-7"><strong>1. é—®é¢˜æ ¹æºï¼šå†…å­˜åˆ†é…çš„å†…éƒ¨æœºåˆ¶</strong></h4>
<p><strong>å•ä¸ªå¯¹è±¡ vs å¯¹è±¡æ•°ç»„çš„å†…å­˜å¸ƒå±€ï¼š</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Widget</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">Widget</span>() { std::cout &lt;&lt; <span class="hljs-string">"Widgetæ„é€  "</span> &lt;&lt; <span class="hljs-keyword">this</span> &lt;&lt; std::endl; }
    ~<span class="hljs-built_in">Widget</span>() { std::cout &lt;&lt; <span class="hljs-string">"Widgetææ„ "</span> &lt;&lt; <span class="hljs-keyword">this</span> &lt;&lt; std::endl; }
<span class="hljs-keyword">private</span>:
    <span class="hljs-type">int</span> data[<span class="hljs-number">10</span>];
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_memory_layout</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// å•ä¸ªå¯¹è±¡çš„å†…å­˜åˆ†é…</span>
    Widget* singleObj = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Widget</span>();
    <span class="hljs-comment">// å†…å­˜å¸ƒå±€: [Widgetå¯¹è±¡æ•°æ®]</span>
    
    <span class="hljs-comment">// å¯¹è±¡æ•°ç»„çš„å†…å­˜åˆ†é…  </span>
    Widget* arrayObj = <span class="hljs-keyword">new</span> Widget[<span class="hljs-number">3</span>];
    <span class="hljs-comment">// å†…å­˜å¸ƒå±€: [æ•°ç»„å¤§å°][Widget][Widget][Widget]</span>
    <span class="hljs-comment">// å¤§å¤šæ•°ç¼–è¯‘å™¨ä¼šåœ¨æ•°ç»„å‰é¢å­˜å‚¨å…ƒç´ æ•°é‡</span>
    
    std::cout &lt;&lt; <span class="hljs-string">"å•ä¸ªå¯¹è±¡åœ°å€: "</span> &lt;&lt; singleObj &lt;&lt; std::endl;
    std::cout &lt;&lt; <span class="hljs-string">"æ•°ç»„å¯¹è±¡åœ°å€: "</span> &lt;&lt; arrayObj &lt;&lt; std::endl;
    
    <span class="hljs-comment">// æ­£ç¡®çš„é‡Šæ”¾</span>
    <span class="hljs-keyword">delete</span> singleObj;      <span class="hljs-comment">// é‡Šæ”¾å•ä¸ªå¯¹è±¡</span>
    <span class="hljs-keyword">delete</span>[] arrayObj;     <span class="hljs-comment">// é‡Šæ”¾å¯¹è±¡æ•°ç»„</span>
}
</code></pre>
<p><strong>å±é™©çš„é”™è¯¯é…å¯¹ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_dangerous_mismatch</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// åœºæ™¯1ï¼šnew[] é… delete</span>
    std::cout &lt;&lt; <span class="hljs-string">"=== é”™è¯¯1: new[] é… delete ==="</span> &lt;&lt; std::endl;
    Widget* widgets = <span class="hljs-keyword">new</span> Widget[<span class="hljs-number">3</span>];
    
    <span class="hljs-comment">// delete widgets;  // ç¾éš¾ï¼</span>
    <span class="hljs-comment">// å®é™…å‘ç”Ÿï¼š</span>
    <span class="hljs-comment">// 1. åªè°ƒç”¨ç¬¬ä¸€ä¸ªå…ƒç´ çš„ææ„å‡½æ•°</span>
    <span class="hljs-comment">// 2. è¯•å›¾é‡Šæ”¾é”™è¯¯çš„å†…å­˜åœ°å€ï¼ˆæ•°ç»„å¼€å§‹ä½ç½® - æ•°ç»„å¤§å°å­˜å‚¨åç§»ï¼‰</span>
    <span class="hljs-comment">// 3. å †æ•°æ®ç»“æ„ç ´å</span>
    
    <span class="hljs-comment">// åœºæ™¯2ï¼šnew é… delete[]</span>
    std::cout &lt;&lt; <span class="hljs-string">"\n=== é”™è¯¯2: new é… delete[] ==="</span> &lt;&lt; std::endl;
    Widget* single = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Widget</span>();
    
    <span class="hljs-comment">// delete[] single;  // åŒæ ·ç¾éš¾ï¼</span>
    <span class="hljs-comment">// å®é™…å‘ç”Ÿï¼š</span>
    <span class="hljs-comment">// 1. è¯•å›¾è¯»å–æ•°ç»„å¤§å°ï¼ˆåœ¨å¯¹è±¡å‰é¢ï¼‰</span>
    <span class="hljs-comment">// 2. è°ƒç”¨å¤šä¸ªä¸å­˜åœ¨çš„å¯¹è±¡çš„ææ„å‡½æ•°</span>
    <span class="hljs-comment">// 3. é‡Šæ”¾é”™è¯¯å¤§å°çš„å†…å­˜å—</span>
    
    <span class="hljs-comment">// æ­£ç¡®é‡Šæ”¾</span>
    <span class="hljs-keyword">delete</span>[] widgets;
    <span class="hljs-keyword">delete</span> single;
}
</code></pre>
<h4 data-id="heading-8"><strong>2. ç¼–è¯‘å™¨å®ç°çš„å·®å¼‚</strong></h4>
<p><strong>ä¸åŒç¼–è¯‘å™¨çš„æ•°ç»„å¤§å°å­˜å‚¨ï¼š</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_compiler_differences</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Simple</span> {
    <span class="hljs-keyword">public</span>:
        ~<span class="hljs-built_in">Simple</span>() {}  <span class="hljs-comment">// æœ‰ææ„å‡½æ•°ï¼Œç¼–è¯‘å™¨å¿…é¡»è®°å½•æ•°ç»„å¤§å°</span>
    };
    
    Simple* array1 = <span class="hljs-keyword">new</span> Simple[<span class="hljs-number">5</span>];
    
    <span class="hljs-comment">// åœ¨å¤§å¤šæ•°ç¼–è¯‘å™¨ä¸­ï¼Œå†…å­˜å¸ƒå±€ç±»ä¼¼ï¼š</span>
    <span class="hljs-comment">// [size_t n=5][Simple][Simple][Simple][Simple][Simple]</span>
    <span class="hljs-comment">// æ•°ç»„å¼€å§‹çš„å®é™…åœ°å€æ˜¯ &amp;array1 - sizeof(size_t)</span>
    
    <span class="hljs-keyword">delete</span>[] array1;  <span class="hljs-comment">// ç¼–è¯‘å™¨çŸ¥é“è¦è°ƒç”¨5æ¬¡ææ„å‡½æ•°</span>
    
    <span class="hljs-comment">// å¯¹äºæ²¡æœ‰ææ„å‡½æ•°çš„ç±»å‹ï¼Œç¼–è¯‘å™¨å¯èƒ½ä¼˜åŒ–</span>
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">NoDestructor</span> {
    <span class="hljs-keyword">public</span>:
        <span class="hljs-comment">// æ²¡æœ‰ç”¨æˆ·å®šä¹‰çš„ææ„å‡½æ•°</span>
    };
    
    NoDestructor* array2 = <span class="hljs-keyword">new</span> NoDestructor[<span class="hljs-number">5</span>];
    <span class="hljs-comment">// ç¼–è¯‘å™¨å¯èƒ½ä¸å­˜å‚¨æ•°ç»„å¤§å°ï¼Œå› ä¸ºä¸éœ€è¦è°ƒç”¨ææ„å‡½æ•°</span>
    
    <span class="hljs-keyword">delete</span>[] array2;  <span class="hljs-comment">// å¯èƒ½åªæ˜¯é‡Šæ”¾å†…å­˜ï¼Œä¸è°ƒç”¨ææ„å‡½æ•°</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-9"><strong>è§£å†³æ–¹æ¡ˆï¼šä¸¥æ ¼çš„é…å¯¹è§„åˆ™</strong></h3>
<h4 data-id="heading-10"><strong>1. åŸºæœ¬é…å¯¹è§„åˆ™</strong></h4>
<p><strong>æ­£ç¡®çš„new/deleteé…å¯¹ï¼š</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Investment</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">Investment</span>() { std::cout &lt;&lt; <span class="hljs-string">"Investmentæ„é€ "</span> &lt;&lt; std::endl; }
    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">Investment</span>() { std::cout &lt;&lt; <span class="hljs-string">"Investmentææ„"</span> &lt;&lt; std::endl; }
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">calculate</span><span class="hljs-params">()</span> </span>= <span class="hljs-number">0</span>;
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Stock</span> : <span class="hljs-keyword">public</span> Investment {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">calculate</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span> </span>{ 
        std::cout &lt;&lt; <span class="hljs-string">"è®¡ç®—è‚¡ç¥¨æ”¶ç›Š"</span> &lt;&lt; std::endl; 
    }
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_correct_pairing</span><span class="hljs-params">()</span> </span>{
    std::cout &lt;&lt; <span class="hljs-string">"=== å•ä¸ªå¯¹è±¡ ==="</span> &lt;&lt; std::endl;
    Investment* single = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Stock</span>();
    single-&gt;<span class="hljs-built_in">calculate</span>();
    <span class="hljs-keyword">delete</span> single;  <span class="hljs-comment">// æ­£ç¡®ï¼šnew é… delete</span>
    
    std::cout &lt;&lt; <span class="hljs-string">"\n=== å¯¹è±¡æ•°ç»„ ==="</span> &lt;&lt; std::endl;
    Investment* array = <span class="hljs-keyword">new</span> Stock[<span class="hljs-number">3</span>];
    <span class="hljs-comment">// æ³¨æ„ï¼šè¿™é‡Œæœ‰å¤šæ€æ•°ç»„çš„é—®é¢˜ï¼Œåé¢ä¼šè®¨è®º</span>
    <span class="hljs-keyword">delete</span>[] array;  <span class="hljs-comment">// æ­£ç¡®ï¼šnew[] é… delete[]</span>
    
    std::cout &lt;&lt; <span class="hljs-string">"\n=== å†…ç½®ç±»å‹æ•°ç»„ ==="</span> &lt;&lt; std::endl;
    <span class="hljs-type">int</span>* intArray = <span class="hljs-keyword">new</span> <span class="hljs-type">int</span>[<span class="hljs-number">100</span>];
    <span class="hljs-keyword">delete</span>[] intArray;  <span class="hljs-comment">// æ­£ç¡®ï¼šå³ä½¿æ²¡æœ‰ææ„å‡½æ•°ä¹Ÿè¦åŒ¹é…</span>
    
    <span class="hljs-type">double</span>* singleDouble = <span class="hljs-keyword">new</span> <span class="hljs-type">double</span>;
    <span class="hljs-keyword">delete</span> singleDouble;  <span class="hljs-comment">// æ­£ç¡®ï¼šnew é… delete</span>
}
</code></pre>
<h4 data-id="heading-11"><strong>2. typedefå¸¦æ¥çš„é™·é˜±</strong></h4>
<p><strong>typedeféšè—çš„æ•°ç»„æœ¬è´¨ï¼š</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// å±é™©çš„typedefå®šä¹‰</span>
<span class="hljs-keyword">typedef</span> Investment* InvestmentPtr;
<span class="hljs-keyword">typedef</span> Investment* InvestmentArray[<span class="hljs-number">10</span>];  <span class="hljs-comment">// å¤§å°ä¸º10çš„InvestmentæŒ‡é’ˆæ•°ç»„</span>

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_typedef_danger</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// æƒ…å†µ1ï¼šçœ‹èµ·æ¥åƒå•ä¸ªå¯¹è±¡ï¼Œå®é™…ä¸Šæ˜¯æ•°ç»„</span>
    InvestmentArray investments;  <span class="hljs-comment">// Investment* investments[10]</span>
    
    <span class="hljs-comment">// é”™è¯¯çš„åˆ†é…æ–¹å¼</span>
    InvestmentPtr* badAlloc = <span class="hljs-keyword">new</span> InvestmentArray;  <span class="hljs-comment">// å®é™…ä¸Šæ˜¯ new Investment*[10]</span>
    <span class="hljs-comment">// çœ‹èµ·æ¥åƒå•ä¸ªå¯¹è±¡ï¼Œä½†å®é™…ä¸Šæ˜¯æ•°ç»„ï¼</span>
    
    <span class="hljs-comment">// delete badAlloc;  // é”™è¯¯ï¼šåº”è¯¥ç”¨ delete[]</span>
    <span class="hljs-keyword">delete</span>[] badAlloc;   <span class="hljs-comment">// æ­£ç¡®</span>
    
    <span class="hljs-comment">// æƒ…å†µ2ï¼šæ›´æ¸…æ™°çš„ç°ä»£æ›¿ä»£</span>
    <span class="hljs-keyword">using</span> InvestmentPtr = Investment*;
    <span class="hljs-keyword">using</span> InvestmentArray = std::array&lt;Investment*, <span class="hljs-number">10</span>&gt;;
    
    InvestmentArray safeInvestments;  <span class="hljs-comment">// æ˜ç¡®çš„å®¹å™¨ç±»å‹</span>
    <span class="hljs-comment">// ä¸éœ€è¦æ‰‹åŠ¨å†…å­˜ç®¡ç†ï¼</span>
}
</code></pre>
<p><strong>ç°ä»£C++çš„è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// ä½¿ç”¨usingæ›¿ä»£typedefï¼Œæ›´æ¸…æ™°</span>
<span class="hljs-keyword">using</span> SingleInvestment = Investment;
<span class="hljs-keyword">using</span> InvestmentArray = Investment[<span class="hljs-number">10</span>];

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_modern_solution</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// C++11 usingè¯­æ³•æ›´æ¸…æ™°</span>
    <span class="hljs-keyword">auto</span> single = <span class="hljs-keyword">new</span> SingleInvestment;  <span class="hljs-comment">// æ˜ç¡®æ˜¯å•ä¸ªå¯¹è±¡</span>
    <span class="hljs-keyword">delete</span> single;
    
    <span class="hljs-comment">// ä½†æ›´å¥½çš„æ–¹æ¡ˆæ˜¯ä½¿ç”¨æ ‡å‡†åº“å®¹å™¨</span>
    std::vector&lt;std::unique_ptr&lt;Investment&gt;&gt; investments;
    investments.<span class="hljs-built_in">push_back</span>(std::<span class="hljs-built_in">make_unique</span>&lt;Stock&gt;());
    <span class="hljs-comment">// è‡ªåŠ¨ç®¡ç†å†…å­˜ï¼Œæ— éœ€æ‹…å¿ƒnew/deleteé…å¯¹</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-12"><strong>ç°ä»£C++çš„æ”¹è¿›æ–¹æ¡ˆ</strong></h3>
<h4 data-id="heading-13"><strong>1. æ™ºèƒ½æŒ‡é’ˆè‡ªåŠ¨ç®¡ç†</strong></h4>
<p><strong>unique_ptrçš„æ•°ç»„ç‰¹åŒ–ï¼š</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_smart_pointers</span><span class="hljs-params">()</span> </span>{
    std::cout &lt;&lt; <span class="hljs-string">"=== unique_ptr å•å¯¹è±¡ ==="</span> &lt;&lt; std::endl;
    {
        std::unique_ptr&lt;Investment&gt; investment = std::<span class="hljs-built_in">make_unique</span>&lt;Stock&gt;();
        investment-&gt;<span class="hljs-built_in">calculate</span>();
        <span class="hljs-comment">// è‡ªåŠ¨è°ƒç”¨deleteï¼Œæ— éœ€æ‰‹åŠ¨ç®¡ç†</span>
    }
    
    std::cout &lt;&lt; <span class="hljs-string">"\n=== unique_ptr å¯¹è±¡æ•°ç»„ ==="</span> &lt;&lt; std::endl;
    {
        <span class="hljs-comment">// unique_ptrçš„æ•°ç»„ç‰¹åŒ–ç‰ˆæœ¬</span>
        <span class="hljs-function">std::unique_ptr&lt;Investment[]&gt; <span class="hljs-title">array</span><span class="hljs-params">(<span class="hljs-keyword">new</span> Stock[<span class="hljs-number">3</span>])</span></span>;
        <span class="hljs-comment">// ä¼šè‡ªåŠ¨è°ƒç”¨delete[]</span>
        
        <span class="hljs-comment">// C++20æ”¯æŒmake_uniqueå¯¹äºæ•°ç»„ï¼ˆæœ‰é™åˆ¶ï¼‰</span>
        <span class="hljs-comment">// auto array = std::make_unique&lt;Investment[]&gt;(3);</span>
    }
    
    std::cout &lt;&lt; <span class="hljs-string">"\n=== shared_ptr éœ€è¦è‡ªå®šä¹‰åˆ é™¤å™¨ ==="</span> &lt;&lt; std::endl;
    {
        <span class="hljs-comment">// shared_ptré»˜è®¤ä½¿ç”¨deleteï¼Œä¸æ˜¯delete[]</span>
        std::shared_ptr&lt;Investment&gt; single = std::<span class="hljs-built_in">make_shared</span>&lt;Stock&gt;();
        
        <span class="hljs-comment">// å¯¹äºæ•°ç»„ï¼Œéœ€è¦æä¾›è‡ªå®šä¹‰åˆ é™¤å™¨</span>
        <span class="hljs-function">std::shared_ptr&lt;Investment&gt; <span class="hljs-title">array</span><span class="hljs-params">(
            <span class="hljs-keyword">new</span> Stock[<span class="hljs-number">3</span>],
            [](Investment* p) { <span class="hljs-keyword">delete</span>[] p; }
        )</span></span>;
    }
}
</code></pre>
<h4 data-id="heading-14"><strong>2. æ ‡å‡†åº“å®¹å™¨ä¼˜å…ˆ</strong></h4>
<p><strong>å®Œå…¨é¿å…æ‰‹åŠ¨å†…å­˜ç®¡ç†ï¼š</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;array&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span>

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_standard_containers</span><span class="hljs-params">()</span> </span>{
    std::cout &lt;&lt; <span class="hljs-string">"=== std::vector æ›¿ä»£åŠ¨æ€æ•°ç»„ ==="</span> &lt;&lt; std::endl;
    {
        <span class="hljs-function">std::vector&lt;Stock&gt; <span class="hljs-title">stocks</span><span class="hljs-params">(<span class="hljs-number">3</span>)</span></span>;  <span class="hljs-comment">// åˆ›å»º3ä¸ªStockå¯¹è±¡</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; stock : stocks) {
            stock.<span class="hljs-built_in">calculate</span>();
        }
        <span class="hljs-comment">// è‡ªåŠ¨ç®¡ç†å†…å­˜ï¼Œæ­£ç¡®è°ƒç”¨æ‰€æœ‰ææ„å‡½æ•°</span>
    }
    
    std::cout &lt;&lt; <span class="hljs-string">"\n=== std::array æ›¿ä»£å›ºå®šå¤§å°æ•°ç»„ ==="</span> &lt;&lt; std::endl;
    {
        std::array&lt;Stock, 5&gt; fixedStocks;  <span class="hljs-comment">// å›ºå®šå¤§å°æ•°ç»„</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; stock : fixedStocks) {
            stock.<span class="hljs-built_in">calculate</span>();
        }
        <span class="hljs-comment">// æ ˆä¸Šåˆ†é…ï¼Œè‡ªåŠ¨ææ„</span>
    }
    
    std::cout &lt;&lt; <span class="hljs-string">"\n=== å¤šæ€å¯¹è±¡ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆå®¹å™¨ ==="</span> &lt;&lt; std::endl;
    {
        std::vector&lt;std::unique_ptr&lt;Investment&gt;&gt; portfolio;
        portfolio.<span class="hljs-built_in">push_back</span>(std::<span class="hljs-built_in">make_unique</span>&lt;Stock&gt;());
        <span class="hljs-comment">// portfolio.push_back(std::make_unique&lt;Bond&gt;());</span>
        
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; investment : portfolio) {
            investment-&gt;<span class="hljs-built_in">calculate</span>();
        }
        <span class="hljs-comment">// è‡ªåŠ¨æ­£ç¡®é‡Šæ”¾æ‰€æœ‰å¯¹è±¡</span>
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-15"><strong>ç‰¹æ®Šåœºæ™¯ä¸é™·é˜±è§„é¿</strong></h3>
<h4 data-id="heading-16"><strong>1. å¤šæ€å¯¹è±¡æ•°ç»„çš„é—®é¢˜</strong></h4>
<p><strong>å¤šæ€æ•°ç»„çš„å±é™©æ€§ï¼š</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Bond</span> : <span class="hljs-keyword">public</span> Investment {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">calculate</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span> </span>{
        std::cout &lt;&lt; <span class="hljs-string">"è®¡ç®—å€ºåˆ¸æ”¶ç›Š"</span> &lt;&lt; std::endl;
    }
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_polymorphic_array_danger</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// å±é™©ï¼šå¤šæ€æ•°ç»„</span>
    Investment* investments = <span class="hljs-keyword">new</span> Stock[<span class="hljs-number">3</span>];
    
    <span class="hljs-comment">// delete[] investments;  // æœªå®šä¹‰è¡Œä¸ºï¼</span>
    <span class="hljs-comment">// é—®é¢˜ï¼š</span>
    <span class="hljs-comment">// 1. é€šè¿‡åŸºç±»æŒ‡é’ˆåˆ é™¤æ´¾ç”Ÿç±»æ•°ç»„</span>
    <span class="hljs-comment">// 2. æ´¾ç”Ÿç±»å¯¹è±¡å¤§å°å¯èƒ½ä¸åŸºç±»ä¸åŒ</span>
    <span class="hljs-comment">// 3. ææ„å‡½æ•°è°ƒç”¨ä¸æ­£ç¡®</span>
    
    <span class="hljs-comment">// æ­£ç¡®åšæ³•ï¼šä½¿ç”¨æŒ‡é’ˆæ•°ç»„</span>
    Investment** safeInvestments = <span class="hljs-keyword">new</span> Investment*[<span class="hljs-number">3</span>];
    safeInvestments[<span class="hljs-number">0</span>] = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Stock</span>();
    safeInvestments[<span class="hljs-number">1</span>] = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Bond</span>();
    safeInvestments[<span class="hljs-number">2</span>] = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Stock</span>();
    
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; ++i) {
        <span class="hljs-keyword">delete</span> safeInvestments[i];  <span class="hljs-comment">// æ­£ç¡®è°ƒç”¨è™šææ„å‡½æ•°</span>
    }
    <span class="hljs-keyword">delete</span>[] safeInvestments;  <span class="hljs-comment">// é‡Šæ”¾æŒ‡é’ˆæ•°ç»„</span>
    
    <span class="hljs-comment">// æ›´å¥½çš„åšæ³•ï¼šä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆå®¹å™¨</span>
    std::vector&lt;std::unique_ptr&lt;Investment&gt;&gt; bestInvestments;
    bestInvestments.<span class="hljs-built_in">push_back</span>(std::<span class="hljs-built_in">make_unique</span>&lt;Stock&gt;());
    bestInvestments.<span class="hljs-built_in">push_back</span>(std::<span class="hljs-built_in">make_unique</span>&lt;Bond&gt;());
}
</code></pre>
<h4 data-id="heading-17"><strong>2. å­—ç¬¦ä¸²å†…å­˜ç®¡ç†</strong></h4>
<p><strong>Cé£æ ¼å­—ç¬¦ä¸²çš„æ­£ç¡®ç®¡ç†ï¼š</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_string_management</span><span class="hljs-params">()</span> </span>{
    std::cout &lt;&lt; <span class="hljs-string">"=== Cé£æ ¼å­—ç¬¦ä¸²æ•°ç»„ ==="</span> &lt;&lt; std::endl;
    
    <span class="hljs-comment">// å­—ç¬¦æ•°ç»„</span>
    <span class="hljs-type">char</span>* str = <span class="hljs-keyword">new</span> <span class="hljs-type">char</span>[<span class="hljs-number">100</span>];
    std::<span class="hljs-built_in">strcpy</span>(str, <span class="hljs-string">"Hello World"</span>);
    std::cout &lt;&lt; <span class="hljs-string">"Cå­—ç¬¦ä¸²: "</span> &lt;&lt; str &lt;&lt; std::endl;
    <span class="hljs-keyword">delete</span>[] str;  <span class="hljs-comment">// å¿…é¡»ä½¿ç”¨delete[]</span>
    
    <span class="hljs-comment">// å­—ç¬¦ä¸²æŒ‡é’ˆæ•°ç»„</span>
    <span class="hljs-type">const</span> <span class="hljs-type">char</span>* <span class="hljs-type">const</span>* strings = <span class="hljs-keyword">new</span> <span class="hljs-type">const</span> <span class="hljs-type">char</span>*[<span class="hljs-number">3</span>] {
        <span class="hljs-string">"Hello"</span>, <span class="hljs-string">"World"</span>, <span class="hljs-string">"!"</span>
    };
    
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; ++i) {
        std::cout &lt;&lt; strings[i] &lt;&lt; <span class="hljs-string">" "</span>;
    }
    std::cout &lt;&lt; std::endl;
    
    <span class="hljs-keyword">delete</span>[] strings;  <span class="hljs-comment">// é‡Šæ”¾æŒ‡é’ˆæ•°ç»„</span>
    
    <span class="hljs-comment">// ç°ä»£C++ï¼šä½¿ç”¨std::stringå’Œstd::vector</span>
    std::vector&lt;std::string&gt; modernStrings = {<span class="hljs-string">"Hello"</span>, <span class="hljs-string">"World"</span>, <span class="hljs-string">"!"</span>};
    <span class="hljs-keyword">for</span> (<span class="hljs-type">const</span> <span class="hljs-keyword">auto</span>&amp; s : modernStrings) {
        std::cout &lt;&lt; s &lt;&lt; <span class="hljs-string">" "</span>;
    }
    std::cout &lt;&lt; std::endl;
}
</code></pre>
<hr/>
<h3 data-id="heading-18"><strong>å®æˆ˜æ¡ˆä¾‹ï¼šå¤æ‚ç³»ç»Ÿçš„å†…å­˜ç®¡ç†</strong></h3>
<h4 data-id="heading-19"><strong>æ¡ˆä¾‹1ï¼šå›¾å½¢ç³»ç»Ÿèµ„æºç®¡ç†</strong></h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Texture</span> {
<span class="hljs-keyword">private</span>:
    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> textureId;
    <span class="hljs-type">int</span> width, height;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">Texture</span>(<span class="hljs-type">int</span> w, <span class="hljs-type">int</span> h) : <span class="hljs-built_in">width</span>(w), <span class="hljs-built_in">height</span>(h) {
        <span class="hljs-comment">// æ¨¡æ‹ŸOpenGLçº¹ç†åˆ›å»º</span>
        textureId = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>&gt;(w * h); <span class="hljs-comment">// æ¨¡æ‹ŸIDç”Ÿæˆ</span>
        std::cout &lt;&lt; <span class="hljs-string">"åˆ›å»ºçº¹ç† "</span> &lt;&lt; textureId &lt;&lt; <span class="hljs-string">" ("</span> &lt;&lt; w &lt;&lt; <span class="hljs-string">"x"</span> &lt;&lt; h &lt;&lt; <span class="hljs-string">")"</span> &lt;&lt; std::endl;
    }
    
    ~<span class="hljs-built_in">Texture</span>() {
        std::cout &lt;&lt; <span class="hljs-string">"é”€æ¯çº¹ç† "</span> &lt;&lt; textureId &lt;&lt; std::endl;
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">bind</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
        std::cout &lt;&lt; <span class="hljs-string">"ç»‘å®šçº¹ç† "</span> &lt;&lt; textureId &lt;&lt; std::endl;
    }
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">TextureManager</span> {
<span class="hljs-keyword">private</span>:
    <span class="hljs-comment">// ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆç®¡ç†å•ä¸ªçº¹ç†</span>
    std::vector&lt;std::unique_ptr&lt;Texture&gt;&gt; textures;
    
    <span class="hljs-comment">// çº¹ç†æ•°ç»„çš„ä¸“é—¨ç®¡ç†</span>
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">TextureArray</span> {
    <span class="hljs-keyword">private</span>:
        std::unique_ptr&lt;Texture[]&gt; array;
        <span class="hljs-type">size_t</span> count;
        
    <span class="hljs-keyword">public</span>:
        <span class="hljs-built_in">TextureArray</span>(<span class="hljs-type">size_t</span> n) : <span class="hljs-built_in">array</span>(<span class="hljs-keyword">new</span> Texture[n]), <span class="hljs-built_in">count</span>(n) {
            std::cout &lt;&lt; <span class="hljs-string">"åˆ›å»ºçº¹ç†æ•°ç»„ï¼Œå¤§å°: "</span> &lt;&lt; n &lt;&lt; std::endl;
        }
        
        <span class="hljs-comment">// è‡ªåŠ¨è°ƒç”¨delete[]</span>
        ~<span class="hljs-built_in">TextureArray</span>() = <span class="hljs-keyword">default</span>;
        
        Texture&amp; <span class="hljs-keyword">operator</span>[](<span class="hljs-type">size_t</span> index) {
            <span class="hljs-keyword">return</span> array[index];
        }
        
        <span class="hljs-function"><span class="hljs-type">size_t</span> <span class="hljs-title">size</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{ <span class="hljs-keyword">return</span> count; }
    };
    
    std::vector&lt;std::unique_ptr&lt;TextureArray&gt;&gt; textureArrays;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// æ·»åŠ å•ä¸ªçº¹ç†</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">addTexture</span><span class="hljs-params">(<span class="hljs-type">int</span> width, <span class="hljs-type">int</span> height)</span> </span>{
        textures.<span class="hljs-built_in">push_back</span>(std::<span class="hljs-built_in">make_unique</span>&lt;Texture&gt;(width, height));
    }
    
    <span class="hljs-comment">// æ·»åŠ çº¹ç†æ•°ç»„</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">addTextureArray</span><span class="hljs-params">(<span class="hljs-type">size_t</span> count, <span class="hljs-type">int</span> width, <span class="hljs-type">int</span> height)</span> </span>{
        <span class="hljs-keyword">auto</span> array = std::<span class="hljs-built_in">make_unique</span>&lt;TextureArray&gt;(count);
        textureArrays.<span class="hljs-built_in">push_back</span>(std::<span class="hljs-built_in">move</span>(array));
    }
    
    <span class="hljs-comment">// ä½¿ç”¨æ‰€æœ‰çº¹ç†</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">useAllTextures</span><span class="hljs-params">()</span> </span>{
        std::cout &lt;&lt; <span class="hljs-string">"=== ä½¿ç”¨å•ä¸ªçº¹ç† ==="</span> &lt;&lt; std::endl;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; texture : textures) {
            texture-&gt;<span class="hljs-built_in">bind</span>();
        }
        
        std::cout &lt;&lt; <span class="hljs-string">"=== ä½¿ç”¨çº¹ç†æ•°ç»„ ==="</span> &lt;&lt; std::endl;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; array : textureArrays) {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; array-&gt;<span class="hljs-built_in">size</span>(); ++i) {
                (*array)[i].<span class="hljs-built_in">bind</span>();
            }
        }
    }
    
    <span class="hljs-comment">// è‡ªåŠ¨æ­£ç¡®é‡Šæ”¾æ‰€æœ‰èµ„æº</span>
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_graphics_resource_management</span><span class="hljs-params">()</span> </span>{
    TextureManager manager;
    
    <span class="hljs-comment">// æ·»åŠ å•ä¸ªçº¹ç†</span>
    manager.<span class="hljs-built_in">addTexture</span>(<span class="hljs-number">256</span>, <span class="hljs-number">256</span>);
    manager.<span class="hljs-built_in">addTexture</span>(<span class="hljs-number">512</span>, <span class="hljs-number">512</span>);
    
    <span class="hljs-comment">// æ·»åŠ çº¹ç†æ•°ç»„</span>
    manager.<span class="hljs-built_in">addTextureArray</span>(<span class="hljs-number">3</span>, <span class="hljs-number">128</span>, <span class="hljs-number">128</span>);
    manager.<span class="hljs-built_in">addTextureArray</span>(<span class="hljs-number">5</span>, <span class="hljs-number">64</span>, <span class="hljs-number">64</span>);
    
    manager.<span class="hljs-built_in">useAllTextures</span>();
    
    std::cout &lt;&lt; <span class="hljs-string">"TextureManagerç¦»å¼€ä½œç”¨åŸŸï¼Œè‡ªåŠ¨é‡Šæ”¾æ‰€æœ‰èµ„æº..."</span> &lt;&lt; std::endl;
}
</code></pre>
<h4 data-id="heading-20"><strong>æ¡ˆä¾‹2ï¼šæ•°æ®åº“è¿æ¥æ± </strong></h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;array&gt;</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabaseConnection</span> {
<span class="hljs-keyword">private</span>:
    std::string connectionString;
    <span class="hljs-type">bool</span> connected;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">DatabaseConnection</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; connStr)</span> 
        : connectionString(connStr), connected(false) {</span>
        <span class="hljs-built_in">connect</span>();
    }
    
    ~<span class="hljs-built_in">DatabaseConnection</span>() {
        <span class="hljs-built_in">disconnect</span>();
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">connect</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">if</span> (!connected) {
            connected = <span class="hljs-literal">true</span>;
            std::cout &lt;&lt; <span class="hljs-string">"è¿æ¥æ•°æ®åº“: "</span> &lt;&lt; connectionString &lt;&lt; std::endl;
        }
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">disconnect</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">if</span> (connected) {
            connected = <span class="hljs-literal">false</span>;
            std::cout &lt;&lt; <span class="hljs-string">"æ–­å¼€æ•°æ®åº“è¿æ¥: "</span> &lt;&lt; connectionString &lt;&lt; std::endl;
        }
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">execute</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; query)</span> </span>{
        <span class="hljs-keyword">if</span> (connected) {
            std::cout &lt;&lt; <span class="hljs-string">"æ‰§è¡ŒæŸ¥è¯¢: "</span> &lt;&lt; query &lt;&lt; <span class="hljs-string">" on "</span> &lt;&lt; connectionString &lt;&lt; std::endl;
        }
    }
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ConnectionPool</span> {
<span class="hljs-keyword">private</span>:
    <span class="hljs-comment">// å›ºå®šå¤§å°è¿æ¥æ±  - ä½¿ç”¨std::array</span>
    <span class="hljs-type">static</span> <span class="hljs-keyword">constexpr</span> <span class="hljs-type">size_t</span> POOL_SIZE = <span class="hljs-number">5</span>;
    std::array&lt;std::unique_ptr&lt;DatabaseConnection&gt;, POOL_SIZE&gt; connections;
    
    <span class="hljs-comment">// åŠ¨æ€æ‰©å±•è¿æ¥ - ä½¿ç”¨std::vector</span>
    std::vector&lt;std::unique_ptr&lt;DatabaseConnection&gt;&gt; extraConnections;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">ConnectionPool</span>() {
        <span class="hljs-comment">// åˆå§‹åŒ–å›ºå®šè¿æ¥æ± </span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; POOL_SIZE; ++i) {
            connections[i] = std::<span class="hljs-built_in">make_unique</span>&lt;DatabaseConnection&gt;(
                <span class="hljs-string">"Server=DB"</span> + std::<span class="hljs-built_in">to_string</span>(i) + <span class="hljs-string">";Database=App"</span>
            );
        }
        std::cout &lt;&lt; <span class="hljs-string">"åˆå§‹åŒ–è¿æ¥æ± ï¼Œå¤§å°: "</span> &lt;&lt; POOL_SIZE &lt;&lt; std::endl;
    }
    
    <span class="hljs-comment">// è·å–å›ºå®šè¿æ¥æ± ä¸­çš„è¿æ¥</span>
    <span class="hljs-function">DatabaseConnection* <span class="hljs-title">getConnection</span><span class="hljs-params">(<span class="hljs-type">size_t</span> index)</span> </span>{
        <span class="hljs-keyword">if</span> (index &lt; POOL_SIZE) {
            <span class="hljs-keyword">return</span> connections[index].<span class="hljs-built_in">get</span>();
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;
    }
    
    <span class="hljs-comment">// åˆ›å»ºæ–°çš„åŠ¨æ€è¿æ¥</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">createExtraConnection</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; connStr)</span> </span>{
        extraConnections.<span class="hljs-built_in">push_back</span>(
            std::<span class="hljs-built_in">make_unique</span>&lt;DatabaseConnection&gt;(connStr)
        );
    }
    
    <span class="hljs-comment">// ä½¿ç”¨æ‰€æœ‰è¿æ¥</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">useAllConnections</span><span class="hljs-params">()</span> </span>{
        std::cout &lt;&lt; <span class="hljs-string">"=== ä½¿ç”¨å›ºå®šè¿æ¥æ±  ==="</span> &lt;&lt; std::endl;
        <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; POOL_SIZE; ++i) {
            connections[i]-&gt;<span class="hljs-built_in">execute</span>(<span class="hljs-string">"SELECT * FROM users"</span>);
        }
        
        std::cout &lt;&lt; <span class="hljs-string">"=== ä½¿ç”¨åŠ¨æ€è¿æ¥ ==="</span> &lt;&lt; std::endl;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; conn : extraConnections) {
            conn-&gt;<span class="hljs-built_in">execute</span>(<span class="hljs-string">"UPDATE stats SET value = 1"</span>);
        }
    }
    
    <span class="hljs-comment">// è‡ªåŠ¨æ­£ç¡®é‡Šæ”¾æ‰€æœ‰è¿æ¥</span>
    ~<span class="hljs-built_in">ConnectionPool</span>() {
        std::cout &lt;&lt; <span class="hljs-string">"è¿æ¥æ± é”€æ¯ï¼Œè‡ªåŠ¨é‡Šæ”¾æ‰€æœ‰è¿æ¥..."</span> &lt;&lt; std::endl;
    }
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_connection_pool_management</span><span class="hljs-params">()</span> </span>{
    ConnectionPool pool;
    
    <span class="hljs-comment">// ä½¿ç”¨å›ºå®šè¿æ¥</span>
    <span class="hljs-keyword">auto</span>* conn1 = pool.<span class="hljs-built_in">getConnection</span>(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">auto</span>* conn2 = pool.<span class="hljs-built_in">getConnection</span>(<span class="hljs-number">1</span>);
    
    <span class="hljs-keyword">if</span> (conn1 &amp;&amp; conn2) {
        conn1-&gt;<span class="hljs-built_in">execute</span>(<span class="hljs-string">"BEGIN TRANSACTION"</span>);
        conn2-&gt;<span class="hljs-built_in">execute</span>(<span class="hljs-string">"COMMIT"</span>);
    }
    
    <span class="hljs-comment">// æ·»åŠ åŠ¨æ€è¿æ¥</span>
    pool.<span class="hljs-built_in">createExtraConnection</span>(<span class="hljs-string">"Server=EXTRA;Database=Backup"</span>);
    pool.<span class="hljs-built_in">createExtraConnection</span>(<span class="hljs-string">"Server=ANALYTICS;Database=Reports"</span>);
    
    pool.<span class="hljs-built_in">useAllConnections</span>();
    
    std::cout &lt;&lt; <span class="hljs-string">"ConnectionPoolç¦»å¼€ä½œç”¨åŸŸ..."</span> &lt;&lt; std::endl;
}
</code></pre>
<hr/>
<h3 data-id="heading-21"><strong>è°ƒè¯•ä¸æ£€æµ‹æŠ€æœ¯</strong></h3>
<h4 data-id="heading-22"><strong>1. å†…å­˜æ£€æµ‹å·¥å…·ä½¿ç”¨</strong></h4>
<p><strong>Valgrindæ£€æµ‹ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_memory_debugging</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// è¿™äº›é”™è¯¯ä¼šåœ¨Valgrind/Memcheckä¸­è¢«æ£€æµ‹åˆ°</span>
    
    <span class="hljs-comment">// é”™è¯¯1ï¼šnew[] é… delete</span>
    <span class="hljs-type">int</span>* array1 = <span class="hljs-keyword">new</span> <span class="hljs-type">int</span>[<span class="hljs-number">10</span>];
    <span class="hljs-comment">// delete array1;  // Valgrindä¼šæŠ¥å‘Šï¼šmismatched free() / delete / delete[]</span>
    
    <span class="hljs-comment">// é”™è¯¯2ï¼šå†…å­˜æ³„æ¼</span>
    <span class="hljs-type">int</span>* leaked = <span class="hljs-keyword">new</span> <span class="hljs-type">int</span>[<span class="hljs-number">100</span>];
    <span class="hljs-comment">// å¿˜è®°delete[] leaked</span>
    
    <span class="hljs-comment">// é”™è¯¯3ï¼šé‡å¤é‡Šæ”¾</span>
    <span class="hljs-type">int</span>* doubleFree = <span class="hljs-keyword">new</span> <span class="hljs-type">int</span>;
    <span class="hljs-keyword">delete</span> doubleFree;
    <span class="hljs-comment">// delete doubleFree;  // Valgrindä¼šæŠ¥å‘Šï¼šinvalid free()</span>
    
    <span class="hljs-comment">// æ­£ç¡®é‡Šæ”¾</span>
    <span class="hljs-keyword">delete</span>[] array1;
    <span class="hljs-comment">// delete[] leaked;  // ä¿®å¤æ³„æ¼</span>
    <span class="hljs-comment">// ç¬¬äºŒä¸ªdeleteæ³¨é‡Šæ‰</span>
}
</code></pre>
<h4 data-id="heading-23"><strong>2. ç¼–è¯‘å™¨è¯Šæ–­é€‰é¡¹</strong></h4>
<p><strong>åˆ©ç”¨ç¼–è¯‘å™¨è­¦å‘Šï¼š</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// ç¼–è¯‘æ—¶ä½¿ç”¨è¿™äº›é€‰é¡¹æ£€æµ‹é—®é¢˜ï¼š</span>
<span class="hljs-comment">// g++ -Wall -Wextra -Werror main.cpp</span>
<span class="hljs-comment">// clang++ -Weverything -Werror main.cpp</span>
<span class="hljs-comment">// MSVC /W4 /WX</span>

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_compiler_warnings</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// æŸäº›ç¼–è¯‘å™¨å¯ä»¥æ£€æµ‹åˆ°æ˜æ˜¾çš„ç±»å‹ä¸åŒ¹é…</span>
    <span class="hljs-type">int</span>* single = <span class="hljs-keyword">new</span> <span class="hljs-type">int</span>;
    
    <span class="hljs-comment">// delete[] single;  // æŸäº›ç¼–è¯‘å™¨ä¼šè­¦å‘Šï¼šä¸åŒ¹é…çš„åˆ é™¤å½¢å¼</span>
    
    <span class="hljs-keyword">delete</span> single;  <span class="hljs-comment">// æ­£ç¡®</span>
}
</code></pre>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Androidè¾“å…¥æ³•æ¡†æ¶çš„Binderé€šä¿¡æœºåˆ¶å‰–æ]]></title>    <link>https://juejin.cn/post/7570897638440894491</link>    <guid>https://juejin.cn/post/7570897638440894491</guid>    <pubDate>2025-11-10T13:22:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570897638440894491" data-draft-id="7570897638440878107" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Androidè¾“å…¥æ³•æ¡†æ¶çš„Binderé€šä¿¡æœºåˆ¶å‰–æ"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-11-10T13:22:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="WAsbry"/> <meta itemprop="url" content="https://juejin.cn/user/3413335797139511"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Androidè¾“å…¥æ³•æ¡†æ¶çš„Binderé€šä¿¡æœºåˆ¶å‰–æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3413335797139511/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    WAsbry
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T13:22:56.000Z" title="Mon Nov 10 2025 13:22:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Androidè¾“å…¥æ³•æ¡†æ¶çš„Binderé€šä¿¡æœºåˆ¶å‰–æ</h2>
<h3 data-id="heading-1">é—®é¢˜èƒŒæ™¯</h3>
<ul>
<li>
<p>ç»ˆç«¯è®¾å¤‡ï¼šç”¨æˆ·æ“ä½œï¼š</p>
<ol>
<li>è¾“å…¥æ•°å­— "123456"</li>
<li>åˆ‡æ¢åˆ°å­—æ¯é”®ç›˜ï¼ˆç™¾åº¦/æœç‹—è¾“å…¥æ³•ï¼‰</li>
<li>è¿ç»­ç‚¹å‡»å­—æ¯ 'q'</li>
</ol>
</li>
<li>
<p>å¼‚å¸¸ç»“æœï¼š
ç‚¹å‡»ç¬¬1æ¬¡ 'q': "123456" (ä¸å˜)
ç‚¹å‡»ç¬¬2æ¬¡ 'q': "12345"  (åˆ é™¤1ä½)
ç‚¹å‡»ç¬¬3æ¬¡ 'q': "123"    (åˆ é™¤2ä½)
ç‚¹å‡»ç¬¬4æ¬¡ 'q': ""       (å…¨éƒ¨åˆ é™¤)</p>
</li>
</ul>
<blockquote>
<p>å¾ˆå¥‡å¦™ï¼Œå°ç±³æ‰‹æœºæ˜¯æ²¡æœ‰è¿™äº›é—®é¢˜çš„ï¼Œæ— è®ºæ˜¯è‡ªå¸¦çš„è¾“å…¥æ³•è¿˜æ˜¯å®‰è£…çš„ç™¾åº¦è¾“å…¥æ³•å‡æ²¡æœ‰æ­¤é—®é¢˜</p>
</blockquote>
<p><strong>ä»¥Android 10 æºç è¿›è¡Œåˆ†æ</strong></p>
<h3 data-id="heading-2">ğŸ’¡ æœ¬æ–‡ç²¾å</h3>
<ul>
<li><strong>ç°è±¡</strong>ï¼šEditTextè®¾ç½®<code>inputType="number"</code>åï¼Œåˆ‡æ¢å­—æ¯é”®ç›˜è¾“å…¥å­—æ¯å¯¼è‡´æ•°å­—å†…å®¹è¢«åˆ é™¤</li>
<li><strong>æœ¬è´¨</strong>ï¼šè¾“å…¥æ³•ä¸åº”ç”¨æ˜¯ä¸¤ä¸ªç‹¬ç«‹è¿›ç¨‹ï¼Œé€šè¿‡Binder IPCé€šä¿¡ï¼Œå­˜åœ¨å¤©ç„¶çš„ä¿¡æ¯ä¸å¯¹ç§°</li>
<li><strong>æ ¸å¿ƒæœºåˆ¶</strong>ï¼šAIDLæ¥å£å®šä¹‰ â†’ Stub/Proxyè‡ªåŠ¨ç”Ÿæˆ â†’ Binderé©±åŠ¨è·¨è¿›ç¨‹ä¼ è¾“ â†’ Handlerçº¿ç¨‹åˆ‡æ¢</li>
<li><strong>å…³é”®æ´å¯Ÿ</strong>ï¼šå¼‚æ­¥é€šä¿¡å¯¼è‡´è¾“å…¥æ³•æ— æ³•è·çŸ¥æ–‡æœ¬æ“ä½œçš„å®é™…æ‰§è¡Œç»“æœï¼Œå¼•å‘åç»­ä¸€ç³»åˆ—é—®é¢˜</li>
<li><strong>ä»·å€¼</strong>ï¼šç†è§£Androidè¾“å…¥æ³•æ¶æ„ï¼Œä¸ºåç»­ä¸¤ç¯‡æ–‡ç« ï¼ˆè®¾è®¡ç¼ºé™·ã€å·¥ç¨‹å®è·µï¼‰å¥ å®šåŸºç¡€</li>
</ul>
<hr/>
<h3 data-id="heading-3">ä¸€ã€é—®é¢˜ç°è±¡ï¼šä¸€ä¸ª"ä¸åº”è¯¥å­˜åœ¨"çš„Bug</h3>
<h4 data-id="heading-4">1.1 å¤ç°æ­¥éª¤</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- activity_main.xml --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">EditText</span>
    <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/edit_number"</span>
    <span class="hljs-attr">android:inputType</span>=<span class="hljs-string">"number"</span>
    <span class="hljs-attr">android:hint</span>=<span class="hljs-string">"è¯·è¾“å…¥æ•°å­—"</span> /&gt;</span>
</code></pre>
<pre><code class="hljs language-arduino" lang="arduino">ç”¨æˆ·æ“ä½œï¼š
<span class="hljs-number">1.</span> è¾“å…¥æ•°å­— <span class="hljs-string">"123456"</span>
<span class="hljs-number">2.</span> åˆ‡æ¢åˆ°å­—æ¯é”®ç›˜ï¼ˆç™¾åº¦/æœç‹—è¾“å…¥æ³•ï¼‰
<span class="hljs-number">3.</span> è¿ç»­ç‚¹å‡»å­—æ¯ <span class="hljs-string">'q'</span>

å¼‚å¸¸ç»“æœï¼š
ç‚¹å‡»ç¬¬<span class="hljs-number">1</span>æ¬¡ <span class="hljs-string">'q'</span>: <span class="hljs-string">"123456"</span> (ä¸å˜)
ç‚¹å‡»ç¬¬<span class="hljs-number">2</span>æ¬¡ <span class="hljs-string">'q'</span>: <span class="hljs-string">"12345"</span>  (åˆ é™¤<span class="hljs-number">1</span>ä½)
ç‚¹å‡»ç¬¬<span class="hljs-number">3</span>æ¬¡ <span class="hljs-string">'q'</span>: <span class="hljs-string">"123"</span>    (åˆ é™¤<span class="hljs-number">2</span>ä½)
ç‚¹å‡»ç¬¬<span class="hljs-number">4</span>æ¬¡ <span class="hljs-string">'q'</span>: <span class="hljs-string">""</span>       (å…¨éƒ¨åˆ é™¤)
</code></pre>
<h4 data-id="heading-5">1.2 ç¬¬ä¸€ç›´è§‰çš„å›°æƒ‘</h4>
<ul>
<li><strong>InputFilterå·²ç”Ÿæ•ˆ</strong>ï¼šDigitsKeyListeneræ‹’ç»äº†å­—æ¯æ’å…¥</li>
<li><strong>æ—¥å¿—æ˜¾ç¤ºæ­£å¸¸</strong>ï¼šinsert("q")ç¡®å®è¢«æ‹’ç»</li>
<li><strong>ä½†æ•°å­—å´ä¸¢å¤±äº†</strong>ï¼šä¸ºä»€ä¹ˆåˆæ³•å†…å®¹è¢«åˆ é™¤ï¼Ÿ</li>
</ul>
<p>è¿™ä¸æ˜¯åº”ç”¨å±‚Bugï¼Œè€Œæ˜¯<strong>è·¨è¿›ç¨‹é€šä¿¡æœºåˆ¶å¯¼è‡´çš„ç³»ç»Ÿçº§é—®é¢˜</strong>ã€‚</p>
<hr/>
<h3 data-id="heading-6">äºŒã€è¾“å…¥æ³•æ¡†æ¶çš„ä¸‰è¿›ç¨‹æ¶æ„</h3>
<h4 data-id="heading-7">2.1 ä¸ºä»€ä¹ˆè¾“å…¥æ³•è¦ç‹¬ç«‹è¿›ç¨‹ï¼Ÿ</h4>
<pre><code class="hljs language-scss" lang="scss">å‡è®¾æ²¡æœ‰è¿›ç¨‹éš”ç¦»ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åº”ç”¨è¿›ç¨‹                            â”‚
â”‚  â”œâ”€ EditText (å¯†ç : "MyPassword")   â”‚
â”‚  â””â”€ è¾“å…¥æ³•ä»£ç  (ç›´æ¥è¿è¡Œåœ¨åº”ç”¨å†…)     â”‚
â”‚       â†“                             â”‚
â”‚    æ¶æ„è¾“å…¥æ³•å¯ä»¥ï¼š                  â”‚
â”‚    - è¯»å– EditText<span class="hljs-selector-class">.getText</span>()        â”‚
â”‚    - è®¿é—® Activity<span class="hljs-selector-class">.findViewById</span>()   â”‚
â”‚    - çªƒå–åº”ç”¨å†…å­˜æ•°æ®                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>å®‰å…¨é£é™©</strong>ï¼šè¾“å…¥æ³•æ˜¯ç¬¬ä¸‰æ–¹åº”ç”¨ï¼Œä¸èƒ½ä¿¡ä»»ã€‚</p>
<h4 data-id="heading-8">2.2 å®é™…çš„ä¸‰å±‚æ¶æ„</h4>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               åº”ç”¨è¿›ç¨‹ (com.example.app)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ EditText                                           â”‚ â”‚
â”‚  â”‚   â””â”€ InputConnection (BaseInputConnection)        â”‚ â”‚
â”‚  â”‚        - Binder Stub (IInputConnectionWrapper)    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†• Binder IPC
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ç³»ç»ŸæœåŠ¡è¿›ç¨‹ (system_server)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ InputMethodManagerService (IMMS)                   â”‚ â”‚
â”‚  â”‚   - ç®¡ç†è¾“å…¥æ³•ç”Ÿå‘½å‘¨æœŸ                               â”‚ â”‚
â”‚  â”‚   - è½¬å‘Binderè°ƒç”¨                                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†• Binder IPC
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            è¾“å…¥æ³•è¿›ç¨‹ (com.baidu.input)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ InputMethodService                                 â”‚ â”‚
â”‚  â”‚   â””â”€ InputConnection (Binder Proxy)               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>æ ¸å¿ƒè¦ç‚¹</strong>ï¼š</p>
<ol>
<li><strong>è¿›ç¨‹éš”ç¦»</strong>ï¼šè¾“å…¥æ³•æ— æ³•ç›´æ¥è®¿é—®åº”ç”¨å†…å­˜</li>
<li><strong>å”¯ä¸€é€šé“</strong>ï¼šInputConnectionæ˜¯ä¸¤è€…é€šä¿¡çš„å”¯ä¸€æ¡¥æ¢</li>
<li><strong>æƒé™å—é™</strong>ï¼šInputConnectionæ¥å£åªæš´éœ²æ–‡æœ¬ç¼–è¾‘æ–¹æ³•ï¼Œä¸æš´éœ²UIè®¿é—®</li>
</ol>
<hr/>
<h3 data-id="heading-9">ä¸‰ã€InputConnectionçš„Binderå®ç°</h3>
<h4 data-id="heading-10">3.1 AIDLæ¥å£å®šä¹‰</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// IInputContext.aidl (ç³»ç»Ÿå†…éƒ¨æ¥å£)</span>
<span class="hljs-keyword">package</span> com.android.internal.view;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">IInputContext</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">setComposingText</span><span class="hljs-params">(CharSequence text, <span class="hljs-type">int</span> newCursorPosition)</span>;
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">commitText</span><span class="hljs-params">(CharSequence text, <span class="hljs-type">int</span> newCursorPosition)</span>;
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteSurroundingText</span><span class="hljs-params">(<span class="hljs-type">int</span> beforeLength, <span class="hljs-type">int</span> afterLength)</span>;

    CharSequence <span class="hljs-title function_">getTextBeforeCursor</span><span class="hljs-params">(<span class="hljs-type">int</span> length, <span class="hljs-type">int</span> flags)</span>;
    CharSequence <span class="hljs-title function_">getTextAfterCursor</span><span class="hljs-params">(<span class="hljs-type">int</span> length, <span class="hljs-type">int</span> flags)</span>;
    <span class="hljs-comment">// ... æ›´å¤šæ–¹æ³•</span>
}
</code></pre>
<p><strong>AIDLçš„ä½œç”¨</strong>ï¼š</p>
<ul>
<li>å®šä¹‰è·¨è¿›ç¨‹æ¥å£</li>
<li>ç¼–è¯‘åè‡ªåŠ¨ç”ŸæˆStubï¼ˆæœåŠ¡ç«¯ï¼‰å’ŒProxyï¼ˆå®¢æˆ·ç«¯ï¼‰</li>
</ul>
<h4 data-id="heading-11">3.2 åº”ç”¨è¿›ç¨‹ï¼šBinder Stub</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// IInputConnectionWrapper.java (åº”ç”¨è¿›ç¨‹)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">IInputConnectionWrapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">IInputContext</span>.Stub {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> InputConnection mInputConnection; <span class="hljs-comment">// BaseInputConnection</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Handler mH;                      <span class="hljs-comment">// ä¸»çº¿ç¨‹Handler</span>

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setComposingText</span><span class="hljs-params">(CharSequence text, <span class="hljs-type">int</span> newCursorPosition)</span> {
        <span class="hljs-comment">// å½“å‰çº¿ç¨‹ï¼šBinderçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ï¼ˆå¦‚ Binder:12345_3ï¼‰</span>

        <span class="hljs-comment">// å‘é€åˆ°ä¸»çº¿ç¨‹æ‰§è¡Œ</span>
        mH.post(() -&gt; {
            <span class="hljs-comment">// ä¸»çº¿ç¨‹æ‰§è¡Œ</span>
            mInputConnection.setComposingText(text, newCursorPosition);
        });

        <span class="hljs-comment">// ç«‹å³è¿”å›ï¼Œä¸ç­‰å¾…æ‰§è¡Œå®Œæˆï¼</span>
    }
}
</code></pre>
<p><strong>å…³é”®ç‚¹1</strong>ï¼šçº¿ç¨‹åˆ‡æ¢</p>
<ul>
<li>Binderè°ƒç”¨å‘ç”Ÿåœ¨Binderçº¿ç¨‹ï¼ˆéä¸»çº¿ç¨‹ï¼‰</li>
<li>EditTextæ“ä½œå¿…é¡»åœ¨ä¸»çº¿ç¨‹ï¼ˆViewRootImplæ£€æŸ¥ï¼‰</li>
<li>é€šè¿‡Handler.poståˆ‡æ¢çº¿ç¨‹</li>
</ul>
<p><strong>å…³é”®ç‚¹2</strong>ï¼šå¼‚æ­¥æ‰§è¡Œ</p>
<ul>
<li><code>post()</code>åç«‹å³è¿”å›ï¼Œä¸é˜»å¡Binderçº¿ç¨‹</li>
<li>è¾“å…¥æ³•è®¤ä¸ºè°ƒç”¨"æˆåŠŸ"ï¼Œä½†å®é™…å°šæœªæ‰§è¡Œ</li>
<li>è¿™æ˜¯åç»­Bugçš„æ ¹æºä¹‹ä¸€</li>
</ul>
<h4 data-id="heading-12">3.3 è¾“å…¥æ³•è¿›ç¨‹ï¼šBinder Proxy</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è¾“å…¥æ³•è¿›ç¨‹ä¸­çš„ä»£ç†å¯¹è±¡</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">InputConnectionProxy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InputConnection</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> IInputContext mIInputContext; <span class="hljs-comment">// Binderä»£ç†</span>

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">setComposingText</span><span class="hljs-params">(CharSequence text, <span class="hljs-type">int</span> newCursorPosition)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// çœ‹ä¼¼æœ¬åœ°è°ƒç”¨ï¼Œå®é™…è·¨è¿›ç¨‹</span>
            mIInputContext.setComposingText(text, newCursorPosition);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        } <span class="hljs-keyword">catch</span> (RemoteException e) {
            <span class="hljs-comment">// åº”ç”¨è¿›ç¨‹å´©æºƒæˆ–è¿æ¥æ–­å¼€</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
    }
}
</code></pre>
<p><strong>å…³é”®ç‚¹</strong>ï¼šé€æ˜çš„è·¨è¿›ç¨‹</p>
<ul>
<li>è¾“å…¥æ³•è°ƒç”¨æœ¬åœ°æ–¹æ³•</li>
<li>Binderé©±åŠ¨è‡ªåŠ¨è½¬å‘åˆ°åº”ç”¨è¿›ç¨‹</li>
<li>è¿”å›å€¼åªè¡¨ç¤º"Binderè°ƒç”¨æˆåŠŸ"ï¼Œä¸è¡¨ç¤º"æ–‡æœ¬æ“ä½œæˆåŠŸ"</li>
</ul>
<hr/>
<h3 data-id="heading-13">å››ã€å®Œæ•´çš„Binderè°ƒç”¨é“¾è·¯</h3>
<h4 data-id="heading-14">4.1 è¯¦ç»†æ—¶åºå›¾</h4>
<p>ç”¨æˆ·ç‚¹å‡»å­—æ¯'q'çš„å®Œæ•´æµç¨‹ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">è¾“å…¥æ³•è¿›ç¨‹                Binderé©±åŠ¨           åº”ç”¨è¿›ç¨‹
(Baidu IME)                                   (Your App)
     â”‚                                            â”‚
     â”‚ <span class="hljs-number">1</span>. <span class="hljs-built_in">onKeyClick</span>('q')                         â”‚
     â”‚    â†“                                       â”‚
     â”‚ <span class="hljs-number">2</span>. <span class="hljs-built_in">getCurrentInputConnection</span>()             â”‚
     â”‚    â†’ InputConnectionProxy                  â”‚
     â”‚    â†“                                       â”‚
     â”‚ <span class="hljs-number">3</span>. proxy<span class="hljs-selector-class">.setComposingText</span>("q", <span class="hljs-number">1</span>)          â”‚
     â”‚    â†“                                       â”‚
     â”‚ <span class="hljs-number">4</span>. Parcel<span class="hljs-selector-class">.obtain</span>()                         â”‚
     â”‚    å†™å…¥å‚æ•°åˆ°Parcel                         â”‚
     â”‚    â†“                                       â”‚
     â”‚ <span class="hljs-number">5</span>. mRemote<span class="hljs-selector-class">.transact</span>()                      â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ Binderé©±åŠ¨                   â”‚
     â”‚               â”œâ”€ æ‹·è´æ•°æ®åˆ°å†…æ ¸ç¼“å†²åŒº        â”‚
     â”‚               â”œâ”€ æŸ¥æ‰¾ç›®æ ‡è¿›ç¨‹ (PID)         â”‚
     â”‚               â”œâ”€ å”¤é†’Binderçº¿ç¨‹             â”‚
     â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ Binderçº¿ç¨‹æ±      â”‚
     â”‚                              â†“             â”‚
     â”‚                          <span class="hljs-number">6</span>. <span class="hljs-built_in">onTransact</span>()   â”‚
     â”‚                              â†“             â”‚
     â”‚                          <span class="hljs-number">7</span>. è§£æParcel     â”‚
     â”‚                              â†“             â”‚
     â”‚                          <span class="hljs-number">8</span>. Handler<span class="hljs-selector-class">.post</span>() â”‚
     â”‚                              â†“             â”‚
     â”‚                          è¿”å›æˆåŠŸ           â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
     â”‚                                            â”‚
     â”‚ <span class="hljs-number">9</span>. è¾“å…¥æ³•è®¤ä¸ºè°ƒç”¨æˆåŠŸ                        â”‚
     â”‚    ç»§ç»­æ‰§è¡Œåç»­é€»è¾‘                          â”‚
     â”‚                                            â”‚
     â”‚                              æ¶ˆæ¯é˜Ÿåˆ—       â”‚
     â”‚                              â†“             â”‚
     â”‚                          <span class="hljs-number">10</span>. ä¸»çº¿ç¨‹         â”‚
     â”‚                              Handler<span class="hljs-selector-class">.handleMessage</span>()
     â”‚                              â†“             â”‚
     â”‚                          <span class="hljs-number">11</span>. BaseInputConnection
     â”‚                              <span class="hljs-selector-class">.setComposingText</span>()
     â”‚                              â†“             â”‚
     â”‚                          <span class="hljs-number">12</span>. <span class="hljs-built_in">replaceText</span>() â”‚
     â”‚                              â†“             â”‚
     â”‚                          <span class="hljs-number">13</span>. Editableæ“ä½œ  â”‚
     â”‚                              â†“             â”‚
     â”‚                          <span class="hljs-number">14</span>. UIåˆ·æ–°        â”‚
</code></pre>
<h4 data-id="heading-15">4.2 Binder transactçš„å®ç°</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Proxyç«¯ï¼ˆè¾“å…¥æ³•è¿›ç¨‹ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setComposingText</span><span class="hljs-params">(CharSequence text, <span class="hljs-type">int</span> newCursorPosition)</span> {
    <span class="hljs-type">Parcel</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> Parcel.obtain();   <span class="hljs-comment">// æ•°æ®åŒ…</span>
    <span class="hljs-type">Parcel</span> <span class="hljs-variable">reply</span> <span class="hljs-operator">=</span> Parcel.obtain();  <span class="hljs-comment">// è¿”å›åŒ…</span>

    <span class="hljs-keyword">try</span> {
        data.writeInterfaceToken(DESCRIPTOR);

        <span class="hljs-comment">// åºåˆ—åŒ–å‚æ•°</span>
        TextUtils.writeToParcel(text, data, <span class="hljs-number">0</span>);
        data.writeInt(newCursorPosition);

        <span class="hljs-comment">// å‘èµ·Binderè°ƒç”¨ï¼ˆé˜»å¡ç­‰å¾…è¿”å›ï¼‰</span>
        mRemote.transact(TRANSACTION_setComposingText, data, reply, <span class="hljs-number">0</span>);

        reply.readException(); <span class="hljs-comment">// è¯»å–å¼‚å¸¸ï¼ˆå¦‚æœæœ‰ï¼‰</span>
    } <span class="hljs-keyword">finally</span> {
        data.recycle();
        reply.recycle();
    }
}
</code></pre>
<p><strong>æ€§èƒ½æ•°æ®</strong>ï¼š</p>
<ul>
<li>åºåˆ—åŒ–ï¼š~10Î¼s</li>
<li>Binder transactï¼š~100Î¼s</li>
<li>æ€»è€—æ—¶ï¼š~110Î¼s</li>
</ul>
<p>ä½†è¿™åªæ˜¯åˆ°è¾¾åº”ç”¨è¿›ç¨‹Binderçº¿ç¨‹çš„æ—¶é—´ï¼Œå®é™…æ‰§è¡Œè¿˜è¦ç­‰ä¸»çº¿ç¨‹è°ƒåº¦ã€‚</p>
<h4 data-id="heading-16">4.3 çº¿ç¨‹åˆ‡æ¢çš„å»¶è¿Ÿ</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Stubç«¯ï¼ˆåº”ç”¨è¿›ç¨‹ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setComposingText</span><span class="hljs-params">(CharSequence text, <span class="hljs-type">int</span> newCursorPosition)</span> {
    <span class="hljs-comment">// å½“å‰ï¼šBinderçº¿ç¨‹</span>

    <span class="hljs-type">Message</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> mH.obtainMessage(DO_SET_COMPOSING_TEXT);
    msg.obj = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SomeArgs</span>(text, newCursorPosition);
    msg.sendToTarget();

    <span class="hljs-comment">// ç«‹å³è¿”å›ï¼ˆæ€»è€—æ—¶ ~110Î¼sï¼‰</span>
}

<span class="hljs-comment">// ä¸»çº¿ç¨‹ Handler</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleMessage</span><span class="hljs-params">(Message msg)</span> {
    <span class="hljs-comment">// å½“å‰ï¼šä¸»çº¿ç¨‹</span>
    <span class="hljs-comment">// å»¶è¿Ÿï¼šå–å†³äºä¸»çº¿ç¨‹æ¶ˆæ¯é˜Ÿåˆ—</span>
    <span class="hljs-comment">//      æ­£å¸¸æƒ…å†µï¼š&lt; 16ms (ä¸€å¸§)</span>
    <span class="hljs-comment">//      ç¹å¿™æƒ…å†µï¼š&gt; 100ms</span>

    mInputConnection.setComposingText(...);
}
</code></pre>
<p><strong>ä¿¡æ¯ä¸å¯¹ç§°çš„æ ¹æº</strong>ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">è¾“å…¥æ³•è§†è§’ï¼š
  è°ƒç”¨ <span class="hljs-built_in">setComposingText</span>() â†’ è¿”å› <span class="hljs-literal">true</span> â†’ <span class="hljs-string">"æˆåŠŸ"</span>

å®é™…æƒ…å†µï¼š
  Binderè°ƒç”¨æˆåŠŸ â‰  æ–‡æœ¬æ“ä½œæˆåŠŸ
  å¯èƒ½è¿˜åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ’é˜Ÿ
  å¯èƒ½è¢«InputFilteræ‹’ç»

è¾“å…¥æ³•æ— ä»å¾—çŸ¥çœŸå®ç»“æœï¼
</code></pre>
<hr/>
<h3 data-id="heading-17">äº”ã€Binderæœºåˆ¶çš„æ€§èƒ½è€ƒé‡</h3>
<h4 data-id="heading-18">5.1 ä¸€æ¬¡æ‹·è´ vs ä¸¤æ¬¡æ‹·è´</h4>
<p><strong>ä¼ ç»ŸIPCï¼ˆç®¡é“/Socketï¼‰</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">å‘é€è¿›ç¨‹ç”¨æˆ·ç©ºé—´ â†’ å†…æ ¸ç¼“å†²åŒº â†’ æ¥æ”¶è¿›ç¨‹ç”¨æˆ·ç©ºé—´
     (æ‹·è´<span class="hljs-number">1</span>)           (æ‹·è´<span class="hljs-number">2</span>)
</code></pre>
<p><strong>Binder IPC</strong>ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">å‘é€è¿›ç¨‹ç”¨æˆ·ç©ºé—´ â†’ Binderå†…æ ¸ç¼“å†²åŒºï¼ˆmmapæ˜ å°„ï¼‰
<span class="hljs-code">     (æ‹·è´1)            â†“
                 æ¥æ”¶è¿›ç¨‹ç›´æ¥è®¿é—®ï¼ˆé›¶æ‹·è´ï¼‰
</span></code></pre>
<p><strong>mmapçš„ä½œç”¨</strong>ï¼š</p>
<ul>
<li>å†…æ ¸ç¼“å†²åŒºæ˜ å°„åˆ°æ¥æ”¶è¿›ç¨‹åœ°å€ç©ºé—´</li>
<li>æ¥æ”¶è¿›ç¨‹è¯»å–æ—¶æ— éœ€æ‹·è´</li>
<li>å‡å°‘50%çš„æ•°æ®æ‹·è´å¼€é”€</li>
</ul>
<h4 data-id="heading-19">5.2 CharSequenceçš„ä¼ è¾“æˆæœ¬</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// TextUtils.java</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">writeToParcel</span><span class="hljs-params">(CharSequence cs, Parcel p, <span class="hljs-type">int</span> flags)</span> {
    <span class="hljs-keyword">if</span> (cs <span class="hljs-keyword">instanceof</span> Spanned) {
        <span class="hljs-comment">// åŒ…å«å¯Œæ–‡æœ¬æ ·å¼</span>
        p.writeInt(<span class="hljs-number">1</span>);
        p.writeString(cs.toString());

        <span class="hljs-comment">// åºåˆ—åŒ–Spanä¿¡æ¯</span>
        <span class="hljs-type">Spanned</span> <span class="hljs-variable">sp</span> <span class="hljs-operator">=</span> (Spanned) cs;
        Object[] spans = sp.getSpans(<span class="hljs-number">0</span>, cs.length(), Object.class);
        p.writeInt(spans.length);

        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; spans.length; i++) {
            <span class="hljs-type">Object</span> <span class="hljs-variable">span</span> <span class="hljs-operator">=</span> spans[i];
            <span class="hljs-type">int</span> <span class="hljs-variable">spanStart</span> <span class="hljs-operator">=</span> sp.getSpanStart(span);
            <span class="hljs-type">int</span> <span class="hljs-variable">spanEnd</span> <span class="hljs-operator">=</span> sp.getSpanEnd(span);
            <span class="hljs-type">int</span> <span class="hljs-variable">spanFlags</span> <span class="hljs-operator">=</span> sp.getSpanFlags(span);

            <span class="hljs-comment">// æ¯ä¸ªSpan: ç±»å‹ + èµ·å§‹ + ç»“æŸ + æ ‡å¿—</span>
            <span class="hljs-comment">// çº¦ 20-50 bytes</span>
        }
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// çº¯æ–‡æœ¬</span>
        p.writeInt(<span class="hljs-number">0</span>);
        p.writeString(cs.toString());
    }
}
</code></pre>
<p><strong>æ€§èƒ½å¯¹æ¯”</strong>ï¼š</p>
<pre><code class="hljs language-python" lang="python">çº¯æ–‡æœ¬ <span class="hljs-string">"hello"</span>:
  <span class="hljs-number">5</span>ä¸ªå­—ç¬¦ Ã— <span class="hljs-number">2</span> <span class="hljs-built_in">bytes</span> (UTF-<span class="hljs-number">16</span>) = <span class="hljs-number">10</span> <span class="hljs-built_in">bytes</span>
  + é•¿åº¦ä¿¡æ¯ = <span class="hljs-number">14</span> <span class="hljs-built_in">bytes</span>

å¯Œæ–‡æœ¬ <span class="hljs-string">"hello"</span> (çº¢è‰² + ç²—ä½“):
  æ–‡æœ¬: <span class="hljs-number">14</span> <span class="hljs-built_in">bytes</span>
  + <span class="hljs-number">2</span>ä¸ªSpan Ã— <span class="hljs-number">40</span> <span class="hljs-built_in">bytes</span> = <span class="hljs-number">80</span> <span class="hljs-built_in">bytes</span>
  æ€»è®¡: <span class="hljs-number">94</span> <span class="hljs-built_in">bytes</span> (<span class="hljs-number">6.7</span>å€)
</code></pre>
<p><strong>ä¼˜åŒ–å»ºè®®</strong>ï¼šè¾“å…¥æ³•å°½é‡å‘é€çº¯æ–‡æœ¬ï¼Œé¿å…Spanã€‚</p>
<h4 data-id="heading-20">5.3 é«˜é¢‘è°ƒç”¨çš„æ€§èƒ½å½±å“</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç”¨æˆ·å¿«é€Ÿè¾“å…¥ "hello"</span>
<span class="hljs-keyword">for</span> (<span class="hljs-type">char</span> c : <span class="hljs-string">"hello"</span>.toCharArray()) {
    ic.commitText(String.valueOf(c), <span class="hljs-number">1</span>);
    <span class="hljs-comment">// æ¯æ¬¡è°ƒç”¨ï¼š~110Î¼s Binder + ~200Î¼s ä¸»çº¿ç¨‹æ‰§è¡Œ</span>
}

<span class="hljs-comment">// 5ä¸ªå­—ç¬¦ Ã— 310Î¼s = 1.55ms (å¯æ¥å—)</span>

<span class="hljs-comment">// ä½†å¦‚æœè¾“å…¥æ³•è¿˜è¯»å–ä¸Šä¸‹æ–‡ï¼š</span>
<span class="hljs-keyword">for</span> (<span class="hljs-type">char</span> c : <span class="hljs-string">"hello"</span>.toCharArray()) {
    <span class="hljs-type">CharSequence</span> <span class="hljs-variable">ctx</span> <span class="hljs-operator">=</span> ic.getTextBeforeCursor(<span class="hljs-number">10</span>, <span class="hljs-number">0</span>); <span class="hljs-comment">// +110Î¼s</span>
    ic.commitText(String.valueOf(c), <span class="hljs-number">1</span>);              <span class="hljs-comment">// +310Î¼s</span>
}

<span class="hljs-comment">// 5ä¸ªå­—ç¬¦ Ã— 420Î¼s = 2.1ms (ä»å¯æ¥å—)</span>
</code></pre>
<p><strong>ç»“è®º</strong>ï¼šBinderæ€§èƒ½è¶³å¤Ÿå¥½ï¼Œä¸æ˜¯ç“¶é¢ˆã€‚</p>
<hr/>
<h3 data-id="heading-21">å…­ã€ä»Binderè§†è§’çœ‹Bugçš„è§¦å‘</h3>
<h4 data-id="heading-22">6.1 æ­£å¸¸åœºæ™¯ï¼šè¾“å…¥æ•°å­—</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è¾“å…¥æ³•è¿›ç¨‹</span>
ic.commitText(<span class="hljs-string">"1"</span>, <span class="hljs-number">1</span>);

<span class="hljs-comment">// Binderä¼ è¾“åˆ°åº”ç”¨è¿›ç¨‹</span>
<span class="hljs-comment">// â†“</span>

<span class="hljs-comment">// åº”ç”¨è¿›ç¨‹ä¸»çº¿ç¨‹</span>
BaseInputConnection.commitText(<span class="hljs-string">"1"</span>, <span class="hljs-number">1</span>)
  â†’ Editable.insert(<span class="hljs-number">0</span>, <span class="hljs-string">"1"</span>)
  â†’ InputFilter.filter(<span class="hljs-string">"1"</span>, ...)  <span class="hljs-comment">// DigitsKeyListener</span>
  â†’ æ£€æŸ¥ï¼š<span class="hljs-string">'1'</span> æ˜¯æ•°å­— â†’ è¿”å› <span class="hljs-literal">null</span> (æ¥å—)
  â†’ æ’å…¥æˆåŠŸ
</code></pre>
<p><strong>ç»“æœ</strong>ï¼šâœ“ æ­£å¸¸</p>
<h4 data-id="heading-23">6.2 Bugåœºæ™¯ï¼šè¾“å…¥å­—æ¯</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç¬¬1æ¬¡ï¼šsetComposingText("q")</span>
è¾“å…¥æ³•è¿›ç¨‹ï¼š
  ic.setComposingText(<span class="hljs-string">"q"</span>, <span class="hljs-number">1</span>)
  â†“ Binder IPC
åº”ç”¨è¿›ç¨‹ Binderçº¿ç¨‹ï¼š
  IInputConnectionWrapper.onTransact()
  â†’ Handler.post(runnable)
  â†’ è¿”å›æˆåŠŸ
  â†“
è¾“å…¥æ³•ï¼šè®¤ä¸ºæˆåŠŸï¼Œç»§ç»­
  â†“
åº”ç”¨è¿›ç¨‹ä¸»çº¿ç¨‹ï¼ˆå»¶è¿Ÿæ‰§è¡Œï¼‰ï¼š
  BaseInputConnection.setComposingText(<span class="hljs-string">"q"</span>, <span class="hljs-number">1</span>)
  â†’ replaceText(<span class="hljs-string">"q"</span>, <span class="hljs-number">1</span>, <span class="hljs-literal">true</span>)
  â†’ ç»„åˆèŒƒå›´: a=-<span class="hljs-number">1</span>, b=-<span class="hljs-number">1</span> (æ— )
  â†’ delete: ä¸æ‰§è¡Œ
  â†’ insert(<span class="hljs-string">"q"</span>): è¢«DigitsKeyListeneræ‹’ç»
  â†’ setComposingSpans(<span class="hljs-number">6</span>, <span class="hljs-number">6</span>) <span class="hljs-comment">// è®¾ç½®äº†ç©ºèŒƒå›´</span>

<span class="hljs-comment">// ç¬¬2æ¬¡ï¼šsetComposingText("qq")</span>
è¾“å…¥æ³•è¿›ç¨‹ï¼š
  ic.setComposingText(<span class="hljs-string">"qq"</span>, <span class="hljs-number">1</span>)
  â†“ Binder IPC
åº”ç”¨è¿›ç¨‹ä¸»çº¿ç¨‹ï¼š
  BaseInputConnection.setComposingText(<span class="hljs-string">"qq"</span>, <span class="hljs-number">1</span>)
  â†’ replaceText(<span class="hljs-string">"qq"</span>, <span class="hljs-number">1</span>, <span class="hljs-literal">true</span>)
  â†’ ç»„åˆèŒƒå›´: a=<span class="hljs-number">5</span>, b=<span class="hljs-number">6</span> â† ä¸Šæ¬¡è®¾ç½®çš„
  â†’ delete(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>): åˆ é™¤å­—ç¬¦<span class="hljs-string">'6'</span> âœ— (ç»•è¿‡äº†Filter!)
  â†’ insert(<span class="hljs-string">"qq"</span>): è¢«DigitsKeyListeneræ‹’ç»
  â†’ ç»“æœ: <span class="hljs-string">"12345"</span> (ä¸¢å¤±äº†<span class="hljs-string">'6'</span>)
</code></pre>
<p><strong>Binderå±‚é¢çš„é—®é¢˜</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql">è¾“å…¥æ³•å‘é€ï¼šsetComposingText("qq")
  â†“ æœŸæœ›ï¼šæ›¿æ¢ä¸º"qq"
  â†“ å®é™…ï¼š<span class="hljs-keyword">delete</span>æˆåŠŸ <span class="hljs-operator">+</span> <span class="hljs-keyword">insert</span>å¤±è´¥
  â†“ ç»“æœï¼šæ•°æ®ä¸¢å¤±
  â†“ åé¦ˆï¼šè¿”å› <span class="hljs-literal">true</span> (æˆåŠŸ)

è¾“å…¥æ³•ä¸çŸ¥é“å®é™…å‘ç”Ÿäº†ä»€ä¹ˆï¼
</code></pre>
<h4 data-id="heading-24">6.3 ä¿¡æ¯ä¸å¯¹ç§°çš„æœ¬è´¨</h4>
<pre><code class="hljs language-sql" lang="sql">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Binderæ¥å£çš„å±€é™æ€§                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  æ¥å£å®šä¹‰ï¼š                                      â”‚
â”‚  <span class="hljs-type">boolean</span> setComposingText(CharSequence, <span class="hljs-type">int</span>)   â”‚
â”‚                                                 â”‚
â”‚  è¿”å›å€¼å«ä¹‰ï¼š                                    â”‚
â”‚  <span class="hljs-operator">-</span> <span class="hljs-literal">true</span>:  Binderè°ƒç”¨æˆåŠŸ                        â”‚
â”‚  <span class="hljs-operator">-</span> <span class="hljs-literal">false</span>: Binderè°ƒç”¨å¤±è´¥ï¼ˆRemoteExceptionï¼‰     â”‚
â”‚                                                 â”‚
â”‚  æ— æ³•è¡¨è¾¾ï¼š                                      â”‚
â”‚  <span class="hljs-operator">-</span> æ–‡æœ¬æ˜¯å¦çœŸçš„è¢«æ’å…¥                            â”‚
â”‚  <span class="hljs-operator">-</span> è¢«InputFilterè¿‡æ»¤æ‰å¤šå°‘å­—ç¬¦                   â”‚
â”‚  <span class="hljs-operator">-</span> å®é™…å…‰æ ‡ä½ç½®                                 â”‚
â”‚  <span class="hljs-operator">-</span> <span class="hljs-keyword">delete</span><span class="hljs-operator">/</span><span class="hljs-keyword">insert</span>çš„è¯¦ç»†ç»“æœ                      â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>è®¾è®¡ç¼ºé™·</strong>ï¼š</p>
<ul>
<li>æ¥å£è¿‡äºç®€å•ï¼Œæ— æ³•ä¼ é€’è¯¦ç»†ä¿¡æ¯</li>
<li>å¼‚æ­¥æ‰§è¡Œï¼Œæ— æ³•ç­‰å¾…å®é™…ç»“æœ</li>
<li>è¾“å…¥æ³•ä¸åº”ç”¨çŠ¶æ€ä¸åŒæ­¥</li>
</ul>
<hr/>
<h3 data-id="heading-25">ä¸ƒã€æ€»ç»“ï¼šBinderé€šä¿¡çš„æœ¬è´¨</h3>
<h4 data-id="heading-26">7.1 æ ¸å¿ƒæ¶æ„å›é¡¾</h4>
<pre><code class="hljs language-scss" lang="scss">è¾“å…¥æ³•è¿›ç¨‹ â†â”€ Binder IPC â”€â†’ åº”ç”¨è¿›ç¨‹
   â†“                          â†“
é€æ˜ä»£ç†                    çº¿ç¨‹åˆ‡æ¢
(ä»¥ä¸ºæ˜¯æœ¬åœ°è°ƒç”¨)          (Binderçº¿ç¨‹ â†’ ä¸»çº¿ç¨‹)
   â†“                          â†“
è°ƒç”¨è¿”å› true               å¼‚æ­¥æ‰§è¡Œ
(åªè¡¨ç¤ºIPCæˆåŠŸ)            (å¯èƒ½å¤±è´¥ï¼Œä½†æ— åé¦ˆ)
   â†“                          â†“
ç»§ç»­åç»­æ“ä½œ                 å®é™…æ–‡æœ¬æ“ä½œ
(åŸºäºé”™è¯¯å‡è®¾)              (ç»“æœæœªçŸ¥)
</code></pre>
<h4 data-id="heading-27">7.2 å…³é”®æŠ€æœ¯ç‚¹</h4>



































<table><thead><tr><th>æŠ€æœ¯ç‚¹</th><th>å®ç°</th><th>å½±å“</th></tr></thead><tbody><tr><td><strong>è¿›ç¨‹éš”ç¦»</strong></td><td>è¾“å…¥æ³•ç‹¬ç«‹è¿›ç¨‹</td><td>å®‰å…¨æ€§â†‘ï¼Œéœ€è¦IPC</td></tr><tr><td><strong>Binder IPC</strong></td><td>AIDLç”ŸæˆStub/Proxy</td><td>ä¸€æ¬¡æ‹·è´ï¼Œæ€§èƒ½å¥½</td></tr><tr><td><strong>çº¿ç¨‹åˆ‡æ¢</strong></td><td>Binderçº¿ç¨‹â†’Handlerâ†’ä¸»çº¿ç¨‹</td><td>å¼‚æ­¥æ‰§è¡Œï¼Œå»¶è¿Ÿ</td></tr><tr><td><strong>è¿”å›å€¼</strong></td><td>boolean (æˆåŠŸ/å¤±è´¥)</td><td>ä¿¡æ¯ä¸è¶³ï¼Œæ— ç»†èŠ‚</td></tr><tr><td><strong>ä¿¡æ¯ä¸å¯¹ç§°</strong></td><td>è¾“å…¥æ³•ä¸çŸ¥é“å®é™…ç»“æœ</td><td>å¼•å‘åç»­Bug</td></tr></tbody></table>
<h4 data-id="heading-28">7.3 ä¸ºåç»­æ–‡ç« é“ºå«</h4>
<p><strong>ç¬¬ä¸€ç¯‡ï¼ˆæœ¬æ–‡ï¼‰</strong>ï¼š</p>
<ul>
<li>âœ“ ç†è§£äº†ä¸‰è¿›ç¨‹æ¶æ„</li>
<li>âœ“ ç†è§£äº†Binder IPCæœºåˆ¶</li>
<li>âœ“ ç†è§£äº†å¼‚æ­¥é€šä¿¡å¯¼è‡´çš„ä¿¡æ¯ä¸å¯¹ç§°</li>
</ul>
<p><strong>ç¬¬äºŒç¯‡é¢„å‘Š</strong>ï¼š</p>
<ul>
<li>ä»åº”ç”¨è¿›ç¨‹å†…éƒ¨çœ‹ï¼šreplaceText()ä¸ºä»€ä¹ˆå…ˆdeleteåinsertï¼Ÿ</li>
<li>deleteä¸ºä»€ä¹ˆèƒ½ç»•è¿‡InputFilterï¼Ÿ</li>
<li>SpanèŒƒå›´ä¸ºä»€ä¹ˆä¼šå¼‚å¸¸æ‰©å±•ï¼Ÿ</li>
<li>â†’ æ·±å…¥Editableã€InputFilterã€Spançš„è®¾è®¡ç¼ºé™·</li>
</ul>
<p><strong>ç¬¬ä¸‰ç¯‡é¢„å‘Š</strong>ï¼š</p>
<ul>
<li>å¦‚ä½•åœ¨åº”ç”¨å±‚è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ</li>
<li>å®Œæ•´çš„è§£å†³æ–¹æ¡ˆï¼ˆä¿ç•™æ•°å­—é”®ç›˜ï¼‰</li>
<li>å·¥ç¨‹å®è·µçš„æœ€ä½³åšæ³•</li>
<li>â†’ ä»æ¶æ„è®¾è®¡åˆ°ä»£ç å®ç°</li>
</ul>
<hr/>
<h3 data-id="heading-29">å‚è€ƒèµ„æ–™</h3>
<ol>
<li>Androidæºç ï¼š<code>frameworks/base/core/java/android/view/inputmethod/</code></li>
<li>Binderé©±åŠ¨ï¼š<code>kernel/drivers/android/binder.c</code></li>
<li>AIDLæ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fguide%2Fcomponents%2Faidl" target="_blank" title="https://developer.android.com/guide/components/aidl" ref="nofollow noopener noreferrer">Android Interface Definition Language</a></li>
<li>BinderåŸç†ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fsource.android.com%2Fdevices%2Farchitecture%2Fhidl%2Fbinder-ipc" target="_blank" title="https://source.android.com/devices/architecture/hidl/binder-ipc" ref="nofollow noopener noreferrer">Android Binder Design</a></li>
</ol>
<hr/>
<p><strong>ä¸‹ä¸€ç¯‡</strong>ï¼šã€Šä»ä¸€ä¸ªBugçœ‹Androidæ–‡æœ¬ç¼–è¾‘çš„è®¾è®¡ç¼ºé™·ã€‹- æ·±å…¥åº”ç”¨è¿›ç¨‹å†…éƒ¨ï¼Œå‰–æEditableã€InputFilterã€Spanæœºåˆ¶çš„ä¸å¯¹ç§°æ€§</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä»ä¸€ä¸ªBugçœ‹Androidæ–‡æœ¬ç¼–è¾‘çš„è®¾è®¡ç¼ºé™·]]></title>    <link>https://juejin.cn/post/7570932873131294747</link>    <guid>https://juejin.cn/post/7570932873131294747</guid>    <pubDate>2025-11-10T13:24:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570932873131294747" data-draft-id="7570932873131278363" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä»ä¸€ä¸ªBugçœ‹Androidæ–‡æœ¬ç¼–è¾‘çš„è®¾è®¡ç¼ºé™·"/> <meta itemprop="keywords" content="Android,Linux"/> <meta itemprop="datePublished" content="2025-11-10T13:24:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="WAsbry"/> <meta itemprop="url" content="https://juejin.cn/user/3413335797139511"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä»ä¸€ä¸ªBugçœ‹Androidæ–‡æœ¬ç¼–è¾‘çš„è®¾è®¡ç¼ºé™·
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3413335797139511/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    WAsbry
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T13:24:41.000Z" title="Mon Nov 10 2025 13:24:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä»ä¸€ä¸ªBugçœ‹Androidæ–‡æœ¬ç¼–è¾‘çš„è®¾è®¡ç¼ºé™·</h2>
<h3 data-id="heading-1">ğŸ’¡ æœ¬æ–‡ç²¾å</h3>
<ul>
<li><strong>æ‰¿æ¥ä¸Šæ–‡</strong>ï¼šç¬¬ä¸€ç¯‡è§£æäº†è·¨è¿›ç¨‹é€šä¿¡ï¼Œæœ¬ç¯‡æ·±å…¥åº”ç”¨è¿›ç¨‹å†…éƒ¨ï¼Œå‰–ææ–‡æœ¬æ“ä½œçš„è®¾è®¡ç¼ºé™·</li>
<li><strong>æ ¸å¿ƒçŸ›ç›¾</strong>ï¼šInputFilteræœŸæœ›æ§åˆ¶æ‰€æœ‰æ–‡æœ¬æ“ä½œï¼Œä½†delete()ç»•è¿‡äº†è¿‡æ»¤æœºåˆ¶</li>
<li><strong>å…³é”®å‘ç°</strong>ï¼š<code>replaceText()</code>å…ˆdeleteåinsertï¼Œdeleteä¼ å…¥ç©ºå­—ç¬¦ä¸²""ï¼ŒInputFilterè®¤ä¸ºåˆæ³•æ”¾è¡Œ</li>
<li><strong>æ·±å±‚åŸå› </strong>ï¼šSpanèŒƒå›´åœ¨insertå¤±è´¥åä¸å®é™…æ–‡æœ¬ä¸åŒæ­¥ï¼Œå¯¼è‡´èŒƒå›´å¼‚å¸¸æ‰©å±•ï¼Œåå™¬æ›´å¤šå­—ç¬¦</li>
<li><strong>ä»·å€¼</strong>ï¼šç†è§£Androidæ–‡æœ¬ç¼–è¾‘æ¡†æ¶çš„è®¾è®¡å±€é™ï¼Œä¸ºç¬¬ä¸‰ç¯‡çš„å·¥ç¨‹è§£å†³æ–¹æ¡ˆåšå‡†å¤‡</li>
</ul>
<hr/>
<h3 data-id="heading-2">ä¸€ã€åº”ç”¨è¿›ç¨‹å†…éƒ¨çš„æ–‡æœ¬ç¼–è¾‘æ¶æ„</h3>
<h4 data-id="heading-3">1.1 ä¸‰å¤§æ ¸å¿ƒç»„ä»¶</h4>
<p>ä¸Šä¸€ç¯‡æˆ‘ä»¬ç†è§£äº†Binderå¦‚ä½•å°†è¾“å…¥æ³•çš„è°ƒç”¨ä¼ é€’åˆ°åº”ç”¨è¿›ç¨‹ã€‚ç°åœ¨èšç„¦åº”ç”¨è¿›ç¨‹å†…éƒ¨ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">åº”ç”¨è¿›ç¨‹å†…éƒ¨æ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TextView / EditText                    â”‚
â”‚    â”œâ”€ Editable (SpannableStringBuilder)â”‚ â† æ–‡æœ¬ç¼“å†²åŒº
â”‚    â”‚    - char<span class="hljs-selector-attr">[]</span> mText                  â”‚
â”‚    â”‚    - <span class="hljs-selector-tag">Object</span><span class="hljs-selector-attr">[]</span> mSpans               â”‚
â”‚    â”‚                                    â”‚
â”‚    â”œâ”€ InputFilter<span class="hljs-selector-attr">[]</span>                    â”‚ â† è¿‡æ»¤å™¨é“¾
â”‚    â”‚    - DigitsKeyListener             â”‚
â”‚    â”‚    - LengthFilter                  â”‚
â”‚    â”‚                                    â”‚
â”‚    â””â”€ InputConnection                  â”‚ â† å¤–éƒ¨æ¥å£
â”‚         - BaseInputConnection           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>ä¸Šä¸€ç¯‡å·²è®²</strong>ï¼šInputConnectionæ˜¯è·¨è¿›ç¨‹æ¥å£
<strong>æœ¬ç¯‡èšç„¦</strong>ï¼šEditableã€InputFilterã€Spanå¦‚ä½•ååŒå·¥ä½œ</p>
<h4 data-id="heading-4">1.2 Editableæ¥å£è®¾è®¡</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Editable</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">CharSequence</span>, Spannable {
    <span class="hljs-comment">// æ ¸å¿ƒçš„ä¸‰ä¸ªæ“ä½œ</span>
    Editable <span class="hljs-title function_">insert</span><span class="hljs-params">(<span class="hljs-type">int</span> where, CharSequence text)</span>;
    Editable <span class="hljs-title function_">delete</span><span class="hljs-params">(<span class="hljs-type">int</span> st, <span class="hljs-type">int</span> en)</span>;
    Editable <span class="hljs-title function_">replace</span><span class="hljs-params">(<span class="hljs-type">int</span> st, <span class="hljs-type">int</span> en, CharSequence text)</span>;

    <span class="hljs-comment">// è¿‡æ»¤å™¨ç®¡ç†</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">setFilters</span><span class="hljs-params">(InputFilter[] filters)</span>;
    InputFilter[] getFilters();
}
</code></pre>
<p><strong>å®ç°ç±»</strong>ï¼šSpannableStringBuilder</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpannableStringBuilder</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Editable</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">char</span>[] mText;           <span class="hljs-comment">// å­˜å‚¨å­—ç¬¦</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> mGapStart;          <span class="hljs-comment">// Gap Bufferä¼˜åŒ–</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> mGapLength;

    <span class="hljs-keyword">private</span> Object[] mSpans;        <span class="hljs-comment">// å­˜å‚¨Spanå¯¹è±¡</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span>[] mSpanStarts;      <span class="hljs-comment">// Spanèµ·å§‹ä½ç½®</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span>[] mSpanEnds;        <span class="hljs-comment">// Spanç»“æŸä½ç½®</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span>[] mSpanFlags;       <span class="hljs-comment">// Spanæ ‡å¿—</span>

    <span class="hljs-comment">// æ ¸å¿ƒå®ç°</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> SpannableStringBuilder <span class="hljs-title function_">replace</span><span class="hljs-params">(<span class="hljs-type">int</span> start, <span class="hljs-type">int</span> end,
                                          CharSequence tb, <span class="hljs-type">int</span> tbstart, <span class="hljs-type">int</span> tbend)</span> {
        <span class="hljs-comment">// å…³é”®ï¼šè¿™é‡Œä¼šè°ƒç”¨InputFilteré“¾</span>
        InputFilter[] filters = getFilters();
        <span class="hljs-keyword">if</span> (filters != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; filters.length; i++) {
                <span class="hljs-type">CharSequence</span> <span class="hljs-variable">repl</span> <span class="hljs-operator">=</span> filters[i].filter(tb, tbstart, tbend,
                                                      <span class="hljs-built_in">this</span>, start, end);
                <span class="hljs-keyword">if</span> (repl != <span class="hljs-literal">null</span>) {
                    tb = repl;
                    tbstart = <span class="hljs-number">0</span>;
                    tbend = repl.length();
                }
            }
        }

        <span class="hljs-comment">// æ‰§è¡Œå®é™…çš„æ–‡æœ¬æ›¿æ¢</span>
        <span class="hljs-comment">// ...</span>
    }
}
</code></pre>
<p><strong>å…³é”®ç‚¹</strong>ï¼š</p>
<ul>
<li>insert/deleteæœ€ç»ˆéƒ½è°ƒç”¨replace()</li>
<li>replace()ä¼šè§¦å‘InputFilteré“¾</li>
<li>ä½†æœ‰ä¸ªä¾‹å¤–...</li>
</ul>
<hr/>
<h3 data-id="heading-5">äºŒã€è®¾è®¡ç¼ºé™·çš„æ ¸å¿ƒï¼šä¸å¯¹ç§°çš„æ§åˆ¶æƒ</h3>
<h4 data-id="heading-6">2.1 InputFilterçš„æ¥å£è®¾è®¡</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">InputFilter</span> {
    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@param</span> source è¦æ’å…¥çš„æ–°æ–‡æœ¬
     * <span class="hljs-doctag">@param</span> start  sourceçš„èµ·å§‹ä½ç½®
     * <span class="hljs-doctag">@param</span> end    sourceçš„ç»“æŸä½ç½®
     * <span class="hljs-doctag">@param</span> dest   ç›®æ ‡æ–‡æœ¬(å½“å‰EditTextå†…å®¹)
     * <span class="hljs-doctag">@param</span> dstart æ’å…¥ä½ç½®çš„èµ·å§‹
     * <span class="hljs-doctag">@param</span> dend   æ’å…¥ä½ç½®çš„ç»“æŸ
     * <span class="hljs-doctag">@return</span> null  = æ¥å—source
     *         ""    = æ‹’ç»source
     *         å…¶ä»–  = æ›¿æ¢ä¸ºè¿”å›çš„å†…å®¹
     */</span>
    CharSequence <span class="hljs-title function_">filter</span><span class="hljs-params">(CharSequence source, <span class="hljs-type">int</span> start, <span class="hljs-type">int</span> end,
                       Spanned dest, <span class="hljs-type">int</span> dstart, <span class="hljs-type">int</span> dend)</span>;
}
</code></pre>
<p><strong>DigitsKeyListenerçš„å®ç°</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// NumberKeyListener.java (çˆ¶ç±»)</span>
<span class="hljs-keyword">public</span> CharSequence <span class="hljs-title function_">filter</span><span class="hljs-params">(CharSequence source, <span class="hljs-type">int</span> start, <span class="hljs-type">int</span> end,
                           Spanned dest, <span class="hljs-type">int</span> dstart, <span class="hljs-type">int</span> dend)</span> {
    <span class="hljs-type">char</span>[] accept = getAcceptedChars(); <span class="hljs-comment">// ['0'-'9']</span>

    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> start; i &lt; end; i++) {
        <span class="hljs-keyword">if</span> (!ok(accept, source.charAt(i))) {
            <span class="hljs-comment">// å‘ç°éæ³•å­—ç¬¦ (å¦‚å­—æ¯ 'q')</span>
            <span class="hljs-keyword">if</span> (end - start == <span class="hljs-number">1</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>; <span class="hljs-comment">// å•ä¸ªå­—ç¬¦ï¼Œç›´æ¥æ‹’ç»</span>
            }
            <span class="hljs-comment">// å¤šä¸ªå­—ç¬¦ï¼Œè¿‡æ»¤æ‰éæ³•çš„</span>
            <span class="hljs-comment">// ...</span>
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">// å…¨éƒ¨åˆæ³•ï¼Œæ¥å—</span>
}

<span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">ok</span><span class="hljs-params">(<span class="hljs-type">char</span>[] accept, <span class="hljs-type">char</span> c)</span> {
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> accept.length - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) {
        <span class="hljs-keyword">if</span> (accept[i] == c) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
</code></pre>
<h4 data-id="heading-7">2.2 delete()çš„ç‰¹æ®Šå®ç°</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// SpannableStringBuilder.java</span>
<span class="hljs-keyword">public</span> SpannableStringBuilder <span class="hljs-title function_">delete</span><span class="hljs-params">(<span class="hljs-type">int</span> start, <span class="hljs-type">int</span> end)</span> {
    <span class="hljs-comment">// å…³é”®ï¼šdeleteæœ¬è´¨æ˜¯replaceæ“ä½œï¼Œä¼ å…¥ç©ºå­—ç¬¦ä¸²""</span>
    <span class="hljs-keyword">return</span> replace(start, end, <span class="hljs-string">""</span>);
}

<span class="hljs-comment">// è°ƒç”¨é“¾</span>
delete(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>)
  â†“
replace(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-string">""</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
  â†“
filter(<span class="hljs-string">""</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"123456"</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>)  â† InputFilterçœ‹åˆ°çš„æ˜¯ç©ºå­—ç¬¦ä¸²
  â†“
<span class="hljs-comment">// DigitsKeyListenerçš„æ£€æŸ¥</span>
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">0</span>; i++) {  <span class="hljs-comment">// start=0, end=0ï¼Œå¾ªç¯ä¸æ‰§è¡Œ</span>
    <span class="hljs-comment">// æ£€æŸ¥å­—ç¬¦åˆæ³•æ€§</span>
}
  â†“
<span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;  <span class="hljs-comment">// æ¥å—ï¼</span>
</code></pre>
<p><strong>é—®é¢˜æœ¬è´¨</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         InputFilterçš„è§†è§’                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  <span class="hljs-built_in">insert</span>(<span class="hljs-number">5</span>, "abc"):                             â”‚
â”‚    <span class="hljs-built_in">filter</span>(<span class="hljs-string">"abc"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">3</span>, dest, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>)            â”‚
â”‚    â†’ æ£€æŸ¥ <span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span> â†’ æ‹’ç» âœ“               â”‚
â”‚                                                 â”‚
â”‚  <span class="hljs-built_in">delete</span>(<span class="hljs-number">5</span>, <span class="hljs-number">8</span>):                                 â”‚
â”‚    <span class="hljs-built_in">filter</span>(<span class="hljs-string">""</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, dest, <span class="hljs-number">5</span>, <span class="hljs-number">8</span>)               â”‚
â”‚    â†’ æ£€æŸ¥ç©ºå­—ç¬¦ä¸² â†’ æ¥å— âœ—                     â”‚
â”‚                                                 â”‚
â”‚  InputFilteræ— æ³•åŒºåˆ†ï¼š                          â”‚
â”‚  - æ’å…¥ç©ºå­—ç¬¦ä¸² (åº”æ¥å—)                        â”‚
â”‚  - åˆ é™¤æ“ä½œ (åº”è¯¥ä¹Ÿèƒ½æ‹¦æˆªå—?)                   â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 data-id="heading-8">2.3 è®¾è®¡å‡è®¾ vs å®é™…æƒ…å†µ</h4>



































<table><thead><tr><th>åœºæ™¯</th><th>è®¾è®¡å‡è®¾</th><th>å®é™…æƒ…å†µ</th><th>æ˜¯å¦åˆç†</th></tr></thead><tbody><tr><td><strong>ç”¨æˆ·æŒ‰åˆ é™¤é”®</strong></td><td>deleteåº”è¯¥æ— æ¡ä»¶æ‰§è¡Œ</td><td>deleteç»•è¿‡InputFilter</td><td>âœ“ åˆç†ï¼ˆå°Šé‡ç”¨æˆ·æ„å›¾ï¼‰</td></tr><tr><td><strong>InputFilteræ‹¦æˆªinsert</strong></td><td>æ‹¦æˆªéæ³•å­—ç¬¦æ’å…¥</td><td>åªèƒ½æ‹¦æˆªinsert</td><td>âœ“ ç¬¦åˆé¢„æœŸ</td></tr><tr><td><strong>ç»„åˆæ–‡æœ¬æ›¿æ¢</strong></td><td>æ›¿æ¢åº”è¯¥åŸå­æ‰§è¡Œ</td><td>deleteå…ˆäºinsertï¼Œåˆ†ç¦»æ‰§è¡Œ</td><td>âœ— ä¸åˆç†</td></tr><tr><td><strong>delete+insertç»„åˆ</strong></td><td>åº”è¯¥ä¿æŒä¸€è‡´æ€§</td><td>deleteç»•è¿‡ï¼Œinsertæ‹¦æˆª</td><td>âœ— ä¸å¯¹ç§°</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-9">ä¸‰ã€BaseInputConnectionçš„replaceText()å®ç°</h3>
<h4 data-id="heading-10">3.1 æ ¸å¿ƒä»£ç åˆ†æ</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// BaseInputConnection.java</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">replaceText</span><span class="hljs-params">(CharSequence text, <span class="hljs-type">int</span> newCursorPosition, <span class="hljs-type">boolean</span> composing)</span> {
    <span class="hljs-keyword">final</span> <span class="hljs-type">Editable</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> getEditable();
    <span class="hljs-keyword">if</span> (content == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">return</span>;
    }

    beginBatchEdit();

    <span class="hljs-comment">// ========== æ­¥éª¤1: è·å–æ—§çš„ç»„åˆæ–‡æœ¬èŒƒå›´ ==========</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> getComposingSpanStart(content);
    <span class="hljs-type">int</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> getComposingSpanEnd(content);

    <span class="hljs-keyword">if</span> (b &lt; a) {
        <span class="hljs-type">int</span> <span class="hljs-variable">tmp</span> <span class="hljs-operator">=</span> a;
        a = b;
        b = tmp;
    }

    <span class="hljs-keyword">if</span> (a != -<span class="hljs-number">1</span> &amp;&amp; b != -<span class="hljs-number">1</span>) {
        removeComposingSpans(content);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// å¦‚æœæ²¡æœ‰ç»„åˆèŒƒå›´ï¼Œä½¿ç”¨é€‰ä¸­èŒƒå›´</span>
        a = Selection.getSelectionStart(content);
        b = Selection.getSelectionEnd(content);
    }

    <span class="hljs-comment">// ========== æ­¥éª¤2: å…ˆåˆ é™¤æ—§èŒƒå›´ ==========</span>
    <span class="hljs-keyword">if</span> (b != a) {
        content.delete(a, b);  <span class="hljs-comment">// â† å…³é”®: å…ˆåˆ é™¤ï¼Œä¸ç»è¿‡InputFilteréªŒè¯ï¼</span>
    }

    <span class="hljs-comment">// ========== æ­¥éª¤3: å†æ’å…¥æ–°æ–‡æœ¬ ==========</span>
    <span class="hljs-keyword">if</span> (text != <span class="hljs-literal">null</span>) {
        content.insert(a, text);  <span class="hljs-comment">// â† ç»è¿‡InputFilterï¼Œå¯èƒ½è¢«æ‹’ç»</span>
    }

    <span class="hljs-comment">// ========== æ­¥éª¤4: è®¾ç½®æ–°çš„ç»„åˆèŒƒå›´ ==========</span>
    <span class="hljs-keyword">if</span> (composing) {
        setComposingSpans(content, a, a + text.length());
    }

    endBatchEdit();
}
</code></pre>
<h4 data-id="heading-11">3.2 Bugè§¦å‘çš„å®Œæ•´æµç¨‹</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å‰æï¼šEditTextå†…å®¹ "123456"ï¼Œå…‰æ ‡åœ¨æœ«å°¾</span>

<span class="hljs-comment">// ========== ç¬¬1æ¬¡ï¼šsetComposingText("q") ==========</span>
replaceText(<span class="hljs-string">"q"</span>, <span class="hljs-number">1</span>, <span class="hljs-literal">true</span>)
  â†“
æ­¥éª¤<span class="hljs-number">1</span>: è·å–ç»„åˆèŒƒå›´
  a = getComposingSpanStart() â†’ -<span class="hljs-number">1</span> (æ— æ—§èŒƒå›´)
  b = getComposingSpanEnd() â†’ -<span class="hljs-number">1</span>
  ä½¿ç”¨å…‰æ ‡ä½ç½®: a=<span class="hljs-number">6</span>, b=<span class="hljs-number">6</span>
  â†“
æ­¥éª¤<span class="hljs-number">2</span>: åˆ é™¤
  <span class="hljs-keyword">if</span> (<span class="hljs-number">6</span> != <span class="hljs-number">6</span>) â†’ <span class="hljs-literal">false</span>ï¼Œä¸æ‰§è¡Œdelete
  â†“
æ­¥éª¤<span class="hljs-number">3</span>: æ’å…¥
  content.insert(<span class="hljs-number">6</span>, <span class="hljs-string">"q"</span>)
    â†’ filter(<span class="hljs-string">"q"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-string">"123456"</span>, <span class="hljs-number">6</span>, <span class="hljs-number">6</span>)
    â†’ æ£€æŸ¥: <span class="hljs-string">'q'</span> ä¸æ˜¯æ•°å­—
    â†’ è¿”å› <span class="hljs-string">""</span> (æ‹’ç»)
    â†’ æ’å…¥å¤±è´¥
  â†“
æ­¥éª¤<span class="hljs-number">4</span>: è®¾ç½®ç»„åˆèŒƒå›´
  setComposingSpans(<span class="hljs-number">6</span>, <span class="hljs-number">6</span> + <span class="hljs-number">0</span>) â†’ [<span class="hljs-number">6</span>, <span class="hljs-number">6</span>)
  â†“
ç»“æœ: <span class="hljs-string">"123456"</span> (æœªå˜)

<span class="hljs-comment">// ========== ç¬¬2æ¬¡ï¼šsetComposingText("qq") ==========</span>
replaceText(<span class="hljs-string">"qq"</span>, <span class="hljs-number">1</span>, <span class="hljs-literal">true</span>)
  â†“
æ­¥éª¤<span class="hljs-number">1</span>: è·å–ç»„åˆèŒƒå›´
  a = getComposingSpanStart() â†’ <span class="hljs-number">5</span> â† ä¸ºä»€ä¹ˆæ˜¯<span class="hljs-number">5</span>? (ç¨ååˆ†æ)
  b = getComposingSpanEnd() â†’ <span class="hljs-number">6</span>
  â†“
æ­¥éª¤<span class="hljs-number">2</span>: åˆ é™¤ â† Bugå¼€å§‹ï¼
  <span class="hljs-keyword">if</span> (<span class="hljs-number">6</span> != <span class="hljs-number">5</span>) â†’ <span class="hljs-literal">true</span>
  content.delete(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>)
    â†’ replace(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-string">""</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
    â†’ filter(<span class="hljs-string">""</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"123456"</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>)
    â†’ å¾ªç¯ä¸æ‰§è¡Œ (start=<span class="hljs-number">0</span>, end=<span class="hljs-number">0</span>)
    â†’ è¿”å› <span class="hljs-literal">null</span> (æ¥å—)
    â†’ åˆ é™¤æˆåŠŸï¼å­—ç¬¦<span class="hljs-string">'6'</span>è¢«åˆ é™¤
  content = <span class="hljs-string">"12345"</span>
  â†“
æ­¥éª¤<span class="hljs-number">3</span>: æ’å…¥
  content.insert(<span class="hljs-number">5</span>, <span class="hljs-string">"qq"</span>)
    â†’ filter(<span class="hljs-string">"qq"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-string">"12345"</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>)
    â†’ æ£€æŸ¥: <span class="hljs-string">'q'</span> ä¸æ˜¯æ•°å­—
    â†’ è¿”å› <span class="hljs-string">""</span> (æ‹’ç»)
    â†’ æ’å…¥å¤±è´¥
  â†“
æ­¥éª¤<span class="hljs-number">4</span>: è®¾ç½®ç»„åˆèŒƒå›´
  setComposingSpans(<span class="hljs-number">5</span>, <span class="hljs-number">5</span> + <span class="hljs-number">0</span>) â†’ [<span class="hljs-number">5</span>, <span class="hljs-number">5</span>)
  â†“
ç»“æœ: <span class="hljs-string">"12345"</span> âœ— (ä¸¢å¤±äº†<span class="hljs-string">'6'</span>)
</code></pre>
<h4 data-id="heading-12">3.3 ä¸ºä»€ä¹ˆå…ˆdeleteåinsertï¼Ÿ</h4>
<p><strong>è®¾è®¡æ„å›¾</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç»„åˆæ–‡æœ¬çš„æ›¿æ¢é€»è¾‘</span>
<span class="hljs-comment">// ä¾‹å¦‚ï¼šæ‹¼éŸ³è¾“å…¥ "zhongguo" â†’ å€™é€‰è¯ "ä¸­å›½"</span>

<span class="hljs-comment">// æ—§ç»„åˆæ–‡æœ¬: "zhongguo" (8ä¸ªå­—ç¬¦)</span>
<span class="hljs-comment">// æ–°ç»„åˆæ–‡æœ¬: "ä¸­å›½" (2ä¸ªå­—ç¬¦)</span>

<span class="hljs-comment">// å¦‚æœå…ˆinsertådeleteï¼š</span>
insert(<span class="hljs-string">"ä¸­å›½"</span>)    â†’ <span class="hljs-string">"123456zhongguoä¸­å›½"</span>
delete(<span class="hljs-number">6</span>, <span class="hljs-number">14</span>)    â†’ <span class="hljs-string">"123456ä¸­å›½"</span>

<span class="hljs-comment">// å¦‚æœå…ˆdeleteåinsertï¼š</span>
delete(<span class="hljs-number">6</span>, <span class="hljs-number">14</span>)    â†’ <span class="hljs-string">"123456"</span>
insert(<span class="hljs-string">"ä¸­å›½"</span>)   â†’ <span class="hljs-string">"123456ä¸­å›½"</span>

<span class="hljs-comment">// ä¸¤ç§æ–¹å¼ç»“æœç›¸åŒï¼Œä½†å…ˆdeleteåinsertæ›´é«˜æ•ˆ</span>
<span class="hljs-comment">// (é¿å…ä¸´æ—¶åˆ›å»ºè¿‡é•¿çš„å­—ç¬¦ä¸²)</span>
</code></pre>
<p><strong>é—®é¢˜</strong>ï¼š</p>
<ul>
<li>å‡è®¾äº†insertæ€»æ˜¯æˆåŠŸ</li>
<li>æ²¡æœ‰è€ƒè™‘InputFilteræ‹’ç»çš„æƒ…å†µ</li>
<li>æ²¡æœ‰å›æ»šæœºåˆ¶</li>
</ul>
<hr/>
<h3 data-id="heading-13">å››ã€Spanæœºåˆ¶å¯¼è‡´çš„èŒƒå›´å¼‚å¸¸æ‰©å±•</h3>
<h4 data-id="heading-14">4.1 COMPOSING Spançš„ä½œç”¨</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// BaseInputConnection.java</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Object</span> <span class="hljs-variable">COMPOSING</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ComposingText</span>();

<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ComposingText</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">NoCopySpan</span> {
    <span class="hljs-comment">// ç©ºå®ç°ï¼Œåªä½œä¸ºæ ‡è®°</span>
}

<span class="hljs-comment">// è·å–ç»„åˆæ–‡æœ¬èŒƒå›´</span>
<span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getComposingSpanStart</span><span class="hljs-params">(Spannable text)</span> {
    <span class="hljs-keyword">return</span> text.getSpanStart(COMPOSING);
}

<span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getComposingSpanEnd</span><span class="hljs-params">(Spannable text)</span> {
    <span class="hljs-keyword">return</span> text.getSpanEnd(COMPOSING);
}

<span class="hljs-comment">// è®¾ç½®ç»„åˆæ–‡æœ¬èŒƒå›´</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">setComposingSpans</span><span class="hljs-params">(Spannable text, <span class="hljs-type">int</span> start, <span class="hljs-type">int</span> end)</span> {
    <span class="hljs-comment">// ç§»é™¤æ—§çš„COMPOSING Span</span>
    removeComposingSpans(text);

    <span class="hljs-comment">// è®¾ç½®æ–°çš„COMPOSING Span</span>
    text.setSpan(COMPOSING, start, end,
                 Spanned.SPAN_EXCLUSIVE_EXCLUSIVE | Spanned.SPAN_COMPOSING);
}
</code></pre>
<h4 data-id="heading-15">4.2 SpanèŒƒå›´çš„åŠ¨æ€å˜åŒ–</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åˆå§‹çŠ¶æ€</span>
<span class="hljs-type">SpannableStringBuilder</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SpannableStringBuilder</span>(<span class="hljs-string">"123456"</span>);
<span class="hljs-comment">// æ— COMPOSING Span</span>

<span class="hljs-comment">// ç¬¬1æ¬¡ setComposingText("q")</span>
setComposingSpans(<span class="hljs-number">6</span>, <span class="hljs-number">6</span>)  <span class="hljs-comment">// è®¾ç½®ç©ºèŒƒå›´Span</span>
<span class="hljs-comment">// text: "123456"</span>
<span class="hljs-comment">// Span: [6, 6) â† ç©ºèŒƒå›´ï¼Œä½†Spanå­˜åœ¨</span>

<span class="hljs-comment">// ç¬¬2æ¬¡ setComposingText("qq")</span>
<span class="hljs-comment">// 1. è·å–èŒƒå›´</span>
<span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> getComposingSpanStart() â†’ è¿”å› <span class="hljs-number">5</span> â† ä¸ºä»€ä¹ˆï¼Ÿ
<span class="hljs-type">int</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> getComposingSpanEnd() â†’ è¿”å› <span class="hljs-number">6</span>

<span class="hljs-comment">// 2. delete(5, 6)</span>
text.delete(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>)
<span class="hljs-comment">// text: "12345"</span>
<span class="hljs-comment">// Spanè¢«è‡ªåŠ¨è°ƒæ•´...</span>

<span class="hljs-comment">// 3. insert("qq") å¤±è´¥</span>

<span class="hljs-comment">// 4. setComposingSpans(5, 5)</span>
<span class="hljs-comment">// text: "12345"</span>
<span class="hljs-comment">// Span: [5, 5)</span>
</code></pre>
<h4 data-id="heading-16">4.3 ä¸ºä»€ä¹ˆSpanèŒƒå›´ä¼šä»[6,6)å˜æˆ[5,6)?</h4>
<p><strong>å…³é”®ä»£ç </strong>ï¼šsetComposingSpansçš„å®ç°</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setComposingSpans</span><span class="hljs-params">(Spannable text, <span class="hljs-type">int</span> start, <span class="hljs-type">int</span> end)</span> {
    <span class="hljs-comment">// è·å–[start, end)èŒƒå›´å†…çš„æ‰€æœ‰Span</span>
    <span class="hljs-keyword">final</span> Object[] sps = text.getSpans(start, end, Object.class);
    <span class="hljs-keyword">if</span> (sps != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> sps.length - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) {
            <span class="hljs-keyword">final</span> <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> sps[i];
            <span class="hljs-keyword">if</span> (o == COMPOSING) {
                text.removeSpan(o);
                <span class="hljs-keyword">continue</span>;
            }

            <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">fl</span> <span class="hljs-operator">=</span> text.getSpanFlags(o);
            <span class="hljs-comment">// å…³é”®ï¼šä¿®æ”¹å…¶ä»–Spançš„èŒƒå›´å’Œæ ‡å¿—</span>
            <span class="hljs-keyword">if</span> ((fl &amp; (Spanned.SPAN_COMPOSING | Spanned.SPAN_POINT_MARK_MASK))
                    != (Spanned.SPAN_COMPOSING | SPAN_EXCLUSIVE_EXCLUSIVE)) {
                text.setSpan(o, start, end,
                    (fl &amp; ~SPAN_POINT_MARK_MASK)
                    | SPAN_COMPOSING | SPAN_EXCLUSIVE_EXCLUSIVE);
            }
        }
    }

    <span class="hljs-comment">// è®¾ç½®æ–°çš„COMPOSING Span</span>
    text.setSpan(COMPOSING, start, end,
        SPAN_EXCLUSIVE_EXCLUSIVE | SPAN_COMPOSING);
}
</code></pre>
<p><strong>é—®é¢˜æ ¹æº</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">ç¬¬<span class="hljs-number">1</span>æ¬¡ <span class="hljs-built_in">setComposingSpans</span>(<span class="hljs-number">6</span>, <span class="hljs-number">6</span>):
  - è®¾ç½® COMPOSING Span [<span class="hljs-number">6</span>, <span class="hljs-number">6</span>)
  - texté•¿åº¦: <span class="hljs-number">6</span>
  - æœŸæœ›: Spanåœ¨æ–‡æœ¬æœ«å°¾

ç¬¬<span class="hljs-number">2</span>æ¬¡ <span class="hljs-built_in">insert</span>(<span class="hljs-string">"q"</span>) å¤±è´¥:
  - texté•¿åº¦ä»æ˜¯<span class="hljs-number">6</span>
  - ä½† <span class="hljs-built_in">setComposingSpans</span>(<span class="hljs-number">6</span>, <span class="hljs-number">6</span> + <span class="hljs-string">"q"</span>.<span class="hljs-built_in">length</span>()) æœŸæœ›é•¿åº¦æ˜¯<span class="hljs-number">7</span>
  - SpanèŒƒå›´è®¡ç®—å‡ºç°åå·®

ç¬¬<span class="hljs-number">3</span>æ¬¡ <span class="hljs-built_in">getComposingSpanStart</span>():
  - SpannableStringBuilderå†…éƒ¨çš„Spanä½ç½®è®¡ç®—
  - ç”±äºtexté•¿åº¦ä¸é¢„æœŸä¸ç¬¦
  - è¿”å›äº†é”™è¯¯çš„èµ·å§‹ä½ç½® (<span class="hljs-number">5</span>è€Œä¸æ˜¯<span class="hljs-number">6</span>)

è¿é”ååº”:
  [<span class="hljs-number">6</span>, <span class="hljs-number">6</span>) â†’ deleteä¸æ‰§è¡Œ â†’ [<span class="hljs-number">5</span>, <span class="hljs-number">6</span>) â†’ <span class="hljs-built_in">delete</span>(<span class="hljs-number">5</span>,<span class="hljs-number">6</span>) â†’ [<span class="hljs-number">4</span>, <span class="hljs-number">5</span>) â†’ <span class="hljs-built_in">delete</span>(<span class="hljs-number">4</span>,<span class="hljs-number">5</span>) â†’ ...
  èŒƒå›´é€æ¸å‘å‰æ‰©å±•ï¼Œåå™¬æ›´å¤šå­—ç¬¦ï¼
</code></pre>
<h4 data-id="heading-17">4.4 SpanèŒƒå›´æ‰©å±•çš„å¯è§†åŒ–</h4>
<pre><code class="hljs language-sql" lang="sql">æ–‡æœ¬:     "123456"
ç´¢å¼•:      <span class="hljs-number">012345</span>

ç¬¬<span class="hljs-number">1</span>æ¬¡æ“ä½œå:
  text:  "123456"
  Span:  [<span class="hljs-number">6</span>, <span class="hljs-number">6</span>)  â† ç©ºèŒƒå›´ï¼Œåœ¨<span class="hljs-string">'6'</span>ä¹‹å

ç¬¬<span class="hljs-number">2</span>æ¬¡æ“ä½œ:
  <span class="hljs-number">1.</span> è·å–èŒƒå›´: [<span class="hljs-number">5</span>, <span class="hljs-number">6</span>) â† å¼‚å¸¸ï¼ä¸ºä»€ä¹ˆå˜äº†ï¼Ÿ
  <span class="hljs-number">2.</span> <span class="hljs-keyword">delete</span>(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>): "12345" â† åˆ é™¤<span class="hljs-string">'6'</span>
  <span class="hljs-number">3.</span> <span class="hljs-keyword">insert</span>å¤±è´¥
  <span class="hljs-number">4.</span> è®¾ç½®Span: [<span class="hljs-number">5</span>, <span class="hljs-number">5</span>) â† åœ¨<span class="hljs-string">'5'</span>ä¹‹å

ç¬¬<span class="hljs-number">3</span>æ¬¡æ“ä½œ:
  <span class="hljs-number">1.</span> è·å–èŒƒå›´: [<span class="hljs-number">3</span>, <span class="hljs-number">5</span>) â† ç»§ç»­æ‰©å±•
  <span class="hljs-number">2.</span> <span class="hljs-keyword">delete</span>(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>): "123" â† åˆ é™¤<span class="hljs-string">'4'</span>å’Œ<span class="hljs-string">'5'</span>
  <span class="hljs-number">3.</span> <span class="hljs-keyword">insert</span>å¤±è´¥
  <span class="hljs-number">4.</span> è®¾ç½®Span: [<span class="hljs-number">3</span>, <span class="hljs-number">3</span>)

ç¬¬<span class="hljs-number">4</span>æ¬¡æ“ä½œ:
  <span class="hljs-number">1.</span> è·å–èŒƒå›´: [<span class="hljs-number">0</span>, <span class="hljs-number">3</span>)
  <span class="hljs-number">2.</span> <span class="hljs-keyword">delete</span>(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>): "" â† åˆ é™¤å…¨éƒ¨
</code></pre>
<p><strong>åº•å±‚åŸå› </strong>ï¼šSpannableStringBuilderçš„Spanä½ç½®è®¡ç®—ä¾èµ–æ–‡æœ¬é•¿åº¦ï¼Œå½“å®é™…é•¿åº¦ä¸é¢„æœŸä¸ç¬¦æ—¶ï¼ŒSpançš„<code>start/end</code>ä¼šè¢«é”™è¯¯åœ°è°ƒæ•´ã€‚</p>
<hr/>
<h3 data-id="heading-18">äº”ã€è®¾è®¡ç¼ºé™·çš„å±‚æ¬¡åˆ†æ</h3>
<h4 data-id="heading-19">5.1 æ¥å£å±‚ï¼šfilter()æ— æ³•åŒºåˆ†æ“ä½œç±»å‹</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å½“å‰æ¥å£</span>
CharSequence <span class="hljs-title function_">filter</span><span class="hljs-params">(CharSequence source, <span class="hljs-type">int</span> start, <span class="hljs-type">int</span> end,
                   Spanned dest, <span class="hljs-type">int</span> dstart, <span class="hljs-type">int</span> dend)</span>;
</code></pre>
<p><strong>ç¼ºé™·</strong>ï¼š</p>
<ul>
<li>åªçœ‹åˆ°<code>source</code>ï¼ˆè¦æ’å…¥çš„å†…å®¹ï¼‰</li>
<li>çœ‹ä¸åˆ°æ“ä½œç±»å‹ï¼ˆinsert? delete? replace?ï¼‰</li>
<li>çœ‹ä¸åˆ°æ“ä½œæ¥æºï¼ˆç”¨æˆ·? è¾“å…¥æ³•? ç³»ç»Ÿ?ï¼‰</li>
<li>æ— æ³•åŒºåˆ†"æ’å…¥ç©ºå­—ç¬¦ä¸²"å’Œ"åˆ é™¤æ“ä½œ"</li>
</ul>
<p><strong>ç†æƒ³æ¥å£</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">enum</span> <span class="hljs-title class_">OperationType</span> { INSERT, DELETE, REPLACE }
<span class="hljs-keyword">enum</span> <span class="hljs-title class_">OperationSource</span> { USER_KEY, IME, SYSTEM }

CharSequence <span class="hljs-title function_">filter</span><span class="hljs-params">(CharSequence source, <span class="hljs-type">int</span> start, <span class="hljs-type">int</span> end,
                   Spanned dest, <span class="hljs-type">int</span> dstart, <span class="hljs-type">int</span> dend,
                   OperationType type,     // æ“ä½œç±»å‹
                   OperationSource source)</span>; <span class="hljs-comment">// æ“ä½œæ¥æº</span>
</code></pre>
<h4 data-id="heading-20">5.2 å®ç°å±‚ï¼šreplaceText()ç¼ºä¹åŸå­æ€§</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å½“å‰å®ç°ï¼ˆæœ‰ç¼ºé™·ï¼‰</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">replaceText</span><span class="hljs-params">(CharSequence text, ...)</span> {
    <span class="hljs-keyword">if</span> (b != a) {
        content.delete(a, b); <span class="hljs-comment">// å¯èƒ½åˆ é™¤åˆæ³•å†…å®¹</span>
    }
    <span class="hljs-keyword">if</span> (text != <span class="hljs-literal">null</span>) {
        content.insert(a, text); <span class="hljs-comment">// å¯èƒ½è¢«è¿‡æ»¤</span>
    }
    <span class="hljs-comment">// æ²¡æœ‰å›æ»šæœºåˆ¶ï¼</span>
}
</code></pre>
<p><strong>æ”¹è¿›æ–¹å‘1</strong>ï¼šå…ˆéªŒè¯</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">replaceText</span><span class="hljs-params">(CharSequence text, ...)</span> {
    <span class="hljs-comment">// å…ˆæ£€æŸ¥æ–°æ–‡æœ¬æ˜¯å¦åˆæ³•</span>
    <span class="hljs-keyword">if</span> (text != <span class="hljs-literal">null</span>) {
        <span class="hljs-type">CharSequence</span> <span class="hljs-variable">filtered</span> <span class="hljs-operator">=</span> applyFilters(text, a, a);
        <span class="hljs-keyword">if</span> (filtered.length() == <span class="hljs-number">0</span> &amp;&amp; text.length() &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-comment">// æ–°æ–‡æœ¬è¢«å®Œå…¨è¿‡æ»¤ï¼Œæ”¾å¼ƒæ›¿æ¢</span>
            <span class="hljs-keyword">return</span>;
        }
        text = filtered; <span class="hljs-comment">// ä½¿ç”¨è¿‡æ»¤åçš„å†…å®¹</span>
    }

    <span class="hljs-comment">// å†æ‰§è¡Œæ›¿æ¢</span>
    <span class="hljs-keyword">if</span> (b != a) {
        content.delete(a, b);
    }
    <span class="hljs-keyword">if</span> (text != <span class="hljs-literal">null</span>) {
        content.insert(a, text);
    }
}
</code></pre>
<p><strong>æ”¹è¿›æ–¹å‘2</strong>ï¼šä½¿ç”¨åŸå­replace</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸è¦åˆ†å¼€deleteå’Œinsertï¼Œä½¿ç”¨Editable.replace()</span>
content.replace(a, b, text);
<span class="hljs-comment">// replace()å†…éƒ¨ä¸€æ¬¡æ€§è°ƒç”¨filter</span>
<span class="hljs-comment">// filterå¯ä»¥åŒæ—¶çœ‹åˆ°åˆ é™¤èŒƒå›´[a,b)å’Œæ’å…¥å†…å®¹text</span>
</code></pre>
<h4 data-id="heading-21">5.3 åè®®å±‚ï¼šSpanèŒƒå›´ä¸å¯é </h4>
<p><strong>å½“å‰æœºåˆ¶</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">setComposingSpans</span>(start, end)
  â†’ å‡è®¾æ–‡æœ¬é•¿åº¦ä¼šå˜ä¸ºstart + text<span class="hljs-selector-class">.length</span>()
  â†’ å®é™…: insertå¤±è´¥ï¼Œé•¿åº¦ä¸å˜
  â†’ SpanèŒƒå›´ä¸å®é™…ä¸ç¬¦
  â†’ ä¸‹æ¬¡getComposingSpanStart/<span class="hljs-built_in">End</span>()è¿”å›é”™è¯¯å€¼
</code></pre>
<p><strong>æ”¹è¿›æ–¹å‘</strong>ï¼šå¼•å…¥ç‰ˆæœ¬å·</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ComposingState</span> {
    <span class="hljs-type">int</span> start;
    <span class="hljs-type">int</span> end;
    <span class="hljs-type">int</span> textVersion; <span class="hljs-comment">// æ–‡æœ¬ç‰ˆæœ¬å·</span>

    <span class="hljs-comment">// æ¯æ¬¡æ–‡æœ¬æ“ä½œå¢åŠ ç‰ˆæœ¬å·</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
        textVersion++;
    }

    <span class="hljs-comment">// éªŒè¯SpanèŒƒå›´æ˜¯å¦ä»æœ‰æ•ˆ</span>
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">isValid</span><span class="hljs-params">(<span class="hljs-type">int</span> currentVersion)</span> {
        <span class="hljs-keyword">return</span> textVersion == currentVersion;
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-22">å…­ã€å¯¹æ¯”ï¼šæ­£å¸¸åœºæ™¯ vs Bugåœºæ™¯</h3>
<h4 data-id="heading-23">6.1 æ­£å¸¸åœºæ™¯ï¼šç”¨æˆ·ä¸»åŠ¨åˆ é™¤</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç”¨æˆ·æŒ‰åˆ é™¤é”®</span>
onKeyDown(KeyEvent.KEYCODE_DEL)
  â†“
BaseInputConnection.deleteSurroundingText(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>)
  â†“
Editable.delete(cursorPos - <span class="hljs-number">1</span>, cursorPos)
  â†“
replace(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-string">""</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
  â†“
filter(<span class="hljs-string">""</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"123456"</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>)
  â†“
è¿”å› <span class="hljs-literal">null</span> (æ¥å—)
  â†“
åˆ é™¤æˆåŠŸ âœ“
</code></pre>
<p><strong>è¿™ç§æƒ…å†µä¸‹ï¼Œdeleteåº”è¯¥è¢«å…è®¸</strong>ï¼ˆç”¨æˆ·ä¸»åŠ¨æ“ä½œï¼‰ã€‚</p>
<h4 data-id="heading-24">6.2 Bugåœºæ™¯ï¼šè¾“å…¥æ³•è‡ªåŠ¨æ›¿æ¢</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è¾“å…¥æ³•è°ƒç”¨ setComposingText("qq", 1)</span>
BaseInputConnection.setComposingText(<span class="hljs-string">"qq"</span>, <span class="hljs-number">1</span>)
  â†“
replaceText(<span class="hljs-string">"qq"</span>, <span class="hljs-number">1</span>, <span class="hljs-literal">true</span>)
  â†“
delete(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>) + insert(<span class="hljs-string">"qq"</span>)
  â†“
deleteæˆåŠŸ + insertå¤±è´¥
  â†“
æ•°æ®ä¸¢å¤± âœ—
</code></pre>
<p><strong>è¿™ç§æƒ…å†µä¸‹ï¼Œdeleteæ˜¯"æ›¿æ¢çš„ä¸€éƒ¨åˆ†"ï¼Œåº”è¯¥ä¸insertä¿æŒä¸€è‡´</strong>ã€‚</p>
<h4 data-id="heading-25">6.3 æ ¸å¿ƒå·®å¼‚</h4>






























<table><thead><tr><th>ç»´åº¦</th><th>ç”¨æˆ·åˆ é™¤</th><th>è¾“å…¥æ³•æ›¿æ¢</th></tr></thead><tbody><tr><td><strong>æ“ä½œæ„å›¾</strong></td><td>åˆ é™¤å†…å®¹</td><td>æ›¿æ¢å†…å®¹ï¼ˆdelete+insertï¼‰</td></tr><tr><td><strong>åŸå­æ€§</strong></td><td>å•ä¸ªæ“ä½œ</td><td>ç»„åˆæ“ä½œ</td></tr><tr><td><strong>æ˜¯å¦åº”æ‹¦æˆª</strong></td><td>å¦ï¼ˆå°Šé‡ç”¨æˆ·ï¼‰</td><td>æ˜¯ï¼ˆä¿æŒä¸€è‡´æ€§ï¼‰</td></tr><tr><td><strong>å®é™…è¡Œä¸º</strong></td><td>deleteé€šè¿‡ âœ“</td><td>deleteé€šè¿‡ï¼Œinsertè¢«æ‹’ âœ—</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-26">ä¸ƒã€æ€»ç»“ï¼šè®¾è®¡çš„ä¸å¯¹ç§°æ€§</h3>
<h4 data-id="heading-27">7.1 æ ¸å¿ƒçŸ›ç›¾</h4>
<pre><code class="hljs language-sql" lang="sql">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         æ–‡æœ¬ç¼–è¾‘æ¡†æ¶çš„ä¸å¯¹ç§°æ€§                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  InputFilter çš„æœŸæœ›:                            â”‚
â”‚    æ§åˆ¶æ‰€æœ‰æ–‡æœ¬æ“ä½œ                              â”‚
â”‚                                                 â”‚
â”‚  Editable çš„å®ç°:                               â”‚
â”‚    <span class="hljs-keyword">insert</span>() â†’ ç»è¿‡<span class="hljs-keyword">filter</span> âœ“                     â”‚
â”‚    <span class="hljs-keyword">delete</span>() â†’ ç»•è¿‡<span class="hljs-keyword">filter</span> âœ—                     â”‚
â”‚                                                 â”‚
â”‚  replaceText() çš„å‡è®¾:                          â”‚
â”‚    <span class="hljs-keyword">delete</span>() æ€»æ˜¯æˆåŠŸ                            â”‚
â”‚    <span class="hljs-keyword">insert</span>() ä¹Ÿæ€»æ˜¯æˆåŠŸ                          â”‚
â”‚                                                 â”‚
â”‚  å®é™…åœºæ™¯:                                       â”‚
â”‚    <span class="hljs-keyword">delete</span>() æˆåŠŸ                                â”‚
â”‚    <span class="hljs-keyword">insert</span>() è¢«InputFilteræ‹’ç»                  â”‚
â”‚    â†’ æ•°æ®ä¸¢å¤±                                   â”‚
â”‚                                                 â”‚
â”‚  Span çš„å‰¯ä½œç”¨:                                 â”‚
â”‚    èŒƒå›´è®¡ç®—ä¾èµ–æ–‡æœ¬é•¿åº¦                          â”‚
â”‚    <span class="hljs-keyword">insert</span>å¤±è´¥å¯¼è‡´é•¿åº¦ä¸ç¬¦                        â”‚
â”‚    â†’ èŒƒå›´å¼‚å¸¸æ‰©å±•                               â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 data-id="heading-28">7.2 å¾ªåºæ¸è¿›çš„çŸ¥è¯†é“¾</h4>
<p><strong>ç¬¬ä¸€ç¯‡</strong>ï¼šBinderé€šä¿¡æœºåˆ¶</p>
<ul>
<li>âœ“ ç†è§£äº†è¾“å…¥æ³•â†’åº”ç”¨çš„è·¨è¿›ç¨‹è°ƒç”¨</li>
<li>âœ“ ç†è§£äº†å¼‚æ­¥æ‰§è¡Œå¯¼è‡´çš„ä¿¡æ¯ä¸å¯¹ç§°</li>
<li>â†’ setComposingText("qq")è¢«ä¼ é€’åˆ°åº”ç”¨è¿›ç¨‹</li>
</ul>
<p><strong>ç¬¬äºŒç¯‡ï¼ˆæœ¬æ–‡ï¼‰</strong>ï¼šæ–‡æœ¬ç¼–è¾‘è®¾è®¡ç¼ºé™·</p>
<ul>
<li>âœ“ ç†è§£äº†replaceText()çš„å…ˆdeleteåinsert</li>
<li>âœ“ ç†è§£äº†deleteç»•è¿‡InputFilterçš„æœºåˆ¶</li>
<li>âœ“ ç†è§£äº†SpanèŒƒå›´å¼‚å¸¸æ‰©å±•çš„åŸå› </li>
<li>â†’ ç†è§£äº†ä¸ºä»€ä¹ˆæ•°å­—ä¼šè¢«åˆ é™¤</li>
</ul>
<p><strong>ç¬¬ä¸‰ç¯‡é¢„å‘Š</strong>ï¼šå·¥ç¨‹è§£å†³æ–¹æ¡ˆ</p>
<ul>
<li>å¦‚ä½•åœ¨InputConnectionå±‚æ‹¦æˆªéæ³•ç»„åˆæ–‡æœ¬ï¼Ÿ</li>
<li>å®Œæ•´çš„è§£å†³æ–¹æ¡ˆï¼ˆä¿ç•™æ•°å­—é”®ç›˜ï¼‰</li>
<li>ä¸‰ç§æ–¹æ¡ˆå¯¹æ¯”ä¸æœ€ä½³å®è·µ</li>
<li>â†’ ä»ç†è®ºåˆ°å®è·µ</li>
</ul>
<hr/>
<h3 data-id="heading-29">å‚è€ƒèµ„æ–™</h3>
<ol>
<li>Androidæºç ï¼š<code>frameworks/base/core/java/android/text/SpannableStringBuilder.java</code></li>
<li>Androidæºç ï¼š<code>frameworks/base/core/java/android/view/inputmethod/BaseInputConnection.java</code></li>
<li>Androidæºç ï¼š<code>frameworks/base/core/java/android/text/method/DigitsKeyListener.java</code></li>
<li>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Freference%2Fandroid%2Ftext%2FInputFilter" target="_blank" title="https://developer.android.com/reference/android/text/InputFilter" ref="nofollow noopener noreferrer">InputFilter</a></li>
</ol>
<hr/>
<p><strong>ä¸‹ä¸€ç¯‡</strong>ï¼šã€ŠInputConnectionæœºåˆ¶ä¸è·¨è¿›ç¨‹æ–‡æœ¬æ“ä½œçš„å·¥ç¨‹å®è·µã€‹- å®Œæ•´çš„è§£å†³æ–¹æ¡ˆï¼Œæ—¢ä¿ç•™æ•°å­—é”®ç›˜ï¼Œåˆé¿å…æ•°æ®ä¸¢å¤±</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä½ çŸ¥é“npm create vite æ€ä¹ˆè¿ä½œçš„å—ï¼Ÿå’Œæˆ‘ä¸€èµ·æ¥å†™ä¸€ä¸ªcli]]></title>    <link>https://juejin.cn/post/7570908785293557779</link>    <guid>https://juejin.cn/post/7570908785293557779</guid>    <pubDate>2025-11-10T13:23:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570908785293557779" data-draft-id="7569798982942228516" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä½ çŸ¥é“npm create vite æ€ä¹ˆè¿ä½œçš„å—ï¼Ÿå’Œæˆ‘ä¸€èµ·æ¥å†™ä¸€ä¸ªcli"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,é¢è¯•"/> <meta itemprop="datePublished" content="2025-11-10T13:23:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¥ˆå¾·ä¸½"/> <meta itemprop="url" content="https://juejin.cn/user/620537392934711"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä½ çŸ¥é“npm create vite æ€ä¹ˆè¿ä½œçš„å—ï¼Ÿå’Œæˆ‘ä¸€èµ·æ¥å†™ä¸€ä¸ªcli
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/620537392934711/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¥ˆå¾·ä¸½
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T13:23:05.000Z" title="Mon Nov 10 2025 13:23:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    21
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å¥ˆå¾·ä¸½ã€‚</p>
<p>å‘¨æœ«é—²ç€æ²¡äº‹ï¼Œçªç„¶æƒ³ç ”ç©¶ä¸€ä¸‹ <code>create-vite</code> æ˜¯æ€ä¹ˆå®ç°çš„ã€‚æ‰“å¼€æºç ä¸€çœ‹ï¼Œæˆ‘äººéƒ½å‚»äº†â€”â€”æ ¸å¿ƒé€»è¾‘å°±å‡ ç™¾è¡Œä»£ç ï¼è¿™è®©æˆ‘çªç„¶æ¥äº†å…´è‡´ï¼šæ—¢ç„¶è¿™ä¹ˆç®€å•ï¼Œä¸ºä»€ä¹ˆä¸è‡ªå·±æ’¸ä¸€ä¸ªå‘¢ï¼Ÿ</p>
<p>äºæ˜¯æˆ‘èŠ±äº†ä¸€ä¸ªå‘¨æœ«çš„æ—¶é—´ï¼Œä»é›¶å¼€å§‹å®ç°äº†ä¸€ä¸ªç®€åŒ–ç‰ˆçš„è„šæ‰‹æ¶å·¥å…· <code>custom-create-vite</code>ã€‚è™½ç„¶åŠŸèƒ½æ²¡æœ‰å®˜æ–¹çš„å…¨é¢ï¼Œä½†è¯¥æœ‰çš„éƒ½æœ‰ï¼Œè€Œä¸”è¿˜åŠ äº†ä¸€äº›è‡ªå·±è§‰å¾—å¥½ç”¨çš„ç‰¹æ€§ï¼Œæ¯”å¦‚eslintã€tailwindç­‰ã€‚</p>
<p>ä»Šå¤©å°±æ¥å’Œå¤§å®¶åˆ†äº«ä¸€ä¸‹æ•´ä¸ªå®ç°è¿‡ç¨‹ï¼Œä»¥åŠæˆ‘è¸©è¿‡çš„é‚£äº›å‘ï¼Œå¦‚æœä½ ä¹Ÿæƒ³æœ‰ä¸€ä¸ªè‡ªå·±çš„cliå·¥å…·ï¼Œä¸å¦¨èŠ±å‡ åˆ†é’Ÿçœ‹ä¸€çœ‹ã€‚</p>
<h2 data-id="heading-1">ä¸ºä»€ä¹ˆè¦é€ è¿™ä¸ªè½®å­ï¼Ÿ</h2>
<p>å¯èƒ½æœ‰äººä¼šé—®ï¼šå®˜æ–¹çš„ <code>create-vite</code> ä¸æ˜¯æŒºå¥½ç”¨çš„å—ï¼Ÿå¹²å˜›è¦è‡ªå·±å†™ï¼Ÿ</p>
<p>è¯´å®è¯ï¼Œæˆ‘ä¸»è¦æ˜¯å‡ºäºè¿™å‡ ä¸ªåŸå› ï¼š</p>
<p><strong>1. å­¦ä¹ ç›®çš„</strong></p>
<p>å­¦ä¹ å½“ç„¶æ˜¯ä¸ºäº†è§£å†³è‡ªå·±çš„ç–‘æƒ‘ï¼Œä»¥å‰é€šè¿‡<code>npm create vite</code>ï¼Œä¸çŸ¥é“å®é™…ä¸Šæ˜¯æ€ä¹ˆè¿è¡Œçš„ï¼Œä¹‹å‰ä¸€ç›´ä»¥ä¸ºæˆ‘æ‰§è¡Œäº†è¿™ä¸ªå‘½ä»¤ä¹‹åï¼Œvite cliæ˜¯æ ¹æ®ç”¨æˆ·é€‰æ‹©å®æ—¶åŠ¨æ€ç”Ÿæˆå†…å®¹ï¼Œç®€å•ç‚¹è¯´ï¼Œå°±æ˜¯å½“ä½ åœ¨Vueã€Reactç­‰ä¼—å¤šæ¡†æ¶ä¸­é€‰æ‹©Vueæ—¶ï¼Œcliæ˜¯åŠ¨æ€ç”Ÿæˆäº†vueæ¨¡æ¿ï¼Œå…¶å®ä¸æ˜¯è¿™æ ·ï¼Œå®ƒæ˜¯æå‰åˆ›å»ºäº†å¾ˆå¤šä¸ªtemplateï¼Œæ¯”å¦‚jså’Œtså°±å¯¹åº”äº†ä¸åŒæ¨¡æ¿ï¼Œè€ŒReactå’ŒVueä¹Ÿæ˜¯ï¼Œä»–ä¿©ç»„åˆå°±æœ‰4ä¸ªæ¨¡æ¿ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3b5488ad30d46b3a23de17eb09f1bb9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aWI5b635Li9:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763386516&amp;x-signature=b%2B9krr%2F0kckRX55KtXlXkQSwIMI%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/892a06b59f9c43f297f797bd930445bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aWI5b635Li9:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763386516&amp;x-signature=rfCnateS2kLJx2rpmoyxmdX%2F7xc%3D" alt="image.png" loading="lazy"/></p>
<p><strong>2. å›¢é˜Ÿå®šåˆ¶éœ€æ±‚</strong></p>
<p>æˆ‘ä»¬å›¢é˜Ÿæœ‰ä¸€äº›å›ºå®šçš„å¼€å‘è§„èŒƒï¼Œæ¯”å¦‚ç»Ÿä¸€ç”¨ Antfu çš„ ESLint é…ç½®ã€Tailwind CSS v4 ç­‰ç­‰ã€‚æ¯æ¬¡åˆ›å»ºæ–°é¡¹ç›®éƒ½è¦æ‰‹åŠ¨é…ç½®è¿™äº›ä¸œè¥¿ï¼Œè´¼çƒ¦ã€‚å¦‚æœèƒ½åœ¨è„šæ‰‹æ¶é‡Œé¢„ç½®è¿™äº›é€‰é¡¹ï¼Œé‚£å°±çˆ½æ­ªæ­ªäº†ã€‚</p>
<p><strong>3. æ’ä»¶åŒ–æ‰©å±•</strong></p>
<p>æˆ‘æƒ³å®ç°ä¸€ä¸ªæ’ä»¶ç³»ç»Ÿï¼Œè®©ç”¨æˆ·åœ¨åˆ›å»ºé¡¹ç›®çš„æ—¶å€™å°±èƒ½é€‰æ‹©è¦ä¸è¦è£… ESLintã€Tailwind CSSã€UnoCSS è¿™äº›å·¥å…·ã€‚è¿™æ ·æ–°é¡¹ç›®å¼€ç®±å³ç”¨ï¼Œä¸ç”¨å†æ‰‹åŠ¨é…ç½®ã€‚</p>
<p>åŸºäºè¿™äº›æƒ³æ³•ï¼Œæˆ‘å¼€å§‹åŠ¨æ‰‹äº†ã€‚</p>
<h2 data-id="heading-2">æŠ€æœ¯é€‰å‹</h2>
<p>æ—¢ç„¶æ˜¯ 2025 å¹´äº†ï¼Œé‚£å¿…é¡»å¾—ç”¨ç°ä»£åŒ–çš„æŠ€æœ¯æ ˆï¼š</p>
<ul>
<li><strong>prompts</strong>ï¼šäº¤äº’å¼å‘½ä»¤è¡Œå·¥å…·ï¼ŒAPI ç®€å•ï¼Œä½“ç§¯å°</li>
<li><strong>picocolors</strong>ï¼šç»™ç»ˆç«¯è¾“å‡ºåŠ ç‚¹é¢œè‰²ï¼Œæå‡ç”¨æˆ·ä½“éªŒ</li>
</ul>
<p>æ²¡é”™ï¼Œæ•´ä¸ªé¡¹ç›®åªä¾èµ–è¿™ä¸¤ä¸ªåŒ…ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"prompts"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^2.4.2"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"picocolors"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^1.1.1"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-3">é¡¹ç›®ç»“æ„è®¾è®¡</h2>
<p>åœ¨åŠ¨æ‰‹å†™ä»£ç ä¹‹å‰ï¼Œæˆ‘å…ˆè§„åˆ’äº†ä¸€ä¸‹é¡¹ç›®ä¸»è¦ç»“æ„ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">mini-vite/
â”œâ”€â”€ index.js                    <span class="hljs-comment"># ä¸»å…¥å£æ–‡ä»¶</span>
â”œâ”€â”€ plugins/                    <span class="hljs-comment"># æ’ä»¶ç³»ç»Ÿ</span>
â”‚   â”œâ”€â”€ index.js               <span class="hljs-comment"># æ’ä»¶ç®¡ç†å™¨</span>
â”‚   â”œâ”€â”€ eslint.js              <span class="hljs-comment"># ESLint æ’ä»¶</span>
â”‚   â”œâ”€â”€ tailwind.js            <span class="hljs-comment"># Tailwind CSS æ’ä»¶</span>
â”‚   â””â”€â”€ unocss.js              <span class="hljs-comment"># UnoCSS æ’ä»¶</span>
â”œâ”€â”€ template-vue/              <span class="hljs-comment"># Vue JavaScript æ¨¡æ¿</span>
â”œâ”€â”€ template-vue-ts/           <span class="hljs-comment"># Vue TypeScript æ¨¡æ¿</span>
â”œâ”€â”€ template-react/            <span class="hljs-comment"># React JavaScript æ¨¡æ¿</span>
â”œâ”€â”€ template-react-ts/         <span class="hljs-comment"># React TypeScript æ¨¡æ¿</span>
â””â”€â”€ package.json
</code></pre>
<p>ç»“æ„å¾ˆæ¸…æ™°ï¼š</p>
<ul>
<li>ä¸»é€»è¾‘æ”¾åœ¨ <code>index.js</code></li>
<li>æ’ä»¶ç³»ç»Ÿç‹¬ç«‹æˆ <code>plugins</code> ç›®å½•ï¼Œæ–¹ä¾¿æ‰©å±•</li>
<li>æ¯ä¸ªæ¨¡æ¿éƒ½æ˜¯ç‹¬ç«‹çš„ç›®å½•ï¼ŒåŒ…å«å®Œæ•´çš„é¡¹ç›®æ–‡ä»¶</li>
</ul>
<p>é™¤äº†ä¸»è¦ç›®å½•ï¼Œæˆ‘è¿˜æ­å»ºäº†å·¥ä½œæµï¼Œä»¥åŠgithub åŸç”Ÿdependabotï¼Œå¦‚æœæœ‰å°ä¼™ä¼´æ„Ÿå…´è¶£çš„è¯ï¼ŒåæœŸå¯ä»¥å†™ä¸€ç¯‡æ–‡ç« ä¸“é—¨è®²ä¸€è®²å¦‚ä½•é…ç½®ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/373a8ee2d0794daea52d5f85c3c6591c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aWI5b635Li9:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763386516&amp;x-signature=4r4KzwW503x2myF5tiqinM0Q68g%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-4">æ ¸å¿ƒæµç¨‹å®ç°</h2>
<p>ä¸‹é¢è®²è®²å…·ä½“çš„å®ç°ç»†èŠ‚ã€‚æ•´ä¸ªæµç¨‹å¯ä»¥åˆ†ä¸º 7 ä¸ªæ­¥éª¤ï¼š</p>
<h3 data-id="heading-5">ç¬¬ä¸€æ­¥ï¼šé…ç½®å‘½ä»¤è¡Œå…¥å£</h3>
<p>é¦–å…ˆåœ¨ <code>package.json</code> é‡Œå£°æ˜ bin å­—æ®µï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"mini-vite"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"module"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"bin"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"mini-vite"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"index.js"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"create-mini-vite"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"index.js"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>æ³¨æ„ä¸¤ç‚¹ï¼š</p>
<ol>
<li><strong>type å¿…é¡»è®¾ç½®ä¸º module</strong>ï¼Œè¿™æ ·æ‰èƒ½ç”¨ ES Module è¯­æ³•</li>
<li>æˆ‘é…ç½®äº†ä¸¤ä¸ªå‘½ä»¤åï¼Œç”¨æˆ·å¯ä»¥ç”¨ <code>mini-vite</code> æˆ– <code>create-mini-vite</code>ï¼Œæ€ä¹ˆé¡ºæ‰‹æ€ä¹ˆæ¥</li>
</ol>
<p>ç„¶ååœ¨ <code>index.js</code> å¼€å¤´åŠ ä¸Š shebangï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-meta">#!/usr/bin/env node</span>
</code></pre>
<p>è¿™ä¸€è¡Œå‘Šè¯‰ç³»ç»Ÿç”¨ Node.js æ¥æ‰§è¡Œè¿™ä¸ªæ–‡ä»¶ã€‚æ²¡æœ‰è¿™ä¸€è¡Œï¼Œç›´æ¥è¿è¡Œä¼šæŠ¥é”™ã€‚</p>
<h3 data-id="heading-6">ç¬¬äºŒæ­¥ï¼šè¯¢é—®é¡¹ç›®åç§°</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> prompts <span class="hljs-keyword">from</span> <span class="hljs-string">'prompts'</span>
<span class="hljs-keyword">import</span> colors <span class="hljs-keyword">from</span> <span class="hljs-string">'picocolors'</span>

<span class="hljs-keyword">const</span> { cyan, green, yellow, red, reset } = colors

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`\n<span class="hljs-subst">${cyan(<span class="hljs-string">'Mini Vite'</span>)}</span> - A minimal scaffolding tool\n`</span>)

  <span class="hljs-keyword">let</span> targetDir = <span class="hljs-string">'mini-vite-project'</span>

  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">prompts</span>({
    <span class="hljs-attr">type</span>: <span class="hljs-string">'text'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'projectName'</span>,
    <span class="hljs-attr">message</span>: <span class="hljs-title function_">reset</span>(<span class="hljs-string">'Project name:'</span>),
    <span class="hljs-attr">initial</span>: targetDir,
    <span class="hljs-attr">onState</span>: <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> {
      targetDir = state.<span class="hljs-property">value</span>?.<span class="hljs-title function_">trim</span>() || targetDir
    }
  })

  <span class="hljs-keyword">if</span> (!result.<span class="hljs-property">projectName</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\n'</span> + <span class="hljs-title function_">red</span>(<span class="hljs-string">'âœ–'</span>) + <span class="hljs-string">' Operation cancelled'</span>)
    <span class="hljs-keyword">return</span>
  }
}

<span class="hljs-title function_">init</span>().<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-title function_">red</span>(<span class="hljs-string">'Error:'</span>), e)
  process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">1</span>)
})
</code></pre>
<p>ç”¨ <code>prompts</code> è¯¢é—®ç”¨æˆ·è¾“å…¥é¡¹ç›®åç§°ï¼Œé»˜è®¤æ˜¯ <code>mini-vite-project</code>ã€‚å¦‚æœç”¨æˆ·ç›´æ¥æŒ‰å›è½¦æˆ–è€… Ctrl+C å–æ¶ˆï¼Œå°±é€€å‡ºç¨‹åºã€‚</p>
<h3 data-id="heading-7">ç¬¬ä¸‰æ­¥ï¼šæ£€æŸ¥ç›®å½•æ˜¯å¦å­˜åœ¨</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> fs <span class="hljs-keyword">from</span> <span class="hljs-string">'fs'</span>
<span class="hljs-keyword">import</span> path <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span>

<span class="hljs-keyword">const</span> root = path.<span class="hljs-title function_">join</span>(process.<span class="hljs-title function_">cwd</span>(), targetDir)

<span class="hljs-comment">// åˆ¤æ–­ç›®å½•æ˜¯å¦ä¸ºç©º</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">isEmpty</span>(<span class="hljs-params">path</span>) {
  <span class="hljs-keyword">const</span> files = fs.<span class="hljs-title function_">readdirSync</span>(path)
  <span class="hljs-keyword">return</span> files.<span class="hljs-property">length</span> === <span class="hljs-number">0</span> || (files.<span class="hljs-property">length</span> === <span class="hljs-number">1</span> &amp;&amp; files[<span class="hljs-number">0</span>] === <span class="hljs-string">'.git'</span>)
}

<span class="hljs-comment">// æ¸…ç©ºç›®å½•</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">emptyDir</span>(<span class="hljs-params">dir</span>) {
  <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(dir)) <span class="hljs-keyword">return</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> file <span class="hljs-keyword">of</span> fs.<span class="hljs-title function_">readdirSync</span>(dir)) {
    <span class="hljs-keyword">if</span> (file === <span class="hljs-string">'.git'</span>) <span class="hljs-keyword">continue</span>
    fs.<span class="hljs-title function_">rmSync</span>(path.<span class="hljs-title function_">resolve</span>(dir, file), { <span class="hljs-attr">recursive</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">force</span>: <span class="hljs-literal">true</span> })
  }
}

<span class="hljs-keyword">if</span> (fs.<span class="hljs-title function_">existsSync</span>(root) &amp;&amp; !<span class="hljs-title function_">isEmpty</span>(root)) {
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">prompts</span>({
    <span class="hljs-attr">type</span>: <span class="hljs-string">'select'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'overwrite'</span>,
    <span class="hljs-attr">message</span>: <span class="hljs-string">`Target directory "<span class="hljs-subst">${targetDir}</span>" is not empty. Please choose:`</span>,
    <span class="hljs-attr">choices</span>: [
      { <span class="hljs-attr">title</span>: <span class="hljs-string">'Cancel'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'no'</span> },
      { <span class="hljs-attr">title</span>: <span class="hljs-string">'Remove existing files'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'yes'</span> }
    ]
  })

  <span class="hljs-keyword">if</span> (response.<span class="hljs-property">overwrite</span> === <span class="hljs-string">'no'</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\n'</span> + <span class="hljs-title function_">red</span>(<span class="hljs-string">'âœ–'</span>) + <span class="hljs-string">' Operation cancelled'</span>)
    <span class="hljs-keyword">return</span>
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (response.<span class="hljs-property">overwrite</span> === <span class="hljs-string">'yes'</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`\nRemoving existing files in <span class="hljs-subst">${targetDir}</span>...`</span>)
    <span class="hljs-title function_">emptyDir</span>(root)
  }
}
</code></pre>
<p>è¿™é‡Œæˆ‘è¸©äº†ä¸ªå‘ï¼ä¸€å¼€å§‹æˆ‘ç”¨ <code>fs.rmdirSync()</code>ï¼Œç»“æœå‘ç°å¦‚æœç›®å½•éç©ºå°±ä¼šæŠ¥é”™ã€‚åæ¥æ”¹æˆ <code>fs.rmSync()</code> é…åˆ <code>recursive: true</code>ï¼Œæ‰èƒ½é€’å½’åˆ é™¤æ•´ä¸ªç›®å½•ã€‚</p>
<h3 data-id="heading-8">ç¬¬å››æ­¥ï¼šéªŒè¯åŒ…å</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">isValidPackageName</span>(<span class="hljs-params">projectName</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-regexp">/^(?:@[a-z\d\-*~][a-z\d\-*._~]*\/)?[a-z\d\-~][a-z\d\-._~]*$/</span>.<span class="hljs-title function_">test</span>(projectName)
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">toValidPackageName</span>(<span class="hljs-params">projectName</span>) {
  <span class="hljs-keyword">return</span> projectName
    .<span class="hljs-title function_">trim</span>()
    .<span class="hljs-title function_">toLowerCase</span>()
    .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\s+/g</span>, <span class="hljs-string">'-'</span>)
    .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/^[._]/</span>, <span class="hljs-string">''</span>)
    .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/[^a-z\d\-~]+/g</span>, <span class="hljs-string">'-'</span>)
}

<span class="hljs-keyword">let</span> packageName = path.<span class="hljs-title function_">basename</span>(root)

<span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isValidPackageName</span>(packageName)) {
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">prompts</span>({
    <span class="hljs-attr">type</span>: <span class="hljs-string">'text'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'packageName'</span>,
    <span class="hljs-attr">message</span>: <span class="hljs-title function_">reset</span>(<span class="hljs-string">'Package name:'</span>),
    <span class="hljs-attr">initial</span>: <span class="hljs-title function_">toValidPackageName</span>(packageName),
    <span class="hljs-attr">validate</span>: <span class="hljs-function">(<span class="hljs-params">name</span>) =&gt;</span> <span class="hljs-title function_">isValidPackageName</span>(name) || <span class="hljs-string">'Invalid package name'</span>
  })
  packageName = response.<span class="hljs-property">packageName</span>
}
</code></pre>
<p>npm åŒ…åæœ‰ä¸€å®šçš„è§„èŒƒï¼Œä¸èƒ½æœ‰å¤§å†™å­—æ¯ã€ç©ºæ ¼ã€ç‰¹æ®Šå­—ç¬¦ç­‰ã€‚æ‰€ä»¥éœ€è¦éªŒè¯ä¸€ä¸‹ï¼Œå¦‚æœä¸åˆæ³•å°±æç¤ºç”¨æˆ·é‡æ–°è¾“å…¥ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f3dcf8b3e3046d7bd9ae62a55b9ea7f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aWI5b635Li9:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763386516&amp;x-signature=mCg2bucE19LkPNHly0wD6lIb31o%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-9">ç¬¬äº”æ­¥ï¼šé€‰æ‹©æ¡†æ¶å’Œå˜ä½“</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">FRAMEWORKS</span> = [
  {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'vue'</span>,
    <span class="hljs-attr">display</span>: <span class="hljs-string">'Vue'</span>,
    <span class="hljs-attr">color</span>: green,
    <span class="hljs-attr">variants</span>: [
      { <span class="hljs-attr">name</span>: <span class="hljs-string">'vue-ts'</span>, <span class="hljs-attr">display</span>: <span class="hljs-string">'TypeScript'</span>, <span class="hljs-attr">color</span>: blue },
      { <span class="hljs-attr">name</span>: <span class="hljs-string">'vue'</span>, <span class="hljs-attr">display</span>: <span class="hljs-string">'JavaScript'</span>, <span class="hljs-attr">color</span>: yellow }
    ]
  },
  {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'react'</span>,
    <span class="hljs-attr">display</span>: <span class="hljs-string">'React'</span>,
    <span class="hljs-attr">color</span>: cyan,
    <span class="hljs-attr">variants</span>: [
      { <span class="hljs-attr">name</span>: <span class="hljs-string">'react-ts'</span>, <span class="hljs-attr">display</span>: <span class="hljs-string">'TypeScript'</span>, <span class="hljs-attr">color</span>: blue },
      { <span class="hljs-attr">name</span>: <span class="hljs-string">'react'</span>, <span class="hljs-attr">display</span>: <span class="hljs-string">'JavaScript'</span>, <span class="hljs-attr">color</span>: yellow }
    ]
  }
]

<span class="hljs-comment">// é€‰æ‹©æ¡†æ¶</span>
<span class="hljs-keyword">const</span> frameworkResponse = <span class="hljs-keyword">await</span> <span class="hljs-title function_">prompts</span>({
  <span class="hljs-attr">type</span>: <span class="hljs-string">'select'</span>,
  <span class="hljs-attr">name</span>: <span class="hljs-string">'framework'</span>,
  <span class="hljs-attr">message</span>: <span class="hljs-title function_">reset</span>(<span class="hljs-string">'Select a framework:'</span>),
  <span class="hljs-attr">choices</span>: <span class="hljs-variable constant_">FRAMEWORKS</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">framework</span> =&gt;</span> ({
    <span class="hljs-attr">title</span>: framework.<span class="hljs-title function_">color</span>(framework.<span class="hljs-property">display</span>),
    <span class="hljs-attr">value</span>: framework
  }))
})

<span class="hljs-keyword">const</span> framework = frameworkResponse.<span class="hljs-property">framework</span>

<span class="hljs-keyword">if</span> (!framework) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\n'</span> + <span class="hljs-title function_">red</span>(<span class="hljs-string">'âœ–'</span>) + <span class="hljs-string">' Operation cancelled'</span>)
  <span class="hljs-keyword">return</span>
}

<span class="hljs-comment">// é€‰æ‹©å˜ä½“ï¼ˆTypeScript æˆ– JavaScriptï¼‰</span>
<span class="hljs-keyword">const</span> variantResponse = <span class="hljs-keyword">await</span> <span class="hljs-title function_">prompts</span>({
  <span class="hljs-attr">type</span>: <span class="hljs-string">'select'</span>,
  <span class="hljs-attr">name</span>: <span class="hljs-string">'variant'</span>,
  <span class="hljs-attr">message</span>: <span class="hljs-title function_">reset</span>(<span class="hljs-string">'Select a variant:'</span>),
  <span class="hljs-attr">choices</span>: framework.<span class="hljs-property">variants</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">variant</span> =&gt;</span> ({
    <span class="hljs-attr">title</span>: variant.<span class="hljs-title function_">color</span>(variant.<span class="hljs-property">display</span>),
    <span class="hljs-attr">value</span>: variant.<span class="hljs-property">name</span>
  }))
})

<span class="hljs-keyword">const</span> template = variantResponse.<span class="hljs-property">variant</span>
</code></pre>
<p>è¿™é‡Œæˆ‘ç”¨äº†ä¸¤çº§é€‰æ‹©ï¼šå…ˆé€‰æ¡†æ¶ï¼ˆVue æˆ– Reactï¼‰ï¼Œå†é€‰å˜ä½“ï¼ˆTypeScript æˆ– JavaScriptï¼‰ã€‚è¿™æ ·äº¤äº’æ›´æ¸…æ™°ï¼Œç”¨æˆ·ä½“éªŒæ›´å¥½ã€‚</p>
<p>æ¯ä¸ªé€‰é¡¹éƒ½ç”¨ä¸åŒçš„é¢œè‰²æ ‡è¯†ï¼Œè§†è§‰æ•ˆæœæ›´å‹å¥½ã€‚</p>
<h3 data-id="heading-10">ç¬¬å…­æ­¥ï¼šé€‰æ‹©å¢å¼ºåŠŸèƒ½ï¼ˆæ’ä»¶ç³»ç»Ÿï¼‰</h3>
<p>è¿™æ˜¯æˆ‘è§‰å¾—æœ€æœ‰æ„æ€çš„éƒ¨åˆ†ï¼ä¸€å¼€å§‹æˆ‘vite cli çš„swcä¹Ÿæ˜¯åŠ¨æ€æ’å…¥çš„ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰è¿™ç§æ’ä»¶æ¨¡å—ï¼Œæˆ‘æƒ³äº†ä¸€ä¸‹è¿˜æ˜¯é€šè¿‡å•ç‹¬çš„æ¨¡å—æ¥å®ç°ä¸€ä¸ªæ’ä»¶ç³»ç»Ÿï¼Œå› ä¸ºåç»­ä¼šæ‰©å±•æ›´å¤šçš„æ’ä»¶ï¼Œè¿™æ ·å¯æ‰©å±•æ€§ä¹Ÿæ›´é«˜ç‚¹</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 5. é€‰æ‹©å¢å¼ºåŠŸèƒ½ï¼ˆå¯é€‰ï¼‰</span>
  <span class="hljs-keyword">const</span> featuresResponse = <span class="hljs-keyword">await</span> <span class="hljs-title function_">prompts</span>([
    {
      <span class="hljs-attr">type</span>: <span class="hljs-string">'multiselect'</span>,
      <span class="hljs-attr">name</span>: <span class="hljs-string">'features'</span>,
      <span class="hljs-attr">message</span>: <span class="hljs-title function_">reset</span>(<span class="hljs-string">'Select additional features:'</span>),
      <span class="hljs-comment">//æŠŠå¤šé€‰ä¸€çš„æ’ä»¶æ’é™¤æ‰</span>
      <span class="hljs-attr">choices</span>: <span class="hljs-title function_">getPluginChoices</span>().<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">choice</span> =&gt;</span> ![<span class="hljs-string">'tailwind'</span>, <span class="hljs-string">'unocss'</span>].<span class="hljs-title function_">includes</span>(choice.<span class="hljs-property">value</span>)),
      <span class="hljs-attr">hint</span>: <span class="hljs-string">'- Space to select. Return to submit'</span>,
      <span class="hljs-attr">instructions</span>: <span class="hljs-literal">false</span>
    }
  ])

  <span class="hljs-keyword">const</span> selectedFeatures = featuresResponse.<span class="hljs-property">features</span> || []

  <span class="hljs-comment">// 6. é€‰æ‹© CSS æ¡†æ¶ï¼ˆå•é€‰ï¼Œå¯é€‰ï¼‰</span>
  <span class="hljs-keyword">const</span> cssFrameworkResponse = <span class="hljs-keyword">await</span> <span class="hljs-title function_">prompts</span>({
    <span class="hljs-attr">type</span>: <span class="hljs-string">'select'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'cssFramework'</span>,
    <span class="hljs-attr">message</span>: <span class="hljs-title function_">reset</span>(<span class="hljs-string">'Select a CSS framework (optional):'</span>),
    <span class="hljs-attr">choices</span>: [
      { <span class="hljs-attr">title</span>: <span class="hljs-string">'None'</span>, <span class="hljs-attr">value</span>: <span class="hljs-literal">null</span> },
      { <span class="hljs-attr">title</span>: <span class="hljs-string">'Tailwind CSS v4'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'tailwind'</span>, <span class="hljs-attr">description</span>: <span class="hljs-string">'Utility-first CSS framework'</span> },
      { <span class="hljs-attr">title</span>: <span class="hljs-string">'UnoCSS'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'unocss'</span>, <span class="hljs-attr">description</span>: <span class="hljs-string">'Instant on-demand Atomic CSS'</span> }
    ]
  })

  <span class="hljs-keyword">if</span> (cssFrameworkResponse.<span class="hljs-property">cssFramework</span>) {
    selectedFeatures.<span class="hljs-title function_">push</span>(cssFrameworkResponse.<span class="hljs-property">cssFramework</span>)
  }
</code></pre>
<p>æˆ‘æŠŠæ’ä»¶åˆ†æˆäº†ä¸¤ç±»ï¼š</p>
<ol>
<li><strong>é€šç”¨åŠŸèƒ½</strong>ï¼šESLintï¼ˆå¤šé€‰ï¼‰ç­‰ä¸èƒ½åŒæ—¶é€‰æ‹©çš„æ‰©å±•</li>
<li><strong>CSS æ¡†æ¶</strong>ï¼šTailwind CSS æˆ– UnoCSSï¼ˆå•é€‰ï¼‰</li>
</ol>
<p>ä¸ºä»€ä¹ˆè¦åˆ†å¼€å‘¢ï¼Ÿå› ä¸º CSS æ¡†æ¶æ˜¯äº’æ–¥çš„ï¼Œä¸èƒ½åŒæ—¶è£… Tailwind å’Œ UnoCSSï¼Œä¼šå†²çªã€‚æ‰€ä»¥å¿…é¡»ç”¨å•é€‰ã€‚</p>
<h3 data-id="heading-11">ç¬¬ä¸ƒæ­¥ï¼šå¤åˆ¶æ¨¡æ¿å¹¶åº”ç”¨æ’ä»¶</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { fileURLToPath } <span class="hljs-keyword">from</span> <span class="hljs-string">'url'</span>
<span class="hljs-keyword">import</span> { applyPlugins } <span class="hljs-keyword">from</span> <span class="hljs-string">'./plugins/index.js'</span>

<span class="hljs-keyword">const</span> currentDir = path.<span class="hljs-title function_">dirname</span>(<span class="hljs-title function_">fileURLToPath</span>(<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>))
<span class="hljs-keyword">const</span> templateDir = path.<span class="hljs-title function_">resolve</span>(currentDir, <span class="hljs-string">`template-<span class="hljs-subst">${template}</span>`</span>)

<span class="hljs-comment">// å¤åˆ¶æ–‡ä»¶çš„å·¥å…·å‡½æ•°</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">copy</span>(<span class="hljs-params">src, dest</span>) {
  <span class="hljs-keyword">const</span> stat = fs.<span class="hljs-title function_">statSync</span>(src)
  <span class="hljs-keyword">if</span> (stat.<span class="hljs-title function_">isDirectory</span>()) {
    <span class="hljs-title function_">copyDir</span>(src, dest)
  } <span class="hljs-keyword">else</span> {
    fs.<span class="hljs-title function_">copyFileSync</span>(src, dest)
  }
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">copyDir</span>(<span class="hljs-params">srcDir, destDir</span>) {
  fs.<span class="hljs-title function_">mkdirSync</span>(destDir, { <span class="hljs-attr">recursive</span>: <span class="hljs-literal">true</span> })
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> file <span class="hljs-keyword">of</span> fs.<span class="hljs-title function_">readdirSync</span>(srcDir)) {
    <span class="hljs-keyword">const</span> srcFile = path.<span class="hljs-title function_">resolve</span>(srcDir, file)
    <span class="hljs-keyword">const</span> destFile = path.<span class="hljs-title function_">resolve</span>(destDir, file)
    <span class="hljs-title function_">copy</span>(srcFile, destFile)
  }
}

<span class="hljs-comment">// åˆ›å»ºç›®æ ‡ç›®å½•</span>
fs.<span class="hljs-title function_">mkdirSync</span>(root, { <span class="hljs-attr">recursive</span>: <span class="hljs-literal">true</span> })

<span class="hljs-comment">// å¤åˆ¶æ¨¡æ¿æ–‡ä»¶</span>
<span class="hljs-keyword">const</span> files = fs.<span class="hljs-title function_">readdirSync</span>(templateDir)
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> file <span class="hljs-keyword">of</span> files.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f !== <span class="hljs-string">'package.json'</span>)) {
  <span class="hljs-keyword">const</span> srcFile = path.<span class="hljs-title function_">join</span>(templateDir, file)
  <span class="hljs-keyword">const</span> destFile = path.<span class="hljs-title function_">join</span>(root, file)
  <span class="hljs-title function_">copy</span>(srcFile, destFile)
}

<span class="hljs-comment">// è¯»å–å¹¶ä¿®æ”¹ package.json</span>
<span class="hljs-keyword">const</span> pkgPath = path.<span class="hljs-title function_">join</span>(templateDir, <span class="hljs-string">'package.json'</span>)
<span class="hljs-keyword">const</span> pkg = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(fs.<span class="hljs-title function_">readFileSync</span>(pkgPath, <span class="hljs-string">'utf-8'</span>))
pkg.<span class="hljs-property">name</span> = packageName

<span class="hljs-comment">// åº”ç”¨é€‰ä¸­çš„æ’ä»¶</span>
<span class="hljs-title function_">applyPlugins</span>(selectedFeatures, root, template, pkg)

<span class="hljs-comment">// å†™å…¥ package.json</span>
fs.<span class="hljs-title function_">writeFileSync</span>(
  path.<span class="hljs-title function_">join</span>(root, <span class="hljs-string">'package.json'</span>),
  <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(pkg, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>) + <span class="hljs-string">'\n'</span>
)
</code></pre>
<p>è¿™é‡Œæœ‰ä¸ªå°ç»†èŠ‚ï¼šå› ä¸ºç”¨äº† ES Moduleï¼Œæ²¡æœ‰ <code>__dirname</code> å˜é‡ï¼Œæ‰€ä»¥è¦ç”¨ <code>import.meta.url</code> é…åˆ <code>fileURLToPath</code> æ¥è·å–å½“å‰æ–‡ä»¶è·¯å¾„ã€‚</p>
<p>å¤åˆ¶æ–‡ä»¶çš„é€»è¾‘å¾ˆç®€å•ï¼šé€’å½’éå†æ¨¡æ¿ç›®å½•ï¼ŒæŠŠæ¯ä¸ªæ–‡ä»¶éƒ½å¤åˆ¶åˆ°ç›®æ ‡ç›®å½•ã€‚</p>
<p>æœ€å…³é”®çš„æ˜¯ <code>applyPlugins</code> è¿™ä¸€æ­¥ï¼Œå®ƒä¼šæ ¹æ®ç”¨æˆ·é€‰æ‹©çš„æ’ä»¶ï¼ŒåŠ¨æ€ä¿®æ”¹é¡¹ç›®é…ç½®ã€‚</p>
<h2 data-id="heading-12">æ’ä»¶ç³»ç»Ÿçš„è®¾è®¡</h2>
<p>æ’ä»¶ç³»ç»Ÿæ˜¯æ•´ä¸ªé¡¹ç›®çš„æ ¸å¿ƒï¼Œæˆ‘èŠ±äº†ä¸å°‘æ—¶é—´æ¥è®¾è®¡å®ƒçš„æ¶æ„ã€‚</p>
<h3 data-id="heading-13">æ’ä»¶çš„æ ‡å‡†ç»“æ„</h3>
<p>æ¯ä¸ªæ’ä»¶éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ JS æ–‡ä»¶ï¼Œå¯¼å‡ºä¸€ä¸ªå¯¹è±¡ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// plugins/eslint.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> eslintPlugin = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'eslint'</span>,
  <span class="hljs-attr">title</span>: <span class="hljs-string">'ESLint + Prettier (Antfu Config)'</span>,
  <span class="hljs-attr">description</span>: <span class="hljs-string">'Code quality and formatting'</span>,
  
  <span class="hljs-title function_">setup</span>(<span class="hljs-params">root, template, pkg</span>) {
    <span class="hljs-comment">// 1. æ·»åŠ ä¾èµ–</span>
    pkg.<span class="hljs-property">devDependencies</span> = pkg.<span class="hljs-property">devDependencies</span> || {}
    pkg.<span class="hljs-property">devDependencies</span>[<span class="hljs-string">'eslint'</span>] = <span class="hljs-string">'^9.39.1'</span>
    pkg.<span class="hljs-property">devDependencies</span>[<span class="hljs-string">'@antfu/eslint-config'</span>] = <span class="hljs-string">'^6.2.0'</span>
  
    <span class="hljs-comment">// 2. åˆ›å»ºé…ç½®æ–‡ä»¶</span>
    <span class="hljs-keyword">const</span> configContent = <span class="hljs-string">`import antfu from '@antfu/eslint-config'

export default antfu()`</span>
  
    fs.<span class="hljs-title function_">writeFileSync</span>(
      path.<span class="hljs-title function_">join</span>(root, <span class="hljs-string">'eslint.config.js'</span>),
      configContent
    )
  
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${green(<span class="hljs-string">'âœ”'</span>)}</span> ESLint configured`</span>)
  }
}
</code></pre>
<p>æ¯ä¸ªæ’ä»¶åŒ…å«ï¼š</p>
<ul>
<li><strong>name</strong>ï¼šæ’ä»¶æ ‡è¯†</li>
<li><strong>title</strong>ï¼šæ˜¾ç¤ºç»™ç”¨æˆ·çœ‹çš„åç§°</li>
<li><strong>description</strong>ï¼šç®€çŸ­æè¿°</li>
<li><strong>setup</strong>ï¼šå®‰è£…å‡½æ•°ï¼Œæ¥æ”¶ <code>root</code>ï¼ˆé¡¹ç›®ç›®å½•ï¼‰ã€<code>template</code>ï¼ˆæ¨¡æ¿åç§°ï¼‰ã€<code>pkg</code>ï¼ˆpackage.json å¯¹è±¡ï¼‰ä¸‰ä¸ªå‚æ•°</li>
</ul>
<h3 data-id="heading-14">æ’ä»¶ç®¡ç†å™¨</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// plugins/index.js</span>
<span class="hljs-keyword">import</span> { eslintPlugin } <span class="hljs-keyword">from</span> <span class="hljs-string">'./eslint.js'</span>
<span class="hljs-keyword">import</span> { tailwindPlugin } <span class="hljs-keyword">from</span> <span class="hljs-string">'./tailwind.js'</span>
<span class="hljs-keyword">import</span> { unocssPlugin } <span class="hljs-keyword">from</span> <span class="hljs-string">'./unocss.js'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> plugins = {
  <span class="hljs-attr">eslint</span>: eslintPlugin,
  <span class="hljs-attr">tailwind</span>: tailwindPlugin,
  <span class="hljs-attr">unocss</span>: unocssPlugin
}

<span class="hljs-comment">// æ’ä»¶æ‰§è¡Œé¡ºåº</span>
<span class="hljs-keyword">const</span> pluginOrder = {
  <span class="hljs-attr">eslint</span>: <span class="hljs-number">1</span>,
  <span class="hljs-attr">tailwind</span>: <span class="hljs-number">2</span>,
  <span class="hljs-attr">unocss</span>: <span class="hljs-number">2</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">applyPlugins</span>(<span class="hljs-params">selectedPlugins, root, template, pkg</span>) {
  <span class="hljs-comment">// æŒ‰ä¼˜å…ˆçº§æ’åº</span>
  <span class="hljs-keyword">const</span> sortedPlugins = [...selectedPlugins].<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> orderA = pluginOrder[a] || <span class="hljs-number">999</span>
    <span class="hljs-keyword">const</span> orderB = pluginOrder[b] || <span class="hljs-number">999</span>
    <span class="hljs-keyword">return</span> orderA - orderB
  })
  
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> pluginName <span class="hljs-keyword">of</span> sortedPlugins) {
    <span class="hljs-keyword">const</span> plugin = plugins[pluginName]
  
    <span class="hljs-keyword">if</span> (!plugin) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`<span class="hljs-subst">${red(<span class="hljs-string">'âœ–'</span>)}</span> Plugin "<span class="hljs-subst">${pluginName}</span>" not found`</span>)
      <span class="hljs-keyword">continue</span>
    }
  
    <span class="hljs-keyword">try</span> {
      plugin.<span class="hljs-title function_">setup</span>(root, template, pkg)
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`<span class="hljs-subst">${red(<span class="hljs-string">'âœ–'</span>)}</span> Failed to configure <span class="hljs-subst">${plugin.title}</span>`</span>)
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`   <span class="hljs-subst">${error.message}</span>`</span>)
    }
  }
}
</code></pre>
<p>æ’ä»¶ç®¡ç†å™¨è´Ÿè´£ï¼š</p>
<ol>
<li>æŒ‰ä¼˜å…ˆçº§æ’åºæ’ä»¶ï¼ˆESLint è¦å…ˆæ‰§è¡Œï¼ŒCSS æ¡†æ¶åæ‰§è¡Œï¼‰</li>
<li>ä¾æ¬¡è°ƒç”¨æ¯ä¸ªæ’ä»¶çš„ <code>setup</code> æ–¹æ³•</li>
<li>é”™è¯¯å¤„ç†ï¼Œé˜²æ­¢æŸä¸ªæ’ä»¶å¤±è´¥å¯¼è‡´æ•´ä¸ªæµç¨‹å´©æºƒ</li>
</ol>
<h3 data-id="heading-15">Tailwind CSS v4 æ’ä»¶</h3>
<p>è¿™é‡Œæˆ‘åˆè¸©äº†ä¸ªå‘ï¼</p>
<p>Tailwind CSS v4 çš„é…ç½®æ–¹å¼å’Œ v3 å®Œå…¨ä¸åŒã€‚v3 éœ€è¦åˆ›å»º <code>tailwind.config.js</code> å’Œ <code>postcss.config.js</code>ï¼Œä½† v4 ç®€åŒ–äº†å¾ˆå¤šï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// plugins/tailwind.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> tailwindPlugin = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'tailwind'</span>,
  <span class="hljs-attr">title</span>: <span class="hljs-string">'Tailwind CSS v4'</span>,
  <span class="hljs-attr">description</span>: <span class="hljs-string">'Utility-first CSS framework'</span>,
  
  <span class="hljs-title function_">setup</span>(<span class="hljs-params">root, template, pkg</span>) {
    <span class="hljs-comment">// 1. æ·»åŠ ä¾èµ–</span>
    pkg.<span class="hljs-property">devDependencies</span>[<span class="hljs-string">'tailwindcss'</span>] = <span class="hljs-string">'^4.1.0'</span>
    pkg.<span class="hljs-property">devDependencies</span>[<span class="hljs-string">'@tailwindcss/vite'</span>] = <span class="hljs-string">'^4.1.0'</span>
  
    <span class="hljs-comment">// 2. åˆ›å»º CSS æ–‡ä»¶</span>
    <span class="hljs-keyword">const</span> cssPath = path.<span class="hljs-title function_">join</span>(root, <span class="hljs-string">'src/index.css'</span>)
    fs.<span class="hljs-title function_">writeFileSync</span>(cssPath, <span class="hljs-string">'@import "tailwindcss";\n'</span>)
  
    <span class="hljs-comment">// 3. ä¿®æ”¹ vite.config.js</span>
    <span class="hljs-keyword">const</span> viteConfigPath = path.<span class="hljs-title function_">join</span>(root, <span class="hljs-string">'vite.config.js'</span>)
    <span class="hljs-keyword">let</span> viteConfig = fs.<span class="hljs-title function_">readFileSync</span>(viteConfigPath, <span class="hljs-string">'utf-8'</span>)
  
    <span class="hljs-comment">// åœ¨ import åŒºåŸŸæ·»åŠ </span>
    viteConfig = viteConfig.<span class="hljs-title function_">replace</span>(
      <span class="hljs-regexp">/(import .+ from .+\n)/</span>,
      <span class="hljs-string">`$1import tailwindcss from '@tailwindcss/vite'\n`</span>
    )
  
    <span class="hljs-comment">// åœ¨ plugins æ•°ç»„æ·»åŠ </span>
    viteConfig = viteConfig.<span class="hljs-title function_">replace</span>(
      <span class="hljs-regexp">/plugins:\s*\[/</span>,
      <span class="hljs-string">'plugins: [tailwindcss(), '</span>
    )
  
    fs.<span class="hljs-title function_">writeFileSync</span>(viteConfigPath, viteConfig)
  
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${green(<span class="hljs-string">'âœ”'</span>)}</span> Tailwind CSS v4 configured`</span>)
  }
}
</code></pre>
<p>è¿™é‡Œé‡‡ç”¨çš„æœ€æ–°ç‰ˆçš„v4 tailwindcssï¼Œv4 çš„é…ç½®æ­¥éª¤ï¼š</p>
<ol>
<li>å®‰è£… <code>tailwindcss</code> å’Œ <code>@tailwindcss/vite</code></li>
<li>åœ¨ CSS æ–‡ä»¶é‡Œå†™ <code>@import "tailwindcss";</code></li>
<li>åœ¨ <code>vite.config.js</code> å¼•å…¥ Vite æ’ä»¶</li>
</ol>
<p><strong>ä¸éœ€è¦</strong>åˆ›å»º <code>tailwind.config.js</code> å’Œ <code>postcss.config.js</code>ï¼</p>
<h3 data-id="heading-16">UnoCSS æ’ä»¶</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// plugins/unocss.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> unocssPlugin = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'unocss'</span>,
  <span class="hljs-attr">title</span>: <span class="hljs-string">'UnoCSS'</span>,
  <span class="hljs-attr">description</span>: <span class="hljs-string">'Instant on-demand Atomic CSS'</span>,
  
  <span class="hljs-title function_">setup</span>(<span class="hljs-params">root, template, pkg</span>) {
    <span class="hljs-comment">// 1. æ·»åŠ ä¾èµ–</span>
    pkg.<span class="hljs-property">devDependencies</span>[<span class="hljs-string">'unocss'</span>] = <span class="hljs-string">'^0.64.6'</span>
  
    <span class="hljs-comment">// 2. åˆ›å»ºé…ç½®æ–‡ä»¶</span>
    <span class="hljs-keyword">const</span> configContent = <span class="hljs-string">`import { defineConfig } from 'unocss'

export default defineConfig({
  // ä½ çš„é…ç½®
})`</span>
  
    fs.<span class="hljs-title function_">writeFileSync</span>(
      path.<span class="hljs-title function_">join</span>(root, <span class="hljs-string">'uno.config.ts'</span>),
      configContent
    )
  
    <span class="hljs-comment">// 3. ä¿®æ”¹ vite.config.js</span>
    <span class="hljs-keyword">const</span> viteConfigPath = path.<span class="hljs-title function_">join</span>(root, <span class="hljs-string">'vite.config.js'</span>)
    <span class="hljs-keyword">let</span> viteConfig = fs.<span class="hljs-title function_">readFileSync</span>(viteConfigPath, <span class="hljs-string">'utf-8'</span>)
  
    viteConfig = viteConfig.<span class="hljs-title function_">replace</span>(
      <span class="hljs-regexp">/(import .+ from .+\n)/</span>,
      <span class="hljs-string">`$1import UnoCSS from 'unocss/vite'\n`</span>
    )
  
    viteConfig = viteConfig.<span class="hljs-title function_">replace</span>(
      <span class="hljs-regexp">/plugins:\s*\[/</span>,
      <span class="hljs-string">'plugins: [UnoCSS(), '</span>
    )
  
    fs.<span class="hljs-title function_">writeFileSync</span>(viteConfigPath, viteConfig)
  
    <span class="hljs-comment">// 4. ä¿®æ”¹ main å…¥å£æ–‡ä»¶</span>
    <span class="hljs-keyword">const</span> isVue = template.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'vue'</span>)
    <span class="hljs-keyword">const</span> mainFile = isVue ? <span class="hljs-string">'main.js'</span> : <span class="hljs-string">'main.jsx'</span>
    <span class="hljs-keyword">const</span> mainPath = path.<span class="hljs-title function_">join</span>(root, <span class="hljs-string">'src'</span>, mainFile)
    <span class="hljs-keyword">let</span> mainContent = fs.<span class="hljs-title function_">readFileSync</span>(mainPath, <span class="hljs-string">'utf-8'</span>)
  
    mainContent = <span class="hljs-string">`import 'virtual:uno.css'\n<span class="hljs-subst">${mainContent}</span>`</span>
  
    fs.<span class="hljs-title function_">writeFileSync</span>(mainPath, mainContent)
  
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${green(<span class="hljs-string">'âœ”'</span>)}</span> UnoCSS configured`</span>)
  }
}
</code></pre>
<p>UnoCSS çš„é…ç½®ç›¸å¯¹å¤æ‚ä¸€ç‚¹ï¼š</p>
<ol>
<li>åˆ›å»º <code>uno.config.ts</code></li>
<li>ä¿®æ”¹ <code>vite.config.js</code> å¼•å…¥æ’ä»¶</li>
<li>åœ¨å…¥å£æ–‡ä»¶ï¼ˆ<code>main.js</code> æˆ– <code>main.jsx</code>ï¼‰å¼•å…¥ <code>virtual:uno.css</code></li>
</ol>
<h2 data-id="heading-17">æ¨¡æ¿è®¾è®¡</h2>
<p>å› ä¸ºå¹³å¸¸ä¸»è¦ç”¨Vueå’ŒReactæ¯”è¾ƒå¤šï¼Œæˆ‘ä¸º Vue å’Œ React å„å‡†å¤‡äº† JS å’Œ TS ä¸¤ä¸ªç‰ˆæœ¬ï¼Œä¸€å…± 4 ä¸ªæ¨¡æ¿ã€‚</p>
<h3 data-id="heading-18">Vue æ¨¡æ¿</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">template</span>-vue/
â”œâ”€â”€ index.html
â”œâ”€â”€ vite.config.js
â”œâ”€â”€ package.json
â”œâ”€â”€ <span class="hljs-keyword">public</span>/
â”‚   â””â”€â”€ vite.svg
â””â”€â”€ src/
    â”œâ”€â”€ main.js
    â”œâ”€â”€ App.vue
    â”œâ”€â”€ style.css
    â”œâ”€â”€ components/
    â”‚   â””â”€â”€ HelloWorld.vue
    â””â”€â”€ assets/
        â””â”€â”€ vue.svg
</code></pre>
<p><strong>package.json</strong>ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite-project"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"private"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"module"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite build"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"preview"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite preview"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"vue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^3.5.13"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"@vitejs/plugin-vue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^5.2.1"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"vite"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^6.0.5"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>vite.config.js</strong>ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-vue'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [<span class="hljs-title function_">vue</span>()]
})
</code></pre>
<h3 data-id="heading-19">React æ¨¡æ¿</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">template</span>-react/
â”œâ”€â”€ index.html
â”œâ”€â”€ vite.config.js
â”œâ”€â”€ package.json
â”œâ”€â”€ <span class="hljs-keyword">public</span>/
â”‚   â””â”€â”€ vite.svg
â””â”€â”€ src/
    â”œâ”€â”€ main.jsx
    â”œâ”€â”€ App.jsx
    â”œâ”€â”€ index.css
    â”œâ”€â”€ components/
    â”‚   â””â”€â”€ Counter.jsx
    â””â”€â”€ assets/
        â””â”€â”€ react.svg
</code></pre>
<p><strong>package.json</strong>ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite-project"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"private"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"module"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite build"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"preview"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite preview"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"react"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^18.3.1"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"react-dom"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^18.3.1"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"@vitejs/plugin-react"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.3.4"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"@types/react"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^18.3.18"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"@types/react-dom"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^18.3.5"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"vite"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^6.0.5"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>TypeScript ç‰ˆæœ¬å°±æ˜¯åœ¨ä¸Šé¢çš„åŸºç¡€ä¸Šï¼š</p>
<ol>
<li>æ·»åŠ  <code>tsconfig.json</code> å’Œ <code>tsconfig.node.json</code></li>
<li>æ–‡ä»¶åç¼€æ”¹æˆ <code>.ts</code> æˆ– <code>.tsx</code></li>
<li><code>package.json</code> é‡ŒåŠ ä¸Š <code>typescript</code> ä¾èµ–</li>
</ol>
<h2 data-id="heading-20">ä½¿ç”¨æ–¹å¼</h2>
<p>å¼€å‘é˜¶æ®µï¼Œå¯ä»¥ç”¨<code>node index.js</code>æˆ–åˆ™æ˜¯ä½¿ç”¨ <code>npm link</code> æŠŠå‘½ä»¤é“¾æ¥åˆ°å…¨å±€ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> mini-vite
npm <span class="hljs-built_in">link</span>
</code></pre>
<p>ç„¶åå°±å¯ä»¥åœ¨ä»»æ„ç›®å½•ä½¿ç”¨äº†ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">mini-vite my-app
</code></pre>
<p>æˆ–è€…ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">create-mini-vite my-app
</code></pre>
<p>æ‰§è¡Œåä¼šçœ‹åˆ°äº¤äº’å¼ç•Œé¢ï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet">Mini Vite - A minimal scaffolding tool

? Project name: â€º my-app
? <span class="hljs-keyword">Select</span> a framework: â€º 
  Vue
  React
? <span class="hljs-keyword">Select</span> a variant: â€º 
  TypeScript
  JavaScript
? <span class="hljs-keyword">Select</span> additional features: â€º 
â—¯ ESLint + Prettier (Antfu Config)
? <span class="hljs-keyword">Select</span> a CSS framework (<span class="hljs-keyword">optional</span>): â€º 
  None
  Tailwind CSS v4
  UnoCSS

âœ” Scaffolding project <span class="hljs-keyword">in</span> /path/<span class="hljs-keyword">to</span>/my-app...

âœ” ESLint configured
âœ” Tailwind CSS v4 configured

âœ” Done!

Now run:

  cd my-app
  npm install
  npm run dev
</code></pre>
<h2 data-id="heading-21">è¸©è¿‡çš„å‘</h2>
<h3 data-id="heading-22">1. ES Module çš„ __dirname é—®é¢˜</h3>
<p>åœ¨ ES Module é‡Œæ²¡æœ‰ <code>__dirname</code> å’Œ <code>__filename</code>ï¼Œè¦è¿™æ ·è·å–ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { fileURLToPath } <span class="hljs-keyword">from</span> <span class="hljs-string">'url'</span>
<span class="hljs-keyword">import</span> path <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span>

<span class="hljs-keyword">const</span> __filename = <span class="hljs-title function_">fileURLToPath</span>(<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>)
<span class="hljs-keyword">const</span> __dirname = path.<span class="hljs-title function_">dirname</span>(__filename)
</code></pre>
<p>æˆ‘ä¸€å¼€å§‹ç›´æ¥ç”¨ <code>__dirname</code>ï¼Œç»“æœæŠ¥é”™è¯´æœªå®šä¹‰ã€‚æŸ¥äº†æ–‡æ¡£æ‰çŸ¥é“è¦ç”¨ <code>import.meta.url</code>ã€‚</p>
<h3 data-id="heading-23">2. Tailwind CSS v4 çš„é…ç½®å˜åŒ–</h3>
<p>v4 ä¸å†éœ€è¦ <code>tailwind.config.js</code> å’Œ <code>postcss.config.js</code>ï¼Œç›´æ¥åœ¨ CSS é‡Œå¼•å…¥å°±è¡Œï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-keyword">@import</span> <span class="hljs-string">"tailwindcss"</span>;
</code></pre>
<p>ç„¶ååœ¨ <code>vite.config.js</code> å¼•å…¥ Vite æ’ä»¶ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> tailwindcss <span class="hljs-keyword">from</span> <span class="hljs-string">'@tailwindcss/vite'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [<span class="hljs-title function_">tailwindcss</span>()]
})
</code></pre>
<p>æˆ‘ä¸€å¼€å§‹è¿˜æŒ‰ v3 çš„æ–¹å¼åˆ›å»ºé…ç½®æ–‡ä»¶ï¼Œæµªè´¹äº†å¥½é•¿æ—¶é—´ã€‚</p>
<h3 data-id="heading-24">3. æ­£åˆ™è¡¨è¾¾å¼ä¿®æ”¹ vite.config.js</h3>
<p>ç”¨æ­£åˆ™è¡¨è¾¾å¼ä¿®æ”¹é…ç½®æ–‡ä»¶çš„æ—¶å€™è¦ç‰¹åˆ«å°å¿ƒï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// ä¸å¥½çš„å†™æ³•ï¼ˆå‡è®¾æ ¼å¼å›ºå®šï¼‰</span>
content.<span class="hljs-title function_">replace</span>(<span class="hljs-string">'plugins: ['</span>, <span class="hljs-string">'plugins: [tailwindcss(), '</span>)

<span class="hljs-comment">// å¥½çš„å†™æ³•ï¼ˆè€ƒè™‘å„ç§ç©ºæ ¼æƒ…å†µï¼‰</span>
content.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/plugins:\s*\[/</span>, <span class="hljs-string">'plugins: [tailwindcss(), '</span>)
</code></pre>
<p>å› ä¸ºä¸åŒäººå†™ä»£ç çš„æ ¼å¼å¯èƒ½ä¸ä¸€æ ·ï¼Œæœ‰äººå†™ <code>plugins:[</code>ï¼Œæœ‰äººå†™ <code>plugins: [</code>ã€‚ç”¨æ­£åˆ™çš„ <code>\s*</code> å¯ä»¥åŒ¹é…ä»»æ„ç©ºæ ¼ã€‚</p>
<h2 data-id="heading-25">å’Œå®˜æ–¹å·¥å…·çš„å¯¹æ¯”</h2>













































<table><thead><tr><th>ç‰¹æ€§</th><th>create-vite</th><th>mini-vite</th></tr></thead><tbody><tr><td>æ”¯æŒçš„æ¡†æ¶</td><td>8+</td><td>2ï¼ˆVueã€Reactï¼‰</td></tr><tr><td>æ¨¡æ¿æ•°é‡</td><td>18+</td><td>4</td></tr><tr><td>ä¾èµ–æ•°é‡</td><td>3</td><td>2</td></tr><tr><td>æ’ä»¶ç³»ç»Ÿ</td><td>âœ—</td><td>âœ“ï¼ˆESLintã€Tailwindã€UnoCSSï¼‰</td></tr><tr><td>ä»£ç é‡</td><td>~500 è¡Œ</td><td>~300 è¡Œ</td></tr><tr><td>å›¢é˜Ÿå®šåˆ¶</td><td>å›°éš¾</td><td>å®¹æ˜“</td></tr><tr><td>å­¦ä¹ éš¾åº¦</td><td>ä¸­ç­‰</td><td>ç®€å•</td></tr></tbody></table>
<p>å®˜æ–¹å·¥å…·åŠŸèƒ½æ›´å…¨é¢ï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒã€‚æˆ‘è¿™ä¸ªæ›´è½»é‡ã€æ›´çµæ´»ï¼Œé€‚åˆå­¦ä¹ å’Œå›¢é˜Ÿå®šåˆ¶ã€‚</p>
<h2 data-id="heading-26">å†™åœ¨æœ€å</h2>
<p>åç»­æˆ‘ä¼šè¡¥å……æ›´å¤špluginï¼Œæ”¯æŒh5ç«¯ä¸åŒæœºå‹é€‚é…ã€routerå’Œè·¨é¡µé¢åº”ç”¨å­˜å‚¨ç­‰é€šç”¨åŠŸèƒ½
å¤§å®¶ä¹Ÿå¯ä»¥å°è¯•å†™ä¸€ä¸ªè‡ªå·±çš„cliå·¥å…·ï¼Œæ— è®ºæ˜¯å›¢é˜Ÿå¼€å‘è¿˜æ˜¯ä¸ªäººç‹¬ç«‹å¼€å‘ï¼Œæˆ‘è§‰å¾—éƒ½æŒºæœ‰ç”¨çš„ï¼Œè™½ç„¶ç°åœ¨aiå¾ˆç‰›ï¼Œæœ‰æ—¶å€™è®©å®ƒåˆ›å»ºé¡¹ç›®ï¼Œä¹Ÿä¼šå‡ºé”™ï¼Œè¿˜å¾—ä¸æ–­è°ƒè¯•æ‰èƒ½åšå¥½ï¼ˆåæ§½ä¸€ä¸‹ï¼‰</p>
<p>emm æ‡¦å¤«çš„å‘³é“...</p>
<hr/>
<h2 data-id="heading-27">å‚è€ƒèµ„æ–™</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvitejs%2Fvite%2Ftree%2Fmain%2Fpackages%2Fcreate-vite" target="_blank" title="https://github.com/vitejs/vite/tree/main/packages/create-vite" ref="nofollow noopener noreferrer">create-vite æºç </a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fterkelg%2Fprompts" target="_blank" title="https://github.com/terkelg/prompts" ref="nofollow noopener noreferrer">prompts</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Falexeyraspopov%2Fpicocolors" target="_blank" title="https://github.com/alexeyraspopov/picocolors" ref="nofollow noopener noreferrer">picocolors</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fantfu%2Feslint-config" target="_blank" title="https://github.com/antfu/eslint-config" ref="nofollow noopener noreferrer">@antfu/eslint-config</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftailwindcss.com%2Fblog%2Ftailwindcss-v4-alpha" target="_blank" title="https://tailwindcss.com/blog/tailwindcss-v4-alpha" ref="nofollow noopener noreferrer">Tailwind CSS v4</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Funocss.dev%2F" target="_blank" title="https://unocss.dev/" ref="nofollow noopener noreferrer">UnoCSS</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€åº•å±‚æœºåˆ¶ã€‘Androidä½å†…å­˜ç®¡ç†æœºåˆ¶æ·±åº¦è§£æ]]></title>    <link>https://juejin.cn/post/7570901172527415331</link>    <guid>https://juejin.cn/post/7570901172527415331</guid>    <pubDate>2025-11-10T13:24:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570901172527415331" data-draft-id="7570909641682812968" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€åº•å±‚æœºåˆ¶ã€‘Androidä½å†…å­˜ç®¡ç†æœºåˆ¶æ·±åº¦è§£æ"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-11-10T13:24:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ²æ€¡æ—¸"/> <meta itemprop="url" content="https://juejin.cn/user/2875978146656750"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€åº•å±‚æœºåˆ¶ã€‘Androidä½å†…å­˜ç®¡ç†æœºåˆ¶æ·±åº¦è§£æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2875978146656750/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ²æ€¡æ—¸
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T13:24:02.000Z" title="Mon Nov 10 2025 13:24:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€ä½å†…å­˜ç®¡ç†æ¶æ„æ¦‚è¿°</h2>
<h3 data-id="heading-1">1.1 ç³»ç»Ÿçº§å†…å­˜å‹åŠ›å“åº”</h3>
<p>Androidä½å†…å­˜ç®¡ç†æ˜¯ä¸€ä¸ªå¤šå±‚æ¬¡ã€ååŒå·¥ä½œçš„ç³»ç»Ÿï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯åœ¨å†…å­˜å‹åŠ›ä¸‹ç»´æŒç³»ç»Ÿå“åº”æ€§å’Œç¨³å®šæ€§ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/03b8018a7d404502ba3ebd625cdcf2c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKQ5oCh5pe4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763385842&amp;x-signature=2EgAwvUn24hfcdDX6kDD4NMx3bE%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-2">äºŒã€ä½å†…å­˜æ€æ‰‹ï¼ˆLMKï¼‰æ ¸å¿ƒå®ç°</h2>
<h3 data-id="heading-3">2.1 LMKé©±åŠ¨æ¶æ„</h3>
<h4 data-id="heading-4">2.1.1 å†…æ ¸ç©ºé—´å®ç°</h4>
<p>LMKä½œä¸ºLinuxå†…æ ¸æ¨¡å—å®ç°ï¼Œä¸»è¦ç»„ä»¶åŒ…æ‹¬ï¼š</p>
<p><strong>å†…å­˜å‹åŠ›æ£€æµ‹</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">lmk_metrics</span> {</span>
    <span class="hljs-type">long</span> free_pages;           <span class="hljs-comment">// ç³»ç»Ÿç©ºé—²é¡µé¢</span>
    <span class="hljs-type">long</span> file_cache;           <span class="hljs-comment">// é¡µé¢ç¼“å­˜å¤§å°</span>
    <span class="hljs-type">long</span> swap_used;            <span class="hljs-comment">// äº¤æ¢ç©ºé—´ä½¿ç”¨</span>
    <span class="hljs-type">long</span> anon_pages;           <span class="hljs-comment">// åŒ¿åé¡µé¢æ•°é‡</span>
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">zone_watermarks</span> <span class="hljs-title">wm</span>;</span> <span class="hljs-comment">// å†…å­˜åŒºåŸŸæ°´ä½çº¿</span>
};
</code></pre>
<p><strong>è¿›ç¨‹è¯„åˆ†æœºåˆ¶</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc_score</span> {</span>
    <span class="hljs-type">pid_t</span> pid;                 <span class="hljs-comment">// è¿›ç¨‹ID</span>
    <span class="hljs-type">int</span> oom_score_adj;         <span class="hljs-comment">// OOMè°ƒæ•´åˆ†æ•°</span>
    <span class="hljs-type">long</span> rss;                  <span class="hljs-comment">// é©»ç•™å†…å­˜å¤§å°</span>
    <span class="hljs-type">long</span> swap_usage;           <span class="hljs-comment">// äº¤æ¢ä½¿ç”¨é‡</span>
    <span class="hljs-type">long</span> last_visible_time;    <span class="hljs-comment">// æœ€åå¯è§æ—¶é—´</span>
    <span class="hljs-type">int</span> importance;            <span class="hljs-comment">// è¿›ç¨‹é‡è¦æ€§</span>
};
</code></pre>
<h4 data-id="heading-5">2.1.2 æ€è¿›ç¨‹å†³ç­–ç®—æ³•</h4>
<p>LMKä½¿ç”¨ç»¼åˆè¯„åˆ†ç³»ç»Ÿé€‰æ‹©ç›®æ ‡è¿›ç¨‹ï¼š</p>
<p><strong>è¯„åˆ†å…¬å¼</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">score</span> = base_oom_score Ã— memory_pressure Ã— time_factor

å…¶ä¸­ï¼š
<span class="hljs-attr">base_oom_score</span> = f(oom_score_adj, process_state)
<span class="hljs-attr">memory_pressure</span> = current_free_pages / low_memory_threshold
<span class="hljs-attr">time_factor</span> = time_since_last_visible / time_constant
</code></pre>
<p><strong>é€‰æ‹©ç­–ç•¥</strong>ï¼š</p>
<ul>
<li>ä¼˜å…ˆé€‰æ‹©é«˜oom_score_adjçš„è¿›ç¨‹</li>
<li>è€ƒè™‘è¿›ç¨‹å†…å­˜å ç”¨å¤§å°</li>
<li>å¹³è¡¡æ€è¿›ç¨‹çš„æˆæœ¬ä¸æ”¶ç›Š</li>
</ul>
<h3 data-id="heading-6">2.2 ç”¨æˆ·ç©ºé—´åä½œ</h3>
<h4 data-id="heading-7">2.2.1 ActivityManagerServiceé›†æˆ</h4>
<p>AMSç»´æŠ¤è¿›ç¨‹çŠ¶æ€å¹¶åŠ¨æ€è°ƒæ•´OOMåˆ†æ•°ï¼š</p>
<p><strong>è¿›ç¨‹çŠ¶æ€æ˜ å°„</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ProcessRecord</span> {
    <span class="hljs-type">int</span> curAdj;          <span class="hljs-comment">// å½“å‰OOMè°ƒæ•´åˆ†æ•°</span>
    <span class="hljs-type">int</span> setAdj;          <span class="hljs-comment">// è®¾ç½®çš„OOMåˆ†æ•°</span>
    ProcessState state;  <span class="hljs-comment">// è¿›ç¨‹çŠ¶æ€</span>
    <span class="hljs-type">boolean</span> foreground;  <span class="hljs-comment">// æ˜¯å¦å‰å°</span>
    <span class="hljs-type">long</span> lastVisibleTime;<span class="hljs-comment">// æœ€åå¯è§æ—¶é—´</span>
}
</code></pre>
<p><strong>åŠ¨æ€åˆ†æ•°è°ƒæ•´</strong>ï¼š</p>
<ul>
<li>å‰å°è¿›ç¨‹ï¼š0 (ADJ_MEM_FACTOR_NORMAL)</li>
<li>å¯è§è¿›ç¨‹ï¼š100 (ADJ_MEM_FACTOR_VISIBLE)</li>
<li>æœåŠ¡è¿›ç¨‹ï¼š200-400 (åŸºäºæœåŠ¡é‡è¦æ€§)</li>
<li>åå°è¿›ç¨‹ï¼š600-900</li>
<li>ç¼“å­˜è¿›ç¨‹ï¼š900+</li>
</ul>
<h2 data-id="heading-8">ä¸‰ã€å†…å­˜å‹åŠ›æ£€æµ‹ä¸å“åº”</h2>
<h3 data-id="heading-9">3.1 å¤šçº§æ°´ä½çº¿ç›‘æ§</h3>
<h4 data-id="heading-10">3.1.1 å†…æ ¸æ°´ä½çº¿å®šä¹‰</h4>
<p>Linuxå†…æ ¸å®šä¹‰äº†ä¸‰å±‚å†…å­˜æ°´ä½çº¿ï¼š</p>
<p><strong>æ°´ä½çº¿è®¡ç®—</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">high_wmark</span> = total_pages Ã— <span class="hljs-number">0.9</span>    // å¼€å§‹å›æ”¶ç¼“å­˜
<span class="hljs-attr">low_wmark</span> = total_pages Ã— <span class="hljs-number">0.7</span>     // ç§¯æå›æ”¶
<span class="hljs-attr">min_wmark</span> = total_pages Ã— <span class="hljs-number">0.5</span>     // ç›´æ¥å›æ”¶å’ŒOOM
</code></pre>
<h4 data-id="heading-11">3.1.2 Androidæ‰©å±•æ°´ä½çº¿</h4>
<p>Androidåœ¨æ ‡å‡†æ°´ä½çº¿åŸºç¡€ä¸Šæ·»åŠ ç§»åŠ¨è®¾å¤‡ç‰¹å®šæ‰©å±•ï¼š</p>
<p><strong>ç§»åŠ¨ä¼˜åŒ–æ°´ä½çº¿</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">critical_wmark</span> = total_pages Ã— <span class="hljs-number">0.3</span>    // è§¦å‘LMK
<span class="hljs-attr">super_critical</span> = total_pages Ã— <span class="hljs-number">0.2</span>    // æ¿€è¿›LMK
<span class="hljs-attr">emergency_wmark</span> = total_pages Ã— <span class="hljs-number">0.1</span>   // ç³»ç»Ÿç¨³å®šæ€§æªæ–½
</code></pre>
<h3 data-id="heading-12">3.2 å†…å­˜å‹åŠ›ä¼ æ’­æœºåˆ¶</h3>
<h4 data-id="heading-13">3.2.1 å‹åŠ›çŠ¶æ€é€šçŸ¥</h4>
<p><strong>vmpressureäº‹ä»¶</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">vmpressure_level</span> {</span>
    VMPRESSURE_LOW,      <span class="hljs-comment">// ä½å‹åŠ›</span>
    VMPRESSURE_MEDIUM,   <span class="hljs-comment">// ä¸­ç­‰å‹åŠ›</span>
    VMPRESSURE_CRITICAL, <span class="hljs-comment">// ä¸´ç•Œå‹åŠ›</span>
    VMPRESSULE_OOM       <span class="hljs-comment">// OOMçŠ¶æ€</span>
};
</code></pre>
<p><strong>äº‹ä»¶ä¼ é€’è·¯å¾„</strong>ï¼š
å†…æ ¸vmpressure â†’ ç”¨æˆ·ç©ºé—´lmkd â†’ ActivityManagerService â†’ åº”ç”¨è¿›ç¨‹</p>
<h4 data-id="heading-14">3.2.2 åˆ†çº§å“åº”ç­–ç•¥</h4>
<p>åŸºäºå‹åŠ›çº§åˆ«å®æ–½ä¸åŒå¼ºåº¦çš„å†…å­˜å›æ”¶ï¼š</p>
<p><strong>ä½å‹åŠ›å“åº”</strong>ï¼š</p>
<ul>
<li>åå°è¿›ç¨‹å‹ç¼©</li>
<li>ç¼“å­˜æ¸…ç†</li>
<li>æ¸©å’Œçš„äº¤æ¢</li>
</ul>
<p><strong>ä¸­ç­‰å‹åŠ›å“åº”</strong>ï¼š</p>
<ul>
<li>æ€æ­»éƒ¨åˆ†åå°è¿›ç¨‹</li>
<li>ç§¯æå›æ”¶æ–‡ä»¶ç¼“å­˜</li>
<li>å‹ç¼©åŒ¿åå†…å­˜</li>
</ul>
<p><strong>ä¸´ç•Œå‹åŠ›å“åº”</strong>ï¼š</p>
<ul>
<li>æ€æ­»å¯è§è¿›ç¨‹ä¹‹å¤–çš„æ‰€æœ‰è¿›ç¨‹</li>
<li>å¼ºåˆ¶å†…å­˜å‹ç¼©</li>
<li>ç³»ç»ŸæœåŠ¡é™çº§</li>
</ul>
<h2 data-id="heading-15">å››ã€è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸç®¡ç†</h2>
<h3 data-id="heading-16">4.1 è¿›ç¨‹çŠ¶æ€æœº</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/799354e4b136464eb7ce112a75efe333~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKQ5oCh5pe4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763385842&amp;x-signature=1bp13nVliHZAJyDntw1bR3%2Ftqds%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-17">4.2 é‡è¦æ€§è®¡ç®—ç®—æ³•</h3>
<h4 data-id="heading-18">4.2.1 åŸºç¡€é‡è¦æ€§åˆ†æ•°</h4>
<p>åŸºäºè¿›ç¨‹åŒ…å«çš„ç»„ä»¶ç±»å‹è®¡ç®—åŸºç¡€åˆ†æ•°ï¼š</p>
<p><strong>ç»„ä»¶æƒé‡</strong>ï¼š</p>
<ul>
<li>å‰å°Activityï¼š+100</li>
<li>å¯è§Activityï¼š+50</li>
<li>å‰å°æœåŠ¡ï¼š+30</li>
<li>ç»‘å®šæœåŠ¡ï¼š+20</li>
<li>å†…å®¹æä¾›è€…ï¼š+10</li>
<li>å¹¿æ’­æ¥æ”¶å™¨ï¼š+5</li>
</ul>
<h4 data-id="heading-19">4.2.2 åŠ¨æ€è°ƒæ•´å› ç´ </h4>
<p><strong>ç”¨æˆ·äº¤äº’å› ç´ </strong>ï¼š</p>
<ul>
<li>æœ€è¿‘ç”¨æˆ·äº¤äº’æ—¶é—´</li>
<li>äº¤äº’é¢‘ç‡å’ŒæŒç»­æ—¶é—´</li>
<li>ç”¨æˆ·æ˜¾å¼é‡è¦æ€§è®¾ç½®</li>
</ul>
<p><strong>ç³»ç»Ÿç­–ç•¥å› ç´ </strong>ï¼š</p>
<ul>
<li>ç”µæºç®¡ç†çŠ¶æ€</li>
<li>çƒ­çŠ¶æ€çº¦æŸ</li>
<li>ç³»ç»Ÿè´Ÿè½½æ°´å¹³</li>
</ul>
<h2 data-id="heading-20">äº”ã€å†…å­˜å›æ”¶ç­–ç•¥</h2>
<h3 data-id="heading-21">5.1 åˆ†å±‚å›æ”¶æœºåˆ¶</h3>
<h4 data-id="heading-22">5.1.1 åº”ç”¨å±‚å›æ”¶</h4>
<p><strong>ä¸»åŠ¨å†…å­˜é‡Šæ”¾</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ComponentCallbacks2æ¥å£</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">ComponentCallbacks2</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">onTrimMemory</span><span class="hljs-params">(<span class="hljs-type">int</span> level)</span>;  <span class="hljs-comment">// å†…å­˜ä¿®å‰ªé€šçŸ¥</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">onLowMemory</span><span class="hljs-params">()</span>;           <span class="hljs-comment">// ä½å†…å­˜é€šçŸ¥</span>
}
</code></pre>
<p><strong>ä¿®å‰ªçº§åˆ«</strong>ï¼š</p>
<ul>
<li>TRIM_MEMORY_COMPLETEï¼šè¿›ç¨‹å¯èƒ½å¾ˆå¿«è¢«æ€æ­»</li>
<li>TRIM_MEMORY_MODERATEï¼šå»ºè®®é‡Šæ”¾éå…³é”®èµ„æº</li>
<li>TRIM_MEMORY_BACKGROUNDï¼šé‡Šæ”¾å®¹æ˜“é‡å»ºçš„èµ„æº</li>
</ul>
<h4 data-id="heading-23">5.1.2 ç³»ç»Ÿå±‚å›æ”¶</h4>
<p><strong>ç¼“å­˜ç®¡ç†</strong>ï¼š</p>
<ul>
<li>æ–‡ä»¶ç³»ç»Ÿç¼“å­˜æ¸…ç†</li>
<li>å­—ä½“å’Œèµ„æºç¼“å­˜å›æ”¶</li>
<li>ZRAMå‹ç¼©å†…å­˜é‡Šæ”¾</li>
</ul>
<p><strong>æœåŠ¡é™çº§</strong>ï¼š</p>
<ul>
<li>å‡å°‘åå°æœåŠ¡è¿è¡Œé¢‘ç‡</li>
<li>é™åˆ¶å¹¿æ’­å‘é€</li>
<li>æ¨è¿Ÿéç´§æ€¥ä»»åŠ¡</li>
</ul>
<h3 data-id="heading-24">5.2 äº¤æ¢ä¸å‹ç¼©ç­–ç•¥</h3>
<h4 data-id="heading-25">5.2.1 ZRAMäº¤æ¢ä¼˜åŒ–</h4>
<p>Androidä½¿ç”¨å‹ç¼©çš„RAMä½œä¸ºäº¤æ¢è®¾å¤‡ï¼š</p>
<p><strong>å‹ç¼©ç­–ç•¥</strong>ï¼š</p>
<ul>
<li>åŒ¿åé¡µé¢ä¼˜å…ˆå‹ç¼©</li>
<li>å†·é¡µé¢ä¼˜å…ˆæ¢å‡º</li>
<li>ä¿æŒçƒ­é¡µé¢åœ¨ç‰©ç†å†…å­˜</li>
</ul>
<p><strong>å‹ç¼©ç®—æ³•é€‰æ‹©</strong>ï¼š</p>
<ul>
<li>LZ4ï¼šå¿«é€Ÿå‹ç¼©ï¼Œé€‚åˆäº¤äº’åœºæ™¯</li>
<li>LZOï¼šå¹³è¡¡å‹ç¼©æ¯”å’Œé€Ÿåº¦</li>
<li>ZSTDï¼šé«˜å‹ç¼©æ¯”ï¼Œé€‚åˆåå°ä»»åŠ¡</li>
</ul>
<h4 data-id="heading-26">5.2.2 KSMé¡µé¢åˆå¹¶</h4>
<p>å†…æ ¸åŒé¡µåˆå¹¶ä¼˜åŒ–é‡å¤å†…å­˜ï¼š</p>
<p><strong>åˆå¹¶ç­–ç•¥</strong>ï¼š</p>
<ul>
<li>é›¶é¡µé¢ä¼˜å…ˆåˆå¹¶</li>
<li>åº“ä»£ç é¡µé¢åˆå¹¶</li>
<li>åº”ç”¨é—´å…±äº«èµ„æºåˆå¹¶</li>
</ul>
<h2 data-id="heading-27">å…­ã€è‡ªé€‚åº”ä¼˜åŒ–æœºåˆ¶</h2>
<h3 data-id="heading-28">6.1 å­¦ä¹ å‹å†…å­˜ç®¡ç†</h3>
<h4 data-id="heading-29">6.1.1 ä½¿ç”¨æ¨¡å¼åˆ†æ</h4>
<p><strong>ç”¨æˆ·è¡Œä¸ºå»ºæ¨¡</strong>ï¼š</p>
<ul>
<li>åº”ç”¨ä½¿ç”¨é¢‘ç‡å’Œæ—¶é•¿</li>
<li>å†…å­˜è®¿é—®æ¨¡å¼è¯†åˆ«</li>
<li>é¢„æµ‹æ€§å†…å­˜é¢„åˆ†é…</li>
</ul>
<p><strong>è‡ªé€‚åº”é˜ˆå€¼è°ƒæ•´</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">dynamic_threshold</span> = base_threshold Ã— usage_factor Ã— behavior_factor

<span class="hljs-attr">usage_factor</span> = f(historical_memory_usage)
<span class="hljs-attr">behavior_factor</span> = f(user_interaction_pattern)
</code></pre>
<h4 data-id="heading-30">6.1.2 é¢„æµ‹æ€§ç®¡ç†</h4>
<p><strong>å†…å­˜éœ€æ±‚é¢„æµ‹</strong>ï¼š</p>
<ul>
<li>åŸºäºå†å²æ•°æ®çš„åº”ç”¨å¯åŠ¨é¢„æµ‹</li>
<li>å‘¨æœŸæ€§ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´é¢„æµ‹</li>
<li>ç”¨æˆ·å·¥ä½œè´Ÿè½½æ¨¡å¼è¯†åˆ«</li>
</ul>
<h3 data-id="heading-31">6.2 è®¾å¤‡ç‰¹å®šä¼˜åŒ–</h3>
<h4 data-id="heading-32">6.2.1 å†…å­˜å®¹é‡é€‚é…</h4>
<p><strong>åˆ†çº§é…ç½®ç­–ç•¥</strong>ï¼š</p>
<ul>
<li>å°å†…å­˜è®¾å¤‡ï¼ˆ2GBä»¥ä¸‹ï¼‰ï¼šæ¿€è¿›å›æ”¶ç­–ç•¥</li>
<li>ä¸­ç­‰å†…å­˜è®¾å¤‡ï¼ˆ2-6GBï¼‰ï¼šå¹³è¡¡ç­–ç•¥</li>
<li>å¤§å†…å­˜è®¾å¤‡ï¼ˆ6GBä»¥ä¸Šï¼‰ï¼šå®½æ¾ç­–ç•¥</li>
</ul>
<h4 data-id="heading-33">6.2.2 ç¡¬ä»¶ç‰¹æ€§åˆ©ç”¨</h4>
<p><strong>å†…å­˜æ¶æ„ä¼˜åŒ–</strong>ï¼š</p>
<ul>
<li>NUMAæ„ŸçŸ¥çš„å†…å­˜åˆ†é…</li>
<li>å¤§é¡µé¢æ”¯æŒ</li>
<li>å†…å­˜å¸¦å®½ç®¡ç†</li>
</ul>
<h2 data-id="heading-34">ä¸ƒã€ç³»ç»Ÿç¨³å®šæ€§ä¿éšœ</h2>
<h3 data-id="heading-35">7.1 é˜²æŠ–åŠ¨æœºåˆ¶</h3>
<h4 data-id="heading-36">7.1.1 æ€è¿›ç¨‹é¢‘ç‡é™åˆ¶</h4>
<p>é˜²æ­¢è¿‡äºé¢‘ç¹çš„è¿›ç¨‹æ€æ­»å¯¼è‡´ç³»ç»Ÿä¸ç¨³å®šï¼š</p>
<p><strong>æ—¶é—´çª—å£é™åˆ¶</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">if (time_since_last_kill &lt; min_kill_interval) {
    <span class="hljs-built_in">delay_kill_decision</span>();
}
</code></pre>
<p><strong>æˆæœ¬æ•ˆç›Šåˆ†æ</strong>ï¼š</p>
<ul>
<li>è¯„ä¼°æ€è¿›ç¨‹çš„ç³»ç»Ÿå¼€é”€</li>
<li>è€ƒè™‘è¿›ç¨‹é‡å¯æˆæœ¬</li>
<li>å¹³è¡¡å†…å­˜æ”¶ç›Šä¸æ€§èƒ½æŸå¤±</li>
</ul>
<h4 data-id="heading-37">7.1.2 å…³é”®è¿›ç¨‹ä¿æŠ¤</h4>
<p><strong>ç³»ç»Ÿæ ¸å¿ƒæœåŠ¡</strong>ï¼š</p>
<ul>
<li>System Serverè¿›ç¨‹</li>
<li>è¾“å…¥æ³•æœåŠ¡</li>
<li>ç”µè¯æœåŠ¡</li>
<li>æ˜¾ç¤ºæœåŠ¡</li>
</ul>
<p><strong>ä¿æŠ¤æœºåˆ¶</strong>ï¼š</p>
<ul>
<li>æœ€ä½OOMè°ƒæ•´åˆ†æ•°</li>
<li>å†…å­˜ä½¿ç”¨é™åˆ¶è±å…</li>
<li>ç´§æ€¥æƒ…å†µç‰¹æ®Šå¤„ç†</li>
</ul>
<h3 data-id="heading-38">7.2 ç›‘æ§ä¸è¯Šæ–­</h3>
<h4 data-id="heading-39">7.2.1 å®æ—¶ç›‘æ§</h4>
<p><strong>æ€§èƒ½æŒ‡æ ‡æ”¶é›†</strong>ï¼š</p>
<ul>
<li>LMKè§¦å‘é¢‘ç‡å’Œæ—¶æœº</li>
<li>è¿›ç¨‹æ€æ­»ç»Ÿè®¡ä¿¡æ¯</li>
<li>å†…å­˜å‹åŠ›æŒç»­æ—¶é—´</li>
<li>ç”¨æˆ·æ„ŸçŸ¥çš„å¡é¡¿æƒ…å†µ</li>
</ul>
<h4 data-id="heading-40">7.2.2 é—®é¢˜è¯Šæ–­</h4>
<p><strong>å†…å­˜æ³„æ¼æ£€æµ‹</strong>ï¼š</p>
<ul>
<li>å¯ç–‘çš„å†…å­˜å¢é•¿æ¨¡å¼è¯†åˆ«</li>
<li>å¼•ç”¨é“¾åˆ†æ</li>
<li>æ³„æ¼æ¨¡å¼åˆ†ç±»</li>
</ul>
<h2 data-id="heading-41">æŠ€æœ¯æ€»ç»“</h2>
<p>Androidä½å†…å­˜ç®¡ç†æœºåˆ¶æ˜¯ä¸€ä¸ªå¤æ‚è€Œç²¾å¯†çš„ç³»ç»Ÿï¼Œé€šè¿‡å¤šå±‚æ¬¡åä½œåœ¨æœ‰é™çš„å†…å­˜èµ„æºä¸‹ç»´æŒç³»ç»Ÿæ€§èƒ½å’Œç¨³å®šæ€§ã€‚å…¶æ ¸å¿ƒåˆ›æ–°åœ¨äºï¼š</p>
<ol>
<li><strong>æ™ºèƒ½çš„è¿›ç¨‹é‡è¦æ€§è¯„ä¼°</strong>ï¼šåŸºäºç”¨æˆ·äº¤äº’å’Œç³»ç»ŸçŠ¶æ€çš„åŠ¨æ€è¯„åˆ†</li>
<li><strong>åˆ†çº§çš„å‹åŠ›å“åº”</strong>ï¼šä»æ¸©å’Œçš„èµ„æºå›æ”¶åˆ°æ¿€è¿›çš„è¿›ç¨‹æ€æ­»</li>
<li><strong>è‡ªé€‚åº”çš„é˜ˆå€¼è°ƒæ•´</strong>ï¼šåŸºäºä½¿ç”¨æ¨¡å¼å’Œè®¾å¤‡ç‰¹æ€§çš„åŠ¨æ€ä¼˜åŒ–</li>
<li><strong>ç³»ç»Ÿç¨³å®šæ€§ä¿éšœ</strong>ï¼šé˜²æ­¢è¿‡åº¦å›æ”¶å’Œå…³é”®æœåŠ¡ä¿æŠ¤</li>
</ol>
<p>è¿™å¥—æœºåˆ¶ä½¿å¾—Androidèƒ½å¤Ÿåœ¨å„ç§å†…å­˜çº¦æŸæ¡ä»¶ä¸‹æä¾›ä¸€è‡´çš„ç”¨æˆ·ä½“éªŒï¼Œæ˜¯ç§»åŠ¨æ“ä½œç³»ç»Ÿå†…å­˜ç®¡ç†çš„å…¸èŒƒå®ç°ã€‚éšç€è®¾å¤‡å†…å­˜å®¹é‡çš„å¢é•¿å’Œç”¨æˆ·éœ€æ±‚çš„æå‡ï¼Œä½å†…å­˜ç®¡ç†æœºåˆ¶ä»åœ¨æŒç»­æ¼”è¿›ï¼Œä»¥æ›´å¥½åœ°å¹³è¡¡æ€§èƒ½ã€åŠŸè€—å’Œç”¨æˆ·ä½“éªŒã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[InputConnectionæœºåˆ¶ä¸è·¨è¿›ç¨‹æ–‡æœ¬æ“ä½œçš„å·¥ç¨‹å®è·µ]]></title>    <link>https://juejin.cn/post/7570923924364853311</link>    <guid>https://juejin.cn/post/7570923924364853311</guid>    <pubDate>2025-11-10T13:26:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570923924364853311" data-draft-id="7571060853353824266" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="InputConnectionæœºåˆ¶ä¸è·¨è¿›ç¨‹æ–‡æœ¬æ“ä½œçš„å·¥ç¨‹å®è·µ"/> <meta itemprop="keywords" content="Android,Linux"/> <meta itemprop="datePublished" content="2025-11-10T13:26:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="WAsbry"/> <meta itemprop="url" content="https://juejin.cn/user/3413335797139511"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            InputConnectionæœºåˆ¶ä¸è·¨è¿›ç¨‹æ–‡æœ¬æ“ä½œçš„å·¥ç¨‹å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3413335797139511/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    WAsbry
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T13:26:16.000Z" title="Mon Nov 10 2025 13:26:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">InputConnectionæœºåˆ¶ä¸è·¨è¿›ç¨‹æ–‡æœ¬æ“ä½œçš„å·¥ç¨‹å®è·µ</h2>
<h3 data-id="heading-1">ğŸ’¡ æœ¬æ–‡ç²¾å</h3>
<ul>
<li><strong>æ‰¿æ¥å‰æ–‡</strong>ï¼šç¬¬ä¸€ç¯‡è®²Binderé€šä¿¡ï¼Œç¬¬äºŒç¯‡è®²è®¾è®¡ç¼ºé™·ï¼Œæœ¬ç¯‡ç»™å‡ºå®Œæ•´çš„å·¥ç¨‹è§£å†³æ–¹æ¡ˆ</li>
<li><strong>æ ¸å¿ƒéœ€æ±‚</strong>ï¼šæ—¢ä¿ç•™æ•°å­—é”®ç›˜ï¼ˆinputType="number"ï¼‰ï¼Œåˆé¿å…å­—æ¯è¾“å…¥å¯¼è‡´æ•°å­—ä¸¢å¤±</li>
<li><strong>æœ€ä½³æ–¹æ¡ˆ</strong>ï¼šè‡ªå®šä¹‰InputConnectionåœ¨<code>setComposingText()</code>å±‚æ‹¦æˆªéæ³•å­—ç¬¦ï¼Œé˜»æ­¢è¿›å…¥delete-insertæµç¨‹</li>
<li><strong>ä¸‰ç§æ–¹æ¡ˆå¯¹æ¯”</strong>ï¼šInputConnectionæ‹¦æˆªï¼ˆæ¨èâ­â­â­â­â­ï¼‰ã€TextWatcherè¿‡æ»¤ï¼ˆâ­â­â­ï¼‰ã€è‡ªå®šä¹‰InputFilterï¼ˆâ­â­â­â­ï¼‰</li>
<li><strong>ä»·å€¼</strong>ï¼šæä¾›å¯ç›´æ¥ä½¿ç”¨çš„å®Œæ•´ä»£ç ï¼Œåˆ†ææ–¹æ¡ˆä¼˜åŠ£ï¼ŒæŒ‡å¯¼å·¥ç¨‹å®è·µ</li>
</ul>
<hr/>
<h3 data-id="heading-2">ä¸€ã€éœ€æ±‚åˆ†æä¸çº¦æŸæ¡ä»¶</h3>
<h4 data-id="heading-3">1.1 æ ¸å¿ƒéœ€æ±‚</h4>
<pre><code class="hljs language-markdown" lang="markdown">ç”¨æˆ·éœ€æ±‚:
<span class="hljs-bullet">1.</span> ç‚¹å‡»EditTextæ—¶ï¼Œå¼¹å‡ºæ•°å­—é”®ç›˜ï¼ˆä¸æ˜¯å…¨é”®ç›˜ï¼‰
<span class="hljs-bullet">2.</span> åªå…è®¸è¾“å…¥æ•°å­—å­—ç¬¦
<span class="hljs-bullet">3.</span> åˆ‡æ¢åˆ°å­—æ¯é”®ç›˜è¾“å…¥å­—æ¯æ—¶ï¼Œä¸åº”å¯¼è‡´å·²æœ‰æ•°å­—ä¸¢å¤±

æŠ€æœ¯çº¦æŸ:
<span class="hljs-bullet">1.</span> å¿…é¡»ä½¿ç”¨ android:inputType="number" (ä¿è¯æ•°å­—é”®ç›˜)
<span class="hljs-bullet">2.</span> ä¸èƒ½ä¿®æ”¹Androidæ¡†æ¶ä»£ç 
<span class="hljs-bullet">3.</span> éœ€è¦å…¼å®¹ä¸»æµè¾“å…¥æ³•ï¼ˆç™¾åº¦ã€æœç‹—ã€è®¯é£ç­‰ï¼‰
<span class="hljs-bullet">4.</span> æ€§èƒ½å¼€é”€è¦å°
</code></pre>
<h4 data-id="heading-4">1.2 é—®é¢˜å›é¡¾</h4>
<p><strong>å‰ä¸¤ç¯‡å·²åˆ†æçš„æ ¹æœ¬åŸå› </strong>ï¼š</p>
<pre><code class="hljs language-css" lang="css">è¾“å…¥æ³•è¿›ç¨‹:
  ic.<span class="hljs-built_in">setComposingText</span>(<span class="hljs-string">"qq"</span>, <span class="hljs-number">1</span>)
  â†“ Binder IPC
åº”ç”¨è¿›ç¨‹:
  BaseInputConnection.<span class="hljs-built_in">replaceText</span>(<span class="hljs-string">"qq"</span>, <span class="hljs-number">1</span>, true)
  â†“
  <span class="hljs-number">1</span>. <span class="hljs-built_in">delete</span>(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>) â†’ æˆåŠŸï¼ˆç»•è¿‡InputFilterï¼‰
  <span class="hljs-number">2</span>. <span class="hljs-built_in">insert</span>(<span class="hljs-string">"qq"</span>) â†’ å¤±è´¥ï¼ˆè¢«DigitsKeyListeneræ‹’ç»ï¼‰
  â†“
  ç»“æœ: æ•°æ®ä¸¢å¤±
</code></pre>
<p><strong>è§£å†³æ–¹å‘</strong>ï¼š</p>
<ul>
<li>åœ¨deleteæ‰§è¡Œä¹‹å‰æ‹¦æˆª</li>
<li>åˆ¤æ–­æ–°æ–‡æœ¬æ˜¯å¦åˆæ³•</li>
<li>å¦‚æœéæ³•ï¼Œä¸è¿›å…¥delete-insertæµç¨‹</li>
</ul>
<hr/>
<h3 data-id="heading-5">äºŒã€è§£å†³æ–¹æ¡ˆä¸€ï¼šInputConnectionæ‹¦æˆªï¼ˆæ¨èâ­â­â­â­â­ï¼‰</h3>
<h4 data-id="heading-6">2.1 æ ¸å¿ƒæ€è·¯</h4>
<pre><code class="hljs language-css" lang="css">åŸå§‹æµç¨‹ï¼ˆæœ‰Bugï¼‰:
<span class="hljs-built_in">setComposingText</span>(<span class="hljs-string">"qq"</span>)
  â†’ <span class="hljs-built_in">replaceText</span>()
  â†’ <span class="hljs-built_in">delete</span>(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>) â† åˆ é™¤æ•°å­—
  â†’ <span class="hljs-built_in">insert</span>(<span class="hljs-string">"qq"</span>) â† è¢«æ‹’ç»
  â†’ Bug!

ä¼˜åŒ–åæµç¨‹:
<span class="hljs-built_in">setComposingText</span>(<span class="hljs-string">"qq"</span>)
  â†’ NumberInputConnectionWrapper.<span class="hljs-built_in">setComposingText</span>()
  â†’ æ£€æµ‹åˆ°å­—æ¯ <span class="hljs-string">'q'</span>
  â†’ è°ƒç”¨ <span class="hljs-built_in">finishComposingText</span>() â† ç›´æ¥å®Œæˆç»„åˆï¼Œä¸æ‰§è¡Œdelete-insert
  â†’ æ•°å­—ä¿æŒä¸å˜ âœ“
</code></pre>
<h4 data-id="heading-7">2.2 å®Œæ•´å®ç°ä»£ç </h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RecommendedNumberEditText</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatEditText</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RecommendedNumberEditText</span><span class="hljs-params">(Context context)</span> {
        <span class="hljs-built_in">super</span>(context);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RecommendedNumberEditText</span><span class="hljs-params">(Context context, AttributeSet attrs)</span> {
        <span class="hljs-built_in">super</span>(context, attrs);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RecommendedNumberEditText</span><span class="hljs-params">(Context context, AttributeSet attrs, <span class="hljs-type">int</span> defStyleAttr)</span> {
        <span class="hljs-built_in">super</span>(context, attrs, defStyleAttr);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> InputConnection <span class="hljs-title function_">onCreateInputConnection</span><span class="hljs-params">(EditorInfo outAttrs)</span> {
        <span class="hljs-comment">// è·å–çˆ¶ç±»åˆ›å»ºçš„InputConnection</span>
        <span class="hljs-type">InputConnection</span> <span class="hljs-variable">base</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">super</span>.onCreateInputConnection(outAttrs);
        <span class="hljs-keyword">if</span> (base == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }

        <span class="hljs-comment">// åŒ…è£…æˆæˆ‘ä»¬çš„è‡ªå®šä¹‰InputConnection</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NumberInputConnectionWrapper</span>(base, <span class="hljs-literal">true</span>);
    }

    <span class="hljs-comment">/**
     * è‡ªå®šä¹‰InputConnectionåŒ…è£…ç±»
     * æ‹¦æˆªsetComposingTextï¼Œæ£€æŸ¥æ˜¯å¦åŒ…å«éæ•°å­—å­—ç¬¦
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NumberInputConnectionWrapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">InputConnectionWrapper</span> {

        <span class="hljs-keyword">public</span> <span class="hljs-title function_">NumberInputConnectionWrapper</span><span class="hljs-params">(InputConnection target, <span class="hljs-type">boolean</span> mutable)</span> {
            <span class="hljs-built_in">super</span>(target, mutable);
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">setComposingText</span><span class="hljs-params">(CharSequence text, <span class="hljs-type">int</span> newCursorPosition)</span> {
            <span class="hljs-comment">// å…³é”®ï¼šåœ¨æ‰§è¡Œdelete-insertä¹‹å‰æ£€æŸ¥</span>
            <span class="hljs-keyword">if</span> (text != <span class="hljs-literal">null</span> &amp;&amp; containsNonDigit(text)) {
                <span class="hljs-comment">// åŒ…å«éæ•°å­—å­—ç¬¦ï¼Œç›´æ¥å®Œæˆç»„åˆï¼ˆä¸æ‰§è¡Œdelete-insertï¼‰</span>
                <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.finishComposingText();
            }

            <span class="hljs-comment">// çº¯æ•°å­—æˆ–nullï¼Œæ­£å¸¸å¤„ç†</span>
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.setComposingText(text, newCursorPosition);
        }

        <span class="hljs-comment">/**
         * æ£€æŸ¥CharSequenceæ˜¯å¦åŒ…å«éæ•°å­—å­—ç¬¦
         */</span>
        <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">containsNonDigit</span><span class="hljs-params">(CharSequence text)</span> {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; text.length(); i++) {
                <span class="hljs-type">char</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> text.charAt(i);
                <span class="hljs-keyword">if</span> (!Character.isDigit(c)) {
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// å‘ç°éæ•°å­—å­—ç¬¦</span>
                }
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// å…¨éƒ¨æ˜¯æ•°å­—</span>
        }
    }
}
</code></pre>
<h4 data-id="heading-8">2.3 ä½¿ç”¨æ–¹æ³•</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- activity_main.xml --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">com.yourpackage.RecommendedNumberEditText</span>
    <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/edit_number"</span>
    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"match_parent"</span>
    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span>
    <span class="hljs-attr">android:hint</span>=<span class="hljs-string">"è¯·è¾“å…¥æ•°å­—"</span>
    <span class="hljs-attr">android:inputType</span>=<span class="hljs-string">"number"</span> /&gt;</span>
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// MainActivity.java</span>
<span class="hljs-type">RecommendedNumberEditText</span> <span class="hljs-variable">editText</span> <span class="hljs-operator">=</span> findViewById(R.id.edit_number);
<span class="hljs-comment">// æ­£å¸¸ä½¿ç”¨ï¼Œæ— éœ€é¢å¤–ä»£ç </span>
</code></pre>
<h4 data-id="heading-9">2.4 æ–¹æ¡ˆä¼˜åŠ¿</h4>

































<table><thead><tr><th>ä¼˜åŠ¿</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>æ‹¦æˆªæ—¶æœºæ—©</strong></td><td>åœ¨deleteä¹‹å‰æ‹¦æˆªï¼Œä»æºå¤´è§£å†³é—®é¢˜</td></tr><tr><td><strong>æ€§èƒ½æœ€ä¼˜</strong></td><td>ä¸æ‰§è¡Œdelete-insertï¼Œé¿å…æ— æ•ˆæ“ä½œ</td></tr><tr><td><strong>å¯¹è¾“å…¥æ³•é€æ˜</strong></td><td>è¿”å›trueï¼Œè¾“å…¥æ³•è®¤ä¸ºæˆåŠŸï¼Œä¸å½±å“æ­£å¸¸æµç¨‹</td></tr><tr><td><strong>ä¸å½±å“æ­£å¸¸è¾“å…¥</strong></td><td>æ•°å­—è¾“å…¥ä¸å—å½±å“ï¼Œä»èµ°åŸæœ‰é€»è¾‘</td></tr><tr><td><strong>ä»£ç ç®€æ´</strong></td><td>åªéœ€é‡å†™ä¸€ä¸ªæ–¹æ³•</td></tr><tr><td><strong>æ•°å­—é”®ç›˜ä¿ç•™</strong></td><td>inputType="number"ä¿è¯æ•°å­—é”®ç›˜å¼¹å‡º</td></tr></tbody></table>
<h4 data-id="heading-10">2.5 å·¥ä½œæµç¨‹å›¾</h4>
<pre><code class="hljs language-css" lang="css">ç”¨æˆ·æ“ä½œï¼š
  è¾“å…¥æ•°å­— "<span class="hljs-number">123456</span>"
  â†“
  åˆ‡æ¢åˆ°å­—æ¯é”®ç›˜
  â†“
  ç‚¹å‡» '<span class="hljs-selector-tag">q</span>'

è¾“å…¥æ³•è¿›ç¨‹:
  ic.<span class="hljs-built_in">setComposingText</span>(<span class="hljs-string">"q"</span>, <span class="hljs-number">1</span>)
  â†“ Binder IPC

åº”ç”¨è¿›ç¨‹:
  NumberInputConnectionWrapper.<span class="hljs-built_in">setComposingText</span>(<span class="hljs-string">"q"</span>, <span class="hljs-number">1</span>)
  â†“
  <span class="hljs-built_in">containsNonDigit</span>(<span class="hljs-string">"q"</span>) â†’ true (æ£€æµ‹åˆ°å­—æ¯)
  â†“
  è°ƒç”¨ <span class="hljs-built_in">finishComposingText</span>()
  â†“
  BaseInputConnection.<span class="hljs-built_in">finishComposingText</span>()
    - ç§»é™¤COMPOSING Span
    - ä¸æ‰§è¡Œdelete
    - ä¸æ‰§è¡Œinsert
  â†“
  è¿”å› true
  â†“
  å†…å®¹ä¿æŒ <span class="hljs-string">"123456"</span> âœ“

ç»§ç»­ç‚¹å‡» <span class="hljs-string">'q'</span>:
  åŒæ ·æµç¨‹ï¼Œæ¯æ¬¡éƒ½è°ƒç”¨ <span class="hljs-built_in">finishComposingText</span>()
  å†…å®¹å§‹ç»ˆä¿æŒ <span class="hljs-string">"123456"</span> âœ“
</code></pre>
<hr/>
<h3 data-id="heading-11">ä¸‰ã€è§£å†³æ–¹æ¡ˆäºŒï¼šTextWatcherè¿‡æ»¤ï¼ˆâ­â­â­ï¼‰</h3>
<h4 data-id="heading-12">3.1 æ ¸å¿ƒæ€è·¯</h4>
<pre><code class="hljs">åŸç†ï¼š
ä¸ä¾èµ–InputFilterï¼Œè€Œæ˜¯ç›‘å¬æ–‡æœ¬å˜åŒ–
åœ¨æ–‡æœ¬æ”¹å˜åï¼Œè¿‡æ»¤æ‰éæ•°å­—å­—ç¬¦
</code></pre>
<h4 data-id="heading-13">3.2 å®Œæ•´å®ç°ä»£ç </h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleNumberEditText</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatEditText</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">isFiltering</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// é˜²æ­¢é€’å½’</span>

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SimpleNumberEditText</span><span class="hljs-params">(Context context)</span> {
        <span class="hljs-built_in">super</span>(context);
        init();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SimpleNumberEditText</span><span class="hljs-params">(Context context, AttributeSet attrs)</span> {
        <span class="hljs-built_in">super</span>(context, attrs);
        init();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SimpleNumberEditText</span><span class="hljs-params">(Context context, AttributeSet attrs, <span class="hljs-type">int</span> defStyleAttr)</span> {
        <span class="hljs-built_in">super</span>(context, attrs, defStyleAttr);
        init();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// ä¸è®¾ç½®inputTypeä¸ºnumberï¼Œé¿å…DigitsKeyListener</span>
        <span class="hljs-comment">// ä½†ä¼šä¸¢å¤±æ•°å­—é”®ç›˜ï¼Œéœ€è¦æ‰‹åŠ¨è®¾ç½®</span>
        setRawInputType(InputType.TYPE_CLASS_NUMBER);

        addTextChangedListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TextWatcher</span>() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">beforeTextChanged</span><span class="hljs-params">(CharSequence s, <span class="hljs-type">int</span> start, <span class="hljs-type">int</span> count, <span class="hljs-type">int</span> after)</span> {
                <span class="hljs-comment">// ä¸éœ€è¦å¤„ç†</span>
            }

            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onTextChanged</span><span class="hljs-params">(CharSequence s, <span class="hljs-type">int</span> start, <span class="hljs-type">int</span> before, <span class="hljs-type">int</span> count)</span> {
                <span class="hljs-comment">// ä¸éœ€è¦å¤„ç†</span>
            }

            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterTextChanged</span><span class="hljs-params">(Editable s)</span> {
                <span class="hljs-keyword">if</span> (isFiltering) {
                    <span class="hljs-keyword">return</span>; <span class="hljs-comment">// é¿å…é€’å½’</span>
                }

                <span class="hljs-comment">// è¿‡æ»¤æ‰éæ•°å­—å­—ç¬¦</span>
                <span class="hljs-type">String</span> <span class="hljs-variable">filtered</span> <span class="hljs-operator">=</span> s.toString().replaceAll(<span class="hljs-string">"[^0-9]"</span>, <span class="hljs-string">""</span>);

                <span class="hljs-keyword">if</span> (!s.toString().equals(filtered)) {
                    isFiltering = <span class="hljs-literal">true</span>;

                    <span class="hljs-comment">// ä¿å­˜å…‰æ ‡ä½ç½®</span>
                    <span class="hljs-type">int</span> <span class="hljs-variable">cursorPos</span> <span class="hljs-operator">=</span> getSelectionStart();
                    <span class="hljs-type">int</span> <span class="hljs-variable">lengthBefore</span> <span class="hljs-operator">=</span> s.length();

                    <span class="hljs-comment">// æ›¿æ¢ä¸ºè¿‡æ»¤åçš„å†…å®¹</span>
                    setText(filtered);

                    <span class="hljs-comment">// è°ƒæ•´å…‰æ ‡ä½ç½®</span>
                    <span class="hljs-type">int</span> <span class="hljs-variable">lengthAfter</span> <span class="hljs-operator">=</span> filtered.length();
                    <span class="hljs-type">int</span> <span class="hljs-variable">diff</span> <span class="hljs-operator">=</span> lengthBefore - lengthAfter;
                    <span class="hljs-type">int</span> <span class="hljs-variable">newCursorPos</span> <span class="hljs-operator">=</span> Math.max(<span class="hljs-number">0</span>, cursorPos - diff);
                    setSelection(Math.min(newCursorPos, filtered.length()));

                    isFiltering = <span class="hljs-literal">false</span>;
                }
            }
        });
    }
}
</code></pre>
<h4 data-id="heading-14">3.3 æ–¹æ¡ˆä¼˜åŠ£</h4>





























<table><thead><tr><th>ç»´åº¦</th><th>è¯„ä»·</th></tr></thead><tbody><tr><td><strong>ä¼˜ç‚¹</strong></td><td>å®ç°ç®€å•ï¼Œæ˜“äºç†è§£</td></tr><tr><td><strong>ä¼˜ç‚¹</strong></td><td>ä¸ä¾èµ–InputConnectionï¼Œé€»è¾‘ç‹¬ç«‹</td></tr><tr><td><strong>ç¼ºç‚¹</strong></td><td>éœ€è¦é¢å¤–çš„setTextæ“ä½œï¼Œæ€§èƒ½ç•¥å·®</td></tr><tr><td><strong>ç¼ºç‚¹</strong></td><td>å…‰æ ‡ä½ç½®å¤„ç†å¤æ‚</td></tr><tr><td><strong>ç¼ºç‚¹</strong></td><td>ä¼šè§¦å‘é¢å¤–çš„TextWatcherå›è°ƒ</td></tr></tbody></table>
<h4 data-id="heading-15">3.4 æ€§èƒ½å¯¹æ¯”</h4>
<pre><code class="hljs language-css" lang="css">æ–¹æ¡ˆä¸€ï¼ˆInputConnectionæ‹¦æˆªï¼‰:
  <span class="hljs-built_in">setComposingText</span>(<span class="hljs-string">"qq"</span>)
    â†’ æ£€æµ‹åˆ°å­—æ¯
    â†’ <span class="hljs-built_in">finishComposingText</span>()
    â†’ <span class="hljs-number">1</span>æ¬¡æ“ä½œ

æ–¹æ¡ˆäºŒï¼ˆTextWatcherï¼‰:
  <span class="hljs-built_in">setComposingText</span>(<span class="hljs-string">"qq"</span>)
    â†’ <span class="hljs-built_in">delete</span>(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>) â†’ åˆ é™¤<span class="hljs-string">'6'</span>
    â†’ <span class="hljs-built_in">insert</span>(<span class="hljs-string">"qq"</span>) â†’ è¢«æ‹’ç»
    â†’ afterTextChangedè§¦å‘
    â†’ <span class="hljs-built_in">setText</span>(<span class="hljs-string">"123456"</span>) â†’ æ¢å¤
    â†’ <span class="hljs-number">3</span>æ¬¡æ“ä½œ

æ€§èƒ½å·®è·ï¼šæ–¹æ¡ˆäºŒçº¦<span class="hljs-number">3</span>å€äºæ–¹æ¡ˆä¸€
</code></pre>
<hr/>
<h3 data-id="heading-16">å››ã€è§£å†³æ–¹æ¡ˆä¸‰ï¼šè‡ªå®šä¹‰InputFilterï¼ˆâ­â­â­â­ï¼‰</h3>
<h4 data-id="heading-17">4.1 æ ¸å¿ƒæ€è·¯</h4>
<pre><code class="hljs language-sql" lang="sql">åŸç†ï¼š
ä¸ä»…æ‹¦æˆª<span class="hljs-keyword">insert</span>ï¼Œä¹Ÿæ‹¦æˆª<span class="hljs-keyword">delete</span>
é€šè¿‡åˆ¤æ–­sourceæ˜¯å¦ä¸ºç©ºæ¥åŒºåˆ†æ“ä½œç±»å‹
</code></pre>
<h4 data-id="heading-18">4.2 å®Œæ•´å®ç°ä»£ç </h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SafeNumberEditText</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatEditText</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SafeNumberEditText</span><span class="hljs-params">(Context context)</span> {
        <span class="hljs-built_in">super</span>(context);
        init();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SafeNumberEditText</span><span class="hljs-params">(Context context, AttributeSet attrs)</span> {
        <span class="hljs-built_in">super</span>(context, attrs);
        init();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SafeNumberEditText</span><span class="hljs-params">(Context context, AttributeSet attrs, <span class="hljs-type">int</span> defStyleAttr)</span> {
        <span class="hljs-built_in">super</span>(context, attrs, defStyleAttr);
        init();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// è®¾ç½®è‡ªå®šä¹‰Filterï¼Œæ›¿æ¢ç³»ç»Ÿçš„DigitsKeyListener</span>
        setFilters(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputFilter</span>[]{<span class="hljs-keyword">new</span> <span class="hljs-title class_">SafeNumberInputFilter</span>()});
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> InputConnection <span class="hljs-title function_">onCreateInputConnection</span><span class="hljs-params">(EditorInfo outAttrs)</span> {
        <span class="hljs-type">InputConnection</span> <span class="hljs-variable">base</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">super</span>.onCreateInputConnection(outAttrs);
        <span class="hljs-keyword">if</span> (base == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }

        <span class="hljs-comment">// åŒæ—¶ä½¿ç”¨InputConnectionæ‹¦æˆªï¼ˆåŒé‡ä¿æŠ¤ï¼‰</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SafeInputConnectionWrapper</span>(base, <span class="hljs-literal">true</span>);
    }

    <span class="hljs-comment">/**
     * è‡ªå®šä¹‰InputFilter
     * æ‹¦æˆªéæ•°å­—å­—ç¬¦çš„æ’å…¥
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SafeNumberInputFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InputFilter</span> {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> CharSequence <span class="hljs-title function_">filter</span><span class="hljs-params">(CharSequence source, <span class="hljs-type">int</span> start, <span class="hljs-type">int</span> end,
                                   Spanned dest, <span class="hljs-type">int</span> dstart, <span class="hljs-type">int</span> dend)</span> {
            <span class="hljs-comment">// è¿‡æ»¤æ‰éæ•°å­—å­—ç¬¦</span>
            <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">filtered</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> start; i &lt; end; i++) {
                <span class="hljs-type">char</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> source.charAt(i);
                <span class="hljs-keyword">if</span> (Character.isDigit(c)) {
                    filtered.append(c);
                }
            }

            <span class="hljs-comment">// å¦‚æœå…¨éƒ¨è¢«è¿‡æ»¤æ‰ï¼Œè¿”å›ç©ºå­—ç¬¦ä¸²</span>
            <span class="hljs-keyword">if</span> (filtered.length() == <span class="hljs-number">0</span> &amp;&amp; end &gt; start) {
                <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
            }

            <span class="hljs-comment">// å¦‚æœæœ‰å­—ç¬¦è¢«è¿‡æ»¤æ‰ï¼Œè¿”å›è¿‡æ»¤åçš„å†…å®¹</span>
            <span class="hljs-keyword">if</span> (filtered.length() &lt; (end - start)) {
                <span class="hljs-keyword">return</span> filtered.toString();
            }

            <span class="hljs-comment">// å…¨éƒ¨åˆæ³•ï¼Œè¿”å›nullï¼ˆæ¥å—åŸå§‹å†…å®¹ï¼‰</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
    }

    <span class="hljs-comment">/**
     * InputConnectionåŒ…è£…ç±»
     * ä½œä¸ºç¬¬äºŒå±‚é˜²æŠ¤
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SafeInputConnectionWrapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">InputConnectionWrapper</span> {

        <span class="hljs-keyword">public</span> <span class="hljs-title function_">SafeInputConnectionWrapper</span><span class="hljs-params">(InputConnection target, <span class="hljs-type">boolean</span> mutable)</span> {
            <span class="hljs-built_in">super</span>(target, mutable);
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">setComposingText</span><span class="hljs-params">(CharSequence text, <span class="hljs-type">int</span> newCursorPosition)</span> {
            <span class="hljs-keyword">if</span> (text != <span class="hljs-literal">null</span> &amp;&amp; containsNonDigit(text)) {
                <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.finishComposingText();
            }
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.setComposingText(text, newCursorPosition);
        }

        <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">containsNonDigit</span><span class="hljs-params">(CharSequence text)</span> {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; text.length(); i++) {
                <span class="hljs-keyword">if</span> (!Character.isDigit(text.charAt(i))) {
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                }
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
    }
}
</code></pre>
<h4 data-id="heading-19">4.3 æ–¹æ¡ˆç‰¹ç‚¹</h4>

























<table><thead><tr><th>ç‰¹ç‚¹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>åŒé‡ä¿æŠ¤</strong></td><td>InputFilter + InputConnectionä¸¤å±‚æ‹¦æˆª</td></tr><tr><td><strong>çµæ´»æ€§é«˜</strong></td><td>å¯ä»¥è‡ªå®šä¹‰è¿‡æ»¤è§„åˆ™ï¼ˆå¦‚å…è®¸å°æ•°ç‚¹ï¼‰</td></tr><tr><td><strong>å…¼å®¹æ€§å¥½</strong></td><td>é€‚é…å„ç§è¾“å…¥åœºæ™¯</td></tr><tr><td><strong>ä»£ç å¤æ‚</strong></td><td>éœ€è¦åŒæ—¶å®ç°Filterå’ŒWrapper</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-20">äº”ã€ä¸‰ç§æ–¹æ¡ˆå¯¹æ¯”ä¸é€‰å‹æŒ‡å—</h3>
<h4 data-id="heading-21">5.1 å…¨é¢å¯¹æ¯”</h4>





















































<table><thead><tr><th>ç»´åº¦</th><th>æ–¹æ¡ˆä¸€ï¼šInputConnection</th><th>æ–¹æ¡ˆäºŒï¼šTextWatcher</th><th>æ–¹æ¡ˆä¸‰ï¼šè‡ªå®šä¹‰Filter</th></tr></thead><tbody><tr><td><strong>å®ç°å¤æ‚åº¦</strong></td><td>â­â­ (ç®€å•)</td><td>â­ (æœ€ç®€å•)</td><td>â­â­â­â­ (å¤æ‚)</td></tr><tr><td><strong>æ€§èƒ½</strong></td><td>â­â­â­â­â­ (æœ€ä¼˜)</td><td>â­â­â­ (ä¸€èˆ¬)</td><td>â­â­â­â­ (å¥½)</td></tr><tr><td><strong>æ‹¦æˆªæ—¶æœº</strong></td><td>æ—©ï¼ˆdeleteä¹‹å‰ï¼‰</td><td>æ™šï¼ˆæ–‡æœ¬å·²æ”¹å˜ï¼‰</td><td>æ—©ï¼ˆä½†æœ‰å±€é™ï¼‰</td></tr><tr><td><strong>æ•°å­—é”®ç›˜</strong></td><td>âœ“ è‡ªåŠ¨</td><td>âœ“ æ‰‹åŠ¨è®¾ç½®</td><td>âœ“ è‡ªåŠ¨</td></tr><tr><td><strong>å…‰æ ‡å¤„ç†</strong></td><td>âœ“ è‡ªåŠ¨</td><td>âœ— éœ€æ‰‹åŠ¨</td><td>âœ“ è‡ªåŠ¨</td></tr><tr><td><strong>ä»£ç é‡</strong></td><td>~40è¡Œ</td><td>~60è¡Œ</td><td>~80è¡Œ</td></tr><tr><td><strong>æ¨èåº¦</strong></td><td>â­â­â­â­â­</td><td>â­â­â­</td><td>â­â­â­â­</td></tr></tbody></table>
<h4 data-id="heading-22">5.2 é€‰å‹å»ºè®®</h4>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">åœºæ™¯1: æ™®é€šæ•°å­—è¾“å…¥æ¡†</span>
  æ¨è: æ–¹æ¡ˆä¸€ï¼ˆInputConnectionæ‹¦æˆªï¼‰
  ç†ç”±: æ€§èƒ½æœ€ä¼˜ï¼Œä»£ç æœ€ç®€æ´

<span class="hljs-section">åœºæ™¯2: éœ€è¦è‡ªå®šä¹‰è¿‡æ»¤è§„åˆ™ï¼ˆå¦‚ç”µè¯å·ç ï¼šæ•°å­— + '-'ï¼‰</span>
  æ¨è: æ–¹æ¡ˆä¸‰ï¼ˆè‡ªå®šä¹‰Filter + InputConnectionï¼‰
  ç†ç”±: çµæ´»æ€§é«˜ï¼Œå¯è‡ªå®šä¹‰allowedå­—ç¬¦é›†

<span class="hljs-section">åœºæ™¯3: å¿«é€ŸåŸå‹å¼€å‘</span>
  æ¨è: æ–¹æ¡ˆäºŒï¼ˆTextWatcherï¼‰
  ç†ç”±: æœ€ç®€å•ï¼Œå¿«é€Ÿå®ç°

<span class="hljs-section">åœºæ™¯4: é«˜æ€§èƒ½è¦æ±‚ï¼ˆå¦‚å¤§é‡EditTextï¼‰</span>
  æ¨è: æ–¹æ¡ˆä¸€ï¼ˆInputConnectionæ‹¦æˆªï¼‰
  ç†ç”±: æ€§èƒ½å¼€é”€æœ€å°

<span class="hljs-section">åœºæ™¯5: å¤æ‚è¾“å…¥éªŒè¯ï¼ˆå¦‚é‡‘é¢ï¼šæ•°å­— + å°æ•°ç‚¹ï¼Œæœ€å¤š2ä½å°æ•°ï¼‰</span>
  æ¨è: æ–¹æ¡ˆä¸‰ï¼ˆè‡ªå®šä¹‰Filterï¼‰
  ç†ç”±: å¯ä»¥åœ¨filter()ä¸­å®ç°å¤æ‚è§„åˆ™
</code></pre>
<h4 data-id="heading-23">5.3 å®é™…é¡¹ç›®ä¸­çš„ä½¿ç”¨</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç¤ºä¾‹ï¼šé‡‘é¢è¾“å…¥æ¡†ï¼ˆå…è®¸æ•°å­—å’Œå°æ•°ç‚¹ï¼Œæœ€å¤š2ä½å°æ•°ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MoneyEditText</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatEditText</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> InputConnection <span class="hljs-title function_">onCreateInputConnection</span><span class="hljs-params">(EditorInfo outAttrs)</span> {
        <span class="hljs-type">InputConnection</span> <span class="hljs-variable">base</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">super</span>.onCreateInputConnection(outAttrs);
        <span class="hljs-keyword">if</span> (base == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MoneyInputConnectionWrapper</span>(base, <span class="hljs-literal">true</span>);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MoneyInputConnectionWrapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">InputConnectionWrapper</span> {

        <span class="hljs-keyword">public</span> <span class="hljs-title function_">MoneyInputConnectionWrapper</span><span class="hljs-params">(InputConnection target, <span class="hljs-type">boolean</span> mutable)</span> {
            <span class="hljs-built_in">super</span>(target, mutable);
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">setComposingText</span><span class="hljs-params">(CharSequence text, <span class="hljs-type">int</span> newCursorPosition)</span> {
            <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦ç¬¦åˆé‡‘é¢æ ¼å¼</span>
            <span class="hljs-keyword">if</span> (text != <span class="hljs-literal">null</span> &amp;&amp; !isValidMoneyInput(text)) {
                <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.finishComposingText();
            }
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.setComposingText(text, newCursorPosition);
        }

        <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isValidMoneyInput</span><span class="hljs-params">(CharSequence text)</span> {
            <span class="hljs-comment">// å…è®¸ï¼šæ•°å­—ã€å°æ•°ç‚¹</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> text.toString();
            <span class="hljs-comment">// ç®€å•éªŒè¯ï¼šåªåŒ…å«[0-9.]</span>
            <span class="hljs-keyword">return</span> str.matches(<span class="hljs-string">"[0-9.]*"</span>);
        }
    }

    <span class="hljs-comment">// å¯ä»¥é…åˆInputFilteråšæ›´å¤æ‚çš„éªŒè¯ï¼ˆå¦‚æœ€å¤š2ä½å°æ•°ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MoneyInputFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InputFilter</span> {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> CharSequence <span class="hljs-title function_">filter</span><span class="hljs-params">(CharSequence source, <span class="hljs-type">int</span> start, <span class="hljs-type">int</span> end,
                                   Spanned dest, <span class="hljs-type">int</span> dstart, <span class="hljs-type">int</span> dend)</span> {
            <span class="hljs-comment">// ç»„åˆåçš„å®Œæ•´æ–‡æœ¬</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">beforeInsert</span> <span class="hljs-operator">=</span> dest.subSequence(<span class="hljs-number">0</span>, dstart).toString();
            <span class="hljs-type">String</span> <span class="hljs-variable">afterInsert</span> <span class="hljs-operator">=</span> dest.subSequence(dend, dest.length()).toString();
            <span class="hljs-type">String</span> <span class="hljs-variable">newText</span> <span class="hljs-operator">=</span> beforeInsert + source.subSequence(start, end) + afterInsert;

            <span class="hljs-comment">// éªŒè¯ï¼šæœ€å¤šä¸€ä¸ªå°æ•°ç‚¹</span>
            <span class="hljs-keyword">if</span> (newText.indexOf(<span class="hljs-string">'.'</span>) != newText.lastIndexOf(<span class="hljs-string">'.'</span>)) {
                <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>; <span class="hljs-comment">// æ‹’ç»ï¼ˆå¤šä¸ªå°æ•°ç‚¹ï¼‰</span>
            }

            <span class="hljs-comment">// éªŒè¯ï¼šå°æ•°ç‚¹åæœ€å¤š2ä½</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">dotIndex</span> <span class="hljs-operator">=</span> newText.indexOf(<span class="hljs-string">'.'</span>);
            <span class="hljs-keyword">if</span> (dotIndex != -<span class="hljs-number">1</span> &amp;&amp; newText.length() - dotIndex &gt; <span class="hljs-number">3</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>; <span class="hljs-comment">// æ‹’ç»ï¼ˆè¶…è¿‡2ä½å°æ•°ï¼‰</span>
            }

            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">// æ¥å—</span>
        }
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-24">å…­ã€å·¥ç¨‹å®è·µçš„æœ€ä½³å®è·µ</h3>
<h4 data-id="heading-25">6.1 æ€§èƒ½ç›‘æ§</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MonitoredNumberEditText</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatEditText</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> InputConnection <span class="hljs-title function_">onCreateInputConnection</span><span class="hljs-params">(EditorInfo outAttrs)</span> {
        <span class="hljs-type">InputConnection</span> <span class="hljs-variable">base</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">super</span>.onCreateInputConnection(outAttrs);
        <span class="hljs-keyword">if</span> (base == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MonitoredInputConnectionWrapper</span>(base, <span class="hljs-literal">true</span>);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MonitoredInputConnectionWrapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">InputConnectionWrapper</span> {

        <span class="hljs-keyword">public</span> <span class="hljs-title function_">MonitoredInputConnectionWrapper</span><span class="hljs-params">(InputConnection target, <span class="hljs-type">boolean</span> mutable)</span> {
            <span class="hljs-built_in">super</span>(target, mutable);
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">setComposingText</span><span class="hljs-params">(CharSequence text, <span class="hljs-type">int</span> newCursorPosition)</span> {
            <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.nanoTime();

            <span class="hljs-type">boolean</span> result;
            <span class="hljs-keyword">if</span> (text != <span class="hljs-literal">null</span> &amp;&amp; containsNonDigit(text)) {
                result = <span class="hljs-built_in">super</span>.finishComposingText();
            } <span class="hljs-keyword">else</span> {
                result = <span class="hljs-built_in">super</span>.setComposingText(text, newCursorPosition);
            }

            <span class="hljs-type">long</span> <span class="hljs-variable">duration</span> <span class="hljs-operator">=</span> System.nanoTime() - startTime;
            <span class="hljs-keyword">if</span> (duration &gt; <span class="hljs-number">1_000_000</span>) { <span class="hljs-comment">// è¶…è¿‡1ms</span>
                Log.w(<span class="hljs-string">"InputMonitor"</span>, <span class="hljs-string">"setComposingText slow: "</span> + duration / <span class="hljs-number">1_000_000.0</span> + <span class="hljs-string">"ms"</span>);
            }

            <span class="hljs-keyword">return</span> result;
        }

        <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">containsNonDigit</span><span class="hljs-params">(CharSequence text)</span> {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; text.length(); i++) {
                <span class="hljs-keyword">if</span> (!Character.isDigit(text.charAt(i))) {
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                }
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
    }
}
</code></pre>
<h4 data-id="heading-26">6.2 æ—¥å¿—è°ƒè¯•</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DebugNumberEditText</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatEditText</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TAG</span> <span class="hljs-operator">=</span> <span class="hljs-string">"DebugNumberEditText"</span>;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> InputConnection <span class="hljs-title function_">onCreateInputConnection</span><span class="hljs-params">(EditorInfo outAttrs)</span> {
        <span class="hljs-type">InputConnection</span> <span class="hljs-variable">base</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">super</span>.onCreateInputConnection(outAttrs);
        <span class="hljs-keyword">if</span> (base == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DebugInputConnectionWrapper</span>(base, <span class="hljs-literal">true</span>);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DebugInputConnectionWrapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">InputConnectionWrapper</span> {

        <span class="hljs-keyword">public</span> <span class="hljs-title function_">DebugInputConnectionWrapper</span><span class="hljs-params">(InputConnection target, <span class="hljs-type">boolean</span> mutable)</span> {
            <span class="hljs-built_in">super</span>(target, mutable);
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">setComposingText</span><span class="hljs-params">(CharSequence text, <span class="hljs-type">int</span> newCursorPosition)</span> {
            Log.d(TAG, <span class="hljs-string">"setComposingText: text='"</span> + text + <span class="hljs-string">"', cursor="</span> + newCursorPosition);

            <span class="hljs-type">boolean</span> <span class="hljs-variable">hasNonDigit</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">if</span> (text != <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; text.length(); i++) {
                    <span class="hljs-type">char</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> text.charAt(i);
                    <span class="hljs-keyword">if</span> (!Character.isDigit(c)) {
                        hasNonDigit = <span class="hljs-literal">true</span>;
                        Log.w(TAG, <span class="hljs-string">"  Detected non-digit: '"</span> + c + <span class="hljs-string">"' at index "</span> + i);
                    }
                }
            }

            <span class="hljs-type">boolean</span> result;
            <span class="hljs-keyword">if</span> (hasNonDigit) {
                Log.d(TAG, <span class="hljs-string">"  Action: finishComposingText() (rejecting non-digit input)"</span>);
                result = <span class="hljs-built_in">super</span>.finishComposingText();
            } <span class="hljs-keyword">else</span> {
                Log.d(TAG, <span class="hljs-string">"  Action: setComposingText() (accepting digit input)"</span>);
                result = <span class="hljs-built_in">super</span>.setComposingText(text, newCursorPosition);
            }

            Log.d(TAG, <span class="hljs-string">"  Result: "</span> + result);
            <span class="hljs-keyword">return</span> result;
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">commitText</span><span class="hljs-params">(CharSequence text, <span class="hljs-type">int</span> newCursorPosition)</span> {
            Log.d(TAG, <span class="hljs-string">"commitText: text='"</span> + text + <span class="hljs-string">"', cursor="</span> + newCursorPosition);
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.commitText(text, newCursorPosition);
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">finishComposingText</span><span class="hljs-params">()</span> {
            Log.d(TAG, <span class="hljs-string">"finishComposingText"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.finishComposingText();
        }
    }
}
</code></pre>
<h4 data-id="heading-27">6.3 å•å…ƒæµ‹è¯•</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RunWith(RobolectricTestRunner.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NumberEditTextTest</span> {

    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testDigitInput</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// æµ‹è¯•æ­£å¸¸æ•°å­—è¾“å…¥</span>
        <span class="hljs-type">RecommendedNumberEditText</span> <span class="hljs-variable">editText</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RecommendedNumberEditText</span>(ApplicationProvider.getApplicationContext());
        editText.setText(<span class="hljs-string">"123"</span>);

        <span class="hljs-type">InputConnection</span> <span class="hljs-variable">ic</span> <span class="hljs-operator">=</span> editText.onCreateInputConnection(<span class="hljs-keyword">new</span> <span class="hljs-title class_">EditorInfo</span>());
        ic.setComposingText(<span class="hljs-string">"456"</span>, <span class="hljs-number">1</span>);

        assertEquals(<span class="hljs-string">"123456"</span>, editText.getText().toString());
    }

    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testLetterInput</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// æµ‹è¯•å­—æ¯è¾“å…¥ï¼ˆåº”è¯¥è¢«æ‹’ç»ï¼‰</span>
        <span class="hljs-type">RecommendedNumberEditText</span> <span class="hljs-variable">editText</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RecommendedNumberEditText</span>(ApplicationProvider.getApplicationContext());
        editText.setText(<span class="hljs-string">"123"</span>);

        <span class="hljs-type">InputConnection</span> <span class="hljs-variable">ic</span> <span class="hljs-operator">=</span> editText.onCreateInputConnection(<span class="hljs-keyword">new</span> <span class="hljs-title class_">EditorInfo</span>());
        ic.setComposingText(<span class="hljs-string">"abc"</span>, <span class="hljs-number">1</span>);

        <span class="hljs-comment">// å†…å®¹ä¸åº”è¯¥å˜åŒ–</span>
        assertEquals(<span class="hljs-string">"123"</span>, editText.getText().toString());
    }

    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testMixedInput</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// æµ‹è¯•æ··åˆè¾“å…¥</span>
        <span class="hljs-type">RecommendedNumberEditText</span> <span class="hljs-variable">editText</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RecommendedNumberEditText</span>(ApplicationProvider.getApplicationContext());
        editText.setText(<span class="hljs-string">"123"</span>);

        <span class="hljs-type">InputConnection</span> <span class="hljs-variable">ic</span> <span class="hljs-operator">=</span> editText.onCreateInputConnection(<span class="hljs-keyword">new</span> <span class="hljs-title class_">EditorInfo</span>());
        ic.setComposingText(<span class="hljs-string">"4a5"</span>, <span class="hljs-number">1</span>);

        <span class="hljs-comment">// åŒ…å«å­—æ¯ï¼Œåº”è¯¥è¢«æ‹’ç»</span>
        assertEquals(<span class="hljs-string">"123"</span>, editText.getText().toString());
    }
}
</code></pre>
<h4 data-id="heading-28">6.4 å…¼å®¹æ€§æµ‹è¯•</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * æµ‹è¯•ä¸åŒè¾“å…¥æ³•çš„å…¼å®¹æ€§
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IMECompatibilityTest</span> {

    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testBaiduIME</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// æ¨¡æ‹Ÿç™¾åº¦è¾“å…¥æ³•çš„è¡Œä¸º</span>
        <span class="hljs-comment">// ...</span>
    }

    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSogouIME</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// æ¨¡æ‹Ÿæœç‹—è¾“å…¥æ³•çš„è¡Œä¸º</span>
        <span class="hljs-comment">// ...</span>
    }

    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testGboard</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// æ¨¡æ‹ŸGoogle Gboardçš„è¡Œä¸º</span>
        <span class="hljs-comment">// ...</span>
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-29">ä¸ƒã€å¸¸è§é—®é¢˜ä¸è§£ç­”</h3>
<h4 data-id="heading-30">7.1 ä¸ºä»€ä¹ˆä¸ç›´æ¥å»æ‰inputType="number"ï¼Ÿ</h4>
<p><strong>é—®é¢˜</strong>ï¼šå»æ‰inputTypeåï¼Œä¸ä¼šæœ‰Bugï¼Œä¸ºä»€ä¹ˆä¸è¿™æ ·åšï¼Ÿ</p>
<p><strong>è§£ç­”</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">å»æ‰ <span class="hljs-attr">inputType</span>=<span class="hljs-string">"number"</span> çš„åæœ:
1. å¼¹å‡ºå…¨é”®ç›˜ï¼ˆè€Œä¸æ˜¯æ•°å­—é”®ç›˜ï¼‰
2. ç”¨æˆ·ä½“éªŒå˜å·®ï¼ˆè¾“å…¥æ•°å­—éœ€è¦åˆ‡æ¢é”®ç›˜ï¼‰
3. æ— æ³•ä½¿ç”¨ç³»ç»Ÿçš„æ•°å­—é”®ç›˜ä¼˜åŒ–

ä¿ç•™ <span class="hljs-attr">inputType</span>=<span class="hljs-string">"number"</span> + InputConnectionæ‹¦æˆª:
1. ä¿ç•™æ•°å­—é”®ç›˜ï¼ˆç”¨æˆ·ä½“éªŒå¥½ï¼‰
2. é¿å…æ•°æ®ä¸¢å¤±ï¼ˆæŠ€æœ¯æ­£ç¡®ï¼‰
3. æœ€ä½³å®è·µ
</code></pre>
<h4 data-id="heading-31">7.2 ä¸ºä»€ä¹ˆè°ƒç”¨finishComposingText()ï¼Ÿ</h4>
<p><strong>é—®é¢˜</strong>ï¼šä¸ºä»€ä¹ˆä¸ç›´æ¥return falseï¼Ÿ</p>
<p><strong>è§£ç­”</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// é”™è¯¯åšæ³•</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">setComposingText</span><span class="hljs-params">(CharSequence text, <span class="hljs-type">int</span> newCursorPosition)</span> {
    <span class="hljs-keyword">if</span> (containsNonDigit(text)) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// âœ— è¾“å…¥æ³•ä¼šè®¤ä¸ºå¤±è´¥ï¼Œå¯èƒ½é‡è¯•æˆ–æŠ¥é”™</span>
    }
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.setComposingText(text, newCursorPosition);
}

<span class="hljs-comment">// æ­£ç¡®åšæ³•</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">setComposingText</span><span class="hljs-params">(CharSequence text, <span class="hljs-type">int</span> newCursorPosition)</span> {
    <span class="hljs-keyword">if</span> (containsNonDigit(text)) {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.finishComposingText(); <span class="hljs-comment">// âœ“ å‘Šè¯‰è¾“å…¥æ³•"ç»„åˆå·²å®Œæˆ"</span>
    }
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.setComposingText(text, newCursorPosition);
}
</code></pre>
<p><strong>åŸå› </strong>ï¼š</p>
<ul>
<li><code>finishComposingText()</code> æ˜¯åˆæ³•çš„æ“ä½œï¼Œè¾“å…¥æ³•ä¼šæ­£å¸¸å¤„ç†</li>
<li>è¿”å› <code>false</code> è¡¨ç¤ºæ“ä½œå¤±è´¥ï¼Œè¾“å…¥æ³•å¯èƒ½å‡ºç°å¼‚å¸¸è¡Œä¸º</li>
<li><code>finishComposingText()</code> ä¼šæ¸…é™¤COMPOSING Spanï¼Œé¿å…åç»­é—®é¢˜</li>
</ul>
<h4 data-id="heading-32">7.3 ä¸ºä»€ä¹ˆä¸ç”¨setFilterså®Œå…¨æ›¿ä»£ï¼Ÿ</h4>
<p><strong>é—®é¢˜</strong>ï¼šä¸ºä»€ä¹ˆä¸åªç”¨InputFilterï¼Œè¿˜è¦ç”¨InputConnectionï¼Ÿ</p>
<p><strong>è§£ç­”</strong>ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">å•ç‹¬ä½¿ç”¨ InputFilter çš„é—®é¢˜:
<span class="hljs-bullet">1.</span> æ— æ³•é˜»æ­¢deleteæ“ä½œï¼ˆdeleteç»•è¿‡Filterï¼‰
<span class="hljs-bullet">2.</span> ä»ä¼šè§¦å‘Bug

å•ç‹¬ä½¿ç”¨ InputConnection çš„ä¼˜åŠ¿:
<span class="hljs-bullet">1.</span> æ‹¦æˆªæ—¶æœºæ—©ï¼ˆdeleteä¹‹å‰ï¼‰
<span class="hljs-bullet">2.</span> ä»æºå¤´è§£å†³é—®é¢˜

æœ€ä½³å®è·µ:
  InputConnectionæ‹¦æˆªä¸ºä¸»ï¼ˆæ–¹æ¡ˆä¸€ï¼‰
  æˆ– InputFilter + InputConnectionåŒé‡ä¿æŠ¤ï¼ˆæ–¹æ¡ˆä¸‰ï¼‰
</code></pre>
<h4 data-id="heading-33">7.4 å¦‚ä½•æ”¯æŒå°æ•°ç‚¹ï¼Ÿ</h4>
<p><strong>æ‰©å±•æ–¹æ¡ˆ</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isValidNumberInput</span><span class="hljs-params">(CharSequence text)</span> {
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; text.length(); i++) {
        <span class="hljs-type">char</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> text.charAt(i);
        <span class="hljs-comment">// å…è®¸æ•°å­—å’Œå°æ•°ç‚¹</span>
        <span class="hljs-keyword">if</span> (!Character.isDigit(c) &amp;&amp; c != <span class="hljs-string">'.'</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}

<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">setComposingText</span><span class="hljs-params">(CharSequence text, <span class="hljs-type">int</span> newCursorPosition)</span> {
    <span class="hljs-keyword">if</span> (text != <span class="hljs-literal">null</span> &amp;&amp; !isValidNumberInput(text)) {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.finishComposingText();
    }
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.setComposingText(text, newCursorPosition);
}

<span class="hljs-comment">// åŒæ—¶è®¾ç½®inputType</span>
setInputType(InputType.TYPE_CLASS_NUMBER | InputType.TYPE_NUMBER_FLAG_DECIMAL);
</code></pre>
<hr/>
<h3 data-id="heading-34">å…«ã€æ€»ç»“ï¼šä»ç†è®ºåˆ°å®è·µçš„å®Œæ•´é“¾è·¯</h3>
<h4 data-id="heading-35">8.1 ä¸‰ç¯‡æ–‡ç« çš„çŸ¥è¯†é“¾</h4>
<pre><code class="hljs language-sql" lang="sql">ç¬¬ä¸€ç¯‡ï¼šBinderé€šä¿¡æœºåˆ¶
  â”œâ”€ ä¸‰è¿›ç¨‹æ¶æ„
  â”œâ”€ AIDLæ¥å£å®šä¹‰
  â”œâ”€ Stub<span class="hljs-operator">/</span>Proxyå®ç°
  â”œâ”€ çº¿ç¨‹åˆ‡æ¢
  â””â”€ ä¿¡æ¯ä¸å¯¹ç§°
       â†“ ä¸ºä»€ä¹ˆè¾“å…¥æ³•ä¸çŸ¥é“å®é™…ç»“æœ

ç¬¬äºŒç¯‡ï¼šæ–‡æœ¬ç¼–è¾‘è®¾è®¡ç¼ºé™·
  â”œâ”€ InputFilteræ¥å£å±€é™
  â”œâ”€ <span class="hljs-keyword">delete</span>ç»•è¿‡<span class="hljs-keyword">Filter</span>
  â”œâ”€ replaceTextå…ˆ<span class="hljs-keyword">delete</span>å<span class="hljs-keyword">insert</span>
  â”œâ”€ SpanèŒƒå›´å¼‚å¸¸æ‰©å±•
  â””â”€ ä¸å¯¹ç§°çš„æ§åˆ¶æƒ
       â†“ ä¸ºä»€ä¹ˆæ•°å­—ä¼šè¢«åˆ é™¤

ç¬¬ä¸‰ç¯‡ï¼ˆæœ¬æ–‡ï¼‰ï¼šå·¥ç¨‹è§£å†³æ–¹æ¡ˆ
  â”œâ”€ InputConnectionæ‹¦æˆªï¼ˆæ¨èï¼‰
  â”œâ”€ TextWatcherè¿‡æ»¤ï¼ˆç®€å•ï¼‰
  â”œâ”€ è‡ªå®šä¹‰InputFilterï¼ˆçµæ´»ï¼‰
  â”œâ”€ ä¸‰ç§æ–¹æ¡ˆå¯¹æ¯”
  â”œâ”€ é€‰å‹æŒ‡å—
  â”œâ”€ æœ€ä½³å®è·µ
  â””â”€ å®Œæ•´ä»£ç 
       â†“ å¦‚ä½•åœ¨å®é™…é¡¹ç›®ä¸­è§£å†³
</code></pre>
<h4 data-id="heading-36">8.2 æœ€ä½³å®è·µæ€»ç»“</h4>






























<table><thead><tr><th>åœºæ™¯</th><th>æ¨èæ–¹æ¡ˆ</th><th>æ ¸å¿ƒä»£ç </th></tr></thead><tbody><tr><td><strong>æ™®é€šæ•°å­—è¾“å…¥</strong></td><td>InputConnectionæ‹¦æˆª</td><td><code>finishComposingText()</code></td></tr><tr><td><strong>è‡ªå®šä¹‰è§„åˆ™</strong></td><td>è‡ªå®šä¹‰Filter + IC</td><td><code>filter()</code> + <code>finishComposingText()</code></td></tr><tr><td><strong>å¿«é€Ÿå¼€å‘</strong></td><td>TextWatcher</td><td><code>afterTextChanged()</code> + <code>setText()</code></td></tr><tr><td><strong>é«˜æ€§èƒ½</strong></td><td>InputConnectionæ‹¦æˆª</td><td>é¿å…å¤šä½™æ“ä½œ</td></tr></tbody></table>
<h4 data-id="heading-37">8.3 æ ¸å¿ƒè¦ç‚¹</h4>
<pre><code class="hljs language-markdown" lang="markdown">å…³é”®è®¾è®¡å†³ç­–:
<span class="hljs-bullet">1.</span> ä¿ç•™ inputType="number" ï¼ˆæ•°å­—é”®ç›˜ï¼‰
<span class="hljs-bullet">2.</span> é‡å†™ onCreateInputConnection() ï¼ˆæ‹¦æˆªå…¥å£ï¼‰
<span class="hljs-bullet">3.</span> åŒ…è£… InputConnectionWrapper ï¼ˆæ‰©å±•åŠŸèƒ½ï¼‰
<span class="hljs-bullet">4.</span> æ‹¦æˆª setComposingText() ï¼ˆå…³é”®æ–¹æ³•ï¼‰
<span class="hljs-bullet">5.</span> è°ƒç”¨ finishComposingText() ï¼ˆæ­£ç¡®å¤„ç†ï¼‰

ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡:
<span class="hljs-bullet">1.</span> ç”¨æˆ·ä½“éªŒï¼šæ•°å­—é”®ç›˜æ›´æ–¹ä¾¿
<span class="hljs-bullet">2.</span> æ€§èƒ½ä¼˜åŒ–ï¼šæ‹¦æˆªæ—©ï¼Œå¼€é”€å°
<span class="hljs-bullet">3.</span> å…¼å®¹æ€§å¥½ï¼šå¯¹è¾“å…¥æ³•é€æ˜
<span class="hljs-bullet">4.</span> ä»£ç ç®€æ´ï¼šåªéœ€40è¡Œä»£ç 
<span class="hljs-bullet">5.</span> æ˜“äºç»´æŠ¤ï¼šé€»è¾‘æ¸…æ™°
</code></pre>
<h4 data-id="heading-38">8.4 å»¶ä¼¸åº”ç”¨</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å¯ä»¥æ‰©å±•åˆ°å…¶ä»–åœºæ™¯:</span>

<span class="hljs-comment">// 1. æ‰‹æœºå·è¾“å…¥ï¼ˆæ•°å­— + ç©ºæ ¼/æ¨ªçº¿ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PhoneNumberEditText</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatEditText</span> {
    <span class="hljs-comment">// ...</span>
}

<span class="hljs-comment">// 2. é‚®ç®±è¾“å…¥ï¼ˆé™åˆ¶ç‰¹æ®Šå­—ç¬¦ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EmailEditText</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatEditText</span> {
    <span class="hljs-comment">// ...</span>
}

<span class="hljs-comment">// 3. ç”¨æˆ·åè¾“å…¥ï¼ˆå­—æ¯ + æ•°å­— + ä¸‹åˆ’çº¿ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UsernameEditText</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatEditText</span> {
    <span class="hljs-comment">// ...</span>
}

<span class="hljs-comment">// 4. å¯†ç è¾“å…¥ï¼ˆå¢å¼ºå®‰å…¨ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SecurePasswordEditText</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatEditText</span> {
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-39">ä¹ã€å®Œæ•´ç¤ºä¾‹é¡¹ç›®ç»“æ„</h3>
<pre><code class="hljs language-css" lang="css">app/<span class="hljs-attribute">src</span>/<span class="hljs-selector-tag">main</span>/java/com/yourpackage/
â”œâ”€ widget/
â”‚  â”œâ”€ RecommendedNumberEditText<span class="hljs-selector-class">.java</span>   â† æ–¹æ¡ˆä¸€ï¼ˆæ¨èï¼‰
â”‚  â”œâ”€ SimpleNumberEditText<span class="hljs-selector-class">.java</span>        â† æ–¹æ¡ˆäºŒ
â”‚  â”œâ”€ SafeNumberEditText<span class="hljs-selector-class">.java</span>          â† æ–¹æ¡ˆä¸‰
â”‚  â”œâ”€ MoneyEditText<span class="hljs-selector-class">.java</span>               â† æ‰©å±•ï¼šé‡‘é¢è¾“å…¥
â”‚  â”œâ”€ PhoneNumberEditText<span class="hljs-selector-class">.java</span>         â† æ‰©å±•ï¼šç”µè¯è¾“å…¥
â”‚  â””â”€ DebugNumberEditText<span class="hljs-selector-class">.java</span>         â† è°ƒè¯•ç‰ˆæœ¬
â”‚
â”œâ”€ utils/
â”‚  â””â”€ InputValidationUtils<span class="hljs-selector-class">.java</span>        â† é€šç”¨éªŒè¯å·¥å…·
â”‚
â””â”€ MainActivity<span class="hljs-selector-class">.java</span>

app/<span class="hljs-attribute">src</span>/<span class="hljs-selector-tag">main</span>/res/layout/
â””â”€ activity_main<span class="hljs-selector-class">.xml</span>

app/<span class="hljs-attribute">src</span>/test/java/com/yourpackage/
â””â”€ NumberEditTextTest<span class="hljs-selector-class">.java</span>             â† å•å…ƒæµ‹è¯•
</code></pre>
<hr/>
<h3 data-id="heading-40">å‚è€ƒèµ„æ–™</h3>
<ol>
<li>Androidæºç ï¼š<code>frameworks/base/core/java/android/view/inputmethod/InputConnectionWrapper.java</code></li>
<li>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Freference%2Fandroid%2Fview%2Finputmethod%2FInputConnectionWrapper" target="_blank" title="https://developer.android.com/reference/android/view/inputmethod/InputConnectionWrapper" ref="nofollow noopener noreferrer">InputConnectionWrapper</a></li>
<li>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Freference%2Fandroid%2Fview%2Finputmethod%2FInputConnection" target="_blank" title="https://developer.android.com/reference/android/view/inputmethod/InputConnection" ref="nofollow noopener noreferrer">InputConnection</a></li>
<li>æœ¬ç³»åˆ—å‰ä¸¤ç¯‡ï¼š
<ul>
<li>ç¬¬ä¸€ç¯‡ï¼šã€ŠAndroidè¾“å…¥æ³•æ¡†æ¶çš„Binderé€šä¿¡æœºåˆ¶å‰–æã€‹</li>
<li>ç¬¬äºŒç¯‡ï¼šã€Šä»ä¸€ä¸ªBugçœ‹Androidæ–‡æœ¬ç¼–è¾‘çš„è®¾è®¡ç¼ºé™·ã€‹</li>
</ul>
</li>
</ol>
<hr/>
<h3 data-id="heading-41">é™„å½•ï¼šå®Œæ•´å¯è¿è¡Œçš„ç¤ºä¾‹ä»£ç </h3>
<p><strong>RecommendedNumberEditText.java</strong>ï¼ˆç›´æ¥å¤åˆ¶å¯ç”¨ï¼‰ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.yourpackage.widget;

<span class="hljs-keyword">import</span> android.content.Context;
<span class="hljs-keyword">import</span> android.util.AttributeSet;
<span class="hljs-keyword">import</span> android.view.inputmethod.EditorInfo;
<span class="hljs-keyword">import</span> android.view.inputmethod.InputConnection;
<span class="hljs-keyword">import</span> android.view.inputmethod.InputConnectionWrapper;
<span class="hljs-keyword">import</span> androidx.appcompat.widget.AppCompatEditText;

<span class="hljs-comment">/**
 * æ¨èçš„æ•°å­—è¾“å…¥æ¡†å®ç°
 * è§£å†³ inputType="number" æ—¶ï¼Œåˆ‡æ¢å­—æ¯é”®ç›˜å¯¼è‡´æ•°å­—ä¸¢å¤±çš„é—®é¢˜
 *
 * ä½¿ç”¨æ–¹æ³•:
 * &lt;com.yourpackage.widget.RecommendedNumberEditText
 *     android:inputType="number"
 *     ... /&gt;
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RecommendedNumberEditText</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatEditText</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RecommendedNumberEditText</span><span class="hljs-params">(Context context)</span> {
        <span class="hljs-built_in">super</span>(context);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RecommendedNumberEditText</span><span class="hljs-params">(Context context, AttributeSet attrs)</span> {
        <span class="hljs-built_in">super</span>(context, attrs);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RecommendedNumberEditText</span><span class="hljs-params">(Context context, AttributeSet attrs, <span class="hljs-type">int</span> defStyleAttr)</span> {
        <span class="hljs-built_in">super</span>(context, attrs, defStyleAttr);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> InputConnection <span class="hljs-title function_">onCreateInputConnection</span><span class="hljs-params">(EditorInfo outAttrs)</span> {
        <span class="hljs-type">InputConnection</span> <span class="hljs-variable">base</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">super</span>.onCreateInputConnection(outAttrs);
        <span class="hljs-keyword">if</span> (base == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NumberInputConnectionWrapper</span>(base, <span class="hljs-literal">true</span>);
    }

    <span class="hljs-comment">/**
     * è‡ªå®šä¹‰InputConnectionåŒ…è£…ç±»
     * æ‹¦æˆªsetComposingTextï¼Œæ£€æŸ¥æ˜¯å¦åŒ…å«éæ•°å­—å­—ç¬¦
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NumberInputConnectionWrapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">InputConnectionWrapper</span> {

        <span class="hljs-keyword">public</span> <span class="hljs-title function_">NumberInputConnectionWrapper</span><span class="hljs-params">(InputConnection target, <span class="hljs-type">boolean</span> mutable)</span> {
            <span class="hljs-built_in">super</span>(target, mutable);
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">setComposingText</span><span class="hljs-params">(CharSequence text, <span class="hljs-type">int</span> newCursorPosition)</span> {
            <span class="hljs-keyword">if</span> (text != <span class="hljs-literal">null</span> &amp;&amp; containsNonDigit(text)) {
                <span class="hljs-comment">// åŒ…å«éæ•°å­—å­—ç¬¦ï¼Œç›´æ¥å®Œæˆç»„åˆï¼ˆä¸æ‰§è¡Œdelete-insertï¼‰</span>
                <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.finishComposingText();
            }
            <span class="hljs-comment">// çº¯æ•°å­—æˆ–nullï¼Œæ­£å¸¸å¤„ç†</span>
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.setComposingText(text, newCursorPosition);
        }

        <span class="hljs-comment">/**
         * æ£€æŸ¥æ˜¯å¦åŒ…å«éæ•°å­—å­—ç¬¦
         */</span>
        <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">containsNonDigit</span><span class="hljs-params">(CharSequence text)</span> {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; text.length(); i++) {
                <span class="hljs-keyword">if</span> (!Character.isDigit(text.charAt(i))) {
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                }
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
    }
}
</code></pre>
<p><strong>activity_main.xml</strong>ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"utf-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">LinearLayout</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">"http://schemas.android.com/apk/res/android"</span>
    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"match_parent"</span>
    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"match_parent"</span>
    <span class="hljs-attr">android:orientation</span>=<span class="hljs-string">"vertical"</span>
    <span class="hljs-attr">android:padding</span>=<span class="hljs-string">"16dp"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">TextView</span>
        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"wrap_content"</span>
        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span>
        <span class="hljs-attr">android:text</span>=<span class="hljs-string">"æ¨èæ–¹æ¡ˆï¼ˆInputConnectionæ‹¦æˆªï¼‰ï¼š"</span>
        <span class="hljs-attr">android:textSize</span>=<span class="hljs-string">"16sp"</span>
        <span class="hljs-attr">android:textStyle</span>=<span class="hljs-string">"bold"</span> /&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">com.yourpackage.widget.RecommendedNumberEditText</span>
        <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/edit_recommended"</span>
        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"match_parent"</span>
        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span>
        <span class="hljs-attr">android:hint</span>=<span class="hljs-string">"è¯·è¾“å…¥æ•°å­—"</span>
        <span class="hljs-attr">android:inputType</span>=<span class="hljs-string">"number"</span> /&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">TextView</span>
        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"wrap_content"</span>
        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span>
        <span class="hljs-attr">android:layout_marginTop</span>=<span class="hljs-string">"24dp"</span>
        <span class="hljs-attr">android:text</span>=<span class="hljs-string">"æµ‹è¯•è¯´æ˜ï¼š"</span>
        <span class="hljs-attr">android:textSize</span>=<span class="hljs-string">"14sp"</span> /&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">TextView</span>
        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"wrap_content"</span>
        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span>
        <span class="hljs-attr">android:layout_marginTop</span>=<span class="hljs-string">"8dp"</span>
        <span class="hljs-attr">android:text</span>=<span class="hljs-string">"1. è¾“å…¥æ•°å­— 123456\n2. åˆ‡æ¢åˆ°å­—æ¯é”®ç›˜\n3. è¿ç»­ç‚¹å‡»å­—æ¯ 'q'\n4. æ•°å­—ä¸ä¼šè¢«åˆ é™¤ âœ“"</span>
        <span class="hljs-attr">android:textSize</span>=<span class="hljs-string">"12sp"</span> /&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">LinearLayout</span>&gt;</span>
</code></pre>
<hr/>
<p><strong>ç³»åˆ—å®Œç»“</strong>ã€‚ä»Binderé€šä¿¡æœºåˆ¶ï¼Œåˆ°æ–‡æœ¬ç¼–è¾‘è®¾è®¡ç¼ºé™·ï¼Œå†åˆ°å®Œæ•´çš„å·¥ç¨‹è§£å†³æ–¹æ¡ˆï¼Œå¸Œæœ›è¿™ä¸‰ç¯‡æ–‡ç« èƒ½å¸®åŠ©ä½ æ·±å…¥ç†è§£Androidè¾“å…¥æ³•æ¡†æ¶ï¼Œå¹¶åœ¨å®é™…é¡¹ç›®ä¸­æ¸¸åˆƒæœ‰ä½™åœ°è§£å†³ç±»ä¼¼é—®é¢˜ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è¿›å…¥èŒåœºç¬¬ä¸‰è¯¾â€”â€”ç«‹è¶³]]></title>    <link>https://juejin.cn/post/7570935965435510799</link>    <guid>https://juejin.cn/post/7570935965435510799</guid>    <pubDate>2025-11-10T13:58:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570935965435510799" data-draft-id="7570901172527497251" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è¿›å…¥èŒåœºç¬¬ä¸‰è¯¾â€”â€”ç«‹è¶³"/> <meta itemprop="keywords" content="ç¨‹åºå‘˜"/> <meta itemprop="datePublished" content="2025-11-10T13:58:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Mapbarfront"/> <meta itemprop="url" content="https://juejin.cn/user/624178336632407"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è¿›å…¥èŒåœºç¬¬ä¸‰è¯¾â€”â€”ç«‹è¶³
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/624178336632407/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Mapbarfront
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T13:58:13.000Z" title="Mon Nov 10 2025 13:58:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">è¿›å…¥èŒåœºç¬¬ä¸‰è¯¾â€”ç«‹è¶³</h2>
<p>åœ¨è§‚å¯Ÿå’Œèå…¥ä¹‹åï¼Œè¦åšçš„ç¬¬ä¸‰ä»¶äº‹å°±æ˜¯ç«‹è¶³ã€‚ä½ å·²ç»åº¦è¿‡äº†æ–°æ‰‹æœŸï¼Œæ¥ä¸‹æ¥ï¼Œéœ€è¦ä½ æ‰¿æ‹…æ›´å¤šæœ‰æŒ‘æˆ˜çš„å·¥ä½œï¼Œæ¥è¯æ˜ä½ çš„èƒ½åŠ›ã€‚</p>
<p>å¦‚æœä½ æ˜¯åº”å±Šæ–°äººï¼Œè¿™ä¸ªæ—¶å€™å¯èƒ½è·Ÿç€å¸¦ä½ çš„å¯¼å¸ˆï¼Œå¼€å§‹æ­£å¼å‚åŠ ä¸šåŠ¡å¼€å‘ï¼›å¦‚æœä½ æ˜¯èŒåœºè€é¸Ÿï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ä½ ç‹¬ç«‹å®Œæˆä»»åŠ¡äº†ã€‚è¿™ä¸ªé˜¶æ®µæ˜¯ä½ ç»™ç›´å±é¢†å¯¼ï¼Œä¹Ÿå°±æ˜¯ä½ çš„è€æ¿ï¼Œå»ºç«‹å°è±¡æœ€å…³é”®çš„æ—¶åˆ»ï¼Œå¦‚æœç¬¦åˆé¢„æœŸç”šè‡³è¶…é¢„æœŸï¼Œä»¥åï¼Œåœ¨å…¬å¸å¤§æ¦‚ç‡ä¼šå‘å±•çš„é¡ºé¡ºåˆ©åˆ©ï¼›å¦‚æœä¸åŠé¢„æœŸçš„è¯ï¼Œåˆ™å¯èƒ½ä¼šè¢«è€æ¿è´´ä¸Šä¸å¤ªè¡Œçš„æ ‡ç­¾ï¼Œè¢«å½’ä¸ºä½ç»©æ•ˆçš„å€™é€‰äººã€‚</p>
<p>æ¸¡è¿‡äº†æ–°æ‰‹æœŸï¼Œæ¥ä¸‹æ¥å°±è¯¥ç«‹è¶³äº†ï¼Œåªæœ‰ç«™å¾—ç¨³ï¼Œæ‰èƒ½èµ°å¾—å¥½ï¼Œæ‰æœ‰æœºä¼šè·³å¾—é«˜ï¼Œæ˜“ç»ä¹¾å¦ä¸­çš„è§é¾™åœ¨ç”°ï¼Œè¯´çš„å°±æ˜¯è¿™ä¸ªæ„æ€ï¼Œæƒ³è¦ç«‹è¶³ï¼Œæƒ³è¦ç«™å¾—ç¨³ï¼Œä½ éœ€è¦åšå¥½ä»¥ä¸‹è¿™å››ä¸ªåŠ¨ä½œã€‚</p>
<h3 data-id="heading-1">1ã€åšå¥½ç¬¬ä¸€ä¸ªç‹¬ç«‹ä»»åŠ¡</h3>
<p>ä»æ–°æ‰‹æœŸçš„å­¦ä¹ é€‚åº”ï¼Œåˆ°ç«‹è¶³æœŸçš„æ‰¿æ‹…è´Ÿè´£ï¼Œè¿™æ˜¯å›¢é˜Ÿå†…å…¶ä»–æˆå‘˜ï¼Œå¯¹ä½ é¢„æœŸçš„æ”¹å˜ï¼Œè€æ¿ç»™äº†ä½ å¾ˆé•¿æ—¶é—´ï¼Œæ˜¯æ—¶å€™ä½“ç°ä½ çš„ä»·å€¼äº†ï¼Œå½“ä½ æ¥åˆ°ç¬¬ä¸€ä¸ªç‹¬ç«‹å®Œæˆçš„ä»»åŠ¡ï¼Œå°¤å…¶é‡è¦ï¼Œä½ éœ€è¦èŠ±120%çš„å¿ƒæ€æ¥æŠŠå®ƒåšå¥½ã€‚</p>
<p>åŸå› å¾ˆç®€å•ï¼Œè¿™ä¸ªä»»åŠ¡å®Œæˆçš„å¥½åï¼Œç›´æ¥å†³å®šï¼Œä½ åœ¨è€æ¿å¿ƒä¸­å»ºç«‹ä»€ä¹ˆæ ·çš„å°è±¡ï¼Œæƒ³è¢«è€æ¿è®¤å¯ï¼Œåç»­è¢«ä»–å½’åˆ°æ”¾å¿ƒã€é è°±è¿™ä¸€ç±»é‡Œï¼Œç¬¬ä¸€ä¸ªç‹¬ç«‹ä»»åŠ¡æ˜¯ä½ å¿…é¡»åšå¥½çš„ã€‚å½“ç„¶ï¼Œä½ æ¥çš„æ—¶é—´è¿˜ä¸é•¿ï¼Œä¸€äº›å†å²å€ºåŠ¡å¯èƒ½è¿˜ä¸æ¸…æ¥šï¼Œä»ç„¶å­˜åœ¨çŠ¯é”™çš„å¯èƒ½æ€§ï¼Œæ²¡å…³ç³»ï¼Œå°½åŠ›å»æŠŠå®ƒåšå¥½ï¼Œå³ä½¿çŠ¯é”™ä¹Ÿåˆ«æ‹…å¿ƒï¼Œç§¯ææ”¹æ­£çš„åŠªåŠ›æ€åº¦ä¸€å®šè¦æ‰“æ»¡ã€‚</p>
<h3 data-id="heading-2">2ã€ä¸»åŠ¨ä¼˜åŒ–ä¸€ä¸ªå°äº‹</h3>
<p>æ¯ä¸ªå…¬å¸ã€æ¯ä¸ªå›¢é˜Ÿï¼Œéƒ½æœ‰å¤§å¤§å°å°ã€å„ç§å„æ ·çš„é—®é¢˜ï¼Œå°±ç®—å†ä¼˜ç§€çš„å›¢é˜Ÿï¼Œä¹Ÿä¸€å®šæœ‰å°çš„ç‘•ç–µå¯ä»¥ä¼˜åŒ–ï¼Œåœ¨ä½ è´Ÿè´£çš„å·¥ä½œèŒƒå›´å†…ï¼Œæ‰¾åˆ°ä¸€ä»¶å°äº‹æƒ…ï¼Œåœ¨é¢†å¯¼æ²¡æœ‰å®‰æ’ï¼Œå…¶ä»–åŒäº‹é»˜è®¤æ¥å—çš„æƒ…å†µä¸‹ï¼Œä½ ä¸»åŠ¨å»æŠŠå®ƒä¼˜åŒ–ä¸€ä¸‹ï¼Œåšçš„æ›´å¥½ä¸€ç‚¹ï¼Œè®©å›¢é˜Ÿçš„åä½œæ•ˆç‡å˜å¾—æ›´é«˜ä¸€ç‚¹ï¼Œå¯åˆ«å°çœ‹è¿™ç§å°äº‹æƒ…ï¼Œè¿™æ˜¯æœ‰è§‚å¯ŸåŠ›ã€ä¸»åŠ¨æ€è€ƒçš„å…¸å‹è¡¨ç°ï¼Œä¼šç»™è€æ¿å’Œå›¢é˜Ÿå…¶ä»–æˆå‘˜ï¼Œç•™ä¸‹å¾ˆå¥½çš„å°è±¡ã€‚</p>
<h3 data-id="heading-3">3ã€ä¸ºè‡ªå·±è´´ä¸Šé è°±çš„æ ‡ç­¾</h3>
<p>å‡¡äº‹æœ‰äº¤ä»£ï¼Œä»¶ä»¶æœ‰ç€è½ï¼Œäº‹äº‹æœ‰å›å“ï¼Œæ— è®ºæ˜¯ç‹¬ç«‹ä»»åŠ¡ã€åˆä½œä»»åŠ¡ï¼Œåˆæˆ–è€…æ˜¯å…±åŒè®¨è®ºï¼Œä¸»åŠ¨å‚ä¸ã€ç§¯æåé¦ˆã€æ‡‚å¾—å¿…è¿˜ï¼Œè¿™äº›éƒ½æ˜¯å»ºç«‹ä¿¡ä»»çš„è¡Œä¸ºï¼Œä¹Ÿæ˜¯ä¸ºè‡ªå·±è´´ä¸Šé è°±æ ‡ç­¾çš„åŠ¨ä½œï¼Œåƒä¸‡è®°å¾—ï¼Œä¸€å®šä¸è¦è®©æµè½¬åˆ°ä½ æ‰‹ä¸Šçš„äº‹æƒ…ï¼Œæ²¡å®Œæˆã€æ²¡ä¸‹æ–‡ï¼Œæ‰åœ¨åœ°ä¸Šï¼ŒåŒæ—¶ï¼Œæœ‰é£é™©ä¹Ÿè¦ç¬¬ä¸€æ—¶é—´åŒæ­¥å‡ºæ¥ï¼Œä¸è¦æ‚åœ¨è‡ªå·±çš„ç›–å­åº•ä¸‹ã€‚</p>
<h3 data-id="heading-4">4ã€ç»“äº¤æ­£ç£åœºçš„åŒäº‹</h3>
<p>å›¢é˜Ÿé‡Œï¼Œè€æ¿å–œæ¬¢çš„äººï¼Œå¾€å¾€æ˜¯ä¸»åŠ›è¾“å‡ºï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸­é«˜ç»©æ•ˆï¼Œå¦‚æœä½ æœ‰é‡å¿ƒï¼Œæƒ³åœ¨å›¢é˜Ÿé‡Œç«‹è¶³ï¼Œç«‹çš„é«˜ä¸€ç‚¹ï¼Œå°½é‡è¦ç»“äº¤é‚£äº›ï¼Œèƒ½ç»™ä½ æä¾›æ­£ç£åœºçš„åŒäº‹ï¼Œäººéƒ½æ˜¯æœ‰ç£åœºçš„ï¼Œæ¯ä¸ªäººçš„ç£åœºä¹Ÿä¸åŒï¼Œç£åœºä¹‹é—´ç›¸äº’å¸å¼•ã€ç›¸äº’å½±å“ï¼Œç›¸äº’ä¼ é€’ã€‚</p>
<p>ä½ç»©æ•ˆï¼Œè¾¹ç¼˜åŒ–çš„åŒäº‹ï¼Œä»–å¯èƒ½è‡ªå·±å·²ç»æ‘†çƒ‚äº†æˆ–è€…æƒ³æºœäº†ï¼Œä½ è·Ÿä»–åœ¨ä¸€èµ·ï¼Œé™¤äº†å¤©å¤©å¬ä»–åæ§½å…¬å¸ã€åæ§½è€æ¿ï¼ŒæŠ±æ€¨ä¸œæŠ±æ€¨è¥¿ï¼Œå•¥ä¹Ÿæ”¶è·ä¸äº†ï¼Œè€Œä¸”æ—¶é—´é•¿äº†ï¼Œåœ¨è€æ¿çœ¼é‡Œï¼Œä½ ä¹Ÿä¼šè¢«å½’åˆ°å’Œä»–åŒä¸€ç±»æ€åº¦é‡Œå»ã€‚</p>
<h2 data-id="heading-5">ç»“è¯­</h2>
<p>è§é¾™åœ¨ç”°ï¼Œåˆ©è§å¤§äººï¼Œä¹Ÿæœ‰è¯¥ç»“äº¤å¯ä»¥å¸®åŠ©ä½ è´µäººçš„æ„æ€ï¼Œåšå¥½ä¸Šé¢è¿™4ä»¶äº‹ï¼Œä½ å°±ç®—åœ¨å›¢é˜Ÿä¸­çœŸæ­£çš„ç«‹è¶³ç«™ç¨³äº†ã€‚</p>
<p>ä½ çš„èƒ½åŠ›æœ‰äº†æ–½å±•çš„æœºä¼šï¼Œä½ ä¹Ÿå¼€å§‹çœŸæ­£ç‹¬ç«‹çš„è¢«äººå®¡è§†ï¼Œè¢«äººçœ‹è§ï¼Œè¿™æ˜¯ä¸€ä¸ªä»è¢«åŠ¨æ¥å—ï¼Œåˆ°ä¸»åŠ¨æ‰¿æ‹…çš„è¿‡ç¨‹ã€‚</p>
<p>è§é¾™åœ¨ç”°ï¼Œé¾™åˆšåˆšå‡ºç°åœ¨å¤§åœ°ä¸Šè¢«äººå‘ç°ï¼Œé‡ç‚¹åœ¨äºæ˜¾ç°ï¼Œè€Œä¸æ˜¯å†²åˆºï¼Œç«‹è¶³ç«™ç¨³ï¼Œè€Œä¸æ˜¯æ€¥åŠŸè¿‘åˆ©ï¼Œåˆ«ç€æ€¥ï¼Œåé¢çš„è·¯è¿˜é•¿ç€å‘¢ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[éœ‡æ’¼ä¸šç•Œï¼šæ–‡å¿ƒ5.0 Previewç™»é¡¶å…¨çƒç¬¬äºŒï¼Œåˆ›æ„å†™ä½œèƒ½åŠ›äº®çœ¼ï¼]]></title>    <link>https://juejin.cn/post/7570885801478553641</link>    <guid>https://juejin.cn/post/7570885801478553641</guid>    <pubDate>2025-11-10T14:00:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570885801478553641" data-draft-id="7570908785293656083" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="éœ‡æ’¼ä¸šç•Œï¼šæ–‡å¿ƒ5.0 Previewç™»é¡¶å…¨çƒç¬¬äºŒï¼Œåˆ›æ„å†™ä½œèƒ½åŠ›äº®çœ¼ï¼"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2025-11-10T14:00:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¢¨é£å¦‚é›ª"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            éœ‡æ’¼ä¸šç•Œï¼šæ–‡å¿ƒ5.0 Previewç™»é¡¶å…¨çƒç¬¬äºŒï¼Œåˆ›æ„å†™ä½œèƒ½åŠ›äº®çœ¼ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¢¨é£å¦‚é›ª
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T14:00:44.000Z" title="Mon Nov 10 2025 14:00:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ€è¿‘AIåœˆå­çœŸæ˜¯çƒ­é—¹éå‡¡ï¼Œå„å¤§æ¨¡å‹ä½ æ–¹å”±ç½¢æˆ‘ç™»åœºï¼Œä½†å¦‚æœè¯´å“ªä¸ªæ¶ˆæ¯æœ€è®©äººå¿ƒå¤´ä¸€éœ‡ï¼Œé‚£è«è¿‡äºç™¾åº¦æ–‡å¿ƒå¤§æ¨¡å‹5.0 Previewçš„æ¨ªç©ºå‡ºä¸–ï¼Œå®ƒä¸ä»…ä¸€ä¸¾é—®é¼å›½å†…å¤§æ¨¡å‹ä¹‹é¦–ï¼Œæ›´æ˜¯åœ¨å›½é™…èˆå°ä¸Šæ€å…¥äº†å…¨çƒå¹¶åˆ—ç¬¬äºŒçš„å®åº§ï¼Œå°¤å…¶åœ¨åˆ›æ„å†™ä½œæ–¹é¢ï¼Œæ›´æ˜¯ç‹¬æ­¥å¤©ä¸‹ï¼Œæ‹¿ä¸‹äº†å…¨çƒç¬¬ä¸€çš„æ¡‚å† ï¼</p>
<p>è¿™å¯ä¸æ˜¯ä»€ä¹ˆå®éªŒå®¤é‡Œçš„æ•°æ®ï¼Œè€Œæ˜¯æ¥è‡ªAIç•Œå…¬è®¤çš„æƒå¨è¯„æµ‹å¹³å°â€”â€”LMArenaï¼ˆåŸåLMSYS Chatbot Arenaï¼‰çš„å®æˆ˜ç»“æœã€‚è¿™ä¸ªç”±åŠ å·å¤§å­¦ä¼¯å…‹åˆ©åˆ†æ ¡å›¢é˜Ÿæ‰“é€ çš„å¹³å°ï¼Œè¯„æµ‹æœºåˆ¶å¯ä»¥è¯´ç›¸å½“â€œæ®‹é…·â€ä½†ä¹Ÿæœ€è´´è¿‘çœŸå®ï¼šå®ƒè®©å…¨çƒç”¨æˆ·å¯¹ä¸¤ä¸ªåŒ¿åçš„æ¨¡å‹å›ç­”è¿›è¡Œç›²æµ‹æŠ•ç¥¨ï¼Œè°ç­”å¾—å¥½å°±ç»™è°ä¸€ç¥¨ã€‚è¿™ç§åŸºäºç”¨æˆ·çœŸå®åå¥½çš„Eloè¯„åˆ†ç³»ç»Ÿï¼Œèƒ½æœ€ç›´è§‚åœ°åæ˜ æ¨¡å‹åœ¨å®é™…åº”ç”¨ä¸­çš„ç”¨æˆ·ä½“éªŒå’Œèƒ½åŠ›ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-10_21.49.55-1024x459.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-10_21.49.55-1024x459.png" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3436459c86fb45338d988e052ab726c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763388044&amp;x-signature=Yv4VwgSfUz%2F12ZBNrMpTObMqqBE%3D" alt="iShot_2025-11-10_21.49.55" loading="lazy"/></a></p>
<h3 data-id="heading-0">LMArenaæ¦œå•çš„æƒŠè‰³è¡¨ç°</h3>
<p>å°±åœ¨æœ€è¿‘çš„LMArena Text Arenaæ¦œå•ä¸Šï¼Œæ–‡å¿ƒ5.0 Previewï¼ˆERNIE-5.0-Preview-1022ï¼‰å‡­å€Ÿ1432åˆ†çš„Eloé«˜åˆ†ï¼Œä¸OpenAIçš„GPT-4.5-Previewã€Anthropicçš„Claude-Opus-4-1ç­‰å›½é™…é¡¶çº§æ¨¡å‹å¹³èµ·å¹³åï¼Œä¸€åŒä½åˆ—å…¨çƒå¹¶åˆ—ç¬¬äºŒã€‚æ›´ä»¤äººå…´å¥‹çš„æ˜¯ï¼Œå®ƒè¶…è¶Šäº†åŒ…æ‹¬GPT-5-Highã€Qwen3-Maxã€DeepSeek-R1åœ¨å†…çš„è¯¸å¤šå›½å†…å¤–ä¸»æµå¼ºåŠ²å¯¹æ‰‹ã€‚è¿™ä¸å…‰æ˜¯æ–‡å¿ƒçš„èƒœåˆ©ï¼Œæ›´æ˜¯å›½äº§å¤§æ¨¡å‹è¿ˆå‘å…¨çƒå·…å³°çš„é‡è¦é‡Œç¨‹ç¢‘ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-10_21.50.03-1024x726.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-10_21.50.03-1024x726.png" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6d2c8280f584680a4368bac46b1111b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763388044&amp;x-signature=L%2Bx%2BGhpQvyJr6NHYbXGQRsT4Kmg%3D" alt="iShot_2025-11-10_21.50.03" loading="lazy"/></a></p>
<h3 data-id="heading-1">ä¸‰å¤§æ ¸å¿ƒèƒ½åŠ›ï¼Œå®šä¹‰é¡¶å°–æ°´å‡†</h3>
<p>é‚£ä¹ˆï¼Œè¿™ä¸ªæ–°æ¥çš„â€œé»‘é©¬â€ç©¶ç«Ÿå‡­ä»€ä¹ˆèƒ½ä¸€é¸£æƒŠäººå‘¢ï¼Ÿåœ¨æˆ‘çœ‹æ¥ï¼Œæ–‡å¿ƒ5.0 Previewåœ¨ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒæ–‡æœ¬èƒ½åŠ›ç»´åº¦ä¸Šï¼Œç¡®å®å±•ç°äº†é¡¶çº§æ°´å‡†ï¼š</p>
<h4 data-id="heading-2">ğŸ† åˆ›æ„å†™ä½œï¼šå…¨çƒç‹¬ä¸€ä»½çš„â€œå¦™ç¬”ç”ŸèŠ±â€</h4>
<p>è¦è¯´æœ€è®©äººæ‹æ¡ˆå«ç»çš„ï¼Œå¿…é¡»æ˜¯æ–‡å¿ƒ5.0 Previewåœ¨<strong>åˆ›æ„å†™ä½œ</strong>ä¸Šçš„ç»Ÿæ²»åŠ›â€”â€”å®ƒåœ¨è¿™ä¸ªç»´åº¦æ‹¿ä¸‹äº†<strong>å…¨çƒç¬¬ä¸€</strong>ï¼è¿™æ„å‘³ç€ï¼Œæ— è®ºæ˜¯ç­–åˆ’ä¸€åœºå£°åŠ¿æµ©å¤§çš„è¥é”€æˆ˜å½¹ã€æ’°å†™å¼•äººå…¥èƒœçš„å‰§æœ¬ï¼Œè¿˜æ˜¯ç”Ÿæˆä¸€ç¯‡æƒ…æ„ŸçœŸæŒšçš„æ–‡ç« ï¼Œå®ƒçš„äº§å‡ºéƒ½èƒ½åœ¨æ•ˆç‡å’Œè´¨é‡ä¸Šå®ç°å¤§å¹…è·ƒå‡ã€‚æœ‰å®æµ‹æ¡ˆä¾‹æ˜¾ç¤ºï¼Œåœ¨ç­–åˆ’ä¸€åœºè¥é”€æˆ˜å½¹æ—¶ï¼Œæ–‡å¿ƒ5.0 Previewä¸ä»…èƒ½æŠ“ä½â€œæƒ…ç»ªä»·å€¼â€çš„æ ¸å¿ƒæ´å¯Ÿï¼Œè¿è¾“å‡ºçš„çŸ­è§†é¢‘è„šæœ¬éƒ½ä¸“ä¸šåˆ°ä»¤äººæƒŠå¹ï¼Œç”»é¢ã€å‰ªè¾‘ç‚¹ã€éŸ³æ•ˆç­‰æ‰§è¡Œç»†èŠ‚ä¸€åº”ä¿±å…¨ï¼Œè¿™å¯ä¸æ˜¯ç®€å•çš„å †ç Œæ–‡å­—ï¼Œè€Œæ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„â€œå¦™ç¬”ç”ŸèŠ±â€ã€‚</p>
<h4 data-id="heading-3">ğŸ§  å¤æ‚é•¿é—®é¢˜ç†è§£ï¼šæ´å¯Ÿæ·±å±‚é€»è¾‘çš„â€œæ™ºè€…â€</h4>
<p>åœ¨å¤„ç†<strong>å¤æ‚é•¿é—®é¢˜</strong>æ–¹é¢ï¼Œæ–‡å¿ƒ5.0 Previewä¹Ÿè¡¨ç°å‡ºäº†éå‡¡çš„æ‰èƒ½ã€‚å®ƒæ“…é•¿å¤„ç†é‚£äº›æ‹¥æœ‰å¤šå±‚é€»è¾‘ã€éœ€è¦æ·±å…¥é˜…è¯»å’Œæ¨ç†çš„é•¿æ–‡æœ¬ä»»åŠ¡ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œé¢å¯¹ä¸€ç¯‡å†—é•¿çš„å­¦æœ¯æŠ¥å‘Šï¼Œæˆ–è€…ä¸€ä¸ªéœ€è¦å¤šæ–¹é¢çŸ¥è¯†èåˆçš„æ·±åº¦é—®ç­”ï¼Œå®ƒèƒ½å¤Ÿç²¾å‡†æŠŠæ¡æ ¸å¿ƒè¦ç‚¹ï¼Œè¿›è¡Œé«˜æ•ˆçš„çŸ¥è¯†æ¨ç†å’Œåˆ†æã€‚è¿™å¯¹äºç§‘ç ”ã€æ³•å¾‹ã€é‡‘èç­‰é«˜è®¤çŸ¥è¦æ±‚çš„åœºæ™¯ï¼Œç®€ç›´æ˜¯å¦‚è™æ·»ç¿¼ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-10_21.50.09-1024x742.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-10_21.50.09-1024x742.png" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c20f358cc2f9492d8ab091f17d873731~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763388044&amp;x-signature=VuX6EDrmBLEcNTHHDjQe8mkNbO8%3D" alt="iShot_2025-11-10_21.50.09" loading="lazy"/></a></p>
<h4 data-id="heading-4">âœ… æŒ‡ä»¤éµå¾ªï¼šç²¾ç¡®æ— è¯¯çš„â€œæ‰§è¡Œå®˜â€</h4>
<p>ç¬¬ä¸‰ä¸ªæ ¸å¿ƒèƒ½åŠ›æ˜¯<strong>æŒ‡ä»¤éµå¾ª</strong>ã€‚è¿™å¬èµ·æ¥ç®€å•ï¼Œä½†åœ¨å®é™…åº”ç”¨ä¸­å´è‡³å…³é‡è¦ã€‚æ–‡å¿ƒ5.0 Previewèƒ½ç²¾å‡†ç†è§£å¹¶æ‰§è¡Œç”¨æˆ·æå‡ºçš„å„é¡¹å¤æ‚æ„å›¾ï¼Œè¿™å¯¹äºæ™ºèƒ½åŠ©ç†ã€ä»£ç ç”Ÿæˆã€ä¸šåŠ¡æµç¨‹è‡ªåŠ¨åŒ–ç­‰åœºæ™¯ï¼Œæ˜¯ä¿è¯è¾“å‡ºå¯é æ€§å’Œå‡†ç¡®æ€§çš„åŸºçŸ³ã€‚è¿˜è®°å¾—é‚£ä¸ªä»¤äººç§°å¥‡çš„æµ‹è¯•å—ï¼Ÿåœ¨æ’°å†™å…³äºâ€œåŒ—äº¬â€çš„ä»‹ç»æ—¶ï¼Œæ¨¡å‹è¢«è¦æ±‚åŒæ—¶æ»¡è¶³â€œç¦æ­¢ä½¿ç”¨â€˜çš„â€™å­—ã€ç¦æ­¢ä½¿ç”¨é€—å·å’Œé¡¿å·ã€å¿…é¡»åˆ†ä¸‰ä¸ªç¼–å·æ®µè½â€ç­‰å¤šé¡¹åç›´è§‰çš„è‹›åˆ»çº¦æŸã€‚ç»“æœå‘¢ï¼Ÿå®ƒå‡ºè‰²åœ°ç†è§£å¹¶å®Œç¾æ‰§è¡Œäº†æ‰€æœ‰è§„åˆ™ï¼Œåœ¨å®Œå…¨ä¸ç”¨ç‰¹å®šæ ‡ç‚¹å’Œå­—è¯çš„æƒ…å†µä¸‹ï¼Œä¾ç„¶ç”Ÿæˆäº†ä¸€æ®µè¿è´¯ä¸”å¯Œæœ‰æ–‡é‡‡çš„ä»‹ç»ï¼Œè¿™ç®€ç›´æ˜¯åœ¨AIçš„â€œåˆ€å°–ä¸Šè·³èˆâ€ï¼</p>
<h3 data-id="heading-5">å›½äº§AIï¼Œæœªæ¥å¯æœŸ</h3>
<p>æ–‡å¿ƒ5.0 Previewçš„å¼ºåŠ²è¡¨ç°ï¼Œç»éå¶ç„¶ã€‚è¿™èƒŒåæ˜¯ç™¾åº¦åœ¨â€œèŠ¯ç‰‡-æ¡†æ¶-æ¨¡å‹-åº”ç”¨â€å››å±‚å…¨æ ˆAIæŠ€æœ¯å¸ƒå±€ä¸Šçš„é•¿æœŸæ·±è€•ä¸ç§¯ç´¯ã€‚è¿™ä¸å…‰æ˜¯æ¨¡å‹çš„èƒœåˆ©ï¼Œæ›´æ˜¯ç™¾åº¦åœ¨AIé¢†åŸŸé•¿æœŸæŠ•å…¥çš„å…¨æ ˆæŠ€æœ¯ä½“ç³»å¼€èŠ±ç»“æœï¼Œå®ƒæ¸…æ™°åœ°å‘Šè¯‰æˆ‘ä»¬ï¼Œä¸­å›½çš„å¤§æ¨¡å‹åœ¨ç†è§£å’Œç”Ÿæˆäººç±»è¯­è¨€æ–¹é¢ï¼Œå·²ç»å®Œå…¨æœ‰èƒ½åŠ›ä¸å…¨çƒæœ€é¡¶å°–çš„äº§å“æ°æ‰‹è…•ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-10_21.50.18-1024x725.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-10_21.50.18-1024x725.png" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67f77e84520c4c21b64349d8fcda82d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763388044&amp;x-signature=%2B4Bh0ustsJWE9xKqr9WV7hFQPzQ%3D" alt="iShot_2025-11-10_21.50.18" loading="lazy"/></a></p>
<p>è™½ç„¶ç›®å‰æˆ‘ä»¬çœ‹åˆ°çš„æ˜¯ä¸€ä¸ªPreviewç‰ˆæœ¬ï¼Œä½†å®ƒå¸¦æ¥çš„æƒŠå–œå·²ç»è¶³å¤Ÿéœ‡åŠ¨ä¸šç•Œã€‚æ®æ‚‰ï¼Œæ–‡å¿ƒå¤§æ¨¡å‹çš„æœ€æ–°åŸºåº§æ¨¡å‹è®¡åˆ’äº2025å¹´11æœˆ13æ—¥çš„ç™¾åº¦ä¸–ç•Œå¤§ä¼šä¸Šæ­£å¼å‘å¸ƒï¼Œå±Šæ—¶ï¼Œå¼€å‘è€…å’Œç”¨æˆ·å°†æœ‰æœºä¼šæ›´å…¨é¢åœ°ä½“éªŒå®ƒçš„å¼ºå¤§èƒ½åŠ›ã€‚ä½œä¸ºAIåˆ›ä½œè€…ï¼Œæˆ‘å·²ç»è¿«ä¸åŠå¾…æƒ³çœ‹çœ‹å®ƒåœ¨æ›´å¹¿é˜”çš„åº”ç”¨åœºæ™¯ä¸­ï¼Œè¿˜èƒ½å¸¦æ¥å¤šå°‘æƒŠå–œã€‚å›½äº§AIçš„æœªæ¥ï¼Œä»æœªå¦‚æ­¤æ¸…æ™°å’Œä»¤äººæŒ¯å¥‹ï¼</p>
<p><strong>å¦‚æœä½ ä¹Ÿå¯¹æœ€æ–°çš„AIä¿¡æ¯æ„Ÿå…´è¶£æˆ–è€…æœ‰ç–‘é—® éƒ½å¯ä»¥åŠ å…¥æˆ‘çš„å¤§å®¶åº­ ç¬¬ä¸€æ—¶é—´åˆ†äº«æœ€æ–°AIèµ„è®¯ã€å·¥å…·ã€æ•™ç¨‹ã€æ–‡æ¡£ æ¬¢è¿ä½ çš„åŠ å…¥ï¼ï¼ï¼ğŸ˜‰ğŸ˜‰ğŸ˜‰</strong></p>
<p>å…¬ä¼—å·ï¼šå¢¨é£å¦‚é›ªå°ç«™</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C#/.NET/.NET CoreæŠ€æœ¯å‰æ²¿å‘¨åˆŠ | ç¬¬ 60 æœŸï¼ˆ2025å¹´11.1-11.9ï¼‰]]></title>    <link>https://juejin.cn/post/7570902804451475466</link>    <guid>https://juejin.cn/post/7570902804451475466</guid>    <pubDate>2025-11-10T12:03:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570902804451475466" data-draft-id="7570912420567744522" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C#/.NET/.NET CoreæŠ€æœ¯å‰æ²¿å‘¨åˆŠ | ç¬¬ 60 æœŸï¼ˆ2025å¹´11.1-11.9ï¼‰"/> <meta itemprop="keywords" content="åç«¯,.NET"/> <meta itemprop="datePublished" content="2025-11-10T12:03:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è¿½é€æ—¶å…‰è€…"/> <meta itemprop="url" content="https://juejin.cn/user/2770425031690333"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C#/.NET/.NET CoreæŠ€æœ¯å‰æ²¿å‘¨åˆŠ | ç¬¬ 60 æœŸï¼ˆ2025å¹´11.1-11.9ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2770425031690333/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è¿½é€æ—¶å…‰è€…
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T12:03:25.000Z" title="Mon Nov 10 2025 12:03:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/43a29eaf433a41e99b3836c7caf5a516~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763381005&amp;x-signature=02RmGren4qCBIuicXq0AsqbFjkg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">å‰è¨€</h2>
<p>C#/.NET/.NET CoreæŠ€æœ¯å‰æ²¿å‘¨åˆŠï¼Œä½ çš„æ¯å‘¨æŠ€æœ¯æŒ‡å—é’ˆï¼è®°å½•ã€è¿½è¸ªC#/.NET/.NET Coreé¢†åŸŸã€ç”Ÿæ€çš„æ¯å‘¨æœ€æ–°ã€æœ€å®ç”¨ã€æœ€æœ‰ä»·å€¼çš„æŠ€æœ¯æ–‡ç« ã€ç¤¾åŒºåŠ¨æ€ã€ä¼˜è´¨é¡¹ç›®å’Œå­¦ä¹ èµ„æºç­‰ã€‚è®©ä½ æ—¶åˆ»ç«™åœ¨æŠ€æœ¯å‰æ²¿ï¼ŒåŠ©åŠ›æŠ€æœ¯æˆé•¿ä¸è§†é‡æ‹“å®½ã€‚</p>
<blockquote>
<p>æ¬¢è¿æŠ•ç¨¿ã€æ¨èæˆ–è‡ªèä¼˜è´¨æ–‡ç« ã€é¡¹ç›®ã€å­¦ä¹ èµ„æºç­‰ã€‚</p>
</blockquote>
<ul>
<li><strong>ğŸ†æŠ€æœ¯å‰æ²¿å‘¨åˆŠGiteeå¼€æºåœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fysgdaydayup%2FDotNetGuide%2Fblob%2Fmain%2Fdocs%2FDotNet%2FDotNetWeekly.md" target="_blank" title="https://gitee.com/ysgdaydayup/DotNetGuide/blob/main/docs/DotNet/DotNetWeekly.md" ref="nofollow noopener noreferrer">gitee.com/ysgdaydayupâ€¦</a></li>
<li><strong>ğŸ“°æŠ€æœ¯å‰æ²¿å‘¨åˆŠGitHubå¼€æºåœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FYSGStudyHards%2FDotNetGuide%2Fblob%2Fmain%2Fdocs%2FDotNet%2FDotNetWeekly.md" target="_blank" title="https://github.com/YSGStudyHards/DotNetGuide/blob/main/docs/DotNet/DotNetWeekly.md" ref="nofollow noopener noreferrer">github.com/YSGStudyHarâ€¦</a></li>
</ul>
<h2 data-id="heading-1">C#/.NET/.NET Coreä¼˜ç§€é¡¹ç›®å’Œæ¡†æ¶2025å¹´10æœˆç®€æŠ¥</h2>
<ul>
<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong> å…¬ä¼—å·æ¯æœˆå®šæœŸæ¨å¹¿å’Œåˆ†äº«çš„C#/.NET/.NET Coreä¼˜ç§€é¡¹ç›®å’Œæ¡†æ¶ï¼ˆæ¯å‘¨è‡³å°‘ä¼šæ¨èä¸¤ä¸ªä¼˜ç§€çš„é¡¹ç›®å’Œæ¡†æ¶å½“ç„¶èŠ‚å‡æ—¥é™¤å¤–ï¼‰ï¼Œå…¬ä¼—å·æ¨æ–‡ä¸­æœ‰é¡¹ç›®å’Œæ¡†æ¶çš„è¯¦ç»†ä»‹ç»ã€åŠŸèƒ½ç‰¹ç‚¹ã€ä½¿ç”¨æ–¹å¼ä»¥åŠéƒ¨åˆ†åŠŸèƒ½æˆªå›¾ç­‰ï¼ˆæ‰“ä¸å¼€æˆ–è€…æ‰“å¼€GitHubå¾ˆæ…¢çš„åŒå­¦å¯ä»¥ä¼˜å…ˆæŸ¥çœ‹å…¬ä¼—å·æ¨æ–‡ï¼Œæ–‡æœ«ä¸€å®šä¼šé™„å¸¦é¡¹ç›®å’Œæ¡†æ¶æºç åœ°å€ï¼‰ã€‚</li>
<li><strong>æ–‡ç« åœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FDB1UBuiS2BvZjf7VlH0_MQ" target="_blank" title="https://mp.weixin.qq.com/s/DB1UBuiS2BvZjf7VlH0_MQ" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/DB1UBuiS2â€¦</a></li>
</ul>
<h2 data-id="heading-2">äº‹åŠåŠŸå€ï¼š.NET å¼€å‘è€…çš„ Visual Studio æ•ˆç‡æŠ€å·§ï¼</h2>
<ul>
<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong> æœ¬æ–‡å¤§å§šå°†ä¸ºä½ åˆ†äº«ä¸€äº› Visual Studio çš„ä½¿ç”¨æŠ€å·§å’Œå»ºè®®ï¼Œæ—¨åœ¨å¸®åŠ© .NET å¼€å‘è€…æ›´åŠ é«˜æ•ˆåœ°åˆ©ç”¨ Visual Studio è¿›è¡Œç¼–ç¨‹å¼€å‘å·¥ä½œã€‚æ— è®ºä½ æ˜¯ .NET åˆå­¦è€…è¿˜æ˜¯ç»éªŒä¸°å¯Œçš„ .NET å¼€å‘è€…ï¼Œè¿™äº›æŠ€å·§éƒ½å°†æœ‰åŠ©äºæå‡ä½ çš„å·¥ä½œæ•ˆç‡ï¼Œè®©ä½ èƒ½å¤Ÿæ›´å¿«åœ°ç¼–å†™å‡ºé«˜è´¨é‡çš„ä»£ç ã€‚</li>
<li><strong>æ–‡ç« åœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FyHAK0VvcOR8bqZVqOBizXQ" target="_blank" title="https://mp.weixin.qq.com/s/yHAK0VvcOR8bqZVqOBizXQ" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/yHAK0VvcOâ€¦</a></li>
</ul>
<h2 data-id="heading-3">ã€æ‹¾é—è¡¥æ¼ã€‘.NET å¸¸è§æœ¯è¯­é›†</h2>
<ul>
<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong> .NET å¸¸è§æœ¯è¯­é›†æ—¨åœ¨ä¸º .NET åˆå­¦è€…æä¾›ä¸€ä»½æ¸…æ™°çš„å…¥é—¨æŒ‡å¼•ï¼Œä¹Ÿä¸ºç»éªŒä¸°å¯Œçš„ .NET å¼€å‘è€…æä¾›ä¸€ä»½ä¾¿æ·çš„å‚è€ƒï¼Œå¸®åŠ©å¤§å®¶æ›´å‡†ç¡®åœ°è¡¨è¾¾ã€æ›´é«˜æ•ˆåœ°å­¦ä¹ ã€æ›´æ·±å…¥åœ°æ¢ç´¢ .NET çš„å¼ºå¤§åŠŸèƒ½ï¼ˆæœ‰é—æ¼çš„æ¬¢è¿æ–‡æœ«ç•™è¨€ï¼‰ã€‚</li>
<li><strong>æ–‡ç« åœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2FCan-daydayup%2Fp%2F19193323" target="_blank" title="https://www.cnblogs.com/Can-daydayup/p/19193323" ref="nofollow noopener noreferrer">www.cnblogs.com/Can-daydayuâ€¦</a></li>
</ul>
<h2 data-id="heading-4">ä¸€æ¬¾åŸºäº .NET WinForm å¼€æºã€è½»é‡ä¸”åŠŸèƒ½å¼ºå¤§çš„èŠ‚ç‚¹ç¼–è¾‘å™¨</h2>
<ul>
<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong> STNodeEditor æ˜¯ä¸€æ¬¾åŸºäº .NET WinForm å¼€æºå…è´¹ï¼ˆMIT Licenseï¼‰ã€è½»é‡ä¸”åŠŸèƒ½å¼ºå¤§çš„èŠ‚ç‚¹ç¼–è¾‘å™¨ï¼Œé‡‡ç”¨çº¯ GDI+ ç»˜åˆ¶æ— ä»»ä½•ä¾èµ–åº“ä»…ä»…100+Kbï¼Œæä¾›äº†ä¸°å¯Œçš„å±æ€§ä»¥åŠäº‹ä»¶ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿çš„å®ŒæˆèŠ‚ç‚¹ä¹‹é—´æ•°æ®çš„äº¤äº’åŠé€šçŸ¥ï¼Œç¼–è¾‘å™¨å†…ç½®äº†å¤§é‡è™šå‡½æ•°ï¼Œä¾›å¼€å‘è€…æ ¹æ®éœ€æ±‚è¿›è¡Œé‡å†™ï¼Œèµ‹äºˆäº†æé«˜çš„è‡ªç”±åº¦å’Œå®šåˆ¶èƒ½åŠ›ã€‚</li>
<li><strong>æ–‡ç« åœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FfMG3iAu1Y0Fkmf6d-fcgiA" target="_blank" title="https://mp.weixin.qq.com/s/fMG3iAu1Y0Fkmf6d-fcgiA" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/fMG3iAu1Yâ€¦</a></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc08d40683fa477e8650ce425439488d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763381005&amp;x-signature=vcdiT%2FJjvahnXVpAR%2FRfeU15dtM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">ä¸€æ¬¾ .NET å¼€æºï¼ˆGPL-3.0 licenseï¼‰ã€å…è´¹ã€ç°ä»£çš„è¿œç¨‹ä¼šè¯ç®¡ç†å’Œå¯åŠ¨å™¨</h2>
<ul>
<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong> 1Remote æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„ä¸ªäººè¿œç¨‹ä¼šè¯ç®¡ç†å’Œå¯åŠ¨å™¨ï¼Œé€‚ç”¨äºéœ€è¦ç®¡ç†å¤šç§ä¸åŒåè®®è¿œç¨‹ä¼šè¯çš„ç”¨æˆ·ã€‚æ— è®ºæ˜¯ç³»ç»Ÿç®¡ç†å‘˜ã€å¼€å‘äººå‘˜è¿˜æ˜¯ITæ”¯æŒäººå‘˜ï¼Œéƒ½å¯ä»¥é€šè¿‡1Remoteåœ¨ä¸€ä¸ªé›†ä¸­çš„åœ°æ–¹ç®¡ç†ä»–ä»¬çš„æ‰€æœ‰è¿œç¨‹è¿æ¥ï¼Œæé«˜å·¥ä½œæ•ˆç‡å’Œä¾¿åˆ©æ€§ã€‚</li>
<li><strong>æ–‡ç« åœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F4PIKVLGLkOsvSJJO9InvXA" target="_blank" title="https://mp.weixin.qq.com/s/4PIKVLGLkOsvSJJO9InvXA" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/4PIKVLGLkâ€¦</a></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f16c45ff1bbb482694f0b734b8c887c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763381005&amp;x-signature=InIjYF7OsUCLt68OEaIhv7ZSPa0%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">ASP.NET Core éƒ¨ç½²è¿›åŒ–å²ï¼šä» Windows IIS åˆ° Dockerï¼Œå†åˆ°å›½äº§ Linux å®¹å™¨åŒ–å®è·µ</h2>
<ul>
<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong> ASP.NET Core éƒ¨ç½²è¿›åŒ–å²ï¼šä» Windows IIS åˆ° Dockerï¼Œå†åˆ°å›½äº§ Linux å®¹å™¨åŒ–å®è·µã€‚</li>
<li><strong>æ–‡ç« åœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FqxBAzom3He-Lk7hQr7T7bQ" target="_blank" title="https://mp.weixin.qq.com/s/qxBAzom3He-Lk7hQr7T7bQ" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/qxBAzom3Hâ€¦</a></li>
</ul>
<h2 data-id="heading-7">æ·±å…¥æ¢ç´¢C# Channelsï¼šé«˜çº§æ¨¡å¼ä¸å®æˆ˜æŒ‡å—</h2>
<ul>
<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong> æˆ‘ä»¬å·²ç»ä»‹ç»äº†åŸºç¡€çŸ¥è¯†ï¼ŒåŒ…æ‹¬ç±»å‹ã€å¾ªç¯ï¼Œç”šè‡³ä¸€äº›å®é™…åº”ç”¨åœºæ™¯ã€‚ç°åœ¨ï¼Œæ‚¨åº”è¯¥å¯¹ç”Ÿäº§è€…ã€æ¶ˆè´¹è€…ã€å®Œæˆå’Œå–æ¶ˆæ“ä½œæ„Ÿåˆ°ç†Ÿæ‚‰äº†ã€‚ä½† Channels å°±åƒä¸€åº§å†°å±±ï¼›æ‚¨ç›®å‰æ‰€è§çš„ä»…æ˜¯å†°å±±ä¸€è§’ã€‚å…¶åº•å±‚éšè—ç€é«˜çº§æ¨¡å¼ï¼Œå¦‚æœèƒ½å¤Ÿæ°å½“åœ°è¿ç”¨ï¼ˆæˆ–é¿å…ä½¿ç”¨ï¼‰ï¼Œå®ƒä»¬èƒ½è®©æ‚¨çš„ç³»ç»Ÿå‘æŒ¥å‡ºå“è¶Šçš„æ€§èƒ½ã€‚</li>
<li><strong>æ–‡ç« åœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fjhu0IEk_4D1n-cJocPLMbA" target="_blank" title="https://mp.weixin.qq.com/s/jhu0IEk_4D1n-cJocPLMbA" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/jhu0IEk_4â€¦</a></li>
</ul>
<h2 data-id="heading-8">ä¸€ä¸ªå¼€æºã€ç²¾ç¾çš„ WPF ç”¨æˆ·ç•Œé¢</h2>
<ul>
<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong> WPFUIDemo æ˜¯ä¸€ä¸ªä¸“æ³¨äº WPFï¼ˆWindows Presentation Foundationï¼‰ç”¨æˆ·ç•Œé¢è®¾è®¡ä¸å¼€å‘çš„ç¤ºä¾‹é¡¹ç›®ã€‚è¯¥é¡¹ç›®æ—¨åœ¨ä¸ºå¼€å‘è€…æä¾›ä¸€ä¸ªå…¨é¢ã€å®ç”¨çš„å‚è€ƒèŒƒä¾‹ï¼Œå¸®åŠ©ä»–ä»¬å¿«é€ŸæŒæ¡ WPF åº”ç”¨å¼€å‘çš„æ ¸å¿ƒæŠ€å·§å’Œæœ€ä½³å®è·µï¼Œæå‡å¼€å‘æ•ˆç‡ä¸ç•Œé¢è®¾è®¡æ°´å¹³ã€‚é€šè¿‡ä¸°å¯Œçš„åŠŸèƒ½æ¨¡å—å’Œä»£ç ç¤ºä¾‹ï¼Œå¼€å‘è€…å¯ä»¥æ·±å…¥äº†è§£ WPF çš„å¼ºå¤§ç‰¹æ€§ï¼Œå¹¶å°†å…¶çµæ´»åº”ç”¨äºå®é™…é¡¹ç›®ä¸­ã€‚</li>
<li><strong>æ–‡ç« åœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F15oTrGmLzGl4AAUV6maIgw" target="_blank" title="https://mp.weixin.qq.com/s/15oTrGmLzGl4AAUV6maIgw" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/15oTrGmLzâ€¦</a></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a24154ae6baf4a4abe006b250011e0aa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763381005&amp;x-signature=8o%2Bl%2BjX7g6ofRRlwWg7bi7C6q%2BI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-9">ä¸€æ¬¾åŸºäº .NET 8 + Vue å‰åç«¯åˆ†ç¦»çš„å¿«é€Ÿå¼€å‘æ¡†æ¶ï¼Œè§£å†³ 70% çš„é‡å¤å·¥ä½œï¼</h2>
<ul>
<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong> ZrAdminNetCoreÂ æ˜¯ä¸€æ¬¾åŸºäºå‰åç«¯åˆ†ç¦»æ¶æ„ã€è·¨å¹³å°éƒ¨ç½²çš„é€šç”¨æƒé™ç®¡ç†åå°ç³»ç»Ÿï¼Œé‡‡ç”¨Â RBACï¼ˆRole-Based Access Controlï¼‰Â æƒé™æ¨¡å‹è®¾è®¡ï¼Œæ”¯æŒå¤šç§Ÿæˆ·ã€åŠ¨æ€èœå•ã€ç»†ç²’åº¦æƒé™æ§åˆ¶ç­‰åŠŸèƒ½ã€‚é¡¹ç›®ä»¥Â .NET CoreÂ ä¸ºåç«¯æŠ€æœ¯æ ˆï¼Œç»“åˆç°ä»£åŒ–å‰ç«¯æ¡†æ¶æ„å»ºï¼Œé€‚ç”¨äºä¼ä¸šçº§ä¸­åå°ç®¡ç†ç³»ç»Ÿå¿«é€Ÿå¼€å‘ã€‚</li>
<li><strong>æ–‡ç« åœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FilK-HScDVxb9tBykwgP_JQ" target="_blank" title="https://mp.weixin.qq.com/s/ilK-HScDVxb9tBykwgP_JQ" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/ilK-HScDVâ€¦</a></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b10e69eb50b34b46a44e7a6e49522c35~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763381005&amp;x-signature=oPvimKfOYTCAyP03fo7uZ%2FyuBU0%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f8875103a4d4b548847114e259a4e5f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763381005&amp;x-signature=RTruBica7oXG6cFg4A4%2Bvxl8BoI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-10">ã€è¯‘ã€‘Avalonia UIä¸è°·æ­ŒFlutterå›¢é˜Ÿåˆä½œå°†Impelleræ¸²æŸ“å¼•æ“å¼•å…¥.NET</h2>
<ul>
<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong> æˆ‘ä»¬æ¿€åŠ¨åœ°å®£å¸ƒé˜¿ç“¦æ´›å°¼äºšåœ¨æ¸²æŸ“æŠ€æœ¯é“è·¯ä¸Šè¿æ¥ä¸€ä¸ªé‡è¦é‡Œç¨‹ç¢‘ã€‚æˆ‘ä»¬çš„å›¢é˜Ÿæ­£ä¸è°·æ­ŒFlutterå·¥ç¨‹å¸ˆåˆä½œï¼Œå°†å…¶ä¸‹ä¸€ä»£"GPUä¼˜å…ˆ"æ¸²æŸ“å™¨Impellerå¼•å…¥.NETå¼€å‘è€…ç”Ÿæ€ã€‚è¿™é¡¹æŠ€æœ¯åˆä½œæ—¨åœ¨çªç ´è·¨å¹³å°æ€§èƒ½è¾¹ç•Œï¼Œå±•ç°å¼€æºç¤¾åŒºå¦‚ä½•é€šè¿‡åä½œåˆ›é€ æ›´å¤§ä»·å€¼ã€‚</li>
<li><strong>æ–‡ç« åœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FBQz1GrnknYqlAMujSJQ55A" target="_blank" title="https://mp.weixin.qq.com/s/BQz1GrnknYqlAMujSJQ55A" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/BQz1Grnknâ€¦</a></li>
</ul>
<h2 data-id="heading-11">ä¸€æ¬¾ .NET å¼€æºå…è´¹ã€åŠŸèƒ½å…¨é¢çš„ä¸²å£è°ƒè¯•ç¥å™¨ï¼Œå·¥æ§å¿…å¤‡æ•ˆç‡å·¥å…·ï¼</h2>
<ul>
<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong> BYSerial æ˜¯ä¸€æ¬¾åŠŸèƒ½å…¨é¢ã€ç”¨æˆ·å‹å¥½çš„ä¸²å£è°ƒè¯•å·¥å…·ï¼Œé€‚ç”¨äºå·¥æ§é¢†åŸŸã€ç‰©è”ç½‘å¼€å‘ã€åµŒå…¥å¼ç³»ç»Ÿå¼€å‘ç­‰å¤šç§åœºæ™¯ã€‚é¡¹ç›®å¼€æºå…è´¹ï¼ˆMIT Licenseï¼‰ï¼Œæ”¯æŒå¤šè¯­è¨€åˆ‡æ¢ã€è‡ªåŠ¨æ›´æ–°ã€è‡ªå®šä¹‰å¿«æ·å‘½ä»¤ç­‰åŠŸèƒ½ï¼Œæ˜¯å·¥æ§é¢†åŸŸå¿…å¤‡çš„æ•ˆç‡å·¥å…·ã€‚</li>
<li><strong>æ–‡ç« åœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F6aJr_eT1kFCgvBvILXHkXQ" target="_blank" title="https://mp.weixin.qq.com/s/6aJr_eT1kFCgvBvILXHkXQ" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/6aJr_eT1kâ€¦</a></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87c8079ad7a34f52857d19b403b3552f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763381005&amp;x-signature=BMcKIQQlkPErIQrkouOP2Cbq2Fg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-12">.NET æ AI ä¸è¡Œï¼Ÿ</h2>
<ul>
<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong> ä»Šå¤©ï¼Œæˆ‘è¦å‘Šè¯‰ä½ ä¸€ä¸ªè¢«ä¸¥é‡ä½ä¼°çš„äº‹å®ï¼š.NETå¼€å‘è€…ä¸ä»…èƒ½åšAIï¼Œè€Œä¸”å¯èƒ½æ˜¯æœ€é€‚åˆæŠŠAIè½åœ°åˆ°ç”Ÿäº§ç¯å¢ƒçš„é‚£ç¾¤äººã€‚</li>
<li><strong>æ–‡ç« åœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Fsheng-jie%2Fp%2F19200934" target="_blank" title="https://www.cnblogs.com/sheng-jie/p/19200934" ref="nofollow noopener noreferrer">www.cnblogs.com/sheng-jie/pâ€¦</a></li>
</ul>
<h2 data-id="heading-13">ä»é›¶å¼€å§‹:C#ä¸C++å‡½æ•°ä¼ å‚â€”â€”è°ƒåŒ…ä¾ ç§˜ç±</h2>
<ul>
<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong> åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼ŒC# å’Œ C++ éƒ½æ˜¯éå¸¸å¼ºå¤§çš„ç¼–ç¨‹è¯­è¨€ã€‚C# æœ‰ç€ç®€æ´çš„è¯­æ³•å’Œå¼ºå¤§çš„æ¡†æ¶æ”¯æŒï¼Œè€Œ C++ åœ¨æ€§èƒ½å’Œåº•å±‚æ“ä½œä¸Šæœ‰ç€ç‹¬ç‰¹çš„ä¼˜åŠ¿ã€‚æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦åœ¨ C# é¡¹ç›®ä¸­è°ƒç”¨ C++ ç¼–å†™çš„é«˜æ€§èƒ½å‡½æ•°ï¼Œæ¯”å¦‚å¤„ç†å¤æ‚çš„å›¾åƒç®—æ³•ã€è°ƒç”¨åº•å±‚ç¡¬ä»¶æ¥å£ç­‰ï¼Œè¿˜æœ‰å°±æ˜¯å¯ä»¥æ›´å¤šçš„ä¸°å¯Œå’±ä»¬çš„ä»£ç åº“ï¼Œå› ä¸ºå¾ˆå¤šæ€§èƒ½å¥½ã€å®ç”¨ã€è·¨å¹³å°çš„åº“éƒ½æ˜¯C++å†™çš„ï¼Œå¯ä»¥æå¤§æ‰©å±•å’±ä»¬ç¨‹åºçš„åº”ç”¨åœºæ™¯ã€‚ä½†å¯¹äºåˆå­¦è€…æ¥è¯´ï¼Œç¬¬ä¸€å¤§éš¾é¢˜å°±æ˜¯æ–¹æ³•/å‡½æ•°çš„è°ƒç”¨ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ä¸¾ä¾‹è¯´æ˜ä¸€ä¸‹C#è°ƒç”¨C++åŠ¨æ€é“¾æ¥åº“å‡½æ•°çš„è¯¦ç»†å®ç°ï¼ˆä»¥windowsç³»ç»Ÿä¸ºä¾‹ï¼‰ã€‚</li>
<li><strong>æ–‡ç« åœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Fluojin765%2Fp%2F19199730" target="_blank" title="https://www.cnblogs.com/luojin765/p/19199730" ref="nofollow noopener noreferrer">www.cnblogs.com/luojin765/pâ€¦</a></li>
</ul>
<h2 data-id="heading-14">ASP.NET Core Blazor æ ¸å¿ƒåŠŸèƒ½ä¸‰ï¼šBlazorä¸JavaScriptäº’æ“ä½œâ€”â€”è®©Webå¼€å‘æ›´çµæ´»</h2>
<ul>
<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong> ä»Šå¤©æˆ‘ä»¬æ¥èŠèŠBlazorä¸­C#ä¸JavaScriptäº’æ“ä½œã€‚æˆ‘çŸ¥é“å¾ˆå¤šåŒå­¦åœ¨å¬åˆ°"Blazor"å’Œ"JavaScript"è¦ä¸€èµ·å·¥ä½œæ—¶ä¼šæœ‰ç‚¹æ‡µï¼Œä½†åˆ«æ‹…å¿ƒï¼Œæˆ‘ä¼šç”¨æœ€ç®€å•çš„æ–¹å¼å¸¦ä½ æŒæ¡è¿™ä¸ªæŠ€èƒ½ï¼</li>
<li><strong>æ–‡ç« åœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Fshenchuanchao%2Fp%2F19194651" target="_blank" title="https://www.cnblogs.com/shenchuanchao/p/19194651" ref="nofollow noopener noreferrer">www.cnblogs.com/shenchuanchâ€¦</a></li>
</ul>
<h2 data-id="heading-15">ASP.NET Core Blazor æ ¸å¿ƒåŠŸèƒ½äºŒï¼šBlazorè¡¨å•å’ŒéªŒè¯</h2>
<ul>
<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong> æœ¬æ–‡ä»‹ç»äº†Blazorä¸­EditFormç»„ä»¶çš„ä½¿ç”¨åŠè¡¨å•éªŒè¯æ–¹æ¡ˆã€‚</li>
<li><strong>æ–‡ç« åœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Fshenchuanchao%2Fp%2F19189573" target="_blank" title="https://www.cnblogs.com/shenchuanchao/p/19189573" ref="nofollow noopener noreferrer">www.cnblogs.com/shenchuanchâ€¦</a></li>
</ul>
<h2 data-id="heading-16">ã€EF Coreã€‘â€œå¤šå¯¹å¤šâ€å…³ç³»ä¸è·³è·ƒå¯¼èˆª</h2>
<ul>
<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong> â€œå¤šå¯¹å¤šâ€å…³ç³»ä¸åƒâ€œä¸€å¯¹å¤šâ€é‚£ä¹ˆâ€œå•çº¯â€ï¼Œå®ƒå†…éƒ¨æ¶‰åŠåˆ°â€œè¿æ¥å®ä½“â€ï¼ˆJoin Entityï¼‰çš„æ¦‚å¿µã€‚å’±ä»¬å…ˆæ”¾ä¸‹è¿™ä¸ªæ¦‚å¿µä¸è¡¨ï¼Œæ¥äº†è§£ä¸€ä¸‹å¤šå¯¹å¤šæ•°æ®è¡¨ä¸ºä»€ä¹ˆéœ€è¦ä¸€ä¸ªâ€œè¾…åŠ©è¡¨â€æ¥å»ºç«‹å…³ç³»ã€‚</li>
<li><strong>æ–‡ç« åœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Ftcjiaan%2Fp%2F19184567" target="_blank" title="https://www.cnblogs.com/tcjiaan/p/19184567" ref="nofollow noopener noreferrer">www.cnblogs.com/tcjiaan/p/1â€¦</a></li>
</ul>
<h2 data-id="heading-17">LVGLSharpï¼šLVGLçš„C#ç»‘å®šåº“ä»‹ç»</h2>
<ul>
<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong> åœ¨åµŒå…¥å¼ç³»ç»Ÿå’Œå›¾å½¢ç”¨æˆ·ç•Œé¢ï¼ˆGUIï¼‰å¼€å‘é¢†åŸŸï¼ŒLVGLï¼ˆLight and Versatile Graphics Libraryï¼‰æ˜¯ä¸€ä¸ªå¹¿å—æ¬¢è¿çš„å¼€æºå›¾å½¢åº“ï¼Œå®ƒæä¾›äº†ä¸°å¯Œçš„UIç»„ä»¶å’Œé«˜æ•ˆçš„æ¸²æŸ“èƒ½åŠ›ï¼Œé€‚ç”¨äºå„ç§èµ„æºå—é™çš„è®¾å¤‡ã€‚è€ŒLVGLSharpåˆ™æ˜¯LVGLçš„ä¸€ä¸ªC#ç»‘å®šåº“ï¼Œå®ƒä½¿å¾—.NETå¼€å‘è€…èƒ½å¤Ÿæ›´æ–¹ä¾¿åœ°åˆ©ç”¨LVGLçš„å¼ºå¤§åŠŸèƒ½ï¼Œåœ¨C#ç¯å¢ƒä¸­åˆ›å»ºå‡ºç¾è§‚ä¸”é«˜æ•ˆçš„å›¾å½¢ç•Œé¢ã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»LVGLSharpåŠå…¶ç‰¹ç‚¹ã€‚</li>
<li><strong>æ–‡ç« åœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Fshanyou%2Fp%2F19185046" target="_blank" title="https://www.cnblogs.com/shanyou/p/19185046" ref="nofollow noopener noreferrer">www.cnblogs.com/shanyou/p/1â€¦</a></li>
</ul>
<h2 data-id="heading-18">Copilot Studio å¦‚ä½•ä½¿ç”¨ .NET å’Œ WebAssembly å®ç°æ€§èƒ½å’Œåˆ›æ–°</h2>
<ul>
<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong> Microsoft Copilot Studio å¤„äºå¯¹è¯å¼ AI å’Œè‡ªåŠ¨åŒ–çš„æœ€å‰æ²¿ï¼Œä½¿ç»„ç»‡èƒ½å¤Ÿä¸ºå„ç§ä¼ä¸šåœºæ™¯æ„å»ºã€è‡ªå®šä¹‰å’Œç®¡ç†æ™ºèƒ½åŠ©æ‰‹å’Œæœºå™¨äººã€‚éšç€å¹³å°çš„å‘å±•ï¼Œæ”¯æ’‘å®ƒçš„æŠ€æœ¯ä¹Ÿåœ¨ä¸æ–­å‘å±•ã€‚Copilot Studio åˆ›æ–°çš„æ ¸å¿ƒæ˜¯å®ƒä¸ .NET çš„æ·±åº¦é›†æˆï¼ŒåŒ…æ‹¬åœ¨ WebAssembly ï¼ˆWASMï¼‰ ä¸Šä½¿ç”¨ .NETã€‚è¿™ç¯‡æ–‡ç« æ¢è®¨äº† Copilot Studio å¦‚ä½•åˆ©ç”¨ .NETã€å¹³å°å‡çº§å¸¦æ¥çš„å¥½å¤„ï¼Œä»¥åŠç”±æ­¤å¸¦æ¥çš„æ€§èƒ½ã€æˆæœ¬å’Œç”Ÿäº§åŠ›æ”¹è¿›ã€‚</li>
<li><strong>æ–‡ç« åœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fdevblogs.microsoft.com%2Fdotnet%2Fcopilot-studio-dotnet-wasm%2F" target="_blank" title="https://devblogs.microsoft.com/dotnet/copilot-studio-dotnet-wasm/" ref="nofollow noopener noreferrer">devblogs.microsoft.com/dotnet/copiâ€¦</a></li>
</ul>
<h2 data-id="heading-19">.NET Conf 2025å³å°†å¼€å§‹</h2>
<ul>
<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong> .NET Conf 2025 ä»…å‡ å¤©åå°±è¦å¼€å§‹äº†ï¼Œå‚åŠ 11 æœˆ 11 æ—¥è‡³ 13 æ—¥çš„è¿™åœºå…è´¹ä¸‰æ—¥è™šæ‹Ÿä¼šè®®ï¼Œäº†è§£ .NET å¹³å°ã€å¼€æºé¡¹ç›®å’Œå¼€å‘è€…å·¥å…·çš„æœ€æ–°è¿›å±•â€”åŒ…æ‹¬ .NET 10 çš„æ­£å¼å‘å¸ƒï¼Œä»¥åŠå¯¹ Visual Studio 2026 çš„æ·±åº¦æ¢è®¨ã€‚ä»Šå¹´çš„ä¼šè®®ç‰¹åˆ«èšç„¦ä½¿ç”¨ Aspire è¿›è¡Œäº‘åŸç”Ÿå¼€å‘ã€å¿«é€Ÿåœ°å°†ç°æœ‰åº”ç”¨å‡çº§åˆ° .NET 10ï¼Œä»¥åŠä½¿ç”¨ AI æ„å»ºæ™ºèƒ½åº”ç”¨ï¼ŒåŒ…æ‹¬å…¨æ–°çš„ Microsoft Agent Framework å’Œ Model Context Protocol (MCP) æ”¯æŒã€‚</li>
<li><strong>æ–‡ç« åœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FGqLWiGQ77EZ4MTUFhwGqUA" target="_blank" title="https://mp.weixin.qq.com/s/GqLWiGQ77EZ4MTUFhwGqUA" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/GqLWiGQ77â€¦</a></li>
</ul>
<h2 data-id="heading-20">AI æ—¶ä»£ï¼Œ.NET å¼€å‘è€…å‘å·¦è¿˜æ˜¯å‘å³ï¼Ÿ</h2>
<ul>
<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong> AI æ—¶ä»£ï¼Œ.NET å¼€å‘è€…å‘å·¦è¿˜æ˜¯å‘å³ï¼Ÿ MAF vs LangChain 1.0 ä¸€åœºå…³ä¹æœªæ¥çš„æŠ€æœ¯é€‰æ‹©ã€‚</li>
<li><strong>æ–‡ç« åœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FXBYYsjkmhuDEq3gyTvSmmQ" target="_blank" title="https://mp.weixin.qq.com/s/XBYYsjkmhuDEq3gyTvSmmQ" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/XBYYsjkmhâ€¦</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è´§æ‹‰æ‹‰ç”¨æˆ·ç”»åƒåŸºäº Apache Doris çš„æ•°æ®æ¨¡å‹è®¾è®¡ä¸å®è·µ]]></title>    <link>https://juejin.cn/post/7570903763721797642</link>    <guid>https://juejin.cn/post/7570903763721797642</guid>    <pubDate>2025-11-10T12:03:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570903763721797642" data-draft-id="7570932873130803227" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è´§æ‹‰æ‹‰ç”¨æˆ·ç”»åƒåŸºäº Apache Doris çš„æ•°æ®æ¨¡å‹è®¾è®¡ä¸å®è·µ"/> <meta itemprop="keywords" content="æ•°æ®åº“,Apache"/> <meta itemprop="datePublished" content="2025-11-10T12:03:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SelectDB"/> <meta itemprop="url" content="https://juejin.cn/user/3189021726222904"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è´§æ‹‰æ‹‰ç”¨æˆ·ç”»åƒåŸºäº Apache Doris çš„æ•°æ®æ¨¡å‹è®¾è®¡ä¸å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3189021726222904/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SelectDB
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T12:03:56.000Z" title="Mon Nov 10 2025 12:03:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»15åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>è´§æ‹‰æ‹‰æ˜¯å›½å†…é¢†å…ˆçš„åŒåŸè´§è¿æ•°å­—åŒ–å¹³å°ï¼Œæˆç«‹äº 2013 å¹´ã€‚æˆªâ¾„2025 å¹´ 4â½‰ ï¼Œè´§æ‹‰æ‹‰ä¸šåŠ¡è¦†ç›–å…¨çƒ 14 ä¸ªå¸‚åœº ï¼Œ400+ åŸå¸‚ ï¼Œå…¶ä¸­ä¸­å›½å†…åœ°æ€»å…±è¦†ç›– 363 åº§åŸå¸‚ ï¼Œâ½‰æ´»å¸æœºè¾¾ 120 ä¸‡ ï¼Œâ½‰æ´»â½¤æˆ·è¾¾ 1400 ä¸‡ï¼Œ å¹¶åœ¨å…¨çƒè®¾æœ‰ 6 ä¸ªæ•°æ®ä¸­â¼¼ã€‚ä½œä¸ºå…±äº«ç»æµæ¨¡å¼çš„ä»£è¡¨ä¼ä¸š ï¼Œè´§æ‹‰æ‹‰é€šè¿‡ç§»åŠ¨äº’è”â½¹æŠ€æœ¯æ•´åˆç¤¾ä¼šè¿â¼’èµ„æº ï¼Œä¸ºâ½¤æˆ·æä¾›å³æ—¶è´§è¿ã€ä¼ä¸šç‰©æµã€æ¬å®¶æœåŠ¡ç­‰å¤šå…ƒåŒ–è§£å†³â½…æ¡ˆã€‚</p>
<p>åœ¨åºâ¼¤çš„ä¸šåŠ¡è§„æ¨¡ä¸‹ ï¼Œæ„å»ºå®Œå–„çš„â½¤æˆ·ç”»åƒå¹³å°æˆä¸ºå®ç°ç²¾ç»†åŒ–è¿è¥çš„é‡è¦åŸºç¡€ ï¼Œå¯ä»¥æœ‰æ•ˆæå‡è¿è¥æ•ˆç‡å’Œâ½¤æˆ·ä½“éªŒã€‚</p>
<h2 data-id="heading-0">ç”»åƒæœåŠ¡èƒŒæ™¯ä¸æ¶æ„</h2>
<p>ç›®å‰è´§æ‹‰æ‹‰çš„ç”»åƒå¹³å°å·²æ·±åº¦åº”ç”¨äºå¤šä¸ªæ ¸å¿ƒä¸šåŠ¡åœºæ™¯ï¼Œå„ä¸šåŠ¡åœºæ™¯å¯¹æ ‡ç­¾çš„ä½¿â½¤â½…å¼å’Œæ—¶æ•ˆæ€§è¦æ±‚å„ä¸ç›¸åŒã€‚ä» 22 å¹´åˆ° 25 å¹´ï¼Œç”¨æˆ·å‘ˆç°ç¨³å®šå¢é•¿è¶‹åŠ¿ï¼Œä¸šåŠ¡å¯¹æœåŠ¡çš„å‹åŠ›ä¹Ÿæ˜¯é€å¹´é€’å¢ï¼Œç´¯è®¡æ¥å…¥äº† 300+ ä¸šåŠ¡ï¼Œ3,000+ ä¸ªæ ‡ç­¾ä»¥åŠ 5 ä¸‡å¤šäººç¾¤ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c66913f70762483c865b8f6a4c96ca0d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763381036&amp;x-signature=ygxNmiZsth03AsIZmiNNqnrZksE%3D" alt="ç”»åƒæœåŠ¡èƒŒæ™¯ä¸æ¶æ„.png" loading="lazy"/></p>
<h3 data-id="heading-1">01 åº”ç”¨æ¶æ„</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55e13b8607e243a98ef31a3995963291~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763381036&amp;x-signature=2ko8cdEzlCDoZJZYfm9wMalSkio%3D" alt="è´§æ‹‰æ‹‰ç”¨æˆ·ç”»åƒåº”ç”¨æ¶æ„.PNG" loading="lazy"/></p>
<p>ä¸Šå›¾æ˜¯è´§æ‹‰æ‹‰ç”»åƒå¹³å°æ•´ä½“æ¶æ„å›¾ï¼ŒApache Doris ä½œä¸ºç»Ÿä¸€æŸ¥è¯¢å¼•æ“ï¼Œä¸ºäººç¾¤ç”»åƒæä¾›é«˜æ•ˆçš„åˆ†æèƒ½åŠ›ã€‚è¯¥å¹³å°é€šè¿‡æ¶æ„åˆ†å±‚å®ç°äº†ä¸šåŠ¡éœ€æ±‚ä¸æŠ€æœ¯èƒ½åŠ›çš„ç²¾å‡†åŒ¹é…ã€‚å…¶ä¸­æœ‰ä¸¤ä¸ªæ ¸å¿ƒæ¨¡å—ï¼š</p>
<ul>
<li>API å±‚ï¼ˆæ¥â¼æœåŠ¡å±‚ï¼‰ï¼šåŸºäºé‡ç‚¹ä½¿â½¤åœºæ™¯å’Œå¯¹æ¥ç³»ç»Ÿæ­å»ºçš„ç”»åƒæ¥å£æœåŠ¡ ï¼Œä»â½½ç²¾å‡†åœ°â½£æˆç”¨æˆ·ç”»åƒ ï¼Œç»™åˆ°å¯¹æ¥ä¸šåŠ¡â½…ä½¿â½¤ã€‚å…¶ä¸­åŒ…æ‹¬ï¼š
<ul>
<li>persona-apiï¼šâ¾¯å‘â¾¼å¹¶å‘æŸ¥è¯¢åœºæ™¯</li>
<li>persona-analysis-apiï¼šæ‰¿æ¥åˆ†æè®¡ç®—ä¸æ¨é€ä½œä¸šè¯·æ±‚</li>
<li>persona-web-apiï¼šâ½€æŒç®¡ç†åå°çš„ Web æœåŠ¡</li>
</ul>
</li>
<li>BE å±‚ï¼ˆè®¡ç®—å¼•æ“å±‚ï¼‰ ï¼šå»ºé€ åŸºäºå¤§æ•°æ®ä½“ç³»çš„ç”¨æˆ·æ ‡ç­¾é“¾è·¯çš„ç”»åƒç®¡ç†å¹³å° ï¼Œâ½¤äºåœ¨ç‰¹å®šä¸šåŠ¡å½¢æ€ä¸‹æè¿°ä¸šåŠ¡ä¸»ä½“ï¼›å…¶ä¸­åŒ…æ‹¬ï¼š
<ul>
<li>persona-taskï¼šæ‰§â¾åˆ†å¸ƒå¼è®¡ç®—ä½œä¸š ï¼Œâ½€æŒæ¨ªå‘æ‰©å±•</li>
<li>persona-scheduler ï¼šè°ƒåº¦â¼ˆç¾¤è®¡ç®—ä»»åŠ¡</li>
</ul>
</li>
</ul>
<p>ä¸¤å¤§æ¨¡å—ååŒå·¥ä½œï¼Œå…±åŒæ”¯æ’‘ä¸šåŠ¡æ–¹çš„ç²¾ç»†åŒ–è¿è¥éœ€æ±‚ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1331ddf1992b4fcfa2c32bf8ae770647~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763381036&amp;x-signature=wp%2F6LvWGnjEARAq8aX614Wrq2Xo%3D" alt="è´§æ‹‰æ‹‰ç”¨æˆ·ç”»åƒåº”ç”¨æ¶æ„-1.PNG" loading="lazy"/></p>
<h3 data-id="heading-2">02 ç”»åƒå¹³å°è®¡ç®—å¼•æ“æ¼”è¿›</h3>
<p>åœ¨æ ¸å¿ƒè®¡ç®—å¼•æ“çš„é€‰å‹ä¸æ¼”è¿›è¿‡ç¨‹ä¸­ï¼ŒæŠ€æœ¯å›¢é˜Ÿç»å†äº†ä¸‰ä¸ªä¸»è¦é˜¶æ®µã€‚</p>
<ul>
<li>ç¬¬ä¸€é˜¶æ®µï¼Œå—é™äºæˆæœ¬å› ç´ ï¼Œé‡‡ç”¨äº†ä¸‰æ–¹æœåŠ¡ç»“åˆ Impala+KUDU çš„æ¶æ„ä½œä¸ºç”¨æˆ·ç”»åƒè®¡ç®—å¼•æ“ã€‚è¯¥æ¶æ„åœ¨å®é™…åº”ç”¨ä¸­æš´éœ²å‡ºè¯¸å¤šé—®é¢˜ï¼šå•æ¬¡äººç¾¤è®¡ç®—è€—æ—¶ 10 åˆ†é’Ÿä»¥ä¸Šï¼Œé«˜å³°æœŸç”šè‡³è¶…è¿‡ 30 åˆ†é’Ÿï¼›åŒæ—¶ï¼Œæ•°æ®å¯¼å…¥è€—æ—¶è¾ƒé•¿ï¼Œç»å¸¸è¶…æ—¶ã€‚æ­¤å¤–ï¼Œè¯¥æ¶æ„å­˜åœ¨æ¨ªå‘æ‰©å±•å›°éš¾ã€å¤æ‚æŸ¥è¯¢æ•ˆç‡åä½åŠè¿ç»´å¤æ‚ç­‰ä¸è¶³ã€‚</li>
<li>ç¬¬äºŒé˜¶æ®µï¼Œä¸ºå¯»æ±‚æ”¹è¿›ï¼Œæˆ‘ä»¬å°è¯•å¼•å…¥ Elasticsearchï¼Œè™½åœ¨ä¸€å®šç¨‹åº¦ä¸Šæœ‰æ‰€ç¼“è§£ï¼Œä½†ä»é¢ä¸´å¼€å‘æˆæœ¬é«˜ã€è¯­æ³•å¤æ‚ã€å¤šç»´åˆ†æèƒ½åŠ›ä¸è¶³ç­‰æŒ‘æˆ˜ï¼Œä¸”åœ¨åŠ¨æ€æ‰©å±•å’Œå¤æ‚æŸ¥è¯¢æ–¹é¢æœªå®ç°æ ¹æœ¬æ€§æ”¹å–„ã€‚å°¤å…¶åœ¨å¤„ç†äººç¾¤é—´å­˜åœ¨ä¾èµ–å…³ç³»çš„ç‰¹æ®Šä¸šåŠ¡åœºæ™¯æ—¶ï¼ŒElasticsearch æ¶æ„éš¾ä»¥æœ‰æ•ˆæ”¯æŒã€‚</li>
<li>åŸºäºæ­¤ï¼Œæˆ‘ä»¬æœ€ç»ˆè½¬å‘é‡‡ç”¨ Doris ä½œä¸ºæ ¸å¿ƒè®¡ç®—å¼•æ“ã€‚é€‰æ‹© Doris çš„å…³é”®å› ç´ å¦‚ä¸‹ï¼š
<ul>
<li><strong>æ€§èƒ½ä¼˜è¶Š</strong>ï¼šåŸºäº MPP æ¶æ„ã€å…·å¤‡å‘é‡åŒ–å¼•æ“å’Œå…ˆè¿›çš„ä¼˜åŒ–å™¨èƒ½åŠ›ï¼ŒæŸ¥è¯¢æ€§èƒ½ä¼˜ç§€ã€‚</li>
<li><strong>ç¤¾åŒºèµ„æºä¸°å¯Œ</strong>ï¼šDoris æ‹¥æœ‰æ´»è·ƒçš„ç¤¾åŒºæ”¯æŒä»¥åŠä¸°å¯Œçš„æ–‡æ¡£èµ„æ–™ï¼Œè‡ªè¡Œæ­å»ºé‡åˆ°å¡ç‚¹æ—¶ï¼Œå¯å‘ç¤¾åŒºå¸®åŠ©å¯»æ±‚ä¸“ä¸šçš„æŒ‡å¯¼ä¸å¸®åŠ©ã€‚</li>
<li><strong>æ”¯æŒå¤šç§æ•°æ®ç±»å‹</strong>ï¼šç”»åƒåœºæ™¯å¯ä»¥ä½¿ç”¨ BITMAP å®ç°é«˜æ•ˆçš„äº¤å¹¶é›†è¿ç®—ï¼Œæˆä¸ºæ”¯æ’‘å¤šæ ·åŒ–æ ‡ç­¾ç±»å‹ä¸äººç¾¤åˆ†æä¸šåŠ¡çš„æŠ€æœ¯åŸºç¡€ã€‚</li>
<li><strong>æ”¯æŒå¤šç§æ•°æ®æ¨¡å‹</strong>ï¼šé’ˆå¯¹å¤šç»´å¤æ‚çš„äººç¾¤ç”»åƒï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„æ•°æ®æ¨¡å‹æ”¯æ’‘å„ç§æ ‡ç­¾ç±»å‹ä¸äººç¾¤ä¸šåŠ¡ã€‚</li>
</ul>
</li>
</ul>
<p>è‡ªå¼•å…¥ Doris åï¼Œç³»ç»Ÿç¨³å®šæ€§å¾—åˆ°äº†æ˜¾è‘—æå‡ï¼Œè‡³ä»Šæœªå‡ºç°è¿‡é‡å¤§ç¨³å®šæ€§é—®é¢˜ï¼Œæ•´ä½“é“¾è·¯çš„æ—¶æ•ˆæ€§ä¸å¯é æ€§å‡å®ç°äº†æ ¹æœ¬æ€§çš„ä¼˜åŒ–ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>
<ul>
<li>åœ¨è®¡ç®—æ•ˆç‡æ–¹é¢ï¼Œå•ä¸ªäººç¾¤çš„è®¡ç®—èƒ½å¤Ÿå®ç°ç§’çº§å“åº”ï¼Œå³ä½¿åœ¨é«˜å³°æœŸï¼Œå“åº”æ—¶é—´ä¹Ÿä¿æŒåœ¨ 1 åˆ†é’Ÿä»¥å†…ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒImpala æ¶æ„ä¸‹è¯¥è®¡ç®—è¿‡ç¨‹é€šå¸¸éœ€è¦ 10 è‡³ 30 åˆ†é’Ÿã€‚<strong>é‡‡ç”¨ Doris åï¼Œè®¡ç®—æ•ˆç‡æå‡äº†è¿‘ 30 å€ã€‚</strong></li>
<li>åœ¨æ•°æ®å¯¼å…¥æ–¹é¢ï¼ŒDoris åŒæ ·è¡¨ç°å‡ºè‰²ã€‚åœ¨å¤„ç† 4 äº¿è¡Œ 200 åˆ—çš„å•è¡¨æ•°æ®æ—¶ï¼ŒDoris å¯åœ¨ 30 åˆ†é’Ÿå†…å®Œæˆå¯¼å…¥æ“ä½œã€‚è€Œåœ¨åŒç­‰æ¡ä»¶ä¸‹ï¼ŒImpala æ¶æ„åˆ™éœ€è¦ 90 åˆ†é’Ÿä»¥ä¸Šï¼Œ<strong>Doris æ•°æ®å¯¼å…¥æ•ˆç‡æ˜¯ Impala æ¶æ„çš„ 3 å€</strong>ã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e11a63c30e5d480b82e6415f75c1b972~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763381036&amp;x-signature=pHrcYb7lNVtrHwxTHa8vw%2Fohwto%3D" alt="ç”»åƒå¹³å°è®¡ç®—å¼•æ“æ¼”è¿›.png" loading="lazy"/></p>
<h2 data-id="heading-3">æ•°æ®æ¨¡å‹è®¾è®¡ä¸å¼‚æ„æŸ¥è¯¢å®ç°</h2>
<h3 data-id="heading-4">01 æ ¸å¿ƒæŒ‘æˆ˜</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0942780c34794cc5a1867f7ce10fb846~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763381036&amp;x-signature=N0laRIszv2f04xcN5fy%2Bcyyip4E%3D" alt="æ ¸å¿ƒæŒ‘æˆ˜.png" loading="lazy"/></p>
<p>é¦–å…ˆæ˜¯ç”¨æˆ·ç”»åƒæ ‡ç­¾å­˜å‚¨çš„æŒ‘æˆ˜ã€‚é¢å¯¹ 3000+ æ ‡ç­¾çš„ä½“ç³»ï¼Œæˆ‘ä»¬å‘ç°æ ‡ç­¾æ•°æ®å¤©ç„¶å­˜åœ¨ä¸‰ä¸ªç»´åº¦çš„åˆ†è£‚ç‰¹å¾ï¼šä¸šåŠ¡å±æ€§ï¼ˆè¡Œä¸º/å±æ€§/åœ°ç†ç­‰ï¼‰ã€èšåˆç²’åº¦ï¼ˆæ˜ç»†/èšåˆ/äººç¾¤ï¼‰ã€æ›´æ–°æ—¶æ•ˆï¼ˆç¦»çº¿/è¿‘å®æ—¶/å®æ—¶ï¼‰ã€‚ä¸åŒä¸šåŠ¡å±æ€§çš„æ•°æ®åœ¨æ›´æ–°é¢‘ç‡ã€æŸ¥è¯¢æ¨¡å¼ã€å­˜å‚¨å¯†åº¦ä¸Šå·®å¼‚å·¨å¤§ã€‚</p>
<p>æ­¤å¤–ï¼Œç”¨æˆ·ä½¿ç”¨ç”»åƒæ ‡ç­¾çš„æ—¶å€™ï¼Œå¯¹äººç¾¤æ ‡ç­¾/æ˜ç»†æ ‡ç­¾/èšåˆæ ‡ç­¾ç­‰æ¦‚å¿µä¸æ¸…æ™°ï¼Œåªä¼šè¿›è¡Œç®€å•çš„æ‹–æ‹‰æ‹½æ‹¼æ¥è§„åˆ™ã€‚å› æ­¤åœ¨æ ‡ç­¾ä½¿ç”¨åœºæ™¯ï¼Œå¦‚ä½•é€‰æ‹©å­˜å‚¨æ¨¡å‹æˆä¸ºäº†æ ¸å¿ƒé—®é¢˜ã€‚è‹¥ä½¿ç”¨å®½è¡¨ï¼Œå°†é¢ä¸´åŠ¨æ€æ›´æ–°ä»¥åŠåˆ—æ‹“å±•çš„æŒ‘æˆ˜ï¼›è€Œé«˜è¡¨åˆ™é¢ä¸´å¤æ‚æŸ¥è¯¢ä¸åµŒå¥—é€»è¾‘çš„æŒ‘æˆ˜ã€‚</p>
<h3 data-id="heading-5">02 å­˜å‚¨æ¨¡å‹è®¾è®¡</h3>
<p>é¢å¯¹å¤æ‚çš„æ ‡ç­¾ç®¡ç†ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†<strong>åŸºäº Apache Doris åˆ†è€Œæ²»ä¹‹çš„å­˜å‚¨æ–¹æ¡ˆ</strong>ï¼Œå…·ä½“åˆ†ä¸ºä¸‰ç±»æ¨¡å‹æ¥è¿›è¡ŒååŒå·¥ä½œã€‚</p>
<p><strong>æ ‡ç­¾å®½è¡¨</strong></p>
<ul>
<li>å­˜å‚¨ä½é¢‘æ›´æ–°çš„æ ‡ç­¾ã€‚</li>
<li>å­˜å‚¨æ— æ³•ç”¨é«˜è¡¨å­˜å‚¨çš„å¯†é›†æ ‡ç­¾ã€‚</li>
<li>åˆ©ç”¨ Doris çš„åˆ—å¼å­˜å‚¨æŠ€æœ¯ï¼Œåˆ©ç”¨ç´¢å¼•ã€ç‰©åŒ–è§†å›¾ç­‰ä¼˜åŒ–æ‰‹æ®µï¼Œæ”¯æŒé«˜æ•ˆçš„å¤šç»´åˆ†æã€‚</li>
</ul>
<p>æ ‡ç­¾å®½è¡¨å»ºè¡¨ SQL å‚è€ƒï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span>  wide_table  (
 user_id  <span class="hljs-type">varchar</span>(<span class="hljs-number">1000</span>) <span class="hljs-keyword">NULL</span> COMMENT "",
 age  <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) REPLACE_IF_NOT_NULL <span class="hljs-keyword">NULL</span> COMMENT "",
 height  <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) REPLACE_IF_NOT_NULL <span class="hljs-keyword">NULL</span> COMMENT "",
 ......) ENGINE<span class="hljs-operator">=</span>OLAP AGGREGATE KEY( user_id ) COMMENT "OLAP"
DISTRIBUTED <span class="hljs-keyword">BY</span> HASH( user_id ) BUCKETS <span class="hljs-number">40</span>
PROPERTIES ( ... )
</code></pre>
<p><strong>æ ‡ç­¾é«˜è¡¨</strong></p>
<ul>
<li>å­˜å‚¨é«˜é¢‘æ›´æ–°çš„ç¨€ç–æ ‡ç­¾ã€‚</li>
<li>æ”¯æŒç§’çº§/åˆ†é’Ÿçº§æ•°æ®æ›´æ–°ï¼Œæ ‡ç­¾æ–°å¢çš„åœºæ™¯ä¸‹ï¼Œå¯ä»¥è§„é¿å®½è¡¨é¢‘ç¹ ALTER TABLE å¯¼è‡´çš„é”è¡¨é—®é¢˜ã€‚</li>
<li>å¤šä¸ªæ ‡ç­¾çš„ä½å›¾äº¤å¹¶è®¡ç®—ï¼Œå¹¶ä¸”æ”¯æŒæ¯«ç§’çº§å“åº”ã€‚</li>
</ul>
<p>æ ‡ç­¾é«˜è¡¨å»ºè¡¨ SQL å‚è€ƒï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span>  high_table  (
 tag  <span class="hljs-type">varchar</span>(<span class="hljs-number">45</span>) <span class="hljs-keyword">NULL</span> COMMENT "æ ‡ç­¾å",
 tag_value  <span class="hljs-type">varchar</span>(<span class="hljs-number">45</span>) <span class="hljs-keyword">NULL</span> COMMENT "æ ‡ç­¾å€¼",
 <span class="hljs-type">time</span>  datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT "æ•°æ®çŒå…¥æ—¶é—´",
 user_ids  bitmap BITMAP_UNION <span class="hljs-keyword">NULL</span> COMMENT "ç”¨æˆ·é›†"
) ENGINE<span class="hljs-operator">=</span>OLAP AGGREGATE KEY( tag ,  tag_value ,  <span class="hljs-type">time</span>  ) COMMENT "OLAP"
DISTRIBUTED <span class="hljs-keyword">BY</span> HASH( tag ) BUCKETS <span class="hljs-number">128</span>
PROPERTIES ( ... )
</code></pre>
<p><strong>äººç¾¤ä½å›¾è¡¨</strong></p>
<ul>
<li>ç”¨äºå­˜å‚¨æ ‡ç­¾è§„åˆ™åœˆé€‰å‡ºæ¥çš„äººç¾¤ç»“æœã€‚</li>
<li>ç”¨æˆ· ID é›†åˆä½¿ç”¨ RoaringBitmap å‹ç¼©ï¼Œé™ä½å­˜å‚¨æˆæœ¬ã€‚</li>
<li>æ”¯æŒäººç¾¤ä¾èµ–è®¡ç®—ï¼Œé¿å…è¡¨æ•°é‡è†¨èƒ€é—®é¢˜ï¼Œâ½€æŒâ¼ˆç¾¤è¥é”€å®éªŒä¸šåŠ¡ã€‚</li>
</ul>
<p>äººç¾¤ä½å›¾è¡¨å»ºè¡¨ SQL å‚è€ƒï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span>  routine_segmentation_bitmap (
 <span class="hljs-type">time</span>  datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT "æ•°æ®çŒå…¥æ—¶é—´",
 seg_name  <span class="hljs-type">varchar</span>(<span class="hljs-number">45</span>) <span class="hljs-keyword">NULL</span> COMMENT "æ ‡ç­¾å€¼",
 user_ids  bitmap BITMAP_UNION <span class="hljs-keyword">NULL</span> COMMENT "äººç¾¤IDé›†åˆ"
) ENGINE<span class="hljs-operator">=</span>OLAP AGGREGATE KEY( <span class="hljs-type">time</span> ,  seg_name )
COMMENT "OLAP" <span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">RANGE</span>(`<span class="hljs-type">time</span>`) (...)DISTRIBUTED <span class="hljs-keyword">BY</span> HASH( seg_name )
BUCKETS <span class="hljs-number">128</span>
PROPERTIES (..., "dynamic_partition.enable" <span class="hljs-operator">=</span> "true", ...);
</code></pre>
<h3 data-id="heading-6">03 äººç¾¤åœˆé€‰ä¸å¼‚æ„ç»„åˆæŸ¥è¯¢</h3>
<p>åŸºäºä¸Šè¿°æåˆ°äº†ä¸‰ç§å­˜å‚¨æ¨¡å‹ï¼Œæˆ‘ä»¬æ„å»ºäº†ä»¥ä½å›¾è®¡ç®—ä¸ºæ ¸å¿ƒçš„å¼‚æ„ç»„åˆè®¡ç®—ä½“ç³»ï¼Œå¹¶å°†å…¶ä½œç”¨äºæ•´ä¸ªäººç¾¤åœˆé€‰çš„åœºæ™¯ï¼Œå®ç°å®½è¡¨ã€é«˜è¡¨åŠäººç¾¤è¡¨è¿™ä¸‰ç±»å­˜å‚¨æ¨¡å‹ä¹‹é—´çš„æ— ç¼è”åŠ¨ã€‚</p>
<ol>
<li>ç¬¬ä¸€æ­¥ï¼šå°†æ‰€æœ‰å•ä¸€æ ‡ç­¾æˆ–å­æŸ¥è¯¢çš„ç»“æœéƒ½å¤„ç†æˆ Bitmap ä½å›¾ï¼Œå¤„ç†å®½è¡¨çš„æ ‡ç­¾ä½¿ç”¨<code>TO_BITMAP</code>èšåˆå¤šåˆ— ID ç»“æœï¼Œå¤„ç†æ ‡ç­¾é«˜è¡¨å’Œäººç¾¤è¡¨åˆ™ç›´æ¥ä½¿ç”¨é¢„èšåˆçš„ Bitmapï¼ŒåŠ é€Ÿé€»è¾‘å¤ç”¨ã€‚</li>
<li>ç¬¬äºŒæ­¥ï¼Œé€šè¿‡<code>UNION ALL</code>æ•´åˆå®½è¡¨/é«˜è¡¨/äººç¾¤è¡¨ä¸‰ç§æ•°æ®æºçš„ Bitmapï¼Œå¹¶ä½¿ç”¨å¤–å±‚çš„<code>BITMAP_INTERSECT</code>/<code>BITMAP_UNION</code>å®ç°è·¨æ¨¡å‹äº¤å¹¶é›†è¿ç®—ï¼ˆAND/OR é€»è¾‘ï¼‰ã€‚</li>
<li>ç¬¬ä¸‰æ­¥ï¼Œç”±äº<code>BITMAP_INTERSECT</code>/<code>BITMAP_UNION</code>çš„ç»“æœä¹Ÿæ˜¯ Bitmapï¼Œæ‰€ä»¥å¯ä»¥ç”¨åŒæ ·çš„å¤„ç†æ–¹å¼ï¼Œé€’å½’æ•´åˆå­æŸ¥è¯¢çš„æŸ¥è¯¢ç»“æœï¼Œå¹¶æ”¯æŒç›´æ¥å¯¼å‡ºæˆ–å¯¹æ¥ä¸šåŠ¡ç³»ç»Ÿã€‚</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a99ecd4ce2249518f26832e57d7d1d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763381036&amp;x-signature=sv5DbJfnXHGJ41zgvegBpAh%2Bq%2Bo%3D" alt="äººç¾¤åœˆé€‰ä¸å¼‚æ„ç»„åˆæŸ¥è¯¢.png" loading="lazy"/></p>
<p>è¯¥å®ç°æ–¹æ³•å…·å¤‡ä¸‰å¤§æ ¸å¿ƒä¼˜åŠ¿ï¼š</p>
<ul>
<li><strong>çµæ´»æ‹“å±•</strong>ï¼šåŠ¨æ€åµŒå¥—å­æŸ¥è¯¢æ”¯æŒæ— é™å±‚çº§è§„åˆ™ï¼ˆå¦‚ â€œA ä¸”ï¼ˆB æˆ– Cï¼‰ä¸”ï¼ˆD ä¸”ï¼ˆE æˆ– Fï¼‰ï¼‰â€ ï¼‰ ï¼Œé™æ€å±æ€§ã€åŠ¨æ€è¡Œä¸ºä»¥åŠé¢„è®¡ç®—äººç¾¤ç­‰å¤æ‚çš„æ ‡ç­¾è§„åˆ™çš†å¯æ— ç¼åµŒå…¥ã€‚</li>
<li><strong>èµ„æºèŠ‚çœ</strong>ï¼šå¤ç”¨äººç¾¤è¡¨ï¼ˆé¢„è®¡ç®—äººç¾¤ï¼‰çš„æ•°æ®ä»è€Œå¤§å¹…å‡è½»è®¡ç®—å‹åŠ›ï¼Œå¹¶å…è®¸ä¸åŒäººç¾¤é—´ç›¸äº’ä¾èµ–è¿›è¡Œè®¡ç®—ï¼›äººç¾¤è®¡ç®—ç»“æœä½¿ç”¨ RoaringBitmap å­˜å‚¨ï¼Œä¸éœ€è¦é¢å¤–æ–°å¢è¡¨ã€‚</li>
<li><strong>ä¸šåŠ¡å‹å¥½</strong>ï¼šæ”¯æŒäººç¾¤+æ ‡ç­¾çš„å¤æ‚æ··åˆåµŒå¥—æŸ¥è¯¢ï¼Œç”¨æˆ·æ— éœ€æŠ€æœ¯åŸºç¡€ï¼Œä»…é€šè¿‡ç®€å•çš„æ‹–æ‹½æ ‡ç­¾æ¡ä»¶å³å¯é«˜æ•ˆåœˆå®šç›®æ ‡ç”¨æˆ·ç¾¤ä½“ï¼Œé€‚ç”¨äºè¥é”€ç­‰å¤šç§åœºæ™¯ã€‚</li>
</ul>
<p>æŸ¥è¯¢ SQL ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> BITMAP_INTERSECT(b) <span class="hljs-keyword">FROM</span> (
  <span class="hljs-comment">-- Layer1: å®½è¡¨æ¡ä»¶A</span>
  <span class="hljs-keyword">SELECT</span> TO_BITMAP(...) <span class="hljs-keyword">AS</span> b <span class="hljs-keyword">FROM</span> æ ‡ç­¾å®½è¡¨ <span class="hljs-keyword">WHERE</span> æ¡ä»¶A
  <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span>
  <span class="hljs-comment">-- Layer1: é«˜è¡¨æ¡ä»¶B</span>
  <span class="hljs-keyword">SELECT</span> user_ids <span class="hljs-keyword">AS</span> b <span class="hljs-keyword">FROM</span> æ ‡ç­¾é«˜è¡¨ <span class="hljs-keyword">WHERE</span> æ¡ä»¶B
  <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span>
  <span class="hljs-comment">-- Layer1: äººç¾¤æ¡ä»¶C</span>
  <span class="hljs-keyword">SELECT</span> user_ids <span class="hljs-keyword">AS</span> b <span class="hljs-keyword">FROM</span> äººç¾¤è¡¨ <span class="hljs-keyword">WHERE</span> æ¡ä»¶C
  <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span>
  <span class="hljs-comment">-- Layer2: åµŒå¥—å­æŸ¥è¯¢ï¼ˆæ–°æ¡ä»¶D/E/Fï¼‰</span>
  <span class="hljs-keyword">SELECT</span> BITMAP_INTERSECT(b) <span class="hljs-keyword">FROM</span> (
    <span class="hljs-keyword">SELECT</span> TO_BITMAP(...) <span class="hljs-keyword">AS</span> b <span class="hljs-keyword">FROM</span> æ ‡ç­¾å®½è¡¨ <span class="hljs-keyword">WHERE</span> æ¡ä»¶D  <span class="hljs-comment">-- æ–°å®½è¡¨æ¡ä»¶</span>
    <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span>
    <span class="hljs-keyword">SELECT</span> user_ids <span class="hljs-keyword">AS</span> b <span class="hljs-keyword">FROM</span> æ ‡ç­¾é«˜è¡¨ <span class="hljs-keyword">WHERE</span> æ¡ä»¶E      <span class="hljs-comment">-- æ–°é«˜è¡¨æ¡ä»¶</span>
    <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span>
    <span class="hljs-keyword">SELECT</span> BITMAP_INTERSECT(...) <span class="hljs-keyword">AS</span> b <span class="hljs-keyword">FROM</span> äººç¾¤è¡¨ <span class="hljs-keyword">WHERE</span> æ¡ä»¶F <span class="hljs-comment">-- æ–°äººç¾¤æ¡ä»¶</span>
  )
) t;
</code></pre>
<h3 data-id="heading-7">04 æ•°æ®å¯¼å…¥</h3>
<p>è´§æ‹‰æ‹‰ç”»åƒæœåŠ¡çš„å®æ—¶æ ‡ç­¾/äººç¾¤ç‚¹æŸ¥ä¸»è¦é‡‡ç”¨ HBase ä¸ Redis ç›¸ç»“åˆçš„æ–¹å¼ï¼ŒDoris ä¸»è¦æ‰¿æ‹…äººç¾¤åœˆé€‰ã€äººç¾¤æ´å¯Ÿã€è¡Œä¸ºåˆ†æç­‰ä»»åŠ¡ã€‚å®æ—¶å’Œè¿‘å®æ—¶æ ‡ç­¾å†™å…¥ Doris åˆ™é€šè¿‡ Flink å®Œæˆï¼Œç¦»çº¿å¯¼å…¥ä¾èµ– Doris çš„ Broker Load åŠŸèƒ½ã€‚å¯¹åº”çš„æ•°æ®å¯¼â¼Šâ½…å¼å’Œåº”â½¤åœºæ™¯å¦‚ä¸‹ï¼š</p>
<p><strong>å®æ—¶/è¿‘å®æ—¶æ ‡ç­¾</strong></p>
<p>å®šä¹‰ï¼šç§’çº§/å°æ—¶çº§æ›´æ–°çš„åŠ¨æ€æ•°æ®ï¼ˆå¦‚ç‚¹å‡»ã€ç™»å½•äº‹ä»¶ï¼‰ã€‚</p>
<p>æ•°æ®æºï¼šKafka æ—¥å¿—ã€API åŸ‹ç‚¹ã€äº‘æ–‡ä»¶å­˜å‚¨ã€‚</p>
<p>å¤„ç†æ–¹å¼ï¼š</p>
<ul>
<li>ç§’çº§/åˆ†é’Ÿçº§æ ‡ç­¾ï¼šFlink -&gt; Doris / Hbaseã€‚</li>
<li>å°æ—¶çº§æ ‡ç­¾ï¼šäº‘æ–‡ä»¶å­˜å‚¨ -&gt; BrokerLoadã€‚</li>
</ul>
<p>åœºæ™¯ï¼šç”¨æˆ·è¡Œä¸ºåˆ†æï¼Œç”¨æˆ·å®æ—¶äººç¾¤ã€‚</p>
<p><strong>ç¦»çº¿æ ‡ç­¾</strong></p>
<p>å®šä¹‰ï¼šT+1 æ›´æ–°çš„å†å²æ•°æ®ï¼ˆå¦‚å¹´é¾„ã€å†å²è®¢å•ï¼‰ã€‚</p>
<p>æ•°æ®æºï¼šHiveã€‚</p>
<p>å¤„ç†æ–¹å¼ï¼š</p>
<ul>
<li>æ•°æ®é‡ï¼š3000+ æ ‡ç­¾ï¼Œ4 äº¿+ç”¨æˆ·æ€»é‡ã€‚</li>
<li>å®šæ—¶è°ƒåº¦ï¼šBrokerLoadã€‚</li>
<li>è°ƒä¼˜æ‰‹æ®µï¼šå®½è¡¨å¯¼å…¥æ‹†åˆ†å¤šè¡¨å’Œå¤šä¸ª BrokerLoad ä»»åŠ¡ã€‚æ•°æ®é‡å°‘çš„ç¨€ç–æ ‡ç­¾ä½¿ç”¨é«˜è¡¨å¯¼å…¥ã€‚</li>
<li>å¯¼å…¥æ•ˆç‡ï¼š200+ æ ‡ç­¾å®½è¡¨ 4 äº¿è¡Œ+å¯¼å…¥ 30min ä»¥å†…ï¼Œé«˜è¡¨æ ‡ç­¾å¯¼å…¥ 5min ä»¥å†…ã€‚</li>
</ul>
<p>åœºæ™¯ï¼šç”¨æˆ·äººç¾¤åœˆé€‰ã€ç”¨æˆ·ç”»åƒåˆ†æã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17651837909c467abb42a2f9c871d55e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763381036&amp;x-signature=HepMDQlzhYPcV2IQKo2xIuGivS4%3D" alt="æ•°æ®å¯¼å…¥.png" loading="lazy"/></p>
<p>ç‰¹åˆ«å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¤§è§„æ¨¡æ•°æ®å¯¼å…¥æ—¶ï¼Œå»ºè®®æ‹†åˆ†å¤šä¸ªè¡¨å¹¶è¡Œå¯¼å…¥ä»¥æå‡æ•ˆç‡ï¼Œä¾‹å¦‚åœ¨æ—©æœŸ 1.2.4 ç‰ˆæœ¬é›†ç¾¤æµ‹è¯•ä¸­ï¼Œå•ä¸ªåŒ…å« 200 ä½™æ ‡ç­¾ã€å››äº¿è¡Œè®°å½•çš„å®½è¡¨å¯¼å…¥è€—æ—¶è¶…è¿‡ 1.5 å°æ—¶ï¼Œè€Œæ‹†åˆ†ä¸º 6 ä¸ªä»»åŠ¡å¹¶è¡Œå¯¼å…¥åï¼Œæ€»è€—æ—¶ç¼©çŸ­è‡³çº¦ 20 åˆ†é’Ÿï¼Œ<strong>æ•ˆç‡æå‡è¿‘ 5 å€</strong>ã€‚</p>
<h2 data-id="heading-8">è´§æ‹‰æ‹‰ç”»åƒå·¥ç¨‹æŸ¥è¯¢ä¼˜åŒ–å®è·µ</h2>
<h3 data-id="heading-9">01 DSL ä¸ SQL ä¼˜åŒ–</h3>
<p>é¦–å…ˆæ˜¯ç¦»çº¿äººç¾¤åŒ…åœˆé€‰çš„æµç¨‹ï¼Œä¸»è¦åˆ†ä¸ºä¸‰æ­¥ï¼šã€è¿è¥é€šè¿‡å¹³å°è¿›è¡Œå¤šè§„åˆ™æ‹¼æ¥ï¼Œå‰ç«¯å®Œæˆ DSL æ„å»ºã€‘-ã€DSL ç»è¿‡æœåŠ¡åç«¯ä¼˜åŒ–ã€‘-ã€æœ€ç»ˆå°†ä¸šåŠ¡è§„åˆ™è‡ªåŠ¨è½¬åŒ–ä¸ºé«˜æ•ˆ SQLã€‘ã€‚DSL ä¼˜åŒ–çš„ç›®çš„æ˜¯æå‰æ’é™¤å†—ä½™è®¡ç®—ï¼Œä»è€Œå°†ä¼˜åŒ–åçš„ DSL ç›´æ¥ç¿»è¯‘ä¸ºé«˜æ•ˆæ˜“ç”¨çš„ SQLã€‚</p>
<ol>
<li>ä¸ºä»€ä¹ˆéœ€è¦ä¼˜åŒ–ï¼Ÿå½“å‰å¼‚æ„æŸ¥è¯¢ SQL ç—›ç‚¹ï¼š
<ol>
<li>éƒ¨åˆ†æ ‡ç­¾åœ¨ä¸šåŠ¡é€»è¾‘ä¸Šå¯ä»¥åˆå¹¶ ï¼Œå¼•æ“ä¾§æ²¡æœ‰è¦†ç›–è¯†åˆ«ï¼›</li>
<li>å¤šå±‚èšåˆå¯¼è‡´å†—ä½™æ‰«æï¼šå¤æ‚åµŒå¥—çš„åœºæ™¯ä¸‹ï¼ŒåµŒå¥—çš„ <code>UNION ALL</code> å’Œ <code>BITMAP_INTERSECT</code> å¯¼è‡´æ‰§è¡Œè®¡åˆ’å±‚çº§è†¨èƒ€ï¼Œå¯¼è‡´å†—ä½™çš„æ‰«æã€‚</li>
<li>ç¨³å®šæ€§ï¼šé«˜å³°æœŸäººç¾¤è®¡ç®—æ—¶ï¼Œå†…å­˜å ç”¨é«˜ã€ç½‘ç»œä¼ è¾“é‡å¤§ï¼Œé«˜å†…å­˜å¼€é”€å½±å“é›†ç¾¤ç¨³å®šæ€§ã€‚</li>
</ol>
</li>
<li>å¦‚ä½•å®ç°ä¼˜åŒ–ï¼ŸDSL ä¼˜åŒ–ï¼š
<ol>
<li>æ¡ä»¶åˆå¹¶ï¼ˆæŸ“è‰²ï¼‰ï¼šå°†åŒç±»æ ‡è®°çš„æ ‡ç­¾æ¡ä»¶åˆå¹¶ä¸ºåŒä¸ªå­æŸ¥è¯¢ã€‚</li>
<li>ç»“æ„æ‰å¹³åŒ–ï¼ˆå‰ªæï¼‰ï¼šå»é™¤å†—ä½™çš„ AND/OR é€»è¾‘èŠ‚ç‚¹</li>
</ol>
</li>
</ol>
<p>å°†åŒç±»åˆå¹¶æ“ä½œåçš„ DSL è½¬ä¸º SQLï¼ŒåŸæœ¬æŸ¥è¯¢ 3 æ¬¡å®½è¡¨è¯»å–äº† 3 ä¸ª BITMAP è¿›è¡Œåˆå¹¶è®¡ç®—ï¼Œä¼˜åŒ–åç»Ÿä¸€æˆ 1 æ¬¡å®½è¡¨æŸ¥è¯¢å’Œ 1 æ¬¡ BITMAP è¯»å–ï¼Œå‡å°‘äº†60% çš„å†—ä½™è¯»å–ã€‚å‚è€ƒä¸‹å›¾ï¼ŒDSL çš„æ¯ä¸€ä¸ªåœ†åœˆå¯¹åº”ä¸€ä¸ª BITMAP æŸ¥è¯¢ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0322d45dce5143068f52bd0c035ba2e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763381036&amp;x-signature=myNzCIbQ%2Fz5tL84427dvFCP6%2FFo%3D" alt="DSL ä¸ SQL ä¼˜åŒ–.png" loading="lazy"/></p>
<p>å…³äº <code>EXPLAIN</code> æŒ‡æ ‡ä¼˜åŒ–å‰åçš„å…·ä½“è¡¨ç°ï¼Œæˆ‘ä»¬åœ¨æ­¤ä¹Ÿåˆ†äº«ä¸€åˆ™å‚è€ƒç¤ºä¾‹ï¼Œè¯¦æƒ…å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ä¼˜åŒ–å‰</span>
<span class="hljs-keyword">SELECT</span> BITMAP_INTERSECT(b) <span class="hljs-keyword">AS</span> <span class="hljs-keyword">result</span> 
<span class="hljs-keyword">FROM</span> (
    <span class="hljs-keyword">SELECT</span> BITMAP_INTERSECT(b) <span class="hljs-keyword">AS</span> b 
    <span class="hljs-keyword">FROM</span> (
        <span class="hljs-keyword">SELECT</span> user_bitmap <span class="hljs-keyword">as</span> b <span class="hljs-keyword">FROM</span> user_bitmap <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">group</span> <span class="hljs-operator">=</span> â€˜Aâ€™
        <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span> 
        <span class="hljs-keyword">SELECT</span> TO_BITMAP(id) <span class="hljs-keyword">AS</span> b <span class="hljs-keyword">FROM</span> wide_table <span class="hljs-keyword">WHERE</span> city <span class="hljs-operator">=</span> <span class="hljs-string">'ä¸œè'</span>
        <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span>
        <span class="hljs-keyword">SELECT</span> TO_BITMAP(id) <span class="hljs-keyword">AS</span> b <span class="hljs-keyword">FROM</span> wide_table <span class="hljs-keyword">WHERE</span> sex <span class="hljs-operator">=</span> <span class="hljs-string">'ç”·'</span>
    ) t1 ) t2;
 
<span class="hljs-comment">-- ä¼˜åŒ–å</span>
<span class="hljs-keyword">SELECT</span> BITMAP_INTERSECT(b) <span class="hljs-keyword">AS</span> <span class="hljs-keyword">result</span> 
<span class="hljs-keyword">FROM</span> (    <span class="hljs-keyword">SELECT</span> user_bitmap <span class="hljs-keyword">as</span> b <span class="hljs-keyword">FROM</span> user_bitmap <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">group</span> <span class="hljs-operator">=</span> â€˜Aâ€™    <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span> 
    <span class="hljs-keyword">SELECT</span> TO_BITMAP(id) <span class="hljs-keyword">AS</span> b <span class="hljs-keyword">FROM</span> wide_table <span class="hljs-keyword">WHERE</span> city <span class="hljs-operator">=</span> <span class="hljs-string">'ä¸œè'</span> <span class="hljs-keyword">and</span> sex <span class="hljs-operator">=</span> â€˜ç”·â€™
) t1 ) t2;
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e67718b54bd4931859275b3dffdbfc3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763381036&amp;x-signature=kNgfIa6yfLOxPwWg5hW1PJijgc0%3D" alt="DSL ä¸ SQL ä¼˜åŒ–-1.png" loading="lazy"/></p>
<p>åœ¨ä¸šåŠ¡åœˆé€‰é€»è¾‘ä¸å˜çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡å°†ä¼˜åŒ–å‰ BITMAP å­æŸ¥è¯¢åˆå¹¶åˆ° WHERE æ¡ä»¶ä¸­ä»¥é¿å…é‡å¤æ‰«æè¡¨ï¼ŒåŒæ—¶å‡å°‘ BITMAP å­æŸ¥è¯¢åŠæ•°æ®åˆ†ç‰‡åˆå¹¶æ¬¡æ•°ï¼Œè¿›è€Œå‡å°‘èšåˆå±‚çº§å®ç°ç»“æ„æ‰å¹³åŒ–ï¼Œé™ä½äººç¾¤è®¡ç®—æ—¶çš„å†…å­˜å³°å€¼ã€‚</p>
<p><strong>åœ¨ä¸šåŠ¡é«˜å³°æœŸé’ˆå¯¹å¤§è§„æ¨¡äººç¾¤å±•å¼€è®¡ç®—çš„åœºæ™¯ä¸‹ï¼Œæ­¤ä¼˜åŒ–æªæ–½èƒ½å¤Ÿæœ‰æ•ˆå‡å°‘ 30ï½50% çš„å†…å­˜å¼€é”€ã€‚ä¸æ­¤åŒæ—¶ï¼ŒJVM çš„å †å†…å­˜ä½¿ç”¨å³°å€¼ä»åŸæœ¬çš„ 60% é™è‡³ 20% ã€‚</strong></p>
<h3 data-id="heading-10">02 äººç¾¤ä½å›¾è¡¨è¯»å–ä¼˜åŒ–</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/52b8c303d6f04465aebd08e833f11188~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763381036&amp;x-signature=bUEErdsWm9RG42CIVokKja5dygw%3D" alt="äººç¾¤ä½å›¾è¡¨è¯»å–ä¼˜åŒ–.png" loading="lazy"/></p>
<p>äººç¾¤ä½å›¾ç»“æœé›†é€šè¿‡ BITMAP å­˜å‚¨äºäººç¾¤è¡¨ä¸­ï¼Œè¯»å–äººç¾¤ä½å›¾æ•°æ®ä¸»è¦ç”¨äºäººç¾¤åœˆé€‰ã€äººç¾¤åˆ†æï¼Œå¹¶å°†æ•´ä¸ªç»“æœé›†æ¨é€è‡³ä¸‹æ¸¸ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/76e29b32c80445b6b04feed2e4ba91b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763381036&amp;x-signature=dJwZjb18rxkDsCwZWkWI3tazXO0%3D" alt="äººç¾¤ä½å›¾è¡¨è¯»å–ä¼˜åŒ–å®è·µ.png" loading="lazy"/></p>
<p>è¯»å–ä½å›¾æ•°æ®çš„æ–¹æ¡ˆæœ‰ä¸‰ç§ï¼š</p>
<ul>
<li>ç¬¬ä¸€ç§æ–¹æ¡ˆï¼Œç›´æ¥ä½¿ç”¨ Doris è‡ªå¸¦çš„ <code>bitmap_to_string</code> å‡½æ•°ï¼Œè¯¥å‡½æ•°å¯å°†ä½å›¾è½¬åŒ–ä¸ºé€—å·åˆ†éš”çš„å­—ç¬¦ä¸²ï¼Œå®¢æˆ·ç«¯æŒ‰æ­¤å­—ç¬¦ä¸²è§£æå‡ºç”¨æˆ·åˆ—è¡¨ã€‚ä½†æ˜¯å½“é¢å¯¹å¤§å‹ä½å›¾æ—¶ï¼Œè§£æéš¾åº¦è¾ƒå¤§ï¼Œä¸”æ•°æ®ä½“ç§¯ä¼šå¤§å¹…è†¨èƒ€ã€‚ä¼˜ç‚¹æ˜¯ç®€å•æ˜“ç”¨ï¼Œé€‚åˆæµ‹è¯•å’Œå¯¼å‡ºåœºæ™¯ã€‚</li>
<li>ç¬¬äºŒç§æ–¹æ¡ˆï¼Œé‡‡ç”¨ <code>explore</code> ä¸ <code>lateral view</code>å…ˆå°†æ•´ä¸ªä½å›¾å±•å¼€ï¼Œå†æ„å»ºæœåŠ¡ç«¯æµå¤„ç†é€»è¾‘ã€‚ä¸è¿‡ï¼ŒDoris éœ€å°†ä½å›¾å±•å¼€æˆç”¨æˆ·åˆ—è¡¨å¹¶ç¼“å­˜äºæœåŠ¡å™¨ï¼Œè¿™ä¼šç»™æœåŠ¡ç«¯å¸¦æ¥å‹åŠ›ï¼Œå°¤å…¶åœ¨é«˜å³°æœŸï¼Œäººç¾¤è®¡ç®—ä»»åŠ¡ç¹é‡æ—¶æ›´ä¸ºæ˜æ˜¾ã€‚æ­¤å¤–ï¼Œç”»åƒå·¥ç¨‹ä¾§éœ€ç»´æŠ¤æµå¤„ç†é€»è¾‘ï¼Œå¼€å‘ç»´æŠ¤æˆæœ¬è¾ƒé«˜ã€‚è¯¥æ–¹æ¡ˆé€‚åˆäººç¾¤å¤šè¡¨çš„å…³è”åˆ†æã€‚</li>
<li>ç¬¬ä¸‰ç§æ–¹æ¡ˆï¼Œä¹Ÿæ˜¯è¾ƒä¸ºæ¨èçš„æ–¹æ¡ˆï¼Œç›´æ¥å°†ä½å›¾çš„äºŒè¿›åˆ¶æ•°æ®è¯»å–è‡³æœåŠ¡ç«¯å†…å­˜ï¼Œå†è¿›è¡Œååºåˆ—åŒ–ã€‚æœåŠ¡ç«¯è®¾ç½® <code>return_object_data_as_binary=true</code> ï¼Œå³å¯ç›´æ¥è¯»å–ä½å›¾çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œç”»åƒæœåŠ¡ç«¯å¯åŸºäº Doris æºç ä¸­çš„ä½å›¾åè®®è¿›è¡Œååºåˆ—åŒ–ã€‚æ­¤æ–¹å¼ä»…éœ€ä¼ è¾“ä½å›¾çš„åŸå§‹äºŒè¿›åˆ¶æ•°æ®ï¼Œå†…å­˜å ç”¨å’Œå¼€é”€è¾ƒä½ã€‚å¼€å‘æˆæœ¬åˆæœŸè¾ƒé«˜ï¼Œä½†åæœŸç»´æŠ¤æ–¹ä¾¿ä¸”ç¨³å®šã€‚æ­¤è¯»å–æ–¹å¼é€‚ç”¨äºäººç¾¤åœˆé€‰åœºæ™¯ï¼Œå°†ä½å›¾å…¨é‡è¯»å–è‡³æœåŠ¡å†…å­˜åï¼Œé«˜å³°æœŸæ¯åˆ†é’Ÿå¯è½»æ¾å¤„ç†å‡ åç”šè‡³ä¸Šç™¾ä¸ªäººç¾¤ã€‚</li>
</ul>
<h2 data-id="heading-11">æ€»ç»“ä¸è§„åˆ’</h2>
<p>è´§æ‹‰æ‹‰è‡ªå¼•å…¥ Apache Doris æ„å»ºç”¨æˆ·ç”»åƒç³»ç»Ÿä»¥æ¥ï¼Œæ”¶ç›Šååˆ†æ˜¾è‘—ï¼š<strong>ä¸šåŠ¡æŸ¥è¯¢æ•ˆç‡æå‡è¿‘ 30 å€ï¼Œæ•°æ®å¯¼å…¥é€Ÿåº¦æ˜¯ Impala+KUDU çš„ 3 å€ï¼Œå†…å­˜å¼€é”€é™ä½ 30%-50%ï¼Œç³»ç»Ÿç¨³å®šæ€§å¤§å¹…æå‡ï¼Œæ»¡è¶³äº†ç”»åƒåœºæ™¯æ•°åƒä¸ªæ ‡ç­¾çš„ç²¾ç»†åŒ–è¿è¥éœ€æ±‚ï¼ŒåŒæ—¶é€šè¿‡å¯è§†åŒ–æ ‡ç­¾ç­›é€‰ï¼Œé™ä½ä¸šåŠ¡åˆ†æçš„æ“ä½œé—¨æ§›</strong>ã€‚</p>
<p>åç»­ï¼Œè´§æ‹‰æ‹‰å°†é‡ç‚¹æŠ•å…¥ä»¥ä¸‹ä¸¤ä¸ªæ–¹é¢ï¼š</p>
<ul>
<li><strong>æ¥å…¥ç”»åƒå®æ—¶ä¸šåŠ¡</strong>ï¼šå½“å‰è´§æ‹‰æ‹‰ç”»åƒæœåŠ¡çš„å®æ—¶æ ‡ç­¾/äººç¾¤ç‚¹æŸ¥ä¸»è¦ä½¿ç”¨ Hbase å’Œ Redisï¼ŒåŸºäºç¨³å®šæ€§å’Œè¿ç§»å‡çº§æˆæœ¬çš„è€ƒè™‘ï¼ŒDoris ä¸»è¦æ‰¿æ‹…äººç¾¤åœˆé€‰ã€äººç¾¤æ´å¯Ÿã€è¡Œä¸ºåˆ†æç­‰ä½œä¸šã€‚æœªæ¥è§„åˆ’ä½¿ç”¨ Doris é«˜ç‰ˆæœ¬çš„æ¶æ„ï¼Œæ‰¿æ‹…å¤§éƒ¨åˆ†é«˜å¹¶å‘çš„å®æ—¶ç‚¹æŸ¥æµé‡ï¼Œæå‡äººè´§åŒ¹é…æ•ˆç‡å’Œä½“éªŒã€‚</li>
<li><strong>å¼•å…¥æ¹–ä»“ä¸€ä½“æ¶æ„</strong>ï¼šä½¿ç”¨ Doris + æ•°æ®æ¹–ï¼Œåœ¨å­˜å‚¨æ¶æ„æ–¹é¢ï¼Œå°è¯•è½åœ°æ•°æ®æ¹–è§£å†³æ–¹æ¡ˆï¼Œç”»åƒå¹³å°å°†æ‰“é€šå…¶ä»–æ•°æ®åº”ç”¨å¹³å°ã€å®ç°è¶…å¤§è§„æ¨¡æ•°æ®çš„åˆ†æã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>