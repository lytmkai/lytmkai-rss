<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[Vercel React 最佳实践 中文版]]></title>    <link>https://juejin.cn/post/7595893785907265570</link>    <guid>https://juejin.cn/post/7595893785907265570</guid>    <pubDate>2026-01-17T16:13:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595893785907265570" data-draft-id="7595896809652142120" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vercel React 最佳实践 中文版"/> <meta itemprop="keywords" content="前端,面试,React.js"/> <meta itemprop="datePublished" content="2026-01-17T16:13:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ssshooter"/> <meta itemprop="url" content="https://juejin.cn/user/3122268751795101"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vercel React 最佳实践 中文版
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3122268751795101/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ssshooter
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T16:13:44.000Z" title="Sat Jan 17 2026 16:13:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">React 最佳实践</h2>
<p><strong>版本 1.0.0</strong><br/>
Vercel 工程团队<br/>
2026年1月</p>
<blockquote>
<p><strong>注意：</strong><br/>
本文档主要供 Agent 和 LLM 在 Vercel 维护、生成或重构 React 及 Next.js 代码库时遵循。人类开发者也会发现其对于保持一致性和自动化优化非常有帮助。</p>
</blockquote>
<hr/>
<h3 data-id="heading-1">摘要</h3>
<p>这是一份针对 React 和 Next.js 应用程序的综合性能优化指南，专为 AI Agent 和 LLM 设计。包含 8 个类别的 40 多条规则，按影响力从关键（消除瀑布流、减少打包体积）到增量（高级模式）排序。每条规则都包含详细的解释、错误与正确实现的真实代码对比，以及具体的影响指标，以指导自动重构和代码生成。</p>
<hr/>
<h3 data-id="heading-2">目录</h3>
<ol>
<li><a href="#1-%E6%B6%88%E9%99%A4%E7%80%91%E5%B8%83%E6%B5%81" title="#1-%E6%B6%88%E9%99%A4%E7%80%91%E5%B8%83%E6%B5%81">消除瀑布流</a> — <strong>关键</strong>
<ul>
<li>1.1 <a href="#11-%E6%8E%A8%E8%BF%9F-await-%E7%9B%B4%E5%88%B0%E9%9C%80%E8%A6%81%E6%97%B6" title="#11-%E6%8E%A8%E8%BF%9F-await-%E7%9B%B4%E5%88%B0%E9%9C%80%E8%A6%81%E6%97%B6">推迟 Await 直到需要时</a></li>
<li>1.2 <a href="#12-%E5%9F%BA%E4%BA%8E%E4%BE%9D%E8%B5%96%E7%9A%84%E5%B9%B6%E8%A1%8C%E5%8C%96" title="#12-%E5%9F%BA%E4%BA%8E%E4%BE%9D%E8%B5%96%E7%9A%84%E5%B9%B6%E8%A1%8C%E5%8C%96">基于依赖的并行化</a></li>
<li>1.3 <a href="#13-%E9%98%B2%E6%AD%A2-api-%E8%B7%AF%E7%94%B1%E4%B8%AD%E7%9A%84%E7%80%91%E5%B8%83%E9%93%BE" title="#13-%E9%98%B2%E6%AD%A2-api-%E8%B7%AF%E7%94%B1%E4%B8%AD%E7%9A%84%E7%80%91%E5%B8%83%E9%93%BE">防止 API 路由中的瀑布链</a></li>
<li>1.4 <a href="#14-%E5%AF%B9%E7%8B%AC%E7%AB%8B%E6%93%8D%E4%BD%9C%E4%BD%BF%E7%94%A8-promiseall" title="#14-%E5%AF%B9%E7%8B%AC%E7%AB%8B%E6%93%8D%E4%BD%9C%E4%BD%BF%E7%94%A8-promiseall">对独立操作使用 Promise.all()</a></li>
<li>1.5 <a href="#15-%E7%AD%96%E7%95%A5%E6%80%A7-suspense-%E8%BE%B9%E7%95%8C" title="#15-%E7%AD%96%E7%95%A5%E6%80%A7-suspense-%E8%BE%B9%E7%95%8C">策略性 Suspense 边界</a></li>
</ul>
</li>
<li><a href="#2-%E6%89%93%E5%8C%85%E4%BD%93%E7%A7%AF%E4%BC%98%E5%8C%96" title="#2-%E6%89%93%E5%8C%85%E4%BD%93%E7%A7%AF%E4%BC%98%E5%8C%96">打包体积优化</a> — <strong>关键</strong>
<ul>
<li>2.1 <a href="#21-%E9%81%BF%E5%85%8D-barrel-%E6%96%87%E4%BB%B6%E5%AF%BC%E5%85%A5" title="#21-%E9%81%BF%E5%85%8D-barrel-%E6%96%87%E4%BB%B6%E5%AF%BC%E5%85%A5">避免 Barrel 文件导入</a></li>
<li>2.2 <a href="#22-%E6%9D%A1%E4%BB%B6%E6%A8%A1%E5%9D%97%E5%8A%A0%E8%BD%BD" title="#22-%E6%9D%A1%E4%BB%B6%E6%A8%A1%E5%9D%97%E5%8A%A0%E8%BD%BD">条件模块加载</a></li>
<li>2.3 <a href="#23-%E6%8E%A8%E8%BF%9F%E9%9D%9E%E5%85%B3%E9%94%AE%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93" title="#23-%E6%8E%A8%E8%BF%9F%E9%9D%9E%E5%85%B3%E9%94%AE%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93">推迟非关键第三方库</a></li>
<li>2.4 <a href="#24-%E9%87%8D%E5%9E%8B%E7%BB%84%E4%BB%B6%E5%8A%A8%E6%80%81%E5%AF%BC%E5%85%A5" title="#24-%E9%87%8D%E5%9E%8B%E7%BB%84%E4%BB%B6%E5%8A%A8%E6%80%81%E5%AF%BC%E5%85%A5">重型组件动态导入</a></li>
<li>2.5 <a href="#25-%E5%9F%BA%E4%BA%8E%E7%94%A8%E6%88%B7%E6%84%8F%E5%9B%BE%E9%A2%84%E5%8A%A0%E8%BD%BD" title="#25-%E5%9F%BA%E4%BA%8E%E7%94%A8%E6%88%B7%E6%84%8F%E5%9B%BE%E9%A2%84%E5%8A%A0%E8%BD%BD">基于用户意图预加载</a></li>
</ul>
</li>
<li><a href="#3-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%80%A7%E8%83%BD" title="#3-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%80%A7%E8%83%BD">服务端性能</a> — <strong>高</strong>
<ul>
<li>3.1 <a href="#31-%E8%B7%A8%E8%AF%B7%E6%B1%82-lru-%E7%BC%93%E5%AD%98" title="#31-%E8%B7%A8%E8%AF%B7%E6%B1%82-lru-%E7%BC%93%E5%AD%98">跨请求 LRU 缓存</a></li>
<li>3.2 <a href="#32-%E6%9C%80%E5%B0%8F%E5%8C%96-rsc-%E8%BE%B9%E7%95%8C%E5%BA%8F%E5%88%97%E5%8C%96" title="#32-%E6%9C%80%E5%B0%8F%E5%8C%96-rsc-%E8%BE%B9%E7%95%8C%E5%BA%8F%E5%88%97%E5%8C%96">最小化 RSC 边界序列化</a></li>
<li>3.3 <a href="#33-%E9%80%9A%E8%BF%87%E7%BB%84%E4%BB%B6%E7%BB%84%E5%90%88%E5%B9%B6%E8%A1%8C%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE" title="#33-%E9%80%9A%E8%BF%87%E7%BB%84%E4%BB%B6%E7%BB%84%E5%90%88%E5%B9%B6%E8%A1%8C%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE">通过组件组合并行获取数据</a></li>
<li>3.4 <a href="#34-%E4%BD%BF%E7%94%A8-reactcache-%E8%BF%9B%E8%A1%8C%E6%8C%89%E8%AF%B7%E6%B1%82%E5%8E%BB%E9%87%8D" title="#34-%E4%BD%BF%E7%94%A8-reactcache-%E8%BF%9B%E8%A1%8C%E6%8C%89%E8%AF%B7%E6%B1%82%E5%8E%BB%E9%87%8D">使用 React.cache() 进行按请求去重</a></li>
<li>3.5 <a href="#35-%E4%BD%BF%E7%94%A8-after-%E5%A4%84%E7%90%86%E9%9D%9E%E9%98%BB%E5%A1%9E%E6%93%8D%E4%BD%9C" title="#35-%E4%BD%BF%E7%94%A8-after-%E5%A4%84%E7%90%86%E9%9D%9E%E9%98%BB%E5%A1%9E%E6%93%8D%E4%BD%9C">使用 after() 处理非阻塞操作</a></li>
</ul>
</li>
<li><a href="#4-%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%95%B0%E6%8D%AE%E8%8E%B7%E5%8F%96" title="#4-%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%95%B0%E6%8D%AE%E8%8E%B7%E5%8F%96">客户端数据获取</a> — <strong>中高</strong>
<ul>
<li>4.1 <a href="#41-%E5%8E%BB%E9%87%8D%E5%85%A8%E5%B1%80%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC%E5%99%A8" title="#41-%E5%8E%BB%E9%87%8D%E5%85%A8%E5%B1%80%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC%E5%99%A8">去重全局事件监听器</a></li>
<li>4.2 <a href="#42-%E4%BD%BF%E7%94%A8-swr-%E8%87%AA%E5%8A%A8%E5%8E%BB%E9%87%8D" title="#42-%E4%BD%BF%E7%94%A8-swr-%E8%87%AA%E5%8A%A8%E5%8E%BB%E9%87%8D">使用 SWR 自动去重</a></li>
</ul>
</li>
<li><a href="#5-%E9%87%8D%E6%B8%B2%E6%9F%93%E4%BC%98%E5%8C%96" title="#5-%E9%87%8D%E6%B8%B2%E6%9F%93%E4%BC%98%E5%8C%96">重渲染优化</a> — <strong>中</strong>
<ul>
<li>5.1 <a href="#51-%E6%8E%A8%E8%BF%9F%E7%8A%B6%E6%80%81%E8%AF%BB%E5%8F%96%E5%88%B0%E4%BD%BF%E7%94%A8%E7%82%B9" title="#51-%E6%8E%A8%E8%BF%9F%E7%8A%B6%E6%80%81%E8%AF%BB%E5%8F%96%E5%88%B0%E4%BD%BF%E7%94%A8%E7%82%B9">推迟状态读取到使用点</a></li>
<li>5.2 <a href="#52-%E6%8F%90%E5%8F%96%E4%B8%BA%E8%AE%B0%E5%BF%86%E5%8C%96%E7%BB%84%E4%BB%B6" title="#52-%E6%8F%90%E5%8F%96%E4%B8%BA%E8%AE%B0%E5%BF%86%E5%8C%96%E7%BB%84%E4%BB%B6">提取为记忆化组件</a></li>
<li>5.3 <a href="#53-%E7%BC%A9%E5%B0%8F-effect-%E4%BE%9D%E8%B5%96%E8%8C%83%E5%9B%B4" title="#53-%E7%BC%A9%E5%B0%8F-effect-%E4%BE%9D%E8%B5%96%E8%8C%83%E5%9B%B4">缩小 Effect 依赖范围</a></li>
<li>5.4 <a href="#54-%E8%AE%A2%E9%98%85%E6%B4%BE%E7%94%9F%E7%8A%B6%E6%80%81" title="#54-%E8%AE%A2%E9%98%85%E6%B4%BE%E7%94%9F%E7%8A%B6%E6%80%81">订阅派生状态</a></li>
<li>5.5 <a href="#55-%E4%BD%BF%E7%94%A8%E5%87%BD%E6%95%B0%E5%BC%8F-setstate-%E6%9B%B4%E6%96%B0" title="#55-%E4%BD%BF%E7%94%A8%E5%87%BD%E6%95%B0%E5%BC%8F-setstate-%E6%9B%B4%E6%96%B0">使用函数式 setState 更新</a></li>
<li>5.6 <a href="#56-%E4%BD%BF%E7%94%A8%E6%83%B0%E6%80%A7%E7%8A%B6%E6%80%81%E5%88%9D%E5%A7%8B%E5%8C%96" title="#56-%E4%BD%BF%E7%94%A8%E6%83%B0%E6%80%A7%E7%8A%B6%E6%80%81%E5%88%9D%E5%A7%8B%E5%8C%96">使用惰性状态初始化</a></li>
<li>5.7 <a href="#57-%E5%AF%B9%E9%9D%9E%E7%B4%A7%E6%80%A5%E6%9B%B4%E6%96%B0%E4%BD%BF%E7%94%A8-transitions" title="#57-%E5%AF%B9%E9%9D%9E%E7%B4%A7%E6%80%A5%E6%9B%B4%E6%96%B0%E4%BD%BF%E7%94%A8-transitions">对非紧急更新使用 Transitions</a></li>
</ul>
</li>
<li><a href="#6-%E6%B8%B2%E6%9F%93%E6%80%A7%E8%83%BD" title="#6-%E6%B8%B2%E6%9F%93%E6%80%A7%E8%83%BD">渲染性能</a> — <strong>中</strong>
<ul>
<li>6.1 <a href="#61-%E5%8A%A8%E7%94%BB%E5%8C%96-svg-%E5%8C%85%E8%A3%85%E5%99%A8%E8%80%8C%E9%9D%9E-svg-%E5%85%83%E7%B4%A0" title="#61-%E5%8A%A8%E7%94%BB%E5%8C%96-svg-%E5%8C%85%E8%A3%85%E5%99%A8%E8%80%8C%E9%9D%9E-svg-%E5%85%83%E7%B4%A0">动画化 SVG 包装器而非 SVG 元素</a></li>
<li>6.2 <a href="#62-%E9%95%BF%E5%88%97%E8%A1%A8%E4%BD%BF%E7%94%A8-css-content-visibility" title="#62-%E9%95%BF%E5%88%97%E8%A1%A8%E4%BD%BF%E7%94%A8-css-content-visibility">长列表使用 CSS content-visibility</a></li>
<li>6.3 <a href="#63-%E6%8F%90%E5%8D%87%E9%9D%99%E6%80%81-jsx-%E5%85%83%E7%B4%A0" title="#63-%E6%8F%90%E5%8D%87%E9%9D%99%E6%80%81-jsx-%E5%85%83%E7%B4%A0">提升静态 JSX 元素</a></li>
<li>6.4 <a href="#64-%E4%BC%98%E5%8C%96-svg-%E7%B2%BE%E5%BA%A6" title="#64-%E4%BC%98%E5%8C%96-svg-%E7%B2%BE%E5%BA%A6">优化 SVG 精度</a></li>
<li>6.5 <a href="#65-%E6%97%A0%E9%97%AA%E7%83%81%E9%98%B2%E6%AD%A2%E6%B0%B4%E5%90%88%E4%B8%8D%E5%8C%B9%E9%85%8D" title="#65-%E6%97%A0%E9%97%AA%E7%83%81%E9%98%B2%E6%AD%A2%E6%B0%B4%E5%90%88%E4%B8%8D%E5%8C%B9%E9%85%8D">无闪烁防止水合不匹配</a></li>
<li>6.6 <a href="#66-%E4%BD%BF%E7%94%A8-activity-%E7%BB%84%E4%BB%B6%E8%BF%9B%E8%A1%8C%E6%98%BE%E7%A4%BA%E9%9A%90%E8%97%8F" title="#66-%E4%BD%BF%E7%94%A8-activity-%E7%BB%84%E4%BB%B6%E8%BF%9B%E8%A1%8C%E6%98%BE%E7%A4%BA%E9%9A%90%E8%97%8F">使用 Activity 组件进行显示/隐藏</a></li>
<li>6.7 <a href="#67-%E4%BD%BF%E7%94%A8%E6%98%BE%E5%BC%8F%E6%9D%A1%E4%BB%B6%E6%B8%B2%E6%9F%93" title="#67-%E4%BD%BF%E7%94%A8%E6%98%BE%E5%BC%8F%E6%9D%A1%E4%BB%B6%E6%B8%B2%E6%9F%93">使用显式条件渲染</a></li>
</ul>
</li>
<li><a href="#7-javascript-%E6%80%A7%E8%83%BD" title="#7-javascript-%E6%80%A7%E8%83%BD">JavaScript 性能</a> — <strong>中低</strong>
<ul>
<li>7.1 <a href="#71-%E6%89%B9%E9%87%8F-dom-css-%E6%9B%B4%E6%94%B9" title="#71-%E6%89%B9%E9%87%8F-dom-css-%E6%9B%B4%E6%94%B9">批量 DOM CSS 更改</a></li>
<li>7.2 <a href="#72-%E4%B8%BA%E9%87%8D%E5%A4%8D%E6%9F%A5%E6%89%BE%E6%9E%84%E5%BB%BA%E7%B4%A2%E5%BC%95-map" title="#72-%E4%B8%BA%E9%87%8D%E5%A4%8D%E6%9F%A5%E6%89%BE%E6%9E%84%E5%BB%BA%E7%B4%A2%E5%BC%95-map">为重复查找构建索引 Map</a></li>
<li>7.3 <a href="#73-%E5%9C%A8%E5%BE%AA%E7%8E%AF%E4%B8%AD%E7%BC%93%E5%AD%98%E5%B1%9E%E6%80%A7%E8%AE%BF%E9%97%AE" title="#73-%E5%9C%A8%E5%BE%AA%E7%8E%AF%E4%B8%AD%E7%BC%93%E5%AD%98%E5%B1%9E%E6%80%A7%E8%AE%BF%E9%97%AE">在循环中缓存属性访问</a></li>
<li>7.4 <a href="#74-%E7%BC%93%E5%AD%98%E9%87%8D%E5%A4%8D%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8" title="#74-%E7%BC%93%E5%AD%98%E9%87%8D%E5%A4%8D%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8">缓存重复函数调用</a></li>
<li>7.5 <a href="#75-%E7%BC%93%E5%AD%98-storage-api-%E8%B0%83%E7%94%A8" title="#75-%E7%BC%93%E5%AD%98-storage-api-%E8%B0%83%E7%94%A8">缓存 Storage API 调用</a></li>
<li>7.6 <a href="#76-%E5%90%88%E5%B9%B6%E5%A4%9A%E4%B8%AA%E6%95%B0%E7%BB%84%E8%BF%AD%E4%BB%A3" title="#76-%E5%90%88%E5%B9%B6%E5%A4%9A%E4%B8%AA%E6%95%B0%E7%BB%84%E8%BF%AD%E4%BB%A3">合并多个数组迭代</a></li>
<li>7.7 <a href="#77-%E6%95%B0%E7%BB%84%E6%AF%94%E8%BE%83%E5%89%8D%E5%85%88%E6%A3%80%E6%9F%A5%E9%95%BF%E5%BA%A6" title="#77-%E6%95%B0%E7%BB%84%E6%AF%94%E8%BE%83%E5%89%8D%E5%85%88%E6%A3%80%E6%9F%A5%E9%95%BF%E5%BA%A6">数组比较前先检查长度</a></li>
<li>7.8 <a href="#78-%E5%87%BD%E6%95%B0%E6%8F%90%E5%89%8D%E8%BF%94%E5%9B%9E" title="#78-%E5%87%BD%E6%95%B0%E6%8F%90%E5%89%8D%E8%BF%94%E5%9B%9E">函数提前返回</a></li>
<li>7.9 <a href="#79-%E6%8F%90%E5%8D%87-regexp-%E5%88%9B%E5%BB%BA" title="#79-%E6%8F%90%E5%8D%87-regexp-%E5%88%9B%E5%BB%BA">提升 RegExp 创建</a></li>
<li>7.10 <a href="#710-%E4%BD%BF%E7%94%A8%E5%BE%AA%E7%8E%AF%E6%B1%82%E6%9C%80%E5%B0%8F%E6%9C%80%E5%A4%A7%E5%80%BC%E8%80%8C%E9%9D%9E%E6%8E%92%E5%BA%8F" title="#710-%E4%BD%BF%E7%94%A8%E5%BE%AA%E7%8E%AF%E6%B1%82%E6%9C%80%E5%B0%8F%E6%9C%80%E5%A4%A7%E5%80%BC%E8%80%8C%E9%9D%9E%E6%8E%92%E5%BA%8F">使用循环求最小/最大值而非排序</a></li>
<li>7.11 <a href="#711-%E4%BD%BF%E7%94%A8-setmap-%E8%BF%9B%E8%A1%8C-o1-%E6%9F%A5%E6%89%BE" title="#711-%E4%BD%BF%E7%94%A8-setmap-%E8%BF%9B%E8%A1%8C-o1-%E6%9F%A5%E6%89%BE">使用 Set/Map 进行 O(1) 查找</a></li>
<li>7.12 <a href="#712-%E4%BD%BF%E7%94%A8-tosorted-%E4%BB%A3%E6%9B%BF-sort-%E4%BB%A5%E4%BF%9D%E8%AF%81%E4%B8%8D%E5%8F%AF%E5%8F%98%E6%80%A7" title="#712-%E4%BD%BF%E7%94%A8-tosorted-%E4%BB%A3%E6%9B%BF-sort-%E4%BB%A5%E4%BF%9D%E8%AF%81%E4%B8%8D%E5%8F%AF%E5%8F%98%E6%80%A7">使用 toSorted() 代替 sort() 以保证不可变性</a></li>
</ul>
</li>
<li><a href="#8-%E9%AB%98%E7%BA%A7%E6%A8%A1%E5%BC%8F" title="#8-%E9%AB%98%E7%BA%A7%E6%A8%A1%E5%BC%8F">高级模式</a> — <strong>低</strong>
<ul>
<li>8.1 <a href="#81-%E5%9C%A8-refs-%E4%B8%AD%E5%AD%98%E5%82%A8%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E7%A8%8B%E5%BA%8F" title="#81-%E5%9C%A8-refs-%E4%B8%AD%E5%AD%98%E5%82%A8%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E7%A8%8B%E5%BA%8F">在 Refs 中存储事件处理程序</a></li>
<li>8.2 <a href="#82-%E4%BD%BF%E7%94%A8-uselatest-%E8%8E%B7%E5%8F%96%E7%A8%B3%E5%AE%9A%E7%9A%84%E5%9B%9E%E8%B0%83-refs" title="#82-%E4%BD%BF%E7%94%A8-uselatest-%E8%8E%B7%E5%8F%96%E7%A8%B3%E5%AE%9A%E7%9A%84%E5%9B%9E%E8%B0%83-refs">使用 useLatest 获取稳定的回调 Refs</a></li>
</ul>
</li>
</ol>
<hr/>
<h3 data-id="heading-3">1. 消除瀑布流</h3>
<p><strong>影响力: 关键</strong></p>
<p>瀑布流（Waterfalls）是头号性能杀手。每一个连续的 <code>await</code> 都会增加完整的网络延迟。消除它们能带来最大的收益。</p>
<h4 data-id="heading-4">1.1 推迟 Await 直到需要时</h4>
<p><strong>影响力: 高 (避免阻塞不使用的代码路径)</strong></p>
<p>将 <code>await</code> 操作移动到实际使用它们的分支中，以避免阻塞不需要它们的代码路径。</p>
<p><strong>错误：阻塞了两个分支</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleRequest</span>(<span class="hljs-params">userId: <span class="hljs-built_in">string</span>, skipProcessing: <span class="hljs-built_in">boolean</span></span>) {
  <span class="hljs-keyword">const</span> userData = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchUserData</span>(userId)
  
  <span class="hljs-keyword">if</span> (skipProcessing) {
    <span class="hljs-comment">// 立即返回，但仍然等待了 userData</span>
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">skipped</span>: <span class="hljs-literal">true</span> }
  }
  
  <span class="hljs-comment">// 只有这个分支使用了 userData</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">processUserData</span>(userData)
}
</code></pre>
<p><strong>正确：仅在需要时阻塞</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleRequest</span>(<span class="hljs-params">userId: <span class="hljs-built_in">string</span>, skipProcessing: <span class="hljs-built_in">boolean</span></span>) {
  <span class="hljs-keyword">if</span> (skipProcessing) {
    <span class="hljs-comment">// 不等待直接返回</span>
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">skipped</span>: <span class="hljs-literal">true</span> }
  }
  
  <span class="hljs-comment">// 仅在需要时获取</span>
  <span class="hljs-keyword">const</span> userData = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchUserData</span>(userId)
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">processUserData</span>(userData)
}
</code></pre>
<p><strong>另一个例子：提前返回优化</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 错误：总是获取权限</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">updateResource</span>(<span class="hljs-params">resourceId: <span class="hljs-built_in">string</span>, userId: <span class="hljs-built_in">string</span></span>) {
  <span class="hljs-keyword">const</span> permissions = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchPermissions</span>(userId)
  <span class="hljs-keyword">const</span> resource = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getResource</span>(resourceId)
  
  <span class="hljs-keyword">if</span> (!resource) {
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">error</span>: <span class="hljs-string">'Not found'</span> }
  }
  
  <span class="hljs-keyword">if</span> (!permissions.<span class="hljs-property">canEdit</span>) {
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">error</span>: <span class="hljs-string">'Forbidden'</span> }
  }
  
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-title function_">updateResourceData</span>(resource, permissions)
}

<span class="hljs-comment">// 正确：仅在需要时获取</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">updateResource</span>(<span class="hljs-params">resourceId: <span class="hljs-built_in">string</span>, userId: <span class="hljs-built_in">string</span></span>) {
  <span class="hljs-keyword">const</span> resource = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getResource</span>(resourceId)
  
  <span class="hljs-keyword">if</span> (!resource) {
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">error</span>: <span class="hljs-string">'Not found'</span> }
  }
  
  <span class="hljs-keyword">const</span> permissions = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchPermissions</span>(userId)
  
  <span class="hljs-keyword">if</span> (!permissions.<span class="hljs-property">canEdit</span>) {
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">error</span>: <span class="hljs-string">'Forbidden'</span> }
  }
  
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-title function_">updateResourceData</span>(resource, permissions)
}
</code></pre>
<p>当被跳过的分支经常被执行，或者被推迟的操作非常昂贵时，这种优化通过尤为有价值。</p>
<h4 data-id="heading-5">1.2 基于依赖的并行化</h4>
<p><strong>影响力: 关键 (2-10倍 提升)</strong></p>
<p>对于具有部分依赖关系的操作，使用 <code>better-all</code> 来即最大化并行性。它会在尽可能早的时刻启动每个任务。</p>
<p><strong>错误：profile 不必要地等待 config</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> [user, config] = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([
  <span class="hljs-title function_">fetchUser</span>(),
  <span class="hljs-title function_">fetchConfig</span>()
])
<span class="hljs-keyword">const</span> profile = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchProfile</span>(user.<span class="hljs-property">id</span>)
</code></pre>
<p><strong>正确：config 和 profile 并行运行</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { all } <span class="hljs-keyword">from</span> <span class="hljs-string">'better-all'</span>

<span class="hljs-keyword">const</span> { user, config, profile } = <span class="hljs-keyword">await</span> <span class="hljs-title function_">all</span>({
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">user</span>(<span class="hljs-params"/>) { <span class="hljs-keyword">return</span> <span class="hljs-title function_">fetchUser</span>() },
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">config</span>(<span class="hljs-params"/>) { <span class="hljs-keyword">return</span> <span class="hljs-title function_">fetchConfig</span>() },
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">profile</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">fetchProfile</span>((<span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">$</span>.<span class="hljs-property">user</span>).<span class="hljs-property">id</span>)
  }
})
</code></pre>
<p>参考: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fshuding%2Fbetter-all" target="_blank" title="https://github.com/shuding/better-all" ref="nofollow noopener noreferrer">github.com/shuding/bet…</a></p>
<h4 data-id="heading-6">1.3 防止 API 路由中的瀑布链</h4>
<p><strong>影响力: 关键 (2-10倍 提升)</strong></p>
<p>在 API 路由和 Server Actions 中，即使此时还不 <code>await</code> 它们，也要立即启动独立的操作。</p>
<p><strong>错误：config 等待 auth，data 等待两者</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">GET</span>(<span class="hljs-params">request: Request</span>) {
  <span class="hljs-keyword">const</span> session = <span class="hljs-keyword">await</span> <span class="hljs-title function_">auth</span>()
  <span class="hljs-keyword">const</span> config = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchConfig</span>()
  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchData</span>(session.<span class="hljs-property">user</span>.<span class="hljs-property">id</span>)
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Response</span>.<span class="hljs-title function_">json</span>({ data, config })
}
</code></pre>
<p><strong>正确：auth 和 config 立即启动</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">GET</span>(<span class="hljs-params">request: Request</span>) {
  <span class="hljs-keyword">const</span> sessionPromise = <span class="hljs-title function_">auth</span>()
  <span class="hljs-keyword">const</span> configPromise = <span class="hljs-title function_">fetchConfig</span>()
  <span class="hljs-keyword">const</span> session = <span class="hljs-keyword">await</span> sessionPromise
  <span class="hljs-keyword">const</span> [config, data] = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([
    configPromise,
    <span class="hljs-title function_">fetchData</span>(session.<span class="hljs-property">user</span>.<span class="hljs-property">id</span>)
  ])
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Response</span>.<span class="hljs-title function_">json</span>({ data, config })
}
</code></pre>
<p>对于具有更复杂依赖链的操作，使用 <code>better-all</code> 自动最大化并行性（参见"基于依赖的并行化"）。</p>
<h4 data-id="heading-7">1.4 对独立操作使用 Promise.all()</h4>
<p><strong>影响力: 关键 (2-10倍 提升)</strong></p>
<p>当异步操作没有相互依赖关系时，使用 <code>Promise.all()</code> 并发执行它们。</p>
<p><strong>错误：顺序执行，3 次往返</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchUser</span>()
<span class="hljs-keyword">const</span> posts = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchPosts</span>()
<span class="hljs-keyword">const</span> comments = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchComments</span>()
</code></pre>
<p><strong>正确：并行执行，1 次往返</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> [user, posts, comments] = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([
  <span class="hljs-title function_">fetchUser</span>(),
  <span class="hljs-title function_">fetchPosts</span>(),
  <span class="hljs-title function_">fetchComments</span>()
])
</code></pre>
<h4 data-id="heading-8">1.5 策略性 Suspense 边界</h4>
<p><strong>影响力: 高 (更快的首次绘制)</strong></p>
<p>不要在异步组件中等待数据后再返回 JSX，而是使用 Suspense 边界在数据加载时更快地显示包装器 UI。</p>
<p><strong>错误：包装器被数据获取阻塞</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Page</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchData</span>() <span class="hljs-comment">// 阻塞整个页面</span>
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Sidebar<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Header<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">DataDisplay</span> <span class="hljs-attr">data</span>=<span class="hljs-string">{data}</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Footer<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<p>即便只有中间部分需要数据，整个布局也会等待数据。</p>
<p><strong>正确：包装器立即显示，数据流式传输</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Page</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Sidebar<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Header<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">Skeleton</span> /&gt;</span>}&gt;
          <span class="hljs-tag">&lt;<span class="hljs-name">DataDisplay</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Footer<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">DataDisplay</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchData</span>() <span class="hljs-comment">// 仅阻塞此组件</span>
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{data.content}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
}
</code></pre>
<p>Sidebar、Header 和 Footer 立即渲染。只有 DataDisplay 等待数据。</p>
<p><strong>替代方案：在组件间共享 promise</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Page</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 立即开始获取，但不要 await</span>
  <span class="hljs-keyword">const</span> dataPromise = <span class="hljs-title function_">fetchData</span>()
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Sidebar<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Header<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">Skeleton</span> /&gt;</span>}&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">DataDisplay</span> <span class="hljs-attr">dataPromise</span>=<span class="hljs-string">{dataPromise}</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">DataSummary</span> <span class="hljs-attr">dataPromise</span>=<span class="hljs-string">{dataPromise}</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Footer<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">DataDisplay</span>(<span class="hljs-params">{ dataPromise }: { dataPromise: <span class="hljs-built_in">Promise</span>&lt;Data&gt; }</span>) {
  <span class="hljs-keyword">const</span> data = <span class="hljs-title function_">use</span>(dataPromise) <span class="hljs-comment">// 解包 promise</span>
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{data.content}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">DataSummary</span>(<span class="hljs-params">{ dataPromise }: { dataPromise: <span class="hljs-built_in">Promise</span>&lt;Data&gt; }</span>) {
  <span class="hljs-keyword">const</span> data = <span class="hljs-title function_">use</span>(dataPromise) <span class="hljs-comment">// 复用同一个 promise</span>
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{data.summary}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
}
</code></pre>
<p>两个组件共享同一个 promise，因此只会进行一次获取。布局立即渲染，而两个组件一起等待。</p>
<p><strong>何时不使用此模式：</strong></p>
<ul>
<li>
<p>布局决策所需的关键数据（影响定位）</p>
</li>
<li>
<p>首屏（Above the fold）的 SEO 关键内容</p>
</li>
<li>
<p>Suspense 开销不值得的小型快速查询</p>
</li>
<li>
<p>当你想要避免布局偏移（加载中 → 内容跳动）时</p>
</li>
</ul>
<p><strong>权衡：</strong> 更快的首次绘制 vs 潜在的布局偏移。根据你的 UX 优先级进行选择。</p>
<hr/>
<h3 data-id="heading-9">2. 打包体积优化</h3>
<p><strong>影响力: 关键</strong></p>
<p>减少初始打包体积可以改善可交互时间 (TTI) 和最大内容绘制 (LCP)。</p>
<h4 data-id="heading-10">2.1 避免 Barrel 文件导入</h4>
<p><strong>影响力: 关键 (200-800ms 导入成本, 缓慢的构建)</strong></p>
<p>直接从源文件导入而不是从 Barrel 文件导入，以避免加载数千个未使用的模块。<strong>Barrel 文件</strong>是重新导出多个模块的入口点（例如，执行 <code>export * from './module'</code> 的 <code>index.js</code>）。</p>
<p>流行的图标和组件库在其入口文件中可能有 <strong>多达 10,000 个重导出</strong>。对于许多 React 包，<strong>仅导入它们就需要 200-800ms</strong>，这会影响开发速度和生产环境的冷启动。</p>
<p><strong>为什么 tree-shaking 没有帮助：</strong> 当库被标记为外部（不打包）时，打包器无法对其进行优化。如果你将其打包以启用 tree-shaking，分析整个模块图会导致构建变得非常缓慢。</p>
<p><strong>错误：导入整个库</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Check</span>, X, <span class="hljs-title class_">Menu</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'lucide-react'</span>
<span class="hljs-comment">// 加载 1,583 个模块，开发环境额外耗时 ~2.8s</span>
<span class="hljs-comment">// 运行时成本：每次冷启动 200-800ms</span>

<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Button</span>, <span class="hljs-title class_">TextField</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@mui/material'</span>
<span class="hljs-comment">// 加载 2,225 个模块，开发环境额外耗时 ~4.2s</span>
</code></pre>
<p><strong>正确：仅导入你需要的内容</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Check</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'lucide-react/dist/esm/icons/check'</span>
<span class="hljs-keyword">import</span> X <span class="hljs-keyword">from</span> <span class="hljs-string">'lucide-react/dist/esm/icons/x'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Menu</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'lucide-react/dist/esm/icons/menu'</span>
<span class="hljs-comment">// 仅加载 3 个模块 (~2KB vs ~1MB)</span>

<span class="hljs-keyword">import</span> <span class="hljs-title class_">Button</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@mui/material/Button'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">TextField</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@mui/material/TextField'</span>
<span class="hljs-comment">// 仅加载你使用的内容</span>
</code></pre>
<p><strong>替代方案：Next.js 13.5+</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// next.config.js - 使用 optimizePackageImports</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">experimental</span>: {
    <span class="hljs-attr">optimizePackageImports</span>: [<span class="hljs-string">'lucide-react'</span>, <span class="hljs-string">'@mui/material'</span>]
  }
}

<span class="hljs-comment">// 这样你可以保留符合人体工程学的 Barrel 导入：</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Check</span>, X, <span class="hljs-title class_">Menu</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'lucide-react'</span>
<span class="hljs-comment">// 在构建时自动转换为直接导入</span>
</code></pre>
<p>直接导入可提供 15-70% 更快的开发启动速度，28% 更快的构建速度，40% 更快的冷启动速度，以及显著更快的 HMR。</p>
<p>受影响的常见库：<code>lucide-react</code>, <code>@mui/material</code>, <code>@mui/icons-material</code>, <code>@tabler/icons-react</code>, <code>react-icons</code>, <code>@headlessui/react</code>, <code>@radix-ui/react-*</code>, <code>lodash</code>, <code>ramda</code>, <code>date-fns</code>, <code>rxjs</code>, <code>react-use</code>。</p>
<p>参考: <a href="https://link.juejin.cn?target=https%3A%2F%2Fvercel.com%2Fblog%2Fhow-we-optimized-package-imports-in-next-js" target="_blank" title="https://vercel.com/blog/how-we-optimized-package-imports-in-next-js" ref="nofollow noopener noreferrer">vercel.com/blog/how-we…</a></p>
<h4 data-id="heading-11">2.2 条件模块加载</h4>
<p><strong>影响力: 高 (仅在需要时加载大数据)</strong></p>
<p>仅在功能激活时加载大数据或模块。</p>
<p><strong>例子：懒加载动画帧</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">AnimationPlayer</span>(<span class="hljs-params">{ enabled }: { enabled: <span class="hljs-built_in">boolean</span> }</span>) {
  <span class="hljs-keyword">const</span> [frames, setFrames] = useState&lt;<span class="hljs-title class_">Frame</span>[] | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>)

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (enabled &amp;&amp; !frames &amp;&amp; <span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span> !== <span class="hljs-string">'undefined'</span>) {
      <span class="hljs-keyword">import</span>(<span class="hljs-string">'./animation-frames.js'</span>)
        .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">mod</span> =&gt;</span> <span class="hljs-title function_">setFrames</span>(mod.<span class="hljs-property">frames</span>))
        .<span class="hljs-title function_">catch</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">setEnabled</span>(<span class="hljs-literal">false</span>))
    }
  }, [enabled, frames])

  <span class="hljs-keyword">if</span> (!frames) <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Skeleton</span> /&gt;</span></span>
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Canvas</span> <span class="hljs-attr">frames</span>=<span class="hljs-string">{frames}</span> /&gt;</span></span>
}
</code></pre>
<p><code>typeof window !== 'undefined'</code> 检查可防止在 SSR 时打包此模块，从而优化服务端包体积和构建速度。</p>
<h4 data-id="heading-12">2.3 推迟非关键第三方库</h4>
<p><strong>影响力: 中 (水合后加载)</strong></p>
<p>分析、日志记录和错误跟踪不会阻塞用户交互。应当在水合（Hydration）之后加载它们。</p>
<p><strong>错误：阻塞初始包</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Analytics</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@vercel/analytics/react'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">RootLayout</span>(<span class="hljs-params">{ children }</span>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
        {children}
        <span class="hljs-tag">&lt;<span class="hljs-name">Analytics</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span>
  )
}
</code></pre>
<p><strong>正确：水合后加载</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> dynamic <span class="hljs-keyword">from</span> <span class="hljs-string">'next/dynamic'</span>

<span class="hljs-keyword">const</span> <span class="hljs-title class_">Analytics</span> = <span class="hljs-title function_">dynamic</span>(
  <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@vercel/analytics/react'</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">m</span> =&gt;</span> m.<span class="hljs-property">Analytics</span>),
  { <span class="hljs-attr">ssr</span>: <span class="hljs-literal">false</span> }
)

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">RootLayout</span>(<span class="hljs-params">{ children }</span>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
        {children}
        <span class="hljs-tag">&lt;<span class="hljs-name">Analytics</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span>
  )
}
</code></pre>
<h4 data-id="heading-13">2.4 重型组件动态导入</h4>
<p><strong>影响力: 关键 (直接影响 TTI 和 LCP)</strong></p>
<p>使用 <code>next/dynamic</code> 懒加载初始渲染不需要的大型组件。</p>
<p><strong>错误：Monaco 随主 chunk 打包 ~300KB</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">MonacoEditor</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./monaco-editor'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">CodePanel</span>(<span class="hljs-params">{ code }: { code: <span class="hljs-built_in">string</span> }</span>) {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">MonacoEditor</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{code}</span> /&gt;</span></span>
}
</code></pre>
<p><strong>正确：Monaco 按需加载</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> dynamic <span class="hljs-keyword">from</span> <span class="hljs-string">'next/dynamic'</span>

<span class="hljs-keyword">const</span> <span class="hljs-title class_">MonacoEditor</span> = <span class="hljs-title function_">dynamic</span>(
  <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./monaco-editor'</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">m</span> =&gt;</span> m.<span class="hljs-property">MonacoEditor</span>),
  { <span class="hljs-attr">ssr</span>: <span class="hljs-literal">false</span> }
)

<span class="hljs-keyword">function</span> <span class="hljs-title function_">CodePanel</span>(<span class="hljs-params">{ code }: { code: <span class="hljs-built_in">string</span> }</span>) {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">MonacoEditor</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{code}</span> /&gt;</span></span>
}
</code></pre>
<h4 data-id="heading-14">2.5 基于用户意图预加载</h4>
<p><strong>影响力: 中 (减少感知延迟)</strong></p>
<p>在需要之前预加载繁重的包，以减少感知延迟。</p>
<p><strong>例子：悬停/聚焦时预加载</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">EditorButton</span>(<span class="hljs-params">{ onClick }: { onClick: () =&gt; <span class="hljs-built_in">void</span> }</span>) {
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">preload</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span> !== <span class="hljs-string">'undefined'</span>) {
      <span class="hljs-built_in">void</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./monaco-editor'</span>)
    }
  }

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span>
      <span class="hljs-attr">onMouseEnter</span>=<span class="hljs-string">{preload}</span>
      <span class="hljs-attr">onFocus</span>=<span class="hljs-string">{preload}</span>
      <span class="hljs-attr">onClick</span>=<span class="hljs-string">{onClick}</span>
    &gt;</span>
      打开编辑器
    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
  )
}
</code></pre>
<p><strong>例子：当功能标志启用时预加载</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">FlagsProvider</span>(<span class="hljs-params">{ children, flags }: Props</span>) {
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (flags.<span class="hljs-property">editorEnabled</span> &amp;&amp; <span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span> !== <span class="hljs-string">'undefined'</span>) {
      <span class="hljs-built_in">void</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./monaco-editor'</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">mod</span> =&gt;</span> mod.<span class="hljs-title function_">init</span>())
    }
  }, [flags.<span class="hljs-property">editorEnabled</span>])

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">FlagsContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{flags}</span>&gt;</span>
    {children}
  <span class="hljs-tag">&lt;/<span class="hljs-name">FlagsContext.Provider</span>&gt;</span></span>
}
</code></pre>
<p><code>typeof window !== 'undefined'</code> 检查可防止在 SSR 时打包预加载模块，从而优化服务端包体积和构建速度。</p>
<hr/>
<h3 data-id="heading-15">3. 服务端性能</h3>
<p><strong>影响力: 高</strong></p>
<p>优化服务端渲染和数据获取可消除服务端瀑布流并减少响应时间。</p>
<h4 data-id="heading-16">3.1 跨请求 LRU 缓存</h4>
<p><strong>影响力: 高 (跨请求缓存)</strong></p>
<p><code>React.cache()</code> 仅在一个请求内有效。对于跨连续请求共享的数据（用户点击按钮 A 然后点击按钮 B），请使用 LRU 缓存。</p>
<p><strong>实现：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">LRUCache</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'lru-cache'</span>

<span class="hljs-keyword">const</span> cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LRUCache</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;({
  <span class="hljs-attr">max</span>: <span class="hljs-number">1000</span>,
  <span class="hljs-attr">ttl</span>: <span class="hljs-number">5</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>  <span class="hljs-comment">// 5 分钟</span>
})

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getUser</span>(<span class="hljs-params">id: <span class="hljs-built_in">string</span></span>) {
  <span class="hljs-keyword">const</span> cached = cache.<span class="hljs-title function_">get</span>(id)
  <span class="hljs-keyword">if</span> (cached) <span class="hljs-keyword">return</span> cached

  <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> db.<span class="hljs-property">user</span>.<span class="hljs-title function_">findUnique</span>({ <span class="hljs-attr">where</span>: { id } })
  cache.<span class="hljs-title function_">set</span>(id, user)
  <span class="hljs-keyword">return</span> user
}

<span class="hljs-comment">// 请求 1: DB 查询, 结果被缓存</span>
<span class="hljs-comment">// 请求 2: 缓存命中, 无 DB 查询</span>
</code></pre>
<p>当顺序的用户操作在几秒钟内命中多个需要相同数据的端点时，请使用此方法。</p>
<p><strong>配合 Vercel 的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fvercel.com%2Fdocs%2Ffluid-compute" target="_blank" title="https://vercel.com/docs/fluid-compute" ref="nofollow noopener noreferrer">Fluid Compute</a>：</strong> LRU 缓存特别有效，因为多个并发请求可以共享同一个函数实例和缓存。这意味着缓存可以跨请求持久化，而无需 Redis 等外部存储。</p>
<p><strong>在传统 Serverless 中：</strong> 每次调用都是隔离运行的，因此请考虑使用 Redis 进行跨进而缓存。</p>
<p>参考: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fisaacs%2Fnode-lru-cache" target="_blank" title="https://github.com/isaacs/node-lru-cache" ref="nofollow noopener noreferrer">github.com/isaacs/node…</a></p>
<h4 data-id="heading-17">3.2 最小化 RSC 边界序列化</h4>
<p><strong>影响力: 高 (减少传输数据大小)</strong></p>
<p>React Server/Client 边界会将所有对象属性序列化为字符串，并将它们嵌入到 HTML 响应和后续的 RSC 请求中。此序列化数据直接影响页面重量和加载时间，因此 <strong>大小非常重要</strong>。仅传递客户端实际使用的字段。</p>
<p><strong>错误：序列化所有 50 个字段</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Page</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchUser</span>()  <span class="hljs-comment">// 50 个字段</span>
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Profile</span> <span class="hljs-attr">user</span>=<span class="hljs-string">{user}</span> /&gt;</span></span>
}

<span class="hljs-string">'use client'</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Profile</span>(<span class="hljs-params">{ user }: { user: User }</span>) {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{user.name}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>  <span class="hljs-comment">// 使用 1 个字段</span>
}
</code></pre>
<p><strong>正确：仅序列化 1 个字段</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Page</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchUser</span>()
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Profile</span> <span class="hljs-attr">name</span>=<span class="hljs-string">{user.name}</span> /&gt;</span></span>
}

<span class="hljs-string">'use client'</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Profile</span>(<span class="hljs-params">{ name }: { name: <span class="hljs-built_in">string</span> }</span>) {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{name}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
}
</code></pre>
<h4 data-id="heading-18">3.3 通过组件组合并行获取数据</h4>
<p><strong>影响力: 关键 (消除服务端瀑布流)</strong></p>
<p>React Server Components 在树中顺序执行。使用组合重构以并行化数据获取。</p>
<p><strong>错误：Sidebar 等待 Page 的 fetch 完成</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Page</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> header = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchHeader</span>()
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{header}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Sidebar</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Sidebar</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> items = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchSidebarItems</span>()
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">nav</span>&gt;</span>{items.map(renderItem)}<span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span></span>
}
</code></pre>
<p><strong>正确：两者同时获取</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Header</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchHeader</span>()
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{data}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
}

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Sidebar</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> items = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchSidebarItems</span>()
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">nav</span>&gt;</span>{items.map(renderItem)}<span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span></span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Page</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Header</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Sidebar</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<p><strong>使用 children prop 的替代方案：</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Layout</span>(<span class="hljs-params">{ children }: { children: ReactNode }</span>) {
  <span class="hljs-keyword">const</span> header = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchHeader</span>()
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{header}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      {children}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Sidebar</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> items = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchSidebarItems</span>()
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">nav</span>&gt;</span>{items.map(renderItem)}<span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span></span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Page</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Layout</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Sidebar</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Layout</span>&gt;</span></span>
  )
}
</code></pre>
<h4 data-id="heading-19">3.4 使用 React.cache() 进行按请求去重</h4>
<p><strong>影响力: 中 (请求内去重)</strong></p>
<p>使用 <code>React.cache()</code> 进行服务端请求去重。身份验证和数据库查询受益最大。</p>
<p><strong>用法：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { cache } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> getCurrentUser = <span class="hljs-title function_">cache</span>(<span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">const</span> session = <span class="hljs-keyword">await</span> <span class="hljs-title function_">auth</span>()
  <span class="hljs-keyword">if</span> (!session?.<span class="hljs-property">user</span>?.<span class="hljs-property">id</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> db.<span class="hljs-property">user</span>.<span class="hljs-title function_">findUnique</span>({
    <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: session.<span class="hljs-property">user</span>.<span class="hljs-property">id</span> }
  })
})
</code></pre>
<p>在单个请求中，对 <code>getCurrentUser()</code> 的多次调用只会执行一次查询。</p>
<h4 data-id="heading-20">3.5 使用 after() 处理非阻塞操作</h4>
<p><strong>影响力: 中 (更快的响应时间)</strong></p>
<p>使用 Next.js 的 <code>after()</code> 来调度应在发送响应后执行的工作。这可以防止日志记录、分析和其他副作用阻塞响应。</p>
<p><strong>错误：阻塞响应</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { logUserAction } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/app/utils'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">POST</span>(<span class="hljs-params">request: Request</span>) {
  <span class="hljs-comment">// 执行变更</span>
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">updateDatabase</span>(request)
  
  <span class="hljs-comment">// 日志记录阻塞了响应</span>
  <span class="hljs-keyword">const</span> userAgent = request.<span class="hljs-property">headers</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'user-agent'</span>) || <span class="hljs-string">'unknown'</span>
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">logUserAction</span>({ userAgent })
  
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">status</span>: <span class="hljs-string">'success'</span> }), {
    <span class="hljs-attr">status</span>: <span class="hljs-number">200</span>,
    <span class="hljs-attr">headers</span>: { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> }
  })
}
</code></pre>
<p><strong>正确：非阻塞</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { after } <span class="hljs-keyword">from</span> <span class="hljs-string">'next/server'</span>
<span class="hljs-keyword">import</span> { headers, cookies } <span class="hljs-keyword">from</span> <span class="hljs-string">'next/headers'</span>
<span class="hljs-keyword">import</span> { logUserAction } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/app/utils'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">POST</span>(<span class="hljs-params">request: Request</span>) {
  <span class="hljs-comment">// 执行变更</span>
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">updateDatabase</span>(request)
  
  <span class="hljs-comment">// 响应发送后记录日志</span>
  <span class="hljs-title function_">after</span>(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> userAgent = (<span class="hljs-keyword">await</span> <span class="hljs-title function_">headers</span>()).<span class="hljs-title function_">get</span>(<span class="hljs-string">'user-agent'</span>) || <span class="hljs-string">'unknown'</span>
    <span class="hljs-keyword">const</span> sessionCookie = (<span class="hljs-keyword">await</span> <span class="hljs-title function_">cookies</span>()).<span class="hljs-title function_">get</span>(<span class="hljs-string">'session-id'</span>)?.<span class="hljs-property">value</span> || <span class="hljs-string">'anonymous'</span>
    
    <span class="hljs-title function_">logUserAction</span>({ sessionCookie, userAgent })
  })
  
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">status</span>: <span class="hljs-string">'success'</span> }), {
    <span class="hljs-attr">status</span>: <span class="hljs-number">200</span>,
    <span class="hljs-attr">headers</span>: { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> }
  })
}
</code></pre>
<p>响应立即发送，而日志记录在后台发生。</p>
<p><strong>常见用例：</strong></p>
<ul>
<li>
<p>分析跟踪</p>
</li>
<li>
<p>审计日志</p>
</li>
<li>
<p>发送通知</p>
</li>
<li>
<p>缓存失效</p>
</li>
<li>
<p>清理任务</p>
</li>
</ul>
<p><strong>重要说明：</strong></p>
<ul>
<li>
<p>即使响应失败或重定向，<code>after()</code> 也会运行</p>
</li>
<li>
<p>适用于 Server Actions、Route Handlers 和 Server Components</p>
</li>
</ul>
<p>参考: <a href="https://link.juejin.cn?target=https%3A%2F%2Fnextjs.org%2Fdocs%2Fapp%2Fapi-reference%2Ffunctions%2Fafter" target="_blank" title="https://nextjs.org/docs/app/api-reference/functions/after" ref="nofollow noopener noreferrer">nextjs.org/docs/app/ap…</a></p>
<hr/>
<h3 data-id="heading-21">4. 客户端数据获取</h3>
<p><strong>影响力: 中高</strong></p>
<p>自动去重和高效的数据获取模式减少了多余的网络请求。</p>
<h4 data-id="heading-22">4.1 去重全局事件监听器</h4>
<p><strong>影响力: 低 (N 个组件共用单个监听器)</strong></p>
<p>使用 <code>useSWRSubscription()</code> 在组件实例之间共享全局事件监听器。</p>
<p><strong>错误：N 个实例 = N 个监听器</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">useKeyboardShortcut</span>(<span class="hljs-params">key: <span class="hljs-built_in">string</span>, callback: () =&gt; <span class="hljs-built_in">void</span></span>) {
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handler</span> = (<span class="hljs-params">e: KeyboardEvent</span>) =&gt; {
      <span class="hljs-keyword">if</span> (e.<span class="hljs-property">metaKey</span> &amp;&amp; e.<span class="hljs-property">key</span> === key) {
        <span class="hljs-title function_">callback</span>()
      }
    }
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'keydown'</span>, handler)
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'keydown'</span>, handler)
  }, [key, callback])
}
</code></pre>
<p>当多次使用 <code>useKeyboardShortcut</code> 钩子时，每个实例都会注册一个新的监听器。</p>
<p><strong>正确：N 个实例 = 1 个监听器</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> useSWRSubscription <span class="hljs-keyword">from</span> <span class="hljs-string">'swr/subscription'</span>

<span class="hljs-comment">// 模块级 Map 跟踪每个键的回调</span>
<span class="hljs-keyword">const</span> keyCallbacks = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Set</span>&lt;<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>&gt;&gt;()

<span class="hljs-keyword">function</span> <span class="hljs-title function_">useKeyboardShortcut</span>(<span class="hljs-params">key: <span class="hljs-built_in">string</span>, callback: () =&gt; <span class="hljs-built_in">void</span></span>) {
  <span class="hljs-comment">// 在 Map 中注册此回调</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (!keyCallbacks.<span class="hljs-title function_">has</span>(key)) {
      keyCallbacks.<span class="hljs-title function_">set</span>(key, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>())
    }
    keyCallbacks.<span class="hljs-title function_">get</span>(key)!.<span class="hljs-title function_">add</span>(callback)

    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">const</span> set = keyCallbacks.<span class="hljs-title function_">get</span>(key)
      <span class="hljs-keyword">if</span> (set) {
        set.<span class="hljs-title function_">delete</span>(callback)
        <span class="hljs-keyword">if</span> (set.<span class="hljs-property">size</span> === <span class="hljs-number">0</span>) {
          keyCallbacks.<span class="hljs-title function_">delete</span>(key)
        }
      }
    }
  }, [key, callback])

  <span class="hljs-title function_">useSWRSubscription</span>(<span class="hljs-string">'global-keydown'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handler</span> = (<span class="hljs-params">e: KeyboardEvent</span>) =&gt; {
      <span class="hljs-keyword">if</span> (e.<span class="hljs-property">metaKey</span> &amp;&amp; keyCallbacks.<span class="hljs-title function_">has</span>(e.<span class="hljs-property">key</span>)) {
        keyCallbacks.<span class="hljs-title function_">get</span>(e.<span class="hljs-property">key</span>)!.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">cb</span> =&gt;</span> <span class="hljs-title function_">cb</span>())
      }
    }
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'keydown'</span>, handler)
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'keydown'</span>, handler)
  })
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Profile</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 多个快捷键将共享同一个监听器</span>
  <span class="hljs-title function_">useKeyboardShortcut</span>(<span class="hljs-string">'p'</span>, <span class="hljs-function">() =&gt;</span> { <span class="hljs-comment">/* ... */</span> }) 
  <span class="hljs-title function_">useKeyboardShortcut</span>(<span class="hljs-string">'k'</span>, <span class="hljs-function">() =&gt;</span> { <span class="hljs-comment">/* ... */</span> })
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<h4 data-id="heading-23">4.2 使用 SWR 自动去重</h4>
<p><strong>影响力: 中高 (自动去重)</strong></p>
<p>SWR 支持跨组件实例的请求去重、缓存和重新验证。</p>
<p><strong>错误：无去重，每个实例都获取</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">UserList</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [users, setUsers] = <span class="hljs-title function_">useState</span>([])
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/users'</span>)
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> r.<span class="hljs-title function_">json</span>())
      .<span class="hljs-title function_">then</span>(setUsers)
  }, [])
}
</code></pre>
<p><strong>正确：多个实例共享一个请求</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> useSWR <span class="hljs-keyword">from</span> <span class="hljs-string">'swr'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">UserList</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> { <span class="hljs-attr">data</span>: users } = <span class="hljs-title function_">useSWR</span>(<span class="hljs-string">'/api/users'</span>, fetcher)
}
</code></pre>
<p><strong>对于不可变数据：</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { useImmutableSWR } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/lib/swr'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">StaticContent</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> { data } = <span class="hljs-title function_">useImmutableSWR</span>(<span class="hljs-string">'/api/config'</span>, fetcher)
}
</code></pre>
<p><strong>对于变异 (Mutations)：</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { useSWRMutation } <span class="hljs-keyword">from</span> <span class="hljs-string">'swr/mutation'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">UpdateButton</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> { trigger } = <span class="hljs-title function_">useSWRMutation</span>(<span class="hljs-string">'/api/user'</span>, updateUser)
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> trigger()}&gt;更新<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
}
</code></pre>
<p>参考: <a href="https://link.juejin.cn?target=https%3A%2F%2Fswr.vercel.app" target="_blank" title="https://swr.vercel.app" ref="nofollow noopener noreferrer">swr.vercel.app</a></p>
<hr/>
<h3 data-id="heading-24">5. 重渲染优化</h3>
<p><strong>影响力: 中</strong></p>
<p>减少不必要的重渲染可最大限度地减少浪费的计算并提高 UI 响应能力。</p>
<h4 data-id="heading-25">5.1 推迟状态读取到使用点</h4>
<p><strong>影响力: 中 (避免不必要的订阅)</strong></p>
<p>如果你只在回调中读取动态状态（搜索参数、localStorage），则不要订阅它。</p>
<p><strong>错误：订阅所有 searchParams 更改</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ShareButton</span>(<span class="hljs-params">{ chatId }: { chatId: <span class="hljs-built_in">string</span> }</span>) {
  <span class="hljs-keyword">const</span> searchParams = <span class="hljs-title function_">useSearchParams</span>()

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleShare</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">const</span> ref = searchParams.<span class="hljs-title function_">get</span>(<span class="hljs-string">'ref'</span>)
    <span class="hljs-title function_">shareChat</span>(chatId, { ref })
  }

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleShare}</span>&gt;</span>分享<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
}
</code></pre>
<p><strong>正确：按需读取，无订阅</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ShareButton</span>(<span class="hljs-params">{ chatId }: { chatId: <span class="hljs-built_in">string</span> }</span>) {
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleShare</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">const</span> params = <span class="hljs-keyword">new</span> <span class="hljs-title class_">URLSearchParams</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">search</span>)
    <span class="hljs-keyword">const</span> ref = params.<span class="hljs-title function_">get</span>(<span class="hljs-string">'ref'</span>)
    <span class="hljs-title function_">shareChat</span>(chatId, { ref })
  }

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleShare}</span>&gt;</span>分享<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
}
</code></pre>
<h4 data-id="heading-26">5.2 提取为记忆化组件</h4>
<p><strong>影响力: 中 (启用提前返回)</strong></p>
<p>将昂贵的工作提取到记忆化 (memoized) 组件中，以便在计算及以前提前返回。</p>
<p><strong>错误：即使在加载时也计算头像</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Profile</span>(<span class="hljs-params">{ user, loading }: Props</span>) {
  <span class="hljs-keyword">const</span> avatar = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> id = <span class="hljs-title function_">computeAvatarId</span>(user)
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Avatar</span> <span class="hljs-attr">id</span>=<span class="hljs-string">{id}</span> /&gt;</span></span>
  }, [user])

  <span class="hljs-keyword">if</span> (loading) <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Skeleton</span> /&gt;</span></span>
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{avatar}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
}
</code></pre>
<p><strong>正确：加载时跳过计算</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">const</span> <span class="hljs-title class_">UserAvatar</span> = <span class="hljs-title function_">memo</span>(<span class="hljs-keyword">function</span> <span class="hljs-title function_">UserAvatar</span>(<span class="hljs-params">{ user }: { user: User }</span>) {
  <span class="hljs-keyword">const</span> id = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">computeAvatarId</span>(user), [user])
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Avatar</span> <span class="hljs-attr">id</span>=<span class="hljs-string">{id}</span> /&gt;</span></span>
})

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Profile</span>(<span class="hljs-params">{ user, loading }: Props</span>) {
  <span class="hljs-keyword">if</span> (loading) <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Skeleton</span> /&gt;</span></span>
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">UserAvatar</span> <span class="hljs-attr">user</span>=<span class="hljs-string">{user}</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<p><strong>注意：</strong> 如果你的项目启用了 <a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Flearn%2Freact-compiler" target="_blank" title="https://react.dev/learn/react-compiler" ref="nofollow noopener noreferrer">React Compiler</a>，则无需使用 <code>memo()</code> 和 <code>useMemo()</code> 进行手动记忆化。编译器会自动优化重渲染。</p>
<h4 data-id="heading-27">5.3 缩小 Effect 依赖范围</h4>
<p><strong>影响力: 低 (最小化 effect 重新运行)</strong></p>
<p>指定原始值依赖项而不是对象，以最大限度地减少 effect 的重新运行。</p>
<p><strong>错误：在任何用户字段更改时重新运行</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user.<span class="hljs-property">id</span>)
}, [user])
</code></pre>
<p><strong>正确：仅在 id 更改时重新运行</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user.<span class="hljs-property">id</span>)
}, [user.<span class="hljs-property">id</span>])
</code></pre>
<p><strong>对于派生状态，在 effect 外部计算：</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// 错误：在 width=767, 766, 765... 时运行</span>
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (width &lt; <span class="hljs-number">768</span>) {
    <span class="hljs-title function_">enableMobileMode</span>()
  }
}, [width])

<span class="hljs-comment">// 正确：仅在布尔值转换时运行</span>
<span class="hljs-keyword">const</span> isMobile = width &lt; <span class="hljs-number">768</span>
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (isMobile) {
    <span class="hljs-title function_">enableMobileMode</span>()
  }
}, [isMobile])
</code></pre>
<h4 data-id="heading-28">5.4 订阅派生状态</h4>
<p><strong>影响力: 中 (降低重渲染频率)</strong></p>
<p>订阅派生的布尔状态而不是连续值，以降低重渲染频率。</p>
<p><strong>错误：在每个像素变化时重渲染</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Sidebar</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> width = <span class="hljs-title function_">useWindowWidth</span>()  <span class="hljs-comment">// 持续更新</span>
  <span class="hljs-keyword">const</span> isMobile = width &lt; <span class="hljs-number">768</span>
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">nav</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{isMobile</span> ? '<span class="hljs-attr">mobile</span>' <span class="hljs-attr">:</span> '<span class="hljs-attr">desktop</span>'}&gt;</span>
}
</span></code></pre>
<p><strong>正确：仅在布尔值更改时重渲染</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Sidebar</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> isMobile = <span class="hljs-title function_">useMediaQuery</span>(<span class="hljs-string">'(max-width: 767px)'</span>)
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">nav</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{isMobile</span> ? '<span class="hljs-attr">mobile</span>' <span class="hljs-attr">:</span> '<span class="hljs-attr">desktop</span>'}&gt;</span>
}
</span></code></pre>
<h4 data-id="heading-29">5.5 使用函数式 setState 更新</h4>
<p><strong>影响力: 中 (防止闭包陷阱和不必要的回调重建)</strong></p>
<p>当基于当前状态值更新状态时，使用 <code>setState</code> 的函数式更新形式，而不是直接引用状态变量。这可以防止闭包陷阱 (stale closures)，消除不必要的依赖，并创建稳定的回调引用。</p>
<p><strong>错误：需要 state 作为依赖</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">TodoList</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [items, setItems] = <span class="hljs-title function_">useState</span>(initialItems)
  
  <span class="hljs-comment">// 回调必须依赖 items，在每次 items 更改时重建</span>
  <span class="hljs-keyword">const</span> addItems = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">(<span class="hljs-params">newItems: Item[]</span>) =&gt;</span> {
    <span class="hljs-title function_">setItems</span>([...items, ...newItems])
  }, [items])  <span class="hljs-comment">// ❌ items 依赖导致重建</span>
  
  <span class="hljs-comment">// 如果忘记依赖，会有闭包陷阱风险</span>
  <span class="hljs-keyword">const</span> removeItem = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">(<span class="hljs-params">id: <span class="hljs-built_in">string</span></span>) =&gt;</span> {
    <span class="hljs-title function_">setItems</span>(items.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">id</span> !== id))
  }, [])  <span class="hljs-comment">// ❌ 缺少 items 依赖 - 将使用陈旧的 items！</span>
  
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ItemsEditor</span> <span class="hljs-attr">items</span>=<span class="hljs-string">{items}</span> <span class="hljs-attr">onAdd</span>=<span class="hljs-string">{addItems}</span> <span class="hljs-attr">onRemove</span>=<span class="hljs-string">{removeItem}</span> /&gt;</span></span>
}
</code></pre>
<p>第一个回调每次 <code>items</code> 更改时都会重建，这可能会导致子组件不必要地重渲染。第二个回调有一个闭包陷阱 bug——它将始终引用初始的 <code>items</code> 值。</p>
<p><strong>正确：稳定的回调，无闭包陷阱</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">TodoList</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [items, setItems] = <span class="hljs-title function_">useState</span>(initialItems)
  
  <span class="hljs-comment">// 稳定的回调，从未重建</span>
  <span class="hljs-keyword">const</span> addItems = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">(<span class="hljs-params">newItems: Item[]</span>) =&gt;</span> {
    <span class="hljs-title function_">setItems</span>(<span class="hljs-function"><span class="hljs-params">curr</span> =&gt;</span> [...curr, ...newItems])
  }, [])  <span class="hljs-comment">// ✅ 不需要依赖</span>
  
  <span class="hljs-comment">// 始终使用最新状态，无闭包陷阱风险</span>
  <span class="hljs-keyword">const</span> removeItem = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">(<span class="hljs-params">id: <span class="hljs-built_in">string</span></span>) =&gt;</span> {
    <span class="hljs-title function_">setItems</span>(<span class="hljs-function"><span class="hljs-params">curr</span> =&gt;</span> curr.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">id</span> !== id))
  }, [])  <span class="hljs-comment">// ✅ 安全且稳定</span>
  
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ItemsEditor</span> <span class="hljs-attr">items</span>=<span class="hljs-string">{items}</span> <span class="hljs-attr">onAdd</span>=<span class="hljs-string">{addItems}</span> <span class="hljs-attr">onRemove</span>=<span class="hljs-string">{removeItem}</span> /&gt;</span></span>
}
</code></pre>
<p><strong>好处：</strong></p>
<ol>
<li>
<p><strong>稳定的回调引用</strong> - 状态更改时无需重建回调</p>
</li>
<li>
<p><strong>无闭包陷阱</strong> - 始终对最新状态值进行操作</p>
</li>
<li>
<p><strong>更少的依赖</strong> - 简化了依赖数组并减少了内存泄漏</p>
</li>
<li>
<p><strong>防止错误</strong> - 消除了 React 闭包 bug 的最常见来源</p>
</li>
</ol>
<p><strong>何时使用函数式更新：</strong></p>
<ul>
<li>
<p>任何依赖于当前状态值的 setState</p>
</li>
<li>
<p>在需要 state 的 useCallback/useMemo 内部</p>
</li>
<li>
<p>引用 state 的事件处理程序</p>
</li>
<li>
<p>更新 state 的异步操作</p>
</li>
</ul>
<p><strong>何时直接更新是可以的：</strong></p>
<ul>
<li>
<p>将 state 设置为静态值：<code>setCount(0)</code></p>
</li>
<li>
<p>仅从 props/参数设置 state：<code>setName(newName)</code></p>
</li>
<li>
<p>State 不依赖于先前的值</p>
</li>
</ul>
<p><strong>注意：</strong> 如果你的项目启用了 <a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Flearn%2Freact-compiler" target="_blank" title="https://react.dev/learn/react-compiler" ref="nofollow noopener noreferrer">React Compiler</a>，编译器可以自动优化某些情况，但仍建议使用函数式更新以确保证正确性并防止闭包陷阱 bug。</p>
<h4 data-id="heading-30">5.6 使用惰性状态初始化</h4>
<p><strong>影响力: 中 (每次渲染都浪费计算)</strong></p>
<p>将函数传递给 <code>useState</code> 用于昂贵的初始值。如果不使用函数形式，初始化程序将在每次渲染时运行，即使该值仅使用一次。</p>
<p><strong>错误：每次渲染都运行</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">FilteredList</span>(<span class="hljs-params">{ items }: { items: Item[] }</span>) {
  <span class="hljs-comment">// buildSearchIndex() 在每次渲染时运行，即使在初始化之后</span>
  <span class="hljs-keyword">const</span> [searchIndex, setSearchIndex] = <span class="hljs-title function_">useState</span>(<span class="hljs-title function_">buildSearchIndex</span>(items))
  <span class="hljs-keyword">const</span> [query, setQuery] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>)
  
  <span class="hljs-comment">// 当 query 更改时，buildSearchIndex 再次不必要地运行</span>
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">SearchResults</span> <span class="hljs-attr">index</span>=<span class="hljs-string">{searchIndex}</span> <span class="hljs-attr">query</span>=<span class="hljs-string">{query}</span> /&gt;</span></span>
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">UserProfile</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// JSON.parse 在每次渲染时运行</span>
  <span class="hljs-keyword">const</span> [settings, setSettings] = <span class="hljs-title function_">useState</span>(
    <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'settings'</span>) || <span class="hljs-string">'{}'</span>)
  )
  
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">SettingsForm</span> <span class="hljs-attr">settings</span>=<span class="hljs-string">{settings}</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">{setSettings}</span> /&gt;</span></span>
}
</code></pre>
<p><strong>正确：仅运行一次</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">FilteredList</span>(<span class="hljs-params">{ items }: { items: Item[] }</span>) {
  <span class="hljs-comment">// buildSearchIndex() 仅在初始渲染时运行</span>
  <span class="hljs-keyword">const</span> [searchIndex, setSearchIndex] = <span class="hljs-title function_">useState</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">buildSearchIndex</span>(items))
  <span class="hljs-keyword">const</span> [query, setQuery] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>)
  
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">SearchResults</span> <span class="hljs-attr">index</span>=<span class="hljs-string">{searchIndex}</span> <span class="hljs-attr">query</span>=<span class="hljs-string">{query}</span> /&gt;</span></span>
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">UserProfile</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// JSON.parse 仅在初始渲染时运行</span>
  <span class="hljs-keyword">const</span> [settings, setSettings] = <span class="hljs-title function_">useState</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> stored = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'settings'</span>)
    <span class="hljs-keyword">return</span> stored ? <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(stored) : {}
  })
  
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">SettingsForm</span> <span class="hljs-attr">settings</span>=<span class="hljs-string">{settings}</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">{setSettings}</span> /&gt;</span></span>
}
</code></pre>
<p>当从 localStorage/sessionStorage 计算初始值、构建数据结构（索引、Map）、从 DOM 读取或执行繁重的转换是，请使用惰性初始化。</p>
<p>对于简单的原始值 (<code>useState(0)</code>)、直接引用 (<code>useState(props.value)</code>) 或廉价的字面量 (<code>useState({})</code>)，函数形式是不必要的。</p>
<h4 data-id="heading-31">5.7 对非紧急更新使用 Transitions</h4>
<p><strong>影响力: 中 (保持 UI 响应及)</strong></p>
<p>将频繁的、非紧急的状态更新标记为 transitions，以保持 UI 响应能力。</p>
<p><strong>错误：每次滚动都阻塞 UI</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ScrollTracker</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [scrollY, setScrollY] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>)
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handler</span> = (<span class="hljs-params"/>) =&gt; <span class="hljs-title function_">setScrollY</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">scrollY</span>)
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'scroll'</span>, handler, { <span class="hljs-attr">passive</span>: <span class="hljs-literal">true</span> })
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'scroll'</span>, handler)
  }, [])
}
</code></pre>
<p><strong>正确：非阻塞更新</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { startTransition } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">ScrollTracker</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [scrollY, setScrollY] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>)
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handler</span> = (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-title function_">startTransition</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">setScrollY</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">scrollY</span>))
    }
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'scroll'</span>, handler, { <span class="hljs-attr">passive</span>: <span class="hljs-literal">true</span> })
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'scroll'</span>, handler)
  }, [])
}
</code></pre>
<hr/>
<h3 data-id="heading-32">6. 渲染性能</h3>
<p><strong>影响力: 中</strong></p>
<p>优化渲染过程可减少浏览器需要做的工作。</p>
<h4 data-id="heading-33">6.1 动画化 SVG 包装器而非 SVG 元素</h4>
<p><strong>影响力: 低 (启用硬件加速)</strong></p>
<p>许多浏览器不支持对 SVG 元素的 CSS3 动画进行硬件加速。将 SVG 包装在 <code>&lt;div&gt;</code> 中并对包装器进行动画处理。</p>
<p><strong>错误：直接动画化 SVG - 无硬件加速</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">LoadingSpinner</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">svg</span> 
      <span class="hljs-attr">className</span>=<span class="hljs-string">"animate-spin"</span>
      <span class="hljs-attr">width</span>=<span class="hljs-string">"24"</span> 
      <span class="hljs-attr">height</span>=<span class="hljs-string">"24"</span> 
      <span class="hljs-attr">viewBox</span>=<span class="hljs-string">"0 0 24 24"</span>
    &gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">circle</span> <span class="hljs-attr">cx</span>=<span class="hljs-string">"12"</span> <span class="hljs-attr">cy</span>=<span class="hljs-string">"12"</span> <span class="hljs-attr">r</span>=<span class="hljs-string">"10"</span> <span class="hljs-attr">stroke</span>=<span class="hljs-string">"currentColor"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span></span>
  )
}
</code></pre>
<p><strong>正确：动画化包装器 div - 硬件加速</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">LoadingSpinner</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"animate-spin"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">svg</span> 
        <span class="hljs-attr">width</span>=<span class="hljs-string">"24"</span> 
        <span class="hljs-attr">height</span>=<span class="hljs-string">"24"</span> 
        <span class="hljs-attr">viewBox</span>=<span class="hljs-string">"0 0 24 24"</span>
      &gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">circle</span> <span class="hljs-attr">cx</span>=<span class="hljs-string">"12"</span> <span class="hljs-attr">cy</span>=<span class="hljs-string">"12"</span> <span class="hljs-attr">r</span>=<span class="hljs-string">"10"</span> <span class="hljs-attr">stroke</span>=<span class="hljs-string">"currentColor"</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<p>这适用于所有 CSS 变换和过渡（<code>transform</code>, <code>opacity</code>, <code>translate</code>, <code>scale</code>, <code>rotate</code>）。包装器 div 允许浏览器使用 GPU 加速来实现更流畅的动画。</p>
<h4 data-id="heading-34">6.2 长列表使用 CSS content-visibility</h4>
<p><strong>影响力: 高 (更快的首次渲染)</strong></p>
<p>应用 <code>content-visibility: auto</code> 以推迟屏幕外渲染。</p>
<p><strong>CSS:</strong></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.message-item</span> {
  <span class="hljs-attribute">content-visibility</span>: auto;
  <span class="hljs-attribute">contain</span>-intrinsic-size: <span class="hljs-number">0</span> <span class="hljs-number">80px</span>;
}
</code></pre>
<p><strong>例子：</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">MessageList</span>(<span class="hljs-params">{ messages }: { messages: Message[] }</span>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"overflow-y-auto h-screen"</span>&gt;</span>
      {messages.map(msg =&gt; (
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{msg.id}</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"message-item"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Avatar</span> <span class="hljs-attr">user</span>=<span class="hljs-string">{msg.author}</span> /&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{msg.content}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      ))}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<p>对于 1000 条消息，浏览器会跳过 ~990 个屏幕外项目的布局/绘制（首次渲染快 10 倍）。</p>
<h4 data-id="heading-35">6.3 提升静态 JSX 元素</h4>
<p><strong>影响力: 低 (避免重新创建)</strong></p>
<p>将静态 JSX 提取到组件外部以避免重新创建。</p>
<p><strong>错误：每次渲染都重新创建元素</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">LoadingSkeleton</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"animate-pulse h-20 bg-gray-200"</span> /&gt;</span></span>
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Container</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      {loading &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">LoadingSkeleton</span> /&gt;</span>}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<p><strong>正确：复用相同元素</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">const</span> loadingSkeleton = (
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"animate-pulse h-20 bg-gray-200"</span> /&gt;</span></span>
)

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Container</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      {loading &amp;&amp; loadingSkeleton}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<p>这对于大型和静态的 SVG 节点特别有用，因为在每次渲染时重新创建它们可能会很昂贵。</p>
<p><strong>注意：</strong> 如果你的项目启用了 <a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Flearn%2Freact-compiler" target="_blank" title="https://react.dev/learn/react-compiler" ref="nofollow noopener noreferrer">React Compiler</a>，编译器会自动提升静态 JSX 元素并优化组件重渲染，使得手动提升变得不必要。</p>
<h4 data-id="heading-36">6.4 优化 SVG 精度</h4>
<p><strong>影响力: 低 (减小文件大小)</strong></p>
<p>降低 SVG 坐标精度以减小文件大小。最佳精度取决于 viewBox 大小，但在一般情况下，应考虑降低精度。</p>
<p><strong>错误：过高的精度</strong></p>
<pre><code class="hljs language-svg" lang="svg"><span class="hljs-tag">&lt;<span class="hljs-name">path</span> <span class="hljs-attr">d</span>=<span class="hljs-string">"M 10.293847 20.847362 L 30.938472 40.192837"</span> /&gt;</span>
</code></pre>
<p><strong>正确：1 位小数</strong></p>
<pre><code class="hljs language-svg" lang="svg"><span class="hljs-tag">&lt;<span class="hljs-name">path</span> <span class="hljs-attr">d</span>=<span class="hljs-string">"M 10.3 20.8 L 30.9 40.2"</span> /&gt;</span>
</code></pre>
<p><strong>使用 SVGO 自动化：</strong></p>
<pre><code class="hljs language-bash" lang="bash">npx svgo --precision=1 --multipass icon.svg
</code></pre>
<h4 data-id="heading-37">6.5 无闪烁防止水合不匹配</h4>
<p><strong>影响力: 中 (避免视觉闪烁和水合错误)</strong></p>
<p>当渲染依赖于客户端存储（localStorage, cookies）的内容时，通过注入一个同步脚本在 React 水合之前更新 DOM，以避免 SSR 中断和水合后的闪烁。</p>
<p><strong>错误：破坏 SSR</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ThemeWrapper</span>(<span class="hljs-params">{ children }: { children: ReactNode }</span>) {
  <span class="hljs-comment">// localStorage 在服务器上不可用 - 抛出错误</span>
  <span class="hljs-keyword">const</span> theme = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'theme'</span>) || <span class="hljs-string">'light'</span>
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{theme}</span>&gt;</span>
      {children}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<p>服务端渲染将失败，因为 <code>localStorage</code> 未定义。</p>
<p><strong>错误：视觉闪烁</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ThemeWrapper</span>(<span class="hljs-params">{ children }: { children: ReactNode }</span>) {
  <span class="hljs-keyword">const</span> [theme, setTheme] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">'light'</span>)
  
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// 在水合后运行 - 导致可见的闪烁</span>
    <span class="hljs-keyword">const</span> stored = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'theme'</span>)
    <span class="hljs-keyword">if</span> (stored) {
      <span class="hljs-title function_">setTheme</span>(stored)
    }
  }, [])
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{theme}</span>&gt;</span>
      {children}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<p>组件首先使用默认值（<code>light</code>）渲染，然后在水合后更新，导致不正确内容的可见闪烁。</p>
<p><strong>正确：无闪烁，无水合不匹配</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ThemeWrapper</span>(<span class="hljs-params">{ children }: { children: ReactNode }</span>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"theme-wrapper"</span>&gt;</span>
        {children}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">script</span>
        <span class="hljs-attr">dangerouslySetInnerHTML</span>=<span class="hljs-string">{{</span>
          <span class="hljs-attr">__html:</span> `
            (<span class="hljs-attr">function</span>() {
              <span class="hljs-attr">try</span> {
                <span class="hljs-attr">var</span> <span class="hljs-attr">theme</span> = <span class="hljs-string">localStorage.getItem(</span>'<span class="hljs-attr">theme</span>') || '<span class="hljs-attr">light</span>';
                <span class="hljs-attr">var</span> <span class="hljs-attr">el</span> = <span class="hljs-string">document.getElementById(</span>'<span class="hljs-attr">theme-wrapper</span>');
                <span class="hljs-attr">if</span> (<span class="hljs-attr">el</span>) <span class="hljs-attr">el.className</span> = <span class="hljs-string">theme;</span>
              } <span class="hljs-attr">catch</span> (<span class="hljs-attr">e</span>) {}
            })();
          `,
        }}
      /&gt;</span><span class="xml">
    <span class="hljs-tag">&lt;/&gt;</span></span></span>
  )
}
</code></pre>
<p>内联脚本在显示元素之前同步执行，确保 DOM 已经具有正确的值。无闪烁，无水合不匹配。</p>
<p>此模式对于主题切换、用户偏好、身份验证状态以及任何应立即渲染而不闪烁默认值的仅客户端数据特别有用。</p>
<h4 data-id="heading-38">6.6 使用 Activity 组件进行显示/隐藏</h4>
<p><strong>影响力: 中 (保留状态/DOM)</strong></p>
<p>使用 React 的 <code>&lt;Activity&gt;</code> 来为频繁切换可见性的昂贵组件保留状态/DOM。</p>
<p><strong>用法：</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Activity</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Dropdown</span>(<span class="hljs-params">{ isOpen }: Props</span>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Activity</span> <span class="hljs-attr">mode</span>=<span class="hljs-string">{isOpen</span> ? '<span class="hljs-attr">visible</span>' <span class="hljs-attr">:</span> '<span class="hljs-attr">hidden</span>'}&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">ExpensiveMenu</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Activity</span>&gt;</span></span>
  )
}
</code></pre>
<p>避免昂贵的重渲染和状态丢失。</p>
<h4 data-id="heading-39">6.7 使用显式条件渲染</h4>
<p><strong>影响力: 低 (防止渲染 0 或 NaN)</strong></p>
<p>当条件可能为 <code>0</code>、<code>NaN</code> 或其他会渲染的假值时，使用显式三元运算符 (<code>? :</code>) 而不是 <code>&amp;&amp;</code> 进行条件渲染。</p>
<p><strong>错误：当 count 为 0 时渲染 "0"</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Badge</span>(<span class="hljs-params">{ count }: { count: <span class="hljs-built_in">number</span> }</span>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      {count &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"badge"</span>&gt;</span>{count}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}

<span class="hljs-comment">// 当 count = 0, 渲染: &lt;div&gt;0&lt;/div&gt;</span>
<span class="hljs-comment">// 当 count = 5, 渲染: &lt;div&gt;&lt;span class="badge"&gt;5&lt;/span&gt;&lt;/div&gt;</span>
</code></pre>
<p><strong>正确：当 count 为 0 时不渲染任何内容</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Badge</span>(<span class="hljs-params">{ count }: { count: <span class="hljs-built_in">number</span> }</span>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      {count &gt; 0 ? <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"badge"</span>&gt;</span>{count}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span> : null}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}

<span class="hljs-comment">// 当 count = 0, 渲染: &lt;div&gt;&lt;/div&gt;</span>
<span class="hljs-comment">// 当 count = 5, 渲染: &lt;div&gt;&lt;span class="badge"&gt;5&lt;/span&gt;&lt;/div&gt;</span>
</code></pre>
<hr/>
<h3 data-id="heading-40">7. JavaScript 性能</h3>
<p><strong>影响力: 中低</strong></p>
<p>对热路径的微优化可以累积成有意义的改进。</p>
<h4 data-id="heading-41">7.1 批量 DOM CSS 更改</h4>
<p><strong>影响力: 中 (减少重排/重绘)</strong></p>
<p>避免通过一次修改一个属性的方式更改样式。通过类或 <code>cssText</code> 将多个 CSS 更改组合在一起，以最大程度地减少浏览器重排 (reflows)。</p>
<p><strong>错误：多次重排</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">updateElementStyles</span>(<span class="hljs-params">element: HTMLElement</span>) {
  <span class="hljs-comment">// 每一行都会触发一次重排</span>
  element.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-string">'100px'</span>
  element.<span class="hljs-property">style</span>.<span class="hljs-property">height</span> = <span class="hljs-string">'200px'</span>
  element.<span class="hljs-property">style</span>.<span class="hljs-property">backgroundColor</span> = <span class="hljs-string">'blue'</span>
  element.<span class="hljs-property">style</span>.<span class="hljs-property">border</span> = <span class="hljs-string">'1px solid black'</span>
}
</code></pre>
<p><strong>正确：添加类 - 单次重排</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// CSS 文件</span>
.<span class="hljs-property">highlighted</span>-box {
  <span class="hljs-attr">width</span>: 100px;
  <span class="hljs-attr">height</span>: 200px;
  background-<span class="hljs-attr">color</span>: blue;
  <span class="hljs-attr">border</span>: 1px solid black;
}

<span class="hljs-comment">// JavaScript</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">updateElementStyles</span>(<span class="hljs-params">element: HTMLElement</span>) {
  element.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'highlighted-box'</span>)
}
</code></pre>
<p><strong>正确：改变 cssText - 单次重排</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">updateElementStyles</span>(<span class="hljs-params">element: HTMLElement</span>) {
  element.<span class="hljs-property">style</span>.<span class="hljs-property">cssText</span> = <span class="hljs-string">`
    width: 100px;
    height: 200px;
    background-color: blue;
    border: 1px solid black;
  `</span>
}
</code></pre>
<p><strong>React 例子：</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// 错误：逐个更改样式</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Box</span>(<span class="hljs-params">{ isHighlighted }: { isHighlighted: <span class="hljs-built_in">boolean</span> }</span>) {
  <span class="hljs-keyword">const</span> ref = useRef&lt;<span class="hljs-title class_">HTMLDivElement</span>&gt;(<span class="hljs-literal">null</span>)
  
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (ref.<span class="hljs-property">current</span> &amp;&amp; isHighlighted) {
      ref.<span class="hljs-property">current</span>.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-string">'100px'</span>
      ref.<span class="hljs-property">current</span>.<span class="hljs-property">style</span>.<span class="hljs-property">height</span> = <span class="hljs-string">'200px'</span>
      ref.<span class="hljs-property">current</span>.<span class="hljs-property">style</span>.<span class="hljs-property">backgroundColor</span> = <span class="hljs-string">'blue'</span>
    }
  }, [isHighlighted])
  
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{ref}</span>&gt;</span>内容<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
}

<span class="hljs-comment">// 正确：切换类</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Box</span>(<span class="hljs-params">{ isHighlighted }: { isHighlighted: <span class="hljs-built_in">boolean</span> }</span>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{isHighlighted</span> ? '<span class="hljs-attr">highlighted-box</span>' <span class="hljs-attr">:</span> ''}&gt;</span>
      内容
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<p>尽可能使用 CSS 类而不是内联样式。类会被浏览器缓存，并提供更好的关注点分离。</p>
<h4 data-id="heading-42">7.2 为重复查找构建索引 Map</h4>
<p><strong>影响力: 中低 (1M 操作 -&gt; 2K 操作)</strong></p>
<p>同一键的多次 <code>.find()</code> 调用应使用 Map。</p>
<p><strong>错误 (每次查找 O(n))：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">processOrders</span>(<span class="hljs-params">orders: Order[], users: User[]</span>) {
  <span class="hljs-keyword">return</span> orders.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">order</span> =&gt;</span> ({
    ...order,
    <span class="hljs-attr">user</span>: users.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">u</span> =&gt;</span> u.<span class="hljs-property">id</span> === order.<span class="hljs-property">userId</span>)
  }))
}
</code></pre>
<p><strong>正确 (每次查找 O(1))：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">processOrders</span>(<span class="hljs-params">orders: Order[], users: User[]</span>) {
  <span class="hljs-keyword">const</span> userById = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(users.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">u</span> =&gt;</span> [u.<span class="hljs-property">id</span>, u]))

  <span class="hljs-keyword">return</span> orders.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">order</span> =&gt;</span> ({
    ...order,
    <span class="hljs-attr">user</span>: userById.<span class="hljs-title function_">get</span>(order.<span class="hljs-property">userId</span>)
  }))
}
</code></pre>
<p>构建一次 Map (O(n))，然后所有查找都是 O(1)。</p>
<p>对于 1000 个订单 × 1000 个用户：100万次操作 → 2000 次操作。</p>
<h4 data-id="heading-43">7.3 在循环中缓存属性访问</h4>
<p><strong>影响力: 中低 (减少查找)</strong></p>
<p>在热路径中缓存对象属性查找。</p>
<p><strong>错误：3 次查找 × N 次迭代</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; arr.<span class="hljs-property">length</span>; i++) {
  <span class="hljs-title function_">process</span>(obj.<span class="hljs-property">config</span>.<span class="hljs-property">settings</span>.<span class="hljs-property">value</span>)
}
</code></pre>
<p><strong>正确：总过 1 次查找</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> value = obj.<span class="hljs-property">config</span>.<span class="hljs-property">settings</span>.<span class="hljs-property">value</span>
<span class="hljs-keyword">const</span> len = arr.<span class="hljs-property">length</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; len; i++) {
  <span class="hljs-title function_">process</span>(value)
}
</code></pre>
<h4 data-id="heading-44">7.4 缓存重复函数调用</h4>
<p><strong>影响力: 中 (避免冗余计算)</strong></p>
<p>当在渲染期间使用相同的输入重复调用相同的函数时，使用模块级 Map 缓存函数结果。</p>
<p><strong>错误：冗余计算</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ProjectList</span>(<span class="hljs-params">{ projects }: { projects: Project[] }</span>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      {projects.map(project =&gt; {
        // slugify() 对相同的项目名称调用了 100+ 次
        const slug = slugify(project.name)
        
        return <span class="hljs-tag">&lt;<span class="hljs-name">ProjectCard</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{project.id}</span> <span class="hljs-attr">slug</span>=<span class="hljs-string">{slug}</span> /&gt;</span>
      })}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<p><strong>正确：缓存结果</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 模块级缓存</span>
<span class="hljs-keyword">const</span> slugifyCache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;()

<span class="hljs-keyword">function</span> <span class="hljs-title function_">cachedSlugify</span>(<span class="hljs-params">text: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">string</span> {
  <span class="hljs-keyword">if</span> (slugifyCache.<span class="hljs-title function_">has</span>(text)) {
    <span class="hljs-keyword">return</span> slugifyCache.<span class="hljs-title function_">get</span>(text)!
  }
  <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">slugify</span>(text)
  slugifyCache.<span class="hljs-title function_">set</span>(text, result)
  <span class="hljs-keyword">return</span> result
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">ProjectList</span>(<span class="hljs-params">{ projects }: { projects: Project[] }</span>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      {projects.map(project =&gt; {
        // 每个唯一的项目名称仅计算一次
        const slug = cachedSlugify(project.name)
        
        return <span class="hljs-tag">&lt;<span class="hljs-name">ProjectCard</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{project.id}</span> <span class="hljs-attr">slug</span>=<span class="hljs-string">{slug}</span> /&gt;</span>
      })}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<p><strong>单值函数的更简单模式：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">let</span> <span class="hljs-attr">isLoggedInCache</span>: <span class="hljs-built_in">boolean</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">isLoggedIn</span>(<span class="hljs-params"/>): <span class="hljs-built_in">boolean</span> {
  <span class="hljs-keyword">if</span> (isLoggedInCache !== <span class="hljs-literal">null</span>) {
    <span class="hljs-keyword">return</span> isLoggedInCache
  }
  
  isLoggedInCache = <span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'auth='</span>)
  <span class="hljs-keyword">return</span> isLoggedInCache
}

<span class="hljs-comment">// 身份验证更改时清除缓存</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">onAuthChange</span>(<span class="hljs-params"/>) {
  isLoggedInCache = <span class="hljs-literal">null</span>
}
</code></pre>
<p>使用 Map（而不是 hook），这样它可以在任何地方工作：工具函数、事件处理程序，而不仅仅是 React 组件。</p>
<p>参考: <a href="https://link.juejin.cn?target=https%3A%2F%2Fvercel.com%2Fblog%2Fhow-we-made-the-vercel-dashboard-twice-as-fast" target="_blank" title="https://vercel.com/blog/how-we-made-the-vercel-dashboard-twice-as-fast" ref="nofollow noopener noreferrer">vercel.com/blog/how-we…</a></p>
<h4 data-id="heading-45">7.5 缓存 Storage API 调用</h4>
<p><strong>影响力: 中低 (减少昂贵的 I/O)</strong></p>
<p><code>localStorage</code>, <code>sessionStorage</code> 和 <code>document.cookie</code> 是同步且昂贵的。在内存中缓存读取。</p>
<p><strong>错误：每次调用都读取存储</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getTheme</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'theme'</span>) ?? <span class="hljs-string">'light'</span>
}
<span class="hljs-comment">// 调用 10 次 = 10 次存储读取</span>
</code></pre>
<p><strong>正确：Map 缓存</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> storageCache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>&gt;()

<span class="hljs-keyword">function</span> <span class="hljs-title function_">getLocalStorage</span>(<span class="hljs-params">key: <span class="hljs-built_in">string</span></span>) {
  <span class="hljs-keyword">if</span> (!storageCache.<span class="hljs-title function_">has</span>(key)) {
    storageCache.<span class="hljs-title function_">set</span>(key, <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(key))
  }
  <span class="hljs-keyword">return</span> storageCache.<span class="hljs-title function_">get</span>(key)
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">setLocalStorage</span>(<span class="hljs-params">key: <span class="hljs-built_in">string</span>, value: <span class="hljs-built_in">string</span></span>) {
  <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(key, value)
  storageCache.<span class="hljs-title function_">set</span>(key, value)  <span class="hljs-comment">// 保持缓存同步</span>
}
</code></pre>
<p>使用 Map（而不是 hook），这样它可以在任何地方工作：工具函数、事件处理程序，而不仅仅是 React 组件。</p>
<p><strong>Cookie 缓存：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">let</span> <span class="hljs-attr">cookieCache</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt; | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">getCookie</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span></span>) {
  <span class="hljs-keyword">if</span> (!cookieCache) {
    cookieCache = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">fromEntries</span>(
      <span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">'; '</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> c.<span class="hljs-title function_">split</span>(<span class="hljs-string">'='</span>))
    )
  }
  <span class="hljs-keyword">return</span> cookieCache[name]
}
</code></pre>
<p><strong>重要：在外部更改时失效</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'storage'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (e.<span class="hljs-property">key</span>) storageCache.<span class="hljs-title function_">delete</span>(e.<span class="hljs-property">key</span>)
})

<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'visibilitychange'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">document</span>.<span class="hljs-property">visibilityState</span> === <span class="hljs-string">'visible'</span>) {
    storageCache.<span class="hljs-title function_">clear</span>()
  }
})
</code></pre>
<p>如果存储可以在外部更改（另一个标签页、服务器设置的 cookie），请使缓存失效。</p>
<h4 data-id="heading-46">7.6合并多个数组迭代</h4>
<p><strong>影响力: 中低 (减少迭代)</strong></p>
<p>多个 <code>.filter()</code> 或 <code>.map()</code> 调用会多次迭代数组。合并为一个循环。</p>
<p><strong>错误：3 次迭代</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> admins = users.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">u</span> =&gt;</span> u.<span class="hljs-property">isAdmin</span>)
<span class="hljs-keyword">const</span> testers = users.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">u</span> =&gt;</span> u.<span class="hljs-property">isTester</span>)
<span class="hljs-keyword">const</span> inactive = users.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">u</span> =&gt;</span> !u.<span class="hljs-property">isActive</span>)
</code></pre>
<p><strong>正确：1 次迭代</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-attr">admins</span>: <span class="hljs-title class_">User</span>[] = []
<span class="hljs-keyword">const</span> <span class="hljs-attr">testers</span>: <span class="hljs-title class_">User</span>[] = []
<span class="hljs-keyword">const</span> <span class="hljs-attr">inactive</span>: <span class="hljs-title class_">User</span>[] = []

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> user <span class="hljs-keyword">of</span> users) {
  <span class="hljs-keyword">if</span> (user.<span class="hljs-property">isAdmin</span>) admins.<span class="hljs-title function_">push</span>(user)
  <span class="hljs-keyword">if</span> (user.<span class="hljs-property">isTester</span>) testers.<span class="hljs-title function_">push</span>(user)
  <span class="hljs-keyword">if</span> (!user.<span class="hljs-property">isActive</span>) inactive.<span class="hljs-title function_">push</span>(user)
}
</code></pre>
<h4 data-id="heading-47">7.7 数组比较前先检查长度</h4>
<p><strong>影响力: 中高 (避免长度不同时的昂贵操作)</strong></p>
<p>在通过昂贵操作（排序、深度相等、序列化）比较数组时，先检查长度。如果长度不同，数组就不可能相等。</p>
<p>在实际应用中，当比较运行在热路径（事件处理程序、渲染循环）中时，此优化通过尤为有价值。</p>
<p><strong>错误：总是运行昂贵的比较</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">hasChanges</span>(<span class="hljs-params">current: <span class="hljs-built_in">string</span>[], original: <span class="hljs-built_in">string</span>[]</span>) {
  <span class="hljs-comment">// 即使长度不同，也总是进行排序和连接</span>
  <span class="hljs-keyword">return</span> current.<span class="hljs-title function_">sort</span>().<span class="hljs-title function_">join</span>() !== original.<span class="hljs-title function_">sort</span>().<span class="hljs-title function_">join</span>()
}
</code></pre>
<p>即使 <code>current.length</code> 是 5 而 <code>original.length</code> 是 100，也会运行两次 O(n log n) 排序。连接数组和比较字符串也有开销。</p>
<p><strong>正确 (先进行 O(1) 长度检查)：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">hasChanges</span>(<span class="hljs-params">current: <span class="hljs-built_in">string</span>[], original: <span class="hljs-built_in">string</span>[]</span>) {
  <span class="hljs-comment">// 如果长度不同，提前返回</span>
  <span class="hljs-keyword">if</span> (current.<span class="hljs-property">length</span> !== original.<span class="hljs-property">length</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
  }
  <span class="hljs-comment">// 仅当长度匹配时才排序/连接</span>
  <span class="hljs-keyword">const</span> currentSorted = current.<span class="hljs-title function_">toSorted</span>()
  <span class="hljs-keyword">const</span> originalSorted = original.<span class="hljs-title function_">toSorted</span>()
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; currentSorted.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">if</span> (currentSorted[i] !== originalSorted[i]) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
    }
  }
  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
}
</code></pre>
<p>这种新方法更高效，因为：</p>
<ul>
<li>
<p>当长度不同时，它避免了排序和连接数组的开销</p>
</li>
<li>
<p>它避免了消耗内存来连接字符串（对于大数组尤其重要）</p>
</li>
<li>
<p>它避免了修改原始数组</p>
</li>
<li>
<p>发现差异时提前返回</p>
</li>
</ul>
<h4 data-id="heading-48">7.8 函数提前返回</h4>
<p><strong>影响力: 中低 (避免不必要的计算)</strong></p>
<p>确当定结果时提前返回，以跳过不必要的处理。</p>
<p><strong>错误：即使找到答案也处理所有项目</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">validateUsers</span>(<span class="hljs-params">users: User[]</span>) {
  <span class="hljs-keyword">let</span> hasError = <span class="hljs-literal">false</span>
  <span class="hljs-keyword">let</span> errorMessage = <span class="hljs-string">''</span>
  
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> user <span class="hljs-keyword">of</span> users) {
    <span class="hljs-keyword">if</span> (!user.<span class="hljs-property">email</span>) {
      hasError = <span class="hljs-literal">true</span>
      errorMessage = <span class="hljs-string">'Email required'</span>
    }
    <span class="hljs-keyword">if</span> (!user.<span class="hljs-property">name</span>) {
      hasError = <span class="hljs-literal">true</span>
      errorMessage = <span class="hljs-string">'Name required'</span>
    }
    <span class="hljs-comment">// 即使发现错误也继续检查所有用户</span>
  }
  
  <span class="hljs-keyword">return</span> hasError ? { <span class="hljs-attr">valid</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">error</span>: errorMessage } : { <span class="hljs-attr">valid</span>: <span class="hljs-literal">true</span> }
}
</code></pre>
<p><strong>正确：一发现错误立即返回</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">validateUsers</span>(<span class="hljs-params">users: User[]</span>) {
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> user <span class="hljs-keyword">of</span> users) {
    <span class="hljs-keyword">if</span> (!user.<span class="hljs-property">email</span>) {
      <span class="hljs-keyword">return</span> { <span class="hljs-attr">valid</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">error</span>: <span class="hljs-string">'Email required'</span> }
    }
    <span class="hljs-keyword">if</span> (!user.<span class="hljs-property">name</span>) {
      <span class="hljs-keyword">return</span> { <span class="hljs-attr">valid</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">error</span>: <span class="hljs-string">'Name required'</span> }
    }
  }

  <span class="hljs-keyword">return</span> { <span class="hljs-attr">valid</span>: <span class="hljs-literal">true</span> }
}
</code></pre>
<h4 data-id="heading-49">7.9 提升 RegExp 创建</h4>
<p><strong>影响力: 中低 (避免重新创建)</strong></p>
<p>不要在 render 内部创建 RegExp。提升到模块作用域或使用 <code>useMemo()</code> 进行记忆化。</p>
<p><strong>错误：每次渲染都创建新的 RegExp</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Highlighter</span>(<span class="hljs-params">{ text, query }: Props</span>) {
  <span class="hljs-keyword">const</span> regex = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(<span class="hljs-string">`(<span class="hljs-subst">${query}</span>)`</span>, <span class="hljs-string">'gi'</span>)
  <span class="hljs-keyword">const</span> parts = text.<span class="hljs-title function_">split</span>(regex)
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;&gt;</span>{parts.map((part, i) =&gt; ...)}<span class="hljs-tag">&lt;/&gt;</span></span>
}
</code></pre>
<p><strong>正确：记忆化或提升</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">EMAIL_REGEX</span> = <span class="hljs-regexp">/^[^\s@]+@[^\s@]+\.[^\s@]+$/</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Highlighter</span>(<span class="hljs-params">{ text, query }: Props</span>) {
  <span class="hljs-keyword">const</span> regex = <span class="hljs-title function_">useMemo</span>(
    <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(<span class="hljs-string">`(<span class="hljs-subst">${escapeRegex(query)}</span>)`</span>, <span class="hljs-string">'gi'</span>),
    [query]
  )
  <span class="hljs-keyword">const</span> parts = text.<span class="hljs-title function_">split</span>(regex)
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;&gt;</span>{parts.map((part, i) =&gt; ...)}<span class="hljs-tag">&lt;/&gt;</span></span>
}
</code></pre>
<p><strong>警告：全局 regex 具有可变状态</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> regex = <span class="hljs-regexp">/foo/g</span>
regex.<span class="hljs-title function_">test</span>(<span class="hljs-string">'foo'</span>)  <span class="hljs-comment">// true, lastIndex = 3</span>
regex.<span class="hljs-title function_">test</span>(<span class="hljs-string">'foo'</span>)  <span class="hljs-comment">// false, lastIndex = 0</span>
</code></pre>
<p>全局 regex (<code>/g</code>) 具有可变的 <code>lastIndex</code> 状态。</p>
<h4 data-id="heading-50">7.10 使用循环求最小/最大值而非排序</h4>
<p><strong>影响力: 低 (O(n) 而非 O(n log n))</strong></p>
<p>查找最小或最大元素只需要遍历数组一次。排序是浪费且更慢的。</p>
<p><strong>错误 (O(n log n) - 排序以查找最新)：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Project</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">updatedAt</span>: <span class="hljs-built_in">number</span>
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">getLatestProject</span>(<span class="hljs-params">projects: Project[]</span>) {
  <span class="hljs-keyword">const</span> sorted = [...projects].<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> b.<span class="hljs-property">updatedAt</span> - a.<span class="hljs-property">updatedAt</span>)
  <span class="hljs-keyword">return</span> sorted[<span class="hljs-number">0</span>]
}
</code></pre>
<p>仅为了查找最大值而对整个数组进行排序。</p>
<p><strong>错误 (O(n log n) - 排序以查找最旧和最新)：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getOldestAndNewest</span>(<span class="hljs-params">projects: Project[]</span>) {
  <span class="hljs-keyword">const</span> sorted = [...projects].<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a.<span class="hljs-property">updatedAt</span> - b.<span class="hljs-property">updatedAt</span>)
  <span class="hljs-keyword">return</span> { <span class="hljs-attr">oldest</span>: sorted[<span class="hljs-number">0</span>], <span class="hljs-attr">newest</span>: sorted[sorted.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>] }
}
</code></pre>
<p>仅需要最小/最大值时仍然不必要地排序。</p>
<p><strong>正确 (O(n) - 单次循环)：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getLatestProject</span>(<span class="hljs-params">projects: Project[]</span>) {
  <span class="hljs-keyword">if</span> (projects.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
  
  <span class="hljs-keyword">let</span> latest = projects[<span class="hljs-number">0</span>]
  
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt; projects.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">if</span> (projects[i].<span class="hljs-property">updatedAt</span> &gt; latest.<span class="hljs-property">updatedAt</span>) {
      latest = projects[i]
    }
  }
  
  <span class="hljs-keyword">return</span> latest
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">getOldestAndNewest</span>(<span class="hljs-params">projects: Project[]</span>) {
  <span class="hljs-keyword">if</span> (projects.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> { <span class="hljs-attr">oldest</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">newest</span>: <span class="hljs-literal">null</span> }
  
  <span class="hljs-keyword">let</span> oldest = projects[<span class="hljs-number">0</span>]
  <span class="hljs-keyword">let</span> newest = projects[<span class="hljs-number">0</span>]
  
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt; projects.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">if</span> (projects[i].<span class="hljs-property">updatedAt</span> &lt; oldest.<span class="hljs-property">updatedAt</span>) oldest = projects[i]
    <span class="hljs-keyword">if</span> (projects[i].<span class="hljs-property">updatedAt</span> &gt; newest.<span class="hljs-property">updatedAt</span>) newest = projects[i]
  }
  
  <span class="hljs-keyword">return</span> { oldest, newest }
}
</code></pre>
<p>单次遍历数组，无复制，无排序。</p>
<p><strong>替代方案：Math.min/Math.max 用于小数组</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">5</span>, <span class="hljs-number">2</span>, <span class="hljs-number">8</span>, <span class="hljs-number">1</span>, <span class="hljs-number">9</span>]
<span class="hljs-keyword">const</span> min = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(...numbers)
<span class="hljs-keyword">const</span> max = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(...numbers)
</code></pre>
<p>这对于小数组有效，但对于非常大的数组，由于展开运算符的限制，可能会更慢。为了可靠性，建议使用循环方法。</p>
<h4 data-id="heading-51">7.11 使用 Set/Map 进行 O(1) 查找</h4>
<p><strong>影响力: 中低 (O(n) -&gt; O(1))</strong></p>
<p>将数组转换为 Set/Map 以进行重复的成员身份检查。</p>
<p><strong>错误 (每次检查 O(n))：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> allowedIds = [<span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>, ...]
items.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> allowedIds.<span class="hljs-title function_">includes</span>(item.<span class="hljs-property">id</span>))
</code></pre>
<p><strong>正确 (每次检查 O(1))：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> allowedIds = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([<span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>, ...])
items.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> allowedIds.<span class="hljs-title function_">has</span>(item.<span class="hljs-property">id</span>))
</code></pre>
<h4 data-id="heading-52">7.12 使用 toSorted() 代替 sort() 以保证不可变性</h4>
<p><strong>影响力: 中高 (防止 React 状态中的变异 bug)</strong></p>
<p><code>.sort()</code> 会原地修改数组，这可能会导致 React 状态和 props 出现 bug。使用 <code>.toSorted()</code> 创建一个新的排序数组而不进行变异。</p>
<p><strong>错误：修改原始数组</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">UserList</span>(<span class="hljs-params">{ users }: { users: User[] }</span>) {
  <span class="hljs-comment">// 修改了 users prop 数组！</span>
  <span class="hljs-keyword">const</span> sorted = <span class="hljs-title function_">useMemo</span>(
    <span class="hljs-function">() =&gt;</span> users.<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a.<span class="hljs-property">name</span>.<span class="hljs-title function_">localeCompare</span>(b.<span class="hljs-property">name</span>)),
    [users]
  )
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{sorted.map(renderUser)}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
}
</code></pre>
<p><strong>正确：创建新数组</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">UserList</span>(<span class="hljs-params">{ users }: { users: User[] }</span>) {
  <span class="hljs-comment">// 创建新的排序数组，原始数组未更改</span>
  <span class="hljs-keyword">const</span> sorted = <span class="hljs-title function_">useMemo</span>(
    <span class="hljs-function">() =&gt;</span> users.<span class="hljs-title function_">toSorted</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a.<span class="hljs-property">name</span>.<span class="hljs-title function_">localeCompare</span>(b.<span class="hljs-property">name</span>)),
    [users]
  )
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{sorted.map(renderUser)}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
}
</code></pre>
<p><strong>为什么这在 React 中很重要：</strong></p>
<ol>
<li>
<p>Props/state 变异打破了 React 的不可变性模型 - React 期望 props 和 state 被视为只读</p>
</li>
<li>
<p>导致闭包陷阱 bug - 在闭包（回调、effects）内修改数组可能导致意外行为</p>
</li>
</ol>
<p><strong>浏览器支持：旧版浏览器回退</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 旧版浏览器的回退</span>
<span class="hljs-keyword">const</span> sorted = [...items].<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a.<span class="hljs-property">value</span> - b.<span class="hljs-property">value</span>)
</code></pre>
<p><code>.toSorted()</code> 在所有现代浏览器（Chrome 110+, Safari 16+, Firefox 115+, Node.js 20+）中均可用。对于旧环境，使用展开运算符。</p>
<p><strong>其他不可变数组方法：</strong></p>
<ul>
<li>
<p><code>.toSorted()</code> - 不可变排序</p>
</li>
<li>
<p><code>.toReversed()</code> - 不可变反转</p>
</li>
<li>
<p><code>.toSpliced()</code> - 不可变拼接</p>
</li>
<li>
<p><code>.with()</code> - 不可变元素替换</p>
</li>
</ul>
<hr/>
<h3 data-id="heading-53">8. 高级模式</h3>
<p><strong>影响力: 低</strong></p>
<p>针对需要谨慎实现的特定情况的高级模式。</p>
<h4 data-id="heading-54">8.1 在 Refs 中存储事件处理程序</h4>
<p><strong>影响力: 低 (稳定的订阅)</strong></p>
<p>当在不应因回调更改而重新订阅的 effect 中使用时，将回调存储在 refs 中。</p>
<p><strong>错误：每次渲染都重新订阅</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">useWindowEvent</span>(<span class="hljs-params">event: <span class="hljs-built_in">string</span>, handler: () =&gt; <span class="hljs-built_in">void</span></span>) {
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(event, handler)
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(event, handler)
  }, [event, handler])
}
</code></pre>
<p><strong>正确：稳定的订阅</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { useEffectEvent } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">useWindowEvent</span>(<span class="hljs-params">event: <span class="hljs-built_in">string</span>, handler: () =&gt; <span class="hljs-built_in">void</span></span>) {
  <span class="hljs-keyword">const</span> onEvent = <span class="hljs-title function_">useEffectEvent</span>(handler)

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(event, onEvent)
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(event, onEvent)
  }, [event])
}
</code></pre>
<p><strong>替代方案：如果你使用的是最新版 React，请使用 <code>useEffectEvent</code>：</strong></p>
<p><code>useEffectEvent</code> 为相同的模式提供了更清晰的 API：它创建一个稳定的函数引用，该引用始终调用处理程序的最新版本。</p>
<h4 data-id="heading-55">8.2 使用 useLatest 获取稳定的回调 Refs</h4>
<p><strong>影响力: 低 (防止 effect 重新运行)</strong></p>
<p>在不将值添加到依赖数组的情况下访问回调中的最新值。防止 effect 重新运行，同时避免闭包陷阱。</p>
<p><strong>实现：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> useLatest&lt;T&gt;(<span class="hljs-attr">value</span>: T) {
  <span class="hljs-keyword">const</span> ref = <span class="hljs-title function_">useRef</span>(value)
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    ref.<span class="hljs-property">current</span> = value
  }, [value])
  <span class="hljs-keyword">return</span> ref
}
</code></pre>
<p><strong>错误：在每次回调更改时重新运行 effect</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">SearchInput</span>(<span class="hljs-params">{ onSearch }: { onSearch: (q: <span class="hljs-built_in">string</span>) =&gt; <span class="hljs-built_in">void</span> }</span>) {
  <span class="hljs-keyword">const</span> [query, setQuery] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>)

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> timeout = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">onSearch</span>(query), <span class="hljs-number">300</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearTimeout</span>(timeout)
  }, [query, onSearch])
}
</code></pre>
<p><strong>正确：稳定的 effect，新鲜的回调</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">SearchInput</span>(<span class="hljs-params">{ onSearch }: { onSearch: (q: <span class="hljs-built_in">string</span>) =&gt; <span class="hljs-built_in">void</span> }</span>) {
  <span class="hljs-keyword">const</span> [query, setQuery] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>)
  <span class="hljs-keyword">const</span> onSearchRef = <span class="hljs-title function_">useLatest</span>(onSearch)

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> timeout = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> onSearchRef.<span class="hljs-title function_">current</span>(query), <span class="hljs-number">300</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearTimeout</span>(timeout)
  }, [query])
}
</code></pre>
<hr/>
<h3 data-id="heading-56">参考资料</h3>
<ol>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev" target="_blank" title="https://react.dev" ref="nofollow noopener noreferrer">react.dev</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fnextjs.org" target="_blank" title="https://nextjs.org" ref="nofollow noopener noreferrer">nextjs.org</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fswr.vercel.app" target="_blank" title="https://swr.vercel.app" ref="nofollow noopener noreferrer">swr.vercel.app</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fshuding%2Fbetter-all" target="_blank" title="https://github.com/shuding/better-all" ref="nofollow noopener noreferrer">github.com/shuding/bet…</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fisaacs%2Fnode-lru-cache" target="_blank" title="https://github.com/isaacs/node-lru-cache" ref="nofollow noopener noreferrer">github.com/isaacs/node…</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fvercel.com%2Fblog%2Fhow-we-optimized-package-imports-in-next-js" target="_blank" title="https://vercel.com/blog/how-we-optimized-package-imports-in-next-js" ref="nofollow noopener noreferrer">vercel.com/blog/how-we…</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fvercel.com%2Fblog%2Fhow-we-made-the-vercel-dashboard-twice-as-fast" target="_blank" title="https://vercel.com/blog/how-we-made-the-vercel-dashboard-twice-as-fast" ref="nofollow noopener noreferrer">vercel.com/blog/how-we…</a></li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Monorepo入门]]></title>    <link>https://juejin.cn/post/7595878718172381220</link>    <guid>https://juejin.cn/post/7595878718172381220</guid>    <pubDate>2026-01-17T16:35:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595878718172381220" data-draft-id="7593212374921117723" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Monorepo入门"/> <meta itemprop="keywords" content="前端,JavaScript,设计模式"/> <meta itemprop="datePublished" content="2026-01-17T16:35:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Hyyy"/> <meta itemprop="url" content="https://juejin.cn/user/2673667942934333"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Monorepo入门
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2673667942934333/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Hyyy
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T16:35:32.000Z" title="Sat Jan 17 2026 16:35:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. Monorepo 介绍</h2>
<blockquote>
<p>核心价值：<strong>把“需要一起演进的一组项目”放在同一个版本空间里</strong>，从而让跨项目改动（API 变更、重构、升级）能在一次提交里完成并验证</p>
</blockquote>
<p>Monorepo 是把多个相关项目/包放在同一个 Git 仓库中管理的<strong>策略</strong>，有助于跨项目联动修改、内部包共享更顺畅、统一规范与 CI、版本控制、构建和部署等方面的复杂性，并提供更好的可重用性和协作性。</p>
<p>Monorepo 提倡了开放、透明、共享的组织文化，这种方法已经被很多大型公司广泛使用，如 Google、Facebook 和 Microsoft 等。</p>
<h2 data-id="heading-1">2. Monorepo 演进</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54fbc99a045243dc845a2f3a73d80f36~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSHl5eQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769273310&amp;x-signature=N9tx7UWbYq8mCFWk19GSAD3Q5F8%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-2">2.1 阶段一：单仓库巨石应用(Monolith)</h3>
<p>初期很爽：一个仓库、一个 package.json、一个 node_modules、一个构建流程,但随着迭代业务复杂度的提升，项目代码会变得越来越多，越来越复杂，大量代码构建效率也会降低，最终导致了单体巨石应用，这种代码管理方式称之为 Monolith。</p>
<p>问题在于：业务一旦变大，就容易出现：</p>
<ul>
<li>模块边界不清晰、改动影响范围越来越大</li>
<li>构建/测试变慢</li>
<li>多人协作冲突多</li>
</ul>
<p>于是团队会自然想到：“拆开”，故此迎来阶段二。</p>
<blockquote>
<p>注意：这里的 Monolith 是“一个应用越长越大”。它和后面的 Monorepo（多个包/项目同仓）不是同一个概念。</p>
</blockquote>
<h3 data-id="heading-3">2.2 阶段二：多仓库多模块应用</h3>
<p>把系统拆成多个仓库（例如：组件库仓库、业务 A 仓库、业务 B 仓库），会带来立竿见影的收益：</p>
<ul>
<li>每个仓库更小、owner 更明确、权限更清晰</li>
<li>每个模块可以独立发版</li>
<li>单仓库的 CI 看起来更快（只跑自己的）</li>
</ul>
<p>代码管理变得简化，构建效率也得以提升，这种代码管理方式称之为 MultiRepo。</p>
<p>但当仓库越来越多，新的成本也会越来越明显：</p>
<ul>
<li><strong>联动修改很难“原子化”</strong>：改组件库 API 后，你需要发布组件库，然后业务仓库分别升级、分别修、分别跑 CI。</li>
<li><strong>版本同步链路变长</strong>：底层库升级，上层一堆仓库要跟着升级验证。</li>
<li><strong>工程配置容易漂移</strong>：eslint/tsconfig/构建脚本在多个仓库逐渐不一致，治理难度上升。</li>
</ul>
<p>这时候团队会意识到：拆仓库解决了局部自治，但放大了“协作与一致性”的成本。</p>
<h3 data-id="heading-4">2.3 阶段三：单仓库多模块应用</h3>
<p>随着业务复杂度的提升，模块仓库越来越多，MultiRepo这种方式虽然从业务上解耦了，但增加了项目工程管理的难度，随着模块仓库达到一定数量级，会有几个问题：跨仓库代码难共享；分散在单仓库的模块依赖管理复杂（底层模块升级后，其他上层依赖需要及时更新，否则有问题）；增加了构建耗时。于是将多个项目集成到一个仓库下，共享工程配置，同时又快捷地共享模块代码，成为趋势，这种代码管理方式称之为 Monorepo。</p>
<p>当“跨仓库联动成本”超过收益时，Monorepo 就变得有吸引力：</p>
<ul>
<li>改公共包 + 改所有使用方，可以在一个 PR 一次性完成并验证</li>
<li>配置集中化，工程规范更易统一</li>
<li>公共能力更容易沉淀成 packages，减少复制粘贴和重复造轮子</li>
</ul>
<p>当然，Monorepo 也不是没有代价：</p>
<ul>
<li>仓库会变大（clone、索引、IDE 负担上升）</li>
<li>如果没有“按影响范围执行（affected）+ 缓存”，CI 可能会变慢）</li>
</ul>
<h2 data-id="heading-5">3. Monorepo 优劣</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d82bbb2d96149a386ffd438a16d6aef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSHl5eQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769273310&amp;x-signature=sQWKrYZ6Na4bIob%2BAX6gUhD7B6g%3D" alt="image.png" loading="lazy"/></p>








































<table><thead><tr><th><strong>场景</strong></th><th><strong>MultiRepo</strong></th><th><strong>MonoRepo</strong></th></tr></thead><tbody><tr><td>代码可见性</td><td>✅ 代码隔离，研发者只需关注自己负责的仓库<br/> ❌ 包管理按照各自owner划分，当出现问题时，需要到依赖包中进行判断并解决。</td><td>✅ 一个仓库中多个相关项目，很容易看到整个代码库的变化趋势，更好的团队协作。 <br/>❌ 增加了非owner改动代码的风险</td></tr><tr><td>依赖管理</td><td>❌ 多个仓库都有自己的 node_modules，存在依赖重复安装情况，占用磁盘内存大。</td><td>✅ 多项目代码都在一个仓库中，相同版本依赖提升到顶层只安装一次，节省磁盘内存，</td></tr><tr><td>代码权限</td><td>✅ 各项目单独仓库，不会出现代码被误改的情况，单个项目出现问题不会影响其他项目。</td><td>❌ 多个项目代码都在一个仓库中，没有项目粒度的权限管控，一个项目出问题，可能影响所有项目。(</td></tr><tr><td>开发迭代</td><td>✅ 仓库体积小，模块划分清晰，可维护性强。 <br/>❌ 多仓库来回切换（编辑器及命令行），项目多的话效率很低。多仓库见存在依赖时，需要手动 <code>npm link</code>，操作繁琐。 <br/>❌ 依赖管理不便，多个依赖可能在多个仓库中存在不同版本，重复安装，npm link 时不同项目的依赖会存在冲突。</td><td>✅ 多个项目都在一个仓库中，可看到相关项目全貌，编码非常方便。 <br/>✅ 代码复用高，方便进行代码重构。 <br/>❌ 多项目在一个仓库中，代码体积多大几个 G，<code>git clone</code>时间较长。 <br/>✅ 依赖调试方便，依赖包迭代场景下，借助工具自动 npm link，直接使用最新版本依赖，简化了操作流程。</td></tr><tr><td>工程配置</td><td>❌ 各项目构建、打包、代码校验都各自维护，不一致时会导致代码差异或构建差异。</td><td>✅ 多项目在一个仓库，工程配置一致，代码质量标准及风格也很容易一致。</td></tr><tr><td>构建部署</td><td>❌ 多个项目间存在依赖，部署时需要手动到不同的仓库根据先后顺序去修改版本及进行部署，操作繁琐效率低。</td><td>✅ 构建性 Monorepo 工具可以配置依赖项目的构建优先级，可以实现一次命令完成所有的部署。</td></tr></tbody></table>
<h2 data-id="heading-6">4. Monorepo 场景</h2>
<p><strong>场景一</strong>：大型项目与多项目协作</p>
<ul>
<li><strong>场景</strong>：企业或团队维护多个紧密关联的项目（如前端、后端、工具库等）。</li>
<li><strong>优势</strong>：集中管理代码，方便跨项目修改和协作，避免代码分散导致的重复劳动。</li>
</ul>
<hr/>
<p><strong>场景二</strong>：共享代码与依赖</p>
<ul>
<li><strong>场景</strong>：多个项目共用组件库、工具函数或配置（如 UI 组件、通用 SDK）。</li>
<li><strong>优势</strong>：直接引用内部模块，避免多仓库的版本同步问题，确保依赖一致性。</li>
</ul>
<hr/>
<p><strong>场景三</strong>：统一构建与持续集成（CI/CD）</p>
<ul>
<li><strong>场景</strong>：需要标准化构建、测试和部署流程。</li>
<li><strong>优势</strong>：集中配置 CI/CD，仅针对变更部分触发构建（增量构建），提升效率。</li>
</ul>
<hr/>
<p><strong>何时谨慎使用？</strong></p>
<ul>
<li><strong>代码量过大</strong>：需要考虑构建性能、代码可维护性</li>
<li><strong>权限管理复杂</strong>：需细化目录权限控制</li>
<li><strong>团队独立性高</strong>：若子团队高度自治，多仓库可能更灵活</li>
</ul>
<h2 data-id="heading-7">5. Monorepo 工具</h2>
<p>在采用 Monorepo（单一仓库）架构的软件开发中，工具的选择是至关重要的。合适的 Monorepo 工具能够帮助团队更高效地管理大规模代码库、提升协同开发体验以及优化构建和部署流程。</p>
<p>直至 2026 年年初，目前在前端界比较流行的 Monorepo 工具有 <code>Pnpm Workspaces</code>、<code>Yarn Workspaces</code>、<code>npm Workspaces</code>、<code>Rush</code>、<code>Turborepo</code>、<code>Yalc</code>、和 <code>Nx</code></p>
<h3 data-id="heading-8">5.1 <strong>依赖管理工具</strong></h3>
<p><strong>没有 workspace/工具链时</strong>：A 包要用 B 包，只能 <code>npm link</code>、复制代码、或走相对/绝对路径，非常别扭且容易错。</p>
<p>负责“怎么安装依赖、怎么把 workspace 包链接起来”</p>
<p><strong>pnpm workspace 是包管理器层面的工作区能力</strong>：</p>
<ul>
<li>支持 monorepo 内部包之间用“包名”互相依赖（不是路径引用），并自动链接到本地源码</li>
<li>pnpm 有全局的内容存储（store），不同项目/不同 workspace 之间可以复用同版本依赖；再通过链接把依赖组织到各包的 node_modules 结构中。：直观效果：同一个依赖不需要在 N 个地方复制 N 份。</li>
<li>依赖安装更快、更省空间（全局 store 复用 + 链接）</li>
<li>默认依赖隔离更严格，可显著减少“幽灵依赖”</li>
</ul>
<p><strong>强烈推荐使用</strong><code>Pnpm Workspaces</code> <strong>作为 Monorepo 项目的依赖管理工具</strong>😍😍😍</p>
<ul>
<li><strong>pnpm</strong>：通过全局 store + 链接方式，通常<strong>既省空间又更严格</strong>。</li>
</ul>
<h4 data-id="heading-9">5.1.1 避免幽灵依赖</h4>
<p>npm/yarn 安装依赖时，存在依赖提升，某个项目使用的依赖，并没有在其 package.json 中声明，也可以直接使用，这种现象称之为 “幽灵依赖”；随着项目迭代，这个依赖不再被其他项目使用，不再被安装，使用幽灵依赖的项目，会因为无法找到依赖而报错，而 pnpm 彻底解决这个问题</p>
<p>所谓幽灵依赖，可以理解为：</p>
<blockquote>
<p>某个包没有在自己的 package.json 声明依赖，但因为安装结构/提升等原因，代码依然能 import 到它，直到某天依赖结构变化才突然报错。</p>
</blockquote>
<p>pnpm 默认对依赖访问更严格，能更早暴露“未声明却在使用”的问题，让错误更早出现、定位更容易。</p>
<h5 data-id="heading-10">什么是幽灵依赖</h5>
<p>先提问：你觉得“一个包能 import 某个依赖”的前提是什么？</p>
<p>正常答案应该是：</p>
<blockquote>
<p>这个包的 <code>package.json</code> 里 <strong>dependencies/devDependencies</strong> 声明了它。</p>
</blockquote>
<p>幽灵依赖就是：<strong>没声明，但居然还能 import 并运行成功</strong>。</p>
<p>最小例子（用 npm/yarn 经典安装方式更容易出现）：</p>
<p>假设是 monorepo：</p>
<ul>
<li>根 <code>package.json</code> 没有 lodash</li>
<li><code>packages/a/package.json</code> <strong>声明了</strong> <code>lodash</code></li>
<li><code>packages/b/package.json</code> <strong>没声明</strong> <code>lodash</code></li>
</ul>
<p>但在 <code>packages/b/src/index.ts</code> 里写了：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> _ <span class="hljs-keyword">from</span> <span class="hljs-string">"lodash"</span>;
</code></pre>
<p>在 <strong>npm/yarn（node_modules 提升/hoist）</strong>  的某些安装结果下，<code>lodash</code> 可能被“提升”到了更上层的 <code>node_modules</code>，导致 <code>b</code> 虽然没声明，也能“碰巧”找到 lodash，于是：</p>
<ul>
<li>开发阶段：你以为没问题</li>
<li>某天 a 删除了 lodash 或版本变化/安装结构变化：b 突然就挂了</li>
</ul>
<p>这就像：你家隔壁有个锤子，你没买但你一直去借用；直到隔壁搬家，你才发现自己其实从来没拥有它。</p>
<h5 data-id="heading-11">为什么 pnpm 更容易避免？</h5>
<p>pnpm 的默认策略更“严格”：</p>
<ul>
<li>每个 package 能访问到的依赖，基本只限于它声明的那一圈（通过链接+隔离结构实现）</li>
<li>所以 <strong>b 没声明 lodash，就更容易直接报错</strong>（这反而是好事：早发现早修）</li>
</ul>
<p>一句话总结你可以写进文章：</p>
<blockquote>
<p>幽灵依赖：<strong>未在当前包的 package.json 声明，却因为依赖提升等原因在运行时能被解析到的依赖</strong>；pnpm 通过更严格的依赖隔离，能显著减少这类问题。</p>
</blockquote>
<h4 data-id="heading-12">5.1.2 依赖安装耗时长</h4>
<p>MonoRepo 中每个项目都有自己的 package.json 依赖列表，随着 MonoRepo 中依赖总数的增长，每次 <code>install</code> 时，耗时会较长。使用 pnpm 按需安装及依赖缓存，相同版本依赖提升到 Monorepo 根目录下，减少冗余依赖安装；</p>
<p><strong>那么 Monorepo 与包管理工具（npm、yarn、pnpm）之间是一种怎样的关系？</strong></p>
<p>这些包管理工具与 monorepo 的关系在于，它们可以为 monorepo 提供依赖安装与依赖管理的支持，借助自身对 workspace 的支持，允许在 monorepo 中的不同子项目之间共享依赖项，并提供一种管理这些共享依赖项的方式，这可以简化依赖项管理和构建过程，并提高开发效率。</p>
<h4 data-id="heading-13">5.1.3 构建打包耗时长</h4>
<p><strong>问题</strong>：多个项目构建任务存在依赖时，往往是串行构建 或 全量构建，导致构建时间较长，可以使用增量构建，而非全量构建；也可以将串行构建，优化成并行构建。</p>
<p>npm、yarn、pnpm 等是用来管理项目依赖、发布包、安装依赖的工具，他们都提供了对工作区（workspace）的支持，允许在单个代码库中管理多个项目或包。这种工作区支持在单个代码库中同时开发、测试和管理多个的项目，而无需使用多个独立的代码仓库。</p>
<p>这些包管理工具与 monorepo 的关系在于他们可以为 monorepo 提供依赖安装与依赖管理的支持，借助自身对workspace的支持，允许在monorepo中的不同子项目之间共享依赖项，并提供一种管理这些共享以来想的方式，这可以简化依赖项管理和构建过程，并提高开发效率。</p>
<p>硬链接指向同一份文件数据，因此可以复用磁盘空间。</p>
<h3 data-id="heading-14">5.2 任务编排/构建系统</h3>
<p>负责“有哪些任务要跑、哪些可以并行、哪些可以跳过、结果怎么缓存复用（增量构建）”</p>
<p><strong>没有任务编排/增量构建时</strong>：一个仓库多个包，但 CI/构建经常只能全量跑，慢；发布也麻烦。</p>
<p><strong>Nx/Turborepo/Rush</strong></p>
<h2 data-id="heading-15">用一个场景立刻区分：只改了 UI 组件库，会发生什么？</h2>
<p>假设 monorepo 里有：</p>
<ul>
<li><code>packages/ui</code>（组件库）</li>
<li><code>apps/web</code>（业务）</li>
<li><code>apps/admin</code></li>
</ul>
<p>改了 <code>packages/ui/Button.tsx</code></p>
<ul>
<li><strong>pnpm workspace 会做什么？</strong><br/>
让 <code>apps/web</code> 依赖的 <code>@repo/ui</code> 指向本仓库的 ui 源码（链接），并保证依赖安装正确、边界更严格。</li>
<li><strong>turbo/nx 会做什么？</strong><br/>
计算“受影响范围”：<code>ui</code> 变了 ⇒ <code>web/admin</code> 可能都受影响<br/>
然后只跑：<code>ui build</code> + <code>web build</code> + <code>admin build</code>（而不是全仓库所有包都 build）<br/>
并且能并行、能缓存。</li>
</ul>
<h2 data-id="heading-16">6. 总结</h2>
<ul>
<li>Monorepo 并不是银弹，而是一种权衡工程管理与项目协作复杂性的最佳实践之一。适用于项目关联紧密、需频繁联动、强调一致性的中大型团队/企业。</li>
<li>通过引入现代的包管理工具（如 pnpm workspace）和任务编排系统（如 Turborepo、Nx），Monorepo 管理的优势可以最大化，同时减轻依赖和构建上的压力。</li>
<li>采用 Monorepo 可以促进团队协作、统一规范和复用代码，但也需留意仓库增大、权限细化等实际挑战。</li>
<li>是否采纳 Monorepo，需结合企业项目规模、团队协作方式、基础设施支持等多方面因素综合考量。</li>
<li>总之，合理组合工具和规范，才能真正发挥 Monorepo 的价值，为团队降本增效。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[基于 YOLOv8 的多车型交通车辆实时检测识别项目 [目标检测完整源码]]]></title>    <link>https://juejin.cn/post/7596181746061819931</link>    <guid>https://juejin.cn/post/7596181746061819931</guid>    <pubDate>2026-01-17T15:03:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596181746061819931" data-draft-id="7595808703075172378" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="基于 YOLOv8 的多车型交通车辆实时检测识别项目 [目标检测完整源码]"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-17T15:03:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="我是杰尼"/> <meta itemprop="url" content="https://juejin.cn/user/4200579899599495"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            基于 YOLOv8 的多车型交通车辆实时检测识别项目 [目标检测完整源码]
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4200579899599495/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    我是杰尼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T15:03:42.000Z" title="Sat Jan 17 2026 15:03:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">基于 YOLOv8 的多车型交通车辆实时检测识别项目 [目标检测完整源码]</h2>
<h3 data-id="heading-1">一、背景与问题引入</h3>
<p>在智慧交通体系中，“看得清、分得准、跑得快”始终是视觉感知系统的核心诉求。传统基于规则或特征工程的方法，在复杂道路环境、密集车流、多车型混行的场景下，往往存在鲁棒性不足、维护成本高的问题。</p>
<p>随着深度学习目标检测模型的成熟，<strong>YOLO 系列</strong>逐渐成为交通视觉领域的主流方案。其中，YOLOv8 以其 <strong>Anchor-Free 架构、更优的速度–精度平衡以及完善的工程生态</strong>，非常适合用于实时车辆检测与系统级落地。</p>
<p>本文将从工程实践角度，完整介绍一个 <strong>支持 12 类常见交通车辆、具备图形化界面、可直接部署运行</strong> 的实时检测系统设计与实现思路。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87e2ebe017e74133a8ad9c9618e21789~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769267022&amp;x-signature=nmxlqQ8xV453QexV5Z0sCb6%2B3dI%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h3 data-id="heading-2">源码下载与效果演示</h3>
<p>哔哩哔哩视频下方观看：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1dwg5zCEkL%2F" target="_blank" title="https://www.bilibili.com/video/BV1dwg5zCEkL/" ref="nofollow noopener noreferrer">www.bilibili.com/video/BV1dw…</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fb2ecd6f751242ca8e73eb51f14153c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769267022&amp;x-signature=5ES3RyLpsd0Sr%2B7iqCANKnqr8IU%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>包含：</p>
<p>📦完整项目源码</p>
<p>📦 预训练模型权重</p>
<p>🗂️ 数据集地址（含标注脚本</p>
<h3 data-id="heading-3">二、系统整体架构设计</h3>
<p>该系统并非仅停留在“模型推理”层面，而是以<strong>完整应用系统</strong>为目标进行设计，整体架构可划分为四个核心模块：</p>
<pre><code class="hljs language-markdown" lang="markdown">┌────────────┐
│  数据输入层 │  ← 图片 / 视频 / 摄像头 / 文件夹
└─────┬──────┘
<span class="hljs-code">      │
┌─────▼──────┐
│  检测引擎层 │  ← YOLOv8 Detection Model
└─────┬──────┘
      │
┌─────▼──────┐
│  结果处理层 │  ← NMS / 置信度过滤 / 可视化
└─────┬──────┘
      │
┌─────▼──────┐
│  UI 交互层  │  ← PyQt5 图形界面
└────────────┘
</span></code></pre>
<p>这种分层结构具备以下优势：</p>
<ul>
<li>算法与界面解耦，便于模型升级</li>
<li>输入方式可扩展（无人机、RTSP流等）</li>
<li>易于二次开发与功能叠加</li>
</ul>
<hr/>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2541c2137d9340b7b5668011d599f9e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769267022&amp;x-signature=zKcwJ6eTK3PkNCJwFObZe%2BL2V8c%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/06d8922a85684cddb9fb41fff6232b90~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769267022&amp;x-signature=ADKSDyddfx4wudkYvG3wYjHj84Q%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h3 data-id="heading-4">三、核心功能能力解析</h3>
<h4 data-id="heading-5">3.1 多源输入的统一检测流程</h4>
<p>系统支持多种数据源接入，并统一走同一套检测逻辑：</p>
<ul>
<li><strong>单张图片检测</strong>：适合离线分析与测试</li>
<li><strong>文件夹批量检测</strong>：用于数据清洗与标注校验</li>
<li><strong>视频文件检测</strong>：适配道路监控录像</li>
<li><strong>实时摄像头检测</strong>：满足在线监控需求</li>
</ul>
<p>在底层实现上，通过对输入源进行抽象封装，确保模型推理逻辑保持一致，避免重复代码。</p>
<hr/>
<h4 data-id="heading-6">3.2 多车型精细化识别</h4>
<p>本项目针对真实交通场景，定义了 <strong>12 类常见车辆类型</strong>，涵盖：</p>
<ul>
<li>轿车、SUV、面包车</li>
<li>公交车、卡车、工程车辆</li>
<li>特殊用途车辆等</li>
</ul>
<p>YOLOv8 的 Anchor-Free 机制在多尺度目标（远距离小车 / 近景大车）检测中表现稳定，有效降低漏检与误检率。</p>
<hr/>
<h4 data-id="heading-7">3.3 PyQt5 图形化交互系统</h4>
<p>为了降低系统使用门槛，引入 PyQt5 构建桌面级应用界面，核心设计原则是：</p>
<ul>
<li><strong>无需编程经验即可使用</strong></li>
<li><strong>操作路径清晰</strong></li>
<li><strong>结果可视、可保存</strong></li>
</ul>
<p>主要功能包括：</p>
<ul>
<li>输入源选择与切换</li>
<li>检测启动 / 停止控制</li>
<li>实时画面显示（带检测框）</li>
<li>检测结果自动保存</li>
</ul>
<p>这使得模型能力真正转化为“可使用的软件”，而不仅是脚本级 Demo。</p>
<hr/>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ffa5f34e85e4453882fc86cc63af347f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769267022&amp;x-signature=ZFeR%2FlQJliQZfNYaAzXYeruA5iI%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h3 data-id="heading-8">四、YOLOv8 模型训练与评估实践</h3>
<h4 data-id="heading-9">4.1 数据集组织规范</h4>
<p>项目采用标准 YOLO 数据格式，便于复用与迁移：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">dataset/
├── images/
│   ├── train
│   └── <span class="hljs-keyword">val</span>
└── labels/
    ├── train
    └── <span class="hljs-keyword">val</span>
</code></pre>
<p>标签文件采用归一化坐标，兼容 Ultralytics 官方训练接口。</p>
<hr/>
<h4 data-id="heading-10">4.2 模型训练策略</h4>
<p>训练阶段基于 YOLOv8 预训练权重进行微调，核心关注点包括：</p>
<ul>
<li><strong>box_loss</strong>：定位精度</li>
<li><strong>cls_loss</strong>：车辆类别区分能力</li>
<li><strong>dfl_loss</strong>：边框质量优化</li>
</ul>
<p>在实际项目中，当 <code>mAP@0.5</code> 稳定超过 <strong>90%</strong>，即可满足工程部署需求。</p>
<hr/>
<h4 data-id="heading-11">4.3 推理与部署方式</h4>
<p>模型推理通过 Ultralytics 官方 API 完成，具备如下特点：</p>
<ul>
<li>接口简洁，代码量少</li>
<li>支持 CPU / GPU 自适应</li>
<li>可导出 ONNX / TensorRT</li>
</ul>
<p>结合 UI 层，可直接形成“即点即检”的完整工作流。</p>
<hr/>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/34362c66872b4e30bed5fffb7d3b74df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769267022&amp;x-signature=d7OtaSjGvbqvN%2FZvjFvDrqCAfkM%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h3 data-id="heading-12">五、工程化落地与可扩展性</h3>
<p>与单纯算法实验不同，该项目在工程层面具备以下实用特性：</p>
<ul>
<li><strong>完整源码与权重打包</strong></li>
<li><strong>一行命令启动系统</strong></li>
<li><strong>训练 / 推理 / UI 全流程覆盖</strong></li>
</ul>
<p>在此基础上，可进一步拓展：</p>
<ul>
<li>车辆轨迹跟踪（DeepSORT / ByteTrack）</li>
<li>车流量统计与时间序列分析</li>
<li>多路摄像头并行检测</li>
<li>智慧交通平台对接</li>
</ul>
<hr/>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7febb44e32eb4813aaa6098a95099315~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769267022&amp;x-signature=8%2BF%2BNSBgZSBRbFw2jXU6ueAcqwI%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9935ddfd218347629e8def85c127113d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769267022&amp;x-signature=Rrta6MsLZbuDxPGcuZGC1k6au%2Fw%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h3 data-id="heading-13">六、总结与展望</h3>
<p>本文从系统视角出发，完整介绍了一套 <strong>基于 YOLOv8 的多车型交通车辆实时检测平台</strong> 的设计与实现思路。通过将高性能目标检测模型与 PyQt5 图形界面深度融合，实现了从算法能力到实际可用系统的有效转化。</p>
<p>该项目不仅适用于智慧交通与城市监控场景，也非常适合作为：</p>
<ul>
<li>计算机视觉工程实战案例</li>
<li>AI 教学与科研实验平台</li>
<li>工业级视觉系统原型</li>
</ul>
<p>随着模型与算力的持续演进，交通视觉系统将不再只是“看见车辆”，而是逐步走向 <strong>理解交通、预测交通、优化交通</strong>。这一项目，正是迈向该目标的一个扎实起点。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1086afe0b49248c497a5c87ff999dff4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769267022&amp;x-signature=A8ORyXDlKWqYFNSXjJERYNxDS4A%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>本文从工程化与系统化的角度，介绍了一套基于 <strong>YOLOv8 的多车型交通车辆实时检测系统</strong>，完整覆盖了数据输入、模型训练、推理部署以及 PyQt5 图形化交互等关键环节。通过将高精度目标检测模型与易用的桌面端界面相结合，系统实现了对多种交通场景下车辆目标的稳定识别与实时展示，显著降低了深度学习技术在智慧交通领域的使用门槛。整体方案结构清晰、可扩展性强，不仅具备直接落地应用的工程价值，也为后续在车流统计、行为分析和交通智能决策等方向上的功能扩展提供了良好的技术基础。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[GPT-5.2 七天“手搓”Chrome，社区评价：依托大的]]></title>    <link>https://juejin.cn/post/7595894884957536307</link>    <guid>https://juejin.cn/post/7595894884957536307</guid>    <pubDate>2026-01-17T15:09:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595894884957536307" data-draft-id="7596299957276966939" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="GPT-5.2 七天“手搓”Chrome，社区评价：依托大的"/> <meta itemprop="keywords" content="前端,后端,JavaScript"/> <meta itemprop="datePublished" content="2026-01-17T15:09:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="摸鱼的春哥"/> <meta itemprop="url" content="https://juejin.cn/user/1714893870865303"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            GPT-5.2 七天“手搓”Chrome，社区评价：依托大的
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1714893870865303/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    摸鱼的春哥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T15:09:39.000Z" title="Sat Jan 17 2026 15:09:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在AI这行，营销的油门，好像总比技术的轮子踩得猛。</p>
<p>最近，Cursor团队（由他们的CEO Michael Truell亲自演示）发了一段视频，在科技圈里简直炸开了锅。视频里说，他们用最新的GPT-5.2模型，通过一个叫“Shadow”的AI智能体，只花了7天，就让AI自己写了300万行代码，从零到一搞出了一个“Chrome级别”的现代浏览器。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/031aaac6d8d1468d8f334b63da2543c7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pG46bG855qE5pil5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769267379&amp;x-signature=I20ib5q478ypv2pd%2FNCGwVtEEEg%3D" alt="" loading="lazy"/></p>
<p>这个故事，几乎集齐了所有让投资人和技术宅热血沸腾的元素：不知疲倦的AI劳工、飙升的生产力，还有对人类编程工作的“降维打击”。但如果我们剥开这层金光闪闪的包装，看到的真的是“奇迹”吗，还是只是一场精心设计的“调包”戏法。</p>
<h2 data-id="heading-0">神话诞生——视频里的“奇迹七天”</h2>
<p>在Cursor团队CEO Michael Truell的演示里，故事讲得那叫一个宏大。</p>
<p>Truell介绍了一个叫“Shadow”的AI智能体系统。它和以前只能补几行代码的Copilot可不一样，被描述成一个全自动的软件工程师。据说它能理解庞大的代码库，有长期记忆，还能自己规划任务。</p>
<p>按照视频的说法，这个AI在7天里几乎没休息。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc1c040e2feb4e47ae8ab05f2c5c0dab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pG46bG855qE5pil5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769267379&amp;x-signature=zxiPR0IlF1t41PzIVII6AUz0qxo%3D" alt="" loading="lazy"/></p>
<p>它先自己拿主意，决定需要什么模块，自己设计架构。接着自己修Bug，遇到编译错误或者逻辑问题，它会像人一样去看报错信息，然后改代码，直到跑通为止。最终产出了一个叫<code>fastrender</code>的项目，据说有300万行代码。视频甚至明里暗里地暗示，这个浏览器复杂得很，AI连HTML解析器、CSS布局引擎、文本渲染系统都自己写了，甚至还搞定了一个JavaScript虚拟机。</p>
<p>演示者的话里话外都在表达，这不仅仅是个浏览器，简直是AI要取代人类程序员的“转折点”。听起来，AI已经不再是辅助工具，而是一个能独立完成从设计到实现全过程的“超级包工头”了。</p>
<h2 data-id="heading-1">泡沫破裂——除了胶水，啥也不是</h2>
<p>可是，当社区的开发者们真的去看了代码仓库，也就是GitHub上的<code>wilsonzlin/fastrender</code>，尤其是检查了那个关键的<code>Cargo.toml</code>（Rust项目的依赖配置文件）之后，这场“造神运动”立马变成了一个笑话。</p>
<p>所谓的“从零自研”，在事实面前根本站不住脚。</p>
<p>视频里吹得神乎其神的“核心底层技术”，其实全是AI，也就是GPT-5.2，从Rust开源社区“借”来的现成轮子。那300万行代码，绝大部分是这些第三方库的，或者是AI为了调用这些库而写出来的、臃肿的“胶水代码”。</p>
<p>来看看这个“AI奇迹”的真面目吧。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e0ca060ebca24d06a176e48f1660957e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pG46bG855qE5pil5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769267379&amp;x-signature=Znk%2BSq5SGXfNTf91eP6kGqSvblc%3D" alt="" loading="lazy"/></p>
<p>它根本没写HTML解析逻辑，直接调用了<strong>Servo‘s HTML parser</strong>。这是Mozilla（火狐背后的团队）为Servo引擎耕耘了十几年的成果。它也没处理复杂的CSS权重和匹配，用的是<strong>Servo‘s CSS parser</strong>和<strong>selectors</strong>库。对于浏览器最难的部分JavaScript引擎，它直接把<strong>QuickJS</strong>（通过<code>rquickjs</code>绑定）塞进去了，压根没写虚拟机，只是写了个“启动QuickJS”的函数。此外，SVG渲染靠的是<strong>resvg</strong>，图形渲染靠的是<strong>wgpu</strong>和<strong>tiny-skia</strong>，GUI界面用的是<strong>egui</strong>，而WebSocket支持则依赖<strong>tungstenite</strong>。</p>
<p>这就像有人号称自己“七天从零造了辆法拉利”，结果大家发现他只是上网买了法拉利的发动机、保时捷的轮子、特斯拉的底盘，然后用胶带把它们捆在一块，最后给外壳喷了个漆。</p>
<h2 data-id="heading-2">社区的群嘲：一堆没用的“代码山”</h2>
<p>这种工程在技术圈里引发了大量的吐槽，大家普遍觉得，这次演示不仅没证明AI多厉害，反而暴露了现在大语言模型写代码的大问题。</p>
<p>社区开发者调侃说，如果这也能叫“造浏览器”，那任何一个学过Rust的初级程序员，只要会用<code>cargo add</code>命令，都能在半天内“造”出一个来。AI干的主要活儿，就是用一种不怎么优雅的方式，把这些现成的、设计得挺好的库给拼起来。</p>
<p>宣称的“300万行代码”成了最大的讽刺。对于一个主要起连接作用的项目，代码越多，通常意味着工程越差。真正的工程师追求用更少的代码做更多的事（KISS原则）。而AI生成了一大堆样板代码、重复的逻辑判断和冗余的类型转换。这根本不是功劳，而是技术负担。<strong>烧了几亿Token换来的，是一个人类没法维护、没法阅读、一旦依赖库升级就可能全盘崩溃的数字垃圾场。</strong></p>
<p>浏览器的核心难点，比如DOM树的构建、复杂的渲染流水线优化、JIT编译器的安全性等等，Shadow一个都没解决，它只是绕开了。这说明AI擅长<strong>搜索和拼接</strong>，但根本不具备<strong>系统级的工程创新能力</strong>。</p>
<h2 data-id="heading-3">写在最后</h2>
<p>GPT-5.2的这次演示，与其说是展示了AI的编程实力，不如说是展示了AI的“画饼”实力。</p>
<p>它活灵活现地模仿了一个只会东抄抄、西抄抄，然后把代码量堆得老高来糊弄人的普通程序员。对资本市场来说，这或许是个好听的故事；但对认真的软件工程来说，这只是一次既浪费钱又没啥意义的折腾。</p>
<p>我们不需要AI用300万行代码把别人的成果重新包装一遍，我们更希望它能用30行代码解决一个人类想了很久的难题。很可惜，这一次，它交出的是一份不及格的答卷。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ArcGIS Pro 添加底图的方式]]></title>    <link>https://juejin.cn/post/7595878718172332068</link>    <guid>https://juejin.cn/post/7595878718172332068</guid>    <pubDate>2026-01-17T15:13:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595878718172332068" data-draft-id="7595878718172282916" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ArcGIS Pro 添加底图的方式"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-17T15:13:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="GIS之路"/> <meta itemprop="url" content="https://juejin.cn/user/4346787284915481"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ArcGIS Pro 添加底图的方式
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4346787284915481/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    GIS之路
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T15:13:44.000Z" title="Sat Jan 17 2026 15:13:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">^ 关注我，带你一起学GIS ^</h2>
<h2 data-id="heading-1">前言</h2>
<blockquote>
<p>❝</p>
<p>众所周知，<code>ArcGIS Pro</code>中来自<code>ESRI</code>公司的底图被封禁了，虽然使用天地图数据源进行了替换，但是使用起来总感觉差点儿意思，不那么让人舒服。所以，还是另想办法把<code>ESRI</code>原底图给加进来。</p>
</blockquote>
<p>之前通过<code>Map</code>菜单下的<code>Basemap</code>选项便可以直接添加底图，便捷又省力。可恶的是我的底图这里竟然是空空如也，连天地图也消失不见。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/13edd8473754456d9a2411cd05240b8f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769267623&amp;x-signature=jWHQpC3CbDvIm39mrND8kiIINFw%3D" alt="" loading="lazy"/></p>
<p>还是得自立更生啊。去网上找了一下，好多文章比较老，推荐的数据源地址还是：<code>https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer</code></p>
<p>结果给我死活都加载不了，浏览器也无法访问，打开命令行测试一下域名是否能够联通。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/76168b986dc44d5bad427e1c815cd42a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769267623&amp;x-signature=6KGpZMGx%2BfgHE4TvP4Cy6mETgIo%3D" alt="" loading="lazy"/>好家伙，直接请求超时了，估计是域名换了，继续重新找资源。</p>
<p>这是新的服务地址，原来域名由以前的<code>services</code>改为<code>server</code>了。</p>
<p><code>https://server.arcgisonline.com/arcgis/rest/services/World_Imagery/MapServer</code><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb54d0e158e64ca59f3aa98fbc62f87d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769267623&amp;x-signature=pvGgccKWIm392x9HaxBkJJLd%2FlE%3D" alt="" loading="lazy"/></p>
<p>可以ping通，继续在浏览器里面测试一下看看是否能正常打开，经验证是可以。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1473f5ce8c094a7891217dac18bced2b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769267623&amp;x-signature=R9y%2FMfbAeRn3GsJq%2F%2BNXNkexZbA%3D" alt="" loading="lazy"/></p>
<p>使用<code>ArcGIS API</code>预览一下服务，发现都是<code>ok</code>的。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a3b2ea299a548c2b2737ff1bc304e01~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769267623&amp;x-signature=TQQFzYJIiTviOk7J%2BoWkAfFZ2%2Fk%3D" alt="" loading="lazy"/></p>
<p>那现在我们就可以使用<code>ArcGIS Pro</code>来连接一下在线服务了。</p>
<h2 data-id="heading-2">1. 通过ArcGIS Server添加</h2>
<p>先按照以下四步进行操作：</p>
<p><strong>(1)、</strong> 点击菜单栏<code>Insert</code>按钮</p>
<p><strong>(2)、</strong> 打开<code>Connections</code>下拉菜单</p>
<p><strong>(3)、</strong> 选择<code>Server</code>选项</p>
<p><strong>(4)、</strong> 最后点击右侧<code>New ArcGIS Server</code><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ebff546103ea48c2962418fdaa62c333~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769267623&amp;x-signature=J7M2Ih0Qybh0hAwTZ2je0VdjE50%3D" alt="" loading="lazy"/></p>
<p>在添加服务对话框中输入地址：<code>https://server.arcgisonline.com/arcgis/rest/services/World_Imagery/MapServer</code>，然后点击<code>OK</code>。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/825a092584154062a514a488a2b05a47~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769267623&amp;x-signature=%2F61Moa3tIOzzkDCIjwcY4XjPjqM%3D" alt="" loading="lazy"/></p>
<p>点击目录中的<code>Servers</code>选项，然后选择添加的服务链接即可查看添加的服务。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/51fba7cf3cd343089be420de5bf562c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769267623&amp;x-signature=LuoKAmJ2nVH4Vuez2tHkbzVMIkg%3D" alt="" loading="lazy"/></p>
<p>在你要添加服务上右键，可以选择将图层添加到当前地图或者添加新地图、场景。也可以直接拖动图层到地图容器或者场景中进行查看。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/416380a23be844919694f136861a60fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769267623&amp;x-signature=lXxwx9DALcv9%2FVi1s%2BXEgmP5gw8%3D" alt="" loading="lazy"/></p>
<p>如果你的软件没有显示目录或者你没有找到<code>Servers</code>选项的话，可以通过顶部菜单栏进行打开。</p>
<p>首先点击菜单栏<code>View</code>选项，然后打开<code>Catalog Pane</code>。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/359b66d06c4a4721a6f177658fa8312a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769267623&amp;x-signature=6Sc%2B3mi7ZSidJTzi6LW%2FdrYoIBM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">2. 通过Add Data 添加</h2>
<p><strong>（1）</strong> 点击菜单栏<code>Map</code></p>
<p><strong>（2）</strong> 选择<code>Add Data</code>选项</p>
<p><strong>（3）</strong> 点击From Path········<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c94265fc44d24a219151d95973000e29~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769267623&amp;x-signature=ZSSjkGUiKwlvgCeQWGFKKgdovig%3D" alt="" loading="lazy"/></p>
<p>然后再添加数据对话框中填入地址：<code>https://server.arcgisonline.com/arcgis/rest/services/World_Imagery/MapServer</code>，然后点击<code>Add</code>。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bbf1dc46a9074b97a48861d5c606f4d7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769267623&amp;x-signature=U29iY2xklNKdDU00HC1FtW2t4%2Bg%3D" alt="" loading="lazy"/></p>
<p>图层显示效果如下：<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/466677317520435e921b4ee4b7f6acb8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769267623&amp;x-signature=u%2BxfTnQmsGk%2BmMIMybF3nFloayE%3D" alt="" loading="lazy"/></p>
<p>还可以直接在对话框中填入xyz服务地址：<code>https://server.arcgisonline.com/arcgis/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}</code>，然后点击<code>Add</code>。</p>
<p>此种方式显示效果如下。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/544713d332084496bb921b2dbf95e406~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769267623&amp;x-signature=10P2v9FEkHP2nnw%2FmTfGIJAN544%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">3. 服务地址</h2>
<p>下面推荐几个常用的地图服务地址，具有<code>xyz</code>服务类型，也有<code>ArcGIS</code>地图服务类型。可以添加影像底图、矢量底图和地形数据。</p>
<p><strong>（一）ArcGIS xyz 切片</strong></p>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-comment"># Esri Imagery 服务</span>
<span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/server.arcgisonline.com/arcgis</span><span class="hljs-regexp">/rest/services</span><span class="hljs-regexp">/World_Imagery/</span><span class="hljs-title class_">MapServer</span>/tile/{z}/{y}/{x}

<span class="hljs-comment"># Esri Topographic 服务</span>
<span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/server.arcgisonline.com/arcgis</span><span class="hljs-regexp">/rest/services</span><span class="hljs-regexp">/World_Topo_Map/</span><span class="hljs-title class_">MapServer</span>/tile/{z}/{y}/{x}

<span class="hljs-comment"># Esri Terrain 服务</span>
<span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/server.arcgisonline.com/arcgis</span><span class="hljs-regexp">/rest/services</span><span class="hljs-regexp">/World_Terrain_Base/</span><span class="hljs-title class_">MapServer</span>/tile/{z}/{y}/{x}
</code></pre>
<p><strong>（二）ArcGIS MapServer</strong></p>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-comment"># USA 服务</span>
<span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/sampleserver6.arcgisonline.com/</span><span class="hljs-title class_">Arc</span>GIS/rest/services/<span class="hljs-variable constant_">USA</span>/<span class="hljs-title class_">MapServer</span>

<span class="hljs-comment"># Wildfire 服务</span>
<span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/sampleserver6.arcgisonline.com/arcgis</span><span class="hljs-regexp">/rest/services</span><span class="hljs-regexp">/Wildfire/</span><span class="hljs-title class_">MapServer</span>

<span class="hljs-comment"># Esri Imagery 服务</span>
<span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/server.arcgisonline.com/arcgis</span><span class="hljs-regexp">/rest/services</span><span class="hljs-regexp">/World_Imagery/</span><span class="hljs-title class_">MapServer</span>

<span class="hljs-comment"># Esri Topographic 服务</span>
<span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/server.arcgisonline.com/arcgis</span><span class="hljs-regexp">/rest/services</span><span class="hljs-regexp">/World_Topo_Map/</span><span class="hljs-title class_">MapServer</span>

<span class="hljs-comment"># Esri Terrain 服务</span>
<span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/server.arcgisonline.com/arcgis</span><span class="hljs-regexp">/rest/services</span><span class="hljs-regexp">/World_Terrain_Base/</span><span class="hljs-title class_">MapServer</span>
</code></pre>
<p>原域名<code>services.arcgisonline.com</code>已经不能使用。</p>
<pre><code class="hljs language-bash" lang="bash">https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer
</code></pre>
<p><strong><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ab5cede7f1a248138ac927960a559501~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769267623&amp;x-signature=kvraz4TZ%2BvRuv46HBYRgRhprJxw%3D" alt="" loading="lazy"/></strong></p>
<blockquote>
<p>❝</p>
<p>OpenLayers示例数据下载，请在公众号后台回复：<strong>vector</strong></p>
<p>全国信息化工程师－GIS 应用水平考试资料，请在公众号后台回复：<strong>GIS考试</strong></p>
</blockquote>
<blockquote>
<p>❝</p>
<p><em><strong>GIS之路</strong></em> 公众号已经接入了<strong>智能</strong> <strong>助手</strong>，可以在对话框进行提问，也可以直接搜索历史文章进行查看。</p>
</blockquote>
<p>都看到这了，不要忘记<em><strong>点赞、收藏</strong></em> <strong>+</strong> <em><strong>关注</strong></em> 哦 <strong>！</strong></p>
<p>本号不定时更新有关 <em><strong>GIS开发</strong></em> 相关内容，<em><strong>欢迎关注 <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e1d0e63e962d4cf898647d45c78d8bdb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769267623&amp;x-signature=2wwp%2BlsHs1c6ErRok0zJhKi8RU4%3D" alt="" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f01a5a3b82584793b1185c57141b9784~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769267623&amp;x-signature=3WGWBSU3nuu5ypNdvA06%2BZAi3xc%3D" alt="" loading="lazy"/></strong></em></p>
<hr/>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4e6ceb7a5d0a4319b6dfdb09c07e4f45~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769267623&amp;x-signature=z%2BwsZQCMvtkMK3JK%2BNB50hYZzZo%3D" alt="" loading="lazy"/></p>
<p>   <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7478f5b8d1164e9cba5e3c5aa54226c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769267623&amp;x-signature=t4Wvz4QWdgrBCoH4rZzIQKAtggQ%3D" alt="" loading="lazy"/> </p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkwOTEzNjI5NQ%3D%3D%26mid%3D2247487953%26idx%3D1%26sn%3D0b2d5aeefdb290583cf8cdd82f3c2077%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzkwOTEzNjI5NQ==&amp;mid=2247487953&amp;idx=1&amp;sn=0b2d5aeefdb290583cf8cdd82f3c2077&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">GeoTools 开发合集（全）</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkwOTEzNjI5NQ%3D%3D%26mid%3D2247487119%26idx%3D1%26sn%3Dc313efa84c27bf933ef2f2a47991ef2d%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzkwOTEzNjI5NQ==&amp;mid=2247487119&amp;idx=1&amp;sn=c313efa84c27bf933ef2f2a47991ef2d&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">OpenLayers 开发合集</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FE9BrT9VzidvziCayXgRCQA" target="_blank" title="https://mp.weixin.qq.com/s/E9BrT9VzidvziCayXgRCQA" ref="nofollow noopener noreferrer">为什么每次打开 ArcGIS Pro 页面加载都如此缓慢？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FhBXfq6zRK9twSicMXw69jw" target="_blank" title="https://mp.weixin.qq.com/s/hBXfq6zRK9twSicMXw69jw" ref="nofollow noopener noreferrer">ArcGIS Pro 实现影像波段合成</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FQVFiW5C5wXQ6a1WODCaH0g" target="_blank" title="https://mp.weixin.qq.com/s/QVFiW5C5wXQ6a1WODCaH0g" ref="nofollow noopener noreferrer">自然资源部党组关于苗泽等4名同志职务任免的通知</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FJmv3J_bjbBG-4jB72zS3hw" target="_blank" title="https://mp.weixin.qq.com/s/Jmv3J_bjbBG-4jB72zS3hw" ref="nofollow noopener noreferrer">GDAL 创建矢量图层的两种方式</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FwkHv2NnJfuPhtyjJcFLrEQ" target="_blank" title="https://mp.weixin.qq.com/s/wkHv2NnJfuPhtyjJcFLrEQ" ref="nofollow noopener noreferrer">GDAL 实现矢量数据转换处理（全）</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FMZIQ57Ka3NQfKFi9AuEQEg" target="_blank" title="https://mp.weixin.qq.com/s/MZIQ57Ka3NQfKFi9AuEQEg" ref="nofollow noopener noreferrer">GDAL 实现投影转换</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FSX2u2ww1iNOtqR5m3BE93g" target="_blank" title="https://mp.weixin.qq.com/s/SX2u2ww1iNOtqR5m3BE93g" ref="nofollow noopener noreferrer">国产版的Google Earth，吉林一号卫星App“共生地球”来了</a><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FfWufqSyplniNj4Q3BRRbAQ" target="_blank" title="https://mp.weixin.qq.com/s/fWufqSyplniNj4Q3BRRbAQ" ref="nofollow noopener noreferrer">2026年全国自然资源工作会议召开</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FRq7mCSrKU7DA7WRGDEy6Cg" target="_blank" title="https://mp.weixin.qq.com/s/Rq7mCSrKU7DA7WRGDEy6Cg" ref="nofollow noopener noreferrer">日本欲打造“本土版”星链系统</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FEqpOD--IdOUO6gyzwBc6RA" target="_blank" title="https://mp.weixin.qq.com/s/EqpOD--IdOUO6gyzwBc6RA" ref="nofollow noopener noreferrer">吉林一号国内首张高分辨率彩色夜光卫星影像发布</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FznfhqB1_3JbQHG7CEqWSCw" target="_blank" title="https://mp.weixin.qq.com/s/znfhqB1_3JbQHG7CEqWSCw" ref="nofollow noopener noreferrer">2025 年度信创领军企业名单出炉！</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Nano Banana API 来了：不到半价享官方同款品质，仅需约 ¥0.10/张！]]></title>    <link>https://juejin.cn/post/7595901379015000074</link>    <guid>https://juejin.cn/post/7595901379015000074</guid>    <pubDate>2026-01-17T15:33:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595901379015000074" data-draft-id="7595901379014983690" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Nano Banana API 来了：不到半价享官方同款品质，仅需约 ¥0.10/张！"/> <meta itemprop="keywords" content="API"/> <meta itemprop="datePublished" content="2026-01-17T15:33:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="崔庆才丨静觅"/> <meta itemprop="url" content="https://juejin.cn/user/1521379821230269"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Nano Banana API 来了：不到半价享官方同款品质，仅需约 ¥0.10/张！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1521379821230269/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    崔庆才丨静觅
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T15:33:14.000Z" title="Sat Jan 17 2026 15:33:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近被谷歌新发布的 <strong>Nano Banana（Gemini 2.5 Flash Image）图像生成模型</strong> 霸屏了。</p>
<p>从手办秒变真人级 Cosplay，到一键统一多图风格，从个性化头像到产品概念设计，甚至连静态画作都能一键生成电影级动态分镜——这波 AI 生图浪潮，真的在重新定义创作！</p>
<p>Ace Data Cloud 平台 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud" target="_blank" title="https://platform.acedata.cloud" ref="nofollow noopener noreferrer">platform.acedata.cloud</a> 现也推出 <strong>Nano Banana API</strong>：价格：约 ¥0.10/张，成本相比官方直接省一半，性能效果毫不打折。是更快、更稳、更省钱的图片生产线</p>
<h2 data-id="heading-0">Nano Banana 强在哪？</h2>
<p>它最厉害的地方，是能轻松实现 <strong>高精度的一致性生成</strong>。
无论是换背景、改风格、调表情，还是处理复杂动作与服装，过渡都非常自然，效果高度统一，几乎看不出 AI 生成的痕迹！</p>
<h2 data-id="heading-1">超实用的玩法示例</h2>
<h3 data-id="heading-2">1. 2D 图片转 3D 手办</h3>
<p>当前最火的出圈玩法！</p>
<p><strong>指令</strong>：生成一幅图片中角色的商品化模型，环境写实。模型放电脑桌上，使用圆形亚克力底座。电脑屏幕显示建模过程，旁边放置印有原图的 BANDAI 包装盒。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/07749c8d8dd34d278d2b10158f8873c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769268794&amp;x-signature=SgbqVsdCL3h%2BaDU8exSM%2FL407UE%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">2. 产品内部结构解析</h3>
<p><strong>提示词</strong>：超详细的产品爆炸视图，金属零件和电子元件漂浮在半空中，完美排列，揭示内部结构，未来主义技术美学，8K 分辨率，柔和的电影照明，高度逼真。背景是纯白色。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d60109719b6479eb40c4af07ee22ec0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769268794&amp;x-signature=jfFAEpUT%2F7LtOvXem3YFVLvlQFw%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">3. 老照片修复</h3>
<p><strong>提示词</strong>：请修复这张充满划痕的黑白老照片。移除所有污点和破损，大幅提升清晰度，并进行自然、逼真的上色。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/236c41b03b5d464daaf604d7fcac0afa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769268794&amp;x-signature=mNQ0%2BN4Yk98JaMGxNeOs2lkTRho%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-5">4. 多元素组图 / 电商产品植入</h3>
<p><strong>提示词</strong>：一位模特站在一辆白色的车前面摆拍，场景为街区路面，两边是建筑。她穿着黑色连衣裙和白色高跟鞋，一手拎着白色的包。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b73742d727494c43b6cc6b9ec3be6fa0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769268794&amp;x-signature=a%2B4qwd0Kzze%2BejXk1btDgauDMN4%3D" alt="" loading="lazy"/></p>
<p>还有更多实用场景：一键换装/换表情/换动作、多角度镜头、人物合影、表情包九宫格、模特 OOTD 服装平铺展示、手稿转 3D 实物图、建筑等轴测建模、地图转实景解析……统统都能高效完成！</p>
<p>在展示了 Nano Banana 如此多令人惊艳的玩法之后，你可能会想：这么强大的能力，接入起来一定很复杂，成本也很难控制吧？
无论是 AI 产品的开发者想要快速集成，还是个人用户希望直接体验，Ace Data Cloud 都让这一切变得简单、可控且经济。</p>
<h2 data-id="heading-6">价格</h2>
<p>说到价格，Ace Data Cloud 绝对是你的性价比之选：</p>
<ul>
<li>Google 官方：约美元 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.039</mn><mi mathvariant="normal">/</mi><mtext>张，按</mtext></mrow><annotation encoding="application/x-tex">0.039/张，按 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">0.039/</span><span class="mord cjk_fallback">张，按</span></span></span></span></span>1 ≈ ¥7.2 计算，人民币大约 ¥0.28/张。</li>
<li>AceDataCloud：统一 ¥0.10/张。</li>
</ul>
<p>另外并发支持更宽裕，响应更稳定，提供专属客服，7×24 小时可用性保障，具体价格与配额请见：<a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fservices%2Fnano-banana" target="_blank" title="https://platform.acedata.cloud/services/nano-banana" ref="nofollow noopener noreferrer">platform.acedata.cloud/services/na…</a>。</p>
<h2 data-id="heading-7">快速接入，立即体验高品质低成本图像生成！</h2>
<p>我们提供简洁的 API 和完整的开发文档，助你快速集成到既有工作流或新产品。</p>
<ul>
<li>开发集成文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2Fnano-banana-images-integration" target="_blank" title="https://platform.acedata.cloud/documents/nano-banana-images-integration" ref="nofollow noopener noreferrer">platform.acedata.cloud/documents/n…</a></li>
<li>立即购买与使用：<a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fservices%2Fnano-banana" target="_blank" title="https://platform.acedata.cloud/services/nano-banana" ref="nofollow noopener noreferrer">platform.acedata.cloud/documents/n…</a></li>
<li>技术支持与咨询：随时联系我们的技术团队：<a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fsupport" target="_blank" title="https://platform.acedata.cloud/support" ref="nofollow noopener noreferrer">platform.acedata.cloud/support</a></li>
</ul>
<p>下面是样例调用说明，轻松一个 API 就能得到你想要的效果：</p>
<pre><code class="hljs language-bash" lang="bash">curl -X POST <span class="hljs-string">'https://api.acedata.cloud/nano-banana/images'</span> \
  -H <span class="hljs-string">'authorization: Bearer {token}'</span> \
  -H <span class="hljs-string">'accept: application/json'</span> \
  -H <span class="hljs-string">'content-type: application/json'</span> \
  -d <span class="hljs-string">'{
    "action": "generate",
    "prompt": "A photorealistic close-up portrait of an elderly Japanese ceramicist with deep, sun-etched wrinkles and a warm, knowing smile. He is carefully inspecting a freshly glazed tea bowl. The setting is his rustic, sun-drenched workshop. The scene is illuminated by soft, golden hour light streaming through a window, highlighting the fine texture of the clay. Captured with an 85mm portrait lens, resulting in a soft, blurred background (bokeh). The overall mood is serene and masterful. Vertical portrait orientation."
  }'</span>
</code></pre>
<p>返回结果：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"056f0589-a3dd-4ec2-8440-ad61f5038dfa"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"c48de83f-0077-426e-b02b-ff1d58179064"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"A photorealistic close-up portrait of an elderly Japanese ceramicist with deep, sun-etched wrinkles and a warm, knowing smile. He is carefully inspecting a freshly glazed tea bowl. The setting is his rustic, sun-drenched workshop. The scene is illuminated by soft, golden hour light streaming through a window, highlighting the fine texture of the clay. Captured with an 85mm portrait lens, resulting in a soft, blurred background (bokeh). The overall mood is serene and masterful. Vertical portrait orientation."</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://platform.cdn.acedata.cloud/nanobanana/69790adb-c85d-4362-ad9e-0c9ba4352cf4.png"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>其中 image_url 就是 Nano Banana 生成的的图片，永久可访问。</p>
<h2 data-id="heading-8">总结</h2>
<p>好了，以上就是 Ace Data Cloud 的 Nano Banana API 的介绍，快来试试吧！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[PinMe:零成本三秒发布你的网站]]></title>    <link>https://juejin.cn/post/7595994039109140516</link>    <guid>https://juejin.cn/post/7595994039109140516</guid>    <pubDate>2026-01-17T15:39:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595994039109140516" data-draft-id="7595858760134656063" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="PinMe:零成本三秒发布你的网站"/> <meta itemprop="keywords" content="开源"/> <meta itemprop="datePublished" content="2026-01-17T15:39:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="修己xj"/> <meta itemprop="url" content="https://juejin.cn/user/2641475936724142"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            PinMe:零成本三秒发布你的网站
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2641475936724142/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    修己xj
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T15:39:19.000Z" title="Sat Jan 17 2026 15:39:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你是否渴望将自己的博客网站部署上线，却因高昂的服务器和域名费用、繁琐的配置流程而望而却步？你是否希望发布一个活动页面或图书介绍网站，却不愿购买服务器，也不想经历复杂的部署步骤？</p>
<p>最近在浏览 GitHub 时，我发现了一个很棒的项目——PinMe。 PinMe 的目标，就是把发布这件事简化成一句话：</p>
<p>「本地有一份静态资源，上传到网站发上去或者给我一个命令，我帮你发上去。」</p>
<p>不仅如此，这套发布方案还天生具备 “内容可验证” 与 “抗篡改” 的特点。 今天就来给大家推荐这个项目，相信它会让你的发布之路变得轻松又可靠！🚀</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d03d08f4e26044dfbd03991e1fcf5432~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769269159&amp;x-signature=gqYWv7g8Or4fw%2BJQ%2Bt1PvYMl5Ac%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">🔍什么是PinMe？</h2>
<p>PinMe 是一款零配置的前端部署工具。无需服务器、无需账号、无需设置。</p>
<p>无论是构建静态站点、使用 AI 生成页面，还是导出前端项目 — 只需一条命令或者拖动文件夹上传即可即时部署。</p>
<p>PinMe 将您的网站发布为可验证的内容，相比传统托管，能更有效地防止静默篡改和意外损坏。</p>
<p>您无需管理服务器、区域或运行时间。PinMe 为您处理可用性和持久性。</p>
<p>github地址： <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fglitternetwork%2Fpinme" target="_blank" title="https://github.com/glitternetwork/pinme" ref="nofollow noopener noreferrer">github.com/glitternetw…</a></p>
<p>官网地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fpinme.eth.limo%2F" target="_blank" title="https://pinme.eth.limo/" ref="nofollow noopener noreferrer">pinme.eth.limo/</a></p>
<p>该项目在github 有2.6k ⭐️star</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b0f0ddd070c34b6c9cc71058a3d72866~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769269159&amp;x-signature=jXVzXntfO69scY5%2FFCo3eA1X6FE%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">✒️ 核心特性</h2>
<h3 data-id="heading-2">🚀 极简部署</h3>
<ul>
<li>网页部署：进入网站，上传文件jar</li>
<li>命令行部署： 只需执行几行简单的命令</li>
</ul>
<h3 data-id="heading-3">🔒 去中心化存储</h3>
<p>PinMe基于IPFS（星际文件系统）技术，将你的网站内容存储在去中心化网络中。这意味着：</p>
<ul>
<li>不可篡改：上传的内容会生成唯一的哈希值，确保内容完整性</li>
<li>永久访问：即使单个节点离线，你的网站仍然可以通过其他节点访问</li>
<li>全球加速：内容通过IPFS网络分布，实现就近访问</li>
</ul>
<h3 data-id="heading-4">🆓 完全免费</h3>
<p>目前PinMe提供免费的部署服务，支持：</p>
<ul>
<li>单个文件最大200MB</li>
<li>整个目录最大1GB</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/68778d89312e406b97aa6497788ff4c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769269159&amp;x-signature=H7G64j5gYK8LcABTIsykE7%2FMZqc%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">🚂快速开始</h2>
<h3 data-id="heading-6">🕸️ 网站上传部署（小白推荐）</h3>
<p>浏览器打开网站：<a href="https://link.juejin.cn?target=https%3A%2F%2Fpinme.eth.limo%2F" target="_blank" title="https://pinme.eth.limo/" ref="nofollow noopener noreferrer">pinme.eth.limo/</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f77e64d7144d4b618202ced9a39f1934~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769269159&amp;x-signature=emNQkuKHLC3J7eHTtk8xZ6OXEAQ%3D" alt="" loading="lazy"/></p>
<p>将你构建好的前端项目或者静态网页文件上传，上传成功之后会返回一个url地址（保存好此地址），使用此地址即可访问你的网站。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/962d281b2bae49bbbffa9c9e6c06d786~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769269159&amp;x-signature=jdtM0mxWmuRA5SKfuy3RIoFolhY%3D" alt="" loading="lazy"/></p>
<p>部署示例网站：<a href="https://link.juejin.cn?target=https%3A%2F%2F34759bf5.pinit.eth.limo%2F" target="_blank" title="https://34759bf5.pinit.eth.limo/" ref="nofollow noopener noreferrer">34759bf5.pinit.eth.limo/</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b4c880955bd4d8c9c0ced52fa2d9453~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769269159&amp;x-signature=WYVKfPF5iJjz5Aa2%2FNy4AarLMXM%3D" alt="pinme-web-example.png" loading="lazy"/></p>
<blockquote>
<p>注：建议使用github账号登录，登录之后每次上传有历史记录可以查看，历史记录中可以查询到我们的地址</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f5b42eab818443baec9711de97dce94~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769269159&amp;x-signature=cI2%2B5JMVB2MgKmop3LGIZnot1%2BU%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-7">🖥️ 命令行部署（开发推荐）</h3>
<ol>
<li>准备环境</li>
</ol>
<blockquote>
<p>要求 Node.js 版本 ≥ 16.13.0</p>
</blockquote>
<p>如果版本过低，先升级 Node。</p>
<ol start="2">
<li>安装 PinMe CLI</li>
</ol>
<p>使用 npm：</p>
<pre><code class="hljs">npm install -g pinme
</code></pre>
<p>3.  构建并上传</p>
<p>以常见的前端工程为例：</p>
<pre><code class="hljs language-arduino" lang="arduino"># Vite / React / Vue 项目，一般是：
npm run build
</code></pre>
<p>完成构建后，上传：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 最常见的 dist 目录</span>
pinme upload dist
</code></pre>
<p>命令执行成功后，你将得到：</p>
<ol>
<li>一个 IPFS 内容 hash</li>
<li>一个预览页面链接：<br/>
<code>https://pinme.eth.limo/#/preview/*</code></li>
</ol>
<p>打开这个链接，就能在线访问你的站点。</p>
<h2 data-id="heading-8">⏳ PinMe CLI：常用命令一览</h2>
<p>PinMe 主要通过 CLI 提供能力，整体命令集很简洁。</p>
<h3 data-id="heading-9">⬆️ 1. 上传（核心命令）</h3>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># 交互式上传（会让你选择要上传的目录/文件）</span>
pinme upload

<span class="hljs-comment"># 直接指定路径上传</span>
pinme upload /path/to/file-<span class="hljs-keyword">or</span>-directory

<span class="hljs-comment"># 上传并绑定一个固定子域名（需要 AppKey &amp; Plus 会员）</span>
pinme upload dist --domain <span class="hljs-keyword">my</span>-site
<span class="hljs-comment"># 简写</span>
pinme upload dist -d <span class="hljs-keyword">my</span>-site
</code></pre>
<blockquote>
<p>注意：</p>
<ul>
<li>固定域名使用的是 <code>https://&lt;name&gt;.pinit.eth.limo</code> 这种形式</li>
<li>绑定固定域名需要 AppKey 且开通 Plus 会员；普通用户可以使用预览链接访问。</li>
</ul>
</blockquote>
<h3 data-id="heading-10">🔄 2. 查看上传历史</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看最近 10 条上传记录</span>
pinme list
<span class="hljs-comment"># 或简写</span>
pinme <span class="hljs-built_in">ls</span>

<span class="hljs-comment"># 指定数量</span>
pinme list -l 5

<span class="hljs-comment"># 清空本地上传历史</span>
pinme list -c
</code></pre>
<h3 data-id="heading-11">♻️ 3. 删除与清理</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 交互式删除（从历史中选择）</span>
pinme <span class="hljs-built_in">rm</span>

<span class="hljs-comment"># 指定 IPFS hash 删除</span>
pinme <span class="hljs-built_in">rm</span> &lt;IPFS_hash&gt;
</code></pre>
<p>需要说明的是，<code>rm</code> 实际做的是从 PinMe 使用的 IPFS 节点中「取消 pin 并移除 ENS 记录」，并不意味着全网 IPFS 都会立刻删除内容。</p>
<h3 data-id="heading-12">🔓 4. 登录与身份（AppKey）</h3>
<p>PinMe 使用 <strong>AppKey</strong> 来标识用户，用于：</p>
<ul>
<li>账号登录</li>
<li>上传历史合并</li>
<li>固定域名绑定</li>
</ul>
<p>appkey可在网页端 Account Information 页面查看</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/48cab80659ac421ab1231777a1bb5ae0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769269159&amp;x-signature=3CSb8pfR6IVHlfFeL6qgRADqT4Y%3D" alt="" loading="lazy"/></p>
<p>相关命令：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 设置 AppKey</span>
pinme set-appkey

<span class="hljs-comment"># 查看当前 AppKey 信息（会做掩码处理）</span>
pinme show-appkey
pinme appkey

<span class="hljs-comment"># 登出并清除本地认证信息</span>
pinme <span class="hljs-built_in">logout</span>

<span class="hljs-comment"># 查看当前账号拥有的域名</span>
pinme my-domains
pinme domain
</code></pre>
<h3 data-id="heading-13">👁️‍🗨️ 5. 帮助信息</h3>
<pre><code class="hljs language-bash" lang="bash">pinme <span class="hljs-built_in">help</span>
</code></pre>
<h2 data-id="heading-14">📂 上传大小限制与存储说明</h2>
<p>免费计划下的限制（以 README 为准）：</p>

















<table><thead><tr><th>类型</th><th>限制</th></tr></thead><tbody><tr><td>单个文件</td><td>200 MB</td></tr><tr><td>整个目录总和</td><td>1 GB</td></tr></tbody></table>
<p>上传后文件会存储在 IPFS 网络中，并通过 Glitter Protocol 的 IPFS 网关提供访问。</p>
<p>成功上传后你会获得：</p>
<ol>
<li>IPFS 内容 hash</li>
<li>预览链接：<code>https://pinme.eth.limo/#/preview/*</code></li>
<li>可选固定域名：<code>https://*.pinit.eth.limo</code>（需 Plus）</li>
</ol>
<p>本地日志默认保存在：</p>
<ul>
<li>Linux / macOS: <code>~/.pinme/</code></li>
<li>Windows: <code>%USERPROFILE%.pinme</code></li>
</ul>
<p>❤️ 结语</p>
<p>PinMe代表了前端部署的未来方向——简单、快速、可靠。无论你是独立开发者、创业团队，还是大型企业，PinMe都能为你节省宝贵的时间和资源。</p>
<p>告别繁琐的服务器配置，拥抱一键部署的新时代。试试PinMe，体验前所未有的部署体验！</p>
<p>一句话总结：构建你的网站，运行pinme upload，然后就可以分享链接了。就这么简单。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深度剖析ooderAI Agent的Scene与Group机制：多Agent自主协作的核心引擎]]></title>    <link>https://juejin.cn/post/7595911076014768164</link>    <guid>https://juejin.cn/post/7595911076014768164</guid>    <pubDate>2026-01-17T15:44:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595911076014768164" data-draft-id="7596025264455794724" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深度剖析ooderAI Agent的Scene与Group机制：多Agent自主协作的核心引擎"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-01-17T15:44:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="OneCodeCN"/> <meta itemprop="url" content="https://juejin.cn/user/1427583415622366"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深度剖析ooderAI Agent的Scene与Group机制：多Agent自主协作的核心引擎
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1427583415622366/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    OneCodeCN
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T15:44:00.000Z" title="Sat Jan 17 2026 15:44:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言</h2>
<p>在人工智能技术快速发展的今天，<strong>多Agent系统</strong>已成为实现复杂任务协作的重要架构。ooderAI Agent系统创新性地引入了<strong>Scene（场景）<strong>和</strong>Group（组）<strong>机制，为</strong>多Agent间的自主协作</strong>提供了强大的支持。这一机制使得Agent和Skill能够根据业务场景自动组织成协作团队，实现高效的任务分配、执行和结果聚合，是实现大规模多Agent协作的核心引擎。</p>
<p>本文将从5W（What, Who, When, Where, Why）角度深入剖析这一机制，重点突出<strong>多Agent协作</strong>的设计理念、工作原理和应用场景，帮助读者全面理解ooderAI Agent系统如何实现高效的多Agent自主协作。</p>
<h2 data-id="heading-1">一、What：Scene与Group到底是什么？</h2>
<h3 data-id="heading-2">1.1 核心概念定义</h3>
<p><strong>Scene（场景）</strong></p>
<p>Scene是<strong>多Agent和Skill协作的上下文环境</strong>，用于描述特定的业务或技术上下文。它定义了一组Agent和Skill协作的规则、目标和约束条件，为<strong>多Agent协作</strong>提供了明确的上下文边界。每个Scene都有明确的类型，用于区分不同的<strong>多Agent协作场景</strong>。</p>
<p><strong>Group（场景组）</strong></p>
<p>Group是基于Scene自动形成的<strong>多Agent协作组</strong>，用于管理同一场景下的Skill协作。它是Scene的具体实例化，包含了实际参与协作的<strong>多Agent/Skill列表</strong>、组所有者和组管理规则，是实现<strong>多Agent自主协作</strong>的具体执行单元。</p>
<p><strong>SceneDeclaration（场景声明）</strong></p>
<p>SceneDeclaration是用于Skill声明支持某个Scene，或Route/MCP声明Scene所有者的机制。通过SceneDeclaration，系统可以<strong>自动发现和组织多Agent协作资源</strong>，实现<strong>多Agent协作团队的动态形成</strong>。</p>
<h3 data-id="heading-3">1.2 场景类型列表</h3>
<p>ooderAI Agent系统中存在两种场景类型：核心场景类型和应用场景类型。</p>
<h4 data-id="heading-4">1.2.1 核心场景类型（SceneType）</h4>
<p>核心场景类型用于描述系统内部的命令执行场景，基于系统操作和技术维度设计：</p>



































































































































<table><thead><tr><th align="left">类别</th><th align="left">场景类型</th><th align="left">描述</th><th align="left">标识</th><th align="left">典型应用</th></tr></thead><tbody><tr><td align="left"><strong>系统生命周期</strong></td><td align="left">INITIALIZATION</td><td align="left">系统初始化场景</td><td align="left">init</td><td align="left">系统启动、组件初始化</td></tr><tr><td align="left">​</td><td align="left">UPGRADE</td><td align="left">系统升级场景</td><td align="left">upgrade</td><td align="left">系统版本升级、组件更新</td></tr><tr><td align="left">​</td><td align="left">SHUTDOWN</td><td align="left">系统关闭场景</td><td align="left">shutdown</td><td align="left">系统优雅关闭、资源释放</td></tr><tr><td align="left"><strong>运行时操作</strong></td><td align="left">CONFIGURATION</td><td align="left">配置管理场景</td><td align="left">config</td><td align="left">动态配置更新、参数调整</td></tr><tr><td align="left">​</td><td align="left">EXECUTION</td><td align="left">命令执行场景</td><td align="left">execute</td><td align="left">任务执行、命令下发</td></tr><tr><td align="left">​</td><td align="left">CONTROL</td><td align="left">系统控制场景</td><td align="left">control</td><td align="left">流程控制、状态管理</td></tr><tr><td align="left"><strong>监控与维护</strong></td><td align="left">MONITORING</td><td align="left">系统监控场景</td><td align="left">monitor</td><td align="left">性能监控、状态上报</td></tr><tr><td align="left">​</td><td align="left">MAINTENANCE</td><td align="left">系统维护场景</td><td align="left">maintain</td><td align="left">日志清理、数据备份</td></tr><tr><td align="left"><strong>调试与测试</strong></td><td align="left">DEBUGGING</td><td align="left">系统调试场景</td><td align="left">debug</td><td align="left">问题排查、调试信息收集</td></tr><tr><td align="left">​</td><td align="left">TESTING</td><td align="left">系统测试场景</td><td align="left">test</td><td align="left">功能测试、性能测试</td></tr><tr><td align="left"><strong>数据处理</strong></td><td align="left">DATA_TRANSFER</td><td align="left">数据传输场景</td><td align="left">data_transfer</td><td align="left">数据同步、文件传输</td></tr><tr><td align="left">​</td><td align="left">DATA_STORAGE</td><td align="left">数据存储场景</td><td align="left">data_storage</td><td align="left">数据持久化、存储管理</td></tr><tr><td align="left">​</td><td align="left">REPORTING</td><td align="left">报告生成场景</td><td align="left">report</td><td align="left">统计报表、数据分析</td></tr><tr><td align="left"><strong>安全与审计</strong></td><td align="left">SECURITY</td><td align="left">安全管理场景</td><td align="left">security</td><td align="left">权限管理、加密解密</td></tr><tr><td align="left">​</td><td align="left">AUDIT</td><td align="left">审计日志场景</td><td align="left">audit</td><td align="left">操作审计、日志记录</td></tr><tr><td align="left"><strong>备份与恢复</strong></td><td align="left">BACKUP</td><td align="left">数据备份场景</td><td align="left">backup</td><td align="left">数据备份、快照管理</td></tr><tr><td align="left">​</td><td align="left">RECOVERY</td><td align="left">数据恢复场景</td><td align="left">recovery</td><td align="left">灾难恢复、数据还原</td></tr></tbody></table>
<h4 data-id="heading-5">1.2.2 应用场景类型（AgentSceneEnum）</h4>
<p>应用场景类型用于描述Agent的具体应用场景，基于业务维度设计，用于superAgent自助协作：</p>





















































































































































































































<table><thead><tr><th align="left">类别</th><th align="left">场景类型</th><th align="left">描述</th><th align="left">标识</th><th align="left">典型应用</th><th align="left">适用范围</th></tr></thead><tbody><tr><td align="left"><strong>基础场景（核心功能）</strong></td><td align="left">DEVICE_CONTROL</td><td align="left">设备控制</td><td align="left">deviceControl</td><td align="left">控制各类智能设备</td><td align="left">all</td></tr><tr><td align="left">​</td><td align="left">SENSOR_DATA</td><td align="left">传感器数据</td><td align="left">sensorData</td><td align="left">采集和展示传感器数据</td><td align="left">all</td></tr><tr><td align="left">​</td><td align="left">SECURITY_MONITOR</td><td align="left">安全监控</td><td align="left">securityMonitor</td><td align="left">监控设备和环境安全</td><td align="left">all</td></tr><tr><td align="left">​</td><td align="left">ENERGY_MANAGEMENT</td><td align="left">能源管理</td><td align="left">energyManagement</td><td align="left">管理和优化能源使用</td><td align="left">all</td></tr><tr><td align="left"><strong>智能生活场景</strong></td><td align="left">SMART_HOME</td><td align="left">智能家居</td><td align="left">smartHome</td><td align="left">打造智能舒适的家居环境</td><td align="left">residential</td></tr><tr><td align="left">​</td><td align="left">SMART_LIGHTING</td><td align="left">智能照明</td><td align="left">smartLighting</td><td align="left">智能控制灯光系统</td><td align="left">residential,commercial</td></tr><tr><td align="left">​</td><td align="left">SMART_THERMOSTAT</td><td align="left">智能温控</td><td align="left">smartThermostat</td><td align="left">智能调节温度和湿度</td><td align="left">residential,commercial</td></tr><tr><td align="left">​</td><td align="left">SMART_SECURITY</td><td align="left">智能安防</td><td align="left">smartSecurity</td><td align="left">智能监控和安全防护</td><td align="left">residential,commercial</td></tr><tr><td align="left">​</td><td align="left">PERSONAL_ASSISTANT</td><td align="left">个人助手</td><td align="left">personalAssistant</td><td align="left">提供个性化的智能助手服务</td><td align="left">personal</td></tr><tr><td align="left"><strong>智能办公场景</strong></td><td align="left">SMART_OFFICE</td><td align="left">智能办公</td><td align="left">smartOffice</td><td align="left">打造高效智能的办公环境</td><td align="left">commercial</td></tr><tr><td align="left">​</td><td align="left">MEETING_ROOM</td><td align="left">智能会议室</td><td align="left">meetingRoom</td><td align="left">智能管理会议室资源</td><td align="left">commercial</td></tr><tr><td align="left">​</td><td align="left">OFFICE_AUTOMATION</td><td align="left">办公自动化</td><td align="left">officeAutomation</td><td align="left">自动化处理办公事务</td><td align="left">commercial</td></tr><tr><td align="left"><strong>行业应用场景</strong></td><td align="left">INDUSTRIAL_AUTOMATION</td><td align="left">工业自动化</td><td align="left">industrialAutomation</td><td align="left">实现工业生产自动化</td><td align="left">industrial</td></tr><tr><td align="left">​</td><td align="left">SMART_RETAIL</td><td align="left">智能零售</td><td align="left">smartRetail</td><td align="left">打造智能零售体验</td><td align="left">commercial</td></tr><tr><td align="left">​</td><td align="left">SMART_HEALTHCARE</td><td align="left">智能医疗</td><td align="left">smartHealthcare</td><td align="left">智能医疗服务和管理</td><td align="left">healthcare</td></tr><tr><td align="left">​</td><td align="left">SMART_AGRICULTURE</td><td align="left">智能农业</td><td align="left">smartAgriculture</td><td align="left">智能农业生产管理</td><td align="left">agriculture</td></tr><tr><td align="left">​</td><td align="left">SMART_TRAFFIC</td><td align="left">智能交通</td><td align="left">smartTraffic</td><td align="left">智能交通管理系统</td><td align="left">transportation</td></tr><tr><td align="left">​</td><td align="left">SMART_LOGISTICS</td><td align="left">智能物流</td><td align="left">smartLogistics</td><td align="left">智能物流管理</td><td align="left">logistics</td></tr><tr><td align="left">​</td><td align="left">SMART_EDUCATION</td><td align="left">智能教育</td><td align="left">smartEducation</td><td align="left">智能教育服务和管理</td><td align="left">education</td></tr><tr><td align="left"><strong>环境与公共服务场景</strong></td><td align="left">ENVIRONMENT_MONITOR</td><td align="left">环境监测</td><td align="left">environmentMonitor</td><td align="left">监测和分析环境数据</td><td align="left">public</td></tr><tr><td align="left">​</td><td align="left">PUBLIC_SERVICE</td><td align="left">公共服务</td><td align="left">publicService</td><td align="left">提供智能公共服务</td><td align="left">public</td></tr><tr><td align="left">​</td><td align="left">SMART_CITY</td><td align="left">智慧城市</td><td align="left">smartCity</td><td align="left">打造智能高效的城市管理</td><td align="left">public</td></tr><tr><td align="left">​</td><td align="left">SMART_PARKING</td><td align="left">智能停车</td><td align="left">smartParking</td><td align="left">智能停车管理系统</td><td align="left">transportation</td></tr><tr><td align="left"><strong>特殊场景</strong></td><td align="left">EMERGENCY_RESPONSE</td><td align="left">应急响应</td><td align="left">emergencyResponse</td><td align="left">处理紧急情况和灾害</td><td align="left">all</td></tr><tr><td align="left">​</td><td align="left">REMOTE_MAINTENANCE</td><td align="left">远程维护</td><td align="left">remoteMaintenance</td><td align="left">远程设备维护和故障处理</td><td align="left">all</td></tr></tbody></table>
<h2 data-id="heading-6">二、Who：谁参与Scene与Group的管理和协作？</h2>
<h3 data-id="heading-7">2.1 角色定义</h3>
<p><strong>Scene所有者</strong></p>
<p>Scene所有者是负责管理和维护特定Scene的角色，只能由Route或MCP（Master Control Program）担任。Scene所有者拥有该Scene下所有Group的管理权限。</p>
<p><strong>Skill</strong></p>
<p>Skill是实际执行任务的组件，可以声明支持一个或多个Scene，并在Scene中担任不同的角色：</p>
<ul>
<li><strong>agentRoute（聚合中继）</strong>：负责接收任务、分发任务和聚合结果</li>
<li><strong>endAgent（终端）</strong>：负责具体任务的执行</li>
</ul>
<p><strong>SceneManager</strong></p>
<p>SceneManager是系统级的场景管理中心，负责处理SceneDeclaration、自动创建Group、管理Scene和Group信息等核心功能。</p>
<h3 data-id="heading-8">2.2 角色协作关系</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/597ce017ecd14b33a650b56f661ab772~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT25lQ29kZUNO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769269439&amp;x-signature=QvuBhZt2PCBuPUhEy9tdFUORBuI%3D" alt="Mermaid Diagram" loading="lazy"/></p>
<h2 data-id="heading-9">三、When：Scene与Group机制何时生效？</h2>
<h3 data-id="heading-10">3.1 生命周期</h3>
<p><strong>Scene的生命周期</strong></p>
<ol>
<li><strong>声明阶段</strong>：Route/MCP声明为Scene所有者</li>
<li><strong>形成阶段</strong>：Skill声明支持该Scene</li>
<li><strong>活跃阶段</strong>：SceneGroup自动形成，开始协作</li>
<li><strong>演化阶段</strong>：Skill动态加入或离开Group</li>
<li><strong>解散阶段</strong>：所有Skill离开或所有者取消声明</li>
</ol>
<p><strong>Group的生命周期</strong></p>
<ol>
<li><strong>创建阶段</strong>：当Scene同时存在所有者和至少一个Skill声明时自动创建</li>
<li><strong>运行阶段</strong>：接收任务、执行协作</li>
<li><strong>更新阶段</strong>：添加/移除Skill，更新配置</li>
<li><strong>删除阶段</strong>：当所有Skill离开或所有者删除时自动解散</li>
</ol>
<h3 data-id="heading-11">3.2 触发时机</h3>
<ul>
<li><strong>SceneDeclaration</strong>：当Route/MCP启动或Skill注册时触发</li>
<li><strong>Group创建</strong>：当Scene同时满足"有所有者"和"至少一个Skill声明"条件时触发</li>
<li><strong>Group更新</strong>：当有新Skill加入或现有Skill离开时触发</li>
<li><strong>Group删除</strong>：当所有Skill离开或所有者删除Group时触发</li>
</ul>
<h2 data-id="heading-12">四、Where：Scene与Group机制在系统架构中的位置？</h2>
<h3 data-id="heading-13">4.1 系统架构中的位置</h3>
<p>Scene与Group机制位于ooderAI Agent系统的协作管理层，连接了上层的业务逻辑和下层的执行引擎。它负责将抽象的业务需求转化为具体的协作任务，并组织合适的Skill完成这些任务。</p>
<h3 data-id="heading-14">4.2 与其他组件的关系</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aae32dbb2dde47089a14197f7e5f4a5f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT25lQ29kZUNO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769269439&amp;x-signature=MshY2Da4JTcpJzNEO1WCllmHDCY%3D" alt="Mermaid Diagram" loading="lazy"/></p>
<h3 data-id="heading-15">4.3 部署位置</h3>
<ul>
<li><strong>SceneManager</strong>：通常部署在MCP节点，作为系统级服务运行</li>
<li><strong>SceneDeclaration</strong>：分布在各个Route和Skill节点，通过消息队列与SceneManager通信</li>
<li><strong>SceneGroup信息</strong>：存储在分布式存储系统中，确保高可用性和一致性</li>
</ul>
<h2 data-id="heading-16">五、Why：为什么需要Scene与Group机制？</h2>
<h3 data-id="heading-17">5.1 设计理念</h3>
<p>Scene与Group机制的设计基于以下核心理念：</p>
<ul>
<li><strong>自主协作</strong>：Agent和Skill可以自主声明和发现协作机会，无需手动配置</li>
<li><strong>场景驱动</strong>：基于场景组织协作，使协作更有针对性和效率</li>
<li><strong>动态调整</strong>：支持协作组的动态形成和调整，适应系统变化</li>
<li><strong>松耦合</strong>：通过场景抽象，降低Agent和Skill之间的直接依赖</li>
</ul>
<h3 data-id="heading-18">5.2 解决的核心问题</h3>
<ol>
<li><strong>协作复杂性问题</strong>：在多Agent系统中，如何有效组织大量Agent和Skill进行协作是一个核心挑战。Scene与Group机制通过场景抽象和自动组形成，简化了协作管理。</li>
<li><strong>动态扩展性问题</strong>：传统的协作机制难以适应系统规模的动态变化。Scene与Group机制支持Skill的动态加入和离开，使系统具有良好的扩展性。</li>
<li><strong>资源利用率问题</strong>：如何将合适的Skill分配给合适的任务是提高资源利用率的关键。Scene与Group机制通过场景匹配，实现了资源的高效分配。</li>
<li><strong>系统鲁棒性问题</strong>：当某个Skill故障时，如何保证系统的继续运行是一个重要问题。Scene与Group机制支持Skill的动态替换，提高了系统的鲁棒性。</li>
</ol>
<h3 data-id="heading-19">5.3 带来的价值</h3>
<ul>
<li><strong>降低开发成本</strong>：开发者无需手动配置协作关系，只需关注业务逻辑</li>
<li><strong>提高系统灵活性</strong>：支持动态调整协作关系，适应业务变化</li>
<li><strong>增强系统可扩展性</strong>：支持大规模Agent和Skill的协作管理</li>
<li><strong>提高资源利用率</strong>：实现资源的按需分配和动态调整</li>
<li><strong>增强系统鲁棒性</strong>：支持故障转移和动态替换</li>
</ul>
<h2 data-id="heading-20">六、How：Scene与Group机制如何实现多Agent自主协作？</h2>
<h3 data-id="heading-21">6.1 多Agent协作工作流程详解</h3>
<h4 data-id="heading-22">6.1.1 多Agent场景声明与组形成流程</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d0d198dfa6bd425b904b4d2245f2214f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT25lQ29kZUNO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769269439&amp;x-signature=1SuNkdmDD7ygbPPFIYZgYokbpDE%3D" alt="Mermaid Diagram" loading="lazy"/></p>
<h4 data-id="heading-23">6.1.2 多Agent协作组自动形成过程</h4>
<ol>
<li><strong>步骤1：Scene所有者声明</strong>
<ul>
<li>Route/MCP通过SceneDeclare命令声明为某个Scene的所有者</li>
<li>SceneManager存储所有者信息，为<strong>多Agent协作</strong>创建基础</li>
</ul>
</li>
<li><strong>步骤2：Skill场景支持声明</strong>
<ul>
<li>Skill通过SceneDeclare命令声明支持某个Scene</li>
<li>指定Skill角色(agentRoute/endAgent)，明确<strong>多Agent协作</strong>中的角色定位</li>
<li>SceneManager存储Skill声明信息，构建<strong>多Agent协作</strong>资源池</li>
</ul>
</li>
<li><strong>步骤3：自动组形成条件检查</strong>
<ul>
<li>SceneManager检查该Scene是否同时满足：
<ul>
<li>存在所有者</li>
<li>存在至少一个Skill声明</li>
</ul>
</li>
<li>满足条件则触发<strong>多Agent协作组</strong>自动形成</li>
</ul>
</li>
<li><strong>步骤4：多Agent协作组创建</strong>
<ul>
<li>生成Group ID：格式为"group_场景类型_所有者"</li>
<li>创建SceneGroup对象，包含<strong>多Agent/Skill协作列表</strong>、组所有者和组管理规则</li>
<li>存储SceneGroup信息，完成<strong>多Agent协作团队</strong>的组建</li>
</ul>
</li>
<li><strong>步骤5：通知相关方</strong>
<ul>
<li>通知Scene所有者：新的<strong>多Agent协作组</strong>已创建</li>
<li>通知所有相关Skill：已加入新的<strong>多Agent协作组</strong>，可以开始协作</li>
</ul>
</li>
</ol>
<h4 data-id="heading-24">6.1.3 多Agent任务协作执行流程</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/04b0763becac4872ac0caf4987eb5055~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT25lQ29kZUNO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769269439&amp;x-signature=2stRqiyixby0GUDw%2BJu8QUD8LMk%3D" alt="Mermaid Diagram" loading="lazy"/></p>
<p>这个<strong>多Agent协作执行流程</strong>展示了ooderAI Agent系统如何实现高效的任务分配和执行：</p>
<ul>
<li><strong>任务分发</strong>：SceneGroup将业务请求分发给agentRoute角色的Skill</li>
<li><strong>子任务分配</strong>：agentRoute作为<strong>多Agent协调者</strong>，将任务分解为子任务并分配给多个endAgent</li>
<li><strong>并行执行</strong>：多个endAgent作为<strong>多Agent执行者</strong>，并行执行子任务</li>
<li><strong>结果聚合</strong>：agentRoute聚合所有执行结果，形成最终响应</li>
<li><strong>结果返回</strong>：将聚合结果返回给Scene所有者，完成业务请求</li>
</ul>
<p>这种设计实现了<strong>多Agent间的高效协作</strong>，充分利用了系统资源，提高了任务执行效率。</p>
<h3 data-id="heading-25">6.2 核心命令体系</h3>
<h4 data-id="heading-26">6.2.1 Scene管理命令</h4>























<table><thead><tr><th align="left">命令名称</th><th align="left">描述</th><th align="left">调用方</th><th align="left">主要参数</th></tr></thead><tbody><tr><td align="left">SceneDeclare</td><td align="left">场景声明</td><td align="left">Route/MCP/Skill</td><td align="left">sceneOwner, sceneType, skillId, skillRole, isOwnerDeclaration</td></tr><tr><td align="left">SceneDeclareCancel</td><td align="left">取消场景声明</td><td align="left">Route/MCP/Skill</td><td align="left">sceneType, skillId</td></tr></tbody></table>
<h4 data-id="heading-27">6.2.2 Group管理命令</h4>















































<table><thead><tr><th align="left">命令名称</th><th align="left">描述</th><th align="left">调用方</th><th align="left">主要参数</th></tr></thead><tbody><tr><td align="left">SceneGroupCreate</td><td align="left">创建场景组</td><td align="left">Scene所有者</td><td align="left">groupId, sceneType, groupName, skillIds</td></tr><tr><td align="left">SceneGroupUpdate</td><td align="left">更新场景组</td><td align="left">Scene所有者</td><td align="left">groupId, groupName, skillIds</td></tr><tr><td align="left">SceneGroupDelete</td><td align="left">删除场景组</td><td align="left">Scene所有者</td><td align="left">groupId</td></tr><tr><td align="left">SceneGroupAddSkill</td><td align="left">添加Skill到场景组</td><td align="left">Scene所有者</td><td align="left">groupId, skillId</td></tr><tr><td align="left">SceneGroupRemoveSkill</td><td align="left">从场景组移除Skill</td><td align="left">Scene所有者</td><td align="left">groupId, skillId</td></tr><tr><td align="left">SceneGroupQuery</td><td align="left">查询场景组信息</td><td align="left">任意角色</td><td align="left">groupId</td></tr></tbody></table>
<h2 data-id="heading-28">七、实战案例：工作日报自动生成场景</h2>
<h3 data-id="heading-29">7.1 场景描述</h3>
<p><strong>场景类型</strong>：REPORTING（报告生成场景）</p>
<p><strong>场景所有者</strong>：Route节点</p>
<p><strong>参与Skill</strong>：</p>
<ul>
<li>工作日报Skill（agentRoute角色）：负责聚合各系统数据，生成工作日报</li>
<li>邮件Skill（endAgent角色）：负责发送工作日报邮件</li>
<li>OA系统Skill（endAgent角色）：负责获取OA系统中的审批数据</li>
<li>项目管理Skill（endAgent角色）：负责获取项目进度数据</li>
</ul>
<h3 data-id="heading-30">7.2 实现过程</h3>
<ol>
<li><strong>Scene所有者声明</strong>
<ul>
<li>Route节点启动时，通过SceneDeclare命令声明为REPORTING场景的所有者</li>
<li>命令参数：sceneType=REPORTING, isOwnerDeclaration=true, sceneOwner=route_001</li>
</ul>
</li>
<li><strong>Skill场景支持声明</strong>
<ul>
<li>工作日报Skill注册时，声明支持REPORTING场景，角色为agentRoute</li>
<li>邮件Skill注册时，声明支持REPORTING场景，角色为endAgent</li>
<li>OA系统Skill注册时，声明支持REPORTING场景，角色为endAgent</li>
<li>项目管理Skill注册时，声明支持REPORTING场景，角色为endAgent</li>
</ul>
</li>
<li><strong>自动Group形成</strong>
<ul>
<li>SceneManager检测到REPORTING场景同时有所有者和多个Skill声明</li>
<li>自动创建SceneGroup：groupId=group_report_route_001</li>
<li>组内包含所有声明支持该场景的Skill</li>
</ul>
</li>
<li><strong>任务执行</strong>
<ul>
<li>每天17:30，Route节点向groupId=group_report_route_001发送生成工作日报的命令</li>
<li>工作日报Skill（agentRoute）接收命令，向OA系统Skill和项目管理Skill发送数据查询请求</li>
<li>OA系统Skill返回当天的审批数据</li>
<li>项目管理Skill返回当天的项目进度数据</li>
<li>工作日报Skill聚合所有数据，生成工作日报</li>
<li>工作日报Skill向邮件Skill发送发送邮件请求，包含生成的工作日报</li>
<li>邮件Skill发送工作日报邮件给相关人员</li>
</ul>
</li>
</ol>
<h3 data-id="heading-31">7.3 动态调整</h3>
<ul>
<li><strong>新Skill加入</strong>：如果后续有新的HR系统Skill声明支持REPORTING场景，SceneManager会自动将其添加到group_report_route_001组中</li>
<li><strong>Skill离开</strong>：如果项目管理Skill暂时不可用，SceneManager会将其从组中移除，工作日报Skill会自动调整数据聚合逻辑</li>
</ul>
<h2 data-id="heading-32">八、设计亮点与创新</h2>
<h3 data-id="heading-33">8.1 自主协作机制</h3>
<p>ooderAI Agent的Scene与Group机制实现了真正的自主协作，Agent和Skill可以自主声明和发现协作机会，无需人工干预。这种设计极大地提高了系统的灵活性和可扩展性。</p>
<h3 data-id="heading-34">8.2 场景驱动设计</h3>
<p>通过场景驱动的设计，系统可以根据不同的业务需求自动组织合适的协作资源，实现了资源的按需分配和动态调整。</p>
<h3 data-id="heading-35">8.3 动态扩展性</h3>
<p>支持Skill的动态加入和离开，使系统能够适应业务需求的变化和系统规模的扩展。</p>
<h3 data-id="heading-36">8.4 角色清晰分工</h3>
<p>将Skill分为agentRoute和endAgent两种角色，明确了各角色的职责和协作关系，提高了系统的可维护性和可靠性。</p>
<h3 data-id="heading-37">8.5 完整的命令体系</h3>
<p>提供了完整的Scene和Group管理命令，便于系统管理和监控，支持从声明到执行的全生命周期管理。</p>
<h2 data-id="heading-38">九、未来发展方向</h2>
<h3 data-id="heading-39">9.1 增强场景类型设计</h3>
<ul>
<li>增加业务场景类型，支持更多业务需求</li>
<li>支持自定义场景类型，提高系统灵活性</li>
<li>实现场景类型的层级关系，便于场景管理</li>
</ul>
<h3 data-id="heading-40">9.2 完善场景组机制</h3>
<ul>
<li>支持一个场景下形成多个场景组</li>
<li>实现场景组的动态调整和优化</li>
<li>支持场景组的负载均衡和容错机制</li>
</ul>
<h3 data-id="heading-41">9.3 丰富Skill角色</h3>
<ul>
<li>增加更多Skill角色类型，支持复杂协作模式</li>
<li>实现角色的动态转换和权限调整</li>
<li>支持角色间的协作协议</li>
</ul>
<h3 data-id="heading-42">9.4 增强跨场景协作</h3>
<ul>
<li>设计场景间的关联机制</li>
<li>实现跨场景的命令路由和协作</li>
<li>保障跨场景协作的安全性和可靠性</li>
</ul>
<h2 data-id="heading-43">十、结论</h2>
<p>ooderAI Agent的Scene与Group机制是一种创新的多Agent协作管理方式，它通过自主协作、场景驱动、动态扩展等设计理念，解决了传统多Agent系统中的协作复杂性、动态扩展性、资源利用率和系统鲁棒性等核心问题。</p>
<p>这一机制的实现，为大规模Agent系统的协作管理提供了一种高效、灵活、可靠的解决方案，具有广阔的应用前景。随着技术的不断发展和完善，Scene与Group机制将在更多领域发挥重要作用，推动多Agent系统向更高层次发展。</p>
<h2 data-id="heading-44">附录：核心类与接口</h2>
<ul>
<li><strong>Command.java</strong>：命令基类，定义了命令的基本结构</li>
<li><strong>SceneType.java</strong>：场景类型枚举，定义了场景类型</li>
<li><strong>SceneDeclarationCommand.java</strong>：场景声明命令，用于场景声明</li>
<li><strong>SceneGroupCommand.java</strong>：场景组命令，用于场景组管理</li>
<li><strong>SceneManager.java</strong>：场景管理器，负责场景和组管理</li>
<li><strong>CommandEnums.java</strong>：命令枚举，定义了所有命令类型</li>
</ul>
<hr/>
<p><strong>作者</strong>：ooderAI Agent系统设计团队</p>
<p><strong>发布日期</strong>：2026-01-17</p>
<p><strong>版本</strong>：v1.0</p>
<p><strong>版权所有</strong>：ooderAI</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Maven终极实战指南：从零入门到企业级项目构建-含Maven Wrapper与全命令解析]]></title>    <link>https://juejin.cn/post/7595901379015180298</link>    <guid>https://juejin.cn/post/7595901379015180298</guid>    <pubDate>2026-01-17T15:59:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595901379015180298" data-draft-id="7595894884957650995" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Maven终极实战指南：从零入门到企业级项目构建-含Maven Wrapper与全命令解析"/> <meta itemprop="keywords" content="后端,Java,maven"/> <meta itemprop="datePublished" content="2026-01-17T15:59:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="苏渡苇"/> <meta itemprop="url" content="https://juejin.cn/user/729731453429159"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Maven终极实战指南：从零入门到企业级项目构建-含Maven Wrapper与全命令解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/729731453429159/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    苏渡苇
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T15:59:10.000Z" title="Sat Jan 17 2026 15:59:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body .octicon{display:inline-block;fill:currentColor;vertical-align:text-bottom}.markdown-body .anchor{float:left;line-height:1;margin-left:-20px;padding-right:4px}.markdown-body .anchor:focus{outline:none}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#1b1f23;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1:hover .anchor .octicon-link:before,.markdown-body h2:hover .anchor .octicon-link:before,.markdown-body h3:hover .anchor .octicon-link:before,.markdown-body h4:hover .anchor .octicon-link:before,.markdown-body h5:hover .anchor .octicon-link:before,.markdown-body h6:hover .anchor .octicon-link:before{width:16px;height:16px;content:" ";display:inline-block;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' aria-hidden='true'%3E%3Cpath fill-rule='evenodd' d='M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z'/%3E%3C/svg%3E")}.markdown-body{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;color:#24292e;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;font-size:16px;line-height:1.5;word-wrap:break-word}.markdown-body details{display:block}.markdown-body summary{display:list-item}.markdown-body a{background-color:initial}.markdown-body a:active,.markdown-body a:hover{outline-width:0}.markdown-body strong{font-weight:inherit;font-weight:bolder}.markdown-body h1{margin:.67em 0}.markdown-body img{border-style:none}.markdown-body code,.markdown-body kbd,.markdown-body pre{font-family:monospace,monospace;font-size:1em}.markdown-body hr{box-sizing:initial;overflow:visible}.markdown-body input{font:inherit;margin:0;overflow:visible}.markdown-body [type=checkbox]{box-sizing:border-box;padding:0}.markdown-body *{box-sizing:border-box}.markdown-body input{font-family:inherit;font-size:inherit;line-height:inherit}.markdown-body a{color:#0366d6;text-decoration:none}.markdown-body a:hover{text-decoration:underline}.markdown-body strong{font-weight:600}.markdown-body hr{height:0;margin:15px 0;overflow:hidden;background:transparent;border-bottom:1px solid #dfe2e5}.markdown-body hr:after,.markdown-body hr:before{display:table;content:""}.markdown-body hr:after{clear:both}.markdown-body table{border-spacing:0;border-collapse:collapse}.markdown-body td,.markdown-body th{padding:0}.markdown-body details summary{cursor:pointer}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:0;margin-bottom:0}.markdown-body h1{font-size:32px}.markdown-body h1,.markdown-body h2{font-weight:600}.markdown-body h2{font-size:24px}.markdown-body h3{font-size:20px}.markdown-body h3,.markdown-body h4{font-weight:600}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:14px}.markdown-body h5,.markdown-body h6{font-weight:600}.markdown-body h6{font-size:12px}.markdown-body p{margin-top:0;margin-bottom:10px}.markdown-body blockquote{margin:0}.markdown-body ol,.markdown-body ul{padding-left:0;margin-top:0;margin-bottom:0}.markdown-body ol ol,.markdown-body ul ol{list-style-type:lower-roman}.markdown-body ol ol ol,.markdown-body ol ul ol,.markdown-body ul ol ol,.markdown-body ul ul ol{list-style-type:lower-alpha}.markdown-body dd{margin-left:0}.markdown-body code,.markdown-body pre{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px}.markdown-body pre{margin-top:0;margin-bottom:0}.markdown-body input::-webkit-inner-spin-button,.markdown-body input::-webkit-outer-spin-button{margin:0;-webkit-appearance:none;appearance:none}.markdown-body :checked+.radio-label{position:relative;z-index:1;border-color:#0366d6}.markdown-body .border{border:1px solid #e1e4e8!important}.markdown-body .border-0{border:0!important}.markdown-body .border-bottom{border-bottom:1px solid #e1e4e8!important}.markdown-body .rounded-1{border-radius:3px!important}.markdown-body .bg-white{background-color:#fff!important}.markdown-body .bg-gray-light{background-color:#fafbfc!important}.markdown-body .text-gray-light{color:#6a737d!important}.markdown-body .pl-3,.markdown-body .px-3{padding-left:16px!important}.markdown-body .px-3{padding-right:16px!important}.markdown-body .f6{font-size:12px!important}.markdown-body .lh-condensed{line-height:1.25!important}.markdown-body .text-bold{font-weight:600!important}.markdown-body .pl-c{color:#6a737d}.markdown-body .pl-c1,.markdown-body .pl-s .pl-v{color:#005cc5}.markdown-body .pl-e,.markdown-body .pl-en{color:#6f42c1}.markdown-body .pl-s .pl-s1,.markdown-body .pl-smi{color:#24292e}.markdown-body .pl-ent{color:#22863a}.markdown-body .pl-k{color:#d73a49}.markdown-body .pl-pds,.markdown-body .pl-s,.markdown-body .pl-s .pl-pse .pl-s1,.markdown-body .pl-sr,.markdown-body .pl-sr .pl-cce,.markdown-body .pl-sr .pl-sra,.markdown-body .pl-sr .pl-sre{color:#032f62}.markdown-body .pl-smw,.markdown-body .pl-v{color:#e36209}.markdown-body .pl-bu{color:#b31d28}.markdown-body .pl-ii{color:#fafbfc;background-color:#b31d28}.markdown-body .pl-c2{color:#fafbfc;background-color:#d73a49}.markdown-body .pl-c2:before{content:"^M"}.markdown-body .pl-sr .pl-cce{font-weight:700;color:#22863a}.markdown-body .pl-ml{color:#735c0f}.markdown-body .pl-mh,.markdown-body .pl-mh .pl-en,.markdown-body .pl-ms{font-weight:700;color:#005cc5}.markdown-body .pl-mi{font-style:italic;color:#24292e}.markdown-body .pl-mb{font-weight:700;color:#24292e}.markdown-body .pl-md{color:#b31d28;background-color:#ffeef0}.markdown-body .pl-mi1{color:#22863a;background-color:#f0fff4}.markdown-body .pl-mc{color:#e36209;background-color:#ffebda}.markdown-body .pl-mi2{color:#f6f8fa;background-color:#005cc5}.markdown-body .pl-mdr{font-weight:700;color:#6f42c1}.markdown-body .pl-ba{color:#586069}.markdown-body .pl-sg{color:#959da5}.markdown-body .pl-corl{text-decoration:underline;color:#032f62}.markdown-body .mb-0{margin-bottom:0!important}.markdown-body .my-2{margin-bottom:8px!important;margin-top:8px!important}.markdown-body .pl-0{padding-left:0!important}.markdown-body .py-0{padding-top:0!important;padding-bottom:0!important}.markdown-body .pl-1{padding-left:4px!important}.markdown-body .pl-2{padding-left:8px!important}.markdown-body .py-2{padding-top:8px!important;padding-bottom:8px!important}.markdown-body .pl-3{padding-left:16px!important}.markdown-body .pl-4{padding-left:24px!important}.markdown-body .pl-5{padding-left:32px!important}.markdown-body .pl-6{padding-left:40px!important}.markdown-body .pl-7{padding-left:48px!important}.markdown-body .pl-8{padding-left:64px!important}.markdown-body .pl-9{padding-left:80px!important}.markdown-body .pl-10{padding-left:96px!important}.markdown-body .pl-11{padding-left:112px!important}.markdown-body .pl-12{padding-left:128px!important}.markdown-body hr{border-bottom-color:#eee}.markdown-body kbd{display:inline-block;padding:3px 5px;font:11px SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #d1d5da;border-radius:3px;box-shadow:inset 0 -1px 0 #d1d5da}.markdown-body:after,.markdown-body:before{display:table;content:""}.markdown-body:after{clear:both}.markdown-body&gt;:first-child{margin-top:0!important}.markdown-body&gt;:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body blockquote,.markdown-body details,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body hr{height:.25em;padding:0;margin:24px 0;background-color:#e1e4e8;border:0}.markdown-body blockquote{padding:0 1em;color:#6a737d;border-left:.25em solid #dfe2e5}.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eaecef}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{font-size:.85em;color:#6a737d}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li{word-wrap:break-all}.markdown-body li&gt;p{margin-top:16px}.markdown-body li+li{margin-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:600}.markdown-body dl dd{padding:0 16px;margin-bottom:16px}.markdown-body table{display:block;width:100%;overflow:auto}.markdown-body table th{font-weight:600}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid #dfe2e5}.markdown-body table tr{background-color:#fff;border-top:1px solid #c6cbd1}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}.markdown-body img{max-width:100%;box-sizing:initial;background-color:#fff}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body code{padding:.2em .4em;margin:0;font-size:85%;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body pre{word-wrap:normal}.markdown-body pre&gt;code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:transparent;border:0}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f6f8fa;border-radius:3px}.markdown-body pre code{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:initial;border:0}.markdown-body .commit-tease-sha{display:inline-block;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:90%;color:#444d56}.markdown-body .full-commit .btn-outline:not(:disabled):hover{color:#005cc5;border-color:#005cc5}.markdown-body .blob-wrapper{overflow-x:auto;overflow-y:hidden}.markdown-body .blob-wrapper-embedded{max-height:240px;overflow-y:auto}.markdown-body .blob-num{width:1%;min-width:50px;padding-right:10px;padding-left:10px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;line-height:20px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;vertical-align:top;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-body .blob-num:hover{color:rgba(27,31,35,.6)}.markdown-body .blob-num:before{content:attr(data-line-number)}.markdown-body .blob-code{position:relative;padding-right:10px;padding-left:10px;line-height:20px;vertical-align:top}.markdown-body .blob-code-inner{overflow:visible;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;color:#24292e;word-wrap:normal;white-space:pre}.markdown-body .pl-token.active,.markdown-body .pl-token:hover{cursor:pointer;background:#ffea7f}.markdown-body .tab-size[data-tab-size="1"]{-moz-tab-size:1;tab-size:1}.markdown-body .tab-size[data-tab-size="2"]{-moz-tab-size:2;tab-size:2}.markdown-body .tab-size[data-tab-size="3"]{-moz-tab-size:3;tab-size:3}.markdown-body .tab-size[data-tab-size="4"]{-moz-tab-size:4;tab-size:4}.markdown-body .tab-size[data-tab-size="5"]{-moz-tab-size:5;tab-size:5}.markdown-body .tab-size[data-tab-size="6"]{-moz-tab-size:6;tab-size:6}.markdown-body .tab-size[data-tab-size="7"]{-moz-tab-size:7;tab-size:7}.markdown-body .tab-size[data-tab-size="8"]{-moz-tab-size:8;tab-size:8}.markdown-body .tab-size[data-tab-size="9"]{-moz-tab-size:9;tab-size:9}.markdown-body .tab-size[data-tab-size="10"]{-moz-tab-size:10;tab-size:10}.markdown-body .tab-size[data-tab-size="11"]{-moz-tab-size:11;tab-size:11}.markdown-body .tab-size[data-tab-size="12"]{-moz-tab-size:12;tab-size:12}.markdown-body .task-list-item{list-style-type:none}.markdown-body .task-list-item+.task-list-item{margin-top:3px}.markdown-body .task-list-item input{margin:0 .2em .25em -1.6em;vertical-align:middle}</style><style data-highlight="" data-highlight-key="github">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>温馨提示：本文关于配置的内容较长您可根据目录大纲，直接跳转到最困扰你的章节。建议搭配咖啡☕或茶🍵享用，风味更佳~</strong></p>
<h2 data-id="heading-0">前言</h2>
<p>Maven是Java生态系统中最流行的 <strong>项目管理和构建自动化</strong> 工具之一。</p>
<p>它通过标准的项目结构和约定的配置方式，简化了项目的构建、依赖管理和部署过程。</p>
<p>本文将深入探讨Maven的核心概念、命令使用、高级技巧以及IDE集成。</p>
<h2 data-id="heading-1">一、Maven基础概念</h2>
<h3 data-id="heading-2">1.1 Maven是什么？</h3>
<p>Maven是一个基于项目对象模型 - <strong>Project Object Model (POM)</strong> 的项目管理工具，它包含了：</p>
<ul>
<li><strong>项目构建</strong>：编译、测试、打包、部署</li>
<li><strong>依赖管理</strong>：自动下载和管理项目依赖，自动下载、传递依赖、解决冲突</li>
<li><strong>项目信息管理</strong>：文档生成、报告生成</li>
<li><strong>项目生命周期管理</strong>：标准化的构建过程，clean → default → site 三大生命周期，每个阶段绑定插件目标</li>
</ul>
<h3 data-id="heading-3">1.2 Maven安装与配置</h3>
<h4 data-id="heading-4">安装Maven</h4>
<blockquote>
<p>操作是在 Linux 环境下</p>
</blockquote>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 下载最新版Maven</span>
wget https://dlcdn.apache.org/maven/maven-3/3.9.12/binaries/apache-maven-3.9.12-bin.tar.gz
tar -zxvf apache-maven-3.9.12-bin.tar.gz  -C /home/warehouse/
</code></pre>
<p>此时可以修改构建部件的存储位置以及中央仓库地址，如果不修改，那么构建的结果部件将会存储到默认位置 <code>${user.home}/.m2/repository</code> ，拉取镜像是从默认的中央仓库拉取（网络不好的情况下可能很慢甚至拉取失败）。</p>
<p>建议修改：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> /home/warehouse/apache-maven-3.9.12/conf
vim settings.xml
</code></pre>
<p>根据需要修改如下配置：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">localRepository</span>&gt;</span>/home/mvn_repo<span class="hljs-tag">&lt;/<span class="hljs-name">localRepository</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">mirror</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>aliyunmaven<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">mirrorOf</span>&gt;</span>*<span class="hljs-tag">&lt;/<span class="hljs-name">mirrorOf</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>阿里云公共仓库<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>https://maven.aliyun.com/repository/public<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mirror</span>&gt;</span>
</code></pre>
<h4 data-id="heading-5">环境变量配置</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 在~/.bashrc或~/.zshrc中添加</span>
<span class="hljs-built_in">export</span> MAVEN_HOME=/home/warehouse/apache-maven-3.9.12
<span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$MAVEN_HOME</span>/bin:<span class="hljs-variable">$PATH</span>

<span class="hljs-comment"># 验证安装</span>
mvn -v
</code></pre>
<pre><code class="hljs language-bash" lang="bash">[root@local-dev conf]<span class="hljs-comment"># vim settings.xml </span>
[root@local-dev conf]<span class="hljs-comment"># </span>
[root@local-dev conf]<span class="hljs-comment"># vim ~/.bashrc</span>
[root@local-dev conf]<span class="hljs-comment"># source ~/.bashrc</span>
[root@local-dev conf]<span class="hljs-comment"># mvn -v</span>
Apache Maven 3.9.12 (848fbb4bf2d427b72bdb2471c22fced7ebd9a7a1)
Maven home: /home/warehouse/apache-maven-3.9.12
Java version: 1.8.0_421, vendor: Oracle Corporation, runtime: /home/warehouse/jdk1.8.0_421/jre
Default locale: en_US, platform encoding: UTF-8
OS name: <span class="hljs-string">"linux"</span>, version: <span class="hljs-string">"5.14.0-570.17.1.el9_6.x86_64"</span>, <span class="hljs-built_in">arch</span>: <span class="hljs-string">"amd64"</span>, family: <span class="hljs-string">"unix"</span>
[root@local-dev conf]<span class="hljs-comment"># </span>

</code></pre>
<p>windows 环境下配置 maven 非常简单，解压后，在系统属性的高级属性中配置环境变量：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64d7a20171c042cf9540d9178196d842~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5rih6IuH:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769270349&amp;x-signature=xVZFjbn5T%2FEbWmG9lyTBVB%2B79Yo%3D" alt="" loading="lazy"/></p>
<p>之后，在powersherll终端验证：</p>
<pre><code class="hljs language-powershell" lang="powershell">PS C:\Users\adm&gt; mvn -v
Apache Maven 3.9.9 (8e8579a9e76f7d015ee5ec7bfcdc97d260186937)
Maven home: D:\Java\apache-maven-3.9.9
Java version: 1.8.0_421, vendor: Oracle Corporation, runtime: D:\Java\java-8\jdk-1.8\jre
Default locale: zh_CN, platform encoding: GBK
OS name: "windows 11", version: "10.0", arch: "amd64", family: "windows"
</code></pre>
<h2 data-id="heading-6">二、创建Maven项目</h2>
<blockquote>
<p>现在从 IDE 上创建 maven 项目非常简单，这里不在赘述。</p>
<p>当然如果你就想使用命令行创建，可以使用Maven Archetype这样创建：</p>
<pre><code class="hljs language-bash" lang="bash">mvn archetype:generate \
  -DgroupId=com.example \
  -DartifactId=my-app \
  -DarchetypeArtifactId=maven-archetype-quickstart \
  -DinteractiveMode=<span class="hljs-literal">false</span> \
  -Dversion=1.0.0
</code></pre>
<pre><code class="hljs language-bash" lang="bash">mvn archetype:generate \
  -DgroupId=com.example \
  -DartifactId=my-webapp \
  -DarchetypeArtifactId=maven-archetype-webapp \
  -DinteractiveMode=<span class="hljs-literal">false</span>
</code></pre>
</blockquote>
<p>这里，我以我以我的开源项目 <code>spring-insight-sca-demo</code>  为例，进行maven操作展示。</p>
<blockquote>
<p>项目地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fiweidujiang%2Fspring-insight-sca-demo" target="_blank" title="https://github.com/iweidujiang/spring-insight-sca-demo" ref="nofollow noopener noreferrer">github.com/iweidujiang…</a></p>
</blockquote>
<h3 data-id="heading-7">2.1 项目结构解析</h3>
<p>一个maven项目的项目结构大致如下：</p>
<pre><code class="hljs language-less" lang="less">项目根目录
│
├── <span class="hljs-selector-tag">src</span>
│   ├── <span class="hljs-selector-tag">main</span>
│   │   ├── <span class="hljs-selector-tag">java</span>        <span class="hljs-comment">// 主代码</span>
│   │   └── <span class="hljs-selector-tag">resources</span>   <span class="hljs-comment">// 主资源文件</span>
│   └── <span class="hljs-selector-tag">test</span>
│       ├── <span class="hljs-selector-tag">java</span>        <span class="hljs-comment">// 测试代码</span>
│       └── <span class="hljs-selector-tag">resources</span>   <span class="hljs-comment">// 测试资源文件</span>
│
├── <span class="hljs-selector-tag">target</span>              <span class="hljs-comment">// 编译输出目录</span>
│
└── <span class="hljs-selector-tag">pom</span><span class="hljs-selector-class">.xml</span>            <span class="hljs-comment">// 项目对象模型文件</span>
</code></pre>
<p>比如：</p>
<pre><code class="hljs language-css" lang="css">│  <span class="hljs-selector-class">.gitignore</span>
│  pom<span class="hljs-selector-class">.xml</span>
│
└─<span class="hljs-attribute">src</span>
    ├─<span class="hljs-selector-tag">main</span>
    │  ├─java
    │  │  └─io
    │  │      └─github
    │  │          └─iweidujiang
    │  │              └─gateway
    │  │                      ScaGatewayApplication<span class="hljs-selector-class">.java</span>
    │  │
    │  └─resources
    └─test
        └─java
            └─io
                └─github
                    └─iweidujiang
                        └─gateway
                                ScaGatewayApplicationTests<span class="hljs-selector-class">.java</span>
</code></pre>
<h3 data-id="heading-8">2.2 POM.XML整体结构解析</h3>
<h4 data-id="heading-9">2.2.1 基本骨架</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span>
         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0 
         http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 根元素，必须的命名空间和模式定义 --&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 固定值，表示使用的POM模型版本 --&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 坐标三要素：唯一标识一个项目 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.company.project<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-comment">&lt;!-- 组织或公司标识 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>my-application<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-comment">&lt;!-- 项目标识 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>         <span class="hljs-comment">&lt;!-- 版本号 --&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 打包类型：jar, war, pom, ear等 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>jar<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 项目名称和描述 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>My Application<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>A demo application for POM explanation<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>http://www.company.com<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 继承和聚合配置 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">modules</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">modules</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 项目信息：开发者、贡献者、许可证等 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">developers</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">developers</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">contributors</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">contributors</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">licenses</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">licenses</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 组织信息 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">organization</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">organization</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 源代码管理系统 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">scm</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">scm</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 问题跟踪系统 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">issueManagement</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">issueManagement</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 持续集成系统 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ciManagement</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">ciManagement</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 项目邮件列表 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">mailingLists</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">mailingLists</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 属性定义 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 依赖管理 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 依赖列表 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 构建配置 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 报告配置 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">reporting</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">reporting</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 环境配置 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">profiles</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">profiles</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span>
</code></pre>
<h4 data-id="heading-10">2.2.2 坐标与项目基本信息</h4>
<h5 data-id="heading-11">坐标系统详解</h5>
<p>坐标是Maven项目的唯一标识。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 坐标是Maven项目的唯一标识 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.company.division.project<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
<span class="hljs-comment">&lt;!-- 命名规范：反向域名 + 部门/产品线 + 项目名
     例如：com.company.division.project → 公司.部门.项目
     实际案例：com.alibaba.nacos.client --&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>my-application-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-comment">&lt;!-- 项目名称，通常使用小写字母和连字符
     命名规范：项目名-模块名[-子模块名]
     例如：spring-boot-starter-web --&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.5.1-RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-comment">&lt;!-- 版本号命名规范：
     - 主版本号.次版本号.修订号[-状态版本]
     - SNAPSHOT：开发版本，可被覆盖
     - RELEASE：正式版本，不可被覆盖
     - 示例：1.0.0, 2.1.3-SNAPSHOT, 3.0.0-RELEASE --&gt;</span>

<span class="hljs-comment">&lt;!-- 版本范围语法（在依赖中使用） --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>[1.0,2.0)<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>  <span class="hljs-comment">&lt;!-- 1.0 ≤ version &lt; 2.0 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>[1.0,2.0]<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>  <span class="hljs-comment">&lt;!-- 1.0 ≤ version ≤ 2.0 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>(,1.0]<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>     <span class="hljs-comment">&lt;!-- version ≤ 1.0 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>[1.0,)<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>     <span class="hljs-comment">&lt;!-- version ≥ 1.0 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>LATEST<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>     <span class="hljs-comment">&lt;!-- 最新版本（不推荐使用） --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>    <span class="hljs-comment">&lt;!-- 最新发布版（不推荐使用） --&gt;</span>
</code></pre>
<h5 data-id="heading-12">继承配置（parent）</h5>
<p>使用继承配置的好处：</p>
<ul>
<li>统一管理依赖版本</li>
<li>统一插件配置</li>
<li>统一构建配置</li>
<li>统一项目信息</li>
</ul>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 继承父POM，复用配置 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.7.18<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 相对路径，默认为../pom.xml --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 自定义父POM示例 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.company<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>company-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>&gt;</span>../parent/pom.xml<span class="hljs-tag">&lt;/<span class="hljs-name">relativePath</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span>
</code></pre>
<h5 data-id="heading-13">多模块聚合（modules）</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 父POM中定义子模块 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">modules</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>module1<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span>          <span class="hljs-comment">&lt;!-- 同级目录下的module1 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>../module2<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span>       <span class="hljs-comment">&lt;!-- 相对路径 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>subprojects/module3<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span> <span class="hljs-comment">&lt;!-- 子目录中的模块 --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">modules</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 实际企业项目示例 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">modules</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>ecommerce-common<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>ecommerce-domain<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>ecommerce-repository<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>ecommerce-service<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>ecommerce-api<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>ecommerce-web<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>ecommerce-batch<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">modules</span>&gt;</span>
</code></pre>
<h4 data-id="heading-14">2.2.3 属性配置（properties）</h4>
<h5 data-id="heading-15">预定义属性</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 1. 构建相关属性 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">project.reporting.outputEncoding</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 2. Java版本 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>21<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.source</span>&gt;</span>${java.version}<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.source</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.target</span>&gt;</span>${java.version}<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.target</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.release</span>&gt;</span>${java.version}<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.release</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 3. 项目版本 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">project.version</span>&gt;</span>1.0.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">project.version</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">revision</span>&gt;</span>${project.version}<span class="hljs-tag">&lt;/<span class="hljs-name">revision</span>&gt;</span>  <span class="hljs-comment">&lt;!-- Maven 3.5.0+ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">sha1</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">sha1</span>&gt;</span>                            <span class="hljs-comment">&lt;!-- Git commit hash --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">changelist</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">changelist</span>&gt;</span>                <span class="hljs-comment">&lt;!-- 用于版本后缀 --&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 4. 依赖版本（集中管理） --&gt;</span>
    <span class="hljs-comment">&lt;!-- Spring --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">spring-boot.version</span>&gt;</span>2.7.10<span class="hljs-tag">&lt;/<span class="hljs-name">spring-boot.version</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">spring-cloud.version</span>&gt;</span>2021.0.6<span class="hljs-tag">&lt;/<span class="hljs-name">spring-cloud.version</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 数据库 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">mysql.version</span>&gt;</span>8.0.33<span class="hljs-tag">&lt;/<span class="hljs-name">mysql.version</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">mybatis.version</span>&gt;</span>3.5.13<span class="hljs-tag">&lt;/<span class="hljs-name">mybatis.version</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">mybatis-plus.version</span>&gt;</span>3.5.3.1<span class="hljs-tag">&lt;/<span class="hljs-name">mybatis-plus.version</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 工具 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">lombok.version</span>&gt;</span>1.18.26<span class="hljs-tag">&lt;/<span class="hljs-name">lombok.version</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">mapstruct.version</span>&gt;</span>1.5.5.Final<span class="hljs-tag">&lt;/<span class="hljs-name">mapstruct.version</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">guava.version</span>&gt;</span>31.1-jre<span class="hljs-tag">&lt;/<span class="hljs-name">guava.version</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 测试 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">junit.version</span>&gt;</span>5.9.2<span class="hljs-tag">&lt;/<span class="hljs-name">junit.version</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">mockito.version</span>&gt;</span>5.3.1<span class="hljs-tag">&lt;/<span class="hljs-name">mockito.version</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 5. 插件版本 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">maven-compiler-plugin.version</span>&gt;</span>3.11.0<span class="hljs-tag">&lt;/<span class="hljs-name">maven-compiler-plugin.version</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">maven-surefire-plugin.version</span>&gt;</span>3.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">maven-surefire-plugin.version</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">maven-failsafe-plugin.version</span>&gt;</span>3.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">maven-failsafe-plugin.version</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 6. 环境相关 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">env</span>&gt;</span>dev<span class="hljs-tag">&lt;/<span class="hljs-name">env</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">active.profile</span>&gt;</span>${env}<span class="hljs-tag">&lt;/<span class="hljs-name">active.profile</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 7. 自定义属性 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">company.name</span>&gt;</span>MyCompany<span class="hljs-tag">&lt;/<span class="hljs-name">company.name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">project.license</span>&gt;</span>Apache-2.0<span class="hljs-tag">&lt;/<span class="hljs-name">project.license</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">docker.registry</span>&gt;</span>registry.company.com<span class="hljs-tag">&lt;/<span class="hljs-name">docker.registry</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">docker.namespace</span>&gt;</span>${company.name}<span class="hljs-tag">&lt;/<span class="hljs-name">docker.namespace</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 8. 系统属性引用 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">user.home</span>&gt;</span>${user.home}<span class="hljs-tag">&lt;/<span class="hljs-name">user.home</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">java.io.tmpdir</span>&gt;</span>${java.io.tmpdir}<span class="hljs-tag">&lt;/<span class="hljs-name">java.io.tmpdir</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 9. Maven属性 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">project.basedir</span>&gt;</span>${project.basedir}<span class="hljs-tag">&lt;/<span class="hljs-name">project.basedir</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">project.build.directory</span>&gt;</span>${project.build.directory}<span class="hljs-tag">&lt;/<span class="hljs-name">project.build.directory</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">project.build.outputDirectory</span>&gt;</span>${project.build.outputDirectory}<span class="hljs-tag">&lt;/<span class="hljs-name">project.build.outputDirectory</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 10. 条件属性 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">skipTests</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">skipTests</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">skipITs</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">skipITs</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">skip.docker.build</span>&gt;</span>${skipTests}<span class="hljs-tag">&lt;/<span class="hljs-name">skip.docker.build</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>
</code></pre>
<h5 data-id="heading-16">属性优先级和作用域</h5>
<p>在 <code>pom.xml</code> 中定义的属性查找顺序从高到低排列如下：</p>
<ol>
<li>命令行属性：-Dproperty=value</li>
<li>POM中的properties</li>
<li>settings.xml中的properties</li>
<li>系统属性</li>
<li>环境变量</li>
<li>资源过滤中的properties文件</li>
</ol>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 属性查找顺序（从高到低）：
     1. 命令行属性：-Dproperty=value
     2. POM中的properties
     3. settings.xml中的properties
     4. 系统属性
     5. 环境变量
     6. 资源过滤中的properties文件 --&gt;</span>

<span class="hljs-comment">&lt;!-- 示例：不同来源的属性 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- POM中的属性 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">app.name</span>&gt;</span>MyApp<span class="hljs-tag">&lt;/<span class="hljs-name">app.name</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 引用settings.xml中的属性 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">nexus.url</span>&gt;</span>${settings.nexus.url}<span class="hljs-tag">&lt;/<span class="hljs-name">nexus.url</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 引用系统属性 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">line.separator</span>&gt;</span>${line.separator}<span class="hljs-tag">&lt;/<span class="hljs-name">line.separator</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 引用环境变量 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">jenkins.build.number</span>&gt;</span>${env.BUILD_NUMBER}<span class="hljs-tag">&lt;/<span class="hljs-name">jenkins.build.number</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>
</code></pre>
<h4 data-id="heading-17">2.2.4 依赖管理（dependencies &amp; dependencyManagement）</h4>
<h5 data-id="heading-18">依赖声明详解</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 1. 编译期依赖（默认scope） --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${spring-boot.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 不需要写version，如果父POM或dependencyManagement中已定义 --&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 2. 依赖作用域（scope） --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 3. 依赖排除 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>ch.qos.logback<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>logback-classic<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>slf4j-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 4. 分类器（classifier） --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.spark<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spark-core_2.12<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.3.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">classifier</span>&gt;</span>hadoop3.2<span class="hljs-tag">&lt;/<span class="hljs-name">classifier</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 5. 系统依赖（不推荐） --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>custom-lib<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>system<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">systemPath</span>&gt;</span>${project.basedir}/lib/custom-lib.jar<span class="hljs-tag">&lt;/<span class="hljs-name">systemPath</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 6. 可选依赖 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.google.guava<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>guava<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${guava.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 7. 类型（type） --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>my-service<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span>  <span class="hljs-comment">&lt;!-- 导入pom类型的依赖 --&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 8. 测试依赖 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.junit.jupiter<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit-jupiter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${junit.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<h5 data-id="heading-19">依赖作用域详解</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- scope的六种类型 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 1. compile（默认）：编译、测试、运行都有效 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>compile<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 2. provided：编译和测试有效，运行时由容器提供 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>javax.servlet<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>javax.servlet-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 3. runtime：运行和测试有效，编译不需要 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 4. test：仅在测试时有效 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mockito<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mockito-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 5. system：类似provided，但需要指定systemPath --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.sun<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>tools<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>system<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">systemPath</span>&gt;</span>${java.home}/../lib/tools.jar<span class="hljs-tag">&lt;/<span class="hljs-name">systemPath</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 6. import：仅用于dependencyManagement中 --&gt;</span>
    <span class="hljs-comment">&lt;!-- 在dependencyManagement部分使用 --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<h5 data-id="heading-20">依赖管理（dependencyManagement）</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 父POM中的dependencyManagement --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 1. 统一管理依赖版本 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${spring-boot.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        
        <span class="hljs-comment">&lt;!-- 2. 自定义依赖版本管理 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-databind<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.14.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.google.guava<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>guava<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${guava.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        
        <span class="hljs-comment">&lt;!-- 3. 强制使用特定版本（覆盖传递依赖） --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>slf4j-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0.7<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        
        <span class="hljs-comment">&lt;!-- 4. BOM导入（Bill of Materials） --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${spring-cloud.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 子模块中只需声明groupId和artifactId --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.google.guava<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>guava<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 版本从父POM的dependencyManagement继承 --&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<h4 data-id="heading-21">2.2.5 构建配置（build）</h4>
<h5 data-id="heading-22">基础构建配置</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 1. 输出目录配置 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">directory</span>&gt;</span>${project.basedir}/target<span class="hljs-tag">&lt;/<span class="hljs-name">directory</span>&gt;</span>  <span class="hljs-comment">&lt;!-- 构建输出目录 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">outputDirectory</span>&gt;</span>${project.build.directory}/classes<span class="hljs-tag">&lt;/<span class="hljs-name">outputDirectory</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">testOutputDirectory</span>&gt;</span>${project.build.directory}/test-classes<span class="hljs-tag">&lt;/<span class="hljs-name">testOutputDirectory</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">sourceDirectory</span>&gt;</span>${project.basedir}/src/main/java<span class="hljs-tag">&lt;/<span class="hljs-name">sourceDirectory</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">testSourceDirectory</span>&gt;</span>${project.basedir}/src/test/java<span class="hljs-tag">&lt;/<span class="hljs-name">testSourceDirectory</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">resources</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">resource</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">directory</span>&gt;</span>${project.basedir}/src/main/resources<span class="hljs-tag">&lt;/<span class="hljs-name">directory</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">filtering</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">filtering</span>&gt;</span>  <span class="hljs-comment">&lt;!-- 是否启用资源过滤 --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">includes</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">include</span>&gt;</span>**/*.properties<span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">include</span>&gt;</span>**/*.xml<span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">include</span>&gt;</span>**/*.yml<span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">include</span>&gt;</span>**/*.yaml<span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">includes</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">excludes</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">exclude</span>&gt;</span>**/*.secret<span class="hljs-tag">&lt;/<span class="hljs-name">exclude</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">exclude</span>&gt;</span>**/test/**<span class="hljs-tag">&lt;/<span class="hljs-name">exclude</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">excludes</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">resource</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 多资源目录配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">resource</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">directory</span>&gt;</span>${project.basedir}/src/main/config<span class="hljs-tag">&lt;/<span class="hljs-name">directory</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">targetPath</span>&gt;</span>config<span class="hljs-tag">&lt;/<span class="hljs-name">targetPath</span>&gt;</span>  <span class="hljs-comment">&lt;!-- 输出到classes/config --&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">resource</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">resources</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">testResources</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">testResource</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">directory</span>&gt;</span>${project.basedir}/src/test/resources<span class="hljs-tag">&lt;/<span class="hljs-name">directory</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">filtering</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">filtering</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">testResource</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">testResources</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 2. 插件配置 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 编译器插件 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${maven-compiler-plugin.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">source</span>&gt;</span>${maven.compiler.source}<span class="hljs-tag">&lt;/<span class="hljs-name">source</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">target</span>&gt;</span>${maven.compiler.target}<span class="hljs-tag">&lt;/<span class="hljs-name">target</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">release</span>&gt;</span>${maven.compiler.release}<span class="hljs-tag">&lt;/<span class="hljs-name">release</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">encoding</span>&gt;</span>${project.build.sourceEncoding}<span class="hljs-tag">&lt;/<span class="hljs-name">encoding</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">parameters</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">parameters</span>&gt;</span>  <span class="hljs-comment">&lt;!-- 保留方法参数名 --&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">showWarnings</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">showWarnings</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">showDeprecation</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">showDeprecation</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">compilerArgs</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">arg</span>&gt;</span>-Xlint:all<span class="hljs-tag">&lt;/<span class="hljs-name">arg</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">arg</span>&gt;</span>-Xlint:-processing<span class="hljs-tag">&lt;/<span class="hljs-name">arg</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">arg</span>&gt;</span>-Werror<span class="hljs-tag">&lt;/<span class="hljs-name">arg</span>&gt;</span>  <span class="hljs-comment">&lt;!-- 将警告视为错误 --&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">compilerArgs</span>&gt;</span>
                <span class="hljs-comment">&lt;!-- 注解处理器配置 --&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">annotationProcessorPaths</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">path</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${lombok.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">path</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">path</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mapstruct<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mapstruct-processor<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${mapstruct.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">path</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">annotationProcessorPaths</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
        
        <span class="hljs-comment">&lt;!-- 测试插件 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-surefire-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${maven-surefire-plugin.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">skipTests</span>&gt;</span>${skipTests}<span class="hljs-tag">&lt;/<span class="hljs-name">skipTests</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">testFailureIgnore</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">testFailureIgnore</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">includes</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">include</span>&gt;</span>**/*Test.java<span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">include</span>&gt;</span>**/*Tests.java<span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">includes</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">excludes</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">exclude</span>&gt;</span>**/*IntegrationTest.java<span class="hljs-tag">&lt;/<span class="hljs-name">exclude</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">exclude</span>&gt;</span>**/*IT.java<span class="hljs-tag">&lt;/<span class="hljs-name">exclude</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">excludes</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">parallel</span>&gt;</span>classes<span class="hljs-tag">&lt;/<span class="hljs-name">parallel</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">threadCount</span>&gt;</span>4<span class="hljs-tag">&lt;/<span class="hljs-name">threadCount</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">forkCount</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">forkCount</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">reuseForks</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">reuseForks</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">argLine</span>&gt;</span>-Xmx512m<span class="hljs-tag">&lt;/<span class="hljs-name">argLine</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">systemPropertyVariables</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">java.awt.headless</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">java.awt.headless</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">user.timezone</span>&gt;</span>UTC<span class="hljs-tag">&lt;/<span class="hljs-name">user.timezone</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">systemPropertyVariables</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
        
        <span class="hljs-comment">&lt;!-- 集成测试插件 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-failsafe-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${maven-failsafe-plugin.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">skipITs</span>&gt;</span>${skipITs}<span class="hljs-tag">&lt;/<span class="hljs-name">skipITs</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">includes</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">include</span>&gt;</span>**/*IT.java<span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">include</span>&gt;</span>**/*IntegrationTest.java<span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">includes</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>integration-test<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>verify<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 3. 插件管理 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">pluginManagement</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${maven-compiler-plugin.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">pluginManagement</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 4. 扩展配置 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">extensions</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">extension</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.wagon<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>wagon-ssh<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.5.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">extension</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">extensions</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 5. 默认目标配置 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">defaultGoal</span>&gt;</span>install<span class="hljs-tag">&lt;/<span class="hljs-name">defaultGoal</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 6. 过滤器配置 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">filters</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">filter</span>&gt;</span>${project.basedir}/src/main/filters/${env}.properties<span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">filters</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>
</code></pre>
<h5 data-id="heading-23">高级插件配置示例</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 1. JAR打包插件 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-jar-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.3.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">archive</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">manifest</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">addClasspath</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">addClasspath</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">classpathPrefix</span>&gt;</span>lib/<span class="hljs-tag">&lt;/<span class="hljs-name">classpathPrefix</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">mainClass</span>&gt;</span>com.company.MainApplication<span class="hljs-tag">&lt;/<span class="hljs-name">mainClass</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">manifest</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">manifestEntries</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">Implementation-Title</span>&gt;</span>${project.name}<span class="hljs-tag">&lt;/<span class="hljs-name">Implementation-Title</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">Implementation-Version</span>&gt;</span>${project.version}<span class="hljs-tag">&lt;/<span class="hljs-name">Implementation-Version</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">Implementation-Vendor</span>&gt;</span>${company.name}<span class="hljs-tag">&lt;/<span class="hljs-name">Implementation-Vendor</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">Built-By</span>&gt;</span>${user.name}<span class="hljs-tag">&lt;/<span class="hljs-name">Built-By</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">Build-Timestamp</span>&gt;</span>${maven.build.timestamp}<span class="hljs-tag">&lt;/<span class="hljs-name">Build-Timestamp</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">Created-By</span>&gt;</span>Maven ${maven.version}<span class="hljs-tag">&lt;/<span class="hljs-name">Created-By</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">manifestEntries</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">archive</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">excludes</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">exclude</span>&gt;</span>**/*.properties<span class="hljs-tag">&lt;/<span class="hljs-name">exclude</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">exclude</span>&gt;</span>**/*.xml<span class="hljs-tag">&lt;/<span class="hljs-name">exclude</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">excludes</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
        
        <span class="hljs-comment">&lt;!-- 2. 资源插件 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-resources-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.3.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">delimiters</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">delimiter</span>&gt;</span>@<span class="hljs-tag">&lt;/<span class="hljs-name">delimiter</span>&gt;</span>  <span class="hljs-comment">&lt;!-- 默认是${}，可改为@ --&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">delimiters</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">useDefaultDelimiters</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">useDefaultDelimiters</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">escapeString</span>&gt;</span>\<span class="hljs-tag">&lt;/<span class="hljs-name">escapeString</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">overwrite</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">overwrite</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">includeEmptyDirs</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">includeEmptyDirs</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
        
        <span class="hljs-comment">&lt;!-- 3. 源码打包插件 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-source-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.2.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>attach-sources<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>verify<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>jar-no-fork<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
        
        <span class="hljs-comment">&lt;!-- 4. Javadoc插件 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-javadoc-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.5.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">show</span>&gt;</span>private<span class="hljs-tag">&lt;/<span class="hljs-name">show</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">nohelp</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">nohelp</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">detectJavaApiLink</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">detectJavaApiLink</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">doclint</span>&gt;</span>all<span class="hljs-tag">&lt;/<span class="hljs-name">doclint</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">failOnError</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">failOnError</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">source</span>&gt;</span>${maven.compiler.source}<span class="hljs-tag">&lt;/<span class="hljs-name">source</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">encoding</span>&gt;</span>${project.build.sourceEncoding}<span class="hljs-tag">&lt;/<span class="hljs-name">encoding</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">charset</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">charset</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">docencoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">docencoding</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>attach-javadocs<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>jar<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
        
        <span class="hljs-comment">&lt;!-- 5. 依赖拷贝插件 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-dependency-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.5.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>copy-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>package<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>copy-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">outputDirectory</span>&gt;</span>${project.build.directory}/lib<span class="hljs-tag">&lt;/<span class="hljs-name">outputDirectory</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">overWriteReleases</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">overWriteReleases</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">overWriteSnapshots</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">overWriteSnapshots</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">overWriteIfNewer</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">overWriteIfNewer</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">includeScope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">includeScope</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">excludeTransitive</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">excludeTransitive</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">silent</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">silent</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
        
        <span class="hljs-comment">&lt;!-- 6. Assembly插件（打包可执行JAR） --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-assembly-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.5.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">descriptorRefs</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">descriptorRef</span>&gt;</span>jar-with-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">descriptorRef</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">descriptorRefs</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">archive</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">manifest</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">mainClass</span>&gt;</span>com.company.MainApplication<span class="hljs-tag">&lt;/<span class="hljs-name">mainClass</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">manifest</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">archive</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">appendAssemblyId</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">appendAssemblyId</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>make-assembly<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>package<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>single<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
        
        <span class="hljs-comment">&lt;!-- 7. Spring Boot插件 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${spring-boot.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">mainClass</span>&gt;</span>com.company.MainApplication<span class="hljs-tag">&lt;/<span class="hljs-name">mainClass</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">layout</span>&gt;</span>JAR<span class="hljs-tag">&lt;/<span class="hljs-name">layout</span>&gt;</span>  <span class="hljs-comment">&lt;!-- JAR, WAR, ZIP, DIR, NONE --&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">executable</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">executable</span>&gt;</span>  <span class="hljs-comment">&lt;!-- 设置为true生成可执行脚本 --&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">classifier</span>&gt;</span>exec<span class="hljs-tag">&lt;/<span class="hljs-name">classifier</span>&gt;</span>  <span class="hljs-comment">&lt;!-- 分类器 --&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">excludes</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">exclude</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">exclude</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">excludes</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">jvmArguments</span>&gt;</span>-Xmx512m -Xms256m<span class="hljs-tag">&lt;/<span class="hljs-name">jvmArguments</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">arguments</span>&gt;</span>--spring.profiles.active=${env}<span class="hljs-tag">&lt;/<span class="hljs-name">arguments</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">embeddedLaunchScript</span>&gt;</span>launch.script<span class="hljs-tag">&lt;/<span class="hljs-name">embeddedLaunchScript</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>repackage<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
        
        <span class="hljs-comment">&lt;!-- 8. 版本插件 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.codehaus.mojo<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>versions-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.15.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">generateBackupPoms</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">generateBackupPoms</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">allowMajorUpdates</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">allowMajorUpdates</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">allowMinorUpdates</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">allowMinorUpdates</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">allowIncrementalUpdates</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">allowIncrementalUpdates</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">allowSnapshots</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">allowSnapshots</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">excludes</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">exclude</span>&gt;</span>org.springframework.boot:*<span class="hljs-tag">&lt;/<span class="hljs-name">exclude</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">excludes</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
        
        <span class="hljs-comment">&lt;!-- 9. 覆盖率插件 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.jacoco<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jacoco-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.8.9<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>prepare-agent<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>prepare-agent<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>report<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>verify<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>report<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">outputDirectory</span>&gt;</span>${project.build.directory}/jacoco-report<span class="hljs-tag">&lt;/<span class="hljs-name">outputDirectory</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>check<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>check<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">rules</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">rule</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">element</span>&gt;</span>BUNDLE<span class="hljs-tag">&lt;/<span class="hljs-name">element</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">limits</span>&gt;</span>
                                    <span class="hljs-tag">&lt;<span class="hljs-name">limit</span>&gt;</span>
                                        <span class="hljs-tag">&lt;<span class="hljs-name">counter</span>&gt;</span>INSTRUCTION<span class="hljs-tag">&lt;/<span class="hljs-name">counter</span>&gt;</span>
                                        <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>COVEREDRATIO<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
                                        <span class="hljs-tag">&lt;<span class="hljs-name">minimum</span>&gt;</span>0.80<span class="hljs-tag">&lt;/<span class="hljs-name">minimum</span>&gt;</span>
                                    <span class="hljs-tag">&lt;/<span class="hljs-name">limit</span>&gt;</span>
                                <span class="hljs-tag">&lt;/<span class="hljs-name">limits</span>&gt;</span>
                            <span class="hljs-tag">&lt;/<span class="hljs-name">rule</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">rules</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
        
        <span class="hljs-comment">&lt;!-- 10. 检查插件 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-checkstyle-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.2.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">configLocation</span>&gt;</span>checkstyle.xml<span class="hljs-tag">&lt;/<span class="hljs-name">configLocation</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">encoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">encoding</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">consoleOutput</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">consoleOutput</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">failsOnError</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">failsOnError</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">linkXRef</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">linkXRef</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>validate<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>validate<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>check<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
        
        <span class="hljs-comment">&lt;!-- 11. Docker构建插件 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.spotify<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>dockerfile-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.4.13<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">repository</span>&gt;</span>${docker.registry}/${docker.namespace}/${project.artifactId}<span class="hljs-tag">&lt;/<span class="hljs-name">repository</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">tag</span>&gt;</span>${project.version}<span class="hljs-tag">&lt;/<span class="hljs-name">tag</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">buildArgs</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">JAR_FILE</span>&gt;</span>${project.build.finalName}.jar<span class="hljs-tag">&lt;/<span class="hljs-name">JAR_FILE</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">buildArgs</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">skip</span>&gt;</span>${skip.docker.build}<span class="hljs-tag">&lt;/<span class="hljs-name">skip</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>build-image<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>package<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>build<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>push-image<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>deploy<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>push<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">tag</span>&gt;</span>latest<span class="hljs-tag">&lt;/<span class="hljs-name">tag</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>
</code></pre>
<h4 data-id="heading-24">2.2.6 Profile配置</h4>
<h5 data-id="heading-25">Profile基础配置</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">profiles</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 1. 开发环境Profile --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">profile</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>dev<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">activation</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- 激活条件：默认激活 --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">activeByDefault</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">activeByDefault</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- 或基于文件存在 --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">file</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">exists</span>&gt;</span>src/main/resources/application-dev.yml<span class="hljs-tag">&lt;/<span class="hljs-name">exists</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">file</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- 或基于操作系统 --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">os</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">family</span>&gt;</span>Windows<span class="hljs-tag">&lt;/<span class="hljs-name">family</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>Windows 10<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">arch</span>&gt;</span>amd64<span class="hljs-tag">&lt;/<span class="hljs-name">arch</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">os</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- 或基于JDK版本 --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">jdk</span>&gt;</span>[11,18)<span class="hljs-tag">&lt;/<span class="hljs-name">jdk</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- 或基于属性 --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>env<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>dev<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">activation</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">env</span>&gt;</span>dev<span class="hljs-tag">&lt;/<span class="hljs-name">env</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">spring.profiles.active</span>&gt;</span>dev<span class="hljs-tag">&lt;/<span class="hljs-name">spring.profiles.active</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">log.level</span>&gt;</span>DEBUG<span class="hljs-tag">&lt;/<span class="hljs-name">log.level</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">skipTests</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">skipTests</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">skipITs</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">skipITs</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- 开发环境专用依赖 --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-devtools<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">resources</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">resource</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">directory</span>&gt;</span>src/main/resources<span class="hljs-tag">&lt;/<span class="hljs-name">directory</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">filtering</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">filtering</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">includes</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">include</span>&gt;</span>**/application-dev.properties<span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">includes</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">resource</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">resources</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">jvmArguments</span>&gt;</span>
                            -Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=5005
                        <span class="hljs-tag">&lt;/<span class="hljs-name">jvmArguments</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">profile</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 2. 测试环境Profile --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">profile</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">activation</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>env<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">activation</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">env</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">env</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">spring.profiles.active</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">spring.profiles.active</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">log.level</span>&gt;</span>INFO<span class="hljs-tag">&lt;/<span class="hljs-name">log.level</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">skipTests</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">skipTests</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">skipITs</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">skipITs</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">database.url</span>&gt;</span>jdbc:mysql://test-db:3306/app_test<span class="hljs-tag">&lt;/<span class="hljs-name">database.url</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">resources</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">resource</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">directory</span>&gt;</span>src/main/resources<span class="hljs-tag">&lt;/<span class="hljs-name">directory</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">filtering</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">filtering</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">includes</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">include</span>&gt;</span>**/application-test.properties<span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">includes</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">resource</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">resources</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">profile</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 3. 生产环境Profile --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">profile</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>prod<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">activation</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>env<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>prod<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">activation</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">env</span>&gt;</span>prod<span class="hljs-tag">&lt;/<span class="hljs-name">env</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">spring.profiles.active</span>&gt;</span>prod<span class="hljs-tag">&lt;/<span class="hljs-name">spring.profiles.active</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">log.level</span>&gt;</span>WARN<span class="hljs-tag">&lt;/<span class="hljs-name">log.level</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">skipTests</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">skipTests</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">skipITs</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">skipITs</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">database.url</span>&gt;</span>jdbc:mysql://prod-db:3306/app_prod?useSSL=true<span class="hljs-tag">&lt;/<span class="hljs-name">database.url</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- 生产环境移除开发依赖 --&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">resources</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">resource</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">directory</span>&gt;</span>src/main/resources<span class="hljs-tag">&lt;/<span class="hljs-name">directory</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">filtering</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">filtering</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">includes</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">include</span>&gt;</span>**/application-prod.properties<span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">includes</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">resource</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">resources</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">executable</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">executable</span>&gt;</span>  <span class="hljs-comment">&lt;!-- 生产环境生成可执行JAR --&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">profile</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 4. 代码质量Profile --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">profile</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>quality<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">skipTests</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">skipTests</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">skipITs</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">skipITs</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-checkstyle-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>verify<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>check<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span>
                            <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-pmd-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.20.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>verify<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>check<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span>
                            <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.jacoco<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jacoco-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>check<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>check<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span>
                            <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">profile</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 5. 部署Profile --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">profile</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>deploy<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">deploy.skip</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">deploy.skip</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">distributionManagement</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">repository</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>nexus-releases<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>Releases Repository<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>http://nexus.company.com/repository/maven-releases/<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">repository</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">snapshotRepository</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>nexus-snapshots<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>Snapshots Repository<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>http://nexus.company.com/repository/maven-snapshots/<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">snapshotRepository</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">distributionManagement</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-deploy-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">skip</span>&gt;</span>${deploy.skip}<span class="hljs-tag">&lt;/<span class="hljs-name">skip</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">profile</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">profiles</span>&gt;</span>
</code></pre>
<h5 data-id="heading-26">Profile激活与使用</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- settings.xml中的Profile激活 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">settings</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">activeProfiles</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">activeProfile</span>&gt;</span>dev<span class="hljs-tag">&lt;/<span class="hljs-name">activeProfile</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">activeProfiles</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">settings</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 命令行激活Profile --&gt;</span>
<span class="hljs-comment">&lt;!-- mvn clean install -P dev,test --&gt;</span>
<span class="hljs-comment">&lt;!-- mvn clean install -P !prod --&gt;</span>  <span class="hljs-comment">&lt;!-- 排除prod --&gt;</span>
<span class="hljs-comment">&lt;!-- mvn clean install -Denv=test --&gt;</span>  <span class="hljs-comment">&lt;!-- 通过属性激活 --&gt;</span>
</code></pre>
<h3 data-id="heading-27">2.3 案例</h3>
<p>下面是我的开源项目 <code>spring-insight</code> 的测试项目，以maven多模块父子项目构建，父项目 pom.xml：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span>
         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.github.iweidujiang<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-insight-sca-demo<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>Spring Insight 在 Spring Cloud Alibaba 微服务项目中的使用<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">modules</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>sca-gateway<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>sca-order<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>sca-product<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>sca-user<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">modules</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>21<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">spring.boot.version</span>&gt;</span>3.5.9<span class="hljs-tag">&lt;/<span class="hljs-name">spring.boot.version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">spring.cloud.version</span>&gt;</span>2023.0.1<span class="hljs-tag">&lt;/<span class="hljs-name">spring.cloud.version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">spring.cloud.alibaba.version</span>&gt;</span>2023.0.1.0<span class="hljs-tag">&lt;/<span class="hljs-name">spring.cloud.alibaba.version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">spring.insight.version</span>&gt;</span>0.1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">spring.insight.version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- Spring Boot --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${spring.boot.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

            <span class="hljs-comment">&lt;!-- Spring Cloud --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${spring.cloud.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

            <span class="hljs-comment">&lt;!-- Spring Cloud Alibaba --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${spring.cloud.alibaba.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

            <span class="hljs-comment">&lt;!-- Spring Insight --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.github.iweidujiang<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-insight-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${spring.insight.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span>
</code></pre>
<p>子模块 <code>sca-gateway</code> 的 pom.xml：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span>
         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.github.iweidujiang<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-insight-sca-demo<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>sca-gateway<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>网关服务<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- Spring Cloud Gateway --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Nacos Discovery --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Spring Insight --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.github.iweidujiang<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-insight-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span>
</code></pre>
<h2 data-id="heading-28">三、Maven核心命令详解</h2>
<h3 data-id="heading-29">3.1 生命周期命令</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 清理项目</span>
mvn clean
<span class="hljs-comment"># 清理并删除target目录</span>
mvn clean -Dclean.verbose=<span class="hljs-literal">true</span>

<span class="hljs-comment"># 编译项目</span>
mvn compile
<span class="hljs-comment"># 只编译特定模块</span>
mvn compile -pl module-name
<span class="hljs-comment"># 跳过测试编译</span>
mvn compile -DskipTests

<span class="hljs-comment"># 测试项目</span>
mvn <span class="hljs-built_in">test</span>
<span class="hljs-comment"># 运行特定测试类</span>
mvn <span class="hljs-built_in">test</span> -Dtest=TestClass
<span class="hljs-comment"># 运行匹配模式的测试</span>
mvn <span class="hljs-built_in">test</span> -Dtest=<span class="hljs-string">"*Test"</span>
<span class="hljs-comment"># 跳过测试</span>
mvn <span class="hljs-built_in">test</span> -DskipTests
<span class="hljs-comment"># 跳过测试编译和执行</span>
mvn <span class="hljs-built_in">test</span> -DskipTests -DskipITs

<span class="hljs-comment"># 打包项目</span>
mvn package
<span class="hljs-comment"># 指定打包类型</span>
mvn package -Dpackaging=jar
<span class="hljs-comment"># 跳过测试打包</span>
mvn package -DskipTests

<span class="hljs-comment"># 安装到本地仓库</span>
mvn install
<span class="hljs-comment"># 跳过测试安装</span>
mvn install -DskipTests
<span class="hljs-comment"># 强制重新安装</span>
mvn install -U

<span class="hljs-comment"># 部署到远程仓库</span>
mvn deploy
<span class="hljs-comment"># 部署到特定仓库</span>
mvn deploy -DaltDeploymentRepository=<span class="hljs-built_in">id</span>::layout::url

<span class="hljs-comment"># 验证项目</span>
mvn validate

<span class="hljs-comment"># 生成站点文档</span>
mvn site
mvn site:deploy
</code></pre>
<h3 data-id="heading-30">3.2 依赖管理命令</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看依赖树</span>
mvn dependency:tree
<span class="hljs-comment"># 显示特定范围的依赖树</span>
mvn dependency:tree -Dincludes=groupId:artifactId
<span class="hljs-comment"># 显示重复依赖</span>
mvn dependency:tree -Dverbose

<span class="hljs-comment"># 分析依赖</span>
mvn dependency:analyze
mvn dependency:analyze-duplicate
mvn dependency:analyze-only

<span class="hljs-comment"># 复制依赖到目录</span>
mvn dependency:copy-dependencies
mvn dependency:copy-dependencies -DoutputDirectory=lib

<span class="hljs-comment"># 解决依赖问题</span>
mvn dependency:resolve
mvn dependency:resolve-plugins

<span class="hljs-comment"># 下载源码</span>
mvn dependency:sources
<span class="hljs-comment"># 下载javadoc</span>
mvn dependency:javadoc

<span class="hljs-comment"># 检查依赖更新</span>
mvn versions:display-dependency-updates
mvn versions:display-plugin-updates

<span class="hljs-comment"># 更新依赖版本</span>
mvn versions:use-latest-versions
mvn versions:use-next-releases
</code></pre>
<h3 data-id="heading-31">3.3 插件相关命令</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 列出所有插件</span>
mvn <span class="hljs-built_in">help</span>:effective-pom
mvn <span class="hljs-built_in">help</span>:effective-settings

<span class="hljs-comment"># 插件帮助</span>
mvn <span class="hljs-built_in">help</span>:describe -Dplugin=compiler
mvn <span class="hljs-built_in">help</span>:describe -Dplugin=compiler -Ddetail

<span class="hljs-comment"># 运行插件目标</span>
mvn compiler:compile
mvn surefire:<span class="hljs-built_in">test</span>
mvn jar:jar

<span class="hljs-comment"># 生成项目文档</span>
mvn javadoc:javadoc
mvn javadoc:jar

<span class="hljs-comment"># 生成可执行JAR</span>
mvn assembly:single
mvn assembly:assembly -DdescriptorId=jar-with-dependencies
</code></pre>
<h3 data-id="heading-32">3.4 多模块项目管理</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建多模块项目结构</span>
mvn archetype:generate \
  -DgroupId=com.example \
  -DartifactId=parent-project \
  -DarchetypeArtifactId=maven-archetype-site-simple \
  -DinteractiveMode=<span class="hljs-literal">false</span>

<span class="hljs-comment"># 构建所有模块</span>
mvn clean install
<span class="hljs-comment"># 构建特定模块</span>
mvn clean install -pl module1,module2
<span class="hljs-comment"># 构建模块及其依赖</span>
mvn clean install -pl module1 -am
<span class="hljs-comment"># 从指定模块开始构建</span>
mvn clean install -rf module1

<span class="hljs-comment"># 并行构建</span>
mvn clean install -T 4
mvn clean install -T 1C  <span class="hljs-comment"># 每个CPU核心一个线程</span>
</code></pre>
<h2 data-id="heading-33">四、Maven Wrapper详解</h2>
<h3 data-id="heading-34">4.1 为什么需要Maven Wrapper？</h3>
<p>Maven Wrapper确保项目使用特定版本的Maven，无需在系统上全局安装Maven。</p>
<h3 data-id="heading-35">4.2 初始化Maven Wrapper</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 为现有项目添加Maven Wrapper</span>
mvn wrapper:wrapper
<span class="hljs-comment"># 指定Maven版本</span>
mvn wrapper:wrapper -Dmaven=3.9.9

<span class="hljs-comment"># 或者使用wrapper目标</span>
mvn -N io.takari:maven:wrapper -DmavenVersion=3.9.9
</code></pre>
<p>执行后，会在项目根目录生成 <code>.mvn</code> 文件夹以及 <code>mvnw</code> (Linux下的执行命名)和 <code>mvnw.cmd</code> (Windows下的执行命令)。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5e8bd2797baf4163a701abb98e4f178c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5rih6IuH:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769270349&amp;x-signature=EMMXHS0VDog4SytG4GBa7cnxiF8%3D" alt="image-20260117221734397.png" loading="lazy"/></p>
<h3 data-id="heading-36">4.3 使用Maven Wrapper</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Unix/Linux/Mac</span>
./mvnw clean install

<span class="hljs-comment"># Windows</span>
mvnw.cmd clean install

<span class="hljs-comment"># 更新Maven Wrapper版本</span>
./mvnw wrapper:wrapper -Dmaven=3.9.9
</code></pre>
<h3 data-id="heading-37">4.4 自定义Maven Wrapper配置</h3>
<p><code>.mvn/wrapper/maven-wrapper.properties</code>:</p>
<pre><code class="hljs language-properties" lang="properties">distributionUrl=https://maven.aliyun.com/repository/public/org/apache/maven/apache-maven/3.9.9/apache-maven-3.9.9-bin.zip
wrapperUrl=https://repo.maven.apache.org/maven2/org/apache/maven/wrapper/maven-wrapper/3.3.4/maven-wrapper-3.1.1.jar
</code></pre>
<h3 data-id="heading-38">4.5 进阶Wrapper使用</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 离线模式</span>
./mvnw clean install -o

<span class="hljs-comment"># 调试模式</span>
./mvnw clean install -X

<span class="hljs-comment"># 指定本地仓库</span>
./mvnw clean install -Dmaven.repo.local=/path/to/repo
</code></pre>
<h2 data-id="heading-39">五、实战项目：构建一个多模块Spring Boot应用</h2>
<h3 data-id="heading-40">5.1 项目结构设计</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1bc258a36e24383a03175084f6c8bd7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5rih6IuH:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769270349&amp;x-signature=uAkWoBiL%2FRrYBkIKPicarNLBXcg%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-41">5.2 构建命令示例</h3>
<p>初始化 maven wrapper</p>
<pre><code class="hljs language-powershell" lang="powershell">PS E:\code_repository\openSource\spring-insight-sca-demo&gt; mvn wrapper:wrapper
[INFO] Scanning for projects...
[INFO] ------------------------------------------------------------------------
[INFO] Reactor Build Order:
[INFO]
[INFO] Spring Insight 在 Spring Cloud Alibaba 微服务项目中的使用                    [pom]
[INFO] 网关服务                                                               [jar]
[INFO] SCA Order                                                          [jar]
[INFO] SCA Product                                                        [jar]
[INFO] SCA User                                                           [jar]
... 一些下载信息 ...
[INFO]
[INFO] -----------&lt; io.github.iweidujiang:spring-insight-sca-demo &gt;------------
[INFO] Building Spring Insight 在 Spring Cloud Alibaba 微服务项目中的使用 1.0.0-SNAPSHOT [1/5]
[INFO]   from pom.xml
[INFO] --------------------------------[ pom ]---------------------------------
[INFO] 
... 一些下载信息 ...
[INFO] ------------------------------------------------------------------------
[INFO] Reactor Summary for Spring Insight 在 Spring Cloud Alibaba 微服务项目中的使用 1.0.0-SNAPSHOT:
[INFO]
[INFO] Spring Insight 在 Spring Cloud Alibaba 微服务项目中的使用 .... SUCCESS [  0.638 s]
[INFO] 网关服务 ............................................... SKIPPED
[INFO] SCA Order .......................................... SKIPPED
[INFO] SCA Product ........................................ SKIPPED
[INFO] SCA User ........................................... SKIPPED
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  4.001 s
[INFO] Finished at: 2026-01-17T22:03:10+08:00
[INFO] ------------------------------------------------------------------------
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a2f72a6901844989a491c7d1b5aad854~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5rih6IuH:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769270349&amp;x-signature=6vsfOd1VskgSAe2g0lJPMuIlPiY%3D" alt="" loading="lazy"/></p>
<p>之后我们再做一些配置，使 maven 在项目级生效，不影响其他项目，这也是最佳实践。</p>
<p>首先，<strong>在 <code>.mvn</code> 文件夹内新建 <code>maven.config</code> 文件</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 如下配置表示maven使用项目根目录下的settings.xml</span>
-ssettings.xml
</code></pre>
<p>然后，<strong>在项目根目录创建 settings.xml：</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">settings</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://maven.apache.org/SETTINGS/1.2.0"</span>
          <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
          <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://maven.apache.org/SETTINGS/1.2.0 https://maven.apache.org/xsd/settings-1.2.0.xsd"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">localRepository</span>&gt;</span>D:/Java/mvn_repo<span class="hljs-tag">&lt;/<span class="hljs-name">localRepository</span>&gt;</span>
  
  <span class="hljs-comment">&lt;!-- 配置镜像 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">mirrors</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 阿里云中央仓库镜像 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">mirror</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>aliyunmaven<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">mirrorOf</span>&gt;</span>central<span class="hljs-tag">&lt;/<span class="hljs-name">mirrorOf</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>https://maven.aliyun.com/repository/public<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">mirror</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">mirrors</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">settings</span>&gt;</span>
</code></pre>
<p>下面就可以使用 <code>mvnw.cmd</code> 来构建项目了（Linux下用 <code>mvnw</code> ，看前面章节）。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 初始化项目</span>
mvnw.cmd clean install -DskipTests

<span class="hljs-comment"># 2. 运行所有测试</span>
mvnw.cmd <span class="hljs-built_in">test</span>

<span class="hljs-comment"># 3. 打包所有模块</span>
mvnw.cmd clean package

<span class="hljs-comment"># 4. 跳过测试打包</span>
mvnw.cmd clean package -DskipTests

<span class="hljs-comment"># 5. 只构建web模块及其依赖</span>
mvnw.cmd clean install -pl web -am

<span class="hljs-comment"># 6. 使用生产环境配置打包</span>
mvnw.cmd clean package -Pprod

<span class="hljs-comment"># 7. 运行Spring Boot应用</span>
mvnw.cmd spring-boot:run

<span class="hljs-comment"># 8. 生成依赖树</span>
mvnw.cmd dependency:tree -Dverbose

<span class="hljs-comment"># 9. 检查依赖更新</span>
mvnw.cmd versions:display-dependency-updates

<span class="hljs-comment"># 10. 生成项目站点</span>
mvnw.cmd site
</code></pre>
<h2 data-id="heading-42">六、Maven高级技巧</h2>
<h3 data-id="heading-43">6.1 自定义生命周期</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-antrun-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.1.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>validate<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>run<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">target</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">echo</span>&gt;</span>Custom validation step<span class="hljs-tag">&lt;/<span class="hljs-name">echo</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">target</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>
</code></pre>
<h3 data-id="heading-44">6.2 资源过滤</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">resources</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">resource</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">directory</span>&gt;</span>src/main/resources<span class="hljs-tag">&lt;/<span class="hljs-name">directory</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">filtering</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">filtering</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">includes</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">include</span>&gt;</span>**/*.properties<span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">include</span>&gt;</span>**/*.xml<span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">includes</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">resource</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">resources</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">testResources</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">testResource</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">directory</span>&gt;</span>src/test/resources<span class="hljs-tag">&lt;/<span class="hljs-name">directory</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">filtering</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">filtering</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">testResource</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">testResources</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">filters</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">filter</span>&gt;</span>src/main/filters/dev.properties<span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">filters</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>
</code></pre>
<h3 data-id="heading-45">6.3 构建优化</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 构建缓存</span>
mvn clean install -Dmaven.build.cache.enabled=<span class="hljs-literal">true</span>

<span class="hljs-comment"># 2. 跳过不必要的插件</span>
mvn clean install -Dmaven.site.skip=<span class="hljs-literal">true</span> -Dmaven.javadoc.skip=<span class="hljs-literal">true</span>

<span class="hljs-comment"># 3. 使用镜像仓库（加速）</span>
<span class="hljs-comment"># 在~/.m2/settings.xml中配置</span>
&lt;mirror&gt;
    &lt;<span class="hljs-built_in">id</span>&gt;aliyun-maven&lt;/id&gt;
    &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;
    &lt;name&gt;Aliyun Maven Mirror&lt;/name&gt;
    &lt;url&gt;https://maven.aliyun.com/repository/central&lt;/url&gt;
&lt;/mirror&gt;
</code></pre>
<h3 data-id="heading-46">6.4 故障排查</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 调试模式</span>
mvn clean install -X

<span class="hljs-comment"># 2. 显示详细错误</span>
mvn clean install -e

<span class="hljs-comment"># 3. 离线模式排查</span>
mvn clean install -o

<span class="hljs-comment"># 4. 查看依赖冲突</span>
mvn dependency:tree -Dverbose

<span class="hljs-comment"># 5. 清理本地仓库缓存</span>
mvn dependency:purge-local-repository
</code></pre>
<h2 data-id="heading-47">七、常见问题与解决方案</h2>
<h3 data-id="heading-48">7.1 依赖冲突解决</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 识别冲突</span>
mvn dependency:tree -Dverbose | grep conflict

<span class="hljs-comment"># 2. 排除特定依赖</span>
&lt;dependency&gt;
    &lt;groupId&gt;com.example&lt;/groupId&gt;
    &lt;artifactId&gt;problematic-artifact&lt;/artifactId&gt;
    &lt;version&gt;1.0.0&lt;/version&gt;
    &lt;exclusions&gt;
        &lt;exclusion&gt;
            &lt;groupId&gt;conflicting-group&lt;/groupId&gt;
            &lt;artifactId&gt;conflicting-artifact&lt;/artifactId&gt;
        &lt;/exclusion&gt;
    &lt;/exclusions&gt;
&lt;/dependency&gt;

<span class="hljs-comment"># 3. 强制使用特定版本</span>
&lt;dependencyManagement&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;conflicting-group&lt;/groupId&gt;
            &lt;artifactId&gt;conflicting-artifact&lt;/artifactId&gt;
            &lt;version&gt;1.2.3&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;
</code></pre>
<h3 data-id="heading-49">7.2 构建性能优化</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 并行构建</span>
mvn clean install -T 1C  <span class="hljs-comment"># 每个CPU核心一个线程</span>

<span class="hljs-comment"># 2. 增量编译</span>
mvn compile -Dmaven.compiler.useIncrementalCompilation=<span class="hljs-literal">true</span>

<span class="hljs-comment"># 3. 跳过测试</span>
mvn clean install -DskipTests -DskipITs

<span class="hljs-comment"># 4. 使用构建缓存</span>
mvn clean install -Dmaven.build.cache.enabled=<span class="hljs-literal">true</span>

<span class="hljs-comment"># 5. 限制内存使用</span>
<span class="hljs-built_in">export</span> MAVEN_OPTS=<span class="hljs-string">"-Xmx2g -XX:MaxMetaspaceSize=512m"</span>
</code></pre>
<h2 data-id="heading-50">八、最佳实践总结</h2>
<ol>
<li><strong>使用Maven Wrapper</strong>：确保团队使用相同的Maven版本</li>
<li><strong>统一依赖管理</strong>：在父pom中使用dependencyManagement</li>
<li><strong>合理使用Profile</strong>：区分开发、测试、生产环境</li>
<li><strong>配置镜像仓库</strong>：加速依赖下载</li>
<li><strong>定期更新依赖</strong>：使用versions插件检查更新</li>
<li><strong>保持pom整洁</strong>：及时清理无用依赖</li>
<li><strong>使用标准目录结构</strong>：遵循Maven约定</li>
<li><strong>配置编码</strong>：统一使用UTF-8编码</li>
</ol>
<p>至此，你应该已经掌握了Maven的核心概念和高级用法。在实际项目中，建议根据具体需求灵活运用这些知识和技巧。</p>
<p>关注我，获取更多实战技术干货！ ⭐️</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[大数据-215 sklearn KMeans 关键属性与评估：cluster_centers_、inertia_、轮廓系数选 K 实战]]></title>    <link>https://juejin.cn/post/7595901379014623242</link>    <guid>https://juejin.cn/post/7595901379014623242</guid>    <pubDate>2026-01-17T14:03:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595901379014623242" data-draft-id="7595901379014606858" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="大数据-215 sklearn KMeans 关键属性与评估：cluster_centers_、inertia_、轮廓系数选 K 实战"/> <meta itemprop="keywords" content="后端,大数据,机器学习"/> <meta itemprop="datePublished" content="2026-01-17T14:03:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="武子康"/> <meta itemprop="url" content="https://juejin.cn/user/149189314230039"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            大数据-215 sklearn KMeans 关键属性与评估：cluster_centers_、inertia_、轮廓系数选 K 实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/149189314230039/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    武子康
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T14:03:37.000Z" title="Sat Jan 17 2026 14:03:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">TL;DR</h2>
<ul>
<li>场景：用 sklearn 做 KMeans 聚类，想解释中心点/损失，并用指标选 K。</li>
<li>结论：inertia_ 只能“越小越好但不可比”，选 K 更应看 -silhouette_score 的峰值；代码里要修正 idxmin/变量名混用。</li>
<li>产出：一套可复用的“属性解读 + 选 K 曲线 + 版本差异 + 报错排查”模板。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f7ebd27195374e6e90dc6a9bae951591~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769263417&amp;x-signature=siY8ys3sVAXOe8zqLN3WbY54WD8%3D" alt="大数据-215 sklearn KMeans 关键属性与评估：cluster_centers_、inertia_、轮廓系数选 K 实战" loading="lazy"/></p>
<h2 data-id="heading-1">sklearn实现 K-Means</h2>
<h3 data-id="heading-2">cluster.cluster_centers_</h3>
<pre><code class="hljs language-python" lang="python">centroid = cluster.cluster_centers_
centroid
centroid.shape
</code></pre>
<p>运行结果如下图所示：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0bb9a81c7d98414aa9a1e00c26a35589~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769263417&amp;x-signature=RZ%2BSVEmtdyGDEIzgWeyLxjglq%2F4%3D" alt="cluster.cluster_centers_" loading="lazy"/></p>
<h3 data-id="heading-3">cluster.inertia_</h3>
<p>查看总距离的平方和：</p>
<pre><code class="hljs language-python" lang="python">inertia = cluster.inertia_
inertia
</code></pre>
<p>运行结果如下图所示：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/835a3e54a3d04b3b8add0f8fec6bc35d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769263417&amp;x-signature=m%2FsxaByIvtonTn3A94G5%2FZR4TTw%3D" alt="cluster.inertia_" loading="lazy"/>
如果我们把簇的数量换成 4，Inertia 会怎么样？</p>
<pre><code class="hljs language-python" lang="python">n_clusters = <span class="hljs-number">4</span>
cluster_ = KMeans(n_clusters=n_clusters, random_state=<span class="hljs-number">0</span>).fit(X)
inertia_ = cluster_.inertia_
inertia_
</code></pre>
<p>运行结果如下图所示：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a92975fbccf45748713729a8e5c9820~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769263417&amp;x-signature=xxSLyIUZ3FRzkkPoKl%2BJ%2BxFH7MM%3D" alt="cluster.inertia_" loading="lazy"/>
如果换成 5：</p>
<pre><code class="hljs language-python" lang="python">n_clusters = <span class="hljs-number">5</span>
cluster_ = KMeans(n_clusters=n_clusters, random_state=<span class="hljs-number">0</span>).fit(X)
inertia_ = cluster_.inertia_
inertia_
</code></pre>
<p>执行结果如下图所示：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/663be61c94f2411586f030d6a4fe0b27~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769263417&amp;x-signature=F%2FRpStGxuHxUR0c5cPFxrAgSR0M%3D" alt="KMeans(n_clusters=n_clusters," loading="lazy"/>
如果换成 6：</p>
<pre><code class="hljs language-python" lang="python">n_clusters = <span class="hljs-number">6</span>
cluster_ = KMeans(n_clusters=n_clusters, random_state=<span class="hljs-number">0</span>).fit(X)
inertia_ = cluster_.inertia_
inertia_
</code></pre>
<p>执行结果如下图所示：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3cbf05481384b3abc3c262478e2472d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769263417&amp;x-signature=pK249QNDcOVlTIJTn6M3ug9IZ4I%3D" alt="KMeans(n_clusters=n_clusters," loading="lazy"/></p>
<h2 data-id="heading-4">聚类算法模型评估：轮廓系数</h2>
<p>不同于分类模型和回归，聚类算法的模型评估不是一件简单的事，在分类中，有直接结果（标签）的输出，并且分类结果有正负之分，所以我们使用预测的准确度，混淆矩阵，ROC 曲线等等指标来进行评估，但无论如何评估，都是在”模型找到正确答案“的能力。而回归中，由于要拟合数据，我们有 SSE 均方误差，有损失函数来衡量模型的拟合程度，但这些衡量指标都不能够使用于聚类。</p>
<h2 data-id="heading-5">如何衡量聚类算法的效果</h2>
<p>聚类模型的结果不是某种标签输出，并且聚类的结果是不确定的，其优劣由业务需求或算法需求来决定，并且永远没有正确答案。那我们如何衡量聚类的效果呢？
记得我们说过，KMeans 的目标是确保“簇内差异小，簇外差异大”，我们就可以通过衡量簇内差异来衡量聚类的效果。我们刚才说过，Inertia 是用距离来衡量簇内差异的指标，因此，我们是否可以使用 Inertia 来作为聚类的衡量指标呢？Inertia 越小模型越好。
可以，但是这个指标的缺点和极限太大了：</p>
<ul>
<li>它不是有界的，我们只知道，Inertia 是越小越好，是 0 最好，但我们不知道，一个较小的Inertia究竟有没有达到模型的极限，是否能够继续提高。</li>
<li>它的计算太容易受到特征数目的影响，数据维度很大的时候，Inertia 的计算量会陷入维度诅咒之中，计算量会爆炸，不适合用来一次次评估模型。</li>
<li>它会收到超参数 K 的影响，在我们之前的尝试中其实我们已经发现，随着 K 的越大，Intertia 会越来越小，但是这不能代表我们的模型越来越好。</li>
<li>Inertia 作为评估指标，会让聚类算法在一些细长簇，环形簇，或者不规则的表现不佳。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0b2eb55088b4443fbcede77c2c8f7a92~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769263417&amp;x-signature=3jcBvVlaIiOZRP6u7AMS6xGE%2BlM%3D" alt="聚类算法模型评估：轮廓系数" loading="lazy"/>
那我们可以使用什么指标呢？聚类是没有标签的，即不知道真实答案的预测算法，我们必须完全依赖评价簇内稠密程度（簇内差异小）和簇间的离散程度（簇外差异大）来评估聚类的效果。其中轮廓系数是最常用的聚类算法的评价指标。它是对每个样本来定义的，它能够同时衡量：</p>
<ul>
<li>样本与其自身所在的簇中的其他样本的相似度 a，等于样本与同一簇所有其他点之间的平均距离</li>
<li>样本与其他簇中的样本相似度 b ，等于样本与下一个最近的簇中的所有点之间的平均距离</li>
</ul>
<p>根据聚类的要求：“簇内差异小，簇外差异大”，我们希望 b 永远大于 a，并且大的越多越好，单个样本的轮廓系数为：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9a75f86d9d874fe29fe1d5e25f677536~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769263417&amp;x-signature=k%2BlMbDRNvMLciHTZXGrP4Qb%2BvmQ%3D" alt="聚类算法模型评估：轮廓系数" loading="lazy"/>
这个公式可以被解析为：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e76d48418cd455a9273c76cfc0c3c5e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769263417&amp;x-signature=sqA6uPCYqweDtJi6hK0bpI7%2FnJ4%3D" alt="聚类算法模型评估：轮廓系数" loading="lazy"/></p>
<p>很容易理解的轮廓系数范围是：（-1,1）：</p>
<ul>
<li>轮廓系数越接近 1：样本与自己所在簇中的样本很相似，并且与其他簇中的样本不相似</li>
<li>轮廓系数为 0 时，两个簇中的样本相似度一致，两个簇本应该是一个簇。</li>
<li>轮廓为负时：样本点与簇外的样本更相似。</li>
</ul>
<p>如果一个簇中的大多数样本具有比较高的轮廓系数，则簇会有较高的总轮廓系数，则整个数据集的平均轮廓系数较高，则聚类时合适的。
如果许多样本点具有低轮廓系数甚至负值，则聚类是不合适的，聚类的超参数 K 可能设定的太大或者太小。</p>
<p>在 sklearn 中，我们使用模块 metrics 中的类 sihouette_score 来计算轮廓系数，它返回的是一个数据集中，所有样本的轮库系数的均值，但我们还有同在 metrics 模块中的 sihouette_sample，它的参数与轮廓系数一致，但返回的数据集中每个样本自己的轮廓系数：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> silhouette_score
<span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> silhouette_samples

X
y_pred
</code></pre>
<p>执行结果如下图所示:
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5bbeb7260007448b9f2e16844ae6b46c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769263417&amp;x-signature=eb126mP1yK29toSTMdqleGc7pas%3D" alt="执行结果" loading="lazy"/>
观察一下不同的 K ，轮廓系数发生了什么变化？</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment">#观察一下不同的K下，轮廓系数发生什么变化？</span>
cluster = KMeans(n_clusters=<span class="hljs-number">3</span>, random_state=<span class="hljs-number">0</span>).fit(X)
silhouette_score(X,cluster_.labels_) <span class="hljs-comment">#计算所有样本的轮廓系数均值。</span>
silhouette_samples(X,cluster.labels_) <span class="hljs-comment">#计算每个样本的轮廓系数。</span>
</code></pre>
<p>运行之后生成的结果如下：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/386ca0d012a4474f9875389779633ca2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769263417&amp;x-signature=LS9h9ycwz4L2PQ6gTvTbJp4XTVg%3D" alt="执行结果" loading="lazy"/></p>
<p>我们继续编写代码：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt
<span class="hljs-keyword">from</span> sklearn.cluster <span class="hljs-keyword">import</span> KMeans
<span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> silhouette_score

<span class="hljs-comment"># 定义存储评分的列表</span>
score = []

<span class="hljs-comment"># 进行 KMeans 聚类并计算 silhouette_score</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>, <span class="hljs-number">100</span>):
    cluster = KMeans(n_clusters=i, random_state=<span class="hljs-number">0</span>).fit(X)
    score.append(silhouette_score(X, cluster.labels_))

<span class="hljs-comment"># 绘制 silhouette_score 的变化曲线</span>
plt.plot(<span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>, <span class="hljs-number">100</span>), score)

<span class="hljs-comment"># 找到 silhouette_score 最小值对应的索引，并绘制一条垂直线</span>
plt.axvline(pd.DataFrame(score).idxmin()[<span class="hljs-number">0</span>] + <span class="hljs-number">2</span>, ls=<span class="hljs-string">':'</span>)

<span class="hljs-comment"># 添加标题和坐标轴标签</span>
plt.title(<span class="hljs-string">'Silhouette Score vs Number of Clusters'</span>)
plt.xlabel(<span class="hljs-string">'Number of Clusters'</span>)
plt.ylabel(<span class="hljs-string">'Silhouette Score'</span>)

<span class="hljs-comment"># 显示图形</span>
plt.show()

</code></pre>
<p>轮廓系数(Silhouette Coefficient)是一种常用的聚类效果评估指标，具有以下显著优点：</p>
<ol>
<li>
<p>取值范围明确：</p>
<ul>
<li>数值范围固定在[-1,1]之间，使得评估结果具有可比性</li>
<li>值越接近1表示聚类效果越好</li>
<li>值为0表示样本点在簇边界上</li>
<li>负值表示可能被分错了簇</li>
</ul>
</li>
<li>
<p>适用性广泛：</p>
<ul>
<li>不要求数据服从特定分布，适用于各种形态的数据集</li>
<li>对球形簇、凸形簇等常见聚类形态都能有效评估</li>
<li>特别适合评估K-means等基于距离的聚类算法效果</li>
</ul>
</li>
<li>
<p>直观解释性强：</p>
<ul>
<li>同时考虑了簇内紧密度和簇间分离度</li>
<li>通过计算样本与同簇其他点的平均距离(a)和与最近其他簇点的平均距离(b)得出</li>
<li>计算公式为：s = (b - a)/max(a,b)</li>
</ul>
</li>
</ol>
<p>然而，轮廓系数也存在一些局限性：</p>
<ol>
<li>
<p>对特定聚类类型的评估偏差：</p>
<ul>
<li>对于DBSCAN等基于密度的聚类算法，可能给出虚高的评分</li>
<li>在评估不规则形状的簇时表现不佳</li>
<li>当数据中存在噪声点时，评估结果可能失真</li>
</ul>
</li>
<li>
<p>最佳适用场景：</p>
<ul>
<li>在簇间边界清晰、各簇密度相近时表现最好</li>
<li>适用于评估预先确定簇数量的聚类算法</li>
<li>对于层次聚类等不确定簇数量的算法评估效果有限</li>
</ul>
</li>
<li>
<p>计算复杂度问题：</p>
<ul>
<li>需要计算所有样本点之间的距离，时间复杂度较高</li>
<li>在大规模数据集上计算代价较大</li>
</ul>
</li>
</ol>
<p>在实际应用中，建议将轮廓系数与其他评估指标(如Calinski-Harabasz指数、Davies-Bouldin指数等)结合使用，以获得更全面的聚类效果评估。同时要注意，对于特殊形态的数据集或特定类型的聚类算法，可能需要选用更适合的评估方法。</p>
<h2 data-id="heading-6">错误速查</h2>















































<table><thead><tr><th>症状</th><th>根因</th><th>定位</th><th>修复</th></tr></thead><tbody><tr><td>运行 <code>silhouette_score(X, cluster_.labels_)</code> 报错或结果异常</td><td>变量混用：<code>cluster</code> 与 <code>cluster_</code> 不一致</td><td>检查 <code>fit(X)</code> 的返回对象到底赋给了谁</td><td>统一变量名：<code>cluster = KMeans(...).fit(X)</code> 后用 <code>cluster.labels_</code></td></tr><tr><td>选 K 画线落在“最差点”而不是“最好点”</td><td>用了 <code>idxmin()</code>；轮廓系数应取最大值附近</td><td>看代码：<code>pd.DataFrame(score).idxmin()</code></td><td>改为 <code>idxmax()</code>，并明确“取峰值附近作为候选 K”</td></tr><tr><td>同一份数据在不同机器/版本下 KMeans 结果不一致</td><td>sklearn 1.4 起 <code>n_init</code> 默认 'auto'；初始化次数/策略变化</td><td>打印 sklearn 版本与 KMeans 参数</td><td>显式指定 <code>n_init</code>、<code>init</code>、<code>random_state</code>（跨版本对比必须固定）。</td></tr><tr><td><code>inertia</code> 很大、肘部不明显</td><td>特征未标准化/量纲差异大；高维导致距离主导</td><td>观察特征量纲与方差；对比标准化前后曲线</td><td>先做标准化/归一化；再看 <code>inertia</code>/轮廓曲线</td></tr><tr><td><code>silhouette_score</code> 计算很慢</td><td>轮廓系数需要大量距离计算，样本大时成本高</td><td>K 扫描范围过大（2..100）且 n 较大</td><td>缩小 K 搜索区间；先抽样评估，再全量验证</td></tr><tr><td><code>silhouette</code> 出现大量负值</td><td>K 不合适/簇重叠严重/数据不适合 KMeans（非凸形簇、噪声多）</td><td>用 <code>silhouette_samples</code> 看分布，定位负值集中簇</td><td>调整 K、换特征工程；必要时改用 GMM/DBSCAN 等算法</td></tr></tbody></table>
<h2 data-id="heading-7">其他系列</h2>
<h3 data-id="heading-8">🚀 AI篇持续更新中（长期更新）</h3>
<p><strong>AI炼丹日志-29 - 字节跳动 DeerFlow 深度研究框<em>斜体样式</em>架 私有部署 测试上手 架构研究</strong>，持续打造实用AI工具指南！
<strong>AI研究-132 Java 生态前沿 2025：Spring、Quarkus、GraalVM、CRaC 与云原生落地</strong></p>
<h3 data-id="heading-9">💻 Java篇持续更新中（长期更新）</h3>
<p><strong>Java-218 RocketMQ Java API 实战：同步/异步 Producer 与 Pull/Push Consumer</strong>
MyBatis 已完结，Spring 已完结，Nginx已完结，Tomcat已完结，分布式服务已完结，Dubbo已完结，MySQL已完结，MongoDB已完结，Neo4j已完结，FastDFS 已完结，OSS已完结，GuavaCache已完结，EVCache已完结，RabbitMQ已完结，RocketMQ正在更新... 深入浅出助你打牢基础！</p>
<h3 data-id="heading-10">📊 大数据板块已完成多项干货更新（300篇）：</h3>
<p>包括 Hadoop、Hive、Kafka、Flink、ClickHouse、Elasticsearch 等二十余项核心组件，覆盖离线+实时数仓全栈！
<strong>大数据-278 Spark MLib - 基础介绍 机器学习算法 梯度提升树 GBDT案例 详解</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端开发为什么容易被边缘化？有什么雄起的路径？]]></title>    <link>https://juejin.cn/post/7595974133097136162</link>    <guid>https://juejin.cn/post/7595974133097136162</guid>    <pubDate>2026-01-17T14:56:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595974133097136162" data-draft-id="7595772638880317491" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端开发为什么容易被边缘化？有什么雄起的路径？"/> <meta itemprop="keywords" content="面试"/> <meta itemprop="datePublished" content="2026-01-17T14:56:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="怕浪猫"/> <meta itemprop="url" content="https://juejin.cn/user/2832784963939438"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端开发为什么容易被边缘化？有什么雄起的路径？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2832784963939438/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    怕浪猫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T14:56:22.000Z" title="Sat Jan 17 2026 14:56:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d47da8ea8034b42b365d0f15ee0cfc7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oCV5rWq54yr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769266582&amp;x-signature=sABwmFole%2FzG5xifN9sbl463D1Y%3D" alt="小朋友想像的未來世界.jpg" loading="lazy"/></p>
<h3 data-id="heading-0">技术认知的历史包袱</h3>
<p>“前端就是写写页面，调调样式”的刻板印象在部分传统技术团队中依然存在。当企业技术文化仍以后端为中心时，前端往往被视为实现层而非架构层，这种认知偏差直接影响了前端在技术决策中的话语权。</p>
<h3 data-id="heading-1">技术迭代的“诅咒”</h3>
<p>前端生态以高速迭代著称，技术栈每2-3年就可能完全革新。这种快速变化带来双重困境：一方面，持续学习压力巨大；另一方面，频繁的技术更替让部分管理者质疑前端工作的“技术深度”。</p>
<h3 data-id="heading-2">门槛的“双刃剑”</h3>
<p>现代前端工具链的发展使得基础页面搭建门槛降低，可视化工具、低代码平台甚至能让非技术人员创建简单页面。这种“民主化”进程无意中削弱了初级前端工作的专业壁垒。</p>
<h3 data-id="heading-3">全栈趋势的挤压</h3>
<p>“全栈工程师”概念的流行，使许多后端开发者通过掌握基础前端技能而直接参与前端开发。在追求人效的企业中，专门的前端岗位可能被压缩，尤其是在中小型团队。</p>
<h3 data-id="heading-4">价值衡量的模糊性</h3>
<p>相比后端的并发数、数据库性能等硬指标，前端的用户体验价值更难以量化。当技术投入需要被证明商业价值时，前端往往处于“重要但难以证明”的尴尬境地。</p>
<h3 data-id="heading-5">破茧（胡说八道的例子）</h3>
<p><strong>陈航</strong>是一家电商公司的普通前端，每天重复着商品列表、详情页的开发。转折点出现在一次大促，页面加载缓慢导致转化率直接下降30%。陈航没有止步于“优化代码”，而是：</p>
<ol>
<li><strong>建立量化体系</strong>：引入性能监控工具，将“白屏时间”、“可交互时间”转化为具体数据</li>
<li><strong>推动全链路优化</strong>：不仅优化前端代码，更推动CDN策略调整、图片服务升级</li>
<li><strong>设计性能标准</strong>：制定团队性能准入标准，不合格的页面不得上线</li>
</ol>
<p>一年后，他主导的“极致体验项目”将核心页面加载速度提升了65%，直接带动转化率提升18%。公司为此专门设立了“用户体验架构师”岗位，而他，成为了这个新岗位的负责人。</p>
<p><strong>林悦</strong>加入一家快速扩张的互联网公司时，前端团队还处于“刀耕火种”阶段：没有构建规范，各项目技术栈混乱，每次发布都像一场赌博。</p>
<p>她没有抱怨，而是：</p>
<ul>
<li><strong>默默搭建</strong>：用三个月时间建立起完整的工程化体系，包括统一构建、自动化测试、组件库</li>
<li><strong>用数据说话</strong>：统计显示，新体系下需求平均交付时间缩短40%，线上事故减少70%</li>
<li><strong>主动赋能</strong>：为其他团队提供脚手架和培训，将个人能力转化为团队资产</li>
</ul>
<p>当CTO在年度总结中专门表彰“前端工程化带来的效率革命”时，林悦和她的团队已从“资源部门”转变为“效率引擎”。</p>
<p>前端工程师<strong>小王</strong>。在三年前的公司，他的工作被严格限定在“将设计稿转化为HTML/CSS”，所有业务逻辑、数据交互都由后端决定。一次评审会上，当他对一个交互流程提出优化建议时，得到的回应是：“你先把样式调好，业务逻辑不用你操心。”</p>
<p><strong>张涛</strong>在一家传统企业转型互联网的公司，当公司要评估技术团队贡献时，后端同事可以展示“系统QPS从1000提升到5000”、“数据库查询优化缩短80%时间”等硬核指标，而他精心实现的“首屏加载从3秒降到1秒”却被视为“体验优化，不是核心需求”。</p>
<p><strong>李薇</strong>所在的创业公司，CTO是后端出身，技术架构会议从不邀请前端参与。直到项目上线后出现大量移动端兼容性问题，用户流失率飙升，才意识到前端技术决策的重要性——但此时补救的成本已是预防的十倍。</p>
<h3 data-id="heading-6">雄起之路</h3>
<p><strong>不要只做需求的执行者，要做用户体验的守护者和业务价值的发现者。</strong></p>
<p>像<strong>张明</strong>那样，当接到一个“优化表单页面”的需求时，他不仅完成了开发，更通过用户行为分析发现：表单每增加一个字段，流失率增加5%。他据此提出“分步表单+进度指示”方案，使表单完成率提升了34%。当你能将技术实现直接关联到业务增长，没人会再忽视你的声音。</p>
<p><strong>在快速变化的生态中，深度是抵御“可替代性”的最佳防御。</strong></p>
<p>专注于可视化领域的<strong>赵峰</strong>，带领团队自主研发了公司的数据可视化引擎，解决了复杂图表性能瓶颈。当竞争对手还在使用开源方案卡顿时，他们的产品实现了万级数据点的流畅渲染。这份专业深度，让他成为了公司不可替代的技术专家。</p>
<p><strong>个人的优秀终有天花板，体系的强大才能带来根本性改变。</strong></p>
<p>资深前端<strong>周涛</strong>在意识到团队协作效率低下后，主导搭建了公司的微前端架构和设计系统。这不仅解决了多个团队并行开发的冲突问题，更使新业务的启动时间从两周缩短到两天。他现在被称为“前端基础设施负责人”，而不再是“高级前端开发”。</p>
<p><strong>最危险的不是技能单一，而是思维局限。</strong></p>
<p><strong>吴琳</strong>原本是纯前端开发者，在接触了Node.js后，她主动承担起BFF层的开发，打通了前端与后端的数据鸿沟。接着，她进一步探索AIGC与前端结合，开发出智能UI生成工具，将重复性页面开发效率提升60%。她的角色已无法用传统“前端”定义，而是“体验技术专家”。</p>
<p>雄起之路，在你下一次不只是完成任务，而是创造价值的抉择中。</p>
<h3 data-id="heading-7">结语</h3>
<p>那些既能深入技术细节，又能连接用户需求；既能实现精美界面，又能构建工程体系的前端开发者，永远不会被边缘化——因为他们正在定义数字体验的未来。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[QT跨平台一次编写，处处编译]]></title>    <link>https://juejin.cn/post/7595858760134557759</link>    <guid>https://juejin.cn/post/7595858760134557759</guid>    <pubDate>2026-01-17T14:58:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595858760134557759" data-draft-id="7595858760134541375" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="QT跨平台一次编写，处处编译"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-17T14:58:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码事漫谈"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            QT跨平台一次编写，处处编译
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码事漫谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T14:58:53.000Z" title="Sat Jan 17 2026 14:58:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在当今软件开发领域，“跨平台”已从一个技术理想转变为实际需求。当我们谈论跨平台框架时，QT无疑是其中最耀眼的名字之一。但QT究竟如何实现“一次编写，到处运行”的承诺？它的跨平台本质是什么？</p>
<h3 data-id="heading-0">抽象的艺术：不止于表面的统一</h3>
<p>QT跨平台的核心策略不是简单的“条件编译”，而是构建了一套精妙的<strong>抽象层架构</strong>。这一架构位于操作系统API之上，又在应用程序之下，充当了翻译官的角色。</p>
<p>想象一下：当你调用<code>QWidget::show()</code>方法显示一个窗口时，在Windows上，QT将此调用转换为调用Win32 API的<code>CreateWindowEx</code>和<code>ShowWindow</code>；在macOS上，它使用Cocoa框架的<code>NSWindow</code>；在Linux上，则可能使用X11或Wayland协议。作为开发者，你无需关心这些底层差异——同一行代码在不同平台上自动选择正确的实现路径。</p>
<p>这种抽象不仅限于GUI系统，还延伸至文件系统、网络通信、数据库访问、多媒体处理等几乎每一个与操作系统交互的领域。QT团队为每个支持的平台维护一套“后端实现”，这些实现提供了相同的接口，但内部实现完全不同。</p>
<h3 data-id="heading-1">元对象系统：超越C++的语言扩展</h3>
<p>QT的跨平台能力还源于其独特的<strong>元对象系统（Meta-Object System）</strong>。通过扩展C++语言（借助moc元对象编译器），QT引入了信号槽机制、运行时类型信息和动态属性系统等特性。这些特性本身是平台无关的，为高级功能提供了统一基础。</p>
<p>特别值得注意的是，元对象系统使得QT能够创建灵活的、可脚本化的组件架构，这进一步增强了其跨平台能力。因为应用逻辑与平台细节解耦，大部分业务代码可以在不同平台间共享。</p>
<h3 data-id="heading-2">渐进式抽象：分层设计哲学</h3>
<p>QT并非将所有东西都抽象化，而是采用了一种巧妙的<strong>分层设计</strong>：</p>
<ol>
<li><strong>核心模块</strong>（QtCore）：提供基础容器、线程、文件IO等，抽象程度最高</li>
<li><strong>GUI模块</strong>（QtGui）：抽象图形绘制、事件处理，但保留各平台视觉特色</li>
<li><strong>平台模块</strong>：包含平台特定实现，对外透明</li>
<li><strong>工具模块</strong>（网络、数据库等）：在核心抽象基础上提供高级功能</li>
</ol>
<p>这种设计允许开发者在保持跨平台兼容性的同时，在必要时访问平台特有功能——QT提供了条件编译和平台检测机制，用于处理不可避免的平台差异。</p>
<h3 data-id="heading-3">构建系统：统一的构建体验</h3>
<p>QT的跨平台性不仅体现在运行时，也贯穿于开发过程。qmake（及后来的CMake集成）能够生成适用于不同平台和编译器的构建文件（如Windows的MSVC、Linux的GCC、macOS的Clang）。这种构建系统的统一极大简化了多平台开发的管理复杂度。</p>
<h3 data-id="heading-4">现代挑战与演进</h3>
<p>随着移动平台和WebAssembly的兴起，QT的跨平台策略也在不断演进。面对iOS和Android，QT需要处理触摸界面、移动设备传感器等新维度；而对WebAssembly的支持，则意味着将桌面应用逻辑移植到浏览器环境中运行。</p>
<p>这些新挑战促使QT发展出更精细的平台抽象策略，例如通过Qt Quick为不同屏幕尺寸和交互模式提供自适应界面，同时保持核心业务逻辑的平台无关性。</p>
<h3 data-id="heading-5">结论：抽象的艺术与工程</h3>
<p>QT跨平台的本质是一种<strong>精心设计的抽象艺术与系统工程</strong>的结合。它不是简单地隐藏平台差异，而是通过深思熟虑的架构设计，为开发者提供一致的概念模型和编程接口，同时在底层为每个平台提供最优化的实现。</p>
<p>这种跨平台策略的成功，源于QT项目二十多年来对“一致性”与“本地化”平衡的持续追求——既不让开发者被平台细节困扰，也不强迫所有平台呈现完全相同的体验。正是在这种平衡中，QT证明了真正可持续的跨平台框架，应当尊重每个平台的独特个性，同时提供统一的开发心智模型。</p>
<p>在日益碎片化的计算世界中，QT的跨平台哲学提供了一条务实路径：不是创造一个完全统一的世界，而是架设通往不同世界的桥梁，让开发者能够自由往来其间，而无需重学每一种“方言”。这或许才是跨平台的最高境界——在差异中寻找统一，在多样性中创造价值。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[基于 YOLOv8 的桥梁病害（八类缺陷、病害高精度）自动检测 [目标检测完整源码]]]></title>    <link>https://juejin.cn/post/7596181746061787163</link>    <guid>https://juejin.cn/post/7596181746061787163</guid>    <pubDate>2026-01-17T14:59:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596181746061787163" data-draft-id="7595894884957519923" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="基于 YOLOv8 的桥梁病害（八类缺陷、病害高精度）自动检测 [目标检测完整源码]"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-17T14:59:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="我是杰尼"/> <meta itemprop="url" content="https://juejin.cn/user/4200579899599495"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            基于 YOLOv8 的桥梁病害（八类缺陷、病害高精度）自动检测 [目标检测完整源码]
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4200579899599495/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    我是杰尼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T14:59:17.000Z" title="Sat Jan 17 2026 14:59:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">基于 YOLOv8 的桥梁病害（八类缺陷、病害高精度）自动检测 [目标检测完整源码]</h2>
<h3 data-id="heading-1">一、背景与问题：桥梁检测为什么需要 AI？</h3>
<p>桥梁作为城市与交通网络中的关键基础设施，其服役周期长、受力复杂、环境影响显著。随着时间推移，桥梁结构不可避免地会出现<strong>裂缝扩展、混凝土退化、钢筋腐蚀、潮湿渗水等病害问题</strong>。若不能及时发现并处理，轻则影响通行安全，重则引发结构性风险。</p>
<p>传统桥梁检测主要依赖人工目测或人工+仪器结合的方式，普遍存在以下痛点：</p>
<ul>
<li>检测效率低，难以覆盖大规模桥梁资产</li>
<li>对检测人员经验依赖强，结果主观性高</li>
<li>数据难以结构化，不利于长期健康评估</li>
</ul>
<p>在此背景下，基于计算机视觉的<strong>自动化桥梁病害检测</strong>逐渐成为智能运维的重要发展方向。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58c690947407426fa78ba64f63dcc183~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769266757&amp;x-signature=DcFA3hrnUTOGMuSeJrvVZ59clGQ%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h3 data-id="heading-2">源码下载与效果演示</h3>
<p>哔哩哔哩视频下方观看：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1m8g8z6Ejp%2F" target="_blank" title="https://www.bilibili.com/video/BV1m8g8z6Ejp/" ref="nofollow noopener noreferrer">www.bilibili.com/video/BV1m8…</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c49f7c46d0ed49f6be72fa5b8e432ae1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769266757&amp;x-signature=EpzfAkqHB11Vnhu8ayVIng9hy3M%3D" alt="在这里插入图片描述" loading="lazy"/>
包含：</p>
<p>📦完整项目源码</p>
<p>📦 预训练模型权重</p>
<p>🗂️ 数据集地址（含标注脚本</p>
<h3 data-id="heading-3">二、整体解决方案概述</h3>
<p>本文介绍的一套桥梁病害检测系统，采用 <strong>YOLOv8 目标检测模型</strong> 作为核心算法，并结合 <strong>PyQt5 桌面端可视化工具</strong>，构建了一条从模型训练到工程应用的完整技术链路。</p>
<h4 data-id="heading-4">系统核心能力概览</h4>
<ul>
<li>支持 <strong>8 类典型桥梁缺陷与病害识别</strong></li>
<li>覆盖 <strong>图片、批量图片、视频、摄像头</strong> 等多种输入形式</li>
<li>提供 <strong>图形化操作界面</strong>，降低使用门槛</li>
<li>支持模型再训练与工程级部署</li>
</ul>
<p>该系统既可作为科研与教学案例，也可直接用于工程检测与巡检辅助。</p>
<hr/>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/92cb19d1de6b451e85f969ea354bee8d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769266757&amp;x-signature=2wWDrP%2BDDiLT%2BzQ32AUJa3Z81lM%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d2f9c31fd784df9b4bf328bba64145b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769266757&amp;x-signature=zbaggZF7We6Fchks4F4YmHOSq2c%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h3 data-id="heading-5">三、检测目标设计：让模型“看懂”桥梁问题</h3>
<p>在桥梁结构表面，病害往往呈现出<strong>尺度小、纹理细、形态多样</strong>的特点。针对工程实践需求，系统定义了以下八类检测目标：</p>
<ol>
<li>裂缝</li>
<li>收缩裂缝</li>
<li>底层收缩裂缝</li>
<li>混凝土退化</li>
<li>混凝土空洞</li>
<li>腐蚀</li>
<li>潮湿</li>
<li>路面劣化</li>
</ol>
<p>这些类别基本覆盖了常见桥梁表观病害类型，为后续健康评估与维修决策提供了结构化输入。</p>
<hr/>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67df1e73065f490294af013f4e196e9f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769266757&amp;x-signature=XRGq0Wz7SAV9cKVFdSZHNy%2FMTXE%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h3 data-id="heading-6">四、为什么选择 YOLOv8？</h3>
<p>YOLOv8 是 Ultralytics 推出的新一代实时目标检测模型，在工程实践中表现出明显优势：</p>
<ul>
<li>
<p><strong>Anchor-Free 架构</strong>
对细长裂缝、小尺度缺陷更友好，减少人为先验约束。</p>
</li>
<li>
<p><strong>推理速度快</strong>
能够满足视频流与实时检测场景需求。</p>
</li>
<li>
<p><strong>训练与部署流程成熟</strong>
模型配置灵活，支持快速复现与迁移学习。</p>
</li>
<li>
<p><strong>多任务扩展能力强</strong>
为后续引入分割、姿态或多模态任务奠定基础。</p>
</li>
</ul>
<p>在桥梁病害这类“复杂背景 + 小目标”的场景中，YOLOv8 在精度与速度之间取得了良好平衡。</p>
<hr/>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/370d251dc1c44bc992d774176a169a51~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769266757&amp;x-signature=xlM5fHolXIkK5jkKfVXiJkqDBVk%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h3 data-id="heading-7">五、数据集构建与训练流程</h3>
<h4 data-id="heading-8">1. 数据组织方式</h4>
<p>系统采用标准 YOLO 数据格式，清晰划分训练集与验证集，便于模型迭代：</p>
<pre><code class="hljs language-text" lang="text">dataset/
├── images/
│   ├── train/
│   └── val/
├── labels/
│   ├── train/
│   └── val/
</code></pre>
<p>每张图像均配有对应标注文件，记录目标类别及归一化边界框信息。</p>
<h4 data-id="heading-9">2. 训练与评估策略</h4>
<p>模型训练过程中，重点关注以下指标：</p>
<ul>
<li><strong>box_loss</strong>：定位精度</li>
<li><strong>cls_loss</strong>：类别区分能力</li>
<li><strong>mAP@0.5</strong>：整体检测性能</li>
</ul>
<p>当模型在验证集上达到稳定收敛并取得较高 mAP 后，即可进入部署与应用阶段。</p>
<hr/>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9c173f5c65d84200a0eb68d6c070bb37~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769266757&amp;x-signature=LDZeagcqPw8WJsyJ%2BXxfxrqUmT8%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h3 data-id="heading-10">六、推理与可视化系统实现</h3>
<h4 data-id="heading-11">1. 模型推理逻辑</h4>
<p>系统基于 PyTorch 推理接口加载训练完成的 YOLOv8 模型，对输入图像或视频逐帧执行检测，输出包括：</p>
<ul>
<li>缺陷类别</li>
<li>置信度</li>
<li>边界框坐标</li>
</ul>
<p>这些信息可进一步用于统计分析或风险评估。</p>
<h4 data-id="heading-12">2. PyQt5 图形化界面优势</h4>
<p>通过 PyQt5 封装推理流程，系统实现了：</p>
<ul>
<li>图像/视频/摄像头一键加载</li>
<li>检测结果实时展示</li>
<li>自动保存检测图片与日志</li>
<li>无需命令行操作的工程化体验</li>
</ul>
<p>这使得系统不仅面向算法工程师，也适用于检测人员与工程管理人员使用。</p>
<hr/>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2c22c2c2e51429c8183e40272c07158~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769266757&amp;x-signature=LeuaM7M6n3Hd0lQioodUbnp8G6w%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h3 data-id="heading-13">七、典型应用场景</h3>
<p>该系统在多个实际场景中具备应用潜力：</p>
<ul>
<li>桥梁日常巡检与快速筛查</li>
<li>历史病害数据对比与趋势分析</li>
<li>科研机构桥梁健康监测研究</li>
<li>高校土木与智能建造课程教学</li>
</ul>
<p>通过持续积累检测结果，还可进一步构建桥梁全生命周期健康管理体系。</p>
<hr/>
<h3 data-id="heading-14">八、未来扩展方向</h3>
<p>在当前系统基础上，可进一步拓展以下能力：</p>
<ul>
<li>引入 <strong>图像分割模型</strong>，实现裂缝精细化测量</li>
<li>融合 <strong>红外或多光谱数据</strong>，增强隐蔽病害识别</li>
<li>部署至 <strong>边缘计算设备或无人机平台</strong></li>
<li>结合时序数据，分析病害演化趋势</li>
</ul>
<hr/>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d636186e1b942c59d8beaec1043b02d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769266757&amp;x-signature=7%2FnPWLf2iFBXyHnXH8N0yDEGhmM%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h3 data-id="heading-15">结语</h3>
<p>本文介绍了一套面向实际工程应用的 <strong>桥梁病害智能检测系统</strong>，通过 YOLOv8 高性能目标检测模型与 PyQt5 可视化工具的结合，实现了从数据、模型到应用的完整闭环。</p>
<p>该方案在提升检测效率、降低人工成本、增强结果一致性方面具有显著优势，为桥梁智能巡检与结构健康监测提供了一条可落地、可扩展的技术路径，也为工业视觉在基础设施领域的应用提供了有价值的实践参考。</p>
<p>本文从实际工程应用角度出发，系统梳理了一套基于深度学习目标检测模型的智能识别解决方案，完整覆盖了数据准备、模型训练、推理验证以及应用系统集成等关键环节。通过将算法能力与可视化应用相结合，实现了从模型效果验证到业务可用系统落地的转化，体现了人工智能技术在真实场景中的工程价值。整体方案结构清晰、技术路线成熟，既具备较强的复用性与扩展性，也为相关领域的智能化升级提供了可参考、可落地的实现范式。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[博客与短视频谁更能成就你的个人品牌？]]></title>    <link>https://juejin.cn/post/7595878718172266532</link>    <guid>https://juejin.cn/post/7595878718172266532</guid>    <pubDate>2026-01-17T15:01:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595878718172266532" data-draft-id="7595858760134574143" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="博客与短视频谁更能成就你的个人品牌？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-17T15:01:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码事漫谈"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            博客与短视频谁更能成就你的个人品牌？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码事漫谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T15:01:22.000Z" title="Sat Jan 17 2026 15:01:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>人物：</strong><br/>
老派博客（博哥）——文字爱好者，崇尚深度与持久<br/>
新锐短视频（抖妹）——视觉达人，追求传播与互动</p>
<p><strong>场景：</strong> 虚拟的“品牌咖啡馆”内，两人隔着桌子面对面坐着。空气中弥漫着淡淡的咖啡香与隐约的键盘敲击声。</p>
<hr/>
<p><strong>博哥</strong>（推了推眼镜，啜一口黑咖啡）：“品牌不是烟花，而是陈年佳酿。你想被记住三秒，还是被信赖三年？博客用文字构建思想宫殿，每一篇都是你的基石。”</p>
<p><strong>抖妹</strong>（手机屏的光映在笑脸上）：“博哥，现在是注意力经济时代。一条爆款短视频24小时能触达百万人——你博客三年阅读量的总和。品牌首先得被人‘看见’，对吧？”</p>
<hr/>
<p><strong>博哥</strong>：“看见然后呢？碎片化的娱乐能留下什么？我的读者会在深夜重读我五年前关于‘职场韧性’的文章，留言说它改变了职业轨迹。这种深度连接，算法能给你吗？”</p>
<p><strong>抖妹</strong>（手指轻盈划过屏幕）：“深度不必排斥广度呀。我用60秒讲透‘时间管理陷阱’，评论区变成千人互助社区。视觉+情感+即时互动——这是多维度的品牌渗透。对了，上周我那条‘书房布置哲学’播放量破500万，顺便带火了我的线上课程。”</p>
<hr/>
<p><strong>博哥</strong>：“可依赖平台算法如同在流沙上筑塔。你的内容寿命有多长？我的文章十年后仍能被搜索引擎发现，持续带来咨询客户。SEO是耐心的复利者。”</p>
<p><strong>抖妹</strong>：“但‘品牌人格化’需要温度！我的表情、语调、书房背景甚至猫的入镜，都在传递真实感。用户说‘感觉像每周见面的朋友’——这种亲和力转化率比冷文字高47%，数据说的。”</p>
<hr/>
<p><strong>（沉默片刻，咖啡机发出蒸汽的嘶鸣）</strong></p>
<p><strong>博哥</strong>（语气稍缓）：“我承认，你让复杂概念变得平易近人。但文字所独有的抽象思辨空间……”</p>
<p><strong>抖妹</strong>（身体前倾）：“其实我悄悄把你的长文拆解成系列短视频，标注‘深度版见博客链接’。我的观众中23%会点过去——我们本就不是敌人。”</p>
<hr/>
<p><strong>博哥</strong>（若有所思地转动咖啡杯）：“所以你在做我的预告片？”</p>
<p><strong>抖妹</strong>：“而你是我的资料库。品牌建设从来不是单选——是让短视频成为吸引力的旋涡，让博客成为沉淀感的圣殿。别忘了，那些最持久的个人品牌，都在用视频扩大声量，再用文字巩固信任。”</p>
<hr/>
<h2 data-id="heading-0"><strong>最终结论</strong></h2>
<p>这场辩论没有输家，但<strong>短视频在个人品牌启动阶段具有决定性优势</strong>。原因在于：</p>
<ol>
<li><strong>传播效率的维度差异</strong>：短视频能同时传递视觉符号、声音魅力、场景氛围与情绪冲击，在单位时间内构建更立体的“人格画像”，这对初期建立品牌认知至关重要。</li>
<li><strong>算法赋能的冷启动</strong>：去中心化分发机制让素人有机会突破圈层，这是传统博客难以企及的。</li>
<li><strong>信任加速器</strong>：面部出镜带来的“可视可信度”，能快速跨越陌生信任门槛。</li>
</ol>
<p>但这并非终点。<strong>真正的智慧在于构建“短视频入口+博客沉淀”的生态闭环</strong>：</p>
<ul>
<li>用短视频的钩子吸引海量关注</li>
<li>以博客的深度完成价值筛选与信任深化</li>
<li>让两者形成内容层面的相互导流</li>
</ul>
<p><strong>个人品牌的终极形态，是成为一座既有热闹门庭（短视频），又有深邃殿堂（博客）的认知城市。</strong> 而在这个注意力稀缺的时代，<strong>选择以短视频为先锋，不是放弃深度，而是以更符合人性感知规律的方式，为你的思想打开第一扇门。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[为什么每次打开 ArcGIS Pro 页面加载都如此缓慢？]]></title>    <link>https://juejin.cn/post/7595994039108861988</link>    <guid>https://juejin.cn/post/7595994039108861988</guid>    <pubDate>2026-01-17T13:33:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595994039108861988" data-draft-id="7596025264455581732" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="为什么每次打开 ArcGIS Pro 页面加载都如此缓慢？"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-17T13:33:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="GIS之路"/> <meta itemprop="url" content="https://juejin.cn/user/4346787284915481"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            为什么每次打开 ArcGIS Pro 页面加载都如此缓慢？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4346787284915481/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    GIS之路
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T13:33:22.000Z" title="Sat Jan 17 2026 13:33:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">^ 关注我，带你一起学GIS ^</h2>
<p>大家有没有这种经历，每次新建或者打开一个已有的<code>ArcGIS Pro</code>工程的话，在加载场景页面都要等待很长时间，这无疑对使用体验造成非常不好的影响。</p>
<p>首先需要检查一下电脑配置，如果你的电脑运行内存稍微低一点，显卡也不太给力，对软件运行会造成一定影响。</p>
<p>可访问<code>ESRI</code>网站查看配置需求。<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/628c22adb13d4a9f9b7db994d4d02662~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769261602&amp;x-signature=ob37WJtamryyONRKm7jBZa43fo0%3D" alt="" loading="lazy"/></p>
<p>访问如下地址，可检测本机运行环境。</p>
<p><code>https://www.systemrequirementslab.com/client-app?refid=1256&amp;appkey=6D681CD0-BA6C-4B6B-9A82-639759CFD094&amp;requirementsetid=23091</code></p>
<p>标识<code>ArcGIS Pro</code>版本为3.3到3.6，我本机的是3.5。<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/91d861b2567f408f9ac94948dadff0d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769261602&amp;x-signature=d5wIO58FPfCMpVk10j3oMRlUKKE%3D" alt="" loading="lazy"/></p>
<p>好吧，虽然··············，但是我的电脑没运行出结果，或者说检测出错了，估计是个<code>bug</code>。<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e2a5276aef5466382016e254c823c9b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769261602&amp;x-signature=H%2BhilOrv7T4sKeZf4m49u9DQe0E%3D" alt="" loading="lazy"/>有完整运行结果的同学可以截图看一下。</p>
<p>电脑配置这关过了的话，咱么可以进行软件设置了。</p>
<p>我的主要问题是每次新建工程或者打开原有工程，创建场景的时间都很漫长（底图没被封之前就加载缓慢），也有可能是网络的原因。</p>
<p>但我的需求其实不需要一开始就添加一个完整的底图，包括地形、影像或者矢量，大多数情况下我只需要一个空白工程就可以了，所以我的解决办法是在设置里面将默认加载底图去除。</p>
<p>首先，打开设置选项<code>Options</code>。<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3bdb2fcc55f5447b9bb2c11acf40ad5a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769261602&amp;x-signature=s%2BM06sB0%2FQRPpSTgdaBfPaQxpEE%3D" alt="" loading="lazy"/></p>
<p>然后找到<code>Map and Scene</code>，在右侧将<code>Map</code>项和<code>Scene</code>项修改为<code>None</code>，也就是默认不加载底图。<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/41077acacc4e4e4eb71d7dce57d7b1b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769261602&amp;x-signature=addYSno54FbBdGrmc1AIOEtDbZY%3D" alt="" loading="lazy"/></p>
<p>经过此步骤之后，我再打开<code>ArcGIS Pro</code>那就舒服多了。</p>
<p><strong><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8b3e8a07e2fc4b05ac6fab2283399a72~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769261602&amp;x-signature=EzrV7HZdxUjpc%2Bd7sKh1awPkPY4%3D" alt="" loading="lazy"/></strong></p>
<blockquote>
<p>❝</p>
<p>OpenLayers示例数据下载，请在公众号后台回复：<strong>vector</strong></p>
<p>全国信息化工程师－GIS 应用水平考试资料，请在公众号后台回复：<strong>GIS考试</strong></p>
</blockquote>
<blockquote>
<p>❝</p>
<p><em><strong>GIS之路</strong></em> 公众号已经接入了<strong>智能</strong> <strong>助手</strong>，可以在对话框进行提问，也可以直接搜索历史文章进行查看。</p>
</blockquote>
<p>都看到这了，不要忘记<em><strong>点赞、收藏</strong></em> <strong>+</strong> <em><strong>关注</strong></em> 哦 <strong>！</strong></p>
<p>本号不定时更新有关 <em><strong>GIS开发</strong></em> 相关内容，<em><strong>欢迎关注 <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/03e439ae87384734a48383956f4cdfa8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769261602&amp;x-signature=pRYo%2FG6AxkjWzKrfjNwuw2OCjYs%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a3b0bebb588f4086be4dbdf15a4aaa51~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769261602&amp;x-signature=vy75MPdVP3hRQgBWxS5rHqtslh8%3D" alt="" loading="lazy"/></strong></em></p>
<hr/>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/185d313dc123458e820c445972f6ce3c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769261602&amp;x-signature=zWlsfqqtDA9NXTfauJzQHL9jl2s%3D" alt="" loading="lazy"/></p>
<p>   <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/98596a98205f42a3acfa4cdbcdc07666~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769261602&amp;x-signature=6z1DpmGs%2BgdmgMgQoGvRdcD7Qsw%3D" alt="" loading="lazy"/> </p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkwOTEzNjI5NQ%3D%3D%26mid%3D2247487953%26idx%3D1%26sn%3D0b2d5aeefdb290583cf8cdd82f3c2077%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzkwOTEzNjI5NQ==&amp;mid=2247487953&amp;idx=1&amp;sn=0b2d5aeefdb290583cf8cdd82f3c2077&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">GeoTools 开发合集（全）</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkwOTEzNjI5NQ%3D%3D%26mid%3D2247487119%26idx%3D1%26sn%3Dc313efa84c27bf933ef2f2a47991ef2d%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzkwOTEzNjI5NQ==&amp;mid=2247487119&amp;idx=1&amp;sn=c313efa84c27bf933ef2f2a47991ef2d&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">OpenLayers 开发合集</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FhBXfq6zRK9twSicMXw69jw" target="_blank" title="https://mp.weixin.qq.com/s/hBXfq6zRK9twSicMXw69jw" ref="nofollow noopener noreferrer">ArcGIS Pro 实现影像波段合成</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FQVFiW5C5wXQ6a1WODCaH0g" target="_blank" title="https://mp.weixin.qq.com/s/QVFiW5C5wXQ6a1WODCaH0g" ref="nofollow noopener noreferrer">自然资源部党组关于苗泽等4名同志职务任免的通知</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FJmv3J_bjbBG-4jB72zS3hw" target="_blank" title="https://mp.weixin.qq.com/s/Jmv3J_bjbBG-4jB72zS3hw" ref="nofollow noopener noreferrer">GDAL 创建矢量图层的两种方式</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fi77nCatd4V2nuybZFIs-xA" target="_blank" title="https://mp.weixin.qq.com/s/i77nCatd4V2nuybZFIs-xA" ref="nofollow noopener noreferrer">GDAL 数据类型大全</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FwkHv2NnJfuPhtyjJcFLrEQ" target="_blank" title="https://mp.weixin.qq.com/s/wkHv2NnJfuPhtyjJcFLrEQ" ref="nofollow noopener noreferrer">GDAL 实现矢量数据转换处理（全）</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FMZIQ57Ka3NQfKFi9AuEQEg" target="_blank" title="https://mp.weixin.qq.com/s/MZIQ57Ka3NQfKFi9AuEQEg" ref="nofollow noopener noreferrer">GDAL 实现投影转换</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FSX2u2ww1iNOtqR5m3BE93g" target="_blank" title="https://mp.weixin.qq.com/s/SX2u2ww1iNOtqR5m3BE93g" ref="nofollow noopener noreferrer">国产版的Google Earth，吉林一号卫星App“共生地球”来了</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FfWufqSyplniNj4Q3BRRbAQ" target="_blank" title="https://mp.weixin.qq.com/s/fWufqSyplniNj4Q3BRRbAQ" ref="nofollow noopener noreferrer">2026年全国自然资源工作会议召开</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FRq7mCSrKU7DA7WRGDEy6Cg" target="_blank" title="https://mp.weixin.qq.com/s/Rq7mCSrKU7DA7WRGDEy6Cg" ref="nofollow noopener noreferrer">日本欲打造“本土版”星链系统</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FEqpOD--IdOUO6gyzwBc6RA" target="_blank" title="https://mp.weixin.qq.com/s/EqpOD--IdOUO6gyzwBc6RA" ref="nofollow noopener noreferrer">吉林一号国内首张高分辨率彩色夜光卫星影像发布</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FznfhqB1_3JbQHG7CEqWSCw" target="_blank" title="https://mp.weixin.qq.com/s/znfhqB1_3JbQHG7CEqWSCw" ref="nofollow noopener noreferrer">2025 年度信创领军企业名单出炉！</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[RabbitMQ 在 Celery 中扮演角色介绍]]></title>    <link>https://juejin.cn/post/7595878718172135460</link>    <guid>https://juejin.cn/post/7595878718172135460</guid>    <pubDate>2026-01-17T13:36:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595878718172135460" data-draft-id="7596025264455614500" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="RabbitMQ 在 Celery 中扮演角色介绍"/> <meta itemprop="keywords" content="RabbitMQ"/> <meta itemprop="datePublished" content="2026-01-17T13:36:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="哈里谢顿"/> <meta itemprop="url" content="https://juejin.cn/user/3678304397695056"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            RabbitMQ 在 Celery 中扮演角色介绍
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3678304397695056/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    哈里谢顿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T13:36:56.000Z" title="Sat Jan 17 2026 13:36:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>RabbitMQ 在 Celery 中扮演 <strong>消息中间件（Message Broker）</strong> 的核心角色，负责在 <strong>任务生产者（Producer）</strong> 和 <strong>任务消费者（Worker）</strong> 之间<strong>可靠地传递任务消息</strong>。它是 Celery 实现<strong>异步任务、分布式任务队列、定时任务</strong>的基础设施。</p>
<p>下面通过 <strong>原理详解 + 图示 + 代码示例</strong> 全面解析。</p>
<hr/>
<h2 data-id="heading-0">🧠 一、核心角色与流程</h2>
<h3 data-id="heading-1">1. <strong>四大核心组件</strong></h3>






























<table><thead><tr><th>组件</th><th>作用</th><th>类比</th></tr></thead><tbody><tr><td><strong>Client（生产者）</strong></td><td>发送任务到 Broker</td><td>餐厅顾客（点菜）</td></tr><tr><td><strong>Broker（RabbitMQ）</strong></td><td>接收、存储、转发任务消息</td><td>餐厅传菜系统（订单池）</td></tr><tr><td><strong>Worker（消费者）</strong></td><td>从 Broker 获取任务并执行</td><td>厨师（做菜）</td></tr><tr><td><strong>Result Backend（可选）</strong></td><td>存储任务执行结果（如 Redis）</td><td>上菜记录本</td></tr></tbody></table>
<blockquote>
<p>✅ <strong>RabbitMQ 的核心职责：解耦生产者和消费者，实现异步通信</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-2">🖼️ 二、工作流程图解</h2>
<pre><code class="hljs language-css" lang="css">graph LR
    <span class="hljs-selector-tag">A</span><span class="hljs-selector-attr">[Client\n(任务生产者)]</span> --&gt;|<span class="hljs-number">1</span>. 发送任务| <span class="hljs-selector-tag">B</span>(RabbitMQ\nBroker)
    <span class="hljs-selector-tag">B</span> --&gt;|<span class="hljs-number">2</span>. 存储任务到 Queue| C<span class="hljs-selector-attr">[Queue: default]</span>
    D<span class="hljs-selector-attr">[Worker 1]</span> --&gt;|<span class="hljs-number">3</span>. 拉取任务| C
    E<span class="hljs-selector-attr">[Worker 2]</span> --&gt;|<span class="hljs-number">3</span>. 拉取任务| C
    F<span class="hljs-selector-attr">[Worker N]</span> --&gt;|<span class="hljs-number">3</span>. 拉取任务| C
    D --&gt;|<span class="hljs-number">4</span>. 执行任务| G
    E --&gt;|<span class="hljs-number">4</span>. 执行任务| G
    F --&gt;|<span class="hljs-number">4</span>. 执行任务| G
    <span class="hljs-selector-tag">A</span> --&gt;|<span class="hljs-number">5</span>. 查询结果| G
</code></pre>
<h3 data-id="heading-3">🔁 详细步骤：</h3>
<ol>
<li><strong>Client</strong> 调用 <code>add.delay(2, 3)</code>，Celery 将任务序列化为消息；</li>
<li>消息发送到 <strong>RabbitMQ</strong>，存入指定的 <strong>Queue</strong>（如 <code>celery</code>）；</li>
<li><strong>多个 Worker</strong> 监听该 Queue，竞争消费任务（负载均衡）；</li>
<li>Worker 执行任务函数，将结果存入 <strong>Result Backend</strong>；</li>
<li>Client 可通过 <code>result.get()</code> 从 Result Backend 获取结果。</li>
</ol>
<hr/>
<h2 data-id="heading-4">⚙️ 三、RabbitMQ 在 Celery 中的具体作用</h2>
<h3 data-id="heading-5">1. <strong>任务路由（Routing）</strong></h3>
<ul>
<li>
<p>通过 <strong>Exchange + Queue + Binding</strong> 实现灵活的任务分发。</p>
</li>
<li>
<p>示例：将不同任务发送到不同队列</p>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-comment"># tasks.py</span>
<span class="hljs-variable">@app</span>.task
<span class="hljs-keyword">def</span> <span class="hljs-title function_">send_email</span>(): ...

<span class="hljs-variable">@app</span>.task
<span class="hljs-keyword">def</span> <span class="hljs-title function_">process_video</span>(): ...

<span class="hljs-comment"># 发送时指定队列</span>
send_email.apply_async(queue=<span class="hljs-string">'email'</span>)
process_video.apply_async(queue=<span class="hljs-string">'video'</span>)
</code></pre>
<p>RabbitMQ 配置：</p>
<ul>
<li>Exchange: <code>celery</code></li>
<li>Queue <code>email</code> → 绑定 routing key <code>email</code></li>
<li>Queue <code>video</code> → 绑定 routing key <code>video</code></li>
</ul>
</li>
</ul>
<h3 data-id="heading-6">2. <strong>持久化（Persistence）</strong></h3>
<ul>
<li>RabbitMQ 可将消息<strong>写入磁盘</strong>，即使服务重启也不丢失任务。</li>
<li>Celery 默认开启消息持久化（需配置 Queue 和 Message 为 durable）。</li>
</ul>
<h3 data-id="heading-7">3. <strong>负载均衡（Load Balancing）</strong></h3>
<ul>
<li>多个 Worker 订阅同一 Queue，RabbitMQ <strong>轮询分发</strong>任务（Round-Robin）。</li>
<li>自动实现横向扩展：加机器 = 加 Worker = 提升吞吐量。</li>
</ul>
<h3 data-id="heading-8">4. <strong>流量削峰（Buffering）</strong></h3>
<ul>
<li>当任务突发激增时，RabbitMQ 作为<strong>缓冲区</strong>暂存任务，避免 Worker 崩溃。</li>
<li>Worker 按自身能力匀速消费。</li>
</ul>
<h3 data-id="heading-9">5. <strong>可靠性保障</strong></h3>
<ul>
<li><strong>ACK 机制</strong>：Worker 执行成功后才 ACK，失败则消息重回 Queue（或进入死信队列）。</li>
<li><strong>消息确认</strong>：确保任务不丢失。</li>
</ul>
<hr/>
<h2 data-id="heading-10">🛠️ 四、代码配置示例</h2>
<h3 data-id="heading-11">1. 安装依赖</h3>
<pre><code class="hljs language-bash" lang="bash">pip install celery
<span class="hljs-comment"># RabbitMQ 作为 Broker</span>
<span class="hljs-comment"># Redis 作为 Result Backend（可选）</span>
</code></pre>
<h3 data-id="heading-12">2. Celery 配置 (<code>celery_app.py</code>)</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> celery <span class="hljs-keyword">import</span> Celery

<span class="hljs-comment"># 使用 RabbitMQ 作为 Broker，Redis 作为结果存储</span>
app = Celery(
    <span class="hljs-string">'myapp'</span>,
    broker=<span class="hljs-string">'pyamqp://guest@localhost//'</span>,  <span class="hljs-comment"># RabbitMQ 连接 URL</span>
    backend=<span class="hljs-string">'redis://localhost:6379/0'</span>
)

<span class="hljs-comment"># 可选：配置队列</span>
app.conf.task_routes = {
    <span class="hljs-string">'tasks.send_email'</span>: {<span class="hljs-string">'queue'</span>: <span class="hljs-string">'email'</span>},
    <span class="hljs-string">'tasks.process_video'</span>: {<span class="hljs-string">'queue'</span>: <span class="hljs-string">'video'</span>},
}
</code></pre>
<h3 data-id="heading-13">3. 定义任务 (<code>tasks.py</code>)</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> celery_app <span class="hljs-keyword">import</span> app

<span class="hljs-meta">@app.task</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">x, y</span>):
    <span class="hljs-keyword">return</span> x + y

<span class="hljs-meta">@app.task</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">send_email</span>(<span class="hljs-params">to</span>):
    <span class="hljs-comment"># 模拟耗时操作</span>
    <span class="hljs-keyword">import</span> time
    time.sleep(<span class="hljs-number">2</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"Email sent to <span class="hljs-subst">{to}</span>"</span>
</code></pre>
<h3 data-id="heading-14">4. 启动 Worker</h3>
<pre><code class="hljs language-css" lang="css"># 监听默认队列
celery -<span class="hljs-selector-tag">A</span> celery_app worker <span class="hljs-attr">--loglevel</span>=info

# 监听特定队列
celery -<span class="hljs-selector-tag">A</span> celery_app worker -<span class="hljs-selector-tag">Q</span> email,<span class="hljs-selector-tag">video</span> <span class="hljs-attr">--loglevel</span>=info
</code></pre>
<h3 data-id="heading-15">5. 调用任务 (<code>client.py</code>)</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> tasks <span class="hljs-keyword">import</span> add, send_email

<span class="hljs-comment"># 异步发送任务</span>
result = add.delay(<span class="hljs-number">4</span>, <span class="hljs-number">5</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"Task ID:"</span>, result.<span class="hljs-built_in">id</span>)

<span class="hljs-comment"># 获取结果（阻塞等待）</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"Result:"</span>, result.get(timeout=<span class="hljs-number">10</span>))
</code></pre>
<hr/>
<h2 data-id="heading-16">⚠️ 五、为什么选择 RabbitMQ？ vs 其他 Broker</h2>





























<table><thead><tr><th>Broker</th><th>优点</th><th>缺点</th><th>适用场景</th></tr></thead><tbody><tr><td><strong>RabbitMQ</strong></td><td>功能强大、高可靠、支持复杂路由</td><td>运维稍复杂</td><td>金融、电商等强可靠性场景</td></tr><tr><td><strong>Redis</strong></td><td>简单、高性能</td><td>消息可能丢失（非持久化）</td><td>快速原型、容忍少量丢失</td></tr><tr><td><strong>Kafka</strong></td><td>高吞吐、日志型</td><td>不适合低延迟任务</td><td>大数据管道、事件溯源</td></tr></tbody></table>
<blockquote>
<p>✅ <strong>RabbitMQ 优势</strong>：</p>
<ul>
<li>完整的 AMQP 协议支持</li>
<li>死信队列（DLX）处理失败任务</li>
<li>管理界面（Management Plugin）可视化监控</li>
</ul>
</blockquote>
<hr/>
<h2 data-id="heading-17">📊 六、RabbitMQ 内部结构（Celery 视角）</h2>
<pre><code class="hljs language-lua" lang="lua">graph TB
    subgraph RabbitMQ
        E[Exchange: celery] <span class="hljs-comment">--&gt;|routing key: celery| Q1[Queue: celery]</span>
        E <span class="hljs-comment">--&gt;|routing key: email| Q2[Queue: email]</span>
        E <span class="hljs-comment">--&gt;|routing key: video| Q3[Queue: video]</span>
    <span class="hljs-keyword">end</span>

    Client <span class="hljs-comment">--&gt;|Publish task| E</span>
    Worker1 <span class="hljs-comment">--&gt;|Consume| Q1</span>
    Worker2 <span class="hljs-comment">--&gt;|Consume| Q2</span>
    Worker3 <span class="hljs-comment">--&gt;|Consume| Q3</span>
</code></pre>
<ul>
<li><strong>Exchange 类型</strong>：Celery 默认使用 <code>direct</code> Exchange</li>
<li><strong>Queue 声明</strong>：Celery 自动创建 Queue（可配置持久化）</li>
<li><strong>消息格式</strong>：JSON 或 pickle 序列化的任务元数据</li>
</ul>
<hr/>
<h2 data-id="heading-18">🛡️ 七、生产环境最佳实践</h2>
<ol>
<li>
<p><strong>持久化配置</strong>：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 确保消息和队列持久化</span>
<span class="hljs-attr">app.conf.task_serializer</span> = <span class="hljs-string">'json'</span>
<span class="hljs-attr">app.conf.result_serializer</span> = <span class="hljs-string">'json'</span>
<span class="hljs-attr">app.conf.accept_content</span> = [<span class="hljs-string">'json'</span>]
<span class="hljs-attr">app.conf.task_acks_late</span> = <span class="hljs-literal">True</span>  <span class="hljs-comment"># 任务执行完再 ACK</span>
</code></pre>
</li>
<li>
<p><strong>监控 RabbitMQ</strong>：</p>
<ul>
<li>启用 Management Plugin：<code>rabbitmq-plugins enable rabbitmq_management</code></li>
<li>访问 <code>http://localhost:15672</code> 查看队列积压、消费者状态</li>
</ul>
</li>
<li>
<p><strong>错误处理</strong>：</p>
<ul>
<li>配置死信队列（DLX）捕获失败任务</li>
<li>使用 <code>autoretry_for</code> 自动重试</li>
</ul>
</li>
<li>
<p><strong>资源隔离</strong>：</p>
<ul>
<li>为不同类型任务创建独立 Queue，避免互相阻塞</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-19">✅ 总结：RabbitMQ 在 Celery 中的核心价值</h2>





























<table><thead><tr><th>能力</th><th>说明</th></tr></thead><tbody><tr><td><strong>异步解耦</strong></td><td>生产者无需等待任务执行完成</td></tr><tr><td><strong>可靠投递</strong></td><td>消息持久化 + ACK 机制保证不丢失</td></tr><tr><td><strong>弹性伸缩</strong></td><td>动态增减 Worker 应对流量变化</td></tr><tr><td><strong>流量削峰</strong></td><td>缓冲突发请求，保护后端服务</td></tr><tr><td><strong>灵活路由</strong></td><td>按业务类型分发到不同队列</td></tr></tbody></table>
<blockquote>
<p>💡 <strong>一句话</strong>：<br/>
<strong>RabbitMQ 是 Celery 的“中枢神经”，没有它，Celery 就无法实现分布式任务调度。</strong></p>
</blockquote>
<p>如果需要 <strong>RabbitMQ 高可用集群部署方案</strong>、<strong>Celery 任务重试策略详解</strong> 或 <strong>死信队列配置示例</strong>，欢迎继续提问！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[RabbitMQ如何构建稳定可靠的消息系统]]></title>    <link>https://juejin.cn/post/7596025264455663652</link>    <guid>https://juejin.cn/post/7596025264455663652</guid>    <pubDate>2026-01-17T13:51:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596025264455663652" data-draft-id="7595994039108894756" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="RabbitMQ如何构建稳定可靠的消息系统"/> <meta itemprop="keywords" content="RabbitMQ"/> <meta itemprop="datePublished" content="2026-01-17T13:51:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="哈里谢顿"/> <meta itemprop="url" content="https://juejin.cn/user/3678304397695056"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            RabbitMQ如何构建稳定可靠的消息系统
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3678304397695056/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    哈里谢顿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T13:51:42.000Z" title="Sat Jan 17 2026 13:51:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>RabbitMQ 是一个功能强大、高可靠的开源消息中间件，广泛用于解耦、异步处理和流量削峰。但在实际使用中，若配置不当或缺乏监控，<strong>极易引发严重生产问题</strong>。以下是 RabbitMQ 使用过程中常见的 <strong>8 大核心问题</strong> 及其 <strong>根本原因 + 解决方案</strong>，帮助你构建稳定可靠的消息系统。</p>
<hr/>
<h2 data-id="heading-0">🚨 一、消息堆积（Queue Backlog）</h2>
<h3 data-id="heading-1">🔍 问题表现</h3>
<ul>
<li>RabbitMQ 管理界面显示某个 Queue 的 <strong>"Messages ready" 持续增长</strong></li>
<li>消费者处理速度远低于生产者发送速度</li>
<li>系统延迟飙升，业务卡顿</li>
</ul>
<h3 data-id="heading-2">⚠️ 根本原因</h3>
<ol>
<li><strong>消费者处理能力不足</strong>（CPU/IO 瓶颈）</li>
<li><strong>消费者宕机或未启动</strong></li>
<li><strong>任务逻辑存在死循环或阻塞</strong></li>
<li><strong>突发流量激增</strong></li>
</ol>
<h3 data-id="heading-3">✅ 解决方案</h3>





























<table><thead><tr><th>措施</th><th>说明</th></tr></thead><tbody><tr><td><strong>横向扩容消费者</strong></td><td>增加 Worker 实例（Celery: <code>celery -A app worker -Q xxx --concurrency=4</code>）</td></tr><tr><td><strong>优化消费逻辑</strong></td><td>异步 I/O、批量处理、减少 DB 查询</td></tr><tr><td><strong>限流生产者</strong></td><td>在客户端做速率限制（如令牌桶）</td></tr><tr><td><strong>设置 TTL + 死信队列</strong></td><td>自动丢弃过期消息，避免无限堆积</td></tr><tr><td><strong>监控告警</strong></td><td>对 Queue 长度设置阈值告警（如 &gt; 10,000 条）</td></tr></tbody></table>
<blockquote>
<p>💡 <strong>TTL + DLX 配置示例</strong>：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 声明主队列（带 TTL 和 DLX）</span>
channel.queue_declare(
    <span class="hljs-attr">queue</span>=<span class="hljs-string">'main_queue'</span>,
    <span class="hljs-attr">arguments</span>={
        'x-message-ttl': 60000,  <span class="hljs-comment"># 60秒过期</span>
        'x-dead-letter-exchange': 'dlx_exchange'
    }
)
</code></pre>
</blockquote>
<hr/>
<h2 data-id="heading-4">🗑️ 二、消息丢失（Message Loss）</h2>
<h3 data-id="heading-5">🔍 问题表现</h3>
<ul>
<li>生产者发送成功，但消费者从未收到</li>
<li>RabbitMQ 重启后部分消息消失</li>
</ul>
<h3 data-id="heading-6">⚠️ 根本原因（按链路分析）</h3>





















<table><thead><tr><th>环节</th><th>风险点</th></tr></thead><tbody><tr><td><strong>生产者 → Broker</strong></td><td>未开启 <code>publisher confirms</code>，网络中断导致消息未到达</td></tr><tr><td><strong>Broker 内部</strong></td><td>未持久化：Queue 非 durable / Message 非 persistent</td></tr><tr><td><strong>Broker → 消费者</strong></td><td>消费者未 ACK 就宕机，且 <code>auto_ack=True</code></td></tr></tbody></table>
<h3 data-id="heading-7">✅ 解决方案（端到端可靠性）</h3>
<h4 data-id="heading-8">1. <strong>生产者端：启用发布确认（Publisher Confirms）</strong></h4>
<pre><code class="hljs language-ini" lang="ini">channel.confirm_select()  <span class="hljs-comment"># 开启确认模式</span>
channel.basic_publish(<span class="hljs-attr">exchange</span>=<span class="hljs-string">''</span>, routing_key=<span class="hljs-string">'q'</span>, body=msg)
if not channel.wait_for_confirms(<span class="hljs-attr">timeout</span>=<span class="hljs-number">5</span>):
    raise Exception("Message not confirmed!")
</code></pre>
<h4 data-id="heading-9">2. <strong>Broker 端：持久化配置</strong></h4>
<ul>
<li>
<p><strong>Queue 声明为 durable</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">channel.queue_declare(<span class="hljs-attr">queue</span>=<span class="hljs-string">'task_queue'</span>, durable=<span class="hljs-literal">True</span>)
</code></pre>
</li>
<li>
<p><strong>消息标记为 persistent</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">channel.basic_publish(
    <span class="hljs-attr">exchange</span>=<span class="hljs-string">''</span>,
    <span class="hljs-attr">routing_key</span>=<span class="hljs-string">'task_queue'</span>,
    <span class="hljs-attr">body</span>=message,
    <span class="hljs-attr">properties</span>=pika.BasicProperties(delivery_mode=<span class="hljs-number">2</span>)  <span class="hljs-comment"># 2 = persistent</span>
)
</code></pre>
</li>
</ul>
<h4 data-id="heading-10">3. <strong>消费者端：手动 ACK + 重入队</strong></h4>
<pre><code class="hljs language-ini" lang="ini">def callback(ch, method, properties, body):
    try:
        process(body)
        ch.basic_ack(<span class="hljs-attr">delivery_tag</span>=method.delivery_tag)  <span class="hljs-comment"># 成功后 ACK</span>
    except Exception:
        <span class="hljs-comment"># 失败时拒绝并重新入队（可选）</span>
        ch.basic_nack(<span class="hljs-attr">delivery_tag</span>=method.delivery_tag, requeue=<span class="hljs-literal">True</span>)
</code></pre>
<blockquote>
<p>📌 <strong>关键原则</strong>：<br/>
<strong>“发前确认 + 存盘持久 + 收后 ACK” 三位一体，缺一不可！</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-11">💥 三、消费者雪崩（Consumer Avalanche）</h2>
<h3 data-id="heading-12">🔍 问题表现</h3>
<ul>
<li>消费者因处理失败大量重试</li>
<li>重试消息瞬间压垮下游服务（如数据库、API）</li>
<li>连锁反应导致整个系统瘫痪</li>
</ul>
<h3 data-id="heading-13">⚠️ 根本原因</h3>
<ul>
<li><strong>无退避重试</strong>：失败后立即重新入队</li>
<li><strong>无熔断机制</strong>：持续冲击已故障的服务</li>
</ul>
<h3 data-id="heading-14">✅ 解决方案</h3>
<h4 data-id="heading-15">方案1：<strong>指数退避重试（推荐）</strong></h4>
<ul>
<li>
<p>消费者捕获异常后，将消息发到 <strong>延迟队列</strong>（通过 TTL + DLX 实现）</p>
</li>
<li>
<p>示例流程：</p>
<pre><code class="hljs language-ini" lang="ini">main_queue → 失败 → delay_10s_queue (<span class="hljs-attr">TTL</span>=<span class="hljs-number">10</span>s) → DLX → main_queue
</code></pre>
</li>
</ul>
<h4 data-id="heading-16">方案2：<strong>死信队列（DLQ）隔离</strong></h4>
<ul>
<li>超过 N 次重试后，转入 DLQ 人工处理</li>
<li>避免无效消息反复冲击系统</li>
</ul>
<h4 data-id="heading-17">方案3：<strong>消费者限流</strong></h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 限制每个消费者同时处理的消息数</span>
channel.basic_qos(<span class="hljs-attr">prefetch_count</span>=<span class="hljs-number">1</span>)  <span class="hljs-comment"># 公平分发</span>
</code></pre>
<hr/>
<h2 data-id="heading-18">🔒 四、连接/内存耗尽</h2>
<h3 data-id="heading-19">🔍 问题表现</h3>
<ul>
<li>RabbitMQ 日志出现 <code>memory alarm</code> 或 <code>connection_closed_abruptly</code></li>
<li>客户端频繁断连重连</li>
<li>服务器 OOM（Out of Memory）</li>
</ul>
<h3 data-id="heading-20">⚠️ 根本原因</h3>
<ol>
<li><strong>连接泄漏</strong>：客户端未正确关闭连接</li>
<li><strong>Channel 泄漏</strong>：大量未关闭的 Channel</li>
<li><strong>消息体积过大</strong>：单条消息 &gt; 100MB</li>
<li><strong>未设置内存告警阈值</strong></li>
</ol>
<h3 data-id="heading-21">✅ 解决方案</h3>

























<table><thead><tr><th>问题</th><th>措施</th></tr></thead><tbody><tr><td><strong>连接管理</strong></td><td>使用连接池（如 <code>pika.BlockingConnection</code> 复用）</td></tr><tr><td><strong>大消息处理</strong></td><td>拆分消息 or 存储到外部（如 S3），只传 URL</td></tr><tr><td><strong>内存控制</strong></td><td>调整 <code>vm_memory_high_watermark</code>（默认 40%）</td></tr><tr><td><strong>监控指标</strong></td><td>监控 <code>connections</code>, <code>channels</code>, <code>memory_used</code></td></tr></tbody></table>
<blockquote>
<p>💡 <strong>RabbitMQ 内存告警配置</strong>（<code>rabbitmq.conf</code>）：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">vm_memory_high_watermark.relative</span> = <span class="hljs-number">0.6</span>  <span class="hljs-comment"># 使用 60% 内存时触发流控</span>
</code></pre>
</blockquote>
<hr/>
<h2 data-id="heading-22">🔄 五、重复消费（Duplicate Delivery）</h2>
<h3 data-id="heading-23">🔍 问题表现</h3>
<ul>
<li>同一条消息被消费多次</li>
<li>导致数据不一致（如重复扣款、重复发邮件）</li>
</ul>
<h3 data-id="heading-24">⚠️ 根本原因</h3>
<ul>
<li><strong>消费者处理成功但 ACK 丢失</strong>（网络闪断）</li>
<li><strong>消费者超时未 ACK，Broker 重新投递</strong></li>
</ul>
<h3 data-id="heading-25">✅ 解决方案：<strong>业务层幂等性设计</strong></h3>





















<table><thead><tr><th>方法</th><th>说明</th></tr></thead><tbody><tr><td><strong>唯一 ID 去重</strong></td><td>消息携带 <code>message_id</code>，消费者用 Redis 记录已处理 ID</td></tr><tr><td><strong>数据库唯一约束</strong></td><td>如订单号唯一，重复插入会报错</td></tr><tr><td><strong>状态机校验</strong></td><td>只允许从“待支付” → “已支付”，拒绝重复操作</td></tr></tbody></table>
<blockquote>
<p>📌 <strong>注意</strong>：RabbitMQ <strong>无法保证 Exactly-Once 语义</strong>，必须由业务层实现幂等！</p>
</blockquote>
<hr/>
<h2 data-id="heading-26">🌐 六、集群脑裂（Split-Brain）</h2>
<h3 data-id="heading-27">🔍 问题表现（多节点集群）</h3>
<ul>
<li>网络分区后，两个子集群各自选举 Master</li>
<li>数据不一致，消息可能丢失或重复</li>
</ul>
<h3 data-id="heading-28">⚠️ 根本原因</h3>
<ul>
<li>网络不稳定导致节点间通信中断</li>
<li>未配置自动处理策略</li>
</ul>
<h3 data-id="heading-29">✅ 解决方案：<strong>配置网络分区处理策略</strong></h3>
<p>在 <code>rabbitmq.conf</code> 中设置：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 推荐：pause_minority（少数派暂停）</span>
<span class="hljs-attr">cluster_partition_handling</span> = pause_minority

<span class="hljs-comment"># 或 autoheal（自动愈合，但可能丢数据）</span>
<span class="hljs-comment"># cluster_partition_handling = autoheal</span>
</code></pre>
<blockquote>
<p>📌 <strong>pause_minority 策略</strong>：<br/>
网络分区后，<strong>节点数较少的一方自动暂停服务</strong>，避免脑裂。</p>
</blockquote>
<hr/>
<h2 data-id="heading-30">🕵️ 七、权限与安全漏洞</h2>
<h3 data-id="heading-31">🔍 常见风险</h3>
<ul>
<li>默认用户 <code>guest/guest</code> 未修改</li>
<li>开放 5672 端口到公网</li>
<li>未启用 TLS 加密</li>
</ul>
<h3 data-id="heading-32">✅ 安全加固措施</h3>
<ol>
<li>
<p><strong>删除默认用户</strong>：</p>
<pre><code class="hljs">rabbitmqctl delete_user guest
</code></pre>
</li>
<li>
<p><strong>创建最小权限用户</strong>：</p>
<pre><code class="hljs language-arduino" lang="arduino">rabbitmqctl add_user myapp secret123
rabbitmqctl set_permissions -p / myapp <span class="hljs-string">".*"</span> <span class="hljs-string">".*"</span> <span class="hljs-string">".*"</span>
</code></pre>
</li>
<li>
<p><strong>启用 TLS</strong>：</p>
<ul>
<li>配置 SSL 证书，使用 <code>amqps://</code> 连接</li>
</ul>
</li>
<li>
<p><strong>防火墙限制</strong>：</p>
<ul>
<li>仅允许可信 IP 访问 5672/15672 端口</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-33">📉 八、监控缺失导致故障发现滞后</h2>
<h3 data-id="heading-34">✅ 必须监控的核心指标</h3>



































<table><thead><tr><th>指标</th><th>工具</th><th>告警阈值</th></tr></thead><tbody><tr><td>Queue 长度</td><td>RabbitMQ Management Plugin</td><td>&gt; 10,000</td></tr><tr><td>消息速率（入/出）</td><td>Prometheus + rabbitmq_exporter</td><td>突降 90%</td></tr><tr><td>内存使用率</td><td><code>rabbitmqctl status</code></td><td>&gt; 80%</td></tr><tr><td>连接数</td><td>Management API</td><td>&gt; 最大连接数 * 80%</td></tr><tr><td>消费者数量</td><td>Management Plugin</td><td>= 0（无人消费）</td></tr></tbody></table>
<blockquote>
<p>💡 <strong>推荐工具栈</strong>：<br/>
<strong>Prometheus + Grafana + Alertmanager</strong> 实现可视化监控告警</p>
</blockquote>
<hr/>
<h2 data-id="heading-35">✅ 总结：RabbitMQ 生产环境 Checklist</h2>
<ul>
<li><strong>消息可靠性</strong>：发布确认 + 持久化 + 手动 ACK</li>
<li><strong>消费者健壮性</strong>：幂等设计 + 退避重试 + DLQ</li>
<li><strong>资源控制</strong>：内存告警 + 连接池 + 大消息拆分</li>
<li><strong>高可用</strong>：集群 + 网络分区策略</li>
<li><strong>安全</strong>：强密码 + 防火墙 + TLS</li>
<li><strong>可观测性</strong>：全链路监控 + 告警</li>
</ul>
<blockquote>
<p>🌟 <strong>终极建议</strong>：<br/>
<strong>不要等到线上故障才重视消息队列！</strong><br/>
在测试环境模拟 <strong>Broker 宕机、网络延迟、消费者崩溃</strong> 等场景，验证系统韧性。</p>
</blockquote>
<p>如果需要 <strong>RabbitMQ 高可用集群部署模板</strong>、<strong>死信队列完整代码示例</strong> 或 <strong>与 Celery 集成的最佳实践</strong>，欢迎继续提问！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[8个大脑同时转？美团LongCat开源，让AI学会“三思后行”]]></title>    <link>https://juejin.cn/post/7595890117865783342</link>    <guid>https://juejin.cn/post/7595890117865783342</guid>    <pubDate>2026-01-17T12:13:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595890117865783342" data-draft-id="7595894884956995635" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="8个大脑同时转？美团LongCat开源，让AI学会“三思后行”"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2026-01-17T12:13:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="墨风如雪"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            8个大脑同时转？美团LongCat开源，让AI学会“三思后行”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    墨风如雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T12:13:34.000Z" title="Sat Jan 17 2026 12:13:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2026年刚开年，开源AI社区就迎来了一个重磅玩家。</p>
<p>这次不再是单纯比拼谁的参数更大、谁聊闲天更溜，美团LongCat团队直接把桌子掀了，端上来一盘硬菜：<strong>LongCat-Flash-Thinking-2601</strong>。这名字听着挺长，其实核心就讲了一件事——让AI学会像人类专家一样，遇到难题先别急着张嘴，停下来，多想几遍。</p>
<p>很多开发者在这个模型发布后惊呼，这可能是目前最接近“系统2”思维（慢思考）的开源尝试。今天咱们就抛开那些晦涩的论文公式，聊聊这个模型到底神在哪儿，以及它为什么敢说自己在复杂任务上超越了Claude-Opus-4.5。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2Fadsfsdgdfg-1024x369.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/adsfsdgdfg-1024x369.webp" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aa28775ab87b4cde80e87f331aa31743~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769256814&amp;x-signature=jXXAs1ahKjVjU5oejOCb1faaTEQ%3D" alt="adsfsdgdfg" loading="lazy"/></a></p>
<p><strong>拒绝“直觉式”回答：什么是重思考模式？</strong></p>
<p>以前的大模型，哪怕是所谓的推理模型，大多还是“单线程”的。你问个问题，它顺着逻辑链条往下编，一旦中间某一步走歪了，后面就全崩了。</p>
<p>美团这次搞了个创新，叫“Heavy Thinking Mode”（重思考模式）。这玩意儿有点意思，它模仿了人类面对极难数学题或者复杂代码bug时的状态。</p>
<p>当你开启这个模式，LongCat并不是马上给你答案，而是<strong>同时启动8个独立的“大脑”（推理路径）</strong>。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2Fasfsdfsdg-1024x817.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/asfsdfsdg-1024x817.webp" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/34ae7e3ecf904358b43d17f886a136c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769256814&amp;x-signature=CYVJ6iwWJXGvyIuQxGJdS8QrJcA%3D" alt="asfsdfsdg" loading="lazy"/></a></p>
<p>想象一下，这就像是开了一个圆桌会议。面对你的问题，8个分身同时开始解题，有的试代数法，有的试几何法，有的查文档，有的写伪代码。它们互不干扰，各自探索。</p>
<p>这还没完，等大家都思考得差不多了，进入第二阶段：<strong>总结归纳</strong>。模型会把这8条路径的结果拿来进行比对、验证、去伪存真，把最好的思路像拼积木一样通过“闭环迭代”合成起来，最后才慎重地给你输出一个结果。</p>
<p>这套“想清楚再行动”的机制，直接让它在处理高难度、不确定性任务时的可靠性上了个大台阶。</p>
<p><strong>数据不会撒谎：满分的数学与硬核的实战</strong></p>
<p>咱们来看看成绩单，这也是大家最关心的部分。</p>
<p>在AIME-25（美国数学邀请赛）的评测基准上，开启重思考模式后的LongCat直接拿下了<strong>100.0的满分</strong>。在IMO-AnswerBench（国际奥数级别）上也拿到了86.8分，稳坐目前开源模型的头把交椅。</p>
<p>但真正让圈内人感到兴奋的，其实是它的<strong>工具调用（Agent）能力</strong>。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2Ffsgdhtr-1024x587.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/fsgdhtr-1024x587.webp" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17c90838983141e1bc7610590ec8ba30~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769256814&amp;x-signature=zwPQS4qEl5rDzocgd9Fl15J7%2BDo%3D" alt="fsgdhtr" loading="lazy"/></a></p>
<p>现在的大模型，做数学题只是基本功，能不能熟练使用工具、搜索信息、解决实际问题才是落地的关键。美团官方披露，在依赖工具调用的随机复杂任务中，LongCat的表现超越了Claude-Opus-4.5-Thinking。</p>
<p>注意，这里强调的是“随机复杂任务”。这意味着它不是靠死记硬背常见的API文档，而是真具备了极强的泛化能力。哪怕你给它一个从未见过的、充满随机性的烂摊子工具箱，它也能通过那套“并行思考”机制，试错、调整，最终把活儿干漂亮。</p>
<p>在τ²-Bench基准测试中，它拿到了88.2分；在BrowseComp（智能体搜索能力）上拿到了73.1分。这些数据说明，它不仅是个做题家，更是个实干家。</p>
<p><strong>技术底座：不仅仅是大</strong></p>
<p>LongCat-Flash-Thinking-2601是基于混合专家架构（MoE）构建的。</p>
<p>总参数量达到了560B（5600亿），听起来吓人对吧？但别慌，得益于MoE架构，它在推理时的激活参数只有约27B。这意味着它既拥有巨型模型的知识储备，又能保持相对高效的推理速度（每秒100+ tokens）。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2Fgdfgsdf-1024x605.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/gdfgsdf-1024x605.webp" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8e32958de02b4a1b95114243940d73c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769256814&amp;x-signature=E8FnVas3uGmB6Jwswr4pQOVDiE0%3D" alt="gdfgsdf" loading="lazy"/></a></p>
<p>而且，它的训练方式堪称“斯巴达式”。</p>
<p>为了让模型抗造，团队搞了个“高强度练兵场”。他们在训练数据里故意掺沙子——注入API调用失败、网络超时、返回异常数据等噪声。这种“抗干扰训练”让模型养成了很好的心态：遇到报错不发疯，而是冷静地分析原因，换个姿势继续尝试。这就是为什么它在真实世界的复杂环境中表现得特别稳。</p>
<p><strong>写在最后</strong></p>
<p>美团这次非常地道，不仅仅是发了论文，而是把代码、模型权重全都在GitHub和Hugging Face上开源了，甚至还提供了免费的在线体验和API额度。</p>
<p>对于开发者来说，LongCat提供了一个极具价值的新选择：当你需要一个能处理复杂逻辑、能容忍环境噪声、且具备深度推理能力的智能体核心时，不需要再死磕昂贵的闭源API了。</p>
<p>在这个浮躁的时代，愿意花时间教AI“三思而后行”，本身就是一件值得长期主义者点赞的事。如果你对AI的逻辑推理能力有高要求，LongCat绝对值得你去拉下来跑一跑。</p>
<p><strong>如果你也对最新的AI信息感兴趣或者有疑问 都可以加入我的大家庭 第一时间分享最新AI资讯、工具、教程、文档 欢迎你的加入！！！😉😉😉</strong></p>
<p>公众号：墨风如雪小站</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[K-Medoids聚类方法和K-Means有什么区别？]]></title>    <link>https://juejin.cn/post/7595842144907477042</link>    <guid>https://juejin.cn/post/7595842144907477042</guid>    <pubDate>2026-01-17T12:45:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595842144907477042" data-draft-id="7595890117865832494" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="K-Medoids聚类方法和K-Means有什么区别？"/> <meta itemprop="keywords" content="面试,算法"/> <meta itemprop="datePublished" content="2026-01-17T12:45:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="aicoting"/> <meta itemprop="url" content="https://juejin.cn/user/933911964427818"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            K-Medoids聚类方法和K-Means有什么区别？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/933911964427818/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    aicoting
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T12:45:01.000Z" title="Sat Jan 17 2026 12:45:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>推荐直接网站在线阅读：<a href="https://link.juejin.cn?target=https%3A%2F%2Faicoting.cn%2F" target="_blank" title="https://aicoting.cn/" ref="nofollow noopener noreferrer">aicoting AI算法面试学习在线网站</a></p>
</blockquote>
<h2 data-id="heading-0">什么是聚类？</h2>
<p>聚类（Clustering）是一种典型的无监督学习方法，其目标是在没有标签信息的情况下，将数据样本按照相似性划分为若干簇，使得同一簇内的样本相似度高，不同簇之间差异显著。常见方法包括基于划分的 K-Means、基于层次的 层次聚类、以及基于密度的 DBSCAN、OPTICS 等。聚类广泛应用于用户分群、市场细分、文本主题发现、图像分割等任务，是数据挖掘和探索性分析中的重要工具。</p>
<h2 data-id="heading-1">K-Means 聚类</h2>
<p>K-Means 是最经典的聚类算法之一，属于基于划分（Partition-based）的聚类方法。它通过迭代优化目标函数，将数据划分为 K 个簇，使得同簇内样本之间相似度最大化，而不同簇之间相似度最小化。一个簇说白了就是一组相同类别的东西，只是在这个方法里起了个名字叫簇，比如苹果，香蕉，橘子属于水果那一簇，彭于晏，刘亦菲和你们属于帅哥美女那一簇。由于其简单、高效，K-Means 在数据挖掘、文本分析、图像分割等领域被广泛应用。</p>
<p>K-Means 的目标是最小化簇内平方误差（Within-Cluster Sum of Squares, WCSS），即：</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>J</mi><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>K</mi></msubsup><msub><mo>∑</mo><mrow><mi>x</mi><mo>∈</mo><msub><mi>C</mi><mi>i</mi></msub></mrow></msub><mi mathvariant="normal">∥</mi><mi>x</mi><mo>−</mo><msub><mi>μ</mi><mi>i</mi></msub><msup><mi mathvariant="normal">∥</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">J = \sum_{i=1}^{K} \sum_{x \in C_i} \| x - \mu_i \|^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.381em;vertical-align:-0.3998em;"/><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9812em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1786em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="mrel mtight">∈</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.0715em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span/></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3998em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">∥</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"/><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord"><span class="mord">∥</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>其中：</p>
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span></span> ：簇的个数</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">C_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> ：第 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"/><span class="mord mathnormal">i</span></span></span></span></span> 个簇</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>μ</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">μ_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> ：簇 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">C_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> 的质心（均值向量）</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∥</mi><mi>x</mi><mo>−</mo><msub><mi>μ</mi><mi>i</mi></msub><msup><mi mathvariant="normal">∥</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">\| x - \mu_i \|^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">∥</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"/><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord"><span class="mord">∥</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span> ：样本点与簇中心的欧式距离 K-Means的核心思想就是不断更新簇划分与质心，直到收敛（目标函数不再显著下降）。</li>
</ul>
<p>K-Means的算法流程也很容易理解：</p>
<ol>
<li>初始化：随机选择 K 个样本作为初始质心。</li>
<li>分配样本：将每个样本分配到距离最近的簇中心。</li>
<li>更新质心：对每个簇，计算所有样本的均值作为新的质心。</li>
<li>迭代：重复步骤 2-3，直到簇划分不再变化或目标函数收敛。</li>
</ol>
<p>下面基于Scikit-learn编写一段示例代码让咱们更好的理解一下：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> sklearn.datasets <span class="hljs-keyword">import</span> make_blobs
<span class="hljs-keyword">from</span> sklearn.cluster <span class="hljs-keyword">import</span> KMeans
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt

<span class="hljs-comment"># 1. 生成模拟数据</span>
X, y = make_blobs(n_samples=<span class="hljs-number">300</span>, centers=<span class="hljs-number">4</span>, cluster_std=<span class="hljs-number">0.6</span>, random_state=<span class="hljs-number">42</span>)

<span class="hljs-comment"># 2. 训练 K-Means</span>
kmeans = KMeans(n_clusters=<span class="hljs-number">4</span>, random_state=<span class="hljs-number">42</span>, n_init=<span class="hljs-number">10</span>)
y_pred = kmeans.fit_predict(X)

<span class="hljs-comment"># 3. 可视化结果</span>
plt.scatter(X[:, <span class="hljs-number">0</span>], X[:, <span class="hljs-number">1</span>], c=y_pred, s=<span class="hljs-number">30</span>, cmap=<span class="hljs-string">'viridis'</span>)
plt.scatter(kmeans.cluster_centers_[:, <span class="hljs-number">0</span>], kmeans.cluster_centers_[:, <span class="hljs-number">1</span>],
            c=<span class="hljs-string">'red'</span>, marker=<span class="hljs-string">'X'</span>, s=<span class="hljs-number">200</span>, label=<span class="hljs-string">'Centroids'</span>)
plt.legend()
plt.title(<span class="hljs-string">"K-Means Clustering"</span>)
plt.show()
</code></pre>
<p>运行结果如下，不同颜色表示不同簇，红色 X 为聚类中心。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fbc5299f7e86494186c6599a1ea24857~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769258700&amp;x-signature=MaOGFmkgTpG4Wm6I6R3dNsa2ODY%3D" alt="" loading="lazy"/></p>
<p>总结环节！K-Means 作为经典的无监督学习方法，凭借其高效性和直观性，成为最常用的聚类算法之一。但在实际应用中，需要注意簇数选择、初始点敏感性以及对复杂分布的适用性问题。针对这些不足，研究者提出了 K-Means++、Mini-Batch K-Means 等改进方法，使其在大规模机器学习任务中依然具有重要地位。</p>
<h2 data-id="heading-2">K-Medoids 聚类</h2>
<p>K-Medoids（又称 PAM，Partitioning Around Medoids）是一种基于划分的聚类方法，与 K-Means 类似，但它使用数据集中真实存在的点作为簇中心（称为“Medoid”），而不是均值向量。这使得 K-Medoids 对 异常值和噪声更加鲁棒，适合处理非欧式距离或离散型数据。</p>
<p>K-Medoids 的目标函数是最小化样本与所属簇中心的距离和：</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>J</mi><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>K</mi></msubsup><msub><mo>∑</mo><mrow><mi>x</mi><mo>∈</mo><msub><mi>C</mi><mi>i</mi></msub></mrow></msub><mi>d</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><msub><mi>m</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">J = \sum_{i=1}^{K} \sum_{x \in C_i} d(x, m_i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.381em;vertical-align:-0.3998em;"/><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9812em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1786em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="mrel mtight">∈</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.0715em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span/></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3998em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p>
<p>其中：</p>
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span></span>：簇的个数</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">C_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span>：第<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"/><span class="mord mathnormal">i</span></span></span></span></span> 个簇</li>
<li>：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>m</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">m_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> 簇 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">C_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> 的的中心（medoid，即簇中某个实际点）</li>
<li>：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><msub><mi>m</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">d(x, m_i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>样本点与簇中心 之间的距离（可以是欧式距离、曼哈顿距离，甚至非向量空间距离）</li>
</ul>
<p>与 K-Means 的主要区别是：</p>
<ul>
<li>K-Means 的中心是 簇内均值，可能不属于数据集；</li>
<li>K-Medoids 的中心是 真实样本点，因此对噪声更稳健。</li>
</ul>
<p>K-Medoids 最经典的实现是 PAM（Partitioning Around Medoids），流程如下：</p>
<ol>
<li>初始化：随机选择 K 个点作为初始 medoid。</li>
<li>分配样本：将每个样本分配给距离最近的 medoid。</li>
<li>更新 medoid：</li>
</ol>
<ul>
<li>
<p>对于每个簇，尝试用簇中其他点替换当前 medoid；</p>
</li>
<li>
<p>计算代价函数变化，如果代价减少，则更新 medoid。</p>
</li>
</ul>
<ol start="4">
<li>迭代：重复步骤 2-3，直到 medoid 不再变化或代价函数收敛。 PAM 的计算复杂度较高，约为
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>k</mi><mo>⋅</mo><mo stretchy="false">(</mo><mi>n</mi><mo>−</mo><mi>k</mi><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(k \cdot (n-k)^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>，因此在大规模数据集上常用 CLARA（Clustering Large Applications） 或 CLARANS 进行加速。</li>
</ol>
<p>下面基于Scikit-learn-extra编写了一段示例代码：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> sklearn.datasets <span class="hljs-keyword">import</span> make_blobs
<span class="hljs-keyword">from</span> sklearn_extra.cluster <span class="hljs-keyword">import</span> KMedoids
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt

<span class="hljs-comment"># 1. 生成模拟数据</span>
X, y = make_blobs(n_samples=<span class="hljs-number">300</span>, centers=<span class="hljs-number">4</span>, cluster_std=<span class="hljs-number">0.6</span>, random_state=<span class="hljs-number">42</span>)

<span class="hljs-comment"># 2. 训练 K-Medoids</span>
kmedoids = KMedoids(n_clusters=<span class="hljs-number">4</span>, random_state=<span class="hljs-number">42</span>, metric=<span class="hljs-string">'euclidean'</span>)
y_pred = kmedoids.fit_predict(X)

<span class="hljs-comment"># 3. 可视化结果</span>
plt.scatter(X[:, <span class="hljs-number">0</span>], X[:, <span class="hljs-number">1</span>], c=y_pred, s=<span class="hljs-number">30</span>, cmap=<span class="hljs-string">'viridis'</span>)
plt.scatter(kmedoids.cluster_centers_[:, <span class="hljs-number">0</span>], kmedoids.cluster_centers_[:, <span class="hljs-number">1</span>],
            c=<span class="hljs-string">'red'</span>, marker=<span class="hljs-string">'X'</span>, s=<span class="hljs-number">200</span>, label=<span class="hljs-string">'Medoids'</span>)
plt.legend()
plt.title(<span class="hljs-string">"K-Medoids Clustering"</span>)
plt.show()
</code></pre>
<p>运行结果如下，其中不同颜色表示不同簇，红色 X 为 medoid。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/83d27f3acead4299a0f545912ee820e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769258700&amp;x-signature=9rakAf8zSwgyIz8EUI6NzFNaa7c%3D" alt="" loading="lazy"/></p>
<p>K-Medoids 是 K-Means 的一种稳健变体，适合在存在噪声、异常点或非欧式距离情况下使用。它的 优势 在于簇中心是实际样本点，结果更具可解释性，同时对异常值和噪声更鲁棒，并且可用于任意距离度量，不局限于欧式空间。但它计算复杂度较高，不适合大规模数据，并且对簇形状仍有一定假设，不适合处理复杂非凸簇。</p>
<p>在实践中，K-Medoids 更适合小规模、高质量数据集，或对稳健性有较高要求的任务，而在大规模场景中往往结合 CLARA/CLARANS 进行优化。</p>
<p>最新的文章都在公众号aicoting更新，别忘记关注哦！！！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一文搞懂层次聚类和密度聚类方法！]]></title>    <link>https://juejin.cn/post/7595842144907493426</link>    <guid>https://juejin.cn/post/7595842144907493426</guid>    <pubDate>2026-01-17T12:49:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595842144907493426" data-draft-id="7595890117865865262" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一文搞懂层次聚类和密度聚类方法！"/> <meta itemprop="keywords" content="算法,面试"/> <meta itemprop="datePublished" content="2026-01-17T12:49:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="aicoting"/> <meta itemprop="url" content="https://juejin.cn/user/933911964427818"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一文搞懂层次聚类和密度聚类方法！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/933911964427818/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    aicoting
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T12:49:51.000Z" title="Sat Jan 17 2026 12:49:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>推荐直接网站在线阅读：<a href="https://link.juejin.cn?target=https%3A%2F%2Faicoting.cn%2F" target="_blank" title="https://aicoting.cn/" ref="nofollow noopener noreferrer">aicoting AI算法面试学习在线网站</a></p>
</blockquote>
<p>聚类（Clustering）是一种典型的无监督学习方法，其目标是在没有标签信息的情况下，将数据样本按照相似性划分为若干簇，使得同一簇内的样本相似度高，不同簇之间差异显著。常见方法包括基于划分的 K-Means、基于层次的 层次聚类、以及基于密度的 DBSCAN、OPTICS 等。聚类广泛应用于用户分群、市场细分、文本主题发现、图像分割等任务，是数据挖掘和探索性分析中的重要工具。</p>
<h2 data-id="heading-0">什么是层次聚类</h2>
<p>在无监督学习方法中，层次聚类（Hierarchical Clustering）是一种常见且直观的聚类方法，广泛应用于文本分析中的主题发现、基因表达数据的模式识别、社会网络中群体结构挖掘、以及图像处理和市场细分等场景。与 K-Means 等划分式方法不同，层次聚类通过构建样本间的层次关系，形成一棵聚类树（dendrogram），帮助我们理解数据的多层次结构。</p>
<p>层次聚类的核心思想是：</p>
<ul>
<li>自底向上（凝聚型，Agglomerative）：初始时将每个样本视为一个簇，然后逐步将最相似的簇合并，直到最终形成一个簇或达到设定的簇数。</li>
<li>自顶向下（分裂型，Divisive）：初始时将所有样本视为一个整体簇，然后逐步分裂为更小的簇，直至达到指定的簇数。</li>
</ul>
<p>常用的是凝聚型层次聚类，因为其计算效率更高且直观。</p>
<p>层次聚类依赖于簇间的距离定义，不同的度量方式会影响结果：</p>
<ul>
<li>单链法（Single Linkage）：簇间最短距离。容易出现“链式效应”。</li>
<li>全链法（Complete Linkage）：簇间最长距离。倾向于得到紧凑的簇。</li>
<li>平均链法（Average Linkage）：簇间平均距离。综合了单链与全链的特点。</li>
<li>Ward 方法：基于平方误差最小化，倾向于生成方差较小、大小相对均衡的簇。</li>
</ul>
<p>以凝聚型层次聚类为例，算法的工作步骤如下：</p>
<ol>
<li>将每个样本作为一个独立簇。</li>
<li>计算所有簇之间的距离。</li>
<li>找到最近的两个簇并合并。</li>
<li>更新簇间距离矩阵。</li>
<li>重复步骤 2-4，直到所有样本被合并为一个簇或达到预设簇数。</li>
</ol>
<p>是不是有点像二分法或者归并排序。</p>
<p>最终结果可以用树状图（dendrogram）直观展示，每个分支的高度代表簇之间的距离。</p>
<p>下面用一段代码形象的理解一下：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> sklearn.datasets <span class="hljs-keyword">import</span> load_iris
<span class="hljs-keyword">from</span> sklearn.cluster <span class="hljs-keyword">import</span> AgglomerativeClustering
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt
<span class="hljs-keyword">from</span> scipy.cluster.hierarchy <span class="hljs-keyword">import</span> dendrogram, linkage

<span class="hljs-comment"># 1. 加载数据</span>
iris = load_iris()
X = iris.data

<span class="hljs-comment"># 2. 层次聚类 (AgglomerativeClustering)</span>
model = AgglomerativeClustering(n_clusters=<span class="hljs-number">3</span>, linkage=<span class="hljs-string">'ward'</span>)
labels = model.fit_predict(X)

<span class="hljs-built_in">print</span>(<span class="hljs-string">"聚类结果："</span>, labels[:<span class="hljs-number">20</span>])

<span class="hljs-comment"># 3. 绘制树状图</span>
Z = linkage(X, method=<span class="hljs-string">'ward'</span>)
plt.figure(figsize=(<span class="hljs-number">8</span>, <span class="hljs-number">5</span>))
dendrogram(Z, truncate_mode=<span class="hljs-string">'level'</span>, p=<span class="hljs-number">3</span>)
plt.title(<span class="hljs-string">"Hierarchical Clustering Dendrogram"</span>)
plt.xlabel(<span class="hljs-string">"Sample Index"</span>)
plt.ylabel(<span class="hljs-string">"Distance"</span>)
plt.show()
</code></pre>
<p>输出结果如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9498d033350d4da99a0cc35811e68cba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769258990&amp;x-signature=sLZIedr05Pxar6Ev3bCmCQT0p4k%3D" alt="" loading="lazy"/></p>
<p>我简单解释一下，比如第一次聚类，第7个样本和第8个样本距离最近，那么他们就成一个组合，组合之间再进行聚类，最后是不是就聚成了目标类别了。</p>
<p>层次聚类的优势在于无需预先指定簇数，能够揭示数据的多层次结构，且结果可视化直观。但其缺点是计算复杂度较高，难以扩展到超大规模数据集，同时对噪声与异常值敏感。在小规模数据分析、模式探索和数据可视化场景中，层次聚类依然是一种非常有价值的方法。</p>
<h2 data-id="heading-1">密度聚类方法</h2>
<p>密度聚类方法通过寻找数据空间中高密度区域来划分簇，能够自然地处理噪声和非凸形簇结构，是传统划分式方法（如 K-Means）难以解决的问题。我们出去玩在地图中搜索美食，这些热点区域或者人口事件聚集区都是通过密度聚类方法实现的。</p>
<p>DBSCAN（Density-Based Spatial Clustering of Applications with Noise）和 OPTICS（Ordering Points To Identify the Clustering Structure）是两种典型的密度聚类方法。</p>
<h3 data-id="heading-2">1.DBSCAN</h3>
<p>DBSCAN 的核心思想是：簇是由密度可达的点组成的区域，而低密度区域视为噪声。</p>
<ul>
<li>核心概念：</li>
<li>-邻域：样本点周围半径为 的区域。</li>
<li>核心点：其 -邻域内点数 ≥ minPts。</li>
<li>边界点：位于核心点 -邻域内，但本身点数 &lt; minPts。</li>
<li>噪声点：不属于任何簇的点。</li>
<li>聚类规则：</li>
</ul>
<ol>
<li>从任意未访问点开始，若其为核心点，则以该点为中心扩展簇，将密度可达的点加入簇。</li>
<li>对簇中新增的核心点重复扩展过程，直到簇无法再扩展。</li>
<li>重复以上步骤，直到所有点都被访问过。</li>
</ol>
<p>DBSCAN 可以发现任意形状的簇，能自动识别噪声点，并且无需预设簇数。但是它对参数 和 minPts 比较敏感，同时在高维数据中效果会有所下降，因为高维数据中密度概念就失效了。</p>
<h3 data-id="heading-3">2.OPTICS</h3>
<p>OPTICS 是 DBSCAN 的改进，主要解决 DBSCAN 在参数选择（尤其是 ）上的限制。</p>
<ul>
<li>核心思想：不直接生成簇，而是生成 可达距离序列（reachability distance），记录点之间的密度结构。</li>
<li>聚类规则：</li>
</ul>
<ol>
<li>对每个点计算核心距离（core distance）和可达距离（reachability distance）；</li>
<li>按可达距离顺序访问所有点，形成一个有序列表；</li>
<li>可通过可达距离的突变检测不同密度区域，从而识别簇。</li>
</ol>
<p>OPTICS能发现不同密度的簇，并且不需要严格指定 ε 值，适合数据密度不均匀的场景。但是计算复杂度比 DBSCAN 高，结果需要进一步分析才能确定簇边界。 下面我们用实现的代码展示一下这两种方法的效果好坏：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> sklearn.datasets <span class="hljs-keyword">import</span> make_moons
<span class="hljs-keyword">from</span> sklearn.cluster <span class="hljs-keyword">import</span> DBSCAN
<span class="hljs-keyword">from</span> sklearn.cluster <span class="hljs-keyword">import</span> OPTICS
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt

<span class="hljs-comment"># 生成非凸形数据</span>
X, y = make_moons(n_samples=<span class="hljs-number">300</span>, noise=<span class="hljs-number">0.05</span>, random_state=<span class="hljs-number">42</span>)

<span class="hljs-comment"># DBSCAN 聚类</span>
dbscan = DBSCAN(eps=<span class="hljs-number">0.2</span>, min_samples=<span class="hljs-number">5</span>)
labels_dbscan = dbscan.fit_predict(X)

<span class="hljs-comment"># OPTICS 聚类</span>
optics = OPTICS(min_samples=<span class="hljs-number">5</span>, xi=<span class="hljs-number">0.05</span>, min_cluster_size=<span class="hljs-number">0.1</span>)
labels_optics = optics.fit_predict(X)

<span class="hljs-comment"># 可视化 DBSCAN</span>
plt.figure(figsize=(<span class="hljs-number">12</span>,<span class="hljs-number">5</span>))
plt.subplot(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>)
plt.scatter(X[:,<span class="hljs-number">0</span>], X[:,<span class="hljs-number">1</span>], c=labels_dbscan, cmap=<span class="hljs-string">'viridis'</span>, s=<span class="hljs-number">30</span>)
plt.title(<span class="hljs-string">"DBSCAN Clustering"</span>)

<span class="hljs-comment"># 可视化 OPTICS</span>
plt.subplot(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>)
plt.scatter(X[:,<span class="hljs-number">0</span>], X[:,<span class="hljs-number">1</span>], c=labels_optics, cmap=<span class="hljs-string">'viridis'</span>, s=<span class="hljs-number">30</span>)
plt.title(<span class="hljs-string">"OPTICS Clustering"</span>)
plt.show()
</code></pre>
<p>运行结果如下，可以看到DBSCAN 和 OPTICS 都能识别非凸簇，OPTICS 对不同密度簇表现更稳健。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4771130d2c6f4e41832259f9e51450cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769258990&amp;x-signature=DFW34DOEMOeZ%2BQIJb6U5gMIiu3M%3D" alt="" loading="lazy"/></p>
<p>总结时刻到，DBSCAN 和 OPTICS 是密度聚类的代表方法：</p>
<ul>
<li>DBSCAN 简单高效，适合簇密度均匀、噪声点明确的数据；</li>
<li>OPTICS 解决了 DBSCAN 对参数敏感的问题，能处理不同密度的簇，但计算复杂度更高。</li>
</ul>
<p>总体来说，密度聚类方法在非球形簇、异常点检测和探索性数据分析中具有明显优势，是传统划分聚类方法的重要补充。</p>
<p>最新的文章都在公众号aicoting更新，别忘记关注哦！！！</p>
<p>作者：aicoting</p>
<p>分享是一种信仰，连接让成长更有温度。</p>
<p>我们下次不见不散！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[短信验证码又被盗刷？这篇文章帮你封住所有漏洞]]></title>    <link>https://juejin.cn/post/7595974133096906786</link>    <guid>https://juejin.cn/post/7595974133096906786</guid>    <pubDate>2026-01-17T12:53:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595974133096906786" data-draft-id="7532150298455064614" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="短信验证码又被盗刷？这篇文章帮你封住所有漏洞"/> <meta itemprop="keywords" content="后端,面试,性能优化"/> <meta itemprop="datePublished" content="2026-01-17T12:53:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一只叫煤球的猫"/> <meta itemprop="url" content="https://juejin.cn/user/1732486058745054"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            短信验证码又被盗刷？这篇文章帮你封住所有漏洞
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1732486058745054/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一只叫煤球的猫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T12:53:11.000Z" title="Sat Jan 17 2026 12:53:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>阿城最近在我的熏陶下，喜欢看各种文章和代码。</p>
<p>那天他给我发了一个代码截图，附带着几句话：</p>
<p>“哥你看，这段 <code>sendCode</code> 写得挺清爽的，但是我咋看着不对劲呢”</p>
<p>“短信验证码这种接口，就这么暴露出去？会不会被人刷爆？”</p>
<p>我扫了一眼截图：一个 <code>POST /sendCode</code>，传手机号就发短信；没限流、没人机校验、没发送间隔、也没次数上限。</p>
<p>代码足够清爽，但安全性也确实清爽，看着就透心凉。</p>
<p>我跟阿城说：短信验证码这个东西，本质上并不是个普通的业务接口。这段代码确实写得很优雅，但完全没防护，那一旦发生意外，它也会优雅地把短信预算送走，甚至攻击者都不需要多厉害，只要一段脚本就够了。</p>
<p>所以这篇文章，我们把短信验证码发送链路里最常见的漏洞拆开讲明白，再按漏洞逐个去做防御。</p>
<p>要注意的是，有些防御措施以牺牲用户体验为代价，但这一般都是在<strong>安全、成本、转化率</strong>之间做过权衡后的综合选择，而不是为了安全而安全。</p>
<p>耐心看完，你一定有所收获。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7866e03a8c4b4677b7753f0312a6bcc5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5Y-q5Y-r54Wk55CD55qE54yr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769259191&amp;x-signature=ZODVJ062kE4J3CFz5RIH5p3lOUE%3D" alt="Text Love GIF by Pudgy Penguins.gif" loading="lazy"/></p>
<h2 data-id="heading-1">正文</h2>
<h3 data-id="heading-2">常见漏洞</h3>
<h4 data-id="heading-3">漏洞 1：没有频率限制（或限制太单薄）</h4>
<ul>
<li>同一个 IP / 同一个手机号可以高频请求</li>
<li>攻击脚本一分钟几百次，接口照单全收</li>
</ul>
<h4 data-id="heading-4">漏洞 2：只按手机号限制，不按 IP / 设备 / 用户限制</h4>
<ul>
<li>攻击者换手机号就绕过</li>
<li>或者用代理池换 IP 绕过单 IP 规则</li>
</ul>
<h4 data-id="heading-5">漏洞 3：缺少人机校验（图形/滑动/行为验证码）</h4>
<ul>
<li>发送验证码变成一个无门槛的接口</li>
<li>脚本完全可以模拟正常请求流程</li>
</ul>
<h4 data-id="heading-6">漏洞 4：验证码校验链路可被暴力尝试</h4>
<ul>
<li>验证接口不限制失败次数</li>
<li>验证码过长有效期、可重复使用</li>
<li>导致猜码或撞码的风险上升</li>
</ul>
<h4 data-id="heading-7">漏洞 5：缺少幂等与监控</h4>
<ul>
<li>用户/前端重试也可能造成重复扣费</li>
<li>没有告警，往往是产生账单后才发现</li>
</ul>
<h3 data-id="heading-8">对症下药</h3>
<p>下面我们按漏洞对应防御策略来写。每个策略都讲清楚：</p>
<ol>
<li>解决了什么问题</li>
<li>带来什么副作用（用户体验/误伤）</li>
<li>如何落地（给出最小必要代码示例）</li>
</ol>
<blockquote>
<p>示例默认：Spring Boot + Redis，想必这也是最通用的组合。</p>
</blockquote>
<h4 data-id="heading-9">1. 频率限制：先把无穷发送变成有限发送</h4>
<h5 data-id="heading-10">1.1 IP 维度限流：挡住最常见的脚本</h5>
<p><strong>作用：</strong> 同一来源 IP 短时间内没法频繁打接口。<br/>
<strong>副作用：</strong> 同一个出口 IP（比如公司网络、校园网）可能多人共用，阈值太小会误伤。</p>
<p><strong>示例：同一 IP 60 秒最多 5 次</strong></p>
<pre><code class="hljs language-ini" lang="ini">String <span class="hljs-attr">ip</span> = request.getRemoteAddr()<span class="hljs-comment">;</span>
String <span class="hljs-attr">key</span> = <span class="hljs-string">"sms:rl:ip:"</span> + ip<span class="hljs-comment">;</span>

Long <span class="hljs-attr">n</span> = redis.opsForValue().increment(key)<span class="hljs-comment">;</span>
if (n != null &amp;&amp; <span class="hljs-attr">n</span> == <span class="hljs-number">1</span>) redis.expire(key, Duration.ofSeconds(<span class="hljs-number">60</span>))<span class="hljs-comment">;</span>
if (n != null &amp;&amp; n &gt; 5) throw new TooManyRequestsException("请求过于频繁")<span class="hljs-comment">;</span>
</code></pre>
<blockquote>
<p>建议：IP 限流阈值也不能无脑一刀切，更推荐超过阈值后进入更严格校验（比如人机验证），而不是直接拦截。</p>
</blockquote>
<h5 data-id="heading-11">1.2 手机号限流：最典型</h5>
<p><strong>作用：</strong> 同一手机号必须冷却，并有当天的上限。<br/>
<strong>副作用：</strong> 极少数情况下用户确实需要多次发送（比如网络延迟、短信被拦截等），会给用户带来意想不到的麻烦。</p>
<p><strong>示例：60 秒冷却 + 24 小时最多 5 次</strong></p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 60s 冷却</span>
<span class="hljs-built_in">String</span> cdKey = <span class="hljs-string">"sms:cd:"</span> + phone;
<span class="hljs-keyword">if</span> (Boolean.TRUE.equals(redis.hasKey(cdKey))) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> TooManyRequestsException(<span class="hljs-string">"请稍后再试"</span>);
redis.opsForValue().<span class="hljs-keyword">set</span>(cdKey, <span class="hljs-string">"1"</span>, <span class="hljs-built_in">Duration</span>.ofSeconds(<span class="hljs-number">60</span>));

<span class="hljs-comment">// 24h 上限</span>
<span class="hljs-built_in">String</span> dayKey = <span class="hljs-string">"sms:cnt:"</span> + phone;
Long cnt = redis.opsForValue().increment(dayKey);
<span class="hljs-keyword">if</span> (cnt != <span class="hljs-keyword">null</span> &amp;&amp; cnt == <span class="hljs-number">1</span>) redis.expire(dayKey, <span class="hljs-built_in">Duration</span>.ofHours(<span class="hljs-number">24</span>));
<span class="hljs-keyword">if</span> (cnt != <span class="hljs-keyword">null</span> &amp;&amp; cnt &gt; <span class="hljs-number">5</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> TooManyRequestsException(<span class="hljs-string">"今日验证码次数已用完"</span>);
</code></pre>
<blockquote>
<p>体验权衡：</p>
<ul>
<li>冷却时间 60s 基本是行业共识；</li>
<li>日上限 5 次对绝大多数用户足够，但能显著压制攻击成本。<br/>
这属于轻度影响体验，但极大降低风险，是比较典型的决策。</li>
</ul>
</blockquote>
<h5 data-id="heading-12">1.3 用户/设备维度限流</h5>
<p>如果有 <code>userId</code>（已登录）或可靠的 <code>deviceId</code>（设备指纹/客户端ID），建议也加上类似的计数机制。<br/>
<strong>作用：</strong> 攻击者换手机号也不那么容易。<br/>
<strong>副作用：</strong> 设备指纹如果不可靠，可能存在误判，需要谨慎。</p>
<p>这个就不提供代码示例了，基本和手机号类似。</p>
<h4 data-id="heading-13">2. 人机校验：让攻击成本上升</h4>
<p>只靠限流肯定是不够的，攻击者有很多方式可以规避，比如：</p>
<ul>
<li>通过代理池换 IP</li>
<li>通过猫池批量换手机号</li>
<li>降速慢刷</li>
</ul>
<p>这时必须引入人机校验（滑动/行为验证码等）。</p>
<p>通过这种收到那，实现风险分层，确保正常用户顺畅使用，只有可疑请求才加验证。</p>
<h5 data-id="heading-14">2.1 两种策略：全量上验证码 vs 分层触发验证码</h5>
<ul>
<li>
<p><strong>全量上验证码</strong>：最安全，但体验下降明显</p>
</li>
<li>
<p><strong>分层触发</strong>：更推荐</p>
<ul>
<li>当 IP/手机号触发某个阈值后，再要求通过人机校验</li>
</ul>
</li>
</ul>
<p><strong>权衡说明：</strong></p>
<ul>
<li>对新用户来说，多一步验证码可能降低转化；</li>
<li>但如果你的业务正被攻击盗刷，先止血更重要；</li>
<li>最佳实践通常是平时分层触发，攻击期临时提升强度，甚至全量。</li>
</ul>
<h5 data-id="heading-15">2.2 ticket机制：把人机校验结果绑定到短信发送</h5>
<p>流程：</p>
<ol>
<li>前端做人机校验拿到凭证（如 challenge/validate 或 token）</li>
<li>后端验签通过后发放一个短时 <code>ticket</code>（Redis 里存 2 分钟）</li>
<li>发送短信必须携带 ticket；ticket 用一次就作废（防止重放）</li>
</ol>
<p><strong>示例：校验 ticket（一次性）</strong></p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-type">String</span> tKey = <span class="hljs-string">"sms:ticket:"</span> + ticket;
<span class="hljs-keyword">if</span> (!<span class="hljs-type">Boolean</span>.<span class="hljs-literal">TRUE</span>.<span class="hljs-keyword">equals</span>(redis.hasKey(tKey))) <span class="hljs-keyword">throw</span> <span class="hljs-built_in">new</span> ForbiddenException(<span class="hljs-string">"请先完成人机校验"</span>);
redis.delete(tKey); // 一次性：防止同 ticket 重放刷短信
</code></pre>
<blockquote>
<p>代码比较短啊，但是示例效果应该是有了，就是把短信发送从一个公开接口，变成持票入场的机制。</p>
</blockquote>
<h4 data-id="heading-16">3. 验证码设计与校验：别让验证接口也成为突破口</h4>
<p>短信盗刷主要攻击的是发送接口，但验证接口也要守住。</p>
<h5 data-id="heading-17">3.1 验证码必须：短有效期、一次性使用</h5>
<p><strong>作用：</strong> 过期自动失效，成功后立刻作废。<br/>
<strong>副作用：</strong> 用户可能因为短信延迟导致过期，需要重新获取（体验略微降低）。</p>
<p><strong>示例：校验成功即删除</strong></p>
<pre><code class="hljs language-ini" lang="ini">String <span class="hljs-attr">codeKey</span> = <span class="hljs-string">"sms:code:"</span> + phone<span class="hljs-comment">;</span>
String <span class="hljs-attr">real</span> = redis.opsForValue().get(codeKey)<span class="hljs-comment">;</span>
if (!Objects.equals(real, inputCode)) throw new ForbiddenException("验证码错误")<span class="hljs-comment">;</span>
redis.delete(codeKey)<span class="hljs-comment">; // 一次性使用</span>
</code></pre>
<h5 data-id="heading-18">3.2 限制验证失败次数：防止暴力尝试</h5>
<p><strong>作用：</strong> 抵抗穷举或者撞码的行为
<strong>副作用：</strong> 用户如果手滑输错多次，会被暂时锁定（体验下降，但在业务上也能理解）</p>
<p><strong>示例：10 分钟最多错 5 次</strong></p>
<pre><code class="hljs language-ini" lang="ini">String <span class="hljs-attr">failKey</span> = <span class="hljs-string">"sms:fail:"</span> + phone<span class="hljs-comment">;</span>
Long <span class="hljs-attr">fail</span> = redis.opsForValue().increment(failKey)<span class="hljs-comment">;</span>
if (fail != null &amp;&amp; <span class="hljs-attr">fail</span> == <span class="hljs-number">1</span>) redis.expire(failKey, Duration.ofMinutes(<span class="hljs-number">10</span>))<span class="hljs-comment">;</span>
if (fail != null &amp;&amp; fail &gt; 5) throw new ForbiddenException("错误次数过多，请稍后再试")<span class="hljs-comment">;</span>
</code></pre>
<blockquote>
<p>权衡说明：</p>
<ul>
<li>
<p>虽然是短时间的锁定，但必然会让用户不爽；</p>
</li>
<li>
<p>可是它能让攻击者的穷举直接失去意义</p>
<p>在安全链路里，这是典型的用少量体验换大量安全</p>
</li>
</ul>
</blockquote>
<h4 data-id="heading-19">4. 幂等：别让重复点击变成重复扣费</h4>
<p>某种情况下，很多短信费用并不是黑客盗刷的，也可能是下面这些场景：</p>
<ul>
<li>用户狂点重新发送</li>
<li>前端网络抖动自动重试</li>
<li>网关重试导致重复请求</li>
</ul>
<p><strong>作用：</strong> 同一个请求只发送一次。<br/>
<strong>副作用：</strong> 需要前端或客户端配合提供 <code>requestId</code>（或你在服务端生成并返回）。</p>
<p><strong>示例：3 分钟幂等</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-built_in">Boolean</span> ok = redis.opsForValue()
    .setIfAbsent(<span class="hljs-string">"sms:idem:"</span> + requestId, <span class="hljs-string">"1"</span>, Duration.ofMinutes(<span class="hljs-number">3</span>));
<span class="hljs-keyword">if</span> (!<span class="hljs-built_in">Boolean</span>.TRUE.equals(ok)) <span class="hljs-keyword">return</span>; <span class="hljs-comment">// 已处理过，直接忽略</span>
</code></pre>
<h4 data-id="heading-20">5. 监控与告警：主动的监控报警，提前预防</h4>
<p><strong>建议至少监控以下这几点：</strong></p>
<ul>
<li>每分钟发送量（总量 + 按渠道）</li>
<li>命中限流次数（按 IP / phone）</li>
<li>发送失败率（突然升高往往是被刷或被风控）</li>
<li>单 IP/单号异常排行</li>
</ul>
<p>监控代码和平台差异很大，这里不贴具体的实现，关键是一定要有阈值告警，比方说邮件或者飞书、钉钉的报警。</p>
<h2 data-id="heading-21">写在最后</h2>
<p>到这里，我们把短信验证码这条链路最容易被钻的地方都补了一遍：用 <strong>IP/手机号/用户</strong> 做限流兜底，用 <strong>人机校验 + ticket</strong> 抬高脚本成本，验证码做到 <strong>短有效期、一次性、失败次数限制</strong>，再加上 <strong>幂等和监控告警</strong>，避免重复扣费、也能第一时间发现异常。</p>
<p>有些措施会让体验稍微变差一点，但这是在 <strong>体验、成本、安全</strong> 之间做过权衡后的选择：让正常用户多走半步，总比让攻击者一路绿灯强。</p>
<p>最后感慨两句。</p>
<p>写业务的时候我们总爱相信世界是善良的。</p>
<p>但成年人最大的体面，都要交学费交出来的。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[场景化落地指南——金仓时序数据库在关键行业的应用实践]]></title>    <link>https://juejin.cn/post/7595974133096759330</link>    <guid>https://juejin.cn/post/7595974133096759330</guid>    <pubDate>2026-01-17T11:21:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595974133096759330" data-draft-id="7595893785907003426" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="场景化落地指南——金仓时序数据库在关键行业的应用实践"/> <meta itemprop="keywords" content="数据库"/> <meta itemprop="datePublished" content="2026-01-17T11:21:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="倔强的石头_"/> <meta itemprop="url" content="https://juejin.cn/user/3168119757484368"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            场景化落地指南——金仓时序数据库在关键行业的应用实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3168119757484368/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    倔强的石头_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T11:21:31.000Z" title="Sat Jan 17 2026 11:21:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读17分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>时序数据怎么“落到系统里”，往往比“概念讲清楚”更难。本文就以金仓时序数据库的工程落地为主线，把采集、存储、分析、看板到运维闭环串起来：能力怎么拆、模型怎么建、SQL怎么写、行业怎么用，尽量讲得清楚、也讲得能直接照着做。</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f5b55ca384944f96a4cf3c0a36adf160~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769253691&amp;x-signature=fdsDHhQyoy37cjLTvKj9B2Su7kQ%3D" alt="a6bb70bf487627cb7b4e42054570950f.jpg" loading="lazy"/></p>
<p>@[toc]</p>
<hr/>
<h2 data-id="heading-0">1. 为什么 2025 年时序数据库“必须场景化”</h2>
<p>时序数据库早就不只是“写得快、存得下”这么简单了。到了 2025 年，大家更看重的是<strong>能不能围绕场景把链路交付出来</strong>——接入稳不稳、存储贵不贵、查询快不快、系统抗不抗压、治理合不合规、国产化环境能不能长期跑住。</p>
<h3 data-id="heading-1">1.1 2025 年时序数据的四个典型变化</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1df8dde84d2744feb7bc1cc119e5cf88~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769253691&amp;x-signature=7p2Mi36fZofdnccGaUfht%2BFXZjs%3D" alt="image.png" loading="lazy"/></p>
<ol>
<li>
<p><strong>数据源更碎更近</strong><br/>
边缘侧设备、网关、工业控制与车联网等产生大量“短周期、高噪声、易丢包”的数据，接入链路需要更强的吞吐与容错。</p>
</li>
<li>
<p><strong>“写入高峰 + 查询突发”成为常态</strong><br/>
白天业务写入、夜间批处理、故障排查突发查询叠加，要求数据库同时兼顾写入、压缩、聚合与并发读。</p>
</li>
<li>
<p><strong>从“保存原始数据”走向“可运营的数据资产”</strong><br/>
不只是存：还要分层（热/温/冷）、保留策略、降采样、数据质量与审计，让数据能被长期复用。</p>
</li>
<li>
<p><strong>“可控可用”比“参数最优”更重要</strong><br/>
关键行业更看重可交付性：可运维、可审计、可扩展、可兼容生态、可在国产化环境稳定运行。</p>
</li>
</ol>
<h3 data-id="heading-2">1.2 趋势、格局与金仓的机会点：把“能力”写进“交付件”</h3>
<p>如果把行业格局拆开看，时序产品大体会落在三条路线上：偏工业/能源的生产系统路线、偏 IT 可观测性的运维路线、以及偏物联网与平台化的数据平台路线。走到 2025 年，真正能拉开差距的往往不是某一项“极限指标”，而是能不能把能力沉淀成一套可复用、可验收的交付件：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b622a9049f0743fb8efd44c7b228bc4c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769253691&amp;x-signature=wWSt4kYJwWDsqgK%2F5IfiFmHyqtM%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li><strong>数据接入标准化</strong>：批量写入、重试幂等、乱序补写、质量标记这些能力，最后要落成接入规范与模板，谁接谁用。</li>
<li><strong>分区生命周期工程化</strong>：分区自动创建与清理、冷热分层、归档策略要固化成运维脚本与验收口径，跑起来心里有底。</li>
<li><strong>看板查询产品化</strong>：分钟/小时聚合层配上回补窗口，把看板从“偶尔很快”变成“长期稳定快”。</li>
<li><strong>治理与审计体系化</strong>：权限隔离、审计留痕、保留策略可审计，减少上线审批与合规沟通成本。</li>
<li><strong>国产化落地可持续</strong>：压测基线、容量模型、演练流程与监控指标补齐，尽量把问题挡在上线前。</li>
</ul>
<hr/>
<h2 data-id="heading-3">2. 金仓时序数据库的能力拆解：用工程语言对齐“能解决什么问题”</h2>
<p>把能力按“落地会用到的层次”拆开看，规划、验收、扩容评估都会清晰不少。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TB
  A[数据接入&lt;br/&gt;采集/网关/消息队列] --&gt; B[写入与缓冲&lt;br/&gt;批量/乱序/幂等]
  B --&gt; C[存储组织&lt;br/&gt;分区/索引/压缩]
  C --&gt; D[查询分析&lt;br/&gt;窗口聚合/关联/预聚合]
  D --&gt; E[数据治理&lt;br/&gt;生命周期/权限/审计]
  E --&gt; F[高可用与运维&lt;br/&gt;备份恢复/监控/扩缩容]
</code></pre>
<h3 data-id="heading-4">2.0 把“金仓”放进架构图：不是单点能力，而是一套交付体系</h3>
<p>关键行业里，金仓的时序能力更多是作为金仓数据库的企业级数据底座能力来用：它能承载“海量时序数据采集检索类应用”等场景，并且支持和关系、文档、GIS 等模型统一存储、混合访问。换句话说，很多时候你不必为了时序单独再拼一套系统，运维与治理的压力也会小一截。</p>
<p>做国产化替代，难点往往不在“能不能迁”，而在“迁完能不能长期稳”。所以工程交付必须把“评估—迁移—开发—运维”这一串打通。金仓官网公开信息里也明确提到其配套的工具组件体系覆盖迁移评估、数据迁移、开发管理与集中运维等环节，目的就是把“能跑起来”进一步变成“能持续跑下去”。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b48a386d0f054ef18ff92cd3acb2dd60~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769253691&amp;x-signature=JA2Fl3CS3OEOuywHwQuR0G3cWV8%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-5">2.1 写入：吞吐、乱序与“业务可恢复”</h3>
<p>很多项目里，写入的真实痛点并不是“单条写得慢”，而是下面这些更折磨人的问题：</p>
<ul>
<li>峰值写入时如何保持稳定、不卡死查询；</li>
<li>乱序/迟到数据如何补写并保持一致；</li>
<li>断网/重试时如何做到幂等与可追溯。</li>
</ul>
<p>落到工程上，可以按这个思路做：</p>
<ul>
<li>入口层先把<strong>批量写入</strong>和<strong>重试去重</strong>做扎实（设备侧或网关侧带唯一序号/时间戳+设备ID），写入高峰时更稳。</li>
<li>数据库侧用<strong>按时间范围分区</strong>来兜底，避免一张表无限变大后维护成本飙升。</li>
<li>如果业务维度很稳定、过滤也很高频，就把“时间 + 业务维度”当成联合切分的抓手，既降低热点，也减少扫描范围。[^kb-logs][^kb-safety]</li>
</ul>
<h3 data-id="heading-6">2.2 存储：分区、压缩与冷热分层（降低总成本）</h3>
<p>时序数据按时间范围切分（天/小时/周等）几乎是“默认正确”的选择，收益也很直接：</p>
<ul>
<li>查询裁剪：只扫描命中的时间分区；</li>
<li>运维简化：过期数据直接按分区清理；</li>
<li>性能稳定：避免“越存越慢”的长尾问题。</li>
</ul>
<p>从产品形态上看，金仓把时序能力放进融合数据库体系里，强调多种模型统一存储、混合访问。这样一来，“时序明细 + 业务维表 +（可选的）空间信息”就能在同一底座内闭环完成，跨系统同步与一致性治理的麻烦事会少很多。[^kb-kes]</p>
<h3 data-id="heading-7">2.3 查询：窗口聚合、预聚合与“秒级看板”</h3>
<p>看板/告警最常见的坑就是：原始点位太多，一上来就扫明细，延迟上去了，资源也被吃光。更稳妥的做法通常是：</p>
<ul>
<li>明细层保留原始数据；</li>
<li>聚合层按分钟/小时做预聚合（可物化/可增量）；</li>
<li>业务侧读聚合层满足大多数实时看板。</li>
</ul>
<p>在金仓公开的时序分析实践里，“区间筛选 + 时间窗口聚合”的函数化思路经常被用来把复杂查询收敛成稳定、可复用的时间窗操作，这样压测、缓存和看板复用都会更顺手。[^kb-safety]</p>
<h3 data-id="heading-8">2.4 治理与安全：权限、审计与合规</h3>
<p>关键行业往往要求：</p>
<ul>
<li>
<p>租户/部门隔离（多业务域并行）；</p>
</li>
<li>
<p>行级/库级/表级权限；</p>
</li>
<li>
<p>操作审计、追溯与留痕；</p>
</li>
<li>
<p>数据保留策略可控、可审计。</p>
</li>
</ul>
<h2 data-id="heading-9">时序项目能不能顺利上线、上线后敢不敢放量，很多时候就卡在治理这一关。</h2>
<h2 data-id="heading-10">3. 一个可复用的数据模型：设备测点表（含分区与索引）</h2>
<p>先用通用 SQL 来阐述建模思路，把“设备测点”当作事实表，并按照时间范围实施分区，然后针对最常见的过滤条件创建合成索引，这样大概就可以涵盖多数生产场景。</p>
<p>不同系统对于分区语法的细节可能存在差别，不过建模思路以及字段设计可以照搬，等到实际执行的时候，再依照金仓时序数据库的功能以及运维规范去调整分区粒度和索引策略即可。</p>
<h3 data-id="heading-11">3.1 表结构建议</h3>
<ul>
<li><code>ts</code>：采集时间（统一使用同一时区/统一入库口径）</li>
<li><code>device_id</code>：设备/点位唯一标识</li>
<li><code>metric</code>：指标名（温度、压力、电流等）</li>
<li><code>value</code>：数值</li>
<li><code>quality</code>：质量位（可选，标记是否有效/是否补传）</li>
<li><code>tags</code>：扩展维度（可选，JSON 或规范化维表）</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> telemetry_points (
  ts         <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  device_id  <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  metric     <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  <span class="hljs-keyword">value</span>      <span class="hljs-type">DOUBLE PRECISION</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  quality    <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,
  <span class="hljs-keyword">PRIMARY</span> KEY (ts, device_id, metric)
);
</code></pre>
<h3 data-id="heading-12">3.2 按时间范围分区（示例：按天）</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> telemetry_points_2025_01_01 <span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">OF</span> telemetry_points
<span class="hljs-keyword">FOR</span> <span class="hljs-keyword">VALUES</span> <span class="hljs-keyword">FROM</span> (<span class="hljs-string">'2025-01-01'</span>) <span class="hljs-keyword">TO</span> (<span class="hljs-string">'2025-01-02'</span>);
</code></pre>
<h3 data-id="heading-13">3.3 常用索引</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> INDEX idx_tp_device_metric_ts <span class="hljs-keyword">ON</span> telemetry_points (device_id, metric, ts);
<span class="hljs-keyword">CREATE</span> INDEX idx_tp_ts <span class="hljs-keyword">ON</span> telemetry_points (ts);
</code></pre>
<h3 data-id="heading-14">3.4 多业务域/多租户的两种常见隔离方式</h3>
<p>时序平台一旦做成“平台”，就会遇到多业务域/多租户的问题。工程上最常见的隔离方式基本就这两类：</p>
<ul>
<li><strong>库/模式隔离</strong>：不同租户/业务域使用不同库或不同模式，隔离清晰、权限简单，适合强隔离场景。</li>
<li><strong>表内隔离</strong>：同一张事实表增加 <code>tenant_id</code> 字段，适合租户多且小、共享资源的场景，但需要更严格的权限与审计策略。</li>
</ul>
<hr/>
<h2 data-id="heading-15">4. 典型查询与聚合：从“明细点”到“可用指标”</h2>
<p>许多团队执行时序分析的时候，最常犯的错误就是“每个人都有一套自己的时间窗逻辑”，这样就造成口径不统一，性能也无法控制，金仓在开展时序分析的时候，更侧重于把“时间范围过滤，区间筛选，时间窗口聚合”这些功能做成函数化，模板化的模式，从而减轻重复劳动的负担，也便于创建性能基线并实施回归检测，这里有一组通用的 SQL 思路；到了实际操作金仓时，可以优先采用金仓自身具备的等效内置函数及其相关能力，把逻辑编写得更为精炼，稳定。</p>
<h3 data-id="heading-16">4.1 区间查询：设备在某时间段的曲线</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> ts, <span class="hljs-keyword">value</span>
<span class="hljs-keyword">FROM</span> telemetry_points
<span class="hljs-keyword">WHERE</span> device_id <span class="hljs-operator">=</span> <span class="hljs-string">'D-10086'</span>
  <span class="hljs-keyword">AND</span> metric <span class="hljs-operator">=</span> <span class="hljs-string">'temperature'</span>
  <span class="hljs-keyword">AND</span> ts <span class="hljs-operator">&gt;=</span> <span class="hljs-string">'2025-01-01 00:00:00'</span>
  <span class="hljs-keyword">AND</span> ts <span class="hljs-operator">&lt;</span>  <span class="hljs-string">'2025-01-02 00:00:00'</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> ts;
</code></pre>
<h3 data-id="heading-17">4.2 窗口聚合：按 5 分钟做均值、最大、最小</h3>
<p>没有内置时间桶函数时，也可以用“时间截断/取整”的方式表达时间桶。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span>
  (DATE_TRUNC(<span class="hljs-string">'minute'</span>, ts) <span class="hljs-operator">-</span> (<span class="hljs-built_in">EXTRACT</span>(<span class="hljs-keyword">minute</span> <span class="hljs-keyword">FROM</span> ts)::<span class="hljs-type">int</span> <span class="hljs-operator">%</span> <span class="hljs-number">5</span>) <span class="hljs-operator">*</span> <span class="hljs-type">INTERVAL</span> <span class="hljs-string">'1 minute'</span>) <span class="hljs-keyword">AS</span> bucket_start,
  <span class="hljs-built_in">AVG</span>(<span class="hljs-keyword">value</span>) <span class="hljs-keyword">AS</span> avg_value,
  <span class="hljs-built_in">MIN</span>(<span class="hljs-keyword">value</span>) <span class="hljs-keyword">AS</span> min_value,
  <span class="hljs-built_in">MAX</span>(<span class="hljs-keyword">value</span>) <span class="hljs-keyword">AS</span> max_value
<span class="hljs-keyword">FROM</span> telemetry_points
<span class="hljs-keyword">WHERE</span> device_id <span class="hljs-operator">=</span> <span class="hljs-string">'D-10086'</span>
  <span class="hljs-keyword">AND</span> metric <span class="hljs-operator">=</span> <span class="hljs-string">'temperature'</span>
  <span class="hljs-keyword">AND</span> ts <span class="hljs-operator">&gt;=</span> <span class="hljs-string">'2025-01-01 00:00:00'</span>
  <span class="hljs-keyword">AND</span> ts <span class="hljs-operator">&lt;</span>  <span class="hljs-string">'2025-01-01 06:00:00'</span>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> bucket_start
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> bucket_start;
</code></pre>
<h3 data-id="heading-18">4.3 预聚合：面向看板的“分钟级物化视图”（示例思路）</h3>
<p>当看板查询频繁、且大部分只需要分钟级指标时，建议做“明细层 + 聚合层”两层结构。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> telemetry_1m (
  bucket_start <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  device_id    <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  metric       <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  avg_value    <span class="hljs-type">DOUBLE PRECISION</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  min_value    <span class="hljs-type">DOUBLE PRECISION</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  max_value    <span class="hljs-type">DOUBLE PRECISION</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  cnt          <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  <span class="hljs-keyword">PRIMARY</span> KEY (bucket_start, device_id, metric)
);
</code></pre>
<p>聚合刷新策略建议：</p>
<ul>
<li>实时性要求高：按分钟增量刷新；</li>
<li>允许延迟：按 5 分钟/15 分钟批量刷新；</li>
<li>支持迟到数据：设置“回补窗口”（例如回补最近 2 小时）。</li>
</ul>
<h3 data-id="heading-19">4.4 乱序、重复与补传：用“质量位 + 业务幂等键”降低风险</h3>
<p>现场采集常常会遇到这样一些麻烦事，第一种是设备补传引发的重复情况，第二种是因为网络抖动而出现的乱序现象，第三种则是由于设备离线造成的缺段问题，想要减小返工量，最好是就在模型层预先留出控制面。</p>
<ul>
<li><code>quality</code> 标记来源（正常/补传/估算/无效等），便于告警与统计口径一致</li>
<li>入口层生成 <code>event_id</code>（设备序号或哈希），用于幂等写入与去重</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> telemetry_points2 (
  ts         <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  device_id  <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  metric     <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  <span class="hljs-keyword">value</span>      <span class="hljs-type">DOUBLE PRECISION</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  quality    <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,
  event_id   <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  <span class="hljs-keyword">PRIMARY</span> KEY (event_id)
);
</code></pre>
<h3 data-id="heading-20">4.5 缺失补齐：把“时间对齐”做成可复用查询模板</h3>
<p>看板经常要一根“等间隔时间轴”（比如每分钟一个点）。遇到缺失时，先用 <code>NULL</code> 占位更干净，后面在展示层再做插值或前向填充就好。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">WITH</span> time_grid <span class="hljs-keyword">AS</span> (
  <span class="hljs-keyword">SELECT</span> generate_series(
    <span class="hljs-type">TIMESTAMP</span> <span class="hljs-string">'2025-01-01 00:00:00'</span>,
    <span class="hljs-type">TIMESTAMP</span> <span class="hljs-string">'2025-01-01 01:00:00'</span>,
    <span class="hljs-type">INTERVAL</span> <span class="hljs-string">'1 minute'</span>
  ) <span class="hljs-keyword">AS</span> ts
),
raw <span class="hljs-keyword">AS</span> (
  <span class="hljs-keyword">SELECT</span> DATE_TRUNC(<span class="hljs-string">'minute'</span>, ts) <span class="hljs-keyword">AS</span> ts, <span class="hljs-built_in">AVG</span>(<span class="hljs-keyword">value</span>) <span class="hljs-keyword">AS</span> v
  <span class="hljs-keyword">FROM</span> telemetry_points
  <span class="hljs-keyword">WHERE</span> device_id <span class="hljs-operator">=</span> <span class="hljs-string">'D-10086'</span>
    <span class="hljs-keyword">AND</span> metric <span class="hljs-operator">=</span> <span class="hljs-string">'temperature'</span>
    <span class="hljs-keyword">AND</span> ts <span class="hljs-operator">&gt;=</span> <span class="hljs-string">'2025-01-01 00:00:00'</span>
    <span class="hljs-keyword">AND</span> ts <span class="hljs-operator">&lt;</span>  <span class="hljs-string">'2025-01-01 01:00:00'</span>
  <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> DATE_TRUNC(<span class="hljs-string">'minute'</span>, ts)
)
<span class="hljs-keyword">SELECT</span> g.ts, r.v
<span class="hljs-keyword">FROM</span> time_grid g
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> raw r <span class="hljs-keyword">ON</span> r.ts <span class="hljs-operator">=</span> g.ts
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> g.ts;
</code></pre>
<h3 data-id="heading-21">4.6 告警计算：阈值 + 持续时间（避免“抖动误报”）</h3>
<p>不少告警规则并不是“超过阈值就立刻报”，而是“连续超过阈值 N 分钟才算”。这类需求更适合先在分钟聚合层算，再去识别连续段。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">WITH</span> m1 <span class="hljs-keyword">AS</span> (
  <span class="hljs-keyword">SELECT</span>
    DATE_TRUNC(<span class="hljs-string">'minute'</span>, ts) <span class="hljs-keyword">AS</span> minute_ts,
    <span class="hljs-built_in">AVG</span>(<span class="hljs-keyword">value</span>) <span class="hljs-keyword">AS</span> avg_value
  <span class="hljs-keyword">FROM</span> telemetry_points
  <span class="hljs-keyword">WHERE</span> device_id <span class="hljs-operator">=</span> <span class="hljs-string">'D-10086'</span>
    <span class="hljs-keyword">AND</span> metric <span class="hljs-operator">=</span> <span class="hljs-string">'temperature'</span>
    <span class="hljs-keyword">AND</span> ts <span class="hljs-operator">&gt;=</span> <span class="hljs-string">'2025-01-01 00:00:00'</span>
    <span class="hljs-keyword">AND</span> ts <span class="hljs-operator">&lt;</span>  <span class="hljs-string">'2025-01-01 06:00:00'</span>
  <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> DATE_TRUNC(<span class="hljs-string">'minute'</span>, ts)
),
flag <span class="hljs-keyword">AS</span> (
  <span class="hljs-keyword">SELECT</span>
    minute_ts,
    avg_value,
    <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> avg_value <span class="hljs-operator">&gt;=</span> <span class="hljs-number">80</span> <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span> <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> over_th
  <span class="hljs-keyword">FROM</span> m1
),
grp <span class="hljs-keyword">AS</span> (
  <span class="hljs-keyword">SELECT</span>
    <span class="hljs-operator">*</span>,
    <span class="hljs-built_in">SUM</span>(<span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> over_th <span class="hljs-operator">=</span> <span class="hljs-number">0</span> <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span> <span class="hljs-keyword">END</span>) <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> minute_ts) <span class="hljs-keyword">AS</span> grp_id
  <span class="hljs-keyword">FROM</span> flag
)
<span class="hljs-keyword">SELECT</span>
  <span class="hljs-built_in">MIN</span>(minute_ts) <span class="hljs-keyword">AS</span> start_ts,
  <span class="hljs-built_in">MAX</span>(minute_ts) <span class="hljs-keyword">AS</span> end_ts,
  <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">AS</span> minutes
<span class="hljs-keyword">FROM</span> grp
<span class="hljs-keyword">WHERE</span> over_th <span class="hljs-operator">=</span> <span class="hljs-number">1</span>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> grp_id
<span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-operator">&gt;=</span> <span class="hljs-number">5</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> start_ts;
</code></pre>
<hr/>
<h2 data-id="heading-22">5. 生命周期管理：热/温/冷分层与保留策略（落地可验收）</h2>
<p>时序项目最容易越跑越贵，原因往往很朴素：原始数据一直涨、聚合层没规划、过期数据清不掉（或者不敢清）。</p>
<p>一个实用的做法，是按业务价值把数据分三层：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4847f42a74084e079a20e59150cf2a7e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769253691&amp;x-signature=ewj21miKVR%2BFpb8MZhqW5Cls6LA%3D" alt="image.png" loading="lazy"/></p>
<p>这块怎么验收也不难，口径可以很清楚：</p>
<ul>
<li>分区切换与清理是否自动化；</li>
<li>聚合层是否按周期生成并可回补；</li>
<li>单次看板查询能否稳定在目标延迟（例如 1–3 秒级）。</li>
</ul>
<h3 data-id="heading-23">5.1 分区清理的最小可行策略：按“分区删除”而非“全表删除”</h3>
<p>过期数据的处理上，优先选“按分区删除/归档”，别用“全表扫一遍再删”的方式去赌运气，这样能绕开长事务和大量碎片带来的抖动风险。验收时就看两件事：清理窗口里系统稳不稳、清理耗时能不能预测。</p>
<h3 data-id="heading-24">5.2 用一张图理解“明细到指标”的数据金字塔</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TB
  A[原始明细点位&lt;br/&gt;秒级/更细] --&gt; B[分钟聚合&lt;br/&gt;看板主力]
  B --&gt; C[小时/天聚合&lt;br/&gt;报表与趋势]
  A --&gt; D[事件/告警表&lt;br/&gt;定位入口]
  D --&gt; A
</code></pre>
<hr/>
<h2 data-id="heading-25">6. 关键行业应用实践：三类场景、三种交付方式</h2>
<p>下面我就按“业务诉求—数据特征—落地打法”来写，你写征文或方案时也方便直接拿去用。</p>
<h3 data-id="heading-26">6.0 一张表把“场景诉求”映射到“金仓落地动作”</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/edd77ec9032b4340bd1db610a7dc17aa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769253691&amp;x-signature=gzJi5WMn%2FRWaSWCfyBGSUYYJoPw%3D" alt="image.png" loading="lazy"/></p>
<p>顺带一提，“时间 + 业务维度”的联合分区/分片，以及把查询收敛到区间筛选与时间窗口这套写法，在金仓官网的时序分析文章里被反复强调，用它来当方案的设计抓手会更落地。[^kb-logs][^kb-safety]</p>
<h3 data-id="heading-27">6.1 电力与能源：设备状态监测 + 故障追溯</h3>
<p><strong>业务诉求</strong><br/>
设备状态量（电压、电流、温度、振动等）连续采集；异常发生后要能快速定位时间窗、关联工况与告警记录。</p>
<p><strong>数据特征</strong><br/>
点位多、采样周期短；峰值写入高；查询以“设备+时间段”为主，伴随聚合与对比。</p>
<p><strong>落地打法</strong></p>
<ul>
<li>用金仓时序数据库承载海量采集与检索，先把写入与查询基线压测跑出来，心里有数；[^kb-kes]</li>
<li>明细表按天分区；常用设备/指标建组合索引；</li>
<li>建分钟级聚合层供看板读；</li>
<li>故障追溯走“事件表 + 明细回放”链路。</li>
</ul>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
  participant Dev as 设备/采集端
  participant Gw as 网关/消息队列
  participant TS as 金仓时序数据库
  participant BI as 看板/告警
  Dev-&gt;&gt;Gw: 批量上报(含序号/时间戳)
  Gw-&gt;&gt;TS: 批量写入/重试
  TS--&gt;&gt;BI: 分钟聚合指标
  BI--&gt;&gt;TS: 异常回放查询(设备+时间窗)
</code></pre>
<h3 data-id="heading-28">6.2 制造与工业互联网：OEE/能耗与质量波动分析</h3>
<p><strong>业务诉求</strong><br/>
把机台数据变成可运营指标（稼动率、能耗、节拍波动、良率关联），并能按产线/班组/工单维度分析。</p>
<p><strong>数据特征</strong><br/>
除时序明细外，必须强依赖维度（产线、工单、物料批次、工艺段）。</p>
<p><strong>落地打法</strong></p>
<ul>
<li>把时序事实表和业务维表放在金仓统一底座内，尽量少做跨库同步，把一致性治理的复杂度压下去；[^kb-kes]</li>
<li>“时序事实表 + 维表”建模：维表相对稳定，事实表高频写；</li>
<li>查询侧做“窗口聚合 + 维表关联”，把指标沉淀到报表层；</li>
<li>对关键指标做预聚合，减少峰值压力。</li>
</ul>
<h3 data-id="heading-29">6.3 交通与城市运行：多源融合监测与态势感知</h3>
<p><strong>业务诉求</strong><br/>
融合多源数据（设备、环境、视频结构化指标、路网状态），要求稳定接入、实时聚合与趋势判断。</p>
<p><strong>数据特征</strong><br/>
来源多、格式不一、质量参差；需要统一时间对齐与数据质量管理。</p>
<p><strong>落地打法</strong></p>
<ul>
<li>接入层规范化：统一时间口径、统一设备ID映射；</li>
<li>入库前做基础质量校验（缺测、重复、异常值标记）；</li>
<li>用聚合层支撑全市/全网态势看板，用明细层支撑局部排障回放。</li>
<li>需要空间维度（区域、路段、围栏）时，可结合时序与空间数据做联合筛选，把“时间窗 + 空间范围”的查询收敛成可复用模板。[^kb-kes][^kb-safety]</li>
</ul>
<hr/>
<h2 data-id="heading-30">7. 国产化替代背景下：怎么把“可用”做成“好用、稳用、可持续用”</h2>
<p>国产化替代项目真正的关键，通常不是“能不能替”，而是把风险尽量从“上线后暴露”前移到“上线前可控”。比较稳的推进方式，可以沿着“三条主线”走：</p>
<h3 data-id="heading-31">7.1 主线一：选型与验证（可量化、可复测）</h3>
<p>验证集建议至少覆盖这些维度：</p>
<ul>
<li>
<p>写入：峰值吞吐、乱序补写、重试幂等；</p>
</li>
<li>
<p>查询：典型看板/报表/回放 SQL 的稳定延迟；</p>
</li>
<li>
<p>运维：备份恢复、扩容、分区维护、生命周期清理；</p>
</li>
<li>
<p>安全：权限隔离、审计留痕、账号策略与合规要求。</p>
</li>
</ul>
<p>更为关键的是要将验证动作和工具链关联起来，迁移评定，数据迁移，开发守护以及集中运维这些环节都应该凝结成可回溯的交付物，不可让替代项目仅依靠记忆或者经验存在。</p>
<h3 data-id="heading-32">7.2 主线二：数据分层与指标体系（让成本与性能可控）</h3>
<p>比较实用的做法，是先把指标分成三类：</p>
<ul>
<li>需要秒级：走分钟聚合层或更细粒度的预聚合；</li>
<li>需要分钟级：直接查聚合层；</li>
<li>需要追溯：从事件定位，再回放明细层。</li>
</ul>
<p>这样资源消耗就能从“每次都扫明细”变成“多数读聚合，少数回放明细”，性能和成本都会稳很多。</p>
<h3 data-id="heading-33">7.3 主线三：运维闭环（让系统在生产中持续稳定）</h3>
<p>建议把下面这些事做成日常动作，别等出问题才想起来：</p>
<ul>
<li>
<p>分区自动创建与过期清理；</p>
</li>
<li>
<p>聚合层按计划刷新并具备回补窗口；</p>
</li>
<li>
<p>指标监控：写入延迟、查询 P95、磁盘增长、分区数量、慢查询；</p>
</li>
<li>
<p>灾备演练：按季度做恢复演练与容量回归。</p>
</li>
</ul>
<hr/>
<h2 data-id="heading-34">结语：用“可交付的时序工程”把机会点落到现实</h2>
<p>2025年的时序数据库竞争渐渐变成了一场工程交付能力的较量，谁能将写入，存储，查询，治理，运维形成起一套可复用的体系，谁就更有可能在关键行业中做到规模扩张。</p>
<p>如果你正在推动关键行业时序数据平台的创建或者进行国产化替代，建议先把“数据分层，分区生命周期，预聚合”这三件事做好，然后逐步深入地完善指标体系和运维闭环。想了解更多产品与方案，可以到金仓数据库官网看看：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.kingbase.com.cn%2F" target="_blank" title="https://www.kingbase.com.cn/" ref="nofollow noopener noreferrer">www.kingbase.com.cn/</a></p>
<p>👉 <strong>金仓数据库官方博客站</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fkingbase.com.cn%2Fexplore" target="_blank" title="https://kingbase.com.cn/explore" ref="nofollow noopener noreferrer">kingbase.com.cn/explore</a><br/>
想继续深挖的话，这里有不少专家文章、原理解析和最佳实践，可以按场景直接挑着看。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4489bfd0539c468cbea4c95c197e29aa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769253691&amp;x-signature=uTf9%2BxessAbK49jLIj8bLrmJd5Q%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🌰在 OpenLayers 中实现图层裁切]]></title>    <link>https://juejin.cn/post/7595890117865701422</link>    <guid>https://juejin.cn/post/7595890117865701422</guid>    <pubDate>2026-01-17T11:31:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595890117865701422" data-draft-id="7595894884956864563" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🌰在 OpenLayers 中实现图层裁切"/> <meta itemprop="keywords" content="前端,GIS"/> <meta itemprop="datePublished" content="2026-01-17T11:31:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="黑心皮蛋"/> <meta itemprop="url" content="https://juejin.cn/user/3738785874458039"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🌰在 OpenLayers 中实现图层裁切
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3738785874458039/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    黑心皮蛋
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T11:31:43.000Z" title="Sat Jan 17 2026 11:31:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{font-family:-apple-system,system-ui,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial;color:#00325e}.markdown-body ::selection{background-color:#00325e;color:#fff}.markdown-body blockquote{padding:10px 20px;background-color:#fffaf0;box-shadow:0 3px 10px 0 rgba(255,172,194,.24);border:1px solid #f3ca8e;transition:all .2s;margin:1em 0;border-radius:5px}.markdown-body blockquote p{font-size:14px;line-height:25px;color:#795548}.markdown-body blockquote p:last-child{margin:0}.markdown-body blockquote:hover{border-color:#ff9800;background-color:#fff8e0;box-shadow:0 6px 10px -5px rgba(225,173,98,.3803921569)}.markdown-body blockquote code{color:#ff502c}.markdown-body pre{border:1px solid #8cc0f3;box-shadow:0 3px 10px 0 rgba(255,198,198,.28);border-radius:5px;transition:all .2s;overflow-x:auto;white-space:pre-wrap}.markdown-body pre:hover{border-color:#6d9dce}.markdown-body pre&gt;code{padding:10px 20px;color:#00325e;background:#f0f8ff;font-size:12px;line-height:1.6;display:block}.markdown-body code{background:#f6fbff;color:#0b5393;padding:2px 4px;border-radius:4px;font-size:12px}.markdown-body p{font-size:14px;line-height:28px;text-align:justify;margin-bottom:17px;color:#595959}.markdown-body a{color:#00325e;text-decoration:none}.markdown-body a:after{content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAAXNSR0IArs4c6QAAAQdJREFUKFNt0DtLA0EUBeBzZle0Eks7rcUfEfBRCha7NorYa6NmVJzgyi4smUgKtdZGCJktLMVH4Y8QeztLWyE7VyLEuNFbXj4Oh0P8c8mZm+uJrEN4BJFTeP/MUVe3bnocfALwkOlo1zS7iZAzf6Cx7oXgbaqjxiDEWCcVaGyxQ8pSWo9XhqhoQ/xUFbaKjhe5V+CmR7mnSplEEF6GSmJ+F/d0KHvbCIIJCLc85U6BC5mONgbJNM3uFag++sX7z8O8MzsWBucifMx0dDGE1kmm458KDVukAlnNdDz/exEeW3dNkbfsYC0xtmgDWP6ELLZ0/F6BJu/UoFQN5AkoeUjeJPvx6+i+X5Sjah4tA6gYAAAAAElFTkSuQmCC);margin-left:2px}.markdown-body a:hover{box-shadow:0 1px}.markdown-body table{max-width:100%;border-collapse:collapse;border-spacing:0;box-shadow:0 3px 10px 0 rgba(255,238,172,.24);transition:all .2s}.markdown-body table:hover{box-shadow:0 3px 10px 0 rgba(185,169,103,.24)}.markdown-body table tr th{border:1px solid #8cc0f3;background-color:#f0f8ff;padding:12px 15px}.markdown-body table tr td{border:1px solid rgba(243,202,142,.4);padding:12px 15px}.markdown-body table tbody tr{transition:all .2s}.markdown-body table tbody tr:hover td{border-color:#f3ca8e;background-color:#fff8e0;z-index:1}.markdown-body img{max-width:100%}.markdown-body h1{font-size:20px;margin-top:30px;margin-bottom:10px;padding-left:30px;position:relative}.markdown-body h1&gt;code{font-size:20px}.markdown-body h1:before{content:"🍺";display:block;font-size:18px;width:18px;height:18px;left:0;position:absolute}.markdown-body h2{font-size:18px;margin-top:30px;margin-bottom:10px;padding-left:28px;position:relative}.markdown-body h2&gt;code{font-size:18px}.markdown-body h2:before{content:"🍻";display:block;font-size:16px;width:16px;height:16px;left:0;position:absolute}.markdown-body h3{font-size:16px;margin-top:30px;margin-bottom:10px;padding-left:26px;position:relative}.markdown-body h3&gt;code{font-size:16px}.markdown-body h3:before{content:"🥂";display:block;font-size:14px;width:14px;height:14px;left:0;position:absolute}.markdown-body h4{font-size:14px;margin-top:30px;margin-bottom:10px;padding-left:24px;position:relative}.markdown-body h4&gt;code{font-size:14px}.markdown-body h4:before{content:"🥃";display:block;font-size:12px;width:12px;height:12px;left:0;position:absolute}.markdown-body h5{font-size:12px;margin-top:30px;margin-bottom:10px}.markdown-body h5&gt;code{font-size:12px}.markdown-body h6{font-size:10px;margin-top:30px;margin-bottom:10px}.markdown-body h6&gt;code{font-size:10px}.markdown-body h1,.markdown-body h2{color:#ff502c}.markdown-body hr{height:4px;border:none;margin-top:32px;margin-bottom:32px;background-size:4px 1px;background-image:linear-gradient(270deg,#6d9dce,#8cc0f3 25%,transparent 50%)}.markdown-body hr:nth-child(2n){background-image:linear-gradient(270deg,#ff9800,#fff8e0 25%,transparent 50%)}.markdown-body ul{padding-inline-start:20px}.markdown-body ul li{list-style-type:"🔸"}.markdown-body ul li li{list-style-type:"◻️"}.markdown-body ul li li li{list-style-type:"▫️"}.markdown-body ol{padding-inline-start:20px}.markdown-body ol ::marker{color:#ff9800}.markdown-body ol,.markdown-body ul{line-height:2em}.markdown-body li{padding-inline-start:1ch}.markdown-body li.task-list-item{list-style:none;padding-inline-start:0}.markdown-body li input{padding-right:2px}.markdown-body li input[type=checkbox i]{appearance:none}.markdown-body li input:before{content:"🟩";display:block;width:13px;height:13px}.markdown-body li input:checked:before{content:"✅"}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atelier-sulphurpool-light">.hljs-comment,.hljs-quote{color:#6b7394}.hljs-attribute,.hljs-link,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#c94922}.hljs-built_in,.hljs-builtin-name,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#c76b29}.hljs-bullet,.hljs-string,.hljs-symbol{color:#ac9739}.hljs-section,.hljs-title{color:#3d8fd1}.hljs-keyword,.hljs-selector-tag{color:#6679cc}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#f5f7ff;color:#5e6687}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9bb77a589b2f40f2a4eec2a5f9415aab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buR5b-D55qu6JuL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769254303&amp;x-signature=zhS0YkFsCOPczuk7iFb0uBq%2FV%2FU%3D" alt="img" loading="lazy"/>💬 前言</h2>
<p>​	做地图的时候，常会给地图套个“遮罩”——把不关心的地方调暗，把想看的地方突出出来。但有时我们并不想动整张地图的视觉效果，只想把某一张图层按不规则形状展示出来，比如只在某块多边形里显示指定图层。</p>
<h2 data-id="heading-1">🎯 最终效果如下</h2>
<blockquote>
<p>给定一个多边形（polygonCoords），对单一 WMTS/瓦片图层进行裁切：图层仅在该多边形内部可见，其他图层不受影响。</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fb736c5ae789455e90444e1b40ce72b6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buR5b-D55qu6JuL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769254303&amp;x-signature=euEHOYoOheo8D9TBYBPI3PK9Pbo%3D" alt="图层裁切最终效果" loading="lazy"/></p>
<h2 data-id="heading-2">🧭 实现思路</h2>
<blockquote>
<p>通过监听图层的 prerender 事件 和 postrender事件 实现裁切</p>
</blockquote>
<ol>
<li>在图层开始绘制之前（prerender）准备裁切：
<ul>
<li>回调里会拿到两个东西：OpenLayers 的矢量渲染上下文和原生的 Canvas 上下文（ctx）。</li>
<li>先用 ctx.save() 保存当前 canvas 状态。</li>
<li>用 <code>drawFeature(feature, style)</code> 把多边形画到当前画布上（这会在 canvas 上生成路径）。</li>
<li>然后调用 <code>ctx.clip()</code>，把这条路径设为裁切区,将当前图层进行裁切。</li>
</ul>
</li>
<li>在图层绘制结束后（postrender）恢复状态：
<ul>
<li>在 postrender 回调里调用 <code>ctx.restore()</code>，把之前保存的 canvas 状态还原，移除裁切，确保别的图层不受影响。</li>
</ul>
</li>
</ol>
<h2 data-id="heading-3">⚙️ 初始化项目</h2>
<p>​	这里我设置地图的坐标系是3857,你可以根据自己的需要设置对应的坐标系</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-cn"</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>openlayer图层裁切<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-tag">html</span>,
        <span class="hljs-selector-tag">body</span>,
        <span class="hljs-selector-id">#map</span> {
            <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
            <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"map"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./ol.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-keyword">const</span> projection = ol.<span class="hljs-property">proj</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'EPSG:3857'</span>);
        <span class="hljs-keyword">const</span> map = <span class="hljs-keyword">new</span> ol.<span class="hljs-title class_">Map</span>({
            <span class="hljs-attr">layers</span>: [
                <span class="hljs-comment">// 矢量底图</span>
                <span class="hljs-keyword">new</span> ol.<span class="hljs-property">layer</span>.<span class="hljs-title class_">Tile</span>({
                    <span class="hljs-attr">source</span>: <span class="hljs-keyword">new</span> ol.<span class="hljs-property">source</span>.<span class="hljs-title function_">XYZ</span>({
                        <span class="hljs-attr">url</span>: <span class="hljs-string">`https://t{0-7}.tianditu.gov.cn/DataServer?T=vec_w&amp;x={x}&amp;y={y}&amp;l={z}&amp;tk=2aedde694311cf1e8ac3feca2da4fd3e`</span>,
                    }),
                }),
                <span class="hljs-comment">// 矢量注记</span>
                <span class="hljs-keyword">new</span> ol.<span class="hljs-property">layer</span>.<span class="hljs-title class_">Tile</span>({
                    <span class="hljs-attr">source</span>: <span class="hljs-keyword">new</span> ol.<span class="hljs-property">source</span>.<span class="hljs-title function_">XYZ</span>({
                        <span class="hljs-attr">url</span>: <span class="hljs-string">`https://t{0-7}.tianditu.gov.cn/DataServer?T=cva_w&amp;x={x}&amp;y={y}&amp;l={z}&amp;tk=2aedde694311cf1e8ac3feca2da4fd3e`</span>,
                    }),
                }),
            ],
            <span class="hljs-attr">target</span>: <span class="hljs-string">'map'</span>,
            <span class="hljs-attr">view</span>: <span class="hljs-keyword">new</span> ol.<span class="hljs-title class_">View</span>({
                <span class="hljs-attr">zoom</span>: <span class="hljs-number">5</span>,
                <span class="hljs-attr">maxZoom</span>: <span class="hljs-number">17</span>,
                <span class="hljs-attr">minZoom</span>: <span class="hljs-number">1</span>,
                <span class="hljs-attr">projection</span>: projection,
                <span class="hljs-attr">center</span>: [<span class="hljs-number">116.406393</span>, <span class="hljs-number">39.909006</span>],
            }),
        })
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>效果如下</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a43574a3cdc4763a027c2523cffc589~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buR5b-D55qu6JuL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769254303&amp;x-signature=RN3t1%2Fm7CT5YmRvO0DDmnUOqnHQ%3D" alt="image-20260117182119131" loading="lazy"/></p>
<h2 data-id="heading-4">📐 多边形预览</h2>
<p>​	前面实现思路说了,我们需要一个多边形裁切图层,我这里准备了一个</p>
<pre><code class="hljs language-js" lang="js">   <span class="hljs-keyword">const</span> polygonCoords =
                [
                    [
                        [
                            <span class="hljs-number">911245.7835522988</span>,
                            <span class="hljs-number">1672839.829528198</span>
                        ],
                        [
                            <span class="hljs-number">1517290.255658307</span>,
                            <span class="hljs-number">2962709.5078420187</span>
                        ],
                        [
                            <span class="hljs-number">2862581.9534774087</span>,
                            <span class="hljs-number">3011639.670051078</span>
                        ],
                        [
                            <span class="hljs-number">3492423.0665472616</span>,
                            <span class="hljs-number">2736407.507625122</span>
                        ],
                        [
                            <span class="hljs-number">3675871.934431684</span>,
                            <span class="hljs-number">2161478.101668681</span>
                        ],
                        [
                            <span class="hljs-number">3131640.2930412292</span>,
                            <span class="hljs-number">1647711.398473564</span>
                        ],
                        [
                            <span class="hljs-number">2141016.406465345</span>,
                            <span class="hljs-number">999386.7492035348</span>
                        ],
                        [
                            <span class="hljs-number">2581293.6893879604</span>,
                            <span class="hljs-number">63597.39695528569</span>
                        ],
                        [
                            <span class="hljs-number">2165476.2555166017</span>,
                            -<span class="hljs-number">523564.5495534199</span>
                        ],
                        [
                            <span class="hljs-number">3107180.4439899744</span>,
                            -<span class="hljs-number">982284.8202633462</span>
                        ],
                        [
                            <span class="hljs-number">2232740.8404075587</span>,
                            -<span class="hljs-number">1379842.3882119493</span>
                        ],
                        [
                            <span class="hljs-number">1609014.6896005198</span>,
                            -<span class="hljs-number">1300330.874622228</span>
                        ],
                        [
                            <span class="hljs-number">1040323.1991588091</span>,
                            -<span class="hljs-number">1104610.2257859926</span>
                        ],
                        [
                            <span class="hljs-number">471631.7087170966</span>,
                            -<span class="hljs-number">450169.3062398317</span>
                        ],
                        [
                            <span class="hljs-number">465516.74645428266</span>,
                            <span class="hljs-number">240969.23496312322</span>
                        ],
                        [
                            <span class="hljs-number">324872.6144095585</span>,
                            <span class="hljs-number">913758.9653376816</span>
                        ],
                        [
                            <span class="hljs-number">593930.953973379</span>,
                            <span class="hljs-number">1757804.2634439464</span>
                        ],
                        [
                            <span class="hljs-number">911245.7835522988</span>,
                            <span class="hljs-number">1672839.829528198</span>
                        ]
                    ]
                ]

</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f7410564aeb478e9827fd817cf71849~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buR5b-D55qu6JuL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769254303&amp;x-signature=%2Bkjd2JTkSK9KdsclpRGCcUj429U%3D" alt="image-20260117190344593" loading="lazy"/></p>
<p>后面就会用这个多边形来对图层进行裁切</p>
<h2 data-id="heading-5">🗺️ 添加一张影像图</h2>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-cn"</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>openlayer图层裁切<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-tag">html</span>,
        <span class="hljs-selector-tag">body</span>,
        <span class="hljs-selector-id">#map</span> {
            <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
            <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"map"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./ol.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-keyword">const</span> projection = ol.<span class="hljs-property">proj</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'EPSG:3857'</span>);
        <span class="hljs-keyword">const</span> projectionExtent = projection.<span class="hljs-title function_">getExtent</span>();
        <span class="hljs-keyword">const</span> size = ol.<span class="hljs-property">extent</span>.<span class="hljs-title function_">getWidth</span>(projectionExtent) / <span class="hljs-number">256</span>;
        <span class="hljs-keyword">const</span> resolutions = [];
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> z = <span class="hljs-number">2</span>; z &lt; <span class="hljs-number">19</span>; ++z) {
            resolutions[z] = size / <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(<span class="hljs-number">2</span>, z);
        }
        <span class="hljs-keyword">const</span> matrixIds = [<span class="hljs-string">'0'</span>,
            <span class="hljs-string">'1'</span>,
            <span class="hljs-string">'2'</span>,
            <span class="hljs-string">'3'</span>,
            <span class="hljs-string">'4'</span>,
            <span class="hljs-string">'5'</span>,
            <span class="hljs-string">'6'</span>,
            <span class="hljs-string">'7'</span>,
            <span class="hljs-string">'8'</span>,
            <span class="hljs-string">'9'</span>,
            <span class="hljs-string">'10'</span>,
            <span class="hljs-string">'11'</span>,
            <span class="hljs-string">'12'</span>,
            <span class="hljs-string">'13'</span>,
            <span class="hljs-string">'14'</span>,
            <span class="hljs-string">'15'</span>,
            <span class="hljs-string">'16'</span>,
            <span class="hljs-string">'17'</span>,
            <span class="hljs-string">'18'</span>]
        <span class="hljs-keyword">const</span> map = <span class="hljs-keyword">new</span> ol.<span class="hljs-title class_">Map</span>({
            <span class="hljs-attr">layers</span>: [
                <span class="hljs-comment">// 矢量底图</span>
                <span class="hljs-keyword">new</span> ol.<span class="hljs-property">layer</span>.<span class="hljs-title class_">Tile</span>({
                    <span class="hljs-attr">source</span>: <span class="hljs-keyword">new</span> ol.<span class="hljs-property">source</span>.<span class="hljs-title function_">XYZ</span>({
                        <span class="hljs-attr">url</span>: <span class="hljs-string">`https://t{0-7}.tianditu.gov.cn/DataServer?T=vec_w&amp;x={x}&amp;y={y}&amp;l={z}&amp;tk=2aedde694311cf1e8ac3feca2da4fd3e`</span>,
                    }),
                }),
                <span class="hljs-comment">// 矢量注记</span>
                <span class="hljs-keyword">new</span> ol.<span class="hljs-property">layer</span>.<span class="hljs-title class_">Tile</span>({
                    <span class="hljs-attr">source</span>: <span class="hljs-keyword">new</span> ol.<span class="hljs-property">source</span>.<span class="hljs-title function_">XYZ</span>({
                        <span class="hljs-attr">url</span>: <span class="hljs-string">`https://t{0-7}.tianditu.gov.cn/DataServer?T=cva_w&amp;x={x}&amp;y={y}&amp;l={z}&amp;tk=2aedde694311cf1e8ac3feca2da4fd3e`</span>,
                    }),
                }),
            ],
            <span class="hljs-attr">target</span>: <span class="hljs-string">'map'</span>,
            <span class="hljs-attr">view</span>: <span class="hljs-keyword">new</span> ol.<span class="hljs-title class_">View</span>({
                <span class="hljs-attr">zoom</span>: <span class="hljs-number">5</span>,
                <span class="hljs-attr">maxZoom</span>: <span class="hljs-number">17</span>,
                <span class="hljs-attr">minZoom</span>: <span class="hljs-number">1</span>,
                <span class="hljs-attr">projection</span>: projection,
                <span class="hljs-attr">center</span>: [<span class="hljs-number">116.406393</span>, <span class="hljs-number">39.909006</span>],
            }),
        })
        <span class="hljs-keyword">const</span> wmtsLayer = <span class="hljs-keyword">new</span> ol.<span class="hljs-property">layer</span>.<span class="hljs-title class_">Tile</span>({
            <span class="hljs-attr">source</span>: <span class="hljs-keyword">new</span> ol.<span class="hljs-property">source</span>.<span class="hljs-title function_">WMTS</span>({
                <span class="hljs-attr">url</span>: <span class="hljs-string">`http://t{0-6}.tianditu.gov.cn/img_c/wmts?tk=2aedde694311cf1e8ac3feca2da4fd3e`</span>,
                <span class="hljs-attr">layer</span>: <span class="hljs-string">'img'</span>,
                <span class="hljs-attr">matrixSet</span>: <span class="hljs-string">'c'</span>,
                <span class="hljs-attr">style</span>: <span class="hljs-string">'default'</span>,
                <span class="hljs-attr">crossOrigin</span>: <span class="hljs-string">'anonymous'</span>,
                <span class="hljs-attr">format</span>: <span class="hljs-string">'tiles'</span>,
                <span class="hljs-attr">wrapX</span>: <span class="hljs-literal">true</span>,
                <span class="hljs-attr">crossOrigin</span>: <span class="hljs-string">'anonymous'</span>,
                <span class="hljs-attr">tileGrid</span>: <span class="hljs-keyword">new</span> ol.<span class="hljs-property">tilegrid</span>.<span class="hljs-title function_">WMTS</span>({
                    <span class="hljs-attr">origin</span>: ol.<span class="hljs-property">extent</span>.<span class="hljs-title function_">getTopLeft</span>(projectionExtent),
                    <span class="hljs-attr">resolutions</span>: resolutions,
                    <span class="hljs-attr">matrixIds</span>: matrixIds
                })
            })
        })
        map.<span class="hljs-title function_">addLayer</span>(wmtsLayer);
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>效果如下</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd3566be6a6c415e81caa2a99d625fd9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buR5b-D55qu6JuL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769254303&amp;x-signature=f5pvYkkuGT3v4ZZpmDSqjln99w8%3D" alt="image-20260117191715249" loading="lazy"/></p>
<h2 data-id="heading-6">🔔 监听图层事件</h2>
<p>前面已经将这个影像图添加到地图上面去了, 接下来就可以监听这个图层事件,然后用多边形去裁切这张图层</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// wmtsLayer 就是前面添加的影像图</span>
wmtsLayer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'prerender'</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">evt</span>) {
    <span class="hljs-keyword">const</span> layerContent = ol.<span class="hljs-property">render</span>.<span class="hljs-title function_">getVectorContext</span>(evt)
    <span class="hljs-keyword">const</span> ctx = evt.<span class="hljs-property">context</span>;
    ctx.<span class="hljs-title function_">save</span>();
    layerContent.<span class="hljs-title function_">drawFeature</span>(polygon, polygonStyle)
    ctx.<span class="hljs-title function_">clip</span>();
});

<span class="hljs-comment">// 渲染后恢复 canvas 状态，移除裁切</span>
wmtsLayer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'postrender'</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">evt</span>) {
    <span class="hljs-keyword">const</span> ctx = evt.<span class="hljs-property">context</span>;
    <span class="hljs-keyword">if</span> (ctx) ctx.<span class="hljs-title function_">restore</span>();
});
<span class="hljs-keyword">const</span> layer = map.<span class="hljs-title function_">addLayer</span>(wmtsLayer);
</code></pre>
<h2 data-id="heading-7">📄 完整代码</h2>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-cn"</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>openlayer图层裁切<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-tag">html</span>,
        <span class="hljs-selector-tag">body</span>,
        <span class="hljs-selector-id">#map</span> {
            <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
            <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
        }

        <span class="hljs-comment">/* 右上角形状按钮组 */</span>
        <span class="hljs-selector-id">#shape-controls</span> {
            <span class="hljs-attribute">position</span>: fixed;
            <span class="hljs-attribute">top</span>: <span class="hljs-number">12px</span>;
            <span class="hljs-attribute">right</span>: <span class="hljs-number">12px</span>;
            <span class="hljs-attribute">display</span>: flex;
            <span class="hljs-attribute">flex-direction</span>: column;
            <span class="hljs-attribute">gap</span>: <span class="hljs-number">8px</span>;
            <span class="hljs-attribute">z-index</span>: <span class="hljs-number">1000</span>;
        }

        <span class="hljs-selector-id">#shape-controls</span> <span class="hljs-selector-tag">button</span> {
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">6px</span> <span class="hljs-number">10px</span>;
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
            <span class="hljs-attribute">cursor</span>: pointer;
        }

        <span class="hljs-selector-id">#shape-controls</span> <span class="hljs-selector-tag">button</span><span class="hljs-selector-class">.active</span> {
            <span class="hljs-attribute">background</span>: <span class="hljs-number">#0b5ed7</span>;
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"map"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"shape-controls"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"btn-polygon"</span>&gt;</span>添加多边形影像图<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./ol.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-keyword">const</span> projection = ol.<span class="hljs-property">proj</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'EPSG:3857'</span>);
        <span class="hljs-keyword">const</span> projectionExtent = projection.<span class="hljs-title function_">getExtent</span>();
        <span class="hljs-keyword">const</span> size = ol.<span class="hljs-property">extent</span>.<span class="hljs-title function_">getWidth</span>(projectionExtent) / <span class="hljs-number">256</span>;
        <span class="hljs-keyword">const</span> resolutions = [];
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> z = <span class="hljs-number">2</span>; z &lt; <span class="hljs-number">19</span>; ++z) {
            resolutions[z] = size / <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(<span class="hljs-number">2</span>, z);
        }
        <span class="hljs-keyword">const</span> matrixIds = [<span class="hljs-string">'0'</span>,
            <span class="hljs-string">'1'</span>,
            <span class="hljs-string">'2'</span>,
            <span class="hljs-string">'3'</span>,
            <span class="hljs-string">'4'</span>,
            <span class="hljs-string">'5'</span>,
            <span class="hljs-string">'6'</span>,
            <span class="hljs-string">'7'</span>,
            <span class="hljs-string">'8'</span>,
            <span class="hljs-string">'9'</span>,
            <span class="hljs-string">'10'</span>,
            <span class="hljs-string">'11'</span>,
            <span class="hljs-string">'12'</span>,
            <span class="hljs-string">'13'</span>,
            <span class="hljs-string">'14'</span>,
            <span class="hljs-string">'15'</span>,
            <span class="hljs-string">'16'</span>,
            <span class="hljs-string">'17'</span>,
            <span class="hljs-string">'18'</span>]
        <span class="hljs-keyword">const</span> map = <span class="hljs-keyword">new</span> ol.<span class="hljs-title class_">Map</span>({
            <span class="hljs-attr">layers</span>: [
                <span class="hljs-comment">// 矢量底图</span>
                <span class="hljs-keyword">new</span> ol.<span class="hljs-property">layer</span>.<span class="hljs-title class_">Tile</span>({
                    <span class="hljs-attr">source</span>: <span class="hljs-keyword">new</span> ol.<span class="hljs-property">source</span>.<span class="hljs-title function_">XYZ</span>({
                        <span class="hljs-attr">url</span>: <span class="hljs-string">`https://t{0-7}.tianditu.gov.cn/DataServer?T=vec_w&amp;x={x}&amp;y={y}&amp;l={z}&amp;tk=2aedde694311cf1e8ac3feca2da4fd3e`</span>,
                    }),
                }),
                <span class="hljs-comment">// 矢量注记</span>
                <span class="hljs-keyword">new</span> ol.<span class="hljs-property">layer</span>.<span class="hljs-title class_">Tile</span>({
                    <span class="hljs-attr">source</span>: <span class="hljs-keyword">new</span> ol.<span class="hljs-property">source</span>.<span class="hljs-title function_">XYZ</span>({
                        <span class="hljs-attr">url</span>: <span class="hljs-string">`https://t{0-7}.tianditu.gov.cn/DataServer?T=cva_w&amp;x={x}&amp;y={y}&amp;l={z}&amp;tk=2aedde694311cf1e8ac3feca2da4fd3e`</span>,
                    }),
                }),
            ],
            <span class="hljs-attr">target</span>: <span class="hljs-string">'map'</span>,
            <span class="hljs-attr">view</span>: <span class="hljs-keyword">new</span> ol.<span class="hljs-title class_">View</span>({
                <span class="hljs-attr">zoom</span>: <span class="hljs-number">5</span>,
                <span class="hljs-attr">maxZoom</span>: <span class="hljs-number">17</span>,
                <span class="hljs-attr">minZoom</span>: <span class="hljs-number">1</span>,
                <span class="hljs-attr">projection</span>: projection,
                <span class="hljs-attr">center</span>: [<span class="hljs-number">116.406393</span>, <span class="hljs-number">39.909006</span>],
            }),
        })

        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'btn-polygon'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
            <span class="hljs-keyword">const</span> polygonCoords =
                [
                    [
                        [
                            <span class="hljs-number">911245.7835522988</span>,
                            <span class="hljs-number">1672839.829528198</span>
                        ],
                        [
                            <span class="hljs-number">1517290.255658307</span>,
                            <span class="hljs-number">2962709.5078420187</span>
                        ],
                        [
                            <span class="hljs-number">2862581.9534774087</span>,
                            <span class="hljs-number">3011639.670051078</span>
                        ],
                        [
                            <span class="hljs-number">3492423.0665472616</span>,
                            <span class="hljs-number">2736407.507625122</span>
                        ],
                        [
                            <span class="hljs-number">3675871.934431684</span>,
                            <span class="hljs-number">2161478.101668681</span>
                        ],
                        [
                            <span class="hljs-number">3131640.2930412292</span>,
                            <span class="hljs-number">1647711.398473564</span>
                        ],
                        [
                            <span class="hljs-number">2141016.406465345</span>,
                            <span class="hljs-number">999386.7492035348</span>
                        ],
                        [
                            <span class="hljs-number">2581293.6893879604</span>,
                            <span class="hljs-number">63597.39695528569</span>
                        ],
                        [
                            <span class="hljs-number">2165476.2555166017</span>,
                            -<span class="hljs-number">523564.5495534199</span>
                        ],
                        [
                            <span class="hljs-number">3107180.4439899744</span>,
                            -<span class="hljs-number">982284.8202633462</span>
                        ],
                        [
                            <span class="hljs-number">2232740.8404075587</span>,
                            -<span class="hljs-number">1379842.3882119493</span>
                        ],
                        [
                            <span class="hljs-number">1609014.6896005198</span>,
                            -<span class="hljs-number">1300330.874622228</span>
                        ],
                        [
                            <span class="hljs-number">1040323.1991588091</span>,
                            -<span class="hljs-number">1104610.2257859926</span>
                        ],
                        [
                            <span class="hljs-number">471631.7087170966</span>,
                            -<span class="hljs-number">450169.3062398317</span>
                        ],
                        [
                            <span class="hljs-number">465516.74645428266</span>,
                            <span class="hljs-number">240969.23496312322</span>
                        ],
                        [
                            <span class="hljs-number">324872.6144095585</span>,
                            <span class="hljs-number">913758.9653376816</span>
                        ],
                        [
                            <span class="hljs-number">593930.953973379</span>,
                            <span class="hljs-number">1757804.2634439464</span>
                        ],
                        [
                            <span class="hljs-number">911245.7835522988</span>,
                            <span class="hljs-number">1672839.829528198</span>
                        ]
                    ]
                ]

            <span class="hljs-keyword">const</span> wmtsLayer = <span class="hljs-keyword">new</span> ol.<span class="hljs-property">layer</span>.<span class="hljs-title class_">Tile</span>({
                <span class="hljs-attr">source</span>: <span class="hljs-keyword">new</span> ol.<span class="hljs-property">source</span>.<span class="hljs-title function_">WMTS</span>({
                    <span class="hljs-attr">url</span>: <span class="hljs-string">`http://t{0-6}.tianditu.gov.cn/img_c/wmts?tk=2aedde694311cf1e8ac3feca2da4fd3e`</span>,
                    <span class="hljs-attr">layer</span>: <span class="hljs-string">'img'</span>,
                    <span class="hljs-attr">matrixSet</span>: <span class="hljs-string">'c'</span>,
                    <span class="hljs-attr">style</span>: <span class="hljs-string">'default'</span>,
                    <span class="hljs-attr">crossOrigin</span>: <span class="hljs-string">'anonymous'</span>,
                    <span class="hljs-attr">format</span>: <span class="hljs-string">'tiles'</span>,
                    <span class="hljs-attr">wrapX</span>: <span class="hljs-literal">true</span>,
                    <span class="hljs-attr">crossOrigin</span>: <span class="hljs-string">'anonymous'</span>,
                    <span class="hljs-attr">tileGrid</span>: <span class="hljs-keyword">new</span> ol.<span class="hljs-property">tilegrid</span>.<span class="hljs-title function_">WMTS</span>({
                        <span class="hljs-attr">origin</span>: ol.<span class="hljs-property">extent</span>.<span class="hljs-title function_">getTopLeft</span>(projectionExtent),
                        <span class="hljs-attr">resolutions</span>: resolutions,
                        <span class="hljs-attr">matrixIds</span>: matrixIds
                    })
                })
            })
            <span class="hljs-keyword">const</span> polygon = <span class="hljs-keyword">new</span> ol.<span class="hljs-title class_">Feature</span>({
                <span class="hljs-attr">geometry</span>: <span class="hljs-keyword">new</span> ol.<span class="hljs-property">geom</span>.<span class="hljs-title class_">Polygon</span>(polygonCoords)
            })
            <span class="hljs-keyword">const</span> polygonStyle = <span class="hljs-keyword">new</span> ol.<span class="hljs-property">style</span>.<span class="hljs-title class_">Style</span>({
                <span class="hljs-attr">stroke</span>: <span class="hljs-keyword">new</span> ol.<span class="hljs-property">style</span>.<span class="hljs-title class_">Stroke</span>({
                    <span class="hljs-attr">color</span>: <span class="hljs-string">'rgba(255, 0, 0, 1)'</span>,
                    <span class="hljs-attr">width</span>: <span class="hljs-number">2</span>
                })
            });

            <span class="hljs-comment">// 在渲染前使用多边形对图层进行裁切（clip）</span>
            wmtsLayer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'prerender'</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">evt</span>) {
                <span class="hljs-keyword">const</span> layerContent = ol.<span class="hljs-property">render</span>.<span class="hljs-title function_">getVectorContext</span>(evt)
                <span class="hljs-keyword">const</span> ctx = evt.<span class="hljs-property">context</span>;
                ctx.<span class="hljs-title function_">save</span>();
                layerContent.<span class="hljs-title function_">drawFeature</span>(polygon, polygonStyle)
                ctx.<span class="hljs-title function_">clip</span>();
            });

            <span class="hljs-comment">// 渲染后恢复 canvas 状态，移除裁切</span>
            wmtsLayer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'postrender'</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">evt</span>) {
                <span class="hljs-keyword">const</span> ctx = evt.<span class="hljs-property">context</span>;
                <span class="hljs-keyword">if</span> (ctx) ctx.<span class="hljs-title function_">restore</span>();
            });
            <span class="hljs-keyword">const</span> layer = map.<span class="hljs-title function_">addLayer</span>(wmtsLayer);
        });
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🚀 AI全栈项目实战 Day 3：React 玩家的后端新大陆 —— NestJS 深度硬核指南]]></title>    <link>https://juejin.cn/post/7595808703074500634</link>    <guid>https://juejin.cn/post/7595808703074500634</guid>    <pubDate>2026-01-17T08:22:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595808703074500634" data-draft-id="7595847940621467698" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🚀 AI全栈项目实战 Day 3：React 玩家的后端新大陆 —— NestJS 深度硬核指南"/> <meta itemprop="keywords" content="NestJS,全栈"/> <meta itemprop="datePublished" content="2026-01-17T08:22:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="神秘的猪头"/> <meta itemprop="url" content="https://juejin.cn/user/793223472877051"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🚀 AI全栈项目实战 Day 3：React 玩家的后端新大陆 —— NestJS 深度硬核指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/793223472877051/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    神秘的猪头
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T08:22:24.000Z" title="Sat Jan 17 2026 08:22:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>哈喽，掘金的各位全栈练习生们！我是你们的神秘猪头导师。欢迎来到 AI 全栈项目实战的第三天！👋</p>
<p>在<a href="https://juejin.cn/column/7595043440520413190" target="_blank" title="https://juejin.cn/column/7595043440520413190">上一篇文章</a>中，我们可能还在纠结前端页面的像素眼，或者用原生的 Node.js 手搓简单的服务。但今天，我们要进入一个更加深邃、更加迷人，也绝对会让 React 开发者感到无比亲切的领域——<strong>NestJS</strong>。</p>
<p>如果你觉得 Express 像是一个“只有毛坯房”的装修现场，什么都要自己造；那么 NestJS 就是精装修的“豪宅”，水电煤气（路由、依赖注入、模块化）一应俱全，你只需要拎包入住，专注于你的业务逻辑家具摆放。</p>
<p>准备好了吗？我们要开始一场从“前端切图仔”到“企业级后端架构师”的华丽转身了！🏎️</p>
<hr/>
<h2 data-id="heading-0">🧐 为什么是 NestJS？</h2>
<p>很多 React 开发者第一次看 NestJS 的代码时，都会惊呼：“这味道……太熟悉了！”</p>
<h3 data-id="heading-1">1. 模块化架构 (Modular) 🧩</h3>
<p>React 用 Component（组件）来拼凑 UI，NestJS 用 <strong>Module（模块）</strong> 来拼凑后端服务。你的代码不再是散落在文件夹里的意大利面条，而是井井有条的积木。</p>
<h3 data-id="heading-2">2. 依赖注入 (Dependency Injection) 💉</h3>
<p>听起来很吓人？其实就是“饭来张口”。你需要数据库连接？不需要你自己去 <code>new Database()</code>，只需要在构造函数里喊一声，NestJS 的底层容器就会把数据库实例“注入”给你。这大大降低了代码的耦合度。</p>
<h3 data-id="heading-3">3. TypeScript 的亲儿子 📘</h3>
<p>NestJS 原生就是用 TypeScript 写的。对于我们这些习惯了类型约束、受够了 <code>undefined is not a function</code> 的现代前端人来说，这简直就是福音。</p>
<h3 data-id="heading-4">4. MVC 模式的完美落地 🏗️</h3>
<ul>
<li><strong>M (Model)</strong>: 数据层（Service/Database）</li>
<li><strong>V (View)</strong>: 视图层（API 接口返回的 JSON）</li>
<li><strong>C (Controller)</strong>: 控制层（路由分发）</li>
</ul>
<hr/>
<h2 data-id="heading-5">🛠️ 第一步：起高楼 —— 项目创建</h2>
<p>话不多说，先跑起来。打开你的终端（Terminal），我们先装上 NestJS 的脚手架。这就像是买了一把万能钥匙。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装 NestJS CLI 全局工具</span>
npm i -g @nestjs/cli

<span class="hljs-comment"># 新建项目，我们要创建一个叫 nest-test-demo 的项目</span>
nest new nest-test-demo
</code></pre>
<p>在这个过程中，CLI 会问你用 npm 还是 yarn，选你喜欢的就好。等进度条跑完，一个企业级架构的后端项目就已经躺在你的硬盘里了。</p>
<hr/>
<h2 data-id="heading-6">🚪 第二步：叩开真理之门 —— main.ts 入口分析</h2>
<p>我们先不看别的，直接冲进 <code>main.ts</code>。这里是整个程序的<strong>入口</strong>，梦开始的地方。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NestFactory</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/core'</span>;
<span class="hljs-comment">// 模块化</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">AppModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./app.module'</span>;
<span class="hljs-keyword">import</span> { config } <span class="hljs-keyword">from</span> <span class="hljs-string">'dotenv'</span>;
<span class="hljs-title function_">config</span>();

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">bootstrap</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// server app</span>
  <span class="hljs-comment">// 工厂模式 三星 手机，汽车，方便面</span>
  <span class="hljs-comment">// NestFactory nest 工厂</span>
  <span class="hljs-comment">// 根模型</span>
  <span class="hljs-keyword">const</span> app = <span class="hljs-keyword">await</span> <span class="hljs-title class_">NestFactory</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">AppModule</span>); <span class="hljs-comment">// L12</span>
  <span class="hljs-comment">// 3000 node 进程对象process</span>
  <span class="hljs-comment">// 空值合并运算符 ES2020 2015是ES6所以2020是ES11</span>
  <span class="hljs-keyword">await</span> app.<span class="hljs-title function_">listen</span>(process.<span class="hljs-property">env</span>.<span class="hljs-property">PORT</span> ?? <span class="hljs-number">3000</span>); <span class="hljs-comment">// L15</span>
}
<span class="hljs-title function_">bootstrap</span>();
</code></pre>
<h3 data-id="heading-7">🏭 知识点 1：工厂模式 (Factory Pattern)</h3>
<p>请看第 12 行：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> app = <span class="hljs-keyword">await</span> <span class="hljs-title class_">NestFactory</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">AppModule</span>);
</code></pre>
<p>这里用到了经典的设计模式——<strong>工厂模式</strong>。
想象一下，你想要一台三星手机。你不需要自己去采购屏幕、芯片、电池然后自己组装（那是 <code>new App()</code> 做的事）。你只需要找到“三星工厂” (<code>NestFactory</code>)，告诉它：“给我造一台手机！” (<code>create</code>)，并且把设计图纸 (<code>AppModule</code>) 给它。
<code>NestFactory</code> 就会帮你把底层的 Express 实例、路由系统、异常过滤器等等全部组装好，直接返给你一个可以直接使用的 <code>app</code> 对象。这就是封装的艺术。</p>
<h3 data-id="heading-8">❓ 知识点 2：空值合并运算符 (Nullish Coalescing)</h3>
<p>再看第 15 行：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">await</span> app.<span class="hljs-title function_">listen</span>(process.<span class="hljs-property">env</span>.<span class="hljs-property">PORT</span> ?? <span class="hljs-number">3000</span>);
</code></pre>
<p>这里有个可爱的小符号 <code>??</code>。这是 ES2020 (ES11) 引入的新特性，叫<strong>空值合并运算符</strong>。</p>
<ul>
<li><strong>以前我们怎么写？</strong> <code>process.env.PORT || 3000</code>。但这有个 bug，如果端口真的是 <code>0</code>（虽然很少见），<code>||</code> 会把它当成 false，强行变成 3000。</li>
<li><strong>现在 <code>??</code> 怎么做？</strong> 只有当左侧是 <code>null</code> 或 <code>undefined</code> 时，才会使用右侧的值。如果左侧是 <code>0</code> 或 <code>false</code>，它会照单全收。这就是严谨！</li>
</ul>
<hr/>
<h2 data-id="heading-9">🧠 第三步：大脑中枢 —— App.Module</h2>
<p>如果说 <code>main.ts</code> 是大门，那 <code>app.module.ts</code> 就是<strong>总指挥部</strong>。NestJS 是模块化的，而 <code>AppModule</code> 是所有模块的根（Root Module）。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Module</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">AppController</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./app.controller'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">AppService</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./app.service'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">TodosModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./todos/todos.module'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">DatabaseModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./database/database.module'</span>;
<span class="hljs-comment">// mvc 设计模式 模型-视图-控制器</span>
<span class="hljs-comment">// 一个文件一个类</span>
<span class="hljs-comment">// 装饰器模式 让AppModule类成为一个模块</span>
<span class="hljs-meta">@Module</span>({
  <span class="hljs-attr">imports</span>: [
    <span class="hljs-title class_">TodosModule</span>,
    <span class="hljs-title class_">DatabaseModule</span>
  ],
  <span class="hljs-comment">// 后端路由 控制逻辑 参数校验 逻辑处理</span>
  <span class="hljs-attr">controllers</span>: [<span class="hljs-title class_">AppController</span>],
  <span class="hljs-comment">// 后端服务 业务逻辑 数据库操作</span>
  <span class="hljs-comment">// 数据</span>
  <span class="hljs-attr">providers</span>: [<span class="hljs-title class_">AppService</span>],
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppModule</span> {}
</code></pre>
<h3 data-id="heading-10">🎀 知识点 3：装饰器 (Decorators)</h3>
<p>看到那个 <code>@Module</code> 了吗？这就是<strong>装饰器</strong>。
在 ES6 的类（Class）上面加个 <code>@</code>，就像给这个类贴了个魔法标签。
<code>AppModule</code> 本身只是个空类（Class），啥也不会。但是贴上 <code>@Module</code> 后，NestJS 就知道：“哦！这是一个模块！”</p>
<p><code>@Module</code> 接收一个对象，里面有三个核心属性：</p>
<ol>
<li><strong>imports</strong>: <strong>“我需要谁帮忙？”</strong> 这里引入了 <code>TodosModule</code> 和 <code>DatabaseModule</code>。说明 <code>AppModule</code> 这个老板可以调用这两个部门的能力。</li>
<li><strong>controllers</strong>: <strong>“谁负责接待客人？”</strong> <code>AppController</code> 是门面，负责处理 HTTP 请求。</li>
<li><strong>providers</strong>: <strong>“谁负责干活？”</strong> <code>AppService</code> 是苦力，负责具体的业务逻辑。</li>
</ol>
<p>这三者共同构成了 NestJS 的 MVC 架构基石。</p>
<hr/>
<h2 data-id="heading-11">🗣️ 第四步：门面担当 —— Controller (控制器)</h2>
<p>接下来我们看看负责接待的 <code>AppController</code>。它的职责非常明确：<strong>监听路由，接收参数，校验数据，然后把活儿派给 Service</strong>。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Controller</span>,<span class="hljs-title class_">Get</span>,<span class="hljs-title class_">Post</span>,<span class="hljs-title class_">Body</span>,<span class="hljs-title class_">Inject</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">AppService</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./app.service'</span>;

<span class="hljs-meta">@Controller</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppController</span> {
  <span class="hljs-comment">// service 实例</span>
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">
    <span class="hljs-meta">@Inject</span>(<span class="hljs-string">'PG_CONNECTION'</span>) <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> db: <span class="hljs-built_in">any</span>, <span class="hljs-comment">// L8</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> appService: AppService <span class="hljs-comment">// L9</span>
  </span>){}

  <span class="hljs-meta">@Get</span>()
  <span class="hljs-title function_">getHello</span>(): <span class="hljs-built_in">string</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">appService</span>.<span class="hljs-title function_">getHello</span>();
  }

  <span class="hljs-comment">// ... 省略部分代码</span>

  <span class="hljs-meta">@Post</span>(<span class="hljs-string">'login'</span>)
  <span class="hljs-title function_">login</span>(<span class="hljs-params"><span class="hljs-meta">@Body</span>() body: {username: <span class="hljs-built_in">string</span>, password: <span class="hljs-built_in">string</span>}</span>){
    <span class="hljs-keyword">const</span> {username,password} = body;
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(username,password);
    <span class="hljs-comment">// ... 参数校验逻辑</span>
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">appService</span>.<span class="hljs-title function_">handleLogin</span>(username,password);
  }
}
</code></pre>
<h3 data-id="heading-12">💉 知识点 4：构造函数注入 (Constructor Injection) —— 核心难点！</h3>
<p>请大家把目光聚焦在第 7-10 行的 <code>constructor</code>：</p>
<pre><code class="hljs language-typescript" lang="typescript">  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">
    <span class="hljs-meta">@Inject</span>(<span class="hljs-string">'PG_CONNECTION'</span>) <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> db: <span class="hljs-built_in">any</span>,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> appService: AppService
  </span>){}
</code></pre>
<p>这里有两个非常硬核的知识点：</p>
<ol>
<li>
<p><strong>TypeScript 的参数属性 (Parameter Properties)</strong>：
你看到 <code>private readonly appService: AppService</code> 了吗？
在普通的 JS 类里，你需要先定义 <code>this.appService</code>，然后在构造函数里 <code>this.appService = appService</code>。
但在 TS 里，只要你在构造函数参数前加上 <code>private</code>、<code>public</code> 或 <code>readonly</code>，TS 就会自动帮你把这个参数变成类的属性，并自动赋值！<strong>一行代码顶三行，简洁就是正义。</strong></p>
</li>
<li>
<p><strong>依赖注入 (DI) 的真谛</strong>：
我们没有写 <code>new AppService()</code>。我们只是声明了类型 <code>: AppService</code>。NestJS 的扫描机制发现你需要 <code>AppService</code>，它就会去容器里找，找到之前在 <code>AppModule</code> 里注册过的那个 <code>AppService</code> 实例，直接塞给你。
这就叫“雇佣兵”模式：谁需要谁招募，但招募的动作由系统自动完成。</p>
<p>至于那个 <code>@Inject('PG_CONNECTION')</code>，我们稍后讲数据库模块时会揭晓它的神秘面纱！🎭</p>
</li>
</ol>
<h3 data-id="heading-13">🚦 知识点 5：HTTP 动词与参数装饰器</h3>
<ul>
<li>
<p><strong>@Controller()</strong>: 可以传参，比如 <code>@Controller('users')</code>，那下面的路由前缀就是 <code>/users</code>。这里没传，就是根路径。</p>
</li>
<li>
<p><strong>@Get()</strong>: 处理 GET 请求。</p>
</li>
<li>
<p><strong>@Post('login')</strong>: 处理 POST 请求，路径是 <code>/login</code>。</p>
</li>
<li>
<p><strong>@Body()</strong>: 这是一个<strong>参数装饰器</strong>。它专门用来提取 HTTP 请求体（Body）里的数据。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">login</span>(<span class="hljs-meta">@Body</span>() <span class="hljs-attr">body</span>: {<span class="hljs-attr">username</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">password</span>: <span class="hljs-built_in">string</span>})
</code></pre>
<p>这里我们还顺手给 <code>body</code> 加了个 TS 类型定义。在函数内部，我们可以直接解构 <code>username</code> 和 <code>password</code> 进行校验。虽然这里我们是手动写 <code>if (!username)</code> 来校验的，但在更高级的用法里，我们可以配合 DTO (Data Transfer Object) 和 <code>class-validator</code> 来自动校验。</p>
</li>
</ul>
<p>Controller 做完校验后，最后一行 <code>return this.appService.handleLogin(...)</code>，就把具体的登录逻辑甩锅给 Service 了。这就叫<strong>职责分离</strong>！</p>
<hr/>
<h2 data-id="heading-14">👨‍🍳 第五步：幕后大厨 —— Service (服务)</h2>
<p>Controller 只是服务员，拿着菜单（参数）进厨房。<code>AppService</code> 才是真正炒菜的大厨。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 依赖注入</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Injectable</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>
<span class="hljs-comment">// controller 服务于路由， 树根</span>
<span class="hljs-comment">// service 店里的厨师 Injectable 被注入 </span>
<span class="hljs-meta">@Injectable</span>() 
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppService</span> {
  <span class="hljs-title function_">getHello</span>(): <span class="hljs-built_in">string</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-string">'你好yeah'</span>;
  }
  <span class="hljs-comment">// ...</span>
  <span class="hljs-title function_">handleLogin</span>(<span class="hljs-params">username: <span class="hljs-built_in">string</span>,password: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-keyword">if</span>(username === <span class="hljs-string">"admin"</span> &amp;&amp; password === <span class="hljs-string">"123456"</span>){
      <span class="hljs-keyword">return</span> { <span class="hljs-attr">code</span>: <span class="hljs-number">200</span>, <span class="hljs-attr">msg</span>: <span class="hljs-string">'登录成功'</span> };
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> { <span class="hljs-attr">code</span>: <span class="hljs-number">400</span>, <span class="hljs-attr">msg</span>: <span class="hljs-string">'用户名或密码错误'</span> };
  }
}
</code></pre>
<h3 data-id="heading-15">🏷️ 知识点 6：@Injectable()</h3>
<p><code>@Injectable()</code> 顾名思义：<strong>可被注入的</strong>。
这个装饰器告诉 NestJS：“嘿，我是个有用的类，我可以被注入到别的 Controller 或者其他 Service 里去。”
所有的业务逻辑（Business Logic），比如计算、判断密码、复杂的算法，都应该写在这里。Controller 应该保持清爽，只负责收发。</p>
<hr/>
<h2 data-id="heading-16">🧱 第六步：举一反三 —— Feature Module (Todos 业务模块)</h2>
<p>看完了 <code>AppModule</code>，我们来看看如何扩展业务。比如我们要写一个待办事项（Todo）的功能。NestJS 推荐我们将功能按模块拆分。</p>
<h3 data-id="heading-17">1. Todos Module</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Module</span>({
    <span class="hljs-attr">controllers</span>: [<span class="hljs-title class_">TodosController</span>],
    <span class="hljs-attr">providers</span>: [<span class="hljs-title class_">TodosService</span>],
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TodosModule</span> {}
</code></pre>
<p>结构和 <code>AppModule</code> 一模一样！这就是模块化的美妙之处——<strong>一致性</strong>。无论你的项目多大，每个模块的结构都是可预测的。</p>
<h3 data-id="heading-18">2. Todos Controller (解锁新技能)</h3>
<p>在 <code>todos.controller.ts</code> 里，我们解锁了几个新装饰器：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Controller</span>, <span class="hljs-title class_">Get</span>, <span class="hljs-title class_">Post</span>, <span class="hljs-title class_">Body</span>, <span class="hljs-title class_">Delete</span>, <span class="hljs-title class_">Param</span>, <span class="hljs-title class_">ParseIntPipe</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;
<span class="hljs-comment">// ...</span>

<span class="hljs-meta">@Controller</span>(<span class="hljs-string">'todos'</span>) <span class="hljs-comment">// 路由前缀，访问路径变成了 /todos</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TodosController</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> todosService: TodosService</span>) {}
    
    <span class="hljs-meta">@Get</span>()
    <span class="hljs-title function_">getTodos</span>(<span class="hljs-params"/>) { <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">todosService</span>.<span class="hljs-title function_">findAll</span>(); }

    <span class="hljs-meta">@Post</span>()
    <span class="hljs-title function_">addTodo</span>(<span class="hljs-params"><span class="hljs-meta">@Body</span>(<span class="hljs-string">'title'</span>) title: <span class="hljs-built_in">string</span></span>){ <span class="hljs-comment">// 只取 body 里的 title 字段</span>
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">todosService</span>.<span class="hljs-title function_">addTodo</span>(title);
    }

    <span class="hljs-meta">@Delete</span>(<span class="hljs-string">':id'</span>) <span class="hljs-comment">// 动态路由</span>
    <span class="hljs-title function_">deleteTodo</span>(<span class="hljs-params"><span class="hljs-meta">@Param</span>(<span class="hljs-string">'id'</span>, ParseIntPipe) id: <span class="hljs-built_in">number</span></span>){ <span class="hljs-comment">// 管道转换</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">typeof</span> id,<span class="hljs-string">'/////'</span>); <span class="hljs-comment">// 这里的 id 已经是 number 类型了！</span>
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">todosService</span>.<span class="hljs-title function_">deleteTodo</span>(id);
    }
}
</code></pre>
<ul>
<li><strong>@Controller('todos')</strong>: 这里加了前缀。所以 <code>getTodos</code> 的 URL 是 <code>GET /todos</code>。</li>
<li><strong>@Body('title')</strong>: 之前我们在 <code>login</code> 里是获取整个 body。这里我们可以传个字符串 <code>'title'</code>，告诉 NestJS：“我只要 body 里的 title 属性”。精准打击！🎯</li>
<li><strong>@Delete(':id')</strong>: 定义了一个动态路由参数。URL 类似于 <code>DELETE /todos/123</code>。</li>
<li><strong>Pipe (管道) —— <code>ParseIntPipe</code></strong>:
这是 NestJS 的一大杀器！HTTP 传过来的参数默认都是 String 类型的。
但是我们的 Service 需要一个 Number 类型的 ID。
<code>@Param('id', ParseIntPipe) id: number</code> 这行代码做了一件很酷的事：
<ol>
<li>从路由提取 <code>id</code>。</li>
<li><strong>中间件拦截</strong>：<code>ParseIntPipe</code> 尝试把它转成整数。</li>
<li><strong>如果转换失败</strong>（比如传了 <code>abc</code>），NestJS 直接抛出 400 错误，甚至不会进入函数体。</li>
<li><strong>如果成功</strong>，传入函数的 <code>id</code> 就是纯正的 <code>number</code> 类型。</li>
</ol>
</li>
</ul>
<h3 data-id="heading-19">3. Todos Service (接口与数据)</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Todo</span> {
    <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
    <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">completed</span>: <span class="hljs-built_in">boolean</span>;
}

<span class="hljs-meta">@Injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TodosService</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-attr">todos</span>: <span class="hljs-title class_">Todo</span>[] = [ ... ]; <span class="hljs-comment">// 内存数据库</span>
    <span class="hljs-comment">// ... CRUD 方法</span>
}
</code></pre>
<p>这里我们定义了 <code>Todo</code> 接口（Interface）。在 TS 里，接口是构建健壮应用的基础，它规定了数据的形状。</p>
<hr/>
<h2 data-id="heading-20">💎 第七步：进阶硬核 —— Database Module (自定义 Provider)</h2>
<p>最后，我们来讲讲最硬核的部分——如何封装一个数据库模块。
我们在 <code>AppController</code> 里看到的 <code>@Inject('PG_CONNECTION')</code> 到底是从哪来的？</p>
<p>请看 <code>src/database/database.module.ts</code>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Module</span>,<span class="hljs-title class_">Global</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Pool</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'pg'</span>; <span class="hljs-comment">// PostgreSQL 客户端</span>
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> dotenv <span class="hljs-keyword">from</span> <span class="hljs-string">'dotenv'</span>;
dotenv.<span class="hljs-title function_">config</span>();

<span class="hljs-comment">// 数据库基础服务</span>
<span class="hljs-meta">@Global</span>() <span class="hljs-comment">// 全局服务</span>
<span class="hljs-meta">@Module</span>({
    <span class="hljs-attr">providers</span>: [
        {
            <span class="hljs-attr">provide</span>: <span class="hljs-string">'PG_CONNECTION'</span>, <span class="hljs-comment">// 自定义令牌 (Token)</span>
            <span class="hljs-comment">// 连接池</span>
            <span class="hljs-attr">useValue</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Pool</span>({
                <span class="hljs-attr">user</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">DB_USER</span>,
                <span class="hljs-comment">// ... 环境变量配置</span>
                <span class="hljs-attr">port</span>: <span class="hljs-built_in">parseInt</span>(process.<span class="hljs-property">env</span>.<span class="hljs-property">DB_PORT</span> || <span class="hljs-string">'5432'</span>,<span class="hljs-number">10</span>),
            })
        }
    ],
    <span class="hljs-attr">exports</span>: [<span class="hljs-string">'PG_CONNECTION'</span>] <span class="hljs-comment">// 导出令牌，让别人也能用</span>
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabaseModule</span> {}
</code></pre>
<p>这里包含了 NestJS 高级依赖注入的精髓：</p>
<h3 data-id="heading-21">1. 自定义 Provider (Custom Provider)</h3>
<p>通常我们的 provider 是一个类（比如 <code>AppService</code>）。但有时候，我们需要注入一个第三方库的实例（比如 <code>pg</code> 的连接池 <code>Pool</code>），或者一个常量。
这时我们就不能直接写类名了，而是要用对象字面量：</p>
<ul>
<li><strong>provide</strong>: <code>'PG_CONNECTION'</code>。这是一个<strong>令牌 (Token)</strong>。你可以把它想象成一个暗号。</li>
<li><strong>useValue</strong>: 这是一个具体的值（在这里是一个配置好的数据库连接池实例）。</li>
</ul>
<h3 data-id="heading-22">2. @Global() 全局模块</h3>
<p>通常模块是隔离的。如果 <code>TodosModule</code> 想用数据库，它得在 <code>imports</code> 里导入 <code>DatabaseModule</code>。
但数据库是基础设施，每个模块都要用。每次都 import 太麻烦了。
加上 <code>@Global()</code> 装饰器，<code>DatabaseModule</code> 就变成了“VIP 中 P”。只要在 <code>AppModule</code> 里注册一次，全项目的任何地方都可以直接使用它导出的 Provider！</p>
<h3 data-id="heading-23">3. 回到 AppController 使用它</h3>
<p>现在回到 <code>src/app.controller.ts</code> 的构造函数：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Inject</span>(<span class="hljs-string">'PG_CONNECTION'</span>) <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-attr">db</span>: <span class="hljs-built_in">any</span>
</code></pre>
<p>这里必须用 <code>@Inject('PG_CONNECTION')</code>，因为 <code>'PG_CONNECTION'</code> 是一个字符串令牌，TS 无法通过类型自动推断出来（不像 <code>AppService</code> 是个类）。
通过这个暗号，NestJS 从容器里拿到了那个 <code>Pool</code> 实例，赋值给 <code>this.db</code>。</p>
<p>然后我们就可以愉快地写 SQL 了：</p>
<pre><code class="hljs language-typescript" lang="typescript">  <span class="hljs-meta">@Get</span>(<span class="hljs-string">'db-test'</span>)
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">testConnection</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">db</span>.<span class="hljs-title function_">query</span>(<span class="hljs-string">'SELECT * FROM users'</span>); <span class="hljs-comment">// L44</span>
      <span class="hljs-keyword">return</span> { <span class="hljs-attr">data</span>: res.<span class="hljs-property">rows</span> }
  }
</code></pre>
<p>注意这里用了 <code>async/await</code>，因为数据库查询是异步操作。</p>
<hr/>
<h2 data-id="heading-24">📝 总结</h2>
<p>恭喜你！🎉 读到这里，你已经掌握了 NestJS 的核心命脉：</p>
<ol>
<li><strong>CLI 就像魔法棒</strong>：<code>nest new</code> 一键生成。</li>
<li><strong>Main 入口</strong>：工厂模式创建应用，<code>??</code> 运算符保驾护航。</li>
<li><strong>Module 乐高积木</strong>：<code>@Module</code> 组装 Controller 和 Service。</li>
<li><strong>Controller 接待员</strong>：路由分发，参数校验，Pipe 管道清洗数据。</li>
<li><strong>Service 大厨</strong>：<code>@Injectable</code> 承载业务逻辑。</li>
<li><strong>Dependency Injection (DI)</strong>：通过构造函数自动注入依赖，解放双手。</li>
<li><strong>Custom Provider</strong>：利用 Token 注入数据库连接池等第三方实例。</li>
</ol>
<p>NestJS 就像是给 Node.js 穿上了一套钢铁侠的战衣。它可能一开始看起来有点重，但当你飞起来的时候，你会感谢这套战衣给你提供的强大动力和安全感。</p>
<p>对于 React 开发者来说，学习 NestJS 是一次思维的升维。你不再只是画页面的画家，你是构建世界的建筑师。</p>
<p>Stay Hungry, Stay Foolish, See you next time! 👋</p>
<hr/>
<h3 data-id="heading-25">💡 附录：核心代码地图</h3>
<ul>
<li><strong>入口文件</strong>: <a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target="><code>main.ts</code></a></li>
<li><strong>根模块</strong>: <a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target="><code>app.module.ts</code></a></li>
<li><strong>主控制器</strong>: <a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target="><code>app.controller.ts</code></a></li>
<li><strong>业务模块</strong>: <a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target="><code>todos.module.ts</code></a></li>
<li><strong>数据库模块</strong>: <a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target="><code>database.module.ts</code></a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flask - Tracking ID的设计]]></title>    <link>https://juejin.cn/post/7595842144906870834</link>    <guid>https://juejin.cn/post/7595842144906870834</guid>    <pubDate>2026-01-17T09:31:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595842144906870834" data-draft-id="7595890117865439278" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flask - Tracking ID的设计"/> <meta itemprop="keywords" content="后端,Python,Flask"/> <meta itemprop="datePublished" content="2026-01-17T09:31:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="花酒锄作田"/> <meta itemprop="url" content="https://juejin.cn/user/3289345922186590"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flask - Tracking ID的设计
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3289345922186590/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    花酒锄作田
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T09:31:58.000Z" title="Sat Jan 17 2026 09:31:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>在实际业务中，根据 <code>tracking_id</code> 追溯一条请求的完整处理路径是比较常见的需求。借助 Flask 自带的全局对象 <code>g</code> 以及钩子函数，可以很容易地为每条请求添加 <code>tracking_id</code>，并在日志中自动记录。</p>
<p>主要内容：</p>
<ul>
<li>如何为每条请求添加 <code>tracking_id</code></li>
<li>如何为日志自动添加 <code>tracking_id</code> 记录</li>
<li>如何自定义响应类，实现统一的响应格式，并在响应头中添加 <code>tracking_id</code></li>
<li>视图函数单元测试示例</li>
<li>Gunicorn 配置</li>
</ul>
<h2 data-id="heading-1">项目结构</h2>
<p>虽然内容看起来很多，但 tracking_id 的实现其实很简单。本文按照生产项目的规范组织了代码，添加了 Gunicorn 配置和单元测试代码，以及规范了日志格式和 JSON 响应格式。</p>
<pre><code class="hljs language-markdown" lang="markdown">├── apis
│   ├── common
│   │   ├── common.py
│   │   └── <span class="hljs-strong">__init__</span>.py
│   └── <span class="hljs-strong">__init__</span>.py
├── gunicorn.conf.py
├── handles
│   └── user.py
├── logs
│   ├── access.log
│   └── error.log
├── main.py
├── middlewares
│   ├── <span class="hljs-strong">__init__</span>.py
│   └── tracking<span class="hljs-emphasis">_id.py
├── pkgs
│   └── log
│       ├── app_</span>log.py
│       └── <span class="hljs-strong">__init__</span>.py
├── pyproject.toml
├── pytest.ini
├── README.md
├── responses
│   ├── <span class="hljs-strong">__init__</span>.py
│   └── json<span class="hljs-emphasis">_response.py
├── tests
│   └── apis
│       └── test_</span>common.py
├── tmp
│   └── gunicorn.pid
└── uv.lock
</code></pre>
<p>安装依赖</p>
<pre><code class="hljs language-shell" lang="shell">uv add flask
uv add gunicorn gevent  # 生产环境部署一般依赖这两个
uv add --dev pytest           # 测试库
</code></pre>
<h2 data-id="heading-2">实现添加 tracking_id 的中间件</h2>
<p>代码文件：<code>middlewares/tracking_id.py</code></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> uuid <span class="hljs-keyword">import</span> uuid4

<span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, Response, g, request


<span class="hljs-keyword">def</span> <span class="hljs-title function_">tracking_id_middleware</span>(<span class="hljs-params">app: Flask</span>):
    <span class="hljs-string">"""
    跟踪 ID 中间件
    为每个请求生成或获取跟踪 ID，用于追踪请求链路
    """</span>
    
<span class="hljs-meta">    @app.before_request</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">tracking_id_before_request</span>():
        <span class="hljs-string">"""
        请求前处理函数
        检查请求头中是否包含 X-Tracking-ID，如果没有则生成一个新的 UUID 作为跟踪 ID
        并将其存储到 Flask 的全局对象 g 中，供后续处理使用
        """</span>
        <span class="hljs-comment"># 从请求头中获取 X-Tracking-ID</span>
        tracking_id = request.headers.get(<span class="hljs-string">"X-Tracking-ID"</span>)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> tracking_id:
            <span class="hljs-comment"># 如果请求头中没有 X-Tracking-ID，则生成一个新的 UUID</span>
            tracking_id = <span class="hljs-built_in">str</span>(uuid4())
        <span class="hljs-comment"># 将跟踪 ID 存储到 Flask 的全局对象 g 中，供后续处理使用</span>
        g.tracking_id = tracking_id

<span class="hljs-meta">    @app.after_request</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">tracking_id_after_request</span>(<span class="hljs-params">response: Response</span>):
        <span class="hljs-string">"""
        请求后处理函数
        将跟踪 ID 添加到响应头中，以便客户端知道本次请求的跟踪 ID
        """</span>
        <span class="hljs-comment"># 检查响应头中是否已经有 X-Tracking-ID</span>
        tracking_id = response.headers.get(<span class="hljs-string">"X-Tracking-ID"</span>, <span class="hljs-string">""</span>)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> tracking_id:
            <span class="hljs-comment"># 如果响应头中没有 X-Tracking-ID，则从全局对象 g 中获取</span>
            tracking_id = g.get(<span class="hljs-string">"tracking_id"</span>, <span class="hljs-string">""</span>)
            <span class="hljs-comment"># 将跟踪 ID 添加到响应头中</span>
            response.headers[<span class="hljs-string">"X-Tracking-ID"</span>] = tracking_id
        <span class="hljs-keyword">return</span> response

    <span class="hljs-comment"># 返回应用实例</span>
    <span class="hljs-keyword">return</span> app
</code></pre>
<p>代码文件 <code>middlewares/__init__.py</code>，方便其他模块导入</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> .tracking_id <span class="hljs-keyword">import</span> tracking_id_middleware

__all__ = [
    <span class="hljs-string">"tracking_id_middleware"</span>,
]
</code></pre>
<h2 data-id="heading-3">日志模块 - 自动记录 tracking_id</h2>
<p>实现一个简单的输出到控制台的日志模块，日志格式为 JSON，自动添加 tracking_id 到日志中，避免手动在 <code>logger.info()</code> 这类方法中传入 <code>tracking_id</code>。</p>
<p>代码文件 <code>pkgs/log/app_log.py</code></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> logging
<span class="hljs-keyword">import</span> sys

<span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> g


<span class="hljs-keyword">class</span> <span class="hljs-title class_">JSONFormatter</span>(logging.Formatter):
    <span class="hljs-string">"""日志格式化器，输出 JSON 格式的日志。"""</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">format</span>(<span class="hljs-params">self, record: logging.LogRecord</span>) -&gt; <span class="hljs-built_in">str</span>:
        log_record = {
            <span class="hljs-string">"@timestamp"</span>: self.formatTime(record, <span class="hljs-string">"%Y-%m-%dT%H:%M:%S%z"</span>),
            <span class="hljs-string">"level"</span>: record.levelname,
            <span class="hljs-string">"name"</span>: record.name,
            <span class="hljs-comment"># "processName": record.processName,  # 如需记录进程名可取消注释</span>
            <span class="hljs-string">"tracking_id"</span>: <span class="hljs-built_in">getattr</span>(record, <span class="hljs-string">"tracking_id"</span>, <span class="hljs-literal">None</span>),
            <span class="hljs-string">"loc"</span>: <span class="hljs-string">"%s:%d"</span> % (record.filename, record.lineno),
            <span class="hljs-string">"func"</span>: record.funcName,
            <span class="hljs-string">"message"</span>: record.getMessage(),
        }

        <span class="hljs-keyword">return</span> json.dumps(log_record, ensure_ascii=<span class="hljs-literal">False</span>, default=<span class="hljs-built_in">str</span>)


<span class="hljs-keyword">class</span> <span class="hljs-title class_">TrackingIDFilter</span>(logging.Filter):
    <span class="hljs-string">"""日志过滤器，为日志记录添加 tracking_id。"""</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">filter</span>(<span class="hljs-params">self, record</span>):
        record.tracking_id = g.get(<span class="hljs-string">"tracking_id"</span>, <span class="hljs-literal">None</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>


<span class="hljs-keyword">def</span> <span class="hljs-title function_">_setup_console_handler</span>(<span class="hljs-params">level: <span class="hljs-built_in">int</span></span>) -&gt; logging.StreamHandler:
    <span class="hljs-string">"""设置控制台日志处理器。

    Args:
        level (int): 日志级别。
    """</span>
    handler = logging.StreamHandler(sys.stdout)
    handler.setLevel(level)
    handler.setFormatter(JSONFormatter())
    <span class="hljs-keyword">return</span> handler


<span class="hljs-keyword">def</span> <span class="hljs-title function_">setup_app_logger</span>(<span class="hljs-params">level: <span class="hljs-built_in">int</span> = logging.INFO, name: <span class="hljs-built_in">str</span> = <span class="hljs-string">"app"</span></span>) -&gt; logging.Logger:
    logger = logging.getLogger(name)

    <span class="hljs-keyword">if</span> logger.hasHandlers():
        <span class="hljs-keyword">return</span> logger

    logger.setLevel(level)
    logger.propagate = <span class="hljs-literal">False</span>

    logger.addHandler(_setup_console_handler(level))
    logger.addFilter(TrackingIDFilter())

    <span class="hljs-keyword">return</span> logger
</code></pre>
<p>在 <code>pkgs/log/__init__.py</code> 中初始化 <code>logger</code>，实现单例调用。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> .app_log <span class="hljs-keyword">import</span> setup_app_logger

logger = setup_app_logger()

__all__ = [<span class="hljs-string">"logger"</span>]
</code></pre>
<h2 data-id="heading-4">自定义响应类</h2>
<p>规范 JSON 类型的响应格式，并在响应头中添加 <code>X-Tracking-ID</code> 和 <code>X-DateTime</code>。</p>
<p>代码文件 <code>responses/json_response.py</code></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> json
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime
<span class="hljs-keyword">from</span> http <span class="hljs-keyword">import</span> HTTPStatus
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Any</span>

<span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Response, g, request


<span class="hljs-keyword">class</span> <span class="hljs-title class_">JsonResponse</span>(<span class="hljs-title class_ inherited__">Response</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">
        self,
        data: <span class="hljs-type">Any</span> = <span class="hljs-literal">None</span>,
        code: HTTPStatus = HTTPStatus.OK,
        msg: <span class="hljs-built_in">str</span> = <span class="hljs-string">"this is a json response"</span>,
    </span>):
        x_tracking_id = g.get(<span class="hljs-string">"tracking_id"</span>, <span class="hljs-string">""</span>)
        x_datetime = datetime.now().astimezone().isoformat(timespec=<span class="hljs-string">"seconds"</span>)
        resp_headers = {
            <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"application/json"</span>,
            <span class="hljs-string">"X-Tracking-ID"</span>: x_tracking_id,
            <span class="hljs-string">"X-DateTime"</span>: x_datetime,
        }
        <span class="hljs-keyword">try</span>:
            resp = json.dumps(
                {
                    <span class="hljs-string">"code"</span>: code.value,
                    <span class="hljs-string">"msg"</span>: msg,
                    <span class="hljs-string">"data"</span>: data,
                },
                ensure_ascii=<span class="hljs-literal">False</span>,
                default=<span class="hljs-built_in">str</span>,
            )
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            resp = json.dumps(
                {
                    <span class="hljs-string">"code"</span>: HTTPStatus.INTERNAL_SERVER_ERROR.value,
                    <span class="hljs-string">"msg"</span>: <span class="hljs-string">f"Response serialization error: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>,
                    <span class="hljs-string">"data"</span>: <span class="hljs-literal">None</span>,
                }
            )
        <span class="hljs-built_in">super</span>().__init__(response=resp, status=code.value, headers=resp_headers)


<span class="hljs-keyword">class</span> <span class="hljs-title class_">Success</span>(<span class="hljs-title class_ inherited__">JsonResponse</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, data: <span class="hljs-type">Any</span> = <span class="hljs-literal">None</span>, msg: <span class="hljs-built_in">str</span> = <span class="hljs-string">""</span></span>):
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> msg:
            msg = <span class="hljs-string">f"<span class="hljs-subst">{request.method}</span> <span class="hljs-subst">{request.path}</span> success"</span>
        <span class="hljs-built_in">super</span>().__init__(data=data, code=HTTPStatus.OK, msg=msg)


<span class="hljs-keyword">class</span> <span class="hljs-title class_">Fail</span>(<span class="hljs-title class_ inherited__">JsonResponse</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, msg: <span class="hljs-built_in">str</span> = <span class="hljs-string">""</span>, data: <span class="hljs-type">Any</span> = <span class="hljs-literal">None</span></span>):
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> msg:
            msg = <span class="hljs-string">f"<span class="hljs-subst">{request.method}</span> <span class="hljs-subst">{request.path}</span> failed"</span>
        <span class="hljs-built_in">super</span>().__init__(data=data, code=HTTPStatus.INTERNAL_SERVER_ERROR, msg=msg)


<span class="hljs-keyword">class</span> <span class="hljs-title class_">ArgumentNotFound</span>(<span class="hljs-title class_ inherited__">JsonResponse</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, msg: <span class="hljs-built_in">str</span> = <span class="hljs-string">""</span>, data: <span class="hljs-type">Any</span> = <span class="hljs-literal">None</span></span>):
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> msg:
            msg = <span class="hljs-string">f"<span class="hljs-subst">{request.method}</span> <span class="hljs-subst">{request.path}</span> argument not found"</span>
        <span class="hljs-built_in">super</span>().__init__(data=data, code=HTTPStatus.BAD_REQUEST, msg=msg)


<span class="hljs-keyword">class</span> <span class="hljs-title class_">ArgumentInvalid</span>(<span class="hljs-title class_ inherited__">JsonResponse</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, msg: <span class="hljs-built_in">str</span> = <span class="hljs-string">""</span>, data: <span class="hljs-type">Any</span> = <span class="hljs-literal">None</span></span>):
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> msg:
            msg = <span class="hljs-string">f"<span class="hljs-subst">{request.method}</span> <span class="hljs-subst">{request.path}</span> argument invalid"</span>
        <span class="hljs-built_in">super</span>().__init__(data=data, code=HTTPStatus.BAD_REQUEST, msg=msg)


<span class="hljs-keyword">class</span> <span class="hljs-title class_">AuthFailed</span>(<span class="hljs-title class_ inherited__">JsonResponse</span>):
    <span class="hljs-string">"""HTTP 状态码: 401"""</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, msg: <span class="hljs-built_in">str</span> = <span class="hljs-string">""</span>, data: <span class="hljs-type">Any</span> = <span class="hljs-literal">None</span></span>):
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> msg:
            msg = <span class="hljs-string">f"<span class="hljs-subst">{request.method}</span> <span class="hljs-subst">{request.path}</span> auth failed"</span>
        <span class="hljs-built_in">super</span>().__init__(data=data, code=HTTPStatus.UNAUTHORIZED, msg=msg)


<span class="hljs-keyword">class</span> <span class="hljs-title class_">ResourceConflict</span>(<span class="hljs-title class_ inherited__">JsonResponse</span>):
    <span class="hljs-string">"""HTTP 状态码: 409"""</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, msg: <span class="hljs-built_in">str</span> = <span class="hljs-string">""</span>, data: <span class="hljs-type">Any</span> = <span class="hljs-literal">None</span></span>):
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> msg:
            msg = <span class="hljs-string">f"<span class="hljs-subst">{request.method}</span> <span class="hljs-subst">{request.path}</span> resource conflict"</span>
        <span class="hljs-built_in">super</span>().__init__(data=data, code=HTTPStatus.CONFLICT, msg=msg)


<span class="hljs-keyword">class</span> <span class="hljs-title class_">ResourceNotFound</span>(<span class="hljs-title class_ inherited__">JsonResponse</span>):
    <span class="hljs-string">"""HTTP 状态码: 404"""</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, msg: <span class="hljs-built_in">str</span> = <span class="hljs-string">""</span>, data: <span class="hljs-type">Any</span> = <span class="hljs-literal">None</span></span>):
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> msg:
            msg = <span class="hljs-string">f"<span class="hljs-subst">{request.method}</span> <span class="hljs-subst">{request.path}</span> resource not found"</span>
        <span class="hljs-built_in">super</span>().__init__(data=data, code=HTTPStatus.NOT_FOUND, msg=msg)


<span class="hljs-keyword">class</span> <span class="hljs-title class_">ResourceForbidden</span>(<span class="hljs-title class_ inherited__">JsonResponse</span>):
    <span class="hljs-string">"""HTTP 状态码: 403"""</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, msg: <span class="hljs-built_in">str</span> = <span class="hljs-string">""</span>, data: <span class="hljs-type">Any</span> = <span class="hljs-literal">None</span></span>):
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> msg:
            msg = <span class="hljs-string">f"<span class="hljs-subst">{request.method}</span> <span class="hljs-subst">{request.path}</span> resource forbidden"</span>
        <span class="hljs-built_in">super</span>().__init__(data=data, code=HTTPStatus.FORBIDDEN, msg=msg)

</code></pre>
<p>代码文件 <code>responses/__init__.py</code>，方便其他模块调用。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> .json_response <span class="hljs-keyword">import</span> (
    ArgumentInvalid,
    ArgumentNotFound,
    AuthFailed,
    Fail,
    JsonResponse,
    ResourceConflict,
    ResourceForbidden,
    ResourceNotFound,
    Success,
)

__all__ = [
    <span class="hljs-string">"JsonResponse"</span>,
    <span class="hljs-string">"Success"</span>,
    <span class="hljs-string">"Fail"</span>,
    <span class="hljs-string">"ArgumentNotFound"</span>,
    <span class="hljs-string">"ArgumentInvalid"</span>,
    <span class="hljs-string">"AuthFailed"</span>,
    <span class="hljs-string">"ResourceConflict"</span>,
    <span class="hljs-string">"ResourceNotFound"</span>,
    <span class="hljs-string">"ResourceForbidden"</span>,
]
</code></pre>
<h2 data-id="heading-5">编写视图函数</h2>
<p>代码文件 <code>apis/common/common.py</code>。以下定义了 5 个路由，主要用于测试响应类是否正常返回 JSON 格式。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime

<span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Blueprint

<span class="hljs-keyword">from</span> handles <span class="hljs-keyword">import</span> user <span class="hljs-keyword">as</span> user_handle
<span class="hljs-keyword">from</span> pkgs.log <span class="hljs-keyword">import</span> logger
<span class="hljs-keyword">from</span> responses <span class="hljs-keyword">import</span> Success

route = Blueprint(<span class="hljs-string">"common_apis"</span>, __name__, url_prefix=<span class="hljs-string">"/api"</span>)


<span class="hljs-meta">@route.get(<span class="hljs-params"><span class="hljs-string">"/health"</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">health_check</span>():
    <span class="hljs-comment"># print(g.get("tracking_id", "no-tracking-id"))</span>
    logger.info(<span class="hljs-string">"Health check"</span>)
    <span class="hljs-keyword">return</span> Success(data=<span class="hljs-string">"OK"</span>)


<span class="hljs-meta">@route.get(<span class="hljs-params"><span class="hljs-string">"/users"</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_users</span>():
    users = user_handle.get_users()
    <span class="hljs-keyword">return</span> Success(data=users)


<span class="hljs-meta">@route.get(<span class="hljs-params"><span class="hljs-string">"/names"</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_names</span>():
    names = [<span class="hljs-string">"Alice"</span>, <span class="hljs-string">"Bob"</span>, <span class="hljs-string">"Charlie"</span>]
    <span class="hljs-keyword">return</span> Success(data=names)


<span class="hljs-meta">@route.get(<span class="hljs-params"><span class="hljs-string">"/item"</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_item</span>():
    item = {<span class="hljs-string">"id"</span>: <span class="hljs-number">101</span>, <span class="hljs-string">"name"</span>: <span class="hljs-string">"Sample Item"</span>, <span class="hljs-string">"price"</span>: <span class="hljs-number">29.99</span>, <span class="hljs-string">"now"</span>: datetime.now()}
    <span class="hljs-keyword">return</span> Success(data=item)


<span class="hljs-meta">@route.get(<span class="hljs-params"><span class="hljs-string">"/error"</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_error</span>():
    <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">"This is a test exception"</span>)

</code></pre>
<p><code>GET /api/users</code> 调用了 <code>handles/</code> 中的代码，模拟查询数据库。<code>handles/user.py</code> 中的代码如下：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> time
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Any</span>, <span class="hljs-type">Dict</span>, <span class="hljs-type">List</span>


<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_users</span>() -&gt; <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]]:
    <span class="hljs-comment"># 模拟查询用户数据</span>
    time.sleep(<span class="hljs-number">0.1</span>)  <span class="hljs-comment"># 模拟延迟</span>
    users = [{<span class="hljs-string">"id"</span>: <span class="hljs-number">1</span>, <span class="hljs-string">"name"</span>: <span class="hljs-string">"Alice"</span>}, {<span class="hljs-string">"id"</span>: <span class="hljs-number">2</span>, <span class="hljs-string">"name"</span>: <span class="hljs-string">"Bob"</span>}]
    <span class="hljs-keyword">return</span> users
</code></pre>
<p>代码文件 <code>apis/common/__init__.py</code> 中导入各个蓝图并统一暴露。由于示例代码只定义了一个蓝图，所以这里写得很简单。如果有多个蓝图，可以把蓝图都添加到一个列表中，在 Flask 应用中一次性遍历注册。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> .common <span class="hljs-keyword">import</span> route
<span class="hljs-comment"># from .common import route as common_route</span>

<span class="hljs-comment"># routes = [</span>
<span class="hljs-comment">#     common_route,</span>
<span class="hljs-comment"># ]</span>

__all__ = [<span class="hljs-string">"route"</span>]
</code></pre>
<p>代码文件 <code>apis/__init__.py</code> 中提供 Flask 应用的工厂函数。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> traceback

<span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask

<span class="hljs-keyword">from</span> apis.common <span class="hljs-keyword">import</span> route <span class="hljs-keyword">as</span> common_route
<span class="hljs-keyword">from</span> middlewares <span class="hljs-keyword">import</span> tracking_id_middleware
<span class="hljs-keyword">from</span> responses <span class="hljs-keyword">import</span> Fail, ResourceNotFound
<span class="hljs-keyword">from</span> pkgs.log <span class="hljs-keyword">import</span> logger



<span class="hljs-comment"># 错误处理器</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">error_handler_notfound</span>(<span class="hljs-params">error</span>):
    <span class="hljs-keyword">return</span> ResourceNotFound()


<span class="hljs-keyword">def</span> <span class="hljs-title function_">error_handler_generic</span>(<span class="hljs-params">error</span>):
    logger.error(traceback.format_exc())
    <span class="hljs-keyword">return</span> Fail(data=<span class="hljs-built_in">str</span>(error))



<span class="hljs-keyword">def</span> <span class="hljs-title function_">create_app</span>() -&gt; Flask:
    app = Flask(__name__)

    <span class="hljs-comment"># 注册中间件</span>
    app = tracking_id_middleware(app)

    <span class="hljs-comment"># 注册错误处理器</span>
    app.errorhandler(Exception)(error_handler_generic)
    app.errorhandler(<span class="hljs-number">404</span>)(error_handler_notfound)

    <span class="hljs-comment"># 注册蓝图</span>
    app.register_blueprint(common_route)

    <span class="hljs-keyword">return</span> app

__all__ = [
    <span class="hljs-string">"create_app"</span>,
]
</code></pre>
<p>入口代码文件 <code>main.py</code></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> apis <span class="hljs-keyword">import</span> create_app

app = create_app()

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    app.run(host=<span class="hljs-string">"127.0.0.1"</span>, port=<span class="hljs-number">8000</span>, debug=<span class="hljs-literal">False</span>)
</code></pre>
<h2 data-id="heading-6">简单运行测试</h2>
<ol>
<li>启动应用</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 方式1, 直接启动, 用于简单测试</span>
python main.py

<span class="hljs-comment"># 方式2, 使用 gunicorn, 这是生产环境启动方式. 配置文件默认路径即 ./gunicorn.conf.py</span>
gunicorn main:app
</code></pre>
<ol start="2">
<li>curl 请求 <code>/api/health</code>。可以看到响应头中已经有了 <code>X-Tracking-ID</code> 和 <code>X-DateTime</code></li>
</ol>
<pre><code class="hljs language-bash" lang="bash">$ curl -v http://127.0.0.1:8000/api/health
*   Trying 127.0.0.1:8000...
* Connected to 127.0.0.1 (127.0.0.1) port 8000
* using HTTP/1.x
&gt; GET /api/health HTTP/1.1
&gt; Host: 127.0.0.1:8000
&gt; User-Agent: curl/8.14.1
&gt; Accept: */*
&gt;
* Request completely sent off
&lt; HTTP/1.1 200 OK
&lt; Server: gunicorn
&lt; Date: Sat, 17 Jan 2026 08:41:07 GMT
&lt; Connection: keep-alive
&lt; Content-Type: application/json
&lt; X-Tracking-ID: 1f0adb8d-9bee-49d4-873f-31aa1437da60
&lt; X-DateTime: 2026-01-17T16:41:07+08:00
&lt; Content-Length: 61
&lt;
* Connection <span class="hljs-comment">#0 to host 127.0.0.1 left intact</span>
{<span class="hljs-string">"code"</span>: 200, <span class="hljs-string">"msg"</span>: <span class="hljs-string">"GET /api/health success"</span>, <span class="hljs-string">"data"</span>: <span class="hljs-string">"OK"</span>}
</code></pre>
<ol start="3">
<li>curl 请求 <code>/api/users</code>。手动指定请求头中的 <code>X-Tracking-ID</code>，响应时也会保持相同的 ID。</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">$ curl -v http://127.0.0.1:8000/api/users -H <span class="hljs-string">'X-Tracking-ID:123456'</span>
*   Trying 127.0.0.1:8000...
* Connected to 127.0.0.1 (127.0.0.1) port 8000
* using HTTP/1.x
&gt; GET /api/users HTTP/1.1
&gt; Host: 127.0.0.1:8000
&gt; User-Agent: curl/8.14.1
&gt; Accept: */*
&gt; X-Tracking-ID:123456
&gt;
* Request completely sent off
&lt; HTTP/1.1 200 OK
&lt; Server: gunicorn
&lt; Date: Sat, 17 Jan 2026 08:44:37 GMT
&lt; Connection: keep-alive
&lt; Content-Type: application/json
&lt; X-Tracking-ID: 123456
&lt; X-DateTime: 2026-01-17T16:44:37+08:00
&lt; Content-Length: 110
&lt;
* Connection <span class="hljs-comment">#0 to host 127.0.0.1 left intact</span>
{<span class="hljs-string">"code"</span>: 200, <span class="hljs-string">"msg"</span>: <span class="hljs-string">"GET /api/users success"</span>, <span class="hljs-string">"data"</span>: [{<span class="hljs-string">"id"</span>: 1, <span class="hljs-string">"name"</span>: <span class="hljs-string">"Alice"</span>}, {<span class="hljs-string">"id"</span>: 2, <span class="hljs-string">"name"</span>: <span class="hljs-string">"Bob"</span>}]}
</code></pre>
<h2 data-id="heading-7">编写单元测试</h2>
<p>使用 pytest 进行单元测试，这里只是一个简单的示例</p>
<h3 data-id="heading-8">配置 pytest</h3>
<p>配置文件 <code>pytest.ini</code></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[pytest]</span>
<span class="hljs-attr">testpaths</span> = <span class="hljs-string">"tests"</span>
<span class="hljs-attr">pythonpath</span> = <span class="hljs-string">"."</span>
</code></pre>
<h3 data-id="heading-9">测试代码</h3>
<p>代码文件 <code>tests/apis/test_common.py</code></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Generator
<span class="hljs-keyword">from</span> unittest.mock <span class="hljs-keyword">import</span> MagicMock, patch

<span class="hljs-keyword">import</span> pytest
<span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask
<span class="hljs-keyword">from</span> flask.testing <span class="hljs-keyword">import</span> FlaskClient

<span class="hljs-keyword">from</span> apis.common <span class="hljs-keyword">import</span> route <span class="hljs-keyword">as</span> common_route


<span class="hljs-meta">@pytest.fixture</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">app</span>() -&gt; Generator[Flask, <span class="hljs-literal">None</span>, <span class="hljs-literal">None</span>]:
    app = Flask(__name__)
    app.config.update(
        {
            <span class="hljs-string">"TESTING"</span>: <span class="hljs-literal">True</span>,
            <span class="hljs-string">"DEBUG"</span>: <span class="hljs-literal">False</span>,
        }
    )
    app.register_blueprint(common_route)
    <span class="hljs-keyword">yield</span> app


<span class="hljs-meta">@pytest.fixture</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">client</span>(<span class="hljs-params">app: Flask</span>) -&gt; FlaskClient:
    <span class="hljs-keyword">return</span> app.test_client()


<span class="hljs-keyword">class</span> <span class="hljs-title class_">TestGetHealth</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_get_health_success</span>(<span class="hljs-params">self, client: FlaskClient</span>) -&gt; <span class="hljs-literal">None</span>:
        resp = client.get(<span class="hljs-string">"/api/health"</span>)
        <span class="hljs-keyword">assert</span> resp.status_code == <span class="hljs-number">200</span>

        resp_headers = resp.headers
        <span class="hljs-keyword">assert</span> resp_headers.get(<span class="hljs-string">"Content-Type"</span>) == <span class="hljs-string">"application/json"</span>
        <span class="hljs-keyword">assert</span> <span class="hljs-string">"X-Tracking-ID"</span> <span class="hljs-keyword">in</span> resp_headers
        <span class="hljs-keyword">assert</span> <span class="hljs-string">"X-DateTime"</span> <span class="hljs-keyword">in</span> resp_headers

        resp_body = resp.json
        <span class="hljs-keyword">assert</span> resp_body == {
            <span class="hljs-string">"code"</span>: <span class="hljs-number">200</span>,
            <span class="hljs-string">"msg"</span>: <span class="hljs-string">"GET /api/health success"</span>,
            <span class="hljs-string">"data"</span>: <span class="hljs-string">"OK"</span>,
        }


<span class="hljs-keyword">class</span> <span class="hljs-title class_">TestGetUsers</span>:
<span class="hljs-meta">    @patch(<span class="hljs-params"><span class="hljs-string">"apis.common.common.user_handle.get_users"</span></span>)</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_get_users</span>(<span class="hljs-params">self, mock_get_users: MagicMock, client: FlaskClient</span>) -&gt; <span class="hljs-literal">None</span>:
        <span class="hljs-comment"># mock user.get_users() 的返回值</span>
        mock_get_users.return_value = [
            {<span class="hljs-string">"id"</span>: <span class="hljs-number">1</span>, <span class="hljs-string">"name"</span>: <span class="hljs-string">"Alice123"</span>},
            {<span class="hljs-string">"id"</span>: <span class="hljs-number">2</span>, <span class="hljs-string">"name"</span>: <span class="hljs-string">"Bob456"</span>},
        ]

        <span class="hljs-comment"># 发送请求</span>
        resp = client.get(<span class="hljs-string">"/api/users"</span>)
        <span class="hljs-keyword">assert</span> resp.status_code == <span class="hljs-number">200</span>

        resp_headers = resp.headers
        <span class="hljs-keyword">assert</span> resp_headers.get(<span class="hljs-string">"Content-Type"</span>) == <span class="hljs-string">"application/json"</span>
        <span class="hljs-keyword">assert</span> <span class="hljs-string">"X-Tracking-ID"</span> <span class="hljs-keyword">in</span> resp_headers
        <span class="hljs-keyword">assert</span> <span class="hljs-string">"X-DateTime"</span> <span class="hljs-keyword">in</span> resp_headers

        <span class="hljs-comment"># resp_body = resp.json</span>

        mock_get_users.assert_called_once()

</code></pre>
<h3 data-id="heading-10">执行测试</h3>
<pre><code class="hljs language-shell" lang="shell">pytest -vv
</code></pre>
<h2 data-id="heading-11">配置 Gunicorn</h2>
<p>代码文件 <code>gunicorn.conf.py</code>。简单配置了一些启动参数，以及请求日志的格式。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># Gunicorn 配置文件</span>
<span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path
<span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> cpu_count
<span class="hljs-keyword">import</span> gunicorn.glogging
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime

<span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomLogger</span>(gunicorn.glogging.Logger):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">atoms</span>(<span class="hljs-params">self, resp, req, environ, request_time</span>):
        <span class="hljs-string">"""
        重写 atoms 方法来自定义日志占位符
        """</span>
        <span class="hljs-comment"># 获取默认的所有占位符数据</span>
        atoms = <span class="hljs-built_in">super</span>().atoms(resp, req, environ, request_time)
        
        <span class="hljs-comment"># 自定义 't' (时间戳) 的格式</span>
        now = datetime.now().astimezone()
        atoms[<span class="hljs-string">'t'</span>] = now.isoformat(timespec=<span class="hljs-string">"seconds"</span>)
        
        <span class="hljs-keyword">return</span> atoms
    

<span class="hljs-comment"># 预加载应用代码</span>
preload_app = <span class="hljs-literal">True</span>

<span class="hljs-comment"># 工作进程数量：通常是 CPU 核心数的 2 倍加 1</span>
<span class="hljs-comment"># workers = int(cpu_count() * 2 + 1)</span>
workers = <span class="hljs-number">2</span>

<span class="hljs-comment"># 使用 gevent 异步 worker 类型，适合 I/O 密集型应用</span>
<span class="hljs-comment"># 注意：gevent worker 不使用 threads 参数，而是使用协程进行并发处理</span>
worker_class = <span class="hljs-string">"gevent"</span>

<span class="hljs-comment"># 每个 gevent worker 可处理的最大并发连接数</span>
worker_connections = <span class="hljs-number">2000</span>

<span class="hljs-comment"># 绑定地址和端口</span>
bind = <span class="hljs-string">"127.0.0.1:8000"</span>

<span class="hljs-comment"># 进程名称</span>
proc_name = <span class="hljs-string">"flask-dev"</span>

<span class="hljs-comment"># PID 文件路径</span>
pidfile = <span class="hljs-built_in">str</span>(Path(__file__).parent / <span class="hljs-string">"tmp"</span> / <span class="hljs-string">"gunicorn.pid"</span>)

logger_class = CustomLogger
access_log_format = (
    <span class="hljs-string">'{"@timestamp": "%(t)s", '</span>
    <span class="hljs-string">'"remote_addr": "%(h)s", '</span>
    <span class="hljs-string">'"protocol": "%(H)s", '</span>
    <span class="hljs-string">'"host": "%({host}i)s", '</span>
    <span class="hljs-string">'"request_method": "%(m)s", '</span>
    <span class="hljs-string">'"request_path": "%(U)s", '</span>
    <span class="hljs-string">'"status_code": %(s)s, '</span>
    <span class="hljs-string">'"response_length": %(b)s, '</span>
    <span class="hljs-string">'"referer": "%(f)s", '</span>
    <span class="hljs-string">'"user_agent": "%(a)s", '</span>
    <span class="hljs-string">'"x_tracking_id": "%({x-tracking-id}i)s", '</span>
    <span class="hljs-string">'"request_time": %(L)s}'</span>
)

<span class="hljs-comment"># 访问日志路径</span>
accesslog = <span class="hljs-built_in">str</span>(Path(__file__).parent / <span class="hljs-string">"logs"</span> / <span class="hljs-string">"access.log"</span>)

<span class="hljs-comment"># 错误日志路径</span>
errorlog = <span class="hljs-built_in">str</span>(Path(__file__).parent / <span class="hljs-string">"logs"</span> / <span class="hljs-string">"error.log"</span>)

<span class="hljs-comment"># 日志级别</span>
loglevel = <span class="hljs-string">"debug"</span>
</code></pre>
<p>输出的日志格式。可以看到日志格式符合 JSON 规范，便于 Filebeat 收集后在 Kibana 上检索。</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">$ </span><span class="bash"><span class="hljs-built_in">tail</span> -n 1 logs/access.log | python3 -m json.tool</span>
{
    "@timestamp": "2026-01-17T16:44:37+08:00",
    "remote_addr": "127.0.0.1",
    "protocol": "HTTP/1.1",
    "host": "127.0.0.1:8000",
    "request_method": "GET",
    "request_path": "/api/users",
    "status_code": 200,
    "response_length": 110,
    "referer": "-",
    "user_agent": "curl/8.14.1",
    "x_tracking_id": "123456",
    "request_time": 0.102042
}
</code></pre>
<h2 data-id="heading-12">补充</h2>
<h3 data-id="heading-13">全局对象 g 的注意事项</h3>
<ol>
<li><code>g</code> 不是进程或线程共享的全局变量，请只在请求处理流程中使用 <code>g</code>。</li>
<li>如果视图函数中启动了后台线程或异步任务，在子线程中直接访问 <code>g</code> 通常会报错或获取不到数据。这时建议显式传递数据。</li>
<li>不要在 <code>g</code> 中存储大文件或数据对象，否则会占用过高内存。</li>
<li><code>g</code> 不是 <code>session</code>。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一周之内，五家公司用行动画出了AI的未来地图]]></title>    <link>https://juejin.cn/post/7595890117865537582</link>    <guid>https://juejin.cn/post/7595890117865537582</guid>    <pubDate>2026-01-17T10:16:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595890117865537582" data-draft-id="7595808703074648090" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一周之内，五家公司用行动画出了AI的未来地图"/> <meta itemprop="keywords" content="前端,后端,JavaScript"/> <meta itemprop="datePublished" content="2026-01-17T10:16:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="摸鱼的春哥"/> <meta itemprop="url" content="https://juejin.cn/user/1714893870865303"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一周之内，五家公司用行动画出了AI的未来地图
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1714893870865303/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    摸鱼的春哥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T10:16:24.000Z" title="Sat Jan 17 2026 10:16:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>过去这一周，科技圈的几个大动作，单独看都是新闻，连起来看，就是一张正在快速成型的未来地图。</p>
<p>地图的一角，微软发出警告，说中国AI正在新兴市场成为默认选择。另一角，苹果正式宣布，下一代Siri的核心将交给谷歌的Gemini来驱动。与此同时，Anthropic让Claude变成了能直接操作你电脑文件的“数字员工”。</p>
<p>这些事发生在不同公司、不同领域，但指向同一个方向：AI竞赛已经结束了实验室炫技阶段，进入了拼生态、抢入口、定标准的实战环节。</p>
<h2 data-id="heading-0">微软的警告，关于另一种游戏规则</h2>
<p>微软这份报告，分量很重。它不是什么分析师的观点，而是这家深度绑定OpenAI、运营着全球顶级云服务、天天看着全球数据流的巨头，在陈述一个它观察到的事实。</p>
<p>微软说，在高端企业市场、云基础设施这块，西方公司依然领先。但出了西方世界，游戏规则变了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fb0d49d07083458dada20089402ed53d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pG46bG855qE5pil5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769249784&amp;x-signature=MlYYpFJcIcUhsazrRktWd0ijDtA%3D" alt="" loading="lazy"/></p>
<p>中国AI生态推的模型，更便宜，更容易获取，很多还是开源或接近开源的。在非洲、东欧、拉丁美洲这些地方，企业问的第一个问题往往不是“哪个模型最强大”，而是“哪个我们用得起、部署得了、维护得了”。</p>
<p>微软点名了深度求索这类公司，说它们的模型在这些区域用量很大，有时甚至超过了西方产品。</p>
<p>这件事的关键在于，一旦用上了，就容易形成生态锁定。开发者、初创公司、大学习惯了用某一套工具链，未来几年都会沿着这条路走下去。早期的互联网协议、移动操作系统、云服务商，都是这么过来的。</p>
<p>所以微软的警告其实是，在西方市场之外，中国AI可能正在因为“便宜好用”而成为默认选项。这背后是一整套国家支持、基建投入和快速规模化能力的协同。西方面对的，不是一个对手，而是一个高度协调、能快速铺开的生态系统。</p>
<p>对微软、谷歌、亚马逊这些公司来说，新兴市场不是锦上添花，而是未来的增长引擎。如果在那里失去影响，失去的不仅是客户，还有数据飞轮、开发者生态，最终是市场份额。</p>
<h2 data-id="heading-1">苹果的选择，与生态的合纵连横</h2>
<p>就在微软描绘全球竞争图景时，苹果用行动展示了竞争的另一面：合纵连横。</p>
<p>苹果官方宣布，和谷歌达成一项多年期合作。谷歌的Gemini模型和云技术，将成为苹果下一代基础模型和未来“苹果智能”功能的基石。预计2026年，我们会看到一个由Gemini驱动的全新Siri。</p>
<p>苹果的说法很值得玩味。他们说，经过仔细评估，认为谷歌的AI提供了“能力最强的基础”。以苹果的挑剔，这算是很高的评价了。</p>
<p>更关键的是，苹果并没有因此踢掉OpenAI。他们告诉媒体，之前将ChatGPT集成到Siri和苹果智能中的协议不变。Gemini是来驱动基础模型和下一代Siri核心能力的，而OpenAI则处理某些特定类型的复杂查询。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/41bf68db613643c7af6571fa9bb62401~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pG46bG855qE5pil5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769249784&amp;x-signature=Woj4d77HWrwxYapNn0fGF4ktNCs%3D" alt="" loading="lazy"/>
苹果本质上是在Siri内部构建一个AI路由系统。它想保持自己隐私、本地处理、严格控制的一贯身份，但在底层模型上，它选择依靠谷歌的堆栈，同时也不排斥接入其他强者。</p>
<p>这个决定的背景很有意思。谷歌母公司Alphabet的市值刚超过苹果，这是2019年以来的第一次。同时，谷歌和苹果之间那个著名的搜索默认协议，正因垄断问题被美国法院审视。</p>
<p>但即便在这种压力下，谷歌依然通过AI，把自己的触角更深地伸进了苹果生态。Siri每天在超过20亿台活跃设备上处理10亿次请求，这个分发渠道是谷歌靠自己永远无法复制的。</p>
<p>苹果评估过Anthropic，最终选了谷歌。有消息说，财务条款是重要考量。这不再是功能合作，而是基础设施层面的绑定。AI竞赛，已经进入了巨头结盟的新阶段。</p>
<h2 data-id="heading-2">从桌面到现实，AI代理开始动手</h2>
<p>当巨头们在云端结盟时，AI也在变得更具体、更“动手”。</p>
<p>Anthropic给Claude推出了一个叫“CoWork”的功能，目前是研究预览版，只给Mac版Claude的订阅用户。这个功能很简单，你授权Claude访问你Mac上的某个文件夹，之后它就能直接在里面读取、编辑、创建文件。</p>
<p>这听起来简单，但区别巨大。聊天助手是给你建议，而代理是直接触碰你的资产并产出结果。CoWork设计用来处理多步骤项目，比如整理文件、从图片里提取数据、把零散的笔记生成报告。你可以实时反馈，它还能通过连接器调用外部数据或控制浏览器工作流。</p>
<p>风险是显然的，所以Anthropic强调了安全控制。用户决定Claude能访问哪些文件夹，在删除文件这类重大操作前，助手会请求许可。他们甚至提到了“提示词注入”风险——恶意文档或网页可能嵌入指令，试图劫持代理。目前这功能还限于美国区的macOS。</p>
<p>另一家公司Manus，则瞄准了比电脑桌面更普遍的场景：现实中的对话。他们推出了“会议纪要”功能，专门针对线下面对面会议、访谈，而不是线上会议。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d63c64dd401b492d92a39e58033294f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pG46bG855qE5pil5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769249784&amp;x-signature=WK9tfqhxXppQ26GTdwdunZvG6HY%3D" alt="" loading="lazy"/>
它实时录音，然后产出结构化内容：摘要、发言人识别、参会者列表、可执行任务。两个细节很关键，一是支持离线录音，网络断了也不影响，二是能尝试识别谁说了什么，以便把任务项准确分配给人。</p>
<p>Manus还想把“说到做到”的闭环打通，它能直接从会议笔记在同一个工作流里生成交付物，比如演示文稿、网站或社交媒体素材。商业模式是积分制，录音免费，但分析和结构化输出要花积分。价值显然在“思考”部分，而不只是记录。</p>
<h2 data-id="heading-3">机器人学会“预演”，谷歌想定义AI购物</h2>
<p>从虚拟代理到实体机器人，逻辑是相通的。机器人公司1X将其新的视频预训练世界模型集成到了Neo机器人平台。</p>
<p>传统机器人训练往往依赖海量的机器人演示数据，让机器人反复做动作，慢且贵。1X的新方法，结合了互联网视频和“自我中心”的人类与机器人数据。自我中心数据，就是第一人称视角。</p>
<p>这个模型通过生成文本条件下的视频推演来预测机器人动作，然后再通过逆向动力学把视频转换成运动指令。简单说，AI不仅在看，还在预测“做什么动作会导致什么视觉结果”，然后据此控制身体。</p>
<p>目前每次推演推理大约需要11秒，这说明技术还没到瞬间自主反应的级别。但好处是泛化能力更强，对于训练数据里没有的新物体和新动作，处理得更好。内部测试显示，它在双手协调、复杂物体操控等任务上，成功率匹配或超过了以前的模型。</p>
<p>最后，是谷歌可能埋下的一个最深的基础设施。它正式宣布进入“AI商务”阶段，核心是推出“通用商务协议”。</p>
<p>这是一个新的开放标准，旨在为AI代理、商家和支付系统之间的交互提供通用语言。谷歌与Shopify、沃尔玛、Target、eBay等大公司合作开发。它兼容现有的其他协议，这意味着它能接入现有生态，而不是推倒重来。</p>
<p>一个最直接的应用，就是用户在美国可以通过谷歌的AI搜索模式和Gemini应用，直接购买合作零售商的商品，使用谷歌钱包或PayPal支付。零售商依然是销售主体，保留定制集成的能力。</p>
<p>谷歌还在推出“商务代理”，让品牌能在搜索结果中直接以虚拟购物助手的形态与顾客互动，用品牌自己的风格回答问题。第一阶段包括劳氏、锐步等品牌。</p>
<p>谷歌做的，是在协议层尝试标准化AI购物，把它嵌入Gemini和AI搜索，并给商家在搜索结果里提供代理界面。这是基础设施级别的布局。</p>
<h2 data-id="heading-4">所以，未来是什么样</h2>
<p>把这些碎片拼起来，画面就清晰了。</p>
<p><strong>竞争是全球化的，但打法分成了两种。</strong> 一种是以微软报告为代表的观察：在高端市场之外，性价比和可获取性正在成为决定性因素，催生新的生态主导者。</p>
<p><strong>联盟是必然的，没有全能选手。</strong> 强如苹果，也需要在底层模型上依靠谷歌，并接入OpenAI。未来的AI服务，很可能是一个由多家供应商模型驱动的混合体，关键在于谁能做好路由和整合。</p>
<p><strong>AI正在从“说”走向“做”。</strong> 无论是操作你的电脑文件，处理线下会议，控制机器人手臂，还是帮你完成购物，AI代理开始拥有执行权。这带来了巨大的便利，也带来了全新的安全和伦理挑战。</p>
<p><strong>标准协议是隐藏的战场。</strong> 谷歌推通用商务协议，是想在AI代理如何与商业世界交互这个根本问题上，定义规则。谁定义了协议，谁就掌握了生态的枢纽位置。</p>
<p>我们正在经历的，不是单个产品的升级，而是一整个数字世界运行规则的迁移。AI正在从一项技术，变成我们与所有机器、所有信息、所有商业活动交互的新界面。</p>
<p>这个界面如何工作，由谁定义，又将被谁主导，就是未来十年科技竞争的核心故事。故事才刚刚翻开第一章。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[回顾浮动布局]]></title>    <link>https://juejin.cn/post/7595859552347963444</link>    <guid>https://juejin.cn/post/7595859552347963444</guid>    <pubDate>2026-01-17T07:50:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595859552347963444" data-draft-id="7595871887000813568" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="回顾浮动布局"/> <meta itemprop="keywords" content="CSS,面试,前端"/> <meta itemprop="datePublished" content="2026-01-17T07:50:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="进击的明明"/> <meta itemprop="url" content="https://juejin.cn/user/1159300977801081"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            回顾浮动布局
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1159300977801081/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    进击的明明
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T07:50:18.000Z" title="Sat Jan 17 2026 07:50:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言</h2>
<p>在现代 Web 开发中，虽然 Flexbox 和 Grid 已成为主流布局方案，但 <strong>CSS 浮动（float）</strong>  作为早期实现网页多列布局的核心技术，仍然具有重要的历史地位和实用价值。尤其在处理图文混排、旧项目维护或兼容性要求较高的场景中，掌握浮动布局依然是前端开发者的必备技能。</p>
<p>本文将从原理、行为、常见问题及解决方案等方面，系统讲解 CSS 浮动布局。</p>
<hr/>
<h2 data-id="heading-1">一、什么是浮动（Float）？</h2>
<p><code>float</code> 是 CSS 中的一个属性，最初设计用于实现<strong>文本环绕图片</strong>的效果。其基本语法如下：</p>
<pre><code class="hljs language-sql" lang="sql">element {
  <span class="hljs-type">float</span>: <span class="hljs-keyword">left</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">right</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">none</span> <span class="hljs-operator">|</span> inherit;
}
</code></pre>
<ul>
<li><code>left</code>：元素向左浮动；</li>
<li><code>right</code>：元素向右浮动；</li>
<li><code>none</code>（默认值）：元素不浮动；</li>
<li><code>inherit</code>：继承父元素的浮动设置。</li>
</ul>
<h3 data-id="heading-2">示例：基础浮动</h3>
<pre><code class="hljs language-css" lang="css">&lt;<span class="hljs-selector-tag">img</span> <span class="hljs-attribute">src</span>="example<span class="hljs-selector-class">.jpg</span>" style="<span class="hljs-attribute">float</span>: left; <span class="hljs-attribute">margin</span>: <span class="hljs-number">10px</span>;"&gt;
&lt;<span class="hljs-selector-tag">p</span>&gt;这是一段文字，会环绕在图片右侧……&lt;/<span class="hljs-selector-tag">p</span>&gt;
</code></pre>
<p>在这个例子中，图片脱离了正常文档流并向左浮动，文字则围绕在其右侧流动。</p>
<hr/>
<h2 data-id="heading-3">二、浮动的核心行为</h2>
<p>要真正掌握浮动，必须理解它的三个关键特性：</p>
<h3 data-id="heading-4">1. 脱离正常文档流（但仍在页面中）</h3>
<p>浮动元素会<strong>脱离块级格式化上下文（BFC）中的正常流</strong>，不再占据原来的空间（对后续块级元素而言），但<strong>仍会影响行内内容的排布</strong>（如文字环绕）。</p>
<blockquote>
<p>注意：浮动元素并未完全“消失”，它依然存在于渲染树中，并参与布局计算。</p>
</blockquote>
<h3 data-id="heading-5">2. 向左/右尽可能靠边</h3>
<p>浮动元素会向指定方向移动，直到碰到<strong>包含块的边界</strong>或<strong>另一个浮动元素</strong>为止。</p>
<h3 data-id="heading-6">3. 块级元素“坍塌”问题</h3>
<p>当一个容器内的所有子元素都浮动时，该容器<strong>高度会变为 0</strong>（即“高度坍塌”）。这是因为浮动元素脱离了正常流，父容器无法感知其高度。</p>
<pre><code class="hljs language-css" lang="css">&lt;<span class="hljs-selector-tag">div</span> class="container"&gt;
  &lt;<span class="hljs-selector-tag">div</span> style="<span class="hljs-attribute">float</span>: left; <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>; <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>; <span class="hljs-attribute">background</span>: red;"&gt;&lt;/<span class="hljs-selector-tag">div</span>&gt;
  &lt;<span class="hljs-selector-tag">div</span> style="<span class="hljs-attribute">float</span>: left; <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>; <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>; <span class="hljs-attribute">background</span>: blue;"&gt;&lt;/<span class="hljs-selector-tag">div</span>&gt;
&lt;/<span class="hljs-selector-tag">div</span>&gt;
&lt;!-- <span class="hljs-selector-class">.container</span> 高度为 <span class="hljs-number">0</span> --&gt;
</code></pre>
<p>这个问题需要通过<strong>清除浮动（Clearfix）</strong>  来解决。</p>
<hr/>
<h2 data-id="heading-7">三、清除浮动（Clearing Floats）</h2>
<p>为了解决父容器高度坍塌的问题，我们需要“清除浮动”。常用方法有：</p>
<h3 data-id="heading-8">方法 1：使用 <code>clear</code> 属性</h3>
<p><code>clear: both</code> 是 CSS 中用于<strong>控制元素与浮动元素之间关系</strong>的一个属性值，它的作用是：<strong>强制该元素不与任何左侧或右侧的浮动元素处于同一行</strong>，即“清除浮动”的影响。</p>
<p>在浮动元素后添加一个空元素并设置 <code>clear: both</code>：</p>
<pre><code class="hljs language-css" lang="css">&lt;<span class="hljs-selector-tag">div</span> class="container"&gt;
  &lt;<span class="hljs-selector-tag">div</span> style="<span class="hljs-attribute">float</span>: left;"&gt;<span class="hljs-selector-tag">A</span>&lt;/<span class="hljs-selector-tag">div</span>&gt;
  &lt;<span class="hljs-selector-tag">div</span> style="<span class="hljs-attribute">float</span>: left;"&gt;<span class="hljs-selector-tag">B</span>&lt;/<span class="hljs-selector-tag">div</span>&gt;
  &lt;<span class="hljs-selector-tag">div</span> style="<span class="hljs-attribute">clear</span>: both;"&gt;&lt;/<span class="hljs-selector-tag">div</span>&gt;
&lt;/<span class="hljs-selector-tag">div</span>&gt;
</code></pre>
<blockquote>
<p>缺点：引入无语义的 HTML 元素。</p>
</blockquote>
<h3 data-id="heading-9">方法 2：使用伪元素（推荐 —— Clearfix 技巧）</h3>
<pre><code class="hljs language-css" lang="css">clearfix<span class="hljs-selector-pseudo">::after</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-string">""</span>;
  <span class="hljs-attribute">display</span>: table;
  <span class="hljs-attribute">clear</span>: both;
}
</code></pre>
<pre><code class="hljs language-css" lang="css">&lt;<span class="hljs-selector-tag">div</span> class="container clearfix"&gt;
  &lt;<span class="hljs-selector-tag">div</span> style="<span class="hljs-attribute">float</span>: left;"&gt;<span class="hljs-selector-tag">A</span>&lt;/<span class="hljs-selector-tag">div</span>&gt;
  &lt;<span class="hljs-selector-tag">div</span> style="<span class="hljs-attribute">float</span>: left;"&gt;<span class="hljs-selector-tag">B</span>&lt;/<span class="hljs-selector-tag">div</span>&gt;
&lt;/<span class="hljs-selector-tag">div</span>&gt;
</code></pre>
<p>这是最经典的 <strong>clearfix</strong> 解决方案，兼容性好且语义清晰。</p>
<h3 data-id="heading-10">方法 3：触发 BFC（Block Formatting Context）</h3>
<p>让父容器形成一个新的 BFC，使其能包含浮动子元素。常见方式包括：</p>
<ul>
<li><code>overflow: hidden</code> / <code>auto</code></li>
<li><code>display: flow-root</code>（现代浏览器）</li>
<li><code>float: left/right</code></li>
<li><code>position: absolute/fixed</code></li>
</ul>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">overflow</span>: hidden; <span class="hljs-comment">/* 触发 BFC */</span>
}
</code></pre>
<blockquote>
<p>推荐在现代项目中使用 <code>display: flow-root</code>，它专为解决此问题而生，且不会带来副作用（如裁剪内容）。</p>
</blockquote>
<hr/>
<h2 data-id="heading-11">四、浮动布局的典型应用场景</h2>
<p>尽管 Flex/Grid 更强大，但浮动仍有其用武之地：</p>
<h3 data-id="heading-12">1. 图文混排</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">img</span> {
  <span class="hljs-attribute">float</span>: left;
  <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">15px</span>;
}
</code></pre>
<p>这是浮动最初的设计目的，至今仍非常高效。</p>
<h3 data-id="heading-13">2. 简单的多列布局（旧项目）</h3>
<p>在 Flexbox 出现前，开发者常通过浮动实现两栏或三栏布局：</p>
<pre><code class="hljs language-css" lang="css">sidebar { <span class="hljs-attribute">float</span>: left; <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>; }
<span class="hljs-selector-tag">main</span> { <span class="hljs-attribute">float</span>: right; <span class="hljs-attribute">width</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-number">100%</span> - <span class="hljs-number">200px</span>); }
</code></pre>
<blockquote>
<p>注意：需处理清除浮动和响应式适配。</p>
</blockquote>
<h3 data-id="heading-14">3. 列表项横向排列（如导航菜单）</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">nav</span> <span class="hljs-selector-tag">li</span> {
  <span class="hljs-attribute">float</span>: left;
  <span class="hljs-attribute">list-style</span>: none;
}
<span class="hljs-selector-tag">nav</span><span class="hljs-selector-pseudo">::after</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-string">""</span>;
  <span class="hljs-attribute">display</span>: table;
  <span class="hljs-attribute">clear</span>: both;
}
</code></pre>
<hr/>
<h2 data-id="heading-15">五、浮动的局限性与替代方案</h2>
<h3 data-id="heading-16">局限性：</h3>
<ul>
<li>容易引发高度坍塌；</li>
<li>布局逻辑复杂，调试困难；</li>
<li>不支持垂直居中、等高列等常见需求；</li>
<li>响应式适配能力弱。</li>
</ul>
<h3 data-id="heading-17">现代替代方案：</h3>

























<table><thead><tr><th>需求</th><th>推荐方案</th></tr></thead><tbody><tr><td>多列布局</td><td>CSS Grid</td></tr><tr><td>单行/单列弹性布局</td><td>Flexbox</td></tr><tr><td>图文环绕</td><td>仍可用 <code>float</code>，或结合 <code>shape-outside</code></td></tr><tr><td>容器包含浮动子元素</td><td><code>display: flow-root</code></td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端路由不再难：React Router 从入门到工程化]]></title>    <link>https://juejin.cn/post/7595911076014112804</link>    <guid>https://juejin.cn/post/7595911076014112804</guid>    <pubDate>2026-01-17T08:05:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595911076014112804" data-draft-id="7595911076014096420" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端路由不再难：React Router 从入门到工程化"/> <meta itemprop="keywords" content="React.js,前端框架,前端"/> <meta itemprop="datePublished" content="2026-01-17T08:05:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="xhxxx"/> <meta itemprop="url" content="https://juejin.cn/user/3235201610941578"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端路由不再难：React Router 从入门到工程化
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3235201610941578/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    xhxxx
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T08:05:49.000Z" title="Sat Jan 17 2026 08:05:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">掌握 React Router：从基础到工程化实践</h2>
<h3 data-id="heading-1">前端路由：从页面跳转到体验升级</h3>
<p>在 Web 开发的早期，前端只是“静态页面的搬运工”——所有跳转逻辑由后端掌控，每次点击链接都会触发一次完整的页面刷新。用户看到的是白屏、等待、再加载；开发者面对的是耦合、重复和低效。</p>
<p>随着前后端分离架构的普及，前端不再只是展示层，而是逐渐承担起完整的应用逻辑。<strong>路由，也由此从前端的“盲区”变成了核心能力之一</strong>。</p>
<p>今天，借助像 React Router 这样的工具，我们可以在不刷新页面的前提下，实现 URL 与 UI 的精准同步，构建真正意义上的单页应用（SPA）——既保持了 URL 的可分享性与书签能力，又带来了接近原生应用的流畅体验。</p>
<p>而这一切，都始于一个简单的映射关系：<br/>
<strong>路径（URL） → 组件（View）</strong> 。</p>
<p>接下来，我们将深入 React Router DOM，从安装配置到高级用法，一步步揭开前端路由的面纱。</p>
<h3 data-id="heading-2">React Router DOM</h3>
<p>不同框架的路由实现虽然不同，但基本原理是相似的。这里我们以 React 路由为例，带你了解路由的魅力。</p>
<p>传统的 Web 开发是多页应用，基于 HTTP 请求实现。每当请求新的 URL 时，页面都会完全刷新，导致瞬间白屏，体验较差。</p>
<h4 data-id="heading-3">单页应用 (SPA)</h4>
<p>得益于路由的出现，我们能够实现单页应用（SPA）。当用户点击链接跳转时，只触发对应的事件并更新局部视图，而不是重新渲染整个页面，从而提供流畅的用户体验。</p>
<h4 data-id="heading-4">安装路由</h4>
<pre><code class="hljs language-bash" lang="bash">npm install react-router-dom
</code></pre>
<p><strong>路由表示的就是路径和组件的映射关系</strong></p>
<h4 data-id="heading-5">路由的使用</h4>
<h5 data-id="heading-6">1. 引入路由</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BrowserRouter</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">Router</span>, <span class="hljs-title class_">Route</span>, <span class="hljs-title class_">Routes</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-router-dom'</span>;
</code></pre>
<h5 data-id="heading-7">2. 路由的模式</h5>
<ul>
<li><strong>HashRouter</strong> (<code>#/</code>)
<ul>
<li>URL 带有 <code>#</code> 号。</li>
<li>兼容性极好，通常在路径之后会自动加上 <code>#/</code>。</li>
</ul>
</li>
<li><strong>BrowserRouter</strong> (<code>/</code>)
<ul>
<li>URL 和后端路由一致，基于 HTML5 History API。</li>
<li>兼容性较好（IE11 之前不支持），现代浏览器几乎都支持。</li>
<li><strong>推荐</strong>：现代开发中更推荐使用 <code>BrowserRouter</code>。</li>
<li><strong>注意</strong>：<code>BrowserRouter as Router</code> 是为了提高可读性，后续统一使用 <code>Router</code> 命名。</li>
</ul>
</li>
</ul>
<h5 data-id="heading-8">3. 核心组件</h5>
<ul>
<li><strong>Routes</strong>：路由容器，负责管理一组路由，通常包裹在 <code>Router</code> 组件中。</li>
<li><strong>Route</strong>：定义单个路由规则，当路径匹配时渲染对应的组件。</li>
</ul>
<h4 data-id="heading-9">路由的配置</h4>
<p>在现代的开发目录中，我们通常将路由的配置都放在 <code>router</code> 目录下。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BrowserRouter</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">Router</span>, <span class="hljs-title class_">Route</span>, <span class="hljs-title class_">Routes</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-router-dom'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Home</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./Home'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">About</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./About'</span>;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Router</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Routes</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">Home</span> /&gt;</span>} /&gt;
      <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/about"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">About</span> /&gt;</span>} /&gt;
    <span class="hljs-tag">&lt;/<span class="hljs-name">Routes</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Router</span>&gt;</span></span>
</code></pre>
<p><strong>配置说明</strong>：</p>
<ul>
<li><code>/</code> 对应 <code>Home</code> 组件</li>
<li><code>/about</code> 对应 <code>About</code> 组件</li>
</ul>
<p>当用户访问 <code>/</code> 时，会渲染 <code>Home</code> 组件；当访问 <code>/about</code> 时，会渲染 <code>About</code> 组件。</p>
<h4 data-id="heading-10">路由导航</h4>
<p>在 SPA 中，我们不能使用 <code>&lt;a&gt;</code> 标签进行导航，因为它会导致页面的刷新。我们需要使用 React Router 提供的 <code>Link</code> 组件。</p>
<p>当用户点击 <code>Link</code> 组件时，会触发路由的导航，而不会导致页面刷新。我们需要在 <code>Link</code> 组件中指定 <code>to</code> 属性，来指定跳转的路径。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Link</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-router-dom'</span>;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/"</span>&gt;</span>Home<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span></span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/about"</span>&gt;</span>About<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span></span>
</code></pre>
<p>点击对应的链接就会跳转到对应的页面。</p>
<hr/>
<h4 data-id="heading-11">路由的种类</h4>
<h5 data-id="heading-12">1. 普通路由</h5>
<p>最基本的路由，当路径匹配时，会渲染对应的组件。
例如：<code>about</code> 对应 <code>About</code> 组件。</p>
<pre><code class="hljs language-jsx" lang="jsx"> &lt;<span class="hljs-title class_">Route</span> path=<span class="hljs-string">"/about"</span> element={<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">About</span> /&gt;</span></span>} /&gt;
</code></pre>
<h5 data-id="heading-13">2. 动态路由</h5>
<p>路径中包含动态参数。</p>
<pre><code class="hljs language-jsx" lang="jsx">&lt;<span class="hljs-title class_">Route</span> path=<span class="hljs-string">"/user/:id"</span> element={<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">UserProfile</span> /&gt;</span></span>} /&gt;
</code></pre>
<p>动态路由当路径匹配时，会渲染对应的组件，并且会将路径中的参数传递给组件。
例如：<code>/user/123</code> 对应 <code>UserProfile</code> 组件，并且会将 <code>123</code> 传递给 <code>UserProfile</code> 组件。</p>
<p>在 <code>UserProfile</code> 组件中，我们可以通过 <code>useParams</code> hook 来获取路由参数：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> { useParams } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-router-dom'</span>;
<span class="hljs-keyword">const</span> { id } = <span class="hljs-title function_">useParams</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(id); <span class="hljs-comment">// 123</span>
</code></pre>
<h5 data-id="heading-14">3. 嵌套路由</h5>
<pre><code class="hljs language-jsx" lang="jsx">&lt;<span class="hljs-title class_">Route</span> path=<span class="hljs-string">"/products"</span> element={<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Product</span>/&gt;</span></span>}&gt;
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">":productId"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">ProductDetail</span> /&gt;</span>}/&gt;</span>
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"new"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">NewProduct</span> /&gt;</span>}/&gt;</span>
&lt;/<span class="hljs-title class_">Route</span>&gt;
</code></pre>
<p>嵌套路由是局部更新的一种典型。当用户访问到产品页面时，点击产品列表中的不同按钮（例如产品详情和新产品），会渲染对应的子组件，而不会导致整个页面的刷新。
这样的路径配置是基于 <code>/products</code> 继续匹配的。</p>
<p>在 <code>Product</code> 组件中，我们可以通过 <code>Outlet</code> 组件来渲染嵌套路由的内容。
例如：<code>/products/123</code> 对应 <code>ProductDetail</code> 组件，并且会将 <code>123</code> 传递给 <code>ProductDetail</code> 组件。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span>{
    <span class="hljs-title class_">Outlet</span>
} <span class="hljs-keyword">from</span> <span class="hljs-string">'react-router-dom'</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Product</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>产品列表<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Outlet</span> /&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  )
}
</code></pre>
<h5 data-id="heading-15">4. 重定向路由</h5>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> {
  <span class="hljs-title class_">Routes</span>, 
  <span class="hljs-title class_">Route</span>,
  <span class="hljs-title class_">Navigate</span>
} <span class="hljs-keyword">from</span> <span class="hljs-string">'react-router-dom'</span>

&lt;<span class="hljs-title class_">Route</span> path=<span class="hljs-string">"/old-path"</span> element={<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Navigate</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/new-path"</span> /&gt;</span></span>} /&gt;
</code></pre>
<p>当一个网站可能已经废弃或者不再更新资源，但用户依然访问旧路径时，我们通常就需要使用重定向路由帮助用户进行导航。
引入 <code>Navigate</code>，当用户访问 <code>/old-path</code> 时，会自动跳转到 <code>/new-path</code>。默认是使用 <code>replace</code> 模式，不会保留旧的历史记录。</p>
<p>如果我们想要保留旧的历史记录，可以设置 <code>replace</code> 属性为 <code>false</code>：</p>
<pre><code class="hljs language-jsx" lang="jsx">&lt;<span class="hljs-title class_">Route</span> path=<span class="hljs-string">"/old-path"</span> element={<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Navigate</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/new-path"</span> <span class="hljs-attr">replace</span>=<span class="hljs-string">{false}</span> /&gt;</span></span>} /&gt;
</code></pre>
<h5 data-id="heading-16">5. 鉴权路由 (路由守卫)</h5>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">ProtectRoute</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./ProtectRoute'</span>;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">'/pay'</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>
   &lt;<span class="hljs-attr">ProtectRoute</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Pay</span> /&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-name">ProtectRoute</span>&gt;</span>
}/&gt;</span>
</code></pre>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">//protectRoute.jsx</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Navigate</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-router-dom'</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ProductRoute</span>(<span class="hljs-params">{children}</span>) {
    <span class="hljs-keyword">const</span> isLoggedIn = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'isLogin'</span>)===<span class="hljs-string">'true'</span>
    <span class="hljs-keyword">if</span>(!isLoggedIn){
        <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Navigate</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/login"</span> /&gt;</span></span>
    }
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      {children}
    <span class="hljs-tag">&lt;/&gt;</span></span>
  )
}
</code></pre>
<p>鉴权路由也叫路由守卫，只有当满足条件时才能够放行。就像很多软件，你不登录就无法使用很多功能；当你想要付款时，如果没有登录，它就会自动弹出登录页。
使用一个组件来包裹需要鉴权的路由，当用户访问到这个路由时，会先判断是否登录。如果没有登录，就会跳转到登录页，否则就会渲染对应的组件。</p>
<h5 data-id="heading-17">6. 404 路由</h5>
<pre><code class="hljs language-jsx" lang="jsx">&lt;<span class="hljs-title class_">Route</span> path=<span class="hljs-string">"*"</span> element={<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">NotFound</span> /&gt;</span></span>} /&gt;
</code></pre>
<p><code>*</code> 代表除配置外的所有路由。
当用户访问到一个不存在的路由时，会渲染 <code>NotFound</code> 组件。</p>
<hr/>
<h4 data-id="heading-18">性能优化</h4>
<h5 data-id="heading-19">路由的懒加载</h5>
<p>在现代前端框架（如 React、Vue 等）中，<strong>路由的懒加载 (Lazy Loading)</strong> 是一种优化应用性能的重要手段。它允许你按需加载组件，而不是在应用初始加载时一次性加载所有路由组件，从而减小首屏 bundle 体积、加快页面加载速度。</p>
<p>例如当你打开应用首页时，你会看见很多功能按钮，但是如果要在首次进入时把这些按钮对应的所有组件一次性全部加载，这无疑是很糟糕的。这样不仅仅卡顿，还会增加首屏加载时间，甚至有些组件你都不使用，它却被加载了，这是非常浪费资源的。</p>
<p>而懒加载就很好地处理了这个问题。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// 传统的引入</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Home</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./Home'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">About</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./About'</span>;

<span class="hljs-comment">// 懒加载引入</span>
<span class="hljs-keyword">import</span> { lazy } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Home</span> = <span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./Home'</span>));
<span class="hljs-keyword">const</span> <span class="hljs-title class_">About</span> = <span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./About'</span>));
</code></pre>
<p>当然了，所有懒加载的组件都需要在 <code>Suspense</code> 组件中包裹起来，否则会报错。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Suspense</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">div</span>&gt;</span>Loading...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}&gt;
   <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">Home</span> /&gt;</span>} /&gt;
   <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/about"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">About</span> /&gt;</span>} /&gt;
<span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span></span>
</code></pre>
<p>当 <code>Home</code> 和 <code>About</code> 组件被加载时，会显示 <code>Loading...</code>，当加载完成后，会显示对应的组件。
当我们访问 <code>/</code> 时，会显示 <code>Home</code> 组件，而 <code>About</code> 则会延迟加载；只有当用户访问到 <code>/about</code> 时，才会加载 <code>About</code> 组件。</p>
<hr/>
<h4 data-id="heading-20">路由职责分离</h4>
<p>为了保持代码的整洁和可维护性，我们通常会将路由的<strong>配置</strong>和<strong>导航</strong>逻辑从主应用组件中剥离出来。
这种分离让 <code>App.jsx</code> 更加简洁，专注于布局和全局组件的组合。</p>
<h5 data-id="heading-21">1. 独立的路由配置 (<code>src/router/index.jsx</code>)</h5>
<p>所有的路由规则、懒加载 (<code>lazy</code>)、路由守卫 (<code>ProtectRoute</code>) 等逻辑都集中管理。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// src/router/index.jsx</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Routes</span>, <span class="hljs-title class_">Route</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-router-dom'</span>;
<span class="hljs-keyword">import</span> { lazy, <span class="hljs-title class_">Suspense</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-comment">// ... 懒加载组件定义 ...</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">RouterConfig</span>(<span class="hljs-params"/>){
    <span class="hljs-keyword">return</span>(
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">LoadingFallback</span> /&gt;</span>}&gt;
          <span class="hljs-tag">&lt;<span class="hljs-name">Routes</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">Home</span> /&gt;</span>} /&gt;
            {/* ...其他路由配置 */}
          <span class="hljs-tag">&lt;/<span class="hljs-name">Routes</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span></span>
    )
}
</code></pre>
<h5 data-id="heading-22">2. 独立的导航组件 (<code>src/components/Navigation.jsx</code>)</h5>
<p>导航菜单、链接高亮等 UI 逻辑封装在独立的组件中。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// src/components/Navigation.jsx</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Link</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-router-dom'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Navigation</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">nav</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/"</span>&gt;</span>Home<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/about"</span>&gt;</span>About<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span>
      {/* ... */}
    <span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span></span>
  )
}
</code></pre>
<h5 data-id="heading-23">3. 简洁的主入口 (<code>src/App.jsx</code>)</h5>
<p>主组件只负责引入和组装，不再包含复杂的路由逻辑。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// src/App.jsx</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Navigation</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./components/Navigation'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">RouterConfig</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./router'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Router</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Navigation</span> /&gt;</span>   {/* 导航区域 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">RouterConfig</span> /&gt;</span> {/* 路由视图区域 */}
    <span class="hljs-tag">&lt;/<span class="hljs-name">Router</span>&gt;</span></span>
  )
}
</code></pre>
<hr/>
<h4 data-id="heading-24">样式优化</h4>
<h5 data-id="heading-25">导航区高亮 (像掘金一样)</h5>
<p>当我们点击导航区的不同链接时，我们通常会希望对应的导航项高亮显示，以告知用户当前所在的位置。
React Router 提供的 <code>useResolvedPath</code> 和 <code>useMatch</code> 可以帮助我们实现这个功能。</p>
<ul>
<li><code>useResolvedPath</code>: 将目标路径（<code>to</code> 属性）解析为绝对路径对象。</li>
<li><code>useMatch</code>: 接收一个路径模式，判断当前 URL 是否与该模式匹配。</li>
</ul>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> { useResolvedPath, useMatch, <span class="hljs-title class_">Link</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-router-dom'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Navigation</span>(<span class="hljs-params"/>){
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">isActive</span> = (<span class="hljs-params">to</span>) =&gt; {
     <span class="hljs-comment">// 1. 将 to 解析为 location 对象，处理相对路径等情况</span>
     <span class="hljs-keyword">const</span> resolvedPath = <span class="hljs-title function_">useResolvedPath</span>(to);
     
     <span class="hljs-comment">// 2. 检查当前路径是否匹配 resolvedPath.pathname</span>
     <span class="hljs-keyword">const</span> match = <span class="hljs-title function_">useMatch</span>({
      <span class="hljs-attr">path</span>: resolvedPath.<span class="hljs-property">pathname</span>,
      <span class="hljs-attr">end</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// 精准匹配，避免 / 匹配所有路径</span>
     })

     <span class="hljs-keyword">return</span> match ? <span class="hljs-string">'active'</span> : <span class="hljs-string">''</span>
  }
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">nav</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/"</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{isActive(</span>'/')}&gt;</span>Home<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/about"</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{isActive(</span>'/<span class="hljs-attr">about</span>')}&gt;</span>About<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        {/* ... */}
      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span></span>
  )
}
</code></pre>
<h4 data-id="heading-26">结语</h4>
<p>前端路由的本质，是<strong>路径与组件的映射</strong>；而 React Router，则让这种映射变得清晰、灵活又强大。</p>
<p>从基础跳转到动态参数，从嵌套路由到权限控制，再到懒加载与工程化拆分——我们不仅是在配置 URL，更是在构建一个可维护、高性能、用户体验流畅的现代 Web 应用。</p>
<p>掌握 React Router，不只是学会几个 API，而是理解 SPA 背后的导航逻辑与架构思维。希望这篇指南能成为你开发路上的可靠参考，助你写出更优雅的路由代码。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue转React学习笔记(1): 关于useEffect的困惑和思考]]></title>    <link>https://juejin.cn/post/7595842144906706994</link>    <guid>https://juejin.cn/post/7595842144906706994</guid>    <pubDate>2026-01-17T08:12:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595842144906706994" data-draft-id="7595808703074467866" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue转React学习笔记(1): 关于useEffect的困惑和思考"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-17T08:12:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="mo_Mo"/> <meta itemprop="url" content="https://juejin.cn/user/3727788080114596"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue转React学习笔记(1): 关于useEffect的困惑和思考
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3727788080114596/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    mo_Mo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T08:12:55.000Z" title="Sat Jan 17 2026 08:12:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">零、写在前面</h3>
<ol>
<li>之前实习和项目中都是学的Vue，由于之后工作大概率会进入React的技术生态，最近才开始学React并且缺少企业级的项目开发经验，也没有对源码做系统研究，以下的内容只是个人学习过程中的记录和思考，因此大概率会显得稚嫩而且主观，需要大佬们的指点和修正。</li>
<li>软件开发毕竟属于工程实践领域，对于相同的目标可以有不同的实现方案，而一样的技术在不同的场景下也需要做取舍权衡，它并不像数学物理这样的学科有一套不容置疑的公理。而且对于团队开发者而言，一套技术的开发体验、学习成本、认知对齐等因素也同样重要，它们应该是带有主观色彩的，至少是可讨论的；</li>
<li>为了描述简便，以下会根据官方文档的写法和称呼，对于<code>useEffect(setup，dependencies)</code>，将渲染中产生的副作用称为<code>Effect</code>，将第一个函数参数称为<code>setup</code>，将依赖数组简称为<code>deps</code>，将<code>setup</code>返回的清理函数称为<code>cleanup</code>。</li>
<li>文中提到的观点有些是React官方的提倡，有些是笔者自己的思考，请注意辨别，官方怎么说不代表我们真的要那么做/想。关于这个API，其实在各种React社区已经做出了大量讨论了，本文可以说是一个读后感。</li>
<li>以下提到的Vue指的是3.0+版本，而React指的是React18+的函数式组件+hook模式。</li>
</ol>
<h3 data-id="heading-1">一、Vue视角的对比：一些粗浅的理解</h3>
<p>由于之前有Vue框架的学习经验，因此在学习新的框架的时候，主播总会习惯上联想到Vue中相对应的Api，并且官方文档和大多数技术教程都会提到三种不同deps对应的情景和用法。</p>
<h4 data-id="heading-2">(一) 三种依赖情景</h4>
<h5 data-id="heading-3">1. 不传任何dep——类比<code>onMounted</code>和<code>onUpdated</code></h5>
<p>不传递任何依赖的时候，函数式组件首次渲染及之后更新，都会setup函数都会执行。对Vue来讲也是类似的，组件首次挂载执行onMounted和onUpdated钩子，区别在于Vue的onUpdated钩子的使用频率是很低的。</p>
<h5 data-id="heading-4">2. 传递空数组——类比<code>onMounted</code></h5>
<p>传递空数组意味着dep永远不变，setup函数只会在组件挂载的时候运行一次</p>
<h5 data-id="heading-5">3. 传递依赖值——类比<code>watch</code>和<code>watchEffect</code></h5>
<p>依赖值发生变化的时候，注册的回调函数会重新执行</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">useEffect</span>(() =&gt; {
  <span class="hljs-comment">// 会在每次渲染后运行</span>
});

<span class="hljs-built_in">useEffect</span>(() =&gt; {
  <span class="hljs-comment">// 只会在组件挂载（首次出现）时运行</span>
}, <span class="hljs-selector-attr">[]</span>);

<span class="hljs-built_in">useEffect</span>(() =&gt; {
  <span class="hljs-comment">// 会在组件挂载时运行，而且当 a 或 b 的值自上次渲染后发生变化后也会运行</span>
}, <span class="hljs-selector-attr">[a, b]</span>);
</code></pre>
<h4 data-id="heading-6">(二) 清理函数</h4>
<p>cleanup函数会在调用和组件卸载的时候执行，Vue中也提供了相关的功能，比如在onUnmounted的时候执行卸载逻辑，watch和watchEffect都能返回函数以用于清理副作用。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">watchEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// 副作用逻辑：创建定时器</span>
  <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
    count.<span class="hljs-property">value</span>++
  }, <span class="hljs-number">1000</span>)

  <span class="hljs-comment">// 清理函数：清除上一轮的定时器</span>
  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-built_in">clearInterval</span>(timer)
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'定时器已清除'</span>)
  }
})
</code></pre>
<h4 data-id="heading-7">(三) 思维差异</h4>
<p>对于Vue开发者或者React类组件的开发者来说，很容易用生命周期的组件思维来理解hook，然而官方觉得这对Effect来讲是不适宜的。如果用Vue角度来类比，大概率会觉得<code>useEffect</code>起到了一个“监听器”的作用，这引发了后面关于是否使用effect和如何写deps数组的差异。</p>
<h3 data-id="heading-8">二、如何理解副作用：区分<code>Event</code>和<code>Effect</code></h3>
<h4 data-id="heading-9">(一) 副作用的定义</h4>
<p>React hook倡导的是<code>UI=f(state)</code>的函数式编程理念，理论上组件函数应该是纯函数，也就是相同的输入返回相同的输出，并且不依赖也不影响外部系统，也就是不和外部产生任何交互。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 非纯函数</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">fn</span>=(<span class="hljs-params">arr</span>)=&gt;{
  arr.<span class="hljs-title function_">push</span>(<span class="hljs-number">1</span>) <span class="hljs-comment">// 修改了外部的参数</span>
}
</code></pre>
<p>在日常开发中产生副作用的频率是很高的，常见的比如：</p>
<ul>
<li>发送http请求：和服务器交互</li>
<li>操作dom元素：和浏览器API交互</li>
<li>定时器：和浏览器API交互</li>
<li>甚至console.log也是</li>
</ul>
<p>很多文章提到，<code>useEffect</code>是用来管理副作用的，但如果抱有一遇到“网络请求”“定时器”之类的操作，就全部放进useEffect处理，这肯定是不对的，至少不符合官方推荐的理念。</p>
<p>事实上，官方文档多次强调要区分由用户交互引起的副作用event和由渲染过程引起的Effect</p>
<h4 data-id="heading-10">(二) 区分<code>event</code>和<code>Effect</code></h4>
<p><strong>Effect 允许你指定由渲染自身，而不是特定事件引起的副作用</strong>。</p>
<p>当你决定将某些逻辑放入事件处理函数还是 Effect 中时，你需要回答的主要问题是：从用户的角度来看它是 <strong>怎样的逻辑</strong>。如果这个逻辑是由某个特定的交互引起的，请将它保留在相应的事件处理函数(<code>event handler</code>)中。如果是由用户在屏幕上 <strong>看到</strong> 组件时引起的，请将它保留在 Effect 中。</p>
<h5 data-id="heading-11">1. <strong>官方文档的例子</strong></h5>
<p>假设你正在实现一个聊天室组件，需求如下：</p>
<ol>
<li>组件应该自动连接选中的聊天室。</li>
<li>每当你点击“Send”按钮，组件应该在当前聊天界面发送一条消息。</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params">{ roomId }</span>) {
  <span class="hljs-keyword">const</span> [message, setMessage] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>);
  <span class="hljs-comment">// ...</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleSendClick</span>(<span class="hljs-params"/>) {
    <span class="hljs-title function_">sendMessage</span>(message);
  }
  <span class="hljs-comment">// ...</span>
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{message}</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">{e</span> =&gt;</span> setMessage(e.target.value)} /&gt;
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleSendClick}</span>&gt;</span>Send<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  );
}
</code></pre>
<h5 data-id="heading-12">2. <strong>日常项目中常见的例子</strong></h5>
<p>比如我们点击按钮切换不同的数据类型，需要发送网络请求拉取最新数据，用effect需要这样写</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">useEffect</span>(()=&gt;{
  <span class="hljs-built_in">fetchData</span>(type)
},<span class="hljs-selector-attr">[type]</span>)
</code></pre>
<p>这样就会带来一个问题，比如页面中有一些情况会改变type，但是那个场景下不需要发送请求，却仍旧触发了Effect，因此我们需要在setup函数里添加判断：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">useEffect</span>(()=&gt;{
  if (type==='<span class="hljs-number">1</span>'){
    <span class="hljs-built_in">fetchData</span>(type)
  }
},<span class="hljs-selector-attr">[type]</span>)
</code></pre>
<p>未来，假设业务需求变更，你的请求又依赖了另一个参数userId，你需要在dep中添加另一个数据，甚至新数据也会再页面其他地方被修改，你需要对新数据进行条件判断。这样的话，代码的维护成本将会增高不少。</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">useEffect</span>(()=&gt;{
  if (type==='<span class="hljs-number">1</span>' &amp;&amp; userId){
    <span class="hljs-built_in">fetchData</span>(type,userId)
  }
},<span class="hljs-selector-attr">[type，userId]</span>)
</code></pre>
<p>但实际上，假如请求这是点击事件触发的，官方更推荐把它直接写在事件处理函数里。这样写的好处是：只有当用户点击按钮这个事件触发的时候才会发送请求，而不是type变化的时候发送请求，从而做到切断type和useEffect的逻辑关系，让发送请求专属于点击事件。</p>
<pre><code class="hljs language-lua" lang="lua"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handleClick</span><span class="hljs-params">(e)</span></span>{
  const <span class="hljs-built_in">type</span>=e.target.<span class="hljs-built_in">type</span>
  fetchData(<span class="hljs-built_in">type</span>)
}
</code></pre>
<p>在常见的管理页中，搜索框输入，搜索框点击，分页页码，下拉菜单选项都有可能触发重新请求，那么应该怎么办呢？</p>
<p>我们可能会这么写：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">useEffect</span>(()=&gt;{
	<span class="hljs-built_in">fetchData</span>({
		pageNum,
		pageSize,
		searchKey,
		selectType
	})
},
	<span class="hljs-selector-attr">[pageNum,pageSize,searchKey,selectType]</span>
)
</code></pre>
<p>大多数人我感觉也会这么写，把useEffect当成“监听”来使用，当数据变化时，拿着最新的数据发送请求，好像也没什么问题。</p>
<p>但是按照React官方的说法，每个事件函数里都要发送一次请求吗？我的答案是：也许是的。。。但其实也没那么复杂，多写几次而已，前提是把fetchData提前封装好。</p>
<pre><code class="hljs language-scss" lang="scss">const handleSearch = () =&gt; {
	<span class="hljs-built_in">setPageNum</span>(<span class="hljs-number">1</span>); 
	<span class="hljs-built_in">fetchData</span>(); <span class="hljs-comment">// 调用统一请求函数</span>
};

const handlePageChange = (newPageNum, newPageSize) =&gt; {
	<span class="hljs-built_in">setPageNum</span>(newPageNum);
	<span class="hljs-built_in">setPageSize</span>(newPageSize);
	<span class="hljs-built_in">fetchData</span>(); <span class="hljs-comment">// 调用统一请求函数</span>
};

const handleSelectChange = (value) =&gt; {
	<span class="hljs-built_in">setSelectType</span>(value);
	<span class="hljs-built_in">setPageNum</span>(<span class="hljs-number">1</span>); 
	<span class="hljs-built_in">fetchData</span>(); <span class="hljs-comment">// 调用统一请求函数</span>
};
</code></pre>
<h5 data-id="heading-13"/>
<h4 data-id="heading-14">(三) 响应式 VS 命令式——我们真的需要“监听”吗？</h4>
<p>扯远一点，或许再考虑一个问题，我们真的在React中需要实现“监听”吗？</p>
<p>在<code>JavaScript</code>层面，我们永远做不到对一个变量是否被改变进行监听，Vue和React作为JS框架当然都无法改变这一点。那为什么Vue可以做到监听呢？笔者觉得这涉及到两个框架对于<code>响应式设计</code>在理念上的巨大差异，也就是响应式编程和命令式编程。</p>
<p>简单讲，Vue主打一个“自动化”，基于发布订阅模式，当你声明一个数据需要为“响应式”的时候，框架内部会利用getter和setter帮你自动地进行依赖的收集和触发更新。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">reactive</span>(<span class="hljs-params">target</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(target, {
    <span class="hljs-title function_">get</span>(<span class="hljs-params">obj, key</span>) {
      <span class="hljs-title function_">track</span>(obj, key); <span class="hljs-comment">// 启动依赖跟踪</span>
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(obj, key);
    },
    <span class="hljs-title function_">set</span>(<span class="hljs-params">obj, key, value</span>) {
      <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(obj, key, value);
      <span class="hljs-title function_">trigger</span>(obj, key); <span class="hljs-comment">// 触发副作用</span>
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
  });
}
</code></pre>
<p>而React则把控制权交给开发者，类似于“手动挡”，根据<code>UI=f(state)</code>的理念，React中只有状态这个概念，因此开发者必须<strong>手动</strong>管理好每一个状态，通过调用<code>setState</code>进行状态修改，由React来帮你自动重渲染并更新。这样一来，每一处变动都是开发者手动触发的，React自然没有进行自动监听的义务。</p>
<p>所以笔者觉得，或许当我们真的需要用React来进行自动监听的时候，应该持有的实现思路可能是像Vue一样基于JS的发布订阅这条路去实现<code>getter</code>和<code>setter</code>，而不是<code>useEffect</code>。</p>
<p>幸运的是，我们已经拥有了第三方库<code>Mobx</code>，它便是基于Vue响应式中的getter和setter模式，实现了自动监听。假如你使用<code>React + Mobx</code>则完全不需要手动<code>setState</code>了，可以看到两个框架的设计思想正在发生一定程度的交融。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> {observable, computed} from <span class="hljs-string">"mobx"</span>;

<span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderLine</span> {
    <span class="hljs-meta">@observable</span> price = <span class="hljs-number">0</span>;
    <span class="hljs-meta">@observable</span> amount = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">constructor</span>(price) {
        <span class="hljs-keyword">this</span>.price = price;
    }
  <span class="hljs-comment">// 很像Vue的computed</span>
    <span class="hljs-meta">@computed</span> <span class="hljs-keyword">get</span> total() {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.price * <span class="hljs-keyword">this</span>.amount;
    }
}
</code></pre>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">todos</span> = observable([
    {
        title: <span class="hljs-string">"Make coffee"</span>,
        done: <span class="hljs-literal">true</span>,
    },
])<span class="hljs-comment">;</span>

// reaction 很像watch
const <span class="hljs-attr">reaction</span> = reaction(
    () =&gt; todos.map(<span class="hljs-attr">todo</span> =&gt; todo.title),
    <span class="hljs-attr">titles</span> =&gt; console.log(<span class="hljs-string">"reaction 2:"</span>, titles.join(<span class="hljs-string">", "</span>))
)<span class="hljs-comment">;</span>

// autorun 很像watchEffect
const <span class="hljs-attr">autorun1</span> = autorun(
    () =&gt; console.log("autorun 1:", todos.map(<span class="hljs-attr">todo</span> =&gt; todo.title).join(<span class="hljs-string">", "</span>))
)<span class="hljs-comment">;</span>
</code></pre>
<h3 data-id="heading-15">三、巨大的心智负担：deps到底怎么写</h3>
<p>从以上例子可以看出，Effect的创作者担心开发人员理解不了这个hook，因此用了大量的案例来提示使用者在某些场景下别用Effect，但用不用Effect可能还不是最大的争议，useEffect钩子最大的争议点应该是在于依赖数组，也就是deps该怎么写，是否应该写完整。</p>
<h4 data-id="heading-16">(一) 官方的推荐：写全deps数组</h4>
<p>文档中提到：任何响应式值都可以在重新渲染时发生变化，所以需要将响应式值包括在 Effect 的依赖项中。这里的响应式值可能含有：</p>
<ul>
<li>
<ol>
<li>state</li>
</ol>
</li>
<li>
<ol start="2">
<li>props</li>
</ol>
</li>
<li>
<ol start="3">
<li>所有在组件函数中用到的普通函数和普通变量</li>
</ol>
</li>
</ul>
<p>也就是所有在setup中用到，并且函数组件作用域内的可能变化的值，都需要添加到dep中。</p>
<p>正是这一点，给开发者带来巨大的心智负担，即使官方推荐安装eslint的插件辅助我们补全deps，但实践中还是将它设置为warning而并非error，这仅仅相当于起到了一个心理安慰的作用。</p>
<p>特别是当dep用到了函数的时候，可能会导致useCallback嵌套的问题</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">//组件函数体内部</span>
function <span class="hljs-built_in">init</span>(){
	<span class="hljs-comment">// 每次重渲染都会产生新引用</span>
}

<span class="hljs-built_in">useEffect</span>(()=&gt;{
	<span class="hljs-built_in">init</span>(data) <span class="hljs-comment">// 会频繁触发</span>
},<span class="hljs-selector-attr">[data,init]</span>) 
</code></pre>
<p>添加useCallback</p>
<pre><code class="hljs language-scss" lang="scss">const initFn=<span class="hljs-built_in">useCallback</span>(init,[dep])
<span class="hljs-comment">// 如果dep里面还有函数，可能需要再次包裹useCallback，代码可读性会降低很多</span>

<span class="hljs-built_in">useEffect</span>(()=&gt;{
	<span class="hljs-built_in">initFn</span>(data) <span class="hljs-comment">// 会频繁触发</span>
},<span class="hljs-selector-attr">[data,initFn]</span>) 
</code></pre>
<h4 data-id="heading-17">(二) 先实现setup，再确定deps，而不是反过来</h4>
<p>官方文档提到，dep数组是完全由setup函数确定的，而不是由开发者选择的</p>
<p>个人是这么理解的：</p>
<ol>
<li>
<ol>
<li>你应该先确定这里的副作用是什么</li>
<li>dep是副作用的过滤器，通过指定dep来跳过副作用的执行，保证性能</li>
<li>同样地，如果要修改dep，应该先修改setup，而不是反过来</li>
<li>如果抱着“监听”的思维去理解，会先确定dep（你要监听的东西）再实现setup，那样的话，你可能会漏写dep</li>
</ol>
</li>
</ol>
<h3 data-id="heading-18">四、如何建立自己的最佳实践</h3>
<p>既然<code>useEffect</code>的心智负担那么重，我们应该这么做，以下是一点个人的思考</p>
<h4 data-id="heading-19">1.尽量多使用成熟的第三方库，减少自己裸写<code>useEffect</code>的情景</h4>
<ul>
<li>状态管理上，已经有很多第三方库帮你解决数据的收集和更新的问题了，比如Mobx和Zustand，本质上都是发布订阅的模式</li>
<li>发送请求上，优先使用Tanstack-Query、SWR、ahooks中的useRequest等第三方库，来发送请求，帮你管理请求中的各种问题（包括网络竞态、数据缓存、loading error管理等），比自己写useEffect要稳得多。</li>
</ul>
<h4 data-id="heading-20">2.可以使用<code>useEffect</code>的情况</h4>
<ul>
<li>需要操作原生dom元素的情况：比如手动设置元素的<code>scrollTop</code>的值</li>
<li>确保副作用仅一次性执行，可以使用空数组的场景：比如初始化第三方SDK</li>
<li>监听浏览器原生事件的情况：比如窗口大小变化<code>window.resize</code></li>
<li>需要和外部环境进行同步的情况：比如websocket链接，SSE链接等</li>
<li>你觉得自己完全搞懂了useEffect的话可以用。。。（反正我是没搞懂。。）</li>
</ul>
<h4 data-id="heading-21">3.协作开发的过程需要和团队对齐观念</h4>
<p>如果是团队开发的话，要能看懂并理解别人的代码，而不是强迫别人理解自己的观点。团队的领导者最好能制定一份团队的开发规范，拉齐所有人的技术认知。当然这不是我这种新手该考虑的东西，只能说领导让怎么做就怎么做QvQ。</p>
<h3 data-id="heading-22">五、写在最后</h3>
<p>作为一点Vue转React的新手，有几点个人的主观感受想提一下</p>
<ol>
<li>React只是一个JS库，它没有义务覆盖前端所有的业务场景，也没义务提供所谓的最佳实践，而是让开发者自己选择，这种理念应该是可以理解的。</li>
<li>但不管怎么说，<code>useEffect</code>都是一个认知曲线极其陡峭、给开发者造成巨大心智负担的API，从开发文档的篇幅以及React提出的<code>useEffectEvent</code>就可以看出来，但其实都是在缝缝补补。</li>
<li>官方对这个API的设计理念，和开发者的日常用法存在不少的割裂，这也是官方文档用大部分篇幅来讲这个hook的原因，就是为了让开发者少用，少滥用。</li>
<li>从体验上看，Vue即使对底层原理不那么熟悉也能进行开发，但React的开发过程中，还是需要不断按照React的机制去模拟整个流程，所以理解原理还是比较重要。至于这是不是框架在甩锅给开发者，就见仁见智了。</li>
</ol>
<h3 data-id="heading-23">六、参考</h3>
<ol>
<li>《为什么我们要删掉100%的useEffect》：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.yuque.com%2Fjiango%2Fcode%2Fgood-bye-use-effect%23a6Ch9" target="_blank" title="https://www.yuque.com/jiango/code/good-bye-use-effect#a6Ch9" ref="nofollow noopener noreferrer">www.yuque.com/jiango/code…</a></li>
<li>《React hook使用误区，驳官方文档》：<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F450513902" target="_blank" title="https://zhuanlan.zhihu.com/p/450513902" ref="nofollow noopener noreferrer">zhuanlan.zhihu.com/p/450513902</a></li>
<li>《A Complete Guide to useEffect》：<a href="https://link.juejin.cn?target=https%3A%2F%2Foverreacted.io%2Fa-complete-guide-to-useeffect%2F" target="_blank" title="https://overreacted.io/a-complete-guide-to-useeffect/" ref="nofollow noopener noreferrer">overreacted.io/a-complete-…</a></li>
<li>《精读useEffect完全指南》：<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F60277120" target="_blank" title="https://zhuanlan.zhihu.com/p/60277120" ref="nofollow noopener noreferrer">zhuanlan.zhihu.com/p/60277120</a></li>
<li>React官方文档《脱围机制》：<a href="https://link.juejin.cn?target=https%3A%2F%2Fzh-hans.react.dev%2Flearn%2Fescape-hatches" target="_blank" title="https://zh-hans.react.dev/learn/escape-hatches" ref="nofollow noopener noreferrer">zh-hans.react.dev/learn/escap…</a></li>
<li>React官方文档 useEffect： <a href="https://link.juejin.cn?target=https%3A%2F%2Fzh-hans.react.dev%2Freference%2Freact%2FuseEffect" target="_blank" title="https://zh-hans.react.dev/reference/react/useEffect" ref="nofollow noopener noreferrer">zh-hans.react.dev/reference/r…</a></li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Message组件和Vue3 进阶：手动挂载组件与 Diff 算法深度解析]]></title>    <link>https://juejin.cn/post/7595871887001157632</link>    <guid>https://juejin.cn/post/7595871887001157632</guid>    <pubDate>2026-01-17T08:24:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595871887001157632" data-draft-id="7595871887001141248" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Message组件和Vue3 进阶：手动挂载组件与 Diff 算法深度解析"/> <meta itemprop="keywords" content="Vue.js,前端框架"/> <meta itemprop="datePublished" content="2026-01-17T08:24:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="干死前端"/> <meta itemprop="url" content="https://juejin.cn/user/1486957885265400"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Message组件和Vue3 进阶：手动挂载组件与 Diff 算法深度解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1486957885265400/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    干死前端
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T08:24:01.000Z" title="Sat Jan 17 2026 08:24:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/10862e9655534fde81d62ac8a0a6ae11~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bmy5q275YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769243041&amp;x-signature=N7zA2RCqEgobX5S3upfbxKuSuIM%3D" alt="ai_image_1768638049154_1.jpg" loading="lazy"/></p>
<h2 data-id="heading-0">Vue3 进阶：手动挂载组件与 Diff 算法深度解析</h2>
<blockquote>
<p>很多 Vue 开发者习惯了在 <code>&lt;template&gt;</code> 里写组件，但在开发 <code>Message</code>（全局提示）、<code>Modal</code>（模态框）或 <code>Notification</code>（通知）这类组件时，我们往往希望通过 JS 函数直接调用，而不是在每个页面都写一个 <code>&lt;MyMessage /&gt;</code> 标签。本文将带你深入 Vue3 底层，看看如何<strong>手动渲染组件</strong>。</p>
</blockquote>
<h3 data-id="heading-1">1. 为什么需要手动挂载？</h3>
<p>想象一下，如果你想弹出一个成功提示，哪种方式更优雅？</p>
<p><strong>方式 A (声明式)</strong>：
需要在每个页面的 template 里都写一遍组件，还要定义一个变量来控制显示隐藏。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">MyMessage</span> <span class="hljs-attr">:visible</span>=<span class="hljs-string">"showMsg"</span> <span class="hljs-attr">message</span>=<span class="hljs-string">"操作成功"</span> /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"showMsg = true"</span>&gt;</span>点击<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<p><strong>方式 B (命令式)</strong>：
直接在 JS 里调用，随用随调，完全解耦。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { message } <span class="hljs-keyword">from</span> <span class="hljs-string">'my-ui'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"/>) {
  message.<span class="hljs-title function_">success</span>(<span class="hljs-string">'操作成功'</span>)
}
</code></pre>
<p>显然，方式 B 是组件库的标准做法。但 Vue 的组件通常是渲染在父组件的模板里的，如何把它“凭空”变出来并挂载到 <code>document.body</code> 上呢？</p>
<p>这就需要用到 Vue3 暴露的两个底层 API：<code>createVNode</code> 和 <code>render</code>。</p>
<h3 data-id="heading-2">2. 核心 API 解密</h3>
<h4 data-id="heading-3">createVNode：画图纸</h4>
<p>在 Vue 中，一切皆 VNode（虚拟节点）。普通的 <code>.vue</code> 文件只是一个组件定义，它不是 DOM，也不是 VNode。我们需要用 <code>createVNode</code> 把它实例化。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { createVNode } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">MyComponent</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./MyComponent.vue'</span>

<span class="hljs-comment">// 这就像是拿着图纸 (MyComponent)</span>
<span class="hljs-comment">// 创建了一个具体的实例化对象 (vm)</span>
<span class="hljs-comment">// 第二个参数是 props</span>
<span class="hljs-keyword">const</span> vnode = <span class="hljs-title function_">createVNode</span>(<span class="hljs-title class_">MyComponent</span>, { <span class="hljs-attr">title</span>: <span class="hljs-string">'Hello'</span> })
</code></pre>
<h4 data-id="heading-4">render：施工队</h4>
<p>有了 VNode，它还只是内存里的对象。我们需要 <code>render</code> 函数把它变成真实的 DOM 节点，并挂载到某个容器上。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { render } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> container = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>)
<span class="hljs-comment">// 把 vnode 渲染到 container 盒子里</span>
<span class="hljs-title function_">render</span>(vnode, container)

<span class="hljs-comment">// 最后把盒子放到 body 上</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(container)
</code></pre>
<h3 data-id="heading-5">3. 实战：手写一个简单的 Message 函数</h3>
<p>让我们来看看 <code>packages/components/message/src/method.ts</code> 是如何实现的。</p>
<h4 data-id="heading-6">第一步：创建容器与 VNode</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { createVNode, render } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">MessageConstructor</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./message.vue'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">message</span>(<span class="hljs-params">options</span>) {
  <span class="hljs-comment">// 1. 创建一个临时的 div 容器</span>
  <span class="hljs-keyword">const</span> container = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>)

  <span class="hljs-comment">// 2. 创建 VNode，并将 options 作为 props 传入</span>
  <span class="hljs-comment">// 例如：createVNode(MessageConstructor, { message: '你好', type: 'success' })</span>
  <span class="hljs-keyword">const</span> vnode = <span class="hljs-title function_">createVNode</span>(<span class="hljs-title class_">MessageConstructor</span>, options)

  <span class="hljs-comment">// 3. 将 VNode 渲染到 container 中</span>
  <span class="hljs-comment">// 此时 container.firstElementChild 就是组件生成的真实 DOM</span>
  <span class="hljs-title function_">render</span>(vnode, container)

  <span class="hljs-comment">// 4. 将真实 DOM 追加到 body</span>
  <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(container.<span class="hljs-property">firstElementChild</span>!)
}
</code></pre>
<h4 data-id="heading-7">第二步：处理组件卸载</h4>
<p>这就完事了吗？并没有。如果我们不处理销毁逻辑，这些 DOM 节点会一直堆积在 body 里，造成内存泄漏。</p>
<p>我们需要在组件内部发射一个 <code>destroy</code> 事件（比如在动画结束时），然后在外部监听它。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> vnode = <span class="hljs-title function_">createVNode</span>(<span class="hljs-title class_">MessageConstructor</span>, {
  ...options,
  <span class="hljs-comment">// 监听组件内部 emit('destroy')</span>
  <span class="hljs-attr">onDestroy</span>: <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// 移除 DOM</span>
    <span class="hljs-title function_">render</span>(<span class="hljs-literal">null</span>, container) <span class="hljs-comment">// 这一步会触发组件的 unmounted 钩子</span>
  }
})
</code></pre>
<h3 data-id="heading-8">4. 源码深潜：createVNode 和 render 到底干了啥？</h3>
<p>对于好奇心强的同学，可能想知道：Vue 内部到底是怎么把这几行代码变成页面的？让我们用最通俗的伪代码来拆解一下。</p>
<h4 data-id="heading-9">4.1 createVNode：给节点“打标签”</h4>
<p><code>createVNode</code> 的核心任务不仅仅是创建一个对象，更是为了<strong>性能优化</strong>。它会根据你传入的类型，给 VNode 打上一个二进制标记（ShapeFlag）。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 伪代码简化版</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createVNode</span>(<span class="hljs-params"><span class="hljs-keyword">type</span>, props, children</span>) {
  <span class="hljs-comment">// 1. 定义 VNode 结构</span>
  <span class="hljs-keyword">const</span> vnode = {
    <span class="hljs-keyword">type</span>, <span class="hljs-comment">// 组件对象 或 'div' 标签名</span>
    props,
    children,
    <span class="hljs-attr">component</span>: <span class="hljs-literal">null</span>, <span class="hljs-comment">// 稍后挂载组件实例</span>
    <span class="hljs-attr">el</span>: <span class="hljs-literal">null</span>, <span class="hljs-comment">// 稍后挂载真实 DOM</span>
    <span class="hljs-attr">shapeFlag</span>: <span class="hljs-number">0</span> <span class="hljs-comment">// 核心：类型标记</span>
  }

  <span class="hljs-comment">// 2. 通过位运算打标记</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-keyword">type</span> === <span class="hljs-string">'string'</span>) {
    vnode.<span class="hljs-property">shapeFlag</span> = <span class="hljs-title class_">ShapeFlags</span>.<span class="hljs-property">ELEMENT</span> <span class="hljs-comment">// 这是一个 HTML 标签 (div, span)</span>
  }
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-keyword">type</span> === <span class="hljs-string">'object'</span>) {
    vnode.<span class="hljs-property">shapeFlag</span> = <span class="hljs-title class_">ShapeFlags</span>.<span class="hljs-property">STATEFUL_COMPONENT</span> <span class="hljs-comment">// 这是一个 Vue 组件</span>
  }

  <span class="hljs-keyword">return</span> vnode
}
</code></pre>
<p><strong>为什么要这么做？</strong>
Vue 的更新过程非常频繁。有了 <code>shapeFlag</code>，在后续的 Diff 过程中，Vue 就不需要每次都去猜“这是个啥”，直接看二进制位就知道怎么处理，速度极快。</p>
<h4 data-id="heading-10">4.2 render：万能的包工头</h4>
<p><code>render</code> 函数其实非常简单，它背后真正的干活主力是 <code>patch</code> 函数。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 伪代码简化版</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">render</span>(<span class="hljs-params">vnode, container</span>) {
  <span class="hljs-keyword">if</span> (vnode == <span class="hljs-literal">null</span>) {
    <span class="hljs-comment">// 如果传 null，说明要销毁</span>
    <span class="hljs-keyword">if</span> (container.<span class="hljs-property">_vnode</span>) {
      <span class="hljs-title function_">unmount</span>(container.<span class="hljs-property">_vnode</span>) <span class="hljs-comment">// 卸载旧节点</span>
    }
  }
  <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 如果有新 VNode，就开始“打补丁”</span>
    <span class="hljs-comment">// 参数：(旧节点, 新节点, 容器)</span>
    <span class="hljs-title function_">patch</span>(container.<span class="hljs-property">_vnode</span> || <span class="hljs-literal">null</span>, vnode, container)
  }

  <span class="hljs-comment">// 记住这次渲染的 VNode，下次更新时它就是“旧节点”了</span>
  container.<span class="hljs-property">_vnode</span> = vnode
}
</code></pre>
<h4 data-id="heading-11">4.3 patch：分发任务</h4>
<p><code>patch</code> 是 Vue 渲染器的核心。它根据我们前面打的 <code>shapeFlag</code>，把任务分发给不同的处理函数。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">patch</span>(<span class="hljs-params">n1, n2, container</span>) {
  <span class="hljs-keyword">if</span> (n1 &amp;&amp; !<span class="hljs-title function_">isSameVNodeType</span>(n1, n2)) {
    <span class="hljs-comment">// 如果类型都不一样（比如从 div 变成了 span），直接卸载旧的</span>
    <span class="hljs-title function_">unmount</span>(n1)
    n1 = <span class="hljs-literal">null</span>
  }

  <span class="hljs-keyword">const</span> { shapeFlag } = n2
  <span class="hljs-keyword">if</span> (shapeFlag &amp; <span class="hljs-title class_">ShapeFlags</span>.<span class="hljs-property">ELEMENT</span>) {
    <span class="hljs-comment">// 这是一个 HTML 标签</span>
    <span class="hljs-title function_">processElement</span>(n1, n2, container)
  }
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (shapeFlag &amp; <span class="hljs-title class_">ShapeFlags</span>.<span class="hljs-property">COMPONENT</span>) {
    <span class="hljs-comment">// 这是一个 Vue 组件</span>
    <span class="hljs-title function_">processComponent</span>(n1, n2, container)
  }
}
</code></pre>
<h4 data-id="heading-12">4.4 深入 processComponent：组件是怎么跑起来的？</h4>
<p>当 <code>patch</code> 发现这是个组件时，它会区分是“初次挂载”还是“更新”。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">processComponent</span>(<span class="hljs-params">n1, n2, container</span>) {
  <span class="hljs-keyword">if</span> (n1 == <span class="hljs-literal">null</span>) {
    <span class="hljs-comment">// 1. 挂载组件 (Mount)</span>
    <span class="hljs-title function_">mountComponent</span>(n2, container)
  }
  <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 2. 更新组件 (Update)</span>
    <span class="hljs-title function_">updateComponent</span>(n1, n2)
  }
}
</code></pre>
<p><strong>mountComponent 做的事情：</strong></p>
<ol>
<li><strong>创建实例</strong>：<code>const instance = createComponentInstance(vnode)</code>。</li>
<li><strong>设置状态</strong>：初始化 <code>props</code>、<code>slots</code>，执行 <code>setup()</code> 函数。</li>
<li><strong>建立副作用</strong>：创建一个 <code>effect</code>（响应式副作用），运行组件的 <code>render</code> 函数生成子树（subTree），并监听响应式数据变化。</li>
</ol>
<h4 data-id="heading-13">4.5 深入 processElement：挂载与更新</h4>
<p>当 <code>patch</code> 遇到 HTML 标签时，会根据 <code>n1</code>（旧节点）是否存在来决定是初始化还是更新。</p>
<h5 data-id="heading-14">1. 挂载 (Mount)</h5>
<p>如果 <code>n1</code> 为 <code>null</code>，说明是初次渲染。Vue 会调用宿主环境的 API（如 <code>document.createElement</code>）创建真实 DOM，并将其插入到容器中。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">mountElement</span>(<span class="hljs-params">vnode, container</span>) {
  <span class="hljs-comment">// 1. 创建真实 DOM</span>
  <span class="hljs-keyword">const</span> el = (vnode.<span class="hljs-property">el</span> = <span class="hljs-title function_">hostCreateElement</span>(vnode.<span class="hljs-property">type</span>))

  <span class="hljs-comment">// 2. 处理 Props (Style, Class, Event)</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">in</span> vnode.<span class="hljs-property">props</span>) {
    <span class="hljs-title function_">hostPatchProp</span>(el, key, <span class="hljs-literal">null</span>, vnode.<span class="hljs-property">props</span>[key])
  }

  <span class="hljs-comment">// 3. 处理子节点 (递归 mount)</span>
  <span class="hljs-title function_">mountChildren</span>(vnode.<span class="hljs-property">children</span>, el)

  <span class="hljs-comment">// 4. 插入页面</span>
  <span class="hljs-title function_">hostInsert</span>(el, container)
}
</code></pre>
<h5 data-id="heading-15">2. 更新 (Patch)</h5>
<p>如果 <code>n1</code> 存在，Vue 就需要对比新旧节点，做最小量的 DOM 操作。</p>
<ol>
<li><strong>更新 Props</strong>：对比新旧 Props，修改变动的 Class、Style 或事件监听器。</li>
<li><strong>更新 Children (核心 Diff)</strong>：这是最复杂的部分。</li>
</ol>
<h4 data-id="heading-16">4.6 核心 Diff 算法：Vue3 是如何“增删改移”的？</h4>
<p>Vue3 采用的是<strong>快速 Diff 算法 (Quick Diff)</strong>。它的核心思想是：<strong>先处理两端容易对比的节点，最后再处理中间复杂的乱序部分</strong>。</p>
<p>我们通过一个具体的代码示例来模拟这个过程。</p>
<p><strong>假设场景：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 旧列表 (n1)</span>
<span class="hljs-keyword">const</span> oldChildren = [
  { <span class="hljs-attr">key</span>: <span class="hljs-string">'A'</span> }, { <span class="hljs-attr">key</span>: <span class="hljs-string">'B'</span> }, <span class="hljs-comment">// 头</span>
  { <span class="hljs-attr">key</span>: <span class="hljs-string">'C'</span> }, { <span class="hljs-attr">key</span>: <span class="hljs-string">'D'</span> }, { <span class="hljs-attr">key</span>: <span class="hljs-string">'E'</span> }, <span class="hljs-comment">// 中间</span>
  { <span class="hljs-attr">key</span>: <span class="hljs-string">'F'</span> }, { <span class="hljs-attr">key</span>: <span class="hljs-string">'G'</span> }  <span class="hljs-comment">// 尾</span>
]

<span class="hljs-comment">// 新列表 (n2)</span>
<span class="hljs-keyword">const</span> newChildren = [
  { <span class="hljs-attr">key</span>: <span class="hljs-string">'A'</span> }, { <span class="hljs-attr">key</span>: <span class="hljs-string">'B'</span> }, <span class="hljs-comment">// 头 (不变)</span>
  { <span class="hljs-attr">key</span>: <span class="hljs-string">'E'</span> }, { <span class="hljs-attr">key</span>: <span class="hljs-string">'C'</span> }, { <span class="hljs-attr">key</span>: <span class="hljs-string">'D'</span> }, { <span class="hljs-attr">key</span>: <span class="hljs-string">'H'</span> }, <span class="hljs-comment">// 中间 (乱序 + 新增)</span>
  { <span class="hljs-attr">key</span>: <span class="hljs-string">'F'</span> }, { <span class="hljs-attr">key</span>: <span class="hljs-string">'G'</span> }  <span class="hljs-comment">// 尾 (不变)</span>
]
</code></pre>
<h5 data-id="heading-17">第一步：掐头（Sync from start）</h5>
<p>Vue 会维护一个索引 <code>i = 0</code>，从头部开始向后遍历，如果 <code>key</code> 相同，直接 patch（更新属性），然后 <code>i++</code>。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>
<span class="hljs-keyword">const</span> e1 = oldChildren.<span class="hljs-property">length</span> - <span class="hljs-number">1</span> <span class="hljs-comment">// 旧列表尾部索引</span>
<span class="hljs-keyword">const</span> e2 = newChildren.<span class="hljs-property">length</span> - <span class="hljs-number">1</span> <span class="hljs-comment">// 新列表尾部索引</span>

<span class="hljs-comment">// 1. 从头往后比</span>
<span class="hljs-keyword">while</span> (i &lt;= e1 &amp;&amp; i &lt;= e2) {
  <span class="hljs-keyword">const</span> n1 = oldChildren[i]
  <span class="hljs-keyword">const</span> n2 = newChildren[i]
  
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isSameVNodeType</span>(n1, n2)) {
    <span class="hljs-title function_">patch</span>(n1, n2, container) <span class="hljs-comment">// 复用节点，更新 Props</span>
    i++
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">break</span> <span class="hljs-comment">// 遇到不同的 (C vs E)，停下来</span>
  }
}
<span class="hljs-comment">// 此时 i = 2，指向 C 和 E</span>
</code></pre>
<h5 data-id="heading-18">第二步：去尾（Sync from end）</h5>
<p>同样的逻辑，从尾部开始向前遍历。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 2. 从尾往前比</span>
<span class="hljs-keyword">while</span> (i &lt;= e1 &amp;&amp; i &lt;= e2) {
  <span class="hljs-keyword">const</span> n1 = oldChildren[e1]
  <span class="hljs-keyword">const</span> n2 = newChildren[e2]
  
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isSameVNodeType</span>(n1, n2)) {
    <span class="hljs-title function_">patch</span>(n1, n2, container)
    e1--
    e2--
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">break</span> <span class="hljs-comment">// 遇到不同的 (E vs H)，停下来</span>
  }
}
<span class="hljs-comment">// 此时 e1 = 4 (指向 E), e2 = 5 (指向 H)</span>
</code></pre>
<p><strong>此时的状态：</strong></p>
<ul>
<li>头部 A, B 已处理。</li>
<li>尾部 F, G 已处理。</li>
<li><strong>剩下的烂摊子</strong>：
<ul>
<li>旧：<code>[C, D, E]</code> (索引 2 到 4)</li>
<li>新：<code>[E, C, D, H]</code> (索引 2 到 5)</li>
</ul>
</li>
</ul>
<h5 data-id="heading-19">第三步：处理新增与删除（简单情况）</h5>
<p>如果预处理后，旧列表没了（<code>i &gt; e1</code>），新列表还剩，说明全是<strong>新增</strong>。
如果新列表没了（<code>i &gt; e2</code>），旧列表还剩，说明全是<strong>删除</strong>。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">if</span> (i &gt; e1) {
  <span class="hljs-keyword">if</span> (i &lt;= e2) {
    <span class="hljs-comment">// 旧的没了，新的还有 -&gt; 挂载剩余的新节点</span>
    <span class="hljs-keyword">while</span> (i &lt;= e2) <span class="hljs-title function_">patch</span>(<span class="hljs-literal">null</span>, newChildren[i++], container)
  }
} 
<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (i &gt; e2) {
  <span class="hljs-comment">// 新的没了，旧的还有 -&gt; 卸载剩余的旧节点</span>
  <span class="hljs-keyword">while</span> (i &lt;= e1) <span class="hljs-title function_">unmount</span>(oldChildren[i++])
}
</code></pre>
<h5 data-id="heading-20">第四步：处理乱序（Unknown Sequence）</h5>
<p>这是最复杂的情况（如我们的例子）。Vue 需要判断哪些节点移动了，哪些需要新建。</p>
<p><strong>1. 构建新节点映射表与初始化</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. 构建新节点的 key 映射表</span>
<span class="hljs-keyword">const</span> keyToNewIndexMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>()
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> k = i; k &lt;= e2; k++) {
  keyToNewIndexMap.<span class="hljs-title function_">set</span>(newChildren[k].<span class="hljs-property">key</span>, k)
}

<span class="hljs-comment">// 2. 待处理新节点数量</span>
<span class="hljs-keyword">const</span> count = e2 - i + <span class="hljs-number">1</span>
<span class="hljs-comment">// 3. 记录新节点在旧列表中的位置（用于计算最长递增子序列）</span>
<span class="hljs-keyword">const</span> newIndexToOldIndexMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(count).<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>)
</code></pre>
<p><strong>2. 遍历旧节点：复用与删除</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 4. 遍历旧节点，寻找可复用的节点</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> k = i; k &lt;= e1; k++) {
  <span class="hljs-keyword">const</span> oldChild = oldChildren[k]
  <span class="hljs-keyword">const</span> newIndex = keyToNewIndexMap.<span class="hljs-title function_">get</span>(oldChild.<span class="hljs-property">key</span>)

  <span class="hljs-keyword">if</span> (newIndex === <span class="hljs-literal">undefined</span>) {
    <span class="hljs-comment">// 旧节点在新列表中找不到了 -&gt; 删除</span>
    <span class="hljs-title function_">unmount</span>(oldChild)
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 找到了！记录旧索引 + 1（防止 0 索引冲突）</span>
    <span class="hljs-comment">// newIndex - i 是为了映射到从 0 开始的 count 数组中</span>
    newIndexToOldIndexMap[newIndex - i] = k + <span class="hljs-number">1</span>
    <span class="hljs-comment">// 进行递归比对</span>
    <span class="hljs-title function_">patch</span>(oldChild, newChildren[newIndex], container)
  }
}
<span class="hljs-comment">/**
 * 此时产生的映射关系图例：
 * 
 * 索引 (i):      0    1    2    3   (对应新列表中的位置)
 * 新节点 key:   [E]  [C]  [D]  [H]
 * 旧索引 + 1:   [5]  [3]  [4]  [0]  (对应 newIndexToOldIndexMap)
 * 
 * 其中：
 * - 0 代表 H 是新来的，需要挂载 (Mount)
 * - 3, 4 是递增的序列 -&gt; 这就是 LIS (最长递增子序列)
 * - 5 打破了递增性 -&gt; 说明 E 发生了移动
 */</span>
</code></pre>
<blockquote>
<p><strong>💡 小白专属解释：</strong></p>
<p>你可以把 <code>newIndexToOldIndexMap</code> 想象成一张 <strong>“寻人启事表”</strong>。
表格的长度就是新列表里乱序的人数（这里是 4 个：E, C, D, H）。</p>
<ul>
<li><strong>第 0 格 (E)</strong>：表里写着 <code>5</code>。意思是：“我是旧列表里的第 4 号（5-1）人”。</li>
<li><strong>第 1 格 (C)</strong>：表里写着 <code>3</code>。意思是：“我是旧列表里的第 2 号（3-1）人”。</li>
<li><strong>第 2 格 (D)</strong>：表里写着 <code>4</code>。意思是：“我是旧列表里的第 3 号（4-1）人”。</li>
<li><strong>第 3 格 (H)</strong>：表里写着 <code>0</code>。意思是：“查无此人，我是新来的”。</li>
</ul>
<p>Vue 看到这张表，就知道谁是从哪儿来的，谁是新来的。然后只要算出哪个序列是<strong>递增</strong>的（3 -&gt; 4），就说明这几个人（C 和 D）的相对站位没变，可以不用动，省力气！</p>
</blockquote>
<p><strong>3. 计算最长递增子序列 (LIS)</strong></p>
<p>Vue 使用一个算法算出 <code>newIndexToOldIndexMap</code> 中的<strong>最长递增子序列</strong>。这个序列里的节点，在旧列表和新列表里的相对顺序是一样的，所以<strong>不需要移动</strong>。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 获取最长递增子序列的相对索引</span>
<span class="hljs-comment">// 传入: [5, 3, 4, 0] (忽略 0)</span>
<span class="hljs-comment">// 返回: [1, 2] (对应值 3, 4，即 C 和 D，它们在 newIndexToOldIndexMap 中的下标)</span>
<span class="hljs-keyword">const</span> increasingNewIndexSequence = <span class="hljs-title function_">getSequence</span>(newIndexToOldIndexMap)

<span class="hljs-comment">// j 指向 LIS 数组的末尾 (即最大索引)</span>
<span class="hljs-keyword">let</span> j = increasingNewIndexSequence.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>
</code></pre>
<p><strong>4. 倒序遍历与移动 (Moving)</strong></p>
<p>最后，我们<strong>从后往前</strong>遍历需要处理的新节点。
为什么倒序？因为 <code>insert</code> 操作需要一个<strong>参照节点 (Anchor)</strong>。从后往前遍历时，当前节点的<strong>后一个节点</strong>一定已经处理好了（要么是刚移动完的，要么是末尾固定的），可以放心地作为 Anchor。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 遍历待处理的新节点 (倒序)</span>
<span class="hljs-comment">// k: 当前处理节点在乱序区间内的相对索引 (0 ~ count-1)</span>
<span class="hljs-comment">// i: 乱序区间的起始索引 (全局索引)</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> k = count - <span class="hljs-number">1</span>; k &gt;= <span class="hljs-number">0</span>; k--) {
  <span class="hljs-comment">// 1. 计算该节点在新列表中的真实全局索引</span>
  <span class="hljs-keyword">const</span> nextIndex = i + k
  <span class="hljs-keyword">const</span> nextChild = newChildren[nextIndex]
  
  <span class="hljs-comment">// 2. 找锚点 (Anchor)：就是它后面那个节点</span>
  <span class="hljs-comment">// 如果 nextIndex + 1 超过了长度，说明它是最后一个，锚点是 null (插到容器末尾)</span>
  <span class="hljs-keyword">const</span> anchor = nextIndex + <span class="hljs-number">1</span> &lt; newChildren.<span class="hljs-property">length</span> ? newChildren[nextIndex + <span class="hljs-number">1</span>].<span class="hljs-property">el</span> : <span class="hljs-literal">null</span>

  <span class="hljs-keyword">if</span> (newIndexToOldIndexMap[k] === <span class="hljs-number">0</span>) {
    <span class="hljs-comment">// ------------------------------------</span>
    <span class="hljs-comment">// 情况 1: 标记是 0 -&gt; 新增节点</span>
    <span class="hljs-comment">// ------------------------------------</span>
    <span class="hljs-title function_">patch</span>(<span class="hljs-literal">null</span>, nextChild, container, anchor)
  
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (j &lt; <span class="hljs-number">0</span> || k !== increasingNewIndexSequence[j]) {
    <span class="hljs-comment">// ------------------------------------</span>
    <span class="hljs-comment">// 情况 2: 需要移动</span>
    <span class="hljs-comment">// ------------------------------------</span>
    <span class="hljs-comment">// 这里的 k 不在 LIS 里，说明位置不对，需要搬家</span>
    <span class="hljs-title function_">move</span>(nextChild, container, anchor) 
  
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// ------------------------------------</span>
    <span class="hljs-comment">// 情况 3: 命中 LIS -&gt; 原地不动</span>
    <span class="hljs-comment">// ------------------------------------</span>
    <span class="hljs-comment">// k === seq[j]: 恭喜，这个节点在最长递增序列里</span>
    <span class="hljs-comment">// 它的相对位置没变，不需要动 DOM，只需要让 LIS 指针前移</span>
    j--
  }
}
</code></pre>
<blockquote>
<p><strong>💡 核心逻辑图解：</strong></p>
<ol>
<li><strong>H (i=3)</strong>: Map 值为 0 -&gt; <strong>新建</strong>，插到末尾。</li>
<li><strong>D (i=2)</strong>: 命中 LIS (seq[j]=2) -&gt; <strong>不动</strong>，<code>j--</code>。</li>
<li><strong>C (i=1)</strong>: 命中 LIS (seq[j]=1) -&gt; <strong>不动</strong>，<code>j--</code>。</li>
<li><strong>E (i=0)</strong>: 不在 LIS 里 -&gt; <strong>移动</strong>，插到 C 前面。</li>
</ol>
</blockquote>
<h3 data-id="heading-21">5. 源码级细节：为什么需要 Context？</h3>
<p>你可能会发现我们的源码里有这么一行：</p>
<pre><code class="hljs language-typescript" lang="typescript">vnode.<span class="hljs-property">appContext</span> = context || <span class="hljs-literal">null</span>
</code></pre>
<p>这是为了让动态挂载的组件能继承当前 App 的上下文。比如，你在主 App 里注册了 <code>vue-router</code> 或 <code>i18n</code>，如果不把 <code>appContext</code> 赋值给新的 VNode，那么在这个 Message 组件里就无法使用 <code>useRouter()</code> 或 <code>$t()</code>。</p>
<h3 data-id="heading-22">6. 总结</h3>
<p>通过手动使用 <code>createVNode</code> 和 <code>render</code>，我们突破了 Vue 模板的限制，实现了能够动态创建、挂载、销毁的命令式组件。</p>
<p>这也是开发高级组件（如弹窗、抽屉、通知）的必经之路。</p>
<p><strong>关键点复习</strong>：</p>
<ol>
<li><code>createVNode(Component, props)</code> 创建虚拟节点。</li>
<li><code>render(vnode, container)</code> 将虚拟节点转化为真实 DOM。</li>
<li><code>render(null, container)</code> 销毁组件，释放内存。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[async/await : 一场生成器和 Promise的里应外合]]></title>    <link>https://juejin.cn/post/7595864836360241204</link>    <guid>https://juejin.cn/post/7595864836360241204</guid>    <pubDate>2026-01-17T08:43:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595864836360241204" data-draft-id="7595858353660723234" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="async/await : 一场生成器和 Promise的里应外合"/> <meta itemprop="keywords" content="前端,JavaScript,性能优化"/> <meta itemprop="datePublished" content="2026-01-17T08:43:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="sophie旭"/> <meta itemprop="url" content="https://juejin.cn/user/2559318799692952"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            async/await : 一场生成器和 Promise的里应外合
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2559318799692952/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    sophie旭
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T08:43:33.000Z" title="Sat Jan 17 2026 08:43:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读19分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">背景</h2>
<p>说实话，async/await 我在日常工作中好像并没有很主动的去用，可能对于异步编程，我宁愿去用 Promise这种显式链式方式告诉自己，这是异步流程。同步式的代码让我有点心有余悸，为啥会这样放着更过“高级”的API不用呢？我想可能有一方面的原因是，我对它的了解不深吧，或者只停留在了解吧，这两天看了下 async/await 的原理，发现它并没有那么神秘，并且是站在两位巨人的肩膀上的。</p>
<h2 data-id="heading-1">巨人一号：生成器 Generator</h2>
<h3 data-id="heading-2">Generator基本使用</h3>
<p>Generator相信大家都不陌生啦，我们直接上代码看运行结果吧</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 定义一个生成器函数（普通函数 + *）</span>
<span class="hljs-keyword">function</span>* <span class="hljs-title function_">numberGenerator</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"生成器函数开始执行"</span>);
  
  <span class="hljs-comment">// 第一次yield，向外返回值</span>
  <span class="hljs-keyword">const</span> firstValue = <span class="hljs-keyword">yield</span> <span class="hljs-number">1</span>; <span class="hljs-comment">// yield左边可以接收next传入的参数</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"第一个yield接收到的参数:"</span>, firstValue);
  
  <span class="hljs-comment">// 第二次yield</span>
  <span class="hljs-keyword">const</span> secondValue = <span class="hljs-keyword">yield</span> <span class="hljs-number">2</span>;
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"第二个yield接收到的参数:"</span>, secondValue);
  
  <span class="hljs-comment">// 第三次yield</span>
  <span class="hljs-keyword">yield</span> <span class="hljs-number">3</span>;
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"生成器函数即将执行完毕"</span>);
  
  <span class="hljs-comment">// 函数结束，done会变为true</span>
  <span class="hljs-keyword">return</span> <span class="hljs-string">"执行结束"</span>;
}

<span class="hljs-comment">// 1. 调用生成器函数，不会执行函数体，只会得到生成器对象</span>
<span class="hljs-keyword">const</span> generator = <span class="hljs-title function_">numberGenerator</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"调用生成器函数后得到的对象:"</span>, generator); <span class="hljs-comment">// 输出 Generator 对象，无函数体执行日志</span>

<span class="hljs-comment">// 2. 第一次调用next()，函数体开始执行，直到第一个yield暂停</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"第一次next返回:"</span>, generator.<span class="hljs-title function_">next</span>()); 
<span class="hljs-comment">// 输出：</span>
<span class="hljs-comment">// 生成器函数开始执行</span>
<span class="hljs-comment">// 第一次next返回: { value: 1, done: false }</span>

<span class="hljs-comment">// 3. 第二次调用next()并传入参数，参数会作为上一个yield的返回值</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"第二次next返回:"</span>, generator.<span class="hljs-title function_">next</span>(<span class="hljs-string">"我是第一个yield的返回值"</span>));
<span class="hljs-comment">// 输出：</span>
<span class="hljs-comment">// 第一个yield接收到的参数: 我是第一个yield的返回值</span>
<span class="hljs-comment">// 第二次next返回: { value: 2, done: false }</span>

<span class="hljs-comment">// 4. 第三次调用next()并传入参数</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"第三次next返回:"</span>, generator.<span class="hljs-title function_">next</span>(<span class="hljs-string">"我是第二个yield的返回值"</span>));
<span class="hljs-comment">// 输出：</span>
<span class="hljs-comment">// 第二个yield接收到的参数: 我是第二个yield的返回值</span>
<span class="hljs-comment">// 生成器函数即将执行完毕</span>
<span class="hljs-comment">// 第三次next返回: { value: 3, done: false }</span>

<span class="hljs-comment">// 5. 第四次调用next()，函数执行到return，done变为true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"第四次next返回:"</span>, generator.<span class="hljs-title function_">next</span>());
<span class="hljs-comment">// 输出：</span>
<span class="hljs-comment">// 第四次next返回: { value: '执行结束', done: true }</span>

<span class="hljs-comment">// 6. 后续调用next()，value为undefined，done保持true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"第五次next返回:"</span>, generator.<span class="hljs-title function_">next</span>());
<span class="hljs-comment">// 输出：</span>
<span class="hljs-comment">// 第五次next返回: { value: undefined, done: true }</span>
</code></pre>
<h4 data-id="heading-3">关键特性解释</h4>
<ol>
<li><strong>生成器函数定义</strong>：<code>function* 函数名()</code> 是生成器函数的语法（<code>*</code> 的位置可以在 <code>function</code> 后、函数名前，空格不影响），这是和普通函数最核心的区别。</li>
<li><strong>调用不执行</strong>：调用 <code>numberGenerator()</code> 不会执行函数体，只会返回一个 <code>Generator</code> 对象，这和普通函数调用立即执行完全不同。</li>
<li><strong>yield 暂停与返回</strong>：
<ul>
<li><code>yield</code> 是生成器的核心关键词，执行到 <code>yield</code> 时，函数会<strong>暂停执行</strong>（而非结束），并将 <code>yield</code> 后的值作为 <code>next()</code> 返回对象的 <code>value</code>。</li>
<li><code>yield</code> 不像 <code>return</code> 那样终止函数，下次调用 <code>next()</code> 会从暂停的位置继续执行。</li>
</ul>
</li>
<li><strong>next 传参</strong>：<code>generator.next(参数)</code> 传入的参数，会作为<strong>上一个 <code>yield</code> 语句的返回值</strong>（注意：第一个 <code>next()</code> 传参无效，因为此时还没有执行过任何 <code>yield</code>）。</li>
<li><strong>done 属性</strong>：<code>next()</code> 返回对象的 <code>done</code> 属性表示生成器是否执行完毕：
<ul>
<li><code>false</code>：生成器未执行完，还能继续调用 <code>next()</code> 获取值；</li>
<li><code>true</code>：生成器执行完毕（执行到 <code>return</code> 或函数末尾），<strong>后续 <code>next()</code> 的 <code>value</code> 为 <code>undefined</code>(这一点我经常忽略)。</strong></li>
</ul>
</li>
</ol>
<h4 data-id="heading-4">总结</h4>
<ol>
<li>生成器函数通过 <code>function*</code> 定义，调用后返回生成器对象，而非立即执行函数体。</li>
<li><code>yield</code> 负责暂停函数并向外返回值，<code>next()</code> 负责恢复执行，且 <code>next()</code> 可传参作为上一个 <code>yield</code> 的返回值。</li>
<li><code>next()</code> 返回的对象包含 <code>value</code>（返回值）和 <code>done</code>（执行状态），<code>done: true</code> 表示生成器执行完毕。</li>
</ol>
<h3 data-id="heading-5">Generator throw</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 定义一个包含异常处理的生成器函数</span>
<span class="hljs-keyword">function</span>* <span class="hljs-title function_">fooGenerator</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"fooGenerator 开始执行（第一次next触发）"</span>);
  
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 第一个yield：暂停并返回值，后续可能接收next传参</span>
    <span class="hljs-keyword">const</span> receivedValue = <span class="hljs-keyword">yield</span> <span class="hljs-string">"第一个yield返回值"</span>;
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"第一个yield接收到next的参数:"</span>, receivedValue);

    <span class="hljs-comment">// 执行到这里时，如果外部调用throw()，异常会抛到当前执行位置</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"准备执行第二个yield..."</span>);
    <span class="hljs-keyword">yield</span> <span class="hljs-string">"第二个yield返回值"</span>;

    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"生成器未被中断，继续执行"</span>);
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-comment">// 捕获外部throw()抛出的异常</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"生成器内部捕获到异常:"</span>, error.<span class="hljs-property">message</span>);
    <span class="hljs-comment">// 捕获异常后，生成器可继续yield返回值</span>
    <span class="hljs-keyword">yield</span> <span class="hljs-string">"异常捕获后返回的兜底值"</span>;
  }

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"生成器函数执行到末尾"</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-string">"执行结束"</span>;
}

<span class="hljs-comment">// 1. 调用生成器函数，仅得到生成器对象，函数体不执行</span>
<span class="hljs-keyword">const</span> generator = <span class="hljs-title function_">fooGenerator</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"调用fooGenerator后得到的对象:"</span>, generator); <span class="hljs-comment">// Generator 对象</span>

<span class="hljs-comment">// 2. 第一次调用next()：函数体开始执行，直到第一个yield暂停</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"===== 第一次调用 next() ====="</span>);
<span class="hljs-keyword">const</span> firstNext = generator.<span class="hljs-title function_">next</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"第一次next返回:"</span>, firstNext);
<span class="hljs-comment">// 输出：</span>
<span class="hljs-comment">// fooGenerator 开始执行（第一次next触发）</span>
<span class="hljs-comment">// 第一次next返回: { value: '第一个yield返回值', done: false }</span>

<span class="hljs-comment">// 3. 第二次调用next(参数)：从第一个yield暂停处继续执行，参数作为yield返回值</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"\n===== 第二次调用 next('bar') ====="</span>);
<span class="hljs-keyword">const</span> secondNext = generator.<span class="hljs-title function_">next</span>(<span class="hljs-string">"bar"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"第二次next返回:"</span>, secondNext);
<span class="hljs-comment">// 输出：</span>
<span class="hljs-comment">// 第一个yield接收到next的参数: bar</span>
<span class="hljs-comment">// 准备执行第二个yield...</span>
<span class="hljs-comment">// 第二次next返回: { value: '第二个yield返回值', done: false }</span>

<span class="hljs-comment">// 4. 调用throw()：从第二个yield暂停处继续执行，但抛出异常</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"\n===== 调用 throw() 方法 ====="</span>);
<span class="hljs-keyword">const</span> throwResult = generator.<span class="hljs-keyword">throw</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"外部手动抛出的异常"</span>));
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"throw()返回:"</span>, throwResult);
<span class="hljs-comment">// 输出：</span>
<span class="hljs-comment">// 生成器内部捕获到异常: 外部手动抛出的异常</span>
<span class="hljs-comment">// throw()返回: { value: '异常捕获后返回的兜底值', done: false }</span>

<span class="hljs-comment">// 5. 异常捕获后，生成器仍可继续执行next()</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"\n===== 异常后调用 next() ====="</span>);
<span class="hljs-keyword">const</span> thirdNext = generator.<span class="hljs-title function_">next</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"第三次next返回:"</span>, thirdNext);
<span class="hljs-comment">// 输出：</span>
<span class="hljs-comment">// 生成器函数执行到末尾</span>
<span class="hljs-comment">// 第三次next返回: { value: '执行结束', done: true }</span>
</code></pre>
<h4 data-id="heading-6">throw() 方法核心逻辑解释</h4>
<ol>
<li><strong>throw() 的执行触发</strong>：
<ul>
<li>和 <code>next()</code> 一样，调用 <code>generator.throw()</code> 会让生成器从<strong>上一次暂停的位置</strong>继续执行；</li>
<li>但不同于 <code>next()</code> 传入普通参数，<code>throw()</code> 会在生成器当前执行位置<strong>主动抛出一个异常</strong> -- <strong>意思就是 从当前位置直接去走catch逻辑，try逻辑不会再走了</strong>。</li>
</ul>
</li>
<li><strong>异常的捕获与处理</strong>：
<ul>
<li>如果生成器内部有 <code>try/catch</code> 块包裹了暂停位置后的执行逻辑，异常会被内部捕获，生成器不会立即终止；</li>
<li>如果内部没有捕获，异常会抛出到外部，生成器状态变为 <code>done: true</code>，后续调用 <code>next()</code> 只会返回 <code>{ value: undefined, done: true }</code>。</li>
</ul>
</li>
<li><strong>throw() 的返回值</strong>：
<ul>
<li>即使抛出了异常，只要内部捕获了，<code>throw()</code> 也会返回和 <code>next()</code> 一样的对象（<code>{ value, done }</code>）；</li>
<li>这个 <code>value</code> 是异常捕获后，生成器继续执行到下一个 <code>yield</code> 时返回的值（示例中就是 <code>异常捕获后返回的兜底值</code>）。</li>
</ul>
</li>
</ol>
<h4 data-id="heading-7">总结</h4>
<ol>
<li><code>throw()</code> 方法和 <code>next()</code> 一样能触发生成器继续执行，但核心作用是<strong>向生成器内部抛出异常</strong>；</li>
<li>生成器内部可通过 <code>try/catch</code> 捕获 <code>throw()</code> 抛出的异常，捕获后生成器不会终止，仍可继续执行并返回新的 <code>yield</code> 值；</li>
<li>生成器的执行始终是“暂停-恢复”模式：<code>next()</code> 恢复执行并传参，<code>throw()</code> 恢复执行并抛异常，本质都是改变生成器的执行状态。</li>
</ol>
<p><code>这个特性在异步编程中很实用，比如可以用 </code>throw()<code> 主动终止异步任务、处理异步流程中的错误等。</code></p>
<h2 data-id="heading-8">巨人二号：Promise</h2>
<p>Promise大家应该再熟悉不过了，由于篇幅原因，这篇先不做深入了解</p>
<p>下面让我们看看他们结合在一起会发生什么吧</p>
<h2 data-id="heading-9">“回调式” 写法 =》 “同步式” 写法</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 传统 Promise 回调写法：有明显的回调嵌套感，代码“右移”</span>
<span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://jsonplaceholder.typicode.com/todos/1'</span>)
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.<span class="hljs-title function_">json</span>())
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'请求结果:'</span>, data);
    <span class="hljs-comment">// 如果还要发第二个请求，就要在这继续嵌套 then，越套越深</span>
    <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`https://jsonplaceholder.typicode.com/todos/<span class="hljs-subst">${data.id + <span class="hljs-number">1</span>}</span>`</span>)
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>())
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data2</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'第二个请求结果:'</span>, data2));
  })
  .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'错误:'</span>, error));
</code></pre>
<p>以上代码，我们看到 虽然用到了Promise，但是也难免会出现嵌套，下面我们看看下面这段代码，</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 模拟 Ajax 请求：返回 Promise（真实项目里是 fetch/axios 等）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">requestData</span>(<span class="hljs-params">url</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">fetch</span>(url)
    .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.<span class="hljs-title function_">json</span>()) <span class="hljs-comment">// 解析 JSON 数据</span>
    .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'请求失败:'</span>, error));
}

<span class="hljs-comment">// 定义生成器函数 main：内部用 yield 暂停，写“同步风格”的异步逻辑</span>
<span class="hljs-keyword">function</span>* <span class="hljs-title function_">main</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'开始执行生成器，准备发请求'</span>);
  
  <span class="hljs-comment">// 1. yield 抛出 Promise（Ajax 请求），生成器暂停执行</span>
  <span class="hljs-comment">// 这里的 result 会接收后续 next(data) 传进来的请求结果</span>
  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">yield</span> <span class="hljs-title function_">requestData</span>(<span class="hljs-string">'https://jsonplaceholder.typicode.com/todos/1'</span>);
  
  <span class="hljs-comment">// 3. 当外部调用 next(data) 后，生成器从暂停处恢复，执行这行</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'生成器内部拿到的请求结果:'</span>, result);
  
  <span class="hljs-comment">// 可以继续发第二个请求，依然是“同步写法”</span>
  <span class="hljs-keyword">const</span> result2 = <span class="hljs-keyword">yield</span> <span class="hljs-title function_">requestData</span>(<span class="hljs-string">`https://jsonplaceholder.typicode.com/todos/<span class="hljs-subst">${result.id + <span class="hljs-number">1</span>}</span>`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'第二个请求结果:'</span>, result2);
}

<span class="hljs-comment">// 外界执行生成器的逻辑</span>
<span class="hljs-keyword">const</span> generator = <span class="hljs-title function_">main</span>(); <span class="hljs-comment">// 1. 调用生成器，得到生成器对象（函数体不执行）</span>

<span class="hljs-comment">// 2. 第一次调用 next()：生成器开始执行，直到第一个 yield 暂停</span>
<span class="hljs-keyword">const</span> firstNextResult = generator.<span class="hljs-title function_">next</span>(); 
<span class="hljs-comment">// firstNextResult.value 就是 yield 抛出的 Promise（requestData 的返回值）</span>
<span class="hljs-keyword">const</span> promise = firstNextResult.<span class="hljs-property">value</span>;

<span class="hljs-comment">// 3. 等 Promise 执行完成（请求返回），把结果传给生成器</span>
promise.<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
  <span class="hljs-comment">// 调用 next(data)：把请求结果传进去，生成器从 yield 处恢复执行</span>
  generator.<span class="hljs-title function_">next</span>(data);
  
  <span class="hljs-comment">// 第二个请求的处理（如果有）：这里可以封装成自动执行逻辑，不用手动写</span>
  <span class="hljs-keyword">const</span> secondNextResult = generator.<span class="hljs-title function_">next</span>();
  secondNextResult.<span class="hljs-property">value</span>.<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data2</span> =&gt;</span> {
    generator.<span class="hljs-title function_">next</span>(data2);
  });
});
</code></pre>
<h4 data-id="heading-10">逐行解释（对应你的描述）</h4>
<ol>
<li>
<p><strong>定义生成器函数 <code>main</code></strong>：</p>
<ul>
<li>内部 <code>yield requestData(...)</code>：<code>requestData</code> 返回 Promise（Ajax 请求），<code>yield</code> 会把这个 Promise 抛出去，同时<strong>暂停生成器的执行</strong>（不会立刻执行后面的 <code>console.log</code>）。</li>
<li><code>const result = yield ...</code>：这里的 <code>result</code> 暂时没有值，要等后续把请求结果传进来才会赋值。</li>
</ul>
</li>
<li>
<p><strong>外界调用生成器</strong>：</p>
<ul>
<li><code>const generator = main()</code>：调用生成器函数，只得到生成器对象，<code>main</code> 的函数体<strong>完全不执行</strong>。</li>
<li><code>generator.next()</code>：第一次调用 <code>next</code>，<code>main</code> 开始执行，直到遇到 <code>yield</code> 暂停；<code>next()</code> 返回的对象 <code>{ value: Promise, done: false }</code> 中，<code>value</code> 就是 <code>yield</code> 抛出来的 Promise（Ajax 请求）。</li>
</ul>
</li>
<li>
<p><strong>处理 Promise 结果，恢复生成器</strong>：</p>
<ul>
<li>给 Promise 加 <code>then</code> 回调，等请求返回拿到 <code>data</code> 后，调用 <code>generator.next(data)</code>：
<ul>
<li><code>data</code> 会作为<strong>上一个 <code>yield</code> 语句的返回值</strong>，赋值给 <code>main</code> 里的 <code>result</code>；</li>
<li>生成器从暂停的 <code>yield</code> 位置<strong>继续执行</strong>，执行后面的 <code>console.log(result)</code> —— 这一步就像“同步代码”一样，直接拿到了异步请求的结果。</li>
</ul>
</li>
</ul>
</li>
</ol>
<h4 data-id="heading-11">为什么说“消灭了回调，近乎同步体验”</h4>
<p>对比两种写法：</p>
<ul>
<li>传统 Promise：请求结果的处理逻辑必须写在 <code>then</code> 回调里（异步风格）；</li>
<li>生成器写法：<code>main</code> 内部没有任何 <code>then</code> 回调，<code>const result = yield ...</code> 看起来就像“同步赋值”，拿到结果后直接 <code>console.log</code> —— 代码结构和同步代码完全一致，只是多了 <code>yield</code> 关键字。</li>
</ul>
<h4 data-id="heading-12">总结</h4>
<ol>
<li>核心目的：用生成器的 <code>yield</code> 暂停特性，把异步 Promise 的“回调式”写法，改成生成器内部的“同步式”写法，消灭回调嵌套；</li>
<li>核心流程：生成器 <code>yield</code> 抛出 Promise → 等 Promise 执行完成 → 调用 <code>next(结果)</code> 把值传回生成器 → 生成器恢复执行，拿到结果；</li>
</ol>
<h2 data-id="heading-13">等一下，怎么看着更复杂了？？</h2>
<p>不知道你发现没有发出疑问，经过转换，怎么比我写个嵌套更复杂了？别着急，我们一步步简化！</p>
<h4 data-id="heading-14">先看问题：手动处理多个 yield 的弊端</h4>
<p>如果 <code>main</code> 里有 3 个 <code>yield</code>（3 次 Ajax 请求），手动处理会写成这样，重复代码特别多：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 手动处理多个 yield 的糟糕写法（仅举例，不要这么写）</span>
<span class="hljs-keyword">const</span> gen = <span class="hljs-title function_">main</span>();
<span class="hljs-comment">// 处理第一个请求</span>
<span class="hljs-keyword">let</span> res1 = gen.<span class="hljs-title function_">next</span>();
res1.<span class="hljs-property">value</span>.<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data1</span> =&gt;</span> {
  <span class="hljs-comment">// 处理第二个请求</span>
  <span class="hljs-keyword">let</span> res2 = gen.<span class="hljs-title function_">next</span>(data1);
  res2.<span class="hljs-property">value</span>.<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data2</span> =&gt;</span> {
    <span class="hljs-comment">// 处理第三个请求</span>
    <span class="hljs-keyword">let</span> res3 = gen.<span class="hljs-title function_">next</span>(data2);
    res3.<span class="hljs-property">value</span>.<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data3</span> =&gt;</span> {
      gen.<span class="hljs-title function_">next</span>(data3); <span class="hljs-comment">// 最后一次 next</span>
    });
  });
});
</code></pre>
<p>这种写法和回调嵌套没区别，完全违背了用生成器简化异步的初衷 —— 而<strong>递归自动执行器</strong>就是解决这个问题的关键。</p>
<h4 data-id="heading-15">核心思路：递归自动执行器</h4>
<p>我们写一个通用的递归函数（比如叫 <code>runGenerator</code>），它会：</p>
<ol>
<li>调用生成器的 <code>next()</code>，拿到返回结果（包含 <code>value</code>（Promise）和 <code>done</code>）；</li>
<li>判断 <code>done</code>：如果是 <code>true</code>，递归终止；</li>
<li>如果是 <code>false</code>，给 <code>value</code>（Promise）加 <code>then</code> 回调；</li>
<li>在 <code>then</code> 里拿到异步结果，再<strong>递归调用自身</strong>，把结果传给 <code>next()</code>，继续处理下一个 <code>yield</code>。</li>
</ol>
<h4 data-id="heading-16">完整代码示例（含递归执行器）</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. 模拟 Ajax 请求：返回 Promise</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">requestData</span>(<span class="hljs-params">url</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">fetch</span>(url)
    .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>())
    .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'请求失败:'</span>, err));
}

<span class="hljs-comment">// 2. 定义有多个 yield 的生成器函数</span>
<span class="hljs-keyword">function</span>* <span class="hljs-title function_">main</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'开始第一个请求'</span>);
  <span class="hljs-comment">// 第一个 yield：请求 todo/1</span>
  <span class="hljs-keyword">const</span> result1 = <span class="hljs-keyword">yield</span> <span class="hljs-title function_">requestData</span>(<span class="hljs-string">'https://jsonplaceholder.typicode.com/todos/1'</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'第一个请求结果:'</span>, result1);

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'开始第二个请求'</span>);
  <span class="hljs-comment">// 第二个 yield：基于第一个结果请求 todo/2</span>
  <span class="hljs-keyword">const</span> result2 = <span class="hljs-keyword">yield</span> <span class="hljs-title function_">requestData</span>(<span class="hljs-string">`https://jsonplaceholder.typicode.com/todos/<span class="hljs-subst">${result1.id + <span class="hljs-number">1</span>}</span>`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'第二个请求结果:'</span>, result2);

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'开始第三个请求'</span>);
  <span class="hljs-comment">// 第三个 yield：基于第二个结果请求 todo/3</span>
  <span class="hljs-keyword">const</span> result3 = <span class="hljs-keyword">yield</span> <span class="hljs-title function_">requestData</span>(<span class="hljs-string">`https://jsonplaceholder.typicode.com/todos/<span class="hljs-subst">${result2.id + <span class="hljs-number">1</span>}</span>`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'第三个请求结果:'</span>, result3);

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'所有请求执行完毕'</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-string">'最终结果'</span>;
}

<span class="hljs-comment">// 3. 核心：递归自动执行器（通用函数，任何生成器都能用）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">runGenerator</span>(<span class="hljs-params">generator</span>) {
  <span class="hljs-comment">// 定义递归函数</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">next</span>(<span class="hljs-params">data</span>) {
    <span class="hljs-comment">// 调用 next()，拿到当前执行结果（{ value: Promise, done: boolean }）</span>
    <span class="hljs-keyword">const</span> result = generator.<span class="hljs-title function_">next</span>(data);

    <span class="hljs-comment">// 终止条件：如果 done 为 true，递归结束</span>
    <span class="hljs-keyword">if</span> (result.<span class="hljs-property">done</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'生成器执行完毕，最终返回值:'</span>, result.<span class="hljs-property">value</span>);
      <span class="hljs-keyword">return</span>; <span class="hljs-comment">// 终止递归</span>
    }

    <span class="hljs-comment">// 如果 done 为 false，处理当前的 Promise</span>
    result.<span class="hljs-property">value</span>
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
        <span class="hljs-comment">// 递归调用 next，把当前 Promise 的结果传给下一个 yield</span>
        <span class="hljs-title function_">next</span>(data);
      })
      .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
        <span class="hljs-comment">// 处理异常：也可以调用 generator.throw(err) 抛到生成器内部</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'异步执行出错:'</span>, err);
      });
  }

  <span class="hljs-comment">// 启动第一次递归（第一次 next 不传参，因为第一个 yield 左边没值可接）</span>
  <span class="hljs-title function_">next</span>();
}

<span class="hljs-comment">// 4. 启动执行器，自动处理所有 yield</span>
<span class="hljs-title function_">runGenerator</span>(<span class="hljs-title function_">main</span>());
</code></pre>
<h4 data-id="heading-17">逐行解释递归执行器的逻辑</h4>
<ol>
<li><strong>执行器初始化</strong>：调用 <code>runGenerator(main())</code>，先创建生成器对象，再执行 <code>next()</code>（无参），启动第一次递归。</li>
<li><strong>第一次递归</strong>：
<ul>
<li><code>generator.next()</code> → 执行 <code>main</code> 到第一个 <code>yield</code>，返回 <code>{ value: 第一个请求的 Promise, done: false }</code>；</li>
<li>因为 <code>done: false</code>，给 Promise 加 <code>then</code>；</li>
<li>等第一个请求返回 <code>data1</code>，递归调用 <code>next(data1)</code>。</li>
</ul>
</li>
<li><strong>第二次递归</strong>：
<ul>
<li><code>generator.next(data1)</code> → <code>data1</code> 赋值给 <code>result1</code>，<code>main</code> 执行到第二个 <code>yield</code>，返回 <code>{ value: 第二个请求的 Promise, done: false }</code>；</li>
<li>给第二个 Promise 加 <code>then</code>，拿到 <code>data2</code> 后递归调用 <code>next(data2)</code>。</li>
</ul>
</li>
<li><strong>第三次递归</strong>：
<ul>
<li><code>generator.next(data2)</code> → <code>data2</code> 赋值给 <code>result2</code>，<code>main</code> 执行到第三个 <code>yield</code>，返回 <code>{ value: 第三个请求的 Promise, done: false }</code>；</li>
<li>拿到 <code>data3</code> 后递归调用 <code>next(data3)</code>。</li>
</ul>
</li>
<li><strong>第四次递归</strong>：
<ul>
<li><code>generator.next(data3)</code> → <code>data3</code> 赋值给 <code>result3</code>，<code>main</code> 执行到末尾，返回 <code>{ value: '最终结果', done: true }</code>；</li>
<li>检测到 <code>done: true</code>，递归终止。</li>
</ul>
</li>
</ol>
<h4 data-id="heading-18">为什么递归能解决问题？</h4>
<ul>
<li><strong>自动迭代</strong>：不管 <code>main</code> 里有多少个 <code>yield</code>，递归都会自动处理，不用手动写每一次的 <code>next()</code> 和 <code>then()</code>；</li>
<li><strong>终止条件清晰</strong>：靠 <code>done: true</code> 判断生成器是否执行完，避免无限递归；</li>
<li><strong>代码复用</strong>：<code>runGenerator</code> 是通用函数，任何“yield 出 Promise”的生成器都能直接用，不用改逻辑。</li>
</ul>
<h2 data-id="heading-19"><strong>生成器 + Promise 实现异步同步化</strong> 完整方案</h2>
<h4 data-id="heading-20">再梳理这个“完整执行器”的核心逻辑</h4>
<p>把我们之前的“简化版递归执行器”升级成<strong>工业级的 co 函数</strong>，完整逻辑如下（伪代码梳理）：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. 定义通用执行器 co</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">co</span>(<span class="hljs-params">generatorFunc</span>) {
  <span class="hljs-comment">// 创建生成器对象</span>
  <span class="hljs-keyword">const</span> generator = <span class="hljs-title function_">generatorFunc</span>();

  <span class="hljs-comment">// 2. 定义递归处理函数 handlerResult</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handlerResult</span>(<span class="hljs-params">result</span>) {
    <span class="hljs-comment">// 终止条件：生成器执行完毕</span>
    <span class="hljs-keyword">if</span> (result.<span class="hljs-property">done</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(result.<span class="hljs-property">value</span>); <span class="hljs-comment">// 最终返回 Promise，对齐 async 函数</span>
    }

    <span class="hljs-comment">// 处理 Promise（成功/失败）</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(result.<span class="hljs-property">value</span>) <span class="hljs-comment">// 确保 value 是 Promise（兼容非 Promise 情况）</span>
      .<span class="hljs-title function_">then</span>(
        <span class="hljs-comment">// 成功回调：把结果传给 next，递归处理下一个 result</span>
        <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> <span class="hljs-title function_">handlerResult</span>(generator.<span class="hljs-title function_">next</span>(data)),
        <span class="hljs-comment">// 失败回调：调用 throw() 抛异常给生成器内部</span>
        <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> <span class="hljs-title function_">handlerResult</span>(generator.<span class="hljs-keyword">throw</span>(error))
      );
  }

  <span class="hljs-comment">// 3. 启动递归：传入第一次 next() 的结果</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">handlerResult</span>(generator.<span class="hljs-title function_">next</span>());
}

<span class="hljs-comment">// 4. 生成器内部用 try/catch 捕获异常</span>
<span class="hljs-keyword">function</span>* <span class="hljs-title function_">main</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> res1 = <span class="hljs-keyword">yield</span> <span class="hljs-title function_">requestData</span>(<span class="hljs-string">'url1'</span>);
    <span class="hljs-keyword">const</span> res2 = <span class="hljs-keyword">yield</span> <span class="hljs-title function_">requestData</span>(<span class="hljs-string">'url2'</span>);
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'捕获异常:'</span>, err); <span class="hljs-comment">// 捕获 generator.throw() 抛的异常</span>
  }
}

<span class="hljs-comment">// 5. 调用 co 执行生成器（通用复用）</span>
<span class="hljs-title function_">co</span>(main).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">finalRes</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'最终结果:'</span>, finalRes));
</code></pre>
<h4 data-id="heading-21">总结</h4>
<p>这些内容，是我们之前讨论的<strong>生成器+Promise 实现异步同步化</strong>的“完整版落地”：</p>
<ol>
<li>核心逻辑完全一致：递归执行器 + 暂停-恢复 + Promise 处理；</li>
<li>补充了关键细节：异常处理（<code>throw()</code> + <code>try/catch</code>）；</li>
</ol>
<h2 data-id="heading-22">好的，该 async/await登场了</h2>
<p>讲了这么多啊都没提到我们的主角，好的他们来了～</p>
<h4 data-id="heading-23">用 async/await 改写你这段手动代码</h4>
<p>你手动处理 2 个请求的代码，换成 <code>async/await</code> 后长这样，<strong>没有任何手动的 next/then</strong>，但底层逻辑完全一致：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 原生成器逻辑 → 等价的 async/await 代码</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">mainAsync</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 对应：第一次 next() + promise.then + generator.next(data)</span>
  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">requestData</span>(<span class="hljs-string">'https://jsonplaceholder.typicode.com/todos/1'</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'生成器内部拿到的请求结果:'</span>, result);

  <span class="hljs-comment">// 对应：secondNextResult = generator.next() + secondNextResult.value.then + generator.next(data2)</span>
  <span class="hljs-keyword">const</span> result2 = <span class="hljs-keyword">await</span> <span class="hljs-title function_">requestData</span>(<span class="hljs-string">`https://jsonplaceholder.typicode.com/todos/<span class="hljs-subst">${result.id + <span class="hljs-number">1</span>}</span>`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'第二个请求结果:'</span>, result2);
}

<span class="hljs-comment">// 调用 async 函数（引擎自动执行所有 next/then 逻辑）</span>
<span class="hljs-title function_">mainAsync</span>();
</code></pre>
<h4 data-id="heading-24">关键补充：async/await 不是“新东西”，是语法糖</h4>
<p><code>async/await</code> 并不是 JavaScript 新增的底层特性，它就是<strong>生成器 + 自动执行器</strong>的“语法糖”—— 本质上：</p>
<ol>
<li><code>async</code> 函数 = 生成器函数 + 内置自动执行器；</li>
<li><code>await</code> 关键字 = <code>yield</code> 关键字的“语义化包装”（更易读，不用写 <code>yield</code>）；</li>
<li>你手动写的递归执行器 → JS 引擎内置的、更高效的自动执行逻辑。</li>
</ol>
<h4 data-id="heading-25">举个更直观的例子：引擎如何处理 await</h4>
<p>当你写：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fn</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> a = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-number">1</span>);
  <span class="hljs-keyword">const</span> b = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(a + <span class="hljs-number">1</span>);
  <span class="hljs-keyword">return</span> b;
}
<span class="hljs-title function_">fn</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res)); <span class="hljs-comment">// 输出 2</span>
</code></pre>
<p>JS 引擎在底层会做这些事（对应你的手动代码）：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 引擎模拟的底层逻辑（伪代码）</span>
<span class="hljs-keyword">function</span>* <span class="hljs-title function_">fnGenerator</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> a = <span class="hljs-keyword">yield</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-number">1</span>);
  <span class="hljs-keyword">const</span> b = <span class="hljs-keyword">yield</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(a + <span class="hljs-number">1</span>);
  <span class="hljs-keyword">return</span> b;
}

<span class="hljs-comment">// 引擎内置的自动执行器（类似你写的递归函数）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">autoRun</span>(<span class="hljs-params">generator</span>) {
  <span class="hljs-keyword">const</span> gen = <span class="hljs-title function_">generator</span>();
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">next</span>(<span class="hljs-params">data</span>) {
    <span class="hljs-keyword">const</span> { value, done } = gen.<span class="hljs-title function_">next</span>(data);
    <span class="hljs-keyword">if</span> (done) <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(value);
    <span class="hljs-keyword">return</span> value.<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> <span class="hljs-title function_">next</span>(res));
  }
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">next</span>();
}

<span class="hljs-comment">// 引擎自动调用</span>
<span class="hljs-title function_">autoRun</span>(fnGenerator).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res)); <span class="hljs-comment">// 输出 2</span>
</code></pre>
<h4 data-id="heading-26">总结</h4>
<ol>
<li>你手动写的 <code>next()</code>、<code>then()</code>、传参、处理下一个 <code>yield</code> 这些操作，<strong>全部由 <code>async/await</code> 自动完成</strong>，不用你写一行；</li>
<li><code>async/await</code> 是生成器+自动执行器的语法糖，核心逻辑和你手动封装的递归执行器完全一致；</li>
<li>区别仅在于：引擎的内置执行器更高效、更健壮（处理了异常、中断等边界情况），而你手动写的是简化版。</li>
</ol>
<p>简单说：<code>async/await</code> 就是把你手动做的“脏活累活”（调 next、等 Promise、传结果）全部自动化了，让你只需要写“看起来像同步”的代码就行。</p>
<h2 data-id="heading-27"><code>async/await</code>用了哪些设计模式呢？</h2>
<p><code>async/await</code> 并不是单一的设计模式，而是<strong>组合了多个经典模式</strong>的“语法糖封装”，核心是这3个：</p>





















<table><thead><tr><th>设计模式</th><th>对应 async/await 的角色</th></tr></thead><tbody><tr><td><strong>迭代器模式（Iterator）</strong></td><td>生成器（Generator）本身就是迭代器的一种实现，<code>next()</code> 方法就是迭代器的核心（一步步“迭代”执行异步任务）；</td></tr><tr><td><strong>观察者模式（Observer）</strong></td><td>Promise 是典型的观察者模式（<code>then/catch</code> 监听 Promise 状态变化），<code>await</code> 本质是“监听 Promise 完成后通知生成器继续执行”；</td></tr><tr><td><strong>模板方法模式（Template Method）</strong></td><td>JS 引擎内置的“自动执行器”就是模板方法：把“调用 next → 等 Promise → 传参 → 递归”的固定逻辑封装成模板，<code>async/await</code> 使用者只需要写业务逻辑（await 后面的异步任务），不用关心执行流程；</td></tr></tbody></table>
<p>关于设计模式，我应该会拉出一个主题好好研究</p>
<h2 data-id="heading-28">现在你有没有理解我说的“里应外合“</h2>
<h4 data-id="heading-29">先明确“里”和“外”的角色</h4>




















<table><thead><tr><th>角色</th><th>对应代码/逻辑</th><th>核心动作</th></tr></thead><tbody><tr><td><strong>里（生成器内部）</strong></td><td><code>async</code> 函数里的 <code>await 异步任务</code></td><td>1. 抛出 Promise 给“外”；2. 暂停等待；3. 接收“外”传回来的值继续执行</td></tr><tr><td><strong>外（JS引擎/执行器）</strong></td><td>引擎内置的自动执行器</td><td>1. 接住“里”抛出来的 Promise；2. 等待 Promise 执行完成；3. 把结果传回“里”，触发继续执行</td></tr></tbody></table>
<h4 data-id="heading-30">用“里应外合”拆解完整执行流程（一步一步对应）</h4>
<p>我们用 <code>await requestData()</code> 为例，还原这个互动过程：</p>
<h5 data-id="heading-31">第一步：“里”先出招 —— 抛出 Promise，原地待命</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fn</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 「里」的动作：</span>
  <span class="hljs-comment">// 1. 执行 await requestData()，先调用 requestData 得到 Promise；</span>
  <span class="hljs-comment">// 2. 把这个 Promise “扔”给外面的引擎；</span>
  <span class="hljs-comment">// 3. 自己暂停执行（就像士兵原地待命，等外面的消息）；</span>
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">requestData</span>(<span class="hljs-string">'url'</span>); 
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res); <span class="hljs-comment">// 暂停后，这行暂时不执行</span>
}
</code></pre>
<p>👉 对应“里应外合”：<strong>里先“应”—— 抛出异步任务（Promise），告诉外面“我要等这个做完”</strong>。</p>
<h5 data-id="heading-32">第二步：“外”接招 —— 处理 Promise，等结果</h5>
<p>JS 引擎（外面的执行器）接住这个 Promise 后，不会闲着：</p>
<ol>
<li>监听 Promise 的状态变化（成功/失败）；</li>
<li>等待异步任务完成（比如接口请求返回数据）；</li>
<li>拿到结果（比如接口返回的 data）。</li>
</ol>
<p>👉 对应“里应外合”：<strong>外“合”—— 响应里面的请求，处理异步任务，拿到结果</strong>。</p>
<h5 data-id="heading-33">第三步：“外”回传结果 —— 给“里”赋值，触发继续执行</h5>
<p>引擎拿到 data 后，会做两件关键事：</p>
<ol>
<li>把 data 赋值给 <code>await</code> 左边的变量 <code>res</code>（相当于 <code>res = data</code>）；</li>
<li>告诉“里”：“结果拿到了，你继续往下走！” —— 生成器从暂停的位置恢复执行。</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fn</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">requestData</span>(<span class="hljs-string">'url'</span>); 
  <span class="hljs-comment">// 「里」的动作：</span>
  <span class="hljs-comment">// 接收到外面传的 data，赋值给 res，然后执行这行</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res); 
}
</code></pre>
<p>👉 对应“里应外合”：<strong>外把结果“合”进里面，里收到后继续执行，完成一次互动</strong>。</p>
<h5 data-id="heading-34">第四步：多轮“里应外合”（多个 await）</h5>
<p>如果有多个 <code>await</code>，就是重复上面的过程：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fn</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 第一轮里应外合：</span>
  <span class="hljs-keyword">const</span> res1 = <span class="hljs-keyword">await</span> <span class="hljs-title function_">requestData</span>(<span class="hljs-string">'url1'</span>); 
  <span class="hljs-comment">// 第二轮里应外合：</span>
  <span class="hljs-keyword">const</span> res2 = <span class="hljs-keyword">await</span> <span class="hljs-title function_">requestData</span>(<span class="hljs-string">`url2?<span class="hljs-subst">${res1.id}</span>`</span>); 
}
</code></pre>
<p>👉 里抛第一个 Promise → 外处理 → 回传 res1 → 里再抛第二个 Promise → 外处理 → 回传 res2 → 直到执行完。</p>
<h4 data-id="heading-35">补充：异常场景的“里应外合”（更完整）</h4>
<p>如果 Promise 失败（比如接口报错），互动逻辑变成：</p>
<ol>
<li>里：抛出失败的 Promise；</li>
<li>外：接住失败的 Promise，拿到错误信息；</li>
<li>外：把错误“扔回”里（对应 <code>generator.throw()</code>）；</li>
<li>里：如果有 <code>try/catch</code>，就捕获这个错误，完成“合”。</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fn</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">requestData</span>(<span class="hljs-string">'error-url'</span>); <span class="hljs-comment">// 里抛出失败的 Promise</span>
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err); <span class="hljs-comment">// 外把错误传回来，里捕获处理</span>
  }
}
</code></pre>
<h4 data-id="heading-36">记忆强化：用“里应外合”总结核心</h4>
<ol>
<li><strong>里的核心</strong>：抛 Promise 等结果，接结果继续走（“应”—— 响应异步需求，等外部反馈）；</li>
<li><strong>外的核心</strong>：接 Promise 处理完，传结果促执行（“合”—— 配合内部需求，反馈处理结果）；</li>
<li><code>async/await</code> 就是把这个“里应外合”的过程，从“手动写执行器”变成“引擎自动做”，<code>你只需要写“里”的逻辑就行。</code></li>
</ol>
<p>这个比喻完全抓住了本质 —— 生成器（里）和执行器（外）的互动，就是靠“抛 Promise-处理 Promise-传结果”完成的“里应外合”，记住这个比喻，就能记住 <code>async/await</code> 的底层执行逻辑了。</p>
<h2 data-id="heading-37">这下明白了 async/await 很多用法的底层逻辑</h2>
<h4 data-id="heading-38">一、为什么必须有 <code>async</code>？—— 标记“异步执行器容器”</h4>
<h5 data-id="heading-39">核心原因：</h5>
<p><code>async</code> 是给函数打一个“标记”，告诉 JS 引擎：<strong>这个函数内部有 <code>await</code>，需要按“生成器+自动执行器”的逻辑来处理</strong>，而不是普通函数的“一次性执行完”。</p>
<h5 data-id="heading-40">对应底层逻辑（里应外合）：</h5>
<ul>
<li>没有 <code>async</code> 的普通函数：调用后会“一口气执行完所有代码”，无法暂停；</li>
<li>加了 <code>async</code> 的函数：JS 引擎会把它当成「生成器+自动执行器」的封装体——调用 <code>async</code> 函数时，引擎先创建“生成器式”的执行上下文，为后续 <code>await</code> 的“暂停-恢复”铺路。</li>
</ul>
<h5 data-id="heading-41">记忆例子：</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 错误：没有 async，用 await 会直接报错</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">fn</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">requestData</span>(); <span class="hljs-comment">// Uncaught SyntaxError: await is only valid in async functions</span>
}

<span class="hljs-comment">// 正确：async 标记函数是“异步执行容器”</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fn</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">requestData</span>(); 
}
</code></pre>
<h4 data-id="heading-42">二、为什么要用 <code>try/catch</code>？—— 统一捕获“里应外合”的异常</h4>
<h5 data-id="heading-43">核心原因：</h5>
<p><code>await</code> 后面的 Promise 一旦失败（rejected），底层会触发 <code>generator.throw()</code> 向函数内部抛异常——如果不捕获，这个异常会变成“未捕获异常”导致程序崩溃；而 <code>try/catch</code> 是同步代码的错误处理方式，<code>async/await</code> 把异步错误“伪装”成同步错误，自然用 <code>try/catch</code> 捕获最贴合直觉。</p>
<h5 data-id="heading-44">对应底层逻辑（里应外合）：</h5>
<ul>
<li>外（引擎）：发现 Promise 失败 → 调用 <code>generator.throw(错误)</code> 把异常抛回“里”；</li>
<li>里（async 函数）：如果没有 <code>try/catch</code>，异常会从“里”逃出，变成全局未捕获异常；有 <code>try/catch</code> 则能在内部接住，和同步代码的错误处理完全一致。</li>
</ul>
<h5 data-id="heading-45">记忆例子：</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fn</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// await 后面的 Promise 失败 → 引擎抛异常到这里</span>
    <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'请求失败'</span>));
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'捕获错误:'</span>, err.<span class="hljs-property">message</span>); <span class="hljs-comment">// 输出：请求失败</span>
  }
}
</code></pre>
<h4 data-id="heading-46">三、为什么说“await 后面的代码相当于 promise.then()”？—— 都是“等待完成后执行”</h4>
<h5 data-id="heading-47">核心原因：</h5>
<p><code>await</code> 会暂停函数执行，等后面的 Promise 完成后，才执行 <code>await</code> 下面的代码——这和 <code>promise.then(回调)</code> 里“回调函数等 Promise 完成后执行”的逻辑完全一致，只是 <code>await</code> 把回调里的代码“扁平化”了。</p>
<h5 data-id="heading-48">对应底层逻辑（里应外合）：</h5>
<ul>
<li>Promise.then 写法：回调函数是“外”通知“里”执行的逻辑（观察者模式）；</li>
<li>await 写法：<code>await</code> 下面的代码，就是引擎自动帮你放到 <code>then</code> 回调里的逻辑，只是不用写回调嵌套。</li>
</ul>
<h5 data-id="heading-49">记忆对比：</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Promise.then 写法（回调嵌套）</span>
<span class="hljs-title function_">requestData</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res); <span class="hljs-comment">// 这行在 then 回调里，等 Promise 完成后执行</span>
});

<span class="hljs-comment">// async/await 写法（扁平化）</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fn</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">requestData</span>();
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res); <span class="hljs-comment">// 这行等价于上面 then 里的代码，等 Promise 完成后执行</span>
}
</code></pre>
<h4 data-id="heading-50">四、为什么说“async 函数返回的是 Promise”？—— 对齐异步生态，兼容执行器逻辑</h4>
<h5 data-id="heading-51">核心原因：</h5>
<ol>
<li>底层逻辑：<code>async</code> 函数的自动执行器最终要返回一个“结果容器”，而 Promise 是 JS 里唯一的“异步结果容器”——不管函数内部有没有 <code>await</code>，引擎都会把返回值包装成 Promise；</li>
<li>生态兼容：Promise 是 JS 异步的“通用语言”，返回 Promise 能让 <code>async</code> 函数和现有异步逻辑（<code>.then</code>/<code>.catch</code>、Promise.all 等）无缝衔接。</li>
</ol>
<h5 data-id="heading-52">记忆例子：</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. 显式返回普通值 → 自动包装成 Promise</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fn1</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-number">123</span>; <span class="hljs-comment">// 等价于 return Promise.resolve(123)</span>
}
<span class="hljs-title function_">fn1</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res)); <span class="hljs-comment">// 输出 123</span>

<span class="hljs-comment">// 2. 没有 return → 返回 Promise.resolve(undefined)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fn2</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">requestData</span>();
}
<span class="hljs-title function_">fn2</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res)); <span class="hljs-comment">// 输出 undefined</span>

<span class="hljs-comment">// 3. 抛出异常 → 返回 Promise.reject(错误)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fn3</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'出错了'</span>);
}
<span class="hljs-title function_">fn3</span>().<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err.<span class="hljs-property">message</span>)); <span class="hljs-comment">// 输出 出错了</span>
</code></pre>
<h4 data-id="heading-53">五、补充：我经常混淆的点——“await 不是返回 Promise，是等待 Promise 并取其结果”</h4>
<ul>
<li>❌ 错误：await 返回 Promise；</li>
<li>✅ 正确：<code>await</code> <strong>等待</strong> 后面的 Promise 完成，然后<strong>取出 Promise 的最终结果</strong>（成功值/失败抛异常）。</li>
</ul>
<h5 data-id="heading-54">例子验证：</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fn</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// requestData() 返回 Promise，await 等待它完成，取出结果赋值给 res</span>
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">requestData</span>(); 
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res); <span class="hljs-comment">// res 是 Promise 的成功值（比如接口返回的 data），不是 Promise</span>
}
</code></pre>
<p>对应到底层执行器的逻辑：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 对应的生成器函数</span>
<span class="hljs-keyword">function</span>* <span class="hljs-title function_">genFn</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">yield</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-number">1</span>); <span class="hljs-comment">// await 的底层：yield 抛 Promise，等结果</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res); <span class="hljs-comment">// res = 1（next 传进来的）</span>
  <span class="hljs-keyword">return</span> <span class="hljs-number">3</span>; <span class="hljs-comment">// 生成器最终的 value = 3</span>
}

<span class="hljs-comment">// 执行器处理</span>
<span class="hljs-title function_">autoRun</span>(genFn).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">val</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(val)); <span class="hljs-comment">// 输出 3</span>
<span class="hljs-comment">// autoRun 里的逻辑：</span>
<span class="hljs-comment">// - 第一次 next()：yield 出 Promise.resolve(1)，等待完成后 next(1)</span>
<span class="hljs-comment">// - 第二次 next(1)：res = 1，执行到 return 3，done = true</span>
<span class="hljs-comment">// - 触发 if (done)，返回 Promise.resolve(3) → 这就是 async 函数的返回值</span>
</code></pre>
<p><code>记忆口诀：</code>await<code> 取 Promise 的“值”，</code>async<code> 包返回值成“Promise”——前者是“拆包”，后者是“打包”。</code></p>
<h4 data-id="heading-55">总结（核心记忆点）</h4>
<p>把这些“为什么”浓缩成4句话，记下来就彻底懂了：</p>
<ol>
<li><code>async</code> 是“容器标记”：告诉引擎这个函数要按“生成器+自动执行器”逻辑跑；</li>
<li><code>try/catch</code> 是“异常兜底”：接住引擎从外部抛回的 Promise 失败异常；</li>
<li><code>await</code> 下面的代码 = <code>then</code> 回调：都是等 Promise 完成后执行，只是写法更平；</li>
<li><code>async</code> 函数返回 Promise：对齐异步生态，让结果能被 <code>.then</code>/<code>.catch</code> 处理。</li>
</ol>
<p>本质上，<code>async/await</code> 所有的“规则”（必须加 async、用 try/catch 等），都是为了让“生成器+自动执行器”的底层逻辑，能以“同步代码”的形式呈现——这也是它最巧妙的地方。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从零构建本地AI应用：React与Ollama全栈开发实战]]></title>    <link>https://juejin.cn/post/7595890117865504814</link>    <guid>https://juejin.cn/post/7595890117865504814</guid>    <pubDate>2026-01-17T09:39:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595890117865504814" data-draft-id="7595886887522975784" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从零构建本地AI应用：React与Ollama全栈开发实战"/> <meta itemprop="keywords" content="Ollama,全栈,VibeCoding"/> <meta itemprop="datePublished" content="2026-01-17T09:39:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="秃头敲码小姐姐"/> <meta itemprop="url" content="https://juejin.cn/user/24668014656249"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从零构建本地AI应用：React与Ollama全栈开发实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/24668014656249/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    秃头敲码小姐姐
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T09:39:34.000Z" title="Sat Jan 17 2026 09:39:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    10
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">博客开篇：为什么选择本地大模型开发？</h3>
<p>在当前的AI浪潮中，OpenAI等云端API虽然强大，但存在数据隐私、Token成本和网络延迟的问题。<strong>Ollama</strong> 的出现，让开发者可以在本地轻松部署开源大模型（如Qwen、Llama 3等）。结合前端框架（如React），我们可以构建完全私有、低成本的AI应用。</p>
<p>本博客将带你从环境搭建到代码实现，一步步构建一个基于 React 和 Ollama 的聊天应用，并深入剖析其中的技术细节。</p>
<hr/>
<h3 data-id="heading-1">第一部分：环境与基础架构</h3>
<h4 data-id="heading-2">1.1 Ollama 核心原理</h4>
<p>Ollama 是一个在本地运行大型语言模型的工具。它通过一个简单的命令行接口，让开发者可以拉取（Pull）、运行（Run）和管理模型。</p>
<ul>
<li>
<p><strong>核心命令：</strong></p>
<ul>
<li><code>ollama pull qwen2.5:0.5b</code>：拉取特定版本的千问模型。</li>
<li><code>ollama run qwen2.5:0.5b</code>：启动模型。</li>
<li><strong>端口服务：</strong> Ollama 默认在 <code>11434</code> 端口提供服务，且提供了兼容 OpenAI 格式的 <code>/v1/chat/completions</code> 接口。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-3">1.2 项目初始化</h4>
<p>我们需要一个 React 项目来作为前端界面。使用 Vite 或 Create React App 初始化项目，并安装必要的依赖（如 <code>axios</code> 用于 HTTP 请求）。</p>
<hr/>
<h3 data-id="heading-4">第二部分：后端通信层（API 模块）</h3>
<p>这是应用的“神经系统”，负责前端与本地大模型的对话。</p>
<h4 data-id="heading-5">2.1 代码逻辑解析</h4>
<p>在提供的代码中，<code>ollamaApi.js</code> 文件负责创建与 Ollama 服务的连接。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>;

<span class="hljs-comment">// 创建 axios 实例</span>
<span class="hljs-keyword">const</span> ollamaApi = axios.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">baseURL</span>: <span class="hljs-string">'http://localhost:11434/v1'</span>, <span class="hljs-comment">// 指向本地 Ollama 服务</span>
  <span class="hljs-attr">headers</span>: {
    <span class="hljs-string">'Authorization'</span>: <span class="hljs-string">'Bearer ollama'</span>, <span class="hljs-comment">// 注意：Ollama 的固定 Token</span>
    <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>,
  }
});

<span class="hljs-comment">// 封装聊天请求函数</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">chatCompletions</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">messages</span>) =&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> ollamaApi.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/chat/completions'</span>, {
      <span class="hljs-attr">model</span>: <span class="hljs-string">'qwen2.5:0.5b'</span>, <span class="hljs-comment">// 指定模型名称</span>
      messages, <span class="hljs-comment">// 对话历史</span>
      <span class="hljs-attr">stream</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 关闭流式输出（简化处理）</span>
      <span class="hljs-attr">temperature</span>: <span class="hljs-number">0.7</span>, <span class="hljs-comment">// 控制生成文本的随机性</span>
    });
    <span class="hljs-keyword">return</span> response.<span class="hljs-property">data</span>.<span class="hljs-property">choices</span>.<span class="hljs-property">message</span>.<span class="hljs-property">content</span>;
  } <span class="hljs-keyword">catch</span>(err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'ollama 请求失败'</span>);
  }
}
</code></pre>
<h4 data-id="heading-6">2.2 技术点详解</h4>
<ol>
<li>
<p><strong>Axios 封装：</strong> 使用 <code>axios.create</code> 创建实例，统一管理 <code>baseURL</code> 和 <code>headers</code>，避免在每个请求中重复配置。</p>
</li>
<li>
<p><strong>兼容性接口：</strong> Ollama 采用了 OpenAI 的 API 规范，这意味着如果你的后端换成 OpenAI，前端代码几乎不需要修改。</p>
</li>
<li>
<p><strong>请求参数：</strong></p>
<ul>
<li><code>messages</code>: 这是一个数组，包含 <code>role</code> (system/user/assistant) 和 <code>content</code>。<strong>注意：</strong> 必须传入完整的对话历史，模型才能理解上下文。</li>
<li><code>temperature</code>: 值越低越确定，越高越有创造性。</li>
</ul>
</li>
</ol>
<h4 data-id="heading-7">🧠 答疑解惑：易错点与排查</h4>
<ul>
<li>
<p><strong>问题：跨域错误 (CORS) 或 网络连接失败</strong></p>
<ul>
<li>
<p><strong>原因：</strong> 前端运行在 <code>localhost:3000</code>，而 Ollama 服务运行在 <code>localhost:11434</code>。虽然同源策略通常允许不同端口，但如果 Ollama 服务未启动，会报 <code>ECONNREFUSED</code>。</p>
</li>
<li>
<p><strong>解决方案：</strong></p>
<ol>
<li>确保 Ollama 服务已启动（终端运行 <code>ollama serve</code> 或直接运行模型）。</li>
<li>检查防火墙设置。</li>
<li>在开发环境中，如果遇到严格的 CORS 限制，可以考虑使用 Vite 的代理配置（Proxy）。</li>
</ol>
</li>
</ul>
</li>
<li>
<p><strong>问题：401 Unauthorized 错误</strong></p>
<ul>
<li><strong>原因：</strong> 虽然 Ollama 本地部署通常不需要复杂的鉴权，但根据代码规范，它要求 Header 中必须包含 <code>Authorization: Bearer ollama</code>。</li>
<li><strong>解决方案：</strong> 确保在请求头中正确设置了该字段。</li>
</ul>
</li>
<li>
<p><strong>问题：模型未找到 (Model not found)</strong></p>
<ul>
<li><strong>原因：</strong> 代码中写死了 <code>qwen2.5:0.5b</code>，但本地未下载该模型。</li>
<li><strong>解决方案：</strong> 运行 <code>ollama pull qwen2.5:0.5b</code>，或者修改代码中的 <code>model</code> 字段为你本地已有的模型（如 <code>llama3</code>）。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-8">💼 面试模拟：API 层设计</h4>
<p><strong>面试官：</strong> “在封装 API 时，为什么要使用 Axios 实例而不是直接使用 <code>axios.post</code>？”<br/>
<strong>候选人：</strong></p>
<ol>
<li><strong>统一管理：</strong> 如果 baseURL 变更（例如从开发环境切换到生产环境），只需修改实例配置，无需修改每个请求。</li>
<li><strong>拦截器：</strong> 实例可以添加请求拦截器（自动加 Token）和响应拦截器（统一错误处理）。</li>
<li><strong>复用性：</strong> 可以创建多个实例对应不同的后端服务。</li>
</ol>
<hr/>
<h3 data-id="heading-9">第三部分：前端状态管理（Hooks 模块）</h3>
<h4 data-id="heading-10">3.1 代码逻辑解析</h4>
<p><code>useLLM.js</code> 文件是一个自定义 Hook，用于管理聊天应用的状态。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { chatCompletions } <span class="hljs-keyword">from</span> <span class="hljs-string">'../api/ollamaApi.js'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useLLM</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> [messages, setMessages] = <span class="hljs-title function_">useState</span>([
    { <span class="hljs-attr">role</span>: <span class="hljs-string">'user'</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">'你好'</span> },
    { <span class="hljs-attr">role</span>: <span class="hljs-string">'assistant'</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">'你好，我是qwen2.5 0.5b 模型'</span> }
  ]);
  <span class="hljs-keyword">const</span> [loading, setLoading] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);
  <span class="hljs-keyword">const</span> [error, setError] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);

  <span class="hljs-comment">// 发送消息逻辑</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">sendMessage</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">userMessage</span>) =&gt; {
    <span class="hljs-comment">// 1. 更新UI：添加用户消息</span>
    <span class="hljs-keyword">const</span> newMessages = [...messages, { <span class="hljs-attr">role</span>: <span class="hljs-string">'user'</span>, <span class="hljs-attr">content</span>: userMessage }];
    <span class="hljs-title function_">setMessages</span>(newMessages);
    <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">true</span>);
    <span class="hljs-title function_">setError</span>(<span class="hljs-literal">null</span>);

    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// 2. 调用API</span>
      <span class="hljs-keyword">const</span> botResponse = <span class="hljs-keyword">await</span> <span class="hljs-title function_">chatCompletions</span>(newMessages);
      <span class="hljs-comment">// 3. 更新UI：添加机器人回复</span>
      <span class="hljs-title function_">setMessages</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> [...prev, { <span class="hljs-attr">role</span>: <span class="hljs-string">'assistant'</span>, <span class="hljs-attr">content</span>: botResponse }]);
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-title function_">setError</span>(<span class="hljs-string">'请求失败，请重试'</span>);
    } <span class="hljs-keyword">finally</span> {
      <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">false</span>);
    }
  };

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">resetChat</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-title function_">setMessages</span>([]);
  };

  <span class="hljs-keyword">return</span> { messages, loading, error, sendMessage, resetChat };
};
</code></pre>
<h4 data-id="heading-11">3.2 技术点详解</h4>
<ol>
<li><strong>状态设计：</strong> 使用 <code>messages</code> 数组存储对话历史，<code>loading</code> 控制按钮状态，<code>error</code> 处理异常。</li>
<li><strong>闭包与异步：</strong> 在 <code>sendMessage</code> 中，我们使用了函数式更新 <code>setMessages(prev =&gt; [...prev, ...])</code> 来确保获取到最新的状态，避免闭包陷阱。</li>
<li><strong>错误边界：</strong> 使用 <code>try-catch</code> 捕获 API 异常，并通过 <code>setError</code> 反馈给 UI。</li>
</ol>
<h4 data-id="heading-12">🧠 答疑解惑：易错点与排查</h4>
<ul>
<li>
<p><strong>问题：机器人回复总是“上一轮”的内容</strong></p>
<ul>
<li>
<p><strong>原因：</strong> 这是一个经典的 <strong>State 闭包问题</strong>。如果你在调用 API 前没有正确更新 <code>messages</code>，或者在调用 API 时传入的是旧的 <code>messages</code> 快照。</p>
</li>
<li>
<p><strong>解决方案：</strong></p>
<ul>
<li><strong>方案 A：</strong> 如上面的代码所示，先构造新的消息数组 <code>newMessages</code>，传给 API，成功后再更新 State。</li>
<li><strong>方案 B：</strong> 使用 <code>useRef</code> 保存最新的消息列表，或者在 <code>setMessages</code> 的回调中处理后续逻辑（虽然 React 18 严格模式下可能执行两次渲染，但逻辑上应保证幂等性）。</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>问题：输入框无法输入或按钮一直禁用</strong></p>
<ul>
<li><strong>原因：</strong> 逻辑错误导致 <code>loading</code> 状态未重置。</li>
<li><strong>解决方案：</strong> 确保 <code>try-catch-finally</code> 结构完整。无论成功或失败，<code>finally</code> 块中必须将 <code>loading</code> 设为 <code>false</code>。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-13">💼 面试模拟：React Hooks</h4>
<p><strong>面试官：</strong> “在 <code>sendMessage</code> 函数中，为什么在 <code>setMessages</code> 之后立即调用 API，传入的 <code>messages</code> 可能不是最新的？如何解决？”<br/>
<strong>候选人：</strong><br/>
React 的 <code>setState</code> 是异步的。在 <code>setMessages</code> 调用后，<code>messages</code> 变量的值在当前函数作用域内并没有立即改变。如果直接传 <code>messages</code> 给 API，会丢失刚刚添加的用户消息。<br/>
<strong>解决方法：</strong></p>
<ol>
<li><strong>预计算：</strong> 像代码中那样，先用 <code>const newMessages = [...messages, userMsg]</code> 计算出新数组，传给 API，然后 <code>setMessages(newMessages)</code>。</li>
<li><strong>函数式更新：</strong> 如果逻辑复杂，可以使用 <code>useRef</code> 来维护一个可变的引用。</li>
</ol>
<hr/>
<h3 data-id="heading-14">第四部分：视图层（UI 组件）</h3>
<h4 data-id="heading-15">4.1 代码逻辑解析</h4>
<p><code>App.jsx</code> 是应用的主组件，负责展示和用户交互。</p>
<pre><code class="hljs language-ini" lang="ini">import { useEffect, useState } from 'react'<span class="hljs-comment">;</span>
import { useLLM } from './hooks/useLLM.js'<span class="hljs-comment">;</span>

export default function App() {
  const <span class="hljs-section">[inputValue, setInputValue]</span> = useState('')<span class="hljs-comment">;</span>
  const { messages, loading, sendMessage } = useLLM()<span class="hljs-comment">; // 使用自定义 Hook</span>

  const <span class="hljs-attr">handleSend</span> = (e) =&gt; {
    e.preventDefault()<span class="hljs-comment">;</span>
    if (!inputValue.trim()) return<span class="hljs-comment">;</span>
    sendMessage(inputValue)<span class="hljs-comment">; // 调用 Hook 中的逻辑</span>
    setInputValue('')<span class="hljs-comment">; // 清空输入框</span>
  }<span class="hljs-comment">;</span>

  // 页面挂载时的初始化逻辑（可选）
  useEffect(() =&gt; {
    // 例如：加载历史记录
  }, <span class="hljs-section">[]</span>)<span class="hljs-comment">;</span>

  return (
    &lt;div <span class="hljs-attr">className</span>=<span class="hljs-string">"min-h-screen bg-gray-50 flex flex-col items-center py-6 px-4"</span>&gt;
      &lt;div <span class="hljs-attr">className</span>=<span class="hljs-string">"w-full max-w-[800px] bg-white rounded-lg shadow-md flex flex-col h-[90vh] max-h-[800px]"</span>&gt;
        {/* 聊天内容区域 */}
        &lt;div <span class="hljs-attr">className</span>=<span class="hljs-string">"flex-1 p-4 overflow-y-auto"</span>&gt;
          {messages.map((msg, idx) =&gt; (
            &lt;div <span class="hljs-attr">key</span>={idx} className={`mb-<span class="hljs-number">4</span> p-<span class="hljs-number">3</span> rounded-lg max-w-xs <span class="hljs-variable">${msg.role === 'user' ? 'bg-blue-100 ml-auto' : 'bg-gray-100'}</span>`}&gt;
              {msg.content}
            &lt;/div&gt;
          ))}
        &lt;/div&gt;
      &lt;/div&gt;
      
      &lt;form <span class="hljs-attr">className</span>=<span class="hljs-string">"p-4 border-t"</span> <span class="hljs-literal">on</span>Submit={handleSend}&gt;
        &lt;div <span class="hljs-attr">className</span>=<span class="hljs-string">"flex gap-2"</span>&gt;
          &lt;input
            <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span>
            <span class="hljs-attr">value</span>={inputValue}
            <span class="hljs-attr">onChange</span>={e =&gt; setInputValue(e.target.value)} 
            <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"输入消息....按回车发送"</span>
            <span class="hljs-attr">disabled</span>={loading} 
            <span class="hljs-attr">className</span>=<span class="hljs-string">"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"</span>
          /&gt;
          &lt;button 
            <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span>
            <span class="hljs-attr">disabled</span>={loading || !inputValue.trim()}
            <span class="hljs-attr">className</span>=<span class="hljs-string">"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition"</span>
          &gt;
            {loading ? '思考中...' : '发送'}
          &lt;/button&gt;
        &lt;/div&gt;
      &lt;/form&gt;
    &lt;/div&gt;
  )<span class="hljs-comment">;</span>
}
</code></pre>
<h4 data-id="heading-16">4.2 技术点详解</h4>
<ol>
<li><strong>受控组件：</strong> <code>input</code> 的 <code>value</code> 绑定到 <code>inputValue</code>，通过 <code>onChange</code> 更新状态，保证 UI 与 State 一致。</li>
<li><strong>表单处理：</strong> 使用 <code>onSubmit</code> 处理表单提交，并调用 <code>e.preventDefault()</code> 阻止页面刷新。</li>
<li><strong>条件渲染：</strong> 根据 <code>loading</code> 状态禁用按钮和改变按钮文本，防止重复提交。</li>
</ol>
<h4 data-id="heading-17">🧠 答疑解惑：易错点与排查</h4>
<ul>
<li>
<p><strong>问题：按下回车键页面刷新了</strong></p>
<ul>
<li><strong>原因：</strong> <code>&lt;form&gt;</code> 标签的默认行为是 <code>onSubmit</code> 触发页面跳转。</li>
<li><strong>解决方案：</strong> 在 <code>handleSend</code> 函数的第一行加上 <code>e.preventDefault();</code>。</li>
</ul>
</li>
<li>
<p><strong>问题：聊天记录滚动条没有自动到底部</strong></p>
<ul>
<li><strong>原因：</strong> DOM 更新后，容器的 <code>scrollTop</code> 没有自动调整。</li>
<li><strong>解决方案：</strong> 使用 <code>useRef</code> 获取聊天容器的 DOM 引用，在 <code>useEffect</code> 中监听 <code>messages</code> 变化，并设置 <code>container.scrollTop = container.scrollHeight</code>。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-18">💼 面试模拟：UI 与用户体验</h4>
<p><strong>面试官：</strong> “如何优化这个聊天界面的用户体验（UX）？”<br/>
<strong>候选人：</strong></p>
<ol>
<li><strong>流式响应：</strong> 当前代码设置 <code>stream: false</code>，用户需要等待模型生成完所有文本才能看到结果。开启 <code>stream: true</code> 可以实现逐字输出的效果，体验更像真人打字。</li>
<li><strong>加载状态：</strong> 除了按钮禁用，聊天区域可以增加一个“机器人正在思考...”的 Typing 动画。</li>
<li><strong>错误重试：</strong> 当 API 调用失败时，UI 应该提供一个“重试”按钮，而不是仅仅显示错误文本。</li>
</ol>
<hr/>
<h3 data-id="heading-19">第五部分：进阶与优化</h3>
<h4 data-id="heading-20">5.1 流式传输 (Streaming)</h4>
<p>目前的代码是等待模型生成完所有内容后一次性返回。为了实现类似 ChatGPT 的打字机效果，我们需要开启流式传输。</p>
<ul>
<li><strong>原理：</strong> 设置 <code>stream: true</code>，后端会以 <code>text/event-stream</code> 格式分块传输数据。</li>
<li><strong>实现：</strong> 在 <code>chatCompletions</code> 函数中，需要使用 <code>fetch</code> API 替代 Axios（因为 Axios 对流式处理支持较弱），并读取 <code>ReadableStream</code>。</li>
</ul>
<h4 data-id="heading-21">5.2 上下文管理</h4>
<p><code>qwen2.5:0.5b</code> 这种 0.5B 参数的模型内存有限。如果对话过长，模型会“忘记”开头的内容，或者出现显存溢出。</p>
<ul>
<li><strong>解决方案：</strong> 实现一个简单的上下文截断逻辑，只保留最近的 N 轮对话传给模型。</li>
</ul>
<h4 data-id="heading-22">5.3 模型切换</h4>
<p>可以扩展 UI，让用户在界面上选择不同的本地模型（如从 <code>qwen</code> 切换到 <code>llama3</code>）。</p>
<hr/>
<h3 data-id="heading-23">博客结语</h3>
<p>通过这篇博客，我们完成了一个从本地大模型部署到前端全栈应用的开发流程。这不仅是一个技术Demo，更是理解现代AI应用架构的基石。</p>
<p><strong>核心收获：</strong></p>
<ol>
<li><strong>Ollama 是本地AI的基石</strong>，它让大模型触手可及。</li>
<li><strong>React Hooks</strong> 极大地简化了状态管理的复杂度。</li>
<li><strong>前后端分离</strong> 的思想依然适用，即使是与本地服务通信。</li>
</ol>
<p>希望这篇教程能帮助你在本地AI开发的道路上更进一步！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[小程序 Markdown 渲染血泪史：mp-html 组件从入门到放弃再到重生]]></title>    <link>https://juejin.cn/post/7595886887523401768</link>    <guid>https://juejin.cn/post/7595886887523401768</guid>    <pubDate>2026-01-17T10:14:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595886887523401768" data-draft-id="7595974133096579106" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="小程序 Markdown 渲染血泪史：mp-html 组件从入门到放弃再到重生"/> <meta itemprop="keywords" content="前端,微信小程序"/> <meta itemprop="datePublished" content="2026-01-17T10:14:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小时前端"/> <meta itemprop="url" content="https://juejin.cn/user/1197805741808339"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            小程序 Markdown 渲染血泪史：mp-html 组件从入门到放弃再到重生
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1197805741808339/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小时前端
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T10:14:35.000Z" title="Sat Jan 17 2026 10:14:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{font-size:24px;display:inline-block;font-weight:700;background:#ef7060;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(239,112,96,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 50px);border-bottom:3px solid #ef7060}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #3e3e3e;margin-top:32px;margin-bottom:32px;height:1px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(27,31,35,.05);color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:JetBranins Mono,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px;background-color:#fdfdfd}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#fdfdfd}.markdown-body a{text-decoration:none;font-weight:700;color:#ef7060;border-bottom:1px solid #ef7060}.markdown-body a:active,.markdown-body a:hover{color:#ef2d26}.markdown-body table tr td,.markdown-body table tr th{border:1px solid #ccc;padding:5px 10px}.markdown-body table{display:block!important;width:auto;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{background:#f0f0f0;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#f8f8f8}.markdown-body blockquote{margin-inline-start:0;margin-inline-end:0;border-left:3px solid #ef7060;background:#fff9f9;padding:1px 20px;margin-top:20px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-light">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-built_in,.hljs-class .hljs-title{color:#c18401}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">前言：小程序 MD 渲染的难点</h2>
<p>在小程序开发中，Markdown 内容的渲染一直是一个让人头疼的问题。与 Web 端丰富的生态不同，小程序平台有着诸多限制：</p>
<ul>
<li><strong>平台差异性</strong>：微信小程序、支付宝小程序、百度小程序等平台对 HTML 和 CSS 的支持程度不同</li>
<li><strong>安全限制</strong>：小程序不允许直接使用 <code>dangerouslySetInnerHTML</code> 或动态执行脚本</li>
<li><strong>样式兼容性</strong>：部分 CSS 属性在小程序中不被支持</li>
<li><strong>性能瓶颈</strong>：复杂的富文本渲染容易影响页面性能</li>
<li><strong>交互限制</strong>：图片预览、链接跳转等交互行为需要特殊处理</li>
</ul>
<p>这些限制使得在小程序中实现完整的 Markdown 渲染变得异常困难。开发者往往需要在功能完整性和性能体验之间寻找平衡。</p>
<h2 data-id="heading-1">最近的踩坑经历</h2>
<p>最近在开发一个小程序时，需要在小程序中渲染包含代码块、表格、图片等多种元素的 Markdown 内容。一开始天真地以为可以用简单的 HTML 解析器搞定，结果踩了一堆坑。</p>
<h3 data-id="heading-2">坑一：代码高亮完全不工作</h3>
<p>最先遇到的就是代码高亮问题。我按照文档启用 Markdown 插件后，代码块倒是能显示，但是语法高亮完全没有效果。</p>
<pre><code class="hljs language-markdown" lang="markdown">// 这是我一开始的配置
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">mp-html</span>
  <span class="hljs-attr">:content</span>=<span class="hljs-string">"markdownContent"</span>
  <span class="hljs-attr">:markdown</span>=<span class="hljs-string">"true"</span>
/&gt;</span></span>
</code></pre>
<p>代码块显示成了普通文本，完全没有颜色区分。后来才发现需要单独启用 <code>highlight</code> 插件，而且还需要重新构建组件。</p>
<h3 data-id="heading-3">坑二：多语言代码块识别失败</h3>
<p>启用代码高亮后，发现只有 JavaScript 代码能正常高亮，其他语言如 Java、Python、Go 等都显示为纯文本。原来 mp-html 默认只支持基础的几种语言，需要手动下载完整的 Prism.js 文件来支持更多编程语言。</p>
<h3 data-id="heading-4">坑三：图片路径和预览问题</h3>
<p>Markdown 中的图片链接在小程序中无法直接显示。一开始我尝试使用相对路径，结果全部加载失败。后来发现需要配置 <code>domain</code> 属性来处理图片路径，而且图片预览功能还需要手动开启。</p>
<h3 data-id="heading-5">坑四：表格滚动和样式问题</h3>
<p>复杂的表格在小程序中显示不全，内容会被截断。特别是手机端，表格列数多时根本看不清内容。而且表格的样式也需要特殊处理，默认样式很难看。</p>
<h3 data-id="heading-6">坑五：文本选择和复制功能</h3>
<p>用户希望能复制代码块的内容，但是默认情况下小程序不支持文本选择。后来发现可以通过配置 <code>selectable</code> 属性来开启这个功能。</p>
<h3 data-id="heading-7">坑六：Mermaid 图表渲染失败</h3>
<p>最棘手的问题是 Mermaid 图表渲染。在 Markdown 中，Mermaid 图表通常以代码块形式存在：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-code">```mermaid
graph TD;
    A--&gt;B;
    A--&gt;C;
    B--&gt;D;
    C--&gt;D;
</span></code></pre>
<pre><code class="hljs language-ini" lang="ini">
mp-html 组件本身不支持 Mermaid 语法渲染，因为 Mermaid 需要 JavaScript 引擎来解析和绘制图表，而小程序环境对这有限制。

一开始我尝试直接在 Markdown 中嵌入 Mermaid 代码，但结果只能显示为普通的代码块，完全没有图表效果。

<span class="hljs-comment">## 解决方案大揭秘</span>

经过一番折腾，终于找到了完整的解决方案。以下是我的实战配置：

<span class="hljs-comment">### 1. 完整的组件配置</span>

```vue
&lt;template&gt;
  &lt;view <span class="hljs-attr">class</span>=<span class="hljs-string">"article-container"</span>&gt;
    &lt;mp-html
      :<span class="hljs-attr">content</span>=<span class="hljs-string">"articleContent"</span>
      :<span class="hljs-attr">markdown</span>=<span class="hljs-string">"true"</span>
      :<span class="hljs-attr">preview-img</span>=<span class="hljs-string">"true"</span>
      :<span class="hljs-attr">scroll-table</span>=<span class="hljs-string">"true"</span>
      :<span class="hljs-attr">selectable</span>=<span class="hljs-string">"true"</span>
      :<span class="hljs-attr">use-anchor</span>=<span class="hljs-string">"true"</span>
      :<span class="hljs-attr">lazy-load</span>=<span class="hljs-string">"true"</span>
      <span class="hljs-attr">container-style</span>=<span class="hljs-string">"padding: 20rpx; background: #fff; border-radius: 12rpx;"</span>
      @<span class="hljs-attr">load</span>=<span class="hljs-string">"onContentLoad"</span>
      @<span class="hljs-attr">ready</span>=<span class="hljs-string">"onContentReady"</span>
      @<span class="hljs-attr">imgtap</span>=<span class="hljs-string">"onImageTap"</span>
      @<span class="hljs-attr">linktap</span>=<span class="hljs-string">"onLinkTap"</span>
      @<span class="hljs-attr">error</span>=<span class="hljs-string">"onError"</span>
    /&gt;
  &lt;/view&gt;
&lt;/template&gt;
</code></pre>
<h3 data-id="heading-8">2. 插件配置（重点）</h3>
<p>需要在 <code>node_modules/mp-html/tools/config.js</code> 中启用所有必要的插件：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-string">'markdown'</span>,    <span class="hljs-comment">// Markdown 解析</span>
    <span class="hljs-string">'highlight'</span>,   <span class="hljs-comment">// 代码高亮</span>
    <span class="hljs-string">'emoji'</span>,       <span class="hljs-comment">// Emoji 支持</span>
  ],

  <span class="hljs-comment">// 全局样式配置</span>
  <span class="hljs-attr">externStyle</span>: <span class="hljs-string">`
    .markdown-body {
      color: #333;
      line-height: 1.6;
      font-size: 28rpx;
    }
    .markdown-body h1,
    .markdown-body h2,
    .markdown-body h3 {
      color: #2c3e50;
      margin: 40rpx 0 20rpx 0;
      font-weight: 600;
    }
    .markdown-body p {
      margin: 20rpx 0;
      text-align: justify;
    }
    .markdown-body pre {
      background: #f6f8fa;
      border-radius: 8rpx;
      padding: 20rpx;
      overflow-x: auto;
    }
    .markdown-body code {
      background: #f1f3f4;
      padding: 4rpx 8rpx;
      border-radius: 4rpx;
      font-family: 'Consolas', 'Monaco', monospace;
    }
    .markdown-body blockquote {
      border-left: 4rpx solid #ddd;
      padding-left: 20rpx;
      margin: 20rpx 0;
      color: #666;
      background: #fafafa;
    }
    .markdown-body table {
      border-collapse: collapse;
      width: 100%;
      margin: 20rpx 0;
    }
    .markdown-body th,
    .markdown-body td {
      border: 1rpx solid #ddd;
      padding: 12rpx;
      text-align: left;
    }
    .markdown-body th {
      background: #f5f5f5;
      font-weight: 600;
    }
  `</span>
}
</code></pre>
<h3 data-id="heading-9">3. 代码高亮扩展（关键步骤）</h3>
<p>要支持多种编程语言的代码高亮，需要：</p>
<ol>
<li>访问 <a href="https://link.juejin.cn?target=https%3A%2F%2Fprismjs.com%2Fdownload.html" target="_blank" title="https://prismjs.com/download.html" ref="nofollow noopener noreferrer">prismjs.com/download.ht…</a></li>
<li>选择 Tomorrow Night 主题</li>
<li>勾选需要的语言：JavaScript, Java, Python, Go, C++, C, HTML, CSS 等</li>
<li>下载 <code>prism.min.js</code> 和 <code>prism.css</code></li>
<li>替换 <code>node_modules/mp-html/plugins/highlight/</code> 目录下的对应文件</li>
<li>重新构建组件：<code>npm run build:uni-app</code></li>
</ol>
<h3 data-id="heading-10">4. 代码高亮配置优化</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// plugins/highlight/config.js</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">copyByLongPress</span>: <span class="hljs-literal">true</span>,    <span class="hljs-comment">// 长按复制代码</span>
  <span class="hljs-attr">showLanguageName</span>: <span class="hljs-literal">true</span>,   <span class="hljs-comment">// 显示语言名称</span>
  <span class="hljs-attr">showLineNumber</span>: <span class="hljs-literal">true</span>       <span class="hljs-comment">// 显示行号</span>
}
</code></pre>
<h3 data-id="heading-11">5. Mermaid 图表处理</h3>
<p>对于 Mermaid 图表渲染问题，需要在前端预处理，将 Mermaid 代码块转换为图片：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// utils/mermaidProcessor.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">processMermaidInMarkdown</span>(<span class="hljs-params">content</span>) {
  <span class="hljs-keyword">if</span> (!content) <span class="hljs-keyword">return</span> content

  <span class="hljs-comment">// 匹配 mermaid 代码块</span>
  <span class="hljs-keyword">const</span> mermaidRegex = <span class="hljs-regexp">/```mermaid\s*\n([\s\S]*?)\n```/g</span>

  <span class="hljs-keyword">return</span> content.<span class="hljs-title function_">replace</span>(mermaidRegex, <span class="hljs-function">(<span class="hljs-params">match, mermaidCode</span>) =&gt;</span> {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// 将 mermaid 代码发送到服务器生成图片</span>
      <span class="hljs-comment">// 这里需要实现一个服务，将 mermaid 代码转换为图片 URL</span>
      <span class="hljs-keyword">const</span> imageUrl = <span class="hljs-title function_">generateMermaidImageUrl</span>(mermaidCode)
      <span class="hljs-keyword">return</span> <span class="hljs-string">`![Mermaid 图表](<span class="hljs-subst">${imageUrl}</span>)`</span>
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Mermaid 处理失败:'</span>, error)
      <span class="hljs-comment">// 处理失败时返回原始代码块</span>
      <span class="hljs-keyword">return</span> match
    }
  })
}

<span class="hljs-comment">// 在 Vue 组件中使用</span>
<span class="hljs-keyword">const</span> processedContent = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> content = question.<span class="hljs-property">value</span>?.<span class="hljs-property">content</span>
  <span class="hljs-keyword">if</span> (!content) <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>

  <span class="hljs-comment">// 先处理 mermaid（将 mermaid 代码块转换为图片）</span>
  <span class="hljs-keyword">const</span> mermaidProcessed = <span class="hljs-title function_">processMermaidInMarkdown</span>(content)
  <span class="hljs-comment">// 再转换为 HTML</span>
  <span class="hljs-keyword">return</span> mermaidProcessed
})
</code></pre>
<p><strong>关键点</strong>：</p>
<ul>
<li>Mermaid 图表无法在小程序中直接渲染，需要预先转换为图片</li>
<li>需要后端服务或第三方 API 将 Mermaid 代码转换为图片</li>
<li>处理顺序：先转换 Mermaid → 再解析 Markdown → 最后渲染 HTML</li>
</ul>
<h3 data-id="heading-12">6. 图片处理策略</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 处理图片路径</span>
<span class="hljs-title function_">getImageUrl</span>(<span class="hljs-params">originalUrl</span>) {
  <span class="hljs-comment">// 如果是相对路径，拼接完整域名</span>
  <span class="hljs-keyword">if</span> (originalUrl.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'/'</span>)) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`https://your-domain.com<span class="hljs-subst">${originalUrl}</span>`</span>
  }
  <span class="hljs-comment">// 如果是外部链接，可以添加代理或直接返回</span>
  <span class="hljs-keyword">return</span> originalUrl
}
</code></pre>
<h3 data-id="heading-13">6. 事件处理</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">onContentLoad</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Markdown 内容加载完成'</span>)
      <span class="hljs-comment">// 可以在这里添加加载完成后的逻辑</span>
    },

    <span class="hljs-title function_">onContentReady</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'所有资源加载完成'</span>)
      <span class="hljs-comment">// 图片等资源加载完成后的处理</span>
    },

    <span class="hljs-title function_">onImageTap</span>(<span class="hljs-params">e</span>) {
      <span class="hljs-keyword">const</span> { src, i } = e.<span class="hljs-property">detail</span>
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`点击第 <span class="hljs-subst">${i + <span class="hljs-number">1</span>}</span> 张图片:`</span>, src)
      <span class="hljs-comment">// 可以在这里添加图片统计或其他逻辑</span>
    },

    <span class="hljs-title function_">onLinkTap</span>(<span class="hljs-params">e</span>) {
      <span class="hljs-keyword">const</span> { href } = e.<span class="hljs-property">detail</span>
      <span class="hljs-comment">// 处理内部链接跳转</span>
      <span class="hljs-keyword">if</span> (href.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'#'</span>)) {
        <span class="hljs-comment">// 锚点跳转</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">$refs</span>.<span class="hljs-property">mpHtml</span>.<span class="hljs-title function_">navigateTo</span>(href.<span class="hljs-title function_">substring</span>(<span class="hljs-number">1</span>))
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (href.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'/'</span>)) {
        <span class="hljs-comment">// 内部页面跳转</span>
        uni.<span class="hljs-title function_">navigateTo</span>({ <span class="hljs-attr">url</span>: href })
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 外部链接，可以复制或用 webview 打开</span>
        uni.<span class="hljs-title function_">setClipboardData</span>({
          <span class="hljs-attr">data</span>: href,
          <span class="hljs-attr">success</span>: <span class="hljs-function">() =&gt;</span> {
            uni.<span class="hljs-title function_">showToast</span>({
              <span class="hljs-attr">title</span>: <span class="hljs-string">'链接已复制'</span>,
              <span class="hljs-attr">icon</span>: <span class="hljs-string">'success'</span>
            })
          }
        })
      }
    },

    <span class="hljs-title function_">onError</span>(<span class="hljs-params">err</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'渲染错误:'</span>, err)
      <span class="hljs-comment">// 错误处理逻辑</span>
    }
  }
}
</code></pre>
<h2 data-id="heading-14">性能优化建议</h2>
<h3 data-id="heading-15">1. 图片懒加载</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;mp-html :lazy-load="true" /&gt;
</code></pre>
<h3 data-id="heading-16">2. 按需加载</h3>
<p>只在需要 Markdown 渲染的页面引入组件，避免全局注册增加包体积。</p>
<h3 data-id="heading-17">3. 缓存策略</h3>
<p>对于频繁使用的 Markdown 内容，可以考虑缓存解析结果。</p>
<h3 data-id="heading-18">4. 样式优化</h3>
<p>使用 <code>externStyle</code> 统一配置样式，避免内联样式过多影响性能。</p>
<h2 data-id="heading-19">总结</h2>
<p>mp-html 确实是一个功能强大的小程序 Markdown 渲染组件，但在使用的过程中需要注意：</p>
<ol>
<li><strong>插件配置</strong>：必须正确启用和配置相关插件</li>
<li><strong>代码高亮</strong>：需要手动扩展 Prism.js 来支持更多语言</li>
<li><strong>样式处理</strong>：充分利用 <code>externStyle</code> 和 <code>tag-style</code> 进行样式定制</li>
<li><strong>事件处理</strong>：合理处理图片、链接等交互事件</li>
<li><strong>性能优化</strong>：开启懒加载，合理使用缓存策略</li>
<li><strong>Mermaid 图表</strong>：需要预处理将 Mermaid 代码转换为图片</li>
</ol>
<p>虽然踩了不少坑，但最终的效果还是很满意的。现在我们的小程序可以完美地渲染包含代码高亮、表格、图片、Mermaid 图表等多种元素的 Markdown 内容，为用户提供了良好的阅读体验。</p>
<p>特别值得一提的是 Mermaid 图表的处理，这在技术面试题中非常常见。通过预处理将图表转换为图片，我们成功解决了小程序环境中无法直接渲染 Mermaid 的问题。</p>
<p>如果你也在小程序开发中遇到 Markdown 渲染的问题，不妨试试 mp-html 这个组件，希望这篇踩坑记能为你节省一些时间！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用pymobiledevice3进行iphone应用性能采集]]></title>    <link>https://juejin.cn/post/7595864836360142900</link>    <guid>https://juejin.cn/post/7595864836360142900</guid>    <pubDate>2026-01-17T08:05:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595864836360142900" data-draft-id="7595871887000977408" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用pymobiledevice3进行iphone应用性能采集"/> <meta itemprop="keywords" content="Python,iOS"/> <meta itemprop="datePublished" content="2026-01-17T08:05:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="茫茫碌碌"/> <meta itemprop="url" content="https://juejin.cn/user/430664290939080"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用pymobiledevice3进行iphone应用性能采集
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/430664290939080/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    茫茫碌碌
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T08:05:23.000Z" title="Sat Jan 17 2026 08:05:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">执行步骤</h2>
<h4 data-id="heading-1">安装依赖（未安装则执行）</h4>
<pre><code class="hljs language-bash" lang="bash">pip install pymobiledevice3
</code></pre>
<h4 data-id="heading-2">启动Tunnel（系统版本&gt;=17需要）</h4>
<pre><code class="hljs language-bash" lang="bash">sudo pymobiledevice3 remote tunneld
</code></pre>
<h4 data-id="heading-3">获取性能数据（打开一个新的终端）</h4>
<p>根据PID获取性能数据</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 获取PID</span>
pymobiledevice3 developer dvt process-id-for-bundle-id com.xxx.xxx

<span class="hljs-comment"># 获取指定PID的性能数据</span>
pymobiledevice3 developer dvt sysmon process single -a pid=xxxx
</code></pre>
<p>获取全部进程的性能数据</p>
<pre><code class="hljs language-bash" lang="bash">pymobiledevice3 developer dvt sysmon process monitor --rsd xxxx:xxxx:xxxx::x 58524 0.01
</code></pre>
<h2 data-id="heading-4">简单方案</h2>
<p>上面的多个步骤都是通过<code>pymobiledevice3</code>一个工具来实现的，因此是否可以一步就完成性能的采集？当然可以，通过深扒（并复制+改造）pymobiledevice3的源码，将所有操作封装到了一个脚本中~~~</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""
—————— 使用说明 ——————
usage: python3 ios-monitor.py [-h] [-g GAP] [-b BUNDLE_ID] [-r REPORT_HOST] [--detail] [--csv] [--debug]

ios设备性能收集

options:
  -h, --help            show this help message and exit
  -g, --gap GAP         性能数据获取时间间隔，默认1s
  -b, --bundle_id BUNDLE_ID
                        包名, 默认: com.mi.car.mobile
  -r, --report_host REPORT_HOST
                        性能采集数据上报地址
  --detail              输出详细信息
  --csv                 结果写入到CSV文件
  --debug               打印debug日志

—————— 示例 ——————
# 进行性能采集，ctrl+c 终止后写入csv文件
sudo python3 ios-monitor.py --csv

# 进行性能采集，数据上报到指定服务
sudo python3 ios-monitor.py -r 127.0.0.1:9311

"""</span>
<span class="hljs-keyword">import</span> argparse
<span class="hljs-keyword">import</span> asyncio
<span class="hljs-keyword">import</span> csv
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> logging
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> signal
<span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> partial
<span class="hljs-keyword">import</span> multiprocessing
<span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> Process

<span class="hljs-keyword">from</span> pymobiledevice3.remote.common <span class="hljs-keyword">import</span> TunnelProtocol
<span class="hljs-keyword">from</span> pymobiledevice3.remote.module_imports <span class="hljs-keyword">import</span> verify_tunnel_imports
<span class="hljs-keyword">from</span> pymobiledevice3.remote.remote_service_discovery <span class="hljs-keyword">import</span> RemoteServiceDiscoveryService
<span class="hljs-keyword">from</span> pymobiledevice3.services.dvt.dvt_secure_socket_proxy <span class="hljs-keyword">import</span> DvtSecureSocketProxyService
<span class="hljs-keyword">from</span> pymobiledevice3.services.dvt.instruments.device_info <span class="hljs-keyword">import</span> DeviceInfo
<span class="hljs-keyword">from</span> pymobiledevice3.services.dvt.instruments.process_control <span class="hljs-keyword">import</span> ProcessControl
<span class="hljs-keyword">from</span> pymobiledevice3.services.dvt.instruments.sysmontap <span class="hljs-keyword">import</span> Sysmontap
<span class="hljs-keyword">from</span> pymobiledevice3.tunneld.server <span class="hljs-keyword">import</span> TunneldRunner

<span class="hljs-keyword">import</span> requests

TUNNELD_DEFAULT_ADDRESS = (<span class="hljs-string">'127.0.0.1'</span>, <span class="hljs-number">49151</span>)

logging.basicConfig(level=logging.INFO, <span class="hljs-built_in">format</span>=<span class="hljs-string">'%(asctime)s - %(levelname)s - %(message)s'</span>)
logger = logging.getLogger(__name__)

report_error_num = <span class="hljs-number">0</span>

csv_data_list = []
csv_fieldnames=[<span class="hljs-string">'cpu'</span>, <span class="hljs-string">'mem'</span>]

<span class="hljs-keyword">def</span> <span class="hljs-title function_">run_tunneld</span>():
    <span class="hljs-string">""" Start Tunneld service for remote tunneling
    sudo pymobiledevice3 remote tunneld
    """</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> verify_tunnel_imports():
        logger.warning(<span class="hljs-string">"verify_tunnel_imports false"</span>)
        <span class="hljs-keyword">return</span>
    host = TUNNELD_DEFAULT_ADDRESS[<span class="hljs-number">0</span>]
    port = TUNNELD_DEFAULT_ADDRESS[<span class="hljs-number">1</span>]
    protocol = TunnelProtocol(TunnelProtocol.DEFAULT.value)

    tunneld_runner = partial(TunneldRunner.create, host, port, protocol=protocol, usb_monitor=<span class="hljs-literal">True</span>,
                             wifi_monitor=<span class="hljs-literal">True</span>, usbmux_monitor=<span class="hljs-literal">True</span>, mobdev2_monitor=<span class="hljs-literal">True</span>)

    tunneld_runner()
    <span class="hljs-keyword">return</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">process_id_for_bundle_id</span>(<span class="hljs-params">lockdown, app_bundle_identifier: <span class="hljs-built_in">str</span> = <span class="hljs-string">"com.mi.car.mobile"</span></span>):
    <span class="hljs-string">""" Get PID of a bundle identifier (only returns a valid value if its running). """</span>
    <span class="hljs-keyword">with</span> DvtSecureSocketProxyService(lockdown=lockdown) <span class="hljs-keyword">as</span> dvt:
        <span class="hljs-keyword">return</span> ProcessControl(dvt).process_identifier_for_bundle_identifier(app_bundle_identifier)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">sysmon_process_single</span>(<span class="hljs-params">lockdown, pid, detail, report_host=<span class="hljs-string">''</span>, write_csv=<span class="hljs-literal">False</span>, tunnel_process=<span class="hljs-literal">None</span></span>):
    <span class="hljs-string">""" show a single snapshot of currently running processes. """</span>
    count = <span class="hljs-number">0</span>
    result = []

    <span class="hljs-keyword">with</span> DvtSecureSocketProxyService(lockdown=lockdown) <span class="hljs-keyword">as</span> dvt:
        device_info = DeviceInfo(dvt)
        <span class="hljs-keyword">with</span> Sysmontap(dvt) <span class="hljs-keyword">as</span> sysmon:
            <span class="hljs-keyword">for</span> process_snapshot <span class="hljs-keyword">in</span> sysmon.iter_processes():
                count += <span class="hljs-number">1</span>
                <span class="hljs-keyword">if</span> count &lt; <span class="hljs-number">2</span>:
                    <span class="hljs-comment"># first sample doesn't contain an initialized value for cpuUsage</span>
                    <span class="hljs-keyword">continue</span>
                <span class="hljs-keyword">for</span> process <span class="hljs-keyword">in</span> process_snapshot:
                    <span class="hljs-comment"># print(process)</span>
                    <span class="hljs-keyword">if</span> <span class="hljs-built_in">str</span>(process[<span class="hljs-string">"pid"</span>]) != <span class="hljs-built_in">str</span>(pid):
                        <span class="hljs-keyword">continue</span>
                    <span class="hljs-comment"># adding "artificially" the execName field</span>
                    process[<span class="hljs-string">'execName'</span>] = device_info.execname_for_pid(process[<span class="hljs-string">'pid'</span>])
                    result.append(process)
                <span class="hljs-comment"># exit after single snapshot</span>
                <span class="hljs-keyword">break</span>
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(result) == <span class="hljs-number">0</span>:
        logger.info(<span class="hljs-string">"[]"</span>)
        <span class="hljs-keyword">return</span>
    
    cpu_usage = <span class="hljs-string">"%.2f"</span> % result[<span class="hljs-number">0</span>][<span class="hljs-string">'cpuUsage'</span>]
    mem = <span class="hljs-string">"%.2f"</span> % (result[<span class="hljs-number">0</span>][<span class="hljs-string">'memResidentSize'</span>] / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span>)
    
    <span class="hljs-keyword">if</span> write_csv:
        csv_data = {<span class="hljs-string">'cpu'</span>: cpu_usage, <span class="hljs-string">'mem'</span>: mem}
        csv_data_list.append(csv_data)

    <span class="hljs-keyword">if</span> report_host:
        report(host=report_host, info=result[<span class="hljs-number">0</span>], pid=<span class="hljs-built_in">str</span>(pid), tunnel_process=tunnel_process)
        <span class="hljs-keyword">return</span>

    <span class="hljs-keyword">if</span> detail:
        logger.info(json.dumps(result, indent=<span class="hljs-number">4</span>, ensure_ascii=<span class="hljs-literal">False</span>))
    <span class="hljs-keyword">else</span>:
        logger.info(<span class="hljs-string">"[CPU]{} %  [内存]{} MB"</span>.<span class="hljs-built_in">format</span>(cpu_usage, mem))

<span class="hljs-keyword">def</span> <span class="hljs-title function_">report</span>(<span class="hljs-params">host: <span class="hljs-built_in">str</span>, info: <span class="hljs-built_in">dict</span>, pid: <span class="hljs-built_in">str</span>, tunnel_process=<span class="hljs-literal">None</span></span>):
    <span class="hljs-keyword">global</span> report_error_num
    url = <span class="hljs-string">'http://%s/monitor/collect'</span> % host
    mem = info[<span class="hljs-string">'memResidentSize'</span>] / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span>
    data = {
        <span class="hljs-string">'device'</span>: <span class="hljs-string">'ios-%s'</span> % pid,
        <span class="hljs-string">'list'</span>: [<span class="hljs-number">0</span>, info[<span class="hljs-string">'cpuUsage'</span>], <span class="hljs-number">0</span>, mem],
        <span class="hljs-string">'app_cpu_rate'</span>: info[<span class="hljs-string">'cpuUsage'</span>],
        <span class="hljs-string">'app_mem'</span>: mem,
        <span class="hljs-string">'timestamp'</span>: <span class="hljs-built_in">int</span>(time.time() * <span class="hljs-number">1000</span>)
    }
    report_err = <span class="hljs-literal">False</span>
    <span class="hljs-keyword">try</span>:
        resp = requests.post(url=url, json=data, timeout=(<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>))
    <span class="hljs-keyword">except</span> Exception:
        report_err = <span class="hljs-literal">True</span>

    <span class="hljs-keyword">if</span> report_err <span class="hljs-keyword">is</span> <span class="hljs-literal">False</span> <span class="hljs-keyword">and</span> resp.status_code != <span class="hljs-number">200</span>:
        report_err = <span class="hljs-literal">True</span>

    <span class="hljs-keyword">if</span> report_err:
        report_error_num += <span class="hljs-number">1</span>
        logger.warning(<span class="hljs-string">"上报失败 %d"</span> % report_error_num)
        <span class="hljs-keyword">if</span> report_error_num &gt; <span class="hljs-number">5</span>:
            logger.info(<span class="hljs-string">"接收端已关闭, 监控退出"</span>)
            <span class="hljs-keyword">if</span> tunnel_process:
                tunnel_process.terminate()
            sys.exit(<span class="hljs-number">0</span>)
    <span class="hljs-keyword">else</span>:
        cpu_usage = <span class="hljs-string">"%.2f"</span> % info[<span class="hljs-string">'cpuUsage'</span>]
        logger.info(<span class="hljs-string">"report [CPU]{} %  [内存]{} MB"</span>.<span class="hljs-built_in">format</span>(cpu_usage, mem))
        report_error_num = <span class="hljs-number">0</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_tunnel_addr</span>(<span class="hljs-params">attemp_times=<span class="hljs-number">30</span></span>):
    url = <span class="hljs-string">'http://127.0.0.1:%d/'</span> % TUNNELD_DEFAULT_ADDRESS[<span class="hljs-number">1</span>]
    try_times = <span class="hljs-number">0</span>
    <span class="hljs-keyword">while</span> try_times &lt; attemp_times:
        <span class="hljs-keyword">try</span>:
            logger.info(<span class="hljs-string">'--- 获取设备连接信息'</span>)
            resp = requests.get(url=url, timeout=(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>)).json()
            <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> resp.values():
                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> v:
                    <span class="hljs-keyword">continue</span>
                <span class="hljs-keyword">return</span> v[<span class="hljs-number">0</span>][<span class="hljs-string">'tunnel-address'</span>], v[<span class="hljs-number">0</span>][<span class="hljs-string">'tunnel-port'</span>]
        <span class="hljs-keyword">except</span> Exception:
            <span class="hljs-keyword">pass</span>
        try_times += <span class="hljs-number">1</span>
        time.sleep(<span class="hljs-number">1</span>)
        <span class="hljs-keyword">continue</span>
    logger.warning(<span class="hljs-string">'--- 未找到ios设备'</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>, <span class="hljs-literal">None</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">run_in_one</span>(<span class="hljs-params">bundle_id: <span class="hljs-built_in">str</span>, gap: <span class="hljs-built_in">int</span>, detail: <span class="hljs-built_in">bool</span>, report_host: <span class="hljs-built_in">str</span> = <span class="hljs-string">''</span>, write_csv: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span></span>):
    logger.info(<span class="hljs-string">'--- 连接设备'</span>)
    p = Process(target=run_tunneld, args=())
    p.start()

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">sys_exit</span>(<span class="hljs-params">status: <span class="hljs-built_in">int</span> = <span class="hljs-number">0</span></span>):
        p.terminate()
        <span class="hljs-comment"># 写入csv</span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(csv_data_list) &gt; <span class="hljs-number">0</span>:
            logger.info(<span class="hljs-string">'--- 写入CSV'</span>)
            filename = <span class="hljs-string">'ios-monitor-result-%d.csv'</span> % <span class="hljs-built_in">int</span>(time.time())
            filepath = os.path.join(os.getcwd(), filename)
            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(filepath, <span class="hljs-string">'w'</span>, encoding=<span class="hljs-string">'UTF8'</span>, newline=<span class="hljs-string">''</span>) <span class="hljs-keyword">as</span> f:
                writer = csv.DictWriter(f, fieldnames=csv_fieldnames)
                writer.writeheader()
                writer.writerows(csv_data_list)
        
        logger.info(<span class="hljs-string">' --- 退出 ---'</span>)
        sys.exit(status)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">signal_handler</span>(<span class="hljs-params">*args, **kwargs</span>):
        sys_exit(<span class="hljs-number">0</span>)

    time.sleep(<span class="hljs-number">3</span>)
    signal.signal(signal.SIGINT, signal_handler)

    addr, port = get_tunnel_addr(attemp_times=<span class="hljs-number">30</span>)
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> addr:
        sys_exit(<span class="hljs-number">1</span>)

    logger.info(<span class="hljs-string">"--- connect device: %s %d"</span> % (addr, port))

    logger.debug(<span class="hljs-string">'start run'</span>)
    rsd = RemoteServiceDiscoveryService(address=(addr, port))
    logger.debug(<span class="hljs-string">'start rsd connect'</span>)
    asyncio.run(rsd.connect(), debug=<span class="hljs-literal">True</span>)
    time.sleep(<span class="hljs-number">1</span>)
    logger.debug(<span class="hljs-string">'get pid'</span>)
    pid = process_id_for_bundle_id(lockdown=rsd, app_bundle_identifier=bundle_id)
    logger.info(<span class="hljs-string">'获取应用(%s)PID: %d'</span> % (bundle_id, pid))

    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> pid:
            pid = process_id_for_bundle_id(lockdown=rsd, app_bundle_identifier=bundle_id)
            logger.info(<span class="hljs-string">'获取应用(%s)PID: %d'</span> % (bundle_id, pid))
            time.sleep(<span class="hljs-number">0.3</span>)
            <span class="hljs-keyword">continue</span>

        <span class="hljs-keyword">try</span>:
            sysmon_process_single(lockdown=rsd, pid=pid, detail=detail, report_host=report_host, write_csv=write_csv, tunnel_process=p)
            time.sleep(gap/<span class="hljs-number">1000</span>)
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> err:
            logger.error(<span class="hljs-string">'获取性能指标失败: {}'</span>.<span class="hljs-built_in">format</span>(err))
            addr, port = get_tunnel_addr(attemp_times=<span class="hljs-number">30</span>)
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> addr:
                sys_exit(<span class="hljs-number">1</span>)

            pid = process_id_for_bundle_id(lockdown=rsd, app_bundle_identifier=bundle_id)
            logger.info(<span class="hljs-string">'获取应用(%s)PID: %d'</span> % (bundle_id, pid))

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    multiprocessing.freeze_support()
    parser = argparse.ArgumentParser(description=<span class="hljs-string">'ios设备性能收集'</span>, add_help=<span class="hljs-literal">True</span>)
    parser.add_argument(<span class="hljs-string">'-g'</span>, <span class="hljs-string">'--gap'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">int</span>, required=<span class="hljs-literal">False</span>, default=<span class="hljs-number">1000</span>,
                        <span class="hljs-built_in">help</span>=<span class="hljs-string">'性能数据获取时间间隔(ms)，默认1000ms'</span>)
    parser.add_argument(<span class="hljs-string">'-b'</span>, <span class="hljs-string">'--bundle_id'</span>, required=<span class="hljs-literal">False</span>, default=<span class="hljs-string">'com.mi.car.mobile'</span>,
                        <span class="hljs-built_in">help</span>=<span class="hljs-string">'包名, 默认: com.mi.car.mobile'</span>)
    parser.add_argument(<span class="hljs-string">'-r'</span>, <span class="hljs-string">'--report_host'</span>, required=<span class="hljs-literal">False</span>, default=<span class="hljs-string">''</span>,
                        <span class="hljs-built_in">help</span>=<span class="hljs-string">'性能采集数据上报地址'</span>)
    parser.add_argument(<span class="hljs-string">'--detail'</span>, default=<span class="hljs-literal">False</span>, action=<span class="hljs-string">'store_true'</span>,
                        <span class="hljs-built_in">help</span>=<span class="hljs-string">'输出详细信息'</span>)
    parser.add_argument(<span class="hljs-string">'--csv'</span>, default=<span class="hljs-literal">False</span>, action=<span class="hljs-string">'store_true'</span>,
                        <span class="hljs-built_in">help</span>=<span class="hljs-string">'结果写入到CSV文件'</span>)
    parser.add_argument(<span class="hljs-string">'--debug'</span>, default=<span class="hljs-literal">False</span>, action=<span class="hljs-string">'store_true'</span>,
                        <span class="hljs-built_in">help</span>=<span class="hljs-string">'打印debug日志'</span>)

    args = parser.parse_args()

    <span class="hljs-keyword">if</span> args.debug:
        logger.setLevel(logging.DEBUG)

    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> args.bundle_id:
        logger.error(<span class="hljs-string">'bundle_id invalid'</span>)
        sys.exit(<span class="hljs-number">1</span>)

    gap_ms = args.gap
    <span class="hljs-comment"># 最低200ms间隔</span>
    <span class="hljs-keyword">if</span> gap_ms &lt; <span class="hljs-number">200</span>:
        gap_ms = <span class="hljs-number">200</span>

    rpt_host = args.report_host
    <span class="hljs-comment"># 上报到本机客户端</span>
    <span class="hljs-keyword">if</span> rpt_host <span class="hljs-keyword">in</span> {<span class="hljs-string">'local'</span>, <span class="hljs-string">'localhost'</span>, <span class="hljs-string">'*'</span>, <span class="hljs-string">'-'</span>, <span class="hljs-string">'9311'</span>}:
        rpt_host = <span class="hljs-string">'127.0.0.1:9311'</span>
    run_in_one(bundle_id=args.bundle_id, gap=gap_ms, detail=args.detail, report_host=rpt_host, write_csv=args.csv)

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ooderAI： Agent管理平台开源设计]]></title>    <link>https://juejin.cn/post/7595911076014194724</link>    <guid>https://juejin.cn/post/7595911076014194724</guid>    <pubDate>2026-01-17T10:23:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595911076014194724" data-draft-id="7595994039108485156" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ooderAI： Agent管理平台开源设计"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-01-17T10:23:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="OneCodeCN"/> <meta itemprop="url" content="https://juejin.cn/user/1427583415622366"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ooderAI： Agent管理平台开源设计
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1427583415622366/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    OneCodeCN
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T10:23:40.000Z" title="Sat Jan 17 2026 10:23:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言：ooder开源的初心</h2>
<p>ooder 团队是一只对技术有着执着追求的团队，在Agent，Skill的高速发展的今天 ， 让我们坚信，AI大爆发的时代可能尽在眼前。但国内的环境与国外有很大的不同，特别是开源开放方面，壁垒非常高。即使拥有Skill 这样跨时代的技术出现仍然是很难以撼动国内IT各自为营的现状。经过认真的考虑我们决定开源我们内部协作使用的基于SpringCloud的分布式的SuperAgent平台。<strong>使用MIT协议，允许任意第三方针对协议、代码无限制修改、分发</strong>。而ooder 团队则会将更多的精力放到，基于ooder 开源协议的工具链以及Skill底层支持 的开发，会做强做好包括ooderA2UI,SkillFlow产品，同时会继续维护OneCode的代码升级。但因为时间和精力有限，我们除了将现有的Agent标准，Skill规范快速的纳入到我们支持范围，同时还面临强度不小的SuperAgent平台本身的开源重构整理，在后续的发布过程中我们将分步将协议和工程代码以及AI辅助的脚手架工程推出。开源版在重构过程中大量采用了AI来辅助甚至主导完成。但我们坚持所有的设计和测试人工审核会同步发布，不过也必须友情提醒，SuperAgent开源工程仅为开源协议的参考实现，直接商用需要做认真的评估。</p>
<p>我们希望参考版本可以节省后续的开发者在设计、规范方面投入更多的精力，努力做到开箱即用，同时也将致力于以下几点：</p>
<ol>
<li><strong>标准化SKILL开发</strong>：制定统一的SKILL开发规范，让AI能力的开发更加规范化</li>
<li><strong>规范化SKILL管理</strong>：建立统一的SKILL管理机制，让企业和个人能够更高效地管理和使用AI能力</li>
<li><strong>实现顺畅协作</strong>：构建A2A、A2P、A2U之间的协作框架，让AI能力能够无缝协作</li>
<li><strong>降低使用门槛</strong>：提供可视化的编排工具，让非技术人员也能轻松使用AI能力</li>
<li><strong>保护用户隐私</strong>：支持多种部署方式，确保用户数据的安全和隐私</li>
</ol>
<p>使得我们AIAgent 生态能更加健康发展。</p>
<p><strong>下面是正文是：</strong></p>
<p>企业和个人在使用AI能力时面临的诸多挑战：AI能力分散在不同平台、缺乏统一的管理机制、跨系统协作困难、个人AI工具无法有效整合等。SuperAgent诞生了，下文是一个简单的介绍：</p>
<h2 data-id="heading-1">1. 什么是ooder SuperAgent？</h2>
<p>ooder SuperAgent是一套基于MIT协议的开源企业级AI能力分发与自动化协作框架，它通过创新的Agent架构和SKILL管理机制，为企业提供了从简单任务到复杂流程的全场景自动化解决方案。</p>
<h2 data-id="heading-2">核心设计理念</h2>
<ol>
<li><strong>MCPAgent分发网络</strong>：企业/第三方系统可以将自己的MCPAgent接入AIServer，将AI能力通过SuperAgent分发；个人用户拥有专属MCPAgent，整合个人AI工具</li>
<li><strong>AI能力标准化</strong>：定义统一的AI能力接口规范，支持1:n Capability关系，实现AI能力的模块化设计</li>
<li><strong>跨域自动化编排</strong>：通过Skillflow可视化工具，实现跨企业/个人MCPAgent的工作流编排</li>
<li><strong>安全可靠的设计</strong>：基于RBAC的权限管理，支持多种部署方式，确保系统安全可靠</li>
</ol>
<h2 data-id="heading-3">2. SuperAgent企业总体结构</h2>
<p>SuperAgent企业总体结构由六大核心组件构成：<strong>Auth认证中心</strong>、<strong>DataServer数据中心</strong>、<strong>Skill能力管理中心</strong>、<strong>LLM调度中心</strong>、<strong>Skillflow调度中心</strong>和<strong>Agent协作层</strong>，形成完整的企业级AI能力协作生态。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7cc9f19382ca4b9bb3cfe24ad2981e8a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT25lQ29kZUNO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769250220&amp;x-signature=uhbeoEXstr5nOBpw5ZU7CwX%2Fmto%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<h2 data-id="heading-4">2.1 核心组件详细描述</h2>
<h2 data-id="heading-5">2.1.1 Auth认证中心</h2>
<p><strong>核心职责</strong>：提供统一的身份认证和授权服务，确保系统安全可靠。</p>
<ul>
<li><strong>身份管理</strong>：用户、角色、权限的集中管理</li>
<li><strong>认证服务</strong>：支持OAuth 2.0、JWT、API Key等多种认证方式</li>
<li><strong>授权管理</strong>：基于RBAC的细粒度权限控制</li>
<li><strong>单点登录</strong>：支持企业内部系统的单点登录</li>
<li><strong>审计日志</strong>：完整的操作日志记录，便于合规审计</li>
</ul>
<h2 data-id="heading-6">2.1.2 DataServer数据中心</h2>
<p><strong>核心职责</strong>：统一管理企业数据，支持多种数据类型和存储方式。</p>
<ul>
<li><strong>数据存储</strong>：支持结构化、半结构化、非结构化数据存储</li>
<li><strong>数据处理</strong>：数据清洗、转换、集成等ETL操作</li>
<li><strong>数据分析</strong>：提供基础的数据分析能力</li>
<li><strong>数据安全</strong>：数据加密、脱敏、访问控制</li>
<li><strong>数据共享</strong>：支持跨系统的数据共享和交换</li>
<li><strong>数据生命周期管理</strong>：数据的创建、使用、归档、销毁全生命周期管理</li>
</ul>
<h2 data-id="heading-7">2.1.3 Skill能力管理中心</h2>
<p><strong>核心职责</strong>：统一管理SKILL的注册、分类、发现和调用。</p>
<ul>
<li><strong>SKILL注册</strong>：管理SKILL的注册和发布</li>
<li><strong>能力分类</strong>：基于CAT（Capability And Type）的SKILL分类机制</li>
<li><strong>能力发现</strong>：支持基于多种条件的SKILL发现</li>
<li><strong>版本管理</strong>：SKILL的版本控制和更新管理</li>
<li><strong>权限控制</strong>：基于RBAC的SKILL访问权限管理</li>
<li><strong>监控统计</strong>：SKILL的使用情况监控和统计分析</li>
</ul>
<h2 data-id="heading-8">2.1.4 LLM调度中心</h2>
<p><strong>核心职责</strong>：统一管理LLM资源，实现LLM的高效调度和管控。</p>
<ul>
<li><strong>LLM资源管理</strong>：管理外部LLM和本地LLM资源</li>
<li><strong>调度策略</strong>：基于数据敏感性、成本、性能等因素的智能调度</li>
<li><strong>成本控制</strong>：LLM调用的成本计算和预算控制</li>
<li><strong>频率限制</strong>：防止过度调用导致的资源浪费</li>
<li><strong>结果缓存</strong>：缓存LLM调用结果，提高响应速度</li>
<li><strong>质量监控</strong>：监控LLM输出质量，实现自动过滤和审核</li>
</ul>
<h2 data-id="heading-9">2.1.5 Skillflow调度中心</h2>
<p><strong>核心职责</strong>：统一管理Skillflow的定义、编排、执行和监控。</p>
<ul>
<li><strong>Skillflow定义</strong>：支持可视化和代码两种方式定义Skillflow</li>
<li><strong>工作流编排</strong>：基于DAG的工作流引擎，支持复杂的流程逻辑</li>
<li><strong>任务调度</strong>：支持定时触发、事件触发、手动触发等多种方式</li>
<li><strong>执行管理</strong>：工作流的执行、暂停、恢复、终止等操作</li>
<li><strong>状态监控</strong>：实时监控工作流的执行状态和进度</li>
<li><strong>历史记录</strong>：完整的工作流执行历史，便于审计和分析</li>
<li><strong>异常处理</strong>：工作流执行异常的自动处理和告警</li>
</ul>
<h2 data-id="heading-10">2.1.6 Agent协作层</h2>
<p><strong>核心职责</strong>：实现不同Agent之间的协作和通信，执行具体的业务流程。</p>
<ul>
<li><strong>MCPAgent</strong>：服务流入口，接收外部请求，协调其他Agent</li>
<li><strong>RouteAgent</strong>：负责桥接和转发，连接MCPAgent和EndAgent</li>
<li><strong>EndAgent</strong>：执行具体任务，调用SKILL完成业务逻辑</li>
<li><strong>Agent注册中心</strong>：管理所有Agent的注册、发现和状态</li>
</ul>
<h2 data-id="heading-11">3. MCPAgent分发网络</h2>
<p>SuperAgent的核心创新在于MCPAgent分发网络，它允许企业/第三方系统和个人用户将自己的MCPAgent接入SuperAgent企业核心层，实现AI能力的统一分发和编排。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b97e78219ed54dcd8458e97a88c75862~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT25lQ29kZUNO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769250220&amp;x-signature=E8%2Fs8OFzVPO5ns6%2FqmH3n0hPkoo%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<h2 data-id="heading-12">4. 核心概念与能力</h2>
<h2 data-id="heading-13">4.1 1:n Capability关系</h2>
<p>SuperAgent支持1:n Capability关系，一个SKILL可以提供多个能力，实现AI能力的模块化设计：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7833f69af2774effb529ffd442416ada~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT25lQ29kZUNO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769250220&amp;x-signature=NEegbNVcF44%2BcqNcGGSCW%2BN7mIA%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<h2 data-id="heading-14">4.2 Skillflow自动化编排</h2>
<p>通过Skillflow可视化工具，用户可以轻松设计从简单到复杂的工作流，由Skillflow调度中心负责执行和监控：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf159204ffc34783b5ae68633791ab6c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT25lQ29kZUNO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769250220&amp;x-signature=bA6I1bB1%2F9jxCqUMIqug%2BveqnRk%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<h2 data-id="heading-15">5. 企业核心组件使用指南</h2>
<h2 data-id="heading-16">5.1 Auth认证中心使用</h2>
<p><strong>主要功能</strong>：统一身份管理和权限控制</p>
<ul>
<li><strong>企业SSO集成</strong>：</li>
</ul>
<ol>
<li>在Auth认证中心配置企业域</li>
<li>配置企业现有系统的SSO对接</li>
<li>用户通过企业账号登录SuperAgent</li>
<li>实现企业内部系统的无缝访问</li>
</ol>
<ul>
<li><strong>权限管理</strong>：</li>
</ul>
<ol>
<li>创建企业角色和权限组</li>
<li>为不同部门配置不同权限</li>
<li>实现基于角色的SKILL访问控制</li>
<li>监控和审计权限使用情况</li>
</ol>
<h2 data-id="heading-17">5.2 DataServer数据中心使用</h2>
<p><strong>主要功能</strong>：统一数据存储和管理</p>
<ul>
<li><strong>数据集成</strong>：</li>
</ul>
<ol>
<li>配置数据源连接（数据库、文件系统、API等）</li>
<li>设计数据ETL流程</li>
<li>实现数据的自动同步和更新</li>
<li>确保数据一致性和完整性</li>
</ol>
<ul>
<li><strong>数据安全</strong>：</li>
</ul>
<ol>
<li>配置数据加密策略</li>
<li>实现数据脱敏规则</li>
<li>配置数据访问权限</li>
<li>监控数据访问日志</li>
</ol>
<h2 data-id="heading-18">5.3 Skill能力管理中心使用</h2>
<p><strong>主要功能</strong>：SKILL注册、管理和发现</p>
<ul>
<li><strong>SKILL注册</strong>：</li>
</ul>
<ol>
<li>开发SKILL并通过AIServer认证</li>
<li>在Skill能力管理中心注册SKILL</li>
<li>配置SKILL的CAT分类和权限</li>
<li>发布SKILL到企业SKILL库</li>
</ol>
<ul>
<li><strong>SKILL管理</strong>：</li>
</ul>
<ol>
<li>监控SKILL的使用情况</li>
<li>管理SKILL的版本更新</li>
<li>配置SKILL的访问权限</li>
<li>统计SKILL的性能指标</li>
</ol>
<h2 data-id="heading-19">5.4 LLM调度中心使用</h2>
<p><strong>主要功能</strong>：LLM资源管理和调度</p>
<ul>
<li><strong>LLM资源配置</strong>：</li>
</ul>
<ol>
<li>配置外部LLM API（如OpenAI、阿里云AI等）</li>
<li>配置本地LLM资源（如开源模型部署）</li>
<li>设置LLM调用的成本预算</li>
<li>配置LLM调用的频率限制</li>
</ol>
<ul>
<li><strong>LLM调度策略</strong>：</li>
</ul>
<ol>
<li>基于数据敏感性选择LLM（外部/本地）</li>
<li>配置LLM调用的负载均衡</li>
<li>实现LLM结果的自动过滤</li>
<li>监控LLM调用的质量和成本</li>
</ol>
<h2 data-id="heading-20">5.5 Skillflow调度中心使用</h2>
<p><strong>主要功能</strong>：Skillflow定义、编排和执行</p>
<ul>
<li><strong>Skillflow设计</strong>：</li>
</ul>
<ol>
<li>使用可视化工具设计Skillflow</li>
<li>配置触发条件和执行逻辑</li>
<li>选择所需的SKILL和Agent</li>
<li>设置错误处理和重试策略</li>
</ol>
<ul>
<li><strong>Skillflow管理</strong>：</li>
</ul>
<ol>
<li>管理Skillflow的版本</li>
<li>监控Skillflow的执行状态</li>
<li>手动控制Skillflow的执行</li>
<li>分析Skillflow的执行效率</li>
<li>配置Skillflow的通知规则</li>
</ol>
<ul>
<li><strong>Skillflow执行</strong>：</li>
</ul>
<ol>
<li>自动触发或手动启动Skillflow</li>
<li>实时监控执行进度</li>
<li>处理执行过程中的异常</li>
<li>生成执行报告和日志</li>
</ol>
<h2 data-id="heading-21">6. 典型应用场景</h2>
<h2 data-id="heading-22">6.1 企业场景：跨系统AI能力协作</h2>
<h2 data-id="heading-23">场景描述</h2>
<p>企业用户通过Skillflow整合OA系统的文档处理AI、CRM系统的客户分析AI和ERP系统的数据分析AI，实现自动化的客户报告生成流程。</p>
<h2 data-id="heading-24">使用流程</h2>
<ol>
<li><strong>Auth认证</strong>：用户通过企业SSO登录SuperAgent</li>
<li><strong>MCPAgent接入</strong>：企业IT部门将OA、CRM、ERP系统的MCPAgent接入企业核心层</li>
<li><strong>SKILL注册</strong>：在Skill能力管理中心注册各系统的AI能力</li>
<li><strong>LLM配置</strong>：在LLM调度中心配置所需的LLM资源</li>
<li><strong>Skillflow设计</strong>：业务用户使用Skillflow编辑器设计"客户报告自动生成"工作流：</li>
</ol>
<ul>
<li>触发条件：CRM系统中客户状态变更</li>
<li>执行步骤： a. 调用OA AI生成客户相关文档摘要 b. 调用CRM AI分析客户行为数据 c. 调用ERP AI生成客户交易报告 d. 调用LLM调度中心生成完整客户报告 e. 自动发送给相关人员</li>
</ul>
<ol>
<li><strong>Skillflow执行</strong>：Skillflow调度中心负责执行和监控工作流</li>
<li><strong>数据存储</strong>：所有数据和执行结果存储到DataServer</li>
<li><strong>监控审计</strong>：通过监控系统查看工作流执行状态和审计日志</li>
</ol>
<h2 data-id="heading-25">6.2 个人场景：个人AI工具整合</h2>
<h2 data-id="heading-26">场景描述</h2>
<p>个人用户通过个人MCPAgent整合常用AI工具，实现自动化的工作提效流程。</p>
<h2 data-id="heading-27">使用流程</h2>
<ol>
<li><strong>Auth认证</strong>：个人用户注册并登录SuperAgent</li>
<li><strong>MCPAgent初始化</strong>：创建个人MCPAgent</li>
<li><strong>SKILL集成</strong>：在Skill能力管理中心发现并添加所需的个人AI工具</li>
<li><strong>LLM配置</strong>：在LLM调度中心配置个人LLM资源</li>
<li><strong>Skillflow设计</strong>：创建"会议助手"工作流：</li>
</ol>
<ul>
<li>触发条件：日历会议结束</li>
<li>执行步骤： a. 调用会议录音AI转写会议内容 b. 调用LLM生成会议摘要和行动项 c. 自动更新笔记系统 d. 将行动项添加到日历 e. 发送邮件通知相关人员</li>
</ul>
<ol>
<li><strong>Skillflow执行</strong>：Skillflow调度中心负责执行和监控工作流</li>
<li><strong>执行与监控</strong>：用户通过控制台监控执行状态</li>
</ol>
<h2 data-id="heading-28">7. OODER开源协议目录</h2>
<h2 data-id="heading-29">7.1 第三方系统MCPAgent接入文档</h2>
<ul>
<li><strong>文档简介</strong>：指导第三方系统如何将自己的MCPAgent接入SuperAgent企业核心层，实现AI能力的分发和调用</li>
<li><strong>接入流程</strong>：注册凭证获取 → 网络配置 → MCPAgent部署 → 系统接入 → 测试验证 → 上线运行</li>
<li><strong>关键特性</strong>：支持多种部署方式、提供完整的API文档、支持版本管理、提供SDK支持</li>
<li><strong>适用场景</strong>：企业系统AI能力外部分发、第三方服务集成、自定义AI能力开放</li>
</ul>
<h2 data-id="heading-30">7.2 Skill设计规范</h2>
<ul>
<li><strong>Skill开放能力设计</strong>：</li>
<li>支持1:n Capability关系</li>
<li>静态定义原则，开发完成后不可修改</li>
<li>统一的接口规范，支持RESTful API和gRPC</li>
<li>完整的权限控制机制</li>
<li><strong>LLM调用规范</strong>：</li>
<li>支持外部LLM和本地LLM调用</li>
<li>统一的LLM调用接口，封装不同LLM的差异</li>
<li>支持基于数据敏感性的LLM选择策略</li>
<li>实现LLM调用的成本控制和频率限制</li>
<li>支持LLM结果的过滤和审核</li>
</ul>
<h2 data-id="heading-31">7.3 Agent接入规范</h2>
<ul>
<li><strong>内部Agent通讯协议</strong>：</li>
<li>基于gRPC的高效二进制通信</li>
<li>支持TLS/SSL加密</li>
<li>内置心跳机制和断线重连</li>
<li>统一的消息格式和序列化机制</li>
<li><strong>Agent角色</strong>：</li>
<li><strong>MCPAgent</strong>：服务流入口，管理和协调其他Agent</li>
<li><strong>RouteAgent</strong>：桥接转发，连接MCPAgent和EndAgent</li>
<li><strong>EndAgent</strong>：功能执行，调用SKILL完成具体任务</li>
<li><strong>Agent接入流程</strong>：</li>
<li>自动发现MCPAgent服务</li>
<li>动态分配RouteAgent</li>
<li>自动注册Capability信息</li>
<li>支持批量入网</li>
</ul>
<h2 data-id="heading-32">7.4 Skillflow设计规范</h2>
<ul>
<li><strong>Skillflow定义</strong>：</li>
<li>基于DAG的工作流定义</li>
<li>支持多种触发条件</li>
<li>灵活的执行逻辑（顺序、并行、条件分支、循环）</li>
<li>完整的错误处理机制</li>
<li><strong>Skillflow执行</strong>：</li>
<li>支持同步和异步执行</li>
<li>支持断点续传</li>
<li>实时状态监控</li>
<li>完整的执行日志</li>
</ul>
<h2 data-id="heading-33">8. 加入OODER开源社区</h2>
<p>ooder SuperAgent项目采用<strong>MIT开源协议</strong>，欢迎企业和个人自由使用、修改和分发。我们欢迎社区的参与和贡献，共同构建一个强大的AI能力分发生态。</p>
<h2 data-id="heading-34">开源资源</h2>
<ul>
<li><strong>核心文档</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2FooderCN%2Fsuper-agent.git" target="_blank" title="https://gitee.com/ooderCN/super-agent.git" ref="nofollow noopener noreferrer">gitee.com/ooderCN/sup…</a></li>
</ul>
<h2 data-id="heading-35">开发支持</h2>
<ul>
<li>包含完整的SKILL开发示例</li>
<li>提供SKILL开发和调试工具</li>
</ul>
<h2 data-id="heading-36">关注OODER公众号</h2>
<p><strong>OODER开源</strong>公众号是SuperAgent项目的唯一首发渠道，我们将在公众号上发布：</p>
<ul>
<li>项目最新进展和版本更新</li>
<li>详细的技术文档和教程</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[taro项目踩坑指南——（一）]]></title>    <link>https://juejin.cn/post/7595994039108501540</link>    <guid>https://juejin.cn/post/7595994039108501540</guid>    <pubDate>2026-01-17T10:27:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595994039108501540" data-draft-id="7594627998852300806" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="taro项目踩坑指南——（一）"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-17T10:27:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Snack"/> <meta itemprop="url" content="https://juejin.cn/user/3423212600562768"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            taro项目踩坑指南——（一）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3423212600562768/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Snack
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T10:27:29.000Z" title="Sat Jan 17 2026 10:27:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">自定义导航栏</h3>
<p>在开发小程序的时候没有使用开发者工具，用的H5。想要有一个自定义的底部导航栏，所以就尝试了一下taro中的自定义导航栏。结果配置之后，直接让页面显示不出来内容了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef5992b6d6214917bca96f68a469b5e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU25hY2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769250448&amp;x-signature=LDLTKggX6uh15gFKSHBcVaFz2lM%3D" alt="image.png" loading="lazy"/></p>
<p>随后查询官网后，自定义导航栏好像只支持微信小程序的。H5的应该是没有的，把这段代码删掉之后就可以正常显示了。好烦！！！</p>
<p>在自定义导航栏时，应该由导航栏组件自行控制页面的变更和导航栏的状态变化。在<code>taro</code>中使用<code>useDidShow</code>这个生命周期<code>Hook</code>，通过页面显示，判断当前路由，并根据当前路由设置<code>activeTab</code>。在点击导航栏跳转页面时，使用<code>redirectTo</code>进行跳转。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">  <span class="hljs-title function_">useDidShow</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> pages = <span class="hljs-title class_">Taro</span>.<span class="hljs-title function_">getCurrentPages</span>();
    <span class="hljs-keyword">const</span> current = pages[pages.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>];
    <span class="hljs-keyword">const</span> route = current.<span class="hljs-property">route</span>;
    <span class="hljs-keyword">const</span> matched = tabList.<span class="hljs-title function_">find</span>(<span class="hljs-function">(<span class="hljs-params">tab</span>) =&gt;</span> tab.<span class="hljs-property">pagePath</span> === route);
    <span class="hljs-keyword">if</span> (matched) {
      <span class="hljs-title function_">setActiveTab</span>(matched.<span class="hljs-property">id</span>);
    }
  });

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">switchTab</span> = (<span class="hljs-params">tab</span>) =&gt; {
    <span class="hljs-keyword">if</span> (activeTab !== tab.<span class="hljs-property">id</span>) {
      <span class="hljs-title class_">Taro</span>.<span class="hljs-title function_">redirectTo</span>({ <span class="hljs-attr">url</span>: tab.<span class="hljs-property">pagePath</span> });
    }
  };
</code></pre>
<h3 data-id="heading-1">页面报错或者无渲染</h3>
<p>页面报错类型</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c230b01d0c2746ac9ac872e99ba39d5b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU25hY2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769250448&amp;x-signature=5aHlBwPVSud2259ckN5Qik8QNRY%3D" alt="image.png" loading="lazy"/></p>
<p>这通常是因为Taro无法识别到正确的页面组件。当使用react进行开发时，成为页面的那个组件需要默认导出
<code>export default functoin Index(){return &lt;&gt;&lt;/&gt;}</code>并且要在<code>app.config.ts</code>中配置正确的路由信息。</p>
<p>如果出现页面白屏没有节点渲染并且控制台没有出现报错的情况，这可能是因为组件需要接收的外部组件传来的数据为空或者是属性不匹配导致的。在使用的时候需要注意组件中的数据安全兜底，进行判空。</p>
<pre><code class="hljs language-react" lang="react">// 如果外部组件没有传入post，那么就不会渲染到页面上。（这是一个嵌入到页面中的组件）
export function Index(post){
    return (
        &lt;div&gt;{post.msg}&lt;/div&gt;
    )
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[用 Cherry Markdown 打造丝滑的 AI 对话体验：流式渲染完全指南]]></title>    <link>https://juejin.cn/post/7595847940621697074</link>    <guid>https://juejin.cn/post/7595847940621697074</guid>    <pubDate>2026-01-17T08:46:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595847940621697074" data-draft-id="7595842144906805298" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="用 Cherry Markdown 打造丝滑的 AI 对话体验：流式渲染完全指南"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-17T08:46:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小时前端"/> <meta itemprop="url" content="https://juejin.cn/user/1197805741808339"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            用 Cherry Markdown 打造丝滑的 AI 对话体验：流式渲染完全指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1197805741808339/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小时前端
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T08:46:35.000Z" title="Sat Jan 17 2026 08:46:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{font-size:24px;display:inline-block;font-weight:700;background:#ef7060;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(239,112,96,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 50px);border-bottom:3px solid #ef7060}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #3e3e3e;margin-top:32px;margin-bottom:32px;height:1px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(27,31,35,.05);color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:JetBranins Mono,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px;background-color:#fdfdfd}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#fdfdfd}.markdown-body a{text-decoration:none;font-weight:700;color:#ef7060;border-bottom:1px solid #ef7060}.markdown-body a:active,.markdown-body a:hover{color:#ef2d26}.markdown-body table tr td,.markdown-body table tr th{border:1px solid #ccc;padding:5px 10px}.markdown-body table{display:block!important;width:auto;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{background:#f0f0f0;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#f8f8f8}.markdown-body blockquote{margin-inline-start:0;margin-inline-end:0;border-left:3px solid #ef7060;background:#fff9f9;padding:1px 20px;margin-top:20px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-light">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-built_in,.hljs-class .hljs-title{color:#c18401}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">一、引言：AI 对话时代的 Markdown 渲染痛点</h2>
<h3 data-id="heading-1">1.1 ChatGPT 们的"打字机效果"是怎么实现的？</h3>
<p>当你与 ChatGPT、Claude 或文心一言对话时，是否注意到 AI 的回复会像真人打字一样，一个字一个字地"流"出来？这种流畅的体验背后，隐藏着一个技术难题：<strong>如何在流式输出过程中，实时渲染 Markdown 格式，而不露出丑陋的源码？</strong></p>
<p>传统的 Markdown 渲染器在流式场景下往往会"翻车"：</p>
<ul>
<li>代码块写到一半，用户看到的是 <code>\</code>``python\ndef hello(` 这样的源码</li>
<li>表格只输出了第一行，页面显示的是 <code>| 列1 | 列2 |</code> 这样的原始语法</li>
<li>数学公式还没写完，屏幕上出现 <code>$E = mc^</code> 这样的半成品</li>
</ul>
<h3 data-id="heading-2">1.2 传统 Markdown 渲染器的"翻车现场"</h3>
<p>让我们看一个典型的翻车案例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ❌ 传统方式：直接渲染不完整的 Markdown</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">streamOutput</span>(<span class="hljs-params">text</span>) {
  <span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>;
  <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> partial = text.<span class="hljs-title function_">substring</span>(<span class="hljs-number">0</span>, index++);
    <span class="hljs-title function_">renderMarkdown</span>(partial);  <span class="hljs-comment">// 问题：不完整的语法会显示源码</span>
  }, <span class="hljs-number">30</span>);
}

<span class="hljs-comment">// 当输出到 "```python\ndef" 时，页面显示：</span>
<span class="hljs-comment">// ```python</span>
<span class="hljs-comment">// def</span>
<span class="hljs-comment">// 而不是渲染后的代码块样式</span>
</code></pre>
<p>这就是为什么很多 AI 对话产品要么：</p>
<ul>
<li>等 AI 全部输出完再一次性渲染（失去了流式体验）</li>
<li>或者干脆不支持 Markdown，只用纯文本（功能受限）</li>
</ul>
<h3 data-id="heading-3">1.3 Cherry Markdown 的解决方案：智能自动补全</h3>
<p><strong>Cherry Markdown</strong>（<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTencent%2Fcherry-markdown" target="_blank" title="https://github.com/Tencent/cherry-markdown" ref="nofollow noopener noreferrer">GitHub 项目地址</a>）是一款由腾讯开源的 JavaScript Markdown 编辑器，它就像一位贴心的"语法助手"，专门为 AI 流式输出场景设计了智能补全机制。</p>
<p>想象一下，当 AI 正在逐字输出代码块时，Cherry Markdown 会"聪明地"识别出这是一个未完成的代码块，然后自动帮你补全闭合标记。这样，用户看到的永远是渲染后的漂亮代码样式，而不是尴尬的 <code>\</code>``python\ndef` 这样的源码片段。</p>
<p>Cherry Markdown 会自动识别未闭合的 Markdown 语法，并临时补全，确保在流式输出过程中始终显示渲染后的效果，而不是源码。简单来说，它让 AI 的"打字机效果"变得专业又优雅！✨</p>
<p>开启流式渲染后，Cherry 会对以下 12 种语法进行自动补全：</p>
<ul>
<li>✅ 标题（<code># H1</code>、<code>## H2</code> 等）</li>
<li>✅ 加粗、斜体（<code>**粗体**</code>、<code>*斜体*</code>）</li>
<li>✅ 超链接（<code>[文本](url)</code>）</li>
<li>✅ 图片、音视频（<code>![alt](url)</code>）</li>
<li>✅ 行内代码块（<code>`code`</code>）</li>
<li>✅ 段落代码块（<code>```code```</code>）</li>
<li>✅ 行内公式（<code>$formula$</code>）</li>
<li>✅ 段落公式（<code>$$formula$$</code>）</li>
<li>✅ 无序列表（<code>- item</code>）</li>
<li>✅ 表格（<code>| col1 | col2 |</code>）</li>
<li>✅ mermaid 画图（<code>```mermaid ```</code>）</li>
<li>✅ 脚注（<code>[^1]</code>）</li>
</ul>
<h2 data-id="heading-4">二、快速上手：5 分钟搭建 AI 对话界面</h2>
<h3 data-id="heading-5">2.1 最小可用代码</h3>
<p>让我们用最少的代码，搭建一个支持流式渲染的 AI 对话界面：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>AI 对话流式渲染示例<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/cherry-markdown/dist/cherry-markdown.min.css"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    <span class="hljs-selector-id">#chat-container</span> {
      <span class="hljs-attribute">max-width</span>: <span class="hljs-number">800px</span>;
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">50px</span> auto;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
      <span class="hljs-attribute">background</span>: <span class="hljs-number">#f5f5f5</span>;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"chat-container"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/cherry-markdown/dist/cherry-markdown.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
    <span class="hljs-comment">// 🔑 关键配置：开启流式渲染</span>
    <span class="hljs-keyword">const</span> cherry = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cherry</span>({
      <span class="hljs-attr">el</span>: <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'chat-container'</span>),
      <span class="hljs-attr">editor</span>: {
        <span class="hljs-attr">height</span>: <span class="hljs-string">'auto'</span>,
        <span class="hljs-attr">defaultModel</span>: <span class="hljs-string">'previewOnly'</span>,  <span class="hljs-comment">// 纯预览模式，无编辑区</span>
      },
      <span class="hljs-attr">engine</span>: {
        <span class="hljs-attr">global</span>: {
          <span class="hljs-attr">flowSessionContext</span>: <span class="hljs-literal">true</span>,     <span class="hljs-comment">// 开启流式渲染</span>
          <span class="hljs-attr">flowSessionCursor</span>: <span class="hljs-string">'default'</span>, <span class="hljs-comment">// 显示打字光标效果</span>
        },
      },
      <span class="hljs-attr">previewer</span>: {
        <span class="hljs-attr">enablePreviewerBubble</span>: <span class="hljs-literal">false</span>,   <span class="hljs-comment">// 关闭预览区编辑功能</span>
      },
    });

    <span class="hljs-comment">// 模拟 AI 流式输出</span>
    <span class="hljs-keyword">const</span> aiResponse = <span class="hljs-string">`### 你好！我是 AI 助手

这是一段**加粗文字**和*斜体文字*的演示。

代码示例：

\`\`\`python
def hello():
    print("Hello, World!")
\`\`\`

数学公式：$E = mc^2$
`</span>;

    <span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">streamOutput</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">if</span> (index &lt; aiResponse.<span class="hljs-property">length</span>) {
        cherry.<span class="hljs-title function_">setMarkdown</span>(aiResponse.<span class="hljs-title function_">substring</span>(<span class="hljs-number">0</span>, index + <span class="hljs-number">1</span>));
        index++;
        <span class="hljs-built_in">setTimeout</span>(streamOutput, <span class="hljs-number">30</span>);  <span class="hljs-comment">// 每 30ms 输出一个字符</span>
      }
    }
    
    <span class="hljs-title function_">streamOutput</span>();
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>将上述代码保存为 HTML 文件，在浏览器中打开，你就能看到 AI 逐字输出的效果，而且 Markdown 语法会实时渲染，不会露出源码！</p>
<h3 data-id="heading-6">2.2 关键配置项详解</h3>
<p>让我们详细解释一下每个配置项的作用：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> cherry = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cherry</span>({
  <span class="hljs-attr">el</span>: <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'chat-container'</span>),
  
  <span class="hljs-comment">// 📝 编辑器配置</span>
  <span class="hljs-attr">editor</span>: {
    <span class="hljs-attr">height</span>: <span class="hljs-string">'auto'</span>,              <span class="hljs-comment">// 高度自适应内容</span>
    <span class="hljs-attr">defaultModel</span>: <span class="hljs-string">'previewOnly'</span>,  <span class="hljs-comment">// 纯预览模式（AI 对话不需要编辑功能）</span>
  },
  
  <span class="hljs-comment">// ⚙️ 引擎配置（核心）</span>
  <span class="hljs-attr">engine</span>: {
    <span class="hljs-attr">global</span>: {
      <span class="hljs-comment">// 🔑 开启流式渲染模式</span>
      <span class="hljs-attr">flowSessionContext</span>: <span class="hljs-literal">true</span>,
      
      <span class="hljs-comment">// 🔑 虚拟光标配置</span>
      <span class="hljs-comment">// - "default": 使用默认光标样式（推荐）</span>
      <span class="hljs-comment">// - "": 不显示光标</span>
      <span class="hljs-comment">// - "&lt;span class='custom'&gt;|&lt;/span&gt;": 自定义光标 HTML</span>
      <span class="hljs-attr">flowSessionCursor</span>: <span class="hljs-string">'default'</span>,
    },
  },
  
  <span class="hljs-comment">// 👁️ 预览器配置</span>
  <span class="hljs-attr">previewer</span>: {
    <span class="hljs-attr">enablePreviewerBubble</span>: <span class="hljs-literal">false</span>,  <span class="hljs-comment">// 关闭预览区的编辑气泡（AI 场景不需要）</span>
  },
});
</code></pre>
<h3 data-id="heading-7">2.3 效果预览：开启 vs 关闭流式适配对比</h3>






























<table><thead><tr><th>场景</th><th>关闭流式适配</th><th>开启流式适配</th></tr></thead><tbody><tr><td>代码块写到一半</td><td>显示 <code>\</code>``python\ndef`</td><td>自动补全，显示代码块样式</td></tr><tr><td>表格只输出一行</td><td>显示 <code>| col1 | col2 |</code></td><td>自动补全表格结构</td></tr><tr><td>公式未完成</td><td>显示 <code>$E = mc^</code></td><td>等待公式完整后再渲染</td></tr><tr><td>渲染频率</td><td>最快 50ms</td><td>最快 10ms（快 5 倍）</td></tr></tbody></table>
<h2 data-id="heading-8">三、核心原理：流式渲染是如何工作的？</h2>
<h3 data-id="heading-9">3.1 自动补全机制：Cherry 如何"猜"你要写什么</h3>
<p>Cherry Markdown 的流式渲染核心在于<strong>智能语法补全</strong>。当检测到未闭合的 Markdown 语法时，它会自动插入临时闭合标记，确保渲染器能正确解析。</p>
<h4 data-id="heading-10">标题自动补全</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 流式输出："# Hello"</span>
<span class="hljs-comment">// Cherry 检测到 # 开头，自动补全为完整的标题语法</span>
<span class="hljs-comment">// 渲染结果：&lt;h1&gt;Hello&lt;/h1&gt;（而不是显示 "# Hello" 源码）</span>
</code></pre>
<h4 data-id="heading-11">代码块自动补全</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 流式输出："```python\ndef hello("</span>
<span class="hljs-comment">// Cherry 检测到 ``` 开始，自动补全闭合标记</span>
<span class="hljs-comment">// 渲染结果：显示代码块样式（而不是显示源码）</span>
</code></pre>
<h4 data-id="heading-12">表格自动补全</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 流式输出第一行："| 列1 | 列2 |"</span>
<span class="hljs-comment">// Cherry 检测到表格语法，自动补全第二行占位符</span>
<span class="hljs-comment">// 渲染结果：显示完整的表格结构（而不是显示源码）</span>
</code></pre>
<h4 data-id="heading-13">公式自动补全</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 流式输出："$E = mc^"</span>
<span class="hljs-comment">// Cherry 检测到 $ 开始但未闭合，等待完整公式</span>
<span class="hljs-comment">// 完整后："$E = mc^2$" → 渲染为数学公式</span>
</code></pre>
<h3 data-id="heading-14">3.2 渲染频率优化：从 50ms 到 10ms 的极致体验</h3>
<p>Cherry Markdown 在流式模式下，将渲染频率从默认的 50ms 优化到 10ms，提升了 5 倍性能：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 普通模式：最快 50ms 渲染一次</span>
<span class="hljs-keyword">const</span> cherryNormal = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cherry</span>({
  <span class="hljs-attr">engine</span>: {
    <span class="hljs-attr">global</span>: {
      <span class="hljs-attr">flowSessionContext</span>: <span class="hljs-literal">false</span>,  <span class="hljs-comment">// 关闭流式模式</span>
    },
  },
});

<span class="hljs-comment">// 流式模式：最快 10ms 渲染一次</span>
<span class="hljs-keyword">const</span> cherryStream = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cherry</span>({
  <span class="hljs-attr">engine</span>: {
    <span class="hljs-attr">global</span>: {
      <span class="hljs-attr">flowSessionContext</span>: <span class="hljs-literal">true</span>,   <span class="hljs-comment">// 开启流式模式</span>
    },
  },
});
</code></pre>
<p>这意味着在流式输出场景下，用户能感受到更流畅、更实时的渲染效果。</p>
<h3 data-id="heading-15">3.3 虚拟光标：模拟真实打字效果</h3>
<p>Cherry Markdown 提供了虚拟光标功能，在流式输出时显示一个闪烁的光标，模拟真人打字的效果：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">flowSessionCursor</span>: <span class="hljs-string">'default'</span>  <span class="hljs-comment">// 默认光标样式</span>
</code></pre>
<p>你也可以自定义光标样式：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">flowSessionCursor</span>: <span class="hljs-string">'&lt;span class="custom-cursor"&gt;|&lt;/span&gt;'</span>

<span class="hljs-comment">// CSS</span>
.<span class="hljs-property">custom</span>-cursor {
  <span class="hljs-attr">color</span>: #0d68ff;
  <span class="hljs-attr">animation</span>: blink 1s infinite;
}
@keyframes blink {
  <span class="hljs-number">0</span>%, <span class="hljs-number">50</span>% { <span class="hljs-attr">opacity</span>: <span class="hljs-number">1</span>; }
  <span class="hljs-number">51</span>%, <span class="hljs-number">100</span>% { <span class="hljs-attr">opacity</span>: <span class="hljs-number">0</span>; }
}
</code></pre>
<h2 data-id="heading-16">四、实战案例：构建一个完整的 AI Chat 应用</h2>
<h3 data-id="heading-17">4.1 案例一：模拟 ChatGPT 流式输出</h3>
<p>这个案例展示了如何模拟 ChatGPT 的逐字输出效果：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>模拟 ChatGPT 流式输出<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/cherry-markdown/dist/cherry-markdown.min.css"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    <span class="hljs-selector-tag">body</span> {
      <span class="hljs-attribute">font-family</span>: -apple-system, BlinkMacSystemFont, <span class="hljs-string">'Segoe UI'</span>, sans-serif;
      <span class="hljs-attribute">max-width</span>: <span class="hljs-number">800px</span>;
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">50px</span> auto;
      <span class="hljs-attribute">background</span>: <span class="hljs-number">#f8f9fb</span>;
    }
    <span class="hljs-selector-class">.chat-message</span> {
      <span class="hljs-attribute">background</span>: white;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">16px</span>;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
      <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">16px</span>;
      <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">1px</span> <span class="hljs-number">2px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.1</span>);
    }
    <span class="hljs-selector-class">.avatar</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">32px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">32px</span>;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>;
      <span class="hljs-attribute">background</span>: <span class="hljs-number">#0d68ff</span>;
      <span class="hljs-attribute">color</span>: white;
      <span class="hljs-attribute">display</span>: inline-flex;
      <span class="hljs-attribute">align-items</span>: center;
      <span class="hljs-attribute">justify-content</span>: center;
      <span class="hljs-attribute">font-weight</span>: bold;
      <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">12px</span>;
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"chat-container"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/cherry-markdown/dist/cherry-markdown.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
    <span class="hljs-comment">// AI 回复内容</span>
    <span class="hljs-keyword">const</span> aiResponse = <span class="hljs-string">`### 你好！我是 AI 助手

我可以帮你解答问题、写代码、分析数据等。

**功能特点：**
- 支持 Markdown 格式
- 代码高亮显示
- 数学公式渲染

**代码示例：**

\`\`\`python
def fibonacci(n):
    if n &lt;= 1:
        return n
    return fibonacci(n-1) + fibonacci(n-2)

print(fibonacci(10))
\`\`\`

**数学公式：**

行内公式：$E = mc^2$

段落公式：

$$\\int_{-\\infty}^{\\infty} e^{-x^2} dx = \\sqrt{\\pi}$$

**表格示例：**

| 功能 | 状态 | 说明 |
|:----|:----:|------|
| Markdown | ✅ | 完全支持 |
| 代码高亮 | ✅ | 支持多种语言 |
| 数学公式 | ✅ | LaTeX 语法 |
`</span>;

    <span class="hljs-comment">// 创建 Cherry 实例</span>
    <span class="hljs-keyword">const</span> cherry = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cherry</span>({
      <span class="hljs-attr">el</span>: <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'chat-container'</span>),
      <span class="hljs-attr">editor</span>: {
        <span class="hljs-attr">height</span>: <span class="hljs-string">'auto'</span>,
        <span class="hljs-attr">defaultModel</span>: <span class="hljs-string">'previewOnly'</span>,
      },
      <span class="hljs-attr">engine</span>: {
        <span class="hljs-attr">global</span>: {
          <span class="hljs-attr">flowSessionContext</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">flowSessionCursor</span>: <span class="hljs-string">'default'</span>,
        },
      },
      <span class="hljs-attr">previewer</span>: {
        <span class="hljs-attr">enablePreviewerBubble</span>: <span class="hljs-literal">false</span>,
      },
    });

    <span class="hljs-comment">// 流式输出函数</span>
    <span class="hljs-keyword">let</span> currentIndex = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">const</span> outputSpeed = <span class="hljs-number">30</span>; <span class="hljs-comment">// 每 30ms 输出一个字符</span>

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">streamOutput</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">if</span> (currentIndex &lt; aiResponse.<span class="hljs-property">length</span>) {
        <span class="hljs-keyword">const</span> partialText = aiResponse.<span class="hljs-title function_">substring</span>(<span class="hljs-number">0</span>, currentIndex + <span class="hljs-number">1</span>);
        cherry.<span class="hljs-title function_">setMarkdown</span>(partialText);
        currentIndex++;
        <span class="hljs-built_in">setTimeout</span>(streamOutput, outputSpeed);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'输出完成！'</span>);
      }
    }

    <span class="hljs-comment">// 开始输出</span>
    <span class="hljs-title function_">streamOutput</span>();
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h3 data-id="heading-18">4.2 案例二：对接真实 LLM API（SSE 流式接口）</h3>
<p>这个案例展示如何对接真实的 AI API，实现真正的流式对话：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>对接真实 AI API<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/cherry-markdown/dist/cherry-markdown.min.css"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    <span class="hljs-selector-tag">body</span> {
      <span class="hljs-attribute">font-family</span>: -apple-system, sans-serif;
      <span class="hljs-attribute">max-width</span>: <span class="hljs-number">900px</span>;
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">50px</span> auto;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
    }
    <span class="hljs-selector-id">#input-area</span> {
      <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">20px</span>;
    }
    <span class="hljs-selector-id">#user-input</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span>;
      <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ddd</span>;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">6px</span>;
      <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
    }
    <span class="hljs-selector-id">#send-btn</span> {
      <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">10px</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span> <span class="hljs-number">20px</span>;
      <span class="hljs-attribute">background</span>: <span class="hljs-number">#0d68ff</span>;
      <span class="hljs-attribute">color</span>: white;
      <span class="hljs-attribute">border</span>: none;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">6px</span>;
      <span class="hljs-attribute">cursor</span>: pointer;
    }
    <span class="hljs-selector-id">#send-btn</span><span class="hljs-selector-pseudo">:disabled</span> {
      <span class="hljs-attribute">background</span>: <span class="hljs-number">#ccc</span>;
      <span class="hljs-attribute">cursor</span>: not-allowed;
    }
    <span class="hljs-selector-class">.message</span> {
      <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">20px</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">16px</span>;
      <span class="hljs-attribute">background</span>: <span class="hljs-number">#f8f9fb</span>;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
    }
    <span class="hljs-selector-class">.message</span><span class="hljs-selector-class">.user</span> {
      <span class="hljs-attribute">background</span>: <span class="hljs-number">#e3f2fd</span>;
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"input-area"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"user-input"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"输入你的问题..."</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"send-btn"</span>&gt;</span>发送<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"messages-container"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/cherry-markdown/dist/cherry-markdown.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
    <span class="hljs-keyword">const</span> messagesContainer = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'messages-container'</span>);
    <span class="hljs-keyword">const</span> userInput = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'user-input'</span>);
    <span class="hljs-keyword">const</span> sendBtn = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'send-btn'</span>);

    <span class="hljs-comment">// 创建用户消息</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">createUserMessage</span>(<span class="hljs-params">text</span>) {
      <span class="hljs-keyword">const</span> div = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
      div.<span class="hljs-property">className</span> = <span class="hljs-string">'message user'</span>;
      div.<span class="hljs-property">textContent</span> = text;
      messagesContainer.<span class="hljs-title function_">appendChild</span>(div);
    }

    <span class="hljs-comment">// 创建 AI 消息容器</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">createAIMessage</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">const</span> div = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
      div.<span class="hljs-property">className</span> = <span class="hljs-string">'message'</span>;
      <span class="hljs-keyword">const</span> container = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
      container.<span class="hljs-property">id</span> = <span class="hljs-string">`ai-msg-<span class="hljs-subst">${<span class="hljs-built_in">Date</span>.now()}</span>`</span>;
      div.<span class="hljs-title function_">appendChild</span>(container);
      messagesContainer.<span class="hljs-title function_">appendChild</span>(div);
      <span class="hljs-keyword">return</span> container;
    }

    <span class="hljs-comment">// 初始化 Cherry 实例</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">createCherryInstance</span>(<span class="hljs-params">container</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cherry</span>({
        <span class="hljs-attr">el</span>: container,
        <span class="hljs-attr">editor</span>: {
          <span class="hljs-attr">height</span>: <span class="hljs-string">'auto'</span>,
          <span class="hljs-attr">defaultModel</span>: <span class="hljs-string">'previewOnly'</span>,
        },
        <span class="hljs-attr">engine</span>: {
          <span class="hljs-attr">global</span>: {
            <span class="hljs-attr">flowSessionContext</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">flowSessionCursor</span>: <span class="hljs-string">'default'</span>,
          },
        },
        <span class="hljs-attr">previewer</span>: {
          <span class="hljs-attr">enablePreviewerBubble</span>: <span class="hljs-literal">false</span>,
        },
      });
    }

    <span class="hljs-comment">// 对接 SSE 流式 API</span>
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">chatWithAI</span>(<span class="hljs-params">prompt</span>) {
      <span class="hljs-comment">// 显示用户消息</span>
      <span class="hljs-title function_">createUserMessage</span>(prompt);

      <span class="hljs-comment">// 创建 AI 消息容器</span>
      <span class="hljs-keyword">const</span> aiContainer = <span class="hljs-title function_">createAIMessage</span>();
      <span class="hljs-keyword">const</span> cherry = <span class="hljs-title function_">createCherryInstance</span>(aiContainer);

      <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 调用你的 AI API（这里以 OpenAI 兼容接口为例）</span>
        <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/chat/stream'</span>, {
          <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
          <span class="hljs-attr">headers</span>: {
            <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>,
          },
          <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
            <span class="hljs-attr">messages</span>: [{ <span class="hljs-attr">role</span>: <span class="hljs-string">'user'</span>, <span class="hljs-attr">content</span>: prompt }],
          }),
        });

        <span class="hljs-keyword">const</span> reader = response.<span class="hljs-property">body</span>.<span class="hljs-title function_">getReader</span>();
        <span class="hljs-keyword">const</span> decoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextDecoder</span>();
        <span class="hljs-keyword">let</span> fullText = <span class="hljs-string">''</span>;

        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
          <span class="hljs-keyword">const</span> { done, value } = <span class="hljs-keyword">await</span> reader.<span class="hljs-title function_">read</span>();
          <span class="hljs-keyword">if</span> (done) <span class="hljs-keyword">break</span>;

          <span class="hljs-comment">// 解析 SSE 数据</span>
          <span class="hljs-keyword">const</span> chunk = decoder.<span class="hljs-title function_">decode</span>(value);
          <span class="hljs-keyword">const</span> lines = chunk.<span class="hljs-title function_">split</span>(<span class="hljs-string">'\n'</span>);

          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> line <span class="hljs-keyword">of</span> lines) {
            <span class="hljs-keyword">if</span> (line.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'data: '</span>)) {
              <span class="hljs-keyword">const</span> data = line.<span class="hljs-title function_">slice</span>(<span class="hljs-number">6</span>);
              <span class="hljs-keyword">if</span> (data === <span class="hljs-string">'[DONE]'</span>) <span class="hljs-keyword">continue</span>;

              <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">const</span> json = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(data);
                <span class="hljs-keyword">const</span> delta = json.<span class="hljs-property">choices</span>[<span class="hljs-number">0</span>].<span class="hljs-property">delta</span>.<span class="hljs-property">content</span> || <span class="hljs-string">''</span>;
                fullText += delta;
                
                <span class="hljs-comment">// 🔑 实时更新 Markdown 内容</span>
                cherry.<span class="hljs-title function_">setMarkdown</span>(fullText);
              } <span class="hljs-keyword">catch</span> (e) {
                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'解析错误:'</span>, e);
              }
            }
          }
        }
      } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'API 调用失败:'</span>, error);
        cherry.<span class="hljs-title function_">setMarkdown</span>(<span class="hljs-string">'**错误：** 无法连接到 AI 服务，请稍后重试。'</span>);
      }
    }

    <span class="hljs-comment">// 发送按钮事件</span>
    sendBtn.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">async</span> () =&gt; {
      <span class="hljs-keyword">const</span> prompt = userInput.<span class="hljs-property">value</span>.<span class="hljs-title function_">trim</span>();
      <span class="hljs-keyword">if</span> (!prompt) <span class="hljs-keyword">return</span>;

      sendBtn.<span class="hljs-property">disabled</span> = <span class="hljs-literal">true</span>;
      userInput.<span class="hljs-property">value</span> = <span class="hljs-string">''</span>;
      
      <span class="hljs-keyword">await</span> <span class="hljs-title function_">chatWithAI</span>(prompt);
      
      sendBtn.<span class="hljs-property">disabled</span> = <span class="hljs-literal">false</span>;
      userInput.<span class="hljs-title function_">focus</span>();
    });

    <span class="hljs-comment">// 回车发送</span>
    userInput.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'keypress'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (e.<span class="hljs-property">key</span> === <span class="hljs-string">'Enter'</span> &amp;&amp; !sendBtn.<span class="hljs-property">disabled</span>) {
        sendBtn.<span class="hljs-title function_">click</span>();
      }
    });
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h3 data-id="heading-19">4.3 案例三：支持暂停/继续的流式渲染控制</h3>
<p>这个案例展示了如何实现暂停和继续功能，让用户控制流式输出的节奏：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>可控制的流式输出<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/cherry-markdown/dist/cherry-markdown.min.css"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    <span class="hljs-selector-tag">body</span> {
      <span class="hljs-attribute">font-family</span>: -apple-system, sans-serif;
      <span class="hljs-attribute">max-width</span>: <span class="hljs-number">800px</span>;
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">50px</span> auto;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
    }
    <span class="hljs-selector-class">.controls</span> {
      <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">20px</span>;
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">gap</span>: <span class="hljs-number">10px</span>;
    }
    <span class="hljs-selector-tag">button</span> {
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span> <span class="hljs-number">20px</span>;
      <span class="hljs-attribute">border</span>: none;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">6px</span>;
      <span class="hljs-attribute">cursor</span>: pointer;
      <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
    }
    <span class="hljs-selector-class">.btn-primary</span> {
      <span class="hljs-attribute">background</span>: <span class="hljs-number">#0d68ff</span>;
      <span class="hljs-attribute">color</span>: white;
    }
    <span class="hljs-selector-class">.btn-secondary</span> {
      <span class="hljs-attribute">background</span>: <span class="hljs-number">#6c757d</span>;
      <span class="hljs-attribute">color</span>: white;
    }
    <span class="hljs-selector-tag">button</span><span class="hljs-selector-pseudo">:disabled</span> {
      <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.5</span>;
      <span class="hljs-attribute">cursor</span>: not-allowed;
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"controls"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"start-btn"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn-primary"</span>&gt;</span>开始流式输出<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"pause-btn"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn-secondary"</span> <span class="hljs-attr">disabled</span>&gt;</span>暂停<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"resume-btn"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn-secondary"</span> <span class="hljs-attr">disabled</span>&gt;</span>继续<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"reset-btn"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn-secondary"</span>&gt;</span>重置<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"output-container"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/cherry-markdown/dist/cherry-markdown.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
    <span class="hljs-keyword">const</span> outputContainer = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'output-container'</span>);
    <span class="hljs-keyword">const</span> startBtn = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'start-btn'</span>);
    <span class="hljs-keyword">const</span> pauseBtn = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'pause-btn'</span>);
    <span class="hljs-keyword">const</span> resumeBtn = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'resume-btn'</span>);
    <span class="hljs-keyword">const</span> resetBtn = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'reset-btn'</span>);

    <span class="hljs-comment">// AI 回复内容</span>
    <span class="hljs-keyword">const</span> aiResponse = <span class="hljs-string">`### 可控制的流式输出演示

这段内容支持**暂停**和**继续**功能。

\`\`\`javascript
// 暂停流式输出
paused = true;

// 继续流式输出
paused = false;
\`\`\`

数学公式：$\\sum_{i=1}^{n} i = \\frac{n(n+1)}{2}$

**功能特点：**
- ✅ 可以随时暂停
- ✅ 可以继续输出
- ✅ 可以重置重新开始
`</span>;

    <span class="hljs-keyword">let</span> cherry = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">let</span> currentIndex = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">let</span> paused = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">let</span> streaming = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">let</span> streamTimer = <span class="hljs-literal">null</span>;

    <span class="hljs-comment">// 初始化 Cherry</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">initCherry</span>(<span class="hljs-params"/>) {
      cherry = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cherry</span>({
        <span class="hljs-attr">el</span>: outputContainer,
        <span class="hljs-attr">editor</span>: {
          <span class="hljs-attr">height</span>: <span class="hljs-string">'auto'</span>,
          <span class="hljs-attr">defaultModel</span>: <span class="hljs-string">'previewOnly'</span>,
        },
        <span class="hljs-attr">engine</span>: {
          <span class="hljs-attr">global</span>: {
            <span class="hljs-attr">flowSessionContext</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">flowSessionCursor</span>: <span class="hljs-string">'default'</span>,
          },
        },
        <span class="hljs-attr">previewer</span>: {
          <span class="hljs-attr">enablePreviewerBubble</span>: <span class="hljs-literal">false</span>,
        },
      });
    }

    <span class="hljs-comment">// 流式输出函数</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">streamOutput</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">if</span> (paused) {
        <span class="hljs-comment">// 暂停时，每 100ms 检查一次是否恢复</span>
        streamTimer = <span class="hljs-built_in">setTimeout</span>(streamOutput, <span class="hljs-number">100</span>);
        <span class="hljs-keyword">return</span>;
      }

      <span class="hljs-keyword">if</span> (currentIndex &lt; aiResponse.<span class="hljs-property">length</span>) {
        <span class="hljs-keyword">const</span> partialText = aiResponse.<span class="hljs-title function_">substring</span>(<span class="hljs-number">0</span>, currentIndex + <span class="hljs-number">1</span>);
        cherry.<span class="hljs-title function_">setMarkdown</span>(partialText);
        currentIndex++;
        streamTimer = <span class="hljs-built_in">setTimeout</span>(streamOutput, <span class="hljs-number">30</span>);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 输出完成</span>
        streaming = <span class="hljs-literal">false</span>;
        startBtn.<span class="hljs-property">disabled</span> = <span class="hljs-literal">false</span>;
        pauseBtn.<span class="hljs-property">disabled</span> = <span class="hljs-literal">true</span>;
        resumeBtn.<span class="hljs-property">disabled</span> = <span class="hljs-literal">true</span>;
      }
    }

    <span class="hljs-comment">// 开始输出</span>
    startBtn.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">if</span> (!cherry) <span class="hljs-title function_">initCherry</span>();
      
      currentIndex = <span class="hljs-number">0</span>;
      paused = <span class="hljs-literal">false</span>;
      streaming = <span class="hljs-literal">true</span>;
      
      startBtn.<span class="hljs-property">disabled</span> = <span class="hljs-literal">true</span>;
      pauseBtn.<span class="hljs-property">disabled</span> = <span class="hljs-literal">false</span>;
      resumeBtn.<span class="hljs-property">disabled</span> = <span class="hljs-literal">true</span>;
      
      cherry.<span class="hljs-title function_">setMarkdown</span>(<span class="hljs-string">''</span>);
      <span class="hljs-title function_">streamOutput</span>();
    });

    <span class="hljs-comment">// 暂停输出</span>
    pauseBtn.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
      paused = <span class="hljs-literal">true</span>;
      pauseBtn.<span class="hljs-property">disabled</span> = <span class="hljs-literal">true</span>;
      resumeBtn.<span class="hljs-property">disabled</span> = <span class="hljs-literal">false</span>;
    });

    <span class="hljs-comment">// 继续输出</span>
    resumeBtn.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
      paused = <span class="hljs-literal">false</span>;
      pauseBtn.<span class="hljs-property">disabled</span> = <span class="hljs-literal">false</span>;
      resumeBtn.<span class="hljs-property">disabled</span> = <span class="hljs-literal">true</span>;
    });

    <span class="hljs-comment">// 重置</span>
    resetBtn.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">if</span> (streamTimer) {
        <span class="hljs-built_in">clearTimeout</span>(streamTimer);
        streamTimer = <span class="hljs-literal">null</span>;
      }
      
      currentIndex = <span class="hljs-number">0</span>;
      paused = <span class="hljs-literal">false</span>;
      streaming = <span class="hljs-literal">false</span>;
      
      <span class="hljs-keyword">if</span> (cherry) {
        cherry.<span class="hljs-title function_">setMarkdown</span>(<span class="hljs-string">''</span>);
      }
      
      startBtn.<span class="hljs-property">disabled</span> = <span class="hljs-literal">false</span>;
      pauseBtn.<span class="hljs-property">disabled</span> = <span class="hljs-literal">true</span>;
      resumeBtn.<span class="hljs-property">disabled</span> = <span class="hljs-literal">true</span>;
    });

    <span class="hljs-comment">// 初始化</span>
    <span class="hljs-title function_">initCherry</span>();
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h2 data-id="heading-20">五、进阶技巧：让 AI 对话更专业</h2>
<h3 data-id="heading-21">5.1 异步渲染回调：mermaid 图表完成后的处理</h3>
<p>从 mermaid v10.0.0 开始，渲染逻辑由同步改为异步。Cherry Markdown 提供了 <code>afterAsyncRender</code> 回调，让你在异步渲染完成后获取结果：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> cherry = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cherry</span>({
  <span class="hljs-attr">el</span>: <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'container'</span>),
  <span class="hljs-attr">value</span>: <span class="hljs-string">`
    \`\`\`mermaid
    graph LR
        A[开始] --&gt; B[处理]
        B --&gt; C[结束]
    \`\`\`
  `</span>,
  <span class="hljs-attr">editor</span>: {
    <span class="hljs-attr">defaultModel</span>: <span class="hljs-string">'previewOnly'</span>,
  },
  <span class="hljs-attr">engine</span>: {
    <span class="hljs-attr">global</span>: {
      <span class="hljs-attr">flowSessionContext</span>: <span class="hljs-literal">true</span>,
    },
  },
  <span class="hljs-attr">callback</span>: {
    <span class="hljs-comment">// 🔑 异步渲染完成回调</span>
    <span class="hljs-attr">afterAsyncRender</span>: <span class="hljs-function">(<span class="hljs-params">md, html</span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Markdown 源码:'</span>, md);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'渲染后的 HTML:'</span>, html);
      
      <span class="hljs-comment">// 可以在这里做一些后处理，比如：</span>
      <span class="hljs-comment">// - 统计图表数量</span>
      <span class="hljs-comment">// - 添加交互功能</span>
      <span class="hljs-comment">// - 发送分析数据</span>
    },
  },
});
</code></pre>
<h3 data-id="heading-22">5.2 自定义流式光标样式</h3>
<p>你可以完全自定义光标的样式，让它更符合你的产品设计：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> cherry = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cherry</span>({
  <span class="hljs-attr">el</span>: <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'container'</span>),
  <span class="hljs-attr">engine</span>: {
    <span class="hljs-attr">global</span>: {
      <span class="hljs-attr">flowSessionContext</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-comment">// 自定义光标 HTML</span>
      <span class="hljs-attr">flowSessionCursor</span>: <span class="hljs-string">'&lt;span class="custom-cursor"&gt;▋&lt;/span&gt;'</span>,
    },
  },
});

<span class="hljs-comment">// CSS</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.custom-cursor</span> {
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#0d68ff</span>;
  <span class="hljs-attribute">font-weight</span>: bold;
  <span class="hljs-attribute">animation</span>: blink <span class="hljs-number">1s</span> step-end infinite;
  <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">2px</span>;
}

<span class="hljs-keyword">@keyframes</span> blink {
  <span class="hljs-number">0%</span>, <span class="hljs-number">50%</span> { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>; }
  <span class="hljs-number">51%</span>, <span class="hljs-number">100%</span> { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>; }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span>
</code></pre>
<h3 data-id="heading-23">5.3 多轮对话的消息管理</h3>
<p>在实际的 AI 对话应用中，你需要管理多轮对话。以下是一个完整的消息管理示例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ChatManager</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">container</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span> = container;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">messages</span> = [];
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">cherryInstances</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
  }

  <span class="hljs-comment">// 添加用户消息</span>
  <span class="hljs-title function_">addUserMessage</span>(<span class="hljs-params">content</span>) {
    <span class="hljs-keyword">const</span> msg = {
      <span class="hljs-attr">id</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
      <span class="hljs-attr">role</span>: <span class="hljs-string">'user'</span>,
      content,
      <span class="hljs-attr">timestamp</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(),
    };
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">messages</span>.<span class="hljs-title function_">push</span>(msg);
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">renderUserMessage</span>(msg);
  }

  <span class="hljs-comment">// 添加 AI 消息（流式）</span>
  <span class="hljs-title function_">addAIMessageStream</span>(<span class="hljs-params">streamCallback</span>) {
    <span class="hljs-keyword">const</span> msgId = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
    <span class="hljs-keyword">const</span> msg = {
      <span class="hljs-attr">id</span>: msgId,
      <span class="hljs-attr">role</span>: <span class="hljs-string">'assistant'</span>,
      <span class="hljs-attr">content</span>: <span class="hljs-string">''</span>,
      <span class="hljs-attr">timestamp</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(),
    };
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">messages</span>.<span class="hljs-title function_">push</span>(msg);

    <span class="hljs-comment">// 创建消息 DOM</span>
    <span class="hljs-keyword">const</span> msgDiv = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
    msgDiv.<span class="hljs-property">className</span> = <span class="hljs-string">'ai-message'</span>;
    msgDiv.<span class="hljs-property">id</span> = <span class="hljs-string">`msg-<span class="hljs-subst">${msgId}</span>`</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>.<span class="hljs-title function_">appendChild</span>(msgDiv);

    <span class="hljs-comment">// 创建 Cherry 实例</span>
    <span class="hljs-keyword">const</span> cherry = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cherry</span>({
      <span class="hljs-attr">el</span>: msgDiv,
      <span class="hljs-attr">editor</span>: {
        <span class="hljs-attr">height</span>: <span class="hljs-string">'auto'</span>,
        <span class="hljs-attr">defaultModel</span>: <span class="hljs-string">'previewOnly'</span>,
      },
      <span class="hljs-attr">engine</span>: {
        <span class="hljs-attr">global</span>: {
          <span class="hljs-attr">flowSessionContext</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">flowSessionCursor</span>: <span class="hljs-string">'default'</span>,
        },
      },
      <span class="hljs-attr">previewer</span>: {
        <span class="hljs-attr">enablePreviewerBubble</span>: <span class="hljs-literal">false</span>,
      },
    });

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">cherryInstances</span>.<span class="hljs-title function_">set</span>(msgId, cherry);

    <span class="hljs-comment">// 流式更新内容</span>
    <span class="hljs-keyword">let</span> fullText = <span class="hljs-string">''</span>;
    <span class="hljs-title function_">streamCallback</span>(<span class="hljs-function">(<span class="hljs-params">chunk</span>) =&gt;</span> {
      fullText += chunk;
      cherry.<span class="hljs-title function_">setMarkdown</span>(fullText);
      msg.<span class="hljs-property">content</span> = fullText;
    });

    <span class="hljs-keyword">return</span> msgId;
  }

  <span class="hljs-comment">// 渲染用户消息</span>
  <span class="hljs-title function_">renderUserMessage</span>(<span class="hljs-params">msg</span>) {
    <span class="hljs-keyword">const</span> div = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
    div.<span class="hljs-property">className</span> = <span class="hljs-string">'user-message'</span>;
    div.<span class="hljs-property">textContent</span> = msg.<span class="hljs-property">content</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>.<span class="hljs-title function_">appendChild</span>(div);
  }

  <span class="hljs-comment">// 获取所有消息（用于 API 调用）</span>
  <span class="hljs-title function_">getMessagesForAPI</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">messages</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">msg</span> =&gt;</span> ({
      <span class="hljs-attr">role</span>: msg.<span class="hljs-property">role</span>,
      <span class="hljs-attr">content</span>: msg.<span class="hljs-property">content</span>,
    }));
  }
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-keyword">const</span> chatManager = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChatManager</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'chat-container'</span>));

<span class="hljs-comment">// 用户发送消息</span>
chatManager.<span class="hljs-title function_">addUserMessage</span>(<span class="hljs-string">'你好，请介绍一下 Markdown'</span>);

<span class="hljs-comment">// AI 流式回复</span>
<span class="hljs-keyword">const</span> msgId = chatManager.<span class="hljs-title function_">addAIMessageStream</span>(<span class="hljs-function">(<span class="hljs-params">update</span>) =&gt;</span> {
  <span class="hljs-comment">// 模拟流式输出</span>
  <span class="hljs-keyword">const</span> response = <span class="hljs-string">'### Markdown 简介\n\nMarkdown 是一种轻量级标记语言...'</span>;
  <span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (index &lt; response.<span class="hljs-property">length</span>) {
      <span class="hljs-title function_">update</span>(response[index]);
      index++;
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-built_in">clearInterval</span>(timer);
    }
  }, <span class="hljs-number">30</span>);
});
</code></pre>
<h3 data-id="heading-24">5.4 性能优化：大量消息时的处理策略</h3>
<p>当对话消息很多时，需要注意性能优化：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">OptimizedChatManager</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">container, maxVisibleMessages = <span class="hljs-number">10</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span> = container;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">messages</span> = [];
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxVisibleMessages</span> = maxVisibleMessages;
  }

  <span class="hljs-comment">// 只渲染最近的消息</span>
  <span class="hljs-title function_">renderMessages</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 清空容器</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">''</span>;

    <span class="hljs-comment">// 只渲染最后 N 条消息</span>
    <span class="hljs-keyword">const</span> visibleMessages = <span class="hljs-variable language_">this</span>.<span class="hljs-property">messages</span>.<span class="hljs-title function_">slice</span>(-<span class="hljs-variable language_">this</span>.<span class="hljs-property">maxVisibleMessages</span>);

    visibleMessages.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">msg</span> =&gt;</span> {
      <span class="hljs-keyword">if</span> (msg.<span class="hljs-property">role</span> === <span class="hljs-string">'user'</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">renderUserMessage</span>(msg);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">renderAIMessage</span>(msg);
      }
    });

    <span class="hljs-comment">// 滚动到底部</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">scrollToBottom</span>();
  }

  <span class="hljs-comment">// 虚拟滚动（适用于超大量消息）</span>
  <span class="hljs-title function_">renderWithVirtualScroll</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 实现虚拟滚动逻辑</span>
    <span class="hljs-comment">// 只渲染可见区域的消息</span>
  }

  <span class="hljs-comment">// 懒加载历史消息</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">loadHistoryMessages</span>(<span class="hljs-params">offset = <span class="hljs-number">0</span>, limit = <span class="hljs-number">20</span></span>) {
    <span class="hljs-comment">// 从服务器加载历史消息</span>
    <span class="hljs-keyword">const</span> history = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/messages?offset=<span class="hljs-subst">${offset}</span>&amp;limit=<span class="hljs-subst">${limit}</span>`</span>);
    <span class="hljs-keyword">const</span> messages = <span class="hljs-keyword">await</span> history.<span class="hljs-title function_">json</span>();
    
    <span class="hljs-comment">// 插入到消息列表前面</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">messages</span>.<span class="hljs-title function_">unshift</span>(...messages);
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">renderMessages</span>();
  }
}
</code></pre>
<h2 data-id="heading-25">六、总结与资源</h2>
<h3 data-id="heading-26">6.1 适用场景一览</h3>
<p>Cherry Markdown 的流式渲染功能特别适合以下场景：</p>



































<table><thead><tr><th>场景</th><th>说明</th><th>优势</th></tr></thead><tbody><tr><td>AI 对话应用</td><td>ChatGPT、Claude 等对话界面</td><td>实时渲染，不露源码</td></tr><tr><td>代码生成工具</td><td>AI 生成代码的实时展示</td><td>代码高亮完整显示</td></tr><tr><td>文档生成工具</td><td>流式生成 Markdown 文档</td><td>所见即所得</td></tr><tr><td>在线教育</td><td>实时讲解 Markdown 语法</td><td>教学演示更直观</td></tr><tr><td>协作编辑</td><td>多人实时编辑 Markdown</td><td>流畅的协作体验</td></tr></tbody></table>
<h3 data-id="heading-27">6.2 在线 Demo 与文档链接</h3>
<ul>
<li><strong>在线演示</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Ftencent.github.io%2Fcherry-markdown%2Fexamples%2Fai_chat.html" target="_blank" title="https://tencent.github.io/cherry-markdown/examples/ai_chat.html" ref="nofollow noopener noreferrer">AI Chat 流式渲染 Demo</a></li>
<li><strong>完整文档</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTencent%2Fcherry-markdown%2Fwiki" target="_blank" title="https://github.com/Tencent/cherry-markdown/wiki" ref="nofollow noopener noreferrer">Cherry Markdown Wiki</a></li>
<li><strong>GitHub 仓库</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTencent%2Fcherry-markdown" target="_blank" title="https://github.com/Tencent/cherry-markdown" ref="nofollow noopener noreferrer">Tencent/cherry-markdown</a></li>
<li><strong>API 文档</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Ftencent.github.io%2Fcherry-markdown%2Fexamples%2Fapi.html" target="_blank" title="https://tencent.github.io/cherry-markdown/examples/api.html" ref="nofollow noopener noreferrer">API 参考</a></li>
</ul>
<h3 data-id="heading-28">6.3 常见问题 FAQ</h3>
<p><strong>Q: 流式渲染会影响性能吗？</strong></p>
<p>A: 不会。Cherry Markdown 在流式模式下优化了渲染频率（10ms），比普通模式（50ms）更快。</p>
<p><strong>Q: 支持哪些 Markdown 语法？</strong></p>
<p>A: 支持 12 种语法的自动补全：标题、加粗、斜体、链接、图片、代码块、公式、列表、表格、mermaid、脚注等。</p>
<p><strong>Q: 可以自定义补全规则吗？</strong></p>
<p>A: 目前补全规则是内置的，但你可以通过自定义语法扩展功能。详见<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTencent%2Fcherry-markdown%2Fwiki%2F%25E8%2587%25AA%25E5%25AE%259A%25E4%25B9%2589%25E8%25AF%25AD%25E6%25B3%2595" target="_blank" title="https://github.com/Tencent/cherry-markdown/wiki/%E8%87%AA%E5%AE%9A%E4%B9%89%E8%AF%AD%E6%B3%95" ref="nofollow noopener noreferrer">自定义语法文档</a>。</p>
<p><strong>Q: 如何对接我的 AI API？</strong></p>
<p>A: 参考本文的"案例二"，使用 SSE（Server-Sent Events）或 WebSocket 接收流式数据，然后调用 <code>cherry.setMarkdown()</code> 更新内容。</p>
<p><strong>Q: 流式渲染支持移动端吗？</strong></p>
<p>A: 完全支持。Cherry Markdown 是响应式设计，在移动端也能流畅运行。查看<a href="https://link.juejin.cn?target=https%3A%2F%2Ftencent.github.io%2Fcherry-markdown%2Fexamples%2Fh5.html" target="_blank" title="https://tencent.github.io/cherry-markdown/examples/h5.html" ref="nofollow noopener noreferrer">移动端 Demo</a>。</p>
<h2 data-id="heading-29">结语</h2>
<p>Cherry Markdown 的流式渲染功能，让 AI 对话应用的 Markdown 展示变得丝滑流畅。无论是构建 ChatGPT 类应用，还是开发代码生成工具，Cherry Markdown 都能为你提供专业级的渲染体验。</p>
<p>希望这篇文章能帮助你快速上手 Cherry Markdown 的流式渲染功能。如果你有任何问题或建议，欢迎在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTencent%2Fcherry-markdown%2Fissues" target="_blank" title="https://github.com/Tencent/cherry-markdown/issues" ref="nofollow noopener noreferrer">GitHub Issues</a> 中提出。</p>
<p><strong>开始构建你的 AI 对话应用吧！</strong> 🚀</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[《Git 入门指南：从零开始掌握版本控制（附高频命令速查）》]]></title>    <link>https://juejin.cn/post/7595864836360323124</link>    <guid>https://juejin.cn/post/7595864836360323124</guid>    <pubDate>2026-01-17T08:59:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595864836360323124" data-draft-id="7595859552348258356" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="《Git 入门指南：从零开始掌握版本控制（附高频命令速查）》"/> <meta itemprop="keywords" content="Git"/> <meta itemprop="datePublished" content="2026-01-17T08:59:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户80110532256"/> <meta itemprop="url" content="https://juejin.cn/user/1927884034804425"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            《Git 入门指南：从零开始掌握版本控制（附高频命令速查）》
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1927884034804425/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户80110532256
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T08:59:21.000Z" title="Sat Jan 17 2026 08:59:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Git 入门指南：从零开始掌握版本控制（附高频命令速查）</h2>
<blockquote>
<p><strong>为什么同一个项目不能有多个 Git 仓库？</strong><br/>
<strong>为什么提交要用 hash ID 而不用 1、2、3？</strong><br/>
<strong>如何优雅地回退代码、撤销修改？</strong></p>
<p>本文用最直白的语言 + 实战命令，带你彻底搞懂 Git 核心原理与日常操作，告别“只会 git add / commit / push”！</p>
</blockquote>
<hr/>
<h3 data-id="heading-1">一、为什么需要 Git？</h3>
<p>想象你在开发一个项目：</p>
<ul>
<li>今天改了功能 A，明天想试试功能 B，但又怕搞砸</li>
<li>团队协作时，多人同时修改同一个文件，怎么合并？</li>
<li>代码写崩了，想回到昨天的状态？</li>
</ul>
<p><strong>Git 就是你的“代码时光机”</strong> —— 它能：</p>
<ul>
<li>记录每一次文件变化</li>
<li>支持多人协作不冲突</li>
<li>随时回退到任意历史版本</li>
</ul>
<blockquote>
<p>💡 <strong>关键认知</strong>：Git 管理的不是文件本身，而是<strong>文件的版本</strong>。</p>
</blockquote>
<hr/>
<h3 data-id="heading-2">二、初始化仓库：<code>git init</code></h3>
<p>要让普通文件夹变成“代码仓库”，只需一行命令：</p>
<pre><code class="hljs language-csharp" lang="csharp">git <span class="hljs-keyword">init</span>
</code></pre>
<p>执行后会发生两件事：</p>
<ol>
<li>生成隐藏目录 <code>.git</code>（包含所有版本信息）</li>
<li>自动创建默认分支 <code>master</code>（或 <code>main</code>，取决于 Git 版本）</li>
</ol>
<blockquote>
<p>⚠️ <strong>重要原则</strong>：<strong>一个项目只应有一个 Git 仓库</strong>！<br/>
多个仓库会导致版本混乱，无法统一管理。</p>
</blockquote>
<hr/>
<h3 data-id="heading-3">三、核心工作区概念（必懂！）</h3>
<p>Git 有三个关键区域：</p>

























<table><thead><tr><th>区域</th><th>作用</th><th>命令</th></tr></thead><tbody><tr><td><strong>工作区（Working Directory）</strong></td><td>你编辑的文件所在位置</td><td>直接修改文件</td></tr><tr><td><strong>暂存区（Staging Area）</strong></td><td>临时存放准备提交的修改</td><td><code>git add</code></td></tr><tr><td><strong>本地仓库（Repository）</strong></td><td>永久保存已提交的版本</td><td><code>git commit</code></td></tr></tbody></table>
<blockquote>
<p><strong>流程</strong>：<br/>
工作区 → <code>git add</code> → 暂存区 → <code>git commit</code> → 本地仓库</p>
</blockquote>
<hr/>
<h3 data-id="heading-4">四、高频命令详解（附使用场景）</h3>
<h4 data-id="heading-5">1. <code>git status</code> —— 你的“状态雷达”</h4>
<p><strong>作用</strong>：查看当前仓库状态（最重要！建议每次操作前都运行）</p>
<p>输出解读：</p>
<ul>
<li><strong>Untracked files</strong>：未跟踪的文件（不在暂存区）</li>
<li><strong>Changes not staged for commit</strong>：已修改但未 <code>add</code></li>
<li><strong>Changes to be committed</strong>：已在暂存区，等待 <code>commit</code></li>
</ul>
<blockquote>
<p><strong>好习惯</strong>：任何操作前先 <code>git status</code>，心中有数！</p>
</blockquote>
<hr/>
<h4 data-id="heading-6">2. <code>git add &lt;文件&gt;</code> —— 添加到暂存区</h4>
<pre><code class="hljs language-csharp" lang="csharp">git <span class="hljs-keyword">add</span> index.html      <span class="hljs-meta"># 添加单个文件</span>
git <span class="hljs-keyword">add</span> .               <span class="hljs-meta"># 添加所有修改</span>
</code></pre>
<blockquote>
<p>暂存区让你<strong>精确控制哪些修改进入下一次提交</strong>。</p>
</blockquote>
<hr/>
<h4 data-id="heading-7">3. <code>git commit -m "说明"</code> —— 提交到本地仓库</h4>
<pre><code class="hljs language-sql" lang="sql">git <span class="hljs-keyword">commit</span> <span class="hljs-operator">-</span>m "新增用户登录功能"
</code></pre>
<h5 data-id="heading-8">关键知识点：</h5>
<ul>
<li><strong>提交说明要清晰</strong>！描述“做了什么”，而非“改了哪里”</li>
<li>每次提交生成唯一 ID（如 <code>264c229</code>），由 SHA 算法生成</li>
<li><strong>为什么不用 1,2,3？</strong><br/>
→ 因为 Git 是分布式系统，多人协作时自增 ID 会冲突，而 hash ID 全局唯一！</li>
</ul>
<blockquote>
<p>输出示例：<br/>
<code>2 insertions(+)</code> 表示本次提交新增了 2 行代码。</p>
</blockquote>
<hr/>
<h4 data-id="heading-9">4. <code>git diff</code> —— 查看代码差异</h4>
<p><strong>作用</strong>：对比<strong>工作区</strong>与<strong>暂存区/仓库</strong>的代码差异</p>
<pre><code class="hljs language-bash" lang="bash">git diff                <span class="hljs-comment"># 工作区 vs 暂存区</span>
git diff --cached       <span class="hljs-comment"># 暂存区 vs 仓库</span>
</code></pre>
<blockquote>
<p><strong>好习惯</strong>：重大提交前先 <code>git diff</code>，确保没误改！</p>
</blockquote>
<hr/>
<h4 data-id="heading-10">5. <code>git log</code> —— 查看提交历史</h4>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">log</span>
</code></pre>
<p>输出包含：</p>
<ul>
<li>提交 ID（hash）</li>
<li>作者 &amp; 时间</li>
<li>提交说明</li>
</ul>
<blockquote>
<p>结合 <code>git log --oneline</code> 可简洁查看历史。</p>
</blockquote>
<hr/>
<h3 data-id="heading-11">🔙 五、版本回退与撤销（救命技能！）</h3>
<h4 data-id="heading-12">场景 1：刚改了代码，想撤销（未 add）</h4>
<pre><code class="hljs language-lua" lang="lua">git checkout <span class="hljs-comment">-- 文件名</span>
</code></pre>
<blockquote>
<ul>
<li>效果：丢弃工作区修改，恢复到最后一次提交状态。</li>
</ul>
</blockquote>
<hr/>
<h4 data-id="heading-13">场景 2：已 add 到暂存区，想撤回</h4>
<pre><code class="hljs language-perl" lang="perl">git <span class="hljs-keyword">reset</span> HEAD 文件名
</code></pre>
<blockquote>
<ul>
<li>效果：文件从暂存区移出，回到工作区（修改保留）。</li>
</ul>
</blockquote>
<hr/>
<h4 data-id="heading-14">场景 3：已 commit，想回退到上一个版本</h4>
<pre><code class="hljs language-perl" lang="perl">git <span class="hljs-keyword">reset</span> --hard HEAD^     <span class="hljs-comment"># 回退 1 个版本</span>
git <span class="hljs-keyword">reset</span> --hard HEAD^^    <span class="hljs-comment"># 回退 2 个版本</span>
git <span class="hljs-keyword">reset</span> --hard &lt;commit-id&gt;  <span class="hljs-comment"># 回退到指定版本</span>
</code></pre>
<blockquote>
<ul>
<li><code>--hard</code> 会<strong>丢弃所有修改</strong>，慎用！</li>
</ul>
</blockquote>
<hr/>
<h4 data-id="heading-15">场景 4：不小心回退错了？找回丢失的版本！</h4>
<p>Git 会记录几乎所有操作，用 <code>reflog</code> 找回：</p>
<pre><code class="hljs">git reflog
</code></pre>
<p>输出类似：</p>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-number">264</span>c229 (HEAD -&gt; master) HEAD@{0}: commit: append GPL
a1b2c3d HEAD@{1}: <span class="hljs-keyword">reset</span>: moving to HEAD^
</code></pre>
<p>找到你要的 commit ID，再用 <code>git reset --hard &lt;ID&gt;</code> 恢复！</p>
<hr/>
<h3 data-id="heading-16">六、HEAD 指针：版本穿梭的关键</h3>
<ul>
<li><code>HEAD</code> 指向<strong>当前分支的最新提交</strong></li>
<li>每次 <code>commit</code>，HEAD 会自动前移</li>
<li><code>git reset</code> 本质是<strong>移动 HEAD 指针</strong></li>
</ul>
<blockquote>
<ul>
<li>你可以把 Git 历史想象成一条时间线，HEAD 就是你当前的位置。</li>
</ul>
</blockquote>
<hr/>
<h3 data-id="heading-17">七、最佳实践总结</h3>





























<table><thead><tr><th>场景</th><th>推荐操作</th></tr></thead><tbody><tr><td>开始新功能</td><td>先 <code>git status</code>，确认干净</td></tr><tr><td>提交前</td><td><code>git diff</code> 检查改动</td></tr><tr><td>写提交信息</td><td>清晰描述“做了什么”</td></tr><tr><td>代码写崩</td><td>用 <code>git reset --hard</code> 回退</td></tr><tr><td>误删提交</td><td>用 <code>git reflog</code> 找回</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-18">附：Git 命令速查表</h3>

















































<table><thead><tr><th>命令</th><th>作用</th></tr></thead><tbody><tr><td><code>git init</code></td><td>初始化仓库</td></tr><tr><td><code>git status</code></td><td>查看状态</td></tr><tr><td><code>git add .</code></td><td>添加所有修改到暂存区</td></tr><tr><td><code>git commit -m "msg"</code></td><td>提交</td></tr><tr><td><code>git diff</code></td><td>查看差异</td></tr><tr><td><code>git log</code></td><td>查看历史</td></tr><tr><td><code>git checkout -- file</code></td><td>撤销工作区修改</td></tr><tr><td><code>git reset HEAD file</code></td><td>撤销暂存</td></tr><tr><td><code>git reset --hard HEAD^</code></td><td>回退版本</td></tr><tr><td><code>git reflog</code></td><td>查看操作记录</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-19">结语</h3>
<p>Git 不是魔法，而是一种<strong>工程思维</strong>：</p>
<blockquote>
<p><strong>通过精确记录变化，让我们敢于尝试、不怕犯错。</strong></p>
</blockquote>
<p>掌握这些基础，你就已经超越了 80% 的“只会三板斧”的开发者。下一步，可以学习分支管理（<code>git branch</code>）、远程协作（<code>git push/pull</code>）等进阶内容。</p>
<blockquote>
<p><strong>记住：版本控制不是为了防止错误，而是为了让错误变得无害。</strong></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring Cloud Alibaba+K8S 无感升级架构方案]]></title>    <link>https://juejin.cn/post/7595871887001387008</link>    <guid>https://juejin.cn/post/7595871887001387008</guid>    <pubDate>2026-01-17T08:59:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595871887001387008" data-draft-id="7595859552348274740" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring Cloud Alibaba+K8S 无感升级架构方案"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2026-01-17T08:59:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="wichell同学"/> <meta itemprop="url" content="https://juejin.cn/user/729731452645966"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring Cloud Alibaba+K8S 无感升级架构方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/729731452645966/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    wichell同学
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T08:59:42.000Z" title="Sat Jan 17 2026 08:59:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">第一部分：Spring Cloud Alibaba 微服务项目 (<code>sc-alibaba-k8s-demo</code>)</h3>
<h4 data-id="heading-1">1. 项目结构</h4>
<p>创建一个 Maven 项目，例如命名为 <code>sc-alibaba-k8s-demo</code>。</p>
<pre><code class="hljs language-css" lang="css">sc-alibaba-k8s-demo/
├── pom<span class="hljs-selector-class">.xml</span>
└── <span class="hljs-attribute">src</span>/
    └── <span class="hljs-selector-tag">main</span>/
        ├── java/
        │   └── com/
        │       └── example/
        │           └── scalibaba/
        │               ├── ScAlibabaK8sDemoApplication<span class="hljs-selector-class">.java</span>
        │               └── controller/
        │                   └── DemoController<span class="hljs-selector-class">.java</span>
        └── resources/
            └── application<span class="hljs-selector-class">.yml</span>
</code></pre>
<h4 data-id="heading-2">2. <code>pom.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.1.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span> <span class="hljs-comment">&lt;!-- 使用 Spring Boot 3.x 以获得最新的优雅停机支持 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>/&gt;</span> <span class="hljs-comment">&lt;!-- lookup parent from repository --&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>sc-alibaba-k8s-demo<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>sc-alibaba-k8s-demo<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>Demo project for Spring Cloud Alibaba K8s Graceful Shutdown<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>17<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">spring-cloud.version</span>&gt;</span>2022.0.4<span class="hljs-tag">&lt;/<span class="hljs-name">spring-cloud.version</span>&gt;</span> <span class="hljs-comment">&lt;!-- 对应 Spring Boot 3.1.x --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">spring-cloud-alibaba.version</span>&gt;</span>2022.0.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">spring-cloud-alibaba.version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${spring-cloud.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${spring-cloud-alibaba.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span>
</code></pre>
<h4 data-id="heading-3">3. <code>src/main/java/com/example/scalibaba/ScAlibabaK8sDemoApplication.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.scalibaba;

<span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;
<span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;
<span class="hljs-keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;

<span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-meta">@EnableDiscoveryClient</span>
<span class="hljs-meta">@RestController</span> <span class="hljs-comment">// 添加RestController注解，这样可以直接在这里定义简单的接口</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ScAlibabaK8sDemoApplication</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">instanceId</span> <span class="hljs-operator">=</span> java.util.UUID.randomUUID().toString().substring(<span class="hljs-number">0</span>, <span class="hljs-number">8</span>); <span class="hljs-comment">// 用于区分不同的Pod实例</span>

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        SpringApplication.run(ScAlibabaK8sDemoApplication.class, args);
    }

    <span class="hljs-meta">@GetMapping("/hello")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">hello</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"Instance "</span> + instanceId + <span class="hljs-string">" received /hello request."</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Hello from Spring Cloud Alibaba K8s Demo (Instance: "</span> + instanceId + <span class="hljs-string">")!"</span>;
    }

    <span class="hljs-meta">@GetMapping("/slow-hello")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">slowHello</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"Instance "</span> + instanceId + <span class="hljs-string">" received /slow-hello request. Starting 20s processing..."</span>);
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 模拟一个耗时操作，例如数据库查询、RPC调用等</span>
            Thread.sleep(<span class="hljs-number">20</span> * <span class="hljs-number">1000</span>); <span class="hljs-comment">// 20秒</span>
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            Thread.currentThread().interrupt();
            System.out.println(<span class="hljs-string">"Instance "</span> + instanceId + <span class="hljs-string">" /slow-hello interrupted."</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-string">"Slow hello interrupted by instance "</span> + instanceId;
        }
        System.out.println(<span class="hljs-string">"Instance "</span> + instanceId + <span class="hljs-string">" finished /slow-hello request."</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Slow Hello finished from Spring Cloud Alibaba K8s Demo (Instance: "</span> + instanceId + <span class="hljs-string">")!"</span>;
    }
}
</code></pre>
<h4 data-id="heading-4">4. <code>src/main/resources/application.yml</code></h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span>
  <span class="hljs-attr">shutdown:</span> <span class="hljs-string">graceful</span> <span class="hljs-comment"># 启用优雅停机</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">application:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">sc-alibaba-k8s-demo</span>
  <span class="hljs-attr">cloud:</span>
    <span class="hljs-attr">nacos:</span>
      <span class="hljs-attr">discovery:</span>
        <span class="hljs-attr">server-addr:</span> <span class="hljs-string">nacos-service:8848</span> <span class="hljs-comment"># 指定 Nacos Server 地址，使用 K8s Service Name</span>
        <span class="hljs-comment"># 更多Nacos配置可以按需添加，例如命名空间等</span>
  <span class="hljs-attr">lifecycle:</span>
    <span class="hljs-attr">timeout-per-shutdown-phase:</span> <span class="hljs-string">60s</span> <span class="hljs-comment"># 优雅停机阶段的超时时间，建议比最长请求时间长</span>
  <span class="hljs-attr">profiles:</span>
    <span class="hljs-attr">active:</span> <span class="hljs-string">dev</span> <span class="hljs-comment"># 明确激活一个profile</span>
<span class="hljs-attr">management:</span>
  <span class="hljs-attr">endpoints:</span>
    <span class="hljs-attr">web:</span>
      <span class="hljs-attr">exposure:</span>
        <span class="hljs-attr">include:</span> <span class="hljs-string">"*"</span> <span class="hljs-comment"># 暴露所有Actuator端点</span>
  <span class="hljs-attr">endpoint:</span>
    <span class="hljs-attr">health:</span>
      <span class="hljs-attr">show-details:</span> <span class="hljs-string">always</span> <span class="hljs-comment"># 在健康检查中显示详细信息</span>
      <span class="hljs-attr">livenessstate:</span>
        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
      <span class="hljs-attr">readinessstate:</span>
        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr">logging:</span>
  <span class="hljs-attr">level:</span>
    <span class="hljs-attr">root:</span> <span class="hljs-string">INFO</span>
    <span class="hljs-attr">org.springframework.boot.web.servlet.context.AnnotationConfigServletWebServerApplicationContext:</span> <span class="hljs-string">INFO</span>
    <span class="hljs-comment"># 增加日志，查看优雅停机过程中的连接关闭信息</span>
    <span class="hljs-attr">org.apache.coyote.AbstractProtocol:</span> <span class="hljs-string">DEBUG</span>
    <span class="hljs-attr">org.springframework.web.servlet.DispatcherServlet:</span> <span class="hljs-string">DEBUG</span>
</code></pre>
<p>这个 <code>application.yml</code> 文件开启了优雅停机，设置了较长的停机超时时间以确保慢请求可以完成。<code>nacos.discovery.server-addr</code> 配置指向了我们稍后将在 Kubernetes 中部署的 Nacos Service。</p>
<h3 data-id="heading-5">第二部分：Docker 配置</h3>
<h4 data-id="heading-6">1. <code>Dockerfile</code></h4>
<p>在项目根目录创建 <code>Dockerfile</code> 文件：</p>
<pre><code class="hljs language-dockerfile" lang="dockerfile"># 使用官方的 Java 镜像作为基础镜像
FROM openjdk:17-jdk-slim

# 设置工作目录
WORKDIR /app

# 将 Maven 构建的 JAR 文件复制到容器中
# 注意：你需要先执行 `mvn clean package` 来生成这个 JAR 文件
COPY target/sc-alibaba-k8s-demo-0.0.1-SNAPSHOT.jar app.jar

# 暴露应用程序的端口
EXPOSE 8080

# 定义容器启动时执行的命令
# `-Djava.security.egd=file:/dev/./urandom` 用于提高随机数生成速度，避免启动慢
# `-Dserver.port=8080` 明确指定端口，Dockerfile EXPOSE 只是声明，但实际使用还是配置决定
ENTRYPOINT ["java", "-Djava.security.egd=file:/dev/./urandom", "-jar", "app.jar"]
</code></pre>
<h3 data-id="heading-7">第三部分：Kubernetes 部署文件</h3>
<p>为了在 Kubernetes 中运行我们的应用，我们需要：</p>
<ol>
<li><strong>部署 Nacos Server</strong>: Spring Cloud Alibaba 应用需要 Nacos 作为服务注册中心。</li>
<li><strong>部署我们的应用</strong>: 包含 Deployment 和 Service。</li>
</ol>
<h4 data-id="heading-8">1. Nacos Kubernetes 部署 (<code>nacos-kubernetes.yaml</code>)</h4>
<p>(为了测试的便捷性，这里部署单实例 Nacos。生产环境请部署高可用 Nacos 集群。)</p>
<p>将以下内容保存为 <code>nacos-kubernetes.yaml</code>：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">nacos-server</span>
  <span class="hljs-attr">labels:</span>
    <span class="hljs-attr">app:</span> <span class="hljs-string">nacos</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">selector:</span>
    <span class="hljs-attr">matchLabels:</span>
      <span class="hljs-attr">app:</span> <span class="hljs-string">nacos</span>
  <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span>
  <span class="hljs-attr">template:</span>
    <span class="hljs-attr">metadata:</span>
      <span class="hljs-attr">labels:</span>
        <span class="hljs-attr">app:</span> <span class="hljs-string">nacos</span>
    <span class="hljs-attr">spec:</span>
      <span class="hljs-attr">containers:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">nacos</span>
        <span class="hljs-attr">image:</span> <span class="hljs-string">nacos/nacos-server:2.2.0</span> <span class="hljs-comment"># 使用 Nacos 官方镜像</span>
        <span class="hljs-attr">ports:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">8848</span> <span class="hljs-comment"># client port</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">9848</span> <span class="hljs-comment"># raft port</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">9849</span> <span class="hljs-comment"># raft port</span>
        <span class="hljs-attr">env:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">MODE</span>
          <span class="hljs-attr">value:</span> <span class="hljs-string">"standalone"</span> <span class="hljs-comment"># 单机模式</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">JVM_XMS</span> <span class="hljs-comment"># 调整 JVM 内存，如果资源不足可以稍微调小</span>
          <span class="hljs-attr">value:</span> <span class="hljs-string">"256m"</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">JVM_XMX</span>
          <span class="hljs-attr">value:</span> <span class="hljs-string">"256m"</span>
        <span class="hljs-comment"># 确保 Nacos 启动后可以响应健康检查</span>
        <span class="hljs-attr">livenessProbe:</span>
          <span class="hljs-attr">httpGet:</span>
            <span class="hljs-attr">path:</span> <span class="hljs-string">/nacos/actuator/health</span>
            <span class="hljs-attr">port:</span> <span class="hljs-number">8848</span>
          <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">30</span>
          <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">10</span>
        <span class="hljs-attr">readinessProbe:</span>
          <span class="hljs-attr">httpGet:</span>
            <span class="hljs-attr">path:</span> <span class="hljs-string">/nacos/actuator/health</span>
            <span class="hljs-attr">port:</span> <span class="hljs-number">8848</span>
          <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">20</span>
          <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">10</span>
        <span class="hljs-attr">volumeMounts:</span> <span class="hljs-comment"># 持久化 Nacos 数据</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">nacos-storage</span>
          <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/home/nacos/data</span>
      <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">nacos-storage</span>
        <span class="hljs-attr">emptyDir:</span> {} <span class="hljs-comment"># 简单起见使用 emptyDir，生产环境请使用 PersistentVolume/PersistentVolumeClaim</span>

<span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">nacos-service</span> <span class="hljs-comment"># 这个名字要和 application.yml 中的 server-addr 匹配</span>
  <span class="hljs-attr">labels:</span>
    <span class="hljs-attr">app:</span> <span class="hljs-string">nacos</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">ports:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">port:</span> <span class="hljs-number">8848</span>
    <span class="hljs-attr">targetPort:</span> <span class="hljs-number">8848</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">client</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">port:</span> <span class="hljs-number">9848</span>
    <span class="hljs-attr">targetPort:</span> <span class="hljs-number">9848</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">raft-http</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">port:</span> <span class="hljs-number">9849</span>
    <span class="hljs-attr">targetPort:</span> <span class="hljs-number">9849</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">raft-grpc</span>
  <span class="hljs-attr">selector:</span>
    <span class="hljs-attr">app:</span> <span class="hljs-string">nacos</span>
  <span class="hljs-attr">type:</span> <span class="hljs-string">ClusterIP</span> <span class="hljs-comment"># 内部服务，集群内访问</span>
</code></pre>
<h4 data-id="heading-9">2. 微服务 Kubernetes 部署 (<code>app-kubernetes.yaml</code>)</h4>
<p>将以下内容保存为 <code>app-kubernetes.yaml</code>：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">sc-alibaba-k8s-demo-deployment</span>
  <span class="hljs-attr">labels:</span>
    <span class="hljs-attr">app:</span> <span class="hljs-string">sc-alibaba-k8s-demo</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">replicas:</span> <span class="hljs-number">3</span> <span class="hljs-comment"># 部署3个实例，方便观察滚动升级</span>
  <span class="hljs-attr">selector:</span>
    <span class="hljs-attr">matchLabels:</span>
      <span class="hljs-attr">app:</span> <span class="hljs-string">sc-alibaba-k8s-demo</span>
  <span class="hljs-attr">strategy:</span>
    <span class="hljs-attr">type:</span> <span class="hljs-string">RollingUpdate</span> <span class="hljs-comment"># 默认就是RollingUpdate，这里显式声明</span>
    <span class="hljs-attr">rollingUpdate:</span>
      <span class="hljs-attr">maxSurge:</span> <span class="hljs-number">1</span> <span class="hljs-comment"># 最多允许比期望数量多一个Pod</span>
      <span class="hljs-attr">maxUnavailable:</span> <span class="hljs-number">0</span> <span class="hljs-comment"># 最多允许有0个Pod不可用 (这是确保零停机的关键)</span>
  <span class="hljs-attr">template:</span>
    <span class="hljs-attr">metadata:</span>
      <span class="hljs-attr">labels:</span>
        <span class="hljs-attr">app:</span> <span class="hljs-string">sc-alibaba-k8s-demo</span>
        <span class="hljs-attr">version:</span> <span class="hljs-string">v1.0.0</span> <span class="hljs-comment"># 用于区分版本，方便升级</span>
    <span class="hljs-attr">spec:</span>
      <span class="hljs-attr">terminationGracePeriodSeconds:</span> <span class="hljs-number">120</span> <span class="hljs-comment"># 允许Pod最长120秒关闭，要大于 preStop hook + graceful shutdown timeout</span>
      <span class="hljs-attr">containers:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">sc-alibaba-k8s-demo</span>
        <span class="hljs-attr">image:</span> <span class="hljs-string">sc-alibaba-k8s-demo:v1.0.0</span> <span class="hljs-comment"># 初始镜像版本，需要本地构建</span>
        <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span> <span class="hljs-comment"># 如果本地有就不拉取</span>
        <span class="hljs-attr">ports:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">8080</span>
        <span class="hljs-attr">livenessProbe:</span> <span class="hljs-comment"># 存活探针，检测应用是否还活着，失败则重启Pod</span>
          <span class="hljs-attr">httpGet:</span>
            <span class="hljs-attr">path:</span> <span class="hljs-string">/actuator/health/liveness</span>
            <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span>
          <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">15</span> <span class="hljs-comment"># 初始延迟</span>
          <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">10</span> <span class="hljs-comment"># 每10秒检查一次</span>
          <span class="hljs-attr">timeoutSeconds:</span> <span class="hljs-number">3</span>
          <span class="hljs-attr">failureThreshold:</span> <span class="hljs-number">3</span>
        <span class="hljs-attr">readinessProbe:</span> <span class="hljs-comment"># 就绪探针，检测应用是否可以接收流量，失败则从Service中移除</span>
          <span class="hljs-attr">httpGet:</span>
            <span class="hljs-attr">path:</span> <span class="hljs-string">/actuator/health/readiness</span>
            <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span>
          <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">30</span> <span class="hljs-comment"># 初始延迟，确保应用完全启动并注册Nacos后才Ready</span>
          <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">10</span>
          <span class="hljs-attr">timeoutSeconds:</span> <span class="hljs-number">3</span>
          <span class="hljs-attr">failureThreshold:</span> <span class="hljs-number">3</span>
        <span class="hljs-attr">lifecycle:</span>
          <span class="hljs-attr">preStop:</span> <span class="hljs-comment"># 在发送 TERM 信号前执行，给 K8s 和负载均衡器足够时间移除 Pod</span>
            <span class="hljs-attr">exec:</span>
              <span class="hljs-attr">command:</span> [<span class="hljs-string">"/bin/sh"</span>, <span class="hljs-string">"-c"</span>, <span class="hljs-string">"echo 'PreStop hook: Sleeping for 60 seconds to allow clients to drain and K8s to update endpoints.' &amp;&amp; sleep 60"</span>]
              <span class="hljs-comment"># 这个 sleep 时间应该足够长，以确保：</span>
              <span class="hljs-comment"># 1. K8s 将此 Pod 从 Service Endpoint 列表移除。</span>
              <span class="hljs-comment"># 2. 如果使用外部负载均衡 (如 Ingress Controller, LoadBalancer)，它们有时间更新路由。</span>
              <span class="hljs-comment"># 3. Nacos 上的本实例有足够时间被Service Registry移除 (通常是自动的，但延迟可以辅助)。</span>

<span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">sc-alibaba-k8s-demo-service</span> <span class="hljs-comment"># 外部访问的服务名</span>
  <span class="hljs-attr">labels:</span>
    <span class="hljs-attr">app:</span> <span class="hljs-string">sc-alibaba-k8s-demo</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">type:</span> <span class="hljs-string">LoadBalancer</span> <span class="hljs-comment"># 或者 NodePort，具体取决于你的本地 K8s 环境支持</span>
  <span class="hljs-attr">ports:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">port:</span> <span class="hljs-number">80</span>
    <span class="hljs-attr">targetPort:</span> <span class="hljs-number">8080</span>
  <span class="hljs-attr">selector:</span>
    <span class="hljs-attr">app:</span> <span class="hljs-string">sc-alibaba-k8s-demo</span>
</code></pre>
<p><strong><code>maxUnavailable: 0</code> 和 <code>maxSurge: 1</code> 策略解释：</strong></p>
<ul>
<li><code>maxUnavailable: 0</code>：在升级过程中，任何时候都不能有旧版本的 Pod 不可用。这意味着 Kubernetes 在启动并使一个新 Pod 就绪之前，不会停止任何旧 Pod。</li>
<li><code>maxSurge: 1</code>：允许的 Pod 数量比期望的 <code>replicas</code> 数量多一个。这意味着在升级开始时，Kubernetes 会先创建一个新 Pod，当这个新 Pod 成功启动并就绪后，它才会移除一个旧 Pod。</li>
</ul>
<p>这个组合确保了在升级的任何阶段，服务实例数量都不会低于期望值，从而实现零停机。</p>
<h3 data-id="heading-10">第四部分：测试验证步骤</h3>
<p>请确保您的 Docker Desktop/Minikube Kubernetes 环境已启动。</p>
<h4 data-id="heading-11">1. 部署 Nacos Server</h4>
<pre><code class="hljs language-bash" lang="bash">kubectl apply -f nacos-kubernetes.yaml
</code></pre>
<p>等待 Nacos Pod 启动并运行：</p>
<pre><code class="hljs language-bash" lang="bash">kubectl get pods -l app=nacos -w
<span class="hljs-comment"># 看到 nacos-server-xxxxx-yyyyy   1/1     Running 就绪</span>
</code></pre>
<h4 data-id="heading-12">2. 构建并推送 Docker 镜像</h4>
<p>进入 <code>sc-alibaba-k8s-demo</code> 项目根目录：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 清理并打包 Spring Boot 应用为 JAR</span>
mvn clean package

<span class="hljs-comment"># 2. 构建 Docker 镜像 (版本命名为 v1.0.0)</span>
docker build -t sc-alibaba-k8s-demo:v1.0.0 .

<span class="hljs-comment"># 3. 验证镜像是否生成</span>
docker images | grep sc-alibaba-k8s-demo
</code></pre>
<p>如果您的 Kubernetes 是 Docker Desktop 内置的，那么这个镜像就会自动在 K8s 环境中可用。如果是 Minikube，您可能需要：<code>minikube docker-env</code> 然后 <code>eval $(minikube docker-env)</code>，再进行 <code>docker build</code>。</p>
<h4 data-id="heading-13">3. 部署微服务应用 v1.0.0</h4>
<pre><code class="hljs language-bash" lang="bash">kubectl apply -f app-kubernetes.yaml
</code></pre>
<p>等待应用 Pod 启动并运行：</p>
<pre><code class="hljs language-bash" lang="bash">kubectl get pods -l app=sc-alibaba-k8s-demo -w
<span class="hljs-comment"># 看到所有 Pod 都是 Running 状态 (3/3)</span>
</code></pre>
<p>获取 Service 的外部 IP/端口：</p>
<pre><code class="hljs language-bash" lang="bash">kubectl get svc sc-alibaba-k8s-demo-service
<span class="hljs-comment"># 查找 EXTERNAL-IP 和 PORT</span>
<span class="hljs-comment"># 如果是 Docker Desktop，通常 EXTERNAL-IP 是 localhost，NodePort 也会有</span>
<span class="hljs-comment"># 例如：localhost:30000 这样的，或者直接是 LoadBalancer 暴露的端口</span>
</code></pre>
<p>假设 Service 暴露在 <code>localhost:80</code> (如果是 NodePort，则可能是 <code>&lt;minikube-ip&gt;:&lt;node-port&gt;</code>)。</p>
<p>访问 <code>/hello</code> 接口验证：</p>
<pre><code class="hljs language-bash" lang="bash">curl http://localhost:80/hello
<span class="hljs-comment"># 应该会看到来自不同实例的 "Hello..." 响应</span>
</code></pre>
<h4 data-id="heading-14">4. 准备升级版本 v2.0.0</h4>
<p>我们将模拟对应用代码的修改，然后重新打包和部署。</p>
<h5 data-id="heading-15">修改代码：</h5>
<p>简单修改 <code>ScAlibabaK8sDemoApplication.java</code> 的 <code>/hello</code> 接口，例如：</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-meta">@GetMapping("/hello")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">hello</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"Instance "</span> + instanceId + <span class="hljs-string">" received /hello request. (v2.0.0)"</span>); <span class="hljs-comment">// 添加版本信息</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Hello from Spring Cloud Alibaba K8s Demo (v2.0.0, Instance: "</span> + instanceId + <span class="hljs-string">")!"</span>; <span class="hljs-comment">// 添加版本信息</span>
    }
</code></pre>
<h5 data-id="heading-16">重新构建 JAR 和 Docker 镜像：</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 清理并重新打包 Spring Boot 应用为 JAR</span>
mvn clean package

<span class="hljs-comment"># 2. 构建 Docker 镜像 (版本命名为 v2.0.0)</span>
docker build -t sc-alibaba-k8s-demo:v2.0.0 .
</code></pre>
<h4 data-id="heading-17">5. 执行滚动升级并验证无感</h4>
<p><strong>现在是关键步骤。</strong></p>
<h5 data-id="heading-18">5.1. 持续发送请求（模拟前端访问）</h5>
<p>打开两个终端窗口：</p>
<p><strong>终端 1 (发送慢请求):</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 循环发送慢请求，观察哪个实例处理了请求</span>
<span class="hljs-comment"># 注意：第一次请求需要等待20秒才能看到结果</span>
<span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>; <span class="hljs-keyword">do</span> curl http://localhost:80/slow-hello; <span class="hljs-built_in">echo</span>; <span class="hljs-built_in">sleep</span> 1; <span class="hljs-keyword">done</span>
</code></pre>
<p>这个命令会持续向服务发送慢请求。当一个 Pod 接收到 <code>TERM</code> 信号准备关闭时，如果它正在处理这样的慢请求，它应该<strong>完成</strong>这个请求，而不是中断。</p>
<p><strong>终端 2 (发送快请求):</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 循环发送快请求，观察服务是否持续可用，以及版本切换情况</span>
<span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>; <span class="hljs-keyword">do</span> curl http://localhost:80/hello; <span class="hljs-built_in">echo</span>; <span class="hljs-built_in">sleep</span> 0.1; <span class="hljs-keyword">done</span>
</code></pre>
<p>这个命令会高频次地向服务发送快请求。在滚动升级过程中，您应该始终看到成功响应，并且逐渐地，响应中的版本信息会从 <code>v1.0.0</code> 变为 <code>v2.0.0</code>，而不会出现连接错误或服务中断。</p>
<h5 data-id="heading-19">5.2. 在 Kubernetes 中执行升级</h5>
<p>在另一个终端修改 <code>app-kubernetes.yaml</code>，将 <code>image: sc-alibaba-k8s-demo:v1.0.0</code> 改为 <code>image: sc-alibaba-k8s-demo:v2.0.0</code>，并将 <code>template.metadata.labels.version</code> 也改为 <code>v2.0.0</code>。</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># ... (app-kubernetes.yaml 部分内容)</span>
  <span class="hljs-attr">template:</span>
    <span class="hljs-attr">metadata:</span>
      <span class="hljs-attr">labels:</span>
        <span class="hljs-attr">app:</span> <span class="hljs-string">sc-alibaba-k8s-demo</span>
        <span class="hljs-attr">version:</span> <span class="hljs-string">v2.0.0</span> <span class="hljs-comment"># &lt;--- 修改为 v2.0.0</span>
    <span class="hljs-attr">spec:</span>
      <span class="hljs-attr">terminationGracePeriodSeconds:</span> <span class="hljs-number">120</span>
      <span class="hljs-attr">containers:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">sc-alibaba-k8s-demo</span>
        <span class="hljs-attr">image:</span> <span class="hljs-string">sc-alibaba-k8s-demo:v2.0.0</span> <span class="hljs-comment"># &lt;--- 修改为 v2.0.0</span>
<span class="hljs-comment"># ...</span>
</code></pre>
<p>然后应用更新：</p>
<pre><code class="hljs language-bash" lang="bash">kubectl apply -f app-kubernetes.yaml
</code></pre>
<h5 data-id="heading-20">5.3. 观察和验证</h5>
<p>打开一个新的终端窗口：</p>
<p><strong>终端 3 (观察 Pod 生命周期):</strong></p>
<pre><code class="hljs language-bash" lang="bash">kubectl get pods -w -l app=sc-alibaba-k8s-demo
</code></pre>
<p>您将看到以下现象：</p>
<ol>
<li>一个新的 <code>v2.0.0</code> Pod 会被创建。</li>
<li>这个新 Pod 会经历 <code>Pending</code> -&gt; <code>ContainerCreating</code> -&gt; <code>Running</code>，但此时它的 <code>READY</code> 状态是 <code>0/1</code>。</li>
<li>只有当 <code>readinessProbe</code> 通过后，新 Pod 的 <code>READY</code> 状态才会变为 <code>1/1</code>。</li>
<li>此时，Kubernetes 会将这个新 Pod 添加到 Service 的 Endpoints 列表中。</li>
<li>然后，Kubernetes 会选择一个 <code>v1.0.0</code> 的旧 Pod 进行终止。</li>
<li>旧 Pod 进入 <code>Terminating</code> 状态。此时：
<ul>
<li><strong>Kubernetes 会执行 <code>preStop</code> hook (sleep 60秒)。</strong> 在这 60 秒内，Pod 会继续处理已接收的请求，但 Service 不会再向它发送新请求。</li>
<li><strong>同时，<code>kubectl get pods</code> 会显示 <code>Terminating</code> 状态。</strong> <code>READY</code> 状态可能会保持 <code>1/1</code> 或变成 <code>0/1</code>，具体取决于 <code>readinessProbe</code> 在 <code>preStop</code> hook 期间的状态。由于我们只有一个 <code>sleep</code>，<code>readinessProbe</code> 可能会在 <code>sleep</code> 期间仍是 <code>UP</code>，但 K8s 已经将其标记为 <code>Terminating</code> 并从 Service Endpoints 移除。</li>
<li><strong><code>preStop</code> hook 结束后，Kubernetes 发送 <code>TERM</code> 信号。</strong></li>
<li><strong>Spring Boot 应用启动优雅停机：</strong> 它会停止接受新请求，等待正在进行中的慢请求（20秒）完成。</li>
<li><strong>应用程序日志中会打印 Spring IoC 容器关闭、Web 服务器关闭等信息。</strong></li>
<li>当所有请求完成且应用程序关闭后，旧 Pod 会被完全移除。</li>
<li>这个过程会一直重复，直到所有 3 个 <code>v1.0.0</code> Pod 都被 3 个 <code>v2.0.0</code> Pod 替换。</li>
</ul>
</li>
</ol>
<p>您还会观察到：</p>
<ul>
<li><strong>终端 1 (慢请求):</strong> 即使旧 Pod 处于 <code>Terminating</code> 状态，它正在处理的慢请求也应该能够顺利完成，不会出现错误。当该 Pod 完全关闭后，新的慢请求会被路由到新的 <code>v2.0.0</code> 实例。</li>
<li><strong>终端 2 (快请求):</strong> 始终能得到响应。随着升级进行，您会看到响应逐渐从 <code>v1.0.0</code> 切换到 <code>v2.0.0</code>，中间不会有任何中断或错误。</li>
</ul>
<p><strong>终端 4 (观察 Pod 日志，特别是 <code>Terminating</code> 状态的 Pod):</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 找出一个正在 Terminating 的旧 Pod 的名字，例如 sc-alibaba-k8s-demo-deployment-xxxxx-abcde</span>
kubectl logs -f sc-alibaba-k8s-demo-deployment-xxxxx-abcde
</code></pre>
<p>在旧 Pod 的日志中，您应该能看到：</p>
<ul>
<li>处理慢请求的 <code>"Instance ... received /slow-hello request..."</code> 和 <code>"Instance ... finished /slow-hello request."</code> 正常完成。</li>
<li>Spring Boot 捕获 <code>TERM</code> 信号并启动优雅停机的日志（例如，Tomcat 停止接收连接，关闭线程池等）。</li>
<li>Nacos 实例注销的日志。</li>
</ul>
<hr/>
<h3 data-id="heading-21">总结和关键点回顾</h3>
<ul>
<li><strong><code>maxUnavailable: 0</code> 和 <code>maxSurge: 1</code> 滚动升级策略</strong>：这是 Kubernetes 层面实现零停机的根本。它保证了始终有足够多的可用 Pod 处理流量。</li>
<li><strong><code>readinessProbe</code> (就绪探针)</strong>：
<ul>
<li><strong>新 Pod 启动时</strong>：确保只有当应用完全初始化（如连接 DB, 注册 Nacos）并真正准备好处理请求时，才会被添加到 Service 的 Endpoints。</li>
<li><strong>旧 Pod 终止前</strong>：Kubernetes 会在旧 Pod 被标记为 <code>Terminating</code> 后，等待 <code>readinessProbe</code> 最终失败（通常在 <code>preStop</code> hook 之后或 Spring Boot 停止后），才会将其从 Service Endpoints 彻底移除。</li>
</ul>
</li>
<li><strong><code>preStop</code> hook</strong>：提供了一个在 <code>TERM</code> 信号发送之前的预处理阶段。
<ul>
<li>我们使用 <code>sleep 60</code> 来给 Kubernetes 和所有中间件（如服务网格、负载均衡器）足够的时间来更新路由配置，确保旧 Pod 在开始优雅停机前，已经不再接收任何新请求。</li>
<li><code>terminationGracePeriodSeconds</code> 必须足够长，以覆盖 <code>preStop</code> hook 的执行时间，以及 Spring Boot 优雅停机处理最长请求的时间。</li>
</ul>
</li>
<li><strong>Spring Boot <code>server.shutdown: graceful</code></strong>：确保应用程序在收到 <code>TERM</code> 信号后，停止接受新请求，但会等待所有正在进行中的请求完成，从而避免客户端错误。</li>
<li><strong>Spring Cloud Alibaba Nacos 注销</strong>：当 Spring Application Context 关闭时，Spring Cloud Nacos 会自动将该实例从 Nacos 中注销，确保 Nacos Server 不会将流量路由到已关闭的实例。</li>
</ul>
<p>码字不易，点赞支持~~</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[RustFS：基于Rust的高性能分布式对象存储，重新定义数据存储新标准！]]></title>    <link>https://juejin.cn/post/7595911076014260260</link>    <guid>https://juejin.cn/post/7595911076014260260</guid>    <pubDate>2026-01-17T10:28:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595911076014260260" data-draft-id="7595858760134131775" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="RustFS：基于Rust的高性能分布式对象存储，重新定义数据存储新标准！"/> <!----> <meta itemprop="datePublished" content="2026-01-17T10:28:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="对象存储与RustFS"/> <meta itemprop="url" content="https://juejin.cn/user/652466093570057"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            RustFS：基于Rust的高性能分布式对象存储，重新定义数据存储新标准！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/652466093570057/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    对象存储与RustFS
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T10:28:43.000Z" title="Sat Jan 17 2026 10:28:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">RustFS：基于Rust的高性能分布式对象存储，重新定义数据存储新标准！</h2>
<blockquote>
<p>RustFS 是一个基于 Rust 语言开发的开源分布式对象存储系统，性能比 MinIO 快 2.3 倍，完全兼容 S3 协议，为企业级应用提供高性能、高可靠性的数据存储解决方案。</p>
</blockquote>
<h3 data-id="heading-1">引言：为什么需要分布式对象存储？</h3>
<p>在当今数据爆炸的时代，传统的文件系统和本地存储已经难以满足大规模数据存储的需求。企业级应用、云原生服务和大数据分析都需要处理海量的非结构化数据——图片、视频、日志文件、备份数据等。这就是分布式对象存储的用武之地。</p>
<p>与传统的文件系统不同，对象存储将数据作为独立对象进行管理，每个对象包含数据本身、元数据和全局唯一标识符。这种架构天然适合分布式环境，能够实现近乎无限的扩展性。</p>
<h3 data-id="heading-2">RustFS的设计理念</h3>
<h4 data-id="heading-3">为什么选择Rust语言？</h4>
<p>Rust语言以其内存安全、零成本抽象和高并发性能而闻名，这些特性使其成为构建分布式存储系统的理想选择：</p>
<ul>
<li><strong>内存安全</strong>：无需垃圾回收器即可防止内存泄漏和数据竞争</li>
<li><strong>高性能</strong>：接近C/C++的执行效率</li>
<li><strong>强大的并发模型</strong>：基于所有权系统的 fearless concurrency</li>
<li><strong>丰富的生态系统</strong>：拥有成熟的异步编程库和网络库</li>
</ul>
<h4 data-id="heading-4">核心架构设计</h4>
<p>RustFS采用经典的分布式存储架构，包含以下核心组件：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// 简化的系统组件示意图</span>
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">RustFSCluster</span> {
    metadata_servers: <span class="hljs-type">Vec</span>&lt;metadataserver&gt;,
    data_servers: <span class="hljs-type">Vec</span>&lt;dataserver&gt;,
    client_sdk: ClientSDK,
    load_balancer: LoadBalancer,
}
</code></pre>
<h3 data-id="heading-5">RustFS的核心特性</h3>
<h4 data-id="heading-6">1. 高性能数据存取</h4>
<p>RustFS通过多项优化技术实现极致性能：</p>
<p><strong>异步I/O和并行处理</strong></p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// 使用tokio实现异步写入</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">put_object</span>(&amp;<span class="hljs-keyword">self</span>, bucket: &amp;<span class="hljs-type">str</span>, key: &amp;<span class="hljs-type">str</span>, data: <span class="hljs-type">Vec</span>&lt;<span class="hljs-type">u8</span>&gt;) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;putresult&gt; {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">upload_id</span> = <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">start_multipart_upload</span>(bucket, key).<span class="hljs-keyword">await</span>?;
    
    <span class="hljs-comment">// 并行上传数据分片</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">chunks</span> = data.<span class="hljs-title function_ invoke__">chunks</span>(<span class="hljs-keyword">Self</span>::CHUNK_SIZE);
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">upload_tasks</span>: <span class="hljs-type">Vec</span>&lt;_&gt; = chunks.<span class="hljs-title function_ invoke__">enumerate</span>()
        .<span class="hljs-title function_ invoke__">map</span>(|(part_num, chunk)| {
            <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">upload_part</span>(bucket, key, &amp;upload_id, part_num + <span class="hljs-number">1</span>, chunk.<span class="hljs-title function_ invoke__">to_vec</span>())
        })
        .<span class="hljs-title function_ invoke__">collect</span>();
    
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">results</span> = <span class="hljs-title function_ invoke__">join_all</span>(upload_tasks).<span class="hljs-keyword">await</span>;
    <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">complete_multipart_upload</span>(bucket, key, &amp;upload_id, results).<span class="hljs-keyword">await</span>
}
</code></pre>
<p><strong>智能缓存机制</strong></p>
<ul>
<li>热点数据内存缓存</li>
<li>分层存储（SSD+HDD）</li>
<li>预读优化和缓存预热</li>
</ul>
<h4 data-id="heading-7">2. 强大的数据一致性保证</h4>
<p>RustFS提供多种一致性级别，满足不同场景需求：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">pub</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">ConsistencyLevel</span> {
    Strong,      <span class="hljs-comment">// 强一致性，写后读一致性</span>
    Eventual,    <span class="hljs-comment">// 最终一致性，更高可用性</span>
    ReadAfterWrite, <span class="hljs-comment">// 写后读一致性</span>
}
</code></pre>
<h4 data-id="heading-8">3. 企业级数据保护</h4>
<p><strong>数据冗余与纠删码</strong></p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// 使用Reed-Solomon纠删码</span>
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">ErasureCoding</span> {
    data_shards: <span class="hljs-type">usize</span>,
    parity_shards: <span class="hljs-type">usize</span>,
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">ErasureCoding</span> {
    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>(data_shards: <span class="hljs-type">usize</span>, parity_shards: <span class="hljs-type">usize</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span> {
        <span class="hljs-keyword">Self</span> { data_shards, parity_shards }
    }
    
    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">encode</span>(&amp;<span class="hljs-keyword">self</span>, data: &amp;[<span class="hljs-type">u8</span>]) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;vec&lt;vec&lt;<span class="hljs-type">u8</span>&gt;&gt;&gt; {
        <span class="hljs-comment">// 实现纠删码编码逻辑</span>
        <span class="hljs-comment">// 将数据分片并生成校验片</span>
    }
}
</code></pre>
<p><strong>数据加密与安全</strong></p>
<ul>
<li>传输层加密（TLS）</li>
<li>静态数据加密（AES-256）</li>
<li>客户端加密支持</li>
</ul>
<h3 data-id="heading-9">快速入门指南</h3>
<h4 data-id="heading-10">安装RustFS客户端</h4>
<p>在Cargo.toml中添加依赖：</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[dependencies]</span>
<span class="hljs-attr">rustfs-client</span> = <span class="hljs-string">"0.1.0"</span>
<span class="hljs-attr">tokio</span> = { version = <span class="hljs-string">"1.0"</span>, features = [<span class="hljs-string">"full"</span>] }
</code></pre>
<h4 data-id="heading-11">基础使用示例</h4>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> rustfs_client::{Client, Config};
<span class="hljs-keyword">use</span> anyhow::<span class="hljs-type">Result</span>;

<span class="hljs-meta">#[tokio::main]</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;()&gt; {
    <span class="hljs-comment">// 初始化客户端</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">config</span> = Config {
        endpoint: <span class="hljs-string">"http://127.0.0.1:8080"</span>.<span class="hljs-title function_ invoke__">to_string</span>(),
        access_key: <span class="hljs-string">"your_access_key"</span>.<span class="hljs-title function_ invoke__">to_string</span>(),
        secret_key: <span class="hljs-string">"your_secret_key"</span>.<span class="hljs-title function_ invoke__">to_string</span>(),
        ..<span class="hljs-built_in">Default</span>::<span class="hljs-title function_ invoke__">default</span>()
    };
    
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">client</span> = Client::<span class="hljs-title function_ invoke__">new</span>(config)?;
    
    <span class="hljs-comment">// 创建存储桶</span>
    client.<span class="hljs-title function_ invoke__">create_bucket</span>(<span class="hljs-string">"my-bucket"</span>).<span class="hljs-keyword">await</span>?;
    
    <span class="hljs-comment">// 上传对象</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">data</span> = <span class="hljs-string">b"Hello, RustFS!"</span>.<span class="hljs-title function_ invoke__">to_vec</span>();
    client.<span class="hljs-title function_ invoke__">put_object</span>(<span class="hljs-string">"my-bucket"</span>, <span class="hljs-string">"hello.txt"</span>, data).<span class="hljs-keyword">await</span>?;
    
    <span class="hljs-comment">// 下载对象</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">downloaded</span> = client.<span class="hljs-title function_ invoke__">get_object</span>(<span class="hljs-string">"my-bucket"</span>, <span class="hljs-string">"hello.txt"</span>).<span class="hljs-keyword">await</span>?;
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"Downloaded: {}"</span>, <span class="hljs-type">String</span>::<span class="hljs-title function_ invoke__">from_utf8</span>(downloaded)?);
    
    <span class="hljs-title function_ invoke__">Ok</span>(())
}
</code></pre>
<h4 data-id="heading-12">高级功能示例</h4>
<p><strong>分片上传大文件</strong></p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">async</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">upload_large_file</span>(client: &amp;Client, bucket: &amp;<span class="hljs-type">str</span>, key: &amp;<span class="hljs-type">str</span>, file_path: &amp;Path) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;()&gt; {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">file</span> = File::<span class="hljs-title function_ invoke__">open</span>(file_path).<span class="hljs-keyword">await</span>?;
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">upload_id</span> = client.<span class="hljs-title function_ invoke__">create_multipart_upload</span>(bucket, key).<span class="hljs-keyword">await</span>?;
    
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">part_number</span> = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">parts</span> = <span class="hljs-type">Vec</span>::<span class="hljs-title function_ invoke__">new</span>();
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">buffer</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">0</span>; <span class="hljs-number">8</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>]; <span class="hljs-comment">// 8MB缓冲区</span>
    
    <span class="hljs-keyword">loop</span> {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">bytes_read</span> = file.<span class="hljs-title function_ invoke__">read</span>(&amp;<span class="hljs-keyword">mut</span> buffer).<span class="hljs-keyword">await</span>?;
        <span class="hljs-keyword">if</span> bytes_read == <span class="hljs-number">0</span> {
            <span class="hljs-keyword">break</span>;
        }
        
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">part_data</span> = buffer[..bytes_read].<span class="hljs-title function_ invoke__">to_vec</span>();
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">part</span> = client.<span class="hljs-title function_ invoke__">upload_part</span>(bucket, key, &amp;upload_id, part_number, part_data).<span class="hljs-keyword">await</span>?;
        parts.<span class="hljs-title function_ invoke__">push</span>(part);
        part_number += <span class="hljs-number">1</span>;
    }
    
    client.<span class="hljs-title function_ invoke__">complete_multipart_upload</span>(bucket, key, &amp;upload_id, parts).<span class="hljs-keyword">await</span>?;
    <span class="hljs-title function_ invoke__">Ok</span>(())
}
</code></pre>
<h3 data-id="heading-13">性能基准测试</h3>
<p>我们在标准硬件配置下对RustFS进行了性能测试：</p>

























<table><thead><tr><th>操作类型</th><th>平均延迟</th><th>吞吐量</th></tr></thead><tbody><tr><td>小文件写入（1KB）</td><td>2.3ms</td><td>12,000 ops/s</td></tr><tr><td>大文件写入（100MB）</td><td>1.2s</td><td>830 MB/s</td></tr><tr><td>并发读取（100连接）</td><td>5.1ms</td><td>45,000 ops/s</td></tr></tbody></table>
<h3 data-id="heading-14">实际应用场景</h3>
<h4 data-id="heading-15">1. 云原生应用存储</h4>
<p>RustFS提供Kubernetes CSI驱动，无缝集成容器化环境。</p>
<h4 data-id="heading-16">2. 大数据分析平台</h4>
<p>作为数据湖存储层，支持Spark、Presto等计算引擎。</p>
<h4 data-id="heading-17">3. 媒体存储与分发</h4>
<p>为图片、视频等媒体文件提供可靠的存储和CDN集成。</p>
<h4 data-id="heading-18">4. 备份与容灾</h4>
<p>跨地域复制功能确保数据安全性和业务连续性。</p>
<h3 data-id="heading-19">最佳实践</h3>
<h4 data-id="heading-20">部署建议</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># docker-compose.yml 示例</span>
<span class="hljs-attr">version:</span> <span class="hljs-string">'3.8'</span>
<span class="hljs-attr">services:</span>
  <span class="hljs-attr">rustfs-metadata:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">rustfs/metadata:latest</span>
    <span class="hljs-attr">deploy:</span>
      <span class="hljs-attr">replicas:</span> <span class="hljs-number">3</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">RAFT_CLUSTER=metadata1:7000,metadata2:7000,metadata3:7000</span>
    
  <span class="hljs-attr">rustfs-data:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">rustfs/data:latest</span>
    <span class="hljs-attr">deploy:</span>
      <span class="hljs-attr">replicas:</span> <span class="hljs-number">6</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">METADATA_ENDPOINTS=metadata1:7000,metadata2:7000,metadata3:7000</span>
</code></pre>
<h4 data-id="heading-21">性能调优</h4>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// 客户端配置优化</span>
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">optimized_config</span> = Config {
    endpoint: <span class="hljs-string">"http://rustfs-cluster:8080"</span>.<span class="hljs-title function_ invoke__">to_string</span>(),
    max_connections: <span class="hljs-number">100</span>,           <span class="hljs-comment">// 最大连接数</span>
    connect_timeout: Duration::<span class="hljs-title function_ invoke__">from_secs</span>(<span class="hljs-number">10</span>),
    timeout: Duration::<span class="hljs-title function_ invoke__">from_secs</span>(<span class="hljs-number">30</span>),
    retry_policy: RetryPolicy::ExponentialBackoff {
        max_retries: <span class="hljs-number">3</span>,
        base_delay: Duration::<span class="hljs-title function_ invoke__">from_millis</span>(<span class="hljs-number">100</span>),
    },
    ..<span class="hljs-built_in">Default</span>::<span class="hljs-title function_ invoke__">default</span>()
};
</code></pre>
<h3 data-id="heading-22">总结与展望</h3>
<p>RustFS凭借Rust语言的天然优势，在性能、安全性和可靠性方面表现出色。其简洁的API设计、丰富的功能和良好的扩展性，使其成为构建现代分布式应用的理想存储选择。</p>
<p><strong>未来规划：</strong></p>
<ul>
<li>支持S3兼容API</li>
<li>机器学习数据管道优化</li>
<li>边缘计算场景适配</li>
<li>更强的数据治理功能</li>
</ul>
<p>RustFS正在积极开发中，我们欢迎社区贡献和反馈。无论是功能建议、bug报告还是代码贡献，都将帮助RustFS变得更加完善。</p>
<hr/>
<p>以下是深入学习 RustFS 的推荐资源：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Frustfs%2Frustfs" target="_blank" title="https://github.com/rustfs/rustfs" ref="nofollow noopener noreferrer">RustFS</a></p>
<p>官方文档： <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.rustfs.com%2Finstallation%2F" target="_blank" title="https://docs.rustfs.com/installation/" ref="nofollow noopener noreferrer">RustFS 官方文档</a>- 提供架构、安装指南和 API 参考。</p>
<p>GitHub 仓库： <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Forgs%2Frustfs%2Frepositories" target="_blank" title="https://github.com/orgs/rustfs/repositories" ref="nofollow noopener noreferrer">GitHub 仓库</a> - 获取源代码、提交问题或贡献代码。</p>
<p>社区支持： <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Forgs%2Frustfs%2Fdiscussions" target="_blank" title="https://github.com/orgs/rustfs/discussions" ref="nofollow noopener noreferrer">GitHub Discussions</a>- 与开发者交流经验和解决方案。</p>
<p>‍</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <!----></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【2026毕设】4大维度+12项分析：Spark+Django皮肤癌数据可视化系统 毕业设计 选题推荐 毕设选题 数据分析 机器学习]]></title>    <link>https://juejin.cn/post/7595896809651847208</link>    <guid>https://juejin.cn/post/7595896809651847208</guid>    <pubDate>2026-01-17T10:59:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595896809651847208" data-draft-id="7595864836360781876" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【2026毕设】4大维度+12项分析：Spark+Django皮肤癌数据可视化系统 毕业设计 选题推荐 毕设选题 数据分析 机器学习"/> <meta itemprop="keywords" content="前端,Python,大数据"/> <meta itemprop="datePublished" content="2026-01-17T10:59:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="计算机编程指导师"/> <meta itemprop="url" content="https://juejin.cn/user/881156097585216"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【2026毕设】4大维度+12项分析：Spark+Django皮肤癌数据可视化系统 毕业设计 选题推荐 毕设选题 数据分析 机器学习
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/881156097585216/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    计算机编程指导师
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T10:59:30.000Z" title="Sat Jan 17 2026 10:59:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">皮肤癌数据可视化分析系统-简介</h2>
<p>本系统是一个基于Spark+Django的皮肤癌数据可视化分析平台，旨在通过大数据技术处理和解析海量的医疗记录，从而揭示皮肤癌与多种潜在因素之间的深层关联。系统整体采用前后端分离架构，后端以Python的Django框架为核心，负责业务逻辑处理与API接口提供，并利用PySpark库与大数据集群进行交互。数据处理流程上，系统首先将存储于Hadoop HDFS中的原始皮肤癌患者数据集，通过Spark进行分布式清洗、转换和预处理，确保数据质量。核心分析引擎利用Spark SQL和DataFrame API，围绕四大核心功能模块展开计算：在患者多维画像层面，系统对患者的性别、年龄、吸烟饮酒习惯等数据进行聚合统计，构建高风险人群画像；在临床病变特征分析层面，系统对病变尺寸、高发身体部位及临床症状频率进行量化分析，为临床诊断提供数据参考；在风险因素挖掘层面，系统通过关联规则算法探索临床症状组合与诊断结果的强关联性；最后，在交叉验证分析层面，系统整合多维度数据，为不同诊断类型构建综合画像，并分析活检决策的影响因素。所有计算结果经由Django封装成RESTful API，最终由前端Vue框架结合Echarts组件，以动态、交互式的图表形式直观呈现给用户。</p>
<h2 data-id="heading-1">皮肤癌数据可视化分析系统-技术</h2>
<p>开发语言：Python或Java
大数据框架：Hadoop+Spark（本次没用Hive，支持定制）
后端框架：Django+Spring Boot(Spring+SpringMVC+Mybatis)
前端：Vue+ElementUI+Echarts+HTML+CSS+JavaScript+jQuery
详细技术点：Hadoop、HDFS、Spark、Spark SQL、Pandas、NumPy
数据库：MySQL</p>
<h2 data-id="heading-2">皮肤癌数据可视化分析系统-背景</h2>
<p>选题背景
近年来，随着公众健康意识的提升和医疗信息化的普及，医疗机构积累了海量的患者诊疗数据。皮肤癌作为最常见的恶性肿瘤之一，其早期发现与诊断对于提高患者生存率至关重要。然而，传统的数据统计分析方法往往难以有效处理和挖掘这些规模庞大、维度复杂的医疗数据中隐藏的价值，导致许多有价值的关联性规律未被充分利用。同时，对于计算机专业的学生而言，如何将前沿的大数据技术应用于实际且有社会意义的领域，是一个极具挑战性和价值的课题。因此，选择一个真实且复杂的医疗数据集，运用业界主流的大数据处理框架进行深度分析，不仅能够锻炼学生的工程实践能力，也能为医学研究提供一种新的数据驱动视角。</p>
<p>选题意义
这个毕业设计项目，虽然规模有限，但希望能带来一些实际的参考价值。从技术学习角度看，它能让同学完整地走一遍从数据采集、存储、清洗、分析到可视化展示的大数据项目全流程，深入掌握Spark和Django等核心技术，这比单纯做一个小型Web系统或CRUD项目要更有深度。从应用价值角度看，系统通过多维度数据分析得出的结论，比如特定年龄段的高发性、某些生活习惯与疾病的关联性，或许能为医学研究提供一些数据上的佐证或新的研究方向，为公众的健康科普和自我检查提供直观的参考。总的来说，它是一个将技术学习与社会价值相结合的尝试，体现了计算机科学在赋能其他学科方面的潜力。</p>
<h2 data-id="heading-3">皮肤癌数据可视化分析系统-视频展示</h2>
<p>[video(video-vrPrBp5I-1768646839144)(type-csdn)(url-<a href="https://link.juejin.cn?target=https%3A%2F%2Flive.csdn.net%2Fv%2Fembed%2F510510)(image-https%3A%2F%2Fi-blog.csdnimg.cn%2Fdirect%2F32e4c1c8a4964ce9a5b82c6d409c2067.png)(title-%25E5%259F%25BA%25E4%25BA%258ESpark%2BDjango%25E7%259A%2584%25E7%259A%25AE%25E8%2582%25A4%25E7%2599%258C%25E6%2595%25B0%25E6%258D%25AE%25E5%258F%25AF%25E8%25A7%2586%25E5%258C%2596%25E5%2588%2586%25E6%259E%2590%25E7%25B3%25BB%25E7%25BB%259F" target="_blank" title="https://live.csdn.net/v/embed/510510)(image-https://i-blog.csdnimg.cn/direct/32e4c1c8a4964ce9a5b82c6d409c2067.png)(title-%E5%9F%BA%E4%BA%8ESpark+Django%E7%9A%84%E7%9A%AE%E8%82%A4%E7%99%8C%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E5%88%86%E6%9E%90%E7%B3%BB%E7%BB%9F" ref="nofollow noopener noreferrer">live.csdn.net/v/embed/510…</a>)]</p>
<h2 data-id="heading-4">皮肤癌数据可视化分析系统-图片展示</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/20fdaed539e94f189c7fedbfd846eb53~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py657yW56iL5oyH5a-85biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769252370&amp;x-signature=T6NiT1njGrPlwbqU%2BhYOtvNXTvo%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ae95d356efd41ddac85fd4dc543b956~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py657yW56iL5oyH5a-85biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769252370&amp;x-signature=LaxLSs48qcCLTl%2BqVjQRSi9lRtA%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/27edf02d705b4ce88d7c70ae7f453969~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py657yW56iL5oyH5a-85biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769252370&amp;x-signature=%2FLIDcD5nPjdvvkf02e0EDqnuKF0%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b161672b60d2491887824eb5087b179e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py657yW56iL5oyH5a-85biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769252370&amp;x-signature=urSYD8aIhEPfLYOQ%2FYtbT5Ifj2M%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ec00982f317545b19fc0e6cc885e9737~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py657yW56iL5oyH5a-85biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769252370&amp;x-signature=NLhkV%2FA%2Ba9EkvcyozJpY4ZoKYjs%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cae80deaf0444539bead3338167517ce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py657yW56iL5oyH5a-85biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769252370&amp;x-signature=HYMSVR3OPGZdi9iR8DKFctudNVo%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff4ff61513fc423ea9b7cc5e9831aa81~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py657yW56iL5oyH5a-85biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769252370&amp;x-signature=BHZqRXPImRon7u%2BmnGEwmrF1sFI%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1dac4a12cf054b60a65a6c750f983608~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py657yW56iL5oyH5a-85biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769252370&amp;x-signature=V%2BG%2F0DGEpDrV4j%2FAXKg%2BVGirx5k%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2ba2dfa86dec4e00ae16722daeaf77dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py657yW56iL5oyH5a-85biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769252370&amp;x-signature=F3QEAyvNOypb4qCHwcI8Uy0npkw%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d972214ec104337817b74715faa3cb0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py657yW56iL5oyH5a-85biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769252370&amp;x-signature=CYIpm%2BmgujdOMwyn7esIoBSww1k%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h2 data-id="heading-5">皮肤癌数据可视化分析系统-代码展示</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> pyspark.sql <span class="hljs-keyword">import</span> SparkSession, functions <span class="hljs-keyword">as</span> F

spark = SparkSession.builder.appName(<span class="hljs-string">"SkinCancerAnalysis"</span>).getOrCreate()
df = spark.read.csv(<span class="hljs-string">"hdfs://path/to/skin_cancer_data.csv"</span>, header=<span class="hljs-literal">True</span>, inferSchema=<span class="hljs-literal">True</span>)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze_age_structure</span>(<span class="hljs-params">df</span>):
    df_with_age_group = df.withColumn(<span class="hljs-string">"age_group"</span>, F.when((F.col(<span class="hljs-string">"age"</span>) &gt;= <span class="hljs-number">0</span>) &amp; (F.col(<span class="hljs-string">"age"</span>) &lt; <span class="hljs-number">30</span>), <span class="hljs-string">"青年"</span>)
                                     .when((F.col(<span class="hljs-string">"age"</span>) &gt;= <span class="hljs-number">30</span>) &amp; (F.col(<span class="hljs-string">"age"</span>) &lt; <span class="hljs-number">50</span>), <span class="hljs-string">"中年"</span>)
                                     .otherwise(<span class="hljs-string">"老年"</span>))
    age_diagnostic_count = df_with_age_group.groupBy(<span class="hljs-string">"age_group"</span>, <span class="hljs-string">"diagnostic"</span>).count()
    total_in_age_group = age_diagnostic_count.groupBy(<span class="hljs-string">"age_group"</span>).agg(F.<span class="hljs-built_in">sum</span>(<span class="hljs-string">"count"</span>).alias(<span class="hljs-string">"total"</span>))
    result = age_diagnostic_count.join(total_in_age_group, <span class="hljs-string">"age_group"</span>)
    result = result.withColumn(<span class="hljs-string">"percentage"</span>, F.<span class="hljs-built_in">round</span>((F.col(<span class="hljs-string">"count"</span>) / F.col(<span class="hljs-string">"total"</span>)) * <span class="hljs-number">100</span>, <span class="hljs-number">2</span>))
    result = result.orderBy(<span class="hljs-string">"age_group"</span>, <span class="hljs-string">"diagnostic"</span>)
    <span class="hljs-keyword">return</span> result.collect()

<span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze_top_body_regions</span>(<span class="hljs-params">df</span>):
    region_count = df.<span class="hljs-built_in">filter</span>(F.col(<span class="hljs-string">"region"</span>).isNotNull()).groupBy(<span class="hljs-string">"region"</span>).count()
    top_regions = region_count.orderBy(F.col(<span class="hljs-string">"count"</span>).desc())
    <span class="hljs-keyword">return</span> top_regions.collect()

<span class="hljs-keyword">def</span> <span class="hljs-title function_">mine_symptom_associations_for_mel</span>(<span class="hljs-params">df</span>):
    mel_df = df.<span class="hljs-built_in">filter</span>(F.col(<span class="hljs-string">"diagnostic"</span>) == <span class="hljs-string">"MEL"</span>)
    symptom_cols = [<span class="hljs-string">"itch"</span>, <span class="hljs-string">"grew"</span>, <span class="hljs-string">"hurt"</span>, <span class="hljs-string">"changed"</span>, <span class="hljs-string">"bleed"</span>, <span class="hljs-string">"elevation"</span>]
    mel_symptoms = mel_df.select(*symptom_cols).na.fill(<span class="hljs-number">0</span>)
    frequent_itemsets = []
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(symptom_cols)):
        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(i + <span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(symptom_cols)):
            symptom_pair = mel_symptoms.<span class="hljs-built_in">filter</span>((F.col(symptom_cols[i]) == <span class="hljs-number">1</span>) &amp; (F.col(symptom_cols[j]) == <span class="hljs-number">1</span>))
            count = symptom_pair.count()
            <span class="hljs-keyword">if</span> count &gt; <span class="hljs-number">0</span>:
                frequent_itemsets.append({<span class="hljs-string">"symptom_pair"</span>: <span class="hljs-string">f"<span class="hljs-subst">{symptom_cols[i]}</span> &amp; <span class="hljs-subst">{symptom_cols[j]}</span>"</span>, <span class="hljs-string">"count"</span>: count})
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">sorted</span>(frequent_itemsets, key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-string">'count'</span>], reverse=<span class="hljs-literal">True</span>)
</code></pre>
<h2 data-id="heading-6">皮肤癌数据可视化分析系统-结语</h2>
<p>从数据处理到前端呈现，这个项目让我对大数据全流程开发有了更深的理解。虽然系统还有许多可以完善的地方，比如引入更复杂的预测模型，但它确实是一次宝贵的实践。希望这个分享能帮到正在为毕设发愁的同学，祝大家都能顺利通关。</p>
<p>毕设选题还在迷茫？这个结合了Spark大数据和Django的皮肤癌分析项目或许能给你灵感！觉得有用的话，别忘了点个赞和收藏，你的支持是我更新的最大动力！有任何问题或想法，欢迎在评论区留言交流，我们一起进步！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（46） Hibernate的配置文件如何加载？]]></title>    <link>https://juejin.cn/post/7595801647247327251</link>    <guid>https://juejin.cn/post/7595801647247327251</guid>    <pubDate>2026-01-16T11:55:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595801647247327251" data-draft-id="7595552420048338987" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（46） Hibernate的配置文件如何加载？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-16T11:55:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（46） Hibernate的配置文件如何加载？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-16T11:55:28.000Z" title="Fri Jan 16 2026 11:55:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    16
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在Hibernate中，配置文件通常用于定义数据库连接信息、Hibernate属性和实体类映射等。常见的配置文件包括<code>hibernate.cfg.xml</code>和<code>hibernate.properties</code>。本文将详细介绍如何加载Hibernate的配置文件，并结合代码示例说明。</p>
<h3 data-id="heading-0">加载Hibernate配置文件</h3>
<h4 data-id="heading-1">1. 使用<code>hibernate.cfg.xml</code>加载配置</h4>
<p><code>hibernate.cfg.xml</code>是最常用的Hibernate配置文件。通常放置在类路径的根目录下。</p>
<h5 data-id="heading-2">示例配置文件 <code>hibernate.cfg.xml</code></h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 数据库连接配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate 属性配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 映射类 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Product"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Category"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h5 data-id="heading-3">加载<code>hibernate.cfg.xml</code>的示例代码</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 使用Configuration类加载hibernate.cfg.xml配置文件</span>
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<p>在上面的代码中，<code>new Configuration().configure("hibernate.cfg.xml")</code>会自动查找类路径下的<code>hibernate.cfg.xml</code>文件，并加载其中的配置信息。然后使用这些配置信息构建<code>SessionFactory</code>实例。</p>
<h4 data-id="heading-4">2. 使用<code>hibernate.properties</code>加载配置</h4>
<p>除了<code>hibernate.cfg.xml</code>，Hibernate还支持通过<code>hibernate.properties</code>文件加载配置信息。</p>
<h5 data-id="heading-5">示例配置文件 <code>hibernate.properties</code></h5>
<pre><code class="hljs language-properties" lang="properties">hibernate.connection.driver_class=com.mysql.cj.jdbc.Driver
hibernate.connection.url=jdbc:mysql://localhost:3306/your_database
hibernate.connection.username=your_username
hibernate.connection.password=your_password
hibernate.dialect=org.hibernate.dialect.MySQLDialect
hibernate.show_sql=true
hibernate.format_sql=true
hibernate.hbm2ddl.auto=update
</code></pre>
<h5 data-id="heading-6">加载<code>hibernate.properties</code>的示例代码</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 使用Configuration类加载hibernate.properties配置文件</span>
            <span class="hljs-type">Configuration</span> <span class="hljs-variable">configuration</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>();
            configuration.configure(); <span class="hljs-comment">// 默认会加载类路径下的hibernate.cfg.xml或hibernate.properties</span>
            sessionFactory = configuration.buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<p>在上面的代码中，<code>configuration.configure()</code>默认会加载类路径下的<code>hibernate.cfg.xml</code>或<code>hibernate.properties</code>文件，可以根据具体需求调整。</p>
<h3 data-id="heading-7">配置文件加载的深入解释</h3>
<ol>
<li>
<p><strong>Configuration类</strong>：</p>
<ul>
<li><code>org.hibernate.cfg.Configuration</code>类是Hibernate用来配置的核心类。它可以从XML文件或Java属性文件加载配置。</li>
<li><code>configure()</code>方法默认查找类路径根目录下的<code>hibernate.cfg.xml</code>文件。如果提供文件名参数，<code>configure("hibernate.properties")</code>则会加载指定文件。</li>
</ul>
</li>
<li>
<p><strong>SessionFactory</strong>：</p>
<ul>
<li><code>SessionFactory</code>是Hibernate框架中的关键对象，负责创建<code>Session</code>对象。<code>Session</code>对象是单线程的短期对象，用于执行CRUD操作。</li>
<li><code>SessionFactory</code>是线程安全的，可以在应用程序中全局共享，通常在应用启动时创建一次，并在整个应用生命周期中使用。</li>
</ul>
</li>
<li>
<p><strong>异常处理</strong>：</p>
<ul>
<li>在静态块中初始化<code>SessionFactory</code>，并捕获任何可能的异常。如果初始化失败，会抛出<code>ExceptionInInitializerError</code>，确保应用及时发现配置问题。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-8">综合示例</h3>
<p>以下是一个完整的示例，展示如何配置并加载Hibernate配置文件，创建<code>SessionFactory</code>并执行一些基本操作。</p>
<h5 data-id="heading-9">完整示例</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-comment">// HibernateUtil类</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}

<span class="hljs-comment">// Category类</span>
<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "category")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Category</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "name")</span>
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-meta">@OneToMany(mappedBy = "category", fetch = FetchType.LAZY, cascade = CascadeType.ALL)</span>
    <span class="hljs-keyword">private</span> Set&lt;Product&gt; products = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();

    <span class="hljs-comment">// Getters 和 Setters</span>
}

<span class="hljs-comment">// Product类</span>
<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "product")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Product</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "name")</span>
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-meta">@Column(name = "price")</span>
    <span class="hljs-keyword">private</span> Double price;

    <span class="hljs-meta">@ManyToOne</span>
    <span class="hljs-meta">@JoinColumn(name = "category_id")</span>
    <span class="hljs-keyword">private</span> Category category;

    <span class="hljs-comment">// Getters 和 Setters</span>
}

<span class="hljs-comment">// Hibernate测试类</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateTest</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 插入示例数据</span>
        insertSampleData(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertSampleData</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Category</span> <span class="hljs-variable">category</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Category</span>();
            category.setName(<span class="hljs-string">"Electronics"</span>);

            <span class="hljs-type">Product</span> <span class="hljs-variable">product1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Product</span>();
            product1.setName(<span class="hljs-string">"Laptop"</span>);
            product1.setPrice(<span class="hljs-number">1000.0</span>);

            <span class="hljs-type">Product</span> <span class="hljs-variable">product2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Product</span>();
            product2.setName(<span class="hljs-string">"Smartphone"</span>);
            product2.setPrice(<span class="hljs-number">500.0</span>);

            category.addProduct(product1);
            category.addProduct(product2);

            session.save(category);

            transaction.commit();
            System.out.println(<span class="hljs-string">"Inserted sample data"</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            session.close();
        }
    }
}
</code></pre>
<p>在这个综合示例中，<code>HibernateUtil</code>类负责加载配置文件并创建<code>SessionFactory</code>，<code>Category</code>和<code>Product</code>类定义了实体，<code>HibernateTest</code>类则演示了如何使用Hibernate进行数据操作。通过这种方式，可以有效地加载和使用Hibernate的配置文件进行数据库操作。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Cursor 最新发现：超大型项目 AI 也能做了，上百个 Agent 一起上]]></title>    <link>https://juejin.cn/post/7595842144906854450</link>    <guid>https://juejin.cn/post/7595842144906854450</guid>    <pubDate>2026-01-17T09:13:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595842144906854450" data-draft-id="7595831738234601481" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Cursor 最新发现：超大型项目 AI 也能做了，上百个 Agent 一起上"/> <meta itemprop="keywords" content="前端,AI编程,Cursor"/> <meta itemprop="datePublished" content="2026-01-17T09:13:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="张拭心"/> <meta itemprop="url" content="https://juejin.cn/user/571401775094312"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Cursor 最新发现：超大型项目 AI 也能做了，上百个 Agent 一起上
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/571401775094312/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    张拭心
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T09:13:48.000Z" title="Sat Jan 17 2026 09:13:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是拭心。</p>
<p>2008 年 9 月 2 日，Google Chrome 浏览器正式发布。这个项目从 2005 年立项到发布，<strong>「历时 3 年，投入了数千名工程师」</strong>。如今，Chromium 代码规模已超过 3600 万行，被称为“人类史上最复杂的软件工程项目之一”。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e5f05cf35b2346cd9a49256b01845beb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byg5out5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769246245&amp;x-signature=mifJjS1mapz9Vx2UnF9lKUg9sDw%3D" alt="图片" loading="lazy"/></p>
<p>而就在最近，Cursor 团队做了一件让人震惊的事：<strong>「他们用上百个 AI Agent，花了不到一周时间，从零开始构建了一个浏览器，写出了超过 100 万行代码」</strong>。</p>
<p>这不是概念验证，也不是玩具项目。</p>
<p>他们用 Agent 持续运行数周，在多个超大型项目上写出了数百万行代码：Java LSP（55 万行）、Windows 7 模拟器（120 万行）、Excel（160 万行）。更令人震撼的是，它们还直接在 Cursor 自己的生产代码库中完成了一次大规模框架迁移，代码增删量达到 +266K/-193K，用时 3 周多。</p>
<p><strong>「从 3 年到 1 周，从数千名工程师到上百个 Agent，这不是量变，是质变」</strong>。</p>
<p>AI 编程正在跨越一个关键门槛：从“辅助写代码”到“自主开发项目”。</p>
<p>这篇文章我们来了解下 Cursor 是如何做到的，以及对我们意味着什么。</p>
<h2 data-id="heading-0">一、多 Agent 协作：从失败到突破</h2>
<p>单个 AI Agent 能写出几百行代码，但要开发一个百万行级别的项目，光靠一个 Agent 显然不够。</p>
<p>Cursor 团队的目标是让编码 Agent 持续运行数周，完全自主地完成超大型项目。</p>
<p>这意味着必须让上百个 Agent 同时工作。但问题来了：<strong>「怎么让它们高效协作，而不是互相干扰？」</strong></p>
<h3 data-id="heading-1">1.1 扁平结构：一场灾难</h3>
<p>Cursor 团队最初的想法很直觉：让所有 Agent 具有同等地位，通过一个共享文件自行协同。</p>
<p>每个 Agent 会检查其他 Agent 在做什么、认领一个任务并更新自己的状态。为防止两个 Agent 抢占同一项任务，他们使用了锁机制。</p>
<p>但这套方案在并发方面失败了：</p>
<p><strong>「锁机制成了瓶颈」</strong>。 Agent 会持有锁太久，或者干脆忘记释放锁。即使锁机制正常工作，它也会成为瓶颈。二十个 Agent 的速度会下降到相当于两三个 Agent 的有效吞吐量，大部分时间都花在等待上。</p>
<p><strong>「系统非常脆弱」</strong>。 Agent 可能在持有锁的情况下失败、尝试获取自己已经持有的锁，或者在完全没有获取锁的情况下更新协调文件。</p>
<p>后来他们尝试用乐观并发控制来替代锁：Agent 可以自由读取状态，但如果自上次读取后状态已经发生变化，则写入会失败。这种方式更简单、也更健壮，但更深层的问题依然存在。</p>
<p>在没有确定任务的情况下，Agent 变得非常规避风险。 它们会回避困难任务，转而做一些小而安全的修改。<strong>「没有任何一个 Agent 承担起解决难题或端到端实现的责任」</strong>（像极了曾经遇到的同事）。结果就是工作长时间在空转，却没有实质性进展。</p>
<p>这就像一个没有项目经理的团队，每个人都在做“看起来安全”的小任务，没人敢碰核心难题。</p>
<h3 data-id="heading-2">1.2 分层结构：像真实的团队一样工作</h3>
<p>Cursor 团队后来尝试里将不同角色拆分开来。不再使用每个 Agent 都什么都做的扁平结构，而是搭建了一条职责清晰的流水线：</p>
<ul>
<li><strong>「规划者」</strong>（Planners）：持续探索代码库并创建任务。他们可以针对特定区域派生子规划者，使规划过程本身也可以并行且递归地展开。</li>
<li><strong>「执行者」</strong>（Workers）：领取任务并专注于把任务完成到底。他们不会与其他执行者协调，也不关心整体大局，只是全力处理自己被分配的任务，完成后再提交变更。</li>
</ul>
<p>在每个周期结束时，会有一个**「评审 Agent」**判断是否继续，然后下一轮迭代会从干净的初始状态重新开始。</p>
<p>这套结构基本解决了协同问题，并且让他们可以扩展到非常大的项目，而不会让任何单个 Agent 陷入视野过于狭窄的状态。成百上千个 Worker 并发运行，向同一个分支推送代码，而且几乎没有冲突。</p>
<p>这就像一个真实的开发团队：<strong>「有人负责架构设计和任务拆解，有人专注执行具体任务，各司其职，高效协作。」</strong></p>
<h3 data-id="heading-3">1.3 三个震撼案例</h3>
<p>有了这套系统后，Cursor 团队开始测试它的边界：</p>
<p><strong>「从零开始构建浏览器」</strong>。 Agent 持续运行了将近一周，在 1，000 个文件中写出了超过 100 万行代码。虽然看起来只是一张简单的截图，但从零开始构建一个浏览器极其困难。尽管代码库规模庞大，新启动的 Agent 仍然可以理解它并取得实质性进展。</p>
<p><strong>「Cursor 代码库的框架迁移」</strong>。 他们在 Cursor 代码库中就地将 Solid 迁移到 React，整个过程持续了 3 周多，代码增删量达到 +266K/-193K。随着测试的进行，他们确实认为有可能合并这次大规模改动。</p>
<p><strong>「产品性能提升 25 倍」</strong>。 在一款即将上线的产品中，一个长时间运行的 Agent 通过一个高效的 Rust 实现，让视频渲染速度提升了 25 倍。它还新增了平滑缩放和平移的能力，使用自然的弹簧过渡和运动模糊效果，并能跟随光标顺畅移动。这部分代码已经合并，不久就会在生产环境中上线。</p>
<p>这些案例证明，多 Agent 开发大型项目不再是概念验证，而是真实的生产力。</p>
<h2 data-id="heading-4">二、为什么现在可以做到</h2>
<p>上百个 Agent 协作开发超大型项目，这在一年前几乎是不可想象的。Cursor 团队的成功，背后有几个关键因素。</p>
<h3 data-id="heading-5">2.1 模型能力的质变</h3>
<p>在运行时间极长的任务中，模型选择至关重要。Cursor 团队发现，不同模型在长时间自主工作时表现差异巨大。</p>
<p><strong>「GPT-5.2 系列在长时间自主工作方面要优秀得多：更能遵循指令、保持专注、避免偏离，并且在实现上更加精确和完整」</strong>。相比之下，Opus 4.5 往往会更早结束、在方便的时候走捷径，更快地把控制权交还给用户。</p>
<p>这不是说 Opus 4.5 不好，而是不同模型有不同的“性格”。Opus 4.5 更适合需要人类频繁介入的场景，而 GPT-5.2 更适合长时间无人值守的自主开发。</p>
<p>更有意思的是，不同模型在不同角色上各有所长。即便 GPT-5.1-codex 是专门为编码训练的，GPT-5.2 依然是更好的规划者。现在 Cursor 团队会**「针对每个角色选择最适合的模型，而不是依赖单一通用模型」**。</p>
<p>规划者用 GPT-5.2，执行者用 GPT-5.1-codex，评审者可能又是另一个模型。这就像组建一个真实团队，你会根据每个岗位的特点选择最合适的人。</p>
<h3 data-id="heading-6">2.2 提示词比框架更重要</h3>
<p>系统中有相当大一部分行为，很大程度上取决于如何为这些 Agent 设计提示词。要让它们良好协作、避免异常行为，并在长时间内保持专注，Cursor 团队做了大量实验。</p>
<p>运行框架和模型本身固然重要，但提示词更重要。</p>
<p>这个结论可能让很多人意外。我们往往以为技术架构和模型才是关键，但 Cursor 团队发现，同样的架构，不同的提示词设计，Agent 的表现会有天壤之别。</p>
<p>如何让规划者拆解任务时粒度合适？如何让执行者在遇到困难时不放弃？如何让评审者准确判断工作质量？这些都需要精心设计的提示词。</p>
<p>这也揭示了一个重要趋势：<strong>「Prompt Engineering（提示词工程）是成为 AI 时代的核心技能。」</strong></p>
<blockquote>
<p>❝</p>
<p>推荐阅读我写的《<a href="https://link.juejin.cn?target=https%3A%2F%2Fxiaobot.net%2Fp%2Fai_1024" target="_blank" title="https://xiaobot.net/p/ai_1024" ref="nofollow noopener noreferrer">提示词工程：你缺的不只是专业术语</a>》</p>
<p>❞</p>
</blockquote>
<h3 data-id="heading-7">2.3 减法思维：少即是多</h3>
<p>Cursor 团队的许多改进来自“减法”而不是“加法”。</p>
<p>一开始他们为质量控制和冲突解决设计了一个集成者（Integrator）角色，专门负责协调各个 Worker 的代码、解决冲突、确保质量。听起来很合理，对吧？</p>
<p>但后来发现，<strong>「集成者制造的瓶颈多于解决的问题。各个 Worker 本身就已经有能力处理彼此之间的冲突。多出来的这个角色反而让流程变得复杂、脆弱，成了整个系统的瓶颈」</strong>。</p>
<p>去掉集成者后，系统反而更流畅了。</p>
<p>这个经验很有启发性：最好的系统往往比你想的更简单。起初 Cursor 团队尝试借鉴分布式计算和组织设计中的系统模型，但并不是所有这些方法都适用于 Agent。</p>
<h2 data-id="heading-8">三、剧变来临的信号</h2>
<p>Cursor 团队告诉我们，<strong>「上百个 Agent 可以在同一个代码库上协同工作数周，推动雄心勃勃的项目取得实质进展。这不是理论，而是已经发生的现实」</strong>。</p>
<p>但他们也坦承：多智能体协同仍然是一个难题。当前的系统虽然可用，但离最优状态还差得很远。Planner 应该在任务完成时自动“醒来”规划下一步，Agent 有时会运行时间过长，他们仍然需要定期从头重启，以对抗漂移和思维视野过于狭窄的问题。</p>
<p>即便如此，对于核心问题——“能否通过投入更多 Agent 来扩展 AI 自主编码能力”——他们得到的答案依然比预期更乐观。</p>
<p>回顾过去几年 AI 编程工具的发展：</p>
<ul>
<li>2022 年：GitHub Copilot 补全代码片段</li>
<li>2023 年：ChatGPT 生成完整函数</li>
<li>2024 年：Cursor 理解项目上下文</li>
<li>2025 年：Cursor/TRAE 支持 Agent 自主开发</li>
<li>2026 年：Cursor 探索多 Agent 系统自主开发超大型项目</li>
</ul>
<p>编程工具进展神速，AI 从“辅助写代码”变成了“自主开发项目”。</p>
<p>今天，Cursor 用上百个 Agent 写出了 100 万行代码。明年呢？后年呢？AI 编程的能力边界正在快速扩张。</p>
<p>对于开发者来说：如果你的核心能力是“写代码”，那么你需要警惕了。<strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fxiaobot.net%2Fp%2Fai_1024" target="_blank" title="https://xiaobot.net/p/ai_1024" ref="nofollow noopener noreferrer">但如果你的核心能力是“理解需求、设计架构、协调资源、解决问题”，那么你反而会因为 AI 而变得更强大。</a></strong></p>
<p>那些提前拥抱 AI、学会与 AI 协作的人，正在获得巨大的竞争优势。不要等到 AI 完全成熟了再去学习，因为到那时候，窗口期可能已经关闭了。</p>
<p>Cursor 用上百个 Agent 开发超大型项目，这不是终点，而是起点。剧变正在发生，你准备好了吗？</p>
<p>好了，这篇文章到这里就结束了。感谢你的阅读，愿你平安顺遂。</p>
<p>如果对你有帮助，欢迎评论点赞转发，你的支持是我最大的动力❤️</p>
<p>参考资料：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcursor.com%2Fcn%2Fblog%2Fscaling-agents" target="_blank" title="https://cursor.com/cn/blog/scaling-agents" ref="nofollow noopener noreferrer">cursor.com/cn/blog/sca…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ruoyi专题]]></title>    <link>https://juejin.cn/post/7595911076013932580</link>    <guid>https://juejin.cn/post/7595911076013932580</guid>    <pubDate>2026-01-17T06:38:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595911076013932580" data-draft-id="7593296804110041128" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ruoyi专题"/> <meta itemprop="keywords" content="Java,Spring Boot,前端"/> <meta itemprop="datePublished" content="2026-01-17T06:38:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="哪里的破水瓶"/> <meta itemprop="url" content="https://juejin.cn/user/4394111849466414"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ruoyi专题
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4394111849466414/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    哪里的破水瓶
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T06:38:30.000Z" title="Sat Jan 17 2026 06:38:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#444;background-image:linear-gradient(90deg,rgba(59,59,59,.1) 3%,transparent 0),linear-gradient(1turn,rgba(122,120,121,.1) 3%,transparent 0);background-size:30px 30px;background-position:50%;letter-spacing:1px;word-spacing:1px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{position:relative;margin-top:34px;margin-bottom:16px;font-weight:700;line-height:1.3;cursor:text;color:#444;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body h1{font-size:41px;margin-bottom:34px;line-height:1.5}.markdown-body h1:before{content:""}.markdown-body h2{font-size:30px;padding-left:.4em;border-left:.4em solid #5e5e5e;border-bottom:1px solid #444}.markdown-body h2:after{content:"🕛";position:absolute;top:0;right:0;transition:all;animation:rotate 10s linear infinite}@keyframes rotate{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}.markdown-body h3{border-left:.4em solid #8d8d8d;font-size:24px;padding-left:.4em}.markdown-body h4{font-size:20px}.markdown-body h5{font-size:16px}.markdown-body h6{font-size:14px}.markdown-body blockquote,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body table,.markdown-body ul{margin:.8em 0}.markdown-body strong{font-weight:1000;position:relative;color:#444;padding:0 3px}.markdown-body em{font-weight:inherit}.markdown-body a{box-sizing:border-box;color:grey;position:relative}.markdown-body a:before{position:absolute;box-sizing:border-box;content:"Go -&gt;";left:0;width:100%;max-width:0;color:#fff;background-color:hsla(0,0%,50.2%,.8);white-space:nowrap;transition:.2s ease;pointer-events:none;overflow:hidden}.markdown-body a:after{content:"";position:absolute;bottom:0;left:0;width:100%;height:1px;background-color:grey}.markdown-body a:active:before,.markdown-body a:hover:before{max-width:100%;padding-left:8px;border-radius:5px}.markdown-body hr{position:relative;width:100%;height:1px;border:none;margin-top:36px;margin-bottom:36px;background:linear-gradient(90deg,grey,#f1f1f1,#444,#444,#f1f1f1,grey);overflow:visible}.markdown-body ol,.markdown-body ul{padding-left:32px}.markdown-body ol li,.markdown-body ul li{margin-bottom:6px;list-style:inherit}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol{counter-reset:my-counter}.markdown-body ol&gt;li{padding-left:6px;list-style:none;counter-increment:my-counter;position:relative}.markdown-body ol&gt;li:before{position:absolute;left:-1.5em;content:counter(my-counter);font-weight:700}.markdown-body ol&gt;li:first-child:before{content:"1️⃣"}.markdown-body ol&gt;li:nth-child(2):before{content:"2️⃣"}.markdown-body ol&gt;li:nth-child(3):before{content:"3️⃣"}.markdown-body ol&gt;li:nth-child(4):before{content:"4️⃣"}.markdown-body ol&gt;li:nth-child(5):before{content:"5️⃣"}.markdown-body ol&gt;li:nth-child(6):before{content:"6️⃣"}.markdown-body ol&gt;li:nth-child(7):before{content:"7️⃣"}.markdown-body ol&gt;li:nth-child(8):before{content:"8️⃣"}.markdown-body ol&gt;li:nth-child(9):before{content:"9️⃣"}.markdown-body ol&gt;li:nth-child(10):before{content:"🔟"}.markdown-body ul&gt;li{list-style:none;position:relative}.markdown-body ul&gt;li:before{z-index:10;position:absolute;left:-1.57em;content:"🔹";margin-right:12px}.markdown-body ul&gt;li input{margin-left:8px!important}.markdown-body blockquote{position:relative;background-color:#d3d3d3;padding:5px 10px;border-left:.2em solid #000;border-radius:3px;transition:all .8s ease}.markdown-body blockquote:hover{opacity:.7}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(69,69,77,.8);color:#fff;font-size:.87em;padding:.07em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border-radius:7px;overflow:hidden}.markdown-body pre:before{z-index:10;position:absolute;top:14px;left:14px;width:12px;height:12px;border-radius:50%;background:#fc625d;-webkit-box-shadow:20px 0 #fdbc40,40px 0 #35cd4b;box-shadow:20px 0 #fdbc40,40px 0 #35cd4b;content:" "}.markdown-body pre:after{z-index:9;content:"";position:absolute;width:100%;height:40px;top:0;background-color:#1a1a1a}.markdown-body pre&gt;code{display:block;font-family:Menlo,Monaco,Consolas,Courier New,monospace;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#171717;color:#bababa;font-size:14px;padding:40px 20px 20px}.markdown-body del{color:grey}.markdown-body table{margin-bottom:1.25rem;border-collapse:collapse}.markdown-body table td,.markdown-body table th{margin:0;padding:8px;line-height:20px;vertical-align:middle;border:1px solid #ddd}.markdown-body table thead,.markdown-body table tr:nth-child(2n){background-color:#fcfcfc}.markdown-body table thead th,.markdown-body table tr:nth-child(2n) th{font-weight:700;vertical-align:middle;color:#444}.markdown-body table tbody tr td{font-weight:400;color:#444}.markdown-body table tbody tr:hover{background-color:#d3d3d3}.markdown-body table tbody tr:hover td{color:#fff}.markdown-body img{max-width:100%;margin:0 12px}@media (max-width:720px){.markdown-body h1{font-size:32.8px}.markdown-body h2{font-size:24px}.markdown-body h3{font-size:19.2px}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:12.8px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">修改器下载</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Flpf_project%2FRuoYi-MT" target="_blank" title="https://gitee.com/lpf_project/RuoYi-MT" ref="nofollow noopener noreferrer">gitee.com/lpf_project…</a></p>
<p>选择压缩包，配置修改内容，开始执行。会输出一个文件</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0979afba4c0c4176a77211e39a3c7068~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOq6YeM55qE56C05rC055O2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769247072&amp;x-signature=Q8THEbDjbgn5GYdepaad1RM8Xy8%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">Swagger</h2>
<p>Swagger 是一个规范和完整的框架，用于生成、描述、调用和可视化 RESTful 风格的 Web 服务</p>
<p>它的主要作用有：</p>
<ul>
<li>使得前后端分离开发更加方便，有利于团队协作</li>
<li>在线自动生成接口文档，降低后端开发人员编写接口文档的负担</li>
<li>功能测试</li>
</ul>
<p>Spring已经将Swagger纳入自身的标准，建立了Spring-Swagger项目，现在叫Springfox。通过在项目中引入Springfox ，就可以非常简单快捷的使用Swagger啦。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- swagger3--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.springfox<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springfox-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 防止进入swagger页面报类型转换错误，排除3.0.0中的引用，手动增加1.6.2版本 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.swagger<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>swagger-models<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.6.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<blockquote>
<p>核心配置类</p>
</blockquote>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * Swagger2的接口配置
 */</span>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SwaggerConfig</span> {
    <span class="hljs-comment">/**
     * 系统基础配置
     */</span>
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RuoYiConfig ruoyiConfig;

    <span class="hljs-comment">/**
     * 是否开启swagger
     */</span>
    <span class="hljs-meta">@Value("${swagger.enabled}")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> enabled;

    <span class="hljs-comment">/**
     * 设置请求的统一前缀
     */</span>
    <span class="hljs-meta">@Value("${swagger.pathMapping}")</span>
    <span class="hljs-keyword">private</span> String pathMapping;

    <span class="hljs-comment">/**
     * 创建API
     */</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Docket <span class="hljs-title function_">createRestApi</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Docket</span>(DocumentationType.OAS_30)
                <span class="hljs-comment">// 是否启用Swagger</span>
                .enable(enabled)
                <span class="hljs-comment">// 用来创建该API的基本信息，展示在文档的页面中（自定义展示的信息）</span>
                .apiInfo(apiInfo())
                <span class="hljs-comment">// 设置哪些接口暴露给Swagger展示</span>
                .select()
                <span class="hljs-comment">// 扫描所有有注解的api，用这种方式更灵活</span>
                .apis(RequestHandlerSelectors.withMethodAnnotation(ApiOperation.class))
                <span class="hljs-comment">// 扫描指定包中的swagger注解</span>
                <span class="hljs-comment">// .apis(RequestHandlerSelectors.basePackage("com.kzzyl.project.tool.swagger"))</span>
                <span class="hljs-comment">// 扫描所有 .apis(RequestHandlerSelectors.any())</span>
                .paths(PathSelectors.any())
                .build()
                <span class="hljs-comment">/* 设置安全模式，swagger可以设置访问token */</span>
                .securitySchemes(securitySchemes())
                .securityContexts(securityContexts())
                .pathMapping(pathMapping);
    }

    <span class="hljs-comment">/**
     * 安全模式，这里指定token通过Authorization头请求头传递
     */</span>
    <span class="hljs-keyword">private</span> List&lt;SecurityScheme&gt; <span class="hljs-title function_">securitySchemes</span><span class="hljs-params">()</span> {
        List&lt;SecurityScheme&gt; apiKeyList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        apiKeyList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ApiKey</span>(<span class="hljs-string">"Authorization"</span>, <span class="hljs-string">"Authorization"</span>, In.HEADER.toValue()));
        <span class="hljs-keyword">return</span> apiKeyList;
    }

    <span class="hljs-comment">/**
     * 安全上下文
     */</span>
    <span class="hljs-keyword">private</span> List&lt;SecurityContext&gt; <span class="hljs-title function_">securityContexts</span><span class="hljs-params">()</span> {
        List&lt;SecurityContext&gt; securityContexts = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        securityContexts.add(
                SecurityContext.builder()
                        .securityReferences(defaultAuth())
                        .operationSelector(o -&gt;
                                o.requestMappingPattern().matches(<span class="hljs-string">"/.*"</span>))
                        .build());
        <span class="hljs-keyword">return</span> securityContexts;
    }

    <span class="hljs-comment">/**
     * 默认的安全上引用
     */</span>
    <span class="hljs-keyword">private</span> List&lt;SecurityReference&gt; <span class="hljs-title function_">defaultAuth</span><span class="hljs-params">()</span> {
        <span class="hljs-type">AuthorizationScope</span> <span class="hljs-variable">authorizationScope</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AuthorizationScope</span>(<span class="hljs-string">"global"</span>,
                <span class="hljs-string">"accessEverything"</span>);
        AuthorizationScope[] authorizationScopes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AuthorizationScope</span>[<span class="hljs-number">1</span>];
        authorizationScopes[<span class="hljs-number">0</span>] = authorizationScope;
        List&lt;SecurityReference&gt; securityReferences = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        securityReferences.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SecurityReference</span>(<span class="hljs-string">"Authorization"</span>, authorizationScopes));
        <span class="hljs-keyword">return</span> securityReferences;
    }

    <span class="hljs-comment">/**
     * 添加摘要信息
     */</span>
    <span class="hljs-keyword">private</span> ApiInfo <span class="hljs-title function_">apiInfo</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 用ApiInfoBuilder进行定制</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApiInfoBuilder</span>()
                <span class="hljs-comment">// 设置标题</span>
                .title(<span class="hljs-string">"标题：若依管理系统_接口文档"</span>)
                <span class="hljs-comment">// 描述</span>
                .description(<span class="hljs-string">"描述：用于管理集团旗下公司的人员信息,具体包括XXX,XXX模块..."</span>)
                <span class="hljs-comment">// 作者信息</span>
                .contact(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Contact</span>(ruoyiConfig.getName(), <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>))
                <span class="hljs-comment">// 版本</span>
                .version(<span class="hljs-string">"版本号:"</span> + ruoyiConfig.getVersion())
                .build();
    }
}

</code></pre>
<h2 data-id="heading-2">集成knife4j</h2>
<p>如果不习惯使用swagger可以使用前端UI的增强解决方案knife4j，对比swagger相比有以下优势，友好界面，离线文档，接口排序，安全控制，在线调试，文档清晰，注解增强，容易上手。
目前，企业项目中一般都使用knife4j框架。</p>
<blockquote>
<p>需要移除依赖，springfox-boot-starter 和 swagger-models</p>
</blockquote>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- SpringBoot2 使用依赖 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.github.xiaoymin<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>knife4j-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.0.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<blockquote>
<p>前端修改 ry-ui\views\tool\swagger\index.vue 跳转地址，如下</p>
</blockquote>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> url = <span class="hljs-title function_">ref</span>(<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">VITE_APP_BASE_API</span> + <span class="hljs-string">"/doc.html"</span>)
</code></pre>
<h3 data-id="heading-3">注解参数</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 作用到类上描述，标题</span>
<span class="hljs-meta">@Api(value = "护理项目管理", tags = "护理项目管理")</span>
<span class="hljs-comment">// 作用到方法上，描述具体的接口</span>
<span class="hljs-meta">@ApiOperation("查询护理项目列表")</span>
<span class="hljs-comment">// 作用到方法的参数上，描述参数信息</span>
<span class="hljs-meta">@ApiParam("查询条件对象")</span>
<span class="hljs-comment">// 作用到实体类上</span>
<span class="hljs-meta">@ApiModel("Entity基类")</span>
<span class="hljs-comment">// 作用到实体类的成员变量上</span>
<span class="hljs-meta">@ApiModelProperty("搜索值")</span>
</code></pre>
<h2 data-id="heading-4">Velocity模块引擎</h2>
<p>Velocity是一个基于Java的模板引擎，它可以通过特定的语法获取java对象的数据 , 填充到模板中，从而实现界面和java代码的分离。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3433d5b35001450990f095a738cd467f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOq6YeM55qE56C05rC055O2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769247072&amp;x-signature=aHo%2FU8y22hjMMHOlSFipBAJcnIQ%3D" alt="image.png" loading="lazy"/></p>
<p>常见的应用场景：</p>
<ul>
<li>Web应用程序 : 作为应用程序的视图, 展示数据。</li>
<li>源代码生成 : Velocity可以基于模板生成Java源代码。</li>
<li>自动电子邮件 : 网站注册， 认证等的电子邮件模板。</li>
<li>网页静态化 : 基于velocity模板生成静态网页。</li>
</ul>
<blockquote>
<p>案例</p>
</blockquote>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//<span class="hljs-doctag">TODO:</span> 1.初始化velocity</span>
<span class="hljs-type">Properties</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Properties</span>();
<span class="hljs-comment">// 加载classpath目录下的vm文件</span>
p.setProperty(<span class="hljs-string">"resource.loader.file.class"</span>, <span class="hljs-string">"org.apache.velocity.runtime.resource.loader.ClasspathResourceLoader"</span>);
<span class="hljs-comment">// 定义字符集</span>
p.setProperty(Velocity.INPUT_ENCODING, Constants.UTF8);
<span class="hljs-comment">// 初始化Velocity引擎，指定配置Properties</span>
Velocity.init(p);

<span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> 2.创建Velocity上下文对象</span>
<span class="hljs-type">VelocityContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">VelocityContext</span>();
context.put(<span class="hljs-string">"message"</span>, <span class="hljs-string">"加油朋友"</span>);

<span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> 3.获取模板</span>
<span class="hljs-type">Template</span> <span class="hljs-variable">template</span> <span class="hljs-operator">=</span> Velocity.getTemplate(<span class="hljs-string">"vms/index.html.vm"</span>, Constants.UTF8);
<span class="hljs-comment">// 准备输出流，将文件写出</span>
<span class="hljs-type">FileWriter</span> <span class="hljs-variable">fileWriter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileWriter</span>(<span class="hljs-string">"E:\\黑马ai\\kzzyl\\kzzyl-generator\\src\\main\\resources\\vms\\index.html"</span>);
<span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> 4.合并模板和数据模型</span>
template.merge(context, fileWriter);

fileWriter.close();
</code></pre>
<p><strong>模板如下：使用 ${message} 传递 message 变量</strong></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>随便写点数据吧--${message}<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>Velocity语法解释</p>
<ul>
<li>${variable}: 表示插入变量值。</li>
<li>#foreach 和 #end: 循环结构，用于遍历列表。</li>
<li>#if 和 #end: 条件判断结构。</li>
<li>#set: 设置变量。</li>
<li>#elseif: 条件分支。</li>
</ul>
<h2 data-id="heading-5">集成 MybatisPlus</h2>
<p>在 common 下引入</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- MyBatis-Plus 增强CRUD --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.5.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>删除 mybatis-config.xml 文件</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-comment"># MyBatisPlus配置</span>
<span class="hljs-attr">mybatis-plus:</span>
  <span class="hljs-comment"># 搜索指定包别名</span>
  <span class="hljs-attr">typeAliasesPackage:</span> <span class="hljs-string">com.kzzyl.**.domain</span>
  <span class="hljs-comment"># 配置mapper的扫描，找到所有的mapper.xml映射文件</span>
  <span class="hljs-attr">mapperLocations:</span> <span class="hljs-string">classpath*:mapper/**/*Mapper.xml</span>
  <span class="hljs-attr">global-config:</span>
    <span class="hljs-attr">db-config:</span>
      <span class="hljs-attr">id-type:</span> <span class="hljs-string">auto</span>
  <span class="hljs-attr">configuration:</span>
    <span class="hljs-comment"># 开启驼峰命名规则</span>
    <span class="hljs-attr">map-underscore-to-camel-case:</span> <span class="hljs-literal">true</span>
</code></pre>
<blockquote>
<p>删除 MyBatisConfig 文件，替换成 MyBatisPlusConfig 如下</p>
</blockquote>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-comment">/**
 * Mybatis Plus 配置
 */</span>
<span class="hljs-meta">@EnableTransactionManagement(proxyTargetClass = true)</span>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MybatisPlusConfig</span> {

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> MybatisPlusInterceptor <span class="hljs-title function_">mybatisPlusInterceptor</span><span class="hljs-params">()</span> {
        <span class="hljs-type">MybatisPlusInterceptor</span> <span class="hljs-variable">interceptor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MybatisPlusInterceptor</span>();
        <span class="hljs-comment">// 分页插件</span>
        interceptor.addInnerInterceptor(paginationInnerInterceptor());
        <span class="hljs-comment">// 乐观锁插件</span>
        interceptor.addInnerInterceptor(optimisticLockerInnerInterceptor());
        <span class="hljs-comment">// 阻断插件</span>
        interceptor.addInnerInterceptor(blockAttackInnerInterceptor());
        <span class="hljs-keyword">return</span> interceptor;
    }

    <span class="hljs-comment">/**
     * 分页插件，自动识别数据库类型
     */</span>
    <span class="hljs-keyword">public</span> PaginationInnerInterceptor <span class="hljs-title function_">paginationInnerInterceptor</span><span class="hljs-params">()</span> {
        <span class="hljs-type">PaginationInnerInterceptor</span> <span class="hljs-variable">paginationInnerInterceptor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PaginationInnerInterceptor</span>();
        <span class="hljs-comment">// 设置数据库类型为mysql</span>
        paginationInnerInterceptor.setDbType(DbType.MYSQL);
        <span class="hljs-comment">// 设置最大单页限制数量，默认 500 条，-1 不受限制</span>
        paginationInnerInterceptor.setMaxLimit(-<span class="hljs-number">1L</span>);
        <span class="hljs-keyword">return</span> paginationInnerInterceptor;
    }

    <span class="hljs-comment">/**
     * 乐观锁插件
     */</span>
    <span class="hljs-keyword">public</span> OptimisticLockerInnerInterceptor <span class="hljs-title function_">optimisticLockerInnerInterceptor</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OptimisticLockerInnerInterceptor</span>();
    }

    <span class="hljs-comment">/**
     * 如果是对全表的删除或更新操作，就会终止该操作
     */</span>
    <span class="hljs-keyword">public</span> BlockAttackInnerInterceptor <span class="hljs-title function_">blockAttackInnerInterceptor</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BlockAttackInnerInterceptor</span>();
    }

}
</code></pre>
<p>注意事项：</p>
<ol>
<li>需要在 BaseEntity 里 <code>params和searchValue</code> 需要设置 @TableField(exist = false)</li>
</ol>
<blockquote>
<p>方便直接拷贝</p>
</blockquote>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.kzzyl.common.core.domain;

<span class="hljs-keyword">import</span> java.io.Serial;
<span class="hljs-keyword">import</span> java.io.Serializable;
<span class="hljs-keyword">import</span> java.util.Date;
<span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.Map;

<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.FieldFill;
<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.TableField;
<span class="hljs-keyword">import</span> com.fasterxml.jackson.annotation.JsonFormat;
<span class="hljs-keyword">import</span> com.fasterxml.jackson.annotation.JsonIgnore;
<span class="hljs-keyword">import</span> com.fasterxml.jackson.annotation.JsonInclude;
<span class="hljs-keyword">import</span> io.swagger.annotations.ApiModel;
<span class="hljs-keyword">import</span> io.swagger.annotations.ApiModelProperty;
<span class="hljs-keyword">import</span> lombok.Data;

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@author</span> Kun
 */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@ApiModel("Entity基类")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseEntity</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> {

    <span class="hljs-meta">@Serial</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">1L</span>;

    <span class="hljs-meta">@JsonIgnore</span>
    <span class="hljs-meta">@ApiModelProperty("搜索值")</span>
    <span class="hljs-meta">@TableField(exist = false)</span>
    <span class="hljs-keyword">private</span> String searchValue;

    <span class="hljs-meta">@ApiModelProperty("创建者")</span>
    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT)</span>
    <span class="hljs-keyword">private</span> String createBy;

    <span class="hljs-meta">@JsonFormat(pattern = "yyyy-MM-dd HH:mm:ss")</span>
    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT)</span>
    <span class="hljs-meta">@ApiModelProperty("创建时间")</span>
    <span class="hljs-keyword">private</span> Date createTime;

    <span class="hljs-meta">@ApiModelProperty("更新者")</span>
    <span class="hljs-meta">@TableField(fill = FieldFill.UPDATE)</span>
    <span class="hljs-keyword">private</span> String updateBy;

    <span class="hljs-meta">@JsonFormat(pattern = "yyyy-MM-dd HH:mm:ss")</span>
    <span class="hljs-meta">@TableField(fill = FieldFill.UPDATE)</span>
    <span class="hljs-meta">@ApiModelProperty("更新时间")</span>
    <span class="hljs-keyword">private</span> Date updateTime;

    <span class="hljs-comment">/**
     * 备注
     */</span>
    <span class="hljs-meta">@ApiModelProperty("备注")</span>
    <span class="hljs-keyword">private</span> String remark;

    <span class="hljs-comment">/**
     * 请求参数
     */</span>
    <span class="hljs-meta">@JsonInclude(JsonInclude.Include.NON_EMPTY)</span>
    <span class="hljs-meta">@TableField(exist = false)</span>
    <span class="hljs-meta">@ApiModelProperty("请求参数")</span>
    <span class="hljs-keyword">private</span> Map&lt;String, Object&gt; params;

    <span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title function_">getParams</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (params == <span class="hljs-literal">null</span>) {
            params = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        }
        <span class="hljs-keyword">return</span> params;
    }

}
</code></pre>
<h2 data-id="heading-6">MybatisPlus 自动填充</h2>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.kzzyl.framework.interceptor;

<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.handlers.MetaObjectHandler;
<span class="hljs-keyword">import</span> com.kzzyl.common.utils.DateUtils;
<span class="hljs-keyword">import</span> com.kzzyl.common.utils.SecurityUtils;
<span class="hljs-keyword">import</span> org.apache.ibatis.reflection.MetaObject;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;

<span class="hljs-keyword">import</span> java.util.Date;

<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseEntityHandle</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MetaObjectHandler</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertFill</span><span class="hljs-params">(MetaObject metaObject)</span> {
        <span class="hljs-built_in">this</span>.strictInsertFill(metaObject, <span class="hljs-string">"createBy"</span>, String.class, SecurityUtils.getUserId().toString());
        <span class="hljs-built_in">this</span>.strictInsertFill(metaObject, <span class="hljs-string">"createTime"</span>, Date.class, DateUtils.getNowDate());
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateFill</span><span class="hljs-params">(MetaObject metaObject)</span> {
        <span class="hljs-built_in">this</span>.setFieldValByName(<span class="hljs-string">"updateBy"</span>, SecurityUtils.getUserId().toString(), metaObject);
        <span class="hljs-built_in">this</span>.setFieldValByName(<span class="hljs-string">"updateTime"</span>, DateUtils.getNowDate(), metaObject);
    }

}
</code></pre>
<h2 data-id="heading-7">改造 controller 层</h2>
<p>代码模板在下面，这里只说一下需要调整的内置代码</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> lombok.NoArgsConstructor;

<span class="hljs-keyword">import</span> java.io.Serial;
<span class="hljs-keyword">import</span> java.io.Serializable;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * 表格分页数据对象
 */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@NoArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TableDataInfo</span>&lt;T&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> {
    
    <span class="hljs-meta">@Serial</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">1L</span>;

    <span class="hljs-comment">/**
     * 总记录数
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> total;

    <span class="hljs-comment">/**
     * 列表数据
     */</span>
    <span class="hljs-keyword">private</span> List&lt;T&gt; rows;

    <span class="hljs-comment">/**
     * 消息状态码
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> code;

    <span class="hljs-comment">/**
     * 消息内容
     */</span>
    <span class="hljs-keyword">private</span> String msg;

    <span class="hljs-comment">/**
     * 分页
     *
     * <span class="hljs-doctag">@param</span> list  列表数据
     * <span class="hljs-doctag">@param</span> total 总记录数
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">TableDataInfo</span><span class="hljs-params">(List&lt;T&gt; list, <span class="hljs-type">long</span> total)</span> {
        <span class="hljs-built_in">this</span>.rows = list;
        <span class="hljs-built_in">this</span>.total = total;
    }

}

</code></pre>
<p>还有 BaseController 中的下面方法</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * 响应请求分页数据
 */</span>
<span class="hljs-keyword">protected</span> &lt;T&gt; TableDataInfo&lt;T&gt; <span class="hljs-title function_">getDataTable</span><span class="hljs-params">(List&lt;T&gt; list)</span> {
    TableDataInfo&lt;T&gt; rspData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TableDataInfo</span>&lt;&gt;();
    rspData.setCode(HttpStatus.SUCCESS);
    rspData.setMsg(<span class="hljs-string">"查询成功"</span>);
    rspData.setRows(list);
    rspData.setTotal(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PageInfo</span>&lt;&gt;(list).getTotal());
    <span class="hljs-keyword">return</span> rspData;
}
</code></pre>
<h2 data-id="heading-8">修改时间类型为 LocalDate</h2>
<p>前端在 views/tool/editTable 文件中如下图位置。新增上 LocalDateTime</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a33e76adf0ed4e80a1d8f5b3d5f2fb7c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOq6YeM55qE56C05rC055O2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769247072&amp;x-signature=ruYh3D%2BFK2r95jOiACIjgvAqm20%3D" alt="image.png" loading="lazy"/></p>
<p>Java</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// src/main/java/com/kzzyl/common/constant/GenConstants.java</span>
<span class="hljs-comment">/** 时间类型 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TYPE_LOCAL_DATE_TIME</span> <span class="hljs-operator">=</span> <span class="hljs-string">"LocalDateTime"</span>;

<span class="hljs-comment">// src/main/java/com/kzzyl/generator/util/VelocityUtils.java</span>
<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!column.isSuperColumn() &amp;&amp; GenConstants.TYPE_LOCAL_DATE_TIME.equals(column.getJavaType())) {
    importList.add(<span class="hljs-string">"import java.time.LocalDateTime"</span>);
    importList.add(<span class="hljs-string">"com.fasterxml.jackson.annotation.JsonFormat"</span>);
}
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6714aa61f48f4757977a36549e8e28b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOq6YeM55qE56C05rC055O2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769247072&amp;x-signature=QGb3nJh3bhU6Ibq%2BaF4vfAZMnt4%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-9">初始化字段对应关系修改</h2>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 在 src/main/java/com/kzzyl/generator/util/GenUtils.java</span>
<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (str != <span class="hljs-literal">null</span> &amp;&amp; str.length == <span class="hljs-number">1</span> &amp;&amp; Integer.parseInt(str[<span class="hljs-number">0</span>]) &lt;= <span class="hljs-number">10</span>
        || GenConstants.MYSQL_TINYINT.equals(column.getColumnType()) ||
        GenConstants.MYSQL_INT.equals(column.getColumnType())) {
    <span class="hljs-comment">// 修改为Integer</span>
    column.setJavaType(GenConstants.TYPE_INTEGER);
}
<span class="hljs-comment">// ---------------</span>
<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (arraysContains(GenConstants.COLUMNTYPE_TIME, dataType)) {
    <span class="hljs-comment">// 如果是时间类型 则生成LocalDateTime类型</span>
    column.setJavaType(GenConstants.TYPE_LOCAL_DATE_TIME);
    column.setHtmlType(GenConstants.HTML_DATETIME);
}

<span class="hljs-comment">// src/main/java/com/kzzyl/common/constant/GenConstants.java</span>
<span class="hljs-comment">/** MySql tinyint 类型 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">MYSQL_TINYINT</span> <span class="hljs-operator">=</span> <span class="hljs-string">"tinyint"</span>;

<span class="hljs-comment">/** MySql int 类型 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">MYSQL_INT</span> <span class="hljs-operator">=</span> <span class="hljs-string">"int"</span>;
</code></pre>
<h2 data-id="heading-10">代码生成模板</h2>
<p><strong>controller.java.vm</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> ${packageName}.controller;

<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;

<span class="hljs-keyword">import</span> lombok.AllArgsConstructor;
<span class="hljs-keyword">import</span> io.swagger.annotations.Api;
<span class="hljs-keyword">import</span> com.kzzyl.common.core.domain.R;
<span class="hljs-keyword">import</span> io.swagger.annotations.ApiParam;
<span class="hljs-keyword">import</span> io.swagger.annotations.ApiOperation;
<span class="hljs-keyword">import</span> org.springframework.security.access.prepost.PreAuthorize;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PostMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PutMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.DeleteMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PathVariable;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestBody;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;
<span class="hljs-keyword">import</span> com.kzzyl.common.annotation.Log;
<span class="hljs-keyword">import</span> com.kzzyl.common.core.controller.BaseController;
<span class="hljs-keyword">import</span> com.kzzyl.common.core.domain.AjaxResult;
<span class="hljs-keyword">import</span> com.kzzyl.common.enums.BusinessType;
<span class="hljs-keyword">import</span> ${packageName}.domain.${ClassName};
<span class="hljs-keyword">import</span> ${packageName}.service.I${ClassName}Service;
<span class="hljs-keyword">import</span> com.kzzyl.common.utils.poi.ExcelUtil;
#<span class="hljs-keyword">if</span>($table.crud || $table.sub)
<span class="hljs-keyword">import</span> com.kzzyl.common.core.page.TableDataInfo;
#elseif($table.tree)
#end

<span class="hljs-comment">/**
 * ${functionName}Controller
 * 
 * <span class="hljs-doctag">@author</span> ${author}
 * date ${datetime}
 */</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@AllArgsConstructor</span>
<span class="hljs-meta">@RequestMapping("/${moduleName}/${businessName}")</span>
<span class="hljs-meta">@Api(value = "${functionName}管理", tags = "${functionName}管理")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">$</span>{ClassName}Controller <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseController</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> I${ClassName}Service ${className}Service;

    <span class="hljs-comment">/**
     * 查询${functionName}列表
     */</span>
    <span class="hljs-meta">@ApiOperation("查询${functionName}列表")</span>
    <span class="hljs-meta">@PreAuthorize("@ss.hasPermi('${permissionPrefix}:list')")</span>
    <span class="hljs-meta">@GetMapping("/list")</span>
#<span class="hljs-keyword">if</span>($table.crud || $table.sub)
    <span class="hljs-keyword">public</span> TableDataInfo&lt;${ClassName}&gt; list(${ClassName} ${className}) {
        startPage();
        <span class="hljs-keyword">return</span> getDataTable(${className}Service.select${ClassName}List(${className}));
    }
#elseif($table.tree)
    <span class="hljs-keyword">public</span> AjaxResult <span class="hljs-title function_">list</span><span class="hljs-params">(${ClassName} ${className})</span>
    {
        List&lt;${ClassName}&gt; list = ${className}Service.select${ClassName}List(${className});
        <span class="hljs-keyword">return</span> success(list);
    }
#end

    <span class="hljs-comment">/**
     * 导出${functionName}列表
     */</span>
    <span class="hljs-meta">@ApiOperation("导出${functionName}列表")</span>
    <span class="hljs-meta">@PreAuthorize("@ss.hasPermi('${permissionPrefix}:export')")</span>
    <span class="hljs-meta">@Log(title = "${functionName}", businessType = BusinessType.EXPORT)</span>
    <span class="hljs-meta">@PostMapping("/export")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">export</span><span class="hljs-params">(HttpServletResponse response, ${ClassName} ${className})</span> {
        List&lt;${ClassName}&gt; list = ${className}Service.select${ClassName}List(${className});
        ExcelUtil&lt;${ClassName}&gt; util = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExcelUtil</span>&lt;&gt;(${ClassName}.class);
        util.exportExcel(response, list, <span class="hljs-string">"${functionName}数据"</span>);
    }

    <span class="hljs-comment">/**
     * 获取${functionName}详细信息
     */</span>
    <span class="hljs-meta">@ApiOperation("获取${functionName}列表")</span>
    <span class="hljs-meta">@PreAuthorize("@ss.hasPermi('${permissionPrefix}:query')")</span>
    <span class="hljs-meta">@GetMapping("/{${pkColumn.javaField}}")</span>
    <span class="hljs-keyword">public</span> R&lt;${ClassName}&gt; getInfo(<span class="hljs-meta">@PathVariable</span> <span class="hljs-meta">@ApiParam("唯一ID")</span> ${pkColumn.javaType} ${pkColumn.javaField}) {
        <span class="hljs-keyword">return</span> R.ok(${className}Service.select${ClassName}By${pkColumn.capJavaField}(${pkColumn.javaField}));
    }

    <span class="hljs-comment">/**
     * 新增${functionName}
     */</span>
    <span class="hljs-meta">@ApiOperation("新增${functionName}列表")</span>
    <span class="hljs-meta">@PreAuthorize("@ss.hasPermi('${permissionPrefix}:add')")</span>
    <span class="hljs-meta">@Log(title = "${functionName}", businessType = BusinessType.INSERT)</span>
    <span class="hljs-meta">@PostMapping</span>
    <span class="hljs-keyword">public</span> AjaxResult <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> ${ClassName} ${className})</span> {
        <span class="hljs-keyword">return</span> toAjax(${className}Service.insert${ClassName}(${className}));
    }

    <span class="hljs-comment">/**
     * 修改${functionName}
     */</span>
    <span class="hljs-meta">@ApiOperation("修改${functionName}列表")</span>
    <span class="hljs-meta">@PreAuthorize("@ss.hasPermi('${permissionPrefix}:edit')")</span>
    <span class="hljs-meta">@Log(title = "${functionName}", businessType = BusinessType.UPDATE)</span>
    <span class="hljs-meta">@PutMapping</span>
    <span class="hljs-keyword">public</span> AjaxResult <span class="hljs-title function_">edit</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> ${ClassName} ${className})</span> {
        <span class="hljs-keyword">return</span> toAjax(${className}Service.update${ClassName}(${className}));
    }

    <span class="hljs-comment">/**
     * 删除${functionName}
     */</span>
    <span class="hljs-meta">@ApiOperation("删除${functionName}列表")</span>
    <span class="hljs-meta">@PreAuthorize("@ss.hasPermi('${permissionPrefix}:remove')")</span>
    <span class="hljs-meta">@Log(title = "${functionName}", businessType = BusinessType.DELETE)</span>
    <span class="hljs-meta">@DeleteMapping("/{${pkColumn.javaField}s}")</span>
    <span class="hljs-keyword">public</span> AjaxResult <span class="hljs-title function_">remove</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> <span class="hljs-meta">@ApiParam("唯一ID集合")</span> ${pkColumn.javaType}[] ${pkColumn.javaField}s)</span> {
        <span class="hljs-keyword">return</span> toAjax(${className}Service.delete${ClassName}By${pkColumn.capJavaField}s(${pkColumn.javaField}s));
    }
}
</code></pre>
<p><strong>domain.java.vm</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> ${packageName}.domain;

<span class="hljs-keyword">import</span> lombok.*;

<span class="hljs-keyword">import</span> java.io.Serial;
#foreach ($<span class="hljs-keyword">import</span> in $importList)
<span class="hljs-keyword">import</span> ${<span class="hljs-keyword">import</span>};
#end

<span class="hljs-keyword">import</span> io.swagger.annotations.ApiModel;
<span class="hljs-keyword">import</span> com.kzzyl.common.annotation.Excel;
<span class="hljs-keyword">import</span> io.swagger.annotations.ApiModelProperty;
#<span class="hljs-keyword">if</span>($table.crud || $table.sub)
<span class="hljs-keyword">import</span> com.kzzyl.common.core.domain.BaseEntity;
#elseif($table.tree)
<span class="hljs-keyword">import</span> com.kzzyl.common.core.domain.TreeEntity;
#end

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@author</span> ${author}
 * date ${datetime}
 */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@NoArgsConstructor</span>
<span class="hljs-meta">@AllArgsConstructor</span>
#<span class="hljs-keyword">if</span>($table.crud || $table.sub)
#set($Entity=<span class="hljs-string">"BaseEntity"</span>)
#elseif($table.tree)
#set($Entity=<span class="hljs-string">"TreeEntity"</span>)
#end
<span class="hljs-meta">@EqualsAndHashCode(callSuper = true)</span>
<span class="hljs-meta">@ApiModel(description = "${functionName}")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">$</span>{ClassName} <span class="hljs-keyword">extends</span> <span class="hljs-title class_">$</span>{Entity} {

    <span class="hljs-meta">@Serial</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">1L</span>;

#foreach ($column in $columns)
#<span class="hljs-keyword">if</span>(!$table.isSuperColumn($column.javaField))
#<span class="hljs-keyword">if</span>($column.list)
#set($parentheseIndex=$column.columnComment.indexOf(<span class="hljs-string">"（"</span>))
#<span class="hljs-keyword">if</span>($parentheseIndex != -<span class="hljs-number">1</span>)
#set($comment=$column.columnComment.substring(<span class="hljs-number">0</span>, $parentheseIndex))
#<span class="hljs-keyword">else</span>
#set($comment=$column.columnComment)
#end
#<span class="hljs-keyword">if</span>($parentheseIndex != -<span class="hljs-number">1</span>)
    <span class="hljs-meta">@Excel(name = "${comment}", readConverterExp = "$column.readConverterExp()")</span>
#elseif($column.javaType == <span class="hljs-string">'Date'</span> || $column.javaType == <span class="hljs-string">'LocalDateTime'</span>)
    <span class="hljs-meta">@JsonFormat(pattern = "yyyy-MM-dd HH:mm:ss")</span>
    <span class="hljs-meta">@Excel(name = "${comment}", width = 30, dateFormat = "yyyy-MM-dd HH:mm:ss")</span>
#<span class="hljs-keyword">else</span>
    <span class="hljs-meta">@Excel(name = "${comment}")</span>
#end
#end
    <span class="hljs-meta">@ApiModelProperty("${column.columnComment}")</span>
    <span class="hljs-keyword">private</span> $column.javaType $column.javaField;

#end
#end
#<span class="hljs-keyword">if</span>($table.sub)
    <span class="hljs-comment">/** $table.subTable.functionName信息 */</span>
    <span class="hljs-keyword">private</span> List&lt;${subClassName}&gt; ${subclassName}List;
#end
#<span class="hljs-keyword">if</span>($table.sub)
    <span class="hljs-keyword">public</span> List&lt;${subClassName}&gt; get${subClassName}List()
    {
        <span class="hljs-keyword">return</span> ${subclassName}List;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> set${subClassName}List(List&lt;${subClassName}&gt; ${subclassName}List)
    {
        <span class="hljs-built_in">this</span>.${subclassName}List = ${subclassName}List;
    }
#end
}
</code></pre>
<p><strong>mapper.java.vm</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> ${packageName}.mapper;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;
<span class="hljs-keyword">import</span> ${packageName}.domain.${ClassName};
#<span class="hljs-keyword">if</span>($table.sub)
<span class="hljs-keyword">import</span> ${packageName}.domain.${subClassName};
#end

<span class="hljs-comment">/**
 * ${functionName}Mapper接口
 * 
 * <span class="hljs-doctag">@author</span> ${author}
 * date ${datetime}
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">$</span>{ClassName}Mapper <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseMapper</span>&lt;${ClassName}&gt; {

    <span class="hljs-comment">/**
     * 查询${functionName}
     * 
     * <span class="hljs-doctag">@param</span> ${pkColumn.javaField} ${functionName}主键
     */</span>
    ${ClassName} select${ClassName}By${pkColumn.capJavaField}(${pkColumn.javaType} ${pkColumn.javaField});

    <span class="hljs-comment">/**
     * 查询${functionName}列表
     * 
     * <span class="hljs-doctag">@param</span> ${className} ${functionName}
     */</span>
    List&lt;${ClassName}&gt; select${ClassName}List(${ClassName} ${className});

    <span class="hljs-comment">/**
     * 新增${functionName}
     * 
     * <span class="hljs-doctag">@param</span> ${className} ${functionName}
     */</span>
    <span class="hljs-type">int</span> insert${ClassName}(${ClassName} ${className});

    <span class="hljs-comment">/**
     * 修改${functionName}
     * 
     * <span class="hljs-doctag">@param</span> ${className} ${functionName}
     */</span>
    <span class="hljs-type">int</span> update${ClassName}(${ClassName} ${className});

    <span class="hljs-comment">/**
     * 删除${functionName}
     * 
     * <span class="hljs-doctag">@param</span> ${pkColumn.javaField} ${functionName}主键
     */</span>
    <span class="hljs-type">int</span> delete${ClassName}By${pkColumn.capJavaField}(${pkColumn.javaType} ${pkColumn.javaField});

    <span class="hljs-comment">/**
     * 批量删除${functionName}
     * 
     * <span class="hljs-doctag">@param</span> ${pkColumn.javaField}s 需要删除的数据主键集合
     */</span>
    <span class="hljs-type">int</span> delete${ClassName}By${pkColumn.capJavaField}s(${pkColumn.javaType}[] ${pkColumn.javaField}s);
#<span class="hljs-keyword">if</span>($table.sub)

    <span class="hljs-comment">/**
     * 批量删除${subTable.functionName}
     * 
     * <span class="hljs-doctag">@param</span> ${pkColumn.javaField}s 需要删除的数据主键集合
     */</span>
    <span class="hljs-type">int</span> delete${subClassName}By${subTableFkClassName}s(${pkColumn.javaType}[] ${pkColumn.javaField}s);
    
    <span class="hljs-comment">/**
     * 批量新增${subTable.functionName}
     * 
     * <span class="hljs-doctag">@param</span> ${subclassName}List ${subTable.functionName}列表
     */</span>
    <span class="hljs-type">int</span> batch${subClassName}(List&lt;${subClassName}&gt; ${subclassName}List);
    

    <span class="hljs-comment">/**
     * 通过${functionName}主键删除${subTable.functionName}信息
     * 
     * <span class="hljs-doctag">@param</span> ${pkColumn.javaField} ${functionName}ID
     */</span>
    <span class="hljs-type">int</span> delete${subClassName}By${subTableFkClassName}(${pkColumn.javaType} ${pkColumn.javaField});
#end
}
</code></pre>
<p><strong>service.java.vm</strong></p>
<pre><code class="hljs language-vm" lang="vm">package ${packageName}.service;

import java.util.List;

import com.baomidou.mybatisplus.extension.service.IService;
import ${packageName}.domain.${ClassName};

/**
 * ${functionName}Service接口
 * 
 * @author ${author}
 * date ${datetime}
 */
public interface I${ClassName}Service extends IService&lt;${ClassName}&gt; {

    /**
     * 查询${functionName}
     * 
     * @param ${pkColumn.javaField} ${functionName}主键
     */
    ${ClassName} select${ClassName}By${pkColumn.capJavaField}(${pkColumn.javaType} ${pkColumn.javaField});

    /**
     * 查询${functionName}列表
     * 
     * @param ${className} ${functionName}
     */
    List&lt;${ClassName}&gt; select${ClassName}List(${ClassName} ${className});

    /**
     * 新增${functionName}
     * 
     * @param ${className} ${functionName}
     */
    boolean insert${ClassName}(${ClassName} ${className});

    /**
     * 修改${functionName}
     * 
     * @param ${className} ${functionName}
     */
    boolean update${ClassName}(${ClassName} ${className});

    /**
     * 批量删除${functionName}
     * 
     * @param ${pkColumn.javaField}s 需要删除的${functionName}主键集合
     */
    boolean delete${ClassName}By${pkColumn.capJavaField}s(${pkColumn.javaType}[] ${pkColumn.javaField}s);

}
</code></pre>
<p><strong>serviceImpl.java.vm</strong></p>
<pre><code class="hljs language-vm" lang="vm">package ${packageName}.service;

import java.util.List;

import com.baomidou.mybatisplus.extension.service.IService;
import ${packageName}.domain.${ClassName};

/**
 * ${functionName}Service接口
 * 
 * @author ${author}
 * date ${datetime}
 */
public interface I${ClassName}Service extends IService&lt;${ClassName}&gt; {

    /**
     * 查询${functionName}
     * 
     * @param ${pkColumn.javaField} ${functionName}主键
     */
    ${ClassName} select${ClassName}By${pkColumn.capJavaField}(${pkColumn.javaType} ${pkColumn.javaField});

    /**
     * 查询${functionName}列表
     * 
     * @param ${className} ${functionName}
     */
    List&lt;${ClassName}&gt; select${ClassName}List(${ClassName} ${className});

    /**
     * 新增${functionName}
     * 
     * @param ${className} ${functionName}
     */
    boolean insert${ClassName}(${ClassName} ${className});

    /**
     * 修改${functionName}
     * 
     * @param ${className} ${functionName}
     */
    boolean update${ClassName}(${ClassName} ${className});

    /**
     * 批量删除${functionName}
     * 
     * @param ${pkColumn.javaField}s 需要删除的${functionName}主键集合
     */
    boolean delete${ClassName}By${pkColumn.capJavaField}s(${pkColumn.javaType}[] ${pkColumn.javaField}s);

}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用Python在Linux上实现简单抓包工具的完整教程]]></title>    <link>https://juejin.cn/post/7596181746061295643</link>    <guid>https://juejin.cn/post/7596181746061295643</guid>    <pubDate>2026-01-17T09:42:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7596181746061295643" data-draft-id="7595847940621778994" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用Python在Linux上实现简单抓包工具的完整教程"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-17T09:42:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="开心就好2025"/> <meta itemprop="url" content="https://juejin.cn/user/3850962908492660"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用Python在Linux上实现简单抓包工具的完整教程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3850962908492660/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    开心就好2025
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T09:42:10.000Z" title="Sat Jan 17 2026 09:42:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Python抓包发包实现游戏自动化 python抓包程序</p>
<p>现代计算机程序大部分时候离不开网络，作为开发者，在日常开发网络相关的程序或者排查程序错误时经常会用抓包工具来分析网卡收发的数据，比如著名的tcpdump，Wireshark等。对于需要全平台支持且无需代理或越狱的抓包需求，Sniffmaster是一个强大的选择，它支持HTTPS、TCP和UDP协议，并在iOS、Android、Mac和Windows设备上提供暴力抓包和代理抓包功能。</p>
<p>今天我们尝试用100行左右的Python代码在Linux系统上实现一个简单的抓包工具。</p>
<p>本文共分为四节，前三节分别介绍了三个基本概念，包括端序、socket、以太网帧结构，最后一节介绍具体实现，文末有完整代码。</p>
<ol>
<li>端序</li>
</ol>
<p>试想一个16进制数0x12345678，大端序在内存中的储存顺序如下，高字节保存在内存的低地址，高字节在前：</p>
<p>内存地址 0 1 2 3</p>
<p>---------------------</p>
<p>字节数据 | 12 | 34 | 56 | 78 |</p>
<p>---------------------</p>
<p>而小端序高字节保存在内存的高地址，低字节在前：</p>
<p>内存地址 0 1 2 3</p>
<p>---------------------</p>
<p>字节数据 | 78 | 56 | 34 | 12 |</p>
<p>---------------------</p>
<p>大端序还是小端序是由硬件决定的，通常CPU和内存中的数据都是小端序，而网络传输都用大端序，因为大端序字节流解析起来更方便，但有些特殊的设备是例外。</p>
<p>Python中socket模块的htons，ntohs，htonl，ntohl函数用来处理网络字节顺序与本地字节顺序之间的转换。函数名中h表示host，n表示net，s表示short int（2字节），l表示long int（4字节），比如htons是将2字节长的整数从本地端序转换为网络端序。比如：</p>
<p>import socket</p>
<p>i = 0x1234 # 本地小端序</p>
<p>net_i = socket.htons(i) # 网络大端序</p>
<p>print(hex(i), hex(net_i))</p>
<p># 输出 0x1234 0x3412</p>
<ol start="2">
<li>socket编程</li>
</ol>
<p>socket是操作系统用户与TCP/IP协议族通信的接口，创建一个socket需要3个参数，地址簇，socket类型，协议。比如可以用以下代码创建一个常用的TCP套接字，用来收发TCP数据流：</p>
<p>import socket</p>
<p># AF_INET: internet协议簇</p>
<p># SOCK_STREAM: stream类型的socket</p>
<p># 0: 使用该socket类型的默认协议，即TCP协议</p>
<p>sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM, 0)</p>
<p>也可以用以下代码创建一个UDP套接字，用来收发UDP数据包：</p>
<p># SOCK_STREAM: data gram类型的socket</p>
<p># 0: 使用该socket类型的默认协议，即UDP协议</p>
<p>sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM, 0)</p>
<p>但是我们今天要用的不是这类套接字，而是更底层的原始套接字raw socket，这类套接字可以操作更底的协议比如IP协议和以太网协议，创建raw socket需要root权限。可以用以下代码创建一个接收以太网数据包的原始套接字：</p>
<p>ETH_P_ALL = 0x3</p>
<p>ETH_P_IP = 0x0800</p>
<p>ETH_P_ARP = 0x0806</p>
<p>ETH_P_RARP = 0x8035</p>
<p>ETH_P_IPV6 = 0x086dd</p>
<p>raw_sock = socket.socket(socket.AF_PACKET, socket.SOCK_RAW, socket.htons(ETH_P_ALL))</p>
<p>其中ETH_P_ALL表示监听所有协议的以太网数据包，如果改用ETH_P_IP则只会监听IP协议的数据包。（由于Windows系统上没有定义AF_PACKET，所以这段代码无法在Windows系统上运行）</p>
<p>然后可以开始监听：</p>
<p>while True:</p>
<p>packet, packet_info = raw_sock.recvfrom(1500)</p>
<p>print(packet)</p>
<p>recvfrom函数返回2个值，第一个是以太网数据包，第二个是该数据包相关的信息。</p>
<ol start="3">
<li>以太网帧格式</li>
</ol>
<p>以太网帧根据不同的标准有多种格式，常见的有Ethernet II格式和Ethernet 802.3格式。</p>
<p>Ethernet II帧格式DMAC：6字节，目标MAC地址</p>
<p>SMAC：6字节，源MAC地址</p>
<p>Type：2字节，上层协议类型</p>
<p>Data：46～1500字节可变长度，载荷数据</p>
<p>FCS：最后4字节，帧校验</p>
<p>Ethernet 802.3帧格式DMAC：6字节，目标MAC地址</p>
<p>SMAC：6字节，源MAC地址</p>
<p>Length：2字节，Data字段包含的字节数</p>
<p>LLC：3字节，逻辑链路控制</p>
<p>SNAP：5字节，Sub-network Access Protocol</p>
<p>Data：38～1492字节可变长度，载荷数据</p>
<p>FCS：最后4字节，帧校验</p>
<p>可以看到Ethernet II和Ethernet802.3格式的前12字节结构相同，由于Ethernet 802.3的头部多了8字节，所以载荷数据长度最大只能为1492字节。另外需要注意，原始套接字读取到的包最后不包含帧校验。</p>
<ol start="4">
<li>解析以太网头部</li>
</ol>
<p>在我们了解了以太网帧格式后就可以开始解析接收到的二进制数据了，我们可以用以下代码把MAC地址转换成整数：</p>
<p>BIG_ENDIAN = 'big'</p>
<p>dst_mac = int.from_bytes(packet[:6], BIG_ENDIAN)</p>
<p>src_mac = int.from_bytes(packet[6:12], BIG_ENDIAN)</p>
<p>从第12、13字节用来区分接收到的是Ethernet II帧还是Ethernet 802.3帧，如果该数字小于等于1500（0x05DC）可以判断接收到的是Ethernet 802.3帧，如果该数字大于等于1536（0x0600）则接收到的是Ethernet II帧。其他字段按照帧格式依次解析即可。</p>
<p>完整代码如下：</p>
<p>import socket</p>
<p>BIG_ENDIAN = 'big'</p>
<p>LITTLE_ENDIAN = 'little'</p>
<p>ETH_P_ALL = 0x3</p>
<p>ETH_P_IP = 0x0800</p>
<p>ETH_P_ARP = 0x0806</p>
<p>ETH_P_RARP = 0x8035</p>
<p>ETH_P_IPV6 = 0x086dd</p>
<p>ETH_TYPE_MAP = {</p>
<p>ETH_P_IP: 'IP',</p>
<p>ETH_P_ARP: 'ARP',</p>
<p>ETH_P_RARP: 'RARP',</p>
<p>ETH_P_IPV6: 'IPv6'</p>
<p>}</p>
<p>class MACAddress:</p>
<p>def __init__(self, addr: int):</p>
<p>self.addr = addr</p>
<p>def __str__(self):</p>
<p>return ':'.join('{:02x}'.format(a) for a in self.addr.to_bytes(6, BIG_ENDIAN))</p>
<p>def __repr__(self):</p>
<p>return self.__str__()</p>
<p>class EthernetHeader:</p>
<p>def __init__(self, dst_mac, src_mac):</p>
<p>self.dst_mac = dst_mac</p>
<p>self.src_mac = src_mac</p>
<p>def describe(self):</p>
<p>return {</p>
<p>'src_mac': MACAddress(self.src_mac),</p>
<p>'dst_mac': MACAddress(self.dst_mac)</p>
<p>}</p>
<p>class EthernetIIHeader(EthernetHeader):</p>
<p>def __init__(self, dst_mac, src_mac):</p>
<p>super().__init__(dst_mac, src_mac)</p>
<p>self.eth_type = 0</p>
<p>def describe(self):</p>
<p>dct = super().describe()</p>
<p>dct['eth_type'] = self._describe_eth_type(self.eth_type)</p>
<p>return dct</p>
<p>@staticmethod</p>
<p>def _describe_eth_type(eth_type):</p>
<p>if eth_type in ETH_TYPE_MAP:</p>
<p>return ETH_TYPE_MAP[eth_type]</p>
<p>return 'Unknown protocol{}'.format(eth_type)</p>
<p>class Ethernet802_3Header(EthernetHeader):</p>
<p>def __init__(self, dst_mac, src_mac):</p>
<p>super().__init__(dst_mac, src_mac)</p>
<p>self.length = 0</p>
<p>self.llc = 0</p>
<p>self.snap = 0</p>
<p>def describe(self):</p>
<p>dct = super().describe()</p>
<p>dct['length'] = self.length</p>
<p>dct['llc'] = self.llc</p>
<p>dct['snap'] = self.snap</p>
<p>return dct</p>
<p>def unpack(packet):</p>
<p>dst_mac = int.from_bytes(packet[:6], BIG_ENDIAN)</p>
<p>src_mac = int.from_bytes(packet[6:12], BIG_ENDIAN)</p>
<p>type_or_length = int.from_bytes(packet[12:14], BIG_ENDIAN)</p>
<p>if type_or_length &lt; 1500:</p>
<p>hdr = Ethernet802_3Header(dst_mac, src_mac)</p>
<p>hdr.length = type_or_length</p>
<p>hdr.llc = int.from_bytes(packet[14:17], BIG_ENDIAN)</p>
<p>hdr.snap = int.from_bytes(packet[17:22], BIG_ENDIAN)</p>
<p>return hdr, packet[22:]</p>
<p>elif type_or_length &gt;= 1536:</p>
<p>hdr = EthernetIIHeader(dst_mac, src_mac)</p>
<p>hdr.eth_type = type_or_length</p>
<p>return hdr, packet[14:]</p>
<p>else:</p>
<p>raise ValueError(type_or_length)</p>
<p>def main():</p>
<p>raw_sock = socket.socket(socket.PF_PACKET, socket.SOCK_RAW, socket.htons(ETH_P_ALL))</p>
<p>while True:</p>
<p>try:</p>
<p>packet, packet_info = raw_sock.recvfrom(1500)</p>
<p>eth_header, payload = unpack(packet)</p>
<p>print(eth_header.describe(), payload)</p>
<p>except KeyboardInterrupt:</p>
<p>break</p>
<p>except ValueError as e:</p>
<p>print('unpack failed', e)</p>
<p>if __name__ == '__main__':</p>
<p>main()</p>
<p>最后，用root权限运行抓包程序，可以看到屏幕上输出了解析后的Ethernet头部和未解析的载荷数据，如果有兴趣的话可以按照协议标准继续解析载荷数据中的上层协议。对于更复杂的抓包场景，如HTTPS解密或跨平台支持，工具如Sniffmaster提供了额外功能，包括数据流暴力抓包和代理抓包，无需越狱或root即可使用。</p>
<p>{'src_mac': 50:fa:84:aa:aa:aa, 'dst_mac': ac:d1:b8:aa:aa:aa, 'eth_type': 'IP'} b'E\x00\x00T\x0c\xfe@\x004\x01\x93*\xb4e1\x0c\xc0\xa8\x00g\x00\x00\xb6\x83-\x8e\x00\x07\xa6\xb4c^\x00\x00\x00\x00G\x01\x0c\x00\x00\x00\x00\x00\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f !"#$%&amp;\'()*+,-./01234567'</p>
<p>...</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[别只把 JSON 当字符串：PostgreSQL 用 JSONB 把“半结构化数据”查快了]]></title>    <link>https://juejin.cn/post/7595864836359995444</link>    <guid>https://juejin.cn/post/7595864836359995444</guid>    <pubDate>2026-01-17T07:23:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595864836359995444" data-draft-id="7595871887000862720" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="别只把 JSON 当字符串：PostgreSQL 用 JSONB 把“半结构化数据”查快了"/> <meta itemprop="keywords" content="数据库,PostgreSQL,DBA"/> <meta itemprop="datePublished" content="2026-01-17T07:23:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="技术不打烊"/> <meta itemprop="url" content="https://juejin.cn/user/893244690677165"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            别只把 JSON 当字符串：PostgreSQL 用 JSONB 把“半结构化数据”查快了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/893244690677165/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    技术不打烊
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T07:23:47.000Z" title="Sat Jan 17 2026 07:23:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b0883a71e83649d6a854be714f8a1745~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv5LiN5omT54OK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769239427&amp;x-signature=Uxi7L5Lkc0g7E6ZOsyVbT2OOWfk%3D" alt="1.png" loading="lazy"/>
一睁眼，隔壁大厂的DBA因为频繁改表结构和产品经理“打起来”了！
数据不会撒谎：传统研发中，<strong>高达50%的时间</strong>浪费在字段对齐、清洗和Schema迁移的无尽扯皮中。
难怪PostgreSQL社区大佬都吐槽：“Trying to fit dynamic data into rigid columns is a fool's errand.”（试图把动态数据塞进僵化列简直是自找苦吃）。</p>
<hr/>
<h2 data-id="heading-0">字段大爆炸：是技术债还是业务刚需？</h2>
<p>电商大促，运营突然要加个“鞋底材质”属性；做埋点分析，前端版本一更新，Event里的字段又变了。
这种**“半结构化数据”**的噩梦，相信每个做业务系统的兄弟都经历过。
传统的做法？要么疯狂加列（Alter Table到头秃），要么把一坨JSON直接当字符串扔进 <code>TEXT</code> 字段里。</p>
<p>结果呢？
存的时候是爽了，查的时候<strong>全表扫描</strong>，CPU直接飙到100%。你以为你在做架构，其实是在给数据库埋雷。
这时候，PostgreSQL 的 <strong>JSONB</strong> 简直就是救命稻草——它不是简单的“能存JSON”，而是把半结构化数据的<strong>存储、索引、查询</strong>变成了一套可落地的工程化能力。</p>
<blockquote>
<p><strong>灵魂拷问：</strong> 你现在的 JSON 数据是仅仅“活着”，还是在“裸奔”？</p>
</blockquote>
<hr/>
<h2 data-id="heading-1">JSON vs JSONB：选型一句话讲明白</h2>
<p>别被这俩名字绕晕了，区别就在怎么“存”。
<strong>JSON</strong> 类型就是纯文本，你怎么存它怎么放，每次读都要重新解析，就像一个封死的纸箱子。
<strong>JSONB</strong> 则是二进制存储（Binary），入库时虽然慢点（因为要预处理），但存好后自带目录，查起来飞快，就像透明的收纳盒 。</p>
<p><strong>来看一组彭博社级别的硬核测试：</strong>
同样插入大量数据，JSON可能只花13秒，而JSONB要花20秒（因为要解析和去重键值）。
<strong>但真正的质变在查询：</strong>
当你要检索某个Key时，JSONB配合索引仅需 <strong>8ms</strong>，而普通JSON可能要跑 <strong>27ms</strong> 甚至更久 。</p>
<p><strong>记这个口诀：</strong></p>
<ul>
<li><strong>只存不查</strong>（做日志存档、原样展示）：选 <strong>JSON</strong>。</li>
<li><strong>要查要筛</strong>（做搜索、过滤、关联）：无脑选 <strong>JSONB</strong>。</li>
</ul>
<hr/>
<h2 data-id="heading-2">黄金模板：把“灵活”和“规矩”同时拿到</h2>
<p>很多团队用不好JSONB，是因为走向了极端：要么不用，要么全用。
<strong>最聪明的做法是“混搭”</strong>：核心字段守规矩，长尾字段放飞自我。</p>
<p>给你们一张价值百万的**“通用事件表”**设计模板：</p>






























<table><thead><tr><th align="left">字段名</th><th align="left">类型</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left"><strong>id</strong></td><td align="left">BigInt</td><td align="left"><strong>主键</strong>（雷打不动）</td></tr><tr><td align="left"><strong>created_at</strong></td><td align="left">Timestamp</td><td align="left"><strong>核心时间</strong>（索引刚需）</td></tr><tr><td align="left"><strong>tenant_id</strong></td><td align="left">Int</td><td align="left"><strong>租户隔离</strong>（强约束）</td></tr><tr><td align="left"><strong>payload</strong></td><td align="left"><strong>JSONB</strong></td><td align="left"><strong>变化字段</strong>（甚至可以塞版本号 <code>schema_ver</code>）</td></tr></tbody></table>
<blockquote>
<p><strong>设计哲学：</strong> 哪怕业务再变，<code>payload</code> 里的字段随便加，但外层的 <code>id</code> 和 <code>time</code> 永远保证你的查询底盘不崩 。</p>
</blockquote>
<hr/>
<h2 data-id="heading-3">极速查询三件套：写法+索引+解释计划</h2>
<p>把数据存进去只是第一步，怎么查得快才是老司机的功力。</p>
<p><strong>1. 更是“黑话”的查询符</strong>
别再用 <code>LIKE</code> 模糊匹配了！PostgreSQL 提供了专用的神兵利器：</p>
<ul>
<li><strong>取值</strong>：<code>payload -&gt;&gt; 'user_id'</code>（直接拿文本）</li>
<li><strong>包含</strong>：<code>payload @&gt; '{"region": "CN"}'</code>（最强匹配，包含即命中）</li>
<li><strong>存在</strong>：<code>payload ? 'vip_level'</code>（判断Key在不在）</li>
</ul>
<p><strong>2. 索引核武器：GIN</strong>
普通的 B-Tree 索引对 JSON 内部字段束手无策，这时候必须上 <strong>GIN (Generalized Inverted Index)</strong>。
这就好比给一本书的每一页都做了关键词索引。
<strong>写法很简单：</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> INDEX idx_payload <span class="hljs-keyword">ON</span> events <span class="hljs-keyword">USING</span> GIN (payload);
</code></pre>
<p>一旦加上这个，千万级数据的查询也能瞬间从 <strong>秒级</strong> 掉到 <strong>毫秒级</strong> 。</p>
<p><strong>3. 必做动作：EXPLAIN</strong>
上线前，一定要用 <code>EXPLAIN ANALYZE</code> 跑一下。如果看到 <code>Seq Scan</code>（全表扫描），请立刻去面壁反省，检查你的 GIN 索引是不是漏了或者操作符用错了 。</p>
<hr/>
<h2 data-id="heading-4">拒绝垃圾场：别让JSONB成“信息孤岛”</h2>
<p>“能力越大，责任越大。”
JSONB 的灵活性如果不加约束，三个月后你的数据库就会变成垃圾场：没人知道 <code>attr1</code> 到底存的是 "100" 还是 100。</p>
<p><strong>落地治理三板斧：</strong></p>
<ol>
<li><strong>更新要克制</strong>：尽量用 <code>jsonb_set</code> 做局部更新，别把整个对象覆盖了，防止并发冲突。</li>
<li><strong>字典要维护</strong>：团队内部必须维护一份 <code>payload</code> 字段字典（Excel或飞书文档），标明 <code>payload.vip_level</code> 是啥意思，由谁负责。</li>
<li><strong>版本要控制</strong>：在 JSON 根节点加一个 <code>version: "v1"</code>，方便后续清洗数据时做兼容 。</li>
</ol>
<hr/>
<h2 data-id="heading-5">结尾：最好的重构时机是现在</h2>
<p>JSONB 的价值不在于“随便存”，而在于**“灵活存，但依然可索引、可治理”**。
不管你是做电商商品中心，还是复杂的SaaS配置系统，只要涉及高频查询的半结构化数据，请把工程资源投到 <strong>JSONB + GIN</strong> 上 。</p>
<p><strong>给所有技术人的行动清单：</strong></p>
<ol>
<li>挑一张字段变化最频繁的表（比如 UserProfile 或 OrderExtra）。</li>
<li>把长尾字段迁移到 JSONB，并加上 GIN 索引。</li>
<li>跑一下 <code>EXPLAIN</code>，享受查询速度提升 100 倍的快感。</li>
</ol>
<p><strong>最后问一句：</strong>
你们公司的业务表里，哪一张最让你头大？评论区晒出你的“慢查询”SQL，下期我们专门聊聊怎么优化它！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[WebSocket在SpringBoot中的实现：原理与案例]]></title>    <link>https://juejin.cn/post/7595808703074369562</link>    <guid>https://juejin.cn/post/7595808703074369562</guid>    <pubDate>2026-01-17T07:33:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595808703074369562" data-draft-id="7595847940621500466" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="WebSocket在SpringBoot中的实现：原理与案例"/> <meta itemprop="keywords" content="后端,Java,程序员"/> <meta itemprop="datePublished" content="2026-01-17T07:33:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Olaf_n"/> <meta itemprop="url" content="https://juejin.cn/user/1324234125087575"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            WebSocket在SpringBoot中的实现：原理与案例
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1324234125087575/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Olaf_n
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T07:33:55.000Z" title="Sat Jan 17 2026 07:33:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">什么是websocket？</h2>
<p>WebSocket 是一种全双工的一种网络通信协议，这种协议可以支持主动向客户端推送消息，客户端也可以主动向服务器发送信息，属于服务器推送技术的一种
WebSocket协议是建立在TCP协议之上的，同时WebSocket协议和HTTP协议兼容性比较好默认端口80和443，在握手阶段采用的是Http协议。
WebSocket的数据格式比较轻量，开销也比较小，可以发送文本也可以发送二进制的数据（blob对象或ArraryBuffer对象）
没有同源策略的限制，协议的标识符是ws，如果是加密后的协议标识符则是wss</p>
<h2 data-id="heading-1">为什么要有websocket？</h2>
<p><strong>实时通信</strong>：传统的 HTTP 是请求-响应模型，每次客户端想获取数据时，都必须发起请求并等待服务器响应。而 WebSocket 协议在建立连接后，客户端和服务器可以互相发送数据，适合实时聊天、股票行情、在线游戏等应用场景。</p>
<p><strong>减少延迟</strong>：由于 WebSocket 连接是持久的，数据可以在连接建立后即时双向传输，无需每次请求时重新建立连接，降低了通信的延迟。</p>
<p><strong>减少网络开销</strong>：WebSocket 连接在建立后，不需要每次都发送 HTTP 请求的头部信息，这比传统的 HTTP 请求更加节省带宽和资源</p>
<h2 data-id="heading-2">为什么使用WebSocket？</h2>
<p>Http是你问我答，服务器不能主动找到客户端，http的流程是 ，客户端发起请求 -&gt; 服务器响应 -&gt; 断开连接；服务器不可以主动的推送消息给客户端。如果你想知道有没有新的消息就只能进行轮询或者长轮询；这两种方式再比较简单的的场景下完全可以使用，而且这两种方式实现起来也是比较简单。但如果是网页游戏呢，游戏一般会有大量的数据需要从服务器主动推送到客户端，也就是高频访问的场景下，这种轮询的实现成本就极高了，这时就需要用的websocket了。
websocket可以主动往客户端推送消息，不需要客户端来询问，而且websocket建立连接以后是可以长期使用的，避免频繁的建立连接销毁连接，节省网络资源上的开销。</p>
<h2 data-id="heading-3">什么时候用Websocket？</h2>
<p>服务器要主动通知客户端例如：IM聊天、好友申请/红点提醒
消息发送的频率非常高：实时日志、页游、实时监控面板
在线状态 / 会话存在感很重要 ： 在线用户列表 ， 是否在线等场景</p>
<h2 data-id="heading-4">Websocket的连接是如何建立？</h2>
<p>平时我们刷网页这个时候我们用的是Http协议，访问页游的时候http协议就得切换成Websocket。
为了要兼容这些场景，浏览器再TCP三次握手以后建立连接以后，都统一使用http协议先进行一次通信，如果这个时候是普通的http请求那就继续用http请求，如果这时想要建立Websocket连接，就会再http的请求头上加上一些特殊的header头</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">Connection: Upgrade</span>
<span class="hljs-section">Upgrade: WebSocket</span>
<span class="hljs-section">Sec-WebSocket-Key: T2a6wZ1AwhgQNqruZ2YUyg==</span>
</code></pre>
<p>Connection: Upgrade 是浏览器想要升级协议</p>
<p>Upgrade: WebSocket 表示想要升级的协议类型，证明浏览器想要升级成WebSocket</p>
<p>Sec-WebSocket-Key 一段随机Base64码</p>
<p>如果服务器支持升级成WebSocket协议的话，就会走WebSocket的握手流程，同时根据客户端生成的Base64码，用某个公开的算法变成另外一段字符串，放在Http的响应头里面，同时状态携带上101状态码，发回给浏览器</p>
<pre><code class="hljs language-makefile" lang="makefile">HTTP/1.1 101 Switching Protocols
<span class="hljs-section">Sec-WebSocket-Accept: iBJkv/ALIW2DobfoA4dmr3JHBCY=</span>
<span class="hljs-section">Upgrade: WebSocket</span>
<span class="hljs-section">Connection: Upgrade</span>
</code></pre>
<p>服务器端 base64 -》 某个函数/算法 -》服务器新字符串。</p>
<p>之后客户端也会把 base64 -》 某个函数/算法 -》客户端新字符串。</p>
<p>若是服务器新字符串和客户端新字符串相等，证明连接已经完成了，后续就可以使用websocket的数据格式来进行通信了。</p>
<h2 data-id="heading-5">后端实现WebSocket</h2>
<h3 data-id="heading-6">新建立websocket服务</h3>
<h4 data-id="heading-7">pom 依赖包</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-websocket<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>cn.hutool<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hutool-all<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.8.24<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<h4 data-id="heading-8">yml配置</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment">#服务器配置</span>
<span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">8081</span>
  <span class="hljs-attr">servlet:</span>
    <span class="hljs-attr">context-path:</span> <span class="hljs-string">/api</span>
</code></pre>
<h4 data-id="heading-9">websocket配置类</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebsocketConfig</span> {
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> ServerEndpointExporter <span class="hljs-title function_">serverEndpointExporter</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServerEndpointExporter</span>();
    }
}
</code></pre>
<p>WebSocket注册点</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@ServerEndpoint(value = "/websocket/{userId}")</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebSocket</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ConcurrentHashMap&lt;String, WebSocket&gt; webSocketMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();
    <span class="hljs-comment">//实例一个session，这个session是websocket的session</span>
    <span class="hljs-keyword">private</span> Session session;

    <span class="hljs-comment">//新增一个方法用于主动向客户端发送消息</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendMessage</span><span class="hljs-params">(Object message, String userId)</span> {
        <span class="hljs-type">WebSocket</span> <span class="hljs-variable">webSocket</span> <span class="hljs-operator">=</span> webSocketMap.get(userId);
        <span class="hljs-keyword">if</span> (webSocket != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">try</span> {
                webSocket.session.getBasicRemote().sendText(JSONUtil.toJsonStr(message));
                System.out.println(<span class="hljs-string">"【websocket消息】发送消息成功,用户="</span>+userId+<span class="hljs-string">",消息内容"</span>+message.toString());
            } <span class="hljs-keyword">catch</span> (IOException e) {
                e.printStackTrace();
            }
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ConcurrentHashMap&lt;String, WebSocket&gt; <span class="hljs-title function_">getWebSocketMap</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> webSocketMap;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setWebSocketMap</span><span class="hljs-params">(ConcurrentHashMap&lt;String, WebSocket&gt; webSocketMap)</span> {
        WebSocket.webSocketMap = webSocketMap;
    }

    <span class="hljs-comment">//前端请求时一个websocket时</span>
    <span class="hljs-meta">@OnOpen</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onOpen</span><span class="hljs-params">(Session session, <span class="hljs-meta">@PathParam("userId")</span> String userId)</span> {
        <span class="hljs-built_in">this</span>.session = session;
        webSocketMap.put(userId, <span class="hljs-built_in">this</span>);
        sendMessage(<span class="hljs-string">"CONNECT_SUCCESS"</span>, userId);
        System.out.println(<span class="hljs-string">"【websocket消息】有新的连接,连接id"</span>+userId);
    }

    <span class="hljs-comment">//前端关闭时一个websocket时</span>
    <span class="hljs-meta">@OnClose</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClose</span><span class="hljs-params">(<span class="hljs-meta">@PathParam("userId")</span> String userId)</span> {
        webSocketMap.remove(userId);
        System.out.println(<span class="hljs-string">"【websocket消息】连接断开,总数:"</span>+ webSocketMap.size());
    }

    <span class="hljs-comment">//前端向后端发送消息</span>
    <span class="hljs-meta">@OnMessage</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onMessage</span><span class="hljs-params">(String message)</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-keyword">if</span> (!message.equals(<span class="hljs-string">"ping"</span>)) {
            System.out.println(<span class="hljs-string">"【websocket消息】收到客户端发来的消息:"</span>+message);
            session.getBasicRemote().sendText(<span class="hljs-string">"收到客户端发来的消息了,消息内容为:"</span>+message);
        }
    }
}
</code></pre>
<p>@ServerEndpoint 声明一个Websocket的服务点</p>
<p>@OnOpen 前端连接到后台的WebSocket</p>
<p>@OnClose 前端关闭一个连接</p>
<p>@OnMessage 前端向后端发送消息</p>
<h4 data-id="heading-10">启动类</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebSocketMain</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        SpringApplication.run(WebSocketMain.class, args);
    }
}
</code></pre>
<h4 data-id="heading-11">前端测试页面代码</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"utf-8"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"IE=edge"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>本地websocket测试<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"robots"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"all"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"keywords"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"本地,websocket,测试工具"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"description"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"本地,websocket,测试工具"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
      <span class="hljs-selector-class">.btn-group</span>{
        <span class="hljs-attribute">display</span>: inline-block;
      }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">'text'</span> <span class="hljs-attr">value</span>=<span class="hljs-string">'通信地址, ws://开头..'</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">'width:390px;display:inline'</span>
      <span class="hljs-attr">id</span>=<span class="hljs-string">'wsaddr'</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn-group"</span> &gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-default"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">'addsocket();'</span>&gt;</span>连接<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-default"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">'closesocket();'</span>&gt;</span>断开<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-default"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">'$("#wsaddr").val("")'</span>&gt;</span>清空<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"row"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"output"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border:1px solid #ccc;height:365px;overflow: auto;margin: 20px 0;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">'message'</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">'width:810px'</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"待发信息"</span> <span class="hljs-attr">onkeydown</span>=<span class="hljs-string">"en(event);"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input-group-btn"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-default"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"doSend();"</span>&gt;</span>发送<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>		

  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://code.jquery.com/jquery-3.1.1.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">language</span>=<span class="hljs-string">"javascript"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/javascript"</span>&gt;</span><span class="javascript">
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">formatDate</span>(<span class="hljs-params">now</span>) {
      <span class="hljs-keyword">var</span> year = now.<span class="hljs-title function_">getFullYear</span>();
      <span class="hljs-keyword">var</span> month = now.<span class="hljs-title function_">getMonth</span>() + <span class="hljs-number">1</span>;
      <span class="hljs-keyword">var</span> date = now.<span class="hljs-title function_">getDate</span>();
      <span class="hljs-keyword">var</span> hour = now.<span class="hljs-title function_">getHours</span>();
      <span class="hljs-keyword">var</span> minute = now.<span class="hljs-title function_">getMinutes</span>();
      <span class="hljs-keyword">var</span> second = now.<span class="hljs-title function_">getSeconds</span>();
      <span class="hljs-keyword">return</span> year + <span class="hljs-string">"-"</span> + (month = month &lt; <span class="hljs-number">10</span> ? (<span class="hljs-string">"0"</span> + month) : month) + <span class="hljs-string">"-"</span> + (date = date &lt; <span class="hljs-number">10</span> ? (<span class="hljs-string">"0"</span> + date) : date) +
        <span class="hljs-string">" "</span> + (hour = hour &lt; <span class="hljs-number">10</span> ? (<span class="hljs-string">"0"</span> + hour) : hour) + <span class="hljs-string">":"</span> + (minute = minute &lt; <span class="hljs-number">10</span> ? (<span class="hljs-string">"0"</span> + minute) : minute) + <span class="hljs-string">":"</span> + (
          second = second &lt; <span class="hljs-number">10</span> ? (<span class="hljs-string">"0"</span> + second) : second);
    }
    <span class="hljs-keyword">var</span> output;
    <span class="hljs-keyword">var</span> websocket;

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
      output = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"output"</span>);
      <span class="hljs-title function_">testWebSocket</span>();
    }

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">addsocket</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">var</span> wsaddr = $(<span class="hljs-string">"#wsaddr"</span>).<span class="hljs-title function_">val</span>();
      <span class="hljs-keyword">if</span> (wsaddr == <span class="hljs-string">''</span>) {
        <span class="hljs-title function_">alert</span>(<span class="hljs-string">"请填写websocket的地址"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
      }
      <span class="hljs-title class_">StartWebSocket</span>(wsaddr);
    }

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">closesocket</span>(<span class="hljs-params"/>) {
      websocket.<span class="hljs-title function_">close</span>();
    }

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">StartWebSocket</span>(<span class="hljs-params">wsUri</span>) {
      websocket = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocket</span>(wsUri);
      websocket.<span class="hljs-property">onopen</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) {
        <span class="hljs-title function_">onOpen</span>(evt)
      };
      websocket.<span class="hljs-property">onclose</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) {
        <span class="hljs-title function_">onClose</span>(evt)
      };
      websocket.<span class="hljs-property">onmessage</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) {
        <span class="hljs-title function_">onMessage</span>(evt)
      };
      websocket.<span class="hljs-property">onerror</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) {
        <span class="hljs-title function_">onError</span>(evt)
      };
    }

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">onOpen</span>(<span class="hljs-params">evt</span>) {
      <span class="hljs-title function_">writeToScreen</span>(<span class="hljs-string">"&lt;span style='color:red'&gt;连接成功，现在你可以发送信息啦！！！&lt;/span&gt;"</span>);
    }

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">onClose</span>(<span class="hljs-params">evt</span>) {
      <span class="hljs-title function_">writeToScreen</span>(<span class="hljs-string">"&lt;span style='color:red'&gt;websocket连接已断开!!!&lt;/span&gt;"</span>);
      websocket.<span class="hljs-title function_">close</span>();
    }

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">onMessage</span>(<span class="hljs-params">evt</span>) {
      <span class="hljs-title function_">writeToScreen</span>(<span class="hljs-string">'&lt;span style="color:blue"&gt;服务端回应&amp;nbsp;'</span> + <span class="hljs-title function_">formatDate</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()) + <span class="hljs-string">'&lt;/span&gt;&lt;br/&gt;&lt;span class="bubble"&gt;'</span> +
                    evt.<span class="hljs-property">data</span> + <span class="hljs-string">'&lt;/span&gt;'</span>);
			}
 
			<span class="hljs-keyword">function</span> <span class="hljs-title function_">onError</span>(<span class="hljs-params">evt</span>) {
				<span class="hljs-title function_">writeToScreen</span>(<span class="hljs-string">'&lt;span style="color: red;"&gt;发生错误:&lt;/span&gt; '</span> + evt.<span class="hljs-property">data</span>);
			}
 
			<span class="hljs-keyword">function</span> <span class="hljs-title function_">doSend</span>(<span class="hljs-params"/>) {
				<span class="hljs-keyword">var</span> message = $(<span class="hljs-string">"#message"</span>).<span class="hljs-title function_">val</span>();
				<span class="hljs-keyword">if</span> (message == <span class="hljs-string">''</span>) {
					<span class="hljs-title function_">alert</span>(<span class="hljs-string">"请先填写发送信息"</span>);
					$(<span class="hljs-string">"#message"</span>).<span class="hljs-title function_">focus</span>();
					<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
				}
				<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> websocket === <span class="hljs-string">"undefined"</span>) {
					<span class="hljs-title function_">alert</span>(<span class="hljs-string">"websocket还没有连接，或者连接失败，请检测"</span>);
					<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
				}
				<span class="hljs-keyword">if</span> (websocket.<span class="hljs-property">readyState</span> == <span class="hljs-number">3</span>) {
					<span class="hljs-title function_">alert</span>(<span class="hljs-string">"websocket已经关闭，请重新连接"</span>);
					<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
				}
				<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(websocket);
				$(<span class="hljs-string">"#message"</span>).<span class="hljs-title function_">val</span>(<span class="hljs-string">''</span>);
				<span class="hljs-title function_">writeToScreen</span>(<span class="hljs-string">'&lt;span style="color:green"&gt;你发送的信息&amp;nbsp;'</span> + <span class="hljs-title function_">formatDate</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()) + <span class="hljs-string">'&lt;/span&gt;&lt;br/&gt;'</span> + message);
				websocket.<span class="hljs-title function_">send</span>(message);
			}
 
			<span class="hljs-keyword">function</span> <span class="hljs-title function_">writeToScreen</span>(<span class="hljs-params">message</span>) {
				<span class="hljs-keyword">var</span> div = <span class="hljs-string">"&lt;div class='newmessage'&gt;"</span> + message + <span class="hljs-string">"&lt;/div&gt;"</span>;
				<span class="hljs-keyword">var</span> d = $(<span class="hljs-string">"#output"</span>);
				<span class="hljs-keyword">var</span> d = d[<span class="hljs-number">0</span>];
				<span class="hljs-keyword">var</span> doScroll = d.<span class="hljs-property">scrollTop</span> == d.<span class="hljs-property">scrollHeight</span> - d.<span class="hljs-property">clientHeight</span>;
				$(<span class="hljs-string">"#output"</span>).<span class="hljs-title function_">append</span>(div);
				<span class="hljs-keyword">if</span> (doScroll) {
					d.<span class="hljs-property">scrollTop</span> = d.<span class="hljs-property">scrollHeight</span> - d.<span class="hljs-property">clientHeight</span>;
				}
			}
 
 
			<span class="hljs-keyword">function</span> <span class="hljs-title function_">en</span>(<span class="hljs-params">event</span>) {
				<span class="hljs-keyword">var</span> evt = evt ? evt : (<span class="hljs-variable language_">window</span>.<span class="hljs-property">event</span> ? <span class="hljs-variable language_">window</span>.<span class="hljs-property">event</span> : <span class="hljs-literal">null</span>);
				<span class="hljs-keyword">if</span> (evt.<span class="hljs-property">keyCode</span> == <span class="hljs-number">13</span>) {
					<span class="hljs-title function_">doSend</span>()
				}
			}
		</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
 
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>前端测试网站 <a href="https://link.juejin.cn?target=http%3A%2F%2Fcoolaf.com%2Ftool%2Fchattest" target="_blank" title="http://coolaf.com/tool/chattest" ref="nofollow noopener noreferrer">在线websocket测试-在线工具-postjson</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[iOS开发APP上架全流程解析：从开发到App Store的完整指南]]></title>    <link>https://juejin.cn/post/7595868336595435539</link>    <guid>https://juejin.cn/post/7595868336595435539</guid>    <pubDate>2026-01-17T09:52:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595868336595435539" data-draft-id="7595994039108436004" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="iOS开发APP上架全流程解析：从开发到App Store的完整指南"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-17T09:52:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="开心就好2025"/> <meta itemprop="url" content="https://juejin.cn/user/3850962908492660"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            iOS开发APP上架全流程解析：从开发到App Store的完整指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3850962908492660/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    开心就好2025
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T09:52:25.000Z" title="Sat Jan 17 2026 09:52:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>iOS开发APP上架全流程解析：从开发到App Store的完整指南</p>
<p>在移动互联网时代，iOS应用开发已成为许多企业和开发者的重要业务方向。然而，许多新手开发者常常困惑于如何将自己的应用成功上架到App Store。本文将详细介绍iOS开发APP的完整上架流程，帮助您规避常见问题，提高上架成功率。</p>
<p>一、前期准备工作</p>
<ol>
<li><strong>开发者账号注册</strong></li>
</ol>
<p>首先需要注册Apple开发者账号（个人账号99美元/年，企业账号299美元/年）。这是上架App Store的前提条件，注册过程可能需要1-2个工作日完成审核。</p>
<ol start="2">
<li><strong>应用信息规划</strong></li>
</ol>
<p>确定应用的名称、图标、功能介绍、关键词等元数据，这些信息将直接影响用户在App Store中搜索到您的应用的可能性。</p>
<ol start="3">
<li><strong>开发环境搭建</strong></li>
</ol>
<p>确保使用最新版本的Xcode开发工具，并熟悉iOS开发相关规范和要求。</p>
<p>二、开发阶段注意事项</p>
<ol>
<li><strong>遵循苹果设计指南</strong></li>
</ol>
<p>严格按照《Human Interface Guidelines》进行UI设计，避免因界面问题被拒。</p>
<ol start="2">
<li><strong>功能完整性检查</strong></li>
</ol>
<p>确保应用没有明显bug，所有功能都能正常运行，特别是支付、登录等核心功能。</p>
<ol start="3">
<li><strong>隐私政策准备</strong></li>
</ol>
<p>所有收集用户数据的应用都必须提供隐私政策链接，这是苹果审核的重点项目。</p>
<p>三、上架前测试与优化</p>
<ol>
<li><strong>TestFlight测试</strong></li>
</ol>
<p>通过TestFlight进行内部测试和外部测试，收集用户反馈并修复问题。</p>
<ol start="2">
<li><strong>性能优化</strong></li>
</ol>
<p>关注应用启动时间、内存占用等性能指标，避免因性能问题被拒。</p>
<ol start="3">
<li><strong>截图与预览视频</strong></li>
</ol>
<p>准备高质量的App Store展示素材，这是吸引用户下载的重要因素。</p>
<p>四、正式上架流程</p>
<ol>
<li><strong>创建App Store Connect记录</strong></li>
</ol>
<p>在开发者后台创建新应用，填写完整元数据。</p>
<ol start="2">
<li><strong>构建版本上传</strong></li>
</ol>
<p>通过Xcode或Application Loader上传构建版本。此外，开发者可以使用AppUploader工具在Windows、Linux或Mac系统中上传IPA文件到App Store，无需Mac电脑，同时支持iOS证书申请和描述文件管理，简化上架流程。</p>
<ol start="3">
<li><strong>提交审核</strong></li>
</ol>
<p>填写审核问卷，说明应用功能、使用场景等关键信息。</p>
<ol start="4">
<li><strong>等待审核</strong></li>
</ol>
<p>通常需要1-3个工作日，高峰期可能延长。</p>
<p>五、常见被拒原因及解决方案</p>
<ol>
<li><strong>功能不完整</strong></li>
</ol>
<p>确保演示账号可用，所有功能都可测试。</p>
<ol start="2">
<li><strong>设计不符合规范</strong></li>
</ol>
<p>遵循苹果设计指南，避免使用类似系统图标等元素。</p>
<ol start="3">
<li><strong>隐私政策问题</strong></li>
</ol>
<p>明确说明数据收集范围和使用方式。</p>
<ol start="4">
<li><strong>支付问题</strong></li>
</ol>
<p>虚拟商品必须使用IAP支付，实物商品可使用第三方支付。</p>
<p>六、上架后维护</p>
<ol>
<li><strong>及时更新版本</strong></li>
</ol>
<p>根据用户反馈和市场需求定期更新应用。</p>
<ol start="2">
<li><strong>监控审核状态</strong></li>
</ol>
<p>关注可能的审核延迟或被拒情况。</p>
<ol start="3">
<li><strong>优化应用商店排名</strong></li>
</ol>
<p>通过ASO优化提升应用在搜索结果中的排名。</p>
<p>iOS应用上架是一个系统工程，需要开发者具备技术能力、设计思维和市场意识。对于没有经验的开发者或企业来说，整个流程可能会遇到各种意想不到的挑战。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用企业微信的消息推送来发送告警]]></title>    <link>https://juejin.cn/post/7595831738234486793</link>    <guid>https://juejin.cn/post/7595831738234486793</guid>    <pubDate>2026-01-17T07:49:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595831738234486793" data-draft-id="7595831738234470409" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用企业微信的消息推送来发送告警"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-17T07:49:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="何达维"/> <meta itemprop="url" content="https://juejin.cn/user/4206083706979930"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用企业微信的消息推送来发送告警
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4206083706979930/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    何达维
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-17T07:49:28.000Z" title="Sat Jan 17 2026 07:49:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">使用企业微信的消息推送来发送告警</h2>
<p>实现 Prometheus 的 Alertmanager 与企业微信集成，让 Prometheus 触发的告警能够自动推送到企业微信的群聊/机器人中。</p>
<p>先创建企业微信机器人，复制机器人的 Webhook URL（格式类似：<code>https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=xxxx-xxxx-xxxxx-xxxx-xxxx</code>），把机器人拉入群聊。</p>
<p>假设企业微信的消息推送 webhook 是 <code>https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=xxxx-xxxx-xxxxx-xxxx-xxxx</code>，对该地址发起 HTTP POST 请求，即可实现给该群组发送消息：</p>
<pre><code class="hljs language-bash" lang="bash">
curl <span class="hljs-string">'https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=xxxx-xxxx-xxxxx-xxxx-xxxx'</span> \

   -H <span class="hljs-string">'Content-Type: application/json'</span> \

   -d <span class="hljs-string">'

   {

      "msgtype": "text",

      "text": {

          "content": "hello world"

      }

   }'</span>

</code></pre>
<ul>
<li><code>msgtype</code>：必须字段，中转端点必须生成该字段以适配，否则无法推送，常用的两种类型：</li>
</ul>
<p>  - <code>text</code>：文本类型。</p>
<pre><code class="hljs language-json" lang="json">
<span class="hljs-punctuation">{</span>

    <span class="hljs-attr">"msgtype"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"text"</span><span class="hljs-punctuation">,</span>

    <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>

        <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"广州今日天气：29度，大部分多云，降雨概率：60%"</span><span class="hljs-punctuation">,</span>

    <span class="hljs-attr">"mentioned_list"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-string">"wangqing"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"@all"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>

    <span class="hljs-attr">"mentioned_mobile_list"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-string">"13800001111"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"@all"</span><span class="hljs-punctuation">]</span>

    <span class="hljs-punctuation">}</span>

<span class="hljs-punctuation">}</span>

</code></pre>
<p>  - <code>markdown</code>：markdown 类型。</p>
<pre><code class="hljs language-json" lang="json">
<span class="hljs-punctuation">{</span>

    <span class="hljs-attr">"msgtype"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"markdown"</span><span class="hljs-punctuation">,</span>

    <span class="hljs-attr">"markdown"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>

        <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"实时新增用户反馈&lt;font color=\"warning\"&gt;132例&lt;/font&gt;，请相关同事注意。\n&gt;类型:&lt;font color=\"comment\"&gt;用户反馈&lt;/font&gt;\n&gt;普通用户反馈:&lt;font color=\"comment\"&gt;117例&lt;/font&gt;\n&gt;VIP用户反馈:&lt;font color=\"comment\"&gt;15例&lt;/font&gt;"</span>

    <span class="hljs-punctuation">}</span>

<span class="hljs-punctuation">}</span>

</code></pre>
<p>先手动测试 <code>markdown</code> 类型的消息，看企业微信是否能正常收到消息：</p>
<pre><code class="hljs language-bash" lang="bash">
curl <span class="hljs-string">'https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=xxxx-xxxx-xxxx'</span> \

  -H <span class="hljs-string">'Content-Type: application/json'</span> \

  -d <span class="hljs-string">'{

    "msgtype": "markdown",

    "markdown": {

      "content": "### 测试告警\n&gt; 这是一条测试消息"

    }

  }'</span>

</code></pre>
<p>为什么要用 webhook 中转？目的是让 Alertmanager 模板渲染后的结果严格匹配企业微信机器人要求的消息结构，要确保：</p>
<ul>
<li>
<p>企业微信机器人只接收特定格式的 JSON 数据，上面的 <code>markdown</code> 类型是告警场景最常用的（支持排版、高亮），渲染后的 JSON 格式要符合企业微信的规范。</p>
</li>
<li>
<p><code>content</code> 字段要符合企业微信 <code>markdown</code> 的语法，要处理好一些特殊字符。</p>
</li>
</ul>
<p>Alertmanager 以 JSON 格式向配置的 webhook 端点发送 HTTP POST 请求，固定格式：</p>
<pre><code class="hljs language-json" lang="json">
<span class="hljs-punctuation">{</span>

  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"4"</span><span class="hljs-punctuation">,</span>

  <span class="hljs-attr">"groupKey"</span><span class="hljs-punctuation">:</span> &lt;string&gt;<span class="hljs-punctuation">,</span>              <span class="hljs-comment">// key identifying the group of alerts (e.g. to deduplicate)</span>

  <span class="hljs-attr">"truncatedAlerts"</span><span class="hljs-punctuation">:</span> &lt;int&gt;<span class="hljs-punctuation">,</span>          <span class="hljs-comment">// how many alerts have been truncated due to "max_alerts"</span>

  <span class="hljs-attr">"status"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"&lt;resolved|firing&gt;"</span><span class="hljs-punctuation">,</span>

  <span class="hljs-attr">"receiver"</span><span class="hljs-punctuation">:</span> &lt;string&gt;<span class="hljs-punctuation">,</span>

  <span class="hljs-attr">"groupLabels"</span><span class="hljs-punctuation">:</span> &lt;object&gt;<span class="hljs-punctuation">,</span>

  <span class="hljs-attr">"commonLabels"</span><span class="hljs-punctuation">:</span> &lt;object&gt;<span class="hljs-punctuation">,</span>

  <span class="hljs-attr">"commonAnnotations"</span><span class="hljs-punctuation">:</span> &lt;object&gt;<span class="hljs-punctuation">,</span>

  <span class="hljs-attr">"externalURL"</span><span class="hljs-punctuation">:</span> &lt;string&gt;<span class="hljs-punctuation">,</span>           <span class="hljs-comment">// backlink to the Alertmanager.</span>

  <span class="hljs-attr">"alerts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>

    <span class="hljs-punctuation">{</span>

      <span class="hljs-attr">"status"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"&lt;resolved|firing&gt;"</span><span class="hljs-punctuation">,</span>

      <span class="hljs-attr">"labels"</span><span class="hljs-punctuation">:</span> &lt;object&gt;<span class="hljs-punctuation">,</span>

      <span class="hljs-attr">"annotations"</span><span class="hljs-punctuation">:</span> &lt;object&gt;<span class="hljs-punctuation">,</span>

      <span class="hljs-attr">"startsAt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"&lt;rfc3339&gt;"</span><span class="hljs-punctuation">,</span>

      <span class="hljs-attr">"endsAt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"&lt;rfc3339&gt;"</span><span class="hljs-punctuation">,</span>

      <span class="hljs-attr">"generatorURL"</span><span class="hljs-punctuation">:</span> &lt;string&gt;<span class="hljs-punctuation">,</span>      <span class="hljs-comment">// identifies the entity that caused the alert</span>

      <span class="hljs-attr">"fingerprint"</span><span class="hljs-punctuation">:</span> &lt;string&gt;        <span class="hljs-comment">// fingerprint to identify the alert</span>

    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>

    ...

  <span class="hljs-punctuation">]</span>

<span class="hljs-punctuation">}</span>

</code></pre>
<p>流程：</p>
<pre><code class="hljs language-rust" lang="rust">
Alertmanager（固定的原始 JSON 格式） <span class="hljs-punctuation">-&gt;</span> 中转端点（打包成企业微信机器人要求的格式） <span class="hljs-punctuation">-&gt;</span> 企业微信机器人

</code></pre>
<p>下面用 golang 来实现这个中转端，也可以用其它语言实现比如 python。</p>
<p><code>alertmanager.yml</code> 中配置：</p>
<pre><code class="hljs language-yaml" lang="yaml">
<span class="hljs-string">...</span>

<span class="hljs-comment"># 模板文件</span>

<span class="hljs-attr">templates:</span>

  <span class="hljs-bullet">-</span> <span class="hljs-string">'/etc/alertmanager/templates/*.tmpl'</span>

  


<span class="hljs-comment"># 接收器：定义告警的通知方式（邮件、WebHook 等）</span>

<span class="hljs-attr">receivers:</span>

  <span class="hljs-string">...</span>

  <span class="hljs-comment"># 企业微信接收器（通过 WebHook）</span>

  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">'wechat'</span>

    <span class="hljs-attr">webhook_configs:</span>

      <span class="hljs-comment"># golang 中转端</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">url:</span> <span class="hljs-string">'http://10.0.0.12:5000/wechat'</span>

        <span class="hljs-attr">send_resolved:</span> <span class="hljs-literal">true</span>  <span class="hljs-comment"># 告警恢复时也发送通知</span>

        <span class="hljs-attr">timeout:</span> <span class="hljs-string">15s</span>

</code></pre>
<p><code>golang-wechat/main.go</code>：</p>
<pre><code class="hljs language-golang" lang="golang">
<span class="hljs-keyword">package</span> main

  


<span class="hljs-keyword">import</span> (

  <span class="hljs-string">"bytes"</span>

  <span class="hljs-string">"encoding/json"</span>

  <span class="hljs-string">"fmt"</span>

  <span class="hljs-string">"log"</span>

  <span class="hljs-string">"net/http"</span>

  <span class="hljs-string">"os"</span>

  <span class="hljs-string">"text/template"</span>

  <span class="hljs-string">"time"</span>

)

  


<span class="hljs-comment">// Alertmanager 原始告警数据结构（与模板变量对应）</span>

<span class="hljs-keyword">type</span> AlertmanagerData <span class="hljs-keyword">struct</span> {

  Receiver          <span class="hljs-type">string</span>            <span class="hljs-string">`json:"receiver"`</span>

  Status            <span class="hljs-type">string</span>            <span class="hljs-string">`json:"status"`</span>

  Alerts            []Alert           <span class="hljs-string">`json:"alerts"`</span>

  GroupLabels       <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span> <span class="hljs-string">`json:"groupLabels"`</span>

  CommonLabels      <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span> <span class="hljs-string">`json:"commonLabels"`</span>

  CommonAnnotations <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span> <span class="hljs-string">`json:"commonAnnotations"`</span>

  ExternalURL       <span class="hljs-type">string</span>            <span class="hljs-string">`json:"externalURL"`</span>

  Version           <span class="hljs-type">string</span>            <span class="hljs-string">`json:"version"`</span>

}

  


<span class="hljs-keyword">type</span> Alert <span class="hljs-keyword">struct</span> {

  Status      <span class="hljs-type">string</span>            <span class="hljs-string">`json:"status"`</span>

  Labels      <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span> <span class="hljs-string">`json:"labels"`</span>

  Annotations <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span> <span class="hljs-string">`json:"annotations"`</span>

  StartsAt    time.Time         <span class="hljs-string">`json:"startsAt"`</span>

  EndsAt      time.Time         <span class="hljs-string">`json:"endsAt"`</span>

  Fingerprint <span class="hljs-type">string</span>            <span class="hljs-string">`json:"fingerprint"`</span>

}

  


<span class="hljs-comment">// 企业微信消息结构（模板渲染结果需符合此格式）</span>

<span class="hljs-keyword">type</span> WechatMessage <span class="hljs-keyword">struct</span> {

  MsgType  <span class="hljs-type">string</span> <span class="hljs-string">`json:"msgtype"`</span>

  Markdown <span class="hljs-keyword">struct</span> {

    Content <span class="hljs-type">string</span> <span class="hljs-string">`json:"content"`</span>

  } <span class="hljs-string">`json:"markdown"`</span>

}

  


<span class="hljs-keyword">var</span> (

  wechatWebhook <span class="hljs-type">string</span>

  tpl           *template.Template <span class="hljs-comment">// 全局模板对象</span>

)

  


<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {

  <span class="hljs-comment">// 从环境变量获取配置</span>

  wechatWebhook = os.Getenv(<span class="hljs-string">"WECHAT_WEBHOOK_URL"</span>)

  port := os.Getenv(<span class="hljs-string">"PORT"</span>)

  tplPath := os.Getenv(<span class="hljs-string">"TEMPLATE_PATH"</span>) <span class="hljs-comment">// 模板文件路径</span>

  


  <span class="hljs-keyword">if</span> port == <span class="hljs-string">""</span> {

    port = <span class="hljs-string">"5000"</span> <span class="hljs-comment">// 默认端口</span>

  }

  <span class="hljs-keyword">if</span> wechatWebhook == <span class="hljs-string">""</span> {

    log.Fatal(<span class="hljs-string">"请设置环境变量 WECHAT_WEBHOOK_URL"</span>)

  }

  <span class="hljs-keyword">if</span> tplPath == <span class="hljs-string">""</span> {

    tplPath = <span class="hljs-string">"/app/templates/wechat.tmpl"</span> <span class="hljs-comment">// 默认模板路径</span>

  }

  


  <span class="hljs-comment">// 加载并解析模板文件（只渲染 content 内容，不含 JSON 结构）</span>

  <span class="hljs-keyword">var</span> err <span class="hljs-type">error</span>

  tpl, err = template.ParseFiles(tplPath)

  <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {

    log.Fatalf(<span class="hljs-string">"加载模板失败: %v"</span>, err)

  }

  log.Printf(<span class="hljs-string">"成功加载模板，名称: %s，路径: %s"</span>, tpl.Name(), tplPath)

  


  <span class="hljs-comment">// 注册 HTTP 路由</span>

  http.HandleFunc(<span class="hljs-string">"/wechat"</span>, forwardHandler)

  http.HandleFunc(<span class="hljs-string">"/health"</span>, healthHandler)

  


  <span class="hljs-comment">// 启动服务</span>

  log.Printf(<span class="hljs-string">"服务启动，监听端口: %s"</span>, port)

  log.Fatal(http.ListenAndServe(<span class="hljs-string">":"</span>+port, <span class="hljs-literal">nil</span>))

}

  


<span class="hljs-comment">// 转发处理函数</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">forwardHandler</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> {

  <span class="hljs-comment">// 解析 Alertmanager 原始数据</span>

  <span class="hljs-keyword">var</span> alertData AlertmanagerData

  <span class="hljs-keyword">if</span> err := json.NewDecoder(r.Body).Decode(&amp;alertData); err != <span class="hljs-literal">nil</span> {

    http.Error(w, <span class="hljs-string">"解析请求失败: "</span>+err.Error(), http.StatusBadRequest)

    log.Printf(<span class="hljs-string">"解析错误: %v"</span>, err)

    <span class="hljs-keyword">return</span>

  }

  log.Printf(<span class="hljs-string">"收到告警数据: %+v"</span>, alertData)

  


  <span class="hljs-comment">// 用模板渲染 markdown.content 的文本内容（不含 JSON 结构）</span>

  <span class="hljs-keyword">var</span> contentBuf bytes.Buffer

  <span class="hljs-comment">// 带有命名模板（{{ define "wechat.message" }}）的模板文件 使用 ExecuteTemplate 而不是 Execute</span>

  <span class="hljs-keyword">if</span> err := tpl.ExecuteTemplate(&amp;contentBuf, <span class="hljs-string">"wechat.message"</span>, alertData); err != <span class="hljs-literal">nil</span> {

    http.Error(w, <span class="hljs-string">"模板渲染失败: "</span>+err.Error(), http.StatusInternalServerError)

    log.Printf(<span class="hljs-string">"模板渲染错误: %v"</span>, err)

    <span class="hljs-keyword">return</span>

  }

  rawContent := contentBuf.String()

  log.Printf(<span class="hljs-string">"渲染后的 content 原始内容: %s"</span>, rawContent)

  


  escapedContent := rawContent

  


  <span class="hljs-comment">// 构造企业微信消息结构体</span>

  <span class="hljs-keyword">var</span> wechatMsg WechatMessage

  wechatMsg.MsgType = <span class="hljs-string">"markdown"</span>

  wechatMsg.Markdown.Content = escapedContent

  


  <span class="hljs-comment">// 序列化结构体为 JSON（自动处理所有特殊字符转义）</span>

  jsonData, err := json.Marshal(wechatMsg)

  <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {

    http.Error(w, <span class="hljs-string">"JSON 序列化失败: "</span>+err.Error(), http.StatusInternalServerError)

    log.Printf(<span class="hljs-string">"JSON 序列化错误: %v"</span>, err)

    <span class="hljs-keyword">return</span>

  }

  log.Printf(<span class="hljs-string">"最终发送的 JSON: %s"</span>, jsonData)

  


  <span class="hljs-comment">// 转发到企业微信</span>

  resp, err := http.Post(wechatWebhook, <span class="hljs-string">"application/json"</span>, bytes.NewBuffer(jsonData))

  <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {

    http.Error(w, <span class="hljs-string">"转发失败: "</span>+err.Error(), http.StatusInternalServerError)

    log.Printf(<span class="hljs-string">"转发错误: %v"</span>, err)

    <span class="hljs-keyword">return</span>

  }

  <span class="hljs-keyword">defer</span> resp.Body.Close()

  


  <span class="hljs-keyword">if</span> resp.StatusCode != http.StatusOK {

    http.Error(w, fmt.Sprintf(<span class="hljs-string">"企业微信接口错误，状态码: %d"</span>, resp.StatusCode), http.StatusInternalServerError)

    log.Printf(<span class="hljs-string">"企业微信接口错误，状态码: %d"</span>, resp.StatusCode)

    <span class="hljs-keyword">return</span>

  }

  


  <span class="hljs-comment">// 返回成功响应</span>

  w.WriteHeader(http.StatusOK)

  w.Write([]<span class="hljs-type">byte</span>(<span class="hljs-string">`{"status": "success"}`</span>))

}

  


<span class="hljs-comment">// 健康检查</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">healthHandler</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> {

  w.WriteHeader(http.StatusOK)

  w.Write([]<span class="hljs-type">byte</span>(<span class="hljs-string">`{"status": "healthy"}`</span>))

}

</code></pre>
<p>匹配上面 golang 中转程序的模板 <code>templates/wechat.tmpl</code>：</p>
<pre><code class="hljs language-ruby" lang="ruby">
{{ define <span class="hljs-string">"wechat.message"</span> }}

  


{{- range <span class="hljs-variable">$index</span>, <span class="hljs-variable">$alert</span> <span class="hljs-symbol">:</span>= .<span class="hljs-title class_">Alerts</span> -}}

{{- <span class="hljs-keyword">if</span> gt <span class="hljs-variable">$index</span> <span class="hljs-number">0</span> }}

---

{{ <span class="hljs-keyword">end</span> }}

  


{{- <span class="hljs-keyword">if</span> eq <span class="hljs-variable">$alert</span>.<span class="hljs-title class_">Status</span> <span class="hljs-string">"firing"</span> }}

<span class="hljs-comment">### 🚨 监控报警（故障告警通知）</span>

{{- <span class="hljs-keyword">else</span> }}

<span class="hljs-comment">### ✅ 监控报警（恢复通知）</span>

{{- <span class="hljs-keyword">end</span> }}

- **告警类型**: {{ <span class="hljs-keyword">if</span> <span class="hljs-variable">$alert</span>.<span class="hljs-title class_">Labels</span>.alertname }}{{ <span class="hljs-variable">$alert</span>.<span class="hljs-title class_">Labels</span>.alertname }}{{ <span class="hljs-keyword">else</span> }}未知告警{{ <span class="hljs-keyword">end</span> }}

- **告警级别**: {{ <span class="hljs-keyword">if</span> <span class="hljs-variable">$alert</span>.<span class="hljs-title class_">Labels</span>.severity }}{{ <span class="hljs-variable">$alert</span>.<span class="hljs-title class_">Labels</span>.severity }}{{ <span class="hljs-keyword">else</span> }}未知级别{{ <span class="hljs-keyword">end</span> }}

- **告警状态**: {{ <span class="hljs-variable">$alert</span>.<span class="hljs-title class_">Status</span> }} {{ <span class="hljs-keyword">if</span> eq <span class="hljs-variable">$alert</span>.<span class="hljs-title class_">Status</span> <span class="hljs-string">"firing"</span> }}故障{{ <span class="hljs-keyword">else</span> }}恢复{{ <span class="hljs-keyword">end</span> }}

- **故障主机**: {{ <span class="hljs-keyword">if</span> <span class="hljs-variable">$alert</span>.<span class="hljs-title class_">Labels</span>.instance }}{{ <span class="hljs-variable">$alert</span>.<span class="hljs-title class_">Labels</span>.instance }}{{ <span class="hljs-keyword">else</span> }}-{{ <span class="hljs-keyword">end</span> }} {{ <span class="hljs-keyword">if</span> <span class="hljs-variable">$alert</span>.<span class="hljs-title class_">Labels</span>.device }}{{ <span class="hljs-variable">$alert</span>.<span class="hljs-title class_">Labels</span>.device }}{{ <span class="hljs-keyword">else</span> }}-{{ <span class="hljs-keyword">end</span> }}

- **服务环境**: {{ <span class="hljs-keyword">if</span> <span class="hljs-variable">$alert</span>.<span class="hljs-title class_">Labels</span>.env }}{{ <span class="hljs-variable">$alert</span>.<span class="hljs-title class_">Labels</span>.env }}{{ <span class="hljs-keyword">else</span> }}未知环境{{ <span class="hljs-keyword">end</span> }}

- **服务名称**: {{ <span class="hljs-keyword">if</span> <span class="hljs-variable">$alert</span>.<span class="hljs-title class_">Labels</span>.servicename }}{{ <span class="hljs-variable">$alert</span>.<span class="hljs-title class_">Labels</span>.servicename }}{{ <span class="hljs-keyword">else</span> }}未知服务{{ <span class="hljs-keyword">end</span> }}

- **告警主题**: {{ <span class="hljs-keyword">if</span> <span class="hljs-variable">$alert</span>.<span class="hljs-title class_">Annotations</span>.summary }}{{ <span class="hljs-variable">$alert</span>.<span class="hljs-title class_">Annotations</span>.summary }}{{ <span class="hljs-keyword">else</span> }}无主题{{ <span class="hljs-keyword">end</span> }}

- **告警详情**: {{ <span class="hljs-keyword">if</span> <span class="hljs-variable">$alert</span>.<span class="hljs-title class_">Annotations</span>.message }}{{ <span class="hljs-variable">$alert</span>.<span class="hljs-title class_">Annotations</span>.message }}{{ <span class="hljs-keyword">end</span> }}{{ <span class="hljs-keyword">if</span> <span class="hljs-keyword">and</span> <span class="hljs-variable">$alert</span>.<span class="hljs-title class_">Annotations</span>.message <span class="hljs-variable">$alert</span>.<span class="hljs-title class_">Annotations</span>.description }}；{{ <span class="hljs-keyword">end</span> }}{{ <span class="hljs-keyword">if</span> <span class="hljs-variable">$alert</span>.<span class="hljs-title class_">Annotations</span>.description }}{{ <span class="hljs-variable">$alert</span>.<span class="hljs-title class_">Annotations</span>.description }}{{ <span class="hljs-keyword">else</span> }}无详情{{ <span class="hljs-keyword">end</span> }}

{{- <span class="hljs-keyword">if</span> <span class="hljs-variable">$alert</span>.<span class="hljs-title class_">Annotations</span>.value }}

- **触发阈值**: {{ <span class="hljs-variable">$alert</span>.<span class="hljs-title class_">Annotations</span>.value }}

{{- <span class="hljs-keyword">end</span> }}

- **故障时间**: {{ (<span class="hljs-variable">$alert</span>.<span class="hljs-title class_">StartsAt</span>.<span class="hljs-title class_">Add</span> <span class="hljs-number">28800e9</span>).<span class="hljs-title class_">Format</span> <span class="hljs-string">"2006-01-02 15:04:05"</span> }}

{{- <span class="hljs-keyword">if</span> eq <span class="hljs-variable">$alert</span>.<span class="hljs-title class_">Status</span> <span class="hljs-string">"resolved"</span> }}

- **恢复时间**: {{ <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-variable">$alert</span>.<span class="hljs-title class_">EndsAt</span>.<span class="hljs-title class_">IsZero</span> }}{{ (<span class="hljs-variable">$alert</span>.<span class="hljs-title class_">EndsAt</span>.<span class="hljs-title class_">Add</span> <span class="hljs-number">28800e9</span>).<span class="hljs-title class_">Format</span> <span class="hljs-string">"2006-01-02 15:04:05"</span> }}{{ <span class="hljs-keyword">else</span> }}持续中{{ <span class="hljs-keyword">end</span> }}

{{- <span class="hljs-keyword">end</span> }}

  


{{- <span class="hljs-keyword">end</span> }}

  


{{ <span class="hljs-keyword">end</span> }}

</code></pre>
<p>我的 Alertmanager 是用 docker 容器的形式运行的，进入容器中手动触发告警：</p>
<pre><code class="hljs language-bash" lang="bash">
<span class="hljs-comment"># docker exec -it alertmanager sh</span>

amtool alert add \

  --alertmanager.url=http://localhost:9093 \

  --annotation summary=<span class="hljs-string">"测试告警"</span> \

  --annotation description=<span class="hljs-string">"通过 amtool 发送的测试"</span> \

  alertname=TestAlert \

  severity=critical \

  instance=test-server

  


<span class="hljs-comment"># 生成测试数据（保存为 test_alert.json）</span>

<span class="hljs-built_in">cat</span> &gt; test_alert.json &lt;&lt; <span class="hljs-string">EOF

{

  "version": "4",

  "status": "firing",

  "alerts": [

    {

      "status": "firing",

      "labels": {

        "alertname": "HostOutOfMemory",

        "severity": "warning",

        "instance": "ubuntu-test-10-0-0-12",

        "hostname": "test-host",

        "env": "prod",

        "servicename": "node-exporter"

      },

      "annotations": {

        "summary": "内存不足告警",

        "description": "内存使用率超过90%"

      },

      "startsAt": "2025-08-09T08:00:00Z"

    }

  ]

}

EOF</span>

  


<span class="hljs-comment"># 用 amtool 测试模板渲染</span>

amtool template render \

  --template.glob=/etc/alertmanager/templates/wechat.tmpl \

  --template.data=test_alert.json \

  --template.text=<span class="hljs-string">'{{ template "wechat.message" . }}'</span>

</code></pre>
<p>golang 中转端也是用 docker 容器的形式运行的，一个简单的 <code>golang-wechat/Dockerfile</code>：</p>
<pre><code class="hljs language-Dockerfile" lang="Dockerfile">
FROM golang:1.23-alpine AS builder

WORKDIR /app

COPY main.go .

# 启用 CGO 禁用（静态编译，避免依赖系统库）

RUN CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -ldflags="-s -w" -o mywechat main.go

FROM alpine:3.20

WORKDIR /app

COPY --from=builder /app/mywechat .

EXPOSE 5000

ENTRYPOINT ["./mywechat"]

</code></pre>
<p>构建、启动：</p>
<pre><code class="hljs language-bash" lang="bash">
docker build -t mywechat:v1 .

docker stop mywechat

docker <span class="hljs-built_in">rm</span> mywechat

docker run -d \

-v /etc/localtime:/etc/localtime:ro \

--user 1026:1026 \

--name mywechat \

-p 5000:5000 \

-e WECHAT_WEBHOOK_URL=<span class="hljs-string">"https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=xxxx-xxxx-xxxxx-xxxx-xxxx"</span> \

-v templates:/app/templates \

mywechat:v1

</code></pre>
<p>接下来就可以手动触发一些告警来验证告警规则的处理了。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>