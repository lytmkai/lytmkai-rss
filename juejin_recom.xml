<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>æ˜é‡‘æ–‡ç« æ¨è</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…æˆé•¿çš„ç¤¾åŒº</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[ğŸ”¥ Vue3 å®ç°è¶…ä¸æ»‘æ‰“å­—æœºæ•ˆæœç»„ä»¶ï¼ˆå¯å¤ç”¨ã€é«˜å®šåˆ¶ï¼‰]]></title>    <link>https://juejin.cn/post/7598532592455516187</link>    <guid>https://juejin.cn/post/7598532592455516187</guid>    <pubDate>2026-01-24T07:04:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598532592455516187" data-draft-id="7598499504170614822" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸ”¥ Vue3 å®ç°è¶…ä¸æ»‘æ‰“å­—æœºæ•ˆæœç»„ä»¶ï¼ˆå¯å¤ç”¨ã€é«˜å®šåˆ¶ï¼‰"/> <meta itemprop="keywords" content="å‰ç«¯,Vue.js"/> <meta itemprop="datePublished" content="2026-01-24T07:04:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°é©¬_xiaoen"/> <meta itemprop="url" content="https://juejin.cn/user/4438063859920414"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸ”¥ Vue3 å®ç°è¶…ä¸æ»‘æ‰“å­—æœºæ•ˆæœç»„ä»¶ï¼ˆå¯å¤ç”¨ã€é«˜å®šåˆ¶ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4438063859920414/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°é©¬_xiaoen
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T07:04:17.000Z" title="Sat Jan 24 2026 07:04:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{line-height:1.75;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;letter-spacing:2px;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%;word-break:break-word;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1{font-size:23px;margin-bottom:5px;font-weight:700;padding-left:10px;border-left:5px solid #773098}.markdown-body h2{font-size:19px;font-weight:700;padding-left:10px;border-left:5px solid #916dd5}.markdown-body h3{font-size:17px;font-weight:700;padding-left:10px;border-left:5px solid #d89cf6}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;max-width:100%;margin:1em 0;border-radius:6px;box-shadow:2px 4px 7px #999;user-select:none}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{padding:.2em .5em;font-weight:700;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-size:1em;color:#916dd5;word-break:break-word;overflow-x:auto;background-color:none;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-weight:400;font-size:.9em;padding:16px 12px;margin:0;color:#333;word-break:normal;overflow-x:auto;background:#f8f8f8;scroll-behavior:smooth}.markdown-body a{text-decoration:none;color:#916dd5;font-weight:700;border-bottom:1px solid #916dd5}.markdown-body a:active,.markdown-body a:hover{color:#773098}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border:1px solid #916dd5;border-collapse:collapse}.markdown-body thead{background-color:#916dd5;color:#fff;text-align:left}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;border:1px solid #916dd5}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #d89cf6;background-color:#f4eeff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0;line-height:26px}.markdown-body ol,.markdown-body ul{padding-left:28px;list-style-type:circle}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{color:#916dd5;font-weight:700}.markdown-body b:before,.markdown-body strong:before{content:"ã€Œ"}.markdown-body b:after,.markdown-body strong:after{content:"ã€"}.markdown-body em,.markdown-body i{color:#916dd5}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><p>åœ¨å‰ç«¯å¼€å‘ä¸­ï¼Œæ‰“å­—æœºæ•ˆæœèƒ½æå¤§æå‡é¡µé¢çš„äº¤äº’è¶£å‘³æ€§å’Œè§†è§‰ä½“éªŒï¼Œæ¯”å¦‚ AI èŠå¤©å›å¤ã€ä¸ªæ€§åŒ–ä»‹ç»é¡µç­‰åœºæ™¯éƒ½éå¸¸é€‚ç”¨ã€‚æœ¬æ–‡å°†åˆ†äº«ä¸€ä¸ªåŸºäº Vue3 + Composition API å¼€å‘çš„<strong>é«˜æ€§èƒ½ã€é«˜å®šåˆ¶åŒ–</strong>æ‰“å­—æœºç»„ä»¶ï¼Œæ”¯æŒæ‰“å­—/åˆ é™¤å¾ªç¯ã€å…‰æ ‡é—ªçƒã€è‡ªå®šä¹‰æ ·å¼ç­‰æ ¸å¿ƒåŠŸèƒ½ï¼Œä¸”ä»£ç ç»“æ„æ¸…æ™°ã€æ˜“äºæ‰©å±•ã€‚</p>
<h2 data-id="heading-0">ğŸ¯ ç»„ä»¶ç‰¹æ€§</h2>
<ul>
<li>âœ… è‡ªå®šä¹‰æ‰“å­—é€Ÿåº¦ã€åˆ é™¤é€Ÿåº¦ã€å¾ªç¯å»¶è¿Ÿ</li>
<li>âœ… æ”¯æŒå…‰æ ‡æ˜¾ç¤º/éšè—ã€é—ªçƒæ•ˆæœå¼€å…³</li>
<li>âœ… æ‰“å­—å®Œæˆåè‡ªåŠ¨åˆ é™¤ï¼ˆå¯é€‰ï¼‰+ å¾ªç¯æ’­æ”¾</li>
<li>âœ… å®Œå…¨è‡ªå®šä¹‰æ ·å¼ï¼ˆå­—ä½“ã€é¢œè‰²ã€å¤§å°ç­‰ï¼‰</li>
<li>âœ… æš´éœ²æ§åˆ¶æ–¹æ³•ï¼ˆå¼€å§‹/æš‚åœï¼‰ï¼Œæ”¯æŒæ‰‹åŠ¨å¹²é¢„</li>
<li>âœ… æ— ç¬¬ä¸‰æ–¹ä¾èµ–ï¼Œçº¯åŸç”Ÿ Vue3 å®ç°</li>
<li>âœ… æ€§èƒ½ä¼˜åŒ–ï¼šç»„ä»¶å¸è½½è‡ªåŠ¨æ¸…ç†å®šæ—¶å™¨ï¼Œé¿å…å†…å­˜æ³„æ¼
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/430e5abc5ccf4784b4debc3857893d87~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6amsX3hpYW9lbg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769843056&amp;x-signature=3g31BSS0j3jO4WQZhc%2Fz50kXXjI%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></li>
</ul>
<h2 data-id="heading-1">ğŸ“ å®Œæ•´ç»„ä»¶ä»£ç </h2>
<pre><code class="hljs language-js" lang="js">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"typewriter-container"</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">"fontsConStyle"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- æ‰“å­—æ–‡æœ¬ - é€å­—ç¬¦æ¸²æŸ“ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"typewriter-text"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span> 
        <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(char, index) in displayedText"</span> 
        <span class="hljs-attr">:key</span>=<span class="hljs-string">"index"</span> 
        <span class="hljs-attr">class</span>=<span class="hljs-string">"character"</span>
        <span class="hljs-attr">:data-index</span>=<span class="hljs-string">"index"</span>
      &gt;</span>
        {{ char }}
      <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- å…‰æ ‡ - ç²¾å‡†æ§åˆ¶æ˜¾ç¤º/é—ªçƒ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> 
      <span class="hljs-attr">v-if</span>=<span class="hljs-string">"showCursor &amp;&amp; isCursorVisible"</span>
      <span class="hljs-attr">class</span>=<span class="hljs-string">"cursor"</span>
      <span class="hljs-attr">:class</span>=<span class="hljs-string">"{ 'blink': showBlinkCursor }"</span>
      <span class="hljs-attr">aria-hidden</span>=<span class="hljs-string">"true"</span>
    /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref, onMounted, onBeforeUnmount, computed, watch, watchEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>;

<span class="hljs-comment">// ç»„ä»¶ Props å®šä¹‰ï¼ˆå¸¦å®Œæ•´æ ¡éªŒï¼‰</span>
<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-comment">// è¦æ˜¾ç¤ºçš„æ–‡æœ¬å†…å®¹</span>
  <span class="hljs-attr">text</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,
    <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-string">""</span>
  },
  <span class="hljs-comment">// æ‰“å­—é€Ÿåº¦ï¼ˆms/å­—ç¬¦ï¼‰</span>
  <span class="hljs-attr">speed</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-number">80</span>,
    <span class="hljs-attr">validator</span>: <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> value &gt; <span class="hljs-number">0</span>
  },
  <span class="hljs-comment">// æ˜¯å¦æ˜¾ç¤ºå…‰æ ‡</span>
  <span class="hljs-attr">showCursor</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Boolean</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-literal">true</span>
  },
  <span class="hljs-comment">// å…‰æ ‡æ˜¯å¦é—ªçƒ</span>
  <span class="hljs-attr">blinkCursor</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Boolean</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-literal">true</span>
  },
  <span class="hljs-comment">// æ˜¯å¦è‡ªåŠ¨å¼€å§‹æ‰“å­—</span>
  <span class="hljs-attr">autoStart</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Boolean</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-literal">true</span>
  },
  <span class="hljs-comment">// æ˜¯å¦å¾ªç¯æ’­æ”¾</span>
  <span class="hljs-attr">loop</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Boolean</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-literal">false</span>
  },
  <span class="hljs-comment">// å¾ªç¯å»¶è¿Ÿï¼ˆæ‰“å­—å®Œæˆåç­‰å¾…æ—¶é—´ï¼‰</span>
  <span class="hljs-attr">loopDelay</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-number">1000</span>,
    <span class="hljs-attr">validator</span>: <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> value &gt;= <span class="hljs-number">0</span>
  },
  <span class="hljs-comment">// å®¹å™¨æ ·å¼ï¼ˆè‡ªå®šä¹‰å­—ä½“ã€é¢œè‰²ç­‰ï¼‰</span>
  <span class="hljs-attr">fontsConStyle</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Object</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> ({
      <span class="hljs-attr">fontSize</span>: <span class="hljs-string">"2rem"</span>,
      <span class="hljs-attr">fontFamily</span>: <span class="hljs-string">"'Courier New', monospace"</span>,
      <span class="hljs-attr">color</span>: <span class="hljs-string">"#333"</span>,
      <span class="hljs-attr">lineHeight</span>: <span class="hljs-string">"1.5"</span>
    })
  },
  <span class="hljs-comment">// æ˜¯å¦å¼€å¯åˆ é™¤æ•ˆæœ</span>
  <span class="hljs-attr">deleteEffect</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Boolean</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-literal">false</span>
  },
  <span class="hljs-comment">// åˆ é™¤é€Ÿåº¦ï¼ˆms/å­—ç¬¦ï¼‰</span>
  <span class="hljs-attr">deleteSpeed</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-number">30</span>,
    <span class="hljs-attr">validator</span>: <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> value &gt; <span class="hljs-number">0</span>
  },
  <span class="hljs-comment">// å­—ç¬¦å…¥åœºåŠ¨ç”»å¼€å…³</span>
  <span class="hljs-attr">charAnimation</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Boolean</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-literal">true</span>
  }
});

<span class="hljs-comment">// å“åº”å¼çŠ¶æ€</span>
<span class="hljs-keyword">const</span> displayedText = <span class="hljs-title function_">ref</span>(<span class="hljs-string">""</span>);    <span class="hljs-comment">// å½“å‰æ˜¾ç¤ºçš„æ–‡æœ¬</span>
<span class="hljs-keyword">const</span> currentIndex = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>);      <span class="hljs-comment">// å½“å‰å­—ç¬¦ç´¢å¼•</span>
<span class="hljs-keyword">const</span> isPlaying = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>);     <span class="hljs-comment">// æ˜¯å¦æ­£åœ¨æ’­æ”¾</span>
<span class="hljs-keyword">const</span> isDeleting = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>);    <span class="hljs-comment">// æ˜¯å¦æ­£åœ¨åˆ é™¤</span>
<span class="hljs-keyword">const</span> isCursorVisible = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">true</span>);<span class="hljs-comment">// å…‰æ ‡æ˜¯å¦æ˜¾ç¤º</span>

<span class="hljs-comment">// å®šæ—¶å™¨æ ‡è¯†ï¼ˆç”¨äºæ¸…ç†ï¼‰</span>
<span class="hljs-keyword">let</span> intervalId = <span class="hljs-literal">null</span>;
<span class="hljs-keyword">let</span> timeoutId = <span class="hljs-literal">null</span>;
<span class="hljs-keyword">let</span> cursorTimer = <span class="hljs-literal">null</span>;

<span class="hljs-comment">// è®¡ç®—å±æ€§ï¼šæ§åˆ¶å…‰æ ‡é—ªçƒçŠ¶æ€</span>
<span class="hljs-keyword">const</span> showBlinkCursor = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> props.<span class="hljs-property">blinkCursor</span> &amp;&amp; 
         !isDeleting.<span class="hljs-property">value</span> &amp;&amp;
         (displayedText.<span class="hljs-property">value</span>.<span class="hljs-property">length</span> === props.<span class="hljs-property">text</span>.<span class="hljs-property">length</span> || displayedText.<span class="hljs-property">value</span>.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>);
});

<span class="hljs-comment">// å·¥å…·å‡½æ•°ï¼šæ¸…é™¤æ‰€æœ‰å®šæ—¶å™¨</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">clearAllTimers</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (intervalId) <span class="hljs-built_in">clearInterval</span>(intervalId);
  <span class="hljs-keyword">if</span> (timeoutId) <span class="hljs-built_in">clearTimeout</span>(timeoutId);
  <span class="hljs-keyword">if</span> (cursorTimer) <span class="hljs-built_in">clearInterval</span>(cursorTimer);
  intervalId = <span class="hljs-literal">null</span>;
  timeoutId = <span class="hljs-literal">null</span>;
  cursorTimer = <span class="hljs-literal">null</span>;
};

<span class="hljs-comment">// æ ¸å¿ƒæ–¹æ³•ï¼šå¼€å§‹æ‰“å­—</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">startTyping</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-comment">// é‡ç½®çŠ¶æ€</span>
  <span class="hljs-title function_">clearAllTimers</span>();
  isPlaying.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>;
  isDeleting.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>;
  currentIndex.<span class="hljs-property">value</span> = <span class="hljs-number">0</span>;
  displayedText.<span class="hljs-property">value</span> = <span class="hljs-string">""</span>;
  isCursorVisible.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>;
  
  <span class="hljs-comment">// æ‰“å­—é€»è¾‘</span>
  intervalId = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (currentIndex.<span class="hljs-property">value</span> &lt; props.<span class="hljs-property">text</span>.<span class="hljs-property">length</span>) {
      displayedText.<span class="hljs-property">value</span> = props.<span class="hljs-property">text</span>.<span class="hljs-title function_">substring</span>(<span class="hljs-number">0</span>, currentIndex.<span class="hljs-property">value</span> + <span class="hljs-number">1</span>);
      currentIndex.<span class="hljs-property">value</span>++;
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// æ‰“å­—å®Œæˆ</span>
      <span class="hljs-built_in">clearInterval</span>(intervalId);
      isPlaying.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>;
      
      <span class="hljs-comment">// å¾ªç¯é€»è¾‘</span>
      <span class="hljs-keyword">if</span> (props.<span class="hljs-property">loop</span>) {
        <span class="hljs-keyword">if</span> (props.<span class="hljs-property">deleteEffect</span>) {
          timeoutId = <span class="hljs-built_in">setTimeout</span>(startDeleting, props.<span class="hljs-property">loopDelay</span>);
        } <span class="hljs-keyword">else</span> {
          timeoutId = <span class="hljs-built_in">setTimeout</span>(startTyping, props.<span class="hljs-property">loopDelay</span>);
        }
      }
    }
  }, props.<span class="hljs-property">speed</span>);
};

<span class="hljs-comment">// æ ¸å¿ƒæ–¹æ³•ï¼šå¼€å§‹åˆ é™¤</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">startDeleting</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-title function_">clearAllTimers</span>();
  isDeleting.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>;
  
  intervalId = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (currentIndex.<span class="hljs-property">value</span> &gt; <span class="hljs-number">0</span>) {
      currentIndex.<span class="hljs-property">value</span>--;
      displayedText.<span class="hljs-property">value</span> = props.<span class="hljs-property">text</span>.<span class="hljs-title function_">substring</span>(<span class="hljs-number">0</span>, currentIndex.<span class="hljs-property">value</span>);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// åˆ é™¤å®Œæˆ</span>
      <span class="hljs-built_in">clearInterval</span>(intervalId);
      isDeleting.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>;
      
      <span class="hljs-comment">// å¾ªç¯æ‰“å­—</span>
      <span class="hljs-keyword">if</span> (props.<span class="hljs-property">loop</span>) {
        timeoutId = <span class="hljs-built_in">setTimeout</span>(startTyping, props.<span class="hljs-property">loopDelay</span>);
      } <span class="hljs-keyword">else</span> {
        isCursorVisible.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>; <span class="hljs-comment">// éå¾ªç¯æ¨¡å¼ä¸‹åˆ é™¤å®Œæˆéšè—å…‰æ ‡</span>
      }
    }
  }, props.<span class="hljs-property">deleteSpeed</span>);
};

<span class="hljs-comment">// ç›‘å¬æ–‡æœ¬å˜åŒ–ï¼šè‡ªåŠ¨é‡å¯æ‰“å­—ï¼ˆé€‚é…åŠ¨æ€æ–‡æœ¬åœºæ™¯ï¼‰</span>
<span class="hljs-title function_">watch</span>(<span class="hljs-function">() =&gt;</span> props.<span class="hljs-property">text</span>, <span class="hljs-function">(<span class="hljs-params">newText</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (newText &amp;&amp; props.<span class="hljs-property">autoStart</span>) {
    <span class="hljs-title function_">startTyping</span>();
  }
}, { <span class="hljs-attr">immediate</span>: <span class="hljs-literal">true</span> });

<span class="hljs-comment">// åˆå§‹åŒ–å…‰æ ‡é—ªçƒï¼ˆéé—ªçƒæ¨¡å¼ä¸‹å›ºå®šæ˜¾ç¤ºï¼‰</span>
<span class="hljs-title function_">watchEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (props.<span class="hljs-property">showCursor</span> &amp;&amp; !cursorTimer) {
    cursorTimer = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">if</span> (!showBlinkCursor.<span class="hljs-property">value</span>) {
        isCursorVisible.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>;
      } <span class="hljs-keyword">else</span> {
        isCursorVisible.<span class="hljs-property">value</span> = !isCursorVisible.<span class="hljs-property">value</span>;
      }
    }, <span class="hljs-number">500</span>);
  }
});

<span class="hljs-comment">// ç»„ä»¶æŒ‚è½½ï¼šè‡ªåŠ¨å¼€å§‹æ‰“å­—</span>
<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (props.<span class="hljs-property">autoStart</span> &amp;&amp; props.<span class="hljs-property">text</span>) {
    <span class="hljs-title function_">startTyping</span>();
  }
});

<span class="hljs-comment">// ç»„ä»¶å¸è½½ï¼šæ¸…ç†æ‰€æœ‰å®šæ—¶å™¨ï¼ˆé¿å…å†…å­˜æ³„æ¼ï¼‰</span>
<span class="hljs-title function_">onBeforeUnmount</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">clearAllTimers</span>();
});

<span class="hljs-comment">// æš´éœ²ç»„ä»¶æ–¹æ³•ï¼ˆä¾›çˆ¶ç»„ä»¶è°ƒç”¨ï¼‰</span>
<span class="hljs-title function_">defineExpose</span>({
  <span class="hljs-attr">start</span>: startTyping,        <span class="hljs-comment">// æ‰‹åŠ¨å¼€å§‹</span>
  <span class="hljs-attr">pause</span>: clearAllTimers,     <span class="hljs-comment">// æš‚åœ</span>
  <span class="hljs-attr">restart</span>: <span class="hljs-function">() =&gt;</span> {           <span class="hljs-comment">// é‡å¯</span>
    <span class="hljs-title function_">clearAllTimers</span>();
    <span class="hljs-title function_">startTyping</span>();
  },
  isPlaying,                 <span class="hljs-comment">// å½“å‰æ’­æ”¾çŠ¶æ€</span>
  isDeleting                 <span class="hljs-comment">// å½“å‰åˆ é™¤çŠ¶æ€</span>
});
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-comment">/* å®¹å™¨æ ·å¼ - é€‚é…è¡Œå†…/å—çº§æ˜¾ç¤º */</span>
<span class="hljs-selector-class">.typewriter-container</span> {
  <span class="hljs-attribute">display</span>: inline-flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">font-size</span>: inherit;
  <span class="hljs-attribute">line-height</span>: inherit;
  <span class="hljs-attribute">font-family</span>: inherit;
  <span class="hljs-attribute">white-space</span>: pre-wrap; <span class="hljs-comment">/* æ”¯æŒæ¢è¡Œç¬¦ */</span>
  <span class="hljs-attribute">word-break</span>: break-all; <span class="hljs-comment">/* é˜²æ­¢é•¿æ–‡æœ¬æº¢å‡º */</span>
}

<span class="hljs-comment">/* æ–‡æœ¬å®¹å™¨ */</span>
<span class="hljs-selector-class">.typewriter-text</span> {
  <span class="hljs-attribute">display</span>: inline;
  <span class="hljs-attribute">font-size</span>: inherit;
  <span class="hljs-attribute">line-height</span>: inherit;
  <span class="hljs-attribute">font-family</span>: inherit;
  <span class="hljs-attribute">color</span>: inherit;
}

<span class="hljs-comment">/* å­—ç¬¦æ ·å¼ - å…¥åœºåŠ¨ç”» */</span>
<span class="hljs-selector-class">.character</span> {
  <span class="hljs-attribute">display</span>: inline-block;
  <span class="hljs-attribute">animation</span>: typeIn <span class="hljs-number">0.1s</span> ease-out forwards;
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;
}

<span class="hljs-comment">/* å­—ç¬¦å…¥åœºåŠ¨ç”» */</span>
<span class="hljs-keyword">@keyframes</span> typeIn {
  <span class="hljs-number">0%</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">5px</span>);
    <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;
  }
  <span class="hljs-number">100%</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">0</span>);
    <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;
  }
}

<span class="hljs-comment">/* å…‰æ ‡æ ·å¼ - å‚ç›´å±…ä¸­ä¼˜åŒ– */</span>
<span class="hljs-selector-class">.cursor</span> {
  <span class="hljs-attribute">display</span>: inline-block;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">2px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">1.2em</span>; <span class="hljs-comment">/* åŒ¹é…å­—ä½“é«˜åº¦ */</span>
  <span class="hljs-attribute">background-color</span>: currentColor;
  <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">2px</span>;
  <span class="hljs-attribute">vertical-align</span>: middle;
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;
}

<span class="hljs-comment">/* å…‰æ ‡é—ªçƒåŠ¨ç”» */</span>
<span class="hljs-selector-class">.cursor</span><span class="hljs-selector-class">.blink</span> {
  <span class="hljs-attribute">animation</span>: blink <span class="hljs-number">1s</span> infinite step-end;
}

<span class="hljs-keyword">@keyframes</span> blink {
  <span class="hljs-number">0%</span>, <span class="hljs-number">100%</span> { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>; }
  <span class="hljs-number">50%</span> { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>; }
}

<span class="hljs-comment">/* ç¦ç”¨å­—ç¬¦åŠ¨ç”»çš„æ ·å¼ */</span>
:<span class="hljs-built_in">deep</span>(.character) {
  <span class="hljs-attribute">animation</span>: none <span class="hljs-meta">!important</span>;
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span> <span class="hljs-meta">!important</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span>
</code></pre>
<h2 data-id="heading-2">ğŸš€ æ ¸å¿ƒä¼˜åŒ–ç‚¹è¯´æ˜</h2>
<h3 data-id="heading-3">1. åŠŸèƒ½å¢å¼º</h3>
<ul>
<li>æ–°å¢ <code>charAnimation</code> å±æ€§ï¼šå¯å¼€å…³å­—ç¬¦å…¥åœºåŠ¨ç”»ï¼Œé€‚é…ä¸åŒåœºæ™¯</li>
<li>æ”¯æŒåŠ¨æ€æ–‡æœ¬ï¼šç›‘å¬ <code>text</code> å±æ€§å˜åŒ–ï¼Œæ–‡æœ¬æ›´æ–°è‡ªåŠ¨é‡å¯æ‰“å­—</li>
<li>ä¼˜åŒ–å…‰æ ‡é€»è¾‘ï¼šéé—ªçƒæ¨¡å¼ä¸‹å…‰æ ‡å›ºå®šæ˜¾ç¤ºï¼Œé¿å…é—ªçƒå¹²æ‰°</li>
<li>æ–°å¢ <code>restart</code> æ–¹æ³•ï¼šæ”¯æŒæ‰‹åŠ¨é‡å¯æ‰“å­—æ•ˆæœ</li>
<li>æ–‡æœ¬æ¢è¡Œæ”¯æŒï¼šæ·»åŠ  <code>white-space: pre-wrap</code>ï¼Œå…¼å®¹å¸¦æ¢è¡Œç¬¦çš„æ–‡æœ¬</li>
</ul>
<h3 data-id="heading-4">2. æ€§èƒ½ä¼˜åŒ–</h3>
<ul>
<li>å®šæ—¶å™¨ç»Ÿä¸€ç®¡ç†ï¼šæ‰€æœ‰å®šæ—¶å™¨é›†ä¸­æ¸…ç†ï¼Œé¿å…å†…å­˜æ³„æ¼</li>
<li>å‡å°‘ä¸å¿…è¦æ¸²æŸ“ï¼šé€šè¿‡ <code>watchEffect</code> ç²¾å‡†æ§åˆ¶å…‰æ ‡å®šæ—¶å™¨åˆ›å»º/é”€æ¯</li>
<li>æ ·å¼ä¼˜åŒ–ï¼šä½¿ç”¨ <code>currentColor</code> ç»§æ‰¿æ–‡æœ¬é¢œè‰²ï¼Œå…‰æ ‡é¢œè‰²ä¸æ–‡æœ¬ä¸€è‡´</li>
<li>è¾¹ç•Œå¤„ç†ï¼šæ·»åŠ  <code>word-break: break-all</code>ï¼Œé˜²æ­¢é•¿æ–‡æœ¬æº¢å‡º</li>
</ul>
<h3 data-id="heading-5">3. ä»£ç å¥å£®æ€§</h3>
<ul>
<li>å®Œå–„ Prop æ ¡éªŒï¼šæ‰€æœ‰æ•°å€¼ç±»å‹æ·»åŠ èŒƒå›´æ ¡éªŒï¼Œé¿å…éæ³•å€¼</li>
<li>çŠ¶æ€é‡ç½®ï¼šæ¯æ¬¡å¼€å§‹æ‰“å­—å‰é‡ç½®æ‰€æœ‰çŠ¶æ€ï¼Œé¿å…å¤šè½®æ‰§è¡Œå†²çª</li>
<li>æ³¨é‡Šå®Œå–„ï¼šå…³é”®é€»è¾‘æ·»åŠ æ³¨é‡Šï¼Œæå‡ä»£ç å¯è¯»æ€§</li>
</ul>
<h2 data-id="heading-6">ğŸ“– ä½¿ç”¨ç¤ºä¾‹</h2>
<h3 data-id="heading-7">åŸºç¡€ä½¿ç”¨</h3>
<pre><code class="hljs language-js" lang="js">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Typewriter</span> 
    <span class="hljs-attr">text</span>=<span class="hljs-string">"Hello Vue3! è¿™æ˜¯ä¸€ä¸ªè¶…ä¸æ»‘çš„æ‰“å­—æœºæ•ˆæœç»„ä»¶âœ¨"</span>
    <span class="hljs-attr">speed</span>=<span class="hljs-string">"50"</span>
  /&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Typewriter</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./components/Typewriter.vue'</span>;
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<h3 data-id="heading-8">é«˜çº§ä½¿ç”¨ï¼ˆå¾ªç¯+åˆ é™¤æ•ˆæœï¼‰</h3>
<pre><code class="hljs language-js" lang="js">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Typewriter</span> 
      <span class="hljs-attr">ref</span>=<span class="hljs-string">"typewriterRef"</span>
      <span class="hljs-attr">text</span>=<span class="hljs-string">"Vue3 æ‰“å­—æœºç»„ä»¶ | æ”¯æŒå¾ªç¯åˆ é™¤ | è‡ªå®šä¹‰æ ·å¼"</span>
      <span class="hljs-attr">:speed</span>=<span class="hljs-string">"60"</span>
      <span class="hljs-attr">:deleteSpeed</span>=<span class="hljs-string">"40"</span>
      <span class="hljs-attr">:loop</span>=<span class="hljs-string">"true"</span>
      <span class="hljs-attr">:deleteEffect</span>=<span class="hljs-string">"true"</span>
      <span class="hljs-attr">:loopDelay</span>=<span class="hljs-string">"1500"</span>
      <span class="hljs-attr">:fontsConStyle</span>=<span class="hljs-string">"{
        fontSize: '1.5rem',
        color: '#409eff',
        fontFamily: 'å¾®è½¯é›…é»‘'
      }"</span>
    /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"handleRestart"</span>&gt;</span>é‡å¯æ‰“å­—<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Typewriter</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./components/Typewriter.vue'</span>;

<span class="hljs-keyword">const</span> typewriterRef = <span class="hljs-title function_">ref</span>();

<span class="hljs-comment">// æ‰‹åŠ¨é‡å¯æ‰“å­—</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleRestart</span> = (<span class="hljs-params"/>) =&gt; {
  typewriterRef.<span class="hljs-property">value</span>.<span class="hljs-title function_">restart</span>();
};
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<h2 data-id="heading-9">ğŸ¨ æ ·å¼è‡ªå®šä¹‰è¯´æ˜</h2>






























<table><thead><tr><th>å±æ€§</th><th>è¯´æ˜</th><th>é»˜è®¤å€¼</th></tr></thead><tbody><tr><td>fontSize</td><td>å­—ä½“å¤§å°</td><td>2rem</td></tr><tr><td>fontFamily</td><td>å­—ä½“</td><td>'Courier New', monospace</td></tr><tr><td>color</td><td>æ–‡æœ¬é¢œè‰²</td><td>#333</td></tr><tr><td>lineHeight</td><td>è¡Œé«˜</td><td>1.5</td></tr></tbody></table>
<p>ä½ å¯ä»¥é€šè¿‡ <code>fontsConStyle</code> å±æ€§å®Œå…¨è‡ªå®šä¹‰ç»„ä»¶æ ·å¼ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-attr">fontsConStyle</span>: {
  <span class="hljs-attr">fontSize</span>: <span class="hljs-string">"18px"</span>,
  <span class="hljs-attr">color</span>: <span class="hljs-string">"#e6a23c"</span>,
  <span class="hljs-attr">fontWeight</span>: <span class="hljs-string">"bold"</span>,
  <span class="hljs-attr">background</span>: <span class="hljs-string">"#f5f7fa"</span>,
  <span class="hljs-attr">padding</span>: <span class="hljs-string">"10px 15px"</span>,
  <span class="hljs-attr">borderRadius</span>: <span class="hljs-string">"8px"</span>
}
</code></pre>
<h2 data-id="heading-10">ğŸ› ï¸ æ‰©å±•æ–¹å‘</h2>
<ol>
<li><strong>è‡ªå®šä¹‰å­—ç¬¦åŠ¨ç”»</strong>ï¼šé€šè¿‡ Prop ä¼ å…¥åŠ¨ç”»ç±»åï¼Œæ”¯æŒä¸åŒçš„å­—ç¬¦å…¥åœºæ•ˆæœ</li>
<li><strong>åˆ†æ®µæ‰“å­—</strong>ï¼šæ”¯æŒæ•°ç»„å½¢å¼çš„æ–‡æœ¬ï¼Œåˆ†æ®µæ‰“å­—+é—´éš”</li>
<li><strong>é€Ÿåº¦æ¸å˜</strong>ï¼šå®ç°æ‰“å­—é€Ÿåº¦ç”±å¿«åˆ°æ…¢/ç”±æ…¢åˆ°å¿«çš„æ•ˆæœ</li>
<li><strong>æš‚åœ/ç»§ç»­</strong>ï¼šæ‰©å±•æš‚åœåç»§ç»­æ‰“å­—çš„åŠŸèƒ½ï¼ˆè®°å½•å½“å‰ç´¢å¼•ï¼‰</li>
<li><strong>ç»“åˆ AI æµå¼å“åº”</strong>ï¼šå¯¹æ¥ AI æ¥å£çš„æµå¼è¿”å›ï¼Œå®æ—¶æ›´æ–°æ‰“å­—æ–‡æœ¬</li>
</ol>
<h2 data-id="heading-11">ğŸ“Œ æ€»ç»“</h2>
<p>è¿™ä¸ªæ‰“å­—æœºç»„ä»¶åŸºäº Vue3 Composition API å¼€å‘ï¼Œå…·å¤‡<strong>é«˜å¤ç”¨æ€§ã€é«˜å®šåˆ¶æ€§</strong>çš„ç‰¹ç‚¹ï¼Œæ ¸å¿ƒä¼˜åŒ–ç‚¹å¦‚ä¸‹ï¼š</p>
<ol>
<li>å®Œå–„çš„å®šæ—¶å™¨ç®¡ç†ï¼Œé¿å…å†…å­˜æ³„æ¼</li>
<li>ç²¾å‡†çš„çŠ¶æ€æ§åˆ¶ï¼Œæ”¯æŒæ‰“å­—/åˆ é™¤/å¾ªç¯å…¨æµç¨‹</li>
<li>çµæ´»çš„æ ·å¼è‡ªå®šä¹‰ï¼Œé€‚é…ä¸åŒä¸šåŠ¡åœºæ™¯</li>
<li>æš´éœ²æ§åˆ¶æ–¹æ³•ï¼Œæ”¯æŒçˆ¶ç»„ä»¶æ‰‹åŠ¨å¹²é¢„</li>
</ol>
<p>ç»„ä»¶å¯ç›´æ¥é›†æˆåˆ° Vue3 é¡¹ç›®ä¸­ï¼Œé€‚ç”¨äº AI èŠå¤©ã€ä¸ªäººä¸»é¡µã€äº§å“ä»‹ç»ç­‰éœ€è¦æ‰“å­—æœºæ•ˆæœçš„åœºæ™¯ï¼Œå¼€ç®±å³ç”¨ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue2 çš„å“åº”å¼åŸç†]]></title>    <link>https://juejin.cn/post/7598459769238749218</link>    <guid>https://juejin.cn/post/7598459769238749218</guid>    <pubDate>2026-01-24T07:38:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598459769238749218" data-draft-id="7598465042968117288" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue2 çš„å“åº”å¼åŸç†"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2026-01-24T07:38:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·10063310408"/> <meta itemprop="url" content="https://juejin.cn/user/2103809314920539"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue2 çš„å“åº”å¼åŸç†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2103809314920539/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·10063310408
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T07:38:28.000Z" title="Sat Jan 24 2026 07:38:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»15åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vue2 çš„å“åº”å¼åŸç†</h2>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a4ed082d9906441ba83afeb720cb4552~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTAwNjMzMTA0MDg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769845458&amp;x-signature=hmrnTglCoUxxl2vkDQrLyVzPR%2Bg%3D" alt="1.png" width="100%" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f4cf6543721648579871f5d6f8935ba3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTAwNjMzMTA0MDg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769845458&amp;x-signature=GdWyigDgLiINj6aM5wIYO5QFgdE%3D" alt="Vue2 ç”Ÿå‘½å‘¨æœŸ.png" width="100%" loading="lazy"/>
<h2 data-id="heading-1">Object.defineProperty</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(obj, prop, descriptor)
  objï¼šå¿…éœ€ã€‚è¦å®šä¹‰æˆ–ä¿®æ”¹çš„å±æ€§çš„å¯¹è±¡ã€‚
  propï¼šå¿…éœ€ã€‚è¦å®šä¹‰æˆ–ä¿®æ”¹çš„å±æ€§çš„å±æ€§åã€‚
  descriptorï¼šå¿…éœ€ã€‚è¦å®šä¹‰æˆ–ä¿®æ”¹çš„å±æ€§çš„æè¿°ç¬¦ã€‚
</code></pre>
<p><strong>å­˜å–å™¨ getter/setter</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">var</span> obj = {}
<span class="hljs-keyword">var</span> value = <span class="hljs-string">'hello'</span>

<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(obj, <span class="hljs-string">'key'</span>, {
  <span class="hljs-comment">// å½“è·å– obj['key'] å€¼çš„æ—¶å€™è§¦å‘è¯¥å‡½æ•°ã€‚</span>
  <span class="hljs-attr">get</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> value
  },
  <span class="hljs-comment">// å½“è®¾ç½® obj['key'] å€¼çš„æ—¶å€™è§¦å‘è¯¥å‡½æ•°ã€‚</span>
  <span class="hljs-attr">set</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">newValue</span>) {
    value = newValue
  }
})
</code></pre>
<p>â€‹		æ³¨æ„ï¼šä¸è¦åœ¨ getter ä¸­è·å–è¯¥å±æ€§çš„å€¼ï¼Œä¹Ÿä¸è¦åœ¨ setter ä¸­è®¾ç½®è¯¥å±æ€§çš„å€¼ï¼Œå¦åˆ™ä¼šå‘ç”Ÿæ ˆæº¢å‡ºã€‚</p>
<h2 data-id="heading-2">å®ç°æ•°æ®ä»£ç†å’ŒåŠ«æŒ</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Vue</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">options</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span> = options
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initData</span>()
  }

  <span class="hljs-title function_">initData</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// TODOï¼šthis.$options.data è¿˜å¯èƒ½æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚</span>
    <span class="hljs-keyword">const</span> data = (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_data</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span>.<span class="hljs-property">data</span>)
    <span class="hljs-keyword">const</span> keys = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(data)
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; keys.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-comment">// æ•°æ®ä»£ç†é€»è¾‘ã€‚</span>
      <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(<span class="hljs-variable language_">this</span>, keys[i], {
        <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">get</span>: <span class="hljs-keyword">function</span> <span class="hljs-title function_">proxyGetter</span>(<span class="hljs-params"/>) {
          <span class="hljs-keyword">return</span> data[keys[i]]
        },
        <span class="hljs-attr">set</span>: <span class="hljs-keyword">function</span> <span class="hljs-title function_">proxySetter</span>(<span class="hljs-params">newValue</span>) {
          data[keys[i]] = newValue
        }
      })
      <span class="hljs-comment">// æ•°æ®åŠ«æŒé€»è¾‘ã€‚</span>
      <span class="hljs-keyword">let</span> value = data[keys[i]]
      <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(data, keys[i], {
        <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">get</span>: <span class="hljs-keyword">function</span> <span class="hljs-title function_">reactiveGetter</span>(<span class="hljs-params"/>) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`è·å–äº† data çš„ <span class="hljs-subst">${keys[i]}</span> å€¼ã€‚`</span>)
          <span class="hljs-keyword">return</span> value
        },
        <span class="hljs-attr">set</span>: <span class="hljs-keyword">function</span> <span class="hljs-title function_">reactiveSetter</span>(<span class="hljs-params">newValue</span>) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`è®¾ç½®äº† data çš„ <span class="hljs-subst">${keys[i]}</span> å€¼ã€‚`</span>)
          value = newValue
        }
      })
    }
  }
}
</code></pre>
<h2 data-id="heading-3">å®ç°æ•°æ®ä»£ç†å’Œé€’å½’åŠ«æŒ</h2>
<p>â€‹		é¦–å…ˆå°†æ•°æ®é€’å½’åŠ«æŒé€»è¾‘æŠ½ç¦»åˆ° observe å·¥å‚å‡½æ•°ä¸­ï¼›ç„¶åæ–°å®šä¹‰ä¸€ä¸ª Observer ç±»ï¼Œä¸ºåç»­çš„å·¥ä½œåšé“ºå«ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Vue</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">options</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span> = options
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initData</span>()
  }

  <span class="hljs-title function_">initData</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// TODOï¼šthis.$options.data è¿˜å¯èƒ½æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚</span>
    <span class="hljs-keyword">const</span> data = (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_data</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span>.<span class="hljs-property">data</span>)
    <span class="hljs-keyword">const</span> keys = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(data)
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; keys.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-comment">// æ•°æ®ä»£ç†é€»è¾‘ã€‚</span>
      <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(<span class="hljs-variable language_">this</span>, keys[i], {
        <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">get</span>: <span class="hljs-keyword">function</span> <span class="hljs-title function_">proxyGetter</span>(<span class="hljs-params"/>) {
          <span class="hljs-keyword">return</span> data[keys[i]]
        },
        <span class="hljs-attr">set</span>: <span class="hljs-keyword">function</span> <span class="hljs-title function_">proxySetter</span>(<span class="hljs-params">newValue</span>) {
          data[keys[i]] = newValue
        }
      })
    }

    <span class="hljs-title function_">observe</span>(data)
  }
}

<span class="hljs-comment">// è§‚å¯Ÿ data æ•°æ®ã€‚</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">observe</span>(<span class="hljs-params">data</span>) {
  <span class="hljs-keyword">const</span> type = <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(data)
  <span class="hljs-keyword">if</span> (type !== <span class="hljs-string">'[object Object]'</span> &amp;&amp; type !== <span class="hljs-string">'[object Array]'</span>) {
    <span class="hljs-keyword">return</span>
  }
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Observer</span>(data)
}

<span class="hljs-comment">// TODOï¼šæ•°ç»„çš„è§‚å¯Ÿé€»è¾‘æš‚æ—¶è¿˜æ²¡å®ç°ã€‚</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Observer</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">data</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">walk</span>(data)
  }

  <span class="hljs-title function_">walk</span>(<span class="hljs-params">data</span>) {
    <span class="hljs-keyword">const</span> keys = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(data)
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; keys.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-title function_">defineReactive</span>(data, keys[i], data[keys[i]])
    }
  }
}

<span class="hljs-comment">// å®šä¹‰ obj å¯¹è±¡çš„ key å±æ€§çš„å“åº”å¼ã€‚</span>
<span class="hljs-comment">// è¿™é‡Œåˆ©ç”¨äº†é—­åŒ…ï¼Œä½¿å¾— value å˜é‡ä¸€ç›´æ²¡æœ‰è¢«åƒåœ¾å›æ”¶ã€‚</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">defineReactive</span>(<span class="hljs-params">obj, key, value</span>) {
  <span class="hljs-comment">// æ·±åº¦ä¼˜å…ˆéå†ã€‚</span>
  <span class="hljs-title function_">observe</span>(value)

  <span class="hljs-comment">// æ•°æ®åŠ«æŒé€»è¾‘ã€‚</span>
  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(obj, key, {
    <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">get</span>: <span class="hljs-keyword">function</span> <span class="hljs-title function_">reactiveGetter</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`è·å–äº† <span class="hljs-subst">${key}</span> å€¼ã€‚`</span>)
      <span class="hljs-keyword">return</span> value
    },
    <span class="hljs-attr">set</span>: <span class="hljs-keyword">function</span> <span class="hljs-title function_">reactiveSetter</span>(<span class="hljs-params">newValue</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`è®¾ç½®äº† <span class="hljs-subst">${key}</span> å€¼ã€‚`</span>)
      <span class="hljs-title function_">observe</span>(newValue)
      value = newValue
    }
  })
}
</code></pre>
<h2 data-id="heading-4">å®ç° watch ç›‘å¬</h2>
<p>â€‹		ä¸‹é¢æ˜¯ Vue ä¸­çš„ watch é€‰é¡¹ä¸ $watch æ–¹æ³•çš„å®ç°åŸç†ã€‚ï¼ˆæš‚æ—¶åªå®ç°äº†å¯¹ vm.$options.data å¯¹è±¡çš„ç¬¬ä¸€å±‚å±æ€§çš„ç›‘å¬ã€‚ï¼‰</p>
<p>â€‹		æ¯ä¸ªå“åº”å¼å±æ€§éƒ½æœ‰ä¸€ä¸ªå±äºè‡ªå·±çš„â€œç­â€ã€‚åœ¨è¯¥å“åº”å¼å±æ€§è¢«å…¶ä»–å›è°ƒå‡½æ•°ä¾èµ–çš„æ—¶å€™ï¼ŒVue ä¼šé€šè¿‡è¿™ä¸ªâ€œç­â€çš„ depend æ–¹æ³•æŠŠè¿™äº›å›è°ƒå‡½æ•°æ·»åŠ åˆ°è¿™ä¸ªâ€œç­â€çš„ subs å±æ€§ä¸­ã€‚åœ¨è¯¥å“åº”å¼å±æ€§çš„å€¼å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼ŒVue ä¼šé€šè¿‡è¿™ä¸ªâ€œç­â€çš„ notify æ–¹æ³•æŠŠè¿™ä¸ªâ€œç­â€çš„ subs å±æ€§ä¸­çš„è¿™äº›å›è°ƒå‡½æ•°å–å‡ºæ¥å…¨éƒ¨æ‰§è¡Œã€‚</p>
<p>â€‹		åœ¨ Vue ä¸­ï¼Œâ€œç­â€è¢«æŠ½è±¡æˆäº† Dep å®ä¾‹ï¼Œå›è°ƒå‡½æ•°è¢«åŒ…è£…æˆäº† Watcher å®ä¾‹ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Vue</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">options</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span> = options
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initData</span>()
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initWatch</span>()
  }

  <span class="hljs-title function_">initData</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// TODOï¼šthis.$options.data è¿˜å¯èƒ½æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚</span>
    <span class="hljs-keyword">const</span> data = (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_data</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span>.<span class="hljs-property">data</span>)
    <span class="hljs-keyword">const</span> keys = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(data)
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; keys.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-comment">// æ•°æ®ä»£ç†é€»è¾‘ã€‚</span>
      <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(<span class="hljs-variable language_">this</span>, keys[i], {
        <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">get</span>: <span class="hljs-keyword">function</span> <span class="hljs-title function_">proxyGetter</span>(<span class="hljs-params"/>) {
          <span class="hljs-keyword">return</span> data[keys[i]]
        },
        <span class="hljs-attr">set</span>: <span class="hljs-keyword">function</span> <span class="hljs-title function_">proxySetter</span>(<span class="hljs-params">newValue</span>) {
          data[keys[i]] = newValue
        }
      })
    }

    <span class="hljs-title function_">observe</span>(data)
  }

  <span class="hljs-title function_">initWatch</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> watch = <span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span>.<span class="hljs-property">watch</span>
    <span class="hljs-keyword">if</span> (watch) {
      <span class="hljs-keyword">const</span> keys = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(watch)
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; keys.<span class="hljs-property">length</span>; i++) {
        <span class="hljs-variable language_">this</span>.$watch(keys[i], watch[keys[i]])
      }
    }
  }

  $watch(exp, cb) {
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Watcher</span>(<span class="hljs-variable language_">this</span>, exp, cb)
  }
}

<span class="hljs-comment">// è§‚å¯Ÿ data æ•°æ®ã€‚</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">observe</span>(<span class="hljs-params">data</span>) {
  <span class="hljs-keyword">const</span> type = <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(data)
  <span class="hljs-keyword">if</span> (type !== <span class="hljs-string">'[object Object]'</span> &amp;&amp; type !== <span class="hljs-string">'[object Array]'</span>) {
    <span class="hljs-keyword">return</span>
  }
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Observer</span>(data)
}

<span class="hljs-comment">// TODOï¼šæ•°ç»„çš„è§‚å¯Ÿé€»è¾‘æš‚æ—¶è¿˜æ²¡å®ç°ã€‚</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Observer</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">data</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">walk</span>(data)
  }

  <span class="hljs-title function_">walk</span>(<span class="hljs-params">data</span>) {
    <span class="hljs-keyword">const</span> keys = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(data)
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; keys.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-title function_">defineReactive</span>(data, keys[i], data[keys[i]])
    }
  }
}

<span class="hljs-comment">// å®šä¹‰ obj å¯¹è±¡çš„ key å±æ€§çš„å“åº”å¼ã€‚</span>
<span class="hljs-comment">// è¿™é‡Œåˆ©ç”¨äº†é—­åŒ…ï¼Œä½¿å¾— value å˜é‡ å’Œ dep å¸¸é‡ä¸€ç›´æ²¡æœ‰è¢«åƒåœ¾å›æ”¶ã€‚</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">defineReactive</span>(<span class="hljs-params">obj, key, value</span>) {
  <span class="hljs-keyword">const</span> dep = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dep</span>()

  <span class="hljs-comment">// æ·±åº¦ä¼˜å…ˆéå†ã€‚</span>
  <span class="hljs-title function_">observe</span>(value)

  <span class="hljs-comment">// æ•°æ®åŠ«æŒé€»è¾‘ã€‚</span>
  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(obj, key, {
    <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">get</span>: <span class="hljs-keyword">function</span> <span class="hljs-title function_">reactiveGetter</span>(<span class="hljs-params"/>) {
      <span class="hljs-comment">// è®¢é˜…é€»è¾‘ã€‚</span>
      dep.<span class="hljs-title function_">depend</span>()
      <span class="hljs-keyword">return</span> value
    },
    <span class="hljs-attr">set</span>: <span class="hljs-keyword">function</span> <span class="hljs-title function_">reactiveSetter</span>(<span class="hljs-params">newValue</span>) {
      <span class="hljs-keyword">if</span> (value === newValue) {
        <span class="hljs-keyword">return</span>
      }
      <span class="hljs-comment">// å‘å¸ƒé€»è¾‘ã€‚</span>
      dep.<span class="hljs-title function_">notify</span>()
      <span class="hljs-title function_">observe</span>(newValue)
      value = newValue
    }
  })
}

<span class="hljs-comment">// â€œç­â€è¢«æŠ½è±¡æˆäº† Dep å®ä¾‹ã€‚</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Dep</span> {
  <span class="hljs-comment">// å“åº”å¼å±æ€§å½“å‰è¦è®¢é˜…çš„ watcherã€‚</span>
  <span class="hljs-keyword">static</span> target = <span class="hljs-literal">null</span>

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// å“åº”å¼å±æ€§å·²è®¢é˜…çš„ watcher åˆ—è¡¨ã€‚</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">subs</span> = []
  }

  <span class="hljs-title function_">depend</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Dep</span>.<span class="hljs-property">target</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">subs</span>.<span class="hljs-title function_">push</span>(<span class="hljs-title class_">Dep</span>.<span class="hljs-property">target</span>)
    }
  }

  <span class="hljs-title function_">notify</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">subs</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">watcher</span> =&gt;</span> {
      watcher.<span class="hljs-title function_">run</span>()
    })
  }
}

<span class="hljs-comment">// å›è°ƒå‡½æ•°è¢«åŒ…è£…æˆäº† Watcher å®ä¾‹ã€‚</span>
<span class="hljs-comment">// TODOï¼šæš‚æ—¶åªå®ç°äº†å¯¹ vm.$options.data å¯¹è±¡çš„ç¬¬ä¸€å±‚å±æ€§çš„ç›‘å¬ã€‚</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Watcher</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">vm, exp, cb</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span> = vm
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">exp</span> = exp
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">cb</span> = cb
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">get</span>()
  }

  <span class="hljs-title function_">get</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Dep</span>.<span class="hljs-property">target</span> = <span class="hljs-variable language_">this</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">exp</span>]
    <span class="hljs-title class_">Dep</span>.<span class="hljs-property">target</span> = <span class="hljs-literal">null</span>
  }

  <span class="hljs-title function_">run</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">cb</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>)
  }
}
</code></pre>
<p>â€‹		åœ¨ Vue ä¸­ï¼š1ã€è¢«åŒ…è£…æˆ Watcher å®ä¾‹çš„å›è°ƒå‡½æ•°æ˜¯è¢«å¼‚æ­¥è°ƒç”¨çš„ï¼›2ã€åœ¨è¯¥å›è°ƒå‡½æ•°è¢«å¼‚æ­¥è°ƒç”¨ä¹‹åå’Œå®é™…æ‰§è¡Œä¹‹å‰çš„è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå¦‚æœè§¦å‘è¯¥å›è°ƒå‡½æ•°çš„å“åº”å¼å±æ€§çš„å€¼åˆè¢«ä¿®æ”¹äº†ï¼Œé‚£ä¹ˆè¿™äº›åç»­çš„ä¿®æ”¹æ“ä½œå°†æ— æ³•å†æ¬¡è§¦å‘è¯¥å›è°ƒå‡½æ•°çš„è°ƒç”¨ã€‚æ‰€ä»¥ Watcher ç±»çš„å®ç°åŸç†ï¼Œå®é™…å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å›è°ƒå‡½æ•°è¢«åŒ…è£…æˆäº† Watcher å®ä¾‹ã€‚</span>
<span class="hljs-comment">// TODOï¼šæš‚æ—¶åªå®ç°äº†å¯¹ vm.$options.data å¯¹è±¡çš„ç¬¬ä¸€å±‚å±æ€§çš„ç›‘å¬ã€‚</span>
<span class="hljs-keyword">const</span> watcherQueue = []
<span class="hljs-keyword">let</span> watcherId = <span class="hljs-number">0</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Watcher</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">vm, exp, cb</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = ++watcherId
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span> = vm
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">exp</span> = exp
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">cb</span> = cb
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">get</span>()
  }

  <span class="hljs-title function_">get</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Dep</span>.<span class="hljs-property">target</span> = <span class="hljs-variable language_">this</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">exp</span>]
    <span class="hljs-title class_">Dep</span>.<span class="hljs-property">target</span> = <span class="hljs-literal">null</span>
  }

  <span class="hljs-title function_">run</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (watcherQueue.<span class="hljs-title function_">indexOf</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span>) !== -<span class="hljs-number">1</span>) {
      <span class="hljs-comment">// ç±»ä¼¼äº JavaScript ä¸­çš„é˜²æŠ–é€»è¾‘ã€‚</span>
      <span class="hljs-keyword">return</span>
    }
    watcherQueue.<span class="hljs-title function_">push</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span>)
    <span class="hljs-keyword">const</span> index = watcherQueue.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>
    <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">cb</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>)
      watcherQueue.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>)
    })
  }
}
</code></pre>
<h2 data-id="heading-5">ä»ç„¶å­˜åœ¨çš„é—®é¢˜</h2>
<p>â€‹		è‡³æ­¤ï¼ŒåŸºæœ¬å®ç°äº† Vue ä¸­åŸºäºå‘å¸ƒè®¢é˜…çš„ watch ç›‘å¬é€»è¾‘ã€‚ä½†ç›®å‰ä»ç„¶å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š1ã€<strong>å¯¹è±¡çš„æ–°å¢å±æ€§</strong>æ²¡æœ‰è¢«æ·»åŠ æ•°æ®åŠ«æŒé€»è¾‘ï¼›2ã€<strong>æ•°ç»„å…ƒç´ </strong>çš„æ•°æ®åŠ«æŒé€»è¾‘è¿˜å­˜åœ¨é—®é¢˜ã€‚å› æ­¤åœ¨å¯¹å¯¹è±¡çš„æ–°å¢å±æ€§å’Œæ•°ç»„å…ƒç´ æ·»åŠ ç›‘å¬é€»è¾‘æ—¶ä¹Ÿä¼šå­˜åœ¨é—®é¢˜ã€‚</p>
<h2 data-id="heading-6">å®ç° $set æ–¹æ³•</h2>
<p>â€‹		åœ¨ Vue ä¸­ï¼Œå¦‚æœå“åº”å¼å±æ€§çš„å€¼æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ˆåŒ…æ‹¬æ•°ç»„ï¼‰ï¼Œé‚£ä¹ˆåœ¨è¯¥å“åº”å¼å±æ€§ä¸Šå°±ä¼šè¢«æŒ‚è½½ä¸€ä¸ª _ ob _ å±æ€§ï¼Œè¯¥ _ ob _ å±æ€§çš„å€¼æ˜¯ä¸€ä¸ª Observer å®ä¾‹ï¼Œè¯¥ Observer å®ä¾‹çš„ dep å±æ€§çš„å€¼æ˜¯ä¸€ä¸ª Dep å®ä¾‹ï¼Œè¯¥ Dep å®ä¾‹æ˜¯å’Œ defineReactive æ–¹æ³•çš„é—­åŒ…ä¸­çš„ Dep å®ä¾‹ä¸åŒçš„ä¸è¯¥å“åº”å¼å±æ€§ç»‘å®šçš„å¦å¤–ä¸€ä¸ªâ€œç­â€ã€‚</p>
<p>â€‹		å½“å“åº”å¼å±æ€§çš„å€¼æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ˆåŒ…æ‹¬æ•°ç»„ï¼‰æ—¶ï¼ŒVue ä¼šæŠŠè§¦å‘è¯¥å“åº”å¼å±æ€§çš„ getter çš„ watchers é¢å¤–æ”¶é›†ä¸€ä»½åœ¨è¯¥å“åº”å¼å±æ€§çš„ _ ob _ å±æ€§çš„ dep å±æ€§çš„ subs å±æ€§ä¸­ã€‚è¿™æ ·å¼€å‘è€…å°±å¯ä»¥é€šè¿‡ä»£ç <strong>å‘½ä»¤å¼</strong>åœ°å»è§¦å‘è¿™ä¸ªå“åº”å¼å±æ€§çš„ watchers äº†ã€‚</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8574cad12415492f9c8c28397d6197ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTAwNjMzMTA0MDg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769845458&amp;x-signature=1nJlxfUZ7RgKeXJnED%2FuQjKbOZ8%3D" alt="2.png" width="100%" loading="lazy"/>
<p><strong>$set æ–¹æ³•çš„å®ç°æ€è·¯åŸºæœ¬å¦‚ä¸‹ï¼š</strong></p>
<p>â€‹		1ã€åœ¨åˆ›å»º Observer å¯¹è±¡çš„å®ä¾‹å»è§‚å¯Ÿå“åº”å¼å±æ€§æ—¶ï¼ŒåŒæ—¶ä¹Ÿåˆ›å»ºä¸€ä¸ª Dep å¯¹è±¡çš„å®ä¾‹ã€‚å…ˆå°†è¯¥ Dep å¯¹è±¡çš„å®ä¾‹æŒ‚è½½åˆ°è¯¥ Observer å¯¹è±¡çš„å®ä¾‹ä¸Šï¼Œç„¶åæŠŠè¯¥ Observer å¯¹è±¡çš„å®ä¾‹æŒ‚è½½åˆ°å®ƒè‡ªå·±è§‚å¯Ÿçš„å“åº”å¼å±æ€§ä¸Šã€‚</p>
<p>â€‹		2ã€å½“å“åº”å¼å±æ€§çš„ getter è¢«è§¦å‘æ—¶ï¼ŒæŠŠä¸è¯¥å“åº”å¼å±æ€§ç»‘å®šçš„â€œç­â€çš„ depend æ–¹æ³•è°ƒç”¨ä¸€éã€‚å“åº”å¼å±æ€§çš„å€¼ä¸ºå¯¹è±¡æˆ–æ•°ç»„æ—¶ï¼Œæœ‰ä¸¤ä¸ªç­ï¼›å“åº”å¼å±æ€§çš„å€¼ä¸ä¸ºå¯¹è±¡å’Œæ•°ç»„æ—¶ï¼Œæœ‰ä¸€ä¸ªç­ã€‚</p>
<p>â€‹		3ã€å½“ç”¨æˆ·è°ƒç”¨ $set æ–¹æ³•æ—¶ï¼Œå¦‚æœ target ä¸ºå¯¹è±¡ï¼Œåˆ™ Vue å…ˆè°ƒç”¨ defineReactive æ–¹æ³•æŠŠè®¾ç½®çš„å±æ€§ä¹Ÿå®šä¹‰ä¸ºå“åº”å¼ï¼Œç„¶åè°ƒç”¨ target._ ob _.dep.notify æ–¹æ³•è§¦å‘ target çš„ watchersã€‚ï¼ˆtarget ä¸ºæ•°ç»„çš„æƒ…å†µæš‚æ—¶æœªå®ç°ã€‚ï¼‰</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Vue</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">options</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span> = options
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initData</span>()
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initWatch</span>()
  }

  <span class="hljs-title function_">initData</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// TODOï¼šthis.$options.data è¿˜å¯èƒ½æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚</span>
    <span class="hljs-keyword">const</span> data = (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_data</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span>.<span class="hljs-property">data</span>)
    <span class="hljs-keyword">const</span> keys = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(data)
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; keys.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-comment">// æ•°æ®ä»£ç†é€»è¾‘ã€‚</span>
      <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(<span class="hljs-variable language_">this</span>, keys[i], {
        <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">get</span>: <span class="hljs-keyword">function</span> <span class="hljs-title function_">proxyGetter</span>(<span class="hljs-params"/>) {
          <span class="hljs-keyword">return</span> data[keys[i]]
        },
        <span class="hljs-attr">set</span>: <span class="hljs-keyword">function</span> <span class="hljs-title function_">proxySetter</span>(<span class="hljs-params">newValue</span>) {
          data[keys[i]] = newValue
        }
      })
    }

    <span class="hljs-title function_">observe</span>(data)
  }

  <span class="hljs-title function_">initWatch</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> watch = <span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span>.<span class="hljs-property">watch</span>
    <span class="hljs-keyword">if</span> (watch) {
      <span class="hljs-keyword">const</span> keys = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(watch)
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; keys.<span class="hljs-property">length</span>; i++) {
        <span class="hljs-variable language_">this</span>.$watch(keys[i], watch[keys[i]])
      }
    }
  }

  $watch(exp, cb) {
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Watcher</span>(<span class="hljs-variable language_">this</span>, exp, cb)
  }

  <span class="hljs-comment">// TODOï¼šæš‚æ—¶åªå®ç°äº† target ä¸ºå¯¹è±¡çš„æƒ…å†µï¼Œtarget ä¸ºæ•°ç»„çš„æƒ…å†µè¿˜æœªå®ç°ã€‚</span>
  $set(target, key, value) {
    <span class="hljs-title function_">defineReactive</span>(target, key, value)
    <span class="hljs-comment">// è§¦å‘ä¾èµ– target çš„ watchersã€‚</span>
    target.<span class="hljs-property">__ob__</span>.<span class="hljs-property">dep</span>.<span class="hljs-title function_">notify</span>()
  }
}

<span class="hljs-comment">// è§‚å¯Ÿ data æ•°æ®ã€‚</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">observe</span>(<span class="hljs-params">data</span>) {
  <span class="hljs-keyword">const</span> type = <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(data)
  <span class="hljs-keyword">if</span> (type !== <span class="hljs-string">'[object Object]'</span> &amp;&amp; type !== <span class="hljs-string">'[object Array]'</span>) {
    <span class="hljs-keyword">return</span>
  }
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Observer</span>(data)
}

<span class="hljs-comment">// TODOï¼šæ•°ç»„çš„è§‚å¯Ÿé€»è¾‘æš‚æ—¶è¿˜æ²¡å®ç°ã€‚</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Observer</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">data</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dep</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dep</span>()
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(data, <span class="hljs-string">'__ob__'</span>, {
      <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">configurable</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">value</span>: <span class="hljs-variable language_">this</span>,
      <span class="hljs-attr">writable</span>: <span class="hljs-literal">true</span>
    })
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">walk</span>(data)
  }

  <span class="hljs-title function_">walk</span>(<span class="hljs-params">data</span>) {
    <span class="hljs-keyword">const</span> keys = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(data)
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; keys.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-title function_">defineReactive</span>(data, keys[i], data[keys[i]])
    }
  }
}

<span class="hljs-comment">// å®šä¹‰ obj å¯¹è±¡çš„ key å±æ€§çš„å“åº”å¼ã€‚</span>
<span class="hljs-comment">// è¿™é‡Œåˆ©ç”¨äº†é—­åŒ…ï¼Œä½¿å¾— value å˜é‡ å’Œ dep å¸¸é‡ä¸€ç›´æ²¡æœ‰è¢«åƒåœ¾å›æ”¶ã€‚</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">defineReactive</span>(<span class="hljs-params">obj, key, value</span>) {
  <span class="hljs-keyword">const</span> dep = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dep</span>()

  <span class="hljs-comment">// æ·±åº¦ä¼˜å…ˆéå†ã€‚</span>
  <span class="hljs-keyword">const</span> objKeyOb = <span class="hljs-title function_">observe</span>(value)

  <span class="hljs-keyword">if</span> (objKeyOb &amp;&amp; obj[key] &amp;&amp; obj[key].<span class="hljs-property">__ob__</span>) {
    objKeyOb.<span class="hljs-property">dep</span> = obj[key].<span class="hljs-property">__ob__</span>.<span class="hljs-property">dep</span>
  }

  <span class="hljs-comment">// æ•°æ®åŠ«æŒé€»è¾‘ã€‚</span>
  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(obj, key, {
    <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">get</span>: <span class="hljs-keyword">function</span> <span class="hljs-title function_">reactiveGetter</span>(<span class="hljs-params"/>) {
      <span class="hljs-comment">// è®¢é˜…é€»è¾‘ã€‚</span>
      dep.<span class="hljs-title function_">depend</span>()
      <span class="hljs-keyword">if</span> (objKeyOb) {
        objKeyOb.<span class="hljs-property">dep</span>.<span class="hljs-title function_">depend</span>()
      }
      <span class="hljs-keyword">return</span> value
    },
    <span class="hljs-attr">set</span>: <span class="hljs-keyword">function</span> <span class="hljs-title function_">reactiveSetter</span>(<span class="hljs-params">newValue</span>) {
      <span class="hljs-keyword">if</span> (value === newValue) {
        <span class="hljs-keyword">return</span>
      }
      <span class="hljs-comment">// å‘å¸ƒé€»è¾‘ã€‚</span>
      dep.<span class="hljs-title function_">notify</span>()
      <span class="hljs-keyword">const</span> objKeyOb = <span class="hljs-title function_">observe</span>(newValue)
      <span class="hljs-keyword">if</span> (objKeyOb &amp;&amp; obj[key] &amp;&amp; obj[key].<span class="hljs-property">__ob__</span>) {
        objKeyOb.<span class="hljs-property">dep</span> = obj[key].<span class="hljs-property">__ob__</span>.<span class="hljs-property">dep</span>
      }
      value = newValue
    }
  })
}

<span class="hljs-comment">// â€œç­â€è¢«æŠ½è±¡æˆäº† Dep å®ä¾‹ã€‚</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Dep</span> {
  <span class="hljs-comment">// å“åº”å¼å±æ€§å½“å‰è¦è®¢é˜…çš„ watcherã€‚</span>
  <span class="hljs-keyword">static</span> target = <span class="hljs-literal">null</span>

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// å“åº”å¼å±æ€§å·²è®¢é˜…çš„ watcher åˆ—è¡¨ã€‚</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">subs</span> = []
  }

  <span class="hljs-title function_">depend</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Dep</span>.<span class="hljs-property">target</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">subs</span>.<span class="hljs-title function_">push</span>(<span class="hljs-title class_">Dep</span>.<span class="hljs-property">target</span>)
    }
  }

  <span class="hljs-title function_">notify</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">subs</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">watcher</span> =&gt;</span> {
      watcher.<span class="hljs-title function_">run</span>()
    })
  }
}

<span class="hljs-comment">// å›è°ƒå‡½æ•°è¢«åŒ…è£…æˆäº† Watcher å®ä¾‹ã€‚</span>
<span class="hljs-comment">// TODOï¼šæš‚æ—¶åªå®ç°äº†å¯¹ vm.$options.data å¯¹è±¡çš„ç¬¬ä¸€å±‚å±æ€§çš„ç›‘å¬ã€‚</span>
<span class="hljs-keyword">const</span> watcherQueue = []
<span class="hljs-keyword">let</span> watcherId = <span class="hljs-number">0</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Watcher</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">vm, exp, cb</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = ++watcherId
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span> = vm
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">exp</span> = exp
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">cb</span> = cb
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">get</span>()
  }

  <span class="hljs-title function_">get</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Dep</span>.<span class="hljs-property">target</span> = <span class="hljs-variable language_">this</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">exp</span>]
    <span class="hljs-title class_">Dep</span>.<span class="hljs-property">target</span> = <span class="hljs-literal">null</span>
  }

  <span class="hljs-title function_">run</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (watcherQueue.<span class="hljs-title function_">indexOf</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span>) !== -<span class="hljs-number">1</span>) {
      <span class="hljs-comment">// ç±»ä¼¼äº JavaScript ä¸­çš„é˜²æŠ–é€»è¾‘ã€‚</span>
      <span class="hljs-keyword">return</span>
    }
    watcherQueue.<span class="hljs-title function_">push</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span>)
    <span class="hljs-keyword">const</span> index = watcherQueue.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>
    <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">cb</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>)
      watcherQueue.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>)
    })
  }
}
</code></pre>
<h2 data-id="heading-7">å®ç°æ•°ç»„æ–¹æ³•çš„é‡å†™</h2>
<p><strong>Vue å¯¹æ•°ç»„çš„å¤„ç†æ€è·¯åŸºæœ¬å¦‚ä¸‹ï¼š</strong></p>
<p>â€‹		1ã€å¯¹æ•°ç»„æœ¬èº«ä¸ä½¿ç”¨ Object.defineProperty æ–¹æ³•è¿›è¡Œæ•°æ®åŠ«æŒï¼Œå¯¹æ•°ç»„å…ƒç´ ä¾æ¬¡ä½¿ç”¨ observe æ–¹æ³•è¿›è¡Œæ•°æ®è§‚å¯Ÿã€‚å› æ­¤ï¼Œ<strong>æ•°ç»„å…ƒç´ ä¸å…·æœ‰å“åº”æ€§ï¼Œæ•°ç»„å…ƒç´ çš„å±æ€§ä»ç„¶å…·æœ‰å“åº”æ€§</strong>ã€‚</p>
<p>â€‹		2ã€å¯¹æ•°ç»„çš„ pushã€popã€shiftã€unshiftã€spliceã€sortã€reverse å®ä¾‹æ–¹æ³•è¿›è¡Œé‡å†™ã€‚åœ¨è¿™äº›é‡å†™çš„å®ä¾‹æ–¹æ³•ä¸­ï¼ŒVue å…ˆè°ƒç”¨æ•°ç»„çš„åŸå§‹åŒåå®ä¾‹æ–¹æ³•ï¼Œç„¶åå†è°ƒç”¨ this._ ob _.dep.notify æ–¹æ³•å»è§¦å‘è¯¥æ•°ç»„çš„ watchersã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Vue</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">options</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span> = options
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initData</span>()
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initWatch</span>()
  }

  <span class="hljs-title function_">initData</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// TODOï¼šthis.$options.data è¿˜å¯èƒ½æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚</span>
    <span class="hljs-keyword">const</span> data = (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_data</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span>.<span class="hljs-property">data</span>)
    <span class="hljs-keyword">const</span> keys = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(data)
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; keys.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-comment">// æ•°æ®ä»£ç†é€»è¾‘ã€‚</span>
      <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(<span class="hljs-variable language_">this</span>, keys[i], {
        <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">get</span>: <span class="hljs-keyword">function</span> <span class="hljs-title function_">proxyGetter</span>(<span class="hljs-params"/>) {
          <span class="hljs-keyword">return</span> data[keys[i]]
        },
        <span class="hljs-attr">set</span>: <span class="hljs-keyword">function</span> <span class="hljs-title function_">proxySetter</span>(<span class="hljs-params">newValue</span>) {
          data[keys[i]] = newValue
        }
      })
    }

    <span class="hljs-title function_">observe</span>(data)
  }

  <span class="hljs-title function_">initWatch</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> watch = <span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span>.<span class="hljs-property">watch</span>
    <span class="hljs-keyword">if</span> (watch) {
      <span class="hljs-keyword">const</span> keys = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(watch)
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; keys.<span class="hljs-property">length</span>; i++) {
        <span class="hljs-variable language_">this</span>.$watch(keys[i], watch[keys[i]])
      }
    }
  }

  $watch(exp, cb) {
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Watcher</span>(<span class="hljs-variable language_">this</span>, exp, cb)
  }

  $set(target, key, value) {
    <span class="hljs-keyword">const</span> type = <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(target)
    <span class="hljs-keyword">if</span> (type !== <span class="hljs-string">'[object Object]'</span> &amp;&amp; type !== <span class="hljs-string">'[object Array]'</span>) {
      <span class="hljs-keyword">return</span>
    }
    <span class="hljs-keyword">if</span> (type === <span class="hljs-string">'[object Array]'</span>) {
      <span class="hljs-keyword">const</span> arratProto = <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>
      <span class="hljs-title function_">observe</span>(value)
      arratProto.<span class="hljs-property">splice</span>.<span class="hljs-title function_">call</span>(target, key, <span class="hljs-number">1</span>, value)
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type === <span class="hljs-string">'[object Object]'</span>) {
      <span class="hljs-title function_">defineReactive</span>(target, key, value)
    }
    <span class="hljs-comment">// è§¦å‘ä¾èµ– target çš„ watchersã€‚</span>
    target.<span class="hljs-property">__ob__</span>.<span class="hljs-property">dep</span>.<span class="hljs-title function_">notify</span>()
  }
}

<span class="hljs-comment">// è§‚å¯Ÿ data æ•°æ®ã€‚</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">observe</span>(<span class="hljs-params">data</span>) {
  <span class="hljs-keyword">const</span> type = <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(data)
  <span class="hljs-keyword">if</span> (type !== <span class="hljs-string">'[object Object]'</span> &amp;&amp; type !== <span class="hljs-string">'[object Array]'</span>) {
    <span class="hljs-keyword">return</span>
  }
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Observer</span>(data)
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Observer</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">data</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dep</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dep</span>()
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(data, <span class="hljs-string">'__ob__'</span>, {
      <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">configurable</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">value</span>: <span class="hljs-variable language_">this</span>,
      <span class="hljs-attr">writable</span>: <span class="hljs-literal">true</span>
    })
    <span class="hljs-keyword">const</span> type = <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(data)
    <span class="hljs-keyword">if</span> (type === <span class="hljs-string">'[object Array]'</span>) {
      data.<span class="hljs-property">__proto__</span> = arrayMethods
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">observeArray</span>(data)
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type === <span class="hljs-string">'[object Object]'</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">walk</span>(data)
    }
  }

  <span class="hljs-title function_">walk</span>(<span class="hljs-params">data</span>) {
    <span class="hljs-keyword">const</span> keys = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(data)
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; keys.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-title function_">defineReactive</span>(data, keys[i], data[keys[i]])
    }
  }

  <span class="hljs-title function_">observeArray</span>(<span class="hljs-params">array</span>) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; array.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-title function_">observe</span>(array[i])
    }
  }
}

<span class="hljs-comment">// å®šä¹‰ obj å¯¹è±¡çš„ key å±æ€§çš„å“åº”å¼ã€‚</span>
<span class="hljs-comment">// è¿™é‡Œåˆ©ç”¨äº†é—­åŒ…ï¼Œä½¿å¾— value å˜é‡ å’Œ dep å¸¸é‡ä¸€ç›´æ²¡æœ‰è¢«åƒåœ¾å›æ”¶ã€‚</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">defineReactive</span>(<span class="hljs-params">obj, key, value</span>) {
  <span class="hljs-keyword">const</span> dep = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dep</span>()

  <span class="hljs-comment">// æ·±åº¦ä¼˜å…ˆéå†ã€‚</span>
  <span class="hljs-keyword">const</span> objKeyOb = <span class="hljs-title function_">observe</span>(value)

  <span class="hljs-keyword">if</span> (objKeyOb &amp;&amp; obj[key] &amp;&amp; obj[key].<span class="hljs-property">__ob__</span>) {
    objKeyOb.<span class="hljs-property">dep</span> = obj[key].<span class="hljs-property">__ob__</span>.<span class="hljs-property">dep</span>
  }

  <span class="hljs-comment">// æ•°æ®åŠ«æŒé€»è¾‘ã€‚</span>
  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(obj, key, {
    <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">get</span>: <span class="hljs-keyword">function</span> <span class="hljs-title function_">reactiveGetter</span>(<span class="hljs-params"/>) {
      <span class="hljs-comment">// è®¢é˜…é€»è¾‘ã€‚</span>
      dep.<span class="hljs-title function_">depend</span>()
      <span class="hljs-keyword">if</span> (objKeyOb) {
        objKeyOb.<span class="hljs-property">dep</span>.<span class="hljs-title function_">depend</span>()
      }
      <span class="hljs-keyword">return</span> value
    },
    <span class="hljs-attr">set</span>: <span class="hljs-keyword">function</span> <span class="hljs-title function_">reactiveSetter</span>(<span class="hljs-params">newValue</span>) {
      <span class="hljs-keyword">if</span> (value === newValue) {
        <span class="hljs-keyword">return</span>
      }
      <span class="hljs-comment">// å‘å¸ƒé€»è¾‘ã€‚</span>
      dep.<span class="hljs-title function_">notify</span>()
      <span class="hljs-keyword">const</span> objKeyOb = <span class="hljs-title function_">observe</span>(newValue)
      <span class="hljs-keyword">if</span> (objKeyOb &amp;&amp; obj[key] &amp;&amp; obj[key].<span class="hljs-property">__ob__</span>) {
        objKeyOb.<span class="hljs-property">dep</span> = obj[key].<span class="hljs-property">__ob__</span>.<span class="hljs-property">dep</span>
      }
      value = newValue
    }
  })
}

<span class="hljs-comment">// â€œç­â€è¢«æŠ½è±¡æˆäº† Dep å®ä¾‹ã€‚</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Dep</span> {
  <span class="hljs-comment">// å“åº”å¼å±æ€§å½“å‰è¦è®¢é˜…çš„ watcherã€‚</span>
  <span class="hljs-keyword">static</span> target = <span class="hljs-literal">null</span>

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// å“åº”å¼å±æ€§å·²è®¢é˜…çš„ watcher åˆ—è¡¨ã€‚</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">subs</span> = []
  }

  <span class="hljs-title function_">depend</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Dep</span>.<span class="hljs-property">target</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">subs</span>.<span class="hljs-title function_">push</span>(<span class="hljs-title class_">Dep</span>.<span class="hljs-property">target</span>)
    }
  }

  <span class="hljs-title function_">notify</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">subs</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">watcher</span> =&gt;</span> {
      watcher.<span class="hljs-title function_">run</span>()
    })
  }
}

<span class="hljs-comment">// å›è°ƒå‡½æ•°è¢«åŒ…è£…æˆäº† Watcher å®ä¾‹ã€‚</span>
<span class="hljs-comment">// TODOï¼šæš‚æ—¶åªå®ç°äº†å¯¹ vm.$options.data å¯¹è±¡çš„ç¬¬ä¸€å±‚å±æ€§çš„ç›‘å¬ã€‚</span>
<span class="hljs-keyword">const</span> watcherQueue = []
<span class="hljs-keyword">let</span> watcherId = <span class="hljs-number">0</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Watcher</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">vm, exp, cb</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = ++watcherId
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span> = vm
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">exp</span> = exp
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">cb</span> = cb
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">get</span>()
  }

  <span class="hljs-title function_">get</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Dep</span>.<span class="hljs-property">target</span> = <span class="hljs-variable language_">this</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">exp</span>]
    <span class="hljs-title class_">Dep</span>.<span class="hljs-property">target</span> = <span class="hljs-literal">null</span>
  }

  <span class="hljs-title function_">run</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (watcherQueue.<span class="hljs-title function_">indexOf</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span>) !== -<span class="hljs-number">1</span>) {
      <span class="hljs-comment">// ç±»ä¼¼äº JavaScript ä¸­çš„é˜²æŠ–é€»è¾‘ã€‚</span>
      <span class="hljs-keyword">return</span>
    }
    watcherQueue.<span class="hljs-title function_">push</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span>)
    <span class="hljs-keyword">const</span> index = watcherQueue.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>
    <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">cb</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>)
      watcherQueue.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>)
    })
  }
}

<span class="hljs-keyword">const</span> mutationMethods = [<span class="hljs-string">'push'</span>, <span class="hljs-string">'pop'</span>, <span class="hljs-string">'shift'</span>, <span class="hljs-string">'unshift'</span>, <span class="hljs-string">'splice'</span>, <span class="hljs-string">'sort'</span>, <span class="hljs-string">'reverse'</span>]
<span class="hljs-keyword">const</span> arrayProto = <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>
<span class="hljs-keyword">const</span> arrayMethods = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(arrayProto)
mutationMethods.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">method</span> =&gt;</span> {
  arrayMethods[method] = <span class="hljs-keyword">function</span>(<span class="hljs-params">...args</span>) {
    <span class="hljs-keyword">if</span> (method === <span class="hljs-string">'push'</span> || method === <span class="hljs-string">'unshift'</span> || method === <span class="hljs-string">'splice'</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">__ob__</span>.<span class="hljs-title function_">observeArray</span>(args)
    }
    <span class="hljs-keyword">const</span> result = arrayProto[method].<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args)
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">__ob__</span>.<span class="hljs-property">dep</span>.<span class="hljs-title function_">notify</span>()
    <span class="hljs-keyword">return</span> result
  }
})
</code></pre>
<h2 data-id="heading-8">å®ç° computed è®¡ç®—å±æ€§</h2>
<p><strong>Vue ä¸­ computed è®¡ç®—å±æ€§çš„ç‰¹æ€§ï¼š</strong></p>
<p>â€‹		1ã€è®¡ç®—å±æ€§ä¸å­˜åœ¨äº data é€‰é¡¹ä¸­ï¼Œå› æ­¤è®¡ç®—å±æ€§éœ€è¦å•ç‹¬è¿›è¡Œåˆå§‹åŒ–ã€‚</p>
<p>â€‹		2ã€è®¡ç®—å±æ€§çš„å€¼æ˜¯ä¸€ä¸ªå‡½æ•°è¿è¡Œä¹‹åçš„è¿”å›å€¼ã€‚</p>
<p>â€‹		3ã€è®¡ç®—å±æ€§çš„å€¼â€œåªèƒ½å–ï¼Œä¸èƒ½å­˜â€ï¼Œå³è®¡ç®—å±æ€§çš„ setter æ— æ•ˆã€‚</p>
<p>â€‹		4ã€è®¡ç®—å±æ€§æ‰€ä¾èµ–çš„å“åº”å¼å±æ€§çš„å€¼ï¼Œä¸€æ—¦å‘ç”Ÿå˜åŒ–ï¼Œä¾¿ä¼šå¼•èµ·è¯¥è®¡ç®—å±æ€§çš„å€¼ï¼Œä¸€åŒå‘ç”Ÿå˜åŒ–ã€‚</p>
<p>â€‹		5ã€è®¡ç®—å±æ€§æ˜¯<strong>æƒ°æ€§</strong>çš„ï¼šè®¡ç®—å±æ€§æ‰€ä¾èµ–çš„å“åº”å¼å±æ€§çš„å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¸ä¼šç«‹å³å¼•èµ·è¯¥è®¡ç®—å±æ€§çš„å€¼ä¸€åŒå‘ç”Ÿå˜åŒ–ï¼Œè€Œæ˜¯ç­‰åˆ°è¯¥è®¡ç®—å±æ€§çš„å€¼è¢«è·å–æ—¶æ‰ä¼šä½¿å¾— Vue å¯¹å®ƒçš„å€¼è¿›è¡Œé‡æ–°è®¡ç®—ã€‚</p>
<p>â€‹		6ã€è®¡ç®—å±æ€§æ˜¯<strong>ç¼“å­˜</strong>çš„ï¼šå¦‚æœè®¡ç®—å±æ€§æ‰€ä¾èµ–çš„å“åº”å¼å±æ€§çš„å€¼æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œå³ä½¿å¤šæ¬¡è·å–è¯¥è®¡ç®—å±æ€§çš„å€¼ï¼ŒVue ä¹Ÿä¸ä¼šå¯¹è¯¥è®¡ç®—å±æ€§çš„å€¼è¿›è¡Œé‡æ–°è®¡ç®—ã€‚</p>
<p><strong>æ³¨ï¼šå¯¹äºè®¡ç®—å±æ€§ A ä¾èµ–è®¡ç®—å±æ€§ B çš„æƒ…å†µï¼Œä¸‹é¢çš„ä»£ç å¥½åƒå·²ç»å®ç°äº†ï¼Œä½†è¿˜éœ€è¿›ä¸€æ­¥çš„æµ‹è¯•éªŒè¯ã€‚</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Vue</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">options</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span> = options
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initData</span>()
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initComputed</span>()
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initWatch</span>()
  }

  <span class="hljs-title function_">initData</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// TODOï¼šthis.$options.data è¿˜å¯èƒ½æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚</span>
    <span class="hljs-keyword">const</span> data = (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_data</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span>.<span class="hljs-property">data</span>)
    <span class="hljs-keyword">const</span> keys = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(data)
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; keys.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-comment">// æ•°æ®ä»£ç†é€»è¾‘ã€‚</span>
      <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(<span class="hljs-variable language_">this</span>, keys[i], {
        <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">get</span>: <span class="hljs-keyword">function</span> <span class="hljs-title function_">proxyGetter</span>(<span class="hljs-params"/>) {
          <span class="hljs-keyword">return</span> data[keys[i]]
        },
        <span class="hljs-attr">set</span>: <span class="hljs-keyword">function</span> <span class="hljs-title function_">proxySetter</span>(<span class="hljs-params">newValue</span>) {
          data[keys[i]] = newValue
        }
      })
    }

    <span class="hljs-title function_">observe</span>(data)
  }

  <span class="hljs-title function_">initComputed</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> computed = <span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span>.<span class="hljs-property">computed</span>
    <span class="hljs-keyword">if</span> (computed) {
      <span class="hljs-keyword">const</span> keys = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(computed)
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; keys.<span class="hljs-property">length</span>; i++) {
        <span class="hljs-keyword">const</span> watcher = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Watcher</span>(<span class="hljs-variable language_">this</span>, computed[keys[i]], <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {}, { <span class="hljs-attr">lazy</span>: <span class="hljs-literal">true</span> })
        <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(<span class="hljs-variable language_">this</span>, keys[i], {
          <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">get</span>: <span class="hljs-keyword">function</span> <span class="hljs-title function_">computedGetter</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">if</span> (watcher.<span class="hljs-property">dirty</span>) {
              watcher.<span class="hljs-title function_">get</span>()
              watcher.<span class="hljs-property">dirty</span> = <span class="hljs-literal">false</span>
            }
            watcher.<span class="hljs-property">deps</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">dep</span> =&gt;</span> {
              dep.<span class="hljs-title function_">depend</span>()
            })
            <span class="hljs-keyword">return</span> watcher.<span class="hljs-property">value</span>
          },
          <span class="hljs-attr">set</span>: <span class="hljs-keyword">function</span> <span class="hljs-title function_">computedSetter</span>(<span class="hljs-params"/>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'è¯·ä¸è¦ç»™è®¡ç®—å±æ€§èµ‹å€¼!'</span>)
          }
        })
      }
    }
  }

  <span class="hljs-title function_">initWatch</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> watch = <span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span>.<span class="hljs-property">watch</span>
    <span class="hljs-keyword">if</span> (watch) {
      <span class="hljs-keyword">const</span> keys = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(watch)
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; keys.<span class="hljs-property">length</span>; i++) {
        <span class="hljs-variable language_">this</span>.$watch(keys[i], watch[keys[i]])
      }
    }
  }

  $watch(exp, cb) {
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Watcher</span>(<span class="hljs-variable language_">this</span>, exp, cb)
  }

  $set(target, key, value) {
    <span class="hljs-keyword">const</span> type = <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(target)
    <span class="hljs-keyword">if</span> (type !== <span class="hljs-string">'[object Object]'</span> &amp;&amp; type !== <span class="hljs-string">'[object Array]'</span>) {
      <span class="hljs-keyword">return</span>
    }
    <span class="hljs-keyword">if</span> (type === <span class="hljs-string">'[object Array]'</span>) {
      <span class="hljs-keyword">const</span> arratProto = <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>
      <span class="hljs-title function_">observe</span>(value)
      arratProto.<span class="hljs-property">splice</span>.<span class="hljs-title function_">call</span>(target, key, <span class="hljs-number">1</span>, value)
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type === <span class="hljs-string">'[object Object]'</span>) {
      <span class="hljs-title function_">defineReactive</span>(target, key, value)
    }
    <span class="hljs-comment">// è§¦å‘ä¾èµ– target çš„ watchersã€‚</span>
    target.<span class="hljs-property">__ob__</span>.<span class="hljs-property">dep</span>.<span class="hljs-title function_">notify</span>()
  }
}

<span class="hljs-comment">// è§‚å¯Ÿ data æ•°æ®ã€‚</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">observe</span>(<span class="hljs-params">data</span>) {
  <span class="hljs-keyword">const</span> type = <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(data)
  <span class="hljs-keyword">if</span> (type !== <span class="hljs-string">'[object Object]'</span> &amp;&amp; type !== <span class="hljs-string">'[object Array]'</span>) {
    <span class="hljs-keyword">return</span>
  }
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Observer</span>(data)
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Observer</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">data</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dep</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dep</span>()
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(data, <span class="hljs-string">'__ob__'</span>, {
      <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">configurable</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">value</span>: <span class="hljs-variable language_">this</span>,
      <span class="hljs-attr">writable</span>: <span class="hljs-literal">true</span>
    })
    <span class="hljs-keyword">const</span> type = <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(data)
    <span class="hljs-keyword">if</span> (type === <span class="hljs-string">'[object Array]'</span>) {
      data.<span class="hljs-property">__proto__</span> = arrayMethods
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">observeArray</span>(data)
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type === <span class="hljs-string">'[object Object]'</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">walk</span>(data)
    }
  }

  <span class="hljs-title function_">walk</span>(<span class="hljs-params">data</span>) {
    <span class="hljs-keyword">const</span> keys = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(data)
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; keys.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-title function_">defineReactive</span>(data, keys[i], data[keys[i]])
    }
  }

  <span class="hljs-title function_">observeArray</span>(<span class="hljs-params">array</span>) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; array.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-title function_">observe</span>(array[i])
    }
  }
}

<span class="hljs-comment">// å®šä¹‰ obj å¯¹è±¡çš„ key å±æ€§çš„å“åº”å¼ã€‚</span>
<span class="hljs-comment">// è¿™é‡Œåˆ©ç”¨äº†é—­åŒ…ï¼Œä½¿å¾— value å˜é‡ å’Œ dep å¸¸é‡ä¸€ç›´æ²¡æœ‰è¢«åƒåœ¾å›æ”¶ã€‚</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">defineReactive</span>(<span class="hljs-params">obj, key, value</span>) {
  <span class="hljs-keyword">const</span> dep = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dep</span>()

  <span class="hljs-comment">// æ·±åº¦ä¼˜å…ˆéå†ã€‚</span>
  <span class="hljs-keyword">const</span> objKeyOb = <span class="hljs-title function_">observe</span>(value)

  <span class="hljs-keyword">if</span> (objKeyOb &amp;&amp; obj[key] &amp;&amp; obj[key].<span class="hljs-property">__ob__</span>) {
    objKeyOb.<span class="hljs-property">dep</span> = obj[key].<span class="hljs-property">__ob__</span>.<span class="hljs-property">dep</span>
  }

  <span class="hljs-comment">// æ•°æ®åŠ«æŒé€»è¾‘ã€‚</span>
  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(obj, key, {
    <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">get</span>: <span class="hljs-keyword">function</span> <span class="hljs-title function_">reactiveGetter</span>(<span class="hljs-params"/>) {
      <span class="hljs-comment">// è®¢é˜…é€»è¾‘ã€‚</span>
      dep.<span class="hljs-title function_">depend</span>()
      <span class="hljs-keyword">if</span> (objKeyOb) {
        objKeyOb.<span class="hljs-property">dep</span>.<span class="hljs-title function_">depend</span>()
      }
      <span class="hljs-keyword">return</span> value
    },
    <span class="hljs-attr">set</span>: <span class="hljs-keyword">function</span> <span class="hljs-title function_">reactiveSetter</span>(<span class="hljs-params">newValue</span>) {
      <span class="hljs-keyword">if</span> (value === newValue) {
        <span class="hljs-keyword">return</span>
      }
      <span class="hljs-comment">// å‘å¸ƒé€»è¾‘ã€‚</span>
      dep.<span class="hljs-title function_">notify</span>()
      <span class="hljs-keyword">const</span> objKeyOb = <span class="hljs-title function_">observe</span>(newValue)
      <span class="hljs-keyword">if</span> (objKeyOb &amp;&amp; obj[key] &amp;&amp; obj[key].<span class="hljs-property">__ob__</span>) {
        objKeyOb.<span class="hljs-property">dep</span> = obj[key].<span class="hljs-property">__ob__</span>.<span class="hljs-property">dep</span>
      }
      value = newValue
    }
  })
}

<span class="hljs-comment">// â€œç­â€è¢«æŠ½è±¡æˆäº† Dep å®ä¾‹ã€‚</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Dep</span> {
  <span class="hljs-comment">// å“åº”å¼å±æ€§å½“å‰è¦è®¢é˜…çš„ watcherã€‚</span>
  <span class="hljs-keyword">static</span> target = <span class="hljs-literal">null</span>

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// å“åº”å¼å±æ€§å·²è®¢é˜…çš„ watcher åˆ—è¡¨ã€‚</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">subs</span> = []
  }

  <span class="hljs-title function_">depend</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Dep</span>.<span class="hljs-property">target</span>) {
      <span class="hljs-title class_">Dep</span>.<span class="hljs-property">target</span>.<span class="hljs-title function_">addDep</span>(<span class="hljs-variable language_">this</span>)
    }
  }

  <span class="hljs-title function_">addSub</span>(<span class="hljs-params">watcher</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">subs</span>.<span class="hljs-title function_">indexOf</span>(watcher) !== -<span class="hljs-number">1</span>) {
      <span class="hljs-keyword">return</span>
    }
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">subs</span>.<span class="hljs-title function_">push</span>(watcher)
  }

  <span class="hljs-title function_">notify</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">subs</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">watcher</span> =&gt;</span> {
      watcher.<span class="hljs-title function_">update</span>()
    })
  }
}

<span class="hljs-comment">// å›è°ƒå‡½æ•°è¢«åŒ…è£…æˆäº† Watcher å®ä¾‹ã€‚</span>
<span class="hljs-comment">// TODOï¼šæš‚æ—¶åªå®ç°äº†å¯¹ vm.$options.data å¯¹è±¡çš„ç¬¬ä¸€å±‚å±æ€§çš„ç›‘å¬ã€‚</span>
<span class="hljs-keyword">const</span> watcherQueue = []
<span class="hljs-keyword">let</span> watcherId = <span class="hljs-number">0</span>
<span class="hljs-keyword">const</span> targetStack = []
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Watcher</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">vm, exp, cb, options = {}</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = ++watcherId
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span> = vm
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">exp</span> = exp
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">cb</span> = cb
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">deps</span> = []
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = <span class="hljs-literal">null</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">lazy</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">dirty</span> = !!options.<span class="hljs-property">lazy</span>
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">lazy</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">get</span>()
    }
  }

  <span class="hljs-title function_">get</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Dep</span>.<span class="hljs-property">target</span> = <span class="hljs-variable language_">this</span>
    targetStack.<span class="hljs-title function_">push</span>(<span class="hljs-variable language_">this</span>)
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">exp</span> === <span class="hljs-string">'function'</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">exp</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>)
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">exp</span>]
    }
    targetStack.<span class="hljs-title function_">pop</span>()
    <span class="hljs-keyword">if</span> (targetStack.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-title class_">Dep</span>.<span class="hljs-property">target</span> = targetStack[targetStack.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>]
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-title class_">Dep</span>.<span class="hljs-property">target</span> = <span class="hljs-literal">null</span>
    }
  }

  <span class="hljs-title function_">addDep</span>(<span class="hljs-params">dep</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">deps</span>.<span class="hljs-title function_">indexOf</span>(dep) !== -<span class="hljs-number">1</span>) {
      <span class="hljs-keyword">return</span>
    }
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">deps</span>.<span class="hljs-title function_">push</span>(dep)
    dep.<span class="hljs-title function_">addSub</span>(<span class="hljs-variable language_">this</span>)
  }

  <span class="hljs-title function_">update</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">lazy</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">dirty</span> = <span class="hljs-literal">true</span>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">run</span>()
    }
  }

  <span class="hljs-title function_">run</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (watcherQueue.<span class="hljs-title function_">indexOf</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span>) !== -<span class="hljs-number">1</span>) {
      <span class="hljs-comment">// ç±»ä¼¼äº JavaScript ä¸­çš„é˜²æŠ–é€»è¾‘ã€‚</span>
      <span class="hljs-keyword">return</span>
    }
    watcherQueue.<span class="hljs-title function_">push</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span>)
    <span class="hljs-keyword">const</span> index = watcherQueue.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>
    <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// æ›´æ–° this.value(watcher.value) çš„å€¼ã€‚</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">get</span>()
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">cb</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>)
      watcherQueue.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>)
    })
  }
}

<span class="hljs-keyword">const</span> mutationMethods = [<span class="hljs-string">'push'</span>, <span class="hljs-string">'pop'</span>, <span class="hljs-string">'shift'</span>, <span class="hljs-string">'unshift'</span>, <span class="hljs-string">'splice'</span>, <span class="hljs-string">'sort'</span>, <span class="hljs-string">'reverse'</span>]
<span class="hljs-keyword">const</span> arrayProto = <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>
<span class="hljs-keyword">const</span> arrayMethods = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(arrayProto)
mutationMethods.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">method</span> =&gt;</span> {
  arrayMethods[method] = <span class="hljs-keyword">function</span>(<span class="hljs-params">...args</span>) {
    <span class="hljs-keyword">if</span> (method === <span class="hljs-string">'push'</span> || method === <span class="hljs-string">'unshift'</span> || method === <span class="hljs-string">'splice'</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">__ob__</span>.<span class="hljs-title function_">observeArray</span>(args)
    }
    <span class="hljs-keyword">const</span> result = arrayProto[method].<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args)
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">__ob__</span>.<span class="hljs-property">dep</span>.<span class="hljs-title function_">notify</span>()
    <span class="hljs-keyword">return</span> result
  }
})
</code></pre>
<h2 data-id="heading-9">Vue æ¨¡æ¿å“åº”å¼æ›´æ–°çš„åŸç†</h2>
<p>â€‹		Vue å¯¹æ¨¡æ¿çš„å“åº”å¼æ›´æ–°ï¼Œå°±æ˜¯å¦‚åŒä»£ç ä¸­çš„ initRenderWatch æ–¹æ³•è¿™æ ·åšçš„ã€‚åœ¨ Vue ä¸­ï¼Œå“åº”å¼æ›´æ–°æ¨¡æ¿çš„ watcher è¢«ç§°ä¸º render watcherï¼Œè¯¥ watcher çš„æ±‚å€¼å‡½æ•°æ¯”ä»£ç ä¸­çš„ initRenderWatch æ–¹æ³•ä¸­çš„ watcher çš„æ±‚å€¼å‡½æ•°å¤æ‚çš„å¤šã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Vue</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">options</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span> = options
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initData</span>()
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initComputed</span>()
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initWatch</span>()
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initRenderWatch</span>()
  }

  <span class="hljs-title function_">initData</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// TODOï¼šthis.$options.data è¿˜å¯èƒ½æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚</span>
    <span class="hljs-keyword">const</span> data = (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_data</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span>.<span class="hljs-property">data</span>)
    <span class="hljs-keyword">const</span> keys = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(data)
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; keys.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-comment">// æ•°æ®ä»£ç†é€»è¾‘ã€‚</span>
      <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(<span class="hljs-variable language_">this</span>, keys[i], {
        <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">get</span>: <span class="hljs-keyword">function</span> <span class="hljs-title function_">proxyGetter</span>(<span class="hljs-params"/>) {
          <span class="hljs-keyword">return</span> data[keys[i]]
        },
        <span class="hljs-attr">set</span>: <span class="hljs-keyword">function</span> <span class="hljs-title function_">proxySetter</span>(<span class="hljs-params">newValue</span>) {
          data[keys[i]] = newValue
        }
      })
    }

    <span class="hljs-title function_">observe</span>(data)
  }

  <span class="hljs-title function_">initComputed</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> computed = <span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span>.<span class="hljs-property">computed</span>
    <span class="hljs-keyword">if</span> (computed) {
      <span class="hljs-keyword">const</span> keys = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(computed)
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; keys.<span class="hljs-property">length</span>; i++) {
        <span class="hljs-keyword">const</span> watcher = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Watcher</span>(<span class="hljs-variable language_">this</span>, computed[keys[i]], <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {}, { <span class="hljs-attr">lazy</span>: <span class="hljs-literal">true</span> })
        <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(<span class="hljs-variable language_">this</span>, keys[i], {
          <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">get</span>: <span class="hljs-keyword">function</span> <span class="hljs-title function_">computedGetter</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">if</span> (watcher.<span class="hljs-property">dirty</span>) {
              watcher.<span class="hljs-title function_">get</span>()
              watcher.<span class="hljs-property">dirty</span> = <span class="hljs-literal">false</span>
            }
            watcher.<span class="hljs-property">deps</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">dep</span> =&gt;</span> {
              dep.<span class="hljs-title function_">depend</span>()
            })
            <span class="hljs-keyword">return</span> watcher.<span class="hljs-property">value</span>
          },
          <span class="hljs-attr">set</span>: <span class="hljs-keyword">function</span> <span class="hljs-title function_">computedSetter</span>(<span class="hljs-params"/>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'è¯·ä¸è¦ç»™è®¡ç®—å±æ€§èµ‹å€¼!'</span>)
          }
        })
      }
    }
  }

  <span class="hljs-title function_">initWatch</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> watch = <span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span>.<span class="hljs-property">watch</span>
    <span class="hljs-keyword">if</span> (watch) {
      <span class="hljs-keyword">const</span> keys = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(watch)
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; keys.<span class="hljs-property">length</span>; i++) {
        <span class="hljs-variable language_">this</span>.$watch(keys[i], watch[keys[i]])
      }
    }
  }

  <span class="hljs-title function_">initRenderWatch</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Watcher</span>(
      <span class="hljs-variable language_">this</span>,
      <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'#app'</span>).<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`&lt;p&gt;<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>&lt;/p&gt;`</span>
      },
      <span class="hljs-function">() =&gt;</span> {}
    )
  }

  $watch(exp, cb) {
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Watcher</span>(<span class="hljs-variable language_">this</span>, exp, cb)
  }

  $set(target, key, value) {
    <span class="hljs-keyword">const</span> type = <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(target)
    <span class="hljs-keyword">if</span> (type !== <span class="hljs-string">'[object Object]'</span> &amp;&amp; type !== <span class="hljs-string">'[object Array]'</span>) {
      <span class="hljs-keyword">return</span>
    }
    <span class="hljs-keyword">if</span> (type === <span class="hljs-string">'[object Array]'</span>) {
      <span class="hljs-keyword">const</span> arrayProto = <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>
      <span class="hljs-title function_">observe</span>(value)
      arrayProto.<span class="hljs-property">splice</span>.<span class="hljs-title function_">call</span>(target, key, <span class="hljs-number">1</span>, value)
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type === <span class="hljs-string">'[object Object]'</span>) {
      <span class="hljs-title function_">defineReactive</span>(target, key, value)
    }
    <span class="hljs-comment">// è§¦å‘ä¾èµ– target çš„ watchersã€‚</span>
    target.<span class="hljs-property">__ob__</span>.<span class="hljs-property">dep</span>.<span class="hljs-title function_">notify</span>()
  }
}

<span class="hljs-comment">// è§‚å¯Ÿ data æ•°æ®ã€‚</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">observe</span>(<span class="hljs-params">data</span>) {
  <span class="hljs-keyword">const</span> type = <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(data)
  <span class="hljs-keyword">if</span> (type !== <span class="hljs-string">'[object Object]'</span> &amp;&amp; type !== <span class="hljs-string">'[object Array]'</span>) {
    <span class="hljs-keyword">return</span>
  }
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Observer</span>(data)
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Observer</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">data</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dep</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dep</span>()
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(data, <span class="hljs-string">'__ob__'</span>, {
      <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">configurable</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">value</span>: <span class="hljs-variable language_">this</span>,
      <span class="hljs-attr">writable</span>: <span class="hljs-literal">true</span>
    })
    <span class="hljs-keyword">const</span> type = <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(data)
    <span class="hljs-keyword">if</span> (type === <span class="hljs-string">'[object Array]'</span>) {
      data.<span class="hljs-property">__proto__</span> = arrayMethods
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">observeArray</span>(data)
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type === <span class="hljs-string">'[object Object]'</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">walk</span>(data)
    }
  }

  <span class="hljs-title function_">walk</span>(<span class="hljs-params">data</span>) {
    <span class="hljs-keyword">const</span> keys = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(data)
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; keys.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-title function_">defineReactive</span>(data, keys[i], data[keys[i]])
    }
  }

  <span class="hljs-title function_">observeArray</span>(<span class="hljs-params">array</span>) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; array.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-title function_">observe</span>(array[i])
    }
  }
}

<span class="hljs-comment">// å®šä¹‰ obj å¯¹è±¡çš„ key å±æ€§çš„å“åº”å¼ã€‚</span>
<span class="hljs-comment">// è¿™é‡Œåˆ©ç”¨äº†é—­åŒ…ï¼Œä½¿å¾— value å˜é‡ å’Œ dep å¸¸é‡ä¸€ç›´æ²¡æœ‰è¢«åƒåœ¾å›æ”¶ã€‚</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">defineReactive</span>(<span class="hljs-params">obj, key, value</span>) {
  <span class="hljs-keyword">const</span> dep = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dep</span>()

  <span class="hljs-comment">// æ·±åº¦ä¼˜å…ˆéå†ã€‚</span>
  <span class="hljs-keyword">const</span> objKeyOb = <span class="hljs-title function_">observe</span>(value)

  <span class="hljs-keyword">if</span> (objKeyOb &amp;&amp; obj[key] &amp;&amp; obj[key].<span class="hljs-property">__ob__</span>) {
    objKeyOb.<span class="hljs-property">dep</span> = obj[key].<span class="hljs-property">__ob__</span>.<span class="hljs-property">dep</span>
  }

  <span class="hljs-comment">// æ•°æ®åŠ«æŒé€»è¾‘ã€‚</span>
  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(obj, key, {
    <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">get</span>: <span class="hljs-keyword">function</span> <span class="hljs-title function_">reactiveGetter</span>(<span class="hljs-params"/>) {
      <span class="hljs-comment">// è®¢é˜…é€»è¾‘ã€‚</span>
      dep.<span class="hljs-title function_">depend</span>()
      <span class="hljs-keyword">if</span> (objKeyOb) {
        objKeyOb.<span class="hljs-property">dep</span>.<span class="hljs-title function_">depend</span>()
      }
      <span class="hljs-keyword">return</span> value
    },
    <span class="hljs-attr">set</span>: <span class="hljs-keyword">function</span> <span class="hljs-title function_">reactiveSetter</span>(<span class="hljs-params">newValue</span>) {
      <span class="hljs-keyword">if</span> (value === newValue) {
        <span class="hljs-keyword">return</span>
      }
      <span class="hljs-comment">// å‘å¸ƒé€»è¾‘ã€‚</span>
      dep.<span class="hljs-title function_">notify</span>()
      <span class="hljs-keyword">const</span> objKeyOb = <span class="hljs-title function_">observe</span>(newValue)
      <span class="hljs-keyword">if</span> (objKeyOb &amp;&amp; obj[key] &amp;&amp; obj[key].<span class="hljs-property">__ob__</span>) {
        objKeyOb.<span class="hljs-property">dep</span> = obj[key].<span class="hljs-property">__ob__</span>.<span class="hljs-property">dep</span>
      }
      value = newValue
    }
  })
}

<span class="hljs-comment">// â€œç­â€è¢«æŠ½è±¡æˆäº† Dep å®ä¾‹ã€‚</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Dep</span> {
  <span class="hljs-comment">// å“åº”å¼å±æ€§å½“å‰è¦è®¢é˜…çš„ watcherã€‚</span>
  <span class="hljs-keyword">static</span> target = <span class="hljs-literal">null</span>

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// å“åº”å¼å±æ€§å·²è®¢é˜…çš„ watcher åˆ—è¡¨ã€‚</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">subs</span> = []
  }

  <span class="hljs-title function_">depend</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Dep</span>.<span class="hljs-property">target</span>) {
      <span class="hljs-title class_">Dep</span>.<span class="hljs-property">target</span>.<span class="hljs-title function_">addDep</span>(<span class="hljs-variable language_">this</span>)
    }
  }

  <span class="hljs-title function_">addSub</span>(<span class="hljs-params">watcher</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">subs</span>.<span class="hljs-title function_">indexOf</span>(watcher) !== -<span class="hljs-number">1</span>) {
      <span class="hljs-keyword">return</span>
    }
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">subs</span>.<span class="hljs-title function_">push</span>(watcher)
  }

  <span class="hljs-title function_">notify</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">subs</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">watcher</span> =&gt;</span> {
      watcher.<span class="hljs-title function_">update</span>()
    })
  }
}

<span class="hljs-comment">// å›è°ƒå‡½æ•°è¢«åŒ…è£…æˆäº† Watcher å®ä¾‹ã€‚</span>
<span class="hljs-comment">// TODOï¼šæš‚æ—¶åªå®ç°äº†å¯¹ vm.$options.data å¯¹è±¡çš„ç¬¬ä¸€å±‚å±æ€§çš„ç›‘å¬ã€‚</span>
<span class="hljs-keyword">const</span> watcherQueue = []
<span class="hljs-keyword">let</span> watcherId = <span class="hljs-number">0</span>
<span class="hljs-keyword">const</span> targetStack = []
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Watcher</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">vm, exp, cb, options = {}</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = ++watcherId
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span> = vm
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">exp</span> = exp
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">cb</span> = cb
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">deps</span> = []
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = <span class="hljs-literal">null</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">lazy</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">dirty</span> = !!options.<span class="hljs-property">lazy</span>
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">lazy</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">get</span>()
    }
  }

  <span class="hljs-title function_">get</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Dep</span>.<span class="hljs-property">target</span> = <span class="hljs-variable language_">this</span>
    targetStack.<span class="hljs-title function_">push</span>(<span class="hljs-variable language_">this</span>)
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">exp</span> === <span class="hljs-string">'function'</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">exp</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>)
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">exp</span>]
    }
    targetStack.<span class="hljs-title function_">pop</span>()
    <span class="hljs-keyword">if</span> (targetStack.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-title class_">Dep</span>.<span class="hljs-property">target</span> = targetStack[targetStack.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>]
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-title class_">Dep</span>.<span class="hljs-property">target</span> = <span class="hljs-literal">null</span>
    }
  }

  <span class="hljs-title function_">addDep</span>(<span class="hljs-params">dep</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">deps</span>.<span class="hljs-title function_">indexOf</span>(dep) !== -<span class="hljs-number">1</span>) {
      <span class="hljs-keyword">return</span>
    }
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">deps</span>.<span class="hljs-title function_">push</span>(dep)
    dep.<span class="hljs-title function_">addSub</span>(<span class="hljs-variable language_">this</span>)
  }

  <span class="hljs-title function_">update</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">lazy</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">dirty</span> = <span class="hljs-literal">true</span>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">run</span>()
    }
  }

  <span class="hljs-title function_">run</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (watcherQueue.<span class="hljs-title function_">indexOf</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span>) !== -<span class="hljs-number">1</span>) {
      <span class="hljs-comment">// ç±»ä¼¼äº JavaScript ä¸­çš„é˜²æŠ–é€»è¾‘ã€‚</span>
      <span class="hljs-keyword">return</span>
    }
    watcherQueue.<span class="hljs-title function_">push</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span>)
    <span class="hljs-keyword">const</span> index = watcherQueue.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>
    <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// æ›´æ–° this.value(watcher.value) çš„å€¼ã€‚</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">get</span>()
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">cb</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>)
      watcherQueue.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>)
    })
  }
}

<span class="hljs-keyword">const</span> mutationMethods = [<span class="hljs-string">'push'</span>, <span class="hljs-string">'pop'</span>, <span class="hljs-string">'shift'</span>, <span class="hljs-string">'unshift'</span>, <span class="hljs-string">'splice'</span>, <span class="hljs-string">'sort'</span>, <span class="hljs-string">'reverse'</span>]
<span class="hljs-keyword">const</span> arrayProto = <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>
<span class="hljs-keyword">const</span> arrayMethods = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(arrayProto)
mutationMethods.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">method</span> =&gt;</span> {
  arrayMethods[method] = <span class="hljs-keyword">function</span>(<span class="hljs-params">...args</span>) {
    <span class="hljs-keyword">if</span> (method === <span class="hljs-string">'push'</span> || method === <span class="hljs-string">'unshift'</span> || method === <span class="hljs-string">'splice'</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">__ob__</span>.<span class="hljs-title function_">observeArray</span>(args)
    }
    <span class="hljs-keyword">const</span> result = arrayProto[method].<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args)
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">__ob__</span>.<span class="hljs-property">dep</span>.<span class="hljs-title function_">notify</span>()
    <span class="hljs-keyword">return</span> result
  }
})
</code></pre>
<p><strong>Vue å¯¹æ¨¡æ¿å“åº”å¼æ›´æ–°çš„å¤„ç†æ€è·¯åŸºæœ¬å¦‚ä¸‹ï¼š</strong></p>
<p>â€‹		1ã€**æ¨¡æ¿ç¼–è¯‘ï¼š**å¦‚æœä¼ å…¥äº† template æˆ–è€… DOMï¼Œé‚£ä¹ˆåœ¨ Vue å®ä¾‹åŒ–çš„è¿‡ç¨‹ä¸­ï¼ŒVue é¦–å…ˆä¼šæŠŠæ¨¡æ¿å­—ç¬¦ä¸²è½¬åŒ–æˆæ¸²æŸ“å‡½æ•°ï¼ˆvm.$options.renderï¼‰ã€‚</p>
<p>â€‹		2ã€**è™šæ‹Ÿ DOMï¼š**Vue å€ŸåŠ©è¿™ä¸ªæ¸²æŸ“å‡½æ•°å»å“åº”å¼æ›´æ–°æ¨¡æ¿çš„æ—¶å€™ï¼Œå¦‚æœ Vue ç›´æ¥å»æ“ä½œ DOMï¼Œé‚£ä¹ˆä¼šæå¤§çš„æ¶ˆè€—æµè§ˆå™¨çš„æ€§èƒ½ã€‚äºæ˜¯ Vue å¼•å…¥ Virtual-DOM (è™šæ‹Ÿ DOMï¼‰ï¼Œå€ŸåŠ©å®ƒæ¥å®ç°å¯¹ DOM çš„æŒ‰éœ€æ›´æ–°ã€‚</p>
<h2 data-id="heading-10">å®ç°æ¨¡æ¿ç¼–è¯‘</h2>
<p>â€‹		å¦‚æœä¼ å…¥äº† template æˆ–è€… DOMï¼Œé‚£ä¹ˆåœ¨ Vue å®ä¾‹åŒ–çš„è¿‡ç¨‹ä¸­ï¼ŒVue é¦–å…ˆä¼šæŠŠæ¨¡æ¿å­—ç¬¦ä¸²è½¬åŒ–æˆæ¸²æŸ“å‡½æ•°ï¼ˆvm.$options.renderï¼‰ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯ Vue çš„<strong>æ¨¡æ¿ç¼–è¯‘</strong>ã€‚</p>
<p>â€‹		Vue æ¨¡æ¿ç¼–è¯‘çš„æ•´ä½“é€»è¾‘ä¸»è¦åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š1ã€<strong>è§£æå™¨ï¼š<strong>å°†</strong>æ¨¡æ¿å­—ç¬¦ä¸²</strong>è½¬æ¢æˆ <strong>AST</strong>ã€‚2ã€**ä¼˜åŒ–å™¨ï¼š**å¯¹ <strong>AST</strong> è¿›è¡Œé™æ€èŠ‚ç‚¹æ ‡è®°ã€‚ä¸»è¦æ˜¯ä¸ºäº†ä¼˜åŒ–æ¸²æŸ“æ€§èƒ½ã€‚ï¼ˆè¿™é‡Œä¸åšä»‹ç»ï¼‰3ã€**ä»£ç ç”Ÿæˆå™¨ï¼š**å°† <strong>AST</strong> è½¬æ¢æˆ <strong>render</strong> å‡½æ•°ã€‚</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/669c30a84927493da076d122abfcb96b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTAwNjMzMTA0MDg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769845458&amp;x-signature=xg0tLK%2Fl2Rn13BQiwckuL9Kht1s%3D" alt="5.png" width="100%" loading="lazy"/>
<h3 data-id="heading-11"><strong>AST</strong></h3>
<p>â€‹		ASTï¼Œå³æŠ½è±¡è¯­æ³•æ ‘ï¼Œæ˜¯æºä»£ç è¯­æ³•ç»“æ„çš„æŠ½è±¡è¡¨ç¤ºã€‚<a href="https://link.juejin.cn?target=https%3A%2F%2Fastexplorer.net%2F" target="_blank" title="https://astexplorer.net/" ref="nofollow noopener noreferrer">JS AST åœ¨çº¿ç”Ÿæˆ</a></p>
<p>â€‹		Vue ä¸­ AST çš„ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">{
  <span class="hljs-attr">children</span>: [{â€¦}], <span class="hljs-comment">// å¶å­èŠ‚ç‚¹æ²¡æœ‰ children å±æ€§ã€‚</span>
  <span class="hljs-attr">parent</span>: {}, <span class="hljs-comment">// æ ¹èŠ‚ç‚¹çš„ parent å±æ€§çš„å€¼ä¸º undefinedã€‚</span>
  <span class="hljs-attr">tag</span>: <span class="hljs-string">"div"</span>, <span class="hljs-comment">// å…ƒç´ èŠ‚ç‚¹çš„ä¸“å±å±æ€§ã€‚</span>
  <span class="hljs-attr">type</span>: <span class="hljs-number">1</span>, <span class="hljs-comment">// 1ï¼šå…ƒç´ èŠ‚ç‚¹ã€‚2ï¼šå¸¦å˜é‡çš„æ–‡æœ¬èŠ‚ç‚¹ã€‚3ï¼šçº¯æ–‡æœ¬èŠ‚ç‚¹ã€‚</span>
  <span class="hljs-attr">expression</span>:<span class="hljs-string">'"å§“åï¼š" + _s(name)'</span>, <span class="hljs-comment">// æ–‡æœ¬èŠ‚ç‚¹çš„ä¸“å±å±æ€§ã€‚å¦‚æœ type å€¼æ˜¯ 3ï¼Œåˆ™ expression å€¼ä¸º ''ã€‚</span>
  <span class="hljs-attr">text</span>:<span class="hljs-string">'å§“åï¼š{{name}}'</span> <span class="hljs-comment">// æ–‡æœ¬èŠ‚ç‚¹çš„ä¸“å±å±æ€§ã€‚text å€¼ä¸ºæ–‡æœ¬èŠ‚ç‚¹ç¼–è¯‘å‰çš„å­—ç¬¦ä¸²ã€‚</span>
}
</code></pre>
<h3 data-id="heading-12"><strong>è§£æå™¨ï¼ˆparserï¼‰</strong></h3>
<p>â€‹		æºä»£ç è¢«è§£ææˆ AST çš„è¿‡ç¨‹ä¸€èˆ¬åŒ…å«ä¸¤ä¸ªæ­¥éª¤ï¼šè¯æ³•åˆ†æå’Œè¯­æ³•åˆ†æã€‚</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/824e21f1c88f4557b2834a36a61baafe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTAwNjMzMTA0MDg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769845458&amp;x-signature=IVeFpVM4K6V3h91piHvEpQJaIgE%3D" alt="6.png" width="100%" loading="lazy"/>
<p>â€‹		Vue ä¸­çš„è§£æå™¨å¯¹æ¨¡æ¿å­—ç¬¦ä¸²è¿›è¡Œè§£ææ—¶ï¼Œæ˜¯æ¯äº§ç”Ÿä¸€ä¸ª token ä¾¿ä¼šç«‹å³å¯¹è¯¥ token è¿›è¡Œå¤„ç†ï¼Œå³è¯æ³•åˆ†æå’Œè¯­æ³•åˆ†æåŒæ—¶è¿›è¡Œï¼Œæˆ–è€…è¯´æ²¡æœ‰è¯æ³•åˆ†æåªæœ‰è¯­æ³•åˆ†æã€‚</p>
<p>â€‹		ä¸‹é¢ä»¥æœ€å•çº¯çš„ HTML æ¨¡æ¿ä¸ºä¾‹ï¼Œé˜è¿° Vue ä¸­çš„è§£æå™¨å°†æ¨¡æ¿å­—ç¬¦ä¸²è½¬æ¢æˆ AST çš„åŸç†ã€‚ï¼ˆv-modelã€v-bindã€v-ifã€v-forã€@click ä»¥åŠ HTML ä¸­çš„å•æ ‡ç­¾å…ƒç´ ã€DOM å±æ€§ã€HTML æ³¨é‡Šç­‰æƒ…å†µéƒ½ä¸äºˆä»¥è€ƒè™‘ã€‚ï¼‰</p>
<p>â€‹		**è§£ææ€è·¯ï¼š**ä»¥ &lt; ä¸ºæ ‡è¯†ç¬¦ï¼Œä»£è¡¨å¼€å§‹æ ‡ç­¾æˆ–ç»“æŸæ ‡ç­¾ã€‚ä½¿ç”¨æ ˆç»“æ„å»ç»´æŠ¤å½“å‰æ¨¡æ¿è¢«è§£æåˆ°çš„å±‚çº§ã€‚å¦‚æœæ˜¯å¼€å§‹æ ‡ç­¾ï¼Œä»£è¡¨ AST çš„å±‚çº§ push äº†ä¸€å±‚ï¼›å¦‚æœæ˜¯ç»“æŸæ ‡ç­¾ï¼Œä»£è¡¨  AST  çš„å±‚çº§ pop äº†ä¸€å±‚ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">parse</span>(<span class="hljs-params">template</span>) {
  <span class="hljs-keyword">let</span> root = <span class="hljs-literal">null</span>
  <span class="hljs-keyword">let</span> currentParent
  <span class="hljs-keyword">const</span> stack = []

  <span class="hljs-comment">// è·³è¿‡ç©ºç™½å­—ç¬¦ä¸²ã€‚</span>
  template = template.<span class="hljs-title function_">trim</span>()

  <span class="hljs-keyword">while</span> (template) {
    <span class="hljs-keyword">const</span> ltIndex = template.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">'&lt;'</span>)
    <span class="hljs-comment">// ltIndex === -1 çš„æƒ…å†µä¸ä¼šå‡ºç°ã€‚</span>
    <span class="hljs-comment">// ltIndex &gt; 0 æ ‡ç­¾å‰é¢æœ‰æ–‡æœ¬èŠ‚ç‚¹ã€‚</span>
    <span class="hljs-comment">// ltIndex === 0 &amp;&amp; template[ltIndex + 1] !== '/' å¼€å§‹æ ‡ç­¾ã€‚</span>
    <span class="hljs-comment">// ltIndex === 0 &amp;&amp; template[ltIndex + 1] === '/' ç»“æŸæ ‡ç­¾ã€‚</span>
    <span class="hljs-keyword">if</span> (ltIndex &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-comment">// typeï¼š1-å…ƒç´ èŠ‚ç‚¹ï¼›2-å¸¦å˜é‡çš„æ–‡æœ¬èŠ‚ç‚¹ï¼›3-çº¯æ–‡æœ¬èŠ‚ç‚¹ã€‚</span>
      <span class="hljs-keyword">const</span> text = template.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, ltIndex)
      <span class="hljs-keyword">const</span> element = <span class="hljs-title function_">parseText</span>(text)
      element.<span class="hljs-property">parent</span> = currentParent
      <span class="hljs-keyword">if</span> (!currentParent.<span class="hljs-property">children</span>) {
        currentParent.<span class="hljs-property">children</span> = []
      }
      currentParent.<span class="hljs-property">children</span>.<span class="hljs-title function_">push</span>(element)
      template = template.<span class="hljs-title function_">slice</span>(ltIndex)
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ltIndex === <span class="hljs-number">0</span> &amp;&amp; template[ltIndex + <span class="hljs-number">1</span>] !== <span class="hljs-string">'/'</span>) {
      <span class="hljs-keyword">const</span> gtIndex = template.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">'&gt;'</span>)
      <span class="hljs-keyword">const</span> element = {
        <span class="hljs-attr">parent</span>: currentParent, <span class="hljs-comment">// æ ¹èŠ‚ç‚¹çš„ parent å±æ€§å€¼ä¸º undefinedã€‚</span>
        <span class="hljs-attr">tag</span>: template.<span class="hljs-title function_">slice</span>(ltIndex + <span class="hljs-number">1</span>, gtIndex), <span class="hljs-comment">// åªè€ƒè™‘å¼€å§‹æ ‡ç­¾ä¸­æ²¡æœ‰ä»»ä½•å±æ€§çš„æƒ…å†µã€‚</span>
        <span class="hljs-attr">type</span>: <span class="hljs-number">1</span>
      }
      <span class="hljs-keyword">if</span> (currentParent) {
        <span class="hljs-keyword">if</span> (!currentParent.<span class="hljs-property">children</span>) {
          currentParent.<span class="hljs-property">children</span> = []
        }
        currentParent.<span class="hljs-property">children</span>.<span class="hljs-title function_">push</span>(element)
      } <span class="hljs-keyword">else</span> {
        root = element
      }
      currentParent = element
      stack.<span class="hljs-title function_">push</span>(element)
      template = template.<span class="hljs-title function_">slice</span>(gtIndex + <span class="hljs-number">1</span>)
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ltIndex === <span class="hljs-number">0</span> &amp;&amp; template[ltIndex + <span class="hljs-number">1</span>] === <span class="hljs-string">'/'</span>) {
      <span class="hljs-keyword">const</span> gtIndex = template.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">'&gt;'</span>)
      <span class="hljs-comment">// parse å‡½æ•°æ‰§è¡Œå®Œæ¯•å stack å€¼è¢«è®¾ç½®ä¸º []ã€‚</span>
      stack.<span class="hljs-title function_">pop</span>()
      <span class="hljs-comment">// parse å‡½æ•°æ‰§è¡Œå®Œæ¯•å currentParent å€¼è¢«è®¾ç½®ä¸º undefinedã€‚</span>
      currentParent = stack[stack.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>]
      <span class="hljs-comment">// parse å‡½æ•°æ‰§è¡Œå®Œæ¯•å template å€¼è¢«è®¾ç½®ä¸º ''ã€‚</span>
      template = template.<span class="hljs-title function_">slice</span>(gtIndex + <span class="hljs-number">1</span>)
    }
  }

  <span class="hljs-keyword">return</span> root
}

<span class="hljs-comment">// ä»¥ {{ å’Œ }} ä¸ºæ ‡è¯†ç¬¦ï¼ŒæŠŠ text ä¸­çš„ 'å§“åï¼š{{name}}' è½¬æ¢æˆ '"å§“åï¼š" + _s(name)'ã€‚</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">parseText</span>(<span class="hljs-params">text</span>) {
  <span class="hljs-keyword">const</span> originText = text
  <span class="hljs-keyword">const</span> tokens = []
  <span class="hljs-comment">// typeï¼š2-å¸¦å˜é‡çš„æ–‡æœ¬èŠ‚ç‚¹ï¼›3-çº¯æ–‡æœ¬èŠ‚ç‚¹ã€‚</span>
  <span class="hljs-keyword">let</span> type = <span class="hljs-number">3</span>

  <span class="hljs-keyword">while</span> (text) {
    <span class="hljs-keyword">const</span> start = text.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">'{{'</span>)
    <span class="hljs-keyword">const</span> end = text.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">'}}'</span>)
    <span class="hljs-keyword">if</span> (start !== -<span class="hljs-number">1</span>) {
      type = <span class="hljs-number">2</span>
      <span class="hljs-keyword">if</span> (start &gt; <span class="hljs-number">0</span>) {
        tokens.<span class="hljs-title function_">push</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(text.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, start)))
      }
      <span class="hljs-keyword">const</span> exp = text.<span class="hljs-title function_">slice</span>(start + <span class="hljs-number">2</span>, end)
      tokens.<span class="hljs-title function_">push</span>(<span class="hljs-string">`_s(<span class="hljs-subst">${exp}</span>)`</span>)
      text = text.<span class="hljs-title function_">slice</span>(end + <span class="hljs-number">2</span>)
    } <span class="hljs-keyword">else</span> {
      tokens.<span class="hljs-title function_">push</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(text))
      text = <span class="hljs-string">''</span>
    }
  }

  <span class="hljs-keyword">const</span> element = {
    <span class="hljs-attr">parent</span>: <span class="hljs-literal">null</span>,
    type,
    <span class="hljs-attr">expression</span>: type === <span class="hljs-number">2</span> ? tokens.<span class="hljs-title function_">join</span>(<span class="hljs-string">' + '</span>) : <span class="hljs-string">''</span>,
    <span class="hljs-attr">text</span>: originText
  }

  <span class="hljs-keyword">return</span> element
}
</code></pre>
<h3 data-id="heading-13">render</h3>
<p>â€‹		æœ¬å°ç»“ç”Ÿæˆçš„ render å‡½æ•°çš„å‡½æ•°ä½“å­—ç¬¦ä¸²æ˜¯è¿™æ ·çš„ï¼š</p>
<p>â€‹				<strong>'with (this) { return _c("div", {}, [_c("p", {}, [_v("å§“åï¼š" + _s(name))])]) }'ã€‚</strong></p>
<p>â€‹		å…¶ä¸­ _c å‡½æ•°çš„ç¬¬ä¸‰ä¸ªå‚æ•°çš„ç©ºå€¼æ˜¯ []ï¼Œä¸æ˜¯ undefinedã€‚</p>
<h3 data-id="heading-14"><strong>ä»£ç ç”Ÿæˆå™¨ï¼ˆcodegeneratorï¼‰</strong></h3>
<p>â€‹		**ç”Ÿæˆæ€è·¯ï¼š**1ã€éå† ASTï¼Œå¯¹ AST ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹è¿›è¡Œå¤„ç†ã€‚2ã€é‡åˆ°å…ƒç´ èŠ‚ç‚¹ç”Ÿæˆ <strong>_c("æ ‡ç­¾å", å±æ€§å¯¹è±¡, åä»£æ•°ç»„)</strong> æ ¼å¼çš„å­—ç¬¦ä¸²ã€‚ï¼ˆåä»£æ•°ç»„ä¸ºç©ºæ—¶ä¸º []ï¼Œè€Œä¸æ˜¯ undefinedã€‚ï¼‰3ã€é‡åˆ°çº¯æ–‡æœ¬èŠ‚ç‚¹ç”Ÿæˆ <strong>_v("æ–‡æœ¬å­—ç¬¦ä¸²")</strong> æ ¼å¼çš„å­—ç¬¦ä¸²ã€‚4ã€é‡åˆ°å¸¦å˜é‡çš„æ–‡æœ¬èŠ‚ç‚¹ç”Ÿæˆ <strong>_v(_s(å˜é‡å))</strong> æ ¼å¼çš„å­—ç¬¦ä¸²ã€‚5ã€ä¸ºäº†è®©å­—ç¬¦ä¸²ä¸­çš„å˜é‡èƒ½å¤Ÿåœ¨ render å‡½æ•°ä¸­è¢«æ­£å¸¸å–å€¼ï¼Œåœ¨éå†å®Œ AST åï¼Œ å°†ç”Ÿæˆçš„å­—ç¬¦ä¸²æ•´ä½“å¤–åŒ…ä¸€å±‚ <strong>with(this)</strong>ã€‚6ã€å°†ç»è¿‡ with(this) åŒ…è£…å¤„ç†åçš„å­—ç¬¦ä¸²ä½œä¸ºå‡½æ•°ä½“ï¼Œç”Ÿæˆä¸€ä¸ª <strong>render å‡½æ•°</strong>ï¼Œå¹¶å°†è¿™ä¸ª render å‡½æ•°æŒ‚è½½åˆ° <strong>vm.$options</strong> ä¸Šã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å°† AST è½¬æ¢ä¸º render å‡½æ•°çš„å‡½æ•°ä½“çš„å­—ç¬¦ä¸²ã€‚</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">generate</span>(<span class="hljs-params">ast</span>) {
  <span class="hljs-keyword">const</span> code = <span class="hljs-title function_">genNode</span>(ast)
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">render</span>: <span class="hljs-string">`with (this) { return <span class="hljs-subst">${code}</span> }`</span>
  }
}

<span class="hljs-comment">// è½¬æ¢èŠ‚ç‚¹ã€‚</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">genNode</span>(<span class="hljs-params">node</span>) {
  <span class="hljs-keyword">if</span> (node.<span class="hljs-property">type</span> === <span class="hljs-number">1</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">genElement</span>(node)
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">genText</span>(node)
  }
}

<span class="hljs-comment">// è½¬æ¢å…ƒç´ èŠ‚ç‚¹ã€‚</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">genElement</span>(<span class="hljs-params">node</span>) {
  <span class="hljs-keyword">const</span> children = <span class="hljs-title function_">genChildren</span>(node)
  <span class="hljs-comment">// children çš„ç©ºå€¼æ˜¯ '[]'ï¼Œä¸æ˜¯ 'undefined'ã€‚</span>
  <span class="hljs-keyword">const</span> code = <span class="hljs-string">`_c(<span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(node.tag)}</span>, {}, <span class="hljs-subst">${children}</span>)`</span>
  <span class="hljs-keyword">return</span> code
}

<span class="hljs-comment">// è½¬æ¢æ–‡æœ¬èŠ‚ç‚¹ã€‚</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">genText</span>(<span class="hljs-params">node</span>) {
  <span class="hljs-keyword">if</span> (node.<span class="hljs-property">type</span> === <span class="hljs-number">2</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`_v(<span class="hljs-subst">${node.expression}</span>)`</span>
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (node.<span class="hljs-property">type</span> === <span class="hljs-number">3</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`_v(<span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(node.text)}</span>)`</span>
  }
}

<span class="hljs-comment">// è½¬æ¢å…ƒç´ èŠ‚ç‚¹çš„å­èŠ‚ç‚¹åˆ—è¡¨ä¸­çš„å­èŠ‚ç‚¹ã€‚</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">genChildren</span>(<span class="hljs-params">node</span>) {
  <span class="hljs-comment">// node.children çš„ç©ºå€¼ä¸º undefinedã€‚</span>
  <span class="hljs-keyword">if</span> (node.<span class="hljs-property">children</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">'['</span> + node.<span class="hljs-property">children</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">child</span> =&gt;</span> <span class="hljs-title function_">genNode</span>(child)).<span class="hljs-title function_">join</span>(<span class="hljs-string">', '</span>) + <span class="hljs-string">']'</span>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-string">'[]'</span>
  }
}
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Vue</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">options</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span> = options
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initData</span>()
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initComputed</span>()
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initWatch</span>()
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initRenderFunction</span>()
    <span class="hljs-comment">// this.initRenderWatch()</span>
  }

  <span class="hljs-title function_">initData</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// TODOï¼šthis.$options.data è¿˜å¯èƒ½æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚</span>
    <span class="hljs-keyword">const</span> data = (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_data</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span>.<span class="hljs-property">data</span>)
    <span class="hljs-keyword">const</span> keys = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(data)
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; keys.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-comment">// æ•°æ®ä»£ç†é€»è¾‘ã€‚</span>
      <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(<span class="hljs-variable language_">this</span>, keys[i], {
        <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">get</span>: <span class="hljs-keyword">function</span> <span class="hljs-title function_">proxyGetter</span>(<span class="hljs-params"/>) {
          <span class="hljs-keyword">return</span> data[keys[i]]
        },
        <span class="hljs-attr">set</span>: <span class="hljs-keyword">function</span> <span class="hljs-title function_">proxySetter</span>(<span class="hljs-params">newValue</span>) {
          data[keys[i]] = newValue
        }
      })
    }

    <span class="hljs-title function_">observe</span>(data)
  }

  <span class="hljs-title function_">initComputed</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> computed = <span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span>.<span class="hljs-property">computed</span>
    <span class="hljs-keyword">if</span> (computed) {
      <span class="hljs-keyword">const</span> keys = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(computed)
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; keys.<span class="hljs-property">length</span>; i++) {
        <span class="hljs-keyword">const</span> watcher = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Watcher</span>(<span class="hljs-variable language_">this</span>, computed[keys[i]], <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {}, { <span class="hljs-attr">lazy</span>: <span class="hljs-literal">true</span> })
        <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(<span class="hljs-variable language_">this</span>, keys[i], {
          <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">get</span>: <span class="hljs-keyword">function</span> <span class="hljs-title function_">computedGetter</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">if</span> (watcher.<span class="hljs-property">dirty</span>) {
              watcher.<span class="hljs-title function_">get</span>()
              watcher.<span class="hljs-property">dirty</span> = <span class="hljs-literal">false</span>
            }
            watcher.<span class="hljs-property">deps</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">dep</span> =&gt;</span> {
              dep.<span class="hljs-title function_">depend</span>()
            })
            <span class="hljs-keyword">return</span> watcher.<span class="hljs-property">value</span>
          },
          <span class="hljs-attr">set</span>: <span class="hljs-keyword">function</span> <span class="hljs-title function_">computedSetter</span>(<span class="hljs-params"/>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'è¯·ä¸è¦ç»™è®¡ç®—å±æ€§èµ‹å€¼!'</span>)
          }
        })
      }
    }
  }

  <span class="hljs-title function_">initWatch</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> watch = <span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span>.<span class="hljs-property">watch</span>
    <span class="hljs-keyword">if</span> (watch) {
      <span class="hljs-keyword">const</span> keys = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(watch)
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; keys.<span class="hljs-property">length</span>; i++) {
        <span class="hljs-variable language_">this</span>.$watch(keys[i], watch[keys[i]])
      }
    }
  }

  <span class="hljs-title function_">initRenderFunction</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">let</span> template
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span>.<span class="hljs-property">template</span>) {
      template = <span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span>.<span class="hljs-property">template</span>
    } <span class="hljs-keyword">else</span> {
      template = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span>.<span class="hljs-property">el</span>).<span class="hljs-property">outerHtml</span>
    }
    <span class="hljs-keyword">const</span> ast = <span class="hljs-title function_">parse</span>(template)
    <span class="hljs-keyword">const</span> code = <span class="hljs-title function_">generate</span>(ast).<span class="hljs-property">render</span>
    <span class="hljs-comment">// eslint-disable-next-line no-new-func</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span>.<span class="hljs-property">render</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Function</span>(code)
  }

  <span class="hljs-title function_">initRenderWatch</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Watcher</span>(
      <span class="hljs-variable language_">this</span>,
      <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'#app'</span>).<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`&lt;p&gt;<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>&lt;/p&gt;`</span>
      },
      <span class="hljs-function">() =&gt;</span> {}
    )
  }

  $watch(exp, cb) {
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Watcher</span>(<span class="hljs-variable language_">this</span>, exp, cb)
  }

  $set(target, key, value) {
    <span class="hljs-keyword">const</span> type = <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(target)
    <span class="hljs-keyword">if</span> (type !== <span class="hljs-string">'[object Object]'</span> &amp;&amp; type !== <span class="hljs-string">'[object Array]'</span>) {
      <span class="hljs-keyword">return</span>
    }
    <span class="hljs-keyword">if</span> (type === <span class="hljs-string">'[object Array]'</span>) {
      <span class="hljs-keyword">const</span> arratProto = <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>
      <span class="hljs-title function_">observe</span>(value)
      arratProto.<span class="hljs-property">splice</span>.<span class="hljs-title function_">call</span>(target, key, <span class="hljs-number">1</span>, value)
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type === <span class="hljs-string">'[object Object]'</span>) {
      <span class="hljs-title function_">defineReactive</span>(target, key, value)
    }
    <span class="hljs-comment">// è§¦å‘ä¾èµ– target çš„ watchersã€‚</span>
    target.<span class="hljs-property">__ob__</span>.<span class="hljs-property">dep</span>.<span class="hljs-title function_">notify</span>()
  }
}

<span class="hljs-comment">// è§‚å¯Ÿ data æ•°æ®ã€‚</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">observe</span>(<span class="hljs-params">data</span>) {
  <span class="hljs-keyword">const</span> type = <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(data)
  <span class="hljs-keyword">if</span> (type !== <span class="hljs-string">'[object Object]'</span> &amp;&amp; type !== <span class="hljs-string">'[object Array]'</span>) {
    <span class="hljs-keyword">return</span>
  }
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Observer</span>(data)
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Observer</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">data</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dep</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dep</span>()
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(data, <span class="hljs-string">'__ob__'</span>, {
      <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">configurable</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">value</span>: <span class="hljs-variable language_">this</span>,
      <span class="hljs-attr">writable</span>: <span class="hljs-literal">true</span>
    })
    <span class="hljs-keyword">const</span> type = <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(data)
    <span class="hljs-keyword">if</span> (type === <span class="hljs-string">'[object Array]'</span>) {
      data.<span class="hljs-property">__proto__</span> = arrayMethods
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">observeArray</span>(data)
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type === <span class="hljs-string">'[object Object]'</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">walk</span>(data)
    }
  }

  <span class="hljs-title function_">walk</span>(<span class="hljs-params">data</span>) {
    <span class="hljs-keyword">const</span> keys = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(data)
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; keys.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-title function_">defineReactive</span>(data, keys[i], data[keys[i]])
    }
  }

  <span class="hljs-title function_">observeArray</span>(<span class="hljs-params">array</span>) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; array.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-title function_">observe</span>(array[i])
    }
  }
}

<span class="hljs-comment">// å®šä¹‰ obj å¯¹è±¡çš„ key å±æ€§çš„å“åº”å¼ã€‚</span>
<span class="hljs-comment">// è¿™é‡Œåˆ©ç”¨äº†é—­åŒ…ï¼Œä½¿å¾— value å˜é‡ å’Œ dep å¸¸é‡ä¸€ç›´æ²¡æœ‰è¢«åƒåœ¾å›æ”¶ã€‚</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">defineReactive</span>(<span class="hljs-params">obj, key, value</span>) {
  <span class="hljs-keyword">const</span> dep = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dep</span>()

  <span class="hljs-comment">// æ·±åº¦ä¼˜å…ˆéå†ã€‚</span>
  <span class="hljs-keyword">const</span> objKeyOb = <span class="hljs-title function_">observe</span>(value)

  <span class="hljs-keyword">if</span> (objKeyOb &amp;&amp; obj[key] &amp;&amp; obj[key].<span class="hljs-property">__ob__</span>) {
    objKeyOb.<span class="hljs-property">dep</span> = obj[key].<span class="hljs-property">__ob__</span>.<span class="hljs-property">dep</span>
  }

  <span class="hljs-comment">// æ•°æ®åŠ«æŒé€»è¾‘ã€‚</span>
  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(obj, key, {
    <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">get</span>: <span class="hljs-keyword">function</span> <span class="hljs-title function_">reactiveGetter</span>(<span class="hljs-params"/>) {
      <span class="hljs-comment">// è®¢é˜…é€»è¾‘ã€‚</span>
      dep.<span class="hljs-title function_">depend</span>()
      <span class="hljs-keyword">if</span> (objKeyOb) {
        objKeyOb.<span class="hljs-property">dep</span>.<span class="hljs-title function_">depend</span>()
      }
      <span class="hljs-keyword">return</span> value
    },
    <span class="hljs-attr">set</span>: <span class="hljs-keyword">function</span> <span class="hljs-title function_">reactiveSetter</span>(<span class="hljs-params">newValue</span>) {
      <span class="hljs-keyword">if</span> (value === newValue) {
        <span class="hljs-keyword">return</span>
      }
      <span class="hljs-comment">// å‘å¸ƒé€»è¾‘ã€‚</span>
      dep.<span class="hljs-title function_">notify</span>()
      <span class="hljs-keyword">const</span> objKeyOb = <span class="hljs-title function_">observe</span>(newValue)
      <span class="hljs-keyword">if</span> (objKeyOb &amp;&amp; obj[key] &amp;&amp; obj[key].<span class="hljs-property">__ob__</span>) {
        objKeyOb.<span class="hljs-property">dep</span> = obj[key].<span class="hljs-property">__ob__</span>.<span class="hljs-property">dep</span>
      }
      value = newValue
    }
  })
}

<span class="hljs-comment">// â€œç­â€è¢«æŠ½è±¡æˆäº† Dep å®ä¾‹ã€‚</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Dep</span> {
  <span class="hljs-comment">// å“åº”å¼å±æ€§å½“å‰è¦è®¢é˜…çš„ watcherã€‚</span>
  <span class="hljs-keyword">static</span> target = <span class="hljs-literal">null</span>

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// å“åº”å¼å±æ€§å·²è®¢é˜…çš„ watcher åˆ—è¡¨ã€‚</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">subs</span> = []
  }

  <span class="hljs-title function_">depend</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Dep</span>.<span class="hljs-property">target</span>) {
      <span class="hljs-title class_">Dep</span>.<span class="hljs-property">target</span>.<span class="hljs-title function_">addDep</span>(<span class="hljs-variable language_">this</span>)
    }
  }

  <span class="hljs-title function_">addSub</span>(<span class="hljs-params">watcher</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">subs</span>.<span class="hljs-title function_">indexOf</span>(watcher) !== -<span class="hljs-number">1</span>) {
      <span class="hljs-keyword">return</span>
    }
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">subs</span>.<span class="hljs-title function_">push</span>(watcher)
  }

  <span class="hljs-title function_">notify</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">subs</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">watcher</span> =&gt;</span> {
      watcher.<span class="hljs-title function_">update</span>()
    })
  }
}

<span class="hljs-comment">// å›è°ƒå‡½æ•°è¢«åŒ…è£…æˆäº† Watcher å®ä¾‹ã€‚</span>
<span class="hljs-comment">// TODOï¼šæš‚æ—¶åªå®ç°äº†å¯¹ vm.$options.data å¯¹è±¡çš„ç¬¬ä¸€å±‚å±æ€§çš„ç›‘å¬ã€‚</span>
<span class="hljs-keyword">const</span> watcherQueue = []
<span class="hljs-keyword">let</span> watcherId = <span class="hljs-number">0</span>
<span class="hljs-keyword">const</span> targetStack = []
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Watcher</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">vm, exp, cb, options = {}</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = ++watcherId
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span> = vm
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">exp</span> = exp
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">cb</span> = cb
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">deps</span> = []
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = <span class="hljs-literal">null</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">lazy</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">dirty</span> = !!options.<span class="hljs-property">lazy</span>
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">lazy</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">get</span>()
    }
  }

  <span class="hljs-title function_">get</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Dep</span>.<span class="hljs-property">target</span> = <span class="hljs-variable language_">this</span>
    targetStack.<span class="hljs-title function_">push</span>(<span class="hljs-variable language_">this</span>)
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">exp</span> === <span class="hljs-string">'function'</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">exp</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>)
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">exp</span>]
    }
    targetStack.<span class="hljs-title function_">pop</span>()
    <span class="hljs-keyword">if</span> (targetStack.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-title class_">Dep</span>.<span class="hljs-property">target</span> = targetStack[targetStack.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>]
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-title class_">Dep</span>.<span class="hljs-property">target</span> = <span class="hljs-literal">null</span>
    }
  }

  <span class="hljs-title function_">addDep</span>(<span class="hljs-params">dep</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">deps</span>.<span class="hljs-title function_">indexOf</span>(dep) !== -<span class="hljs-number">1</span>) {
      <span class="hljs-keyword">return</span>
    }
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">deps</span>.<span class="hljs-title function_">push</span>(dep)
    dep.<span class="hljs-title function_">addSub</span>(<span class="hljs-variable language_">this</span>)
  }

  <span class="hljs-title function_">update</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">lazy</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">dirty</span> = <span class="hljs-literal">true</span>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">run</span>()
    }
  }

  <span class="hljs-title function_">run</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (watcherQueue.<span class="hljs-title function_">indexOf</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span>) !== -<span class="hljs-number">1</span>) {
      <span class="hljs-comment">// ç±»ä¼¼äº JavaScript ä¸­çš„é˜²æŠ–é€»è¾‘ã€‚</span>
      <span class="hljs-keyword">return</span>
    }
    watcherQueue.<span class="hljs-title function_">push</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span>)
    <span class="hljs-keyword">const</span> index = watcherQueue.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>
    <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// æ›´æ–° this.value(watcher.value) çš„å€¼ã€‚</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">get</span>()
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">cb</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>)
      watcherQueue.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>)
    })
  }
}

<span class="hljs-keyword">const</span> mutationMethods = [<span class="hljs-string">'push'</span>, <span class="hljs-string">'pop'</span>, <span class="hljs-string">'shift'</span>, <span class="hljs-string">'unshift'</span>, <span class="hljs-string">'splice'</span>, <span class="hljs-string">'sort'</span>, <span class="hljs-string">'reverse'</span>]
<span class="hljs-keyword">const</span> arrayProto = <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>
<span class="hljs-keyword">const</span> arrayMethods = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(arrayProto)
mutationMethods.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">method</span> =&gt;</span> {
  arrayMethods[method] = <span class="hljs-keyword">function</span>(<span class="hljs-params">...args</span>) {
    <span class="hljs-keyword">if</span> (method === <span class="hljs-string">'push'</span> || method === <span class="hljs-string">'unshift'</span> || method === <span class="hljs-string">'splice'</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">__ob__</span>.<span class="hljs-title function_">observeArray</span>(args)
    }
    <span class="hljs-keyword">const</span> result = arrayProto[method].<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args)
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">__ob__</span>.<span class="hljs-property">dep</span>.<span class="hljs-title function_">notify</span>()
    <span class="hljs-keyword">return</span> result
  }
})
</code></pre>
<h2 data-id="heading-15">å®ç°è™šæ‹Ÿ DOM</h2>
<h3 data-id="heading-16"><strong>ä»€ä¹ˆæ˜¯è™šæ‹Ÿ DOMï¼Ÿ</strong></h3>
<p>â€‹		çœŸå® DOMã€‚</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
</code></pre>
<p>â€‹		è™šæ‹Ÿ DOMã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript">{
  <span class="hljs-attr">tag</span>: <span class="hljs-string">'ul'</span>,
  <span class="hljs-attr">attrs</span>: {},
  <span class="hljs-attr">children</span>: [
    {
      <span class="hljs-attr">tag</span>: <span class="hljs-string">'li'</span>,
      <span class="hljs-attr">attrs</span>: {},
      <span class="hljs-attr">children</span>: [
        {
          <span class="hljs-attr">tag</span>: <span class="hljs-literal">null</span>,
          <span class="hljs-attr">attrs</span>: {},
          <span class="hljs-attr">children</span>: [], <span class="hljs-comment">// children çš„ç©ºå€¼ä¸º []ã€‚</span>
          <span class="hljs-attr">text</span>: <span class="hljs-string">'1'</span>
        }
      ]
    },
    ......
  ]
}
</code></pre>
<h3 data-id="heading-17"><strong>è™šæ‹Ÿ DOM æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</strong></h3>
<p>â€‹		1ã€**æ€§èƒ½ä¼˜åŒ–ï¼š**å½“æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒVue ä¼šå…ˆåœ¨å†…å­˜ä¸­æ„å»ºè™šæ‹Ÿ DOM æ ‘ï¼Œç„¶åé€šè¿‡æ¯”è¾ƒæ–°æ—§è™šæ‹Ÿ DOM æ ‘çš„å·®å¼‚ï¼Œæœ€ç»ˆåªæ›´æ–°å¿…è¦çš„éƒ¨åˆ†åˆ°çœŸå® DOM æ ‘ä¸­ã€‚è™šæ‹Ÿ DOM çš„ä½¿ç”¨å‡å°‘äº† Vue æ“ä½œçœŸå® DOM çš„æ¬¡æ•°ï¼Œä»è€Œæé«˜äº† Vue æ¸²æŸ“é¡µé¢çš„æ€§èƒ½ã€‚</p>
<p>â€‹		2ã€**è·¨å¹³å°èƒ½åŠ›ï¼š**è™šæ‹Ÿ DOM æ˜¯ä¸€ä¸ªä¸å¹³å°æ— å…³çš„æŠ½è±¡å±‚ï¼Œå®ƒçš„ä½¿ç”¨ä½¿å¾— Vue å¯ä»¥åœ¨æµè§ˆå™¨ã€ç§»åŠ¨ç«¯å’ŒæœåŠ¡ç«¯ï¼ˆä¾‹å¦‚æœåŠ¡ç«¯æ¸²æŸ“æ—¶ï¼‰ç­‰å¤šä¸ªç¯å¢ƒä¸­è¿è¡Œã€‚</p>
<h3 data-id="heading-18"><strong>ç”±æ¸²æŸ“å‡½æ•°ç”Ÿæˆè™šæ‹Ÿ DOM</strong></h3>
<p>â€‹		å®šä¹‰ä¸€ä¸ªç®€å•çš„ VNode ç±»ï¼Œå¹¶å®ç°æ¸²æŸ“å‡½æ•°ä¸­çš„ _cã€_vã€_s å‡½æ•°ã€‚ç„¶åè¿è¡Œ vm.$options.render.call(vm) å³å¯å¾—åˆ°è™šæ‹Ÿ DOMã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">VNode</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">tag, attrs, children, text</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">tag</span> = tag
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">attrs</span> = attrs
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">children</span> = children <span class="hljs-comment">// children çš„ç©ºå€¼ä¸º []ã€‚</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">text</span> = text
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">elm</span> = <span class="hljs-literal">undefined</span>
  }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Vue</span> {
  ......

  <span class="hljs-title function_">_c</span>(<span class="hljs-params">tag, attrs, children</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">VNode</span>(tag, attrs, children)
  }

  <span class="hljs-title function_">_v</span>(<span class="hljs-params">text</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">VNode</span>(undefind, undefind, undefind, text)
  }

  <span class="hljs-title function_">_s</span>(<span class="hljs-params">value</span>) {
    <span class="hljs-keyword">if</span> (value === <span class="hljs-literal">null</span> || value === <span class="hljs-literal">undefined</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> value === <span class="hljs-string">'object'</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(value)
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">String</span>(value)
    }
  }

  ......
}
</code></pre>
<h3 data-id="heading-19"><strong>å®ç° Diff å’Œ Patch</strong></h3>
<p>â€‹		åœ¨ Vue2 ä¸­ï¼ŒDiff å’Œ Patch æ˜¯è™šæ‹Ÿ DOM ç®—æ³•çš„ä¸¤ä¸ªå…³é”®æ­¥éª¤ï¼š1ã€**Diffï¼ˆå·®å¼‚è®¡ç®—ï¼‰ï¼š**Diff æ˜¯æŒ‡å°†æ–°æ—§è™šæ‹Ÿ DOM æ ‘è¿›è¡Œæ¯”è¾ƒï¼Œè¿›è€Œæ‰¾å‡ºå®ƒä»¬ä¹‹é—´çš„å·®å¼‚ï¼›2ã€**Patchï¼ˆè¡¥ä¸åº”ç”¨ï¼‰ï¼š**Patch æ˜¯æŒ‡å°†è¿™äº›å·®å¼‚æ˜ å°„åˆ°çœŸå® DOM æ ‘ä¸Šï¼Œä½¿å¾—çœŸå® DOM æ ‘ä¸æ–°çš„è™šæ‹Ÿ DOM æ ‘ä¿æŒä¸€è‡´ã€‚</p>
<p>â€‹		é€šè¿‡ Diff å’Œ Patch çš„é…åˆï¼ŒVue å¯ä»¥å‡­å€Ÿè¾ƒå°‘æ¬¡æ•°çš„çœŸå® DOM æ“ä½œæ¥å®ç°é«˜æ•ˆåœ°é¡µé¢æ›´æ–°ã€‚</p>
<p>â€‹		æ³¨æ„ï¼ŒVue2 ä¸­çš„è™šæ‹Ÿ DOM ç®—æ³•æ˜¯åŸºäºå…¨é‡æ¯”è¾ƒçš„ï¼Œå³æ¯æ¬¡é¡µé¢æ›´æ–°éƒ½ä¼šå¯¹æ•´ä¸ªè™šæ‹Ÿ DOM æ ‘è¿›è¡Œæ¯”è¾ƒï¼Œè¿™åœ¨å¤§å‹åº”ç”¨ä¸­å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒVue3 å¼•å…¥äº†åŸºäºé™æ€åˆ†æçš„ç¼–è¯‘ä¼˜åŒ–ï¼Œä½¿ç”¨äº†æ›´é«˜æ•ˆçš„å¢é‡æ›´æ–°ç®—æ³•ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Vue</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">options</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span> = options
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$el</span> = <span class="hljs-literal">undefined</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_vnode</span> = <span class="hljs-literal">undefined</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_watcher</span> = <span class="hljs-literal">undefined</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initData</span>()
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initComputed</span>()
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initWatch</span>()
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initRenderFunction</span>()
    <span class="hljs-variable language_">this</span>.$mount(options.<span class="hljs-property">el</span>)
  }

  ......

  <span class="hljs-title function_">initRenderFunction</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">let</span> template
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span>.<span class="hljs-property">template</span>) {
      template = <span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span>.<span class="hljs-property">template</span>
    } <span class="hljs-keyword">else</span> {
      template = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span>.<span class="hljs-property">el</span>).<span class="hljs-property">outerHtml</span>
    }
    <span class="hljs-keyword">const</span> ast = <span class="hljs-title function_">parse</span>(template)
    <span class="hljs-keyword">const</span> code = <span class="hljs-title function_">generate</span>(ast).<span class="hljs-property">render</span>
    <span class="hljs-comment">// eslint-disable-next-line no-new-func</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span>.<span class="hljs-property">render</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Function</span>(code)
  }

  ......

  $mount(el) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$el</span> = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(el)
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_watcher</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Watcher</span>(
      <span class="hljs-variable language_">this</span>,
      <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_update</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span>.<span class="hljs-property">render</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>))
      },
      <span class="hljs-function">() =&gt;</span> {}
    )
  }

  ......

  <span class="hljs-title function_">_update</span>(<span class="hljs-params">vnode</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_vnode</span>) {
      <span class="hljs-title function_">patch</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_vnode</span>, vnode)
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-title function_">patch</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">$el</span>, vnode)
    }
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_vnode</span> = vnode
  }

  ......
}
</code></pre>
<p>â€‹		Vue å¯¹è™šæ‹Ÿ DOM è¿›è¡Œ patch çš„é€»è¾‘åŸºäº <strong>snabbdom</strong> ç®—æ³•ã€‚patch å‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°ï¼šæ—§çš„è™šæ‹Ÿ DOM å’Œæ–°çš„è™šæ‹Ÿ DOMã€‚ï¼ˆä»¥ä¸‹ä»£ç ä¸è€ƒè™‘èŠ‚ç‚¹çš„å±æ€§å’ŒèŠ‚ç‚¹çš„ keyã€‚ï¼‰</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">patch</span>(<span class="hljs-params">oldVnode, newVnode</span>) {
  <span class="hljs-keyword">const</span> el = oldVnode.<span class="hljs-property">elm</span>
  <span class="hljs-keyword">const</span> parent = el.<span class="hljs-property">parentNode</span>

  <span class="hljs-keyword">const</span> isRealElement = oldVnode.<span class="hljs-property">nodeType</span>
  <span class="hljs-keyword">if</span> (isRealElement) {
    parent.<span class="hljs-title function_">replaceChild</span>(<span class="hljs-title function_">createElement</span>(newVnode), oldVnode)
    <span class="hljs-keyword">return</span>
  }

  <span class="hljs-keyword">if</span> (!newVnode) {
    parent.<span class="hljs-title function_">removeChild</span>(el)
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isChange</span>(newVnode, oldVnode)) {
    newVnode.<span class="hljs-property">elm</span> = <span class="hljs-title function_">createElement</span>(newVnode)
    parent.<span class="hljs-title function_">replaceChild</span>(newVnode.<span class="hljs-property">elm</span>, el)
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isChange</span>(newVnode, oldVnode)) {
    <span class="hljs-comment">// æ¸²æŸ“æ€§èƒ½çš„æå‡å°±åœ¨è¿™é‡Œã€‚</span>
    newVnode.<span class="hljs-property">elm</span> = el
    <span class="hljs-keyword">const</span> newLength = newVnode.<span class="hljs-property">children</span>.<span class="hljs-property">length</span>
    <span class="hljs-keyword">const</span> oldLength = oldVnode.<span class="hljs-property">children</span>.<span class="hljs-property">length</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; newLength || i &lt; oldLength; i++) {
      <span class="hljs-keyword">if</span> (i &gt;= oldLength) {
        el.<span class="hljs-title function_">appendChild</span>(<span class="hljs-title function_">createElement</span>(newVnode.<span class="hljs-property">children</span>[i]))
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-title function_">patch</span>(oldVnode.<span class="hljs-property">children</span>[i], newVnode.<span class="hljs-property">children</span>[i])
      }
    }
  }
}

<span class="hljs-comment">// ç”±è™šæ‹Ÿ DOM åˆ›å»ºçœŸå® DOMã€‚</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createElement</span>(<span class="hljs-params">vnode</span>) {
  <span class="hljs-comment">// æ–‡æœ¬èŠ‚ç‚¹ã€‚</span>
  <span class="hljs-keyword">if</span> (!vnode.<span class="hljs-property">tag</span>) {
    <span class="hljs-keyword">const</span> el = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createTextNode</span>(vnode.<span class="hljs-property">text</span>)
    vnode.<span class="hljs-property">elm</span> = el
    <span class="hljs-keyword">return</span> el
  }

  <span class="hljs-comment">// å…ƒç´ èŠ‚ç‚¹ã€‚</span>
  <span class="hljs-keyword">const</span> el = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(vnode.<span class="hljs-property">tag</span>)
  vnode.<span class="hljs-property">elm</span> = el
  <span class="hljs-comment">// åœ¨çˆ¶å­çœŸå® DOM ä¹‹é—´å»ºç«‹å…³ç³»ã€‚</span>
  vnode.<span class="hljs-property">children</span>.<span class="hljs-title function_">map</span>(createElement).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">subEl</span> =&gt;</span> {
    el.<span class="hljs-title function_">appendChild</span>(subEl)
  })
  <span class="hljs-keyword">return</span> el
}

<span class="hljs-comment">// åˆ¤æ–­æ–°çš„è™šæ‹Ÿ DOM ç›¸å¯¹äºæ—§çš„è™šæ‹Ÿ DOM æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ã€‚</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">isChange</span>(<span class="hljs-params">newVnode, oldVnode</span>) {
  <span class="hljs-keyword">return</span> newVnode.<span class="hljs-property">tag</span> !== oldVnode.<span class="hljs-property">tag</span> || newVnode.<span class="hljs-property">text</span> !== oldVnode.<span class="hljs-property">text</span>
}
</code></pre>
<h3 data-id="heading-20"><strong>è™šæ‹Ÿ DOM ä»£ç æ€»ç»“</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Vue</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">options</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span> = options
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$el</span> = <span class="hljs-literal">undefined</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_vnode</span> = <span class="hljs-literal">undefined</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_watcher</span> = <span class="hljs-literal">undefined</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initData</span>()
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initComputed</span>()
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initWatch</span>()
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initRenderFunction</span>()
    <span class="hljs-variable language_">this</span>.$mount(options.<span class="hljs-property">el</span>)
  }

  <span class="hljs-title function_">initData</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// TODOï¼šthis.$options.data è¿˜å¯èƒ½æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚</span>
    <span class="hljs-keyword">const</span> data = (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_data</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span>.<span class="hljs-property">data</span>)
    <span class="hljs-keyword">const</span> keys = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(data)
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; keys.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-comment">// æ•°æ®ä»£ç†é€»è¾‘ã€‚</span>
      <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(<span class="hljs-variable language_">this</span>, keys[i], {
        <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">get</span>: <span class="hljs-keyword">function</span> <span class="hljs-title function_">proxyGetter</span>(<span class="hljs-params"/>) {
          <span class="hljs-keyword">return</span> data[keys[i]]
        },
        <span class="hljs-attr">set</span>: <span class="hljs-keyword">function</span> <span class="hljs-title function_">proxySetter</span>(<span class="hljs-params">newValue</span>) {
          data[keys[i]] = newValue
        }
      })
    }

    <span class="hljs-title function_">observe</span>(data)
  }

  <span class="hljs-title function_">initComputed</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> computed = <span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span>.<span class="hljs-property">computed</span>
    <span class="hljs-keyword">if</span> (computed) {
      <span class="hljs-keyword">const</span> keys = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(computed)
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; keys.<span class="hljs-property">length</span>; i++) {
        <span class="hljs-keyword">const</span> watcher = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Watcher</span>(<span class="hljs-variable language_">this</span>, computed[keys[i]], <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {}, { <span class="hljs-attr">lazy</span>: <span class="hljs-literal">true</span> })
        <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(<span class="hljs-variable language_">this</span>, keys[i], {
          <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">get</span>: <span class="hljs-keyword">function</span> <span class="hljs-title function_">computedGetter</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">if</span> (watcher.<span class="hljs-property">dirty</span>) {
              watcher.<span class="hljs-title function_">get</span>()
              watcher.<span class="hljs-property">dirty</span> = <span class="hljs-literal">false</span>
            }
            watcher.<span class="hljs-property">deps</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">dep</span> =&gt;</span> {
              dep.<span class="hljs-title function_">depend</span>()
            })
            <span class="hljs-keyword">return</span> watcher.<span class="hljs-property">value</span>
          },
          <span class="hljs-attr">set</span>: <span class="hljs-keyword">function</span> <span class="hljs-title function_">computedSetter</span>(<span class="hljs-params"/>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'è¯·ä¸è¦ç»™è®¡ç®—å±æ€§èµ‹å€¼!'</span>)
          }
        })
      }
    }
  }

  <span class="hljs-title function_">initWatch</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> watch = <span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span>.<span class="hljs-property">watch</span>
    <span class="hljs-keyword">if</span> (watch) {
      <span class="hljs-keyword">const</span> keys = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(watch)
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; keys.<span class="hljs-property">length</span>; i++) {
        <span class="hljs-variable language_">this</span>.$watch(keys[i], watch[keys[i]])
      }
    }
  }

  <span class="hljs-title function_">initRenderFunction</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">let</span> template
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span>.<span class="hljs-property">template</span>) {
      template = <span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span>.<span class="hljs-property">template</span>
    } <span class="hljs-keyword">else</span> {
      template = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span>.<span class="hljs-property">el</span>).<span class="hljs-property">outerHtml</span>
    }
    <span class="hljs-keyword">const</span> ast = <span class="hljs-title function_">parse</span>(template)
    <span class="hljs-keyword">const</span> code = <span class="hljs-title function_">generate</span>(ast).<span class="hljs-property">render</span>
    <span class="hljs-comment">// eslint-disable-next-line no-new-func</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span>.<span class="hljs-property">render</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Function</span>(code)
  }

  $watch(exp, cb) {
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Watcher</span>(<span class="hljs-variable language_">this</span>, exp, cb)
  }

  $set(target, key, value) {
    <span class="hljs-keyword">const</span> type = <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(target)
    <span class="hljs-keyword">if</span> (type !== <span class="hljs-string">'[object Object]'</span> &amp;&amp; type !== <span class="hljs-string">'[object Array]'</span>) {
      <span class="hljs-keyword">return</span>
    }
    <span class="hljs-keyword">if</span> (type === <span class="hljs-string">'[object Array]'</span>) {
      <span class="hljs-keyword">const</span> arrayProto = <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>
      <span class="hljs-title function_">observe</span>(value)
      arrayProto.<span class="hljs-property">splice</span>.<span class="hljs-title function_">call</span>(target, key, <span class="hljs-number">1</span>, value)
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type === <span class="hljs-string">'[object Object]'</span>) {
      <span class="hljs-title function_">defineReactive</span>(target, key, value)
    }
    <span class="hljs-comment">// è§¦å‘ä¾èµ– target çš„ watchersã€‚</span>
    target.<span class="hljs-property">__ob__</span>.<span class="hljs-property">dep</span>.<span class="hljs-title function_">notify</span>()
  }

  $mount(el) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$el</span> = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(el)
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_watcher</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Watcher</span>(
      <span class="hljs-variable language_">this</span>,
      <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_update</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span>.<span class="hljs-property">render</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>))
      },
      <span class="hljs-function">() =&gt;</span> {}
    )
  }

  <span class="hljs-title function_">_update</span>(<span class="hljs-params">vnode</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_vnode</span>) {
      <span class="hljs-title function_">patch</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_vnode</span>, vnode)
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-title function_">patch</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">$el</span>, vnode)
    }
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_vnode</span> = vnode
  }

  <span class="hljs-title function_">_c</span>(<span class="hljs-params">tag, attrs, children</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">VNode</span>(tag, attrs, children)
  }

  <span class="hljs-title function_">_v</span>(<span class="hljs-params">text</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">VNode</span>(undefind, undefind, undefind, text)
  }

  <span class="hljs-title function_">_s</span>(<span class="hljs-params">value</span>) {
    <span class="hljs-keyword">if</span> (value === <span class="hljs-literal">null</span> || value === <span class="hljs-literal">undefined</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> value === <span class="hljs-string">'object'</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(value)
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">String</span>(value)
    }
  }
}

<span class="hljs-comment">// è§‚å¯Ÿ data æ•°æ®ã€‚</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">observe</span>(<span class="hljs-params">data</span>) {
  <span class="hljs-keyword">const</span> type = <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(data)
  <span class="hljs-keyword">if</span> (type !== <span class="hljs-string">'[object Object]'</span> &amp;&amp; type !== <span class="hljs-string">'[object Array]'</span>) {
    <span class="hljs-keyword">return</span>
  }
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Observer</span>(data)
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Observer</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">data</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dep</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dep</span>()
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(data, <span class="hljs-string">'__ob__'</span>, {
      <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">configurable</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">value</span>: <span class="hljs-variable language_">this</span>,
      <span class="hljs-attr">writable</span>: <span class="hljs-literal">true</span>
    })
    <span class="hljs-keyword">const</span> type = <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(data)
    <span class="hljs-keyword">if</span> (type === <span class="hljs-string">'[object Array]'</span>) {
      data.<span class="hljs-property">__proto__</span> = arrayMethods
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">observeArray</span>(data)
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type === <span class="hljs-string">'[object Object]'</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">walk</span>(data)
    }
  }

  <span class="hljs-title function_">walk</span>(<span class="hljs-params">data</span>) {
    <span class="hljs-keyword">const</span> keys = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(data)
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; keys.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-title function_">defineReactive</span>(data, keys[i], data[keys[i]])
    }
  }

  <span class="hljs-title function_">observeArray</span>(<span class="hljs-params">array</span>) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; array.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-title function_">observe</span>(array[i])
    }
  }
}

<span class="hljs-comment">// å®šä¹‰ obj å¯¹è±¡çš„ key å±æ€§çš„å“åº”å¼ã€‚</span>
<span class="hljs-comment">// è¿™é‡Œåˆ©ç”¨äº†é—­åŒ…ï¼Œä½¿å¾— value å˜é‡ å’Œ dep å¸¸é‡ä¸€ç›´æ²¡æœ‰è¢«åƒåœ¾å›æ”¶ã€‚</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">defineReactive</span>(<span class="hljs-params">obj, key, value</span>) {
  <span class="hljs-keyword">const</span> dep = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dep</span>()

  <span class="hljs-comment">// æ·±åº¦ä¼˜å…ˆéå†ã€‚</span>
  <span class="hljs-keyword">const</span> objKeyOb = <span class="hljs-title function_">observe</span>(value)

  <span class="hljs-keyword">if</span> (objKeyOb &amp;&amp; obj[key] &amp;&amp; obj[key].<span class="hljs-property">__ob__</span>) {
    objKeyOb.<span class="hljs-property">dep</span> = obj[key].<span class="hljs-property">__ob__</span>.<span class="hljs-property">dep</span>
  }

  <span class="hljs-comment">// æ•°æ®åŠ«æŒé€»è¾‘ã€‚</span>
  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(obj, key, {
    <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">get</span>: <span class="hljs-keyword">function</span> <span class="hljs-title function_">reactiveGetter</span>(<span class="hljs-params"/>) {
      <span class="hljs-comment">// è®¢é˜…é€»è¾‘ã€‚</span>
      dep.<span class="hljs-title function_">depend</span>()
      <span class="hljs-keyword">if</span> (objKeyOb) {
        objKeyOb.<span class="hljs-property">dep</span>.<span class="hljs-title function_">depend</span>()
      }
      <span class="hljs-keyword">return</span> value
    },
    <span class="hljs-attr">set</span>: <span class="hljs-keyword">function</span> <span class="hljs-title function_">reactiveSetter</span>(<span class="hljs-params">newValue</span>) {
      <span class="hljs-keyword">if</span> (value === newValue) {
        <span class="hljs-keyword">return</span>
      }
      <span class="hljs-comment">// å‘å¸ƒé€»è¾‘ã€‚</span>
      dep.<span class="hljs-title function_">notify</span>()
      <span class="hljs-keyword">const</span> objKeyOb = <span class="hljs-title function_">observe</span>(newValue)
      <span class="hljs-keyword">if</span> (objKeyOb &amp;&amp; obj[key] &amp;&amp; obj[key].<span class="hljs-property">__ob__</span>) {
        objKeyOb.<span class="hljs-property">dep</span> = obj[key].<span class="hljs-property">__ob__</span>.<span class="hljs-property">dep</span>
      }
      value = newValue
    }
  })
}

<span class="hljs-comment">// â€œç­â€è¢«æŠ½è±¡æˆäº† Dep å®ä¾‹ã€‚</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Dep</span> {
  <span class="hljs-comment">// å“åº”å¼å±æ€§å½“å‰è¦è®¢é˜…çš„ watcherã€‚</span>
  <span class="hljs-keyword">static</span> target = <span class="hljs-literal">null</span>

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// å“åº”å¼å±æ€§å·²è®¢é˜…çš„ watcher åˆ—è¡¨ã€‚</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">subs</span> = []
  }

  <span class="hljs-title function_">depend</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Dep</span>.<span class="hljs-property">target</span>) {
      <span class="hljs-title class_">Dep</span>.<span class="hljs-property">target</span>.<span class="hljs-title function_">addDep</span>(<span class="hljs-variable language_">this</span>)
    }
  }

  <span class="hljs-title function_">addSub</span>(<span class="hljs-params">watcher</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">subs</span>.<span class="hljs-title function_">indexOf</span>(watcher) !== -<span class="hljs-number">1</span>) {
      <span class="hljs-keyword">return</span>
    }
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">subs</span>.<span class="hljs-title function_">push</span>(watcher)
  }

  <span class="hljs-title function_">notify</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">subs</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">watcher</span> =&gt;</span> {
      watcher.<span class="hljs-title function_">update</span>()
    })
  }
}

<span class="hljs-comment">// å›è°ƒå‡½æ•°è¢«åŒ…è£…æˆäº† Watcher å®ä¾‹ã€‚</span>
<span class="hljs-comment">// TODOï¼šæš‚æ—¶åªå®ç°äº†å¯¹ vm.$options.data å¯¹è±¡çš„ç¬¬ä¸€å±‚å±æ€§çš„ç›‘å¬ã€‚</span>
<span class="hljs-keyword">const</span> watcherQueue = []
<span class="hljs-keyword">let</span> watcherId = <span class="hljs-number">0</span>
<span class="hljs-keyword">const</span> targetStack = []
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Watcher</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">vm, exp, cb, options = {}</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = ++watcherId
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span> = vm
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">exp</span> = exp
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">cb</span> = cb
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">deps</span> = []
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = <span class="hljs-literal">null</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">lazy</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">dirty</span> = !!options.<span class="hljs-property">lazy</span>
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">lazy</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">get</span>()
    }
  }

  <span class="hljs-title function_">get</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Dep</span>.<span class="hljs-property">target</span> = <span class="hljs-variable language_">this</span>
    targetStack.<span class="hljs-title function_">push</span>(<span class="hljs-variable language_">this</span>)
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">exp</span> === <span class="hljs-string">'function'</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">exp</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>)
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">exp</span>]
    }
    targetStack.<span class="hljs-title function_">pop</span>()
    <span class="hljs-keyword">if</span> (targetStack.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-title class_">Dep</span>.<span class="hljs-property">target</span> = targetStack[targetStack.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>]
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-title class_">Dep</span>.<span class="hljs-property">target</span> = <span class="hljs-literal">null</span>
    }
  }

  <span class="hljs-title function_">addDep</span>(<span class="hljs-params">dep</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">deps</span>.<span class="hljs-title function_">indexOf</span>(dep) !== -<span class="hljs-number">1</span>) {
      <span class="hljs-keyword">return</span>
    }
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">deps</span>.<span class="hljs-title function_">push</span>(dep)
    dep.<span class="hljs-title function_">addSub</span>(<span class="hljs-variable language_">this</span>)
  }

  <span class="hljs-title function_">update</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">lazy</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">dirty</span> = <span class="hljs-literal">true</span>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">run</span>()
    }
  }

  <span class="hljs-title function_">run</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (watcherQueue.<span class="hljs-title function_">indexOf</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span>) !== -<span class="hljs-number">1</span>) {
      <span class="hljs-comment">// ç±»ä¼¼äº JavaScript ä¸­çš„é˜²æŠ–é€»è¾‘ã€‚</span>
      <span class="hljs-keyword">return</span>
    }
    watcherQueue.<span class="hljs-title function_">push</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span>)
    <span class="hljs-keyword">const</span> index = watcherQueue.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>
    <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// æ›´æ–° this.value(watcher.value) çš„å€¼ã€‚</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">get</span>()
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">cb</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>)
      watcherQueue.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>)
    })
  }
}

<span class="hljs-keyword">const</span> mutationMethods = [<span class="hljs-string">'push'</span>, <span class="hljs-string">'pop'</span>, <span class="hljs-string">'shift'</span>, <span class="hljs-string">'unshift'</span>, <span class="hljs-string">'splice'</span>, <span class="hljs-string">'sort'</span>, <span class="hljs-string">'reverse'</span>]
<span class="hljs-keyword">const</span> arrayProto = <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>
<span class="hljs-keyword">const</span> arrayMethods = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(arrayProto)
mutationMethods.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">method</span> =&gt;</span> {
  arrayMethods[method] = <span class="hljs-keyword">function</span>(<span class="hljs-params">...args</span>) {
    <span class="hljs-keyword">if</span> (method === <span class="hljs-string">'push'</span> || method === <span class="hljs-string">'unshift'</span> || method === <span class="hljs-string">'splice'</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">__ob__</span>.<span class="hljs-title function_">observeArray</span>(args)
    }
    <span class="hljs-keyword">const</span> result = arrayProto[method].<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args)
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">__ob__</span>.<span class="hljs-property">dep</span>.<span class="hljs-title function_">notify</span>()
    <span class="hljs-keyword">return</span> result
  }
})

<span class="hljs-keyword">function</span> <span class="hljs-title function_">parse</span>(<span class="hljs-params">template</span>) {
  <span class="hljs-keyword">let</span> root = <span class="hljs-literal">null</span>
  <span class="hljs-keyword">let</span> currentParent
  <span class="hljs-keyword">const</span> stack = []

  <span class="hljs-comment">// è·³è¿‡ç©ºç™½å­—ç¬¦ä¸²ã€‚</span>
  template = template.<span class="hljs-title function_">trim</span>()

  <span class="hljs-keyword">while</span> (template) {
    <span class="hljs-keyword">const</span> ltIndex = template.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">'&lt;'</span>)
    <span class="hljs-comment">// ltIndex === -1 çš„æƒ…å†µä¸ä¼šå‡ºç°ã€‚</span>
    <span class="hljs-comment">// ltIndex &gt; 0 æ ‡ç­¾å‰é¢æœ‰æ–‡æœ¬èŠ‚ç‚¹ã€‚</span>
    <span class="hljs-comment">// ltIndex === 0 &amp;&amp; template[ltIndex + 1] !== '/' å¼€å§‹æ ‡ç­¾ã€‚</span>
    <span class="hljs-comment">// ltIndex === 0 &amp;&amp; template[ltIndex + 1] === '/' ç»“æŸæ ‡ç­¾ã€‚</span>
    <span class="hljs-keyword">if</span> (ltIndex &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-comment">// typeï¼š1-å…ƒç´ èŠ‚ç‚¹ï¼›2-å¸¦å˜é‡çš„æ–‡æœ¬èŠ‚ç‚¹ï¼›3-çº¯æ–‡æœ¬èŠ‚ç‚¹ã€‚</span>
      <span class="hljs-keyword">const</span> text = template.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, ltIndex)
      <span class="hljs-keyword">const</span> element = <span class="hljs-title function_">parseText</span>(text)
      element.<span class="hljs-property">parent</span> = currentParent
      <span class="hljs-keyword">if</span> (!currentParent.<span class="hljs-property">children</span>) {
        currentParent.<span class="hljs-property">children</span> = []
      }
      currentParent.<span class="hljs-property">children</span>.<span class="hljs-title function_">push</span>(element)
      template = template.<span class="hljs-title function_">slice</span>(ltIndex)
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ltIndex === <span class="hljs-number">0</span> &amp;&amp; template[ltIndex + <span class="hljs-number">1</span>] !== <span class="hljs-string">'/'</span>) {
      <span class="hljs-keyword">const</span> gtIndex = template.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">'&gt;'</span>)
      <span class="hljs-keyword">const</span> element = {
        <span class="hljs-attr">parent</span>: currentParent, <span class="hljs-comment">// æ ¹èŠ‚ç‚¹çš„ parent å±æ€§å€¼ä¸º undefinedã€‚</span>
        <span class="hljs-attr">tag</span>: template.<span class="hljs-title function_">slice</span>(ltIndex + <span class="hljs-number">1</span>, gtIndex), <span class="hljs-comment">// åªè€ƒè™‘å¼€å§‹æ ‡ç­¾ä¸­æ²¡æœ‰ä»»ä½•å±æ€§çš„æƒ…å†µã€‚</span>
        <span class="hljs-attr">type</span>: <span class="hljs-number">1</span>
      }
      <span class="hljs-keyword">if</span> (currentParent) {
        <span class="hljs-keyword">if</span> (!currentParent.<span class="hljs-property">children</span>) {
          currentParent.<span class="hljs-property">children</span> = []
        }
        currentParent.<span class="hljs-property">children</span>.<span class="hljs-title function_">push</span>(element)
      } <span class="hljs-keyword">else</span> {
        root = element
      }
      currentParent = element
      stack.<span class="hljs-title function_">push</span>(element)
      template = template.<span class="hljs-title function_">slice</span>(gtIndex + <span class="hljs-number">1</span>)
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ltIndex === <span class="hljs-number">0</span> &amp;&amp; template[ltIndex + <span class="hljs-number">1</span>] === <span class="hljs-string">'/'</span>) {
      <span class="hljs-keyword">const</span> gtIndex = template.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">'&gt;'</span>)
      <span class="hljs-comment">// parse å‡½æ•°æ‰§è¡Œå®Œæ¯•å stack å€¼è¢«è®¾ç½®ä¸º []ã€‚</span>
      stack.<span class="hljs-title function_">pop</span>()
      <span class="hljs-comment">// parse å‡½æ•°æ‰§è¡Œå®Œæ¯•å currentParent å€¼è¢«è®¾ç½®ä¸º undefinedã€‚</span>
      currentParent = stack[stack.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>]
      <span class="hljs-comment">// parse å‡½æ•°æ‰§è¡Œå®Œæ¯•å template å€¼è¢«è®¾ç½®ä¸º ''ã€‚</span>
      template = template.<span class="hljs-title function_">slice</span>(gtIndex + <span class="hljs-number">1</span>)
    }
  }

  <span class="hljs-keyword">return</span> root
}

<span class="hljs-comment">// ä»¥ {{ å’Œ }} ä¸ºæ ‡è¯†ç¬¦ï¼ŒæŠŠ text ä¸­çš„ 'å§“åï¼š{{name}}' è½¬æ¢æˆ '"å§“åï¼š" + _s(name)'ã€‚</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">parseText</span>(<span class="hljs-params">text</span>) {
  <span class="hljs-keyword">const</span> originText = text
  <span class="hljs-keyword">const</span> tokens = []
  <span class="hljs-comment">// typeï¼š2-å¸¦å˜é‡çš„æ–‡æœ¬èŠ‚ç‚¹ï¼›3-çº¯æ–‡æœ¬èŠ‚ç‚¹ã€‚</span>
  <span class="hljs-keyword">let</span> type = <span class="hljs-number">3</span>

  <span class="hljs-keyword">while</span> (text) {
    <span class="hljs-keyword">const</span> start = text.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">'{{'</span>)
    <span class="hljs-keyword">const</span> end = text.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">'}}'</span>)
    <span class="hljs-keyword">if</span> (start !== -<span class="hljs-number">1</span>) {
      type = <span class="hljs-number">2</span>
      <span class="hljs-keyword">if</span> (start &gt; <span class="hljs-number">0</span>) {
        tokens.<span class="hljs-title function_">push</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(text.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, start)))
      }
      <span class="hljs-keyword">const</span> exp = text.<span class="hljs-title function_">slice</span>(start + <span class="hljs-number">2</span>, end)
      tokens.<span class="hljs-title function_">push</span>(<span class="hljs-string">`_s(<span class="hljs-subst">${exp}</span>)`</span>)
      text = text.<span class="hljs-title function_">slice</span>(end + <span class="hljs-number">2</span>)
    } <span class="hljs-keyword">else</span> {
      tokens.<span class="hljs-title function_">push</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(text))
      text = <span class="hljs-string">''</span>
    }
  }

  <span class="hljs-keyword">const</span> element = {
    <span class="hljs-attr">parent</span>: <span class="hljs-literal">null</span>,
    type,
    <span class="hljs-attr">expression</span>: type === <span class="hljs-number">2</span> ? tokens.<span class="hljs-title function_">join</span>(<span class="hljs-string">' + '</span>) : <span class="hljs-string">''</span>,
    <span class="hljs-attr">text</span>: originText
  }

  <span class="hljs-keyword">return</span> element
}

<span class="hljs-comment">// å°† AST è½¬æ¢ä¸º render å‡½æ•°çš„å‡½æ•°ä½“çš„å­—ç¬¦ä¸²ã€‚</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">generate</span>(<span class="hljs-params">ast</span>) {
  <span class="hljs-keyword">const</span> code = <span class="hljs-title function_">genNode</span>(ast)
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">render</span>: <span class="hljs-string">`with (this) { return <span class="hljs-subst">${code}</span> }`</span>
  }
}

<span class="hljs-comment">// è½¬æ¢èŠ‚ç‚¹ã€‚</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">genNode</span>(<span class="hljs-params">node</span>) {
  <span class="hljs-keyword">if</span> (node.<span class="hljs-property">type</span> === <span class="hljs-number">1</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">genElement</span>(node)
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">genText</span>(node)
  }
}

<span class="hljs-comment">// è½¬æ¢å…ƒç´ èŠ‚ç‚¹ã€‚</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">genElement</span>(<span class="hljs-params">node</span>) {
  <span class="hljs-keyword">const</span> children = <span class="hljs-title function_">genChildren</span>(node)
  <span class="hljs-comment">// children çš„ç©ºå€¼æ˜¯ '[]'ï¼Œä¸æ˜¯ 'undefined'ã€‚</span>
  <span class="hljs-keyword">const</span> code = <span class="hljs-string">`_c(<span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(node.tag)}</span>, {}, <span class="hljs-subst">${children}</span>)`</span>
  <span class="hljs-keyword">return</span> code
}

<span class="hljs-comment">// è½¬æ¢æ–‡æœ¬èŠ‚ç‚¹ã€‚</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">genText</span>(<span class="hljs-params">node</span>) {
  <span class="hljs-keyword">if</span> (node.<span class="hljs-property">type</span> === <span class="hljs-number">2</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`_v(<span class="hljs-subst">${node.expression}</span>)`</span>
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (node.<span class="hljs-property">type</span> === <span class="hljs-number">3</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`_v(<span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(node.text)}</span>)`</span>
  }
}

<span class="hljs-comment">// è½¬æ¢å…ƒç´ èŠ‚ç‚¹çš„å­èŠ‚ç‚¹åˆ—è¡¨ä¸­çš„å­èŠ‚ç‚¹ã€‚</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">genChildren</span>(<span class="hljs-params">node</span>) {
  <span class="hljs-comment">// node.children çš„ç©ºå€¼ä¸º undefinedã€‚</span>
  <span class="hljs-keyword">if</span> (node.<span class="hljs-property">children</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">'['</span> + node.<span class="hljs-property">children</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">child</span> =&gt;</span> <span class="hljs-title function_">genNode</span>(child)).<span class="hljs-title function_">join</span>(<span class="hljs-string">', '</span>) + <span class="hljs-string">']'</span>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-string">'[]'</span>
  }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">VNode</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">tag, attrs, children, text</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">tag</span> = tag
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">attrs</span> = attrs
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">children</span> = children <span class="hljs-comment">// children çš„ç©ºå€¼ä¸º []ã€‚</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">text</span> = text
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">elm</span> = <span class="hljs-literal">undefined</span>
  }
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">patch</span>(<span class="hljs-params">oldVnode, newVnode</span>) {
  <span class="hljs-keyword">const</span> el = oldVnode.<span class="hljs-property">elm</span>
  <span class="hljs-keyword">const</span> parent = el.<span class="hljs-property">parentNode</span>

  <span class="hljs-keyword">const</span> isRealElement = oldVnode.<span class="hljs-property">nodeType</span>
  <span class="hljs-keyword">if</span> (isRealElement) {
    parent.<span class="hljs-title function_">replaceChild</span>(<span class="hljs-title function_">createElement</span>(newVnode), oldVnode)
    <span class="hljs-keyword">return</span>
  }

  <span class="hljs-keyword">if</span> (!newVnode) {
    parent.<span class="hljs-title function_">removeChild</span>(el)
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isChange</span>(newVnode, oldVnode)) {
    newVnode.<span class="hljs-property">elm</span> = <span class="hljs-title function_">createElement</span>(newVnode)
    parent.<span class="hljs-title function_">replaceChild</span>(newVnode.<span class="hljs-property">elm</span>, el)
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isChange</span>(newVnode, oldVnode)) {
    <span class="hljs-comment">// æ¸²æŸ“æ€§èƒ½çš„æå‡å°±åœ¨è¿™é‡Œã€‚</span>
    newVnode.<span class="hljs-property">elm</span> = el
    <span class="hljs-keyword">const</span> newLength = newVnode.<span class="hljs-property">children</span>.<span class="hljs-property">length</span>
    <span class="hljs-keyword">const</span> oldLength = oldVnode.<span class="hljs-property">children</span>.<span class="hljs-property">length</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; newLength || i &lt; oldLength; i++) {
      <span class="hljs-keyword">if</span> (i &gt;= oldLength) {
        el.<span class="hljs-title function_">appendChild</span>(<span class="hljs-title function_">createElement</span>(newVnode.<span class="hljs-property">children</span>[i]))
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-title function_">patch</span>(oldVnode.<span class="hljs-property">children</span>[i], newVnode.<span class="hljs-property">children</span>[i])
      }
    }
  }
}

<span class="hljs-comment">// ç”±è™šæ‹Ÿ DOM åˆ›å»ºçœŸå® DOMã€‚</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createElement</span>(<span class="hljs-params">vnode</span>) {
  <span class="hljs-comment">// æ–‡æœ¬èŠ‚ç‚¹ã€‚</span>
  <span class="hljs-keyword">if</span> (!vnode.<span class="hljs-property">tag</span>) {
    <span class="hljs-keyword">const</span> el = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createTextNode</span>(vnode.<span class="hljs-property">text</span>)
    vnode.<span class="hljs-property">elm</span> = el
    <span class="hljs-keyword">return</span> el
  }

  <span class="hljs-comment">// å…ƒç´ èŠ‚ç‚¹ã€‚</span>
  <span class="hljs-keyword">const</span> el = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(vnode.<span class="hljs-property">tag</span>)
  vnode.<span class="hljs-property">elm</span> = el
  <span class="hljs-comment">// åœ¨çˆ¶å­çœŸå® DOM ä¹‹é—´å»ºç«‹å…³ç³»ã€‚</span>
  vnode.<span class="hljs-property">children</span>.<span class="hljs-title function_">map</span>(createElement).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">subEl</span> =&gt;</span> {
    el.<span class="hljs-title function_">appendChild</span>(subEl)
  })
  <span class="hljs-keyword">return</span> el
}

<span class="hljs-comment">// åˆ¤æ–­æ–°çš„è™šæ‹Ÿ DOM ç›¸å¯¹äºæ—§çš„è™šæ‹Ÿ DOM æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ã€‚</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">isChange</span>(<span class="hljs-params">newVnode, oldVnode</span>) {
  <span class="hljs-keyword">return</span> newVnode.<span class="hljs-property">tag</span> !== oldVnode.<span class="hljs-property">tag</span> || newVnode.<span class="hljs-property">text</span> !== oldVnode.<span class="hljs-property">text</span>
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åœ¨ macOS ä¸Šåš OCRï¼šä»æˆªå±åˆ°å¯ç‚¹è¯çš„å®è·µç¬”è®°]]></title>    <link>https://juejin.cn/post/7598435950411104266</link>    <guid>https://juejin.cn/post/7598435950411104266</guid>    <pubDate>2026-01-24T07:38:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598435950411104266" data-draft-id="7598477092196859942" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åœ¨ macOS ä¸Šåš OCRï¼šä»æˆªå±åˆ°å¯ç‚¹è¯çš„å®è·µç¬”è®°"/> <meta itemprop="keywords" content="å‰ç«¯,Swift,macOS"/> <meta itemprop="datePublished" content="2026-01-24T07:38:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¶è½é˜ä¸»"/> <meta itemprop="url" content="https://juejin.cn/user/2189882891714206"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åœ¨ macOS ä¸Šåš OCRï¼šä»æˆªå±åˆ°å¯ç‚¹è¯çš„å®è·µç¬”è®°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2189882891714206/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¶è½é˜ä¸»
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T07:38:57.000Z" title="Sat Jan 24 2026 07:38:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d8cd3b852604356a96eadaa418e61b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-26JC96ZiB5Li7:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769847467&amp;x-signature=uQbt8ybj06GKRFQ%2FadI%2FOtsfDfw%3D" alt="Screenshot 2026-01-24 at 15.37.26.png" loading="lazy"/></p>
<h2 data-id="heading-0">å‰è¨€</h2>
<p>æœ€è¿‘åœ¨å†™ä¸€ä¸ª macOS å¹³å°çš„å¿«é€Ÿç¿»è¯‘è½¯ä»¶ SnapTra Translatorï¼Œæ ¸å¿ƒä½“éªŒæ˜¯â€œæŒ‰ä½å¿«æ·é”®ï¼ŒæŠŠé¼ æ ‡æ‚¬åœåœ¨æ–‡å­—ä¸Šå°±èƒ½çœ‹åˆ°ç¿»è¯‘æ°”æ³¡â€ã€‚è¿™èƒŒåç¦»ä¸å¼€ OCRï¼šå…ˆæŠŠå±å¹•ä¸Šä¸€å°å—åŒºåŸŸæˆªä¸‹æ¥ï¼Œå†ç”¨ Vision æŠŠæ–‡å­—è¯†åˆ«å‡ºæ¥ï¼Œæœ€åæ ¹æ®å…‰æ ‡ä½ç½®é€‰ä¸­æœ€æ¥è¿‘çš„å•è¯ã€‚</p>
<p>è¿™ç¯‡æ–‡ç« æŠŠæˆ‘åœ¨é¡¹ç›®é‡Œçš„å®è·µæ•´ç†æˆä¸€ä»½â€œå¯è½åœ°â€çš„ macOS OCR æŒ‡å—ï¼šæ—¢è®²æ€è·¯ï¼Œä¹Ÿç»™å…³é”®ä»£ç å’Œé¿å‘ç‚¹ã€‚</p>
<h3 data-id="heading-1">ä½ èƒ½å¾—åˆ°ä»€ä¹ˆ</h3>
<ul>
<li>ä¸€ä¸ª macOS OCR çš„å®Œæ•´é“¾è·¯ï¼šæˆªå± â†’ è¯†åˆ« â†’ é€‰è¯ â†’ è°ƒè¯•</li>
<li>å¯ç›´æ¥å¤ç”¨çš„å…³é”®ä»£ç æ®µï¼ˆVision + ScreenCaptureKitï¼‰</li>
<li>çœŸå®é¡¹ç›®é‡Œçš„è®¾è®¡å–èˆä¸å‘ä½</li>
</ul>
<h3 data-id="heading-2">ä¸ºä»€ä¹ˆé€‰æ‹© Vision + ScreenCaptureKit</h3>
<p>åœ¨ macOS ä¸Šåš OCRï¼Œæœ¬è´¨æ˜¯ï¼š</p>
<ol>
<li>æ‹¿åˆ°å±å¹•å›¾åƒï¼ˆéœ€è¦å±å¹•å½•åˆ¶æƒé™ï¼‰</li>
<li>æŠŠå›¾åƒå–‚ç»™ Vision çš„æ–‡æœ¬è¯†åˆ«</li>
<li>æ ¹æ®è¯†åˆ«ç»“æœçš„ bounding box åšäº¤äº’ï¼ˆæ¯”å¦‚â€œå…‰æ ‡é™„è¿‘å–è¯â€ï¼‰</li>
</ol>
<p>Vision æ˜¯ç³»ç»Ÿçº§ OCRï¼Œç¨³å®šã€è½»é‡ã€æ— éœ€é¢å¤–æ¨¡å‹ï¼›ScreenCaptureKit æ˜¯æ›´ç°ä»£çš„æˆªå±æ–¹å¼ï¼Œèƒ½æ›´å¥½æ§åˆ¶é‡‡æ ·åŒºåŸŸä¸æ€§èƒ½ã€‚</p>
<h3 data-id="heading-3">SnapTra çš„ OCR é“¾è·¯æ¦‚è§ˆ</h3>
<p>æˆ‘åœ¨ SnapTra Translator é‡Œé‡‡ç”¨äº†â€œå…‰æ ‡å‘¨å›´å°èŒƒå›´æˆªå±â€çš„ç­–ç•¥ï¼š</p>
<ul>
<li>æ¯æ¬¡ç¿»è¯‘åªæˆªå–é¼ æ ‡é™„è¿‘ä¸€å—å›ºå®šå¤§å°åŒºåŸŸï¼ˆé»˜è®¤ 520x140ï¼‰</li>
<li>OCR ç»“æœè¿”å›æ¯è¡Œæ–‡æœ¬ï¼Œå†è¿›ä¸€æ­¥åˆ‡æˆæ›´ç»†çš„å•è¯ token</li>
<li>å°† token çš„ bounding box ä¸é¼ æ ‡ä½ç½®æ¯”å¯¹ï¼Œé€‰ä¸­æœ€æ¥è¿‘çš„è¯</li>
</ul>
<p>è¿™å¥—é“¾è·¯è®©å®ƒèƒ½åšåˆ°â€œç‚¹å“ªç¿»å“ªâ€ï¼Œè€Œä¸æ˜¯æ•´å± OCRã€‚</p>
<h3 data-id="heading-4">å…³é”®å®ç°ï¼šæˆªå±</h3>
<p>ä¸‹é¢æ˜¯é¡¹ç›®é‡Œæˆªå–å…‰æ ‡å‘¨å›´ç”»é¢çš„æ ¸å¿ƒé€»è¾‘ï¼Œä½¿ç”¨ <code>ScreenCaptureKit</code> è·å–ä¸€å¼  <code>CGImage</code>ï¼š</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ScreenCaptureService</span> {
    <span class="hljs-keyword">let</span> captureSize <span class="hljs-operator">=</span> <span class="hljs-type">CGSize</span>(width: <span class="hljs-number">520</span>, height: <span class="hljs-number">140</span>)

    <span class="hljs-keyword">func</span> <span class="hljs-title function_">captureAroundCursor</span>() <span class="hljs-keyword">async</span> -&gt; (image: <span class="hljs-type">CGImage</span>, region: <span class="hljs-type">CaptureRegion</span>)<span class="hljs-operator">?</span> {
        <span class="hljs-keyword">let</span> mouseLocation <span class="hljs-operator">=</span> <span class="hljs-type">NSEvent</span>.mouseLocation
        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> screen <span class="hljs-operator">=</span> <span class="hljs-type">NSScreen</span>.screens.first(where: { <span class="hljs-type">NSMouseInRect</span>(mouseLocation, <span class="hljs-variable">$0</span>.frame, <span class="hljs-literal">false</span>) }) <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
        }
        <span class="hljs-keyword">let</span> rectInScreen <span class="hljs-operator">=</span> captureRect(for: mouseLocation, in: screen.frame, size: captureSize)
        <span class="hljs-keyword">let</span> cgRect <span class="hljs-operator">=</span> convertToDisplayLocalCoordinates(rectInScreen, screen: screen)

        <span class="hljs-keyword">let</span> display <span class="hljs-operator">=</span> <span class="hljs-keyword">try</span> <span class="hljs-keyword">await</span> getDisplay(for: displayID)
        <span class="hljs-keyword">let</span> filter <span class="hljs-operator">=</span> <span class="hljs-type">SCContentFilter</span>(display: display, excludingWindows: [])
        <span class="hljs-keyword">let</span> configuration <span class="hljs-operator">=</span> makeConfiguration(for: cgRect, scaleFactor: screen.backingScaleFactor)
        <span class="hljs-keyword">let</span> image <span class="hljs-operator">=</span> <span class="hljs-keyword">try</span> <span class="hljs-keyword">await</span> <span class="hljs-type">SCScreenshotManager</span>.captureImage(contentFilter: filter, configuration: configuration)
        <span class="hljs-keyword">return</span> (image, <span class="hljs-type">CaptureRegion</span>(rect: rectInScreen, screen: screen, displayID: displayID, scaleFactor: scaleFactor))
    }
}
</code></pre>
<p>è¿™æ®µä»£ç çš„é‡ç‚¹æ˜¯ï¼šåªæŠ“ä¸€ä¸ªå°çŸ©å½¢åŒºåŸŸï¼Œä¸åšæ•´å±æˆªå›¾ï¼Œæ€§èƒ½ä¼šå¥½å¾ˆå¤šã€‚</p>
<h3 data-id="heading-5">å…³é”®å®ç°ï¼šOCR è¯†åˆ«</h3>
<p>Vision çš„è¯†åˆ«éƒ¨åˆ†éå¸¸ç›´æ¥ï¼š</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OCRService</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">recognizeWords</span>(<span class="hljs-params">in</span> <span class="hljs-params">image</span>: <span class="hljs-type">CGImage</span>, <span class="hljs-params">language</span>: <span class="hljs-type">String</span>) <span class="hljs-keyword">async</span> <span class="hljs-keyword">throws</span> -&gt; [<span class="hljs-type">RecognizedWord</span>] {
        <span class="hljs-keyword">try</span> <span class="hljs-keyword">await</span> <span class="hljs-type">Task</span>.detached(priority: .userInitiated) {
            <span class="hljs-keyword">let</span> request <span class="hljs-operator">=</span> <span class="hljs-type">VNRecognizeTextRequest</span>()
            request.recognitionLevel <span class="hljs-operator">=</span> .accurate
            request.usesLanguageCorrection <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">#available</span>(<span class="hljs-keyword">macOS</span> <span class="hljs-number">13.0</span>, <span class="hljs-operator">*</span>) {
                request.revision <span class="hljs-operator">=</span> <span class="hljs-type">VNRecognizeTextRequestRevision3</span>
                request.automaticallyDetectsLanguage <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>
            } <span class="hljs-keyword">else</span> {
                request.recognitionLanguages <span class="hljs-operator">=</span> [language]
            }

            <span class="hljs-keyword">let</span> handler <span class="hljs-operator">=</span> <span class="hljs-type">VNImageRequestHandler</span>(cgImage: image)
            <span class="hljs-keyword">try</span> handler.perform([request])
            <span class="hljs-keyword">return</span> <span class="hljs-type">OCRService</span>.extractWords(from: request.results <span class="hljs-operator">??</span> [])
        }.value
    }
}
</code></pre>
<p>å‡ ä¸ªå°ç‚¹ï¼š</p>
<ul>
<li><code>recognitionLevel = .accurate</code> é€‚åˆéœ€è¦é«˜ç²¾åº¦çš„ç¿»è¯‘åœºæ™¯</li>
<li>å¼€å¯ <code>usesLanguageCorrection</code> èƒ½æå‡è‹±æ–‡è¯†åˆ«çš„å¯è¯»æ€§</li>
<li>åœ¨ macOS 13+ ç”¨ <code>automaticallyDetectsLanguage</code>ï¼Œå¯ä»¥æ›´è‡ªç„¶åœ°è¯†åˆ«æ··åˆæ–‡æœ¬</li>
</ul>
<h3 data-id="heading-6">å…³é”®å®ç°ï¼šä»è¡Œåˆ°â€œè¯â€</h3>
<p>Vision è¿”å›çš„é€šå¸¸æ˜¯â€œæ–‡æœ¬è¡Œâ€ï¼Œä½†ç¿»è¯‘åœºæ™¯éœ€è¦æ›´ç»†ç²’åº¦ã€‚</p>
<p>SnapTra é‡Œæˆ‘åšäº†ä¸¤æ­¥ï¼š</p>
<ol>
<li>å…ˆæŒ‰è‹±æ–‡å­—ç¬¦æ‹†åˆ† token</li>
<li>å¯¹ CamelCase åšè¿›ä¸€æ­¥åˆ‡åˆ†ï¼ˆæ¯”å¦‚ <code>ApplePay</code> â†’ <code>Apple</code> + <code>Pay</code>ï¼‰</li>
</ol>
<p>åŒæ—¶ï¼Œæˆ‘æ²¡æœ‰ç›´æ¥ä½¿ç”¨ Vision çš„ <code>boundingBox(for:)</code>ï¼Œå› ä¸ºå®ƒå¯¹è‡ªå®šä¹‰åˆ†è¯å¹¶ä¸ç¨³å®šï¼Œè€Œæ˜¯ç”¨â€œå­—ç¬¦æ¯”ä¾‹â€è®¡ç®— boxï¼Œä¿è¯ç¨³å®šæ€§ã€‚</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// å§‹ç»ˆä½¿ç”¨å­—ç¬¦æ¯”ä¾‹è®¡ç®—è¾¹ç•Œæ¡†ï¼Œç¡®ä¿ç¨³å®šæ€§</span>
<span class="hljs-comment">// Vision çš„ boundingBox(for:) å¯¹è‡ªå®šä¹‰åˆ†è¯ï¼ˆCamelCaseï¼‰æ”¯æŒä¸ç¨³å®š</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">boundingBoxByCharacterRatio</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">textBox</span>: <span class="hljs-type">CGRect</span>, <span class="hljs-params">text</span>: <span class="hljs-type">String</span>, <span class="hljs-params">for</span> <span class="hljs-params">range</span>: <span class="hljs-type">Range</span>&lt;<span class="hljs-type">String</span>.<span class="hljs-type">Index</span>&gt;) -&gt; <span class="hljs-type">CGRect</span>? {
    <span class="hljs-keyword">let</span> totalCount <span class="hljs-operator">=</span> text.count
    <span class="hljs-keyword">let</span> startOffset <span class="hljs-operator">=</span> text.distance(from: text.startIndex, to: range.lowerBound)
    <span class="hljs-keyword">let</span> endOffset <span class="hljs-operator">=</span> text.distance(from: text.startIndex, to: range.upperBound)
    <span class="hljs-keyword">let</span> startFraction <span class="hljs-operator">=</span> <span class="hljs-type">CGFloat</span>(startOffset) <span class="hljs-operator">/</span> <span class="hljs-type">CGFloat</span>(totalCount)
    <span class="hljs-keyword">let</span> endFraction <span class="hljs-operator">=</span> <span class="hljs-type">CGFloat</span>(endOffset) <span class="hljs-operator">/</span> <span class="hljs-type">CGFloat</span>(totalCount)
    <span class="hljs-keyword">let</span> x <span class="hljs-operator">=</span> textBox.minX <span class="hljs-operator">+</span> textBox.width <span class="hljs-operator">*</span> startFraction
    <span class="hljs-keyword">let</span> width <span class="hljs-operator">=</span> textBox.width <span class="hljs-operator">*</span> (endFraction <span class="hljs-operator">-</span> startFraction)
    <span class="hljs-keyword">return</span> <span class="hljs-type">CGRect</span>(x: x, y: textBox.minY, width: width, height: textBox.height)
}
</code></pre>
<h3 data-id="heading-7">å¦‚ä½•â€œç‚¹è¯â€ï¼šç”¨é¼ æ ‡ä½ç½®é€‰ä¸­æœ€ç›¸å…³çš„è¯</h3>
<p>OCR çš„è¾“å‡ºæ˜¯å¤šä¸ªå•è¯åŠ  bounding boxã€‚ä¸ºäº†å®ç°â€œé¼ æ ‡æŒ‡å“ªç¿»å“ªâ€ï¼Œæˆ‘åšäº†ä¸¤ä»¶äº‹ï¼š</p>
<ul>
<li>åªä¿ç•™ bounding box åŒ…å«é¼ æ ‡ä½ç½®çš„è¯</li>
<li>å¦‚æœæœ‰å¤šä¸ªå€™é€‰ï¼Œå–ä¸­å¿ƒç‚¹ç¦»é¼ æ ‡æœ€è¿‘çš„</li>
</ul>
<p>è¿™æ ·å¯ä»¥åœ¨å¯†é›†æ–‡æœ¬é‡Œä¹Ÿä¿æŒç¨³å®šä½“éªŒã€‚</p>
<h3 data-id="heading-8">æƒé™ä¸ç³»ç»Ÿè®¾ç½®ï¼šå±å¹•å½•åˆ¶æ˜¯å‰ç½®æ¡ä»¶</h3>
<p>åªè¦æ¶‰åŠå±å¹•æˆªå›¾ï¼Œå°±éœ€è¦ Screen Recording æƒé™ã€‚é¡¹ç›®é‡Œé€šè¿‡ <code>CGPreflightScreenCaptureAccess()</code> åˆ¤æ–­å½“å‰æƒé™ï¼Œå¹¶æä¾›å¿«æ·è·³è½¬ç³»ç»Ÿè®¾ç½®ï¼š</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">func</span> <span class="hljs-title function_">requestAndOpenScreenRecording</span>() {
    <span class="hljs-type">CGRequestScreenCaptureAccess</span>()
    openPrivacyPane(anchor: <span class="hljs-string">"Privacy_ScreenCapture"</span>)
}
</code></pre>
<p>ä½“éªŒä¸Šï¼Œæˆ‘ä¼šåœ¨æƒé™çŠ¶æ€å˜åŒ–åè‡ªåŠ¨åˆ·æ–°ï¼Œå¹¶åœ¨æœªæˆæƒæ—¶æç¤ºç”¨æˆ·ã€‚</p>
<h3 data-id="heading-9">è°ƒè¯•æ‰‹æ®µï¼šæŠŠ OCR åŒºåŸŸç”»å‡ºæ¥</h3>
<p>â€œçœ‹ä¸åˆ°â€æ˜¯ OCR è°ƒè¯•æœ€å¤§çš„é˜»åŠ›ã€‚SnapTra é‡Œåšäº†ä¸€ä¸ª Debug OCR Region å¼€å…³ï¼š</p>
<ul>
<li>çº¢æ¡†æ˜¾ç¤ºå½“å‰æˆªå±åŒºåŸŸ</li>
<li>ç»¿æ¡†æ˜¾ç¤ºæ¯ä¸ªè¯†åˆ«å‡ºæ¥çš„å•è¯è¾¹ç•Œ</li>
</ul>
<p>è¿™å¯ä»¥ç›´è§‚è§‚å¯Ÿâ€œæˆªå±åŒºåŸŸæ˜¯å¦å¯¹é½â€ã€â€œè¯†åˆ«ç»“æœæ˜¯å¦åç§»â€ï¼Œéå¸¸æ¨èåœ¨æ—©æœŸå°±åŠ ä¸Šã€‚</p>
<h3 data-id="heading-10">å¸¸è§å‘ä½ä¸å»ºè®®</h3>
<ol>
<li>ä¸è¦æ•´å± OCRï¼šæ€§èƒ½ä¼šå¾ˆå·®ï¼Œä½“éªŒä¼šå¡</li>
<li>è¯†åˆ«ç»“æœçš„åæ ‡ç³»æ˜¯å½’ä¸€åŒ–åæ ‡ï¼Œè½¬åˆ°å±å¹•åæ ‡è¦æ³¨æ„ y è½´ç¿»è½¬</li>
<li>è¯­è¨€è®¾ç½®ä¸è¦æ­»æ¿ï¼šæ··åˆè¯­è¨€åœºæ™¯å¾ˆå¸¸è§</li>
<li>åˆ†è¯ç­–ç•¥æ¯”ä½ æƒ³è±¡çš„é‡è¦ï¼šç¿»è¯‘å·¥å…·å¯¹è¯ç²’åº¦å¾ˆæ•æ„Ÿ</li>
</ol>
<h3 data-id="heading-11">è½åœ°å°ç»“</h3>
<p>å¦‚æœä½ è¦åšä¸€ä¸ªâ€œå±å¹•å–è¯ + ç¿»è¯‘â€çš„ macOS å·¥å…·ï¼Œæ¨èçš„æœ€å°é“¾è·¯æ˜¯ï¼š</p>
<ol>
<li>ç”¨ ScreenCaptureKit æˆªå–é¼ æ ‡é™„è¿‘å°åŒºåŸŸ</li>
<li>ç”¨ Vision è¯†åˆ«æ–‡æœ¬</li>
<li>è‡ªå·±åšåˆ†è¯ä¸ box ç»†åŒ–</li>
<li>ç”¨é¼ æ ‡ä½ç½®é€‰è¯</li>
<li>åŠ ä¸€ä¸ª Debug OCR Region è§†å›¾ï¼Œè°ƒè¯•æ•ˆç‡ç›´æ¥ç¿»å€</li>
</ol>
<h3 data-id="heading-12">æœ€å</h3>
<p>æˆ‘åœ¨ SnapTra Translator é‡Œè¸©è¿‡çš„å‘ã€åšè¿‡çš„å–èˆï¼Œéƒ½å°½é‡å†™åœ¨ä¸Šé¢äº†ã€‚OCR çœ‹ä¼¼ç®€å•ï¼Œä½†çœŸæ­£è½åœ°åˆ°â€œæ‰‹æ„Ÿå¾ˆå¥½â€çš„äº§å“ï¼Œç»†èŠ‚çœŸçš„å¾ˆå¤šã€‚</p>
<p>å¦‚æœä½ ä¹Ÿåœ¨åš macOS OCR æˆ–ç¿»è¯‘å·¥å…·ï¼Œæ¬¢è¿äº¤æµæƒ³æ³•ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[nuxté…ç½®ä»£ç† å’Œ è¯·æ±‚æ¥å£]]></title>    <link>https://juejin.cn/post/7598532592455598107</link>    <guid>https://juejin.cn/post/7598532592455598107</guid>    <pubDate>2026-01-24T07:45:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598532592455598107" data-draft-id="7598021984300564507" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="nuxté…ç½®ä»£ç† å’Œ è¯·æ±‚æ¥å£"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-24T07:45:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ±Ÿæ¹–æ–‡äºº"/> <meta itemprop="url" content="https://juejin.cn/user/3044986347066480"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            nuxté…ç½®ä»£ç† å’Œ è¯·æ±‚æ¥å£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3044986347066480/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ±Ÿæ¹–æ–‡äºº
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T07:45:07.000Z" title="Sat Jan 24 2026 07:45:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><pre><code class="hljs language-md" lang="md">ä¸€ã€å®‰è£…

npm install @nuxtjs/axios @nuxtjs/proxy -S


// nuxt.config.js
{
  ...
  modules: [
<span class="hljs-code">    '@nuxtjs/axios',
    '@nuxtjs/proxy'
  ],
  axios: {
    // æ˜¯å¦å¯ä»¥è·¨åŸŸ
    proxy: true,
    // retry: { retries: 3 },
    // baseUrl: process.env._ENV == 'production' ? 'xxx' : 'xxx'
  },
  proxy: {
    '/api': {
      target: 'http://localhost:4000',
      pathRewrite: {
        '^/api': ''
      }
    }
  }
}
</span></code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/98cd743e377f40e5a93881b1cfe4db13~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rGf5rmW5paH5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769845507&amp;x-signature=PBKKKb9%2FmIDChl2Sf1im1oRX2Xc%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-0">ç™»å½•&amp;è·å–ä¸ªäººä¿¡æ¯</h2>
<p>axiaosåœ¨é¡¹ç›®ä¸­ä¸€å®šä¼šè¿›è¡ŒäºŒæ¬¡å°è£…çš„ã€‚å°è£…çš„å†…å®¹å¯èƒ½æœ‰æ‰€ä¸åŒã€‚</p>
<pre><code class="hljs language-ts" lang="ts">ç™»å½• æˆ‘çš„ æ–°é—»
</code></pre>
<p>ç‚¹å‡»ç™»å½•ï¼Œå®ƒå°±è·³è½¬åˆ°ç™»å½•é¡µï¼Œé‚£åœ¨ç™»å½•é¡µæˆ‘å°±å¯ä»¥è¾“å…¥è´¦å·æˆ–è€…å¯†ç ã€‚å½“ç„¶ï¼Œåœ¨æ­£å„¿å…«ç»çš„é¡¹ç›®é‡Œé¢ï¼Œå¯èƒ½ä¼šæœ‰æ‰«ç ç™»å½•æˆ–è€…éªŒè¯ç ç­‰ç­‰ã€‚æ‰€ä»¥æˆ‘ä»¬å…ˆåšä¸ªç®€æ˜“ç‰ˆçš„ï¼Œå…ˆæŠŠé€»è¾‘èµ°é€šå…ˆã€‚å°±æ˜¯ç”¨æˆ·åå’Œå¯†ç ç™»å½•ã€‚å¦‚æœè¯´å®ƒè¾“å…¥å†…å®¹ç™»å½•ä¸Šäº†ä»¥åï¼Œå°±éœ€è¦æŠŠtokenè®°å½•ä¸Šã€‚</p>
<p>å­˜å‚¨ä¹‹åï¼Œå¦‚æœè¯´ä»–å·²ç»ç™»å½•äº†ï¼Œé‚£ç‚¹å‡»åˆ°æˆ‘çš„ï¼Œå®ƒå¯ä»¥å±•ç¤ºè¿™ä¸ªç™»å½•è´¦å·çš„ä¸€ä¸ªå¤´åƒæˆ–è€…æ˜µç§°ç­‰ç­‰ä¿¡æ¯ã€‚å¦‚æœè¯´æ²¡æœ‰ç™»å½•ï¼Œç‚¹åˆ°æˆ‘çš„ï¼Œå®ƒä¼šè·³è½¬åˆ°ç™»å½•é¡µï¼Œ</p>
<p>å½“ç„¶æ–°é—»çš„è¯å‘¢ï¼Œæ˜¯ä¸éœ€è¦ç™»å½•çš„ã€‚å°±æ˜¯ç™»å½•æ²¡é‚“æ—’éƒ½å¯ä»¥è¿›å…¥åˆ°æ–°é—»é¡µã€‚</p>
<pre><code class="hljs language-html" lang="html">/pages/index.vue

<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">nuxt-link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/login"</span>&gt;</span>ç™»å½•<span class="hljs-tag">&lt;/<span class="hljs-name">nuxt-link</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">nuxt-link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/my"</span>&gt;</span>æˆ‘çš„<span class="hljs-tag">&lt;/<span class="hljs-name">nuxt-link</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">nuxt-link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/news"</span>&gt;</span>æ–°é—»<span class="hljs-tag">&lt;/<span class="hljs-name">nuxt-link</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'IndexPage'</span>
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>ç™»å½•é¡µ</p>
<pre><code class="hljs language-html" lang="html">// login.vue
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>ç™»å½•é¡µ<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"userName"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"userPwd"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"login"</span>&gt;</span>ç™»å½•<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">userName</span>: <span class="hljs-string">''</span>,
      <span class="hljs-attr">userPwd</span>: <span class="hljs-string">''</span>
  },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">login</span>(<span class="hljs-params"/>) {
    }
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>ç„¶åå®‰è£…åŒ…</p>
<pre><code class="hljs language-ts" lang="ts">cnpm install <span class="hljs-meta">@nuxtjs</span>/axios <span class="hljs-meta">@nuxtjs</span>/proxy -<span class="hljs-title class_">Ss</span>
</code></pre>
<p>åˆ°configé‡Œé¢å»é…ç½®ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// nuxt.config.js</span>

{
  ...
  <span class="hljs-attr">modules</span>: [
    <span class="hljs-string">'@nuxtjs/axios'</span>,
    <span class="hljs-string">'@nuxtjs/proxy'</span>
  ],
  <span class="hljs-attr">axios</span>: {
    <span class="hljs-attr">proxy</span>: <span class="hljs-literal">true</span>
  },
  <span class="hljs-comment">// ä»£ç†çš„åœ°å€</span>
  <span class="hljs-attr">proxy</span>: {
    <span class="hljs-string">'/api'</span>: {
      <span class="hljs-comment">// ä¸€èˆ¬è¿™é‡Œå¡«åŸŸå </span>
      <span class="hljs-attr">target</span>: <span class="hljs-string">'http://testapi.xxx.cn/'</span>
    }
  }
}
</code></pre>
<p>ç„¶åå°±å¯ä»¥å†™æ¥å£äº†ï¼š</p>
<pre><code class="hljs language-html" lang="html">// login.vue
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>ç™»å½•é¡µ<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"userName"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"userPwd"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"login"</span>&gt;</span>ç™»å½•<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">userName</span>: <span class="hljs-string">''</span>,
      <span class="hljs-attr">userPwd</span>: <span class="hljs-string">''</span>
  },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">login</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.$axios({
        <span class="hljs-attr">url</span>: <span class="hljs-string">'/api/u/loginByJson'</span>,
        <span class="hljs-attr">method</span>: <span class="hljs-string">'post'</span>
      })
    }
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>è¿™é‡Œéœ€è¦<code>qs</code>ä¸€ä¸‹ï¼š</p>
<pre><code class="hljs language-ts" lang="ts">cnpm install qs -S
</code></pre>
<pre><code class="hljs language-html" lang="html">// login.vue
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>ç™»å½•é¡µ<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"userName"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"userPwd"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"login"</span>&gt;</span>ç™»å½•<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">userName</span>: <span class="hljs-string">''</span>,
      <span class="hljs-attr">userPwd</span>: <span class="hljs-string">''</span>
  },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">login</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">let</span> data = qs.<span class="hljs-title function_">stringify</span>({
        <span class="hljs-attr">username</span>:  <span class="hljs-variable language_">this</span>.<span class="hljs-property">userName</span>,
        <span class="hljs-attr">password</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">userPwd</span>
      })
      <span class="hljs-variable language_">this</span>.$axios({
        <span class="hljs-attr">url</span>: <span class="hljs-string">'/api/u/loginByJson'</span>,
        <span class="hljs-attr">method</span>: <span class="hljs-string">'post'</span>,
        data
      }).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res)
      })
    }
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><code>qs</code>ç”¨æ¥å¤„ç†<code>url</code>æŸ¥è¯¢å­—ç¬¦ä¸²çš„åºåˆ—åŒ–å’Œè§£æã€‚</p>
<h2 data-id="heading-1">è§£æ</h2>
<p>å°†urlæŸ¥è¯¢å­—ç¬¦ä¸²è½¬ä¸ºjså¯¹è±¡ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> qs <span class="hljs-keyword">from</span> <span class="hljs-string">'qs'</span>;

<span class="hljs-keyword">const</span> query = <span class="hljs-string">'?name=å¼ ä¸‰&amp;age=21'</span>;
<span class="hljs-keyword">const</span> result = qs.<span class="hljs-title function_">parse</span>(query, { <span class="hljs-attr">ignoreQueryPrefix</span>: <span class="hljs-literal">true</span> });

<span class="hljs-comment">// ç»“æœï¼š{ name: 'å¼ ä¸‰', age: '21' }</span>
</code></pre>
<h2 data-id="heading-2">åºåˆ—åŒ–</h2>
<p>å°†jså¯¹è±¡è½¬æ¢ä¸ºurlæŸ¥è¯¢å­—ç¬¦ä¸²</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> obj = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'å¼ ä¸‰'</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">21</span>,
  <span class="hljs-attr">hobbies</span>: [<span class="hljs-string">'1'</span>, <span class="hljs-string">'2'</span>]
}
<span class="hljs-keyword">const</span> queryString = qs.<span class="hljs-title function_">stringify</span>(obj);
<span class="hljs-comment">// ç»“æœ 'name=å¼ ä¸‰&amp;age=21$hobbies=1$hobbies=2'</span>
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// åµŒå¥—å¯¹è±¡</span>
qs.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">a</span>: { <span class="hljs-attr">b</span>: { <span class="hljs-attr">c</span>: <span class="hljs-string">'value'</span> } } });
<span class="hljs-comment">// ç»“æœï¼š'a[b][c]=value'</span>

<span class="hljs-comment">// æ”¯æŒæ•°ç»„ç´¢å¼•</span>
qs.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">a</span>: [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>] });
<span class="hljs-comment">// ç»“æœï¼š'a[0]=1&amp;a[1]=2&amp;a[2]=3'</span>
</code></pre>
<pre><code class="hljs language-js" lang="js">qs.<span class="hljs-title function_">stringify</span>(obj, {
  <span class="hljs-attr">encode</span>: <span class="hljs-literal">true</span>,      <span class="hljs-comment">// æ˜¯å¦ç¼–ç ï¼ˆé»˜è®¤trueï¼‰</span>
  <span class="hljs-attr">arrayFormat</span>: <span class="hljs-string">'brackets'</span>,  <span class="hljs-comment">// æ•°ç»„æ ¼å¼ï¼šindices/brackets/repeat</span>
  <span class="hljs-attr">skipNulls</span>: <span class="hljs-literal">true</span>,   <span class="hljs-comment">// è·³è¿‡nullå€¼</span>
  <span class="hljs-attr">allowDots</span>: <span class="hljs-literal">true</span>,   <span class="hljs-comment">// ä½¿ç”¨ç‚¹å·è¡¨ç¤ºåµŒå¥—ï¼ša.b.c=value</span>
});
</code></pre>
<p>åœ¨è¯·æ±‚ä¸­ï¼Œä¸ºä»€ä¹ˆè¿˜è¦ç”¨ä¸€ä¸‹<code>qs.stringify()</code>ä¸ºäº†å°†å¯¹è±¡æ­£ç¡®åœ°æ ¼å¼åŒ–ä¸º<code>application/x-www-form-urlencoded</code>æ ¼å¼ã€‚</p>
<p>è§£å†³axiosé»˜è®¤è¡Œä¸ºé—®é¢˜ã€‚</p>
<p>axiosé»˜è®¤æƒ…å†µä¸‹ï¼š</p>
<ul>
<li>
<p>å½“dataæ˜¯å¯¹è±¡æ—¶ï¼Œä¼šè‡ªåŠ¨åºåˆ—åŒ–ä¸º<code>application/json</code>ï¼ˆjsonæ ¼å¼ï¼‰ã€‚</p>
</li>
<li>
<p>æœ‰äº›åç«¯æ¥å£è¦æ±‚<code>application/x-www-form-urlencoded</code>æ ¼å¼ã€‚</p>
</li>
</ul>
<pre><code class="hljs language-ts" lang="ts">qs.<span class="hljs-title function_">stringfy</span>({
  <span class="hljs-attr">username</span>: <span class="hljs-string">'å¼ ä¸‰'</span>,
  <span class="hljs-attr">password</span>: <span class="hljs-string">'123'</span>
})

<span class="hljs-comment">// ç»“æœ 'username=%E5%BC%A0%E4%B8%89&amp;password=123456'</span>
</code></pre>
<p>è¯·æ±‚å¤´: <code>Content-Type: application/x-www-form-urlencoded</code></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe768935ba6d4a9899712e363259e175~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rGf5rmW5paH5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769845507&amp;x-signature=0chyQXy2On6ti7NL7MP6xv0nK2A%3D" alt="image.png" loading="lazy"/></p>
<p>ç™»å½•æˆåŠŸåæœ‰ä¸€ä¸ªtoken:</p>
<p>ç„¶åå°±éœ€è¦æŠŠtokenç»™å­˜å‚¨èµ·æ¥ã€‚ä¸‹ä¸€æ­¥åšçš„äº‹å°±æ˜¯å¦‚æœæˆ‘ç™»å½•æˆåŠŸäº†ï¼Œè‚¯å®šè¦æŠŠtokenå­˜è¿›å»ï¼Œå­˜åˆ°vuexé‡Œé¢ï¼Œå¹¶ä¸”åšåˆ°æŒä¹…åŒ–å­˜å‚¨ã€‚</p>
<p>ç‚¹å‡»æˆ‘çš„ï¼Œä¼šæ˜¾ç¤ºä¸ªäººä¿¡æ¯åœ¨é‡Œè¾¹ã€‚è·å–ä¸ªäººä¿¡æ¯ã€‚è·å–ä¸ªäººä¿¡æ¯ï¼Œéœ€è¦æŠŠtokenæºå¸¦è¿‡å»ã€‚å°±æœ‰è¿™æ ·ä¸€ä¸ªå‚æ•°ã€‚è¿™ä¸ªæ—¶å€™å°±è¦é’ˆå¯¹axiosè¿›è¡ŒäºŒæ¬¡å°è£…äº†ã€‚</p>
<p>é‚£ä¹ˆå°è£…çš„å†…å®¹å°±è¦åœ¨pluginsé‡Œé¢ã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// nuxt.config.ts</span>

{
  ...
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-string">'~/plugins/axios'</span>
  ],
  ...
}
</code></pre>
<p><code>plugins/axios.js</code></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// axios.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> ({ $axios, store }) =&gt; {
  <span class="hljs-comment">// Requestæ‹¦æˆªå™¨ï¼Œè®¾ç½®token</span>
  $axios.<span class="hljs-title function_">onRequest</span>(<span class="hljs-function">(<span class="hljs-params">config</span>) =&gt;</span> {
    
  })
  $axios.<span class="hljs-title function_">onRequest</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
    
  })
  $axios.<span class="hljs-title function_">onResponse</span>(<span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> {
    <span class="hljs-keyword">return</span> response.<span class="hljs-property">data</span>;
  })
}
</code></pre>
<p>äºŒæ¬¡å°è£…å°è£…çš„ç‚¹ç‰¹åˆ«å¤šï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬å¯ä»¥å°è£…å®ƒçš„ä¸€ä¸ª<code>request</code>æ‹¦æˆªå™¨å»è®¾ç½®ä¸€ä¸ª<code>token</code>ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/51ea19431e6b4507a7eab5416861f344~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rGf5rmW5paH5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769845507&amp;x-signature=7w91I4SUDcFkOEhoI%2FB84jryV94%3D" alt="image.png" loading="lazy"/></p>
<p>åœ¨storeä¸‹é¢è®¾ç½®vuexï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> state = {
  <span class="hljs-attr">token</span>: <span class="hljs-string">''</span>
}

<span class="hljs-comment">// å› ä¸ºè¦åšæœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯å› ä¸ºæ²¡æœ‰localstorage\cookieç­‰,æ‰€ä»¥éœ€è¦å®‰è£… cnpm install cookie-universal-nuxt -S</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> mutations = {
  <span class="hljs-title function_">setToken</span>(<span class="hljs-params">state, token</span>) {
    state.<span class="hljs-property">token</span> = token
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$cookies</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">'token'</span>, token);
  },
  <span class="hljs-title function_">getToken</span>(<span class="hljs-params">state</span>) {
    <span class="hljs-comment">// è¿™é‡Œç”¨ä¸­é—´ä»¶è¯»å–åˆ°tokenï¼Œç„¶ååœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢å»è®¾ç½®token</span>
    state.<span class="hljs-property">token</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">$cookies</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'token'</span>);
  }
}
</code></pre>
<p>å¹¶ä¸”è¦æŠŠcookie-universal-nuxté…ç½®åˆ°modulesé‡Œé¢ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// nuxt.config.js</span>
{
  ...
  <span class="hljs-attr">modules</span>: [
   <span class="hljs-string">'cookie-universal-nuxt'</span>
  ]
}
</code></pre>
<p>è®¾ç½®å®Œæˆåï¼Œå›åˆ°ä»»ä½•ä¸€ä¸ªåœ°æ–¹ï¼Œå®ƒéƒ½æœ‰ã€‚ç„¶åæˆ‘ä»¬éœ€è¦è®¤è¯å®ˆå«ã€‚</p>
<p>åœ¨è¿™é‡Œæˆ‘ä»¬éœ€è¦æŠŠä¸­é—´ä»¶åˆ›å»ºä¸€ä¸‹ï¼Œå…ˆåœ¨æ ¹ç›®å½•åˆ›å»º<code>middleware</code>æ–‡ä»¶å¤¹ï¼Œç„¶ååœ¨è¿™ä¸‹é¢åˆ›å»ºä¸€ä¸ª<code>auth.js</code>æ–‡ä»¶ï¼Œ</p>
<pre><code class="hljs language-js" lang="js"/></pre>
<p>åœ¨myé¡µé¢åšmiddlewareï¼š</p>
<pre><code class="hljs language-html" lang="html">// my.vue
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>æˆ‘çš„<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span>{
  <span class="hljs-attr">middleware</span>: <span class="hljs-string">'auth'</span>
}
&lt;/scirpt&gt;
</span></code></pre>
<p><code>middleware</code>åœ¨<code>my</code>é¡µé¢ç”Ÿæ•ˆã€‚è¿™æ˜¯æˆ‘ä»¬è¯»å–å‡ºæ¥çš„<code>store</code>ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// middleware/auth.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> ({ store }) =&gt; {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(store.<span class="hljs-property">state</span>);
}
</code></pre>
<p>ç„¶åè·å–tokençš„å€¼ï¼Œæˆ‘ä»¬å·²ç»æŒä¹…åŒ–å­˜åˆ°cookieäº†ï¼Œå¯ä»¥commitå»æäº¤é‚£ä¸ª<code>getToken</code>ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// middleware/auth.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> ({ store }) =&gt; {
  store.<span class="hljs-title function_">commit</span>(<span class="hljs-string">'getToken'</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(store.<span class="hljs-property">state</span>);
}
</code></pre>
<p>ç„¶åå°±å¯ä»¥è¯»å–å¾—åˆ°<code>token</code>äº†ã€‚</p>
<p>å¦‚æœæ²¡æœ‰tokençš„ï¼Œå°±è®©ä»–è·³è½¬åˆ°ç™»å½•é¡µï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// middleware/auth.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> ({ store, redirect }) =&gt; {
  store.<span class="hljs-title function_">commit</span>(<span class="hljs-string">'getToken'</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(store.<span class="hljs-property">state</span>);
  <span class="hljs-keyword">if</span> (!store.<span class="hljs-property">state</span>.<span class="hljs-property">token</span>) {
    <span class="hljs-title function_">redirect</span>(<span class="hljs-string">'/login'</span>)
  }
}
</code></pre>
<pre><code class="hljs language-html" lang="html">// login.vue

methods: {
  ...mapMutations(['setToken']),
  login() {
    let data = qs.stringify({
      username: this.userName,
      password: this.userPwd
    });
    
    this.$axios({
      url: '/api/u/loginByJson',
      method: 'post',
      data
    }).then(res =&gt; {
      this.setToken(res.data.accessToken)
      this.$router.push({
        name: 'index'
      })
    })
  }
}
</code></pre>
<p>å¦‚æœæ²¡æœ‰ç™»å½•ï¼Œé‚£ä¹ˆç‚¹å‡»æˆ‘çš„å°±ä¼šè¿›å…¥ç™»å½•é¡µï¼Œç™»å½•ä¹Ÿå¡«å…¥è´¦å·å’Œå¯†ç ï¼Œç‚¹å‡»ç™»å½•ï¼Œå°±ä¼šè¯·æ±‚ç™»å½•æ¥å£ï¼Œç„¶åè·å¾—tokenï¼Œtokenå°±ä¼šè®¾ç½®åˆ°cookieé‡Œé¢ï¼Œå†ç‚¹å‡»æˆ‘çš„ï¼Œå°±ä¼šå¯ä»¥æŸ¥çœ‹è‡ªå·±çš„ä¿¡æ¯äº†ï¼Œç„¶åstate.tokenä¼šåœ¨ä¸­é—´ä»¶é‡ŒåˆæŠŠæœ¬åœ°cookieé‡Œé¢çš„tokenè®¾ç½®å›å»ç»™å®ƒï¼ˆå®ŒæˆæŒä¹…æ€§ï¼‰ã€‚</p>
<p>åšå®Œä¹‹åï¼Œåœ¨æˆ‘çš„é¡µé¢ï¼Œæƒ³è¦è·å¾—åˆ°ä¸ªäººä¿¡æ¯ï¼Œç”¨æˆ·ä¿¡æ¯ï¼Œæ‰€ä»¥åœ¨<code>my.vue</code>å°±å¯ä»¥åšæ–‡ç« äº†ï¼š</p>
<pre><code class="hljs language-html" lang="html">// my.vue

<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>æˆ‘çš„<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/javascript"</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">middleware</span>: <span class="hljs-string">'auth'</span>,
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">asyncData</span>(<span class="hljs-params">{ $axios }</span>) {
    <span class="hljs-keyword">let</span> res = <span class="hljs-keyword">await</span> $axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api/member/getInfo'</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res);
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>è¯·æ±‚çš„axiosè¦å…¨å±€å°è£…ï¼Œä¸€å®šè¦å¸¦tokenï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// axios.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> ({ $axios }) =&gt; {
  <span class="hljs-comment">// Requestæ‹¦æˆªå™¨ï¼Œè®¾ç½®token</span>
  $axios.<span class="hljs-title function_">onRequest</span>(<span class="hljs-function">(<span class="hljs-params">config</span>) =&gt;</span> {
    config.<span class="hljs-property">headers</span>[<span class="hljs-string">'Authorization'</span>] = store.<span class="hljs-property">state</span>.<span class="hljs-property">token</span>;
  })
  <span class="hljs-comment">// Erroræ‹¦æˆªå™¨ï¼šå‡ºç°é”™è¯¯çš„æ—¶å€™è¢«è°ƒç”¨</span>
  $axios.<span class="hljs-title function_">onRequest</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
    <span class="hljs-title function_">consolelog</span>(<span class="hljs-number">222</span>, error);
  })
  $axios.<span class="hljs-title function_">onResponse</span>(<span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">333</span>, response)
    <span class="hljs-keyword">return</span> response.<span class="hljs-property">data</span>
  })
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ReentrantLockå’ŒAQSæºç è§£æ]]></title>    <link>https://juejin.cn/post/7598465042968199208</link>    <guid>https://juejin.cn/post/7598465042968199208</guid>    <pubDate>2026-01-24T07:51:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598465042968199208" data-draft-id="7596186565270290447" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ReentrantLockå’ŒAQSæºç è§£æ"/> <meta itemprop="keywords" content="æºç "/> <meta itemprop="datePublished" content="2026-01-24T07:51:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="XRay"/> <meta itemprop="url" content="https://juejin.cn/user/3966693685869288"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ReentrantLockå’ŒAQSæºç è§£æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3966693685869288/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    XRay
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T07:51:46.000Z" title="Sat Jan 24 2026 07:51:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»17åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body .octicon{display:inline-block;fill:currentColor;vertical-align:text-bottom}.markdown-body .anchor{float:left;line-height:1;margin-left:-20px;padding-right:4px}.markdown-body .anchor:focus{outline:none}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#1b1f23;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1:hover .anchor .octicon-link:before,.markdown-body h2:hover .anchor .octicon-link:before,.markdown-body h3:hover .anchor .octicon-link:before,.markdown-body h4:hover .anchor .octicon-link:before,.markdown-body h5:hover .anchor .octicon-link:before,.markdown-body h6:hover .anchor .octicon-link:before{width:16px;height:16px;content:" ";display:inline-block;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' aria-hidden='true'%3E%3Cpath fill-rule='evenodd' d='M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z'/%3E%3C/svg%3E")}.markdown-body{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;color:#24292e;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;font-size:16px;line-height:1.5;word-wrap:break-word}.markdown-body details{display:block}.markdown-body summary{display:list-item}.markdown-body a{background-color:initial}.markdown-body a:active,.markdown-body a:hover{outline-width:0}.markdown-body strong{font-weight:inherit;font-weight:bolder}.markdown-body h1{margin:.67em 0}.markdown-body img{border-style:none}.markdown-body code,.markdown-body kbd,.markdown-body pre{font-family:monospace,monospace;font-size:1em}.markdown-body hr{box-sizing:initial;overflow:visible}.markdown-body input{font:inherit;margin:0;overflow:visible}.markdown-body [type=checkbox]{box-sizing:border-box;padding:0}.markdown-body *{box-sizing:border-box}.markdown-body input{font-family:inherit;font-size:inherit;line-height:inherit}.markdown-body a{color:#0366d6;text-decoration:none}.markdown-body a:hover{text-decoration:underline}.markdown-body strong{font-weight:600}.markdown-body hr{height:0;margin:15px 0;overflow:hidden;background:transparent;border-bottom:1px solid #dfe2e5}.markdown-body hr:after,.markdown-body hr:before{display:table;content:""}.markdown-body hr:after{clear:both}.markdown-body table{border-spacing:0;border-collapse:collapse}.markdown-body td,.markdown-body th{padding:0}.markdown-body details summary{cursor:pointer}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:0;margin-bottom:0}.markdown-body h1{font-size:32px}.markdown-body h1,.markdown-body h2{font-weight:600}.markdown-body h2{font-size:24px}.markdown-body h3{font-size:20px}.markdown-body h3,.markdown-body h4{font-weight:600}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:14px}.markdown-body h5,.markdown-body h6{font-weight:600}.markdown-body h6{font-size:12px}.markdown-body p{margin-top:0;margin-bottom:10px}.markdown-body blockquote{margin:0}.markdown-body ol,.markdown-body ul{padding-left:0;margin-top:0;margin-bottom:0}.markdown-body ol ol,.markdown-body ul ol{list-style-type:lower-roman}.markdown-body ol ol ol,.markdown-body ol ul ol,.markdown-body ul ol ol,.markdown-body ul ul ol{list-style-type:lower-alpha}.markdown-body dd{margin-left:0}.markdown-body code,.markdown-body pre{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px}.markdown-body pre{margin-top:0;margin-bottom:0}.markdown-body input::-webkit-inner-spin-button,.markdown-body input::-webkit-outer-spin-button{margin:0;-webkit-appearance:none;appearance:none}.markdown-body :checked+.radio-label{position:relative;z-index:1;border-color:#0366d6}.markdown-body .border{border:1px solid #e1e4e8!important}.markdown-body .border-0{border:0!important}.markdown-body .border-bottom{border-bottom:1px solid #e1e4e8!important}.markdown-body .rounded-1{border-radius:3px!important}.markdown-body .bg-white{background-color:#fff!important}.markdown-body .bg-gray-light{background-color:#fafbfc!important}.markdown-body .text-gray-light{color:#6a737d!important}.markdown-body .pl-3,.markdown-body .px-3{padding-left:16px!important}.markdown-body .px-3{padding-right:16px!important}.markdown-body .f6{font-size:12px!important}.markdown-body .lh-condensed{line-height:1.25!important}.markdown-body .text-bold{font-weight:600!important}.markdown-body .pl-c{color:#6a737d}.markdown-body .pl-c1,.markdown-body .pl-s .pl-v{color:#005cc5}.markdown-body .pl-e,.markdown-body .pl-en{color:#6f42c1}.markdown-body .pl-s .pl-s1,.markdown-body .pl-smi{color:#24292e}.markdown-body .pl-ent{color:#22863a}.markdown-body .pl-k{color:#d73a49}.markdown-body .pl-pds,.markdown-body .pl-s,.markdown-body .pl-s .pl-pse .pl-s1,.markdown-body .pl-sr,.markdown-body .pl-sr .pl-cce,.markdown-body .pl-sr .pl-sra,.markdown-body .pl-sr .pl-sre{color:#032f62}.markdown-body .pl-smw,.markdown-body .pl-v{color:#e36209}.markdown-body .pl-bu{color:#b31d28}.markdown-body .pl-ii{color:#fafbfc;background-color:#b31d28}.markdown-body .pl-c2{color:#fafbfc;background-color:#d73a49}.markdown-body .pl-c2:before{content:"^M"}.markdown-body .pl-sr .pl-cce{font-weight:700;color:#22863a}.markdown-body .pl-ml{color:#735c0f}.markdown-body .pl-mh,.markdown-body .pl-mh .pl-en,.markdown-body .pl-ms{font-weight:700;color:#005cc5}.markdown-body .pl-mi{font-style:italic;color:#24292e}.markdown-body .pl-mb{font-weight:700;color:#24292e}.markdown-body .pl-md{color:#b31d28;background-color:#ffeef0}.markdown-body .pl-mi1{color:#22863a;background-color:#f0fff4}.markdown-body .pl-mc{color:#e36209;background-color:#ffebda}.markdown-body .pl-mi2{color:#f6f8fa;background-color:#005cc5}.markdown-body .pl-mdr{font-weight:700;color:#6f42c1}.markdown-body .pl-ba{color:#586069}.markdown-body .pl-sg{color:#959da5}.markdown-body .pl-corl{text-decoration:underline;color:#032f62}.markdown-body .mb-0{margin-bottom:0!important}.markdown-body .my-2{margin-bottom:8px!important;margin-top:8px!important}.markdown-body .pl-0{padding-left:0!important}.markdown-body .py-0{padding-top:0!important;padding-bottom:0!important}.markdown-body .pl-1{padding-left:4px!important}.markdown-body .pl-2{padding-left:8px!important}.markdown-body .py-2{padding-top:8px!important;padding-bottom:8px!important}.markdown-body .pl-3{padding-left:16px!important}.markdown-body .pl-4{padding-left:24px!important}.markdown-body .pl-5{padding-left:32px!important}.markdown-body .pl-6{padding-left:40px!important}.markdown-body .pl-7{padding-left:48px!important}.markdown-body .pl-8{padding-left:64px!important}.markdown-body .pl-9{padding-left:80px!important}.markdown-body .pl-10{padding-left:96px!important}.markdown-body .pl-11{padding-left:112px!important}.markdown-body .pl-12{padding-left:128px!important}.markdown-body hr{border-bottom-color:#eee}.markdown-body kbd{display:inline-block;padding:3px 5px;font:11px SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #d1d5da;border-radius:3px;box-shadow:inset 0 -1px 0 #d1d5da}.markdown-body:after,.markdown-body:before{display:table;content:""}.markdown-body:after{clear:both}.markdown-body&gt;:first-child{margin-top:0!important}.markdown-body&gt;:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body blockquote,.markdown-body details,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body hr{height:.25em;padding:0;margin:24px 0;background-color:#e1e4e8;border:0}.markdown-body blockquote{padding:0 1em;color:#6a737d;border-left:.25em solid #dfe2e5}.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eaecef}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{font-size:.85em;color:#6a737d}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li{word-wrap:break-all}.markdown-body li&gt;p{margin-top:16px}.markdown-body li+li{margin-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:600}.markdown-body dl dd{padding:0 16px;margin-bottom:16px}.markdown-body table{display:block;width:100%;overflow:auto}.markdown-body table th{font-weight:600}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid #dfe2e5}.markdown-body table tr{background-color:#fff;border-top:1px solid #c6cbd1}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}.markdown-body img{max-width:100%;box-sizing:initial;background-color:#fff}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body code{padding:.2em .4em;margin:0;font-size:85%;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body pre{word-wrap:normal}.markdown-body pre&gt;code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:transparent;border:0}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f6f8fa;border-radius:3px}.markdown-body pre code{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:initial;border:0}.markdown-body .commit-tease-sha{display:inline-block;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:90%;color:#444d56}.markdown-body .full-commit .btn-outline:not(:disabled):hover{color:#005cc5;border-color:#005cc5}.markdown-body .blob-wrapper{overflow-x:auto;overflow-y:hidden}.markdown-body .blob-wrapper-embedded{max-height:240px;overflow-y:auto}.markdown-body .blob-num{width:1%;min-width:50px;padding-right:10px;padding-left:10px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;line-height:20px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;vertical-align:top;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-body .blob-num:hover{color:rgba(27,31,35,.6)}.markdown-body .blob-num:before{content:attr(data-line-number)}.markdown-body .blob-code{position:relative;padding-right:10px;padding-left:10px;line-height:20px;vertical-align:top}.markdown-body .blob-code-inner{overflow:visible;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;color:#24292e;word-wrap:normal;white-space:pre}.markdown-body .pl-token.active,.markdown-body .pl-token:hover{cursor:pointer;background:#ffea7f}.markdown-body .tab-size[data-tab-size="1"]{-moz-tab-size:1;tab-size:1}.markdown-body .tab-size[data-tab-size="2"]{-moz-tab-size:2;tab-size:2}.markdown-body .tab-size[data-tab-size="3"]{-moz-tab-size:3;tab-size:3}.markdown-body .tab-size[data-tab-size="4"]{-moz-tab-size:4;tab-size:4}.markdown-body .tab-size[data-tab-size="5"]{-moz-tab-size:5;tab-size:5}.markdown-body .tab-size[data-tab-size="6"]{-moz-tab-size:6;tab-size:6}.markdown-body .tab-size[data-tab-size="7"]{-moz-tab-size:7;tab-size:7}.markdown-body .tab-size[data-tab-size="8"]{-moz-tab-size:8;tab-size:8}.markdown-body .tab-size[data-tab-size="9"]{-moz-tab-size:9;tab-size:9}.markdown-body .tab-size[data-tab-size="10"]{-moz-tab-size:10;tab-size:10}.markdown-body .tab-size[data-tab-size="11"]{-moz-tab-size:11;tab-size:11}.markdown-body .tab-size[data-tab-size="12"]{-moz-tab-size:12;tab-size:12}.markdown-body .task-list-item{list-style-type:none}.markdown-body .task-list-item+.task-list-item{margin-top:3px}.markdown-body .task-list-item input{margin:0 .2em .25em -1.6em;vertical-align:middle}</style><style data-highlight="" data-highlight-key="github">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ¬æ–‡æºç åŸºäºJDK 1.8</p>
<p>åœ¨ Java ä¸­ï¼ŒDong Lea å¤§å¸ˆä¸ºæˆ‘ä»¬æä¾›äº†å¤§é‡å¹¶å‘ç¼–ç¨‹å·¥å…·ç±»ï¼Œå®ƒä»¬éƒ½åœ¨ JDK çš„ java.util.concurrent åŒ…ä¸‹ï¼Œå…¶ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ec594e8d6f5f4d75a4f5eec212cebcaa~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=580&amp;h=648&amp;s=81240&amp;e=png&amp;b=fefee6" alt="image.png" width="50%" loading="lazy"/>
<p>current åŒ…ä¸­åŒ…å«å¾ˆå¤šæˆ‘ä»¬å¸¸ç”¨çš„å¹¶å‘å·¥å…·ç±»ï¼Œå¦‚ï¼šConcurrentHashMapã€CopyOnWriteArrayListã€ArrayBlockingQueueã€LinkedBlockingQueueã€ThreadPoolExecutor ç­‰ã€‚</p>
<p>å…¶ä¸­è¿˜åŒ…å«äº† 2 ä¸ªå­åŒ…ï¼š atomic å’Œ locks ã€‚atomic åŒ…ä¸‹æœ‰ AtomicBooleanã€AtomicIntegerã€atomicReference ç­‰ CAS åŸå­å˜é‡ç±»ï¼Œ locks åŒ…ä¸‹æœ‰ ReentrantLockã€ReentrantReadWriteLockã€AbstractQueuedSynchronizer ç­‰é”åŠé”çš„åº•å±‚å®ç°åŸºç¡€æ¡†æ¶ã€‚è¿™äº›ç±»çš„å®ç°ä¸»è¦æ˜¯ä¾èµ–äº volatile åŠ CAS ï¼Œä»æ•´ä½“ä¸Šæ¥çœ‹ concurrent åŒ…çš„æ•´ä½“å®ç°å›¾å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ec7cb609de1c454f84a53677d1d7db7b~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=822&amp;h=480&amp;s=42818&amp;e=png&amp;b=fdfdfd" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-0">Lock</h4>
<p>é”èƒ½å¤Ÿè§£å†³å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®å…±äº«èµ„æºé€ æˆçš„åŒæ­¥é—®é¢˜ï¼Œåœ¨ Lock æ¥å£å‡ºç°ä¹‹å‰ï¼Œ Java ä¸»è¦æ˜¯é  synchronized å…³é”®å­—æ¥å®ç°é”åŠŸèƒ½ï¼Œ Java SE5 ä¹‹åå¹¶å‘åŒ…ä¸­å¢åŠ äº† Lock æ¥å£ï¼Œå®ƒæä¾›äº†ä¸ synchronized ä¸€æ ·çš„é”åŠŸèƒ½ã€‚å®ƒè™½ç„¶æ²¡æœ‰ä½¿ç”¨ synchronize å…³é”®å­—é‚£ä¹ˆä¾¿æ·ï¼Œä½†æ˜¯å®ƒæ‹¥æœ‰è·å–å’Œé‡Šæ”¾é”çš„å¯æ“ä½œæ€§ï¼Œè¿˜æœ‰å¯ä¸­æ–­åœ°è·å–é”ä»¥åŠè¶…æ—¶è·å–é”ç­‰å¤šç§ synchronized å…³é”®å­—æ‰€ä¸å…·å¤‡çš„åŒæ­¥ç‰¹æ€§ã€‚</p>
<p>Lock æ˜¯ä¸€ä¸ªæ¥å£ï¼Œé‡Œé¢æœ‰ 6 ä¸ªæ–¹æ³•ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Lock</span> {

    <span class="hljs-comment">// è·å–é”ï¼Œæ— è¿”å›å€¼ï¼Œå¦‚æœæ²¡æœ‰æ‹¿åˆ°é”å°†æ— æ³•è¿›è¡Œçº¿ç¨‹è°ƒåº¦å¹¶å¤„äºä¼‘çœ çŠ¶æ€ç›´åˆ°æ‹¿åˆ°é”</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">lock</span><span class="hljs-params">()</span>;

    <span class="hljs-comment">// å’Œä¸Šé¢ä¸åŒçš„åœ°æ–¹æ˜¯è·å–é”çš„è¿‡ç¨‹èƒ½å¤Ÿå“åº”ä¸­æ–­</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">lockInterruptibly</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException;

    <span class="hljs-comment">// è·å–é”ï¼Œæœ‰è¿”å›å€¼ï¼Œèƒ½æ‹¿åˆ°é”ç«‹å³è¿”å› true ï¼›å¦åˆ™è¿”å› false ;</span>
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryLock</span><span class="hljs-params">()</span>;

    <span class="hljs-comment">// åœ¨è¶…æ—¶æ—¶é—´å†…å¹¶ä¸”æ²¡æœ‰è¢«ä¸­æ–­çš„æƒ…å†µä¸‹å¦‚æœé”æ˜¯ç©ºé—²çš„å°±èƒ½æ‹¿åˆ°é”</span>
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryLock</span><span class="hljs-params">(<span class="hljs-type">long</span> time, TimeUnit unit)</span> <span class="hljs-keyword">throws</span> InterruptedException;

    <span class="hljs-comment">// é‡Šæ”¾é”</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">unlock</span><span class="hljs-params">()</span>;

    <span class="hljs-comment">// è¿”å›è·Ÿé”å®ä¾‹ç»‘å®šçš„Conditionå®ä¾‹</span>
    Condition <span class="hljs-title function_">newCondition</span><span class="hljs-params">()</span>;
}
</code></pre>
<h4 data-id="heading-1">ReentrantLock</h4>
<p>ReentrantLock å®ç°äº† Lock æ¥å£ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReentrantLock</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Lock</span>, java.io.Serializable {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Sync sync;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ReentrantLock</span><span class="hljs-params">()</span> {
        sync = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NonfairSync</span>();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ReentrantLock</span><span class="hljs-params">(<span class="hljs-type">boolean</span> fair)</span> {
        sync = fair ? <span class="hljs-keyword">new</span> <span class="hljs-title class_">FairSync</span>() : <span class="hljs-keyword">new</span> <span class="hljs-title class_">NonfairSync</span>();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">lock</span><span class="hljs-params">()</span> {
        sync.lock();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">lockInterruptibly</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException {
        sync.acquireInterruptibly(<span class="hljs-number">1</span>);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryLock</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sync.nonfairTryAcquire(<span class="hljs-number">1</span>);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryLock</span><span class="hljs-params">(<span class="hljs-type">long</span> timeout, TimeUnit unit)</span>
            <span class="hljs-keyword">throws</span> InterruptedException {
        <span class="hljs-keyword">return</span> sync.tryAcquireNanos(<span class="hljs-number">1</span>, unit.toNanos(timeout));
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unlock</span><span class="hljs-params">()</span> {
        sync.release(<span class="hljs-number">1</span>);
    }

    <span class="hljs-keyword">public</span> Condition <span class="hljs-title function_">newCondition</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sync.newCondition();
    }

}
</code></pre>
<p>ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹åˆ°é‡Œé¢çš„æ–¹æ³•éƒ½æ˜¯é€šè¿‡ sync æ¥å®ç°çš„ï¼Œå¦‚æœè°ƒç”¨ ReentrantLock æ— å‚çš„æ„é€ æ–¹æ³•ï¼Œsync å°±æ˜¯ NonfairSync çš„å®ä¾‹ï¼›å¦‚æœä½¿ç”¨ new ReentrantLock(true) ï¼Œåˆ™ sync å°±æ˜¯ FairSync çš„å®ä¾‹ã€‚</p>
<p>ä»–ä»¬ä¿©åˆ†åˆ«æ˜¯éå…¬å¹³é”å’Œå…¬å¹³é”ï¼Œç”±æ­¤å¯çŸ¥ ReentrantLock é»˜è®¤æ˜¯éå…¬å¹³é”ï¼Œ NonfairSync å’Œ FairSync çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReentrantLock</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Lock</span>, java.io.Serializable {

    <span class="hljs-comment">/**
     * Sync object for non-fair locks
     */</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NonfairSync</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Sync</span> {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">7316153563782823691L</span>;

        <span class="hljs-comment">/**
         * Performs lock. Try immediate barge, backing up to normal
         * acquire on failure.
         */</span>
        <span class="hljs-comment">// Android-removed: @ReservedStackAccess from OpenJDK 9, not available on Android.</span>
        <span class="hljs-comment">// @ReservedStackAccess</span>
        <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">lock</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">if</span> (compareAndSetState(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>))
                setExclusiveOwnerThread(Thread.currentThread());
            <span class="hljs-keyword">else</span>
                acquire(<span class="hljs-number">1</span>);
        }

        <span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryAcquire</span><span class="hljs-params">(<span class="hljs-type">int</span> acquires)</span> {
            <span class="hljs-comment">// è°ƒç”¨ nonfairTryAcquire() æ–¹æ³•</span>
            <span class="hljs-keyword">return</span> nonfairTryAcquire(acquires);
        }
    }

    <span class="hljs-comment">/**
     * Sync object for fair locks
     */</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FairSync</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Sync</span> {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> -<span class="hljs-number">3000897897090466540L</span>;

        <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">lock</span><span class="hljs-params">()</span> {
            acquire(<span class="hljs-number">1</span>);
        }

        <span class="hljs-comment">/**
         * Fair version of tryAcquire. Don't grant access unless
         * recursive call or no waiters or is first.
         */</span>
        <span class="hljs-comment">// Android-removed: @ReservedStackAccess from OpenJDK 9, not available on Android.</span>
        <span class="hljs-comment">// @ReservedStackAccess</span>
        <span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryAcquire</span><span class="hljs-params">(<span class="hljs-type">int</span> acquires)</span> {
            <span class="hljs-keyword">final</span> <span class="hljs-type">Thread</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> Thread.currentThread();
            <span class="hljs-type">int</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> getState();
            <span class="hljs-comment">// é”æ²¡æœ‰è¢«çº¿ç¨‹æŒæœ‰</span>
            <span class="hljs-keyword">if</span> (c == <span class="hljs-number">0</span>) {
                <span class="hljs-comment">// ç­‰å¾…é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰å‰é©±èŠ‚ç‚¹</span>
                <span class="hljs-keyword">if</span> (!hasQueuedPredecessors() &amp;&amp;
                        compareAndSetState(<span class="hljs-number">0</span>, acquires)) {
                    setExclusiveOwnerThread(current);
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                }
            }
            <span class="hljs-comment">// é”å·²ç»è¢«æŸä¸ªçº¿ç¨‹æŒæœ‰ï¼Œåˆ™åˆ¤æ–­è¯¥çº¿ç¨‹æ˜¯å¦æ˜¯å½“å‰çº¿ç¨‹</span>
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (current == getExclusiveOwnerThread()) {
                <span class="hljs-comment">// å†æ¬¡è·å–ï¼Œè®¡æ•°åŠ  1</span>
                <span class="hljs-type">int</span> <span class="hljs-variable">nextc</span> <span class="hljs-operator">=</span> c + acquires;
                <span class="hljs-keyword">if</span> (nextc &lt; <span class="hljs-number">0</span>)
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"Maximum lock count exceeded"</span>);
                setState(nextc);
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
    }


    <span class="hljs-comment">/**
     * Base of synchronization control for this lock. Subclassed
     * into fair and nonfair versions below. Uses AQS state to
     * represent the number of holds on the lock.
     */</span>
    <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Sync</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractQueuedSynchronizer</span> {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> -<span class="hljs-number">5179523762034025860L</span>;

        <span class="hljs-comment">/**
         * Performs {<span class="hljs-doctag">@link</span> Lock#lock}. The main reason for subclassing
         * is to allow fast path for nonfair version.
         */</span>
        <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">lock</span><span class="hljs-params">()</span>;

        <span class="hljs-comment">/**
         * Performs non-fair tryLock. tryAcquire is implemented in
         * subclasses, but both need nonfair try for trylock method.
         */</span>
        <span class="hljs-comment">// Android-removed: @ReservedStackAccess from OpenJDK 9, not available on Android.</span>
        <span class="hljs-comment">// @ReservedStackAccess</span>
        <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">nonfairTryAcquire</span><span class="hljs-params">(<span class="hljs-type">int</span> acquires)</span> {
            <span class="hljs-keyword">final</span> <span class="hljs-type">Thread</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> Thread.currentThread();
            <span class="hljs-type">int</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> getState();
            <span class="hljs-comment">// é”æ²¡æœ‰è¢«çº¿ç¨‹æŒæœ‰ï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹å¯ä»¥å»è·å–é”</span>
            <span class="hljs-keyword">if</span> (c == <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">if</span> (compareAndSetState(<span class="hljs-number">0</span>, acquires)) {
                    setExclusiveOwnerThread(current);
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                }
            }
            <span class="hljs-comment">// é”å·²ç»è¢«æŸä¸ªçº¿ç¨‹æŒæœ‰ï¼Œåˆ™åˆ¤æ–­è¯¥çº¿ç¨‹æ˜¯å¦æ˜¯å½“å‰çº¿ç¨‹</span>
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (current == getExclusiveOwnerThread()) {
                <span class="hljs-comment">// å†æ¬¡è·å–ï¼Œè®¡æ•°åŠ 1</span>
                <span class="hljs-type">int</span> <span class="hljs-variable">nextc</span> <span class="hljs-operator">=</span> c + acquires;
                <span class="hljs-keyword">if</span> (nextc &lt; <span class="hljs-number">0</span>) <span class="hljs-comment">// overflow</span>
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"Maximum lock count exceeded"</span>);
                setState(nextc);
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }

        <span class="hljs-comment">// Android-removed: @ReservedStackAccess from OpenJDK 9, not available on Android.</span>
        <span class="hljs-comment">// @ReservedStackAccess</span>
        <span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryRelease</span><span class="hljs-params">(<span class="hljs-type">int</span> releases)</span> {
            <span class="hljs-comment">//è®¡æ•°å‡1</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> getState() - releases;
            <span class="hljs-keyword">if</span> (Thread.currentThread() != getExclusiveOwnerThread())
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalMonitorStateException</span>();
            <span class="hljs-type">boolean</span> <span class="hljs-variable">free</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
            <span class="hljs-comment">//è®¡æ•°ä¸º0æ—¶ï¼Œå½“å‰çº¿ç¨‹é‡Šæ”¾é”</span>
            <span class="hljs-keyword">if</span> (c == <span class="hljs-number">0</span>) {
                free = <span class="hljs-literal">true</span>;
                setExclusiveOwnerThread(<span class="hljs-literal">null</span>);
            }
            setState(c);
            <span class="hljs-comment">//è®¡æ•°ä¸ä¸º0æ—¶ï¼Œè¿”å›false</span>
            <span class="hljs-keyword">return</span> free;
        }

        <span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isHeldExclusively</span><span class="hljs-params">()</span> {
            <span class="hljs-comment">// While we must in general read state before owner,</span>
            <span class="hljs-comment">// we don't need to do so to check if current thread is owner</span>
            <span class="hljs-keyword">return</span> getExclusiveOwnerThread() == Thread.currentThread();
        }

        <span class="hljs-keyword">final</span> ConditionObject <span class="hljs-title function_">newCondition</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConditionObject</span>();
        }

        <span class="hljs-comment">// Methods relayed from outer class</span>

        <span class="hljs-keyword">final</span> Thread <span class="hljs-title function_">getOwner</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> getState() == <span class="hljs-number">0</span> ? <span class="hljs-literal">null</span> : getExclusiveOwnerThread();
        }

        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getHoldCount</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> isHeldExclusively() ? getState() : <span class="hljs-number">0</span>;
        }

        <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isLocked</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> getState() != <span class="hljs-number">0</span>;
        }

        <span class="hljs-comment">/**
         * Reconstitutes the instance from a stream (that is, deserializes it).
         */</span>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readObject</span><span class="hljs-params">(java.io.ObjectInputStream s)</span>
                <span class="hljs-keyword">throws</span> java.io.IOException, ClassNotFoundException {
            s.defaultReadObject();
            setState(<span class="hljs-number">0</span>); <span class="hljs-comment">// reset to unlocked state</span>
        }
    }
}
</code></pre>
<p>å¯ä»¥çœ‹åˆ° NonfairSync å’Œ FairSync å‡ç»§æ‰¿è‡ª Sync ç±»ï¼ŒSync ç±»æ˜¯ ReentrantLock ç±»ä¸­çš„æŠ½è±¡é™æ€å†…éƒ¨ç±»ï¼Œ Sync ç±»ç»§æ‰¿è‡ª AbstractQueuedSynchronizer ç±»ï¼ŒSync ç±»ä¸­çš„ lock() æ–¹æ³•æ˜¯ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œå­ç±»å¿…é¡»é‡å†™ã€‚ NonfairSync å’Œ FairSync ç±»ä¸­åˆ†åˆ«å¯¹ lock() æ–¹æ³•è¿›è¡Œäº†ä¸åŒçš„é‡å†™å®ç°ã€‚å…¶åŒºåˆ«æ˜¯ NonfairSync ä¸­çš„ lock() æ–¹æ³•ä¼šå…ˆä½¿ç”¨ CAS å°è¯•è·å–é”ï¼Œå¦‚æœæˆåŠŸäº†ï¼Œè®¾ç½®å½“å‰çº¿ç¨‹ä¸ºæ‹¥æœ‰ç‹¬å è®¿é—®æƒé™çš„çº¿ç¨‹ï¼Œå¦‚æœ CAS ä¸æˆåŠŸï¼Œå†è°ƒç”¨ AQS ä¸­çš„ acquire(1) ï¼Œè€Œ FairSync ä¸­çš„ lock() æ–¹æ³•ç›´æ¥è°ƒç”¨äº† acquire(1) ï¼Œ acquire() æ–¹æ³•æ¥è‡ª AbstractQueuedSynchronizer ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AbstractQueuedSynchronizer</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">acquire</span><span class="hljs-params">(<span class="hljs-type">int</span> arg)</span> {
        <span class="hljs-comment">// å…ˆä½¿ç”¨ tryAcquire(arg) è·å–é”ï¼Œå…¬å¹³é”å’Œéå…¬å¹³é”åˆ†åˆ«å¯¹</span>
        <span class="hljs-comment">// tryAcquire() è¿›è¡Œäº†ä¸åŒçš„é‡å†™ï¼ŒaddWaiter() ä¼šå°†å½“å‰çº¿ç¨‹</span>
        <span class="hljs-comment">// å¯¹åº”çš„ Node åŠ å…¥ç­‰å¾…åŒå‘é“¾è¡¨ï¼ŒacquireQueued()å¯ä»¥å¯¹æ’é˜Ÿ</span>
        <span class="hljs-comment">// ä¸­çš„çº¿ç¨‹è¿›è¡Œè·å–é”çš„æ“ä½œ</span>
        <span class="hljs-keyword">if</span> (!tryAcquire(arg) &amp;&amp;
                acquireQueued(addWaiter(Node.EXCLUSIVE), arg))
            selfInterrupt();
    }
}
</code></pre>
<p>å…¶ä¸­ tryAcquire() æ–¹æ³•åœ¨ NonfairSync å’Œ FairSync ç±»ä¸­ä¹Ÿæœ‰ä¸åŒçš„é‡å†™å®ç°ï¼Œä¸»è¦åŒºåˆ«æ˜¯ FairSync ä¸­ä¼šå…ˆåˆ¤æ–­ç­‰å¾…é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰å‰é©±èŠ‚ç‚¹ï¼Œå¦‚æœæœ‰å‰é©±èŠ‚ç‚¹è¯´æ˜æœ‰çº¿ç¨‹æ¯”å½“å‰çº¿ç¨‹æ›´æ—©è·å–é”ï¼Œæ ¹æ®å…¬å¹³æ€§ï¼Œå½“å‰çº¿ç¨‹è·å–é”å¤±è´¥ã€‚</p>
<p>ä»¥ä¸Šå°±æ˜¯ ReentrantLock ä¸­å…¬å¹³é”ä¸éå…¬å¹³é”çš„åŒºåˆ«ã€‚</p>
<p>ç›´æ¥ä»åå­—å°±å¯ä»¥çœ‹å‡ºæ¥ï¼Œ ReentrantLock æ˜¯å¯é‡å…¥é”ã€‚ä»ä»£ç ä¸­ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼ŒtryAcquire() å’Œ nonfairTryAcquire() æ–¹æ³•ä¸­åˆ¤æ–­å¦‚æœå½“å‰çº¿ç¨‹å·²ç»æŒæœ‰äº†é”ï¼Œè®¡æ•°åŠ  1 ã€‚åœ¨ tryRelease() ä¸­è®¡æ•°å‡1ï¼Œç›´åˆ°è®¡æ•°ä¸º 0 æ‰é‡Šæ”¾é”ï¼Œæ‰€ä»¥ä½¿ç”¨ ReentrantLock é‡å¤å¯¹ä¸€ä¸ªçº¿ç¨‹åŠ é”å¹¶ä¸ä¼šå¯¼è‡´æ­»é”ã€‚</p>
<h4 data-id="heading-2">AbstractQueuedSynchronizer</h4>
<p>Sync ç±»ç»§æ‰¿è‡ª AbstractQueuedSynchronizer ç±»ï¼ŒAbstractQueuedSynchronizer æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæºç ä¸­æœ‰ååˆ†å…·ä½“çš„è§£é‡Šï¼š</p>
<pre><code class="hljs language-java" lang="java">Provides a framework <span class="hljs-keyword">for</span> implementing blocking locks and related <span class="hljs-title function_">synchronizers</span> <span class="hljs-params">(semaphores, events, etc)</span> that
rely on first-in-first-out (FIFO) wait queues. This <span class="hljs-keyword">class</span> <span class="hljs-title class_">is</span> designed to be a useful basis <span class="hljs-keyword">for</span> most kinds of
synchronizers that rely on a single atomic <span class="hljs-type">int</span> value to represent state. Subclasses must define the <span class="hljs-keyword">protected</span>
methods that change <span class="hljs-built_in">this</span> state, and which define what that state means in terms of <span class="hljs-built_in">this</span> object being acquired
or released. Given these, the other methods in <span class="hljs-built_in">this</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">carry</span> out all queuing and blocking mechanics.
Subclasses can maintain other state fields, but only the atomically updated <span class="hljs-type">int</span> value manipulated using
methods getState, setState and compareAndSetState is tracked with respect to synchronization

Subclasses should be defined as non-<span class="hljs-keyword">public</span> internal helper classes that are used to implement the
synchronization properties of their enclosing class. Class AbstractQueuedSynchronizer does not implement
any synchronization interface. Instead it defines methods such as acquireInterruptibly that can be invoked
as appropriate by concrete locks and related synchronizers to implement their <span class="hljs-keyword">public</span> methods.

This <span class="hljs-keyword">class</span> <span class="hljs-title class_">supports</span> either or both a <span class="hljs-keyword">default</span> exclusive mode and a shared mode. When acquired in exclusive
mode, attempted acquires by other threads cannot succeed. Shared mode acquires by multiple threads <span class="hljs-title function_">may</span>
<span class="hljs-params">(but need not)</span> succeed. This <span class="hljs-keyword">class</span> <span class="hljs-title class_">does</span> not <span class="hljs-string">"understand"</span> these differences except in the mechanical sense
that when a shared mode acquire succeeds, the next waiting <span class="hljs-title function_">thread</span> <span class="hljs-params">(<span class="hljs-keyword">if</span> one exists)</span> must also determine whether
it can acquire as well. Threads waiting in the different modes share the same FIFO queue. Usually,
implementation subclasses support only one of these modes, but both can come into play <span class="hljs-keyword">for</span> example in a
ReadWriteLock. Subclasses that support only exclusive or only shared modes need not define the methods supporting the unused mode.
</code></pre>
<p>AbstractQueuedSynchronizer æ˜¯ç”¨æ¥å®ç°é”å’Œç›¸å…³åŒæ­¥å™¨ï¼ˆä¿¡å·é‡ã€äº‹ä»¶ç­‰ï¼‰çš„åŸºç¡€æ¡†æ¶ï¼Œå®ƒçš„å®ç°ä¸»è¦ä¾èµ–ä¸€ä¸ª atomic int æˆå‘˜å˜é‡è¡¨ç¤ºçš„åŒæ­¥çŠ¶æ€å’Œä¸€ä¸ª FIFO é˜Ÿåˆ—æ„æˆçš„ç­‰å¾…é˜Ÿåˆ—ã€‚å­ç±»å¿…é¡»é‡å†™ AQS çš„ protected ä¿®é¥°çš„ç”¨æ¥æ”¹å˜åŒæ­¥çŠ¶æ€çš„æ–¹æ³•ï¼Œ AQS çš„å…¶ä»–å‡ ä¸ªæ–¹æ³•å®ç°äº†æ’é˜Ÿå’Œé˜»å¡æœºåˆ¶ã€‚å­ç±»å¯ä»¥ç»´æŠ¤å…¶ä»–çŠ¶æ€å­—æ®µï¼Œä½†æ˜¯å»ºè®®æ›´æ–°åŒæ­¥çŠ¶æ€ä½¿ç”¨ getState() ã€ setState() ä»¥åŠ compareAndSetState() è¿™ä¸‰ä¸ªæ–¹æ³•ã€‚</p>
<p>å­ç±»åº”å®šä¹‰ä¸ºéå…¬å…±å†…éƒ¨å¸®åŠ©ç±»ç”¨äºå®ç°å…¶å°é—­ç±»çš„åŒæ­¥å±æ€§ï¼ŒAQS è‡ªèº«æ²¡æœ‰å®ç°ä»»ä½•åŒæ­¥æ¥å£ï¼Œå®ƒå®šä¹‰äº† acquireInterruptibly() è¿™ç±»æ–¹æ³•ï¼Œå®ƒå¯ä»¥è¢«å…·ä½“çš„é”å’Œç›¸å…³åŒæ­¥å™¨é‡Œé¢çš„å…¬å…±æ–¹æ³•è°ƒç”¨ã€‚</p>
<p>è¯¥ç±»æ”¯æŒé»˜è®¤çš„ç‹¬å å¼è·å–åŒæ­¥çŠ¶æ€å’Œå…±äº«å¼è·å–åŒæ­¥çŠ¶æ€çš„ä¸¤è€…æˆ–è€…ä¹‹ä¸€ï¼Œè¿™æ ·å°±å¯ä»¥æ–¹ä¾¿çš„å®ç°ä¸åŒç±»å‹çš„åŒæ­¥ç»„ä»¶ã€‚</p>
<p><strong>ä»€ä¹ˆæ˜¯ç‹¬å é”ï¼Ÿä»€ä¹ˆæ˜¯å…±äº«é”ï¼Ÿ</strong><br/>
ç‹¬å é”ä¹Ÿå«æ’å®ƒé”ï¼Œæ˜¯æŒ‡è¯¥é”ä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æŒæœ‰ï¼Œå¦‚æœåˆ«çš„çº¿ç¨‹æƒ³è¦è·å–é”ï¼Œåªæœ‰ç­‰åˆ°æŒæœ‰é”çš„çº¿ç¨‹é‡Šæ”¾é”ã€‚<strong>è·å¾—æ’å®ƒé”çš„çº¿ç¨‹æ—¢èƒ½è¯»å–æ•°æ®åˆèƒ½ä¿®æ”¹æ•°æ®</strong>ï¼Œä¸ä¹‹å¯¹ç«‹çš„å°±æ˜¯å…±äº«é”ã€‚å…±äº«é”æ˜¯æŒ‡è¯¥é”å¯è¢«å¤šä¸ªçº¿ç¨‹æ‰€æŒæœ‰ã€‚å¦‚æœçº¿ç¨‹Tå¯¹æ•°æ®AåŠ ä¸Šå…±äº«é”åï¼Œåˆ™å…¶ä»–çº¿ç¨‹åªèƒ½å¯¹Aå†åŠ å…±äº«é”ï¼Œä¸èƒ½åŠ æ’å®ƒé”ã€‚<strong>è·å¾—å…±äº«é”çš„çº¿ç¨‹åªèƒ½è¯»æ•°æ®ï¼Œä¸èƒ½ä¿®æ”¹æ•°æ®</strong>ã€‚</p>
<p>AQS ä½¿ç”¨äº†æ¨¡æ¿æ–¹æ³•è®¾è®¡æ¨¡å¼ï¼Œå­ç±»å¿…é¡»é‡å†™ AQS çš„ protected ä¿®é¥°çš„ç”¨æ¥æ”¹å˜åŒæ­¥çŠ¶æ€çš„æ–¹æ³•ï¼Œè¿˜è¦åœ¨è‡ªå·±çš„ public æ–¹æ³•ä¸­è°ƒç”¨ acquireInterruptibly() è¿™ç±»æ¨¡æ¿æ–¹æ³•ã€‚ä¾‹å¦‚ AQS ä¸­çš„tryAcquire(int arg)æ–¹æ³•å°±æ˜¯ä¸€ä¸ªè¢« protected ä¿®é¥°çš„ç”¨æ¥æ”¹å˜åŒæ­¥çŠ¶æ€çš„æ–¹æ³•ï¼Œåœ¨å‰é¢çš„ä»£ç ä¸­å¯ä»¥çœ‹åˆ° ReentrantLock çš„ FairSync å’Œ NonfairSync å¯¹ tryAcquire(int arg) æ–¹æ³•è¿›è¡Œäº†å¯¹ä¸åŒçš„é‡å†™ï¼Œè€Œ acquireInterruptibly(int arg) åˆ™è¢« ReentrantLock ä¸­çš„ lockInterruptibly() çš„ public æ–¹æ³•è°ƒç”¨ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">lockInterruptibly</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException {
    sync.acquireInterruptibly(<span class="hljs-number">1</span>);
}
</code></pre>
<p>å…¶ä¸­ AQS å¯ä»¥é‡å†™çš„æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * Attempts to acquire in exclusive mode. This method should query
 * if the state of the object permits it to be acquired in the
 * exclusive mode, and if so to acquire it.
 * ç‹¬å å¼è·å–åŒæ­¥çŠ¶æ€ã€‚è¯¥æ–¹æ³•åº”è¯¥æŸ¥è¯¢æ˜¯å¦å…è®¸ç‹¬å å¼è·å–åŒæ­¥çŠ¶æ€ï¼Œå¦‚æœå¯ä»¥å°±ä½¿ç”¨CASè·å–åŒæ­¥çŠ¶æ€
 */</span>
<span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryAcquire</span><span class="hljs-params">(<span class="hljs-type">int</span> arg)</span> {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>();
}

<span class="hljs-comment">/**
 * Attempts to set the state to reflect a release in exclusive
 * mode.
 *
 * &lt;p&gt;This method is always invoked by the thread performing release.
 * ç‹¬å å¼é‡Šæ”¾é”ï¼Œç­‰å¾…è·å–åŒæ­¥çŠ¶æ€çš„çº¿ç¨‹å°†æœ‰æœºä¼šè·å–åŒæ­¥çŠ¶æ€
 */</span>
<span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryRelease</span><span class="hljs-params">(<span class="hljs-type">int</span> arg)</span> {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>();
}

<span class="hljs-comment">/**
 * Attempts to acquire in shared mode. This method should query if
 * the state of the object permits it to be acquired in the shared
 * mode, and if so to acquire it.
 *
 * &lt;p&gt;This method is always invoked by the thread performing
 * acquire. If this method reports failure, the acquire method
 * may queue the thread, if it is not already queued, until it is
 * signalled by a release from some other thread.
 *
 * &lt;p&gt;The default implementation throws {<span class="hljs-doctag">@link</span>
 * UnsupportedOperationException}.
 * å…±äº«å¼è·å–åŒæ­¥çŠ¶æ€ï¼Œè¿”å›å€¼å¤§äºç­‰äº0è¡¨ç¤ºè·å–æˆåŠŸï¼Œåä¹‹è·å–å¤±è´¥
 */</span>
<span class="hljs-keyword">protected</span> <span class="hljs-type">int</span> <span class="hljs-title function_">tryAcquireShared</span><span class="hljs-params">(<span class="hljs-type">int</span> arg)</span> {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>();
}

<span class="hljs-comment">/**
 * Attempts to set the state to reflect a release in shared mode.
 *
 * &lt;p&gt;This method is always invoked by the thread performing release.
 *
 * &lt;p&gt;The default implementation throws
 * {<span class="hljs-doctag">@link</span> UnsupportedOperationException}.
 * å…±äº«å¼é‡Šæ”¾åŒæ­¥çŠ¶æ€
 */</span>
<span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryReleaseShared</span><span class="hljs-params">(<span class="hljs-type">int</span> arg)</span> {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>();
}

<span class="hljs-comment">/**
 * Returns {<span class="hljs-doctag">@code</span> true} if synchronization is held exclusively with
 * respect to the current (calling) thread. This method is invoked
 * upon each call to a non-waiting {<span class="hljs-doctag">@link</span> ConditionObject} method.
 * (Waiting methods instead invoke {<span class="hljs-doctag">@link</span> #release}.)
 * åŒæ­¥å™¨æ˜¯å¦è¢«å½“å‰çº¿ç¨‹ç‹¬å 
 */</span>
<span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isHeldExclusively</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>();
}
</code></pre>
<p>AQS æä¾›çš„æ¨¡æ¿æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * Acquires in exclusive mode, ignoring interrupts. Implemented
 * by invoking at least once {<span class="hljs-doctag">@link</span> #tryAcquire},
 * returning on success. Otherwise the thread is queued, possibly
 * repeatedly blocking and unblocking, invoking {<span class="hljs-doctag">@link</span>
 * #tryAcquire} until success. This method can be used
 * to implement method {<span class="hljs-doctag">@link</span> Lock#lock}.
 * ç‹¬å å¼è·å–åŒæ­¥çŠ¶æ€ï¼Œå¦‚æœæˆåŠŸç›´æ¥ç»“æŸï¼Œå¦‚æœå¤±è´¥çº¿ç¨‹å°†ä¼šè¿›å…¥åŒæ­¥é˜Ÿåˆ—ä¸­ç­‰å¾…ï¼Œè¯¥æ–¹æ³•ä¼šè°ƒç”¨é‡å†™çš„
 * tryAcquire()æ–¹æ³•
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">acquire</span><span class="hljs-params">(<span class="hljs-type">int</span> arg)</span> {
    <span class="hljs-keyword">if</span> (!tryAcquire(arg) &amp;&amp;
            acquireQueued(addWaiter(Node.EXCLUSIVE), arg))
        selfInterrupt();
}

<span class="hljs-comment">/**
 * Acquires in exclusive mode, aborting if interrupted.
 * Implemented by first checking interrupt status, then invoking
 * at least once {<span class="hljs-doctag">@link</span> #tryAcquire}, returning on
 * success. Otherwise the thread is queued, possibly repeatedly
 * blocking and unblocking, invoking {<span class="hljs-doctag">@link</span> #tryAcquire}
 * until success or the thread is interrupted. This method can be
 * used to implement method {<span class="hljs-doctag">@link</span> Lock#lockInterruptibly}.
 * ä¸acquire(int arg)ç›¸åŒï¼Œä½†è¯¥æ–¹æ³•å¯ä»¥å“åº”ä¸­æ–­ï¼Œè¢«ä¸­æ–­æ—¶æŠ›å‡ºInterruptedException
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">acquireInterruptibly</span><span class="hljs-params">(<span class="hljs-type">int</span> arg)</span>
        <span class="hljs-keyword">throws</span> InterruptedException {
    <span class="hljs-keyword">if</span> (Thread.interrupted())
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InterruptedException</span>();
    <span class="hljs-keyword">if</span> (!tryAcquire(arg))
        doAcquireInterruptibly(arg);
}

<span class="hljs-comment">/**
 * Attempts to acquire in exclusive mode, aborting if interrupted,
 * and failing if the given timeout elapses. Implemented by first
 * checking interrupt status, then invoking at least once {<span class="hljs-doctag">@link</span>
 * #tryAcquire}, returning on success. Otherwise, the thread is
 * queued, possibly repeatedly blocking and unblocking, invoking
 * {<span class="hljs-doctag">@link</span> #tryAcquire} until success or the thread is interrupted
 * or the timeout elapses. This method can be used to implement
 * method {<span class="hljs-doctag">@link</span> Lock#tryLock(long, TimeUnit)}.
 * åœ¨InterruptedException(int arg)åŸºç¡€ä¸Šå¢åŠ äº†è¶…æ—¶é™åˆ¶ï¼Œå¦‚æœå½“å‰çº¿ç¨‹åœ¨è¶…æ—¶æ—¶é—´å†…
 * æ²¡æœ‰è·å–åˆ°åŒæ­¥çŠ¶æ€ï¼Œå°†ä¼šè¿”å›falseï¼Œè·å–åˆ°äº†è¿”å›true
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryAcquireNanos</span><span class="hljs-params">(<span class="hljs-type">int</span> arg, <span class="hljs-type">long</span> nanosTimeout)</span>
        <span class="hljs-keyword">throws</span> InterruptedException {
    <span class="hljs-keyword">if</span> (Thread.interrupted())
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InterruptedException</span>();
    <span class="hljs-keyword">return</span> tryAcquire(arg) ||
            doAcquireNanos(arg, nanosTimeout);
}


<span class="hljs-comment">/**
 * Acquires in shared mode, ignoring interrupts. Implemented by
 * first invoking at least once {<span class="hljs-doctag">@link</span> #tryAcquireShared},
 * returning on success. Otherwise the thread is queued, possibly
 * repeatedly blocking and unblocking, invoking {<span class="hljs-doctag">@link</span>
 * #tryAcquireShared} until success.
 * å…±äº«å¼çš„è·å–åŒæ­¥çŠ¶æ€ï¼Œå¦‚æœå½“å‰çº¿ç¨‹æ²¡æœ‰è·å–åˆ°åŒæ­¥çŠ¶æ€ï¼Œå°†ä¼šè¿›å…¥åŒæ­¥é˜Ÿåˆ—ä¸­
 * ç­‰å¾…ï¼Œä¸ç‹¬å å¼è·å–çš„ä¸»è¦åŒºåˆ«æ˜¯åœ¨åŒä¸€æ—¶åˆ»å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹è·å–åŒæ­¥çŠ¶æ€
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">acquireShared</span><span class="hljs-params">(<span class="hljs-type">int</span> arg)</span> {
    <span class="hljs-keyword">if</span> (tryAcquireShared(arg) &lt; <span class="hljs-number">0</span>)
        doAcquireShared(arg);
}

<span class="hljs-comment">/**
 * Acquires in shared mode, aborting if interrupted. Implemented
 * by first checking interrupt status, then invoking at least once
 * {<span class="hljs-doctag">@link</span> #tryAcquireShared}, returning on success. Otherwise the
 * thread is queued, possibly repeatedly blocking and unblocking,
 * invoking {<span class="hljs-doctag">@link</span> #tryAcquireShared} until success or the thread
 * is interrupted.
 * ä¸acquireShared(int arg)ç›¸åŒï¼Œè¯¥æ–¹æ³•å“åº”ä¸­æ–­
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">acquireSharedInterruptibly</span><span class="hljs-params">(<span class="hljs-type">int</span> arg)</span>
        <span class="hljs-keyword">throws</span> InterruptedException {
    <span class="hljs-keyword">if</span> (Thread.interrupted())
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InterruptedException</span>();
    <span class="hljs-keyword">if</span> (tryAcquireShared(arg) &lt; <span class="hljs-number">0</span>)
        doAcquireSharedInterruptibly(arg);
}

<span class="hljs-comment">/**
 * Attempts to acquire in shared mode, aborting if interrupted, and
 * failing if the given timeout elapses. Implemented by first
 * checking interrupt status, then invoking at least once {<span class="hljs-doctag">@link</span>
 * #tryAcquireShared}, returning on success. Otherwise, the
 * thread is queued, possibly repeatedly blocking and unblocking,
 * invoking {<span class="hljs-doctag">@link</span> #tryAcquireShared} until success or the thread
 * is interrupted or the timeout elapses.
 * åœ¨acquireSharedInterruptibly(int arg)åŸºç¡€ä¸Šå¢åŠ äº†è¶…æ—¶é™åˆ¶
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryAcquireSharedNanos</span><span class="hljs-params">(<span class="hljs-type">int</span> arg, <span class="hljs-type">long</span> nanosTimeout)</span>
        <span class="hljs-keyword">throws</span> InterruptedException {
    <span class="hljs-keyword">if</span> (Thread.interrupted())
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InterruptedException</span>();
    <span class="hljs-keyword">return</span> tryAcquireShared(arg) &gt;= <span class="hljs-number">0</span> ||
            doAcquireSharedNanos(arg, nanosTimeout);
}

<span class="hljs-comment">/**
 * Releases in exclusive mode. Implemented by unblocking one or
 * more threads if {<span class="hljs-doctag">@link</span> #tryRelease} returns true.
 * This method can be used to implement method {<span class="hljs-doctag">@link</span> Lock#unlock}.
 * ç‹¬å å¼çš„é‡Šæ”¾åŒæ­¥çŠ¶æ€ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨é‡Šæ”¾åŒæ­¥çŠ¶æ€ä¹‹åï¼Œå°†é˜Ÿå¤´èŠ‚ç‚¹
 * çš„çº¿ç¨‹å”¤é†’
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">release</span><span class="hljs-params">(<span class="hljs-type">int</span> arg)</span> {
    <span class="hljs-keyword">if</span> (tryRelease(arg)) {
        <span class="hljs-type">Node</span> <span class="hljs-variable">h</span> <span class="hljs-operator">=</span> head;
        <span class="hljs-keyword">if</span> (h != <span class="hljs-literal">null</span> &amp;&amp; h.waitStatus != <span class="hljs-number">0</span>)
            unparkSuccessor(h);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}

<span class="hljs-comment">/**
 * Releases in shared mode. Implemented by unblocking one or more
 * threads if {<span class="hljs-doctag">@link</span> #tryReleaseShared} returns true.
 * å…±äº«å¼çš„é‡Šæ”¾åŒæ­¥çŠ¶æ€
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">releaseShared</span><span class="hljs-params">(<span class="hljs-type">int</span> arg)</span> {
    <span class="hljs-keyword">if</span> (tryReleaseShared(arg)) {
        doReleaseShared();
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}

<span class="hljs-comment">/**
 * Returns the first (longest-waiting) thread in the queue, or
 * {<span class="hljs-doctag">@code</span> null} if no threads are currently queued.
 *
 * &lt;p&gt;In this implementation, this operation normally returns in
 * constant time, but may iterate upon contention if other threads are
 * concurrently modifying the queue.
 * è·å–ç­‰å¾…åœ¨åŒæ­¥é˜Ÿåˆ—ä¸Šçš„çº¿ç¨‹é›†åˆ
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> Thread <span class="hljs-title function_">getFirstQueuedThread</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// handle only fast path, else relay</span>
    <span class="hljs-keyword">return</span> (head == tail) ? <span class="hljs-literal">null</span> : fullGetFirstQueuedThread();
}
</code></pre>
<p>AQS æä¾›çš„æ¨¡æ¿æ–¹æ³•å¯ä»¥åˆ†ä¸º3ç±»ï¼š</p>
<ol>
<li>ç‹¬å å¼è·å–ä¸é‡Šæ”¾åŒæ­¥çŠ¶æ€ï¼›</li>
<li>å…±äº«å¼è·å–ä¸é‡Šæ”¾åŒæ­¥çŠ¶æ€ï¼›</li>
<li>æŸ¥è¯¢åŒæ­¥é˜Ÿåˆ—ä¸­ç­‰å¾…çº¿ç¨‹æƒ…å†µï¼›</li>
</ol>
<p>æºç ä¸­æœ‰ä¸€ä¸ªä¾‹å­å¯ä»¥å¸®åŠ©æˆ‘ä»¬ç†è§£å¦‚ä½•ä½¿ç”¨ AQS å®ç°è‡ªå·±çš„åŒæ­¥é”ï¼Œè¿™ä¸ªä¾‹å­æ˜¯ä¸€ä¸ªä¸å¯é‡å…¥äº’æ–¥é”ç±»ï¼Œç”¨ 0 è¡¨ç¤ºè§£é”çŠ¶æ€ï¼Œ1 è¡¨ç¤ºè¡¨ç¤ºé”å®šçŠ¶æ€ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Mutex</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Lock</span>, java.io.Serializable {

    <span class="hljs-comment">// Our internal helper class</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Sync</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractQueuedSynchronizer</span> {
        <span class="hljs-comment">// Reports whether in locked state</span>
        <span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isHeldExclusively</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> getState() == <span class="hljs-number">1</span>;
        }

        <span class="hljs-comment">// Acquires the lock if state is zero</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryAcquire</span><span class="hljs-params">(<span class="hljs-type">int</span> acquires)</span> {
            <span class="hljs-keyword">assert</span> acquires == <span class="hljs-number">1</span>; <span class="hljs-comment">// Otherwise unused</span>
            <span class="hljs-keyword">if</span> (compareAndSetState(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>)) {
                setExclusiveOwnerThread(Thread.currentThread());
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }

        <span class="hljs-comment">// Releases the lock by setting state to zero</span>
        <span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryRelease</span><span class="hljs-params">(<span class="hljs-type">int</span> releases)</span> {
            <span class="hljs-keyword">assert</span> releases == <span class="hljs-number">1</span>; <span class="hljs-comment">// Otherwise unused</span>
            <span class="hljs-keyword">if</span> (getState() == <span class="hljs-number">0</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalMonitorStateException</span>();
            setExclusiveOwnerThread(<span class="hljs-literal">null</span>);
            setState(<span class="hljs-number">0</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }

        <span class="hljs-comment">// Provides a Condition</span>
        Condition <span class="hljs-title function_">newCondition</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConditionObject</span>();
        }

        <span class="hljs-comment">// Deserializes properly</span>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readObject</span><span class="hljs-params">(ObjectInputStream s)</span>
                <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException {
            s.defaultReadObject();
            setState(<span class="hljs-number">0</span>); <span class="hljs-comment">// reset to unlocked state</span>
        }
    }

    <span class="hljs-comment">// The sync object does all the hard work. We just forward to it.</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Sync</span> <span class="hljs-variable">sync</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Sync</span>();

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">lock</span><span class="hljs-params">()</span> {
        sync.acquire(<span class="hljs-number">1</span>);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryLock</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sync.tryAcquire(<span class="hljs-number">1</span>);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unlock</span><span class="hljs-params">()</span> {
        sync.release(<span class="hljs-number">1</span>);
    }

    <span class="hljs-keyword">public</span> Condition <span class="hljs-title function_">newCondition</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sync.newCondition();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isLocked</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sync.isHeldExclusively();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasQueuedThreads</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sync.hasQueuedThreads();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">lockInterruptibly</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException {
        sync.acquireInterruptibly(<span class="hljs-number">1</span>);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryLock</span><span class="hljs-params">(<span class="hljs-type">long</span> timeout, TimeUnit unit)</span>
            <span class="hljs-keyword">throws</span> InterruptedException {
        <span class="hljs-keyword">return</span> sync.tryAcquireNanos(<span class="hljs-number">1</span>, unit.toNanos(timeout));
    }

}
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MutexDemo</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Mutex</span> <span class="hljs-variable">mutex</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Mutex</span>();

    <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increase</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">10000</span>; j++) {
            count++; <span class="hljs-comment">//count++ä¸å…·å¤‡åŸå­æ€§</span>
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            mutex.lock();
            <span class="hljs-keyword">try</span> {
                increase();
            } <span class="hljs-keyword">finally</span> {
                mutex.unlock();
            }

        });
        thread1.start();


        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            mutex.lock();
            <span class="hljs-keyword">try</span> {
                increase();
            } <span class="hljs-keyword">finally</span> {
                mutex.unlock();
            }

        });
        thread2.start();

        <span class="hljs-keyword">try</span> {
            thread1.join();
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }

        <span class="hljs-keyword">try</span> {
            thread2.join();
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }

        System.out.println(<span class="hljs-string">"the count isï¼š "</span> + count);
    }

}
</code></pre>
<p>æ‰“å°ç»“æœä¸ºï¼š</p>
<pre><code class="hljs language-java" lang="java">the count isï¼š <span class="hljs-number">20000</span>
</code></pre>
<p>ç”±äº count++ ä¸å…·å¤‡åŸå­æ€§ï¼Œå®ƒæ˜¯å…ˆæŠŠ count åŠ  1 ç„¶åå†å†™å…¥æ–°çš„ count å€¼ã€‚å¦‚æœä¸æ·»åŠ é”ï¼Œæ‰“å°å‡ºæ¥çš„å€¼å¾ˆå¤§å¯èƒ½å°äº20000ã€‚</p>
<p>ä»è¿™ä¸ªä¾‹å­å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨AQSå¯ä»¥å¾ˆæ–¹ä¾¿åœ°å®ç°åŒæ­¥ç»„ä»¶ã€‚</p>
<h4 data-id="heading-3">ReentrantLock çš„ä¼˜åŠ¿</h4>
<p><code>ReentrantLock</code> æä¾›äº†æ¯” <code>synchronized</code> å…³é”®å­—æ›´çµæ´»çš„é”å®šæœºåˆ¶ï¼Œå¯ä»¥åœ¨ä»¥ä¸‹æƒ…å†µä¸‹ä¼˜å…ˆäº <code>synchronized</code> ä½¿ç”¨ï¼š</p>
<ol>
<li><strong>éœ€è¦æ˜¾å¼çš„é”å®šå’Œè§£é”</strong>ï¼š <code>ReentrantLock</code> å…è®¸ä½ æ˜¾å¼åœ°è·å–å’Œé‡Šæ”¾é”ï¼Œæä¾›äº†æ¯” <code>synchronized</code> æ›´ç»†ç²’åº¦çš„æ§åˆ¶ã€‚<strong>ä½ å¯ä»¥åœ¨ä¸åŒçš„æ–¹æ³•æˆ–ä»£ç å—ä¸­è·å–å’Œé‡Šæ”¾åŒä¸€ä¸ªé”ï¼Œè€Œä¸åƒ <code>synchronized</code> å¿…é¡»åœ¨åŒä¸€ä¸ªä»£ç å—ä¸­é‡Šæ”¾</strong>ã€‚</li>
<li><strong>éœ€è¦å°è¯•é”å®š</strong>ï¼š ä½¿ç”¨ <code>ReentrantLock</code> æ—¶å¯ä»¥è°ƒç”¨ <code>tryLock()</code> æ–¹æ³•ï¼Œå°è¯•è·å–é”è€Œä¸ä¼šä¸€ç›´é˜»å¡ã€‚å¦‚æœé”è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰ï¼Œ<code>tryLock()</code> å¯ä»¥è¿”å› <code>false</code>ï¼Œå…è®¸ä½ æ ¹æ®æƒ…å†µé‡‡å–å…¶ä»–æ“ä½œã€‚</li>
<li><strong>éœ€è¦å¯ä¸­æ–­çš„é”</strong>ï¼š <code>ReentrantLock</code> æä¾›äº† <code>lockInterruptibly()</code> æ–¹æ³•ï¼Œä½¿å¾—çº¿ç¨‹å¯ä»¥åœ¨ç­‰å¾…è·å–é”æ—¶å“åº”ä¸­æ–­è¯·æ±‚ã€‚<code>synchronized</code> åˆ™æ— æ³•å“åº”ä¸­æ–­ï¼Œçº¿ç¨‹åªèƒ½ä¸€ç›´é˜»å¡ï¼Œç›´åˆ°è·å–é”ã€‚</li>
<li><strong>éœ€è¦å…¬å¹³é”</strong>ï¼š <code>ReentrantLock</code> æä¾›äº†å…¬å¹³é”çš„æœºåˆ¶ï¼ˆé€šè¿‡æ„é€ æ–¹æ³• <code>new ReentrantLock(true)</code>ï¼‰ï¼Œè¿™æ„å‘³ç€é”å°†æŒ‰ç…§çº¿ç¨‹è¯·æ±‚çš„é¡ºåºè¿›è¡Œåˆ†é…ï¼Œè€Œ <code>synchronized</code> æ˜¯éå…¬å¹³çš„ï¼Œçº¿ç¨‹è·å–é”çš„é¡ºåºå¯èƒ½æ— æ³•é¢„æµ‹ã€‚</li>
<li><strong>éœ€è¦å¤šæ¡ä»¶ç­‰å¾…</strong>ï¼š <code>ReentrantLock</code> æ”¯æŒå¤šä¸ª <code>Condition</code> å¯¹è±¡ï¼Œå…è®¸çº¿ç¨‹åŸºäºä¸åŒçš„æ¡ä»¶æ¥ç­‰å¾…å’Œé€šçŸ¥ï¼Œå¢å¼ºäº†çµæ´»æ€§ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œ<code>synchronized</code> åªèƒ½ä½¿ç”¨å•ä¸ª <code>wait()</code> å’Œ <code>notify()</code> æœºåˆ¶æ¥è¿›è¡Œçº¿ç¨‹é—´çš„é€šä¿¡ã€‚</li>
<li><strong>æ€§èƒ½éœ€æ±‚</strong>ï¼š åœ¨æŸäº›é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œ<code>ReentrantLock</code> çš„æ€§èƒ½å¯èƒ½ä¼šä¼˜äº <code>synchronized</code>ã€‚å®ƒçš„å®ç°æ›´åŠ ä¼˜åŒ–ï¼Œå‡å°‘äº†é”äº‰ç”¨çš„å¼€é”€ã€‚</li>
</ol>
<p>æ€»çš„æ¥è¯´ï¼Œ<code>ReentrantLock</code> é€‚ç”¨äºéœ€è¦æ›´çµæ´»é”å®šæœºåˆ¶ã€æ›´å¤šæ§åˆ¶æƒæˆ–è€…æ›´å¤æ‚å¹¶å‘æ§åˆ¶åœºæ™¯çš„æƒ…å†µã€‚å¯¹äºç®€å•çš„åŒæ­¥éœ€æ±‚ï¼Œ<code>synchronized</code> å…³é”®å­—ä¾ç„¶æ˜¯é¦–é€‰ï¼Œå› ä¸ºå®ƒæ›´ç®€æ´ï¼Œä¸”åœ¨ç»å¤§å¤šæ•°åœºæ™¯ä¸­æ€§èƒ½è¡¨ç°è‰¯å¥½ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªä»»åŠ¡ç³»ç»Ÿï¼Œå…¶ä¸­å¤šä¸ªçº¿ç¨‹å°è¯•æ‰§è¡Œä¸€é¡¹å…³é”®ä»»åŠ¡ã€‚æˆ‘ä»¬å¸Œæœ›ï¼š</p>
<ol>
<li>çº¿ç¨‹åœ¨ç­‰å¾…è·å–é”æ—¶æœ‰ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªæ—¶é—´æœªèƒ½è·å–é”ï¼Œåˆ™æ‰§è¡Œå…¶ä»–æ“ä½œæˆ–é€€å‡ºã€‚</li>
<li>çº¿ç¨‹åœ¨ç­‰å¾…é”æ—¶å¯ä»¥è¢«ä¸­æ–­ï¼Œè€Œä¸å¿…ä¸€ç›´ç­‰å¾…ã€‚</li>
</ol>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>synchronized</code> æ— æ³•æä¾›è¿™æ ·çš„çµæ´»æ€§ï¼Œä½† <code>ReentrantLock</code> å¯ä»¥é€šè¿‡ <code>tryLock()</code> å’Œ <code>lockInterruptibly()</code> æ–¹æ³•æ¥å®ç°ã€‚</p>
<p>çœ‹å¦‚ä¸‹ä»£ç ç¤ºä¾‹ï¼šä½¿ç”¨ <code>ReentrantLock</code> å®ç°è¶…æ—¶å’Œå“åº”ä¸­æ–­</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CriticalTask</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();

    <span class="hljs-comment">// ä»»åŠ¡æ–¹æ³•ï¼Œå°è¯•åœ¨è¶…æ—¶å†…è·å–é”</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">performTask</span><span class="hljs-params">(String threadName)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// å°è¯•åœ¨ 2 ç§’å†…è·å–é”ï¼Œè¶…æ—¶åˆ™è¿”å› false</span>
            <span class="hljs-keyword">if</span> (lock.tryLock(<span class="hljs-number">2</span>, TimeUnit.SECONDS)) {
                <span class="hljs-keyword">try</span> {
                    System.out.println(threadName + <span class="hljs-string">" æˆåŠŸè·å–é”ï¼Œæ­£åœ¨æ‰§è¡Œä»»åŠ¡..."</span>);
                    <span class="hljs-comment">// æ¨¡æ‹Ÿä»»åŠ¡æ‰§è¡Œ</span>
                    Thread.sleep(<span class="hljs-number">1000</span>);
                    System.out.println(threadName + <span class="hljs-string">" ä»»åŠ¡å®Œæˆ"</span>);
                } <span class="hljs-keyword">finally</span> {
                    lock.unlock(); <span class="hljs-comment">// é‡Šæ”¾é”</span>
                    System.out.println(threadName + <span class="hljs-string">" å·²é‡Šæ”¾é”"</span>);
                }
            } <span class="hljs-keyword">else</span> {
                System.out.println(threadName + <span class="hljs-string">" è·å–é”è¶…æ—¶ï¼Œæ— æ³•æ‰§è¡Œä»»åŠ¡"</span>);
            }
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            System.out.println(threadName + <span class="hljs-string">" è¢«ä¸­æ–­ï¼Œä»»åŠ¡ä¸­æ­¢"</span>);
        }
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">CriticalTask</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CriticalTask</span>();

        <span class="hljs-comment">// åˆ›å»ºä¸¤ä¸ªçº¿ç¨‹ï¼Œæ¨¡æ‹Ÿå¹¶å‘ä»»åŠ¡æ‰§è¡Œ</span>
        <span class="hljs-type">Thread</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; task.performTask(<span class="hljs-string">"çº¿ç¨‹1"</span>));
        <span class="hljs-type">Thread</span> <span class="hljs-variable">t2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; task.performTask(<span class="hljs-string">"çº¿ç¨‹2"</span>));

        t1.start();
        t2.start();

        <span class="hljs-comment">// ä¸­æ–­çº¿ç¨‹t1ä»¥æ¨¡æ‹Ÿä¸­æ–­æƒ…å†µ</span>
        <span class="hljs-keyword">try</span> {
            Thread.sleep(<span class="hljs-number">500</span>);
            t1.interrupt(); <span class="hljs-comment">// ä¸­æ–­t1</span>
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }
    }
}
</code></pre>
<p>è¿™é‡Œ tryLock(2, TimeUnit.SECONDS) çº¿ç¨‹å°è¯•è·å–é”ï¼Œä½†å¦‚æœåœ¨ 2 ç§’å†…æœªèƒ½è·å–é”ï¼Œåˆ™ä¼šè¿”å› falseï¼Œä»è€Œé¿å…çº¿ç¨‹æ°¸ä¹…ç­‰å¾…é”çš„æƒ…å†µã€‚synchronized æ— æ³•å®ç°è¿™ç§è¶…æ—¶æœºåˆ¶ã€‚å¹¶ä¸”æˆ‘ä»¬åœ¨ä»£ç ä¸­æ¨¡æ‹Ÿäº†çº¿ç¨‹ t1 è¢«ä¸­æ–­çš„æƒ…å†µã€‚å¦‚æœä¸€ä¸ªçº¿ç¨‹åœ¨ç­‰å¾…é”æ—¶è¢«ä¸­æ–­ï¼ŒReentrantLock çš„ lockInterruptibly() æ–¹æ³•å¯ä»¥æ•è· InterruptedExceptionï¼Œä»è€Œä¸­æ­¢æ“ä½œå¹¶åŠæ—¶å“åº”ã€‚synchronized æ— æ³•å“åº”ä¸­æ–­ï¼Œçº¿ç¨‹åªèƒ½ä¸€ç›´é˜»å¡ç›´åˆ°é”è¢«é‡Šæ”¾ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å®¹å™¨è¿ç»´ï¼šä¸åŒå¹³å°ä¸‹ Docker/Podman ç½‘é—®é¢˜é…ç½®é€ŸæŸ¥]]></title>    <link>https://juejin.cn/post/7598472744480686099</link>    <guid>https://juejin.cn/post/7598472744480686099</guid>    <pubDate>2026-01-24T08:02:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598472744480686099" data-draft-id="7598480413803446314" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å®¹å™¨è¿ç»´ï¼šä¸åŒå¹³å°ä¸‹ Docker/Podman ç½‘é—®é¢˜é…ç½®é€ŸæŸ¥"/> <meta itemprop="keywords" content="å‰ç«¯,åç«¯,ç¨‹åºå‘˜"/> <meta itemprop="datePublished" content="2026-01-24T08:02:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç«è½¦å¼ä½"/> <meta itemprop="url" content="https://juejin.cn/user/1345457960792808"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å®¹å™¨è¿ç»´ï¼šä¸åŒå¹³å°ä¸‹ Docker/Podman ç½‘é—®é¢˜é…ç½®é€ŸæŸ¥
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1345457960792808/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç«è½¦å¼ä½
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T08:02:45.000Z" title="Sat Jan 24 2026 08:02:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. å‰è¨€ä¸æ ¸å¿ƒæ¦‚å¿µ</h2>
<p>åœ¨ç‰¹å®šçš„ç½‘ç»œç¯å¢ƒä¸‹ï¼Œé…ç½® Registry Mirrorï¼ˆé•œåƒåŠ é€Ÿï¼‰ä¸ HTTP/HTTPS Proxyï¼ˆç½‘ç»œä»£ç†ï¼‰æ˜¯ä¿éšœå®¹å™¨æœåŠ¡ç¨³å®šè¿è¡Œçš„åŸºç¡€å·¥ä½œã€‚æœ¬æ‰‹å†Œæ—¨åœ¨æä¾›ä¸€å¥—æ ‡å‡†åŒ–çš„æ“ä½œæµç¨‹ï¼Œè¦†ç›–ä¸»æµæ“ä½œç³»ç»ŸåŠç‰¹æ®Šç½‘ç»œè®¾å¤‡ã€‚</p>
<h3 data-id="heading-1">1.1 èŒƒå›´ä¸åˆ†ç»„åŸåˆ™</h3>
<p>æˆ‘ä»¬å°†é…ç½®åœºæ™¯åˆ†ä¸ºä¸¤å¤§ç±»ï¼š</p>
<ul>
<li><strong>é•œåƒåŠ é€Ÿ (Registry Mirror)</strong>ï¼šä»…é’ˆå¯¹ <code>docker pull</code> æ“ä½œï¼Œä½œç”¨äº Daemon å±‚é¢ï¼Œé€šå¸¸ä¸æ¶‰åŠé‰´æƒã€‚</li>
<li><strong>é€šç”¨ä»£ç† (HTTP Proxy)</strong>ï¼šå½±å“ <code>docker build</code>ã€<code>docker push</code> åŠå®¹å™¨è¿è¡Œæ—¶çš„å¤–ç½‘è®¿é—®ã€‚</li>
</ul>
<h3 data-id="heading-2">1.2 å®‰å…¨ä¸åˆè§„æç¤º</h3>
<blockquote>
<p><strong>âš ï¸ è­¦å‘Š</strong></p>
<ul>
<li>
<p><strong>è¯ä¹¦ä¿¡ä»»</strong>ï¼šé…ç½®ç§æœ‰æºæˆ–å…¬å¸ä»£ç†æ—¶ï¼Œå¿…é¡»ç¡®ä¿ CA è¯ä¹¦å·²å¯¼å…¥å®¿ä¸»æœºåŠ Docker ä¿¡ä»»åŒºã€‚</p>
</li>
<li>
<p><strong>å‡­è¯æ³„éœ²</strong>ï¼šä¸¥ç¦å°†åŒ…å«è´¦å·å¯†ç çš„ä»£ç† URLï¼ˆå¦‚ <code>user:pass@proxy</code>ï¼‰æäº¤åˆ°å…¬å…±ä»£ç ä»“åº“ã€‚</p>
</li>
<li>
<p><strong>NO_PROXY</strong>ï¼šåŠ¡å¿…æ’é™¤ <code>localhost</code>ã€<code>127.0.0.1</code> åŠå†…éƒ¨åŸŸåï¼Œé˜²æ­¢å†…éƒ¨æµé‡è¯¯èµ°ä»£ç†å¯¼è‡´æœåŠ¡ä¸å¯è¾¾ã€‚</p>
</li>
</ul>
</blockquote>
<hr/>
<h2 data-id="heading-3">2. Linux (Systemd) å®˜æ–¹ Docker Engine</h2>
<blockquote>
<p><strong>é€‚ç”¨èŒƒå›´</strong>ï¼šUbuntu, Debian, CentOS, Fedora, RHEL, Arch Linux ç­‰æ ‡å‡†ç”Ÿäº§ç¯å¢ƒã€‚</p>
</blockquote>
<h3 data-id="heading-4">2.1 é…ç½® Registry Mirror (daemon.json)</h3>
<p>é•œåƒæºé…ç½®ä½äº <code>/etc/docker/daemon.json</code>ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¯·æ–°å»ºã€‚</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"registry-mirrors"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"https://mirror.example.com"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"https://docker.company-mirror.com"</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"insecure-registries"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"debug"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span>
<span class="hljs-punctuation">}</span>

</code></pre>
<h3 data-id="heading-5">2.2 é…ç½® HTTP/HTTPS ä»£ç† (Systemd Override)</h3>
<p>ä¸ºäº†è®© Docker Daemon èƒ½å¤Ÿé€šè¿‡ä»£ç†æ‹‰å–é•œåƒæˆ–æ‰§è¡Œæ„å»ºï¼Œ<strong>åˆ‡å‹¿ç›´æ¥ä¿®æ”¹</strong> <code>/lib/systemd/system/docker.service</code>ï¼Œåº”ä½¿ç”¨ Systemd Drop-in æœºåˆ¶ã€‚</p>
<ol>
<li><strong>åˆ›å»ºé…ç½®ç›®å½•</strong></li>
</ol>
<pre><code class="hljs language-bash" lang="bash">sudo <span class="hljs-built_in">mkdir</span> -p /etc/systemd/system/docker.service.d

</code></pre>
<ol start="2">
<li><strong>åˆ›å»ºä»£ç†é…ç½®æ–‡ä»¶</strong>
ç¼–è¾‘ <code>/etc/systemd/system/docker.service.d/proxy.conf</code>ï¼š</li>
</ol>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[Service]</span>
<span class="hljs-attr">Environment</span>=<span class="hljs-string">"HTTP_PROXY=http://192.168.1.100:7890"</span>
<span class="hljs-attr">Environment</span>=<span class="hljs-string">"HTTPS_PROXY=http://192.168.1.100:7890"</span>
<span class="hljs-attr">Environment</span>=<span class="hljs-string">"NO_PROXY=localhost,127.0.0.1,docker-registry.somecorporation.com"</span>

</code></pre>
<ol start="3">
<li><strong>é‡è½½å¹¶é‡å¯</strong></li>
</ol>
<pre><code class="hljs language-bash" lang="bash">sudo systemctl daemon-reload &amp;&amp; sudo systemctl restart docker

</code></pre>
<ol start="4">
<li><strong>éªŒè¯é…ç½®</strong>
è¿è¡Œ <code>docker info</code>ï¼Œæ£€æŸ¥è¾“å‡ºä¸­çš„ "Registry Mirrors" å’Œ "HTTP Proxy" å­—æ®µã€‚</li>
</ol>
<hr/>
<h2 data-id="heading-6">3. Podman é…ç½®å·®å¼‚</h2>
<p>Podman é‡‡ç”¨æ— å®ˆæŠ¤è¿›ç¨‹ï¼ˆDaemonlessï¼‰æ¶æ„ï¼Œå…¶é…ç½®é€»è¾‘ä¸ Docker æœ‰æ˜¾è‘—ä¸åŒã€‚</p>
<h3 data-id="heading-7">3.1 Docker vs Podman é…ç½®å¯¹æ¯”</h3>






























<table><thead><tr><th>é…ç½®é¡¹</th><th>Docker</th><th>Podman</th></tr></thead><tbody><tr><td><strong>é…ç½®æ–‡ä»¶æ ¼å¼</strong></td><td>JSON (<code>daemon.json</code>)</td><td>TOML (<code>registries.conf</code>)</td></tr><tr><td><strong>ç³»ç»Ÿçº§è·¯å¾„</strong></td><td><code>/etc/docker/daemon.json</code></td><td><code>/etc/containers/registries.conf</code></td></tr><tr><td><strong>ç”¨æˆ·çº§è·¯å¾„</strong></td><td>ä¸æ”¯æŒ (ä¾èµ– Daemon)</td><td><code>~/.config/containers/registries.conf</code></td></tr><tr><td><strong>ä»£ç†ç”Ÿæ•ˆæ–¹å¼</strong></td><td>Systemd Service æ³¨å…¥</td><td>ç›´æ¥è¯»å– Shell ç¯å¢ƒå˜é‡ (CLI)</td></tr></tbody></table>
<h3 data-id="heading-8">3.2 Podman é•œåƒæºé…ç½®</h3>
<p>ç¼–è¾‘ <code>registries.conf</code>ï¼š</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-comment"># é…ç½® docker.io çš„é•œåƒåŠ é€Ÿ</span>
<span class="hljs-section">[[registry]]</span>
<span class="hljs-attr">prefix</span> = <span class="hljs-string">"docker.io"</span>
<span class="hljs-attr">location</span> = <span class="hljs-string">"docker.io"</span>

<span class="hljs-section">[[registry.mirror]]</span>
<span class="hljs-attr">location</span> = <span class="hljs-string">"mirror.example.com"</span>

<span class="hljs-section">[[registry.mirror]]</span>
<span class="hljs-attr">location</span> = <span class="hljs-string">"docker.mirrors.ustc.edu.cn"</span>

<span class="hljs-comment"># å…è®¸çŸ­åç§°æœç´¢ (å¦‚ podman pull alpine)</span>
<span class="hljs-attr">unqualified-search-registries</span> = [<span class="hljs-string">"docker.io"</span>]

</code></pre>
<hr/>
<h2 data-id="heading-9">4. Windows (Docker Desktop) &amp; WSL2</h2>
<h3 data-id="heading-10">4.1 Docker Desktop (GUI)</h3>
<p>Docker Desktop å±è”½äº†åº•å±‚å¤æ‚æ€§ï¼Œæ¨èä¼˜å…ˆé€šè¿‡ GUI é…ç½®ã€‚</p>
<ol>
<li><strong>è®¾ç½®ä»£ç† (Proxy)</strong>ï¼š</li>
</ol>
<ul>
<li>è¿›å…¥ <strong>Settings</strong> -&gt; <strong>Resources</strong> -&gt; <strong>Proxies</strong>ã€‚</li>
<li>å¼€å¯ "Manual proxy configuration"ã€‚</li>
<li>å¡«å…¥ <code>http://127.0.0.1:7890</code> (å‡è®¾ä½¿ç”¨æœ¬æœº Windows ä»£ç†è½¯ä»¶)ã€‚</li>
</ul>
<ol start="2">
<li><strong>è®¾ç½®é•œåƒ (Docker Engine)</strong>ï¼š</li>
</ol>
<ul>
<li>è¿›å…¥ <strong>Settings</strong> -&gt; <strong>Docker Engine</strong>ã€‚</li>
<li>åœ¨ JSON ç¼–è¾‘å™¨ä¸­æ·»åŠ  <code>"registry-mirrors"</code> å­—æ®µï¼Œå†…å®¹åŒ Linux ç»„é…ç½®ã€‚</li>
</ul>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼šå¦‚æœåœ¨ WSL2 å‘½ä»¤è¡Œç›´æ¥ä½¿ç”¨ <code>docker</code> å‘½ä»¤ï¼ˆè¿æ¥ Desktop åç«¯ï¼‰ï¼Œä¸Šè¿° GUI é…ç½®ä¼šè‡ªåŠ¨ç”Ÿæ•ˆã€‚</p>
</blockquote>
<h3 data-id="heading-11">4.2 WSL2 åŸç”Ÿå‘è¡Œç‰ˆ (é Desktop)</h3>
<p>å¦‚æœä½ åœ¨ WSL2 (Ubuntu/Debian) å†…ç‹¬ç«‹å®‰è£…äº† Docker Engineï¼Œéœ€æ³¨æ„ç½‘ç»œäº’é€šé—®é¢˜ã€‚</p>
<ul>
<li><strong>ç½‘ç»œä»£ç†æŒ‡å‘</strong>ï¼šWSL2 æ— æ³•ç›´æ¥é€šè¿‡ <code>127.0.0.1</code> è®¿é—® Windows ä¸Šçš„ä»£ç†ã€‚å¿…é¡»ä½¿ç”¨ <code>host.docker.internal</code>ã€‚</li>
<li><strong>Systemd æ”¯æŒ</strong>ï¼šç¡®ä¿ <code>/etc/wsl.conf</code> ä¸­å·²å¯ç”¨ <code>systemd=true</code>ã€‚</li>
</ul>
<p>é…ç½®ç¤ºä¾‹ (<code>/etc/systemd/system/docker.service.d/proxy.conf</code>)ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[Service]</span>
<span class="hljs-comment"># æ³¨æ„ï¼šhost.docker.internal éœ€è¦ WSL2 ç‰ˆæœ¬æ”¯æŒæˆ–æ‰‹åŠ¨é…ç½® hosts</span>
<span class="hljs-attr">Environment</span>=<span class="hljs-string">"HTTP_PROXY=http://host.docker.internal:7890"</span>
<span class="hljs-attr">Environment</span>=<span class="hljs-string">"HTTPS_PROXY=http://host.docker.internal:7890"</span>
<span class="hljs-attr">Environment</span>=<span class="hljs-string">"NO_PROXY=localhost,127.0.0.1,*.internal,172.16.0.0/12"</span>

</code></pre>
<hr/>
<h2 data-id="heading-12">5. ç‰¹æ®Šç¯å¢ƒï¼šNAS ä¸ è·¯ç”±å™¨</h2>
<h3 data-id="heading-13">5.1 Synology ç¾¤æ™– (DSM)</h3>
<p>ç¾¤æ™– DSM å¯¹ Docker è·¯å¾„è¿›è¡Œäº†å®šåˆ¶ï¼Œä¸”å‡çº§å¯èƒ½é‡ç½®é…ç½®ã€‚</p>
<ul>
<li>
<p><strong>å›¾å½¢ç•Œé¢é…ç½® (æ¨è)</strong>ï¼š</p>
</li>
<li>
<p>æ‰“å¼€ <strong>Container Manager</strong> (DSM 7.2+) æˆ– Docker å¥—ä»¶ã€‚</p>
</li>
<li>
<p><strong>Registry</strong>ï¼šåœ¨è®¾ç½®ä¸­é€‰ä¸­ Docker Hub -&gt; Editï¼Œå¯ç”¨ "Registry Mirrors" å¹¶å¡«å…¥ URLã€‚</p>
</li>
<li>
<p><strong>Proxy</strong>ï¼šé€šå¸¸éœ€åœ¨æ§åˆ¶é¢æ¿çš„ç½‘ç»œè®¾ç½®ä¸­å…¨å±€é…ç½®ã€‚</p>
</li>
<li>
<p><strong>é…ç½®æ–‡ä»¶è·¯å¾„ (SSH)</strong>ï¼š</p>
</li>
<li>
<p>æ ‡å‡†è·¯å¾„ (DSM 7.2+)ï¼š<code>/var/packages/ContainerManager/etc/dockerd.json</code></p>
</li>
<li>
<p>æ—§ç‰ˆè·¯å¾„ï¼š<code>/var/packages/Docker/etc/dockerd.json</code></p>
</li>
<li>
<p>*ä¿®æ”¹åéœ€é‡å¯å¥—ä»¶ï¼š<code>synopkg restart ContainerManager*</code></p>
</li>
</ul>
<h3 data-id="heading-14">5.2 OpenWrt</h3>
<p>OpenWrt ä½¿ç”¨ <code>procd</code> ç®¡ç†æœåŠ¡ã€‚éœ€ä¿®æ”¹ <code>/etc/init.d/dockerd</code> è„šæœ¬ã€‚</p>
<p><strong>æ³¨å…¥ä»£ç†ç¯å¢ƒå˜é‡ï¼š</strong>
åœ¨ <code>start_service()</code> å‡½æ•°ä¸­æ·»åŠ  <code>procd_set_param env</code>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-function"><span class="hljs-title">start_service</span></span>() {
    procd_open_instance
    procd_set_param <span class="hljs-built_in">command</span> /usr/bin/dockerd
    
    <span class="hljs-comment"># æ·»åŠ ä»¥ä¸‹è¡Œé…ç½®ä»£ç†</span>
    procd_set_param <span class="hljs-built_in">env</span> HTTP_PROXY=http://192.168.1.5:7890
    procd_set_param <span class="hljs-built_in">env</span> HTTPS_PROXY=http://192.168.1.5:7890
    procd_set_param <span class="hljs-built_in">env</span> NO_PROXY=localhost,127.0.0.1
    
    procd_close_instance
}

</code></pre>
<p>*é…ç½®å®Œæˆåé‡å¯æœåŠ¡ï¼š<code>/etc/init.d/dockerd restart*</code></p>
<hr/>
<h2 data-id="heading-15">6. éªŒè¯è„šæœ¬ä¸æ•…éšœæ’æŸ¥</h2>
<h3 data-id="heading-16">6.1 è‡ªåŠ¨åŒ–éªŒè¯è„šæœ¬ (Ubuntu/Linux)</h3>
<p>ä½¿ç”¨ä»¥ä¸‹è„šæœ¬æ£€æµ‹é…ç½®æ˜¯å¦ç”Ÿæ•ˆï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"&gt;&gt;&gt; æ£€æŸ¥ Docker æœåŠ¡çŠ¶æ€..."</span>
systemctl is-active docker || { <span class="hljs-built_in">echo</span> <span class="hljs-string">"Docker æœªè¿è¡Œ"</span>; <span class="hljs-built_in">exit</span> 1; }

<span class="hljs-built_in">echo</span> <span class="hljs-string">"&gt;&gt;&gt; æ£€æŸ¥ Proxy ç¯å¢ƒå˜é‡..."</span>
<span class="hljs-comment"># è·å– dockerd è¿›ç¨‹çš„ç¯å¢ƒå˜é‡</span>
PID=$(pgrep -n dockerd)
<span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$PID</span>"</span> ]; <span class="hljs-keyword">then</span> <span class="hljs-built_in">echo</span> <span class="hljs-string">"æ— æ³•æ‰¾åˆ° dockerd è¿›ç¨‹"</span>; <span class="hljs-built_in">exit</span> 1; <span class="hljs-keyword">fi</span>
sudo <span class="hljs-built_in">cat</span> /proc/<span class="hljs-variable">$PID</span>/environ | <span class="hljs-built_in">tr</span> <span class="hljs-string">'\0'</span> <span class="hljs-string">'\n'</span> | grep -E <span class="hljs-string">'HTTP_PROXY|HTTPS_PROXY|NO_PROXY'</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"&gt;&gt;&gt; æ£€æŸ¥ Registry Mirrors..."</span>
docker info --format <span class="hljs-string">'{{json .RegistryConfig.Mirrors}}'</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"&gt;&gt;&gt; ç½‘ç»œè¿é€šæ€§æµ‹è¯•..."</span>
docker pull hello-world

</code></pre>
<h3 data-id="heading-17">6.2 å¸¸è§æ•…éšœæ’æŸ¥</h3>
<ol>
<li><strong>JSON è¯­æ³•é”™è¯¯</strong>ï¼š</li>
</ol>
<ul>
<li>ç°è±¡ï¼šDocker æ— æ³•å¯åŠ¨ã€‚</li>
<li>è§£å†³ï¼šä½¿ç”¨ <code>jq . /etc/docker/daemon.json</code> éªŒè¯è¯­æ³•ï¼Œæ³¨æ„æœ«å°¾é€—å·ã€‚</li>
</ul>
<ol start="2">
<li><strong>ä»£ç†ä¸å¯è¾¾</strong>ï¼š</li>
</ol>
<ul>
<li>ç°è±¡ï¼šPull è¶…æ—¶ã€‚</li>
<li>è§£å†³ï¼šç¡®ä¿å®¿ä¸»æœºèƒ½ <code>ping</code> é€šä»£ç† IPã€‚æ£€æŸ¥é˜²ç«å¢™ï¼ˆufw/iptablesï¼‰æ˜¯å¦æ‹¦æˆªã€‚</li>
</ul>
<ol start="3">
<li><strong>DNS è§£æå¤±è´¥</strong>ï¼š</li>
</ol>
<ul>
<li>ç°è±¡ï¼šæŠ¥é”™ <code>lookup ... no such host</code>ã€‚</li>
<li>è§£å†³ï¼šæ£€æŸ¥ <code>/etc/resolv.conf</code> æˆ–åœ¨ <code>daemon.json</code> ä¸­æ·»åŠ  <code>"dns": ["8.8.8.8"]</code>ã€‚</li>
</ul>
<h3 data-id="heading-18">6.3 é…ç½®æ–‡ä»¶è·¯å¾„é€ŸæŸ¥è¡¨</h3>





























<table><thead><tr><th>æ–‡ä»¶ç”¨é€”</th><th>å…¸å‹è·¯å¾„</th></tr></thead><tbody><tr><td><strong>Docker é•œåƒé…ç½®</strong></td><td><code>/etc/docker/daemon.json</code></td></tr><tr><td><strong>Docker ä»£ç†é…ç½®</strong></td><td><code>/etc/systemd/system/docker.service.d/proxy.conf</code></td></tr><tr><td><strong>Podman ç³»ç»Ÿé…ç½®</strong></td><td><code>/etc/containers/registries.conf</code></td></tr><tr><td><strong>Podman ç”¨æˆ·é…ç½®</strong></td><td><code>~/.config/containers/registries.conf</code></td></tr><tr><td><strong>TLS è¯ä¹¦ç›®å½•</strong></td><td><code>/etc/docker/certs.d/&lt;domain&gt;/ca.crt</code></td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[GitHub Issues é›†æˆ]]></title>    <link>https://juejin.cn/post/7598532592455630875</link>    <guid>https://juejin.cn/post/7598532592455630875</guid>    <pubDate>2026-01-24T07:55:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598532592455630875" data-draft-id="7598827845964988442" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="GitHub Issues é›†æˆ"/> <meta itemprop="keywords" content="å‰ç«¯,AIç¼–ç¨‹"/> <meta itemprop="datePublished" content="2026-01-24T07:55:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="newbe36524"/> <meta itemprop="url" content="https://juejin.cn/user/2682464104098654"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            GitHub Issues é›†æˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2682464104098654/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    newbe36524
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T07:55:22.000Z" title="Sat Jan 24 2026 07:55:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä»é›¶æ„å»º GitHub Issues é›†æˆï¼šHagiCode çš„å‰ç«¯ç›´è¿å®è·µ</h2>
<blockquote>
<p>æœ¬æ–‡è®°å½•äº†åœ¨ HagiCode å¹³å°ä¸­é›†æˆ GitHub Issues çš„å…¨è¿‡ç¨‹ã€‚æˆ‘ä»¬å°†æ¢è®¨å¦‚ä½•é€šè¿‡"å‰ç«¯ç›´è¿ + åç«¯æœ€å°åŒ–"çš„æ¶æ„ï¼Œåœ¨ä¿æŒåç«¯è½»é‡çš„åŒæ—¶ï¼Œå®ç°å®‰å…¨çš„ OAuth è®¤è¯ä¸é«˜æ•ˆçš„ Issues åŒæ­¥ã€‚</p>
</blockquote>
<h3 data-id="heading-1">èƒŒæ™¯ï¼šä¸ºä»€ä¹ˆè¦é›†æˆ GitHubï¼Ÿ</h3>
<p>HagiCode ä½œä¸ºä¸€ä¸ª AI è¾…åŠ©å¼€å‘å¹³å°ï¼Œæ ¸å¿ƒä»·å€¼åœ¨äºè¿æ¥æƒ³æ³•ä¸å®ç°ã€‚ä½†åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œæˆ‘ä»¬å‘ç°ç”¨æˆ·åœ¨ HagiCode ä¸­å®Œæˆäº† Proposalï¼ˆææ¡ˆï¼‰åï¼Œå¾€å¾€éœ€è¦æ‰‹åŠ¨å°†å†…å®¹å¤åˆ¶åˆ° GitHub Issues ä¸­è¿›è¡Œé¡¹ç›®è·Ÿè¸ªã€‚</p>
<p>è¿™å¸¦æ¥äº†å‡ ä¸ªæ˜æ˜¾çš„ç—›ç‚¹ï¼š</p>
<ol>
<li><strong>å·¥ä½œæµå‰²è£‚</strong>ï¼šç”¨æˆ·éœ€è¦åœ¨ä¸¤ä¸ªç³»ç»Ÿä¹‹é—´æ¥å›åˆ‡æ¢ï¼Œä½“éªŒä¸ä»…ä¸æµç•…ï¼Œè¿˜å®¹æ˜“å¯¼è‡´å…³é”®ä¿¡æ¯åœ¨å¤åˆ¶ç²˜è´´çš„è¿‡ç¨‹ä¸­ä¸¢å¤±ã€‚</li>
<li><strong>åä½œä¸ä¾¿</strong>ï¼šå›¢é˜Ÿå…¶ä»–æˆå‘˜ä¹ æƒ¯åœ¨ GitHub ä¸ŠæŸ¥çœ‹ä»»åŠ¡ï¼Œæ— æ³•ç›´æ¥çœ‹åˆ° HagiCode ä¸­çš„ææ¡ˆè¿›å±•ã€‚</li>
<li><strong>é‡å¤åŠ³åŠ¨</strong>ï¼šæ¯å½“ææ¡ˆæ›´æ–°ï¼Œå°±è¦äººå·¥å» GitHub æ›´æ–°å¯¹åº”çš„ Issueï¼Œå¢åŠ ä¸å¿…è¦çš„ç»´æŠ¤æˆæœ¬ã€‚</li>
</ol>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å†³å®šå¼•å…¥ <strong>GitHub Issues Integration</strong> åŠŸèƒ½ï¼Œæ‰“é€š HagiCode ä¼šè¯ä¸ GitHub ä»“åº“çš„è¿æ¥ï¼Œå®ç°"ä¸€é”®åŒæ­¥"ã€‚</p>
<h3 data-id="heading-2">å…³äº HagiCode</h3>
<blockquote>
<p>å˜¿ï¼Œä»‹ç»ä¸€ä¸‹æˆ‘ä»¬æ­£åœ¨åšçš„ä¸œè¥¿</p>
</blockquote>
<p>æˆ‘ä»¬æ­£åœ¨å¼€å‘ <strong>HagiCode</strong> â€”â€” ä¸€æ¬¾ AI é©±åŠ¨çš„ä»£ç æ™ºèƒ½åŠ©æ‰‹ï¼Œè®©å¼€å‘ä½“éªŒå˜å¾—æ›´æ™ºèƒ½ã€æ›´ä¾¿æ·ã€æ›´æœ‰è¶£ã€‚</p>
<p><strong>æ™ºèƒ½</strong> â€”â€” AI å…¨ç¨‹è¾…åŠ©ï¼Œä»æƒ³æ³•åˆ°ä»£ç ï¼Œè®©ç¼–ç æ•ˆç‡æå‡æ•°å€ã€‚<strong>ä¾¿æ·</strong> â€”â€” å¤šçº¿ç¨‹å¹¶å‘æ“ä½œï¼Œå……åˆ†åˆ©ç”¨èµ„æºï¼Œå¼€å‘æµç¨‹é¡ºç•…æ— é˜»ã€‚<strong>æœ‰è¶£</strong> â€”â€” æ¸¸æˆåŒ–æœºåˆ¶å’Œæˆå°±ç³»ç»Ÿï¼Œè®©ç¼–ç ä¸å†æ¯ç‡¥ï¼Œå……æ»¡æˆå°±æ„Ÿã€‚</p>
<p>é¡¹ç›®æ­£åœ¨å¿«é€Ÿè¿­ä»£ä¸­ï¼Œå¦‚æœä½ å¯¹æŠ€æœ¯å†™ä½œã€çŸ¥è¯†ç®¡ç†æˆ–è€… AI è¾…åŠ©å¼€å‘æ„Ÿå…´è¶£ï¼Œæ¬¢è¿æ¥ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FHagiCode-org%2Fsite" target="_blank" title="https://github.com/HagiCode-org/site" ref="nofollow noopener noreferrer">GitHub</a> çœ‹çœ‹ï½</p>
<hr/>
<h3 data-id="heading-3">æŠ€æœ¯é€‰å‹ï¼šå‰ç«¯ç›´è¿ vs åç«¯ä»£ç†</h3>
<p>åœ¨è®¾è®¡é›†æˆæ–¹æ¡ˆæ—¶ï¼Œæ‘†åœ¨æˆ‘ä»¬é¢å‰çš„æœ‰ä¸¤æ¡è·¯ï¼šä¼ ç»Ÿçš„"åç«¯ä»£ç†æ¨¡å¼"å’Œæ›´æ¿€è¿›çš„"å‰ç«¯ç›´è¿æ¨¡å¼"ã€‚</p>
<h4 data-id="heading-4">æ–¹æ¡ˆå¯¹æ¯”</h4>
<p>åœ¨ä¼ ç»Ÿçš„<strong>åç«¯ä»£ç†æ¨¡å¼</strong>ä¸­ï¼Œå‰ç«¯æ‰€æœ‰çš„è¯·æ±‚éƒ½è¦å…ˆç»è¿‡æˆ‘ä»¬çš„åç«¯ï¼Œå†ç”±åç«¯å»è°ƒç”¨ GitHub APIã€‚è¿™è™½ç„¶é€»è¾‘é›†ä¸­ï¼Œä½†ç»™åç«¯å¸¦æ¥äº†ä¸å°çš„è´Ÿæ‹…ï¼š</p>
<ol>
<li><strong>åç«¯è‡ƒè‚¿</strong>ï¼šéœ€è¦ç¼–å†™ä¸“é—¨çš„ GitHub API å®¢æˆ·ç«¯å°è£…ï¼Œè¿˜è¦å¤„ç† OAuth çš„å¤æ‚çŠ¶æ€æœºã€‚</li>
<li><strong>Token é£é™©</strong>ï¼šç”¨æˆ·çš„ GitHub Token å¿…é¡»å­˜å‚¨åœ¨åç«¯æ•°æ®åº“ä¸­ï¼Œè™½ç„¶å¯ä»¥åŠ å¯†ï¼Œä½†æ¯•ç«Ÿå¢åŠ äº†å®‰å…¨é£é™©é¢ã€‚</li>
<li><strong>å¼€å‘æˆæœ¬</strong>ï¼šéœ€è¦æ•°æ®åº“è¿ç§»æ¥å­˜å‚¨ Tokenï¼Œè¿˜éœ€è¦ç»´æŠ¤ä¸€å¥—é¢å¤–çš„åŒæ­¥æœåŠ¡ã€‚</li>
</ol>
<p>è€Œ<strong>å‰ç«¯ç›´è¿æ¨¡å¼</strong>åˆ™è¦è½»é‡å¾—å¤šã€‚åœ¨è¿™ä¸ªæ–¹æ¡ˆä¸­ï¼Œæˆ‘ä»¬åªåˆ©ç”¨åç«¯æ¥å¤„ç†æœ€æ•æ„Ÿçš„"å¯†é’¥äº¤æ¢"ç¯èŠ‚ï¼ˆOAuth callbackï¼‰ï¼Œè·å–åˆ° Token åï¼Œç›´æ¥å­˜åœ¨æµè§ˆå™¨çš„ localStorage é‡Œã€‚åç»­åˆ›å»º Issueã€æ›´æ–°è¯„è®ºç­‰æ“ä½œï¼Œç›´æ¥ç”±å‰ç«¯å‘ HTTP è¯·æ±‚åˆ° GitHubã€‚</p>






























<table><thead><tr><th align="left">å¯¹æ¯”ç»´åº¦</th><th align="left">åç«¯ä»£ç†æ¨¡å¼</th><th align="left">å‰ç«¯ç›´è¿æ¨¡å¼</th></tr></thead><tbody><tr><td align="left"><strong>åç«¯å¤æ‚åº¦</strong></td><td align="left">éœ€è¦å®Œæ•´çš„ OAuth æœåŠ¡å’Œ GitHub API å®¢æˆ·ç«¯</td><td align="left">ä»…éœ€ä¸€ä¸ª OAuth å›è°ƒç«¯ç‚¹</td></tr><tr><td align="left"><strong>Token ç®¡ç†</strong></td><td align="left">éœ€åŠ å¯†å­˜å‚¨åœ¨æ•°æ®åº“ï¼Œæœ‰æ³„éœ²é£é™©</td><td align="left">å­˜å‚¨åœ¨æµè§ˆå™¨ï¼Œä»…ç”¨æˆ·è‡ªå·±å¯è§</td></tr><tr><td align="left"><strong>å®æ–½æˆæœ¬</strong></td><td align="left">éœ€æ•°æ®åº“è¿ç§»ã€å¤šæœåŠ¡å¼€å‘</td><td align="left">ä¸»è¦æ˜¯å‰ç«¯å·¥ä½œé‡</td></tr><tr><td align="left"><strong>ç”¨æˆ·ä½“éªŒ</strong></td><td align="left">é€»è¾‘ç»Ÿä¸€ï¼Œä½†æœåŠ¡å™¨å»¶è¿Ÿå¯èƒ½ç¨é«˜</td><td align="left">å“åº”æå¿«ï¼Œç›´æ¥ä¸ GitHub äº¤äº’</td></tr></tbody></table>
<p>è€ƒè™‘åˆ°æˆ‘ä»¬è¦çš„æ˜¯å¿«é€Ÿé›†æˆå’Œæœ€å°åŒ–åç«¯æ”¹åŠ¨ï¼Œ<strong>æœ€ç»ˆæˆ‘ä»¬é‡‡ç”¨äº†"å‰ç«¯ç›´è¿æ¨¡å¼"</strong>ã€‚è¿™å°±åƒç»™æµè§ˆå™¨å‘äº†ä¸€å¼ "ä¸´æ—¶é€šè¡Œè¯"ï¼Œæ‹¿åˆ°è¯ä¹‹åï¼Œæµè§ˆå™¨å°±å¯ä»¥è‡ªå·±å» GitHub åŠäº‹äº†ï¼Œä¸éœ€è¦æ¯æ¬¡éƒ½æ‰¾åç«¯ç®¡ç†å‘˜æ‰¹å‡†ã€‚</p>
<hr/>
<h3 data-id="heading-5">æ ¸å¿ƒè®¾è®¡ï¼šæ•°æ®æµä¸å®‰å…¨</h3>
<p>åœ¨ç¡®å®šæ¶æ„åï¼Œæˆ‘ä»¬éœ€è¦è®¾è®¡å…·ä½“çš„æ•°æ®æµã€‚æ•´ä¸ªåŒæ­¥æµç¨‹çš„æ ¸å¿ƒåœ¨äºå¦‚ä½•å®‰å…¨åœ°è·å– Token å¹¶é«˜æ•ˆåœ°åˆ©ç”¨å®ƒã€‚</p>
<h4 data-id="heading-6">æ•´ä½“æ¶æ„å›¾</h4>
<p>æ•´ä¸ªç³»ç»Ÿå¯ä»¥æŠ½è±¡ä¸ºä¸‰ä¸ªè§’è‰²ï¼šæµè§ˆå™¨ï¼ˆå‰ç«¯ï¼‰ã€HagiCode åç«¯ã€GitHubã€‚</p>
<pre><code class="hljs language-text" lang="text">+--------------+        +--------------+        +--------------+
|  å‰ç«¯ React  |        |    åç«¯      |        |    GitHub    |
|              |        |   ASP.NET    |        |    REST API  |
|  +--------+  |        |              |        |              |
|  |  OAuth |--+--------&gt; /callback    |        |              |
|  |  æµç¨‹  |  |        |              |        |              |
|  +--------+  |        |              |        |              |
|              |        |              |        |              |
|  +--------+  |        |  +--------+  |        |  +--------+  |
|  |GitHub  |  +------------&gt;Session |  +----------&gt; Issues |  |
|  |API     |  |        |  |Metadata|  |        |  |        |  |
|  |ç›´è¿    |  |        |  +--------+  |        |  +--------+  |
|  +--------+  |        |              |        |              |
+--------------+        +--------------+        +--------------+
</code></pre>
<p><strong>å…³é”®ç‚¹åœ¨äº</strong>ï¼šåªæœ‰ OAuth çš„ä¸€å°æ­¥ï¼ˆè·å– code æ¢ tokenï¼‰éœ€è¦ç»è¿‡åç«¯ï¼Œä¹‹åçš„ç²—æ´»ç´¯æ´»ï¼ˆåˆ›å»º Issueï¼‰éƒ½æ˜¯å‰ç«¯ç›´æ¥è·Ÿ GitHub æ‰“äº¤é“ã€‚</p>
<h4 data-id="heading-7">åŒæ­¥æ•°æ®æµè¯¦è§£</h4>
<p>å½“ç”¨æˆ·ç‚¹å‡» HagiCode ç•Œé¢ä¸Šçš„"Sync to GitHub"æŒ‰é’®æ—¶ï¼Œä¼šå‘ç”Ÿä¸€ç³»åˆ—å¤æ‚çš„åŠ¨ä½œï¼š</p>
<pre><code class="hljs language-text" lang="text">ç”¨æˆ·ç‚¹å‡» "Sync to GitHub"
         â”‚
         â–¼
1. å‰ç«¯æ£€æŸ¥ localStorage è·å– GitHub Token
         â”‚
         â–¼
2. æ ¼å¼åŒ– Issue å†…å®¹ï¼ˆå°† Proposal è½¬æ¢ä¸º Markdownï¼‰
         â”‚
         â–¼
3. å‰ç«¯ç›´æ¥è°ƒç”¨ GitHub API åˆ›å»º/æ›´æ–° Issue
         â”‚
         â–¼
4. è°ƒç”¨ HagiCode åç«¯ API æ›´æ–° Session.metadata (å­˜å‚¨ Issue URL ç­‰ä¿¡æ¯)
         â”‚
         â–¼
5. åç«¯é€šè¿‡ SignalR å¹¿æ’­ SessionUpdated äº‹ä»¶
         â”‚
         â–¼
6. å‰ç«¯æ¥æ”¶äº‹ä»¶ï¼Œæ›´æ–° UI æ˜¾ç¤º"å·²åŒæ­¥"çŠ¶æ€
</code></pre>
<h4 data-id="heading-8">å®‰å…¨è®¾è®¡</h4>
<p>å®‰å…¨é—®é¢˜å§‹ç»ˆæ˜¯é›†æˆç¬¬ä¸‰æ–¹æœåŠ¡çš„é‡ä¸­ä¹‹é‡ã€‚æˆ‘ä»¬åšäº†ä»¥ä¸‹è€ƒé‡ï¼š</p>
<ol>
<li><strong>é˜² CSRF æ”»å‡»</strong>ï¼šåœ¨ OAuth è·³è½¬æ—¶ï¼Œç”Ÿæˆéšæœºçš„ <code>state</code> å‚æ•°å¹¶å­˜å…¥ sessionStorageã€‚å›è°ƒæ—¶ä¸¥æ ¼éªŒè¯ stateï¼Œé˜²æ­¢è¯·æ±‚è¢«ä¼ªé€ ã€‚</li>
<li><strong>Token å­˜å‚¨éš”ç¦»</strong>ï¼šToken ä»…å­˜å‚¨åœ¨æµè§ˆå™¨çš„ <code>localStorage</code> ä¸­ï¼Œåˆ©ç”¨åŒæºç­–ç•¥ï¼ˆSame-Origin Policyï¼‰ï¼Œåªæœ‰ HagiCode çš„è„šæœ¬æ‰èƒ½è¯»å–ï¼Œé¿å…äº†æœåŠ¡å™¨ç«¯æ•°æ®åº“æ³„éœ²æ³¢åŠç”¨æˆ·ã€‚</li>
<li><strong>é”™è¯¯è¾¹ç•Œ</strong>ï¼šé’ˆå¯¹ GitHub API å¸¸è§çš„é”™è¯¯ï¼ˆå¦‚ 401 Token è¿‡æœŸã€422 éªŒè¯å¤±è´¥ã€429 é€Ÿç‡é™åˆ¶ï¼‰ï¼Œè®¾è®¡äº†ä¸“é—¨çš„é”™è¯¯å¤„ç†é€»è¾‘ï¼Œç»™ç”¨æˆ·ä»¥å‹å¥½çš„æç¤ºã€‚</li>
</ol>
<hr/>
<h3 data-id="heading-9">å®è·µï¼šä»£ç å®ç°ç»†èŠ‚</h3>
<p>çº¸ä¸Šå¾—æ¥ç»ˆè§‰æµ…ï¼Œå’±ä»¬æ¥çœ‹çœ‹å…·ä½“çš„ä»£ç æ˜¯æ€ä¹ˆå®ç°çš„ã€‚</p>
<h4 data-id="heading-10">1. åç«¯æœ€å°åŒ–æ”¹åŠ¨</h4>
<p>åç«¯åªéœ€è¦åšä¸¤ä»¶äº‹ï¼šå­˜å‚¨åŒæ­¥ä¿¡æ¯ã€å¤„ç† OAuth å›è°ƒã€‚</p>
<p><strong>æ•°æ®åº“å˜æ›´</strong>
æˆ‘ä»¬åªéœ€è¦åœ¨ <code>Sessions</code> è¡¨å¢åŠ ä¸€ä¸ª <code>Metadata</code> åˆ—ï¼Œç”¨æ¥å­˜å‚¨ JSON æ ¼å¼çš„æ‰©å±•ä¿¡æ¯ã€‚</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æ·»åŠ  metadata åˆ—åˆ° Sessions è¡¨</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> "Sessions" <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">COLUMN</span> "Metadata" text <span class="hljs-keyword">NULL</span>;
</code></pre>
<p><strong>å®ä½“ä¸ DTO å®šä¹‰</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// src/HagiCode.DomainServices.Contracts/Entities/Session.cs</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Session</span> : <span class="hljs-title">AuditedAggregateRoot</span>&lt;<span class="hljs-title">SessionId</span>&gt;
{
    <span class="hljs-comment">// ... å…¶ä»–å±æ€§ ...</span>

    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> JSON metadata for storing extension data like GitHub integration</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span>? Metadata { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}

<span class="hljs-comment">// DTO å®šä¹‰ï¼Œæ–¹ä¾¿å‰ç«¯åºåˆ—åŒ–</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">GitHubIssueMetadata</span>
{
    <span class="hljs-keyword">public</span> required <span class="hljs-built_in">string</span> Owner { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> required <span class="hljs-built_in">string</span> Repo { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> IssueNumber { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> required <span class="hljs-built_in">string</span> IssueUrl { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> DateTime SyncedAt { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> LastSyncStatus { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-string">"success"</span>;
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SessionMetadata</span>
{
    <span class="hljs-keyword">public</span> GitHubIssueMetadata? GitHubIssue { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}
</code></pre>
<h4 data-id="heading-11">2. å‰ç«¯ OAuth æµç¨‹</h4>
<p>è¿™æ˜¯è¿æ¥çš„å…¥å£ã€‚æˆ‘ä»¬ä½¿ç”¨æ ‡å‡†çš„ Authorization Code Flowã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/HagiCode.Client/src/services/githubOAuth.ts</span>

<span class="hljs-comment">// ç”Ÿæˆæˆæƒ URL å¹¶è·³è½¬</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">generateAuthUrl</span>(<span class="hljs-params"/>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; {
  <span class="hljs-keyword">const</span> state = <span class="hljs-title function_">generateRandomString</span>(); <span class="hljs-comment">// ç”Ÿæˆé˜² CSRF çš„éšæœºä¸²</span>
  sessionStorage.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'hagicode_github_state'</span>, state);
  
  <span class="hljs-keyword">const</span> params = <span class="hljs-keyword">new</span> <span class="hljs-title class_">URLSearchParams</span>({
    <span class="hljs-attr">client_id</span>: clientId,
    <span class="hljs-attr">redirect_uri</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">origin</span> + <span class="hljs-string">'/settings?tab=github&amp;oauth=callback'</span>,
    <span class="hljs-attr">scope</span>: [<span class="hljs-string">'repo'</span>, <span class="hljs-string">'public_repo'</span>].<span class="hljs-title function_">join</span>(<span class="hljs-string">' '</span>),
    <span class="hljs-attr">state</span>: state,
  });
  
  <span class="hljs-keyword">return</span> <span class="hljs-string">`https://github.com/login/oauth/authorize?<span class="hljs-subst">${params.toString()}</span>`</span>;
}

<span class="hljs-comment">// åœ¨å›è°ƒé¡µé¢å¤„ç† Code æ¢å– Token</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">exchangeCodeForToken</span>(<span class="hljs-params">code: <span class="hljs-built_in">string</span>, state: <span class="hljs-built_in">string</span></span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">GitHubToken</span>&gt; {
  <span class="hljs-comment">// 1. éªŒè¯ State é˜²æ­¢ CSRF</span>
  <span class="hljs-keyword">const</span> savedState = sessionStorage.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'hagicode_github_state'</span>);
  <span class="hljs-keyword">if</span> (state !== savedState) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Invalid state parameter'</span>);

  <span class="hljs-comment">// 2. è°ƒç”¨åç«¯ API è¿›è¡Œ Token äº¤æ¢</span>
  <span class="hljs-comment">// æ³¨æ„ï¼šè¿™é‡Œå¿…é¡»ç»è¿‡åç«¯ï¼Œå› ä¸ºéœ€è¦ ClientSecretï¼Œä¸èƒ½æš´éœ²åœ¨å‰ç«¯</span>
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/GitHubOAuth/callback'</span>, {
    <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
    <span class="hljs-attr">headers</span>: { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> },
    <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ code, state, <span class="hljs-attr">redirectUri</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">origin</span> + <span class="hljs-string">'/settings?tab=github&amp;oauth=callback'</span> }),
  });

  <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Failed to exchange token'</span>);
  
  <span class="hljs-keyword">const</span> token = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
  
  <span class="hljs-comment">// 3. å­˜å…¥ LocalStorage</span>
  <span class="hljs-title function_">saveToken</span>(token);
  <span class="hljs-keyword">return</span> token;
}
</code></pre>
<h4 data-id="heading-12">3. GitHub API å®¢æˆ·ç«¯å°è£…</h4>
<p>æœ‰äº† Token ä¹‹åï¼Œæˆ‘ä»¬å°±éœ€è¦ä¸€ä¸ªå¼ºæœ‰åŠ›çš„å·¥å…·æ¥è°ƒ GitHub APIã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/HagiCode.Client/src/services/githubApiClient.ts</span>

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">GITHUB_API_BASE</span> = <span class="hljs-string">'https://api.github.com'</span>;

<span class="hljs-comment">// æ ¸å¿ƒè¯·æ±‚å°è£…</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> githubApi&lt;T&gt;(<span class="hljs-attr">endpoint</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">options</span>: <span class="hljs-title class_">RequestInit</span> = {}): <span class="hljs-title class_">Promise</span>&lt;T&gt; {
  <span class="hljs-keyword">const</span> token = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'gh_token'</span>);
  <span class="hljs-keyword">if</span> (!token) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Not connected to GitHub'</span>);
  
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`<span class="hljs-subst">${GITHUB_API_BASE}</span><span class="hljs-subst">${endpoint}</span>`</span>, {
    ...options,
    <span class="hljs-attr">headers</span>: {
      ...options.<span class="hljs-property">headers</span>,
      <span class="hljs-title class_">Authorization</span>: <span class="hljs-string">`Bearer <span class="hljs-subst">${token}</span>`</span>,
      <span class="hljs-title class_">Accept</span>: <span class="hljs-string">'application/vnd.github.v3+json'</span>, <span class="hljs-comment">// æŒ‡å®š API ç‰ˆæœ¬</span>
    },
  });
  
  <span class="hljs-comment">// é”™è¯¯å¤„ç†é€»è¾‘</span>
  <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) {
    <span class="hljs-keyword">if</span> (response.<span class="hljs-property">status</span> === <span class="hljs-number">401</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'GitHub Token å¤±æ•ˆï¼Œè¯·é‡æ–°è¿æ¥'</span>);
    <span class="hljs-keyword">if</span> (response.<span class="hljs-property">status</span> === <span class="hljs-number">403</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'æ— æƒè®¿é—®è¯¥ä»“åº“æˆ–è¶…å‡ºé€Ÿç‡é™åˆ¶'</span>);
    <span class="hljs-keyword">if</span> (response.<span class="hljs-property">status</span> === <span class="hljs-number">422</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Issue éªŒè¯å¤±è´¥ï¼Œå¯èƒ½æ ‡é¢˜é‡å¤'</span>);
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`GitHub API Error: <span class="hljs-subst">${response.statusText}</span>`</span>);
  }
  
  <span class="hljs-keyword">return</span> response.<span class="hljs-title function_">json</span>();
}

<span class="hljs-comment">// åˆ›å»º Issue</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createIssue</span>(<span class="hljs-params">owner: <span class="hljs-built_in">string</span>, repo: <span class="hljs-built_in">string</span>, data: { title: <span class="hljs-built_in">string</span>, body: <span class="hljs-built_in">string</span>, labels: <span class="hljs-built_in">string</span>[] }</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">githubApi</span>(<span class="hljs-string">`/repos/<span class="hljs-subst">${owner}</span>/<span class="hljs-subst">${repo}</span>/issues`</span>, {
    <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
    <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data),
  });
}
</code></pre>
<h4 data-id="heading-13">4. å†…å®¹æ ¼å¼åŒ–ä¸åŒæ­¥</h4>
<p>æœ€åä¸€æ­¥ï¼Œå°±æ˜¯æŠŠ HagiCode çš„ Session æ•°æ®è½¬æ¢æˆ GitHub Issue çš„æ ¼å¼ã€‚è¿™æœ‰ç‚¹åƒ"ç¿»è¯‘"å·¥ä½œã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å°† Session å¯¹è±¡è½¬æ¢ä¸º Markdown å­—ç¬¦ä¸²</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">formatIssueForSession</span>(<span class="hljs-params">session: Session</span>): <span class="hljs-built_in">string</span> {
  <span class="hljs-keyword">let</span> content = <span class="hljs-string">`# <span class="hljs-subst">${session.title}</span>\n\n`</span>;
  content += <span class="hljs-string">`**&gt; HagiCode Session:** #<span class="hljs-subst">${session.code}</span>\n`</span>;
  content += <span class="hljs-string">`**&gt; Status:** <span class="hljs-subst">${session.status}</span>\n\n`</span>;
  content += <span class="hljs-string">`## Description\n\n<span class="hljs-subst">${session.description || <span class="hljs-string">'No description provided.'</span>}</span>\n\n`</span>;
  
  <span class="hljs-comment">// å¦‚æœæ˜¯ Proposal ç±»å‹ï¼Œæ·»åŠ é¢å¤–å­—æ®µ</span>
  <span class="hljs-keyword">if</span> (session.<span class="hljs-property">type</span> === <span class="hljs-string">'proposal'</span>) {
    content += <span class="hljs-string">`## Chief Complaint\n\n<span class="hljs-subst">${session.chiefComplaint || <span class="hljs-string">''</span>}</span>\n\n`</span>;
    <span class="hljs-comment">// æ·»åŠ ä¸€ä¸ªæ·±é“¾æ¥ï¼Œæ–¹ä¾¿ä» GitHub è·³å› HagiCode</span>
    content += <span class="hljs-string">`---\n\n**[View in HagiCode](hagicode://sessions/<span class="hljs-subst">${session.id}</span>)**\n`</span>;
  }
  
  <span class="hljs-keyword">return</span> content;
}

<span class="hljs-comment">// ç‚¹å‡»åŒæ­¥æŒ‰é’®çš„ä¸»é€»è¾‘</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSync</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">session: Session</span>) =&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> repoInfo = <span class="hljs-title function_">parseRepositoryFromUrl</span>(session.<span class="hljs-property">repoUrl</span>); <span class="hljs-comment">// è§£æä»“åº“ URL</span>
    <span class="hljs-keyword">if</span> (!repoInfo) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Invalid repository URL'</span>);

    toast.<span class="hljs-title function_">loading</span>(<span class="hljs-string">'æ­£åœ¨åŒæ­¥åˆ° GitHub...'</span>);
    
    <span class="hljs-comment">// 1. æ ¼å¼åŒ–å†…å®¹</span>
    <span class="hljs-keyword">const</span> issueBody = <span class="hljs-title function_">formatIssueForSession</span>(session);
    
    <span class="hljs-comment">// 2. è°ƒç”¨ API</span>
    <span class="hljs-keyword">const</span> issue = <span class="hljs-keyword">await</span> githubApiClient.<span class="hljs-title function_">createIssue</span>(repoInfo.<span class="hljs-property">owner</span>, repoInfo.<span class="hljs-property">repo</span>, {
      <span class="hljs-attr">title</span>: <span class="hljs-string">`[HagiCode] <span class="hljs-subst">${session.title}</span>`</span>,
      <span class="hljs-attr">body</span>: issueBody,
      <span class="hljs-attr">labels</span>: [<span class="hljs-string">'hagicode'</span>, <span class="hljs-string">'proposal'</span>, <span class="hljs-string">`status:<span class="hljs-subst">${session.status}</span>`</span>],
    });
    
    <span class="hljs-comment">// 3. æ›´æ–° Session Metadata (ä¿å­˜ Issue é“¾æ¥)</span>
    <span class="hljs-keyword">await</span> <span class="hljs-title class_">SessionsService</span>.<span class="hljs-title function_">patchApiSessionsSessionId</span>(session.<span class="hljs-property">id</span>, {
      <span class="hljs-attr">metadata</span>: {
        <span class="hljs-attr">githubIssue</span>: {
          <span class="hljs-attr">owner</span>: repoInfo.<span class="hljs-property">owner</span>,
          <span class="hljs-attr">repo</span>: repoInfo.<span class="hljs-property">repo</span>,
          <span class="hljs-attr">issueNumber</span>: issue.<span class="hljs-property">number</span>,
          <span class="hljs-attr">issueUrl</span>: issue.<span class="hljs-property">html_url</span>,
          <span class="hljs-attr">syncedAt</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>(),
        }
      }
    });

    toast.<span class="hljs-title function_">success</span>(<span class="hljs-string">'åŒæ­¥æˆåŠŸï¼'</span>);
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err);
    toast.<span class="hljs-title function_">error</span>(<span class="hljs-string">'åŒæ­¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ Token æˆ–ç½‘ç»œ'</span>);
  }
};
</code></pre>
<hr/>
<h3 data-id="heading-14">æ€»ç»“ä¸å±•æœ›</h3>
<p>é€šè¿‡è¿™å¥—"å‰ç«¯ç›´è¿"æ–¹æ¡ˆï¼Œæˆ‘ä»¬ç”¨æœ€å°‘çš„åç«¯ä»£ç å®ç°äº† GitHub Issues çš„æ— ç¼é›†æˆã€‚</p>
<h4 data-id="heading-15">æ”¶è·</h4>
<ol>
<li><strong>å¼€å‘æ•ˆç‡é«˜</strong>ï¼šåç«¯æ”¹åŠ¨æå°ï¼Œä¸»è¦æ˜¯æ•°æ®åº“åŠ ä¸€ä¸ªå­—æ®µå’Œä¸€ä¸ªç®€å•çš„ OAuth å›è°ƒæ¥å£ï¼Œå¤§éƒ¨åˆ†é€»è¾‘éƒ½åœ¨å‰ç«¯å®Œæˆã€‚</li>
<li><strong>å®‰å…¨æ€§å¥½</strong>ï¼šToken ä¸ç»è¿‡æœåŠ¡å™¨æ•°æ®åº“ï¼Œé™ä½äº†æ³„éœ²é£é™©ã€‚</li>
<li><strong>ç”¨æˆ·ä½“éªŒä½³</strong>ï¼šç›´æ¥ä»å‰ç«¯å‘èµ·è¯·æ±‚ï¼Œå“åº”é€Ÿåº¦å¿«ï¼Œä¸éœ€è¦ç»è¿‡åç«¯ä¸­è½¬ã€‚</li>
</ol>
<h4 data-id="heading-16">æ³¨æ„äº‹é¡¹</h4>
<p>åœ¨å®é™…éƒ¨ç½²æ—¶ï¼Œæœ‰å‡ ä¸ªå‘å¤§å®¶è¦æ³¨æ„ï¼š</p>
<ul>
<li><strong>OAuth App è®¾ç½®</strong>ï¼šè®°å¾—åœ¨ GitHub OAuth App è®¾ç½®é‡Œå¡«æ­£ç¡®çš„ <code>Authorization callback URL</code>ï¼ˆé€šå¸¸æ˜¯ <code>http://localhost:3000/settings?tab=github&amp;oauth=callback</code>ï¼‰ã€‚</li>
<li><strong>é€Ÿç‡é™åˆ¶</strong>ï¼šGitHub API å¯¹æœªè®¤è¯è¯·æ±‚é™åˆ¶è¾ƒä¸¥ï¼Œä½†ç”¨ Token åé€šå¸¸è¶³å¤Ÿï¼ˆ5000æ¬¡/å°æ—¶ï¼‰ã€‚</li>
<li><strong>URL è§£æ</strong>ï¼šç”¨æˆ·è¾“å…¥çš„ Repo URL åƒå¥‡ç™¾æ€ªï¼Œè®°å¾—æ­£åˆ™è¦åŒ¹é… <code>.git</code> åç¼€ã€SSH æ ¼å¼ç­‰æƒ…å†µã€‚</li>
</ul>
<h4 data-id="heading-17">åç»­å¢å¼º</h4>
<p>ç›®å‰çš„åŠŸèƒ½è¿˜æ˜¯å•å‘åŒæ­¥ï¼ˆHagiCode -&gt; GitHubï¼‰ã€‚æœªæ¥æˆ‘ä»¬è®¡åˆ’é€šè¿‡ GitHub Webhooks å®ç°åŒå‘åŒæ­¥ï¼Œæ¯”å¦‚åœ¨ GitHub é‡Œå…³é—­ Issueï¼ŒHagiCode è¿™è¾¹çš„ä¼šè¯çŠ¶æ€ä¹Ÿèƒ½è‡ªåŠ¨æ›´æ–°ã€‚è¿™éœ€è¦æˆ‘ä»¬åœ¨åç«¯æš´éœ²ä¸€ä¸ª Webhook æ¥æ”¶ç«¯ç‚¹ï¼Œè¿™ä¹Ÿæ˜¯ä¸‹ä¸€æ­¥è¦åšçš„æœ‰è¶£å·¥ä½œã€‚</p>
<p>å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½ç»™ä½ çš„ç¬¬ä¸‰æ–¹é›†æˆå¼€å‘å¸¦æ¥ä¸€ç‚¹çµæ„Ÿï¼å¦‚æœæœ‰é—®é¢˜ï¼Œæ¬¢è¿åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FHagiCode-org%2Fsite" target="_blank" title="https://github.com/HagiCode-org/site" ref="nofollow noopener noreferrer">HagiCode GitHub</a> ä¸Šæ Issue è®¨è®ºã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Post Listã€mockjsä¸axioså®æˆ˜å­¦ä¹ ç¬”è®°]]></title>    <link>https://juejin.cn/post/7598472744480653331</link>    <guid>https://juejin.cn/post/7598472744480653331</guid>    <pubDate>2026-01-24T07:57:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598472744480653331" data-draft-id="7598472744480636947" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Post Listã€mockjsä¸axioså®æˆ˜å­¦ä¹ ç¬”è®°"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,axios"/> <meta itemprop="datePublished" content="2026-01-24T07:57:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="UIUV"/> <meta itemprop="url" content="https://juejin.cn/user/1036168457093483"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Post Listã€mockjsä¸axioså®æˆ˜å­¦ä¹ ç¬”è®°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1036168457093483/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    UIUV
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T07:57:31.000Z" title="Sat Jan 24 2026 07:57:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»15åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Post Listã€mockjsä¸axioså®æˆ˜å­¦ä¹ ç¬”è®°</h2>
<p>åœ¨ç°ä»£å‰ç«¯å¼€å‘ä¸­ï¼Œæ•°æ®è¯·æ±‚ã€æ¨¡æ‹Ÿæ•°æ®ä¸çŠ¶æ€ç®¡ç†æ˜¯æ ¸å¿ƒç¯èŠ‚ã€‚æœ¬æ–‡åŸºäºReact+ViteæŠ€æœ¯æ ˆï¼Œç»“åˆå®æˆ˜ä»£ç ï¼Œç³»ç»Ÿæ¢³ç†Post Listæ•°æ®æ¸²æŸ“ã€axiosè¯·æ±‚å°è£…ã€mockjsæ¨¡æ‹Ÿæ¥å£ä¸‰å¤§æ¨¡å—çš„ç›¸å…³çŸ¥è¯†ï¼Œå‰–æå…¶æŠ€æœ¯åŸç†ã€å®ç°é€»è¾‘ä¸å¼€å‘è§„èŒƒï¼Œä¸ºå‰ç«¯é¡¹ç›®çš„æ•°æ®å±‚æ­å»ºæä¾›å‚è€ƒã€‚</p>
<h2 data-id="heading-1">ä¸€ã€æ•´ä½“æŠ€æœ¯èƒŒæ™¯ä¸æ ¸å¿ƒæµç¨‹</h2>
<p>æœ¬æ–‡å®æˆ˜åœºæ™¯ä¸ºç§»åŠ¨ç«¯Reacté¡¹ç›®çš„é¦–é¡µå¸–å­åˆ—è¡¨ï¼ˆPost Listï¼‰åŠŸèƒ½ï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯å®ç°â€œå‰ç«¯è¯·æ±‚-æ¨¡æ‹Ÿæ•°æ®-çŠ¶æ€ç®¡ç†-é¡µé¢æ¸²æŸ“â€çš„å®Œæ•´é—­ç¯ã€‚åœ¨å‰åç«¯åˆ†ç¦»æ¶æ„ä¸‹ï¼Œåç«¯æ¥å£å¼€å‘å¾€å¾€æ»åäºå‰ç«¯é¡µé¢å¼€å‘ï¼Œæ­¤æ—¶éœ€é€šè¿‡mockjsæ¨¡æ‹Ÿæ¥å£è¿”å›æ•°æ®ï¼ŒåŒæ—¶å€ŸåŠ©axioså°è£…ç»Ÿä¸€çš„è¯·æ±‚é€»è¾‘ï¼Œå†é€šè¿‡Zustandç®¡ç†å…¨å±€çŠ¶æ€ï¼Œæœ€ç»ˆå°†æ•°æ®æ¸²æŸ“è‡³é¡µé¢ã€‚</p>
<p>æ ¸å¿ƒæŠ€æœ¯æ ˆï¼šReact 18+Vite 5+TypeScript+axios+mockjs+Zustand+TailwindCSSï¼Œå„æŠ€æœ¯åˆ†å·¥å¦‚ä¸‹ï¼š</p>
<ul>
<li><strong>axios</strong>ï¼šè´Ÿè´£å‘èµ·HTTPè¯·æ±‚ï¼Œå¤„ç†è¯·æ±‚æ‹¦æˆªã€å“åº”æ‹¦æˆªã€é”™è¯¯æ•è·ç­‰é€»è¾‘ï¼›</li>
<li><strong>mockjs</strong>ï¼šåœ¨å¼€å‘ç¯å¢ƒæ¨¡æ‹Ÿåç«¯æ¥å£ï¼Œç”Ÿæˆéšæœºæµ‹è¯•æ•°æ®ï¼Œå®ç°å‰ç«¯ç‹¬ç«‹å¼€å‘ï¼›</li>
<li><strong>Zustand</strong>ï¼šè½»é‡çº§å…¨å±€çŠ¶æ€ç®¡ç†åº“ï¼Œå­˜å‚¨å¸–å­åˆ—è¡¨æ•°æ®ä¸åŠ è½½æ–¹æ³•ï¼Œå®ç°ç»„ä»¶é—´æ•°æ®å…±äº«ï¼›</li>
<li><strong>Vite</strong>ï¼šé€šè¿‡æ’ä»¶é›†æˆmockæœåŠ¡ï¼Œé…ç½®è·¯å¾„åˆ«åï¼Œä¼˜åŒ–å¼€å‘ä½“éªŒï¼›</li>
<li><strong>TypeScript</strong>ï¼šå®šä¹‰æ¥å£ç±»å‹ï¼ˆPostã€Userï¼‰ï¼Œå®ç°ç±»å‹å®‰å…¨ï¼Œé¿å…æ•°æ®å¼‚å¸¸ã€‚</li>
</ul>
<p>å®Œæ•´æ•°æ®æµè½¬æµç¨‹ï¼šé¡µé¢åŠ è½½æ—¶è§¦å‘useEffectè°ƒç”¨loadMoreæ–¹æ³• â†’ Zustandè°ƒç”¨å°è£…å¥½çš„fetchPostsæ¥å£ â†’ axioså‘èµ·GETè¯·æ±‚ â†’ mockjsæ‹¦æˆªè¯·æ±‚å¹¶è¿”å›æ¨¡æ‹Ÿæ•°æ® â†’ axiosæ¥æ”¶å“åº”å¹¶å¤„ç† â†’ Zustandæ›´æ–°postsçŠ¶æ€ â†’ é¡µé¢ä»çŠ¶æ€ä¸­è¯»å–æ•°æ®å¹¶æ¸²æŸ“ã€‚</p>
<h2 data-id="heading-2">äºŒã€axiosï¼šHTTPè¯·æ±‚å°è£…ä¸å®æˆ˜</h2>
<h3 data-id="heading-3">2.1 axiosæ ¸å¿ƒç‰¹æ€§</h3>
<p>axiosæ˜¯ä¸€æ¬¾åŸºäºPromiseçš„HTTPå®¢æˆ·ç«¯ï¼Œæ”¯æŒæµè§ˆå™¨ç«¯ä¸Node.jsç¯å¢ƒï¼Œå…·å¤‡ä»¥ä¸‹æ ¸å¿ƒä¼˜åŠ¿ï¼š</p>
<ul>
<li>æ”¯æŒè¯·æ±‚/å“åº”æ‹¦æˆªå™¨ï¼Œå¯ç»Ÿä¸€å¤„ç†è¯·æ±‚å¤´ã€tokenéªŒè¯ã€é”™è¯¯æç¤ºç­‰ï¼›</li>
<li>è‡ªåŠ¨è½¬æ¢JSONæ•°æ®ï¼Œæ— éœ€æ‰‹åŠ¨è§£æå“åº”ä½“ï¼›</li>
<li>æ”¯æŒå–æ¶ˆè¯·æ±‚ã€è¶…æ—¶è®¾ç½®ã€è¯·æ±‚é‡è¯•ç­‰é«˜çº§åŠŸèƒ½ï¼›</li>
<li>å…¼å®¹æ€§è‰¯å¥½ï¼Œå¯é€‚é…ä¸åŒæµè§ˆå™¨ä¸Node.jsç‰ˆæœ¬ï¼›</li>
<li>æ”¯æŒTypeScriptç±»å‹æ¨å¯¼ï¼Œä¸TSé¡¹ç›®æ— ç¼é›†æˆã€‚</li>
</ul>
<h3 data-id="heading-4">2.2 åŸºç¡€é…ç½®ä¸å°è£…è§„èŒƒ</h3>
<p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œéœ€å¯¹axiosè¿›è¡Œç»Ÿä¸€å°è£…ï¼Œé¿å…é‡å¤ä»£ç ï¼Œä¾¿äºç»´æŠ¤ã€‚æ ¸å¿ƒå°è£…è¦ç‚¹åŒ…æ‹¬ï¼šåŸºç¡€è·¯å¾„è®¾ç½®ã€è¯·æ±‚å¤´é…ç½®ã€é”™è¯¯ç»Ÿä¸€å¤„ç†ã€ç±»å‹å®šä¹‰ç­‰ã€‚</p>
<h4 data-id="heading-5">2.2.1 åŸºç¡€é…ç½®å®ç°</h4>
<p>ä»£ç ä¸­å¯¹axiosçš„åŸºç¡€é…ç½®å¦‚ä¸‹ï¼Œä½äº<code>src/api/config.ts</code>ï¼ˆæˆ–å¯¹åº”æ–‡ä»¶ï¼‰ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>;
<span class="hljs-comment">// æ¥å£åœ°å€éƒ½ä»¥/apiå¼€å§‹</span>
axios.<span class="hljs-property">defaults</span>.<span class="hljs-property">baseURL</span> = <span class="hljs-string">'http://localhost:5173/api'</span>
<span class="hljs-comment">// ç”Ÿäº§ç¯å¢ƒå¯åˆ‡æ¢ä¸ºçœŸå®åç«¯åœ°å€</span>
<span class="hljs-comment">// axios.defaults.baseURL = 'http://douyin.com:5173/api'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> axios;
</code></pre>
<p>å…³é”®é…ç½®è¯´æ˜ï¼š</p>
<ul>
<li><code>baseURL</code>ï¼šè®¾ç½®è¯·æ±‚åŸºç¡€è·¯å¾„ï¼Œåç»­è¯·æ±‚URLå¯çœç•¥åŸºç¡€éƒ¨åˆ†ï¼Œç®€åŒ–ä»£ç ã€‚å¼€å‘ç¯å¢ƒæŒ‡å‘æœ¬åœ°ViteæœåŠ¡ï¼ˆé…åˆmockjsï¼‰ï¼Œç”Ÿäº§ç¯å¢ƒåˆ‡æ¢ä¸ºåç«¯çœŸå®æ¥å£åœ°å€ï¼›</li>
<li>å¯æ‰©å±•é…ç½®ï¼šå¦‚è®¾ç½®è¶…æ—¶æ—¶é—´ï¼ˆ<code>timeout: 5000</code>ï¼‰ã€é»˜è®¤è¯·æ±‚å¤´ï¼ˆ<code>headers: {'Content-Type': 'application/json'}</code>ï¼‰ç­‰ã€‚</li>
</ul>
<h4 data-id="heading-6">2.2.2 æ¥å£å‡½æ•°å°è£…</h4>
<p>é’ˆå¯¹å…·ä½“ä¸šåŠ¡æ¥å£ï¼Œå°è£…ç‹¬ç«‹çš„è¯·æ±‚å‡½æ•°ï¼Œä¾¿äºå¤ç”¨ä¸ç»´æŠ¤ã€‚ä»¥å¸–å­åˆ—è¡¨è¯·æ±‚ä¸ºä¾‹ï¼Œä»£ç ä½äº<code>src/api/posts.ts</code>ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'./config'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">Post</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/types'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchPosts</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">
    page: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>,
    limit: <span class="hljs-built_in">number</span> = <span class="hljs-number">10</span>,
</span>) =&gt; {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/posts'</span>, {
            <span class="hljs-attr">params</span>: {
                page,
                limit,
            }
        });
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'è·å–å¸–å­åˆ—è¡¨æˆåŠŸ'</span>, response);
        <span class="hljs-keyword">return</span> response.<span class="hljs-property">data</span>;
    } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'è·å–å¸–å­åˆ—è¡¨å¤±è´¥'</span>, error);
        <span class="hljs-keyword">throw</span> error;
    }
};
</code></pre>
<p>å°è£…è¦ç‚¹ä¸æœ€ä½³å®è·µï¼š</p>
<ul>
<li><strong>TypeScriptç±»å‹çº¦æŸ</strong>ï¼šå¯¼å…¥Postç±»å‹ï¼Œæ˜ç¡®è¿”å›æ•°æ®ç»“æ„ï¼Œå®ç°ç±»å‹å®‰å…¨ã€‚å‚æ•°pageã€limitè®¾ç½®é»˜è®¤å€¼ï¼Œé¿å…è°ƒç”¨æ—¶ä¼ å‚é—æ¼ï¼›</li>
<li><strong>å¼‚æ­¥å¤„ç†</strong>ï¼šä½¿ç”¨async/awaitè¯­æ³•ï¼Œæ›¿ä»£Promise.then()ï¼Œä»£ç æ›´ç®€æ´æ˜“è¯»ï¼›</li>
<li><strong>é”™è¯¯æ•è·</strong>ï¼šé€šè¿‡try/catchæ•è·è¯·æ±‚å¼‚å¸¸ï¼Œæ‰“å°é”™è¯¯æ—¥å¿—ä¾¿äºæ’æŸ¥é—®é¢˜ï¼ŒåŒæ—¶é€šè¿‡throw errorå‘ä¸Šå±‚æŠ›å‡ºå¼‚å¸¸ï¼Œç”±è°ƒç”¨æ–¹å†³å®šåç»­å¤„ç†ï¼ˆå¦‚æç¤ºç”¨æˆ·ï¼‰ï¼›</li>
<li><strong>å‚æ•°ä¼ é€’</strong>ï¼šGETè¯·æ±‚é€šè¿‡paramså±æ€§ä¼ é€’æŸ¥è¯¢å‚æ•°ï¼ˆpageã€limitï¼‰ï¼Œaxiosä¼šè‡ªåŠ¨å°†å…¶æ‹¼æ¥ä¸ºURLæŸ¥è¯¢å­—ç¬¦ä¸²ï¼ˆå¦‚<code>/api/posts?page=1&amp;limit=10</code>ï¼‰ï¼›POSTè¯·æ±‚å¯é€šè¿‡dataå±æ€§ä¼ é€’è¯·æ±‚ä½“ã€‚</li>
</ul>
<h4 data-id="heading-7">2.3 è¿›é˜¶æ‰©å±•ï¼šè¯·æ±‚/å“åº”æ‹¦æˆªå™¨</h4>
<p>å®é™…é¡¹ç›®ä¸­ï¼Œéœ€é€šè¿‡æ‹¦æˆªå™¨å®ç°å…¨å±€ç»Ÿä¸€é€»è¾‘ï¼Œä¾‹å¦‚è¯·æ±‚æ—¶æ·»åŠ tokenã€å“åº”æ—¶ç»Ÿä¸€å¤„ç†é”™è¯¯çŠ¶æ€ç ç­‰ã€‚ä»¥ä¸‹ä¸ºå¸¸è§æ‹¦æˆªå™¨é…ç½®ç¤ºä¾‹ï¼Œå¯é›†æˆåˆ°axiosåŸºç¡€é…ç½®ä¸­ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// è¯·æ±‚æ‹¦æˆªå™¨</span>
axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(
    <span class="hljs-function">(<span class="hljs-params">config</span>) =&gt;</span> {
        <span class="hljs-comment">// ç»™æ¯ä¸ªè¯·æ±‚æ·»åŠ token</span>
        <span class="hljs-keyword">const</span> token = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'token'</span>);
        <span class="hljs-keyword">if</span> (token) {
            config.<span class="hljs-property">headers</span>.<span class="hljs-property">Authorization</span> = <span class="hljs-string">`Bearer <span class="hljs-subst">${token}</span>`</span>;
        }
        <span class="hljs-keyword">return</span> config;
    },
    <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
        <span class="hljs-comment">// è¯·æ±‚å‘èµ·å‰çš„é”™è¯¯å¤„ç†ï¼ˆå¦‚å‚æ•°éªŒè¯å¤±è´¥ï¼‰</span>
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error);
    }
);

<span class="hljs-comment">// å“åº”æ‹¦æˆªå™¨</span>
axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(
    <span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> {
        <span class="hljs-comment">// ç»Ÿä¸€å¤„ç†å“åº”æ•°æ®ï¼Œåªè¿”å›dataéƒ¨åˆ†</span>
        <span class="hljs-keyword">return</span> response.<span class="hljs-property">data</span>;
    },
    <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
        <span class="hljs-comment">// ç»Ÿä¸€å¤„ç†é”™è¯¯çŠ¶æ€ç </span>
        <span class="hljs-keyword">const</span> status = error.<span class="hljs-property">response</span>?.<span class="hljs-property">status</span>;
        <span class="hljs-keyword">switch</span> (status) {
            <span class="hljs-keyword">case</span> <span class="hljs-number">401</span>:
                <span class="hljs-comment">// æœªæˆæƒï¼Œè·³è½¬ç™»å½•é¡µ</span>
                <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span> = <span class="hljs-string">'/login'</span>;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">404</span>:
                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'æ¥å£ä¸å­˜åœ¨'</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">500</span>:
                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯'</span>);
                <span class="hljs-keyword">break</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error);
    }
);
</code></pre>
<p>æ‹¦æˆªå™¨çš„æ ¸å¿ƒä»·å€¼åœ¨äºâ€œé›†ä¸­å¤„ç†â€ï¼Œå‡å°‘é‡å¤ä»£ç ï¼Œæå‡é¡¹ç›®å¯ç»´æŠ¤æ€§ã€‚</p>
<h2 data-id="heading-8">ä¸‰ã€mockjsï¼šå‰ç«¯æ¨¡æ‹Ÿæ¥å£ä¸æµ‹è¯•æ•°æ®ç”Ÿæˆ</h2>
<h3 data-id="heading-9">3.1 mockjsçš„æ ¸å¿ƒä½œç”¨</h3>
<p>åœ¨å‰åç«¯åˆ†ç¦»å¼€å‘æ¨¡å¼ä¸­ï¼Œå‰ç«¯å¼€å‘å¸¸ä¾èµ–åç«¯æ¥å£ï¼Œä½†åç«¯æ¥å£å¼€å‘ã€è”è°ƒå¾€å¾€éœ€è¦ä¸€å®šæ—¶é—´ã€‚æ­¤æ—¶mockjså¯å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š</p>
<ul>
<li>æ¨¡æ‹Ÿåç«¯æ¥å£ï¼Œæ‹¦æˆªå‰ç«¯è¯·æ±‚ï¼Œè¿”å›è‡ªå®šä¹‰æ¨¡æ‹Ÿæ•°æ®ï¼Œä½¿å‰ç«¯æ— éœ€ç­‰å¾…åç«¯æ¥å£å®Œæˆå³å¯ç‹¬ç«‹å¼€å‘ï¼›</li>
<li>ç”Ÿæˆå¤§é‡éšæœºæµ‹è¯•æ•°æ®ï¼Œè¦†ç›–ä¸åŒåœºæ™¯ï¼ˆå¦‚åˆ†é¡µã€å¼‚å¸¸çŠ¶æ€ï¼‰ï¼Œä¾¿äºæµ‹è¯•é¡µé¢æ¸²æŸ“æ•ˆæœï¼›</li>
<li>ä¸çœŸå®æ¥å£æ ¼å¼ä¸€è‡´ï¼Œå¼€å‘å®Œæˆååªéœ€åˆ‡æ¢baseURLå³å¯æ— ç¼å¯¹æ¥åç«¯ï¼Œæ— éœ€ä¿®æ”¹ä¸šåŠ¡ä»£ç ã€‚</li>
</ul>
<h3 data-id="heading-10">3.2 Viteé›†æˆmockæœåŠ¡</h3>
<p>Viteé€šè¿‡<code>vite-plugin-mock</code>æ’ä»¶é›†æˆmockæœåŠ¡ï¼Œå®ç°å¼€å‘ç¯å¢ƒä¸‹çš„æ¥å£æ¨¡æ‹Ÿã€‚é…ç½®æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<h4 data-id="heading-11">3.2.1 å®‰è£…ä¾èµ–</h4>
<pre><code class="hljs language-css" lang="css">npm install mockjs vite-plugin-mock <span class="hljs-attr">--save-dev</span>
</code></pre>
<h4 data-id="heading-12">3.2.2 Viteé…ç½®æ–‡ä»¶ä¿®æ”¹</h4>
<p>åœ¨<code>vite.config.ts</code>ä¸­é…ç½®mockæœåŠ¡ï¼ŒæŒ‡å®šmockæ–‡ä»¶è·¯å¾„ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> react <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-react'</span>
<span class="hljs-keyword">import</span> tailwindcss <span class="hljs-keyword">from</span> <span class="hljs-string">'@tailwindcss/vite'</span>
<span class="hljs-keyword">import</span> path <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span>
<span class="hljs-keyword">import</span> { viteMockServe } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite-plugin-mock'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-title function_">react</span>(), 
    <span class="hljs-title function_">tailwindcss</span>(), 
    <span class="hljs-title function_">viteMockServe</span>({
      <span class="hljs-attr">mockPath</span>: <span class="hljs-string">'mock'</span>, <span class="hljs-comment">// æŒ‡å®šmockæ–‡ä»¶å­˜æ”¾ç›®å½•</span>
      <span class="hljs-attr">localEnabled</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// å¼€å‘ç¯å¢ƒå¯ç”¨mock</span>
      <span class="hljs-attr">prodEnabled</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// ç”Ÿäº§ç¯å¢ƒç¦ç”¨mock</span>
    })
  ],
  <span class="hljs-attr">resolve</span>: {
    <span class="hljs-attr">alias</span>: {
      <span class="hljs-string">'@'</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'src'</span>), <span class="hljs-comment">// è·¯å¾„åˆ«åï¼Œç®€åŒ–å¯¼å…¥</span>
    }
  }
});
</code></pre>
<p>å…³é”®é…ç½®è¯´æ˜ï¼š</p>
<ul>
<li><code>mockPath</code>ï¼šæŒ‡å®šmocké…ç½®æ–‡ä»¶çš„å­˜æ”¾ç›®å½•ï¼ˆæœ¬æ–‡ä¸ºé¡¹ç›®æ ¹ç›®å½•ä¸‹çš„mockæ–‡ä»¶å¤¹ï¼‰ï¼›</li>
<li><code>localEnabled</code>ï¼šæ§åˆ¶å¼€å‘ç¯å¢ƒæ˜¯å¦å¯ç”¨mockæœåŠ¡ï¼Œè®¾ä¸ºtrueå³å¯åœ¨å¼€å‘æ—¶ä½¿ç”¨æ¨¡æ‹Ÿæ¥å£ï¼›</li>
<li><code>prodEnabled</code>ï¼šç”Ÿäº§ç¯å¢ƒéœ€ç¦ç”¨mockï¼Œé¿å…æ¨¡æ‹Ÿæ•°æ®å¹²æ‰°çœŸå®æ¥å£ã€‚</li>
</ul>
<h3 data-id="heading-13">3.3 mockjsè¯­æ³•ä¸æ¥å£æ¨¡æ‹Ÿå®ç°</h3>
<h4 data-id="heading-14">3.3.1 mockæ–‡ä»¶ç»“æ„è§„èŒƒ</h4>
<p>åœ¨mockç›®å½•ä¸‹åˆ›å»º<code>posts.js</code>æ–‡ä»¶ï¼Œç”¨äºå®šä¹‰å¸–å­åˆ—è¡¨æ¥å£çš„æ¨¡æ‹Ÿè§„åˆ™ã€‚mockjsçš„æ ¸å¿ƒè¯­æ³•åŒ…æ‹¬â€œæ•°æ®æ¨¡æ¿å®šä¹‰â€ä¸â€œæ¥å£é…ç½®â€ä¸¤éƒ¨åˆ†ã€‚</p>
<h4 data-id="heading-15">3.3.2 æ•°æ®æ¨¡æ¿å®šä¹‰ï¼šç”Ÿæˆéšæœºæµ‹è¯•æ•°æ®</h4>
<p>mockjsé€šè¿‡ç‰¹å®šè¯­æ³•ç”Ÿæˆéšæœºæ•°æ®ï¼Œæ”¯æŒä¸­æ–‡ã€æ•°å­—ã€æ—¥æœŸã€å›¾ç‰‡ç­‰å¤šç§ç±»å‹ï¼Œæ ¸å¿ƒè¯­æ³•å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>'å±æ€§å|è§„åˆ™': å€¼</code>ï¼šå®šä¹‰æ•°æ®ç”Ÿæˆè§„åˆ™ï¼Œå¦‚<code>'list|45': []</code>è¡¨ç¤ºç”Ÿæˆé•¿åº¦ä¸º45çš„listæ•°ç»„ï¼›</li>
<li>å ä½ç¬¦<code>@xxx</code>ï¼šç”Ÿæˆéšæœºæ•°æ®ï¼Œå¦‚<code>@ctitle(8,20)</code>ç”Ÿæˆ8-20å­—çš„ä¸­æ–‡æ ‡é¢˜ï¼Œ<code>@integer(1,30)</code>ç”Ÿæˆ1-30çš„éšæœºæ•´æ•°ï¼›</li>
<li>è‡ªå®šä¹‰å‡½æ•°ï¼šå¯é€šè¿‡å‡½æ•°è¿”å›åŠ¨æ€æ•°æ®ï¼Œå¦‚tagså­—æ®µé€šè¿‡<code>() =&gt; Mock.Random.pick(tags,2)</code>ä»æ ‡ç­¾æ•°ç»„ä¸­éšæœºé€‰å–2ä¸ªã€‚</li>
</ul>
<p>å¸–å­åˆ—è¡¨æ¨¡æ‹Ÿæ•°æ®ç”Ÿæˆä»£ç ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Mock</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'mockjs'</span>
<span class="hljs-keyword">const</span> tags = [<span class="hljs-string">'å‰ç«¯'</span>,<span class="hljs-string">'åç«¯'</span>,<span class="hljs-string">'èŒåœº'</span>,<span class="hljs-string">'AI'</span>,<span class="hljs-string">'å‰¯ä¸š'</span>,<span class="hljs-string">'é¢ç»'</span>,<span class="hljs-string">'ç®—æ³•'</span>];
<span class="hljs-keyword">const</span> posts = <span class="hljs-title class_">Mock</span>.<span class="hljs-title function_">mock</span>({
    <span class="hljs-string">'list|45'</span>:[ <span class="hljs-comment">// ç”Ÿæˆ45æ¡å¸–å­æ•°æ®</span>
        {
            <span class="hljs-attr">title</span>: <span class="hljs-string">'@ctitle(8,20)'</span>, <span class="hljs-comment">// ä¸­æ–‡æ ‡é¢˜ï¼ˆ8-20å­—ï¼‰</span>
            <span class="hljs-attr">brief</span>: <span class="hljs-string">'@ctitle(20,100)'</span>, <span class="hljs-comment">// ä¸­æ–‡æ‘˜è¦ï¼ˆ20-100å­—ï¼‰</span>
            <span class="hljs-attr">totalComments</span>: <span class="hljs-string">'@integer(1,30)'</span>, <span class="hljs-comment">// è¯„è®ºæ•°ï¼ˆ1-30ï¼‰</span>
            <span class="hljs-attr">totalLikes</span>: <span class="hljs-string">'@integer(0,500)'</span>, <span class="hljs-comment">// ç‚¹èµæ•°ï¼ˆ0-500ï¼‰</span>
            <span class="hljs-attr">publishedAt</span>: <span class="hljs-string">'@datetime("yyyy-MM-dd HH:mm:ss")'</span>, <span class="hljs-comment">// å‘å¸ƒæ—¶é—´</span>
            <span class="hljs-attr">user</span>: {
                <span class="hljs-attr">id</span>: <span class="hljs-string">'@integer(1,100)'</span>,
                <span class="hljs-attr">name</span>: <span class="hljs-string">'@cname()'</span>, <span class="hljs-comment">// ä¸­æ–‡å§“å</span>
                <span class="hljs-attr">avatar</span>: <span class="hljs-string">'@image(300x200)'</span> <span class="hljs-comment">// éšæœºå›¾ç‰‡ï¼ˆ300x200ï¼‰</span>
            },
            <span class="hljs-attr">tags</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Mock</span>.<span class="hljs-property">Random</span>.<span class="hljs-title function_">pick</span>(tags,<span class="hljs-number">2</span>), <span class="hljs-comment">// éšæœº2ä¸ªæ ‡ç­¾</span>
            <span class="hljs-attr">thumbnail</span>: <span class="hljs-string">'@image(300x200)'</span>, <span class="hljs-comment">// ç¼©ç•¥å›¾</span>
            <span class="hljs-attr">pics</span>: [
                <span class="hljs-string">'@image(300x200)'</span>,
                <span class="hljs-string">'@image(300x200)'</span>,
                <span class="hljs-string">'@image(300x200)'</span>,
            ],
            <span class="hljs-attr">id</span>: <span class="hljs-string">'@integer(1,1000000)'</span>, <span class="hljs-comment">// å”¯ä¸€ID</span>
        }
    ]
}).<span class="hljs-property">list</span>; <span class="hljs-comment">// æå–listæ•°ç»„</span>
</code></pre>
<h4 data-id="heading-16">3.3.3 æ¥å£é…ç½®ï¼šæ‹¦æˆªè¯·æ±‚å¹¶è¿”å›æ•°æ®</h4>
<p>é€šè¿‡é…ç½®urlã€methodã€responseï¼Œå®ç°å¯¹æŒ‡å®šæ¥å£çš„æ‹¦æˆªä¸å“åº”ã€‚æ ¸å¿ƒé€»è¾‘åŒ…æ‹¬è¯·æ±‚å‚æ•°è§£æã€åˆ†é¡µå¤„ç†ã€å“åº”æ ¼å¼è¿”å›ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> [
    {
        url: <span class="hljs-string">'/api/posts'</span>, <span class="hljs-comment">// åŒ¹é…å‰ç«¯è¯·æ±‚çš„URLï¼ˆéœ€ä¸axiosè¯·æ±‚è·¯å¾„ä¸€è‡´ï¼‰</span>
        method: <span class="hljs-string">'get'</span>, <span class="hljs-comment">// è¯·æ±‚æ–¹æ³•ï¼ˆGET/POSTç­‰ï¼‰</span>
        <span class="hljs-comment">// responseå‡½æ•°ï¼šå¤„ç†è¯·æ±‚å¹¶è¿”å›å“åº”æ•°æ®</span>
        response: ({ query }, res) =&gt; {
            console.<span class="hljs-built_in">log</span>(query); <span class="hljs-comment">// æ‰“å°è¯·æ±‚å‚æ•°ï¼ˆpageã€limitï¼‰</span>
            <span class="hljs-type">const</span> { page = <span class="hljs-string">'1'</span> , limit = <span class="hljs-string">'10'</span> } = query;
            <span class="hljs-comment">// å°†å­—ç¬¦ä¸²å‚æ•°è½¬æ¢ä¸ºæ•°å­—ï¼ˆå‰ç«¯ä¼ å‚å¯èƒ½ä¸ºå­—ç¬¦ä¸²ï¼Œéœ€å¤„ç†ç±»å‹ï¼‰</span>
            <span class="hljs-type">const</span> currentPage = <span class="hljs-built_in">Number</span>(page, <span class="hljs-number">10</span>);
            <span class="hljs-type">const</span> size = <span class="hljs-built_in">parseInt</span>(limit, <span class="hljs-number">10</span>);
            
            <span class="hljs-comment">// å‚æ•°åˆæ³•æ€§æ ¡éªŒ</span>
            <span class="hljs-keyword">if</span>(<span class="hljs-built_in">isNaN</span>(currentPage) || <span class="hljs-built_in">isNaN</span>(size) || currentPage &lt; <span class="hljs-number">1</span> || size &lt; <span class="hljs-number">1</span>){
                <span class="hljs-keyword">return</span> {
                    code: <span class="hljs-number">400</span>,
                    msg: <span class="hljs-string">'Invalid page or pageSize'</span>,
                    data: null
                };
            }

            <span class="hljs-comment">// åˆ†é¡µé€»è¾‘è®¡ç®—</span>
            <span class="hljs-type">const</span> total = posts.length; <span class="hljs-comment">// æ€»æ•°æ®é‡</span>
            <span class="hljs-type">const</span> start = (currentPage - <span class="hljs-number">1</span>) * size; <span class="hljs-comment">// èµ·å§‹ç´¢å¼•</span>
            <span class="hljs-type">const</span> end = start + size; <span class="hljs-comment">// ç»“æŸç´¢å¼•</span>
            <span class="hljs-type">const</span> paginatedData = posts.<span class="hljs-built_in">slice</span>(start, end); <span class="hljs-comment">// æˆªå–å½“å‰é¡µæ•°æ®</span>

            <span class="hljs-comment">// è¿”å›å“åº”ç»“æœï¼ˆä¸åç«¯æ¥å£æ ¼å¼ä¸€è‡´ï¼‰</span>
            <span class="hljs-keyword">return</span> {
                code: <span class="hljs-number">200</span>,
                msg: <span class="hljs-string">'success'</span>,
                items: paginatedData,
                pagination: {
                    current: currentPage,
                    limit: size,
                    total,
                    totalPages: Math.<span class="hljs-built_in">ceil</span>(total / size), <span class="hljs-comment">// æ€»é¡µæ•°</span>
                }
            };
        }
    }
];
</code></pre>
<p>æ¥å£æ¨¡æ‹Ÿå…³é”®è¦ç‚¹ï¼š</p>
<ul>
<li><strong>URLåŒ¹é…</strong>ï¼šurléœ€ä¸axiosè¯·æ±‚çš„URLå®Œå…¨ä¸€è‡´ï¼ˆå«baseURLå‰ç¼€ï¼‰ï¼Œç¡®ä¿è¯·æ±‚è¢«æ­£ç¡®æ‹¦æˆªï¼›</li>
<li><strong>å‚æ•°å¤„ç†</strong>ï¼šGETè¯·æ±‚å‚æ•°ä»queryä¸­è·å–ï¼Œéœ€æ³¨æ„ç±»å‹è½¬æ¢ï¼ˆå‰ç«¯ä¼ å‚å¯èƒ½ä¸ºå­—ç¬¦ä¸²ï¼Œéœ€è½¬ä¸ºæ•°å­—ï¼‰ï¼ŒåŒæ—¶è¿›è¡Œåˆæ³•æ€§æ ¡éªŒï¼Œè¿”å›å¯¹åº”é”™è¯¯ä¿¡æ¯ï¼›</li>
<li><strong>åˆ†é¡µé€»è¾‘</strong>ï¼šé€šè¿‡sliceæ–¹æ³•æˆªå–å½“å‰é¡µæ•°æ®ï¼Œè®¡ç®—æ€»é¡µæ•°ï¼Œè¿”å›åˆ†é¡µä¿¡æ¯ï¼Œä¾¿äºå‰ç«¯å®ç°åˆ†é¡µåŠ è½½ï¼›</li>
<li><strong>å“åº”æ ¼å¼ç»Ÿä¸€</strong>ï¼šä¸åç«¯çº¦å®šå¥½å“åº”æ ¼å¼ï¼ˆcodeã€msgã€data/itemsã€paginationï¼‰ï¼Œç¡®ä¿åˆ‡æ¢çœŸå®æ¥å£æ—¶æ— éœ€ä¿®æ”¹å‰ç«¯é€»è¾‘ã€‚</li>
</ul>
<h3 data-id="heading-17">3.4 mockjsè¿›é˜¶ç”¨æ³•æ‰©å±•</h3>
<ul>
<li><strong>å¤šç§è¯·æ±‚æ–¹æ³•æ”¯æŒ</strong>ï¼šå¯é…ç½®POSTã€PUTã€DELETEç­‰æ–¹æ³•çš„æ¥å£ï¼ŒPOSTè¯·æ±‚å‚æ•°ä»bodyä¸­è·å–ï¼ˆ<code>({ body }, res) =&gt; {}</code>ï¼‰ï¼›</li>
<li><strong>åŠ¨æ€æ•°æ®ç”Ÿæˆ</strong>ï¼šå¯æ ¹æ®è¯·æ±‚å‚æ•°åŠ¨æ€ç”Ÿæˆæ•°æ®ï¼Œå¦‚æ ¹æ®ç”¨æˆ·IDè¿”å›å¯¹åº”ç”¨æˆ·çš„å¸–å­ï¼›</li>
<li><strong>å¼‚å¸¸åœºæ™¯æ¨¡æ‹Ÿ</strong>ï¼šé™¤äº†æ­£å¸¸å“åº”ï¼Œè¿˜å¯æ¨¡æ‹Ÿ401ï¼ˆæœªæˆæƒï¼‰ã€404ï¼ˆæ¥å£ä¸å­˜åœ¨ï¼‰ã€500ï¼ˆæœåŠ¡å™¨é”™è¯¯ï¼‰ç­‰çŠ¶æ€ï¼Œæµ‹è¯•å‰ç«¯é”™è¯¯å¤„ç†é€»è¾‘ã€‚</li>
</ul>
<h2 data-id="heading-18">å››ã€Post Listï¼šæ•°æ®çŠ¶æ€ç®¡ç†ä¸é¡µé¢æ¸²æŸ“</h2>
<h3 data-id="heading-19">4.1 TypeScriptç±»å‹å®šä¹‰</h3>
<p>ä¸ºå®ç°ç±»å‹å®‰å…¨ï¼Œéœ€å®šä¹‰Postã€Useræ¥å£ï¼Œæ˜ç¡®æ•°æ®ç»“æ„ã€‚ä»£ç ä½äº<code>src/types/index.ts</code>ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span>{
    <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
    <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
    avatar?: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// å¯é€‰å±æ€§ï¼ˆ?è¡¨ç¤ºï¼‰</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Post</span>{
    <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
    <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">brief</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// ç®€ä»‹</span>
    <span class="hljs-attr">publishedAt</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// å‘å¸ƒæ—¶é—´</span>
    totalLikes?: <span class="hljs-built_in">number</span>; <span class="hljs-comment">// ç‚¹èµæ•°ï¼ˆå¯é€‰ï¼‰</span>
    totalComments?: <span class="hljs-built_in">number</span>; <span class="hljs-comment">// è¯„è®ºæ•°ï¼ˆå¯é€‰ï¼‰</span>
    <span class="hljs-attr">user</span>: <span class="hljs-title class_">User</span>; <span class="hljs-comment">// å…³è”Useræ¥å£</span>
    <span class="hljs-attr">tags</span>: <span class="hljs-built_in">string</span>[]; <span class="hljs-comment">// æ ‡ç­¾æ•°ç»„</span>
    thumbnail?: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// ç¼©ç•¥å›¾ï¼ˆå¯é€‰ï¼‰</span>
    pics?: <span class="hljs-built_in">string</span>[]; <span class="hljs-comment">// å›¾ç‰‡æ•°ç»„ï¼ˆå¯é€‰ï¼‰</span>
}
</code></pre>
<p>ç±»å‹å®šä¹‰è¦ç‚¹ï¼š</p>
<ul>
<li>å¿…å¡«å±æ€§ç›´æ¥å®šä¹‰ç±»å‹ï¼Œå¯é€‰å±æ€§æ·»åŠ <code>?</code>ï¼›</li>
<li>å…³è”æ¥å£ï¼ˆå¦‚Postä¸­çš„userå±æ€§å…³è”Userï¼‰ï¼Œå®ç°æ•°æ®ç»“æ„çš„åµŒå¥—çº¦æŸï¼›</li>
<li>æ‰€æœ‰æ¥å£ç±»å‹éœ€ä¸mockæ•°æ®ã€åç«¯æ¥å£è¿”å›æ•°æ®ä¿æŒä¸€è‡´ï¼Œé¿å…ç±»å‹ä¸åŒ¹é…é”™è¯¯ã€‚</li>
</ul>
<h3 data-id="heading-20">4.2 Zustandå…¨å±€çŠ¶æ€ç®¡ç†</h3>
<p>Zustandæ˜¯ä¸€æ¬¾è½»é‡çº§çŠ¶æ€ç®¡ç†åº“ï¼Œç›¸æ¯”Reduxæ›´ç®€æ´ï¼Œæ— éœ€ProvideråŒ…è£¹ï¼Œé€‚åˆä¸­å°å‹é¡¹ç›®ã€‚æœ¬æ–‡ç”¨å…¶å­˜å‚¨å¸–å­åˆ—è¡¨æ•°æ®ã€è½®æ’­å›¾æ•°æ®åŠåŠ è½½æ–¹æ³•ã€‚</p>
<h4 data-id="heading-21">4.2.1 çŠ¶æ€å®šä¹‰ä¸å®ç°</h4>
<p>ä»£ç ä½äº<code>src/store/home.ts</code>ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { create } <span class="hljs-keyword">from</span> <span class="hljs-string">"zustand"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">SlideData</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/components/SlideShow"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">Post</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/types"</span>;
<span class="hljs-keyword">import</span> { fetchPosts } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/api/posts"</span>;

<span class="hljs-comment">// å®šä¹‰çŠ¶æ€æ¥å£</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">HomeState</span> {
    <span class="hljs-attr">banners</span>: <span class="hljs-title class_">SlideData</span>[]; <span class="hljs-comment">// è½®æ’­å›¾æ•°æ®</span>
    <span class="hljs-attr">posts</span>: <span class="hljs-title class_">Post</span>[]; <span class="hljs-comment">// å¸–å­åˆ—è¡¨æ•°æ®</span>
    <span class="hljs-attr">loadMore</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;; <span class="hljs-comment">// åŠ è½½æ›´å¤šæ–¹æ³•ï¼ˆåˆ†é¡µåŠ è½½ï¼‰</span>
}

<span class="hljs-comment">// åˆ›å»ºçŠ¶æ€ç®¡ç†å®ä¾‹</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useHomeStore = create&lt;<span class="hljs-title class_">HomeState</span>&gt;(<span class="hljs-function">(<span class="hljs-params">set</span>) =&gt;</span> ({
    <span class="hljs-comment">// åˆå§‹è½®æ’­å›¾æ•°æ®</span>
    <span class="hljs-attr">banners</span>: [{
      <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,
      <span class="hljs-attr">title</span>: <span class="hljs-string">"React ç”Ÿæ€ç³»ç»Ÿ"</span>,
      <span class="hljs-attr">image</span>: <span class="hljs-string">"https://images.unsplash.com/photo-1633356122544-f134324a6cee?q=80&amp;w=2070&amp;auto=format&amp;fit=crop"</span>,
    },
    {
      <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>,
      <span class="hljs-attr">title</span>: <span class="hljs-string">"ç§»åŠ¨ç«¯å¼€å‘æœ€ä½³å®è·µ"</span>,
      <span class="hljs-attr">image</span>: <span class="hljs-string">"https://img.36krcdn.com/hsossms/20260114/v2_1ddcc36679304d3390dd9b8545eaa57f@5091053@ai_oswg1012730oswg1053oswg495_img_png~tplv-1marlgjv7f-ai-v3:600:400:600:400:q70.jpg?x-oss-process=image/format,webp"</span>,
    },
    {
      <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>,
      <span class="hljs-attr">title</span>: <span class="hljs-string">"ç™¾åº¦ä¸Šçº¿ä¸ƒçŒ«æ¼«å‰§ï¼Œæ‰“çš„ä»€ä¹ˆä¸»æ„ï¼Ÿ"</span>,
      <span class="hljs-attr">image</span>: <span class="hljs-string">"https://img.36krcdn.com/hsossms/20260114/v2_8dc528b02ded4f73b29b7c1019f8963a@5091053@ai_oswg1137571oswg1053oswg495_img_png~tplv-1marlgjv7f-ai-v3:600:400:600:400:q70.jpg?x-oss-process=image/format,webp"</span>,
    }],
    <span class="hljs-comment">// åˆå§‹å¸–å­åˆ—è¡¨ä¸ºç©º</span>
    <span class="hljs-attr">posts</span>: [],
    <span class="hljs-comment">// åŠ è½½æ›´å¤šæ–¹æ³•ï¼ˆå¼‚æ­¥ï¼‰</span>
    <span class="hljs-attr">loadMore</span>: <span class="hljs-keyword">async</span> () =&gt; {
      <span class="hljs-keyword">const</span> { items } = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchPosts</span>();
      <span class="hljs-comment">// æ›´æ–°çŠ¶æ€ï¼šå°†æ–°è·å–çš„å¸–å­æ•°æ®è¿½åŠ åˆ°postsä¸­ï¼ˆåˆ†é¡µåŠ è½½é€»è¾‘ï¼‰</span>
      <span class="hljs-title function_">set</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> ({ <span class="hljs-attr">posts</span>: [...state.<span class="hljs-property">posts</span>, ...items] }));
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(items);
    }
}));
</code></pre>
<p>çŠ¶æ€ç®¡ç†æ ¸å¿ƒé€»è¾‘ï¼š</p>
<ul>
<li><strong>çŠ¶æ€æ¥å£å®šä¹‰</strong>ï¼šé€šè¿‡HomeStateæ¥å£çº¦æŸçŠ¶æ€çš„ç»“æ„ä¸ç±»å‹ï¼Œç¡®ä¿çŠ¶æ€æ•°æ®åˆè§„ï¼›</li>
<li><strong>åˆå§‹çŠ¶æ€</strong>ï¼šbannersè®¾ç½®åˆå§‹è½®æ’­å›¾æ•°æ®ï¼Œpostsåˆå§‹ä¸ºç©ºæ•°ç»„ï¼›</li>
<li><strong>å¼‚æ­¥æ–¹æ³•</strong>ï¼šloadMoreä¸ºå¼‚æ­¥æ–¹æ³•ï¼Œè°ƒç”¨fetchPostsè·å–å¸–å­æ•°æ®ï¼Œé€šè¿‡setæ–¹æ³•æ›´æ–°çŠ¶æ€ã€‚setæ–¹æ³•æ”¯æŒå‡½æ•°å‚æ•°ï¼Œå¯è·å–å½“å‰çŠ¶æ€ï¼Œå®ç°æ•°æ®è¿½åŠ ï¼ˆåˆ†é¡µåŠ è½½æ ¸å¿ƒé€»è¾‘ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-22">4.3 é¡µé¢æ¸²æŸ“ä¸æ•°æ®è”åŠ¨</h3>
<p>é¦–é¡µç»„ä»¶ï¼ˆ<code>src/pages/Home.tsx</code>ï¼‰ä»çŠ¶æ€ä¸­è¯»å–æ•°æ®ï¼Œæ¸²æŸ“è½®æ’­å›¾ã€å¸–å­åˆ—è¡¨ï¼Œå¹¶åœ¨ç»„ä»¶åŠ è½½æ—¶è§¦å‘æ•°æ®åŠ è½½ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Header</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"@/components/Header"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">SlideShow</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"@/components/SlideShow"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Card</span>, <span class="hljs-title class_">CardHeader</span>, <span class="hljs-title class_">CardTitle</span>, <span class="hljs-title class_">CardContent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/components/ui/card"</span>;
<span class="hljs-keyword">import</span> { useHomeStore } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/store/home"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Home</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// ä»çŠ¶æ€ä¸­è§£æ„æ•°æ®ä¸æ–¹æ³•</span>
    <span class="hljs-keyword">const</span> { banners, posts, loadMore } = <span class="hljs-title function_">useHomeStore</span>();
    
    <span class="hljs-comment">// ç»„ä»¶æŒ‚è½½æ—¶è§¦å‘åŠ è½½æ›´å¤šï¼ˆè·å–ç¬¬ä¸€é¡µæ•°æ®ï¼‰</span>
    <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-title function_">loadMore</span>();
    }, []); <span class="hljs-comment">// ç©ºä¾èµ–æ•°ç»„ï¼Œä»…åœ¨ç»„ä»¶æŒ‚è½½æ—¶æ‰§è¡Œä¸€æ¬¡</span>
    
    <span class="hljs-keyword">return</span> ( 
        <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Header</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"é¦–é¡µ"</span> <span class="hljs-attr">showBackButton</span>=<span class="hljs-string">{true}</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"p-4 space-y-4 "</span>&gt;</span>
            {/* è½®æ’­å›¾ç»„ä»¶ï¼Œä¼ å…¥bannersæ•°æ® */}
            <span class="hljs-tag">&lt;<span class="hljs-name">SlideShow</span> <span class="hljs-attr">slides</span>=<span class="hljs-string">{banners}</span> /&gt;</span>
            {/* æ¬¢è¿å¡ç‰‡ */}
            <span class="hljs-tag">&lt;<span class="hljs-name">Card</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">CardHeader</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">CardTitle</span>&gt;</span>æ¬¢è¿æ¥åˆ°React Mobile<span class="hljs-tag">&lt;/<span class="hljs-name">CardTitle</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">CardHeader</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">CardContent</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-muted-foreground"</span>&gt;</span>è¿™æ˜¯å†…å®¹åŒºåŸŸ<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">CardContent</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">Card</span>&gt;</span>
            {/* å¸–å­åˆ—è¡¨ç½‘æ ¼å¸ƒå±€ */}
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"grid grid-cols-2 gap-4"</span>&gt;</span>
                {/* éå†postsæ•°æ®æ¸²æŸ“å¸–å­å¡ç‰‡ï¼ˆå½“å‰ä¸ºå ä½ï¼Œå¯æ›¿æ¢ä¸ºçœŸå®å¸–å­ç»„ä»¶ï¼‰ */}
                {posts.map((post) =&gt; (
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{post.id}</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"h-32 bg-white rounded-lg shadow-sm flex items-center justify-center border "</span>&gt;</span>
                        {post.title}
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                ))}
                {/* åŸå ä½æ•°æ®ï¼Œå¯åˆ é™¤ï¼Œæ›¿æ¢ä¸ºçœŸå®æ•°æ®æ¸²æŸ“ */}
                {/* {[1,2,...,25].map((i,index) =&gt; (...))} */}
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/&gt;</span></span>
    );
}
</code></pre>
<p>é¡µé¢æ¸²æŸ“å…³é”®è¦ç‚¹ï¼š</p>
<ul>
<li><strong>çŠ¶æ€è®¢é˜…</strong>ï¼šé€šè¿‡useHomeStoreé’©å­è®¢é˜…çŠ¶æ€ï¼Œå½“postsã€bannerså‘ç”Ÿå˜åŒ–æ—¶ï¼Œç»„ä»¶ä¼šè‡ªåŠ¨é‡æ–°æ¸²æŸ“ï¼›</li>
<li><strong>æ•°æ®åŠ è½½æ—¶æœº</strong>ï¼šé€šè¿‡useEffectåœ¨ç»„ä»¶æŒ‚è½½æ—¶è°ƒç”¨loadMoreï¼Œè·å–ç¬¬ä¸€é¡µå¸–å­æ•°æ®ï¼›</li>
<li><strong>åˆ—è¡¨æ¸²æŸ“</strong>ï¼šä½¿ç”¨mapéå†postsæ•°ç»„æ¸²æŸ“åˆ—è¡¨ï¼Œéœ€æŒ‡å®šå”¯ä¸€keyï¼ˆpost.idï¼‰ï¼Œé¿å…Reactæ¸²æŸ“è­¦å‘Šã€‚åŸä»£ç ä¸­çš„å ä½æ•°æ®å¯æ›¿æ¢ä¸ºçœŸå®å¸–å­ç»„ä»¶ï¼Œå±•ç¤ºå¸–å­æ ‡é¢˜ã€ç¼©ç•¥å›¾ç­‰ä¿¡æ¯ï¼›</li>
<li><strong>æ ·å¼ä¸å¸ƒå±€</strong>ï¼šé€šè¿‡TailwindCSSå®ç°ç½‘æ ¼å¸ƒå±€ï¼ˆgrid-cols-2ï¼‰ã€é—´è·æ§åˆ¶ï¼ˆspace-y-4ã€gap-4ï¼‰ï¼Œé€‚é…ç§»åŠ¨ç«¯å±•ç¤ºã€‚</li>
</ul>
<h2 data-id="heading-23">äº”ã€æ ¸å¿ƒæŠ€æœ¯æ•´åˆä¸å®æˆ˜æ€»ç»“</h2>
<h3 data-id="heading-24">5.1 æŠ€æœ¯æ•´åˆå…³é”®ç‚¹</h3>
<ul>
<li><strong>æ¥å£ä¸€è‡´æ€§</strong>ï¼šmockæ•°æ®æ ¼å¼ã€TypeScriptæ¥å£ã€åç«¯æ¥å£æ–‡æ¡£ä¸‰è€…å¿…é¡»ä¿æŒä¸€è‡´ï¼Œè¿™æ˜¯å®ç°â€œæ— ç¼åˆ‡æ¢â€çš„æ ¸å¿ƒå‰æï¼›</li>
<li><strong>åˆ†å±‚è®¾è®¡</strong>ï¼šè¯·æ±‚å±‚ï¼ˆaxiosï¼‰ã€æ¨¡æ‹Ÿæ•°æ®å±‚ï¼ˆmockjsï¼‰ã€çŠ¶æ€å±‚ï¼ˆZustandï¼‰ã€è§†å›¾å±‚ï¼ˆé¡µé¢ç»„ä»¶ï¼‰åˆ†å±‚æ¸…æ™°ï¼Œä¾¿äºç»´æŠ¤ä¸æ‰©å±•ï¼›</li>
<li><strong>ç±»å‹å®‰å…¨</strong>ï¼šå…¨ç¨‹ä½¿ç”¨TypeScriptå®šä¹‰ç±»å‹ï¼Œä»è¯·æ±‚å‚æ•°ã€å“åº”æ•°æ®åˆ°çŠ¶æ€ç®¡ç†ã€ç»„ä»¶Propsï¼Œé¿å…æ•°æ®å¼‚å¸¸å¯¼è‡´çš„bugï¼›</li>
<li><strong>å¼€å‘æ•ˆç‡</strong>ï¼šmockjsä½¿å‰ç«¯ç‹¬ç«‹å¼€å‘ï¼Œæ— éœ€ä¾èµ–åç«¯ï¼ŒViteæ’ä»¶é›†æˆç®€åŒ–é…ç½®ï¼ŒZustandå‡å°‘çŠ¶æ€ç®¡ç†å†—ä½™ä»£ç ï¼Œæ•´ä½“æå‡å¼€å‘æ•ˆç‡ã€‚</li>
</ul>
<h3 data-id="heading-25">5.2 å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h3>
<ul>
<li><strong>mockè¯·æ±‚æ‹¦æˆªå¤±è´¥</strong>ï¼šæ£€æŸ¥mockæ–‡ä»¶è·¯å¾„æ˜¯å¦ä¸vite.config.tsä¸­mockPathé…ç½®ä¸€è‡´ï¼ŒURLæ˜¯å¦ä¸axiosè¯·æ±‚è·¯å¾„å®Œå…¨åŒ¹é…ï¼Œç¡®ä¿localEnabledè®¾ä¸ºtrueï¼›</li>
<li><strong>ç±»å‹ä¸åŒ¹é…é”™è¯¯</strong>ï¼šæ£€æŸ¥TypeScriptæ¥å£å®šä¹‰ä¸mockæ•°æ®ã€å“åº”æ•°æ®æ˜¯å¦ä¸€è‡´ï¼Œç¡®ä¿å¯é€‰å±æ€§ã€åµŒå¥—ç»“æ„æ­£ç¡®ï¼›</li>
<li><strong>åˆ†é¡µé€»è¾‘å¼‚å¸¸</strong>ï¼šç¡®è®¤pageã€limitå‚æ•°ç±»å‹è½¬æ¢æ­£ç¡®ï¼Œåˆ†é¡µè®¡ç®—å…¬å¼ï¼ˆstart = (currentPage-1)*sizeï¼‰æ— è¯¯ï¼Œsliceæ–¹æ³•æˆªå–èŒƒå›´æ­£ç¡®ï¼›</li>
<li><strong>çŠ¶æ€æ›´æ–°åç»„ä»¶ä¸æ¸²æŸ“</strong>ï¼šç¡®ä¿é€šè¿‡Zustandçš„setæ–¹æ³•æ›´æ–°çŠ¶æ€ï¼Œä¸”ç»„ä»¶æ­£ç¡®è®¢é˜…çŠ¶æ€ï¼ˆä½¿ç”¨useHomeStoreé’©å­è§£æ„æ•°æ®ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-26">5.3 ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ³¨æ„äº‹é¡¹</h3>
<ul>
<li>åˆ‡æ¢axiosçš„baseURLä¸ºåç«¯çœŸå®æ¥å£åœ°å€ï¼Œç¦ç”¨mockæœåŠ¡ï¼ˆprodEnabled: falseï¼‰ï¼›</li>
<li>å®Œå–„é”™è¯¯å¤„ç†é€»è¾‘ï¼Œæ·»åŠ ç”¨æˆ·å¯æ„ŸçŸ¥çš„é”™è¯¯æç¤ºï¼ˆå¦‚Toastç»„ä»¶ï¼‰ï¼Œæ›¿ä»£æ§åˆ¶å°æ‰“å°ï¼›</li>
<li>ä¼˜åŒ–è¯·æ±‚æ€§èƒ½ï¼Œå¦‚æ·»åŠ è¯·æ±‚ç¼“å­˜ã€é˜²æŠ–èŠ‚æµï¼ˆé’ˆå¯¹ä¸‹æ‹‰åŠ è½½æ›´å¤šï¼‰ã€è¶…æ—¶é‡è¿ç­‰ï¼›</li>
<li>æ ¡éªŒåç«¯æ¥å£è¿”å›æ•°æ®ï¼Œå¤„ç†å¼‚å¸¸çŠ¶æ€ç ï¼Œç¡®ä¿ç”Ÿäº§ç¯å¢ƒæ•°æ®ç¨³å®šæ€§ã€‚</li>
</ul>
<h2 data-id="heading-27">å…­ã€æ‰©å±•å­¦ä¹ ä¸è¿›é˜¶æ–¹å‘</h2>
<ul>
<li><strong>axiosè¿›é˜¶</strong>ï¼šå­¦ä¹ è¯·æ±‚å–æ¶ˆï¼ˆå¦‚é¡µé¢å¸è½½æ—¶å–æ¶ˆæœªå®Œæˆè¯·æ±‚ï¼‰ã€è¯·æ±‚é‡è¯•ã€ä¸Šä¼ ä¸‹è½½è¿›åº¦ç›‘æ§ç­‰é«˜çº§åŠŸèƒ½ï¼›</li>
<li><strong>mockjsæ‰©å±•</strong>ï¼šä½¿ç”¨mockjsç»“åˆJSON5è¯­æ³•ç¼–å†™æ›´å¤æ‚çš„æ¨¡æ‹Ÿè§„åˆ™ï¼Œé›†æˆmockæ•°æ®æŒä¹…åŒ–ï¼ˆå¦‚localStorageï¼‰ï¼›</li>
<li><strong>çŠ¶æ€ç®¡ç†æ·±åŒ–</strong>ï¼šå­¦ä¹ Zustandçš„ä¸­é—´ä»¶ï¼ˆå¦‚æ—¥å¿—ã€æŒä¹…åŒ–ï¼‰ï¼Œå¯¹æ¯”Reduxã€Piniaç­‰çŠ¶æ€ç®¡ç†åº“çš„é€‚ç”¨åœºæ™¯ï¼›</li>
<li><strong>åˆ†é¡µä¸æ— é™æ»šåŠ¨</strong>ï¼šåŸºäºå½“å‰åˆ†é¡µé€»è¾‘ï¼Œå®ç°ä¸‹æ‹‰åŠ è½½æ›´å¤šã€ä¸Šæ‹‰åˆ·æ–°åŠŸèƒ½ï¼Œé›†æˆç¬¬ä¸‰æ–¹ç»„ä»¶ï¼ˆå¦‚react-infinite-scroll-componentï¼‰ï¼›</li>
<li><strong>æ¥å£è”è°ƒä¸æµ‹è¯•</strong>ï¼šå­¦ä¹ ä½¿ç”¨Postmanã€Swaggerç­‰å·¥å…·æµ‹è¯•åç«¯æ¥å£ï¼Œå®ç°å‰ç«¯ä¸åç«¯çš„é«˜æ•ˆè”è°ƒã€‚</li>
</ul>
<p>æœ¬æ–‡é€šè¿‡å®æˆ˜ä»£ç æ‹†è§£ï¼Œç³»ç»Ÿè®²è§£äº†Post ListåŠŸèƒ½å¼€å‘ä¸­axiosã€mockjsçš„æ ¸å¿ƒç”¨æ³•åŠçŠ¶æ€ç®¡ç†ã€é¡µé¢æ¸²æŸ“çš„å®Œæ•´æµç¨‹ã€‚æŒæ¡è¿™äº›çŸ¥è¯†ï¼Œå¯å¿«é€Ÿæ­å»ºå‰ç«¯é¡¹ç›®çš„æ•°æ®å±‚æ¶æ„ï¼Œå®ç°å‰åç«¯åˆ†ç¦»æ¨¡å¼ä¸‹çš„é«˜æ•ˆå¼€å‘ã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œéœ€ç»“åˆä¸šåŠ¡éœ€æ±‚çµæ´»æ‰©å±•ï¼Œä¸æ–­ä¼˜åŒ–ä»£ç è´¨é‡ä¸ç”¨æˆ·ä½“éªŒã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[pythontutor - ä»£ç å¯è§†åŒ–æ¢ç´¢ï¼šé“¾è¡¨ã€å¼‚å¸¸ä¸æ§åˆ¶æµçš„åŠ¨æ€æ¼”ç¤º]]></title>    <link>https://juejin.cn/post/7598499504170893350</link>    <guid>https://juejin.cn/post/7598499504170893350</guid>    <pubDate>2026-01-24T08:12:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598499504170893350" data-draft-id="7598818096728866854" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="pythontutor - ä»£ç å¯è§†åŒ–æ¢ç´¢ï¼šé“¾è¡¨ã€å¼‚å¸¸ä¸æ§åˆ¶æµçš„åŠ¨æ€æ¼”ç¤º"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-24T08:12:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="pe7er"/> <meta itemprop="url" content="https://juejin.cn/user/905653310988445"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            pythontutor - ä»£ç å¯è§†åŒ–æ¢ç´¢ï¼šé“¾è¡¨ã€å¼‚å¸¸ä¸æ§åˆ¶æµçš„åŠ¨æ€æ¼”ç¤º
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/905653310988445/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    pe7er
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T08:12:21.000Z" title="Sat Jan 24 2026 08:12:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">PythonTutor æ˜¯ä»€ä¹ˆ</h2>
<p>PythonTutor æ˜¯ä¸€ä¸ªç”¨äºå±•ç¤ºä»£ç æ‰§è¡Œè¿‡ç¨‹çš„å¯è§†åŒ–å­¦ä¹ å·¥å…·ã€‚å®ƒå…³æ³¨çš„ä¸æ˜¯ç¨‹åºæœ€ç»ˆè¾“å‡ºçš„ç»“æœï¼Œè€Œæ˜¯ä»£ç åœ¨è¿è¡Œè¿‡ç¨‹ä¸­æ¯ä¸€æ­¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„ã€å˜é‡å’Œå¯¹è±¡åœ¨å†…å­˜ä¸­å¦‚ä½•å˜åŒ–ã€‚</p>
<hr/>
<h3 data-id="heading-1">PythonTutor çš„æ ¸å¿ƒä»·å€¼</h3>
<p>PythonTutor ä¼šé€è¡Œæ‰§è¡Œä»£ç ï¼Œå¹¶å®æ—¶å±•ç¤ºï¼š</p>
<ul>
<li>å½“å‰æ­£åœ¨æ‰§è¡Œçš„ä»£ç è¡Œ</li>
<li>å˜é‡åœ¨ä¸åŒé˜¶æ®µçš„å–å€¼å˜åŒ–</li>
<li>å¯¹è±¡åœ¨å†…å­˜ä¸­çš„åˆ†é…æƒ…å†µ</li>
<li>å¼•ç”¨å…³ç³»ã€æŒ‡é’ˆæŒ‡å‘å’Œè°ƒç”¨æ ˆç»“æ„</li>
</ul>
<p>è¿™ç§æ–¹å¼å¯ä»¥å¸®åŠ©å¼€å‘è€…çœŸæ­£ç†è§£ç¨‹åºçš„æ‰§è¡Œé€»è¾‘ï¼Œè€Œä¸ä»…ä»…æ˜¯â€œè·‘é€šä»£ç â€ã€‚</p>
<hr/>
<h3 data-id="heading-2">å¯è§†åŒ–å˜é‡å’Œå†…å­˜ç»“æ„</h3>
<p>åœ¨å¾ˆå¤šè¯­è¨€ä¸­ï¼Œå˜é‡æœ¬è´¨ä¸Šæ˜¯å¯¹å¯¹è±¡çš„å¼•ç”¨ã€‚ä»…é€šè¿‡æ—¥å¿—æˆ–æ‰“å°è¾“å‡ºï¼Œå¾ˆéš¾ç›´è§‚ç†è§£å¤šä¸ªå˜é‡æ˜¯å¦æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ã€‚</p>
<p>PythonTutor ä¼šå°†è¿™äº›å…³ç³»ä»¥å›¾å½¢å½¢å¼å±•ç¤ºå‡ºæ¥ï¼Œå°¤å…¶é€‚åˆç†è§£ä»¥ä¸‹æ¦‚å¿µï¼š</p>
<ul>
<li>å¼•ç”¨ä¸å¯¹è±¡çš„å…³ç³»</li>
<li>é“¾è¡¨å’ŒæŒ‡é’ˆç»“æ„</li>
<li>å¯¹è±¡å…±äº«ä¸å‰¯ä½œç”¨</li>
<li>æ ˆä¸å †å†…å­˜çš„å˜åŒ–</li>
</ul>
<hr/>
<h3 data-id="heading-3">Java é“¾è¡¨ç¤ºä¾‹</h3>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´ã€å¯ç›´æ¥è¿è¡Œçš„ Java å•å‘é“¾è¡¨ç¤ºä¾‹ï¼Œé€‚åˆæ”¾å…¥ PythonTutor çš„ Java æ¨¡å¼ä¸­è§‚å¯ŸæŒ‡é’ˆå’Œå¯¹è±¡çš„å˜åŒ–ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2765da14261b4fabbfb1dd97a3dd4005~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgcGU3ZXI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769847968&amp;x-signature=vyg7qoH%2FTmKLIYXokTHMZz1AXeo%3D" alt="é“¾è¡¨è™šæ‹ŸåŒ–.gif" loading="lazy"/></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span>Â java.util.Objects;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LinkedListDemo</span> {

    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Node</span> {
        <span class="hljs-type">int</span> value;
        Node next;

        Node(<span class="hljs-type">int</span> value) {
            <span class="hljs-built_in">this</span>.value = value;
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">Node</span> <span class="hljs-variable">head</span> <span class="hljs-operator">=</span> buildList();
        printList(head);

        head = delete(head, <span class="hljs-number">2</span>);
        printList(head);

        System.out.println(<span class="hljs-string">"æ˜¯å¦åŒ…å« 3: "</span> + contains(head, <span class="hljs-number">3</span>));
        System.out.println(<span class="hljs-string">"æ˜¯å¦åŒ…å« 5: "</span> + contains(head, <span class="hljs-number">5</span>));

        head = reverse(head);
        printList(head);
    }

    <span class="hljs-keyword">static</span> Node <span class="hljs-title function_">buildList</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Node</span> <span class="hljs-variable">n1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>(<span class="hljs-number">1</span>);
        <span class="hljs-type">Node</span> <span class="hljs-variable">n2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>(<span class="hljs-number">2</span>);
        <span class="hljs-type">Node</span> <span class="hljs-variable">n3</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>(<span class="hljs-number">3</span>);
        <span class="hljs-type">Node</span> <span class="hljs-variable">n4</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>(<span class="hljs-number">4</span>);

        n1.next = n2;
        n2.next = n3;
        n3.next = n4;

        <span class="hljs-keyword">return</span> n1;
    }

    <span class="hljs-keyword">static</span> Node <span class="hljs-title function_">delete</span><span class="hljs-params">(Node head, <span class="hljs-type">int</span> target)</span> {
        <span class="hljs-keyword">if</span> (head == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        <span class="hljs-keyword">if</span> (head.value == target) {
            <span class="hljs-keyword">return</span> head.next;
        }

        <span class="hljs-type">Node</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> head;
        <span class="hljs-keyword">while</span> (current.next != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">if</span> (current.next.value == target) {
                current.next = current.next.next;
                <span class="hljs-keyword">break</span>;
            }
            current = current.next;
        }
        <span class="hljs-keyword">return</span> head;
    }

    <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">contains</span><span class="hljs-params">(Node head, <span class="hljs-type">int</span> target)</span> {
        <span class="hljs-type">Node</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> head;
        <span class="hljs-keyword">while</span> (current != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">if</span> (current.value == target) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
            current = current.next;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-keyword">static</span> Node <span class="hljs-title function_">reverse</span><span class="hljs-params">(Node head)</span> {
        <span class="hljs-type">Node</span> <span class="hljs-variable">prev</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-type">Node</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> head;

        <span class="hljs-keyword">while</span> (current != <span class="hljs-literal">null</span>) {
            <span class="hljs-type">Node</span> <span class="hljs-variable">nextTemp</span> <span class="hljs-operator">=</span> current.next;
            current.next = prev;
            prev = current;
            current = nextTemp;
        }
        <span class="hljs-keyword">return</span> prev;
    }

    <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">printList</span><span class="hljs-params">(Node head)</span> {
        <span class="hljs-type">Node</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> head;
        <span class="hljs-keyword">while</span> (current != <span class="hljs-literal">null</span>) {
            System.out.print(current.value + <span class="hljs-string">" -&gt; "</span>);
            current = current.next;
        }
        System.out.println(<span class="hljs-string">"null"</span>);
    }
}
</code></pre>
<p>å¤åˆ¶ä¸‹é¢çš„å†…å®¹åœ¨æµè§ˆå™¨åœ°å€è®¿é—®</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">https:</span>//pythontutor.com/render.html#code=import%<span class="hljs-number">20</span>java.util.Objects%<span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">0</span>Apublic%<span class="hljs-number">20</span><span class="hljs-keyword">class</span>%<span class="hljs-number">20L</span>inkedListDemo%<span class="hljs-number">20%</span><span class="hljs-number">7</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span>//%<span class="hljs-number">20%</span>E5%<span class="hljs-number">8</span>D%<span class="hljs-number">95%</span>E9%<span class="hljs-number">93%</span>BE%E8%A1%A8%E8%<span class="hljs-number">8</span>A%<span class="hljs-number">82%</span>E7%<span class="hljs-number">82%</span>B9%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20s</span>tatic%<span class="hljs-number">20</span><span class="hljs-keyword">class</span>%<span class="hljs-number">20</span>Node%<span class="hljs-number">20%</span><span class="hljs-number">7</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20i</span>nt%<span class="hljs-number">20</span>value%<span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span>Node%<span class="hljs-number">20</span><span class="hljs-keyword">next</span>%<span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span>Node%<span class="hljs-number">28i</span>nt%<span class="hljs-number">20</span>value%<span class="hljs-number">29%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span>this.value%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">20</span>value%<span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>D%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>D%<span class="hljs-number">0</span>A%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span><span class="hljs-keyword">private</span>%<span class="hljs-number">20</span>Node%<span class="hljs-number">20</span>head%<span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span>//%<span class="hljs-number">20%</span>E5%B0%BE%E6%<span class="hljs-number">8</span>F%<span class="hljs-number">92%</span>E6%B3%<span class="hljs-number">95%</span>E6%B7%BB%E5%<span class="hljs-number">8</span>A%A0%E8%<span class="hljs-number">8</span>A%<span class="hljs-number">82%</span>E7%<span class="hljs-number">82%</span>B9%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span><span class="hljs-keyword">public</span>%<span class="hljs-number">20</span>void%<span class="hljs-number">20</span>add%<span class="hljs-number">28i</span>nt%<span class="hljs-number">20</span>value%<span class="hljs-number">29%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span>Node%<span class="hljs-number">20</span>newNode%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">20</span><span class="hljs-built_in">new</span>%<span class="hljs-number">20</span>Node%<span class="hljs-number">28</span>value%<span class="hljs-number">29%</span><span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20i</span>f%<span class="hljs-number">20%</span><span class="hljs-number">28</span>head%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">3</span>D%<span class="hljs-number">20</span>null%<span class="hljs-number">29%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span>head%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">20</span>newNode%<span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span><span class="hljs-keyword">return</span>%<span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>D%<span class="hljs-number">0</span>A%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span>Node%<span class="hljs-number">20</span>cur%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">20</span>head%<span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span><span class="hljs-keyword">while</span>%<span class="hljs-number">20%</span><span class="hljs-number">28</span>cur.<span class="hljs-keyword">next</span>%<span class="hljs-number">20</span>!%<span class="hljs-number">3</span>D%<span class="hljs-number">20</span>null%<span class="hljs-number">29%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span>cur%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">20</span>cur.<span class="hljs-keyword">next</span>%<span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>D%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span>cur.<span class="hljs-keyword">next</span>%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">20</span>newNode%<span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>D%<span class="hljs-number">0</span>A%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span>//%<span class="hljs-number">20%</span>E5%<span class="hljs-number">88%</span>A0%E9%<span class="hljs-number">99%</span>A4%E6%<span class="hljs-number">8</span>C%<span class="hljs-number">87%</span>E5%AE%<span class="hljs-number">9</span>A%E5%<span class="hljs-number">80%</span>BC%E7%<span class="hljs-number">9</span>A%<span class="hljs-number">84%</span>E8%<span class="hljs-number">8</span>A%<span class="hljs-number">82%</span>E7%<span class="hljs-number">82%</span>B9%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span><span class="hljs-keyword">public</span>%<span class="hljs-number">20</span>void%<span class="hljs-number">20</span>remove%<span class="hljs-number">28i</span>nt%<span class="hljs-number">20</span>value%<span class="hljs-number">29%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20i</span>f%<span class="hljs-number">20%</span><span class="hljs-number">28</span>head%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">3</span>D%<span class="hljs-number">20</span>null%<span class="hljs-number">29%</span><span class="hljs-number">20</span><span class="hljs-keyword">return</span>%<span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20i</span>f%<span class="hljs-number">20%</span><span class="hljs-number">28</span>head.value%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">3</span>D%<span class="hljs-number">20</span>value%<span class="hljs-number">29%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span>head%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">20</span>head.<span class="hljs-keyword">next</span>%<span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span><span class="hljs-keyword">return</span>%<span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>D%<span class="hljs-number">0</span>A%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span>Node%<span class="hljs-number">20</span>cur%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">20</span>head%<span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span><span class="hljs-keyword">while</span>%<span class="hljs-number">20%</span><span class="hljs-number">28</span>cur.<span class="hljs-keyword">next</span>%<span class="hljs-number">20</span>!%<span class="hljs-number">3</span>D%<span class="hljs-number">20</span>null%<span class="hljs-number">29%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20i</span>f%<span class="hljs-number">20%</span><span class="hljs-number">28</span>cur.<span class="hljs-keyword">next</span>.value%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">3</span>D%<span class="hljs-number">20</span>value%<span class="hljs-number">29%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span>cur.<span class="hljs-keyword">next</span>%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">20</span>cur.<span class="hljs-keyword">next</span>.<span class="hljs-keyword">next</span>%<span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span><span class="hljs-keyword">return</span>%<span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>D%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span>cur%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">20</span>cur.<span class="hljs-keyword">next</span>%<span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>D%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>D%<span class="hljs-number">0</span>A%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span>//%<span class="hljs-number">20%</span>E5%<span class="hljs-number">88%</span>A4%E6%<span class="hljs-number">96%</span>AD%E6%<span class="hljs-number">98%</span>AF%E5%<span class="hljs-number">90%</span>A6%E5%<span class="hljs-number">8</span>C%<span class="hljs-number">85%</span>E5%<span class="hljs-number">90%</span>AB%E6%<span class="hljs-number">9</span>F%<span class="hljs-number">90%</span>E4%B8%AA%E5%<span class="hljs-number">80%</span>BC%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span><span class="hljs-keyword">public</span>%<span class="hljs-number">20</span><span class="hljs-type">boolean</span>%<span class="hljs-number">20</span>contains%<span class="hljs-number">28i</span>nt%<span class="hljs-number">20</span>value%<span class="hljs-number">29%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span>Node%<span class="hljs-number">20</span>cur%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">20</span>head%<span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span><span class="hljs-keyword">while</span>%<span class="hljs-number">20%</span><span class="hljs-number">28</span>cur%<span class="hljs-number">20</span>!%<span class="hljs-number">3</span>D%<span class="hljs-number">20</span>null%<span class="hljs-number">29%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20i</span>f%<span class="hljs-number">20%</span><span class="hljs-number">28</span>Objects.<span class="hljs-keyword">equals</span>%<span class="hljs-number">28</span>cur.value,%<span class="hljs-number">20</span>value%<span class="hljs-number">29%</span><span class="hljs-number">29%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span><span class="hljs-keyword">return</span>%<span class="hljs-number">20</span><span class="hljs-literal">true</span>%<span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>D%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span>cur%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">20</span>cur.<span class="hljs-keyword">next</span>%<span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>D%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span><span class="hljs-keyword">return</span>%<span class="hljs-number">20</span><span class="hljs-literal">false</span>%<span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>D%<span class="hljs-number">0</span>A%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span>//%<span class="hljs-number">20%</span>E6%<span class="hljs-number">89%</span><span class="hljs-number">93%</span>E5%<span class="hljs-number">8</span>D%B0%E9%<span class="hljs-number">93%</span>BE%E8%A1%A8%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span><span class="hljs-keyword">public</span>%<span class="hljs-number">20</span>void%<span class="hljs-number">20</span>print%<span class="hljs-number">28%</span><span class="hljs-number">29%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span>Node%<span class="hljs-number">20</span>cur%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">20</span>head%<span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span><span class="hljs-keyword">while</span>%<span class="hljs-number">20%</span><span class="hljs-number">28</span>cur%<span class="hljs-number">20</span>!%<span class="hljs-number">3</span>D%<span class="hljs-number">20</span>null%<span class="hljs-number">29%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20S</span>ystem.out.print%<span class="hljs-number">28</span>cur.value%<span class="hljs-number">20%</span><span class="hljs-number">2</span>B%<span class="hljs-number">20%</span><span class="hljs-number">22%</span><span class="hljs-number">20</span>-%<span class="hljs-number">3</span>E%<span class="hljs-number">20%</span><span class="hljs-number">22%</span><span class="hljs-number">29%</span><span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span>cur%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">20</span>cur.<span class="hljs-keyword">next</span>%<span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>D%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20S</span>ystem.out.println%<span class="hljs-number">28%</span><span class="hljs-number">22</span>null%<span class="hljs-number">22%</span><span class="hljs-number">29%</span><span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>D%<span class="hljs-number">0</span>A%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span>//%<span class="hljs-number">20%</span>E5%<span class="hljs-number">8</span>F%<span class="hljs-number">8</span>D%E8%BD%AC%E9%<span class="hljs-number">93%</span>BE%E8%A1%A8%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span><span class="hljs-keyword">public</span>%<span class="hljs-number">20</span>void%<span class="hljs-number">20</span>reverse%<span class="hljs-number">28%</span><span class="hljs-number">29%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span>Node%<span class="hljs-number">20</span>prev%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">20</span>null%<span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span>Node%<span class="hljs-number">20</span>cur%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">20</span>head%<span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span><span class="hljs-keyword">while</span>%<span class="hljs-number">20%</span><span class="hljs-number">28</span>cur%<span class="hljs-number">20</span>!%<span class="hljs-number">3</span>D%<span class="hljs-number">20</span>null%<span class="hljs-number">29%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span>Node%<span class="hljs-number">20</span>nextTemp%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">20</span>cur.<span class="hljs-keyword">next</span>%<span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span>cur.<span class="hljs-keyword">next</span>%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">20</span>prev%<span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span>prev%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">20</span>cur%<span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span>cur%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">20</span>nextTemp%<span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>D%<span class="hljs-number">0</span>A%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span>head%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">20</span>prev%<span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>D%<span class="hljs-number">0</span>A%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span>//%<span class="hljs-number">20%</span>E6%B5%<span class="hljs-number">8</span>B%E8%AF%<span class="hljs-number">95%</span>E5%<span class="hljs-number">85%</span>A5%E5%<span class="hljs-number">8</span>F%A3%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span><span class="hljs-keyword">public</span>%<span class="hljs-number">20s</span>tatic%<span class="hljs-number">20</span>void%<span class="hljs-number">20</span>main%<span class="hljs-number">28S</span>tring%<span class="hljs-number">5</span>B%<span class="hljs-number">5</span>D%<span class="hljs-number">20</span>args%<span class="hljs-number">29%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20L</span>inkedListDemo%<span class="hljs-number">20l</span>ist%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">20</span><span class="hljs-built_in">new</span>%<span class="hljs-number">20L</span>inkedListDemo%<span class="hljs-number">28%</span><span class="hljs-number">29%</span><span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20l</span>ist.add%<span class="hljs-number">281%</span><span class="hljs-number">29%</span><span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20l</span>ist.add%<span class="hljs-number">282%</span><span class="hljs-number">29%</span><span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20l</span>ist.add%<span class="hljs-number">283%</span><span class="hljs-number">29%</span><span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20l</span>ist.add%<span class="hljs-number">284%</span><span class="hljs-number">29%</span><span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20S</span>ystem.out.println%<span class="hljs-number">28%</span><span class="hljs-number">22%</span>E5%<span class="hljs-number">8</span>E%<span class="hljs-number">9</span>F%E5%A7%<span class="hljs-number">8</span>B%E9%<span class="hljs-number">93%</span>BE%E8%A1%A8%<span class="hljs-number">3</span>A%<span class="hljs-number">22%</span><span class="hljs-number">29%</span><span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20l</span>ist.print%<span class="hljs-number">28%</span><span class="hljs-number">29%</span><span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20S</span>ystem.out.println%<span class="hljs-number">28%</span><span class="hljs-number">22%</span>E5%<span class="hljs-number">88%</span>A0%E9%<span class="hljs-number">99%</span>A4%<span class="hljs-number">202%</span><span class="hljs-number">3</span>A%<span class="hljs-number">22%</span><span class="hljs-number">29%</span><span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20l</span>ist.remove%<span class="hljs-number">282%</span><span class="hljs-number">29%</span><span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20l</span>ist.print%<span class="hljs-number">28%</span><span class="hljs-number">29%</span><span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20S</span>ystem.out.println%<span class="hljs-number">28%</span><span class="hljs-number">22%</span>E6%<span class="hljs-number">98%</span>AF%E5%<span class="hljs-number">90%</span>A6%E5%<span class="hljs-number">8</span>C%<span class="hljs-number">85%</span>E5%<span class="hljs-number">90%</span>AB%<span class="hljs-number">203%</span><span class="hljs-number">3</span>A%<span class="hljs-number">20%</span><span class="hljs-number">22%</span><span class="hljs-number">20%</span><span class="hljs-number">2</span>B%<span class="hljs-number">20l</span>ist.contains%<span class="hljs-number">283%</span><span class="hljs-number">29%</span><span class="hljs-number">29%</span><span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20S</span>ystem.out.println%<span class="hljs-number">28%</span><span class="hljs-number">22%</span>E6%<span class="hljs-number">98%</span>AF%E5%<span class="hljs-number">90%</span>A6%E5%<span class="hljs-number">8</span>C%<span class="hljs-number">85%</span>E5%<span class="hljs-number">90%</span>AB%<span class="hljs-number">205%</span><span class="hljs-number">3</span>A%<span class="hljs-number">20%</span><span class="hljs-number">22%</span><span class="hljs-number">20%</span><span class="hljs-number">2</span>B%<span class="hljs-number">20l</span>ist.contains%<span class="hljs-number">285%</span><span class="hljs-number">29%</span><span class="hljs-number">29%</span><span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20S</span>ystem.out.println%<span class="hljs-number">28%</span><span class="hljs-number">22%</span>E5%<span class="hljs-number">8</span>F%<span class="hljs-number">8</span>D%E8%BD%AC%E9%<span class="hljs-number">93%</span>BE%E8%A1%A8%<span class="hljs-number">3</span>A%<span class="hljs-number">22%</span><span class="hljs-number">29%</span><span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20l</span>ist.reverse%<span class="hljs-number">28%</span><span class="hljs-number">29%</span><span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20l</span>ist.print%<span class="hljs-number">28%</span><span class="hljs-number">29%</span><span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>D%<span class="hljs-number">0</span>A%<span class="hljs-number">7</span>D&amp;cumulative=<span class="hljs-literal">false</span>&amp;curInstr=<span class="hljs-number">0&amp;</span>heapPrimitives=nevernest&amp;mode=display&amp;origin=opt-frontend.js&amp;py=java&amp;rawInputLstJSON=%<span class="hljs-number">5</span>B%<span class="hljs-number">5</span>D&amp;textReferences=<span class="hljs-literal">false</span>
</code></pre>
<h3 data-id="heading-4">Java ä¸­çš„ try catch finally ç¤ºä¾‹</h3>
<p>è¿™ä¸ªç¤ºä¾‹é€‚åˆç”¨æ¥è§‚å¯Ÿå¼‚å¸¸å‘ç”Ÿæ—¶æ§åˆ¶æµçš„å˜åŒ–ï¼Œä»¥åŠ finally ä»£ç å—ä¸€å®šä¼šè¢«æ‰§è¡Œçš„ç‰¹æ€§ã€‚</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">TryCatchDemo</span> {

    <span class="hljs-comment">// æ¨¡æ‹Ÿä¸€ä¸ªéœ€è¦æ‰‹åŠ¨é‡Šæ”¾çš„èµ„æº</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">FakeResource</span> {
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">open</span>()</span> {
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"èµ„æºå·²æ‰“å¼€"</span>);
        }

        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">use</span>()</span> {
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"æ­£åœ¨ä½¿ç”¨èµ„æº"</span>);
            <span class="hljs-comment">// äººä¸ºåˆ¶é€ å¼‚å¸¸</span>
            <span class="hljs-built_in">int</span> x = <span class="hljs-number">10</span> / <span class="hljs-number">0</span>;
        }

        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">close</span>()</span> {
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"èµ„æºå·²é‡Šæ”¾"</span>);
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>)</span> {
        FakeResource resource = <span class="hljs-keyword">new</span> FakeResource();

        <span class="hljs-keyword">try</span> {
            resource.open();
            resource.use();
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"è¿™è¡Œä»£ç ä¸ä¼šè¢«æ‰§è¡Œ"</span>);
        } <span class="hljs-keyword">catch</span> (ArithmeticException e) {
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"æ•è·åˆ°å¼‚å¸¸: "</span> + e.getMessage());
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-comment">// æ— è®ºæ˜¯å¦å‘ç”Ÿå¼‚å¸¸ï¼Œéƒ½ä¼šæ‰§è¡Œ</span>
            resource.close();
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"finally å—æ‰§è¡Œå®Œæˆ"</span>);
        }
    }
}
</code></pre>
<p>åœ¨ PythonTutor ä¸­å¯ä»¥æ¸…æ¥šçœ‹åˆ°ï¼š</p>
<ul>
<li>å¼‚å¸¸å‘ç”Ÿåç›´æ¥è·³è½¬åˆ° catch</li>
<li>try ä¸­å‰©ä½™ä»£ç ä¸å†æ‰§è¡Œ</li>
<li>finally å§‹ç»ˆä¼šè¢«æ‰§è¡Œ</li>
</ul>
<p>å¤åˆ¶ä¸‹é¢çš„å†…å®¹åœ¨æµè§ˆå™¨åœ°å€è®¿é—®</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">https:</span>//pythontutor.com/render.html#code=<span class="hljs-keyword">public</span>%<span class="hljs-number">20</span><span class="hljs-keyword">class</span>%<span class="hljs-number">20</span>TryCatchDemo%<span class="hljs-number">20%</span><span class="hljs-number">7</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span>//%<span class="hljs-number">20%</span>E6%A8%A1%E6%<span class="hljs-number">8</span>B%<span class="hljs-number">9</span>F%E4%B8%<span class="hljs-number">80%</span>E4%B8%AA%E9%<span class="hljs-number">9</span>C%<span class="hljs-number">80%</span>E8%A6%<span class="hljs-number">81%</span>E6%<span class="hljs-number">89%</span><span class="hljs-number">8</span>B%E5%<span class="hljs-number">8</span>A%A8%E9%<span class="hljs-number">87%</span><span class="hljs-number">8</span>A%E6%<span class="hljs-number">94%</span>BE%E7%<span class="hljs-number">9</span>A%<span class="hljs-number">84%</span>E8%B5%<span class="hljs-number">84%</span>E6%BA%<span class="hljs-number">90%</span><span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20s</span>tatic%<span class="hljs-number">20</span><span class="hljs-keyword">class</span>%<span class="hljs-number">20</span>FakeResource%<span class="hljs-number">20%</span><span class="hljs-number">7</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span>void%<span class="hljs-number">20</span>open%<span class="hljs-number">28%</span><span class="hljs-number">29%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20S</span>ystem.out.println%<span class="hljs-number">28%</span><span class="hljs-number">22%</span>E8%B5%<span class="hljs-number">84%</span>E6%BA%<span class="hljs-number">90%</span>E5%B7%B2%E6%<span class="hljs-number">89%</span><span class="hljs-number">93%</span>E5%BC%<span class="hljs-number">80%</span><span class="hljs-number">22%</span><span class="hljs-number">29%</span><span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>D%<span class="hljs-number">0</span>A%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span>void%<span class="hljs-number">20us</span>e%<span class="hljs-number">28%</span><span class="hljs-number">29%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20S</span>ystem.out.println%<span class="hljs-number">28%</span><span class="hljs-number">22%</span>E6%AD%A3%E5%<span class="hljs-number">9</span>C%A8%E4%BD%BF%E7%<span class="hljs-number">94%</span>A8%E8%B5%<span class="hljs-number">84%</span>E6%BA%<span class="hljs-number">90%</span><span class="hljs-number">22%</span><span class="hljs-number">29%</span><span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span>//%<span class="hljs-number">20%</span>E4%BA%BA%E4%B8%BA%E5%<span class="hljs-number">88%</span>B6%E9%<span class="hljs-number">80%</span>A0%E5%BC%<span class="hljs-number">82%</span>E5%B8%B8%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20i</span>nt%<span class="hljs-number">20</span>x%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">2010%</span><span class="hljs-number">20</span>/%<span class="hljs-number">200%</span><span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>D%<span class="hljs-number">0</span>A%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span>void%<span class="hljs-number">20</span>close%<span class="hljs-number">28%</span><span class="hljs-number">29%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20S</span>ystem.out.println%<span class="hljs-number">28%</span><span class="hljs-number">22%</span>E8%B5%<span class="hljs-number">84%</span>E6%BA%<span class="hljs-number">90%</span>E5%B7%B2%E9%<span class="hljs-number">87%</span><span class="hljs-number">8</span>A%E6%<span class="hljs-number">94%</span>BE%<span class="hljs-number">22%</span><span class="hljs-number">29%</span><span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>D%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>D%<span class="hljs-number">0</span>A%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span><span class="hljs-keyword">public</span>%<span class="hljs-number">20s</span>tatic%<span class="hljs-number">20</span>void%<span class="hljs-number">20</span>main%<span class="hljs-number">28S</span>tring%<span class="hljs-number">5</span>B%<span class="hljs-number">5</span>D%<span class="hljs-number">20</span>args%<span class="hljs-number">29%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span>FakeResource%<span class="hljs-number">20</span>resource%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">20</span><span class="hljs-built_in">new</span>%<span class="hljs-number">20</span>FakeResource%<span class="hljs-number">28%</span><span class="hljs-number">29%</span><span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span><span class="hljs-keyword">try</span>%<span class="hljs-number">20%</span><span class="hljs-number">7</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span>resource.open%<span class="hljs-number">28%</span><span class="hljs-number">29%</span><span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span>resource.use%<span class="hljs-number">28%</span><span class="hljs-number">29%</span><span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20S</span>ystem.out.println%<span class="hljs-number">28%</span><span class="hljs-number">22%</span>E8%BF%<span class="hljs-number">99%</span>E8%A1%<span class="hljs-number">8</span>C%E4%BB%A3%E7%A0%<span class="hljs-number">81%</span>E4%B8%<span class="hljs-number">8</span>D%E4%BC%<span class="hljs-number">9</span>A%E8%A2%AB%E6%<span class="hljs-number">89%</span>A7%E8%A1%<span class="hljs-number">8</span>C%<span class="hljs-number">22%</span><span class="hljs-number">29%</span><span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>D%<span class="hljs-number">20</span><span class="hljs-keyword">catch</span>%<span class="hljs-number">20%</span><span class="hljs-number">28</span>ArithmeticException%<span class="hljs-number">20</span>e%<span class="hljs-number">29%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20S</span>ystem.out.println%<span class="hljs-number">28%</span><span class="hljs-number">22%</span>E6%<span class="hljs-number">8</span>D%<span class="hljs-number">95%</span>E8%<span class="hljs-number">8</span>E%B7%E5%<span class="hljs-number">88%</span>B0%E5%BC%<span class="hljs-number">82%</span>E5%B8%B8%<span class="hljs-number">3</span>A%<span class="hljs-number">20%</span><span class="hljs-number">22%</span><span class="hljs-number">20%</span><span class="hljs-number">2</span>B%<span class="hljs-number">20</span>e.getMessage%<span class="hljs-number">28%</span><span class="hljs-number">29%</span><span class="hljs-number">29%</span><span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>D%<span class="hljs-number">20</span><span class="hljs-keyword">finally</span>%<span class="hljs-number">20%</span><span class="hljs-number">7</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span>//%<span class="hljs-number">20%</span>E6%<span class="hljs-number">97%</span>A0%E8%AE%BA%E6%<span class="hljs-number">98%</span>AF%E5%<span class="hljs-number">90%</span>A6%E5%<span class="hljs-number">8</span>F%<span class="hljs-number">91%</span>E7%<span class="hljs-number">94%</span><span class="hljs-number">9</span>F%E5%BC%<span class="hljs-number">82%</span>E5%B8%B8%EF%BC%<span class="hljs-number">8</span>C%E9%<span class="hljs-number">83%</span>BD%E4%BC%<span class="hljs-number">9</span>A%E6%<span class="hljs-number">89%</span>A7%E8%A1%<span class="hljs-number">8</span>C%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span>resource.close%<span class="hljs-number">28%</span><span class="hljs-number">29%</span><span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20S</span>ystem.out.println%<span class="hljs-number">28%</span><span class="hljs-number">22</span><span class="hljs-keyword">finally</span>%<span class="hljs-number">20%</span>E5%<span class="hljs-number">9</span>D%<span class="hljs-number">97%</span>E6%<span class="hljs-number">89%</span>A7%E8%A1%<span class="hljs-number">8</span>C%E5%AE%<span class="hljs-number">8</span>C%E6%<span class="hljs-number">88%</span><span class="hljs-number">90%</span><span class="hljs-number">22%</span><span class="hljs-number">29%</span><span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>D%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>D%<span class="hljs-number">0</span>A%<span class="hljs-number">7</span>D&amp;cumulative=<span class="hljs-literal">false</span>&amp;curInstr=<span class="hljs-number">0&amp;</span>heapPrimitives=nevernest&amp;mode=display&amp;origin=opt-frontend.js&amp;py=java&amp;rawInputLstJSON=%<span class="hljs-number">5</span>B%<span class="hljs-number">5</span>D&amp;textReferences=<span class="hljs-literal">false</span>
</code></pre>
<hr/>
<h3 data-id="heading-5">Java ä¸­çš„ switch case ï¼ˆå‘½ä¸­ç©¿é€ï¼‰ç¤ºä¾‹</h3>
<p>ä¸‹é¢è¿™ä¸ªç¤ºä¾‹å°† break åˆ é™¤äº†ï¼Œé€‚åˆè§‚å¯Ÿåˆ†æ”¯åŒ¹é…å’Œ break å¯¹æµç¨‹çš„å½±å“ã€‚</p>
<pre><code class="hljs language-csharp" lang="csharp">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SwitchDemo</span> {

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>)</span> {
            <span class="hljs-built_in">int</span> day = <span class="hljs-number">1</span>;

            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"day = "</span> + day);
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"å¼€å§‹æ‰§è¡Œ switch"</span>);

            <span class="hljs-keyword">switch</span> (day) {
                <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:
                    System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"å‘½ä¸­ case 1ï¼šæ˜ŸæœŸä¸€"</span>);
                    <span class="hljs-comment">// break;</span>
                <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:
                    System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"å‘½ä¸­ case 2ï¼šæ˜ŸæœŸäºŒ"</span>);
                    <span class="hljs-comment">// break;</span>
                <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:
                    System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"å‘½ä¸­ case 3ï¼šæ˜ŸæœŸä¸‰"</span>);
                    <span class="hljs-comment">// break;</span>
                <span class="hljs-literal">default</span>:
                    System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"å‘½ä¸­ defaultï¼šæœªçŸ¥æ—¥æœŸ"</span>);
                    <span class="hljs-comment">// break;</span>
            }

            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"switch æ‰§è¡Œç»“æŸ"</span>);
        }
    }
</code></pre>
<p>é€šè¿‡å¯è§†åŒ–å¯ä»¥çœ‹åˆ°ï¼š</p>
<ul>
<li>switch è¡¨è¾¾å¼åªè®¡ç®—ä¸€æ¬¡</li>
<li>ç¬¬ä¸€ä¸ªåŒ¹é…çš„ case å°±ä¼šè¢«æ‰§è¡Œ</li>
<li>ç¼ºå°‘break ä¼šå¯¼è‡´å‘½ä¸­ç©¿é€ã€‚</li>
</ul>
<p>å¤åˆ¶ä¸‹é¢çš„å†…å®¹åœ¨æµè§ˆå™¨åœ°å€è®¿é—®</p>
<pre><code class="hljs language-sql" lang="sql">https:<span class="hljs-operator">/</span><span class="hljs-operator">/</span>pythontutor.com<span class="hljs-operator">/</span>render.html#code<span class="hljs-operator">=</span>public<span class="hljs-operator">%</span><span class="hljs-number">20</span>class<span class="hljs-operator">%</span><span class="hljs-number">20</span>SwitchDemo<span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">7</span>B<span class="hljs-operator">%</span><span class="hljs-number">0</span>A<span class="hljs-operator">%</span><span class="hljs-number">0</span>A<span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span>public<span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-keyword">static</span><span class="hljs-operator">%</span><span class="hljs-number">20</span>void<span class="hljs-operator">%</span><span class="hljs-number">20</span>main<span class="hljs-operator">%</span><span class="hljs-number">28</span>String<span class="hljs-operator">%</span><span class="hljs-number">5</span>B<span class="hljs-operator">%</span><span class="hljs-number">5</span>D<span class="hljs-operator">%</span><span class="hljs-number">20</span>args<span class="hljs-operator">%</span><span class="hljs-number">29</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">7</span>B<span class="hljs-operator">%</span><span class="hljs-number">0</span>A<span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-type">int</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-keyword">day</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">3</span>D<span class="hljs-operator">%</span><span class="hljs-number">201</span><span class="hljs-operator">%</span><span class="hljs-number">3</span>B<span class="hljs-operator">%</span><span class="hljs-number">0</span>A<span class="hljs-operator">%</span><span class="hljs-number">0</span>A<span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span>System.out.println<span class="hljs-operator">%</span><span class="hljs-number">28</span><span class="hljs-operator">%</span><span class="hljs-number">22</span><span class="hljs-keyword">day</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">3</span>D<span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">22</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">2</span>B<span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-keyword">day</span><span class="hljs-operator">%</span><span class="hljs-number">29</span><span class="hljs-operator">%</span><span class="hljs-number">3</span>B<span class="hljs-operator">%</span><span class="hljs-number">0</span>A<span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span>System.out.println<span class="hljs-operator">%</span><span class="hljs-number">28</span><span class="hljs-operator">%</span><span class="hljs-number">22</span><span class="hljs-operator">%</span>E5<span class="hljs-operator">%</span>BC<span class="hljs-operator">%</span><span class="hljs-number">80</span><span class="hljs-operator">%</span>E5<span class="hljs-operator">%</span>A7<span class="hljs-operator">%</span><span class="hljs-number">8</span>B<span class="hljs-operator">%</span>E6<span class="hljs-operator">%</span><span class="hljs-number">89</span><span class="hljs-operator">%</span>A7<span class="hljs-operator">%</span>E8<span class="hljs-operator">%</span>A1<span class="hljs-operator">%</span><span class="hljs-number">8</span>C<span class="hljs-operator">%</span><span class="hljs-number">20</span>switch<span class="hljs-operator">%</span><span class="hljs-number">22</span><span class="hljs-operator">%</span><span class="hljs-number">29</span><span class="hljs-operator">%</span><span class="hljs-number">3</span>B<span class="hljs-operator">%</span><span class="hljs-number">0</span>A<span class="hljs-operator">%</span><span class="hljs-number">0</span>A<span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span>switch<span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">28</span><span class="hljs-keyword">day</span><span class="hljs-operator">%</span><span class="hljs-number">29</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">7</span>B<span class="hljs-operator">%</span><span class="hljs-number">0</span>A<span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-keyword">case</span><span class="hljs-operator">%</span><span class="hljs-number">201</span><span class="hljs-operator">%</span><span class="hljs-number">3</span>A<span class="hljs-operator">%</span><span class="hljs-number">0</span>A<span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span>System.out.println<span class="hljs-operator">%</span><span class="hljs-number">28</span><span class="hljs-operator">%</span><span class="hljs-number">22</span><span class="hljs-operator">%</span>E5<span class="hljs-operator">%</span><span class="hljs-number">91</span><span class="hljs-operator">%</span>BD<span class="hljs-operator">%</span>E4<span class="hljs-operator">%</span>B8<span class="hljs-operator">%</span>AD<span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-keyword">case</span><span class="hljs-operator">%</span><span class="hljs-number">201</span><span class="hljs-operator">%</span>EF<span class="hljs-operator">%</span>BC<span class="hljs-operator">%</span><span class="hljs-number">9</span>A<span class="hljs-operator">%</span>E6<span class="hljs-operator">%</span><span class="hljs-number">98</span><span class="hljs-operator">%</span><span class="hljs-number">9</span>F<span class="hljs-operator">%</span>E6<span class="hljs-operator">%</span><span class="hljs-number">9</span>C<span class="hljs-operator">%</span><span class="hljs-number">9</span>F<span class="hljs-operator">%</span>E4<span class="hljs-operator">%</span>B8<span class="hljs-operator">%</span><span class="hljs-number">80</span><span class="hljs-operator">%</span><span class="hljs-number">22</span><span class="hljs-operator">%</span><span class="hljs-number">29</span><span class="hljs-operator">%</span><span class="hljs-number">3</span>B<span class="hljs-operator">%</span><span class="hljs-number">0</span>A<span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-operator">%</span><span class="hljs-number">20</span>break<span class="hljs-operator">%</span><span class="hljs-number">3</span>B<span class="hljs-operator">%</span><span class="hljs-number">0</span>A<span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-keyword">case</span><span class="hljs-operator">%</span><span class="hljs-number">202</span><span class="hljs-operator">%</span><span class="hljs-number">3</span>A<span class="hljs-operator">%</span><span class="hljs-number">0</span>A<span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span>System.out.println<span class="hljs-operator">%</span><span class="hljs-number">28</span><span class="hljs-operator">%</span><span class="hljs-number">22</span><span class="hljs-operator">%</span>E5<span class="hljs-operator">%</span><span class="hljs-number">91</span><span class="hljs-operator">%</span>BD<span class="hljs-operator">%</span>E4<span class="hljs-operator">%</span>B8<span class="hljs-operator">%</span>AD<span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-keyword">case</span><span class="hljs-operator">%</span><span class="hljs-number">202</span><span class="hljs-operator">%</span>EF<span class="hljs-operator">%</span>BC<span class="hljs-operator">%</span><span class="hljs-number">9</span>A<span class="hljs-operator">%</span>E6<span class="hljs-operator">%</span><span class="hljs-number">98</span><span class="hljs-operator">%</span><span class="hljs-number">9</span>F<span class="hljs-operator">%</span>E6<span class="hljs-operator">%</span><span class="hljs-number">9</span>C<span class="hljs-operator">%</span><span class="hljs-number">9</span>F<span class="hljs-operator">%</span>E4<span class="hljs-operator">%</span>BA<span class="hljs-operator">%</span><span class="hljs-number">8</span>C<span class="hljs-operator">%</span><span class="hljs-number">22</span><span class="hljs-operator">%</span><span class="hljs-number">29</span><span class="hljs-operator">%</span><span class="hljs-number">3</span>B<span class="hljs-operator">%</span><span class="hljs-number">0</span>A<span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-operator">%</span><span class="hljs-number">20</span>break<span class="hljs-operator">%</span><span class="hljs-number">3</span>B<span class="hljs-operator">%</span><span class="hljs-number">0</span>A<span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-keyword">case</span><span class="hljs-operator">%</span><span class="hljs-number">203</span><span class="hljs-operator">%</span><span class="hljs-number">3</span>A<span class="hljs-operator">%</span><span class="hljs-number">0</span>A<span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span>System.out.println<span class="hljs-operator">%</span><span class="hljs-number">28</span><span class="hljs-operator">%</span><span class="hljs-number">22</span><span class="hljs-operator">%</span>E5<span class="hljs-operator">%</span><span class="hljs-number">91</span><span class="hljs-operator">%</span>BD<span class="hljs-operator">%</span>E4<span class="hljs-operator">%</span>B8<span class="hljs-operator">%</span>AD<span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-keyword">case</span><span class="hljs-operator">%</span><span class="hljs-number">203</span><span class="hljs-operator">%</span>EF<span class="hljs-operator">%</span>BC<span class="hljs-operator">%</span><span class="hljs-number">9</span>A<span class="hljs-operator">%</span>E6<span class="hljs-operator">%</span><span class="hljs-number">98</span><span class="hljs-operator">%</span><span class="hljs-number">9</span>F<span class="hljs-operator">%</span>E6<span class="hljs-operator">%</span><span class="hljs-number">9</span>C<span class="hljs-operator">%</span><span class="hljs-number">9</span>F<span class="hljs-operator">%</span>E4<span class="hljs-operator">%</span>B8<span class="hljs-operator">%</span><span class="hljs-number">89</span><span class="hljs-operator">%</span><span class="hljs-number">22</span><span class="hljs-operator">%</span><span class="hljs-number">29</span><span class="hljs-operator">%</span><span class="hljs-number">3</span>B<span class="hljs-operator">%</span><span class="hljs-number">0</span>A<span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-operator">%</span><span class="hljs-number">20</span>break<span class="hljs-operator">%</span><span class="hljs-number">3</span>B<span class="hljs-operator">%</span><span class="hljs-number">0</span>A<span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-keyword">default</span><span class="hljs-operator">%</span><span class="hljs-number">3</span>A<span class="hljs-operator">%</span><span class="hljs-number">0</span>A<span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span>System.out.println<span class="hljs-operator">%</span><span class="hljs-number">28</span><span class="hljs-operator">%</span><span class="hljs-number">22</span><span class="hljs-operator">%</span>E5<span class="hljs-operator">%</span><span class="hljs-number">91</span><span class="hljs-operator">%</span>BD<span class="hljs-operator">%</span>E4<span class="hljs-operator">%</span>B8<span class="hljs-operator">%</span>AD<span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-keyword">default</span><span class="hljs-operator">%</span>EF<span class="hljs-operator">%</span>BC<span class="hljs-operator">%</span><span class="hljs-number">9</span>A<span class="hljs-operator">%</span>E6<span class="hljs-operator">%</span><span class="hljs-number">9</span>C<span class="hljs-operator">%</span>AA<span class="hljs-operator">%</span>E7<span class="hljs-operator">%</span><span class="hljs-number">9</span>F<span class="hljs-operator">%</span>A5<span class="hljs-operator">%</span>E6<span class="hljs-operator">%</span><span class="hljs-number">97</span><span class="hljs-operator">%</span>A5<span class="hljs-operator">%</span>E6<span class="hljs-operator">%</span><span class="hljs-number">9</span>C<span class="hljs-operator">%</span><span class="hljs-number">9</span>F<span class="hljs-operator">%</span><span class="hljs-number">22</span><span class="hljs-operator">%</span><span class="hljs-number">29</span><span class="hljs-operator">%</span><span class="hljs-number">3</span>B<span class="hljs-operator">%</span><span class="hljs-number">0</span>A<span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-operator">%</span><span class="hljs-number">20</span>break<span class="hljs-operator">%</span><span class="hljs-number">3</span>B<span class="hljs-operator">%</span><span class="hljs-number">0</span>A<span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">7</span>D<span class="hljs-operator">%</span><span class="hljs-number">0</span>A<span class="hljs-operator">%</span><span class="hljs-number">0</span>A<span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span>System.out.println<span class="hljs-operator">%</span><span class="hljs-number">28</span><span class="hljs-operator">%</span><span class="hljs-number">22</span>switch<span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span>E6<span class="hljs-operator">%</span><span class="hljs-number">89</span><span class="hljs-operator">%</span>A7<span class="hljs-operator">%</span>E8<span class="hljs-operator">%</span>A1<span class="hljs-operator">%</span><span class="hljs-number">8</span>C<span class="hljs-operator">%</span>E7<span class="hljs-operator">%</span>BB<span class="hljs-operator">%</span><span class="hljs-number">93</span><span class="hljs-operator">%</span>E6<span class="hljs-operator">%</span><span class="hljs-number">9</span>D<span class="hljs-operator">%</span><span class="hljs-number">9</span>F<span class="hljs-operator">%</span><span class="hljs-number">22</span><span class="hljs-operator">%</span><span class="hljs-number">29</span><span class="hljs-operator">%</span><span class="hljs-number">3</span>B<span class="hljs-operator">%</span><span class="hljs-number">0</span>A<span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">20</span><span class="hljs-operator">%</span><span class="hljs-number">7</span>D<span class="hljs-operator">%</span><span class="hljs-number">0</span>A<span class="hljs-operator">%</span><span class="hljs-number">7</span>D<span class="hljs-operator">&amp;</span>cumulative<span class="hljs-operator">=</span><span class="hljs-literal">false</span><span class="hljs-operator">&amp;</span>curInstr<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-operator">&amp;</span>heapPrimitives<span class="hljs-operator">=</span>nevernest<span class="hljs-operator">&amp;</span>mode<span class="hljs-operator">=</span>display<span class="hljs-operator">&amp;</span>origin<span class="hljs-operator">=</span>opt<span class="hljs-operator">-</span>frontend.js<span class="hljs-operator">&amp;</span>py<span class="hljs-operator">=</span>java<span class="hljs-operator">&amp;</span>rawInputLstJSON<span class="hljs-operator">=</span><span class="hljs-operator">%</span><span class="hljs-number">5</span>B<span class="hljs-operator">%</span><span class="hljs-number">5</span>D<span class="hljs-operator">&amp;</span>textReferences<span class="hljs-operator">=</span><span class="hljs-literal">false</span>
</code></pre>
<hr/>
<h3 data-id="heading-6">while å¾ªç¯ä¸ continueã€break ç¤ºä¾‹</h3>
<p>è¿™ä¸ªç¤ºä¾‹éå¸¸é€‚åˆåœ¨ PythonTutor ä¸­è§‚å¯Ÿå¾ªç¯å˜é‡çš„å˜åŒ–ï¼Œä»¥åŠ continue å’Œ break å¯¹æµç¨‹çš„å½±å“ã€‚</p>
<pre><code class="hljs language-arduino" lang="arduino">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WhileDemo</span> {

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">String</span>[] args)</span> </span>{
            <span class="hljs-type">int</span> i = <span class="hljs-number">0</span>;

            <span class="hljs-keyword">while</span> (i &lt; <span class="hljs-number">5</span>) {
                i++;

                <span class="hljs-keyword">if</span> (i == <span class="hljs-number">2</span>) {
                    <span class="hljs-keyword">continue</span>;
                }

                <span class="hljs-keyword">if</span> (i == <span class="hljs-number">4</span>) {
                    <span class="hljs-keyword">break</span>;
                }

                System.out.<span class="hljs-built_in">println</span>(<span class="hljs-string">"å½“å‰ i = "</span> + i);
            }
        }
    }
</code></pre>
<p>åœ¨å¯è§†åŒ–è¿‡ç¨‹ä¸­å¯ä»¥çœ‹åˆ°ï¼š</p>
<ul>
<li>continue ä¼šè·³è¿‡æœ¬è½®å¾ªç¯å‰©ä½™ä»£ç </li>
<li>break ä¼šç›´æ¥è·³å‡ºæ•´ä¸ªå¾ªç¯</li>
<li>i çš„å˜åŒ–è¿‡ç¨‹æ¸…æ™°å¯è§</li>
</ul>

<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">https:</span>//pythontutor.com/render.html#code=<span class="hljs-keyword">public</span>%<span class="hljs-number">20</span><span class="hljs-keyword">class</span>%<span class="hljs-number">20</span>WhileDemo%<span class="hljs-number">20%</span><span class="hljs-number">7</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span><span class="hljs-keyword">public</span>%<span class="hljs-number">20s</span>tatic%<span class="hljs-number">20</span>void%<span class="hljs-number">20</span>main%<span class="hljs-number">28S</span>tring%<span class="hljs-number">5</span>B%<span class="hljs-number">5</span>D%<span class="hljs-number">20</span>args%<span class="hljs-number">29%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20i</span>nt%<span class="hljs-number">20i</span>%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">200%</span><span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span><span class="hljs-keyword">while</span>%<span class="hljs-number">20%</span><span class="hljs-number">28i</span>%<span class="hljs-number">20%</span><span class="hljs-number">3</span>C%<span class="hljs-number">205%</span><span class="hljs-number">29%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20i</span>%<span class="hljs-number">2</span>B%<span class="hljs-number">2</span>B%<span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20i</span>f%<span class="hljs-number">20%</span><span class="hljs-number">28i</span>%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">3</span>D%<span class="hljs-number">202%</span><span class="hljs-number">29%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span><span class="hljs-keyword">continue</span>%<span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>D%<span class="hljs-number">0</span>A%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20i</span>f%<span class="hljs-number">20%</span><span class="hljs-number">28i</span>%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">3</span>D%<span class="hljs-number">204%</span><span class="hljs-number">29%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20</span>break%<span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>D%<span class="hljs-number">0</span>A%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20S</span>ystem.out.println%<span class="hljs-number">28%</span><span class="hljs-number">22%</span>E5%BD%<span class="hljs-number">93%</span>E5%<span class="hljs-number">89%</span><span class="hljs-number">8</span>D%<span class="hljs-number">20i</span>%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">20%</span><span class="hljs-number">22%</span><span class="hljs-number">20%</span><span class="hljs-number">2</span>B%<span class="hljs-number">20i</span>%<span class="hljs-number">29%</span><span class="hljs-number">3</span>B%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>D%<span class="hljs-number">0</span>A%<span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">20%</span><span class="hljs-number">7</span>D%<span class="hljs-number">0</span>A%<span class="hljs-number">7</span>D&amp;cumulative=<span class="hljs-literal">false</span>&amp;curInstr=<span class="hljs-number">0&amp;</span>heapPrimitives=nevernest&amp;mode=display&amp;origin=opt-frontend.js&amp;py=java&amp;rawInputLstJSON=%<span class="hljs-number">5</span>B%<span class="hljs-number">5</span>D&amp;textReferences=<span class="hljs-literal">false</span>
</code></pre>
<hr/>
<h3 data-id="heading-7">Python ä¸­çš„å˜é‡å¼•ç”¨ç¤ºä¾‹</h3>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªå¯ä»¥ç›´æ¥è¿è¡Œçš„ Python ç¤ºä¾‹ï¼Œç”¨äºç†è§£å˜é‡å’Œå¯¹è±¡ä¹‹é—´çš„å…³ç³»ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a1fd3fb4232544e19b72e4ae4e82f81f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgcGU3ZXI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769847968&amp;x-signature=vIOfQFqi5nAE9%2F2VPiQAgpDPA5Q%3D" alt="python è™šæ‹ŸåŒ–.gif" loading="lazy"/></p>
<pre><code class="hljs language-scss" lang="scss">    <span class="hljs-selector-tag">a</span> = <span class="hljs-selector-attr">[1, 2, 3]</span>
    <span class="hljs-selector-tag">b</span> = <span class="hljs-selector-tag">a</span>

    <span class="hljs-built_in">print</span>("a:", a)
    <span class="hljs-built_in">print</span>("b:", b)

    <span class="hljs-selector-tag">b</span><span class="hljs-selector-class">.append</span>(<span class="hljs-number">4</span>)

    <span class="hljs-built_in">print</span>("ä¿®æ”¹ b ä¹‹å")
    <span class="hljs-built_in">print</span>("a:", a)
    <span class="hljs-built_in">print</span>("b:", b)
</code></pre>
<p>åœ¨ PythonTutor ä¸­å¯ä»¥ç›´è§‚çœ‹åˆ°ï¼š</p>
<ul>
<li>a å’Œ b æŒ‡å‘åŒä¸€ä¸ªåˆ—è¡¨å¯¹è±¡</li>
<li>å¯¹ b çš„ä¿®æ”¹ä¼šåŒæ­¥å½±å“ a</li>
<li>å†…å­˜ä¸­åªå­˜åœ¨ä¸€ä¸ªåˆ—è¡¨å®ä¾‹</li>
</ul>
<p>å¤åˆ¶ä¸‹é¢çš„å†…å®¹åœ¨æµè§ˆå™¨åœ°å€è®¿é—®</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">https:</span>//pythontutor.com/render.html#code=a%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">20%</span><span class="hljs-number">5</span>B1,%<span class="hljs-number">202</span>,%<span class="hljs-number">203%</span><span class="hljs-number">5</span>D%<span class="hljs-number">0</span>Ab%<span class="hljs-number">20%</span><span class="hljs-number">3</span>D%<span class="hljs-number">20</span>a%<span class="hljs-number">0</span>A%<span class="hljs-number">0</span>Aprint%<span class="hljs-number">28%</span><span class="hljs-number">22</span>a%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>,%<span class="hljs-number">20</span>a%<span class="hljs-number">29%</span><span class="hljs-number">0</span>Aprint%<span class="hljs-number">28%</span><span class="hljs-number">22</span>b%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>,%<span class="hljs-number">20</span>b%<span class="hljs-number">29%</span><span class="hljs-number">0</span>A%<span class="hljs-number">0</span>Ab.append%<span class="hljs-number">284%</span><span class="hljs-number">29%</span><span class="hljs-number">0</span>A%<span class="hljs-number">0</span>Aprint%<span class="hljs-number">28%</span><span class="hljs-number">22%</span>E4%BF%AE%E6%<span class="hljs-number">94%</span>B9%<span class="hljs-number">20</span>b%<span class="hljs-number">20%</span>E4%B9%<span class="hljs-number">8</span>B%E5%<span class="hljs-number">90%</span><span class="hljs-number">8</span>E%<span class="hljs-number">22%</span><span class="hljs-number">29%</span><span class="hljs-number">0</span>Aprint%<span class="hljs-number">28%</span><span class="hljs-number">22</span>a%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>,%<span class="hljs-number">20</span>a%<span class="hljs-number">29%</span><span class="hljs-number">0</span>Aprint%<span class="hljs-number">28%</span><span class="hljs-number">22</span>b%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>,%<span class="hljs-number">20</span>b%<span class="hljs-number">29&amp;</span>cumulative=<span class="hljs-literal">false</span>&amp;curInstr=<span class="hljs-number">0&amp;</span>heapPrimitives=nevernest&amp;mode=display&amp;origin=opt-frontend.js&amp;py=<span class="hljs-number">311&amp;</span>rawInputLstJSON=%<span class="hljs-number">5</span>B%<span class="hljs-number">5</span>D&amp;textReferences=<span class="hljs-literal">false</span>
</code></pre>
<hr/>
<h3 data-id="heading-8">é€‚åˆä½¿ç”¨ PythonTutor çš„åœºæ™¯</h3>
<p>PythonTutor ç‰¹åˆ«é€‚åˆç”¨äºï¼š</p>
<ul>
<li>å­¦ä¹ åŸºç¡€è¯­æ³•å’Œæ§åˆ¶æµç¨‹</li>
<li>ç†è§£å¼‚å¸¸å¤„ç†é€»è¾‘</li>
<li>æŒæ¡å¾ªç¯ä¸åˆ†æ”¯çš„æ‰§è¡Œç»†èŠ‚</li>
<li>å­¦ä¹ æ•°æ®ç»“æ„å’Œå¼•ç”¨æ¨¡å‹</li>
</ul>
<p>å®ƒå¹¶ä¸æ˜¯è°ƒè¯•å¤§å‹é¡¹ç›®çš„å·¥å…·ï¼Œè€Œæ˜¯å¸®åŠ©å»ºç«‹æ­£ç¡®æ‰§è¡Œè®¤çŸ¥çš„å­¦ä¹ è¾…åŠ©å·¥å…·ã€‚</p>
<hr/>
<h3 data-id="heading-9">æ€»ç»“</h3>
<p>PythonTutor é€šè¿‡å¯è§†åŒ–çš„æ–¹å¼ï¼ŒæŠŠéšè—åœ¨è¿è¡Œæ—¶å†…éƒ¨çš„æ‰§è¡Œè¿‡ç¨‹å®Œæ•´å‘ˆç°å‡ºæ¥ã€‚æ— è®ºæ˜¯é“¾è¡¨ã€å¼‚å¸¸å¤„ç†ã€åˆ†æ”¯åˆ¤æ–­è¿˜æ˜¯å¾ªç¯æ§åˆ¶ï¼Œéƒ½å¯ä»¥é€šè¿‡å›¾å½¢åŒ–çš„æ–¹å¼è¢«æ¸…æ™°ç†è§£ï¼Œæ˜¯å­¦ä¹ å’Œæ•™å­¦ä¸­éå¸¸æœ‰ä»·å€¼çš„å·¥å…·ã€‚</p>
<h3 data-id="heading-10">æ‰©å±•</h3>
<p>IDEA æ’ä»¶ç¤¾åŒºé‡Œæœ‰ä¸€ä¸ªæ’ä»¶<code>Java Visualizer</code>å¯ä»¥åœ¨ IDEA é‡Œè°ƒè¯•æ—¶ä½¿ç”¨ç±»ä¼¼çš„æ•ˆæœï¼Œå•åªèƒ½ä¸‹ä¸€æ­¥ï¼Œä¸èƒ½å¾€å›èµ°ï¼Œéå¸¸å¥½ç”¨ï¼</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3345f9fcf3014fa3b4f0cad9211466c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgcGU3ZXI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769847968&amp;x-signature=TU%2FOMtKSZ73XRM1yia3E%2FCjljNM%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Next.jsï¼šé¢ è¦†ä¼ ç»Ÿçš„å‰ç«¯å¼€å‘æ¡†æ¶ï¼Œä¸ºä»€ä¹ˆå®ƒå¦‚æ­¤å—æ¬¢è¿ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7598499504170926118</link>    <guid>https://juejin.cn/post/7598499504170926118</guid>    <pubDate>2026-01-24T08:21:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598499504170926118" data-draft-id="7598532592455647259" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Next.jsï¼šé¢ è¦†ä¼ ç»Ÿçš„å‰ç«¯å¼€å‘æ¡†æ¶ï¼Œä¸ºä»€ä¹ˆå®ƒå¦‚æ­¤å—æ¬¢è¿ï¼Ÿ"/> <meta itemprop="keywords" content="Next.js"/> <meta itemprop="datePublished" content="2026-01-24T08:21:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åŒ—è¾°alk"/> <meta itemprop="url" content="https://juejin.cn/user/1772855673241352"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Next.jsï¼šé¢ è¦†ä¼ ç»Ÿçš„å‰ç«¯å¼€å‘æ¡†æ¶ï¼Œä¸ºä»€ä¹ˆå®ƒå¦‚æ­¤å—æ¬¢è¿ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1772855673241352/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åŒ—è¾°alk
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T08:21:09.000Z" title="Sat Jan 24 2026 08:21:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Next.jsï¼šé¢ è¦†ä¼ ç»Ÿçš„å‰ç«¯å¼€å‘æ¡†æ¶ï¼Œä¸ºä»€ä¹ˆå®ƒå¦‚æ­¤å—æ¬¢è¿ï¼Ÿ</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d39a6ea809db47fa9d84f22b0f1b411d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YyX6L6wYWxr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769847669&amp;x-signature=9llCTBmsrjB84G5%2FC7usxDOeHwM%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-1">ä¸€ã€Next.jsåˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p>Next.js æ˜¯ä¸€ä¸ªåŸºäº React çš„<strong>å…¨æ ˆæ¡†æ¶</strong>ï¼Œç”±Vercelå…¬å¸å¼€å‘å¹¶ç»´æŠ¤ã€‚å®ƒä¸æ˜¯ç®€å•çš„UIåº“ï¼Œè€Œæ˜¯ä¸€ä¸ªå®Œæ•´çš„Webåº”ç”¨å¼€å‘è§£å†³æ–¹æ¡ˆï¼Œè®©ä½ èƒ½å¤Ÿè½»æ¾æ„å»ºé«˜æ€§èƒ½çš„Reactåº”ç”¨ç¨‹åºã€‚</p>
<p>ç®€å•æ¥è¯´ï¼ŒNext.js = React + è·¯ç”±ç³»ç»Ÿ + æœåŠ¡ç«¯æ¸²æŸ“ + æ„å»ºä¼˜åŒ– + APIè·¯ç”± + æ›´å¤šå¼€ç®±å³ç”¨çš„åŠŸèƒ½ã€‚</p>
<h3 data-id="heading-2">äºŒã€Next.jsçš„å…«å¤§æ ¸å¿ƒç‰¹ç‚¹</h3>
<h4 data-id="heading-3">1.Â <strong>æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰ä¸é™æ€ç«™ç‚¹ç”Ÿæˆï¼ˆSSGï¼‰</strong></h4>
<p>è¿™æ˜¯Next.jsæœ€äº®çœ¼çš„ç‰¹æ€§ä¹‹ä¸€ï¼ä¼ ç»ŸReactåº”ç”¨åªåœ¨å®¢æˆ·ç«¯æ¸²æŸ“ï¼Œè€ŒNext.jsæ”¯æŒï¼š</p>
<ul>
<li>â€¢ æœåŠ¡ç«¯æ¸²æŸ“ï¼šé¡µé¢åœ¨æœåŠ¡å™¨ä¸Šç”ŸæˆHTMLï¼Œç„¶åå‘é€ç»™å®¢æˆ·ç«¯</li>
<li>â€¢ é™æ€ç”Ÿæˆï¼šæ„å»ºæ—¶é¢„æ¸²æŸ“é¡µé¢ï¼Œé€‚åˆå†…å®¹å˜åŒ–ä¸å¤§çš„é¡µé¢</li>
<li>â€¢ å¢é‡é™æ€å†ç”Ÿï¼šä¿æŒé™æ€é¡µé¢çš„ä¼˜åŠ¿ï¼ŒåŒæ—¶æ”¯æŒå†…å®¹æ›´æ–°</li>
</ul>

<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">//Â ç®€å•çš„é™æ€é¡µé¢ç”Ÿæˆç¤ºä¾‹</span>
<span class="hljs-keyword">export</span>Â <span class="hljs-keyword">async</span>Â <span class="hljs-keyword">function</span>Â <span class="hljs-title function_">getStaticProps</span>(<span class="hljs-params"/>)Â {
Â Â <span class="hljs-keyword">const</span>Â dataÂ =Â <span class="hljs-keyword">await</span>Â <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://api.example.com/data'</span>);
Â Â <span class="hljs-keyword">return</span>Â {
Â Â Â Â <span class="hljs-attr">props</span>:Â {Â dataÂ },
Â Â };
}
</code></pre>
<h4 data-id="heading-4">2.Â <strong>æ–‡ä»¶ç³»ç»Ÿè·¯ç”±</strong></h4>
<p>ä¸éœ€è¦å¤æ‚é…ç½®ï¼Œç›´æ¥åœ¨<code>pages</code>ç›®å½•ä¸‹åˆ›å»ºæ–‡ä»¶å³å¯å®šä¹‰è·¯ç”±ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">pages/
Â Â index.jsÂ Â Â Â Â Â Â Â â†’Â Â /
Â Â about.jsÂ Â Â Â Â Â Â Â â†’Â Â /about
Â Â blog/
Â Â Â Â [slug].jsÂ Â Â Â Â â†’Â Â /blog/:slugÂ (åŠ¨æ€è·¯ç”±)
</code></pre>
<h4 data-id="heading-5">3.Â <strong>APIè·¯ç”±</strong></h4>
<p>æ— éœ€å•ç‹¬çš„åç«¯æœåŠ¡å™¨ï¼Œåœ¨<code>pages/api</code>ç›®å½•ä¸‹åˆ›å»ºæ–‡ä»¶å³å¯ç¼–å†™APIæ¥å£ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">//Â pages/api/user.js</span>
<span class="hljs-keyword">export</span>Â <span class="hljs-keyword">default</span>Â <span class="hljs-keyword">function</span>Â <span class="hljs-title function_">handler</span>(<span class="hljs-params">req,Â res</span>)Â {
Â Â res.<span class="hljs-title function_">status</span>(<span class="hljs-number">200</span>).<span class="hljs-title function_">json</span>({Â <span class="hljs-attr">name</span>:Â <span class="hljs-string">'JohnÂ Doe'</span>Â });
}
</code></pre>
<h4 data-id="heading-6">4.Â <strong>å†…ç½®CSSå’ŒSassæ”¯æŒ</strong></h4>
<p>æ”¯æŒCSS Modulesã€Styled JSXã€Sassç­‰ï¼Œå¼€ç®±å³ç”¨ï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚</p>
<h4 data-id="heading-7">5.Â <strong>è‡ªåŠ¨ä»£ç åˆ†å‰²</strong></h4>
<p>Next.jsä¼šè‡ªåŠ¨å°†ä»£ç æ‹†åˆ†æˆå°å—ï¼ŒåªåŠ è½½å½“å‰é¡µé¢éœ€è¦çš„ä»£ç ï¼Œå¤§å¹…æå‡é¦–å±åŠ è½½é€Ÿåº¦ã€‚</p>
<h4 data-id="heading-8">6.Â <strong>å›¾åƒä¼˜åŒ–ç»„ä»¶</strong></h4>
<p><code>&lt;Image /&gt;</code>ç»„ä»¶è‡ªåŠ¨ä¼˜åŒ–å›¾ç‰‡ï¼š</p>
<ul>
<li>â€¢ è‡ªåŠ¨è°ƒæ•´å°ºå¯¸</li>
<li>â€¢ è½¬æ¢ä¸ºç°ä»£æ ¼å¼ï¼ˆWebPï¼‰</li>
<li>â€¢ å»¶è¿ŸåŠ è½½</li>
<li>â€¢ é˜²æ­¢å¸ƒå±€åç§»</li>
</ul>
<h4 data-id="heading-9">7.Â <strong>TypeScriptåŸç”Ÿæ”¯æŒ</strong></h4>
<p>åªéœ€åˆ›å»ºä¸€ä¸ª<code>tsconfig.json</code>æ–‡ä»¶ï¼ŒNext.jsä¼šè‡ªåŠ¨é…ç½®TypeScriptæ”¯æŒã€‚</p>
<h4 data-id="heading-10">8.Â <strong>å¿«é€Ÿåˆ·æ–°ï¼ˆFast Refreshï¼‰</strong></h4>
<p>å¼€å‘æ¨¡å¼ä¸‹ï¼Œä¿å­˜æ–‡ä»¶å³å¯å®æ—¶çœ‹åˆ°æ›´æ”¹ï¼Œä¿æŒç»„ä»¶çŠ¶æ€ä¸å˜ã€‚</p>
<h3 data-id="heading-11">ä¸‰ã€Next.jsçš„äº”å¤§ä¼˜åŠ¿</h3>
<h4 data-id="heading-12">1.Â <strong>æè‡´çš„æ€§èƒ½ä¼˜åŒ–</strong></h4>
<p>Next.jsçš„é¢„æ¸²æŸ“ç­–ç•¥æ˜¾è‘—æ”¹å–„äº†ï¼š</p>
<ul>
<li>â€¢Â <strong>é¦–å±åŠ è½½æ—¶é—´</strong>ï¼šæœåŠ¡å™¨è¿”å›å®Œæ•´çš„HTMLï¼Œç”¨æˆ·ç«‹å³çœ‹åˆ°å†…å®¹</li>
<li>â€¢Â <strong>SEOä¼˜åŒ–</strong>ï¼šæœç´¢å¼•æ“å¯ä»¥è½»æ¾æŠ“å–é¡µé¢å†…å®¹</li>
<li>â€¢Â <strong>æ ¸å¿ƒWebæŒ‡æ ‡</strong>ï¼šåœ¨LCPã€FIDã€CLSç­‰å…³é”®æŒ‡æ ‡ä¸Šè¡¨ç°ä¼˜å¼‚</li>
</ul>
<h4 data-id="heading-13">2.Â <strong>å¼€å‘ä½“éªŒæä½³</strong></h4>
<ul>
<li>â€¢ é›¶é…ç½®èµ·æ­¥</li>
<li>â€¢ ä¸°å¯Œçš„æ’ä»¶ç”Ÿæ€ç³»ç»Ÿ</li>
<li>â€¢ ä¼˜ç§€çš„é”™è¯¯æŠ¥å‘Šå’Œè°ƒè¯•å·¥å…·</li>
<li>â€¢ å®Œæ•´çš„æ–‡æ¡£å’Œæ´»è·ƒçš„ç¤¾åŒº</li>
</ul>
<h4 data-id="heading-14">3.Â <strong>å…¨æ ˆèƒ½åŠ›</strong></h4>
<p>ä»å‰ç«¯åˆ°åç«¯APIï¼Œä¸€ä¸ªæ¡†æ¶æå®šæ‰€æœ‰ï¼š</p>
<ul>
<li>â€¢ å‰ç«¯é¡µé¢æ¸²æŸ“</li>
<li>â€¢ APIæ¥å£å¼€å‘</li>
<li>â€¢ ä¸­é—´ä»¶å¤„ç†</li>
<li>â€¢ æ•°æ®åº“è¿æ¥</li>
</ul>
<h4 data-id="heading-15">4.Â <strong>å¼ºå¤§çš„éƒ¨ç½²èƒ½åŠ›</strong></h4>
<p>ä¸Vercelå¹³å°æ— ç¼é›†æˆï¼š</p>
<ul>
<li>â€¢ ä¸€é”®éƒ¨ç½²</li>
<li>â€¢ è‡ªåŠ¨HTTPS</li>
<li>â€¢ å…¨çƒCDN</li>
<li>â€¢ é¢„è§ˆéƒ¨ç½²</li>
<li>â€¢ è‡ªåŠ¨æ€§èƒ½ä¼˜åŒ–</li>
</ul>
<h4 data-id="heading-16">5.Â <strong>ä¼ä¸šçº§ç‰¹æ€§</strong></h4>
<ul>
<li>â€¢ å›½é™…åŒ–è·¯ç”±</li>
<li>â€¢ æŒ‰éœ€åˆ†æ</li>
<li>â€¢ é¢„è§ˆæ¨¡å¼</li>
<li>â€¢ ä¸­é—´ä»¶æ”¯æŒ</li>
<li>â€¢ å®‰å…¨å¤´éƒ¨è‡ªåŠ¨é…ç½®</li>
</ul>
<h3 data-id="heading-17">å››ã€Next.jsé€‚åˆå“ªäº›é¡¹ç›®ï¼Ÿ</h3>
<p>âœ…Â <strong>é€‚åˆåœºæ™¯</strong>ï¼š</p>
<ul>
<li>â€¢ éœ€è¦SEOä¼˜åŒ–çš„å†…å®¹å‹ç½‘ç«™ï¼ˆåšå®¢ã€æ–°é—»ã€ç”µå•†ï¼‰</li>
<li>â€¢ éœ€è¦è‰¯å¥½æ€§èƒ½çš„Webåº”ç”¨</li>
<li>â€¢ éœ€è¦æœåŠ¡ç«¯æ¸²æŸ“çš„åº”ç”¨ç¨‹åº</li>
<li>â€¢ å…¨æ ˆé¡¹ç›®ï¼Œå‰åç«¯ç»Ÿä¸€æŠ€æœ¯æ ˆ</li>
</ul>
<p>âŒÂ <strong>ä¸å¤ªé€‚åˆ</strong>ï¼š</p>
<ul>
<li>â€¢ çº¯é™æ€çš„æ— äº¤äº’é¡µé¢ï¼ˆç®€å•çš„é™æ€ç«™ç‚¹ç”Ÿæˆå™¨å¯èƒ½æ›´è½»é‡ï¼‰</li>
<li>â€¢ è¶…å¤§å‹ä¼ä¸šåº”ç”¨ï¼ˆå¯èƒ½éœ€è¦æ›´å®šåˆ¶çš„æ¶æ„ï¼‰</li>
</ul>
<h3 data-id="heading-18">äº”ã€å¿«é€Ÿå¼€å§‹Next.js</h3>
<p>åˆ›å»ºNext.jsé¡¹ç›®åªéœ€è¦ä¸€è¡Œå‘½ä»¤ï¼š</p>
<pre><code class="hljs language-perl" lang="perl">npxÂ create-<span class="hljs-keyword">next</span>-app@latestÂ <span class="hljs-keyword">my</span>-app
cdÂ <span class="hljs-keyword">my</span>-app
npmÂ runÂ dev
</code></pre>
<p>å‡ ç§’é’Ÿåï¼Œä½ çš„å¼€å‘æœåŠ¡å™¨å°±ä¼šåœ¨ <a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A3000" target="_blank" title="http://localhost:3000" ref="nofollow noopener noreferrer">http://localhost:3000</a> å¯åŠ¨ï¼</p>
<h3 data-id="heading-19">å…­ã€æˆåŠŸæ¡ˆä¾‹</h3>
<p>è®¸å¤šçŸ¥åå…¬å¸éƒ½åœ¨ä½¿ç”¨Next.jsï¼š</p>
<ul>
<li>â€¢Â <strong>Twitch</strong>Â - ç›´æ’­å¹³å°</li>
<li>â€¢Â <strong>Netflix</strong>Â - éƒ¨åˆ†é¡µé¢</li>
<li>â€¢Â <strong>TikTok</strong>Â - å®˜ç½‘</li>
<li>â€¢Â <strong>Notion</strong>Â - æ–‡æ¡£å·¥å…·</li>
<li>â€¢Â <strong>Hulu</strong>Â - è§†é¢‘æµåª’ä½“</li>
</ul>
<h3 data-id="heading-20">ä¸ƒã€å­¦ä¹ èµ„æºæ¨è</h3>
<ol>
<li>1.Â <strong>å®˜æ–¹æ–‡æ¡£</strong>ï¼ˆå¼ºçƒˆæ¨èï¼‰ï¼šnextjs.org/docs</li>
<li>2.Â <strong>Next.jså­¦ä¹ è¯¾ç¨‹</strong>ï¼šå®˜æ–¹å…è´¹äº’åŠ¨æ•™ç¨‹</li>
<li>3.Â <strong>GitHubç¤ºä¾‹</strong>ï¼šå®˜æ–¹ç¤ºä¾‹ä»“åº“</li>
<li>4.Â <strong>ç¤¾åŒº</strong>ï¼šGitHub Discussionsã€Redditã€Discord</li>
</ol>
<h3 data-id="heading-21">ç»“è¯­</h3>
<p>Next.jsæ­£åœ¨æ”¹å˜æˆ‘ä»¬æ„å»ºWebåº”ç”¨çš„æ–¹å¼ã€‚å®ƒå°†Reactçš„çµæ´»æ€§ä¸ç”Ÿäº§å°±ç»ªçš„åŠŸèƒ½ç›¸ç»“åˆï¼Œæä¾›äº†ä¸€ä¸ªæ—¢é€‚åˆåˆå­¦è€…å…¥é—¨ï¼Œåˆèƒ½æ»¡è¶³ä¼ä¸šçº§éœ€æ±‚çš„å®Œæ•´è§£å†³æ–¹æ¡ˆã€‚</p>
<p>æ— è®ºä½ æ˜¯æƒ³æå‡ç°æœ‰é¡¹ç›®çš„æ€§èƒ½ï¼Œè¿˜æ˜¯å¼€å§‹ä¸€ä¸ªæ–°é¡¹ç›®ï¼ŒNext.jséƒ½å€¼å¾—ä½ æ·±å…¥äº†è§£å’Œå°è¯•ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Javaä¸­çš„å„ç§Oï¼šä»Big Oåˆ°POJOï¼Œä¸€æ¬¡ææ‡‚æ‰€æœ‰"O"]]></title>    <link>https://juejin.cn/post/7598480267217846306</link>    <guid>https://juejin.cn/post/7598480267217846306</guid>    <pubDate>2026-01-24T08:21:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598480267217846306" data-draft-id="7598490039488708643" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Javaä¸­çš„å„ç§Oï¼šä»Big Oåˆ°POJOï¼Œä¸€æ¬¡ææ‡‚æ‰€æœ‰&quot;O&quot;"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2026-01-24T08:21:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ˜¯2çš„10æ¬¡æ–¹å•Š"/> <meta itemprop="url" content="https://juejin.cn/user/987803531871175"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Javaä¸­çš„å„ç§Oï¼šä»Big Oåˆ°POJOï¼Œä¸€æ¬¡ææ‡‚æ‰€æœ‰"O"
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/987803531871175/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ˜¯2çš„10æ¬¡æ–¹å•Š
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T08:21:26.000Z" title="Sat Jan 24 2026 08:21:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Javaä¸­çš„å„ç§Oï¼šä»Big Oåˆ°POJOï¼Œä¸€æ¬¡ææ‡‚æ‰€æœ‰"O"</h2>
<p>å‰å‡ å¤©é¢è¯•ä¸€ä¸ªJavaå¼€å‘ï¼Œæˆ‘é—®ä»–ï¼š"ä½ çŸ¥é“Javaä¸­æœ‰å“ªäº›'O'å—ï¼Ÿ"</p>
<p>ä»–æƒ³äº†æƒ³è¯´ï¼š"Objectï¼Ÿè¿˜æœ‰...Optionalï¼Ÿ"</p>
<p>æˆ‘ç¬‘äº†ç¬‘ï¼š"è¿˜æœ‰Big Oã€OOPã€POJOã€VOã€BOã€DTOã€DOã€DAO..."</p>
<p>ä»–ä¸€è„¸æ‡µé€¼ï¼š"è¿™ä¹ˆå¤š'O'ï¼Ÿéƒ½æ˜¯å•¥å•Šï¼Ÿ"</p>
<p>å…¶å®ï¼ŒåšJavaå¼€å‘ä¹…äº†ï¼Œä½ ä¼šå‘ç°è¿™ä¸ªå­—æ¯"O"åœ¨Javaä¸–ç•Œé‡Œæ— å¤„ä¸åœ¨ã€‚ä»ç®—æ³•åˆ†æçš„Big Oï¼Œåˆ°ç¼–ç¨‹èŒƒå¼çš„OOPï¼Œå†åˆ°å„ç§å¯¹è±¡ç±»å‹ï¼Œæ¯ä¸€ä¸ª"O"èƒŒåéƒ½æœ‰å®ƒçš„æ•…äº‹ã€‚</p>
<p>ä»Šå¤©ï¼Œæˆ‘å°±æ¥èŠèŠè¿™äº›"O"çš„å‰ä¸–ä»Šç”Ÿï¼Œçœ‹çœ‹å®ƒä»¬æ˜¯æ€ä¹ˆä»æ•°å­¦ç¬¦å·ã€ç¼–ç¨‹æ€æƒ³ï¼Œä¸€æ­¥æ­¥å˜æˆæˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­çš„å·¥å…·çš„ã€‚</p>
<hr/>
<h3 data-id="heading-1">Big Oï¼šé¢è¯•å®˜æœ€çˆ±é—®çš„é—®é¢˜</h3>
<h4 data-id="heading-2">ç¬¬ä¸€æ¬¡è¢«é—®æ‡µçš„ç»å†</h4>
<p>è®°å¾—æˆ‘ç¬¬ä¸€æ¬¡é¢è¯•çš„æ—¶å€™ï¼Œé¢è¯•å®˜é—®æˆ‘ï¼š"è¿™ä¸ªç®—æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿ"</p>
<p>æˆ‘ä¸€è„¸æ‡µé€¼ï¼š"æ—¶é—´å¤æ‚åº¦ï¼Ÿé‚£æ˜¯ä»€ä¹ˆï¼Ÿ"</p>
<p>ç»“æœ...ä½ æ‡‚çš„ï¼Œé¢è¯•å‡‰äº†ã€‚</p>
<p>åæ¥æˆ‘æ‰çŸ¥é“ï¼ŒåŸæ¥è¿™å°±æ˜¯<strong>å¤§Oè¡¨ç¤ºæ³•</strong>â€”â€”ç”¨æ¥æè¿°ç®—æ³•æ€§èƒ½çš„æ•°å­¦ç¬¦å·ã€‚ç®€å•è¯´ï¼Œå°±æ˜¯å‘Šè¯‰æˆ‘ä»¬ï¼šå½“æ•°æ®é‡å˜å¤§æ—¶ï¼Œç®—æ³•ä¼šå˜æ…¢å¤šå°‘ã€‚</p>
<h4 data-id="heading-3">å¤§Oæ˜¯æ€ä¹ˆæ¥çš„ï¼Ÿ</h4>
<p>ä½ å¯èƒ½æƒ³ä¸åˆ°ï¼Œå¤§Oå…¶å®ä¸æ˜¯è®¡ç®—æœºç§‘å­¦å®¶å‘æ˜çš„ï¼Œè€Œæ˜¯æ•°å­¦å®¶ã€‚</p>
<p><strong>1894å¹´</strong>ï¼Œå¾·å›½æ•°å­¦å®¶<strong>ä¿ç½—Â·å·´èµ«æ›¼</strong>åœ¨ç ”ç©¶ç´ æ•°åˆ†å¸ƒçš„æ—¶å€™ï¼Œå‘ç°æŸäº›å‡½æ•°çš„å¢é•¿é€Ÿåº¦å¯ä»¥ç”¨ä¸€ä¸ªç®€å•çš„ç¬¦å·è¡¨ç¤ºï¼Œè¿™å°±æ˜¯å¤§Oçš„é›å½¢ã€‚</p>
<p><strong>1909å¹´</strong>ï¼Œå¦ä¸€ä½æ•°å­¦å®¶<strong>åŸƒå¾·è’™Â·æœ—é“</strong>è¿›ä¸€æ­¥æ¨å¹¿äº†è¿™ä¸ªç¬¦å·ï¼Œè®©å®ƒæˆä¸ºæ•°å­¦åˆ†æçš„æ ‡å‡†å·¥å…·ã€‚</p>
<p>ç›´åˆ°<strong>1968å¹´</strong>ï¼Œè®¡ç®—æœºç§‘å­¦å®¶<strong>å”çº³å¾·Â·å…‹åŠªç‰¹</strong>ï¼ˆå°±æ˜¯å†™ã€Šè®¡ç®—æœºç¨‹åºè®¾è®¡è‰ºæœ¯ã€‹é‚£ä½å¤§ç¥ï¼‰æŠŠå¤§Oå¼•å…¥è®¡ç®—æœºç§‘å­¦ï¼Œç”¨æ¥åˆ†æç®—æ³•å¤æ‚åº¦ã€‚</p>
<p>ä¸ºä»€ä¹ˆå«"å¤§O"ï¼Ÿå…¶å®"O"æ¥è‡ªå¾·è¯­å•è¯"Ordnung"ï¼ˆç§©åºã€é˜¶ï¼‰ï¼Œè¡¨ç¤ºå‡½æ•°çš„"é˜¶"æˆ–"æ•°é‡çº§"ã€‚è¯´ç™½äº†ï¼Œå°±æ˜¯çœ‹å‡½æ•°å¢é•¿æœ‰å¤šå¿«ã€‚</p>
<h4 data-id="heading-4">Javaä¸­å¸¸è§çš„æ—¶é—´å¤æ‚åº¦</h4>
<p>é¢è¯•çš„æ—¶å€™ï¼Œè¿™å‡ ä¸ªæ˜¯æœ€å¸¸é—®çš„ï¼š</p>
<p><strong>O(1)</strong> - å¸¸æ•°æ—¶é—´ï¼Œæœ€å¿«</p>
<pre><code class="hljs language-arduino" lang="arduino">arr[index];Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â æ•°ç»„è®¿é—®ï¼Œæ— è®ºæ•°ç»„å¤šå¤§éƒ½æ˜¯O(1)</span>
map.<span class="hljs-built_in">get</span>(<span class="hljs-string">"key"</span>);Â Â Â Â <span class="hljs-comment">//Â HashMapæŸ¥æ‰¾ï¼Œå¹³å‡ä¹Ÿæ˜¯O(1)</span>
</code></pre>
<p><strong>O(log n)</strong> - å¯¹æ•°æ—¶é—´ï¼Œå¾ˆå¿«</p>
<pre><code class="hljs language-css" lang="css">//Â äºŒåˆ†æŸ¥æ‰¾ï¼šæ¯æ¬¡æ’é™¤ä¸€åŠæ•°æ®
whileÂ (<span class="hljs-attribute">left</span>Â &lt;=Â <span class="hljs-attribute">right</span>)Â {
Â Â Â Â midÂ =Â (<span class="hljs-attribute">left</span>Â +Â <span class="hljs-attribute">right</span>)Â /Â <span class="hljs-number">2</span>;
Â Â Â Â ifÂ (arr<span class="hljs-selector-attr">[mid]</span>Â ==Â target)Â returnÂ mid;
}
</code></pre>
<p><strong>O(n)</strong> - çº¿æ€§æ—¶é—´ï¼Œè¿˜è¡Œ</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">//Â éå†æ•°ç»„ï¼šéœ€è¦æ£€æŸ¥æ¯ä¸ªå…ƒç´ </span>
<span class="hljs-keyword">for</span>Â (<span class="hljs-type">int</span>Â iÂ =Â <span class="hljs-number">0</span>;Â iÂ &lt;Â arr.length;Â i++)Â {
Â Â Â Â <span class="hljs-comment">//Â å¤„ç†</span>
}
</code></pre>
<p><strong>O(n log n)</strong> - çº¿æ€§å¯¹æ•°æ—¶é—´ï¼Œæ’åºç®—æ³•å¸¸ç”¨</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">//Â å½’å¹¶æ’åºï¼šåˆ†æ²»Â +Â åˆå¹¶</span>
<span class="hljs-built_in">mergeSort</span>(arr,Â left,Â mid);
<span class="hljs-built_in">mergeSort</span>(arr,Â midÂ +Â <span class="hljs-number">1</span>,Â right);
</code></pre>
<p><strong>O(nÂ²)</strong> - å¹³æ–¹æ—¶é—´ï¼Œæœ‰ç‚¹æ…¢</p>
<pre><code class="hljs language-ini" lang="ini">//Â åµŒå¥—å¾ªç¯ï¼šå¤–å±‚næ¬¡ï¼Œå†…å±‚næ¬¡
forÂ (intÂ <span class="hljs-attr">i</span>Â =Â <span class="hljs-number">0</span><span class="hljs-comment">;Â iÂ &lt;Â n;Â i++)Â {</span>
Â Â Â Â forÂ (intÂ <span class="hljs-attr">j</span>Â =Â <span class="hljs-number">0</span><span class="hljs-comment">;Â jÂ &lt;Â n;Â j++)Â {</span>
Â Â Â Â Â Â Â Â //Â å¤„ç†
Â Â Â Â }
}
</code></pre>
<p>è¯´å®è¯ï¼Œåˆšå¼€å§‹æˆ‘ä¹Ÿåˆ†ä¸æ¸…è¿™äº›ï¼Œåæ¥åˆ·LeetCodeåˆ·å¤šäº†ï¼Œæ‰æ…¢æ…¢æœ‰æ„Ÿè§‰ã€‚</p>
<h4 data-id="heading-5">Javaé›†åˆæ¡†æ¶ä¸­çš„æ—¶é—´å¤æ‚åº¦</h4>









































<table><thead><tr><th>æ•°æ®ç»“æ„</th><th>æ“ä½œ</th><th>æ—¶é—´å¤æ‚åº¦</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>ArrayList</td><td>get(index)</td><td>O(1)</td><td>æ•°ç»„éšæœºè®¿é—®</td></tr><tr><td>ArrayList</td><td>contains(element)</td><td>O(n)</td><td>éœ€è¦éå†æŸ¥æ‰¾</td></tr><tr><td>HashMap</td><td>get(key)</td><td>O(1) å¹³å‡</td><td>å“ˆå¸Œè¡¨æŸ¥æ‰¾</td></tr><tr><td>TreeMap</td><td>get(key)</td><td>O(log n)</td><td>çº¢é»‘æ ‘æŸ¥æ‰¾</td></tr><tr><td>HashSet</td><td>add(element)</td><td>O(1) å¹³å‡</td><td>åŸºäºHashMapå®ç°</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-6">OOPï¼šJavaçš„ç¼–ç¨‹å“²å­¦</h3>
<h4 data-id="heading-7">ä»é¢å‘è¿‡ç¨‹åˆ°é¢å‘å¯¹è±¡</h4>
<p>åˆšå­¦Javaçš„æ—¶å€™ï¼Œè€å¸ˆä¸€ç›´å¼ºè°ƒ"é¢å‘å¯¹è±¡"ï¼Œæˆ‘é‚£æ—¶å€™å°±æƒ³ï¼šé¢å‘å¯¹è±¡åˆ°åº•æ˜¯ä¸ªå•¥ï¼Ÿ</p>
<p>åæ¥å†™å¤šäº†ä»£ç æ‰å‘ç°ï¼ŒåŸæ¥å°±æ˜¯æŠŠæ•°æ®å’Œæ“ä½œæ•°æ®çš„æ–¹æ³•"æ‰“åŒ…"åœ¨ä¸€èµ·ã€‚å°±åƒç°å®ä¸­çš„ç‰©ä½“ä¸€æ ·ï¼Œæœ‰å±æ€§ï¼ˆæ¯”å¦‚äººçš„å§“åã€å¹´é¾„ï¼‰ï¼Œæœ‰è¡Œä¸ºï¼ˆæ¯”å¦‚äººä¼šåƒé¥­ã€ä¼šèµ°è·¯ï¼‰ã€‚</p>
<h4 data-id="heading-8">OOPæ˜¯æ€ä¹ˆæ¥çš„ï¼Ÿ</h4>
<p><strong>1960å¹´ä»£</strong>ï¼ŒæŒªå¨çš„ä¸¤ä½ç¨‹åºå‘˜å¼€å‘äº†<strong>Simulaè¯­è¨€</strong>ï¼Œè¿™æ˜¯ç¬¬ä¸€ä¸ªæ”¯æŒç±»å’Œå¯¹è±¡æ¦‚å¿µçš„è¯­è¨€ã€‚ä»–ä»¬å½“æ—¶æ˜¯ä¸ºäº†æ¨¡æ‹Ÿç³»ç»Ÿï¼Œæ²¡æƒ³åˆ°è¿™ä¸ªæƒ³æ³•åæ¥æˆäº†ç¼–ç¨‹èŒƒå¼çš„é©å‘½ã€‚</p>
<p><strong>1970å¹´ä»£</strong>ï¼Œ<strong>Alan Kay</strong>åœ¨æ–½ä¹å…¬å¸å¼€å‘äº†<strong>Smalltalk</strong>ï¼Œè¿›ä¸€æ­¥å®Œå–„äº†OOPã€‚ä»–æå‡ºäº†"ä¸‡ç‰©çš†å¯¹è±¡"çš„ç†å¿µï¼Œè¿˜åˆ›é€ äº†"é¢å‘å¯¹è±¡ç¼–ç¨‹"è¿™ä¸ªè¯ã€‚</p>
<p><strong>1983å¹´</strong>ï¼Œ<strong>Bjarne Stroustrup</strong>å¼€å‘äº†<strong>C++</strong> ï¼ŒæŠŠOOPå¸¦å…¥äº†ä¸»æµã€‚</p>
<p><strong>1995å¹´</strong>ï¼Œ<strong>James Gosling</strong>å¼€å‘äº†Javaï¼ŒæŠŠOOPæ¨å‘äº†æ–°é«˜åº¦ã€‚Javaçš„"ä¸€æ¬¡ç¼–å†™ï¼Œåˆ°å¤„è¿è¡Œ"ï¼ŒOOPå°±æ˜¯æ ¸å¿ƒã€‚</p>
<h4 data-id="heading-9">Javaä¸­çš„OOPï¼šå››å¤§ç‰¹æ€§</h4>
<p>OOPæœ‰å››å¤§ç‰¹æ€§ï¼Œæˆ‘åˆšå¼€å§‹ä¹Ÿè®°ä¸ä½ï¼Œåæ¥ç”¨å¤šäº†æ‰ç†è§£ï¼š</p>
<p><strong>1. å°è£…</strong> - æŠŠæ•°æ®è—èµ·æ¥ï¼Œåªæš´éœ²å¿…è¦çš„æ–¹æ³•</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">//Â å°±åƒé“¶è¡Œè´¦æˆ·ï¼Œä½™é¢ä¸èƒ½éšä¾¿æ”¹</span>
<span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">BankAccount</span>Â {
Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-type">double</span>Â balance;Â Â <span class="hljs-comment">//Â ç§æœ‰ï¼Œå¤–éƒ¨ä¸èƒ½ç›´æ¥è®¿é—®</span>
Â Â Â Â 
Â Â Â Â <span class="hljs-function"><span class="hljs-keyword">public</span>Â <span class="hljs-type">void</span>Â <span class="hljs-title">deposit</span><span class="hljs-params">(<span class="hljs-type">double</span>Â amount)</span>Â </span>{
Â Â Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â (amountÂ &gt;Â <span class="hljs-number">0</span>)Â balanceÂ +=Â amount;Â Â <span class="hljs-comment">//Â åªèƒ½é€šè¿‡æ–¹æ³•æ“ä½œ</span>
Â Â Â Â }
}
</code></pre>
<p><strong>2. ç»§æ‰¿</strong> - ä»£ç å¤ç”¨ï¼Œå­ç±»ç»§æ‰¿çˆ¶ç±»</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">class</span>Â <span class="hljs-title class_">Animal</span>Â {
Â Â Â Â <span class="hljs-keyword">protected</span>Â <span class="hljs-title class_">String</span>Â name;
Â Â Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-built_in">void</span>Â <span class="hljs-title function_">eat</span>(<span class="hljs-params"/>)Â {Â <span class="hljs-comment">/*Â ...Â */</span>Â }
}

<span class="hljs-keyword">class</span>Â <span class="hljs-title class_">Dog</span>Â <span class="hljs-keyword">extends</span>Â <span class="hljs-title class_ inherited__">Animal</span>Â {
Â Â Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-built_in">void</span>Â <span class="hljs-title function_">bark</span>(<span class="hljs-params"/>)Â {Â <span class="hljs-comment">/*Â ...Â */</span>Â }Â Â <span class="hljs-comment">//Â ç»§æ‰¿äº†eat()ï¼Œè¿˜æœ‰è‡ªå·±çš„bark()</span>
}
</code></pre>
<p><strong>3. å¤šæ€</strong> - åŒä¸€æ¥å£ï¼Œä¸åŒå®ç°</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">interface</span>Â <span class="hljs-title class_">Shape</span>Â {
Â Â Â Â <span class="hljs-type">double</span>Â <span class="hljs-title function_">calculateArea</span><span class="hljs-params">()</span>;
}

<span class="hljs-keyword">class</span>Â <span class="hljs-title class_">Circle</span>Â <span class="hljs-keyword">implements</span>Â <span class="hljs-title class_">Shape</span>Â {
Â Â Â Â <span class="hljs-meta">@Override</span>
Â Â Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-type">double</span>Â <span class="hljs-title function_">calculateArea</span><span class="hljs-params">()</span>Â {
Â Â Â Â Â Â Â Â <span class="hljs-keyword">return</span>Â Math.PIÂ *Â radiusÂ *Â radius;
Â Â Â Â }
}

<span class="hljs-comment">//Â å¤šæ€ï¼šåŒä¸€ä¸ªæ¥å£ï¼Œä¸åŒçš„å®ç°</span>
<span class="hljs-type">Shape</span>Â <span class="hljs-variable">shape</span>Â <span class="hljs-operator">=</span>Â <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">Circle</span>(<span class="hljs-number">5</span>);
shape.calculateArea();Â Â <span class="hljs-comment">//Â è°ƒç”¨Circleçš„å®ç°</span>
</code></pre>
<p><strong>4. æŠ½è±¡</strong> - éšè—å¤æ‚æ€§ï¼Œåªæš´éœ²å¿…è¦çš„</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">abstract</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title">Vehicle</span>Â {
Â Â Â Â <span class="hljs-function"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">abstract</span>Â <span class="hljs-keyword">void</span>Â <span class="hljs-title">start</span>()</span>;Â Â <span class="hljs-comment">//Â æŠ½è±¡æ–¹æ³•ï¼Œå­ç±»å¿…é¡»å®ç°</span>
}

<span class="hljs-keyword">class</span>Â <span class="hljs-title">Car</span>Â <span class="hljs-title">extends</span>Â <span class="hljs-title">Vehicle</span>Â {
Â Â Â Â @Override
Â Â Â Â <span class="hljs-function"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">void</span>Â <span class="hljs-title">start</span>()</span>Â {Â <span class="hljs-comment">/*Â å…·ä½“å®ç°Â */</span>Â }
}
</code></pre>
<h4 data-id="heading-10">SOLIDåŸåˆ™ï¼šOOPçš„è®¾è®¡åŸåˆ™</h4>
<p>è¯´åˆ°OOPï¼Œå°±ä¸å¾—ä¸æ<strong>SOLIDåŸåˆ™</strong>ã€‚è¿™äº”ä¸ªåŸåˆ™åˆšå¼€å§‹æˆ‘ä¹Ÿè®°ä¸ä½ï¼Œåæ¥è¸©äº†æ— æ•°å‘æ‰æ˜ç™½ï¼š</p>
<ul>
<li><strong>S</strong> - å•ä¸€èŒè´£ï¼šä¸€ä¸ªç±»åªåšä¸€ä»¶äº‹</li>
<li><strong>O</strong> - å¼€é—­åŸåˆ™ï¼šå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­</li>
<li><strong>L</strong> - é‡Œæ°æ›¿æ¢ï¼šå­ç±»å¯ä»¥æ›¿æ¢çˆ¶ç±»</li>
<li><strong>I</strong> - æ¥å£éš”ç¦»ï¼šæ¥å£è¦å°è€Œä¸“</li>
<li><strong>D</strong> - ä¾èµ–å€’ç½®ï¼šä¾èµ–æŠ½è±¡ï¼Œä¸ä¾èµ–å…·ä½“</li>
</ul>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå¼€é—­åŸåˆ™ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//Â æ–°å¢æ”¯ä»˜æ–¹å¼ï¼Œä¸éœ€è¦ä¿®æ”¹ç°æœ‰ä»£ç </span>
<span class="hljs-keyword">interface</span>Â <span class="hljs-title class_">PaymentMethod</span>Â {
Â Â Â Â <span class="hljs-keyword">void</span>Â <span class="hljs-title function_">pay</span><span class="hljs-params">(<span class="hljs-type">double</span>Â amount)</span>;
}

<span class="hljs-keyword">class</span>Â <span class="hljs-title class_">AlipayPayment</span>Â <span class="hljs-keyword">implements</span>Â <span class="hljs-title class_">PaymentMethod</span>Â {
Â Â Â Â <span class="hljs-meta">@Override</span>
Â Â Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-keyword">void</span>Â <span class="hljs-title function_">pay</span><span class="hljs-params">(<span class="hljs-type">double</span>Â amount)</span>Â {Â <span class="hljs-comment">/*Â ...Â */</span>Â }
}

<span class="hljs-comment">//Â è¦åŠ å¾®ä¿¡æ”¯ä»˜ï¼Ÿç›´æ¥å®ç°æ¥å£å°±è¡Œï¼Œä¸ç”¨æ”¹å…¶ä»–ä»£ç </span>
<span class="hljs-keyword">class</span>Â <span class="hljs-title class_">WeChatPayment</span>Â <span class="hljs-keyword">implements</span>Â <span class="hljs-title class_">PaymentMethod</span>Â {
Â Â Â Â <span class="hljs-meta">@Override</span>
Â Â Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-keyword">void</span>Â <span class="hljs-title function_">pay</span><span class="hljs-params">(<span class="hljs-type">double</span>Â amount)</span>Â {Â <span class="hljs-comment">/*Â ...Â */</span>Â }
}
</code></pre>
<p>è¿™å°±æ˜¯"å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­"ã€‚</p>
<hr/>
<h3 data-id="heading-11">Optionalï¼šå‘Šåˆ«NullPointerException</h3>
<h4 data-id="heading-12">è¢«nullæŠ˜ç£¨çš„æ—¥å­</h4>
<p>è¯´å®è¯ï¼ŒåšJavaå¼€å‘æœ€æ€•çš„å°±æ˜¯<code>NullPointerException</code>ã€‚æˆ‘åˆšå¼€å§‹å†™ä»£ç çš„æ—¶å€™ï¼Œç»å¸¸é‡åˆ°ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">//Â è¿™ç§åµŒå¥—çš„nullæ£€æŸ¥ï¼Œå†™å¤šäº†çœŸçš„æƒ³å“­</span>
<span class="hljs-keyword">public</span>Â <span class="hljs-title class_">String</span>Â <span class="hljs-title function_">getUserName</span>(<span class="hljs-params">UserÂ user</span>)Â {
Â Â Â Â <span class="hljs-keyword">if</span>Â (userÂ !=Â <span class="hljs-literal">null</span>)Â {
Â Â Â Â Â Â Â Â <span class="hljs-title class_">Profile</span>Â profileÂ =Â user.<span class="hljs-title function_">getProfile</span>();
Â Â Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â (profileÂ !=Â <span class="hljs-literal">null</span>)Â {
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">return</span>Â profile.<span class="hljs-title function_">getName</span>();
Â Â Â Â Â Â Â Â }
Â Â Â Â }
Â Â Â Â <span class="hljs-keyword">return</span>Â <span class="hljs-string">"Unknown"</span>;
}
</code></pre>
<p>ä»£ç åˆä¸‘åˆå®¹æ˜“å‡ºé”™ï¼Œä¸€ä¸å°å¿ƒå°±æ¼æ‰ä¸€ä¸ªnullæ£€æŸ¥ã€‚</p>
<h4 data-id="heading-13">nullçš„"é»‘å†å²"</h4>
<p><strong>1965å¹´</strong>ï¼Œ<strong>Tony Hoare</strong>åœ¨è®¾è®¡ALGOL Wè¯­è¨€æ—¶å¼•å…¥äº†nullå¼•ç”¨ã€‚ä»–åæ¥æ‰¿è®¤è¿™æ˜¯"ä¸€ä¸ªä»·å€¼åäº¿ç¾å…ƒçš„é”™è¯¯"ã€‚</p>
<p>ç¡®å®ï¼Œnullå¼•ç”¨å¯¼è‡´äº†æ— æ•°bugã€‚å…¶ä»–è¯­è¨€æ—©å°±æƒ³åŠæ³•è§£å†³äº†ï¼š</p>
<ul>
<li><strong>Scala</strong>ç”¨<code>Option[T]</code></li>
<li><strong>Haskell</strong>ç”¨<code>Maybe</code></li>
<li><strong>Kotlin</strong>ç”¨å¯ç©ºç±»å‹<code>String?</code></li>
</ul>
<h4 data-id="heading-14">Java 8çš„æ•‘æ˜Ÿï¼šOptional</h4>
<p><strong>2014å¹´</strong>ï¼ŒJava 8ç»ˆäºå¼•å…¥äº†<code>Optional</code>ï¼Œå€Ÿé‰´äº†å‡½æ•°å¼ç¼–ç¨‹çš„ç»éªŒã€‚</p>
<p>ç°åœ¨å¯ä»¥è¿™æ ·å†™ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">//Â ä¼˜é›…å¤šäº†ï¼</span>
publicÂ StringÂ <span class="hljs-built_in">getUserName</span>(UserÂ user)Â {
Â Â Â Â returnÂ Optional<span class="hljs-selector-class">.ofNullable</span>(user)
Â Â Â Â Â Â Â Â <span class="hljs-selector-class">.map</span>(User::getProfile)
Â Â Â Â Â Â Â Â <span class="hljs-selector-class">.map</span>(Profile::getName)
Â Â Â Â Â Â Â Â <span class="hljs-selector-class">.orElse</span>("Unknown");
}
</code></pre>
<p>é“¾å¼è°ƒç”¨ï¼Œä¸€è¡Œæå®šï¼Œå†ä¹Ÿä¸ç”¨å†™ä¸€å †ifäº†ã€‚</p>
<p>åŸºæœ¬ç”¨æ³•ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">Optional&lt;String&gt;Â optÂ =Â Optional<span class="hljs-selector-class">.ofNullable</span>(value);
opt<span class="hljs-selector-class">.orElse</span>("é»˜è®¤å€¼");Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â å®‰å…¨è·å–å€¼</span>
opt<span class="hljs-selector-class">.ifPresent</span>(System.out::println);Â Â Â Â Â Â <span class="hljs-comment">//Â å­˜åœ¨æ‰æ‰§è¡Œ</span>
opt<span class="hljs-selector-class">.orElseThrow</span>(()Â -&gt;Â newÂ <span class="hljs-built_in">Exception</span>());Â <span class="hljs-comment">//Â ä¸å­˜åœ¨æŠ›å¼‚å¸¸</span>
</code></pre>
<p>ä¸è¿‡è¯´å®è¯ï¼ŒOptionalä¹Ÿä¸æ˜¯ä¸‡èƒ½çš„ï¼Œç”¨ä¸å¥½åè€Œä¼šè®©ä»£ç å˜å¤æ‚ã€‚å…³é”®æ˜¯è¦ç†è§£å®ƒçš„è®¾è®¡æ€æƒ³ã€‚</p>
<hr/>
<h3 data-id="heading-15">Objectï¼šJavaçš„ä¸‡ç‰©ä¹‹æº</h3>
<h4 data-id="heading-16">æ‰€æœ‰ç±»çš„ç¥–å®—</h4>
<p>åœ¨Javaé‡Œï¼Œ<code>Object</code>æ˜¯æ‰€æœ‰ç±»çš„æ ¹ç±»ã€‚ä¸ç®¡ä½ å†™ä»€ä¹ˆç±»ï¼Œæœ€ç»ˆéƒ½ç»§æ‰¿è‡ªObjectã€‚</p>
<p>è¿™ä¸ªè®¾è®¡æ˜¯Javaåœ¨<strong>1995å¹´</strong>å‘å¸ƒæ—¶å°±å®šä¸‹çš„ï¼Œå½±å“äº†æ•´ä¸ªJavaç±»å‹ç³»ç»Ÿã€‚</p>
<h4 data-id="heading-17">Objectçš„æ ¸å¿ƒæ–¹æ³•</h4>
<p>Objectç±»æœ‰å‡ ä¸ªé‡è¦æ–¹æ³•ï¼Œé¢è¯•ç»å¸¸é—®ï¼š</p>
<p><strong>toString()</strong> - å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤º</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span>Â <span class="hljs-title class_">String</span>Â <span class="hljs-title function_">toString</span>(<span class="hljs-params"/>)Â {
Â Â Â Â <span class="hljs-keyword">return</span>Â <span class="hljs-string">"Person{name='"</span>Â +Â nameÂ +Â <span class="hljs-string">"',Â age="</span>Â +Â ageÂ +Â <span class="hljs-string">"}"</span>;
}
</code></pre>
<p><strong>equals() å’Œ hashCode()</strong> - è¿™ä¸¤ä¸ªå¿…é¡»ä¸€èµ·é‡å†™</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span>Â <span class="hljs-built_in">boolean</span>Â <span class="hljs-title function_">equals</span>(<span class="hljs-params"><span class="hljs-built_in">Object</span>Â obj</span>)Â {
Â Â Â Â <span class="hljs-keyword">if</span>Â (<span class="hljs-variable language_">this</span>Â ==Â obj)Â <span class="hljs-keyword">return</span>Â <span class="hljs-literal">true</span>;
Â Â Â Â <span class="hljs-keyword">if</span>Â (objÂ ==Â <span class="hljs-literal">null</span>Â ||Â <span class="hljs-title function_">getClass</span>()Â !=Â obj.<span class="hljs-title function_">getClass</span>())Â <span class="hljs-keyword">return</span>Â <span class="hljs-literal">false</span>;
Â Â Â Â <span class="hljs-title class_">Student</span>Â studentÂ =Â (<span class="hljs-title class_">Student</span>)Â obj;
Â Â Â Â <span class="hljs-keyword">return</span>Â <span class="hljs-title class_">Objects</span>.<span class="hljs-title function_">equals</span>(id,Â student.<span class="hljs-property">id</span>);
}

<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span>Â intÂ <span class="hljs-title function_">hashCode</span>(<span class="hljs-params"/>)Â {
Â Â Â Â <span class="hljs-keyword">return</span>Â <span class="hljs-title class_">Objects</span>.<span class="hljs-title function_">hash</span>(id);
}
</code></pre>
<p><strong>é‡è¦</strong>ï¼šé‡å†™equals()å¿…é¡»é‡å†™hashCode()ï¼Œä¸ç„¶ç”¨HashMapã€HashSetä¼šå‡ºé—®é¢˜ã€‚æˆ‘å½“å¹´å°±å› ä¸ºè¿™ä¸ªè¸©è¿‡å‘ã€‚</p>
<p><strong>getClass()</strong> - è·å–å¯¹è±¡çš„ç±»ï¼ˆåå°„ç”¨ï¼‰</p>
<p><strong>clone()</strong> - å¯¹è±¡å…‹éš†ï¼ˆä¸æ¨èç”¨ï¼Œå»ºè®®ç”¨æ‹·è´æ„é€ å‡½æ•°ï¼‰</p>
<p><strong>wait()ã€notify()ã€notifyAll()</strong> - çº¿ç¨‹é€šä¿¡ï¼ˆJava 5åæ¨èç”¨<code>java.util.concurrent</code>åŒ…ï¼‰</p>
<p><strong>finalize()</strong> - å¯¹è±¡ç»ˆç»“ï¼ˆJava 9å·²åºŸå¼ƒï¼Œç”¨try-with-resourcesï¼‰</p>
<hr/>
<h3 data-id="heading-18">å„ç§å¯¹è±¡ç±»å‹ï¼šPOJOã€VOã€BOã€DTOã€DOã€DAO</h3>
<h4 data-id="heading-19">åˆšå¼€å§‹æˆ‘ä¹Ÿåˆ†ä¸æ¸…</h4>
<p>åšJavaä¼ä¸šçº§å¼€å‘ï¼Œä½ ä¼šå‘ç°åˆ°å¤„éƒ½æ˜¯"O"ï¼šPOJOã€VOã€BOã€DTOã€DOã€DAO...</p>
<p>åˆšå¼€å§‹æˆ‘ä¹Ÿåˆ†ä¸æ¸…ï¼Œåæ¥è¸©äº†æ— æ•°å‘æ‰æ˜ç™½ã€‚</p>
<h4 data-id="heading-20">ä¸ºä»€ä¹ˆæœ‰è¿™ä¹ˆå¤š"O"ï¼Ÿ</h4>
<p><strong>1990å¹´ä»£</strong>ï¼Œä¸‰å±‚æ¶æ„å…´èµ·ï¼š</p>
<ul>
<li>è¡¨ç¤ºå±‚ï¼ˆç”¨æˆ·ç•Œé¢ï¼‰</li>
<li>ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆä¸šåŠ¡å¤„ç†ï¼‰</li>
<li>æ•°æ®è®¿é—®å±‚ï¼ˆæ•°æ®æŒä¹…åŒ–ï¼‰</li>
</ul>
<p>ä¸åŒå±‚éœ€è¦ä¸åŒçš„å¯¹è±¡ç±»å‹æ¥æ‰¿è½½æ•°æ®ï¼Œäºæ˜¯å„ç§"O"å°±å‡ºç°äº†ã€‚</p>
<p><strong>2000å¹´ä»£</strong>ï¼ŒJava EEæ ‡å‡†åŒ–äº†è¿™äº›å‘½åï¼Œå½¢æˆäº†ä»Šå¤©æˆ‘ä»¬çœ‹åˆ°çš„å„ç§"O"ã€‚</p>
<h4 data-id="heading-21">å„ç§"O"éƒ½æ˜¯å•¥ï¼Ÿ</h4>
<p><strong>1. POJO</strong> - æœ€åŸºç¡€çš„å¯¹è±¡ï¼Œä¸ä¾èµ–ä»»ä½•æ¡†æ¶</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">//Â çº¯ç²¹çš„Javaå¯¹è±¡ï¼Œæ²¡æœ‰ä»»ä½•æ¡†æ¶ä¾èµ–</span>
<span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">User</span>Â {
Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-built_in">Long</span>Â id;
Â Â Â Â <span class="hljs-keyword">private</span>Â StringÂ username;
Â Â Â Â <span class="hljs-comment">//Â getter/setter</span>
}
</code></pre>
<p><strong>2. DO</strong> - æ•°æ®å¯¹è±¡ï¼Œå¯¹åº”æ•°æ®åº“è¡¨</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">//Â å¯¹åº”æ•°æ®åº“è¡¨ç»“æ„</span>
<span class="hljs-meta">@Table(nameÂ =Â <span class="hljs-string">"t_user"</span>)</span>
<span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">UserDO</span>Â {
Â Â Â Â <span class="hljs-meta">@Id</span>
Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-built_in">Long</span>Â id;
Â Â Â Â <span class="hljs-meta">@Column(nameÂ =Â <span class="hljs-string">"username"</span>)</span>
Â Â Â Â <span class="hljs-keyword">private</span>Â StringÂ username;
}
</code></pre>
<p><strong>3. DTO</strong> - æ•°æ®ä¼ è¾“å¯¹è±¡ï¼Œç”¨äºAPIæ¥å£</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">//Â ç”¨äºAPIæ¥å£çš„æ•°æ®ä¼ è¾“ï¼Œå¯èƒ½ä¸åŒ…å«æ•æ„Ÿä¿¡æ¯</span>
<span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">UserDTO</span>Â {
Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-built_in">Long</span>Â id;
Â Â Â Â <span class="hljs-keyword">private</span>Â StringÂ username;
Â Â Â Â <span class="hljs-comment">//Â æ²¡æœ‰passwordå­—æ®µ</span>
}
</code></pre>
<p><strong>4. VO</strong> - å€¼å¯¹è±¡ï¼Œç”¨äºå‰ç«¯å±•ç¤º</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">//Â ç”¨äºå‰ç«¯å±•ç¤ºï¼Œå¯èƒ½åŒ…å«æ ¼å¼åŒ–åçš„æ•°æ®</span>
<span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">UserVO</span>Â {
Â Â Â Â <span class="hljs-keyword">private</span>Â LongÂ id;
Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-type">String</span>Â username;
Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-type">String</span>Â ageGroup;Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â "é’å¹´"ã€"ä¸­å¹´"ç­‰</span>
Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-type">String</span>Â formattedTime;Â Â Â <span class="hljs-comment">//Â æ ¼å¼åŒ–åçš„æ—¶é—´</span>
}
</code></pre>
<p><strong>5. BO</strong> - ä¸šåŠ¡å¯¹è±¡ï¼ŒåŒ…å«ä¸šåŠ¡é€»è¾‘</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">//Â åŒ…å«ä¸šåŠ¡é€»è¾‘å’Œä¸šåŠ¡è§„åˆ™</span>
<span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">UserBO</span>Â {
Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-title class_">Long</span>Â id;
Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">OrderBO</span>&gt;Â orders;
Â Â Â Â 
Â Â Â Â <span class="hljs-comment">//Â ä¸šåŠ¡æ–¹æ³•</span>
Â Â Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-built_in">boolean</span>Â <span class="hljs-title function_">isAdult</span>(<span class="hljs-params"/>)Â {
Â Â Â Â Â Â Â Â <span class="hljs-keyword">return</span>Â ageÂ !=Â <span class="hljs-literal">null</span>Â &amp;&amp;Â ageÂ &gt;=Â <span class="hljs-number">18</span>;
Â Â Â Â }
Â Â Â Â 
Â Â Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-built_in">boolean</span>Â <span class="hljs-title function_">canPlaceOrder</span>(<span class="hljs-params"/>)Â {
Â Â Â Â Â Â Â Â <span class="hljs-keyword">return</span>Â <span class="hljs-title function_">isAdult</span>()Â &amp;&amp;Â orders.<span class="hljs-title function_">size</span>()Â &lt;Â <span class="hljs-number">100</span>;
Â Â Â Â }
}
</code></pre>
<p><strong>6. DAO</strong> - æ•°æ®è®¿é—®å¯¹è±¡ï¼Œå°è£…æ•°æ®åº“æ“ä½œ</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//Â æ•°æ®è®¿é—®å±‚</span>
<span class="hljs-meta">@Repository</span>
<span class="hljs-keyword">public</span>Â <span class="hljs-keyword">interface</span>Â <span class="hljs-title class_">UserDAO</span>Â <span class="hljs-keyword">extends</span>Â <span class="hljs-title class_">BaseMapper</span>&lt;UserDO&gt;Â {
Â Â Â Â UserDOÂ <span class="hljs-title function_">findByUsername</span><span class="hljs-params">(StringÂ username)</span>;
}
</code></pre>
<p>è¯´å®è¯ï¼Œå°é¡¹ç›®ä¸ä¸€å®šéœ€è¦è¿™ä¹ˆå¤šç±»å‹ï¼Œä½†å¤§é¡¹ç›®ç¡®å®éœ€è¦åŒºåˆ†æ¸…æ¥šï¼Œä¸ç„¶ä»£ç ä¼šä¹±æˆä¸€å›¢ã€‚</p>
<h4 data-id="heading-22">å¯¹è±¡ç±»å‹ä¹‹é—´çš„è½¬æ¢</h4>
<p>å®é™…å¼€å‘ä¸­ï¼Œç»å¸¸éœ€è¦åœ¨ä¸åŒå¯¹è±¡ç±»å‹ä¹‹é—´è½¬æ¢ã€‚å¯ä»¥æ‰‹åŠ¨å†™è½¬æ¢æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥ç”¨MapStructè‡ªåŠ¨ç”Ÿæˆï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">//Â æ‰‹åŠ¨è½¬æ¢ï¼ˆå†™å¤šäº†å¾ˆçƒ¦ï¼‰</span>
publicÂ staticÂ UserDTOÂ <span class="hljs-built_in">toDTO</span>(UserDOÂ userDO)Â {
Â Â Â Â UserDTOÂ dtoÂ =Â newÂ <span class="hljs-built_in">UserDTO</span>();
Â Â Â Â dto<span class="hljs-selector-class">.setId</span>(userDO.getId());
Â Â Â Â dto<span class="hljs-selector-class">.setUsername</span>(userDO.getUsername());
Â Â Â Â returnÂ dto;
}

<span class="hljs-comment">//Â ç”¨MapStructè‡ªåŠ¨ç”Ÿæˆï¼ˆæ¨èï¼‰</span>
<span class="hljs-keyword">@Mapper</span>(componentModelÂ =Â <span class="hljs-string">"spring"</span>)
publicÂ interfaceÂ UserMapperÂ {
Â Â Â Â UserDTOÂ <span class="hljs-built_in">toDTO</span>(UserDOÂ userDO);
Â Â Â Â UserVOÂ <span class="hljs-built_in">toVO</span>(UserDOÂ userDO);
}
</code></pre>
<h4 data-id="heading-23">å®é™…åº”ç”¨</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">//Â Controllerå±‚ï¼šæ¥æ”¶DTOï¼Œè¿”å›VO</span>
<span class="hljs-meta">@GetMapping(<span class="hljs-string">"/{id}"</span>)</span>
<span class="hljs-keyword">public</span>Â UserVOÂ getUser(<span class="hljs-meta">@PathVariable</span>Â <span class="hljs-built_in">Long</span>Â id)Â {
Â Â Â Â UserBOÂ boÂ =Â userService.getUserById(id);
Â Â Â Â <span class="hljs-keyword">return</span>Â UserConverter.toVO(bo);
}

<span class="hljs-comment">//Â Serviceå±‚ï¼šä½¿ç”¨BOå¤„ç†ä¸šåŠ¡é€»è¾‘</span>
<span class="hljs-keyword">public</span>Â UserBOÂ getUserById(<span class="hljs-built_in">Long</span>Â id)Â {
Â Â Â Â UserDOÂ <span class="hljs-keyword">do</span>Â =Â userDAO.selectById(id);
Â Â Â Â UserBOÂ boÂ =Â UserConverter.toBO(<span class="hljs-keyword">do</span>);
Â Â Â Â <span class="hljs-comment">//Â ä¸šåŠ¡é€»è¾‘å¤„ç†</span>
Â Â Â Â <span class="hljs-keyword">return</span>Â bo;
}
</code></pre>
<h4 data-id="heading-24">å¯¹è±¡ç±»å‹çš„å¯¹æ¯”æ€»ç»“</h4>






















































<table><thead><tr><th>å¯¹è±¡ç±»å‹</th><th>å…¨ç§°</th><th>ç”¨é€”</th><th>ç‰¹ç‚¹</th><th>ä½¿ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>POJO</td><td>Plain Old Java Object</td><td>åŸºç¡€å¯¹è±¡</td><td>æ— æ¡†æ¶ä¾èµ–</td><td>æ‰€æœ‰åœºæ™¯çš„åŸºç¡€</td></tr><tr><td>DO</td><td>Data Object</td><td>æ•°æ®æŒä¹…åŒ–</td><td>å¯¹åº”æ•°æ®åº“è¡¨</td><td>æ•°æ®è®¿é—®å±‚</td></tr><tr><td>DTO</td><td>Data Transfer Object</td><td>æ•°æ®ä¼ è¾“</td><td>è·¨å±‚/è·¨æœåŠ¡ä¼ è¾“</td><td>APIæ¥å£ã€æœåŠ¡é—´é€šä¿¡</td></tr><tr><td>VO</td><td>Value Object</td><td>å€¼å¯¹è±¡</td><td>å±•ç¤ºæ•°æ®</td><td>å‰ç«¯å±•ç¤º</td></tr><tr><td>BO</td><td>Business Object</td><td>ä¸šåŠ¡å¯¹è±¡</td><td>åŒ…å«ä¸šåŠ¡é€»è¾‘</td><td>ä¸šåŠ¡é€»è¾‘å±‚</td></tr><tr><td>DAO</td><td>Data Access Object</td><td>æ•°æ®è®¿é—®</td><td>å°è£…æ•°æ®åº“æ“ä½œ</td><td>æ•°æ®è®¿é—®å±‚</td></tr></tbody></table>
<h4 data-id="heading-25">æœ€ä½³å®è·µ</h4>
<ol>
<li><strong>æ˜ç¡®èŒè´£</strong>ï¼šæ¯ä¸ªå¯¹è±¡ç±»å‹éƒ½æœ‰æ˜ç¡®çš„èŒè´£ï¼Œä¸è¦æ··ç”¨</li>
<li><strong>é¿å…è¿‡åº¦è®¾è®¡</strong>ï¼šå°é¡¹ç›®å¯ä»¥ç®€åŒ–ï¼Œä¸ä¸€å®šéœ€è¦æ‰€æœ‰å¯¹è±¡ç±»å‹</li>
<li><strong>ä½¿ç”¨å·¥å…·</strong>ï¼šä½¿ç”¨MapStructã€BeanUtilsç­‰å·¥å…·ç®€åŒ–è½¬æ¢</li>
<li><strong>ä¿æŒä¸€è‡´æ€§</strong>ï¼šå›¢é˜Ÿå†…éƒ¨ç»Ÿä¸€å‘½åå’ŒèŒè´£å®šä¹‰</li>
<li><strong>æ–‡æ¡£è¯´æ˜</strong>ï¼šåœ¨é¡¹ç›®æ–‡æ¡£ä¸­æ˜ç¡®å„ç§å¯¹è±¡ç±»å‹çš„å®šä¹‰å’Œä½¿ç”¨åœºæ™¯</li>
</ol>
<hr/>
<h3 data-id="heading-26">å…¶ä»–é‡è¦çš„"O"</h3>
<h4 data-id="heading-27">Observeræ¨¡å¼ - è§‚å¯Ÿè€…æ¨¡å¼</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span>Â <span class="hljs-title class_">Observer</span>Â {
Â Â Â Â <span class="hljs-built_in">void</span>Â <span class="hljs-title function_">update</span>(<span class="hljs-title class_">String</span>Â message);
}

<span class="hljs-keyword">class</span>Â <span class="hljs-title class_">Subject</span>Â {
Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">Observer</span>&gt;Â observersÂ =Â <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
Â Â Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-built_in">void</span>Â <span class="hljs-title function_">notifyObservers</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>Â message</span>)Â {
Â Â Â Â Â Â Â Â observers.<span class="hljs-title function_">forEach</span>(obsÂ -&gt;Â obs.<span class="hljs-title function_">update</span>(message));
Â Â Â Â }
}
</code></pre>
<h4 data-id="heading-28">Overrideæ³¨è§£ - æ–¹æ³•é‡å†™æ ‡è®°</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span>Â <span class="hljs-title class_">Child</span>Â <span class="hljs-keyword">extends</span>Â <span class="hljs-title class_">Parent</span>Â {
Â Â Â Â <span class="hljs-meta">@Override</span>Â Â <span class="hljs-comment">//Â æ˜ç¡®æ ‡è®°è¿™æ˜¯é‡å†™æ–¹æ³•</span>
Â Â Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-keyword">void</span>Â <span class="hljs-title function_">method</span><span class="hljs-params">()</span>Â {Â <span class="hljs-comment">/*Â ...Â */</span>Â }
}
</code></pre>
<p>Java 5å¼•å…¥æ³¨è§£åï¼Œ@Overrideå¸®åŠ©é¿å…æ‹¼å†™é”™è¯¯ã€‚</p>
<h4 data-id="heading-29">Overload - æ–¹æ³•é‡è½½</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">//Â åŒåæ–¹æ³•ï¼Œä¸åŒå‚æ•°</span>
<span class="hljs-function"><span class="hljs-keyword">public</span>Â <span class="hljs-type">int</span>Â <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-type">int</span>Â a,Â <span class="hljs-type">int</span>Â b)</span>Â </span>{Â <span class="hljs-keyword">return</span>Â aÂ +Â b;Â }
<span class="hljs-function"><span class="hljs-keyword">public</span>Â <span class="hljs-type">double</span>Â <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-type">double</span>Â a,Â <span class="hljs-type">double</span>Â b)</span>Â </span>{Â <span class="hljs-keyword">return</span>Â aÂ +Â b;Â }
</code></pre>
<hr/>
<h3 data-id="heading-30">æ€»ç»“</h3>
<h4 data-id="heading-31">æ—¶é—´çº¿å›é¡¾</h4>





































<table><thead><tr><th>æ—¶é—´</th><th>äº‹ä»¶</th></tr></thead><tbody><tr><td>1894å¹´</td><td>å·´èµ«æ›¼å¼•å…¥å¤§Oç¬¦å·</td></tr><tr><td>1960å¹´ä»£</td><td>Simulaå¼•å…¥OOPæ¦‚å¿µ</td></tr><tr><td>1965å¹´</td><td>nullå¼•ç”¨çš„è¯ç”Ÿï¼ˆ"åäº¿ç¾å…ƒçš„é”™è¯¯"ï¼‰</td></tr><tr><td>1968å¹´</td><td>å…‹åŠªç‰¹å°†å¤§Oå¼•å…¥è®¡ç®—æœºç§‘å­¦</td></tr><tr><td>1995å¹´</td><td>Javaå‘å¸ƒï¼ŒObjectç±»è¯ç”Ÿ</td></tr><tr><td>2000å¹´</td><td>POJOæ¦‚å¿µæå‡º</td></tr><tr><td>2014å¹´</td><td>Java 8å‘å¸ƒï¼Œå¼•å…¥Optional</td></tr></tbody></table>
<h4 data-id="heading-32">æ ¸å¿ƒè¦ç‚¹</h4>
<ol>
<li><strong>Big O</strong> - ç†è§£ç®—æ³•æ€§èƒ½ï¼Œé¢è¯•å¿…å¤‡</li>
<li><strong>OOP</strong> - Javaçš„ç¼–ç¨‹å“²å­¦ï¼Œå¿…é¡»æŒæ¡</li>
<li><strong>Optional</strong> - ä¼˜é›…å¤„ç†nullï¼Œå‘Šåˆ«NullPointerException</li>
<li><strong>Object</strong> - æ‰€æœ‰ç±»çš„æ ¹åŸºï¼Œç†è§£Javaçš„åŸºç¡€</li>
<li><strong>å„ç§å¯¹è±¡ç±»å‹</strong> - åˆ†å±‚æ¶æ„çš„ä½“ç°ï¼Œå¤§é¡¹ç›®å¿…é¡»åŒºåˆ†æ¸…æ¥š</li>
</ol>
<h4 data-id="heading-33">å­¦ä¹ å»ºè®®</h4>
<ol>
<li><strong>Big O</strong> - å¤šåˆ·LeetCodeï¼ŒåŸ¹å…»å¤æ‚åº¦åˆ†æçš„ç›´è§‰</li>
<li><strong>OOP</strong> - å¤šå†™ä»£ç ï¼Œç†è§£å°è£…ã€ç»§æ‰¿ã€å¤šæ€ã€æŠ½è±¡</li>
<li><strong>Optional</strong> - åœ¨é¡¹ç›®ä¸­å¤šç”¨ï¼Œä½†åˆ«è¿‡åº¦ä½¿ç”¨</li>
<li><strong>Object</strong> - ç†è§£equals/hashCodeçš„å…³ç³»ï¼Œè¿™æ˜¯åŸºç¡€</li>
<li><strong>å¯¹è±¡ç±»å‹</strong> - å°é¡¹ç›®å¯ä»¥ç®€åŒ–ï¼Œå¤§é¡¹ç›®å¿…é¡»åŒºåˆ†æ¸…æ¥š</li>
</ol>
<hr/>
<h3 data-id="heading-34">å»¶ä¼¸é˜…è¯»</h3>
<ul>
<li>ã€Šç®—æ³•å¯¼è®ºã€‹- å¤§Oè¡¨ç¤ºæ³•çš„æ•°å­¦åŸºç¡€</li>
<li>ã€Šè®¾è®¡æ¨¡å¼ï¼šå¯å¤ç”¨é¢å‘å¯¹è±¡è½¯ä»¶çš„åŸºç¡€ã€‹- OOPçš„è®¾è®¡æ¨¡å¼</li>
<li>ã€ŠEffective Javaã€‹- Javaæœ€ä½³å®è·µï¼ŒåŒ…æ‹¬Optionalçš„ä½¿ç”¨</li>
<li>ã€ŠJavaå¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‹- Objectçš„wait/notifyæœºåˆ¶</li>
<li>ã€Šä¼ä¸šåº”ç”¨æ¶æ„æ¨¡å¼ã€‹- Martin Fowlerï¼ŒDTOæ¨¡å¼çš„æå‡ºè€…</li>
<li>ã€Šé¢†åŸŸé©±åŠ¨è®¾è®¡ã€‹- Eric Evansï¼ŒVOå’ŒBOçš„ç†è®ºåŸºç¡€</li>
<li>ã€Šé‡æ„ï¼šæ”¹å–„æ—¢æœ‰ä»£ç çš„è®¾è®¡ã€‹- Martin Fowlerï¼ŒPOJOçš„æœ€ä½³å®è·µ</li>
</ul>
<hr/>
<p><strong>å†™åœ¨æœ€å</strong>ï¼š</p>
<p>è¯´å®è¯ï¼Œåˆšå¼€å§‹å­¦Javaçš„æ—¶å€™ï¼Œæˆ‘ä¹Ÿè¢«è¿™äº›"O"ææ‡µè¿‡ã€‚ä½†å†™å¤šäº†ä»£ç ï¼Œè¸©äº†æ— æ•°å‘ä¹‹åï¼Œæ‰æ…¢æ…¢ç†è§£å®ƒä»¬èƒŒåçš„æ€æƒ³ã€‚</p>
<p>ä»æ•°å­¦ç¬¦å·åˆ°ç¼–ç¨‹èŒƒå¼ï¼Œä»ç©ºå€¼å¤„ç†åˆ°ç±»å‹ç³»ç»Ÿï¼Œæ¯ä¸€ä¸ª"O"éƒ½æ‰¿è½½ç€è®¡ç®—æœºç§‘å­¦çš„å‘å±•å†ç¨‹ã€‚</p>
<p>ç†è§£è¿™äº›"O"çš„å‰ä¸–ä»Šç”Ÿï¼Œä¸ä»…èƒ½å¸®æˆ‘ä»¬å†™å‡ºæ›´å¥½çš„ä»£ç ï¼Œæ›´èƒ½è®©æˆ‘ä»¬ç«™åœ¨å·¨äººçš„è‚©è†€ä¸Šï¼Œçœ‹åˆ°ç¼–ç¨‹è¯­è¨€è®¾è®¡çš„æ™ºæ…§ã€‚</p>
<p>è®°ä½ï¼š<strong>æŠ€æœ¯ä¼šå˜ï¼Œä½†æ€æƒ³æ°¸æ’ã€‚æŒæ¡è¿™äº›"O"èƒŒåçš„æ€æƒ³ï¼Œæ¯”è®°ä½è¯­æ³•æ›´é‡è¦ã€‚</strong></p>
<p>æœ¬æ–‡ä½¿ç”¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fmarkdown.com.cn" target="_blank" title="https://markdown.com.cn" ref="nofollow noopener noreferrer">markdown.com.cn</a> æ’ç‰ˆ</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åˆæ¢ollamaåˆ©ç”¨dockeræç®€éƒ¨ç½²å±äºè‡ªå·±çš„å¤§æ¨¡å‹]]></title>    <link>https://juejin.cn/post/7598818096728850470</link>    <guid>https://juejin.cn/post/7598818096728850470</guid>    <pubDate>2026-01-24T07:32:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598818096728850470" data-draft-id="7598218938758627366" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åˆæ¢ollamaåˆ©ç”¨dockeræç®€éƒ¨ç½²å±äºè‡ªå·±çš„å¤§æ¨¡å‹"/> <meta itemprop="keywords" content="Ollama"/> <meta itemprop="datePublished" content="2026-01-24T07:32:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="yezannnnnn"/> <meta itemprop="url" content="https://juejin.cn/user/958429869908247"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åˆæ¢ollamaåˆ©ç”¨dockeræç®€éƒ¨ç½²å±äºè‡ªå·±çš„å¤§æ¨¡å‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/958429869908247/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    yezannnnnn
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T07:32:35.000Z" title="Sat Jan 24 2026 07:32:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{font-family:-apple-system,system-ui,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial;color:#00325e}.markdown-body ::selection{background-color:#00325e;color:#fff}.markdown-body blockquote{padding:10px 20px;background-color:#fffaf0;box-shadow:0 3px 10px 0 rgba(255,172,194,.24);border:1px solid #f3ca8e;transition:all .2s;margin:1em 0;border-radius:5px}.markdown-body blockquote p{font-size:14px;line-height:25px;color:#795548}.markdown-body blockquote p:last-child{margin:0}.markdown-body blockquote:hover{border-color:#ff9800;background-color:#fff8e0;box-shadow:0 6px 10px -5px rgba(225,173,98,.3803921569)}.markdown-body blockquote code{color:#ff502c}.markdown-body pre{border:1px solid #8cc0f3;box-shadow:0 3px 10px 0 rgba(255,198,198,.28);border-radius:5px;transition:all .2s;overflow-x:auto;white-space:pre-wrap}.markdown-body pre:hover{border-color:#6d9dce}.markdown-body pre&gt;code{padding:10px 20px;color:#00325e;background:#f0f8ff;font-size:12px;line-height:1.6;display:block}.markdown-body code{background:#f6fbff;color:#0b5393;padding:2px 4px;border-radius:4px;font-size:12px}.markdown-body p{font-size:14px;line-height:28px;text-align:justify;margin-bottom:17px;color:#595959}.markdown-body a{color:#00325e;text-decoration:none}.markdown-body a:after{content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAAXNSR0IArs4c6QAAAQdJREFUKFNt0DtLA0EUBeBzZle0Eks7rcUfEfBRCha7NorYa6NmVJzgyi4smUgKtdZGCJktLMVH4Y8QeztLWyE7VyLEuNFbXj4Oh0P8c8mZm+uJrEN4BJFTeP/MUVe3bnocfALwkOlo1zS7iZAzf6Cx7oXgbaqjxiDEWCcVaGyxQ8pSWo9XhqhoQ/xUFbaKjhe5V+CmR7mnSplEEF6GSmJ+F/d0KHvbCIIJCLc85U6BC5mONgbJNM3uFag++sX7z8O8MzsWBucifMx0dDGE1kmm458KDVukAlnNdDz/exEeW3dNkbfsYC0xtmgDWP6ELLZ0/F6BJu/UoFQN5AkoeUjeJPvx6+i+X5Sjah4tA6gYAAAAAElFTkSuQmCC);margin-left:2px}.markdown-body a:hover{box-shadow:0 1px}.markdown-body table{max-width:100%;border-collapse:collapse;border-spacing:0;box-shadow:0 3px 10px 0 rgba(255,238,172,.24);transition:all .2s}.markdown-body table:hover{box-shadow:0 3px 10px 0 rgba(185,169,103,.24)}.markdown-body table tr th{border:1px solid #8cc0f3;background-color:#f0f8ff;padding:12px 15px}.markdown-body table tr td{border:1px solid rgba(243,202,142,.4);padding:12px 15px}.markdown-body table tbody tr{transition:all .2s}.markdown-body table tbody tr:hover td{border-color:#f3ca8e;background-color:#fff8e0;z-index:1}.markdown-body img{max-width:100%}.markdown-body h1{font-size:20px;margin-top:30px;margin-bottom:10px;padding-left:30px;position:relative}.markdown-body h1&gt;code{font-size:20px}.markdown-body h1:before{content:"ğŸº";display:block;font-size:18px;width:18px;height:18px;left:0;position:absolute}.markdown-body h2{font-size:18px;margin-top:30px;margin-bottom:10px;padding-left:28px;position:relative}.markdown-body h2&gt;code{font-size:18px}.markdown-body h2:before{content:"ğŸ»";display:block;font-size:16px;width:16px;height:16px;left:0;position:absolute}.markdown-body h3{font-size:16px;margin-top:30px;margin-bottom:10px;padding-left:26px;position:relative}.markdown-body h3&gt;code{font-size:16px}.markdown-body h3:before{content:"ğŸ¥‚";display:block;font-size:14px;width:14px;height:14px;left:0;position:absolute}.markdown-body h4{font-size:14px;margin-top:30px;margin-bottom:10px;padding-left:24px;position:relative}.markdown-body h4&gt;code{font-size:14px}.markdown-body h4:before{content:"ğŸ¥ƒ";display:block;font-size:12px;width:12px;height:12px;left:0;position:absolute}.markdown-body h5{font-size:12px;margin-top:30px;margin-bottom:10px}.markdown-body h5&gt;code{font-size:12px}.markdown-body h6{font-size:10px;margin-top:30px;margin-bottom:10px}.markdown-body h6&gt;code{font-size:10px}.markdown-body h1,.markdown-body h2{color:#ff502c}.markdown-body hr{height:4px;border:none;margin-top:32px;margin-bottom:32px;background-size:4px 1px;background-image:linear-gradient(270deg,#6d9dce,#8cc0f3 25%,transparent 50%)}.markdown-body hr:nth-child(2n){background-image:linear-gradient(270deg,#ff9800,#fff8e0 25%,transparent 50%)}.markdown-body ul{padding-inline-start:20px}.markdown-body ul li{list-style-type:"ğŸ”¸"}.markdown-body ul li li{list-style-type:"â—»ï¸"}.markdown-body ul li li li{list-style-type:"â–«ï¸"}.markdown-body ol{padding-inline-start:20px}.markdown-body ol ::marker{color:#ff9800}.markdown-body ol,.markdown-body ul{line-height:2em}.markdown-body li{padding-inline-start:1ch}.markdown-body li.task-list-item{list-style:none;padding-inline-start:0}.markdown-body li input{padding-right:2px}.markdown-body li input[type=checkbox i]{appearance:none}.markdown-body li input:before{content:"ğŸŸ©";display:block;width:13px;height:13px}.markdown-body li input:checked:before{content:"âœ…"}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atelier-sulphurpool-light">.hljs-comment,.hljs-quote{color:#6b7394}.hljs-attribute,.hljs-link,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#c94922}.hljs-built_in,.hljs-builtin-name,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#c76b29}.hljs-bullet,.hljs-string,.hljs-symbol{color:#ac9739}.hljs-section,.hljs-title{color:#3d8fd1}.hljs-keyword,.hljs-selector-tag{color:#6679cc}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#f5f7ff;color:#5e6687}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">å‰è¨€</h3>
<p>éšç€å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„æ™®åŠï¼Œè¶Šæ¥è¶Šå¤šçš„å¼€å‘è€…å¸Œæœ›åœ¨æœ¬åœ°æˆ–ç§æœ‰ç¯å¢ƒä¸­å¿«é€Ÿæ„å»ºå±äºè‡ªå·±çš„æ¨¡å‹æœåŠ¡ã€‚æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•åˆ©ç”¨Â <code>Ollama</code>Â è¿™ä¸€å¼€æºå·¥å…·ï¼Œåœ¨ Docker ç¯å¢ƒä¸‹å¿«é€Ÿæ­å»ºå¤§æ¨¡å‹æœåŠ¡ã€‚</p>
<p>æœ¬æ–‡å°†ä»¥ <code>macOS</code> ç¯å¢ƒä¸ºä¾‹ï¼Œä»é›¶å¼€å§‹è®°å½•éƒ¨ç½²å…¨è¿‡ç¨‹ï¼Œå¹¶é’ˆå¯¹è¿‡ç¨‹ä¸­é‡åˆ°çš„ç½‘ç»œã€å†…å­˜é…ç½®ç­‰å¸¸è§é—®é¢˜æä¾›è§£å†³æ–¹æ¡ˆï¼Œä¾›å¤§å®¶å‚è€ƒã€‚</p>
<p><code>æ°´å¹³æœ‰é™åªæ˜¯åˆ†äº«ï¼Œå¤§å®¶å–å…¶ç²¾åï¼Œå»å…¶ç³Ÿç²•</code></p>
<h3 data-id="heading-1">ä»‹ç»Ollama</h3>
<p>Ollama æ˜¯ä¸€ä¸ªå¼€æºå·¥å…·ï¼Œæ—¨åœ¨ç®€åŒ–å¤§è¯­è¨€æ¨¡å‹åœ¨æœ¬åœ°è®¾å¤‡çš„éƒ¨ç½²å’Œè¿è¡Œã€‚å®ƒæ”¯æŒä¸€é”®ä¸‹è½½å’Œè¿è¡Œ<code>Llama 3</code>ã€<code>Qwen</code> ç­‰ä¸»æµå¼€æºæ¨¡å‹ï¼Œæ— éœ€å¤æ‚çš„é…ç½®ã€‚åŒæ—¶ï¼Œå®ƒæä¾›æœ¬åœ° <code>API</code> æœåŠ¡ï¼Œèƒ½æ–¹ä¾¿åœ°é›†æˆåˆ°å„ç±»åº”ç”¨ä¸­ï¼Œä¿æŠ¤æ•°æ®éšç§ä¸”é›¶æˆæœ¬ã€‚</p>
<h3 data-id="heading-2">éƒ¨ç½²å®‰è£…åŠè¿è¡Œ</h3>
<h4 data-id="heading-3">ä¸€ã€å®‰è£…docker</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">brewæ¥å®‰è£…docker</span>
brewÂ installÂ --cask docker
<span class="hljs-meta prompt_"># </span><span class="bash">æ£€éªŒæ˜¯å¦dockerå®‰è£…å¹¶è¿è¡ŒæˆåŠŸ</span>
docker ps
</code></pre>
<p>å‡ºç°ä»¥ä¸‹æˆªå›¾åˆ™è¡¨ç¤º<code>docker</code>å·²ç»æˆåŠŸè¿è¡Œåœ¨åå°ä¸­</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/00eabfab8d1d4c93b7ddc2bb388e2c41~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeWV6YW5ubm5ubg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769845147&amp;x-signature=BYzoKWQ4oViKKNMzHQjY0F63qL8%3D" alt="dockerç›®å½•è¿è¡ŒæˆåŠŸ.png" loading="lazy"/></p>
<h4 data-id="heading-4">äºŒã€dockerä¸‹è¿è¡ŒOllama</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">æ‹‰å–å®˜æ–¹dockeræº</span>
docker pull ollama/ollama
<span class="hljs-meta prompt_"># </span><span class="bash">æŒ‡å®šå·ç¬¦ç›®å½•è¿è¡Œæ¨¡å‹ï¼ˆè¿™æ ·æ¨¡å‹ä¸‹è½½åä¸‹æ¬¡è¿è¡Œä¸ç”¨å†ä¸‹è½½ï¼‰</span>
<span class="hljs-meta prompt_"># </span><span class="bash">  `-d`ï¼šåœ¨åå°è¿è¡Œå®¹å™¨ã€‚</span>
<span class="hljs-meta prompt_"># </span><span class="bash">  `--name my-ollama`ï¼šä¸ºä½ çš„å®¹å™¨æŒ‡å®šçš„åç§°ã€‚</span>
<span class="hljs-meta prompt_"># </span><span class="bash">  `-p 11434:11434`ï¼šå°† Ollama çš„é»˜è®¤ç«¯å£æ˜ å°„åˆ°ä½ çš„å®¿ä¸»æœºå™¨ã€‚</span>
<span class="hljs-meta prompt_"># </span><span class="bash">  `-v ollama:/root/.ollama`ï¼šä¸ºä¸‹è½½çš„æ¨¡å‹åˆ›å»ºäº†ä¸€ä¸ªæŒä¹…åŒ–å·ï¼ˆvolumeï¼‰ã€‚</span>
docker run -d -v ollama:/root/.ollama -p 11434:11434 --name my-ollama ollama/ollama
<span class="hljs-meta prompt_">#</span><span class="bash"><span class="hljs-comment"># æ£€æŸ¥æŒ‡å®šå·ç¬¦ä¸‹æ˜¯å¦åˆ›å»ºollamaå®¹å™¨</span></span>
docker ps -a 
</code></pre>
<p>å‡ºç°ä»¥ä¸‹æˆªå›¾åˆ™è¡¨ç¤ºåˆ›å»ºå®¹å™¨æˆåŠŸ</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d079ca94e2af4dd590da0dc96b0c656b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeWV6YW5ubm5ubg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769845147&amp;x-signature=9h%2BsZ1aXyJrOU7u7r9aN0CF%2F6IQ%3D" alt="image.png" loading="lazy"/></p>
<p>å¹¶ä¸”çœ‹çœ‹ <strong>localhost:11434</strong>æ˜¯å¦å·²ç»æˆåŠŸç›‘å¬è¿è¡ŒæˆåŠŸ</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/546f5715898c4838b5e64a92e620b763~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeWV6YW5ubm5ubg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769845147&amp;x-signature=beDGyEWyqRXzs5nLlE4fe2zO43s%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-5">ä¸‰ã€Ollamaè¿è¡Œæ¨¡å‹</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">æŒ‰ç…§ollamaçš„å®˜æ–¹æ–‡æ¡£ä¸‹è½½gemma3æ¨¡å‹</span>
docker exec -it my-ollama ollama pull gemma3
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e2cc8ea18894474aec2fe4e5d92750b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeWV6YW5ubm5ubg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769845147&amp;x-signature=EuoHST%2B98klX5l1XiNyE6L%2BKg%2B4%3D" alt="image.png" loading="lazy"/></p>
<p>å¥½äº†ä¸€åˆ‡éƒ½å·²ç»å‡†å¤‡å°±ç»ªäº† é‚£æœ¬åœ°æ¨¡å‹å·²ç»æˆåŠŸè¿è¡Œäº†ï¼Œèµ¶ç´§è¯•è¯•æ•ˆæœæ€ä¹ˆæ ·ã€‚</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">æŒ‰ç…§ollamaçš„å®˜æ–¹æ–‡æ¡£ç›´æ¥æµ‹è¯•ä¸€ä¸‹å§</span>
curl http://localhost:11434/api/chat -d '{
  "model": "gemma3",
  "messages": [{
    "role": "user",
    "content": "ollamaæ˜¯ä»€ä¹ˆæœ‰ä»€ä¹ˆç”¨"
  }],
  "stream": false
}'
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f4358c7ce2fb4fd9bbf4626c8e91b0fc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeWV6YW5ubm5ubg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769845147&amp;x-signature=EfZ%2Ff8yjoBap3fZcHenjPV5RMUw%3D" alt="image.png" loading="lazy"/>
åŸºæœ¬ä¸Š<code>ollama</code>æœ¬åœ°éƒ¨ç½²è‡ªå·±çš„å¤§æ¨¡å‹å°±å®Œæˆäº†ï¼Œè‡ªå·±æ…¢æ…¢æŠŠç©å§</p>
<h3 data-id="heading-6">éƒ¨ç½²è¿‡ç¨‹é—®é¢˜åŠè§£å†³</h3>
<blockquote>
<ul>
<li><strong>é—®é¢˜: æ‰§è¡Œdocker pullæŠ¥é”™å¦‚ä¸‹<code>context deadline exceeded</code></strong></li>
<li><strong>è§£å†³æ–¹æ³•ï¼šé—®é¢˜å‡ºåœ¨dockeré»˜è®¤æºdockerhubæ‹‰ä¸åˆ°æ¢æºå³å¯</strong>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/028859584b60445b89e8daa93f278dc7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeWV6YW5ubm5ubg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769845147&amp;x-signature=vGQSNJbKQ%2F14%2BWmiLqC%2Ft5K3kFg%3D" alt="image.png" loading="lazy"/></li>
</ul>
</blockquote>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// é…ç½®æ¢æºå³æœ‰æ•ˆ</span>
<span class="hljs-attr">"registry-mirrors"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"https://docker.registry.cyou"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"https://docker-cf.registry.cyou"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"https://dockercf.jsdelivr.fyi"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"https://docker.jsdelivr.fyi"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"https://dockertest.jsdelivr.fyi"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"https://mirror.aliyuncs.com"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"https://dockerproxy.com"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"https://mirror.baidubce.com"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"https://docker.m.daocloud.io"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"https://docker.nju.edu.cn"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"https://docker.mirrors.sjtug.sjtu.edu.cn"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"https://docker.mirrors.ustc.edu.cn"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"https://mirror.iscas.ac.cn"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"https://docker.rainbond.cc"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"https://do.nark.eu.org"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"https://dc.j8.work"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"https://dockerproxy.com"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"https://gst6rzl9.mirror.aliyuncs.com"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"https://registry.docker-cn.com"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"http://hub-mirror.c.163.com"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"http://mirrors.ustc.edu.cn/"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"https://mirrors.tuna.tsinghua.edu.cn/"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"http://mirrors.sohu.com/"</span>
  <span class="hljs-punctuation">]</span>
</code></pre>
<blockquote>
<ul>
<li><strong>é—®é¢˜: æ‰§è¡Œcurl <a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A11434%2Fapi%2Fchat" target="_blank" title="http://localhost:11434/api/chat" ref="nofollow noopener noreferrer">http://localhost:11434/api/chat</a> -d æŠ¥é”™å¦‚ä¸‹</strong></li>
<li><strong>è§£å†³ï¼šé—®é¢˜å‡ºåœ¨æœ¬åœ°å¼€å¯ä»£ç†ï¼Œè¯·å…³é—­ä»£ç†å³å¯æ­£å¸¸</strong>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/08d9f0d9ac5146acac243afdc550260f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeWV6YW5ubm5ubg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769845147&amp;x-signature=tQe7%2BACQIoH3kX7hkaOmGhlYA7g%3D" alt="image.png" loading="lazy"/></li>
</ul>
</blockquote>
<blockquote>
<ul>
<li><strong>é—®é¢˜: æ‰§è¡Œcurl <a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A11434%2Fapi%2Fchat" target="_blank" title="http://localhost:11434/api/chat" ref="nofollow noopener noreferrer">http://localhost:11434/api/chat</a> -d æŠ¥é”™è¿”å›å†…å®¹</strong></li>
<li><code>{"error":"model requires more system memory (4.8 GiB) than is available (3.8 GiB)"}</code></li>
<li><strong>è§£å†³ï¼šè°ƒæ•´dockeråˆ†é…çš„å†…å­˜å¤§å°å¦‚ä¸‹å›¾</strong>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64b12a32f2bf447a81f3f1c369ef4edc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeWV6YW5ubm5ubg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769845147&amp;x-signature=50BeSiuNI1CTSMQPmcl0KItN7GA%3D" alt="image.png" loading="lazy"/></li>
</ul>
</blockquote>
<h3 data-id="heading-7">ç»“è¯­</h3>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬å·²æˆåŠŸåœ¨æœ¬åœ°éƒ¨ç½²äº†å¤§æ¨¡å‹æœåŠ¡ï¼Œå¹¶å®ç°äº†æµå¼è¾“å‡ºï¼ˆstreamï¼‰ã€‚åç»­åªéœ€é€šè¿‡åç«¯è¿›è¡Œç®€å•å°è£…ï¼Œå³å¯æ‰“é€ ä¸“å±çš„ AI UI ç•Œé¢ã€‚ç„¶è€Œï¼Œå—é™äºæœ¬åœ°ç¡¬ä»¶ç®—åŠ›ï¼Œæ¨¡å‹ç”Ÿæˆå›ç­”å¹³å‡è€—æ—¶ 20-30 ç§’ï¼Œè¿™è®©æˆ‘æ·±åˆ»ä½“ä¼šåˆ°ï¼š<strong>åœ¨ AI æ—¶ä»£ï¼Œç®—åŠ›ç¡®å®æ˜¯å†³å®šä½“éªŒçš„æ ¸å¿ƒç”Ÿäº§åŠ›ã€‚</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Git Submoduleï¼šä¸“æ²»é¡¹ç›®åˆå¹¶ â€œå¤§ä¹±ç‚–â€]]></title>    <link>https://juejin.cn/post/7598418891401248822</link>    <guid>https://juejin.cn/post/7598418891401248822</guid>    <pubDate>2026-01-24T03:39:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598418891401248822" data-draft-id="7598099064443502655" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Git Submoduleï¼šä¸“æ²»é¡¹ç›®åˆå¹¶ â€œå¤§ä¹±ç‚–â€"/> <meta itemprop="keywords" content="è¿ç»´,æ•æ·å¼€å‘,Git"/> <meta itemprop="datePublished" content="2026-01-24T03:39:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è€å®å·´äº¤çš„éº»åŒª"/> <meta itemprop="url" content="https://juejin.cn/user/4218156332615384"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Git Submoduleï¼šä¸“æ²»é¡¹ç›®åˆå¹¶ â€œå¤§ä¹±ç‚–â€
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4218156332615384/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è€å®å·´äº¤çš„éº»åŒª
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T03:39:31.000Z" title="Sat Jan 24 2026 03:39:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child{margin-top:-1.5rem;margin-bottom:1rem}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{content:"#";display:inline-block;color:#3eaf7c;padding-right:.23em}.markdown-body h1{position:relative;font-size:2.5rem;margin-bottom:5px}.markdown-body h1:before{font-size:2.5rem}.markdown-body h2{padding-bottom:.5rem;font-size:2.2rem;border-bottom:1px solid #ececec}.markdown-body h3{font-size:1.5rem;padding-bottom:0}.markdown-body h4{font-size:1.25rem}.markdown-body h5{font-size:1rem}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body strong{color:#3eaf7c}.markdown-body img{max-width:100%;border-radius:2px;display:block;margin:auto;border:3px solid rgba(62,175,124,.2)}.markdown-body hr{border:none;border-top:1px solid #3eaf7c;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;overflow-x:auto;padding:.2rem .5rem;margin:0;color:#3eaf7c;font-weight:700;font-size:.85em;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border-radius:6px;border:2px solid #3eaf7c}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{font-weight:500;text-decoration:none;color:#3eaf7c}.markdown-body a:active,.markdown-body a:hover{border-bottom:1.5px solid #3eaf7c}.markdown-body a:before{content:"â‡²"}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #3eaf7c}.markdown-body thead{background:#3eaf7c;color:#fff;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(62,175,124,.2)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:.5rem solid;border-color:#42b983;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{outline:none;border:none;border-left:4px solid #3eaf7c;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary::-webkit-details-marker{color:#3eaf7c}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ol li::marker{color:#3eaf7c}.markdown-body ul li{list-style:none}.markdown-body ul li:before{content:"â€¢";margin-right:4px;color:#3eaf7c}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æˆ‘åœ¨å¾®ä¿¡å…¬ä¼—å·ä¸Šå·²ç»å®ç°äº†æ¡Œæ¸¸â€œè°æ˜¯å§åº•â€å‘ç‰Œå™¨ï¼Œç‹¬ç«‹äºæ­¤é¡¹ç›®ï¼Œåˆå¼€å‘äº†æ¡Œæ¸¸â€œé˜¿ç“¦éš†â€ã€‚ç°åœ¨æˆ‘æƒ³å°†è¿™ä¸¤ä¸ªæ¡Œæ¸¸å‘ç‰Œå™¨åŒæ—¶åœ¨å¾®ä¿¡å…¬ä¼—å·ä¸­æ”¯æŒï¼Œè¯¥å¦‚ä½•è¿›è¡Œé¡¹ç›®ç®¡ç†ï¼Ÿ</p>
<p>å¦ä¸€ä¸ªåœºæ™¯ï¼Œç‹¬ç«‹å¼€å‘å‰åç«¯é¡¹ç›® backend å’Œ frontendï¼Œæƒ³è¦å°†å®ƒä»¬æ•´åˆåœ¨ä¸€èµ·å®ç°<strong>ä¸€é”®éƒ¨ç½²</strong>ï¼Œè¯¥å¦‚ä½•åšï¼Ÿ</p>
<p>åœ¨å¤§å‹é¡¹ç›®ä¸­ï¼Œæ˜¯é€‰æ‹©ç®¡ç†å¤šä¸ªå­æ¨¡å—ï¼Œè¿˜æ˜¯åœ¨å¤šä¸ªå­é¡¹ç›®åŸºç¡€ä¸ŠæŠ½è±¡å‡ºçˆ¶é¡¹ç›®ï¼Ÿä»æ¶æ„è®¾è®¡è§’åº¦è€ƒè™‘ï¼Œéµå¾ª<strong>é«˜å†…èšä½è€¦åˆ</strong>çš„åŸåˆ™ï¼Œåè€…æ˜¾ç„¶æ˜¯æ›´å¥½çš„é€‰æ‹©ï¼Œèƒ½å¤Ÿä¿è¯å„é¡¹ç›®ç‹¬ç«‹å¼€å‘ã€äº’ä¸å¹²æ‰°ï¼Œè€Œçˆ¶é¡¹ç›®åˆ™è´Ÿè´£åè°ƒå„å­é¡¹ç›®çš„æ•´åˆã€‚</p>
<p>æˆ‘å¼•å…¥äº† <code>git submodule</code> æ¥ç®¡ç†å­é¡¹ç›®ï¼Œå®Œç¾å®ç°â€œç‰©ç†éš”ç¦»ï¼Œé€»è¾‘ç»Ÿä¸€â€ã€‚è¿™æ˜¯ä¸€ä¸ªä¸€èˆ¬ç”¨æˆ·æ¥è§¦ä¸åˆ°çš„ git æ¨¡å—ï¼Œä½†å¯¹äºç³»ç»Ÿæ¶æ„è®¾è®¡å¸ˆè€Œè¨€ï¼Œäº†è§£å®ƒçš„å­˜åœ¨å¹¶åœ¨å…·ä½“é¡¹ç›®è§„åˆ’ä¸­åº”ç”¨ï¼Œå°†å‘æŒ¥é‡è¦ä½œç”¨ã€‚</p>
<h2 data-id="heading-0">è™šæ‹Ÿæ¡ˆä¾‹ï¼šç¾å›¢â€œæœ¬åœ°ç”Ÿæ´»â€çš„è¿›åŒ–ä¹‹è·¯</h2>
<p>ä¸ºäº†è¯´æ˜è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ¨¡æ‹Ÿä¸€ä¸ªâ€œç¾å›¢ç‰ˆâ€çš„åœºæ™¯ã€‚</p>
<p>æ—©æœŸçš„ç¾å›¢ï¼Œå›¢è´­ (tuangou) å’Œ å¤–å– (waimai) æ˜¯ä¸¤å¥—äººé©¬ï¼Œç‹¬ç«‹å¼€å‘å’Œè¿è¥ã€‚éšç€ä¸šåŠ¡ç‰ˆå›¾æ‰©å¼ ï¼Œå…¬å¸æˆç«‹äº† local-life (æœ¬åœ°ç”Ÿæ´») å›¢é˜Ÿï¼Œç›®æ ‡æ˜¯æ‰“é€ ä¸€ä¸ªç»Ÿä¸€é—¨æˆ·ï¼Œæ±‡èšæˆä¸ºé¡¶æµAppï¼Œå æ®åº”ç”¨å•†åº—æ’è¡Œæ¦œã€‚</p>
<p>æ ¸å¿ƒè¯‰æ±‚ï¼š</p>
<ul>
<li>ç»Ÿä¸€å…¥å£ï¼šç”¨æˆ·ç™»å½•ä¸€ä¸ª Appï¼Œå°±èƒ½åˆ‡æ¢å›¢è´­å’Œå¤–å–ã€‚</li>
<li>ç»Ÿä¸€é‰´æƒï¼šåˆ«è®©ç”¨æˆ·åœ¨å¤–å–é‡Œç™»å½•ä¸€æ¬¡ï¼Œè¿›å›¢è´­è¿˜å¾—å†ç™»ä¸€æ¬¡ã€‚</li>
<li>ç‹¬ç«‹æ€§ï¼šå¤–å–å›¢é˜Ÿä»Šå¤©æƒ³å‘ç‰ˆï¼Œä¸èƒ½å› ä¸ºå›¢è´­å›¢é˜Ÿçš„ä»£ç æ²¡å†™å®Œå°±è¢«å¡ä½ã€‚</li>
</ul>
<p>ç ´å±€æ–¹æ¡ˆï¼šæˆç«‹æ–°çš„çˆ¶é¡¹ç›® local-lifeã€‚å®ƒä¸ç”Ÿäº§ä¸šåŠ¡ä»£ç ï¼Œå®ƒåªæ˜¯ä¸šåŠ¡çš„â€œæ¬è¿å·¥â€ã€‚é€šè¿‡ git submodule å°† tuangou å’Œ waimai å¼•å…¥ï¼Œå˜æˆè‡ªå·±çš„å­æ–‡ä»¶å¤¹ã€‚</p>
<h2 data-id="heading-1">Git Submodule å®æˆ˜æŒ‡ä»¤</h2>
<blockquote>
<p>æ›´å¤šå‘½ä»¤å­—å…¸ï¼Œæ¨èèœé¸Ÿæ•™ç¨‹ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.runoob.com%2Fgit%2Fgit-submodule.html" target="_blank" title="https://www.runoob.com/git/git-submodule.html" ref="nofollow noopener noreferrer">www.runoob.com/git/git-subâ€¦</a></p>
</blockquote>
<p>å…ˆå¿«é€ŸæŸ¥çœ‹<code>git submodule</code>çš„æŒ‡ä»¤æ‰‹å†Œ<code>git submodule --help</code></p>
<pre><code class="hljs language-css" lang="css">git submodule <span class="hljs-selector-attr">[--quiet]</span> <span class="hljs-selector-attr">[--cached]</span>
git submodule <span class="hljs-selector-attr">[--quiet]</span> add <span class="hljs-selector-attr">[&lt;options&gt;]</span> <span class="hljs-selector-attr">[--]</span> &lt;repository&gt; <span class="hljs-selector-attr">[&lt;path&gt;]</span>
git submodule <span class="hljs-selector-attr">[--quiet]</span> status <span class="hljs-selector-attr">[--cached]</span> <span class="hljs-selector-attr">[--recursive]</span> <span class="hljs-selector-attr">[--]</span> <span class="hljs-selector-attr">[&lt;path&gt;...]</span>
git submodule <span class="hljs-selector-attr">[--quiet]</span> init <span class="hljs-selector-attr">[--]</span> <span class="hljs-selector-attr">[&lt;path&gt;...]</span>
git submodule <span class="hljs-selector-attr">[--quiet]</span> deinit <span class="hljs-selector-attr">[-f|--force]</span> (<span class="hljs-attr">--all</span>|<span class="hljs-selector-attr">[--]</span> &lt;path&gt;...)
git submodule <span class="hljs-selector-attr">[--quiet]</span> update <span class="hljs-selector-attr">[&lt;options&gt;]</span> <span class="hljs-selector-attr">[--]</span> <span class="hljs-selector-attr">[&lt;path&gt;...]</span>
git submodule <span class="hljs-selector-attr">[--quiet]</span> set-branch <span class="hljs-selector-attr">[&lt;options&gt;]</span> <span class="hljs-selector-attr">[--]</span> &lt;path&gt;
git submodule <span class="hljs-selector-attr">[--quiet]</span> set-url <span class="hljs-selector-attr">[--]</span> &lt;path&gt; &lt;newurl&gt;
git submodule <span class="hljs-selector-attr">[--quiet]</span> <span class="hljs-selector-tag">summary</span> <span class="hljs-selector-attr">[&lt;options&gt;]</span> <span class="hljs-selector-attr">[--]</span> <span class="hljs-selector-attr">[&lt;path&gt;...]</span>
git submodule <span class="hljs-selector-attr">[--quiet]</span> foreach <span class="hljs-selector-attr">[--recursive]</span> &lt;command&gt;
git submodule <span class="hljs-selector-attr">[--quiet]</span> sync <span class="hljs-selector-attr">[--recursive]</span> <span class="hljs-selector-attr">[--]</span> <span class="hljs-selector-attr">[&lt;path&gt;...]</span>
git submodule <span class="hljs-selector-attr">[--quiet]</span> absorbgitdirs <span class="hljs-selector-attr">[--]</span> <span class="hljs-selector-attr">[&lt;path&gt;...]</span>
</code></pre>
<p>ä¸å¤æ‚çš„<code>git</code>æŒ‡ä»¤ä¸€æ ·ï¼Œèµ·æ­¥é˜¶æ®µåªéœ€è¦å…³æ³¨è¿™å‡ æ¡â€œç‘å£«å†›åˆ€â€å‘½ä»¤ï¼š</p>
<p><strong>æ·»åŠ å­æ¨¡å—</strong></p>
<p><code>git submodule add https://github.com/meituan/tuangou.git</code></p>
<p>è¿™ä¼šåœ¨æ ¹ç›®å½•ç”Ÿæˆä¸€ä¸ª .gitmodules æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶ç›¸å½“äºçˆ¶é¡¹ç›®çš„â€œæˆ·å£æœ¬â€ï¼Œè®°å½•äº†å­æ¨¡å—æ˜¯è°ã€åœ¨å“ªã€‚</p>
<p><strong>ä¸€é”®æ‹‰å–</strong></p>
<p>å…‹éš†æ•´ä¸ªçˆ¶é¡¹ç›®ï¼Œå­æ¨¡å—é»˜è®¤æ˜¯ç©ºçš„ï¼Œå¯ä»¥ä½¿ç”¨<code>--recursive</code>é€’å½’æ‹‰å–å­é¡¹ç›®</p>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> --recursive https://github.com/meituan/meituan.git`
</code></pre>
<p>å¦‚æœåœ¨å…‹éš†çˆ¶é¡¹ç›®æ—¶ï¼Œæ²¡æœ‰æŒ‡å®š<code>--recursive</code>ï¼Œå¯ä»¥ä½¿ç”¨æŒ‡ä»¤</p>
<pre><code class="hljs language-css" lang="css">git submodule update <span class="hljs-attr">--init</span> <span class="hljs-attr">--recursive</span>
</code></pre>
<p><strong>åŒæ­¥æ›´æ–°</strong></p>
<p>å½“å­é¡¹ç›®å›¢é˜Ÿæ›´æ–°äº†ä»£ç ï¼Œçˆ¶é¡¹ç›®æƒ³å¼•ç”¨æœ€æ–°çš„ç‰ˆæœ¬ï¼š</p>
<p><code>git submodule update --remote</code></p>
<p>å½“ç„¶ï¼Œçˆ¶é¡¹ç›®ä¸­ä¹Ÿå¯ä»¥æäº¤å¯¹å­ä»£ç çš„æ›´æ–°ï¼Œåœ¨ JetBrains æˆ– VSCode ç­‰ IDE ä¸­çš„ git æ’ä»¶æ¨¡å—ï¼Œé»˜è®¤å…è®¸ç®¡ç†æ‰€æœ‰çš„ git ä»“åº“ã€‚</p>
<p><em>åœ¨çˆ¶é¡¹ç›®ä¸­ç›´æ¥ä¿®æ”¹å­æ¨¡å—ä»£ç ï¼Œæ˜¯ä¸è¢«æ¨èçš„ï¼Œè¿™ä¸åˆ©äºçˆ¶å­é¡¹ç›®æ²»ç†ã€‚</em></p>
<h2 data-id="heading-2">å›¢é˜Ÿæ²»ç†</h2>
<p>é¡¹ç›®å¤šäº†ï¼Œç®¡ç†ä¸èƒ½ä¹±ã€‚åœ¨çˆ¶å­é¡¹ç›®æ¶æ„ä¸‹ï¼ŒèŒè´£åˆ’åˆ†è¦åƒåˆ‡èœä¸€æ ·æ¸…æ™°ï¼š</p>
<h3 data-id="heading-3">çˆ¶é¡¹ç›®å›¢é˜Ÿï¼ˆç‰©ä¸šå…¬å¸ï¼‰</h3>
<p>ä¸å…³å¿ƒå¤–å–é‡Œå–çš„æ˜¯ç‚¸é¸¡è¿˜æ˜¯æ±‰å ¡ï¼Œä»–ä»¬è´Ÿè´£ï¼š</p>
<ul>
<li>ç¨³å®šæ€§ä¸è¿è¥ï¼Œç¡®ä¿ App å¹³ç¨³è¿è¡Œã€‚</li>
<li>å…¬å…±èµ„æºï¼šç»Ÿä¸€çš„é‰´æƒé€»è¾‘ã€ç»Ÿä¸€çš„ UI ç»„ä»¶åº“ã€‚</li>
<li>æµç¨‹çº¦æŸï¼šåˆ¶å®šå­é¡¹ç›®å…¥é©»çš„è§„èŒƒï¼ˆæ¯”å¦‚æ¥å£æ–‡æ¡£æ€ä¹ˆå†™ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-4">å­é¡¹ç›®å›¢é˜Ÿï¼ˆä¸šä¸»/å•†æˆ·ï¼‰</h3>
<p>ä¸šåŠ¡ä¸“å®¶ï¼Œè´Ÿè´£ï¼š</p>
<ul>
<li>å¿«é€Ÿè¿­ä»£ï¼šä»Šå¤©åŠ ä¸ªä¼˜æƒ åˆ¸ï¼Œæ˜å¤©æ”¹ä¸ªæ’ç‰ˆï¼Œåªè¦åœ¨å­ä»“åº“æŠ˜è…¾å°±è¡Œï¼Œä¸å½±å“åˆ«äººã€‚</li>
<li>è´¨é‡è´Ÿè´£ï¼šè‡ªå·±è´Ÿè´£çš„ä¸šåŠ¡æ¨¡å—ï¼Œå‡ºäº† Bug è‡ªå·±ä¿®ã€‚</li>
</ul>
<h3 data-id="heading-5">æ²»ç†æ‰‹æ®µ</h3>
<p>ç‰ˆæœ¬é”šå®šï¼šçˆ¶é¡¹ç›®å§‹ç»ˆè®°å½•å­é¡¹ç›®çš„ä¸€ä¸ªâ€œç‰¹å®šç‰ˆæœ¬ï¼ˆCommit IDï¼‰â€ï¼Œåªæœ‰ç»è¿‡æµ‹è¯•çš„å­é¡¹ç›®ç‰ˆæœ¬ï¼Œæ‰ä¼šè¢«çˆ¶é¡¹ç›®â€œè½¬æ­£â€æ›´æ–°ã€‚</p>
<h2 data-id="heading-6">æ€»ç»“</h2>
<p>Submodule æœ€å¤§çš„ä¼˜åŠ¿åœ¨äºè§£è€¦ï¼Œå®ƒå…è®¸å„å›¢é˜Ÿä¿ç•™ç‹¬ç«‹çš„ Git æƒé™å’Œä¸åŒçš„å¼€å‘èŠ‚å¥ã€‚å¦‚æœä½ ä¹Ÿé¢ä¸´å¤šå›¢é˜Ÿåä½œã€ç»Ÿä¸€å¹³å°æ„å»ºçš„éš¾é¢˜ï¼Œä¸å¦¨è¯•è¯• Git Submoduleã€‚å®ƒæ˜¯ç›®å‰è¿ç»´æ¶æ„ä¸­ï¼Œæ€§ä»·æ¯”æé«˜çš„â€œé™ç†µâ€å·¥å…·ã€‚</p>
<h2 data-id="heading-7">å…³æ³¨å¾®ä¿¡å…¬ä¼—å·ï¼Œè·å–è¿ç»´èµ„è®¯</h2>
<p>å¦‚æœæ­¤ç¯‡æ–‡ç« å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œæ„Ÿè°¢ä½ çš„<strong>ç‚¹èµ</strong>ä¸<strong>æ”¶è—</strong>ï¼Œä¹Ÿæ¬¢è¿åœ¨è¯„è®ºåŒºå‹å¥½äº¤æµã€‚</p>
<p>å¾®ä¿¡æœç´¢å…³æ³¨å…¬ä¼—å·ï¼š<strong>æŒç»­è¿ç»´</strong></p>
<h2 data-id="heading-8">å‚è€ƒ</h2>
<ol>
<li>èœé¸Ÿæ•™ç¨‹ git submoduleï¼Œ<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.runoob.com%2Fgit%2Fgit-submodule.html" target="_blank" title="https://www.runoob.com/git/git-submodule.html" ref="nofollow noopener noreferrer">www.runoob.com/git/git-subâ€¦</a></li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[WSL2 åœ¨ TUN æ¨¡å¼ä¸‹å¯¼è‡´ Supabase è¿æ¥è¶…æ—¶ (P1001) çš„æ’æŸ¥ä¸è§£å†³]]></title>    <link>https://juejin.cn/post/7598447519823314985</link>    <guid>https://juejin.cn/post/7598447519823314985</guid>    <pubDate>2026-01-24T04:46:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598447519823314985" data-draft-id="7598587406694858795" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="WSL2 åœ¨ TUN æ¨¡å¼ä¸‹å¯¼è‡´ Supabase è¿æ¥è¶…æ—¶ (P1001) çš„æ’æŸ¥ä¸è§£å†³"/> <meta itemprop="keywords" content="AIç¼–ç¨‹,Linux"/> <meta itemprop="datePublished" content="2026-01-24T04:46:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‘æ˜æœˆ"/> <meta itemprop="url" content="https://juejin.cn/user/2928754707930126"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            WSL2 åœ¨ TUN æ¨¡å¼ä¸‹å¯¼è‡´ Supabase è¿æ¥è¶…æ—¶ (P1001) çš„æ’æŸ¥ä¸è§£å†³
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2928754707930126/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‘æ˜æœˆ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T04:46:42.000Z" title="Sat Jan 24 2026 04:46:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ <strong>WSL2 (Manjaro)</strong> ç¯å¢ƒä¸‹è¿›è¡Œå…¨æ ˆå¼€å‘æ—¶ï¼Œæˆ‘é‡åˆ°äº†ä¸€ä¸ªç½‘ç»œå†²çªé—®é¢˜ã€‚æˆ‘çš„é¡¹ç›®è¿æ¥äº‘ç«¯æ•°æ®åº“ï¼ˆPostgreSQLï¼‰ï¼ŒåŒæ—¶ä¾èµ– <strong>Github Copilot / Antigravity</strong> ç­‰æµ·å¤–å¼€å‘æœåŠ¡ã€‚</p>
<p>ä¸ºäº†è®© <strong>Github Copilot / Antigravity çš„ AI</strong> æ­£å¸¸ç¨³å®šè¿è¡Œï¼Œæˆ‘å¼€å¯äº†æœ¬åœ°ç½‘ç»œè°ƒè¯•å·¥å…·çš„ <strong>TUN (è™šæ‹Ÿç½‘å¡) æ¨¡å¼</strong>ã€‚ä½†å¼€å¯åå‘ç°ï¼šPrisma è¿æ¥æ•°æ®åº“ä¼šæŠ¥é”™è¶…æ—¶ï¼›å…³é—­ TUN æ¨¡å¼æ•°æ®åº“æ¢å¤ï¼Œä½†æˆ‘çš„ AI åˆæ— æ³•è¿æ¥äº†ã€‚</p>
<p>è¿™ç¯‡æ–‡ç« è®°å½•äº†è¯¥é—®é¢˜çš„æ’æŸ¥è¿‡ç¨‹ï¼Œæ¶‰åŠ <strong>Fake-IP æœºåˆ¶</strong> ä¸ <strong>DNS åŠ«æŒ</strong> çš„å†²çªè§£å†³ã€‚</p>
<h2 data-id="heading-0">é—®é¢˜ç°è±¡</h2>
<p><strong>ç¯å¢ƒä¿¡æ¯ï¼š</strong></p>
<ul>
<li><strong>OS:</strong> Windows 11 + WSL2</li>
<li><strong>ç½‘ç»œç¯å¢ƒ:</strong> å¼€å¯äº†æœ¬åœ°ä»£ç†å·¥å…·çš„ TUN æ¨¡å¼</li>
<li><strong>æ•°æ®åº“:</strong> äº‘ç«¯ PostgreSQL (AWS)</li>
<li><strong>ORM:</strong> Prisma</li>
</ul>
<p><strong>å…·ä½“è¡¨ç°ï¼š</strong></p>
<p>å½“å¼€å¯ TUN æ¨¡å¼æ¥ç®¡ç³»ç»Ÿæµé‡æ—¶ï¼Œè¿è¡Œ <code>npx prisma db pull</code>ï¼ŒæŠ›å‡ºä»¥ä¸‹é”™è¯¯ï¼š</p>
<pre><code class="hljs language-Bash" lang="Bash">Error: P1001
Can<span class="hljs-string">'t reach database server at `xxx.pooler.supabase.com:5432`
Please make sure your database server is running...
</span></code></pre>
<p>ä¸æ­¤åŒæ—¶ï¼Œéƒ¨åˆ† OAuth å›è°ƒå¯èƒ½ä¹Ÿä¼šå‡ºç°è¿æ¥è¶…æ—¶ã€‚å…³é—­ TUN æ¨¡å¼åï¼Œæ•°æ®åº“è¿æ¥æ¢å¤æ­£å¸¸ã€‚</p>
<h2 data-id="heading-1">æ’æŸ¥è¿‡ç¨‹</h2>
<h3 data-id="heading-2">1. æ£€æŸ¥ DNS è§£æï¼ˆå‘ç°ç«¯å€ªï¼‰</h3>
<p>ä¸ºäº†ææ¸…æ¥šç½‘ç»œå±‚å‘ç”Ÿäº†ä»€ä¹ˆï¼Œæˆ‘åœ¨ WSL2 ç»ˆç«¯é‡Œ <code>ping</code> äº†ä¸€ä¸‹æ•°æ®åº“åŸŸåï¼š</p>
<pre><code class="hljs language-Bash" lang="Bash">ping aws-1-ap-northeast-2.pooler.supabase.com
</code></pre>
<p>è¿”å›çš„ç»“æœæ˜¾ç¤ºè§£æåˆ°äº†ä¸€ä¸ªç‰¹æ®Šçš„ IP æ®µï¼š</p>
<pre><code class="hljs language-python" lang="python">PING xxx.supabase.com (<span class="hljs-number">198.18</span><span class="hljs-number">.0</span><span class="hljs-number">.18</span>) <span class="hljs-number">56</span>(<span class="hljs-number">84</span>) <span class="hljs-built_in">bytes</span> of data.
<span class="hljs-number">64</span> <span class="hljs-built_in">bytes</span> <span class="hljs-keyword">from</span> <span class="hljs-number">198.18</span><span class="hljs-number">.0</span><span class="hljs-number">.18</span>: icmp_seq=<span class="hljs-number">1</span> ttl=<span class="hljs-number">64</span> time=<span class="hljs-number">0.297</span> ms
</code></pre>
<p><strong>å…³é”®ç‚¹ï¼š</strong> è§£æç»“æœæ˜¯ <code>198.18.0.18</code>ã€‚</p>
<p><code>198.18.0.0/15</code> æ˜¯ç½‘ç»œåŸºå‡†æµ‹è¯•ä¿ç•™ç½‘æ®µï¼Œå¸¸è¢«å„ç±»ç½‘ç»œè°ƒè¯•å·¥å…·ç”¨äº <strong>Fake-IP (è™šå‡IP)</strong> æ¨¡å¼ã€‚è¿™è¯´æ˜ DNS è§£æå·²ç»è¢«å·¥å…·åŠ«æŒï¼Œè¿”å›äº†è™šæ‹Ÿ IP ä»¥ä¾¿æ¥ç®¡æµé‡ã€‚</p>
<p><strong>åŸå› åˆ†æï¼š</strong></p>
<p>å¯¹äº HTTP åè®®ï¼ŒFake-IP æ¨¡å¼é€šå¸¸å·¥ä½œè‰¯å¥½ã€‚ä½†å¯¹äºæ•°æ®åº“è¿æ¥ï¼ˆTCP ç«¯å£ 5432ï¼‰ï¼Œåœ¨è¿™ä¸ªè™šæ‹Ÿ IP çš„æ˜ å°„å’Œæµé‡è½¬å‘è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½å‡ºç°äº†è§„åˆ™åŒ¹é…å¤±è´¥æˆ–é“¾è·¯ä¸¢å¤±ï¼Œå¯¼è‡´ ORM æ— æ³•é€šè¿‡è¿™ä¸ªâ€œå‡ IPâ€å»ºç«‹çœŸå®çš„ TCP è¿æ¥ã€‚</p>
<h2 data-id="heading-3">è§£å†³æ–¹æ¡ˆ</h2>
<p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¿…é¡»é…ç½®ç½‘ç»œå·¥å…·ï¼Œè®©ç‰¹å®šæ•°æ®åº“åŸŸå<strong>ç»•è¿‡ Fake-IP æœºåˆ¶</strong>ï¼Œç›´æ¥è§£æå‡ºçœŸå®çš„å…¬ç½‘ IPã€‚</p>
<h3 data-id="heading-4">ç¬¬ä¸€æ­¥ï¼šå¼€å¯ DNS è¦†å†™/æ¥ç®¡</h3>
<p>åœ¨ä½ çš„ç½‘ç»œå·¥å…·è®¾ç½®ä¸­ï¼ˆé€šå¸¸åœ¨ DNS è®¾ç½®æ¿å—ï¼‰ï¼Œç¡®ä¿ <strong>DNS è¦†å†™ (DNS Override)</strong> æˆ–ç±»ä¼¼åŠŸèƒ½å·²å¼€å¯ã€‚è¿™ä¸€æ­¥æ˜¯ä¸ºäº†ç¡®ä¿æˆ‘ä»¬æ¥ä¸‹æ¥çš„è¿‡æ»¤è§„åˆ™èƒ½ç”Ÿæ•ˆã€‚</p>
<h3 data-id="heading-5">ç¬¬äºŒæ­¥ï¼šé…ç½® Fake-IP è¿‡æ»¤ (å…³é”®)</h3>
<p>æˆ‘ä»¬éœ€è¦å°†æ•°æ®åº“åŸŸåæ·»åŠ åˆ° <strong>Fake-IP è¿‡æ»¤åˆ—è¡¨ (Fake-IP Filter)</strong> ä¸­ã€‚è¿™ä¸ªåˆ—è¡¨çš„ä½œç”¨æ˜¯å‘Šè¯‰å·¥å…·ï¼šâ€œé‡åˆ°è¿™äº›åŸŸåæ—¶ï¼Œä¸è¦è¿”å› 198.18.x.xï¼Œè¯·å»æŸ¥è¯¢å¹¶è¿”å›çœŸå®çš„å…¬ç½‘ IPâ€ã€‚</p>
<p>åœ¨é…ç½®æ–‡ä»¶çš„ <code>dns</code> -&gt; <code>fake-ip-filter</code> å­—æ®µï¼Œæˆ–è€…è½¯ä»¶ç•Œé¢çš„â€œFake IP è¿‡æ»¤â€è¾“å…¥æ¡†ä¸­ï¼Œè¿½åŠ ä»¥ä¸‹å†…å®¹ï¼š</p>
<pre><code class="hljs language-Plaintext" lang="Plaintext">, *.supabase.com, *.supabase.co, *.supabase.in
</code></pre>
<blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc80c86e98244c338618690d8f4f96e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCR5piO5pyI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769835952&amp;x-signature=pwNUolvahB02E0xSS7ZdCKYzpFk%3D" alt="image.png" loading="lazy"/></p>
</blockquote>
<h3 data-id="heading-6">ç¬¬ä¸‰æ­¥ï¼šéªŒè¯</h3>
<p>ä¿å­˜é…ç½®å¹¶<strong>é‡å¯ç½‘ç»œå·¥å…·</strong>åï¼Œå†æ¬¡å›åˆ° WSL2 ç»ˆç«¯æµ‹è¯•ï¼š</p>
<pre><code class="hljs language-Bash" lang="Bash">ping aws-1-ap-northeast-2.pooler.supabase.com
</code></pre>
<p>æ­¤æ—¶è¿”å›çš„åº”è¯¥æ˜¯çœŸå®çš„å…¬ç½‘ IP åœ°å€ï¼ˆä¾‹å¦‚ <code>52.x.x.x</code>ï¼‰ï¼Œè€Œä¸å†æ˜¯ <code>198.18.x.x</code>ã€‚</p>
<p>å†æ¬¡è¿è¡Œ <code>npx prisma db pull</code>ï¼Œæ•°æ®åº“è¿æ¥æˆåŠŸã€‚</p>
<h2 data-id="heading-7">æ€»ç»“</h2>
<p>åœ¨ WSL2 å¼€å‘ç¯å¢ƒä¸­ï¼Œå¦‚æœå¼€å¯äº†ç½‘ç»œå·¥å…·çš„å…¨å±€/TUN æ¨¡å¼ï¼Œé‡åˆ°é HTTP åè®®ï¼ˆå¦‚æ•°æ®åº“è¿æ¥ã€è‡ªå®šä¹‰ TCP æœåŠ¡ï¼‰è¿æ¥è¶…æ—¶ï¼Œå¯ä»¥ä¼˜å…ˆæ’æŸ¥ DNS è§£æç»“æœã€‚</p>
<p>å¦‚æœå‘ç°è§£æ IP ä¸º <code>198.18.x.x</code>ï¼Œè¯´æ˜èµ°äº† Fake-IP æ¨¡å¼ã€‚æ­¤æ—¶æ— éœ€å…³é—­ TUN æ¨¡å¼ï¼Œåªéœ€åœ¨å·¥å…·çš„ <strong>Fake-IP Filter</strong> ä¸­æ’é™¤ç›¸å…³åŸŸåï¼Œè·å–çœŸå® IP å³å¯è§£å†³å†²çªã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaåŸºç¡€-3ï¼šJava AQS æŠ€æœ¯ä»‹ç»å’Œä»£ç å®ç°è¯¦ç»†å‰–æ]]></title>    <link>https://juejin.cn/post/7598818096729047078</link>    <guid>https://juejin.cn/post/7598818096729047078</guid>    <pubDate>2026-01-24T08:45:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598818096729047078" data-draft-id="7598435950411186186" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaåŸºç¡€-3ï¼šJava AQS æŠ€æœ¯ä»‹ç»å’Œä»£ç å®ç°è¯¦ç»†å‰–æ"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2026-01-24T08:45:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="beata"/> <meta itemprop="url" content="https://juejin.cn/user/1839900247461280"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaåŸºç¡€-3ï¼šJava AQS æŠ€æœ¯ä»‹ç»å’Œä»£ç å®ç°è¯¦ç»†å‰–æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1839900247461280/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    beata
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T08:45:35.000Z" title="Sat Jan 24 2026 08:45:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">AQSæŠ€æœ¯å…¨é¢å­¦ä¹ åªçœ‹è¿™ç¯‡</h2>
<h3 data-id="heading-1">å‰è¨€</h3>
<p>åœ¨ Java å¹¶å‘ç¼–ç¨‹ä¸­ï¼Œ<code>AbstractQueuedSynchronizer</code>ï¼ˆç®€ç§° <strong>AQS</strong>ï¼‰æ˜¯ <code>java.util.concurrent</code> åŒ…çš„åŸºçŸ³ã€‚å‡ ä¹æ‰€æœ‰é«˜çº§åŒæ­¥å·¥å…·ï¼ˆå¦‚ <code>ReentrantLock</code>ã€<code>Semaphore</code>ã€<code>CountDownLatch</code> ç­‰ï¼‰éƒ½åŸºäº AQS æ„å»ºã€‚å®ƒé€šè¿‡â€œçŠ¶æ€ + é˜Ÿåˆ—â€æ¨¡å‹ï¼Œå°†çº¿ç¨‹æ’é˜Ÿã€é˜»å¡ã€å”¤é†’ç­‰å¤æ‚é€»è¾‘å°è£…èµ·æ¥ï¼Œè®©å¼€å‘è€…åªéœ€å…³æ³¨<strong>èµ„æºè·å–/é‡Šæ”¾çš„è§„åˆ™</strong>ã€‚</p>
<p>æœ¬æ–‡å°†ä»æºç çº§æ·±å…¥å‰–æ AQS çš„å®ç°æœºåˆ¶ï¼Œå¹¶ä»‹ç»å…¶åœ¨ JDK ä¸­çš„æ ¸å¿ƒåº”ç”¨ï¼Œæœ€åæ‰‹å†™ä¸€ä¸ªåŸºäº AQS çš„è‡ªå®šä¹‰é”ï¼ŒåŠ©ä½ å½»åº•æŒæ¡è¿™ä¸€å¹¶å‘æ ¸å¿ƒç»„ä»¶ã€‚</p>
<hr/>
<h2 data-id="heading-2">ä¸€ã€AQS æ ¸å¿ƒæœºåˆ¶ä¸æºç å®ç°è¯¦è§£</h2>
<p>AQS çš„è®¾è®¡å“²å­¦æ˜¯ï¼š<strong>æ¨¡æ¿æ–¹æ³• + CAS + CLH é˜Ÿåˆ—</strong>ã€‚æˆ‘ä»¬é€å±‚æ‹†è§£å…¶å†…éƒ¨ç»“æ„ã€‚</p>
<h3 data-id="heading-3">1.1 æ ¸å¿ƒå­—æ®µ</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AbstractQueuedSynchronizer</span>
    <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractOwnableSynchronizer</span> {

    <span class="hljs-comment">// åŒæ­¥çŠ¶æ€ï¼šç”±å­ç±»å®šä¹‰è¯­ä¹‰ï¼ˆå¦‚ 0=ç©ºé—², &gt;0=å ç”¨ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> state;

    <span class="hljs-comment">// FIFO åŒå‘åŒæ­¥é˜Ÿåˆ—çš„å¤´å°¾æŒ‡é’ˆ</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> <span class="hljs-keyword">volatile</span> Node head;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> <span class="hljs-keyword">volatile</span> Node tail;

    <span class="hljs-comment">// è·å–/è®¾ç½® state çš„åŸå­æ“ä½œ</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getState</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> state; }
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setState</span><span class="hljs-params">(<span class="hljs-type">int</span> newState)</span> { state = newState; }
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">compareAndSetState</span><span class="hljs-params">(<span class="hljs-type">int</span> expect, <span class="hljs-type">int</span> update)</span> {
        <span class="hljs-keyword">return</span> unsafe.compareAndSwapInt(<span class="hljs-built_in">this</span>, stateOffset, expect, update);
    }
}
</code></pre>
<blockquote>
<p>âœ… <code>state</code> æ˜¯æ‰€æœ‰ç«äº‰çš„ç„¦ç‚¹ï¼Œå¿…é¡»é€šè¿‡ CAS æ“ä½œä¿è¯åŸå­æ€§ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-4">1.2 Node èŠ‚ç‚¹ç»“æ„</h3>
<p>åŒæ­¥é˜Ÿåˆ—ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ª <code>Node</code>ï¼Œä»£è¡¨ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Node</span> {
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Node</span> <span class="hljs-variable">SHARED</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>();   <span class="hljs-comment">// å…±äº«æ¨¡å¼æ ‡è®°</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Node</span> <span class="hljs-variable">EXCLUSIVE</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;      <span class="hljs-comment">// ç‹¬å æ¨¡å¼æ ‡è®°</span>

    <span class="hljs-comment">// ç­‰å¾…çŠ¶æ€</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">CANCELLED</span> <span class="hljs-operator">=</span>  <span class="hljs-number">1</span>;  <span class="hljs-comment">// å·²å–æ¶ˆ</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">SIGNAL</span>    <span class="hljs-operator">=</span> -<span class="hljs-number">1</span>;  <span class="hljs-comment">// å‰é©±éœ€å”¤é†’åç»§</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">CONDITION</span> <span class="hljs-operator">=</span> -<span class="hljs-number">2</span>;  <span class="hljs-comment">// åœ¨ Condition é˜Ÿåˆ—ä¸­</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">PROPAGATE</span> <span class="hljs-operator">=</span> -<span class="hljs-number">3</span>;  <span class="hljs-comment">// å…±äº«æ¨¡å¼éœ€ä¼ æ’­</span>

    <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> waitStatus;
    <span class="hljs-keyword">volatile</span> Node prev;     <span class="hljs-comment">// å‰é©±</span>
    <span class="hljs-keyword">volatile</span> Node next;     <span class="hljs-comment">// åç»§</span>
    <span class="hljs-keyword">volatile</span> Thread thread; <span class="hljs-comment">// å…³è”çº¿ç¨‹</span>
    Node nextWaiter;        <span class="hljs-comment">// æ¨¡å¼æ ‡è®°ï¼ˆSHARED æˆ– nullï¼‰</span>
}
</code></pre>
<blockquote>
<p>ğŸ”‘ <strong>å…³é”®åŒºåˆ«</strong>ï¼š<code>nextWaiter == SHARED</code> è¡¨ç¤ºå…±äº«æ¨¡å¼ï¼Œ<code>== null</code> è¡¨ç¤ºç‹¬å æ¨¡å¼ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-5">1.3 ç‹¬å æ¨¡å¼ï¼šè·å–èµ„æºæµç¨‹ï¼ˆ<code>acquire</code>ï¼‰</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">acquire</span><span class="hljs-params">(<span class="hljs-type">int</span> arg)</span> {
    <span class="hljs-keyword">if</span> (!tryAcquire(arg) &amp;&amp;                     <span class="hljs-comment">// 1. å°è¯•è·å–ï¼ˆå­ç±»å®ç°ï¼‰</span>
        acquireQueued(addWaiter(Node.EXCLUSIVE), arg)) <span class="hljs-comment">// 2. å¤±è´¥åˆ™å…¥é˜Ÿé˜»å¡</span>
        selfInterrupt(); <span class="hljs-comment">// æ¢å¤ä¸­æ–­çŠ¶æ€</span>
}
</code></pre>
<h4 data-id="heading-6">æ­¥éª¤åˆ†è§£ï¼š</h4>
<p><strong>â‘  å…¥é˜Ÿï¼š<code>addWaiter</code></strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> Node <span class="hljs-title function_">addWaiter</span><span class="hljs-params">(Node mode)</span> {
    <span class="hljs-type">Node</span> <span class="hljs-variable">node</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>(Thread.currentThread(), mode);
    <span class="hljs-type">Node</span> <span class="hljs-variable">pred</span> <span class="hljs-operator">=</span> tail;
    <span class="hljs-keyword">if</span> (pred != <span class="hljs-literal">null</span>) {
        node.prev = pred;
        <span class="hljs-keyword">if</span> (compareAndSetTail(pred, node)) { <span class="hljs-comment">// å¿«é€Ÿè·¯å¾„</span>
            pred.next = node;
            <span class="hljs-keyword">return</span> node;
        }
    }
    enq(node); <span class="hljs-comment">// è‡ªæ—‹å…¥é˜Ÿï¼ˆæ…¢è·¯å¾„ï¼‰</span>
    <span class="hljs-keyword">return</span> node;
}
</code></pre>
<p><strong>â‘¡ é˜»å¡ç­‰å¾…ï¼š<code>acquireQueued</code></strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">acquireQueued</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Node node, <span class="hljs-type">int</span> arg)</span> {
    <span class="hljs-keyword">for</span> (;;) {
        <span class="hljs-keyword">final</span> <span class="hljs-type">Node</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> node.predecessor();
        <span class="hljs-comment">// ä»…å½“å‰é©±æ˜¯ head æ—¶æ‰å°è¯•è·å–</span>
        <span class="hljs-keyword">if</span> (p == head &amp;&amp; tryAcquire(arg)) {
            setHead(node); <span class="hljs-comment">// æˆåŠŸï¼Œè®¾ä¸ºæ–° head</span>
            p.next = <span class="hljs-literal">null</span>; <span class="hljs-comment">// help GC</span>
            <span class="hljs-keyword">return</span> interrupted;
        }
        <span class="hljs-comment">// å†³å®šæ˜¯å¦é˜»å¡</span>
        <span class="hljs-keyword">if</span> (shouldParkAfterFailedAcquire(p, node) &amp;&amp;
            parkAndCheckInterrupt())
            interrupted = <span class="hljs-literal">true</span>;
    }
}
</code></pre>
<p><strong>â‘¢ æ˜¯å¦é˜»å¡ï¼š<code>shouldParkAfterFailedAcquire</code></strong></p>
<ul>
<li>è‹¥å‰é©± <code>waitStatus == SIGNAL</code> â†’ å®‰å…¨é˜»å¡</li>
<li>è‹¥å‰é©±å·²å–æ¶ˆ â†’ è·³è¿‡å¹¶æ¸…ç†</li>
<li>å¦åˆ™ â†’ å°†å‰é©±è®¾ä¸º <code>SIGNAL</code>ï¼Œä¸‹æ¬¡å†è¯•</li>
</ul>
<blockquote>
<p>ğŸ’¡ <strong>ç²¾å¦™ä¹‹å¤„</strong>ï¼šåªæœ‰å‰é©±æ‰¿è¯ºå”¤é†’ï¼ˆ<code>SIGNAL</code>ï¼‰ï¼Œå½“å‰çº¿ç¨‹æ‰ä¼šè°ƒç”¨ <code>LockSupport.park()</code> é˜»å¡ï¼Œé¿å…æ— æ•ˆå”¤é†’ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-7">1.4 é‡Šæ”¾èµ„æºï¼š<code>release</code></h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">release</span><span class="hljs-params">(<span class="hljs-type">int</span> arg)</span> {
    <span class="hljs-keyword">if</span> (tryRelease(arg)) { <span class="hljs-comment">// å­ç±»å®ç°é‡Šæ”¾é€»è¾‘</span>
        <span class="hljs-type">Node</span> <span class="hljs-variable">h</span> <span class="hljs-operator">=</span> head;
        <span class="hljs-keyword">if</span> (h != <span class="hljs-literal">null</span> &amp;&amp; h.waitStatus != <span class="hljs-number">0</span>)
            unparkSuccessor(h); <span class="hljs-comment">// å”¤é†’åç»§</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}

<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unparkSuccessor</span><span class="hljs-params">(Node node)</span> {
    <span class="hljs-comment">// æ¸…é™¤ SIGNAL</span>
    compareAndSetWaitStatus(node, ws, <span class="hljs-number">0</span>);
    
    <span class="hljs-type">Node</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> node.next;
    <span class="hljs-comment">// ä» tail å‘å‰æ‰¾ç¬¬ä¸€ä¸ªæœ‰æ•ˆèŠ‚ç‚¹ï¼ˆè§£å†³ next æœªè®¾ç½®é—®é¢˜ï¼‰</span>
    <span class="hljs-keyword">if</span> (s == <span class="hljs-literal">null</span> || s.waitStatus &gt; <span class="hljs-number">0</span>) {
        s = <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-type">Node</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> tail; t != <span class="hljs-literal">null</span> &amp;&amp; t != node; t = t.prev)
            <span class="hljs-keyword">if</span> (t.waitStatus &lt;= <span class="hljs-number">0</span>) s = t;
    }
    <span class="hljs-keyword">if</span> (s != <span class="hljs-literal">null</span>)
        LockSupport.unpark(s.thread);
}
</code></pre>
<blockquote>
<p>ğŸŒŸ <strong>ä¸ºä»€ä¹ˆä» tail å‘å‰éå†ï¼Ÿ</strong><br/>
å› ä¸º <code>enq</code> ä¸­è®¾ç½® <code>prev</code> åœ¨ CAS ä¹‹å‰ï¼Œä½† <code>next</code> åœ¨ CAS ä¹‹åï¼Œå¯èƒ½å¯¼è‡´ <code>next</code> ä¸º nullã€‚ä» tail å‘å‰æ›´å®‰å…¨ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-8">1.5 å…±äº«æ¨¡å¼ vs ç‹¬å æ¨¡å¼</h3>






























<table><thead><tr><th>ç‰¹æ€§</th><th>ç‹¬å æ¨¡å¼</th><th>å…±äº«æ¨¡å¼</th></tr></thead><tbody><tr><td>API</td><td><code>acquire/release</code></td><td><code>acquireShared/releaseShared</code></td></tr><tr><td>Node æ ‡è®°</td><td><code>EXCLUSIVE (null)</code></td><td><code>SHARED</code></td></tr><tr><td>å”¤é†’è¡Œä¸º</td><td>ä»…å”¤é†’ä¸€ä¸ªåç»§</td><td><strong>ä¼ æ’­å”¤é†’</strong>å¤šä¸ªå…±äº«èŠ‚ç‚¹</td></tr><tr><td>æ ¸å¿ƒæ–¹æ³•</td><td><code>tryAcquire/tryRelease</code></td><td><code>tryAcquireShared/tryReleaseShared</code></td></tr></tbody></table>
<p><strong>å…±äº«æ¨¡å¼çš„å…³é”®ï¼š<code>setHeadAndPropagate</code></strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setHeadAndPropagate</span><span class="hljs-params">(Node node, <span class="hljs-type">int</span> propagate)</span> {
    setHead(node);
    <span class="hljs-comment">// å¦‚æœè¿˜æœ‰èµ„æºï¼ˆpropagate &gt; 0ï¼‰æˆ–å¤´èŠ‚ç‚¹çŠ¶æ€ä¸º PROPAGATE</span>
    <span class="hljs-keyword">if</span> (propagate &gt; <span class="hljs-number">0</span> || h.waitStatus &lt; <span class="hljs-number">0</span>) {
        <span class="hljs-type">Node</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> node.next;
        <span class="hljs-keyword">if</span> (s == <span class="hljs-literal">null</span> || s.isShared())
            doReleaseShared(); <span class="hljs-comment">// ç»§ç»­å”¤é†’åç»§å…±äº«èŠ‚ç‚¹ï¼</span>
    }
}
</code></pre>
<blockquote>
<p>âœ… è¿™å°±æ˜¯ <code>Semaphore</code> èƒ½åŒæ—¶å”¤é†’å¤šä¸ªçº¿ç¨‹çš„åŸå› ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-9">äºŒã€JDK ä¸­åŸºäº AQS çš„æ ¸å¿ƒç±»åŠå…¶å®ç°å·®å¼‚</h2>















































<table><thead><tr><th>ç±»</th><th>æ¨¡å¼</th><th><code>state</code> å«ä¹‰</th><th>æ ¸å¿ƒç”¨é€”</th></tr></thead><tbody><tr><td><code>ReentrantLock</code></td><td>ç‹¬å </td><td>é”é‡å…¥æ¬¡æ•°</td><td>å¯é‡å…¥äº’æ–¥é”</td></tr><tr><td><code>ReentrantReadWriteLock.ReadLock</code></td><td>å…±äº«</td><td>é«˜16ä½ï¼šè¯»é”è®¡æ•°</td><td>è¯»å¤šå†™å°‘åœºæ™¯</td></tr><tr><td><code>ReentrantReadWriteLock.WriteLock</code></td><td>ç‹¬å </td><td>ä½16ä½ï¼šå†™é”é‡å…¥æ¬¡æ•°</td><td>å†™æ“ä½œäº’æ–¥</td></tr><tr><td><code>Semaphore</code></td><td>å…±äº«</td><td>å‰©ä½™è®¸å¯æ•°é‡</td><td>æ§åˆ¶å¹¶å‘è®¿é—®æ•°</td></tr><tr><td><code>CountDownLatch</code></td><td>å…±äº«</td><td>å€’è®¡æ•°å™¨å€¼</td><td>ç­‰å¾… N ä¸ªä»»åŠ¡å®Œæˆ</td></tr><tr><td><code>FutureTask</code></td><td>ç‹¬å </td><td>æ‰§è¡ŒçŠ¶æ€ï¼ˆNEW/RUNNING/DONEï¼‰</td><td>å¼‚æ­¥è®¡ç®—ç»“æœ</td></tr></tbody></table>
<h3 data-id="heading-10">å®ç°å·®å¼‚ä¸¾ä¾‹ï¼š</h3>
<ul>
<li><strong><code>ReentrantLock</code></strong>ï¼š<code>state=0</code> è¡¨ç¤ºç©ºé—²ï¼›<code>&gt;0</code> è¡¨ç¤ºè¢«å ç”¨ï¼Œå€¼ä¸ºé‡å…¥æ¬¡æ•°ã€‚</li>
<li><strong><code>Semaphore</code></strong>ï¼š<code>state</code> åˆå§‹ä¸ºè®¸å¯æ•°ï¼Œæ¯æ¬¡ <code>acquire</code> å‡ 1ï¼Œ<code>release</code> åŠ  1ã€‚</li>
<li><strong><code>CountDownLatch</code></strong>ï¼š<code>state</code> åˆå§‹ä¸º Nï¼Œæ¯æ¬¡ <code>countDown</code> å‡ 1ï¼Œå½’é›¶æ—¶å”¤é†’æ‰€æœ‰ç­‰å¾…è€…ã€‚</li>
</ul>
<blockquote>
<p>ğŸ“Œ æ‰€æœ‰è¿™äº›ç±»éƒ½<strong>åªé‡å†™äº† AQS çš„ <code>tryXxx</code> æ–¹æ³•</strong>ï¼Œæ’é˜Ÿé€»è¾‘å®Œå…¨ç”± AQS æä¾›ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-11">ä¸‰ã€æ‰‹å†™ä¸€ä¸ªåŸºäº AQS çš„ä¸å¯é‡å…¥äº’æ–¥é”</h2>
<p>ä¸‹é¢å®ç°ä¸€ä¸ªç®€åŒ–ç‰ˆçš„ <code>Mutex</code> é”ï¼Œå±•ç¤ºå¦‚ä½•åˆ©ç”¨ AQS æ„å»ºè‡ªå®šä¹‰åŒæ­¥å™¨ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.locks.AbstractQueuedSynchronizer;
<span class="hljs-keyword">import</span> java.util.concurrent.locks.Lock;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleMutex</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Lock</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Sync</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractQueuedSynchronizer</span> {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryAcquire</span><span class="hljs-params">(<span class="hljs-type">int</span> ignored)</span> {
            <span class="hljs-comment">// CAS å°† state ä» 0 â†’ 1</span>
            <span class="hljs-keyword">if</span> (compareAndSetState(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>)) {
                setExclusiveOwnerThread(Thread.currentThread());
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryRelease</span><span class="hljs-params">(<span class="hljs-type">int</span> ignored)</span> {
            <span class="hljs-keyword">if</span> (getExclusiveOwnerThread() != Thread.currentThread()) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalMonitorStateException</span>();
            }
            setExclusiveOwnerThread(<span class="hljs-literal">null</span>);
            setState(<span class="hljs-number">0</span>); <span class="hljs-comment">// é‡Šæ”¾é”</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isHeldExclusively</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> getExclusiveOwnerThread() == Thread.currentThread();
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Sync</span> <span class="hljs-variable">sync</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Sync</span>();

    <span class="hljs-meta">@Override</span> <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">lock</span><span class="hljs-params">()</span> { sync.acquire(<span class="hljs-number">1</span>); }
    <span class="hljs-meta">@Override</span> <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unlock</span><span class="hljs-params">()</span> { sync.release(<span class="hljs-number">1</span>); }
    <span class="hljs-meta">@Override</span> <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryLock</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> sync.tryAcquire(<span class="hljs-number">1</span>); }
    <span class="hljs-comment">// ... å…¶ä»–æ–¹æ³•ç•¥</span>
}
</code></pre>
<h3 data-id="heading-12">æµ‹è¯•éªŒè¯äº’æ–¥æ€§ï¼š</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MutexTest</span> {
    <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    <span class="hljs-keyword">static</span> <span class="hljs-type">SimpleMutex</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleMutex</span>();

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">Thread</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10000</span>; i++) {
                lock.lock();
                <span class="hljs-keyword">try</span> { count++; } <span class="hljs-keyword">finally</span> { lock.unlock(); }
            }
        });
        <span class="hljs-type">Thread</span> <span class="hljs-variable">t2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10000</span>; i++) {
                lock.lock();
                <span class="hljs-keyword">try</span> { count++; } <span class="hljs-keyword">finally</span> { lock.unlock(); }
            }
        });
        t1.start(); t2.start();
        t1.join(); t2.join();
        System.out.println(<span class="hljs-string">"Final count: "</span> + count); <span class="hljs-comment">// å¿…ä¸º 20000</span>
    }
}
</code></pre>
<blockquote>
<p>âœ… è¯¥é”è™½ç®€å•ï¼Œä½†å·²å…·å¤‡å®Œæ•´çš„ AQS èƒ½åŠ›ï¼šçº¿ç¨‹æ’é˜Ÿã€é˜»å¡ã€å”¤é†’ã€å¼‚å¸¸å¤„ç†ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-13">å››ã€æ€»ç»“</h2>
<p>AQS æ˜¯ Java å¹¶å‘åŒ…ä¸­æœ€ç²¾å¦™çš„è®¾è®¡ä¹‹ä¸€ï¼Œå…¶æ ¸å¿ƒä»·å€¼åœ¨äºï¼š</p>
<ol>
<li><strong>è§£è€¦</strong>ï¼šå°†â€œèµ„æºç«äº‰è§„åˆ™â€ä¸â€œçº¿ç¨‹æ’é˜Ÿç®¡ç†â€åˆ†ç¦»ã€‚</li>
<li><strong>é«˜æ•ˆ</strong>ï¼šåŸºäº CAS + <code>LockSupport</code> å®ç°æ— é”é˜Ÿåˆ—å’Œä½å¼€é”€é˜»å¡ã€‚</li>
<li><strong>çµæ´»</strong>ï¼šé€šè¿‡ç‹¬å /å…±äº«æ¨¡å¼æ”¯æŒå„ç§åŒæ­¥è¯­ä¹‰ã€‚</li>
<li><strong>å¯é </strong>ï¼šå¤„ç†äº†ä¸­æ–­ã€è¶…æ—¶ã€å–æ¶ˆç­‰å¤æ‚è¾¹ç•Œæƒ…å†µã€‚</li>
</ol>
<p>æŒæ¡ AQSï¼Œä¸ä»…èƒ½è®©ä½ æ·±å…¥ç†è§£ <code>ReentrantLock</code>ã€<code>Semaphore</code> ç­‰å·¥å…·çš„åŸç†ï¼Œæ›´èƒ½èµ‹äºˆä½ <strong>æ„å»ºé«˜æ€§èƒ½è‡ªå®šä¹‰åŒæ­¥ç»„ä»¶çš„èƒ½åŠ›</strong>ã€‚</p>
<blockquote>
<p>ğŸ“š <strong>å»ºè®®</strong>ï¼šç»“åˆ OpenJDK æºç é˜…è¯»ï¼ˆå¦‚ <code>ReentrantLock.Sync</code>ã€<code>Semaphore.Sync</code>ï¼‰ï¼Œä½“ä¼šå¤§å¸ˆçº§å·¥ç¨‹è®¾è®¡ã€‚</p>
</blockquote>
<hr/>
<p><strong>é™„ï¼šAQS æ ¸å¿ƒæµç¨‹å›¾ï¼ˆç®€åŒ–ç‰ˆï¼‰</strong></p>
<pre><code class="hljs language-scss" lang="scss">                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ <span class="hljs-built_in">tryAcquire</span>() â”‚
                 â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                â–¼                 â”‚
       â”‚         æˆåŠŸï¼Ÿ(true)              â”‚
       â”‚                â”‚                 â”‚
       â”‚                â–¼                 â”‚
       â”‚           æ‰§è¡Œä¸´ç•ŒåŒº              â”‚
       â”‚                â”‚                 â”‚
       â”‚                â–¼                 â”‚
       â”‚          <span class="hljs-built_in">tryRelease</span>()            â”‚
       â”‚                â”‚                 â”‚
       â”‚                â–¼                 â”‚
       â”‚        å”¤é†’ head<span class="hljs-selector-class">.next</span> çº¿ç¨‹        â”‚
       â”‚                                  â”‚
       â–¼ (false)                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ <span class="hljs-built_in">addWaiter</span>() â”‚                â”‚   <span class="hljs-built_in">release</span>(arg)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                 â”‚
       â–¼                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚acquireQueuedâ”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ <span class="hljs-built_in">unparkSuccessor</span>()â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  (è¢«å”¤é†’é‡è¯•)   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€-â”€â”
â”‚shouldParkAfterFailed...â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€-â”€â”˜
            â”‚
            â–¼
    LockSupport<span class="hljs-selector-class">.park</span>()
            â”‚
            â–¼
      (è¢« unpark å”¤é†’)
</code></pre>
<blockquote>
<p>æŒæ¡ AQSï¼Œä½ å°±æŒæ¡äº† Java å¹¶å‘çš„â€œä»»ç£äºŒè„‰â€ã€‚</p>
</blockquote>
<blockquote>
<p>ä½œè€…ï¼šæ¶æ„å¸ˆBeata<br/>
æ—¥æœŸï¼š2026å¹´1æœˆ24æ—¥<br/>
ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡å¯è‡ªç”±è½¬è½½ï¼Œä½†è¯·ä¿ç•™å‡ºå¤„ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±å…¥æµ…å‡º LSDï¼šåŸºäº Solidity 0.8.24 ä¸ OpenZeppelin V5 æ„å»ºæµåŠ¨æ€§è´¨æŠ¼åè®®]]></title>    <link>https://juejin.cn/post/7598490039488774179</link>    <guid>https://juejin.cn/post/7598490039488774179</guid>    <pubDate>2026-01-24T08:46:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598490039488774179" data-draft-id="7598480267217731618" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±å…¥æµ…å‡º LSDï¼šåŸºäº Solidity 0.8.24 ä¸ OpenZeppelin V5 æ„å»ºæµåŠ¨æ€§è´¨æŠ¼åè®®"/> <meta itemprop="keywords" content="æ™ºèƒ½åˆçº¦,Solidity,web3"/> <meta itemprop="datePublished" content="2026-01-24T08:46:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æœ¨è¥¿"/> <meta itemprop="url" content="https://juejin.cn/user/2436173496845549"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±å…¥æµ…å‡º LSDï¼šåŸºäº Solidity 0.8.24 ä¸ OpenZeppelin V5 æ„å»ºæµåŠ¨æ€§è´¨æŠ¼åè®®
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2436173496845549/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æœ¨è¥¿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T08:46:04.000Z" title="Sat Jan 24 2026 08:46:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<blockquote>
<p>æœ¬æ–‡ä¸»è¦æ¢³ç†æµåŠ¨æ€§è´¨æŠ¼åè®®çš„ç†è®ºçŸ¥è¯†ï¼Œæ¶µç›–æ¦‚å¿µæœºåˆ¶ã€æ ¸å¿ƒåŠŸèƒ½ã€è¡Œä¸šç—›ç‚¹åŠåº”ç”¨ä¼˜åŠ£åŠ¿åˆ†æã€‚åŒæ—¶ï¼Œå°†å€ŸåŠ© Solidity 0.8.24 ä¸ OpenZeppelin V5ï¼Œä» 0 åˆ° 1 å®ç°ä¸€ä¸ªæµåŠ¨æ€§è´¨æŠ¼åè®®ï¼Œå®Œæ•´å±•ç¤ºå¼€å‘ã€æµ‹è¯•ä¸éƒ¨ç½²çš„å…¨æµç¨‹ã€‚</p>
</blockquote>
<h2 data-id="heading-1">æµåŠ¨æ€§è´¨æŠ¼ï¼ˆLSDï¼‰ç†è®ºæ¢³ç†</h2>
<h4 data-id="heading-2">ä¸€ã€ä¸»è¦æ¦‚å¿µä¸æ ¸å¿ƒæœºåˆ¶</h4>
<p><strong>å®šä¹‰</strong>ï¼šPoSé“¾ä¸­ï¼Œç”¨æˆ·è´¨æŠ¼ETHã€SOLç­‰åŸç”Ÿèµ„äº§è‡³åè®®ï¼Œæ™ºèƒ½åˆçº¦å³æ—¶å‘æ”¾1:1æŒ‚é’©çš„LSTï¼ˆæµåŠ¨æ€§è´¨æŠ¼ä»£å¸ï¼‰ï¼Œä»£è¡¨è´¨æŠ¼æƒç›Šä¸æ”¶ç›Šï¼ŒLSTå¯åœ¨DeFiç”Ÿæ€è‡ªç”±æµè½¬ï¼Œå®ç°â€œè´¨æŠ¼ä¸é”ä»“â€ã€‚</p>
<p><strong>æ ¸å¿ƒæµç¨‹</strong>ï¼šç”¨æˆ·å­˜å…¥èµ„äº§â†’åè®®èšåˆèµ„é‡‘å¹¶å§”æ‰˜éªŒè¯èŠ‚ç‚¹æŒ–çŸ¿â†’å‘æ”¾LSTï¼ˆä»·å€¼éšæ”¶ç›Šå¢é•¿ï¼‰â†’ç”¨æˆ·å¯äº¤æ˜“ã€ä½¿ç”¨LSTæˆ–èµå›åŸç”Ÿèµ„äº§ï¼ˆéƒ¨åˆ†æœ‰é”å®šæœŸ/æ»‘ç‚¹ï¼‰ã€‚</p>
<p><strong>å…³é”®è§’è‰²</strong>ï¼šåè®®å±‚ï¼ˆæ™ºèƒ½åˆçº¦ç®¡æ§èµ„äº§ä¸åˆ†é…ï¼‰ã€éªŒè¯èŠ‚ç‚¹ï¼ˆä¿éšœç½‘ç»œå®‰å…¨ä¸æ”¶ç›Šï¼‰ã€ç”¨æˆ·ï¼ˆè·å–LSTå…¼é¡¾æµåŠ¨æ€§ä¸æ”¶ç›Šï¼‰ã€‚</p>
<h4 data-id="heading-3">äºŒã€æ ¸å¿ƒåŠŸèƒ½</h4>
<ul>
<li>è´¨æŠ¼ä¸æµåŠ¨æ€§å…¼å¾—ï¼ŒLSTå¯å‚ä¸DeFiå®ç°æ”¶ç›Šå åŠ ï¼›</li>
<li>é™ä½é—¨æ§›ï¼Œå°é¢èµ„é‡‘å¯é€šè¿‡åè®®èšåˆå‚ä¸ï¼Œæ— éœ€è‡ªå»ºèŠ‚ç‚¹ï¼›</li>
<li>èµ„äº§å¤ç”¨å¢å€¼ï¼ŒLSTå¯å€Ÿè´·æŠµæŠ¼ã€DEXæä¾›æµåŠ¨æ€§ï¼Œæˆ–å‚ä¸å†è´¨æŠ¼æå‡å¹´åŒ–ï¼›</li>
<li>çµæ´»é€€å‡ºï¼Œé€šè¿‡äºŒçº§å¸‚åœºäº¤æ˜“æˆ–åè®®èµå›å¿«é€Ÿæ­¢æŸã€‚</li>
</ul>
<h4 data-id="heading-4">ä¸‰ã€è§£å†³çš„è¡Œä¸šç—›ç‚¹</h4>



































<table><thead><tr><th>ç—›ç‚¹</th><th>ä¼ ç»Ÿè´¨æŠ¼</th><th>æµåŠ¨æ€§è´¨æŠ¼è§£å†³æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td>æµåŠ¨æ€§ç¼ºå¤±</td><td>èµ„äº§é•¿æœŸé”å®šï¼Œæ— æ³•å†æŠ•èµ„</td><td>LSTå¯è‡ªç”±äº¤æ˜“ã€å€Ÿè´·ï¼Œé‡Šæ”¾æµåŠ¨æ€§</td></tr><tr><td>é«˜é—¨æ§›</td><td>éœ€å¤§é¢èµ„é‡‘+æŠ€æœ¯è¿ç»´èƒ½åŠ›</td><td>ä¸€é”®è´¨æŠ¼ï¼Œåè®®èšåˆå°é¢èµ„é‡‘ï¼Œé›¶æŠ€æœ¯è¦æ±‚</td></tr><tr><td>èµ„æœ¬æ•ˆç‡ä½</td><td>ä»…è·åŸºç¡€è´¨æŠ¼æ”¶ç›Šï¼Œæœºä¼šæˆæœ¬é«˜</td><td>åŒä¸€èµ„äº§å åŠ è´¨æŠ¼ä¸DeFiåŒé‡æ”¶ç›Š</td></tr><tr><td>é€€å‡ºå›°éš¾</td><td>è§£é”å‘¨æœŸé•¿ï¼Œéš¾ä»¥åŠæ—¶æ­¢æŸ</td><td>äºŒçº§å¸‚åœºå³æ—¶äº¤æ˜“æˆ–å¿«é€Ÿèµå›é€šé“</td></tr><tr><td>ä¸­å¿ƒåŒ–é£é™©</td><td>èŠ‚ç‚¹è¿è¥å•†å„æ–­ï¼Œå»ä¸­å¿ƒåŒ–ä¸è¶³</td><td>å¤šèŠ‚ç‚¹ç«äº‰ï¼Œç”¨æˆ·å¯è‡ªé€‰èŠ‚ç‚¹ï¼Œåˆ†æ•£æƒåŠ›</td></tr></tbody></table>
<h4 data-id="heading-5">å››ã€è¡Œä¸šåº”ç”¨åœºæ™¯</h4>
<ol>
<li>å»ä¸­å¿ƒåŒ–å€Ÿè´·ï¼šLSTä½œä¸ºæŠµæŠ¼å“å€Ÿæ¬¾ï¼Œå®ç°â€œè´¨æŠ¼+å€Ÿè´·â€æ æ†ï¼›</li>
<li>DEXæµåŠ¨æ€§ï¼šæä¾›LST/åŸç”Ÿèµ„äº§äº¤æ˜“å¯¹ï¼Œèµšå–æ‰‹ç»­è´¹ä¸æŒ–çŸ¿å¥–åŠ±ï¼›</li>
<li>å†è´¨æŠ¼ï¼šå­˜å…¥EigenLayerç­‰å¹³å°ï¼Œå¹´åŒ–æ”¶ç›Šå¯ä»8%æå‡è‡³15%-20%ï¼›</li>
<li>èµ„äº§ç®¡ç†ï¼šæ„å»ºä½é£é™©ã€é«˜æµåŠ¨æ€§ç†è´¢ç»„åˆï¼›</li>
<li>è¡ç”Ÿå“ç”Ÿæ€ï¼šåŸºäºLSTå‘è¡Œç¨³å®šå¸æˆ–å¼€å‘æœŸè´§ã€æœŸæƒã€‚</li>
</ol>
<h3 data-id="heading-6">äº”ã€ä¼˜åŠ¿ä¸åŠ£åŠ¿åˆ†æ</h3>
<p><strong>ä¼˜åŠ¿</strong>ï¼šèµ„æœ¬æ•ˆç‡é«˜ï¼Œæ”¶ç›Šå åŠ ï¼›é—¨æ§›ä½ã€æ“ä½œä¾¿æ·ï¼›é€€å‡ºçµæ´»ï¼›åŠ©åŠ›ç½‘ç»œå»ä¸­å¿ƒåŒ–ã€‚</p>
<p><strong>åŠ£åŠ¿</strong>ï¼šå­˜åœ¨æ™ºèƒ½åˆçº¦å®‰å…¨é£é™©ï¼›æç«¯å¸‚åœºä¸‹LSTå¯èƒ½ä¸åŸç”Ÿèµ„äº§è„±é’©ï¼›å¤´éƒ¨åè®®æœ‰èŠ‚ç‚¹é›†ä¸­éšæ‚£ï¼›éƒ¨åˆ†åè®®èµå›å—é™ï¼›LSTç›‘ç®¡æ€§è´¨å°šä¸æ˜ç¡®ã€‚</p>
<h2 data-id="heading-7">æ™ºèƒ½åˆçº¦å¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½²</h2>
<h4 data-id="heading-8">æ™ºèƒ½åˆçº¦</h4>
<p><strong>æµåŠ¨æ€§è´¨æŠ¼æ™ºèƒ½åˆçº¦</strong>ï¼šå®ƒçš„æ ¸å¿ƒé€»è¾‘æ˜¯ï¼šç”¨æˆ·è´¨æŠ¼ ETHï¼Œåˆçº¦æŒ‰ 1:1 çš„æ¯”ä¾‹é“¸é€ ä»£å¸ï¼ˆstETHï¼‰ç»™ç”¨æˆ·ï¼›å½“ç”¨æˆ·é”€æ¯ stETH æ—¶ï¼Œè¿”è¿˜ç­‰é‡çš„ ETH</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// SPDX-License-Identifier: MIT</span>
pragma solidity ^<span class="hljs-number">0.8</span><span class="hljs-number">.24</span>;

<span class="hljs-keyword">import</span> {<span class="hljs-title class_">ERC20</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">"@openzeppelin/contracts/token/ERC20/ERC20.sol"</span>;
<span class="hljs-keyword">import</span> {<span class="hljs-title class_">Ownable</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">"@openzeppelin/contracts/access/Ownable.sol"</span>;
<span class="hljs-keyword">import</span> {<span class="hljs-title class_">ReentrancyGuard</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">"@openzeppelin/contracts/utils/ReentrancyGuard.sol"</span>;

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@title</span> <span class="hljs-variable">SimpleLiquidStaking</span>
 * <span class="hljs-doctag">@dev</span> å®ç°åŸºç¡€çš„ ETH è´¨æŠ¼å¹¶è·å¾— LSD ä»£å¸ (stETH)
 */</span>
contract <span class="hljs-title class_">SimpleLiquidStaking</span> is <span class="hljs-title class_">ERC20</span>, <span class="hljs-title class_">Ownable</span>, <span class="hljs-title class_">ReentrancyGuard</span> {
    
    event <span class="hljs-title class_">Staked</span>(address indexed user, uint256 amount);
    event <span class="hljs-title class_">Withdrawn</span>(address indexed user, uint256 amount);

    <span class="hljs-comment">// åˆå§‹åŒ–æ—¶è®¾ç½®ä»£å¸åç§°å’Œç¬¦å·ï¼Œå¹¶å°†æ‰€æœ‰æƒç§»äº¤ç»™éƒ¨ç½²è€…</span>
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) <span class="hljs-title class_">ERC20</span>(<span class="hljs-string">"Liquid Staked ETH"</span>, <span class="hljs-string">"stETH"</span>) <span class="hljs-title class_">Ownable</span>(msg.<span class="hljs-property">sender</span>) {}

    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@notice</span> ç”¨æˆ·è´¨æŠ¼ ETHï¼Œè·å¾—ç­‰é¢ stETH
     * <span class="hljs-doctag">@dev</span> ä½¿ç”¨ nonReentrant é˜²æ­¢é‡å…¥æ”»å‡»
     */</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">stake</span>(<span class="hljs-params"/>) external payable nonReentrant {
        <span class="hljs-built_in">require</span>(msg.<span class="hljs-property">value</span> &gt; <span class="hljs-number">0</span>, <span class="hljs-string">"Amount must be greater than 0"</span>);
        
        <span class="hljs-comment">// 1:1 é“¸é€ ä»£å¸ç»™ç”¨æˆ·</span>
        <span class="hljs-title function_">_mint</span>(msg.<span class="hljs-property">sender</span>, msg.<span class="hljs-property">value</span>);
        
        emit <span class="hljs-title class_">Staked</span>(msg.<span class="hljs-property">sender</span>, msg.<span class="hljs-property">value</span>);
    }

    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@notice</span> ç”¨æˆ·é”€æ¯ stETHï¼Œå–å›ç­‰é¢ ETH
     * <span class="hljs-doctag">@param</span> amount æƒ³è¦æå–çš„é‡‘é¢
     */</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">withdraw</span>(<span class="hljs-params">uint256 amount</span>) external nonReentrant {
        <span class="hljs-built_in">require</span>(amount &gt; <span class="hljs-number">0</span>, <span class="hljs-string">"Amount must be greater than 0"</span>);
        <span class="hljs-built_in">require</span>(<span class="hljs-title function_">balanceOf</span>(msg.<span class="hljs-property">sender</span>) &gt;= amount, <span class="hljs-string">"Insufficient stETH balance"</span>);

        <span class="hljs-comment">// å…ˆé”€æ¯ç”¨æˆ·çš„ stETH å‡­è¯</span>
        <span class="hljs-title function_">_burn</span>(msg.<span class="hljs-property">sender</span>, amount);
        
        <span class="hljs-comment">// å‘é€ ETH ç»™ç”¨æˆ·</span>
        (bool success, ) = <span class="hljs-title function_">payable</span>(msg.<span class="hljs-property">sender</span>).<span class="hljs-property">call</span>{<span class="hljs-attr">value</span>: amount}(<span class="hljs-string">""</span>);
        <span class="hljs-built_in">require</span>(success, <span class="hljs-string">"ETH transfer failed"</span>);

        emit <span class="hljs-title class_">Withdrawn</span>(msg.<span class="hljs-property">sender</span>, amount);
    }

    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@dev</span> å…è®¸åˆçº¦æ¥æ”¶ ETH (ä¾‹å¦‚éªŒè¯è€…èŠ‚ç‚¹çš„å¥–åŠ±è¿”è¿˜)
     */</span>
    <span class="hljs-title function_">receive</span>() external payable {}
}

</code></pre>
<h4 data-id="heading-9">éƒ¨ç½²è„šæœ¬</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// scripts/deploy.js</span>
<span class="hljs-keyword">import</span> { network, artifacts } <span class="hljs-keyword">from</span> <span class="hljs-string">"hardhat"</span>;
<span class="hljs-keyword">import</span> { parseUnits } <span class="hljs-keyword">from</span> <span class="hljs-string">"viem"</span>;
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// è¿æ¥ç½‘ç»œ</span>
  <span class="hljs-keyword">const</span> { viem } = <span class="hljs-keyword">await</span> network.<span class="hljs-title function_">connect</span>({ <span class="hljs-attr">network</span>: network.<span class="hljs-property">name</span> });<span class="hljs-comment">//æŒ‡å®šç½‘ç»œè¿›è¡Œé“¾æ¥</span>
  
  <span class="hljs-comment">// è·å–å®¢æˆ·ç«¯</span>
  <span class="hljs-keyword">const</span> [deployer, investor] = <span class="hljs-keyword">await</span> viem.<span class="hljs-title function_">getWalletClients</span>();
  <span class="hljs-keyword">const</span> publicClient = <span class="hljs-keyword">await</span> viem.<span class="hljs-title function_">getPublicClient</span>();
 
  <span class="hljs-keyword">const</span> deployerAddress = deployer.<span class="hljs-property">account</span>.<span class="hljs-property">address</span>;
   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"éƒ¨ç½²è€…çš„åœ°å€:"</span>, deployerAddress);
  
  <span class="hljs-comment">// éƒ¨ç½²SimpleLiquidStakingåˆçº¦</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title class_">SimpleLiquidStakingArtifact</span> = <span class="hljs-keyword">await</span> artifacts.<span class="hljs-title function_">readArtifact</span>(<span class="hljs-string">"SimpleLiquidStaking"</span>);
  <span class="hljs-comment">// 1. éƒ¨ç½²åˆçº¦å¹¶è·å–äº¤æ˜“å“ˆå¸Œ</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title class_">SimpleLiquidStakingHash</span> = <span class="hljs-keyword">await</span> deployer.<span class="hljs-title function_">deployContract</span>({
    <span class="hljs-attr">abi</span>: <span class="hljs-title class_">SimpleLiquidStakingArtifact</span>.<span class="hljs-property">abi</span>,
    <span class="hljs-attr">bytecode</span>: <span class="hljs-title class_">SimpleLiquidStakingArtifact</span>.<span class="hljs-property">bytecode</span>,
    <span class="hljs-attr">args</span>: [],
  });
  <span class="hljs-keyword">const</span> <span class="hljs-title class_">SimpleLiquidStakingReceipt</span> = <span class="hljs-keyword">await</span> publicClient.<span class="hljs-title function_">waitForTransactionReceipt</span>({ 
     <span class="hljs-attr">hash</span>: <span class="hljs-title class_">SimpleLiquidStakingHash</span> 
   });
   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"SimpleLiquidStakingåˆçº¦åœ°å€:"</span>, <span class="hljs-title class_">SimpleLiquidStakingReceipt</span>.<span class="hljs-property">contractAddress</span>);
}

<span class="hljs-title function_">main</span>().<span class="hljs-title function_">catch</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">error</span>);
</code></pre>
<h4 data-id="heading-10">æµ‹è¯•è„šæœ¬</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> assert <span class="hljs-keyword">from</span> <span class="hljs-string">"node:assert/strict"</span>;
<span class="hljs-keyword">import</span> { describe, it, beforeEach } <span class="hljs-keyword">from</span> <span class="hljs-string">"node:test"</span>;
<span class="hljs-keyword">import</span> { parseEther } <span class="hljs-keyword">from</span> <span class="hljs-string">'viem'</span>;
<span class="hljs-comment">// æ³¨æ„ï¼šåœ¨ Hardhat ç¯å¢ƒä¸­é€šå¸¸é€šè¿‡ hre è·å– viem</span>
<span class="hljs-keyword">import</span> hre <span class="hljs-keyword">from</span> <span class="hljs-string">"hardhat"</span>;

<span class="hljs-title function_">describe</span>(<span class="hljs-string">"SimpleLiquidStaking æµ‹è¯•"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> { viem } = <span class="hljs-keyword">await</span> hre.<span class="hljs-property">network</span>.<span class="hljs-title function_">connect</span>();
    <span class="hljs-keyword">let</span> <span class="hljs-attr">simpleLiquidStaking</span>: <span class="hljs-built_in">any</span>;
    <span class="hljs-keyword">let</span> <span class="hljs-attr">publicClient</span>: <span class="hljs-built_in">any</span>;
    <span class="hljs-keyword">let</span> <span class="hljs-attr">owner</span>: <span class="hljs-built_in">any</span>, <span class="hljs-attr">user1</span>: <span class="hljs-built_in">any</span>;
    <span class="hljs-keyword">let</span> <span class="hljs-attr">deployerAddress</span>: <span class="hljs-built_in">string</span>;

    <span class="hljs-title function_">beforeEach</span>(<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
        
        <span class="hljs-comment">// è·å– clients</span>
        publicClient = <span class="hljs-keyword">await</span> viem.<span class="hljs-title function_">getPublicClient</span>();
        [owner, user1] = <span class="hljs-keyword">await</span> viem.<span class="hljs-title function_">getWalletClients</span>();
        deployerAddress = owner.<span class="hljs-property">account</span>.<span class="hljs-property">address</span>;

        <span class="hljs-comment">// éƒ¨ç½²åˆçº¦ï¼Œæ³¨æ„ OpenZeppelin V5 çš„ Ownable éœ€è¦æ„é€ å‚æ•°ï¼ˆå¯é€‰ï¼Œå–å†³äºä½ åˆçº¦å…·ä½“å®ç°ï¼‰</span>
        <span class="hljs-comment">// å¦‚æœä½ çš„åˆçº¦æ„é€ å‡½æ•°æ˜¯ constructor() ERC20(...) Ownable(msg.sender) {}</span>
        simpleLiquidStaking = <span class="hljs-keyword">await</span> viem.<span class="hljs-title function_">deployContract</span>(<span class="hljs-string">"SimpleLiquidStaking"</span>, []);
    });

    <span class="hljs-title function_">it</span>(<span class="hljs-string">"ç”¨æˆ·åº”è¯¥èƒ½å¤ŸæˆåŠŸè´¨æŠ¼ ETH å¹¶è·å¾— stETH"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
        <span class="hljs-keyword">const</span> stakeAmount = <span class="hljs-title function_">parseEther</span>(<span class="hljs-string">"10"</span>);

        <span class="hljs-comment">// 1. æ‰§è¡Œè´¨æŠ¼æ“ä½œ</span>
        <span class="hljs-keyword">const</span> hash = <span class="hljs-keyword">await</span> user1.<span class="hljs-title function_">writeContract</span>({
            <span class="hljs-attr">address</span>: simpleLiquidStaking.<span class="hljs-property">address</span>,
            <span class="hljs-attr">abi</span>: simpleLiquidStaking.<span class="hljs-property">abi</span>,
            <span class="hljs-attr">functionName</span>: <span class="hljs-string">"stake"</span>,
            <span class="hljs-attr">value</span>: stakeAmount,
        });

        <span class="hljs-comment">// 2. ç­‰å¾…äº¤æ˜“ç¡®è®¤</span>
        <span class="hljs-keyword">await</span> publicClient.<span class="hljs-title function_">waitForTransactionReceipt</span>({ hash });

        <span class="hljs-comment">// 3. éªŒè¯åˆçº¦ä¸­çš„ ETH ä½™é¢</span>
        <span class="hljs-keyword">const</span> contractEthBalance = <span class="hljs-keyword">await</span> publicClient.<span class="hljs-title function_">getBalance</span>({
            <span class="hljs-attr">address</span>: simpleLiquidStaking.<span class="hljs-property">address</span>,
        });
        assert.<span class="hljs-title function_">equal</span>(contractEthBalance, stakeAmount, <span class="hljs-string">"åˆçº¦æ”¶åˆ°çš„ ETH æ•°é‡ä¸æ­£ç¡®"</span>);

        <span class="hljs-comment">// 4. éªŒè¯ç”¨æˆ·æ”¶åˆ°çš„ stETH å‡­è¯æ•°é‡</span>
        <span class="hljs-keyword">const</span> userStEthBalance = <span class="hljs-keyword">await</span> simpleLiquidStaking.<span class="hljs-property">read</span>.<span class="hljs-title function_">balanceOf</span>([user1.<span class="hljs-property">account</span>.<span class="hljs-property">address</span>]);
        assert.<span class="hljs-title function_">equal</span>(userStEthBalance, stakeAmount, <span class="hljs-string">"ç”¨æˆ·è·å¾—çš„ stETH æ•°é‡ä¸æ­£ç¡®"</span>);
    });

    <span class="hljs-title function_">it</span>(<span class="hljs-string">"ç”¨æˆ·åº”è¯¥èƒ½å¤Ÿé€šè¿‡é”€æ¯ stETH èµå› ETH"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
        <span class="hljs-keyword">const</span> amount = <span class="hljs-title function_">parseEther</span>(<span class="hljs-string">"5"</span>);

        <span class="hljs-comment">// 1. å…ˆè´¨æŠ¼</span>
        <span class="hljs-keyword">await</span> user1.<span class="hljs-title function_">writeContract</span>({
            <span class="hljs-attr">address</span>: simpleLiquidStaking.<span class="hljs-property">address</span>,
            <span class="hljs-attr">abi</span>: simpleLiquidStaking.<span class="hljs-property">abi</span>,
            <span class="hljs-attr">functionName</span>: <span class="hljs-string">"stake"</span>,
            <span class="hljs-attr">value</span>: amount,
        });

        <span class="hljs-keyword">const</span> ethBalanceBefore = <span class="hljs-keyword">await</span> publicClient.<span class="hljs-title function_">getBalance</span>({ <span class="hljs-attr">address</span>: user1.<span class="hljs-property">account</span>.<span class="hljs-property">address</span> });

        <span class="hljs-comment">// 2. æ‰§è¡Œèµå›</span>
        <span class="hljs-keyword">const</span> hash = <span class="hljs-keyword">await</span> user1.<span class="hljs-title function_">writeContract</span>({
            <span class="hljs-attr">address</span>: simpleLiquidStaking.<span class="hljs-property">address</span>,
            <span class="hljs-attr">abi</span>: simpleLiquidStaking.<span class="hljs-property">abi</span>,
            <span class="hljs-attr">functionName</span>: <span class="hljs-string">"withdraw"</span>,
            <span class="hljs-attr">args</span>: [amount],
        });
        <span class="hljs-keyword">const</span> receipt = <span class="hljs-keyword">await</span> publicClient.<span class="hljs-title function_">waitForTransactionReceipt</span>({ hash });
        <span class="hljs-comment">// console.log(receipt);</span>
        <span class="hljs-comment">// 3. éªŒè¯ stETH æ˜¯å¦å·²é”€æ¯</span>
        <span class="hljs-keyword">const</span> stEthBalanceAfter = <span class="hljs-keyword">await</span> simpleLiquidStaking.<span class="hljs-property">read</span>.<span class="hljs-title function_">balanceOf</span>([user1.<span class="hljs-property">account</span>.<span class="hljs-property">address</span>]);
        assert.<span class="hljs-title function_">equal</span>(stEthBalanceAfter, <span class="hljs-number">0n</span>, <span class="hljs-string">"stETH åº”è¯¥å·²è¢«é”€æ¯"</span>);

        <span class="hljs-comment">// 4. éªŒè¯ç”¨æˆ· ETH ä½™é¢æ˜¯å¦å¢åŠ  (è€ƒè™‘ Gas è´¹ï¼Œä½™é¢åº”å¤§äºèµå›å‰)</span>
        <span class="hljs-keyword">const</span> ethBalanceAfter = <span class="hljs-keyword">await</span> publicClient.<span class="hljs-title function_">getBalance</span>({ <span class="hljs-attr">address</span>: user1.<span class="hljs-property">account</span>.<span class="hljs-property">address</span> });
        assert.<span class="hljs-title function_">ok</span>(ethBalanceAfter &gt; ethBalanceBefore, <span class="hljs-string">"ç”¨æˆ·æœªæ”¶åˆ°èµå›çš„ ETH"</span>);
    }); 
});
</code></pre>
<h2 data-id="heading-11">ç»“è¯­</h2>
<p>è‡³æ­¤ï¼ŒæµåŠ¨æ€§è´¨æŠ¼åè®®çš„ç†è®ºæ¢³ç†ä¸ä»£ç å®ç°å·²å…¨éƒ¨è½åœ°ã€‚æœ¬æ–‡æ—¢å¤¯å®äº†ç†è®ºè®¤çŸ¥ï¼Œåˆé€šè¿‡Solidity 0.8.24ä¸OpenZeppelin V5å®Œæˆäº†ä»å¼€å‘åˆ°éƒ¨ç½²çš„å…¨æµç¨‹å®è·µï¼Œå½¢æˆç†è®ºä¸å®æ“çš„é—­ç¯ã€‚
æœ¬æ¬¡è½åœ°æ¡ˆä¾‹ä¸ºç›¸å…³å¼€å‘è€…æä¾›äº†å¯å‚è€ƒçš„å®è·µèŒƒå¼ï¼Œä¹Ÿå°è¯äº†æµåŠ¨æ€§è´¨æŠ¼åœ¨åŒºå—é“¾ç”Ÿæ€ä¸­çš„åº”ç”¨ä»·å€¼ã€‚æœªæ¥å¯åŸºäºæ­¤è¿›ä¸€æ­¥ä¼˜åŒ–åè®®æ€§èƒ½ã€åº”å¯¹è¡Œä¸šæŒ‘æˆ˜ï¼ŒåŠ©åŠ›DeFiç”Ÿæ€æŒç»­è¿­ä»£ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è¡Œä¸šé¢†å…ˆçš„æœç´¢æŠ€æœ¯è¿›å±•åˆ†æ]]></title>    <link>https://juejin.cn/post/7598532592455745563</link>    <guid>https://juejin.cn/post/7598532592455745563</guid>    <pubDate>2026-01-24T08:48:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598532592455745563" data-draft-id="7598499504170975270" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è¡Œä¸šé¢†å…ˆçš„æœç´¢æŠ€æœ¯è¿›å±•åˆ†æ"/> <meta itemprop="keywords" content="æ¶æ„"/> <meta itemprop="datePublished" content="2026-01-24T08:48:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è‡ªç”±ç”Ÿé•¿2024"/> <meta itemprop="url" content="https://juejin.cn/user/1591748569862670"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è¡Œä¸šé¢†å…ˆçš„æœç´¢æŠ€æœ¯è¿›å±•åˆ†æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1591748569862670/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è‡ªç”±ç”Ÿé•¿2024
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T08:48:10.000Z" title="Sat Jan 24 2026 08:48:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">è¡Œä¸šé¢†å…ˆçš„æœç´¢æŠ€æœ¯è¿›å±•åˆ†æ</h2>
<p>æ ¹æ®æœ€æ–°è¡Œä¸šåŠ¨æ€ï¼Œæœç´¢æŠ€æœ¯æ­£ç»å†å‰æ‰€æœªæœ‰çš„å˜é©ï¼Œä¸»è¦é›†ä¸­åœ¨AIé©±åŠ¨çš„å¤šæ¨¡æ€æœç´¢ã€å¯¹è¯å¼äº¤äº’å’Œå®æ—¶äº‹å®æ ¸æŸ¥ç­‰æ–¹å‘ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸»è¦æœç´¢å¼•æ“å…¬å¸çš„æŠ€æœ¯è¿›å±•ï¼š</p>
<h3 data-id="heading-1">è°·æ­Œæœç´¢ï¼ˆGoogle Searchï¼‰</h3>
<p><strong>2025å¹´æŠ€æœ¯çªç ´ï¼š</strong></p>
<ul>
<li><strong>AIæ¨¡å¼å…¨çƒé“ºå¼€</strong>ï¼š2025å¹´5æœˆåœ¨ç¾å›½å¸‚åœºæ¨å‡ºé›†æˆGemini 2.5æ¨¡å‹çš„AIæ¨¡å¼ï¼Œæ”¯æŒå¤šæ¨¡æ€æœç´¢å’Œå¯¹è¯æ¨¡å¼ï¼Œ2025å¹´10æœˆå·²è¦†ç›–å…¨çƒ200ä½™ä¸ªå›½å®¶å’Œåœ°åŒº</li>
<li><strong>AIæ¦‚è§ˆä¸éŸ³é¢‘åŠŸèƒ½</strong>ï¼š2025å¹´6æœˆä¸Šçº¿éŸ³é¢‘æ¦‚è§ˆåŠŸèƒ½ï¼Œç”ŸæˆåŒ…å«ä¸¤ä½è™šæ‹Ÿä¸»æŒäººäº’åŠ¨å¯¹è¯çš„æ’­å®¢å¼AIè¯­éŸ³æ€»ç»“</li>
<li><strong>æ¨¡å‹å‡çº§</strong>ï¼š2025å¹´9æœˆé›†æˆGemini 3äººå·¥æ™ºèƒ½æ¨¡å‹ï¼Œæå‡äº‹å®å‡†ç¡®æ€§å¹¶å¼ºåŒ–å®‰å…¨é˜²æŠ¤èƒ½åŠ›</li>
<li><strong>å¤šæ¨¡æ€èƒ½åŠ›</strong>ï¼šæ”¯æŒé€šè¿‡è¯­éŸ³ã€æ–‡å­—ã€å›¾ç‰‡è¾“å…¥åŠå®æ—¶è§†é¢‘äº¤äº’è¿›è¡Œæ·±åº¦æœç´¢ï¼Œèƒ½è‡ªåŠ¨å‘èµ·ä¸Šç™¾æ¬¡è·¨é¢†åŸŸæœç´¢ç”Ÿæˆä¸“å®¶çº§æŠ¥å‘Š</li>
<li><strong>å›¾åƒå¤„ç†</strong>ï¼š2025å¹´10æœˆå¼•å…¥å›¾åƒç¼–è¾‘æ¨¡å‹Nano Bananaï¼Œå¹¶è®¡åˆ’æ•´åˆC2PA 2.1æ ‡å‡†æ ‡æ³¨AIç”Ÿæˆå†…å®¹</li>
</ul>
<p><strong>æŠ€æœ¯å½±å“</strong>ï¼šAIæ¨¡å¼ä½¿å¹³å‡æŸ¥è¯¢æ¬¡æ•°å‡å°‘40%ï¼Œç”¨æˆ·åœç•™åœ¨æœç´¢é¡µé¢çš„æ—¶é—´å¢åŠ 25%ï¼Œåœ¨åŒ»ç–—å’¨è¯¢ã€å­¦æœ¯ç ”ç©¶ç­‰å¤æ‚åœºæ™¯ä¸­æ•ˆç‡æå‡æ˜¾è‘—ã€‚</p>
<h3 data-id="heading-2">å¾®è½¯å¿…åº”ï¼ˆBingï¼‰</h3>
<p><strong>AIæ•´åˆè¿›å±•ï¼š</strong></p>
<ul>
<li>2023å¹´2æœˆï¼šæ¨å‡ºæ•´åˆChatGPTæŠ€æœ¯çš„æ–°ç‰ˆæœç´¢å¼•æ“ï¼ŒåˆæœŸé‡‡ç”¨GPT-3.5å‡çº§ç‰ˆ</li>
<li>2023å¹´3æœˆï¼šå‡çº§è‡³GPT-4æ¨¡å‹ï¼Œæ–°å¢AIèŠå¤©ã€è§†è§‰æœç´¢åŠå›¾åƒç”ŸæˆåŠŸèƒ½</li>
<li>2025å¹´8æœˆï¼šæ¥å…¥OpenAIçš„GPT-4oå›¾åƒç”Ÿæˆæ¨¡å‹</li>
<li>2024å¹´10æœˆï¼šä¸Šçº¿AIç”Ÿæˆæ‘˜è¦åŠŸèƒ½</li>
</ul>
<p><strong>å¸‚åœºè¡¨ç°</strong>ï¼š2025å¹´6æœˆä¸­å›½å¸‚åœºä»½é¢è¾¾40.23%ï¼Œè¿ç»­12ä¸ªæœˆå±…é¦–ï¼Œæˆä¸ºä¸­å›½å¸‚åœºçš„é‡è¦ç«äº‰è€…ã€‚</p>
<h3 data-id="heading-3">ç”µå•†æœç´¢é¢†åŸŸ</h3>
<p><strong>æ·˜å®æœç´¢ï¼š</strong></p>
<ul>
<li>2025å¹´å¯åŠ¨AIé©±åŠ¨çš„å‡çº§ï¼Œæ„å»ºè¦†ç›–20äº¿å•†å“çš„åºå¤§çŸ¥è¯†å›¾è°±</li>
<li>2025å¹´8æœˆï¼šåŸºäºAI Agentè¾…åŠ©ç”Ÿæˆæ ‡ç­¾çš„æ–°å•†å“åº“å®Œæˆï¼Œé€šè¿‡å°èŒƒå›´æµ‹è¯•éªŒè¯</li>
<li>2025å¹´10æœˆï¼šå‘å•†å®¶å¼€æ”¾æœç´¢æ¡†è‡ªå®šä¹‰è¿è¥æƒé™ï¼Œæ”¯æŒå•†å®¶åœ¨ç‰¹å®šåœºæ™¯ä¸‹è®¾ç½®æœç´¢åº•çº¹è¯ã€å®æ—¶çƒ­æœç­‰</li>
</ul>
<p><strong>æŠ€æœ¯è¶‹åŠ¿</strong>ï¼šä»"å…³é”®è¯åŒ¹é…"å‘"éœ€æ±‚ç†è§£"è½¬å˜ï¼Œæ‰“é€šæœç´¢ä¸æ¨èä½“ç³»ï¼Œå®ç°ç”¨æˆ·æœç´¢å†…å®¹ä¸é¦–é¡µæ¨èçš„è”åŠ¨ã€‚</p>
<h3 data-id="heading-4">çŸ­è§†é¢‘æœç´¢åˆ›æ–°</h3>
<p><strong>å¿«æ‰‹CroPSæ£€ç´¢å¼•æ“ï¼š</strong></p>
<ul>
<li>2026å¹´åˆæ¨å‡ºï¼Œæ—¨åœ¨æ‰“ç ´æœç´¢ä¿¡æ¯èŒ§æˆ¿ï¼Œä¼˜åŒ–çŸ­è§†é¢‘æœç´¢é€»è¾‘</li>
<li>æ ¸å¿ƒåˆ›æ–°ï¼šå¼•å…¥"è·¨è§†è§’æ­£æ ·æœ¬å¢å¼º"æœºåˆ¶ï¼Œé€šè¿‡å¤šç»´åº¦æ­£æ ·æœ¬å¢å¼ºï¼Œä»æ ¹æºä¸Šæ‰“ç ´æ•°æ®é—­ç¯</li>
<li>è§£å†³é—®é¢˜ï¼šä¼ ç»Ÿå‘é‡æ£€ç´¢æ¨¡å‹å› ä¾èµ–å†å²æ›å…‰æ•°æ®å¯¼è‡´çš„æ ·æœ¬åå·®å’Œä¿¡æ¯èŒ§æˆ¿é—®é¢˜</li>
</ul>
<h3 data-id="heading-5">è¡Œä¸šå…±åŒè¶‹åŠ¿</h3>
<ol>
<li><strong>ä»å…³é”®è¯åˆ°å¯¹è¯å¼æœç´¢</strong>ï¼šè°·æ­Œã€å¾®è½¯ç­‰å…¬å¸æ­£æ¨åŠ¨æœç´¢ä»"å…³é”®è¯-é“¾æ¥åˆ—è¡¨"å‘"å¤šè½®å¤æ‚å¯¹è¯"è½¬å˜</li>
<li><strong>å¤šæ¨¡æ€èƒ½åŠ›æ•´åˆ</strong>ï¼šæœç´¢ç³»ç»Ÿä¸ä»…èƒ½å¤„ç†æ–‡æœ¬ï¼Œè¿˜èƒ½ç†è§£å›¾åƒã€éŸ³é¢‘ã€è§†é¢‘ä¸­çš„å†…å®¹</li>
<li><strong>å®æ—¶äº‹å®æ ¸æŸ¥</strong>ï¼šAIå¼•æ“èƒ½å¯¹æ£€ç´¢ä¿¡æ¯è¿›è¡Œå¯ä¿¡åº¦è¯„ä¼°ï¼Œæ ‡æ³¨å¯èƒ½å­˜åœ¨çš„é”™è¯¯æˆ–äº‰è®®</li>
<li><strong>çŸ¥è¯†å›¾è°±æ„å»º</strong>ï¼šæ„å»ºå¤§è§„æ¨¡çŸ¥è¯†å›¾è°±ï¼Œè®©AIèƒ½æ›´æ·±å…¥ç†è§£å†…å®¹ï¼Œå¦‚æ·˜å®æ„å»ºçš„20äº¿å•†å“çŸ¥è¯†å›¾è°±</li>
<li><strong>ä¸ªæ€§åŒ–ä¸éœ€æ±‚ç†è§£</strong>ï¼šé€šè¿‡æŒç»­å¯¹è¯æœºåˆ¶ç²¾å‡†æ•æ‰ç”¨æˆ·æ·±å±‚éœ€æ±‚ï¼Œå®ç°"éœ€æ±‚ç†è§£-èµ„æºåŒ¹é…"é—­ç¯</li>
</ol>
<h3 data-id="heading-6">æŒ‘æˆ˜ä¸å±•æœ›</h3>
<p>å°½ç®¡æŠ€æœ¯è¿›å±•æ˜¾è‘—ï¼Œè¡Œä¸šä»é¢ä¸´æŒ‘æˆ˜ï¼š</p>
<ul>
<li>ä¿¡æ¯å‡†ç¡®æ€§é—®é¢˜ï¼šAIç”Ÿæˆçš„æ‘˜è¦å¯èƒ½å­˜åœ¨åå·®</li>
<li>ç®—æ³•åè§ï¼šå¯èƒ½å¯¼è‡´æœç´¢ç»“æœçš„ä¸å…¬å¹³</li>
<li>éšç§ä¿æŠ¤ï¼šAIéœ€è¦æ”¶é›†åˆ†æç”¨æˆ·è¡Œä¸º</li>
<li>è™šå‡ä¿¡æ¯ï¼šAIå¯èƒ½è¢«ç”¨äºä¼ æ’­è™šå‡å†…å®¹</li>
</ul>
<p>æœªæ¥æœç´¢å°†è¶…è¶Šä¿¡æ¯æœ¬èº«ï¼Œæ¼”è¿›ä¸ºæ›´æ™ºèƒ½çš„çŸ¥è¯†æœåŠ¡ï¼ŒAIå°†èƒ½å¤Ÿç†è§£ç”¨æˆ·çš„çœŸå®æ„å›¾ï¼Œæä¾›æ›´åŠ ä¸ªæ€§åŒ–å’Œå®šåˆ¶åŒ–çš„ç­”æ¡ˆï¼Œç”¨æˆ·å‚ä¸åº¦å°†æˆä¸ºè¡¡é‡æœç´¢è´¨é‡çš„é‡è¦æŒ‡æ ‡ã€‚</p>
<p>å½“å‰ï¼Œè°·æ­Œã€å¾®è½¯ç­‰å·¨å¤´çš„AIæœç´¢æŠ€æœ¯å·²è¿›å…¥å®è´¨æ€§åº”ç”¨é˜¶æ®µï¼Œè€Œå¿«æ‰‹ã€æ·˜å®ç­‰å¹³å°åˆ™åœ¨å‚ç›´é¢†åŸŸæ¢ç´¢AIæœç´¢çš„ç‹¬ç‰¹ä»·å€¼ï¼Œè¡Œä¸šæ­£æœç€æ›´æ™ºèƒ½ã€æ›´äº¤äº’ã€æ›´å¯ä¿¡çš„æ–¹å‘å‘å±•ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[GOä¸­çš„sync.Mapæºç è§£æ]]></title>    <link>https://juejin.cn/post/7598447519824019497</link>    <guid>https://juejin.cn/post/7598447519824019497</guid>    <pubDate>2026-01-24T08:49:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598447519824019497" data-draft-id="7598587406695415851" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="GOä¸­çš„sync.Mapæºç è§£æ"/> <meta itemprop="keywords" content="Go"/> <meta itemprop="datePublished" content="2026-01-24T08:49:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Vecray"/> <meta itemprop="url" content="https://juejin.cn/user/3702810895739134"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            GOä¸­çš„sync.Mapæºç è§£æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3702810895739134/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Vecray
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T08:49:39.000Z" title="Sat Jan 24 2026 08:49:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Mapçš„æºç è§£æï¼Œè¿˜æ˜¯æœ‰ç‚¹ç»•çš„</p>
<p>ä¸»è¦ä¸¤ä¸ªå­—æ®µï¼šreadå’Œdirty</p>
<p>æˆ‘çš„ç†è§£æ˜¯readç›¸å½“äºredisï¼Œdirtyç›¸å½“äºdbï¼š</p>
<p>è¯»ï¼š</p>
<ol>
<li>è¯»éƒ½ä»readä¸­è¯»å–ï¼Œä¸åŠ é”ï¼Œå¾ˆå¿«</li>
<li>å¦‚æœreadä¸­æ²¡æœ‰ï¼Œé‚£å°±ä» dirty ä¸­è¯»å–ï¼Œè¿™æ—¶å°±ä¼šåŠ é”è¯»å–äº†</li>
<li>å¦‚æœdirtyä¸­æœ‰å€¼ï¼Œè¿”å›å€¼ï¼Œè¦ä¸è¦æ›´æ–°readå‘¢ï¼Ÿçœ‹missesç»Ÿè®¡æ•°é‡ï¼Œåªæœ‰è¾¾åˆ°æŸä¸ªé˜ˆå€¼misses &gt; len(dirty)ï¼Œæ‰ä¼šæ›´æ–°readï¼ˆæ­£å¸¸æˆ‘ä»¬ä»dirtyä¸­è¯»å–ä¹‹åä¼šé‡æ–°è®¾ç½®åˆ°readä¸­ï¼Œä½†æ˜¯ä½œè€…é€‰æ‹©æä¸ªé˜ˆå€¼æ¥æ§åˆ¶ï¼Œè¿™æ ·å‡å°‘æ‹·è´å€¼ï¼Œå› ä¸ºæ‹·è´å€¼ä¹Ÿæ˜¯æ¯”è¾ƒè€—æ—¶çš„äº‹æƒ…ï¼‰</li>
</ol>
<p>å†™ï¼š</p>
<ol>
<li>å†™çš„æ—¶å€™ï¼Œä¼˜å…ˆæ›´æ–°readä¸­çš„keyï¼Œå› ä¸ºè¿™æ—¶å€™ä¸éœ€è¦åŠ é”ï¼Œé€šè¿‡åŸå­æ“ä½œCompareAndSwap()ï¼Œå¦‚æœèƒ½æ›´æ–°æˆåŠŸï¼Œé‚£å°±èµšåˆ°äº†</li>
<li>å¦‚æœreadä¸­æ²¡æœ‰keyï¼Œé‚£å°±å¼€å§‹åŠ é”äº†ï¼Œå› ä¸ºå¯èƒ½è¦æ“ä½œdirtyäº†
<ul>
<li>è¿™æ—¶å€™è¿˜æ˜¯ä¼šå…ˆçœ‹readä¸­æœ‰æ²¡æœ‰å€¼ï¼Œæœ‰å°±æ›´æ–°readé‡Œçš„æ•°æ®ï¼ˆåŒé‡æ ¡éªŒreadï¼Œå› ä¸ºå¯èƒ½å…¶ä»–çº¿ç¨‹æŠŠreadç»™æ›´æ–°äº†ï¼Œè¿™æ—¶å€™readä¸­åˆæœ‰å€¼äº†ï¼Œæ¡æ¼ï¼‰</li>
</ul>
</li>
<li>å¦‚æœreadè¿˜æ˜¯æ²¡æœ‰keyï¼Œé‚£å°±è¦çœ‹è¿™ä¸ªkeyåœ¨ä¸åœ¨dirtyä¸­äº†ï¼Œå¦‚æœåœ¨dirtyä¸­ï¼Œç›´æ¥æ›´æ–°dirtyä¸­çš„å€¼</li>
<li>å¦‚æœéƒ½ä¸åœ¨ï¼Œé‚£å°±æ˜¯æ–°keyï¼Œæ’å…¥åˆ°dirtyä¸­ï¼Œreadè¿™æ—¶å€™å¹¶æ²¡æœ‰æ–°keyï¼Œæ‰€ä»¥readçš„amendè¦ä¸ºtrueï¼Œè¡¨ç¤ºreadå’Œdirtyæ•°æ®ä¸ä¸€è‡´</li>
</ol>
<p>åˆ ï¼š</p>
<ol>
<li>åˆ é™¤ä¹Ÿæ˜¯å…ˆåˆ¤æ–­readä¸­æœ‰æ²¡æœ‰è¯¥keyï¼Œå¦‚æœæœ‰çš„è¯ï¼Œç›´æ¥å°†è¯¥keyå¯¹åº”çš„entryå¤åˆ¶ä¸ºnilï¼Œæ ‡è®°è¯¥keyåˆ é™¤äº†ï¼ˆè™½ç„¶è¯¥keyè¿˜åœ¨readä¸­ï¼Œä½†æ˜¯entry=nilï¼‰</li>
<li>å¦‚æœreadä¸­æ²¡æœ‰ï¼Œä¸”readå’Œdirtyæ•°æ®ä¸ä¸€è‡´ï¼Œé‚£å°±è¦åŠ é”æ“ä½œäº†</li>
<li>åŒæ ·çš„åŒé‡æ ¡éªŒï¼Œåˆ¤æ–­keyåœ¨ä¸åœ¨readä¸­ï¼Œå¦‚æœåœ¨çš„è¯ï¼ŒåŒ1æ ‡è®°è¯¥keyä¸ºåˆ é™¤ï¼ˆentry=nilï¼‰</li>
<li>å¦‚æœè¿˜æ˜¯ä¸åœ¨ï¼Œé‚£å°±ä»dirtyä¸­è¯»å–è¯¥keyï¼Œå¦‚æœkeyåœ¨dirtyä¸­å­˜åœ¨ï¼ŒåŒæ ·å°†è¯¥keyçš„entry=nilï¼ŒåŒæ—¶å°†dirtyä¸­çš„keyçœŸæ­£åˆ é™¤ï¼ˆè¦ä¿è¯dirtyçš„æ•°æ®éƒ½æ˜¯æœªè¢«åˆ é™¤çš„æ•°æ®ï¼‰ï¼ŒåŒæ—¶misses+1</li>
</ol>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"sync"</span>
    <span class="hljs-string">"sync/atomic"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    m := &amp;MapSync{}
    k := <span class="hljs-string">"a"</span>
    v := <span class="hljs-string">"hello"</span>
    k1 := <span class="hljs-string">"b"</span>
    v1 := <span class="hljs-string">"world"</span>

    m.Store(k, v) <span class="hljs-comment">// dirtyä¸­æœ‰kï¼Œreadä¸­æ²¡æœ‰ï¼Œreadçš„amend=true</span>
    fmt.Printf(<span class="hljs-string">"m=%+v\n"</span>, m)
    fmt.Println(<span class="hljs-string">"------"</span>)

    m.Load(k) <span class="hljs-comment">// misses=1</span>
    m.Load(k) <span class="hljs-comment">// misses=2, misses &gt; len(dirty)äº†ï¼Œ æŠŠdirtyçš„å€¼copyç»™readï¼Œreadä¸­å°±æœ‰å€¼käº†ï¼Œdirtyä¸ºnil</span>

    <span class="hljs-comment">// è¿™æ—¶å€™readçš„amend=falseï¼Œè¡¨ç¤ºreadå’Œdirtyæ˜¯ä¸€è‡´çš„</span>
    m.Store(k1, v1) <span class="hljs-comment">// !amendæ¡ä»¶æˆç«‹ï¼ŒæŠŠreadæœªåˆ é™¤çš„kåŒæ­¥ç»™dirtyï¼Œè¿™æ—¶å€™dirtyæœ‰kå’Œk1ï¼Œreadåªæœ‰kï¼Œamend=true</span>

    r, _ := m.dirty[k].load()
    r1, _ := m.loadReadOnly().m[k].load() <span class="hljs-comment">// ä»readä¸­è¯»å–çš„</span>
    <span class="hljs-comment">//r2, _ := m.loadReadOnly().m[k1].load() // ä»readä¸­è¯»å–çš„, readä¸­æ²¡æœ‰ï¼Œä¸€å®šä¼šæŠ¥é”™</span>
    r2 := m.loadReadOnly().m[k1] <span class="hljs-comment">// è¿™é‡Œä¸€å®šæ˜¯nil</span>
    fmt.Printf(<span class="hljs-string">"r=%+v\n"</span>, r)     <span class="hljs-comment">// hello</span>
    fmt.Printf(<span class="hljs-string">"r1=%+v\n"</span>, r1)   <span class="hljs-comment">// hello</span>
    fmt.Printf(<span class="hljs-string">"r2=%+v\n"</span>, r2)   <span class="hljs-comment">// nil</span>

    m.Load(<span class="hljs-string">"c"</span>) <span class="hljs-comment">// misses=1</span>
    m.Load(<span class="hljs-string">"c"</span>) <span class="hljs-comment">// misses=2</span>
    m.Load(<span class="hljs-string">"c"</span>) <span class="hljs-comment">// misses=3 missesæ¡ä»¶è¾¾åˆ°äº†ï¼ŒæŠŠdirtyçš„å€¼èµ‹å€¼ç»™readäº†ï¼Œè¿™æ—¶å€™readå°±æœ‰kå’Œk1äº†ï¼Œdirty=nil</span>

    r1, _ = m.loadReadOnly().m[k].load()   <span class="hljs-comment">// ä»readä¸­è¯»å–çš„</span>
    r3, _ := m.loadReadOnly().m[k1].load() <span class="hljs-comment">// ä»readä¸­è¯»å–çš„</span>
    fmt.Printf(<span class="hljs-string">"r1=%+v\n"</span>, r1)             <span class="hljs-comment">// hello</span>
    fmt.Printf(<span class="hljs-string">"r2=%+v\n"</span>, r3)             <span class="hljs-comment">// world</span>
}

<span class="hljs-keyword">type</span> MapSyncInterface <span class="hljs-keyword">interface</span> {
    Load(key any) (value any, ok <span class="hljs-type">bool</span>)
    Store(key, value any) (previous any, ok <span class="hljs-type">bool</span>)
    Delete(key any) (old any, ok <span class="hljs-type">bool</span>)
}

<span class="hljs-comment">// new è¿”å›çš„æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œè¯´æ˜expungedåªæ˜¯ä¸€ä¸ªæŒ‡é’ˆå˜é‡ï¼Œç”¨äºæ ‡è®°æŸä¸ªå…ƒç´ æ˜¯å¦è¢«åˆ é™¤</span>
<span class="hljs-keyword">var</span> expunged = <span class="hljs-built_in">new</span>(any)

<span class="hljs-keyword">type</span> entry <span class="hljs-keyword">struct</span> {
    p atomic.Pointer[any]
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">newEntry</span><span class="hljs-params">(i any)</span></span> *entry {
    e := &amp;entry{}
    e.p.Store(&amp;i)
    <span class="hljs-keyword">return</span> e
}

<span class="hljs-comment">// load è·å–mapä¸­valueçš„å€¼</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(e *entry)</span></span> load() (value any, ok <span class="hljs-type">bool</span>) {
    p := e.p.Load()
    <span class="hljs-keyword">if</span> p == <span class="hljs-literal">nil</span> || p == expunged {
       <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, <span class="hljs-literal">false</span>
    }

    <span class="hljs-keyword">return</span> *p, <span class="hljs-literal">true</span>
}

<span class="hljs-comment">// trySwap å°è¯•æ›´æ–°readä¸­çš„å€¼</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(e *entry)</span></span> trySwap(value *any) (*any, <span class="hljs-type">bool</span>) {
    <span class="hljs-comment">// è¿™é‡Œæä¸ªæ­»å¾ªç¯ï¼Œé‚£å°±æ˜¯å¦‚æœå€¼æ²¡æ ‡è®°åˆ é™¤ï¼Œé‚£å°±æ˜¯è¦å¿…æ›´æ–°æˆåŠŸçš„èŠ‚å¥å•Š</span>
    <span class="hljs-keyword">for</span> {
       p := e.p.Load()
       <span class="hljs-comment">// å¦‚æœreadä¸­çš„å€¼å·²ç»æ˜¯æ ‡è®°ä¸ºåˆ é™¤çŠ¶æ€ï¼Œé‚£è¯¥å€¼ä¹Ÿä¸ä¼šå­˜åœ¨äºdirtyä¸­</span>
       <span class="hljs-comment">// æ‰€ä»¥ä¸èƒ½ç›´æ¥æ›´æ–°ï¼Œä¸ç„¶ä¼šå‡ºç°readä¸­æœ‰å€¼ï¼Œä½†æ˜¯dirtyä¸­æ²¡æœ‰</span>
       <span class="hljs-keyword">if</span> p == expunged {
          <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, <span class="hljs-literal">false</span>
       }
       <span class="hljs-comment">// ç›´åˆ°æ›´æ–°æˆåŠŸ</span>
       <span class="hljs-keyword">if</span> ok := e.p.CompareAndSwap(p, value); ok {
          <span class="hljs-keyword">return</span> p, <span class="hljs-literal">true</span>
       }
    }
}

<span class="hljs-comment">// delete æ ‡è®°åˆ é™¤</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(e *entry)</span></span> <span class="hljs-built_in">delete</span>() (old any, ok <span class="hljs-type">bool</span>) {
    <span class="hljs-comment">// å¾ªç¯æ›´æ–°</span>
    <span class="hljs-keyword">for</span> {
       p := e.p.Load()
       <span class="hljs-comment">// å¦‚æœentryçš„å€¼å·²ç»åˆ é™¤æˆ–è¢«æ ‡è®°ä¸ºåˆ é™¤äº†ï¼Œå°±ä¸å­˜åœ¨åˆ é™¤äº†</span>
       <span class="hljs-keyword">if</span> p == <span class="hljs-literal">nil</span> || p == expunged {
          <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, <span class="hljs-literal">false</span>
       }
       <span class="hljs-comment">// æ ‡è®°åˆ é™¤ï¼Œè®¾ç½®ä¸ºnil</span>
       <span class="hljs-keyword">if</span> e.p.CompareAndSwap(p, <span class="hljs-literal">nil</span>) {
          <span class="hljs-keyword">return</span> *p, <span class="hljs-literal">true</span>
       }
    }
}

<span class="hljs-comment">// unexpungeLocked å¦‚æœæ—§çš„å€¼è¢«æ ‡è®°ä¸ºåˆ é™¤äº†ï¼Œé‡æ–°ä¿®æ”¹ä¸ºnil</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(e *entry)</span></span> unexpungeLocked() <span class="hljs-type">bool</span> {
    <span class="hljs-keyword">return</span> e.p.CompareAndSwap(expunged, <span class="hljs-literal">nil</span>)
}

<span class="hljs-comment">// swapLocked è®¾ç½®æ–°å€¼ï¼ŒåŒæ—¶æŠŠæ—§å€¼è¿”å›</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(e *entry)</span></span> swapLocked(value *any) *any {
    <span class="hljs-keyword">return</span> e.p.Swap(value)
}

<span class="hljs-keyword">type</span> readOnly <span class="hljs-keyword">struct</span> {
    m <span class="hljs-keyword">map</span>[any]*entry <span class="hljs-comment">// readä¸­å­˜å‚¨key-value</span>

    amend <span class="hljs-type">bool</span> <span class="hljs-comment">// å¦‚æœä¸ºtrueï¼Œé‚£è¯´æ˜readä¸­çš„æ•°æ®å’Œdirtyçš„ä¸ä¸€è‡´</span>
}

<span class="hljs-comment">// MapSync å¹¶å‘å®‰å…¨Map</span>
<span class="hljs-keyword">type</span> MapSync <span class="hljs-keyword">struct</span> {
    mu sync.Mutex

    <span class="hljs-comment">// è¯»å†…å®¹ï¼Œç±»ä¼¼äºredisçš„ä½œç”¨ï¼Œç”¨äºå¿«é€ŸæŸ¥è¯¢æ•°æ®ï¼Œä¸éœ€è¦åŠ é”</span>
    <span class="hljs-comment">// å¦‚æœè¯»ä¸­æ²¡æœ‰ï¼Œé‚£å°±éœ€è¦åŠ é”å»dirtyä¸­æŸ¥è¯¢</span>
    <span class="hljs-comment">// å¾€å¾€ä¼šè¿›è¡ŒåŒé‡è¯»ï¼Œç¬¬ä¸€éä¸åŠ é”å»è¯»æ•°æ®ï¼Œå¦‚æœæ•°æ®ä¸å­˜åœ¨ï¼Œå†åŠ é”å»å–dirtyæ•°æ®ä¹‹å‰ï¼Œå†ä»readä¸­å–ä¸€æ¬¡</span>
    read atomic.Pointer[readOnly]

    <span class="hljs-comment">// ç±»ä¼¼äºDBçš„ä½œç”¨ï¼Œè®°å½•å†™çš„å†…å®¹ï¼Œå¾€å¾€éƒ½æ˜¯æœ€æ–°æœ€å‡†ç¡®çš„æ•°æ®</span>
    <span class="hljs-comment">// æ–°å¢çš„keyéƒ½æ˜¯å†™åˆ°dirtyä¸­</span>
    dirty <span class="hljs-keyword">map</span>[any]*entry

    <span class="hljs-comment">// misses, æŒ‡readå’Œdirtyä¸­æ•°æ®ä¸ä¸€è‡´çš„æ¬¡æ•°</span>
    <span class="hljs-comment">// å¦‚æœmissesæ•°å¤§äºç­‰äºdirtyçš„é•¿åº¦ï¼Œåˆ™è¡¨ç¤ºç©¿é€åˆ°dirtyçš„æƒ…å†µæ¯”è¾ƒå¤šï¼Œ</span>
    <span class="hljs-comment">// è¿™æ—¶å€™éœ€è¦æŠŠdirtyä¸­çš„æ•°æ®æ”¾åˆ°readä¸­ï¼Œæ–¹ä¾¿åç»­åªéœ€è¦ä»readä¸­è¯»å–ï¼Œå‡å°‘åŠ å‡é”çš„æ€§èƒ½</span>
    misses <span class="hljs-type">int</span>
}

<span class="hljs-comment">// loadReadOnly åŠ è½½readOnly</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *MapSync)</span></span> loadReadOnly() readOnly {
    <span class="hljs-keyword">if</span> p := m.read.Load(); p != <span class="hljs-literal">nil</span> {
       <span class="hljs-keyword">return</span> *p
    }

    <span class="hljs-keyword">return</span> readOnly{}
}

<span class="hljs-comment">// Load æ ¹æ®keyæŸ¥è¯¢valueå€¼</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *MapSync)</span></span> Load(key any) (value any, ok <span class="hljs-type">bool</span>) {
    <span class="hljs-comment">// è¯»å–read</span>
    read := m.loadReadOnly()
    <span class="hljs-comment">// å…ˆä»readä¸­è·å–keyæ˜¯å¦å­˜åœ¨</span>
    e, ok := read.m[key]
    <span class="hljs-comment">// å¦‚æœkeyä¸å­˜åœ¨readä¸­ï¼Œä¸”readå’Œdirtyä¸­çš„æ•°æ®ä¸ä¸€è‡´äº†ï¼Œå†å»dirtyä¸­è¯»å–</span>
    <span class="hljs-comment">// ä¸ç„¶å¦‚æœreadå’Œdirtyä¸€è‡´ï¼Œreadä¸­æ²¡æœ‰ï¼Œdirtyä¸€æ ·æ²¡æœ‰ï¼Œä¹Ÿæ²¡å¿…è¦å»dirtyä¸­è¯»å–äº†</span>
    <span class="hljs-keyword">if</span> !ok &amp;&amp; read.amend {
       <span class="hljs-comment">// å‡†å¤‡ä»dirtyä¸­è¯»å–ï¼Œå…ˆé”ä½</span>
       m.mu.Lock()

       <span class="hljs-comment">// åŒé‡æ ¡éªŒ</span>
       read = m.loadReadOnly()
       e, ok = read.m[key]
       <span class="hljs-keyword">if</span> !ok &amp;&amp; read.amend {
          <span class="hljs-comment">// åŒé‡æ ¡éªŒè¿˜æ˜¯æ²¡æœ‰ï¼Œä¸”readå’Œdirtyä¸ä¸€æ ·ï¼Œé‚£å°±ä»dirtyä¸­è¯»å–</span>
          e, ok = m.dirty[key]
          m.missLocked()
       }
       m.mu.Unlock()
    }

    <span class="hljs-comment">// æœ€åæ£€æŸ¥ä¸€æ¬¡ï¼Œä¸ç®¡æ˜¯ä»readä¸­ï¼Œè¿˜æ˜¯ä»dirtyä¸­ï¼Œå¦‚æœèƒ½è¯»åˆ°ï¼Œokéƒ½æœ‰å€¼</span>
    <span class="hljs-keyword">if</span> !ok {
       <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, <span class="hljs-literal">false</span>
    }

    <span class="hljs-comment">// è¿”å›mapä¸­valueçš„å€¼</span>
    <span class="hljs-keyword">return</span> e.load()
}

<span class="hljs-comment">// Store æ›´æ–°/æ’å…¥æ–°çš„å€¼</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *MapSync)</span></span> Store(key, value any) (previous any, loaded <span class="hljs-type">bool</span>) {
    <span class="hljs-comment">// å…ˆä»readä¸­æŸ¥è¯¢æ˜¯å¦å­˜åœ¨è¯¥key</span>
    read := m.loadReadOnly()
    <span class="hljs-keyword">if</span> e, ok := read.m[key]; ok {
       <span class="hljs-comment">// readä¸­æœ‰æ•°æ®ï¼Œé‚£å°±å°è¯•åœ¨readä¸­æ›´æ–°è¯¥å€¼ï¼Œ</span>
       <span class="hljs-comment">// ä¸ºå•¥å°è¯•åœ¨readä¸­æ›´æ–°ï¼Ÿé€šè¿‡åŸå­æ“ä½œå‡å°‘åŠ é”å¸¦æ¥çš„æ¶ˆè€—</span>
       <span class="hljs-comment">// å› ä¸ºreadä¸­å’Œdirtyä¸­æŒ‡å‘çš„åº•å±‚æ˜¯ä¸€æ ·ï¼Œreadä¸­æ›´æ–°äº†ï¼Œdirtyä¸­çš„å€¼ä¹Ÿä¼šç›¸åº”æ›´æ–°ï¼Œå¦‚æœdirtyæœ‰è¯¥keyçš„è¯</span>
       <span class="hljs-keyword">if</span> v, ok := e.trySwap(&amp;value); ok {
          <span class="hljs-comment">// æ—§å€¼æ˜¯nilï¼Œè¯´æ˜æ—§å€¼è¢«åˆ é™¤äº†</span>
          <span class="hljs-comment">// è¿™é‡Œå…¶å®å·²ç»æ›´æ–°æˆåŠŸäº†ï¼Œåªæ˜¯æ—§å€¼è¢«åˆ é™¤äº†ï¼Œè¿™é‡Œè¿”å›nilå’Œæ— æ³•è·å–æ—§å€¼</span>
          <span class="hljs-keyword">if</span> v == <span class="hljs-literal">nil</span> {
             <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, <span class="hljs-literal">false</span>
          }
          <span class="hljs-comment">// è¿”å›æ—§å€¼çš„å€¼å’Œæ ‡è¯†æ—§å€¼å­˜åœ¨</span>
          <span class="hljs-keyword">return</span> *v, <span class="hljs-literal">true</span>
       }
    }

    <span class="hljs-comment">// å¦‚æœreadä¸­æ²¡æœ‰æ•°æ®ï¼Œé‚£å°±éœ€è¦åŠ é”å†™å…¥äº†</span>
    m.mu.Lock()

    <span class="hljs-comment">// åŒé‡æ ¡éªŒ</span>
    read = m.loadReadOnly()
    <span class="hljs-keyword">if</span> e, ok := read.m[key]; ok {
       <span class="hljs-keyword">if</span> e.unexpungeLocked() {
          <span class="hljs-comment">// å¦‚æœæ—§å€¼è¢«æ ‡è®°ä¸ºåˆ é™¤çŠ¶æ€ï¼Œé‚£è¯´æ˜å‘ç”Ÿäº†readä¸­çš„æœªè¢«åˆ é™¤çš„å€¼é‡æ–°å†™åˆ°äº†dirtyä¸­ï¼Œä¸”è¯¥å€¼å°±ä¸ä¼šå­˜åœ¨äºdirtyä¸­</span>
          <span class="hljs-comment">// é‚£å°±éœ€è¦æŠŠè¯¥keyï¼Œå†™å…¥åˆ°dirtyä¸­, ä¿è¯dirtyä¸­ä¸€å®šæœ‰readä¸­æœªè¢«åˆ é™¤çš„å€¼</span>
          m.dirty[key] = e
       }
       <span class="hljs-comment">// æŠŠreadä¸­çš„å€¼æ›´æ–°ä¸ºæ–°å€¼ï¼Œè¿™ä¸€æ­¥å’Œä¸Šé¢çš„trySwapä¸åŒ</span>
       <span class="hljs-comment">// ä¸Šé¢çš„æ˜¯æ²¡åŠ é”çš„ï¼Œæ‰€ä»¥éœ€è¦ä¸æ–­é‡è¯•æ›´æ–°</span>
       <span class="hljs-comment">// è¿™é‡Œå‰é¢å·²ç»åŠ é”äº†ï¼Œæ‰€ä»¥åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨å¤„ç†ï¼Œç›´æ¥æ›´æ–°å€¼å³å¯</span>
       <span class="hljs-comment">// åˆ°è¿™ä¸€æ­¥å…¶å®å°±æ›´æ–°æˆåŠŸäº†ï¼Œè¿™ä¸ªv != nilçš„åˆ¤æ–­åªæ˜¯åˆ¤æ–­è¿”å›æ—§å€¼æœ‰æ²¡æœ‰å€¼</span>
       <span class="hljs-comment">// è¿™ä¸€æ­¥æ›´æ–°æˆåŠŸï¼Œå¯¹åº”dirtyä¸­eçš„å€¼ä¹ŸæˆåŠŸäº†ï¼Œå› ä¸ºeçš„åº•å±‚æ˜¯ä¸€æ ·çš„</span>
       <span class="hljs-keyword">if</span> v := e.swapLocked(&amp;value); v != <span class="hljs-literal">nil</span> {
          loaded = <span class="hljs-literal">true</span>
          previous = *v
       }
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> e, ok := m.dirty[key]; ok { <span class="hljs-comment">// readä¸­æ²¡æœ‰å€¼ï¼Œå¦‚æœdirtyä¸­æœ‰ï¼Œé‚£å°±æ›´æ–°dirtyçš„å€¼</span>
       <span class="hljs-comment">// ä»€ä¹ˆæƒ…å†µä¼šè¿›å…¥è¿™ä¸ªæ–¹æ³•ï¼Œé‚£å°±æ˜¯æ’å…¥ä¹‹åæ¥ç€æ›´æ–°çš„æƒ…å†µï¼Œè¿™æ—¶å€™readæ˜¯æ²¡æœ‰å€¼çš„</span>
       <span class="hljs-comment">// ä¸‹é¢è¿™ä¸ªæ–¹æ³•æ˜¯æ¯”æˆåŠŸçš„ï¼Œå› ä¸ºåŠ é”äº†ï¼Œv != nilåˆ¤æ–­åªæ˜¯åˆ¤æ–­è¿”å›æ—§å€¼æœ‰æ²¡æœ‰å€¼</span>
       <span class="hljs-keyword">if</span> v := e.swapLocked(&amp;value); v != <span class="hljs-literal">nil</span> {
          loaded = <span class="hljs-literal">true</span>
          previous = *v
       }
    } <span class="hljs-keyword">else</span> { <span class="hljs-comment">// å¦‚æœread å’Œ dirtyä¸­éƒ½æ²¡æœ‰ï¼Œé‚£å°±æ˜¯æ–°çš„keyæ’å…¥åœºæ™¯</span>
       <span class="hljs-comment">// å¦‚æœreadå’Œdirtyä¸­æ˜¯ä¸€è‡´çš„ï¼Œé‚£å°±éœ€è¦æ›´æ–°readçš„amendå€¼ä¸ºtrueï¼Œæ ‡è®°ä¸ºä¸ä¸€è‡´</span>
       <span class="hljs-comment">// ä»€ä¹ˆæƒ…å†µä¸‹æ˜¯ä¸€è‡´çš„å‘¢ï¼Ÿ</span>
       <span class="hljs-comment">// 1ã€åˆå§‹åŒ–çš„æ—¶å€™ï¼Œç¬¬ä¸€æ¬¡æ’å…¥æ•°æ®çš„æ—¶å€™ï¼Œamend=false</span>
       <span class="hljs-comment">// 2ã€missesæ•°é‡è¶…è¿‡äº†é˜ˆå€¼ï¼Œé‡æ–°æŠŠdirtyèµ‹å€¼ç»™readï¼Œè¿™æ—¶å€™amendæ˜¯false</span>
       <span class="hljs-keyword">if</span> !read.amend {
          <span class="hljs-comment">// åŒæ—¶å¦‚æœreadä¸­æœ‰æœªåˆ é™¤çš„å€¼ï¼Œä¹ŸåŒæ­¥ç»™dirty</span>
          m.dirtyLocked()
          <span class="hljs-comment">// å› ä¸ºåªå†™åˆ°dirtyï¼Œä¸å†™readï¼Œæ‰€ä»¥ä¸¤è€…ä¸€å®šæ˜¯ä¸ä¸€è‡´çš„ï¼Œamend=true</span>
          m.read.Store(&amp;readOnly{m: read.m, amend: <span class="hljs-literal">true</span>})
       }
       <span class="hljs-comment">// ç›´æ¥å†™åˆ°dirtyä¸­ï¼Œè¿™æ—¶readä¸­æ˜¯æ²¡æœ‰è¯¥keyçš„ï¼Œå› ä¸ºæ–°æ’å…¥çš„keyéƒ½æ˜¯åœ¨dirtyä¸­</span>
       m.dirty[key] = newEntry(value)
    }

    m.mu.Unlock()

    <span class="hljs-keyword">return</span> previous, loaded
}

<span class="hljs-comment">// Delete åˆ é™¤æŸä¸ªkey</span>
<span class="hljs-comment">// æ ‡è®°åˆ é™¤æ³•</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *MapSync)</span></span> Delete(key any) (value any, loaded <span class="hljs-type">bool</span>) {
    <span class="hljs-comment">// ä»readæ€»è¯»å–è¯¥å€¼</span>
    read := m.loadReadOnly()
    e, ok := read.m[key]
    <span class="hljs-keyword">if</span> !ok &amp;&amp; read.amend {
       m.mu.Lock()
       read = m.loadReadOnly()
       e, ok = read.m[key]
       <span class="hljs-keyword">if</span> !ok &amp;&amp; read.amend {
          <span class="hljs-comment">// ä»dirtyè·å–</span>
          e, ok = m.dirty[key]
          <span class="hljs-comment">// ç›´æ¥åˆ é™¤ï¼Œè¿™ä¸ªæ–¹æ³•ï¼Œå¦‚æœkeyä¸å­˜åœ¨ï¼Œå¹¶ä¸ä¼šçœŸæ­£åˆ é™¤</span>
          <span class="hljs-comment">// è¿™ä¸ªæ–¹æ³•æ˜¯çœŸæ­£åˆ é™¤ï¼Œå› ä¸ºè¦ä¿è¯dirtyçš„æ•°æ®éƒ½æ˜¯æœªè¢«åˆ é™¤çš„æ­£å¸¸çš„æ•°æ®</span>
          <span class="hljs-built_in">delete</span>(m.dirty, key)
          <span class="hljs-comment">// è®°ä¸€æ¬¡ç©¿é€</span>
          m.missLocked()
       }
       m.mu.Unlock()
    }

    <span class="hljs-keyword">if</span> ok {
       <span class="hljs-keyword">return</span> e.<span class="hljs-built_in">delete</span>() <span class="hljs-comment">// èµ‹å€¼ä¸ºnilï¼Œè¡¨ç¤ºåˆ é™¤äº†</span>
    }

    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, <span class="hljs-literal">false</span>
}

<span class="hljs-comment">// missLocked å¯¹missesè®¡æ•°ï¼Œè¶…è¿‡ä¸€å®šé˜ˆå€¼åï¼ŒæŠŠdirtyçš„å€¼èµ‹å€¼åˆ°readä¸­</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *MapSync)</span></span> missLocked() {
    m.misses++
    <span class="hljs-comment">// è¿™é‡Œä¸ºå•¥æ˜¯dirtyé•¿åº¦å‘¢ï¼Ÿ</span>
    <span class="hljs-comment">// å› ä¸ºdirtyä»£è¡¨å†™å…¥çš„æ•°æ®ï¼Œç­‰äºdirtyé•¿åº¦ï¼Œç›¸å½“äºå…è®¸æ¯ä¸ªæ–°keyéƒ½ç©¿é€ä¸€æ¬¡ï¼Œå¦‚æœè¶…è¿‡äº†ï¼Œé‚£å°±è¯´æ˜ç©¿é€æ¦‚ç‡å¾ˆé«˜äº†</span>
    <span class="hljs-keyword">if</span> m.misses &lt; <span class="hljs-built_in">len</span>(m.dirty) {
       <span class="hljs-keyword">return</span>
    }

    <span class="hljs-comment">// è¶…è¿‡é˜ˆå€¼äº†, æŠŠdirtyç»™åˆ°readï¼ŒæŠŠdirtyè®¾ç½®ä¸ºnil</span>
    <span class="hljs-comment">// ä¸ºå•¥è¦æŠŠdirtyç»™readï¼Œå› ä¸ºè¿›å…¥åˆ°è¿™ä¸ªæ–¹æ³•ï¼Œå°±æ˜¯readä¸­æ²¡æœ‰ï¼Œæ‰åˆ°dirtyä¸­çš„ï¼Œéƒ½å·²ç»ç©¿é€äº†</span>
    <span class="hljs-comment">// æ‰€ä»¥å°±æŠŠreadçš„æ¢æˆdirtyçš„ï¼Œè¿™æ ·å°±å‡å°‘ç©¿é€äº†</span>
    m.read.Store(&amp;readOnly{m: m.dirty})
    <span class="hljs-comment">// ä¸ºå•¥è¦æŠŠdirtyè®¾ç½®ä¸ºnilå‘¢ï¼Ÿ</span>
    <span class="hljs-comment">// æˆ‘çš„ç†è§£æ˜¯ï¼Œæ—¢ç„¶æŠŠdirtyç»™åˆ°readäº†ï¼Œé‚£å¤§éƒ¨åˆ†çš„è¯»åœ¨readä¸­å°±èƒ½è·å–åˆ°äº†ï¼Œå°±ä¸éœ€è¦åˆ°dirtyä¸­æŸ¥è¯¢äº†</span>
    <span class="hljs-comment">// å¯¹äºæ–°æ’å…¥çš„keyï¼Œæ˜¯å†™åˆ°dirtyä¸­çš„ï¼Œä½†æ˜¯å†™å…¥dirtyä¹‹å‰ï¼Œä¼šæŠŠreadä¸­çš„å€¼åŒæ­¥å›dirty</span>
    m.dirty = <span class="hljs-literal">nil</span>
    m.misses = <span class="hljs-number">0</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *MapSync)</span></span> dirtyLocked() {
    <span class="hljs-comment">// å¦‚æœdirtyä¸ä¸ºç©ºï¼Œç›´æ¥è¿”å›</span>
    <span class="hljs-keyword">if</span> m.dirty != <span class="hljs-literal">nil</span> {
       <span class="hljs-keyword">return</span>
    }

    <span class="hljs-comment">// ä»€ä¹ˆæƒ…å†µä¸‹dirtyæ˜¯nilï¼Ÿ</span>
    <span class="hljs-comment">// 1ã€åˆå§‹åŒ–çš„æ—¶å€™ï¼Œç¬¬ä¸€æ¬¡æ’å…¥æ•°æ®çš„æ—¶å€™ï¼Œdirtyæ˜¯nil</span>
    <span class="hljs-comment">// 2ã€missesæ•°é‡è¶…è¿‡äº†é˜ˆå€¼ï¼Œé‡æ–°æŠŠdirtyèµ‹å€¼ç»™readï¼Œè¿™æ—¶å€™amendæ˜¯falseï¼Œdirtyæ˜¯nil</span>
    read := m.loadReadOnly()

    <span class="hljs-comment">// æŠŠreadä¸­ä½nilçš„æ ‡è®°ä¸ºå·²åˆ é™¤çš„åŒæ—¶ï¼ŒæŠŠæœªåˆ é™¤çš„æ•°æ®èµ‹å€¼ç»™dirty</span>
    m.dirty = <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[any]*entry, <span class="hljs-built_in">len</span>(read.m))
    <span class="hljs-keyword">for</span> k, e := <span class="hljs-keyword">range</span> read.m {
       <span class="hljs-keyword">if</span> !e.tryExpungeLocked() {
          <span class="hljs-comment">// èƒ½ä¸èƒ½ä¸åŒæ­¥readçš„æ•°æ®ç»™dirtyå‘¢ï¼Ÿ</span>
          <span class="hljs-comment">// æˆ‘ç†è§£æ˜¯ä¸èƒ½çš„ï¼Œå› ä¸ºå¦‚æœä¸åŒæ­¥readçš„æ•°æ®ç»™dirtyï¼Œåç»­missesè¶…è¿‡äº†ï¼Œdirtyç›´æ¥è¦†ç›–readçš„å€¼</span>
          <span class="hljs-comment">// dirtyå˜ä¸ºnilï¼Œé‚£ä¹‹å‰readä¸­çš„é‚£éƒ¨åˆ†æ•°æ®æ˜¯ä¸æ˜¯å°±ä¸¢äº†ï¼Ÿ</span>
          m.dirty[k] = e
       }
    }
}

<span class="hljs-comment">// tryExpungeLocked æ ‡è®°ä¸ºåˆ é™¤</span>
<span class="hljs-comment">// deleteæ–¹æ³•åªæ˜¯æŠŠentryè®¾ç½®ä¸ºnil</span>
<span class="hljs-comment">// è¿™ä¸ªæ–¹æ³•å°±æ˜¯æŠŠæ ‡è®°ä¸ºnilçš„entryæ ‡è®°ä¸ºexpunged</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(e *entry)</span></span> tryExpungeLocked() <span class="hljs-type">bool</span> {
    p := e.p.Load()
    <span class="hljs-comment">// ä¸æ–­å¾ªç¯ï¼Œç›´åˆ°æ ‡è®°æˆåŠŸä¸ºæ­¢</span>
    <span class="hljs-comment">// è¿™ä¸ªæ–¹æ³•å°±æ˜¯æŠŠæ ‡è®°ä¸ºnilçš„entryæ ‡è®°ä¸ºexpungedï¼Œæ‰€ä»¥ä¸€å®šæ˜¯ä¸ºnilçš„æ‰ä¼šè¿›å…¥å¾ªç¯å¤„ç†</span>
    <span class="hljs-keyword">for</span> p == <span class="hljs-literal">nil</span> {
       <span class="hljs-comment">// æ ‡è®°ä¸ºåˆ é™¤</span>
       <span class="hljs-keyword">if</span> e.p.CompareAndSwap(<span class="hljs-literal">nil</span>, expunged) {
          <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
       }
       p = e.p.Load()
    }

    <span class="hljs-comment">// å¦‚æœpä¸ä¸ºnilï¼Œå°±ä¸ä¼šè¿›å…¥ä¸Šé¢çš„å¾ªç¯ï¼Œé‚£å°±è¦åˆ¤æ–­æ˜¯å¦å·²è¢«æ ‡è®°ä¸ºåˆ é™¤</span>
    <span class="hljs-keyword">return</span> p == expunged
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[From Nand to Tetris é‡Œçš„ Project 5 (CPU éƒ¨åˆ†)]]></title>    <link>https://juejin.cn/post/7598499504170713126</link>    <guid>https://juejin.cn/post/7598499504170713126</guid>    <pubDate>2026-01-24T07:25:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598499504170713126" data-draft-id="7598011274686775296" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="From Nand to Tetris é‡Œçš„ Project 5 (CPU éƒ¨åˆ†)"/> <meta itemprop="keywords" content="è®¾è®¡"/> <meta itemprop="datePublished" content="2026-01-24T07:25:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é‡‘éŠ€éŠ…éµ"/> <meta itemprop="url" content="https://juejin.cn/user/747323638159757"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            From Nand to Tetris é‡Œçš„ Project 5 (CPU éƒ¨åˆ†)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/747323638159757/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é‡‘éŠ€éŠ…éµ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T07:25:51.000Z" title="Sat Jan 24 2026 07:25:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body .octicon{display:inline-block;fill:currentColor;vertical-align:text-bottom}.markdown-body .anchor{float:left;line-height:1;margin-left:-20px;padding-right:4px}.markdown-body .anchor:focus{outline:none}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#1b1f23;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1:hover .anchor .octicon-link:before,.markdown-body h2:hover .anchor .octicon-link:before,.markdown-body h3:hover .anchor .octicon-link:before,.markdown-body h4:hover .anchor .octicon-link:before,.markdown-body h5:hover .anchor .octicon-link:before,.markdown-body h6:hover .anchor .octicon-link:before{width:16px;height:16px;content:" ";display:inline-block;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' aria-hidden='true'%3E%3Cpath fill-rule='evenodd' d='M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z'/%3E%3C/svg%3E")}.markdown-body{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;color:#24292e;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;font-size:16px;line-height:1.5;word-wrap:break-word}.markdown-body details{display:block}.markdown-body summary{display:list-item}.markdown-body a{background-color:initial}.markdown-body a:active,.markdown-body a:hover{outline-width:0}.markdown-body strong{font-weight:inherit;font-weight:bolder}.markdown-body h1{margin:.67em 0}.markdown-body img{border-style:none}.markdown-body code,.markdown-body kbd,.markdown-body pre{font-family:monospace,monospace;font-size:1em}.markdown-body hr{box-sizing:initial;overflow:visible}.markdown-body input{font:inherit;margin:0;overflow:visible}.markdown-body [type=checkbox]{box-sizing:border-box;padding:0}.markdown-body *{box-sizing:border-box}.markdown-body input{font-family:inherit;font-size:inherit;line-height:inherit}.markdown-body a{color:#0366d6;text-decoration:none}.markdown-body a:hover{text-decoration:underline}.markdown-body strong{font-weight:600}.markdown-body hr{height:0;margin:15px 0;overflow:hidden;background:transparent;border-bottom:1px solid #dfe2e5}.markdown-body hr:after,.markdown-body hr:before{display:table;content:""}.markdown-body hr:after{clear:both}.markdown-body table{border-spacing:0;border-collapse:collapse}.markdown-body td,.markdown-body th{padding:0}.markdown-body details summary{cursor:pointer}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:0;margin-bottom:0}.markdown-body h1{font-size:32px}.markdown-body h1,.markdown-body h2{font-weight:600}.markdown-body h2{font-size:24px}.markdown-body h3{font-size:20px}.markdown-body h3,.markdown-body h4{font-weight:600}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:14px}.markdown-body h5,.markdown-body h6{font-weight:600}.markdown-body h6{font-size:12px}.markdown-body p{margin-top:0;margin-bottom:10px}.markdown-body blockquote{margin:0}.markdown-body ol,.markdown-body ul{padding-left:0;margin-top:0;margin-bottom:0}.markdown-body ol ol,.markdown-body ul ol{list-style-type:lower-roman}.markdown-body ol ol ol,.markdown-body ol ul ol,.markdown-body ul ol ol,.markdown-body ul ul ol{list-style-type:lower-alpha}.markdown-body dd{margin-left:0}.markdown-body code,.markdown-body pre{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px}.markdown-body pre{margin-top:0;margin-bottom:0}.markdown-body input::-webkit-inner-spin-button,.markdown-body input::-webkit-outer-spin-button{margin:0;-webkit-appearance:none;appearance:none}.markdown-body :checked+.radio-label{position:relative;z-index:1;border-color:#0366d6}.markdown-body .border{border:1px solid #e1e4e8!important}.markdown-body .border-0{border:0!important}.markdown-body .border-bottom{border-bottom:1px solid #e1e4e8!important}.markdown-body .rounded-1{border-radius:3px!important}.markdown-body .bg-white{background-color:#fff!important}.markdown-body .bg-gray-light{background-color:#fafbfc!important}.markdown-body .text-gray-light{color:#6a737d!important}.markdown-body .pl-3,.markdown-body .px-3{padding-left:16px!important}.markdown-body .px-3{padding-right:16px!important}.markdown-body .f6{font-size:12px!important}.markdown-body .lh-condensed{line-height:1.25!important}.markdown-body .text-bold{font-weight:600!important}.markdown-body .pl-c{color:#6a737d}.markdown-body .pl-c1,.markdown-body .pl-s .pl-v{color:#005cc5}.markdown-body .pl-e,.markdown-body .pl-en{color:#6f42c1}.markdown-body .pl-s .pl-s1,.markdown-body .pl-smi{color:#24292e}.markdown-body .pl-ent{color:#22863a}.markdown-body .pl-k{color:#d73a49}.markdown-body .pl-pds,.markdown-body .pl-s,.markdown-body .pl-s .pl-pse .pl-s1,.markdown-body .pl-sr,.markdown-body .pl-sr .pl-cce,.markdown-body .pl-sr .pl-sra,.markdown-body .pl-sr .pl-sre{color:#032f62}.markdown-body .pl-smw,.markdown-body .pl-v{color:#e36209}.markdown-body .pl-bu{color:#b31d28}.markdown-body .pl-ii{color:#fafbfc;background-color:#b31d28}.markdown-body .pl-c2{color:#fafbfc;background-color:#d73a49}.markdown-body .pl-c2:before{content:"^M"}.markdown-body .pl-sr .pl-cce{font-weight:700;color:#22863a}.markdown-body .pl-ml{color:#735c0f}.markdown-body .pl-mh,.markdown-body .pl-mh .pl-en,.markdown-body .pl-ms{font-weight:700;color:#005cc5}.markdown-body .pl-mi{font-style:italic;color:#24292e}.markdown-body .pl-mb{font-weight:700;color:#24292e}.markdown-body .pl-md{color:#b31d28;background-color:#ffeef0}.markdown-body .pl-mi1{color:#22863a;background-color:#f0fff4}.markdown-body .pl-mc{color:#e36209;background-color:#ffebda}.markdown-body .pl-mi2{color:#f6f8fa;background-color:#005cc5}.markdown-body .pl-mdr{font-weight:700;color:#6f42c1}.markdown-body .pl-ba{color:#586069}.markdown-body .pl-sg{color:#959da5}.markdown-body .pl-corl{text-decoration:underline;color:#032f62}.markdown-body .mb-0{margin-bottom:0!important}.markdown-body .my-2{margin-bottom:8px!important;margin-top:8px!important}.markdown-body .pl-0{padding-left:0!important}.markdown-body .py-0{padding-top:0!important;padding-bottom:0!important}.markdown-body .pl-1{padding-left:4px!important}.markdown-body .pl-2{padding-left:8px!important}.markdown-body .py-2{padding-top:8px!important;padding-bottom:8px!important}.markdown-body .pl-3{padding-left:16px!important}.markdown-body .pl-4{padding-left:24px!important}.markdown-body .pl-5{padding-left:32px!important}.markdown-body .pl-6{padding-left:40px!important}.markdown-body .pl-7{padding-left:48px!important}.markdown-body .pl-8{padding-left:64px!important}.markdown-body .pl-9{padding-left:80px!important}.markdown-body .pl-10{padding-left:96px!important}.markdown-body .pl-11{padding-left:112px!important}.markdown-body .pl-12{padding-left:128px!important}.markdown-body hr{border-bottom-color:#eee}.markdown-body kbd{display:inline-block;padding:3px 5px;font:11px SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #d1d5da;border-radius:3px;box-shadow:inset 0 -1px 0 #d1d5da}.markdown-body:after,.markdown-body:before{display:table;content:""}.markdown-body:after{clear:both}.markdown-body&gt;:first-child{margin-top:0!important}.markdown-body&gt;:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body blockquote,.markdown-body details,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body hr{height:.25em;padding:0;margin:24px 0;background-color:#e1e4e8;border:0}.markdown-body blockquote{padding:0 1em;color:#6a737d;border-left:.25em solid #dfe2e5}.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eaecef}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{font-size:.85em;color:#6a737d}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li{word-wrap:break-all}.markdown-body li&gt;p{margin-top:16px}.markdown-body li+li{margin-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:600}.markdown-body dl dd{padding:0 16px;margin-bottom:16px}.markdown-body table{display:block;width:100%;overflow:auto}.markdown-body table th{font-weight:600}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid #dfe2e5}.markdown-body table tr{background-color:#fff;border-top:1px solid #c6cbd1}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}.markdown-body img{max-width:100%;box-sizing:initial;background-color:#fff}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body code{padding:.2em .4em;margin:0;font-size:85%;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body pre{word-wrap:normal}.markdown-body pre&gt;code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:transparent;border:0}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f6f8fa;border-radius:3px}.markdown-body pre code{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:initial;border:0}.markdown-body .commit-tease-sha{display:inline-block;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:90%;color:#444d56}.markdown-body .full-commit .btn-outline:not(:disabled):hover{color:#005cc5;border-color:#005cc5}.markdown-body .blob-wrapper{overflow-x:auto;overflow-y:hidden}.markdown-body .blob-wrapper-embedded{max-height:240px;overflow-y:auto}.markdown-body .blob-num{width:1%;min-width:50px;padding-right:10px;padding-left:10px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;line-height:20px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;vertical-align:top;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-body .blob-num:hover{color:rgba(27,31,35,.6)}.markdown-body .blob-num:before{content:attr(data-line-number)}.markdown-body .blob-code{position:relative;padding-right:10px;padding-left:10px;line-height:20px;vertical-align:top}.markdown-body .blob-code-inner{overflow:visible;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;color:#24292e;word-wrap:normal;white-space:pre}.markdown-body .pl-token.active,.markdown-body .pl-token:hover{cursor:pointer;background:#ffea7f}.markdown-body .tab-size[data-tab-size="1"]{-moz-tab-size:1;tab-size:1}.markdown-body .tab-size[data-tab-size="2"]{-moz-tab-size:2;tab-size:2}.markdown-body .tab-size[data-tab-size="3"]{-moz-tab-size:3;tab-size:3}.markdown-body .tab-size[data-tab-size="4"]{-moz-tab-size:4;tab-size:4}.markdown-body .tab-size[data-tab-size="5"]{-moz-tab-size:5;tab-size:5}.markdown-body .tab-size[data-tab-size="6"]{-moz-tab-size:6;tab-size:6}.markdown-body .tab-size[data-tab-size="7"]{-moz-tab-size:7;tab-size:7}.markdown-body .tab-size[data-tab-size="8"]{-moz-tab-size:8;tab-size:8}.markdown-body .tab-size[data-tab-size="9"]{-moz-tab-size:9;tab-size:9}.markdown-body .tab-size[data-tab-size="10"]{-moz-tab-size:10;tab-size:10}.markdown-body .tab-size[data-tab-size="11"]{-moz-tab-size:11;tab-size:11}.markdown-body .tab-size[data-tab-size="12"]{-moz-tab-size:12;tab-size:12}.markdown-body .task-list-item{list-style-type:none}.markdown-body .task-list-item+.task-list-item{margin-top:3px}.markdown-body .task-list-item input{margin:0 .2em .25em -1.6em;vertical-align:middle}</style><style data-highlight="" data-highlight-key="agate">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#333;color:#fff}.hljs-name,.hljs-strong{font-weight:700}.hljs-code,.hljs-emphasis{font-style:italic}.hljs-tag{color:#62c8f3}.hljs-selector-class,.hljs-selector-id,.hljs-template-variable,.hljs-variable{color:#ade5fc}.hljs-bullet,.hljs-string{color:#a2fca2}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-quote,.hljs-section,.hljs-title,.hljs-type{color:#ffa}.hljs-bullet,.hljs-number,.hljs-symbol{color:#d36363}.hljs-keyword,.hljs-literal,.hljs-selector-tag{color:#fcc28c}.hljs-code,.hljs-comment,.hljs-deletion{color:#888}.hljs-link,.hljs-regexp{color:#c6b4f0}.hljs-meta{color:#fc9b9b}.hljs-deletion{background-color:#fc9b9b;color:#333}.hljs-addition{background-color:#a2fca2;color:#333}.hljs a{color:inherit}.hljs a:focus,.hljs a:hover{color:inherit;text-decoration:underline}</style><p>è®©æˆ‘ä»¬æŒ‰ç…§Â <a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">From Nand to Tetris</a>Â é‡ŒÂ <code>Project 5</code>Â çš„è¦æ±‚ï¼Œæ¥å®Œæˆä¸‹åˆ—çš„è®¾è®¡ã€‚</p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> 1. <code>Memory</code> (å·²å®Œæˆï¼Œå¯ä»¥å‚è€ƒ <a href="https://juejin.cn/spost/7592531796039925794" target="_blank" title="https://juejin.cn/spost/7592531796039925794">From Nand to Tetris é‡Œçš„ Project 5 (Memory éƒ¨åˆ†)</a> ä¸€æ–‡)</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 2.  <code>CPU</code></li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 3.  <code>Computer</code></li>
</ul>
<p><strong>æœ¬æ–‡åªæ¶‰åŠÂ <code>CPU</code>Â çš„å®ç°</strong></p>
<h2 data-id="heading-0">è¯´æ˜</h2>
<p>æˆ‘æ˜¯é˜…è¯»äº†<a href="https://link.juejin.cn?target=https%3A%2F%2Fbook.douban.com%2Fsubject%2F37354204%2F" target="_blank" title="https://book.douban.com/subject/37354204/" ref="nofollow noopener noreferrer">ã€Šè®¡ç®—æœºç³»ç»Ÿè¦ç´  (ç¬¬2ç‰ˆ)ã€‹</a>Â ç¬¬ 5 ç« çš„å†…å®¹åæ‰å»å®ŒæˆÂ <code>Project 5</code>Â çš„ã€‚è¯»è€…æœ‹å‹åœ¨å®ŒæˆÂ <code>Project 5</code>Â æ—¶ï¼Œå¦‚æœé‡åˆ°ä¸æ˜ç™½çš„åœ°æ–¹ï¼Œå¯ä»¥å‚è€ƒä¹¦ä¸­çš„æè¿°ã€‚ä¹¦ä¸­ç¬¬ <code>66</code> é¡µå’Œç¬¬ <code>67</code> é¡µæœ‰å¦‚ä¸‹å†…å®¹ï¼Œå¯ä¾›å‚è€ƒã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8d3c7749e0c14c5e842624aec2a7b399~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6YqA6YqF6ZC1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769845758&amp;x-signature=XHMVPSVmF3CKubx0aBQKftPFV5Q%3D" alt="p66.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c6d4316bec9b452eb27e758a2a5be939~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6YqA6YqF6ZC1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769845758&amp;x-signature=GhbRfWloHDKaT85Jt43OLisHbkA%3D" alt="p67_temp.png" loading="lazy"/></p>
<h2 data-id="heading-1">æ­£æ–‡</h2>
<p>å‰å¾€Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fnand2tetris.github.io%2Fweb-ide%2Fchip%2F" target="_blank" title="https://nand2tetris.github.io/web-ide/chip/" ref="nofollow noopener noreferrer">Nand to Tetris Online IDE</a>ï¼Œé€‰æ‹©Â <code>Project 5</code>Â é‡Œçš„Â <code>CPU</code>Â â¬‡ï¸</p>
<p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å®ç°Â <code>CPU</code>Â (ä¸­å¤®å¤„ç†å•å…ƒ)ï¼Œæ³¨é‡Šä¸­çš„ç›¸å…³æè¿°å¦‚ä¸‹ â¬‡ï¸</p>
<pre><code class="hljs language-text" lang="text">/**
 * The Hack Central Processing unit (CPU).
 * Parses the binary code in the instruction input and executes it according to the
 * Hack machine language specification. In the case of a C-instruction, computes the
 * function specified by the instruction. If the instruction specifies to read a memory
 * value, the inM input is expected to contain this value. If the instruction specifies
 * to write a value to the memory, sets the outM output to this value, sets the addressM
 * output to the target address, and asserts the writeM output (when writeM = 0, any
 * value may appear in outM).
 * If the reset input is 0, computes the address of the next instruction and sets the
 * pc output to that value. If the reset input is 1, sets pc to 0.
 * Note: The outM and writeM outputs are combinational: they are affected by the
 * instruction's execution during the current cycle. The addressM and pc outputs are
 * clocked: although they are affected by the instruction's execution, they commit to
 * their new values only in the next cycle.
 */
</code></pre>
<ul>
<li>è¾“å…¥æ˜¯
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>inM[16]</mtext></mrow><annotation encoding="application/x-tex">\text{inM[16]}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord text"><span class="mord">inM[16]</span></span></span></span></span></span></li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>instruction[16]</mtext></mrow><annotation encoding="application/x-tex">\text{instruction[16]}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord text"><span class="mord">instruction[16]</span></span></span></span></span></span></li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>reset</mtext></mrow><annotation encoding="application/x-tex">\text{reset}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"/><span class="mord text"><span class="mord">reset</span></span></span></span></span></span></li>
</ul>
</li>
<li>è¾“å‡ºæ˜¯
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>outM[16]</mtext></mrow><annotation encoding="application/x-tex">\text{outM[16]}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord text"><span class="mord">outM[16]</span></span></span></span></span></span></li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>writeM</mtext></mrow><annotation encoding="application/x-tex">\text{writeM}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord text"><span class="mord">writeM</span></span></span></span></span></span></li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>addressM[15]</mtext></mrow><annotation encoding="application/x-tex">\text{addressM[15]}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord text"><span class="mord">addressM[15]</span></span></span></span></span></span></li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>pc[15]</mtext></mrow><annotation encoding="application/x-tex">\text{pc[15]}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord text"><span class="mord">pc[15]</span></span></span></span></span></span></li>
</ul>
</li>
</ul>
<p>å®ç° <code>CPU</code> éœ€è¦å¤„ç†ä»¥ä¸‹ <code>3</code> éƒ¨åˆ†çš„é€»è¾‘</p>
<ol>
<li>æŒ‡ä»¤è¯‘ç </li>
<li>æŒ‡ä»¤çš„æ‰§è¡Œ</li>
<li>å–æŒ‡ä»¤</li>
</ol>
<h3 data-id="heading-2">1 æŒ‡ä»¤è¯‘ç </h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fbook.douban.com%2Fsubject%2F37354204%2F" target="_blank" title="https://book.douban.com/subject/37354204/" ref="nofollow noopener noreferrer">ã€Šè®¡ç®—æœºç³»ç»Ÿè¦ç´  (ç¬¬2ç‰ˆ)ã€‹</a> ä¸€ä¹¦ç¬¬ <code>67</code> é¡µå¯¹ <strong>æŒ‡ä»¤è¯‘ç </strong> æœ‰å¦‚ä¸‹æè¿° â¬‡ï¸</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cccb39ef6bbb42178d5cff8bbfd5c823~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6YqA6YqF6ZC1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769845758&amp;x-signature=hLKDrehsCICO9Y0rTs%2FwI%2F0t%2FvE%3D" alt="image.png" loading="lazy"/></p>
<p>å¦‚æœ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>instruction[15]</mtext><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\text{instruction[15]}=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord text"><span class="mord">instruction[15]</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span>ï¼Œåˆ™ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>instruction</mtext></mrow><annotation encoding="application/x-tex">\text{instruction}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6679em;"/><span class="mord text"><span class="mord">instruction</span></span></span></span></span></span> è¡¨ç¤ºä¸€æ¡ <code>A</code> æŒ‡ä»¤ã€‚<code>A</code> æŒ‡ä»¤æ»¡è¶³ä»¥ä¸‹æ¨¡å¼(<code>?</code> è¡¨ç¤ºå¯¹è¿™ä¸€ä½çš„å€¼æ²¡æœ‰é™åˆ¶)</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19cff3cb74924681a58efc859b60de95~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6YqA6YqF6ZC1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769845758&amp;x-signature=kfBYD2KwjL6Eiekw1UlLPwk57VA%3D" alt="mermaid-diagram-2026-01-24-120551.png" loading="lazy"/></p>
<p>å¦‚æœ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>instruction[15]</mtext><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\text{instruction[15]}=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord text"><span class="mord">instruction[15]</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span>ï¼Œåˆ™ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>instruction</mtext></mrow><annotation encoding="application/x-tex">\text{instruction}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6679em;"/><span class="mord text"><span class="mord">instruction</span></span></span></span></span></span> è¡¨ç¤ºä¸€æ¡ <code>C</code> æŒ‡ä»¤ã€‚<code>C</code> æŒ‡ä»¤çš„æ ¼å¼å¦‚ä¸‹ â¬‡ï¸</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/00bb7b620448470e9c13bda1e9f1d6ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6YqA6YqF6ZC1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769845758&amp;x-signature=Qorl1yAty%2FxtlH4WU17EIBYB%2FtI%3D" alt="mermaid-diagram-2026-01-24-150022.png" loading="lazy"/></p>
<h3 data-id="heading-3">2 æŒ‡ä»¤çš„æ‰§è¡Œ</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fbook.douban.com%2Fsubject%2F37354204%2F" target="_blank" title="https://book.douban.com/subject/37354204/" ref="nofollow noopener noreferrer">ã€Šè®¡ç®—æœºç³»ç»Ÿè¦ç´  (ç¬¬2ç‰ˆ)ã€‹</a> ä¸€ä¹¦ç¬¬ <code>67</code> é¡µå¯¹ <strong>æŒ‡ä»¤çš„æ‰§è¡Œ</strong> æœ‰å¦‚ä¸‹æè¿° â¬‡ï¸</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f757fed8207404fa1163540c202e6c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6YqA6YqF6ZC1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769845758&amp;x-signature=tGhlYM6uKWJkXQZRth0wFfqBH4E%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">a</span></span></span></span></span>: ç¡®å®š <code>ALU</code> çš„ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span></span> è¾“å…¥æ¥è‡ª <code>A</code> å¯„å­˜å™¨çš„å€¼è¿˜æ˜¯æ¥è‡ªè¾“å…¥çš„ <code>M</code> å€¼
<ul>
<li>å¦‚æœ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">a=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span>ï¼Œåˆ™ <code>ALU</code> çš„ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span></span> è¾“å…¥æ¥è‡ª <code>A</code> å¯„å­˜å™¨</li>
<li>å¦‚æœ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">a=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span>ï¼Œåˆ™ <code>ALU</code> çš„ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span></span> è¾“å…¥æ¥è‡ªè¾“å…¥çš„ <code>M</code> å€¼</li>
</ul>
</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>c</mi><mi>c</mi><mi>c</mi><mi>c</mi><mi>c</mi></mrow><annotation encoding="application/x-tex">cccccc</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">cccccc</span></span></span></span></span>: è¿™äº›ä½ç”¨äºç¡®å®š <code>ALU</code> æ‰§è¡Œæ€æ ·çš„è®¡ç®—</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>d</mi><mi>d</mi></mrow><annotation encoding="application/x-tex">ddd</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">ddd</span></span></span></span></span> (å³ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>e</mi><mi>s</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">dest</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">d</span><span class="mord mathnormal">es</span><span class="mord mathnormal">t</span></span></span></span></span>): è¿™äº›ä½ç”¨äºç¡®å®šç”±å“ªäº›å¯„å­˜å™¨æ¥æ”¶ <code>ALU</code> çš„è¾“å‡º</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi><mi>j</mi><mi>j</mi></mrow><annotation encoding="application/x-tex">jjj</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.05724em;">jjj</span></span></span></span></span> (å³ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi><mi>u</mi><mi>m</mi><mi>p</mi></mrow><annotation encoding="application/x-tex">jump</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span><span class="mord mathnormal">p</span></span></span></span></span>): è¿™äº›ä½ç”¨äºç¡®å®šä¸‹ä¸€æ¡è¦å–å‡ºçš„æŒ‡ä»¤</li>
</ul>
<h4 data-id="heading-4">åˆ¤æ–­ <code>instruction</code> æ˜¯ <code>A</code> æŒ‡ä»¤è¿˜æ˜¯ <code>C</code> æŒ‡ä»¤</h4>
<ul>
<li>å¦‚æœ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>instruction[15]</mtext><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\text{instruction[15]}=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord text"><span class="mord">instruction[15]</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span>ï¼Œåˆ™ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>instruction</mtext></mrow><annotation encoding="application/x-tex">\text{instruction}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6679em;"/><span class="mord text"><span class="mord">instruction</span></span></span></span></span></span> è¡¨ç¤ºä¸€æ¡ <code>A</code> æŒ‡ä»¤</li>
<li>å¦‚æœ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>instruction[15]</mtext><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\text{instruction[15]}=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord text"><span class="mord">instruction[15]</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span>ï¼Œåˆ™ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>instruction</mtext></mrow><annotation encoding="application/x-tex">\text{instruction}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6679em;"/><span class="mord text"><span class="mord">instruction</span></span></span></span></span></span> è¡¨ç¤ºä¸€æ¡ <code>C</code> æŒ‡ä»¤</li>
</ul>
<p>åŸºäºä»¥ä¸Šé€»è¾‘ï¼Œå¯ä»¥å†™å‡ºå¯¹åº”çš„ <code>hdl</code> ä»£ç  â¬‡ï¸</p>
<pre><code class="hljs language-hdl" lang="hdl">// instruction type
DMux(in= true, sel= instruction[15], a= aType, b= cType);
</code></pre>
<h4 data-id="heading-5">å¯¹ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">a</span></span></span></span></span> ä½çš„åˆ¤æ–­</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fbook.douban.com%2Fsubject%2F37354204%2F" target="_blank" title="https://book.douban.com/subject/37354204/" ref="nofollow noopener noreferrer">ã€Šè®¡ç®—æœºç³»ç»Ÿè¦ç´  (ç¬¬2ç‰ˆ)ã€‹</a> ä¸€ä¹¦ç¬¬ <code>49</code> é¡µæœ‰å¦‚ä¸‹æè¿° â¬‡ï¸</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ce5d168fbb26413dac781b1ad132ca5f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6YqA6YqF6ZC1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769845758&amp;x-signature=KVS%2F79jt4FwLQCGHt%2BJ83WfyhdQ%3D" alt="image.png" loading="lazy"/>
å¦‚æœ <code>instruction</code> æ˜¯ <code>C</code> æŒ‡ä»¤ï¼Œé‚£ä¹ˆ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>instruction[12]</mtext></mrow><annotation encoding="application/x-tex">\text{instruction[12]}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord text"><span class="mord">instruction[12]</span></span></span></span></span></span> å°±æ˜¯ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">a</span></span></span></span></span>ï¼Œå®ƒçš„å€¼å†³å®šäº† <code>ALU</code> çš„  <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span></span>  è¾“å…¥æ¥è‡ªå“ªé‡Œ</p>
<ul>
<li>å¦‚æœ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">a=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span>ï¼Œåˆ™ <code>ALU</code> çš„ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span></span> è¾“å…¥æ¥è‡ª <code>A</code> å¯„å­˜å™¨</li>
<li>å¦‚æœ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">a=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span>ï¼Œåˆ™ <code>ALU</code> çš„ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span></span> è¾“å…¥æ¥è‡ªè¾“å…¥çš„ <code>M</code> å€¼</li>
</ul>
<p>åŸºäºä»¥ä¸Šé€»è¾‘ï¼Œå¯ä»¥å†™å‡ºå¯¹åº”çš„ <code>hdl</code> ä»£ç  â¬‡ï¸ (<strong><code>aRegister</code> è¡¨ç¤º <code>A</code> å¯„å­˜å™¨çš„è¾“å‡ºï¼Œä¸‹æ–‡ä¼šæåˆ°</strong>)</p>
<pre><code class="hljs language-hdl" lang="hdl">Mux16(a= aRegisterOut, b= inM, sel= instruction[12], out= yOfAlu);
</code></pre>
<h4 data-id="heading-6">å¯¹ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>c</mi><mi>c</mi><mi>c</mi><mi>c</mi><mi>c</mi></mrow><annotation encoding="application/x-tex">cccccc</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">cccccc</span></span></span></span></span> ä½çš„åˆ¤æ–­</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fbook.douban.com%2Fsubject%2F37354204%2F" target="_blank" title="https://book.douban.com/subject/37354204/" ref="nofollow noopener noreferrer">ã€Šè®¡ç®—æœºç³»ç»Ÿè¦ç´  (ç¬¬2ç‰ˆ)ã€‹</a> ä¸€ä¹¦ç¬¬ <code>49</code> é¡µæœ‰å¦‚ä¸‹æè¿° â¬‡ï¸</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/988fbdc28987480dbf483618c0988c29~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6YqA6YqF6ZC1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769845758&amp;x-signature=ov6%2FF9C6lPCj%2B47vpAl4F8rgrNM%3D" alt="image.png" loading="lazy"/></p>
<p>å¯¹ <code>ALU</code> è€Œè¨€ï¼Œ</p>
<ul>
<li>å®ƒçš„ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">x</span></span></span></span></span> è¾“å…¥æ€»æ˜¯æ¥è‡ª <code>D</code> å¯„å­˜å™¨çš„è¾“å‡º</li>
<li>å®ƒçš„ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span></span> è¾“å…¥ç”± <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>instruction[12]</mtext></mrow><annotation encoding="application/x-tex">\text{instruction[12]}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord text"><span class="mord">instruction[12]</span></span></span></span></span></span> (å³ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">a</span></span></span></span></span> ä½) æ¥å†³å®š(ä¸Šæ–‡å·²æåˆ°ï¼Œè¿™é‡Œä¸èµ˜è¿°)</li>
</ul>
<p>è¿™æ ·å¯ä»¥å†™å‡ºå¯¹åº”çš„ <code>hdl</code> ä»£ç  â¬‡ï¸ (<strong><code>dRegister</code> è¡¨ç¤º <code>D</code> å¯„å­˜å™¨çš„è¾“å‡ºï¼Œä¸‹æ–‡ä¼šæåˆ°</strong>)</p>
<pre><code class="hljs language-hdl" lang="hdl">ALU(x= dRegisterOut, y= yOfAlu, 
    zx= instruction[11], 
    nx= instruction[10],
    zy= instruction[9], 
    ny= instruction[8], 
    f= instruction[7], 
    no= instruction[6], 
    out= aluOut, zr= zr, ng= ng);
</code></pre>
<h4 data-id="heading-7">å¯¹ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>d</mi><mi>d</mi></mrow><annotation encoding="application/x-tex">ddd</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">ddd</span></span></span></span></span> (å³ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>e</mi><mi>s</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">dest</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">d</span><span class="mord mathnormal">es</span><span class="mord mathnormal">t</span></span></span></span></span>) ä½çš„åˆ¤æ–­</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fbook.douban.com%2Fsubject%2F37354204%2F" target="_blank" title="https://book.douban.com/subject/37354204/" ref="nofollow noopener noreferrer">ã€Šè®¡ç®—æœºç³»ç»Ÿè¦ç´  (ç¬¬2ç‰ˆ)ã€‹</a> ä¸€ä¹¦ç¬¬ <code>49</code> é¡µæœ‰å¦‚ä¸‹æè¿° â¬‡ï¸</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aa9bf24231d4484cb09512129b0352e7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6YqA6YqF6ZC1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769845758&amp;x-signature=7Q4RbA2fywQHgTq0MOCIMZxedwA%3D" alt="image.png" loading="lazy"/></p>
<p>å¦‚æœ <code>instruction</code> æ˜¯ <code>C</code> æŒ‡ä»¤ï¼Œé‚£ä¹ˆ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>instruction[3..5]</mtext></mrow><annotation encoding="application/x-tex">\text{instruction[3..5]}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord text"><span class="mord">instruction[3..5]</span></span></span></span></span></span> è¡¨ç¤º <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>d</mi><mi>d</mi></mrow><annotation encoding="application/x-tex">ddd</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">ddd</span></span></span></span></span> (å³ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>e</mi><mi>s</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">dest</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">d</span><span class="mord mathnormal">es</span><span class="mord mathnormal">t</span></span></span></span></span>)</p>
<ul>
<li>å¦‚æœ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>instruction[3]</mtext><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\text{instruction[3]}=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord text"><span class="mord">instruction[3]</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span>ï¼Œåˆ™å°†è®¡ç®—ç»“æœå­˜å‚¨åœ¨ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>RAM[A]</mtext></mrow><annotation encoding="application/x-tex">\text{RAM[A]}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord text"><span class="mord">RAM[A]</span></span></span></span></span></span> ä¸­</li>
<li>å¦‚æœ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>instruction[4]</mtext><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\text{instruction[4]}=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord text"><span class="mord">instruction[4]</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span>ï¼Œåˆ™å°†è®¡ç®—ç»“æœå­˜å‚¨åœ¨ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>D</mtext></mrow><annotation encoding="application/x-tex">\text{D}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord text"><span class="mord">D</span></span></span></span></span></span> å¯„å­˜å™¨ä¸­</li>
<li>å¦‚æœ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>instruction[5]</mtext><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\text{instruction[5]}=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord text"><span class="mord">instruction[5]</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span>ï¼Œåˆ™å°†è®¡ç®—ç»“æœå­˜å‚¨åœ¨ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>A</mtext></mrow><annotation encoding="application/x-tex">\text{A}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord text"><span class="mord">A</span></span></span></span></span></span> å¯„å­˜å™¨ä¸­</li>
</ul>
<p><strong>è¯·æ³¨æ„ï¼Œä»¥ä¸Šä¸‰ä¸ªåˆ¤æ–­å¹¶ä¸æ˜¯äº’æ–¥çš„ã€‚</strong></p>
<p>åŸºäºä»¥ä¸Šé€»è¾‘ï¼Œå¯ä»¥å†™å‡ºå¯¹åº”çš„ <code>hdl</code> ä»£ç  â¬‡ï¸</p>
<pre><code class="hljs language-hdl" lang="hdl">// dest
And(a= cType, b= instruction[3], out= toM, out= writeM);
And(a= cType, b= instruction[4], out= toD);
And(a= cType, b= instruction[5], out= toA);
</code></pre>
<h4 data-id="heading-8">å¯¹ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi><mi>j</mi><mi>j</mi></mrow><annotation encoding="application/x-tex">jjj</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.05724em;">jjj</span></span></span></span></span> (å³ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi><mi>u</mi><mi>m</mi><mi>p</mi></mrow><annotation encoding="application/x-tex">jump</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span><span class="mord mathnormal">p</span></span></span></span></span>) ä½çš„åˆ¤æ–­</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fbook.douban.com%2Fsubject%2F37354204%2F" target="_blank" title="https://book.douban.com/subject/37354204/" ref="nofollow noopener noreferrer">ã€Šè®¡ç®—æœºç³»ç»Ÿè¦ç´  (ç¬¬2ç‰ˆ)ã€‹</a> ä¸€ä¹¦ç¬¬ <code>49</code> é¡µæœ‰å¦‚ä¸‹æè¿° â¬‡ï¸</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/313237ac7d6d411983e695fae189fa7a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6YqA6YqF6ZC1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769845758&amp;x-signature=ox9HMSROQrf4ZO5BwXBf9El0r1E%3D" alt="image.png" loading="lazy"/></p>
<p>å¦‚æœ <code>instruction</code> æ˜¯ <code>C</code> æŒ‡ä»¤ï¼Œé‚£ä¹ˆ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>instruction[0..2]</mtext></mrow><annotation encoding="application/x-tex">\text{instruction[0..2]}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord text"><span class="mord">instruction[0..2]</span></span></span></span></span></span> è¡¨ç¤º <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi><mi>j</mi><mi>j</mi></mrow><annotation encoding="application/x-tex">jjj</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.05724em;">jjj</span></span></span></span></span> (å³ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi><mi>u</mi><mi>m</mi><mi>p</mi></mrow><annotation encoding="application/x-tex">jump</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span><span class="mord mathnormal">p</span></span></span></span></span>)</p>
<ul>
<li>å¦‚æœ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>instruction[0]</mtext><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\text{instruction[0]}=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord text"><span class="mord">instruction[0]</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span>ï¼Œåˆ™å½“è®¡ç®—ç»“æœ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\gt 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"/><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span> æ—¶ï¼Œè¦è·³è½¬</li>
<li>å¦‚æœ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>instruction[1]</mtext><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\text{instruction[1]}=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord text"><span class="mord">instruction[1]</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span>ï¼Œåˆ™å½“è®¡ç®—ç»“æœ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">= 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span> æ—¶ï¼Œè¦è·³è½¬</li>
<li>å¦‚æœ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>instruction[2]</mtext><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\text{instruction[2]}=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord text"><span class="mord">instruction[2]</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span>ï¼Œåˆ™å½“è®¡ç®—ç»“æœ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\lt 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"/><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span> æ—¶ï¼Œè¦è·³è½¬</li>
</ul>
<p><strong>è¯·æ³¨æ„ï¼Œä»¥ä¸Šä¸‰ä¸ªåˆ¤æ–­å¹¶ä¸æ˜¯äº’æ–¥çš„ã€‚</strong> (ä¾‹å¦‚ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>instruction[0]</mtext><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\text{instruction[0]}=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord text"><span class="mord">instruction[0]</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span> å’Œ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>instruction[1]</mtext><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\text{instruction[1]}=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord text"><span class="mord">instruction[1]</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span> å¯ä»¥åŒæ—¶æˆç«‹)</p>
<p>åŸºäºä»¥ä¸Šé€»è¾‘ï¼Œå¯ä»¥å†™å‡ºå¯¹åº”çš„ <code>hdl</code> ä»£ç  â¬‡ï¸</p>
<pre><code class="hljs language-hdl" lang="hdl">Or(a= zr, b= ng, out= compNonPositive);
Not(in= compNonPositive, out= compIsPositive);

And(a= instruction[0], b= compIsPositive, out= gtZero);
And(a= instruction[1], b= zr, out= eqZero);
And(a= instruction[2], b= ng , out= ltZero);
Or(a= gtZero, b= eqZero, out= geZero);
Or(a= geZero, b= ltZero, out= rawJump);
And(a= cType, b= rawJump, out= jump);
</code></pre>
<h4 data-id="heading-9">å¯¹ <code>A</code> å¯„å­˜å™¨çš„å¤„ç†</h4>
<p>å½“ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶ä¸­çš„æŸä¸€ä¸ªæˆç«‹æ—¶(è¿™ä¸¤ä¸ªæ¡ä»¶ä¸ä¼šåŒæ—¶æˆç«‹)ï¼Œéœ€è¦å°† <code>A</code> å¯„å­˜å™¨çš„ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>o</mi><mi>a</mi><mi>d</mi></mrow><annotation encoding="application/x-tex">load</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal">a</span><span class="mord mathnormal">d</span></span></span></span></span> è®¾ç½®ä¸º <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>true</mtext></mrow><annotation encoding="application/x-tex">\text{true}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"/><span class="mord text"><span class="mord">true</span></span></span></span></span></span>ã€‚</p>
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>instruction</mtext></mrow><annotation encoding="application/x-tex">\text{instruction}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6679em;"/><span class="mord text"><span class="mord">instruction</span></span></span></span></span></span> æ˜¯ <code>A</code> æŒ‡ä»¤</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>instruction</mtext></mrow><annotation encoding="application/x-tex">\text{instruction}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6679em;"/><span class="mord text"><span class="mord">instruction</span></span></span></span></span></span> æ˜¯ <code>C</code> æŒ‡ä»¤å¹¶ä¸”ä» <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>d</mi><mi>d</mi></mrow><annotation encoding="application/x-tex">ddd</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">ddd</span></span></span></span></span> ä¸­å¯ä»¥åˆ¤æ–­å‡ºéœ€è¦å°†è®¡ç®—ç»“æœå­˜å‚¨åœ¨ <code>A</code> å¯„å­˜å™¨ä¸­</li>
</ul>
<p>åŸºäºä»¥ä¸Šé€»è¾‘ï¼Œå¯ä»¥å†™å‡ºå¯¹åº”çš„ <code>hdl</code> ä»£ç  â¬‡ï¸</p>
<pre><code class="hljs language-hdl" lang="hdl">// We set "load" in A register to true,
// when either of the following condition is satisfied
// 1. instruction is A type, or
// 2. instruction is C type and we need to send the result to A
Mux16(a= aluOut, b= instruction, sel= aType, out= aRegisterInput);
Or(a= aType, b= toA, out= loadA);
ARegister(in= aRegisterInput, load= loadA, out= aRegisterOut, out[0..14]= addressM);
</code></pre>
<h4 data-id="heading-10">å¯¹ <code>D</code> å¯„å­˜å™¨çš„å¤„ç†</h4>
<p>å½“ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶éƒ½æˆç«‹æ—¶ï¼Œéœ€è¦å°† <code>D</code> å¯„å­˜å™¨çš„ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>o</mi><mi>a</mi><mi>d</mi></mrow><annotation encoding="application/x-tex">load</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal">a</span><span class="mord mathnormal">d</span></span></span></span></span> è®¾ç½®ä¸º <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>true</mtext></mrow><annotation encoding="application/x-tex">\text{true}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"/><span class="mord text"><span class="mord">true</span></span></span></span></span></span>ã€‚</p>
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>instruction</mtext></mrow><annotation encoding="application/x-tex">\text{instruction}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6679em;"/><span class="mord text"><span class="mord">instruction</span></span></span></span></span></span> æ˜¯ <code>C</code> æŒ‡ä»¤</li>
<li>ä» <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>d</mi><mi>d</mi></mrow><annotation encoding="application/x-tex">ddd</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">ddd</span></span></span></span></span> ä¸­å¯ä»¥åˆ¤æ–­å‡ºéœ€è¦å°†è®¡ç®—ç»“æœå­˜å‚¨åœ¨ <code>D</code> å¯„å­˜å™¨ä¸­</li>
</ul>
<p>åŸºäºä»¥ä¸Šé€»è¾‘ï¼Œå¯ä»¥å†™å‡ºå¯¹åº”çš„ <code>hdl</code> ä»£ç  â¬‡ï¸</p>
<pre><code class="hljs language-hdl" lang="hdl">// When both of the following conditions are satisfied, we set "load" in D register to true
// 1. instruction is C type, and
// 2. we need to send the result to D
DRegister(in= aluOut, load= toD, out= dRegisterOut);
</code></pre>
<h4 data-id="heading-11">å¯¹ <code>M</code> çš„å¤„ç†</h4>
<p>å½“ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶éƒ½æˆç«‹æ—¶ï¼Œéœ€è¦å¯¹ <code>M</code> (å³ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>RAM[A]</mtext></mrow><annotation encoding="application/x-tex">\text{RAM[A]}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord text"><span class="mord">RAM[A]</span></span></span></span></span></span>) è¿›è¡Œå†™æ“ä½œã€‚</p>
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>instruction</mtext></mrow><annotation encoding="application/x-tex">\text{instruction}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6679em;"/><span class="mord text"><span class="mord">instruction</span></span></span></span></span></span> æ˜¯ <code>C</code> æŒ‡ä»¤</li>
<li>ä» <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>d</mi><mi>d</mi></mrow><annotation encoding="application/x-tex">ddd</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">ddd</span></span></span></span></span> ä¸­å¯ä»¥åˆ¤æ–­å‡ºéœ€è¦å°†è®¡ç®—ç»“æœå­˜å‚¨åœ¨ <code>M</code> ä¸­</li>
</ul>
<p>åŸºäºä»¥ä¸Šé€»è¾‘ï¼Œå¯ä»¥å†™å‡ºå¯¹åº”çš„ <code>hdl</code> ä»£ç  â¬‡ï¸</p>
<pre><code class="hljs language-hdl" lang="hdl">// When both of the following conditions are satisfied, we write M
// 1. instruction is C type, and
// 2. we need to send the result to M
Mux16(a= false, b= aluOut, sel= toM, out= outM);
</code></pre>
<h3 data-id="heading-12">3 å–æŒ‡ä»¤</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fbook.douban.com%2Fsubject%2F37354204%2F" target="_blank" title="https://book.douban.com/subject/37354204/" ref="nofollow noopener noreferrer">ã€Šè®¡ç®—æœºç³»ç»Ÿè¦ç´  (ç¬¬2ç‰ˆ)ã€‹</a> ä¸€ä¹¦ç¬¬ <code>68</code> é¡µå¯¹ <strong>å–æŒ‡ä»¤</strong> æœ‰å¦‚ä¸‹æè¿° â¬‡ï¸</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e2adce2af0ff431386c3d84ce9fb716d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6YqA6YqF6ZC1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769845758&amp;x-signature=WkzgE5rqZQknUxQzX2HWf8LzhTc%3D" alt="image.png" loading="lazy"/></p>
<p>åŸºäºä»¥ä¸Šé€»è¾‘ï¼Œå¯ä»¥å†™å‡ºå¯¹åº”çš„ <code>hdl</code> ä»£ç  â¬‡ï¸</p>
<pre><code class="hljs language-hdl" lang="hdl">Or(a= reset, b= jump, out= noInc);
Not(in= noInc, out= toInc);

PC(in= aRegisterOut, load= jump, inc= toInc, reset= reset, out[0..14]= pc);
</code></pre>
<h2 data-id="heading-13">éªŒè¯</h2>
<p>å°†ä¸Šæ–‡æåˆ°çš„å„éƒ¨åˆ† <code>hdl</code> ç»„è£…åœ¨ä¸€èµ·ï¼Œå¯ä»¥å¾—å‡ºå®Œæ•´çš„ç¨‹åº â¬‡ï¸</p>
<pre><code class="hljs language-hdl" lang="hdl">// This file is part of www.nand2tetris.org
// and the book "The Elements of Computing Systems"
// by Nisan and Schocken, MIT Press.
// File name: projects/5/CPU.hdl
/**
 * The Hack Central Processing unit (CPU).
 * Parses the binary code in the instruction input and executes it according to the
 * Hack machine language specification. In the case of a C-instruction, computes the
 * function specified by the instruction. If the instruction specifies to read a memory
 * value, the inM input is expected to contain this value. If the instruction specifies
 * to write a value to the memory, sets the outM output to this value, sets the addressM
 * output to the target address, and asserts the writeM output (when writeM = 0, any
 * value may appear in outM).
 * If the reset input is 0, computes the address of the next instruction and sets the
 * pc output to that value. If the reset input is 1, sets pc to 0.
 * Note: The outM and writeM outputs are combinational: they are affected by the
 * instruction's execution during the current cycle. The addressM and pc outputs are
 * clocked: although they are affected by the instruction's execution, they commit to
 * their new values only in the next cycle.
 */
CHIP CPU {

    IN  inM[16],         // M value input  (M = contents of RAM[A])
        instruction[16], // Instruction for execution
        reset;           // Signals whether to re-start the current
                         // program (reset==1) or continue executing
                         // the current program (reset==0).

    OUT outM[16],        // M value output
        writeM,          // Write to M? 
        addressM[15],    // Address in data memory (of M)
        pc[15];          // address of next instruction

    PARTS:
    // instruction type
    DMux(in= true, sel= instruction[15], a= aType, b= cType);

    // dest
    And(a= cType, b= instruction[3], out= toM, out= writeM);
    And(a= cType, b= instruction[4], out= toD);
    And(a= cType, b= instruction[5], out= toA);

    // We set "load" in A register to true,
    // when either of the following condition is satisfied
    // 1. instruction is A type, or
    // 2. instruction is C type and we need to send the result to A
    Mux16(a= aluOut, b= instruction, sel= aType, out= aRegisterInput);
    Or(a= aType, b= toA, out= loadA);
    ARegister(in= aRegisterInput, load= loadA, out= aRegisterOut, out[0..14]= addressM);

    // When both of the following conditions are satisfied, we set "load" in D register to true
    // 1. instruction is C type, and
    // 2. we need to send the result to D
    DRegister(in= aluOut, load= toD, out= dRegisterOut);

    // When both of the following conditions are satisfied, we write M
    // 1. instruction is C type, and
    // 2. we need to send the result to M
    Mux16(a= false, b= aluOut, sel= toM, out= outM);

    Mux16(a= aRegisterOut, b= inM, sel= instruction[12], out= yOfAlu);
    ALU(x= dRegisterOut, y= yOfAlu, 
        zx= instruction[11], 
        nx= instruction[10],
        zy= instruction[9], 
        ny= instruction[8], 
        f= instruction[7], 
        no= instruction[6], 
        out= aluOut, zr= zr, ng= ng);

    Or(a= zr, b= ng, out= compNonPositive);
    Not(in= compNonPositive, out= compIsPositive);
    
    And(a= instruction[0], b= compIsPositive, out= gtZero);
    And(a= instruction[1], b= zr, out= eqZero);
    And(a= instruction[2], b= ng , out= ltZero);
    Or(a= gtZero, b= eqZero, out= geZero);
    Or(a= geZero, b= ltZero, out= rawJump);
    And(a= cType, b= rawJump, out= jump);

    Or(a= reset, b= jump, out= noInc);
    Not(in= noInc, out= toInc);

    PC(in= aRegisterOut, load= jump, inc= toInc, reset= reset, out[0..14]= pc);
}
</code></pre>
<p>è¿™æ ·çš„ä»£ç å¯ä»¥é€šè¿‡ä»¿çœŸæµ‹è¯•ã€‚åœ¨æµ‹è¯•å‰ï¼Œå¯ä»¥æŠŠé€Ÿåº¦æŒ‰é’®ç§»åŠ¨åˆ°æ¯”è¾ƒæ¥è¿‘ <code>Fast</code> çš„ä½ç½®</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/57c9e28e31404fb0a18957ad99f95e89~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6YqA6YqF6ZC1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769845758&amp;x-signature=iOt6tUPfH5bMIDXqJm8mHp0IN6A%3D" alt="image.png" loading="lazy"/></p>
<p>ç‚¹å‡» <code>Run</code> æŒ‰é’®ï¼Œå°±å¯ä»¥å¼€å§‹æµ‹è¯•äº†</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/579e77244b9b4cd3be73266ec475bce1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6YqA6YqF6ZC1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769845758&amp;x-signature=fOBeK7AFc4IOub7rUj2w2qhACW0%3D" alt="image.png" loading="lazy"/></p>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæµ‹è¯•é€šè¿‡ â¬‡ï¸</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6643cd8725af4a039e37c1bf95c91658~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6YqA6YqF6ZC1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769845758&amp;x-signature=ysaTiWOELRAgUkqB7%2BVDJOUBTtg%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-14">å…¶ä»–</h2>
<h3 data-id="heading-15">ç”¨äºå±•ç¤º <code>A</code> æŒ‡ä»¤å’Œ <code>C</code> æŒ‡ä»¤çš„æ¨¡å¼çš„å›¾æ˜¯å¦‚ä½•ç”»å‡ºæ¥çš„ï¼Ÿ</h3>
<p>æˆ‘æ˜¯é€šè¿‡Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fmermaid.live" target="_blank" title="https://mermaid.live" ref="nofollow noopener noreferrer">mermaid.live</a>Â é¡µé¢æ¥ç»˜åˆ¶çš„ã€‚ä»¥ <code>C</code> æŒ‡ä»¤ä¸ºä¾‹ï¼Œå¯¹åº”çš„ä»£ç å¦‚ä¸‹ â¬‡ï¸</p>
<pre><code class="hljs language-text" lang="text">block
    columns 1
    title["C æŒ‡ä»¤"]
    block
        columns 16
        p15["[15]"] p14["[14]"] p13["[13]"] p12["[12]"] p11["[11]"] p10["[10]"]
        p9["[9]"] p8["[8]"] p7["[7]"] p6["[6]"] p5["[5]"]
        p4["[4]"] p3["[3]"] p2["[2]"] p1["[1]"] p0["[0]"]
        
        b15["1"] b14["x"] b13["x"] b12["a"] b11["c"] b10["c"]
        b9["c"] b8["c"] b7["c"] b6["c"] b5["d"]
        b4["d"] b3["d"] b2["j"] b1["j"] b0["j"]
    end

style title fill:#fff,stroke:#fff;

style p15 fill:#fff,stroke:#fff;
style p14 fill:#fff,stroke:#fff;
style p13 fill:#fff,stroke:#fff;
style p12 fill:#fff,stroke:#fff;
style p11 fill:#fff,stroke:#fff;
style p10 fill:#fff,stroke:#fff;
style p9 fill:#fff,stroke:#fff;
style p8 fill:#fff,stroke:#fff;
style p7 fill:#fff,stroke:#fff;
style p6 fill:#fff,stroke:#fff;
style p5 fill:#fff,stroke:#fff;
style p4 fill:#fff,stroke:#fff;
style p3 fill:#fff,stroke:#fff;
style p2 fill:#fff,stroke:#fff;
style p1 fill:#fff,stroke:#fff;
style p0 fill:#fff,stroke:#fff;

style b15 fill:#0f0;
style b14 fill:#fff;
style b13 fill:#fff;
style b12 fill:#f08;
style b11 fill:#088;
style b10 fill:#088;
style b9 fill:#088;
style b8 fill:#088;
style b7 fill:#088;
style b6 fill:#088;
style b5 fill:#f88;
style b4 fill:#f88;
style b3 fill:#f88;
style b2 fill:#0ff;
style b1 fill:#0ff;
style b0 fill:#0ff;

</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bbc253b542134cb59b889c3095a4b12a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6YqA6YqF6ZC1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769845758&amp;x-signature=yS2WSLw8JWgjuChWNkqhTc1O5%2B4%3D" alt="image.png" loading="lazy"/></p>
<p>å…·ä½“çš„è¯­æ³•è¯·å‚è€ƒÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fmermaid.js.org%2Fsyntax%2Fblock.html" target="_blank" title="https://mermaid.js.org/syntax/block.html" ref="nofollow noopener noreferrer">Block Diagrams Documentation</a></p>
<h2 data-id="heading-16">å‚è€ƒèµ„æ–™</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fbook.douban.com%2Fsubject%2F37354204%2F" target="_blank" title="https://book.douban.com/subject/37354204/" ref="nofollow noopener noreferrer">ã€Šè®¡ç®—æœºç³»ç»Ÿè¦ç´  (ç¬¬2ç‰ˆ)ã€‹</a>Â </li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fnand2tetris.github.io%2Fweb-ide%2Fchip%2F" target="_blank" title="https://nand2tetris.github.io/web-ide/chip/" ref="nofollow noopener noreferrer">Nand to Tetris Online IDE</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmermaid.js.org%2Fsyntax%2Fblock.html" target="_blank" title="https://mermaid.js.org/syntax/block.html" ref="nofollow noopener noreferrer">Block Diagrams Documentation</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æˆ‘å’ŒTRAEçš„è¿™ä¸€å¹´]]></title>    <link>https://juejin.cn/post/7598403436699582498</link>    <guid>https://juejin.cn/post/7598403436699582498</guid>    <pubDate>2026-01-24T02:38:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598403436699582498" data-draft-id="7598450302615715886" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æˆ‘å’ŒTRAEçš„è¿™ä¸€å¹´"/> <meta itemprop="keywords" content="Trae"/> <meta itemprop="datePublished" content="2026-01-24T02:38:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="çº±é›¾13"/> <meta itemprop="url" content="https://juejin.cn/user/3419926705742091"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æˆ‘å’ŒTRAEçš„è¿™ä¸€å¹´
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3419926705742091/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    çº±é›¾13
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T02:38:45.000Z" title="Sat Jan 24 2026 02:38:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æˆ‘å’ŒTRAEçš„è¿™ä¸€å¹´</h2>
<p>ä¹Ÿæ˜¯å’ŒTraeèµ°è¿‡ä¸€å¹´äº†ï¼ä¹Ÿä½¿ç”¨äº†Traeåšå‡ºäº†å¤§å¤§å°å°çš„é¡¹ç›®ï¼Œä¹Ÿå­¦ä¼šäº†å¾ˆå¤šæŠ€æœ¯æ ˆï¼Œä¹Ÿä½¿ç”¨Traeå‚åŠ äº†ä¸€äº›æ¯”èµ›éƒ½è·å¾—ä¸é”™çš„ä½³ç»©äº†ï¼Œæ¥çœ‹çœ‹æˆ‘å’ŒTraeçš„2025å§</p>
<p><strong>ç›¸é‡</strong></p>
<p>ç›¸é‡å³åœ¨printf("MarsCode"),æˆ‘è¿˜è®°å¾—é‚£æ˜¯2024å¹´6æœˆä»½,æˆ‘åœ¨æ•™å®¤çœ‹è‰åªå‘å¸ƒä¼š,æˆ‘è¿˜è®°å¾—<strong>æµ·å»º</strong>å’Œ<strong>æ—­ä¸œ</strong>è€å¸ˆåœ¨è‰åªä¸Šæ¼”ç¤ºMarscodeçš„èƒ½åŠ›,é‚£ä¸ªæ—¶å€™å°±æ·±æ·±çš„çˆ±ä¸Šäº†è¿™ä¸ªæ’ä»¶,åœ¨æ—¥å¸¸çš„å­¦ä¹ è¿˜æœ‰ä¸€äº›é¡¹ç›®çš„ç”Ÿæˆéƒ½æ˜¯å¾ˆä¸é”™çš„!é‚£ä¸ªæ—¶å€™åªèƒ½ä½¿ç”¨ChatGPTè±†åŒ…è¿™ç±»çš„ç”Ÿæˆåä»£ç ç„¶åCV,å‡ºé”™å†æ¥ä¸€é,ç°åœ¨ä¸éœ€è¦äº†!çœŸçš„å¾ˆæƒŠè‰³~ç„¶åå°±åˆ°2025å¹´çš„å‡æœŸçš„æ—¶å€™è¿˜æœ‰è¶…å¤šç”±æœæ˜”æœˆè€å¸ˆçš„å…±å­¦è¯¾ç¨‹,åœ¨ç›´æ’­é—´å’Œå¥¹çš„å°åŠ©ç†ä¸€èµ·ä½¿ç”¨Marscodeç”Ÿæˆä¸€äº›ä»£ç ,é‚£ä¸ªæ—¶å€™å°±è®¤å®šäº†,è§‰å¾—è¿™ä¸ªç¤¾åŒºå¾ˆä¸é”™,èƒ½å­¦åˆ°å¥½å¤šå¼€å‘çš„æŠ€æœ¯!ä¹Ÿè·å¾—äº†å¾ˆå¤šå‘¨è¾¹!
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/575637b9768b4e289c330be82ce4b431~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57qx6Zu-MTM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769827125&amp;x-signature=TPu5S8scp%2FWQGPH7kdqwhyghY5w%3D" alt="img_v3_02tf_594afca5-d3aa-4606-a881-ff2367ee2d0g.jpg" loading="lazy"/></p>
<p><strong>Trae ç¤¾åŒºæ´»åŠ¨çœŸçš„å¥½å¤š!</strong></p>
<p>8æœˆä»½è¿›å…¥åˆ°äº†é£ä¹¦çš„ç¤¾ç¾¤,è¿™é‡Œæ´»åŠ¨æ›´åŠ ä¸°å¯Œäº†,ä¸”ç¤¾ç¾¤æ¯”ä¹‹å‰å¤§äº†å¥½å¤š!æœ‰å¥½å¤šå¤§ä½¬è¿›å…¥åˆ°è¿™ä¸ªç¾¤é‡Œ,åœ¨è¿™é‡ŒçœŸçš„å­¦åˆ°äº†ç‰¹åˆ«å¤š!
ä¹Ÿæ˜¯åœ¨è¿™ä¸ªæ—¶å€™,è§‰å¾—æ˜¯æˆ‘å­¦ç”Ÿæ—¶ä»£å†™çš„ä»£ç å’Œå¼€å‘é¡¹ç›®çš„å·…å³°äº†,åœ¨è¿™é‡Œå‚åŠ äº†å„ç§ç§ç±»çš„æ´»åŠ¨
ä¾‹å¦‚å‘è¡¨åˆ°Traeå…¬ä¼—å·çš„å€Ÿç”¨å¤§æ¨¡å‹çš„èƒ½åŠ›å»è¿›è¡Œè§„èŒƒäº‹åŠ¡çš„ä¸€ä¸ªé¡¹ç›®
<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F3W2wmNS8NpzReUn5ifSsMQ" target="_blank" title="https://mp.weixin.qq.com/s/3W2wmNS8NpzReUn5ifSsMQ" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/3W2wmNS8Nâ€¦</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8409f118b20341248a6b100d624deb98~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57qx6Zu-MTM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769827125&amp;x-signature=rnE2So5Q89o4p5MqcqHzCh6SFyw%3D" alt="img_v3_02tf_4ec1b381-bb29-4387-b0cb-9b6f9a14689g.jpg" loading="lazy"/>
<img src="" alt="" loading="lazy"/></p>
<p>å½“ç„¶è¿˜æœ‰åœ¨1024ç¨‹åºå‘˜èŠ‚çš„æ—¶å€™,æ¼”ç¤ºè¿‡çš„é¡¹ç›®ç­‰ç­‰ç­‰ç­‰è¶…å¤š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/70c4d4f4ba384336b74988d6a84ca439~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57qx6Zu-MTM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769827125&amp;x-signature=MPvIyJ%2BhkFwsIvTLsYSvbCoU6fY%3D" alt="img_v3_02tf_f4ce8d62-bd58-4b9a-8c7c-13962f1ab33g.png" loading="lazy"/></p>
<p>å½“ç„¶å› ä¸ºæˆ‘è¿˜æ˜¯ä¸€ä¸ªå­¦ç”Ÿ,ä½¿ç”¨Traeå‚åŠ äº†ä¸€äº›äº’è”ç½‘å¼€å‘çš„æ¯”èµ›å‡è·å¾—äº†çœé‡Œä¸é”™çš„æˆç»©!</p>
<p><strong>Traeçš„çº¿ä¸‹æ´»åŠ¨!</strong></p>
<p>ä¸å¾—ä¸è¯´,æˆ‘çš„ç¬¬ä¸€æ¬¡çº¿ä¸‹å‚åŠ å…³äºç¼–ç¨‹ç±»çš„æ´»åŠ¨å°±æ˜¯Trae,çœŸçš„å‚åŠ ç¬¬ä¸€æ¬¡,å°±æƒ³å‚åŠ ç¬¬äºŒæ¬¡,å­¦åˆ°äº†å¾ˆå¤šæœ‰å¹²æ–™çš„å¼€å‘æŠ€å·§!</p>
<p>ç¬¬ä¸€æ¬¡å‚åŠ çš„Traeçš„æ´»åŠ¨!(lunaè«æ€ªæˆ‘æ‹çš„ä¸å¥½çœ‹)
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7aa63c6df9724399a9ffac8cf3bc4423~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57qx6Zu-MTM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769827125&amp;x-signature=qOFQa9WtFCrk7jLLWT2A2qKB8Ko%3D" alt="img_v3_02tf_c9ace577-1c7f-4c3e-a45d-a2189d0b3ceg.png" loading="lazy"/>
ç¬¬ä¸€æ¬¡å‚åŠ Hackathon,å°±è·å¾—äº†ä¸€ç­‰å¥–!ä¸”æˆ‘çš„åŒå­¦ä»¬ä¹Ÿéƒ½è·å–äº†ä½³ç»©!çœŸçš„å¾ˆä¸é”™çš„çº¿ä¸‹ä½“éªŒ!
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c196da2aa6104a93831761340497faf6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57qx6Zu-MTM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769827125&amp;x-signature=sMuNUoHGQTgZoRkbfgZUK9KjLvE%3D" alt="img_v3_02tf_0add46fe-f608-4a5f-a12e-e968fc864b6g.jpg" loading="lazy"/>
<strong>Traeå‘¨è¾¹!</strong></p>
<p>å½“ç„¶è¿™ä¸€å¹´ä¹Ÿè·å¾—äº†è¶…å¤šçš„å‘¨è¾¹!(ä¸å®Œå…¨ç»Ÿè®¡)
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da676d6bb54d4a40978b2d58248bb05e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57qx6Zu-MTM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769827125&amp;x-signature=BrsX4s7vdvza83M0j6Uh9OyIvJQ%3D" alt="img_v3_02tf_fee564d7-7fa0-4a5c-93ae-06f3b743207g.jpg" loading="lazy"/></p>
<p><strong>ä½¿ç”¨ Trae å¼€æºè‡ªå·±çš„ skill</strong></p>
<p>æœ€ä½³ skill æ¦‚å¿µç‰¹åˆ«å¥½ï¼Œä¹Ÿæ˜¯ä½¿ç”¨ Trae å»åšå‡ºè‡ªå·±çš„ä¸€å¥— skillæ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwcn1msagbpwc.feishu.cn%2Fwiki%2FP7VPw22RfinnVHk2FeXcvtFfn7b%3Ffrom%3Dfrom_copylink" target="_blank" title="https://wcn1msagbpwc.feishu.cn/wiki/P7VPw22RfinnVHk2FeXcvtFfn7b?from=from_copylink" ref="nofollow noopener noreferrer">Trae Skills å¼€å‘æŠ€å·§</a>
è‡ªå·±æ£€ç´¢äº†ç°åœ¨æ¯”è¾ƒæµè¡Œçš„ anthropics/skillsã€vercel-labs/agent-skills åŠComposioHQ/awesome-claude-skills è¿™3 ä¸ªåº“çš„ç²¾åï¼Œè‡ªå·±æ•´åˆæ„å»ºå‡ºè¿™ä¸ªskills åº“
çœæµç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<p>ä¸€å¥è¯å¼€å‘ï¼Œå°±æœ‰ä¸“é—¨çš„ skill å»è‡ªåŠ¨åˆ†é…ä»»åŠ¡</p>
<pre><code class="hljs">æˆ‘æƒ³å¼€å‘ä¸€ä¸ª ç®€å•çš„ todolist é¡¹ç›®ï¼Œè¯·å¸¦æˆ‘èµ°ä¸€éå…¨æµç¨‹ã€‚
</code></pre>
<p>å°±ä¼šè‡ªåŠ¨çš„å»åˆ’åˆ†ä»»åŠ¡å‡ºæ¥ï¼Œé…åˆ Trae çš„ todolist å®ç°é«˜æ•ˆå¼€å‘
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5aeea57884fa46979bffba972d64688d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57qx6Zu-MTM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769827125&amp;x-signature=9eJkN%2BUuHsVL9ZoqqajJwf0Kom0%3D" alt="img_v3_02u6_21f61828-5395-470a-92d4-a8720f61749g.jpg" loading="lazy"/></p>
<p><strong>æœ€å!</strong></p>
<p>é‚£æœ€åå‘¢,å¸Œæœ›Traeè¶Šæ¥è¶Šå¥½,åœ¨2026å®ç°æ›´å¤šè·¨æ—¶ä»£çš„ä¸€äº›åŠŸèƒ½,æƒŠè‰³çš„åŠŸèƒ½,è®© <strong>The Real AI Engineer</strong> æ›´åŠ ä¼Ÿå¤§!â€Œ</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é¦–å±åŠ è½½ç»Ÿè®¡çš„å‡ ä¸ªé—®é¢˜æ¢³ç†]]></title>    <link>https://juejin.cn/post/7598447519823724585</link>    <guid>https://juejin.cn/post/7598447519823724585</guid>    <pubDate>2026-01-24T07:11:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598447519823724585" data-draft-id="7597905961664413702" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é¦–å±åŠ è½½ç»Ÿè®¡çš„å‡ ä¸ªé—®é¢˜æ¢³ç†"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,Webpack"/> <meta itemprop="datePublished" content="2026-01-24T07:11:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ‹‰ä¸åŠ¨çš„çŒª"/> <meta itemprop="url" content="https://juejin.cn/user/1429793504759630"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é¦–å±åŠ è½½ç»Ÿè®¡çš„å‡ ä¸ªé—®é¢˜æ¢³ç†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1429793504759630/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ‹‰ä¸åŠ¨çš„çŒª
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T07:11:01.000Z" title="Sat Jan 24 2026 07:11:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="" data-highlight-key="atelier-forest-light">.hljs-comment,.hljs-quote{color:#766e6b}.hljs-attribute,.hljs-link,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#f22c40}.hljs-built_in,.hljs-builtin-name,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#df5320}.hljs-bullet,.hljs-string,.hljs-symbol{color:#7b9726}.hljs-section,.hljs-title{color:#407ee7}.hljs-keyword,.hljs-selector-tag{color:#6666ea}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#f1efee;color:#68615e}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>å‰ç«¯æ€§èƒ½ä¼˜åŒ–æ–¹é¢ç¦»ä¸å¼€ç™½å±çš„é—®é¢˜ï¼Œä»Šå¤©åªæ˜¯ä¾§é‡å¤ä¹ ä¸‹ç™½å±çš„è®¡ç®—æ–¹å¼ä¸ç³»ç»Ÿæ€§çš„è®°å½•æ–¹å¼ã€‚å…³äºç™½å±çš„æ€§èƒ½ä¼˜åŒ–æ–¹é¢æœ‰å¾ˆå¤šï¼Œå¤§å®¶å¯ä»¥å…ˆçœ‹çœ‹ä¸‹é¢è¿™ä½è€å“¥å†™çš„<a href="https://juejin.cn/post/7188894691356573754?searchId=202601221819101CC951314B91B268988F" target="_blank" title="https://juejin.cn/post/7188894691356573754?searchId=202601221819101CC951314B91B268988F">æ€§èƒ½ä¼˜åŒ–çš„å‡ ç§æ–¹å¼</a></p>
<h2 data-id="heading-1">å…³äºç™½å±</h2>
<p>åŸºæœ¬å®šä¹‰ï¼š<strong>ç™½å±æ—¶é—´ï¼ˆFPï¼‰æ˜¯ç”¨æˆ·ä»å‘èµ·è¯·æ±‚åˆ°æµè§ˆå™¨é¦–æ¬¡æ¸²æŸ“å‡ºåƒç´ ï¼ˆç»“æŸç™½å±ï¼‰çš„è€—æ—¶ã€‚</strong></p>
<p>æ‰€ä»¥æŒ‰ç…§ä¸Šé¢çš„å®šä¹‰ï¼Œç™½å±ä¼šç»å†ä»¥ä¸‹å‡ ä¸ªé˜¶æ®µï¼š</p>
<ul>
<li>
<p><strong>DNSè§£æ</strong>ï¼šæµè§ˆå™¨å°†åŸŸåè§£æä¸ºIPåœ°å€ã€‚</p>
</li>
<li>
<p><strong>å»ºç«‹TCPè¿æ¥</strong>ï¼šæµè§ˆå™¨ä¸æœåŠ¡å™¨å»ºç«‹TCPè¿æ¥ï¼ˆä¸‰æ¬¡æ¡æ‰‹ï¼‰ã€‚</p>
</li>
<li>
<p><strong>å‘èµ·HTTPè¯·æ±‚</strong>ï¼šæµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€HTTPè¯·æ±‚ã€‚</p>
</li>
<li>
<p><strong>æœåŠ¡å™¨å“åº”</strong>ï¼šæœåŠ¡å™¨å¤„ç†è¯·æ±‚å¹¶è¿”å›å“åº”æ•°æ®ã€‚</p>
</li>
<li>
<p><strong>æµè§ˆå™¨è§£æHTML</strong>ï¼šæµè§ˆå™¨è§£æHTMLæ–‡æ¡£å¹¶æ„å»ºDOMæ ‘ã€‚</p>
</li>
<li>
<p><strong>æµè§ˆå™¨æ¸²æŸ“é¡µé¢</strong>ï¼šæµè§ˆå™¨æ ¹æ®DOMæ ‘å’ŒCSSOMæ ‘ç”Ÿæˆæ¸²æŸ“æ ‘ï¼Œå¹¶å¼€å§‹æ¸²æŸ“é¡µé¢ã€‚</p>
</li>
<li>
<p><strong>é¡µé¢å±•ç¤ºhtmlå…ƒç´ </strong>ï¼šæµè§ˆå™¨é¦–æ¬¡å°†é¡µé¢å†…å®¹æ¸²æŸ“åˆ°å±å¹•ä¸Šã€‚</p>
</li>
</ul>
<h2 data-id="heading-2">å…³äºç™½å±çš„åˆç†è®¡ç®—</h2>
<p>ç™½å±çš„è®¡ç®—å§‹äºæµè§ˆå™¨ï¼Œæ‰€ä»¥è®¡ç®—çš„ä¾æ®ä¹Ÿæ˜¯æµè§ˆå™¨æä¾›ï¼Œæµè§ˆå™¨Â <strong>Performance API</strong>Â ä¸­æä¾›äº†è®¡ç®—ä¾æ®ã€‚</p>
<h3 data-id="heading-3">ä¸€ã€Performance API æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p>ç®€å•æ¥è¯´ï¼Œ<strong>Performance API</strong>Â æ˜¯æµè§ˆå™¨æä¾›çš„ä¸€å¥—åŸç”Ÿæ¥å£ï¼Œä¸“é—¨ç”¨äºç²¾ç¡®æµ‹é‡ã€ç›‘æ§å’Œåˆ†æç½‘é¡µçš„æ€§èƒ½æ•°æ®ï¼ˆæ¯”å¦‚é¡µé¢åŠ è½½æ—¶é—´ã€èµ„æºåŠ è½½è€—æ—¶ã€è‡ªå®šä¹‰ä»£ç æ‰§è¡Œè€—æ—¶ç­‰ï¼‰ï¼Œæ˜¯å‰ç«¯æ€§èƒ½ä¼˜åŒ–çš„æ ¸å¿ƒå·¥å…·ä¹‹ä¸€ã€‚</p>
<h3 data-id="heading-4">äºŒã€åˆ©ç”¨Performance APIæä¾›çš„æ–¹æ³•ï¼šperformance.timing å¸¸è§„çš„è®¡ç®—æ–¹å¼å¦‚ä¸‹ï¼š</h3>
<p>ä¸‹é¢æ˜¯Â <code>performance.timing</code>Â é‡Œæœ€å¸¸ç”¨çš„æ—¶é—´æˆ³ï¼Œä»¥åŠå®ƒä»¬çš„å«ä¹‰ï¼š</p>

















































<table><thead><tr><th>æ—¶é—´æˆ³å±æ€§</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>navigationStart</code></td><td>é¡µé¢å¼€å§‹å¯¼èˆªçš„æ—¶é—´ï¼ˆæ¯”å¦‚ç”¨æˆ·è¾“å…¥ç½‘å€å›è½¦ã€ç‚¹å‡»é“¾æ¥ï¼‰ï¼Œæ˜¯æ•´ä¸ªæµç¨‹çš„èµ·ç‚¹</td></tr><tr><td><code>domainLookupStart</code></td><td>å¼€å§‹ DNS åŸŸåè§£æçš„æ—¶é—´</td></tr><tr><td><code>domainLookupEnd</code></td><td>DNS åŸŸåè§£æå®Œæˆçš„æ—¶é—´</td></tr><tr><td><code>connectStart</code></td><td>å¼€å§‹å»ºç«‹ TCP è¿æ¥çš„æ—¶é—´</td></tr><tr><td><code>connectEnd</code></td><td>TCP è¿æ¥å»ºç«‹å®Œæˆçš„æ—¶é—´ï¼ˆå¦‚æœæ˜¯ HTTPSï¼ŒåŒ…å« SSL æ¡æ‰‹ï¼‰</td></tr><tr><td><code>requestStart</code></td><td>æµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€è¯·æ±‚çš„æ—¶é—´</td></tr><tr><td><code>responseStart</code></td><td>æµè§ˆå™¨æ”¶åˆ°æœåŠ¡å™¨ç¬¬ä¸€ä¸ªå­—èŠ‚å“åº”çš„æ—¶é—´ï¼ˆé¦–å­—èŠ‚æ—¶é—´ï¼ŒTTFBï¼‰</td></tr><tr><td><code>responseEnd</code></td><td>æµè§ˆå™¨æ¥æ”¶å®ŒæœåŠ¡å™¨å“åº”æ•°æ®çš„æ—¶é—´</td></tr><tr><td><code>domContentLoadedEventEnd</code></td><td>DOM è§£æå®Œæˆï¼Œä¸”æ‰€æœ‰ DOMContentLoaded äº‹ä»¶å›è°ƒæ‰§è¡Œå®Œæ¯•çš„æ—¶é—´</td></tr><tr><td><code>loadEventEnd</code></td><td>é¡µé¢ load äº‹ä»¶è§¦å‘ä¸”æ‰€æœ‰å›è°ƒæ‰§è¡Œå®Œæ¯•çš„æ—¶é—´ï¼ˆé¡µé¢å®Œå…¨åŠ è½½å®Œæˆï¼‰</td></tr></tbody></table>
<h3 data-id="heading-5">ä¸‰ã€ç®€å•ç”¨æ³•ï¼šè®¡ç®—å„é˜¶æ®µè€—æ—¶</h3>
<p>é€šè¿‡è®¡ç®—ä¸åŒæ—¶é—´æˆ³çš„å·®å€¼ï¼Œåˆ©ç”¨æ—¶é—´å·®å¾—å‡ºé¡µé¢åŠ è½½å„é˜¶æ®µçš„è€—æ—¶ï¼Œç®€å•ç”¨æ³•å¦‚ä¸‹ï¼š
ï¼ˆåŸºäº<code>performance.timing</code>ï¼‰ï¼š</p>



































<table><thead><tr><th>æ€§èƒ½æŒ‡æ ‡</th><th>è®¡ç®—æ–¹å¼ï¼ˆç›¸å¯¹è€—æ—¶ï¼‰</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>DNS è§£æè€—æ—¶</td><td>domainLookupEnd - domainLookupStart</td><td>åŸŸåè§£æçš„æ€»è€—æ—¶</td></tr><tr><td>TCP è¿æ¥è€—æ—¶</td><td>connectEnd - connectStart</td><td>å»ºç«‹ TCP æ¡æ‰‹çš„è€—æ—¶</td></tr><tr><td>é¦–å­—èŠ‚è€—æ—¶ (TTFB)</td><td>responseStart - navigationStart</td><td>ä»å¯¼èˆªåˆ°æœåŠ¡å™¨è¿”å›é¦–å­—èŠ‚</td></tr><tr><td>é¡µé¢åŠ è½½å®Œæˆ</td><td>loadEventEnd - navigationStart</td><td>æ•´ä¸ªé¡µé¢åŠ è½½å®Œæˆçš„æ€»è€—æ—¶</td></tr><tr><td>DOM è§£æå®Œæˆ</td><td>domContentLoadedEventEnd - navigationStart</td><td>DOM æ ‘æ„å»ºå®Œæˆçš„è€—æ—¶</td></tr></tbody></table>
<p><strong>ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// è·å– timing å¯¹è±¡</span>
<span class="hljs-keyword">const</span> timing = performance.<span class="hljs-property">timing</span>;

<span class="hljs-comment">// 1. DNSè§£æè€—æ—¶</span>
<span class="hljs-keyword">const</span> dnsTime = timing.<span class="hljs-property">domainLookupEnd</span> - timing.<span class="hljs-property">domainLookupStart</span>;
<span class="hljs-comment">// 2. TCPè¿æ¥è€—æ—¶ï¼ˆå«HTTPSæ¡æ‰‹ï¼‰</span>
<span class="hljs-keyword">const</span> tcpTime = timing.<span class="hljs-property">connectEnd</span> - timing.<span class="hljs-property">connectStart</span>;
<span class="hljs-comment">// 3. é¦–å­—èŠ‚æ—¶é—´ï¼ˆTTFBï¼‰ï¼šè¯·æ±‚å‘é€åˆ°æ”¶åˆ°ç¬¬ä¸€ä¸ªå“åº”å­—èŠ‚çš„æ—¶é—´</span>
<span class="hljs-keyword">const</span> ttfb = timing.<span class="hljs-property">responseStart</span> - timing.<span class="hljs-property">requestStart</span>;
<span class="hljs-comment">// 4. ç™½å±æ—¶é—´ï¼šå¯¼èˆªå¼€å§‹åˆ°é¦–å­—èŠ‚è¿”å›çš„æ—¶é—´ï¼ˆæ ¸å¿ƒä½“éªŒæŒ‡æ ‡ï¼‰</span>
<span class="hljs-keyword">const</span> blankScreenTime = timing.<span class="hljs-property">responseStart</span> - timing.<span class="hljs-property">navigationStart</span>;
<span class="hljs-comment">// 5. DOMè§£æå®Œæˆè€—æ—¶</span>
<span class="hljs-keyword">const</span> domParseTime = timing.<span class="hljs-property">domContentLoadedEventEnd</span> - timing.<span class="hljs-property">responseEnd</span>;
<span class="hljs-comment">// 6. é¡µé¢å®Œå…¨åŠ è½½æ€»è€—æ—¶</span>
<span class="hljs-keyword">const</span> totalLoadTime = timing.<span class="hljs-property">loadEventEnd</span> - timing.<span class="hljs-property">navigationStart</span>;

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>({
  <span class="hljs-variable constant_">DNS</span>è§£æè€—æ—¶: <span class="hljs-string">`<span class="hljs-subst">${dnsTime}</span>ms`</span>,
  <span class="hljs-variable constant_">TCP</span>è¿æ¥è€—æ—¶: <span class="hljs-string">`<span class="hljs-subst">${tcpTime}</span>ms`</span>,
  é¦–å­—èŠ‚æ—¶é—´(<span class="hljs-variable constant_">TTFB</span>): <span class="hljs-string">`<span class="hljs-subst">${ttfb}</span>ms`</span>,
  ç™½å±æ—¶é—´: <span class="hljs-string">`<span class="hljs-subst">${blankScreenTime}</span>ms`</span>,
  <span class="hljs-variable constant_">DOM</span>è§£æè€—æ—¶: <span class="hljs-string">`<span class="hljs-subst">${domParseTime}</span>ms`</span>,
  é¡µé¢æ€»åŠ è½½è€—æ—¶: <span class="hljs-string">`<span class="hljs-subst">${totalLoadTime}</span>ms`</span>
});
</code></pre>
<p><strong>å½“ç„¶è¿˜æœ‰æ–°ç‰ˆæœ¬çš„è®¡ç®—æ–¹å¼ï¼šperformance.getEntriesByType('navigation')</strong></p>
<p>æ¯”å¦‚è¿™æ ·ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">navEntry</span> = performance.getEntriesByType(<span class="hljs-string">'navigation'</span>)[<span class="hljs-number">0</span>]<span class="hljs-comment">; </span>
// ç­‰ä»·äº timing çš„æ ¸å¿ƒè®¡ç®—
const <span class="hljs-attr">dnsTime</span> = navEntry.domainLookupEnd - navEntry.domainLookupStart<span class="hljs-comment">; </span>
const <span class="hljs-attr">ttfb</span> = navEntry.responseStart - navEntry.requestStart<span class="hljs-comment">; </span>
const <span class="hljs-attr">totalLoadTime</span> = navEntry.loadEventEnd - navEntry.navigationStart<span class="hljs-comment">;</span>
</code></pre>
<h3 data-id="heading-6">navigationStartè§¦å‘æ—¶æœº</h3>
<p><code>navigationStart</code>Â çš„æ—¶é—´æˆ³åœ¨<strong>æµè§ˆå™¨æ¥æ”¶åˆ°å¯¼èˆªæŒ‡ä»¤çš„ç¬é—´</strong>è¢«è®°å½•ï¼Œå…·ä½“åˆ†åœºæ™¯ï¼š</p>
<ol>
<li>æ™®é€šè·³è½¬ï¼ˆç‚¹å‡»é“¾æ¥ã€è¾“å…¥ URL å›è½¦ï¼‰ï¼šæµè§ˆå™¨å¼€å§‹å‘èµ·è¯·æ±‚å‰çš„ç¬é—´ï¼›</li>
<li>é¡µé¢åˆ·æ–°ï¼šæµè§ˆå™¨æ¸…ç©ºå½“å‰é¡µé¢ã€å‡†å¤‡é‡æ–°è¯·æ±‚èµ„æºçš„ç¬é—´ï¼›</li>
<li>å‰è¿› / åé€€ï¼ˆæµè§ˆå™¨ç¼“å­˜ï¼‰ï¼šæµè§ˆå™¨å¼€å§‹ä»ç¼“å­˜åŠ è½½é¡µé¢çš„ç¬é—´ã€‚</li>
</ol>
<h3 data-id="heading-7">å¸¸è§„æœ¬åœ°æµ‹è¯•å¯ä»¥è¿™æ ·ï¼š</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// main.js </span>
<span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">calculatePerformance</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// å…ˆåˆ¤æ–­æµè§ˆå™¨æ˜¯å¦æ”¯æŒ Performance API</span>
  <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">window</span>.<span class="hljs-property">performance</span> || !<span class="hljs-variable language_">window</span>.<span class="hljs-property">performance</span>.<span class="hljs-property">timing</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'å½“å‰æµè§ˆå™¨ä¸æ”¯æŒ Performance.timing API'</span>);
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-keyword">const</span> timing = performance.<span class="hljs-property">timing</span>;
  <span class="hljs-comment">// æ ¸å¿ƒï¼šå…ˆåˆ¤æ–­ loadEventEnd æ˜¯å¦å·²å®Œæˆï¼ˆå€¼å¤§äº 0ï¼‰</span>
  <span class="hljs-keyword">if</span> (timing.<span class="hljs-property">loadEventEnd</span> === <span class="hljs-number">0</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'é¡µé¢ load äº‹ä»¶è¿˜æœªå®Œæˆï¼Œæš‚æ— æ³•ç»Ÿè®¡å®Œæ•´æ€§èƒ½æ•°æ®'</span>);
    <span class="hljs-comment">// é€€è€Œæ±‚å…¶æ¬¡ï¼Œç»Ÿè®¡å·²å®Œæˆçš„é˜¶æ®µï¼ˆæ¯”å¦‚ DOM è§£æå®Œæˆï¼‰</span>
    <span class="hljs-keyword">const</span> partialTotalTime = timing.<span class="hljs-property">domContentLoadedEventEnd</span> - timing.<span class="hljs-property">navigationStart</span>;
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å·²å®Œæˆçš„æ€§èƒ½æ•°æ®ï¼ˆéå®Œæ•´ï¼‰ï¼š'</span>, {
      ç™½å±æ—¶é—´: <span class="hljs-string">`<span class="hljs-subst">${timing.responseStart - timing.navigationStart}</span>ms`</span>,
      <span class="hljs-variable constant_">DOM</span>è§£æå®Œæˆè€—æ—¶: <span class="hljs-string">`<span class="hljs-subst">${timing.domContentLoadedEventEnd - timing.responseEnd}</span>ms`</span>,
      æˆªè‡³<span class="hljs-variable constant_">DOM</span>å®Œæˆæ€»è€—æ—¶: <span class="hljs-string">`<span class="hljs-subst">${partialTotalTime}</span>ms`</span>
    });
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-comment">// è®¡ç®—å„é˜¶æ®µè€—æ—¶ï¼ˆå¢åŠ å¼‚å¸¸å€¼è¿‡æ»¤ï¼‰</span>
  <span class="hljs-keyword">const</span> dnsTime = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, timing.<span class="hljs-property">domainLookupEnd</span> - timing.<span class="hljs-property">domainLookupStart</span>);
  <span class="hljs-keyword">const</span> tcpTime = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, timing.<span class="hljs-property">connectEnd</span> - timing.<span class="hljs-property">connectStart</span>);
  <span class="hljs-keyword">const</span> ttfb = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, timing.<span class="hljs-property">responseStart</span> - timing.<span class="hljs-property">requestStart</span>);
  <span class="hljs-keyword">const</span> blankScreenTime = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, timing.<span class="hljs-property">responseStart</span> - timing.<span class="hljs-property">navigationStart</span>);
  <span class="hljs-keyword">const</span> domParseTime = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, timing.<span class="hljs-property">domContentLoadedEventEnd</span> - timing.<span class="hljs-property">responseEnd</span>);
  <span class="hljs-keyword">const</span> totalLoadTime = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, timing.<span class="hljs-property">loadEventEnd</span> - timing.<span class="hljs-property">navigationStart</span>);

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å®Œæ•´æ€§èƒ½ç»Ÿè®¡æ•°æ®ï¼š'</span>, {
    <span class="hljs-variable constant_">DNS</span>è§£æè€—æ—¶: <span class="hljs-string">`<span class="hljs-subst">${dnsTime}</span>ms<span class="hljs-subst">${dnsTime === <span class="hljs-number">0</span> ? <span class="hljs-string">'ï¼ˆDNSç¼“å­˜å‘½ä¸­ï¼‰'</span> : <span class="hljs-string">''</span>}</span>`</span>,
    <span class="hljs-variable constant_">TCP</span>è¿æ¥è€—æ—¶: <span class="hljs-string">`<span class="hljs-subst">${tcpTime}</span>ms`</span>,
    é¦–å­—èŠ‚æ—¶é—´(<span class="hljs-variable constant_">TTFB</span>): <span class="hljs-string">`<span class="hljs-subst">${ttfb}</span>ms`</span>,
    ç™½å±æ—¶é—´: <span class="hljs-string">`<span class="hljs-subst">${blankScreenTime}</span>ms`</span>,
    <span class="hljs-variable constant_">DOM</span>è§£æå®Œæˆè€—æ—¶: <span class="hljs-string">`<span class="hljs-subst">${domParseTime}</span>ms`</span>,
    é¡µé¢æ€»åŠ è½½è€—æ—¶: <span class="hljs-string">`<span class="hljs-subst">${totalLoadTime}</span>ms`</span>
  });
}

<span class="hljs-comment">// æ–¹æ¡ˆ1ï¼šä¼˜å…ˆç­‰å¾… load äº‹ä»¶ï¼ˆæœ€å‡†ç¡®ï¼‰</span>
<span class="hljs-keyword">if</span> (<span class="hljs-variable language_">document</span>.<span class="hljs-property">readyState</span> === <span class="hljs-string">'complete'</span>) {
  <span class="hljs-comment">// é¡µé¢å·²ç»åŠ è½½å®Œæˆï¼Œç›´æ¥æ‰§è¡Œ</span>
  <span class="hljs-title function_">calculatePerformance</span>();
} <span class="hljs-keyword">else</span> {
  <span class="hljs-comment">// é¡µé¢è¿˜åœ¨åŠ è½½ï¼Œç›‘å¬ load äº‹ä»¶</span>
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'load'</span>, calculatePerformance);
}

<span class="hljs-comment">// åˆå§‹åŒ– Vue åº”ç”¨ï¼ˆæ”¾åœ¨ç»Ÿè®¡é€»è¾‘ä¹‹åä¸å½±å“ï¼Œå› ä¸ºç»Ÿè®¡å·²å¼‚æ­¥ç­‰å¾… load äº‹ä»¶ï¼‰</span>
<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>)
app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>)
</code></pre>
<p><strong>è·¯ç”±åˆ‡æ¢æ—¶çš„ç®€å•å¤„ç†</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Vue3 + Vue Router è·¯ç”±åˆ‡æ¢åŸ‹ç‚¹</span>
<span class="hljs-keyword">import</span> { useRouter } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>;
<span class="hljs-keyword">const</span> router = <span class="hljs-title function_">useRouter</span>();

router.<span class="hljs-title function_">afterEach</span>(<span class="hljs-function">(<span class="hljs-params">to, <span class="hljs-keyword">from</span></span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> startTime = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
  <span class="hljs-keyword">const</span> threshold = <span class="hljs-number">2000</span>;
  <span class="hljs-comment">// è·¯ç”±åˆ‡æ¢åï¼Œå»¶è¿Ÿé˜ˆå€¼æ—¶é—´æ£€æµ‹é¦–å±</span>
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> keyNode = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">`#<span class="hljs-subst">${to.name}</span>-container`</span>); <span class="hljs-comment">// è·¯ç”±å¯¹åº”å®¹å™¨</span>
    <span class="hljs-keyword">const</span> isBlank = !keyNode || keyNode.<span class="hljs-property">offsetHeight</span> === <span class="hljs-number">0</span>;
    <span class="hljs-title function_">report</span>({
      isBlank,
      <span class="hljs-attr">type</span>: <span class="hljs-string">'route-change'</span>, <span class="hljs-comment">// æ ‡è®°æ˜¯è·¯ç”±åˆ‡æ¢é¦–å±</span>
      <span class="hljs-attr">from</span>: <span class="hljs-keyword">from</span>.<span class="hljs-property">path</span>,
      <span class="hljs-attr">to</span>: to.<span class="hljs-property">path</span>,
      <span class="hljs-attr">duration</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - startTime
    });
  }, threshold);
});
</code></pre>
<h2 data-id="heading-8">ä»ç”¨æˆ·çš„æ„ŸçŸ¥è§’åº¦è¿›è¡Œè®¡ç®—</h2>
<p><code>responseStart - navigationStart</code> æ˜¯<strong>ä¼ ç»Ÿç™½å±æ—¶é—´è®¡ç®—æ–¹å¼</strong>ï¼Œä½†ä»ç”¨æˆ·ä½“éªŒè§’åº¦ï¼Œæ›´ç²¾å‡†çš„ç™½å±ç»“æŸæ ‡å¿—æ˜¯ã€Œé¦–æ¬¡ç»˜åˆ¶ï¼ˆFPï¼‰ã€æˆ–ã€Œé¦–æ¬¡å†…å®¹ç»˜åˆ¶ï¼ˆFCPï¼‰ã€ï¼Œè¿™ä¸¤ä¸ªæŒ‡æ ‡å¯ä»¥é€šè¿‡ <code>performance.getEntriesByType('paint')</code> è·å–ï¼Œæ¯”ä»…ç”¨ <code>responseStart</code> æ›´è´´åˆå®é™…è§†è§‰ä½“éªŒï¼š</p>
<pre><code class="hljs language-ini" lang="ini">// è·å–æ›´ç²¾å‡†çš„ç™½å±æ—¶é—´ï¼ˆFP/FCPï¼‰
function getAccurateBlankScreenTime() {
  // å…¼å®¹å¤„ç†ï¼šå…ˆåˆ¤æ–­æ˜¯å¦æ”¯æŒ Paint Timing API
  if (!window.performance || !window.performance.getEntriesByType) {
    // é™çº§ä½¿ç”¨ä¼ ç»Ÿæ–¹å¼
    const <span class="hljs-attr">timing</span> = performance.timing<span class="hljs-comment">;</span>
    return Math.max(0, timing.responseStart - timing.navigationStart)<span class="hljs-comment">;</span>
  }

  // è·å– Paint ç±»å‹çš„æ€§èƒ½æŒ‡æ ‡
  const <span class="hljs-attr">paintEntries</span> = performance.getEntriesByType(<span class="hljs-string">'paint'</span>)<span class="hljs-comment">;</span>
  let <span class="hljs-attr">fpTime</span> = <span class="hljs-number">0</span><span class="hljs-comment">; // é¦–æ¬¡ç»˜åˆ¶ï¼ˆFirst Paintï¼‰</span>
  let <span class="hljs-attr">fcpTime</span> = <span class="hljs-number">0</span><span class="hljs-comment">; // é¦–æ¬¡å†…å®¹ç»˜åˆ¶ï¼ˆFirst Contentful Paintï¼‰</span>

  for (const entry of paintEntries) {
    if (<span class="hljs-attr">entry.name</span> === <span class="hljs-string">'first-paint'</span>) {
      <span class="hljs-attr">fpTime</span> = entry.startTime<span class="hljs-comment">;</span>
    } else if (<span class="hljs-attr">entry.name</span> === <span class="hljs-string">'first-contentful-paint'</span>) {
      <span class="hljs-attr">fcpTime</span> = entry.startTime<span class="hljs-comment">;</span>
    }
  }

  // ä¼˜å…ˆçº§ï¼šFCP &gt; FP &gt; ä¼ ç»Ÿæ–¹å¼
  if (fcpTime) return fcpTime<span class="hljs-comment">;</span>
  if (fpTime) return fpTime<span class="hljs-comment">;</span>
  
  // æœ€ç»ˆé™çº§
  const <span class="hljs-attr">timing</span> = performance.timing<span class="hljs-comment">;</span>
  return Math.max(0, timing.responseStart - timing.navigationStart)<span class="hljs-comment">;</span>
}
</code></pre>
<h3 data-id="heading-9">åŒºåˆ«ï¼š</h3>
<ul>
<li><code>responseStart</code>ï¼šæœåŠ¡å™¨è¿”å›ç¬¬ä¸€ä¸ªå­—èŠ‚çš„æ—¶é—´ï¼ˆä»…ä»£è¡¨æ•°æ®å¼€å§‹ä¼ è¾“ï¼Œé¡µé¢æœªå¿…æ¸²æŸ“ï¼‰ï¼›</li>
<li><code>first-paint (FP)</code>ï¼šæµè§ˆå™¨é¦–æ¬¡æ¸²æŸ“åƒç´ ï¼ˆå“ªæ€•æ˜¯èƒŒæ™¯è‰²ï¼Œç»“æŸçº¯é»‘ / çº¯ç™½å±ï¼‰ï¼›</li>
<li><code>first-contentful-paint (FCP)</code>ï¼šæµè§ˆå™¨é¦–æ¬¡æ¸²æŸ“æœ‰æ„ä¹‰çš„å†…å®¹ï¼ˆæ–‡å­—ã€å›¾ç‰‡ã€æŒ‰é’®ç­‰ï¼‰ï¼Œæ›´è´´è¿‘ç”¨æˆ·æ„ŸçŸ¥çš„ã€Œç™½å±ç»“æŸã€ã€‚</li>
</ul>
<h2 data-id="heading-10">å®Œæ•´çš„å¸¸è§„æ€§èƒ½ç»Ÿè®¡å·¥å…·ç¤ºä¾‹</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getPagePerformance</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// åŸºç¡€æ ¡éªŒ</span>
  <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">window</span>.<span class="hljs-property">performance</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'å½“å‰æµè§ˆå™¨ä¸æ”¯æŒ Performance API'</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  }

  <span class="hljs-comment">// 1. åˆå§‹åŒ–åŸºç¡€æ•°æ®</span>
  <span class="hljs-keyword">const</span> timing = performance.<span class="hljs-property">timing</span>;
  <span class="hljs-keyword">const</span> navEntry = performance.<span class="hljs-title function_">getEntriesByType</span>(<span class="hljs-string">'navigation'</span>)[<span class="hljs-number">0</span>] || {};
  <span class="hljs-keyword">const</span> paintEntries = performance.<span class="hljs-title function_">getEntriesByType</span>(<span class="hljs-string">'paint'</span>) || [];

  <span class="hljs-comment">// 2. æ ¸å¿ƒæŒ‡æ ‡è®¡ç®—ï¼ˆå…¼å®¹æ–°æ—§APIï¼‰</span>
  <span class="hljs-keyword">const</span> performanceData = {
    <span class="hljs-comment">// åŸºç¡€å¯¼èˆªæ—¶é—´ï¼ˆå…¼å®¹ navEntry å’Œ timingï¼‰</span>
    <span class="hljs-attr">navigationStart</span>: navEntry.<span class="hljs-property">navigationStart</span> || timing.<span class="hljs-property">navigationStart</span> || <span class="hljs-number">0</span>,
    
    <span class="hljs-comment">// DNS è§£æè€—æ—¶</span>
    <span class="hljs-attr">dnsTime</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, 
      (navEntry.<span class="hljs-property">domainLookupEnd</span> || timing.<span class="hljs-property">domainLookupEnd</span>) - 
      (navEntry.<span class="hljs-property">domainLookupStart</span> || timing.<span class="hljs-property">domainLookupStart</span>)
    ),

    <span class="hljs-comment">// TCP è¿æ¥è€—æ—¶ï¼ˆå«HTTPSæ¡æ‰‹ï¼‰</span>
    <span class="hljs-attr">tcpTime</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>,
      (navEntry.<span class="hljs-property">connectEnd</span> || timing.<span class="hljs-property">connectEnd</span>) -
      (navEntry.<span class="hljs-property">connectStart</span> || timing.<span class="hljs-property">connectStart</span>)
    ),

    <span class="hljs-comment">// é¦–å­—èŠ‚æ—¶é—´ TTFB</span>
    <span class="hljs-attr">ttfb</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>,
      (navEntry.<span class="hljs-property">responseStart</span> || timing.<span class="hljs-property">responseStart</span>) -
      (navEntry.<span class="hljs-property">requestStart</span> || timing.<span class="hljs-property">requestStart</span>)
    ),

    <span class="hljs-comment">// ä¼ ç»Ÿç™½å±æ—¶é—´ï¼ˆå…¼å®¹ï¼‰</span>
    <span class="hljs-attr">blankScreenTime_legacy</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>,
      (navEntry.<span class="hljs-property">responseStart</span> || timing.<span class="hljs-property">responseStart</span>) -
      (navEntry.<span class="hljs-property">navigationStart</span> || timing.<span class="hljs-property">navigationStart</span>)
    ),

    <span class="hljs-comment">// ç²¾å‡†ç™½å±æ—¶é—´ï¼ˆFP/FCPï¼‰</span>
    <span class="hljs-attr">firstPaint</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// é¦–æ¬¡ç»˜åˆ¶</span>
    <span class="hljs-attr">firstContentfulPaint</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// é¦–æ¬¡å†…å®¹ç»˜åˆ¶</span>

    <span class="hljs-comment">// DOM è§£æè€—æ—¶</span>
    <span class="hljs-attr">domParseTime</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>,
      timing.<span class="hljs-property">domContentLoadedEventEnd</span> - timing.<span class="hljs-property">responseEnd</span>
    ),

    <span class="hljs-comment">// é¡µé¢æ€»åŠ è½½è€—æ—¶</span>
    <span class="hljs-attr">totalLoadTime</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>,
      (navEntry.<span class="hljs-property">loadEventEnd</span> || timing.<span class="hljs-property">loadEventEnd</span>) -
      (navEntry.<span class="hljs-property">navigationStart</span> || timing.<span class="hljs-property">navigationStart</span>)
    )
  };

  <span class="hljs-comment">// 3. è¡¥å…… FP/FCP æ•°æ®</span>
  paintEntries.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">entry</span> =&gt;</span> {
    <span class="hljs-keyword">if</span> (entry.<span class="hljs-property">name</span> === <span class="hljs-string">'first-paint'</span>) {
      performanceData.<span class="hljs-property">firstPaint</span> = entry.<span class="hljs-property">startTime</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (entry.<span class="hljs-property">name</span> === <span class="hljs-string">'first-contentful-paint'</span>) {
      performanceData.<span class="hljs-property">firstContentfulPaint</span> = entry.<span class="hljs-property">startTime</span>;
    }
  });

  <span class="hljs-comment">// 4. æœ€ç»ˆæ¨èçš„ç™½å±æ—¶é—´ï¼ˆä¼˜å…ˆçº§ï¼šFCP &gt; FP &gt; ä¼ ç»Ÿæ–¹å¼ï¼‰ï¼Œé€‚é…æ€§é€‰æ‹©</span>
  performanceData.<span class="hljs-property">blankScreenTime</span> = performanceData.<span class="hljs-property">firstContentfulPaint</span> || 
                                    performanceData.<span class="hljs-property">firstPaint</span> || 
                                    performanceData.<span class="hljs-property">blankScreenTime_legacy</span>;

  <span class="hljs-comment">// 5. è¡¥å……å‹å¥½çš„æ ¼å¼åŒ–æ•°æ®</span>
  performanceData.<span class="hljs-property">formatted</span> = {
    <span class="hljs-attr">dnsTime</span>: <span class="hljs-string">`<span class="hljs-subst">${performanceData.dnsTime}</span>ms<span class="hljs-subst">${performanceData.dnsTime === <span class="hljs-number">0</span> ? <span class="hljs-string">'ï¼ˆDNSç¼“å­˜å‘½ä¸­ï¼‰'</span> : <span class="hljs-string">''</span>}</span>`</span>,
    <span class="hljs-attr">tcpTime</span>: <span class="hljs-string">`<span class="hljs-subst">${performanceData.tcpTime}</span>ms`</span>,
    <span class="hljs-attr">ttfb</span>: <span class="hljs-string">`<span class="hljs-subst">${performanceData.ttfb}</span>ms`</span>,
    <span class="hljs-attr">blankScreenTime</span>: <span class="hljs-string">`<span class="hljs-subst">${performanceData.blankScreenTime.toFixed(<span class="hljs-number">2</span>)}</span>ms`</span>, <span class="hljs-comment">// ä¿ç•™ä¸¤ä½å°æ•°</span>
    <span class="hljs-attr">domParseTime</span>: <span class="hljs-string">`<span class="hljs-subst">${performanceData.domParseTime}</span>ms`</span>,
    <span class="hljs-attr">totalLoadTime</span>: <span class="hljs-string">`<span class="hljs-subst">${performanceData.totalLoadTime}</span>ms`</span>
  };

  <span class="hljs-keyword">return</span> performanceData;
}

<span class="hljs-comment">//  åˆå§‹åŒ–æ€§èƒ½ç»Ÿè®¡ï¼ˆç¡®ä¿åœ¨é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œï¼‰</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">initPerformanceMonitor</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// ç›‘å¬é¡µé¢åŠ è½½å®Œæˆäº‹ä»¶</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleLoad</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> perfData = <span class="hljs-title function_">getPagePerformance</span>();
    <span class="hljs-keyword">if</span> (perfData) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'é¡µé¢æ€§èƒ½ç»Ÿè®¡æ•°æ®ï¼š'</span>, perfData.<span class="hljs-property">formatted</span>);
      <span class="hljs-comment">// å¯é€‰ï¼šä¸ŠæŠ¥æ€§èƒ½æ•°æ®åˆ°åç«¯/ç›‘æ§å¹³å°</span>
      <span class="hljs-comment">// reportPerformanceToServer(perfData);</span>
    }
  }

  <span class="hljs-comment">// é¡µé¢å·²åŠ è½½å®Œæˆåˆ™ç›´æ¥æ‰§è¡Œï¼Œå¦åˆ™ç›‘å¬ load äº‹ä»¶</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">document</span>.<span class="hljs-property">readyState</span> === <span class="hljs-string">'complete'</span>) {
    <span class="hljs-built_in">setTimeout</span>(handleLoad, <span class="hljs-number">0</span>); <span class="hljs-comment">// å¾®ä»»åŠ¡å»¶è¿Ÿï¼Œç¡®ä¿æ‰€æœ‰èµ„æºåŠ è½½å®Œæ¯•</span>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'load'</span>, handleLoad);
    <span class="hljs-comment">// å…œåº•ï¼šå¦‚æœ load äº‹ä»¶è¿Ÿè¿Ÿä¸è§¦å‘ï¼Œ5ç§’åå¼ºåˆ¶ç»Ÿè®¡</span>
    <span class="hljs-built_in">setTimeout</span>(handleLoad, <span class="hljs-number">5000</span>);
  }
}

<span class="hljs-comment">// ========== ä¸šåŠ¡é›†æˆç¤ºä¾‹ï¼ˆVue/React é€šç”¨ï¼‰ ==========</span>
<span class="hljs-comment">// Vue é¡¹ç›®ï¼šåœ¨ main.js ä¸­è°ƒç”¨</span>
<span class="hljs-comment">// import { createApp } from 'vue'</span>
<span class="hljs-comment">// import App from './App.vue'</span>

<span class="hljs-comment">// // å…ˆåˆå§‹åŒ–æ€§èƒ½ç›‘æ§</span>
<span class="hljs-comment">// initPerformanceMonitor();</span>

<span class="hljs-comment">// // å†æŒ‚è½½åº”ç”¨</span>
<span class="hljs-comment">// createApp(App).mount('#app');</span>

<span class="hljs-comment">// React é¡¹ç›®ï¼šåœ¨ index.js ä¸­è°ƒç”¨</span>
<span class="hljs-comment">// import React from 'react';</span>
<span class="hljs-comment">// import ReactDOM from 'react-dom/client';</span>
<span class="hljs-comment">// import App from './App';</span>

<span class="hljs-comment">// // å…ˆåˆå§‹åŒ–æ€§èƒ½ç›‘æ§</span>
<span class="hljs-comment">// initPerformanceMonitor();</span>

<span class="hljs-comment">// // å†æ¸²æŸ“åº”ç”¨</span>
<span class="hljs-comment">// const root = ReactDOM.createRoot(document.getElementById('root'));</span>
<span class="hljs-comment">// root.render(&lt;App /&gt;);</span>
</code></pre>
<h2 data-id="heading-11">æ³¨æ„</h2>
<ol>
<li>
<p><strong>è·¨åŸŸèµ„æºçš„æ€§èƒ½æ•°æ®</strong>ï¼šå¦‚æœé¡µé¢åŠ è½½äº†è·¨åŸŸçš„ JS/CSS/ å›¾ç‰‡ï¼Œé»˜è®¤æƒ…å†µä¸‹ <code>performance</code> æ— æ³•è·å–è¿™äº›èµ„æºçš„è¯¦ç»†è€—æ—¶ï¼Œéœ€è¦åœ¨æœåŠ¡ç«¯é…ç½® <code>Timing-Allow-Origin</code> å“åº”å¤´ã€‚</p>
</li>
<li>
<p><strong>SPA åº”ç”¨çš„é€‚é…</strong>ï¼šå•é¡µåº”ç”¨çš„è·¯ç”±è·³è½¬ä¸ä¼šè§¦å‘ <code>navigationStart</code>ï¼Œéœ€è¦æ‰‹åŠ¨æ ‡è®°è·¯ç”±åˆ‡æ¢çš„å¼€å§‹æ—¶é—´ï¼Œç»“åˆ <code>performance.mark()</code> è‡ªå®šä¹‰ç»Ÿè®¡ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// SPA è·¯ç”±åˆ‡æ¢æ—¶æ ‡è®°å¼€å§‹æ—¶é—´</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">markRouteStart</span>(<span class="hljs-params">routeName</span>) {
  performance.<span class="hljs-title function_">mark</span>(<span class="hljs-string">`route_<span class="hljs-subst">${routeName}</span>_start`</span>);
}

<span class="hljs-comment">// è·¯ç”±æ¸²æŸ“å®Œæˆåè®¡ç®—è€—æ—¶</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">calculateRouteTime</span>(<span class="hljs-params">routeName</span>) {
  performance.<span class="hljs-title function_">mark</span>(<span class="hljs-string">`route_<span class="hljs-subst">${routeName}</span>_end`</span>);
  <span class="hljs-keyword">const</span> measure = performance.<span class="hljs-title function_">measure</span>(<span class="hljs-string">`route_<span class="hljs-subst">${routeName}</span>_duration`</span>, 
    <span class="hljs-string">`route_<span class="hljs-subst">${routeName}</span>_start`</span>, 
    <span class="hljs-string">`route_<span class="hljs-subst">${routeName}</span>_end`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${routeName}</span> è·¯ç”±æ¸²æŸ“è€—æ—¶ï¼š`</span>, measure.<span class="hljs-property">duration</span>);
}
</code></pre>
</li>
</ol>
<h2 data-id="heading-12">å…³äºDOM æ ‘æ„å»ºå®Œæˆçš„è€—æ—¶é—®é¢˜ï¼š</h2>
<p>DOM æ£€æµ‹å¯èƒ½å­˜åœ¨ <strong>â€œDOM å­˜åœ¨ä½†æ ·å¼å¼‚å¸¸å¯¼è‡´ä¸å¯è§â€</strong> çš„è¯¯åˆ¤ï¼ˆå¦‚ <code>z-index: -1</code>ã€èƒŒæ™¯è‰²ä¸å†…å®¹è‰²ä¸€è‡´ï¼‰ï¼Œå¤§å‚ä¼šåœ¨æ ¸å¿ƒé¡µé¢å¢åŠ  <strong>Canvas è§†è§‰æ£€æµ‹</strong> ä½œä¸ºå…œåº•ï¼š</p>
<ol>
<li>
<p>åœ¨é˜ˆå€¼æ—¶é—´åï¼Œç”¨ <code>html2canvas</code> å¯¹é¦–å±åŒºåŸŸæˆªå›¾ã€‚</p>
</li>
<li>
<p>è®¡ç®—æˆªå›¾çš„ <strong>åƒç´ ç°åº¦æ–¹å·®</strong>ï¼š</p>
<ul>
<li>ç™½å±æ—¶ï¼Œåƒç´ å€¼è¶‹äºä¸€è‡´ï¼Œæ–¹å·®è¶‹è¿‘äº 0ï¼›</li>
<li>éç™½å±æ—¶ï¼Œåƒç´ å€¼å·®å¼‚å¤§ï¼Œæ–¹å·®é«˜äºé˜ˆå€¼ï¼ˆå¦‚ 50ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>åŒé‡éªŒè¯</strong>ï¼šåªæœ‰ DOM æ£€æµ‹å’Œè§†è§‰æ£€æµ‹å‡åˆ¤å®šä¸º â€œç™½å±â€ï¼Œæ‰è®¡å…¥ç™½å±æ¬¡æ•°ã€‚</p>
</li>
</ol>
<h3 data-id="heading-13">æ€»ç»“</h3>
<ol>
<li><strong>ç™½å±æ—¶é—´è®¡ç®—</strong>ï¼šä¼˜å…ˆä½¿ç”¨ <code>first-contentful-paint (FCP)</code>ï¼Œé™çº§ä½¿ç”¨ <code>first-paint (FP)</code>ï¼Œæœ€ç»ˆå…œåº•ç”¨ <code>responseStart - navigationStart</code>ï¼Œæ›´è´´åˆç”¨æˆ·å®é™…æ„ŸçŸ¥ï¼›</li>
<li><strong>æ€§èƒ½ç»Ÿè®¡æ—¶æœº</strong>ï¼šå¿…é¡»åœ¨ <code>load</code> äº‹ä»¶è§¦å‘åæ‰§è¡Œï¼Œæˆ–åˆ¤æ–­ <code>document.readyState === 'complete'</code>ï¼Œå¦åˆ™æ•°æ®ä¸å®Œæ•´ï¼›</li>
<li><strong>å…¼å®¹æ€§å¤„ç†</strong>ï¼šå…¼é¡¾æ–°æ—§ Performance APIï¼ˆ<code>timing</code> å’Œ <code>getEntriesByType</code>ï¼‰ï¼Œå¹¶å¯¹å¼‚å¸¸å€¼åš <code>Math.max(0, ...)</code> è¿‡æ»¤ï¼Œé¿å…è´Ÿæ•°ã€‚</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C#ä¸­åŸºäºWord COMç»„ä»¶çš„æ•°å­¦å…¬å¼æ’ç‰ˆå®è·µ]]></title>    <link>https://juejin.cn/post/7598459769238667298</link>    <guid>https://juejin.cn/post/7598459769238667298</guid>    <pubDate>2026-01-24T07:05:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598459769238667298" data-draft-id="7598465042968100904" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C#ä¸­åŸºäºWord COMç»„ä»¶çš„æ•°å­¦å…¬å¼æ’ç‰ˆå®è·µ"/> <meta itemprop="keywords" content="åç«¯,C#,.NET"/> <meta itemprop="datePublished" content="2026-01-24T07:05:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="mudtools"/> <meta itemprop="url" content="https://juejin.cn/user/2112621078650964"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C#ä¸­åŸºäºWord COMç»„ä»¶çš„æ•°å­¦å…¬å¼æ’ç‰ˆå®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2112621078650964/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    mudtools
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T07:05:54.000Z" title="Sat Jan 24 2026 07:05:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¼•è¨€</h2>
<h3 data-id="heading-1">èƒŒæ™¯ä¸éœ€æ±‚</h3>
<p>åœ¨ç§‘æŠ€æ–‡æ¡£å¼€å‘ã€å­¦æœ¯è®ºæ–‡æ’°å†™å’Œå·¥ç¨‹è®¡ç®—æ–‡æ¡£ç”Ÿæˆè¿‡ç¨‹ä¸­ï¼Œæ•°å­¦å…¬å¼çš„è‡ªåŠ¨åŒ–æ’ç‰ˆä¸€ç›´æ˜¯ä¸€ä¸ªå…·æœ‰æŒ‘æˆ˜æ€§çš„æŠ€æœ¯éš¾é¢˜ã€‚ä¼ ç»Ÿçš„æ‰‹å·¥æ’ç‰ˆæ–¹å¼ä¸ä»…æ•ˆç‡ä½ä¸‹ï¼Œè€Œä¸”éš¾ä»¥ä¿è¯æ ¼å¼çš„ä¸€è‡´æ€§å’Œä¸“ä¸šæ€§ã€‚Word COMç»„ä»¶ä½œä¸ºMicrosoft Officeçš„æ ¸å¿ƒæŠ€æœ¯ï¼Œä¸ºå¼€å‘è€…æä¾›äº†å¼ºå¤§çš„å…¬å¼å¤„ç†èƒ½åŠ›ï¼Œç‰¹åˆ«æ˜¯åœ¨æ•°å­¦å…¬å¼çš„ç»“æ„åŒ–æ’ç‰ˆæ–¹é¢å…·æœ‰ç‹¬ç‰¹ä¼˜åŠ¿ã€‚</p>
<h3 data-id="heading-2">å¼€å‘ç¯å¢ƒä¸å·¥å…·</h3>
<p>æœ¬æ–‡åŸºäº <strong>MudTools.OfficeInterop.Word</strong> é¡¹ç›®ï¼Œè¯¥é¡¹ç›®æä¾›äº†å®Œæ•´çš„Word COMç»„ä»¶.NETå°è£…ï¼Œè®©å¼€å‘è€…èƒ½å¤Ÿä½¿ç”¨C#è¯­è¨€é«˜æ•ˆåœ°æ“ä½œWordæ–‡æ¡£ä¸­çš„æ•°å­¦å…¬å¼ã€‚æ ¸å¿ƒå¼€å‘ç¯å¢ƒåŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>C# (.NET Framework/.NET Core)</strong> - ä¸»è¦ç¼–ç¨‹è¯­è¨€</li>
<li><strong>Microsoft Office Interop Library</strong> - åº•å±‚COMäº¤äº’æ”¯æŒ</li>
<li><strong>MudTools.OfficeInterop.Word</strong> - å°è£…çš„Wordå¯¹è±¡æ¨¡å‹ (æºç ä»“åº“ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fmudtools%2FOfficeInterop" target="_blank" title="https://gitee.com/mudtools/OfficeInterop" ref="nofollow noopener noreferrer">Gitee</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmudtools%2FOfficeInterop" target="_blank" title="https://github.com/mudtools/OfficeInterop" ref="nofollow noopener noreferrer">Github</a>)</li>
<li><strong>Wordå¯¹è±¡æ¨¡å‹</strong> - æä¾›å±‚æ¬¡åŒ–çš„æ–‡æ¡£å’Œå…¬å¼æ“ä½œæ¥å£</li>
</ul>
<h2 data-id="heading-3">Word COMå¯¹è±¡æ¨¡å‹ä¸­çš„å…¬å¼ç›¸å…³å¯¹è±¡</h2>
<h3 data-id="heading-4">æ ¸å¿ƒå¯¹è±¡å±‚æ¬¡ç»“æ„</h3>
<p>Word COMå¯¹è±¡æ¨¡å‹é‡‡ç”¨å±‚æ¬¡åŒ–è®¾è®¡ï¼Œæ•°å­¦å…¬å¼ç›¸å…³çš„å¯¹è±¡æ„æˆäº†å®Œæ•´çš„æ“ä½œä½“ç³»ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp">IWordApplication application = <span class="hljs-keyword">new</span> WordApplication();        <span class="hljs-comment">// Wordåº”ç”¨ç¨‹åºå®ä¾‹</span>
IWordDocument document = application.Documents.Add();         <span class="hljs-comment">// æ–‡æ¡£å¯¹è±¡</span>
IWordRange range = document.Content;                         <span class="hljs-comment">// æ–‡æœ¬æ“ä½œèŒƒå›´</span>
IWordOMaths oMaths = range.OMaths;                           <span class="hljs-comment">// æ•°å­¦å…¬å¼é›†åˆ</span>
IWordOMath oMath = oMaths.Add(range);                        <span class="hljs-comment">// å•ä¸ªæ•°å­¦å…¬å¼</span>
</code></pre>
<p>æ¯ä¸ªå¯¹è±¡éƒ½æœ‰æ˜ç¡®çš„èŒè´£åˆ†å·¥ï¼š</p>
<ul>
<li><strong>IWordApplication</strong>ï¼šWordåº”ç”¨ç¨‹åºçš„é¡¶çº§æ§åˆ¶æ¥å£ï¼Œç®¡ç†æ–‡æ¡£ç”Ÿå‘½å‘¨æœŸ</li>
<li><strong>IWordDocument</strong>ï¼šæ–‡æ¡£å¯¹è±¡ï¼Œé€šè¿‡<code>IWordDocuments</code>é›†åˆç®¡ç†å¤šä¸ªæ–‡æ¡£</li>
<li><strong>IWordRange</strong> å’Œ <strong>IWordSelection</strong>ï¼šæä¾›æ–‡æœ¬èŒƒå›´çš„ç²¾ç¡®å®šä½å’Œæ“ä½œèƒ½åŠ›</li>
<li><strong>IWordOMath</strong>ã€<strong>IWordOMathPara</strong>ã€<strong>IWordOMathRange</strong>ï¼šä¸“é—¨ç”¨äºæ•°å­¦å…¬å¼æ“ä½œçš„å¯¹è±¡æ¨¡å‹</li>
</ul>
<h4 data-id="heading-5">Word COMå¯¹è±¡å±‚æ¬¡ç»“æ„å›¾</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[IWordApplication] --&gt; B[IWordDocuments]
    B --&gt; C[IWordDocument]
    C --&gt; D[IWordRange]
    C --&gt; E[IWordSelection]
    C --&gt; F[IWordContent]
    D --&gt; G[IWordOMaths]
    E --&gt; G
    F --&gt; G
    G --&gt; H[IWordOMath]
    H --&gt; I[IWordOMathFunctions]
    I --&gt; J[IWordOMathFunction]
    J --&gt; K[IWordOMathFrac]
    J --&gt; L[IWordOMathMat]
    J --&gt; M[IWordOMathNary]
    J --&gt; N[IWordOMathRad]
    J --&gt; O[IWordOMathScrSubSup]
    J --&gt; P[...å…¶ä»–22ç§å‡½æ•°ç±»å‹]
    
    style A fill:#e1f5fe
    style C fill:#f3e5f5
    style G fill:#e8f5e8
    style H fill:#fff3e0
</code></pre>
<h4 data-id="heading-6">æ ¸å¿ƒç»„ä»¶å…³ç³»è¯¦è§£</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">classDiagram
    class IWordApplication {
        +Documents: IWordDocuments
        +Quit()
        +Visible: bool
    }
    
    class IWordDocuments {
        +Add(): IWordDocument
        +Open(string): IWordDocument
        +Count: int
    }
    
    class IWordDocument {
        +Content: IWordRange
        +OMaths: IWordOMaths
        +SaveAs(string)
        +Close()
    }
    
    class IWordRange {
        +Text: string
        +OMaths: IWordOMaths
        +Font: IWordFont
        +ParagraphFormat: IWordParagraphFormat
    }
    
    class IWordOMaths {
        +Add(IWordRange): IWordRange
        +Count: int
        +Item(int): IWordOMath
        +BuildUp()
        +Linearize()
    }
    
    class IWordOMath {
        +Range: IWordRange
        +Functions: IWordOMathFunctions
        +Type: WdOMathType
        +Justification: WdOMathJc
        +BuildUp()
        +Remove()
    }
    
    class IWordOMathFunctions {
        +Add(IWordRange, WdOMathFunctionType): IWordOMathFunction
        +Count: int
        +Item(int): IWordOMathFunction
    }
    
    class IWordOMathFunction {
        +Frac: IWordOMathFrac
        +Mat: IWordOMathMat
        +Nary: IWordOMathNary
        +Rad: IWordOMathRad
        +ScrSubSup: IWordOMathScrSubSup
    }
    
    IWordApplication --&gt; IWordDocuments
    IWordDocuments --&gt; IWordDocument
    IWordDocument --&gt; IWordRange
    IWordDocument --&gt; IWordOMaths
    IWordRange --&gt; IWordOMaths
    IWordOMaths --&gt; IWordOMath
    IWordOMath --&gt; IWordOMathFunctions
    IWordOMathFunctions --&gt; IWordOMathFunction
</code></pre>
<h3 data-id="heading-7">æ•°å­¦å…¬å¼ç›¸å…³æ¥å£</h3>
<p>MudTools.OfficeInterop.Wordé¡¹ç›®æä¾›äº†å®Œæ•´çš„æ•°å­¦å…¬å¼æ¥å£ä½“ç³»ï¼š</p>






























<table><thead><tr><th>æ¥å£</th><th>åŠŸèƒ½æè¿°</th><th>æ ¸å¿ƒç‰¹æ€§</th></tr></thead><tbody><tr><td><strong>IWordOMath</strong></td><td>æ•°å­¦å¯¹è±¡çš„æ ¸å¿ƒæ¥å£</td><td>å…¬å¼æ„å»ºã€æ ¼å¼è½¬æ¢ã€å¯¹é½æ§åˆ¶</td></tr><tr><td><strong>IWordOMathFunction</strong></td><td>æ•°å­¦å‡½æ•°æ¥å£</td><td>åŒ…å«22ç§æ•°å­¦å‡½æ•°ç±»å‹çš„ç»Ÿä¸€è®¿é—®</td></tr><tr><td><strong>IWordOMathMatrix</strong></td><td>çŸ©é˜µæ’ç‰ˆæ”¯æŒ</td><td>å•å…ƒæ ¼æ“ä½œã€è¡Œåˆ—é—´è·ã€å¯¹é½æ–¹å¼</td></tr><tr><td><strong>IWordOMathSupSub</strong></td><td>ä¸Šä¸‹æ ‡æ§åˆ¶</td><td>ä¸Šæ ‡ã€ä¸‹æ ‡ã€ä¸Šä¸‹æ ‡ç»„åˆ</td></tr></tbody></table>
<p>è¿™äº›æ¥å£æ„æˆäº†å®Œæ•´çš„æ•°å­¦å…¬å¼æ“ä½œä½“ç³»ï¼Œæ”¯æŒä»ç®€å•çš„åˆ†æ•°è¿ç®—åˆ°å¤æ‚çš„çŸ©é˜µå˜æ¢ã€‚</p>
<h4 data-id="heading-8">æ•°å­¦å…¬å¼å‡½æ•°ç±»å‹å…³ç³»å›¾</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[IWordOMathFunction] --&gt; B[åŸºç¡€æ•°å­¦ç»“æ„]
    A --&gt; C[è„šæœ¬ç³»ç»Ÿ]
    A --&gt; D[ä¿®é¥°ç¬¦å·]
    A --&gt; E[ç‰¹æ®ŠåŠŸèƒ½]
    
    B --&gt; B1[IWordOMathFrac - åˆ†æ•°]
    B --&gt; B2[IWordOMathRad - æ ¹å¼]
    B --&gt; B3[IWordOMat - çŸ©é˜µ]
    B --&gt; B4[IWordOMathDelim - åˆ†éš”ç¬¦]
    
    C --&gt; C1[IWordOMathScrSub - ä¸‹æ ‡]
    C --&gt; C2[IWordOMathScrSup - ä¸Šæ ‡]
    C --&gt; C3[IWordOMathScrSubSup - ä¸Šä¸‹æ ‡]
    C --&gt; C4[IWordOMathScrPre - å‰ç½®è„šæœ¬]
    
    D --&gt; D1[IWordOMathAcc - é‡éŸ³ç¬¦å·]
    D --&gt; D2[IWordOMathBar - ä¸Š/ä¸‹åˆ’çº¿]
    D --&gt; D3[IWordOMathGroupChar - åˆ†ç»„å­—ç¬¦]
    
    E --&gt; E1[IWordOMathNary - nå…ƒè¿ç®—ç¬¦]
    E --&gt; E2[IWordOMathLimLow/LimUpp - æé™]
    E --&gt; E3[IWordOMathPhantom - å¹»å½±å¯¹è±¡]
    E --&gt; E4[IWordOMathEqArray - ç­‰å¼æ•°ç»„]
    
    style A fill:#ffecb3
    style B fill:#c8e6c9
    style C fill:#bbdefb
    style D fill:#f8bbd0
    style E fill:#d1c4e9
</code></pre>
<h4 data-id="heading-9">çŸ©é˜µå¯¹è±¡è¯¦ç»†ç»“æ„å›¾</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">classDiagram
    class IWordOMathMat {
        +Rows: IWordOMathMatRows
        +Cols: IWordOMathMatCols
        +Cell(int, int): IWordOMath
        +Align: WdOMathVertAlignType
        +RowSpacing: int
        +ColSpacing: int
    }
    
    class IWordOMathMatRows {
        +Add(): IWordOMathMatRow
        +Count: int
        +Item(int): IWordOMathMatRow
    }
    
    class IWordOMathMatCols {
        +Add(): IWordOMathMatCol
        +Count: int
        +Item(int): IWordOMathMatCol
    }
    
    class IWordOMathMatRow {
        +Cells: IWordOMathMatCells
        +Height: int
    }
    
    class IWordOMathMatCol {
        +Cells: IWordOMathMatCells
        +Width: int
    }
    
    IWordOMathMat --&gt; IWordOMathMatRows
    IWordOMathMat --&gt; IWordOMathMatCols
    IWordOMathMatRows --&gt; IWordOMathMatRow
    IWordOMathMatCols --&gt; IWordOMathMatCol
    IWordOMathMat --&gt; IWordOMath : "Cell(row, col)"
</code></pre>
<h2 data-id="heading-10">åŸºç¡€æ•°å­¦å…¬å¼æ’ç‰ˆåŠŸèƒ½å®ç°</h2>
<h3 data-id="heading-11">å…¬å¼æ’å…¥ä¸åŸºç¡€æ“ä½œ</h3>
<p>é€šè¿‡MudTools.OfficeInterop.Wordï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°åˆ›å»ºå’Œæ’å…¥æ•°å­¦å…¬å¼ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// åˆ›å»ºWordåº”ç”¨ç¨‹åºå’Œæ–‡æ¡£</span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">var</span> application = <span class="hljs-keyword">new</span> WordApplication();
IWordDocument document = application.Documents.Add();
IWordRange range = document.Content;

<span class="hljs-comment">// æ’å…¥æ•°å­¦å…¬å¼</span>
IWordOMaths oMaths = range.OMaths;
IWordRange formulaRange = oMaths.Add(range);

<span class="hljs-comment">// è®¾ç½®å…¬å¼å†…å®¹</span>
IWordOMath oMath = formulaRange.OMaths[<span class="hljs-number">0</span>];
oMath.Range.Text = <span class="hljs-string">"x^2 + y^2 = z^2"</span>;

<span class="hljs-comment">// æ„å»ºä¸“ä¸šæ ¼å¼æ˜¾ç¤º</span>
oMath.BuildUp();
</code></pre>
<p><strong>æ ¸å¿ƒæ“ä½œæ–¹æ³•è¯´æ˜ï¼š</strong></p>
<ul>
<li><code>oMaths.Add(range)</code> - åœ¨æŒ‡å®šèŒƒå›´æ·»åŠ æ–°çš„æ•°å­¦å…¬å¼</li>
<li><code>oMath.BuildUp()</code> - å°†çº¿æ€§æ ¼å¼è½¬æ¢ä¸ºä¸“ä¸šæ˜¾ç¤ºæ ¼å¼</li>
<li><code>oMath.Linearize()</code> - å°†ä¸“ä¸šæ ¼å¼è½¬æ¢ä¸ºçº¿æ€§æ ¼å¼</li>
<li><code>oMath.Type = WdOMathType.wdOMathDisplay</code> - è®¾ç½®ä¸ºç‹¬ç«‹è¡Œæ˜¾ç¤º</li>
</ul>
<h3 data-id="heading-12">å¸¸è§å…¬å¼å…ƒç´ æ“ä½œ</h3>
<h4 data-id="heading-13">åˆ†æ•°æ“ä½œï¼ˆIWordOMathFracï¼‰</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// åˆ›å»ºåˆ†æ•°</span>
<span class="hljs-keyword">var</span> fractionFunction = oMath.Functions.Add(range, WdOMathFunctionType.wdOMathFunctionFrac);
<span class="hljs-keyword">var</span> fraction = fractionFunction.Frac;

<span class="hljs-comment">// è®¾ç½®åˆ†å­å’Œåˆ†æ¯</span>
fraction.Num.Range.Text = <span class="hljs-string">"a^2 + b^2"</span>;
fraction.Den.Range.Text = <span class="hljs-string">"c^2"</span>;

<span class="hljs-comment">// è®¾ç½®åˆ†æ•°ç±»å‹</span>
fraction.Type = WdOMathFracType.wdOMathFracBar;  <span class="hljs-comment">// å¸¸è§„åˆ†æ•°çº¿</span>
<span class="hljs-comment">// fraction.Type = WdOMathFracType.wdOMathFracSkw;  // æ–œåˆ†æ•°çº¿</span>
</code></pre>
<h4 data-id="heading-14">ç§¯åˆ†ä¸æ±‚å’Œç¬¦å·ï¼ˆIWordOMathNaryï¼‰</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// åˆ›å»ºç§¯åˆ†ç¬¦å·</span>
<span class="hljs-keyword">var</span> naryFunction = oMath.Functions.Add(range, WdOMathFunctionType.wdOMathFunctionNary);
<span class="hljs-keyword">var</span> nary = naryFunction.Nary;

<span class="hljs-comment">// è®¾ç½®ç§¯åˆ†è¡¨è¾¾å¼</span>
nary.E.Range.Text = <span class="hljs-string">"f(x)dx"</span>;
nary.Sub.Range.Text = <span class="hljs-string">"0"</span>;
nary.Sub.Range.Text = <span class="hljs-string">"âˆ"</span>;

<span class="hljs-comment">// è®¾ç½®è¿ç®—ç¬¦ç±»å‹</span>
nary.Char = <span class="hljs-string">"âˆ«"</span>;  <span class="hljs-comment">// ç§¯åˆ†ç¬¦å·</span>
<span class="hljs-comment">// nary.Char = "âˆ‘";  // æ±‚å’Œç¬¦å·</span>
</code></pre>
<h2 data-id="heading-15">é«˜çº§æ•°å­¦å…¬å¼æ’ç‰ˆåŠŸèƒ½</h2>
<h3 data-id="heading-16">å¤æ‚å…¬å¼ç»“æ„</h3>
<h4 data-id="heading-17">çŸ©é˜µæ’ç‰ˆï¼ˆIWordOMathMatrixï¼‰</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// åˆ›å»ºçŸ©é˜µ</span>
<span class="hljs-keyword">var</span> matrixFunction = oMath.Functions.Add(range, WdOMathFunctionType.wdOMathFunctionMat);
<span class="hljs-keyword">var</span> matrix = matrixFunction.Mat;

<span class="hljs-comment">// æ·»åŠ è¡Œå’Œåˆ—</span>
<span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> row = <span class="hljs-number">0</span>; row &lt; <span class="hljs-number">3</span>; row++)
{
    matrix.Rows.Add(<span class="hljs-literal">null</span>);
}
<span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> col = <span class="hljs-number">0</span>; col &lt; <span class="hljs-number">3</span>; col++)
{
    matrix.Cols.Add(<span class="hljs-literal">null</span>);
}

<span class="hljs-comment">// è®¾ç½®çŸ©é˜µå…ƒç´ </span>
matrix.Cell(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>).Range.Text = <span class="hljs-string">"a"</span>;
matrix.Cell(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>).Range.Text = <span class="hljs-string">"b"</span>;
matrix.Cell(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>).Range.Text = <span class="hljs-string">"c"</span>;
matrix.Cell(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>).Range.Text = <span class="hljs-string">"d"</span>;
matrix.Cell(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>).Range.Text = <span class="hljs-string">"e"</span>;
matrix.Cell(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>).Range.Text = <span class="hljs-string">"f"</span>;
matrix.Cell(<span class="hljs-number">3</span>, <span class="hljs-number">1</span>).Range.Text = <span class="hljs-string">"g"</span>;
matrix.Cell(<span class="hljs-number">3</span>, <span class="hljs-number">2</span>).Range.Text = <span class="hljs-string">"h"</span>;
matrix.Cell(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>).Range.Text = <span class="hljs-string">"i"</span>;

<span class="hljs-comment">// è®¾ç½®çŸ©é˜µæ ¼å¼</span>
matrix.Align = WdOMathVertAlignType.wdOMathVertAlignCenter;
matrix.RowSpacing = <span class="hljs-number">20</span>;
matrix.ColSpacing = <span class="hljs-number">15</span>;
</code></pre>
<h4 data-id="heading-18">å¤šè¡Œæ–¹ç¨‹ç»„ï¼ˆIWordOMathEqArrayï¼‰</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// åˆ›å»ºæ–¹ç¨‹ç»„æ•°ç»„</span>
<span class="hljs-keyword">var</span> eqArrayFunction = oMath.Functions.Add(range, WdOMathFunctionType.wdOMathFunctionEqArray);
<span class="hljs-keyword">var</span> eqArray = eqArrayFunction.EqArray;

<span class="hljs-comment">// æ·»åŠ å¤šè¡Œæ–¹ç¨‹</span>
eqArray.Add(<span class="hljs-string">"x + y = 5"</span>);
eqArray.Add(<span class="hljs-string">"x - y = 1"</span>);

<span class="hljs-comment">// è®¾ç½®å¯¹é½æ–¹å¼</span>
eqArray.Align = WdOMathEqArrayAlign.wdOMathEqArrayAlignAlignAt;
eqArray.RowSpacing = <span class="hljs-number">10</span>;
</code></pre>
<h3 data-id="heading-19">å…¬å¼ç¼–å·ä¸å¼•ç”¨</h3>
<p>å®ç°å…¬å¼çš„è‡ªåŠ¨ç¼–å·å’Œäº¤å‰å¼•ç”¨ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// å…¬å¼ç¼–å·å®ç°</span>
<span class="hljs-built_in">int</span> equationNumber = <span class="hljs-number">1</span>;
<span class="hljs-keyword">foreach</span> (IWordOMath oMath <span class="hljs-keyword">in</span> document.OMaths)
{
    <span class="hljs-comment">// å±…ä¸­å¯¹é½å…¬å¼</span>
    oMath.Range.ParagraphFormat.Alignment = WdAlignment.wdAlignParagraphCenter;
    
    <span class="hljs-comment">// åœ¨å…¬å¼åæ·»åŠ ç¼–å·</span>
    IWordRange endRange = oMath.Range.Duplicate;
    endRange.Collapse(WdCollapseDirection.wdCollapseEnd);
    endRange.Text = <span class="hljs-string">$"    (<span class="hljs-subst">{equationNumber}</span>)"</span>;
    
    <span class="hljs-comment">// æ·»åŠ ä¹¦ç­¾ç”¨äºå¼•ç”¨</span>
    <span class="hljs-built_in">string</span> bookmarkName = <span class="hljs-string">$"Equation_<span class="hljs-subst">{equationNumber}</span>"</span>;
    document.Bookmarks.Add(bookmarkName, oMath.Range);
    
    equationNumber++;
}
</code></pre>
<h3 data-id="heading-20">æ ·å¼ç»§æ‰¿ä¸åµŒå¥—å…¬å¼</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// åˆ›å»ºåµŒå¥—å…¬å¼ç»“æ„</span>
<span class="hljs-keyword">var</span> outerFraction = oMath.Functions.Add(range, WdOMathFunctionType.wdOMathFunctionFrac).Frac;

<span class="hljs-comment">// åœ¨åˆ†å­ä¸­åˆ›å»ºåµŒå¥—çš„å¹³æ–¹æ ¹</span>
<span class="hljs-keyword">var</span> innerRadical = outerFraction.Num.Functions.Add(outerFraction.Num.Range, 
    WdOMathFunctionType.wdOMathFunctionRad).Rad;
innerRadical.E.Range.Text = <span class="hljs-string">"x^2 + y^2"</span>;

<span class="hljs-comment">// è®¾ç½®åˆ†æ¯</span>
outerFraction.Den.Range.Text = <span class="hljs-string">"2"</span>;
</code></pre>
<h3 data-id="heading-21">å…¬å¼æ ·å¼ä¸æ ¼å¼æ§åˆ¶</h3>
<h3 data-id="heading-22">å­—ä½“ä¸å¤§å°è°ƒæ•´</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// è®¾ç½®å…¬å¼å­—ä½“å’Œå¤§å°</span>
oMath.Range.Font.Name = <span class="hljs-string">"Times New Roman"</span>;
oMath.Range.Font.Size = <span class="hljs-number">14</span>;
oMath.Range.Font.Bold = <span class="hljs-number">0</span>;  <span class="hljs-comment">// æ­£å¸¸å­—é‡</span>

<span class="hljs-comment">// è®¾ç½®ç‰¹æ®Šå…ƒç´ çš„å­—ä½“æ ·å¼</span>
<span class="hljs-keyword">if</span> (oMath.Functions.Count &gt; <span class="hljs-number">0</span>)
{
    <span class="hljs-keyword">var</span> function = oMath.Functions[<span class="hljs-number">1</span>];
    <span class="hljs-keyword">if</span> (function.Frac != <span class="hljs-literal">null</span>)
    {
        <span class="hljs-comment">// åˆ†æ•°çº¿ç‰¹æ®Šå¤„ç†</span>
        function.Frac.Num.Range.Font.Color = WdColor.wdColorBlue;
        function.Frac.Den.Range.Font.Color = WdColor.wdColorRed;
    }
}
</code></pre>
<h3 data-id="heading-23">å¯¹é½ä¸å¸ƒå±€ä¼˜åŒ–</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// å±…ä¸­å¯¹é½å…¬å¼</span>
oMath.Range.ParagraphFormat.Alignment = WdAlignment.wdAlignParagraphCenter;

<span class="hljs-comment">// è®¾ç½®åˆ¶è¡¨ä½ï¼Œæ§åˆ¶å…¬å¼ä¸ç¼–å·é—´è·</span>
oMath.Range.ParagraphFormat.TabStops.Add(<span class="hljs-number">200</span>, WdTabAlignment.wdAlignTabCenter);

<span class="hljs-comment">// å…¬å¼å†…å…ƒç´ å¯¹é½</span>
oMath.Justification = WdOMathJc.wdOMathJcCenter;
oMath.AlignPoint = <span class="hljs-number">100</span>;  <span class="hljs-comment">// å¯¹é½ç‚¹ä½ç½®</span>
</code></pre>
<h3 data-id="heading-24">é¢œè‰²ä¸é«˜äº®</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// å…¬å¼å…ƒç´ é«˜äº®</span>
oMath.Range.Shading.BackgroundPatternColor = WdColor.wdColorLightYellow;

<span class="hljs-comment">// é”™è¯¯å…¬å¼æ ‡è®°</span>
<span class="hljs-keyword">if</span> (!IsValidEquation(oMath))
{
    oMath.Range.Font.Color = WdColor.wdColorRed;
    oMath.Range.Font.Italic = <span class="hljs-number">1</span>;
}

<span class="hljs-comment">// ç‰¹æ®Šç¬¦å·é¢œè‰²æ ‡è®°</span>
<span class="hljs-keyword">var</span> naryFunctions = oMath.Functions.Cast&lt;IWordOMathFunction&gt;()
    .Where(f =&gt; f.Nary != <span class="hljs-literal">null</span>);
<span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> func <span class="hljs-keyword">in</span> naryFunctions)
{
    func.Nary.Char.Range.Font.Color = WdColor.wdColorDarkBlue;
}
</code></pre>
<h2 data-id="heading-25">å®é™…åº”ç”¨æ¡ˆä¾‹ï¼šç§‘æŠ€è®ºæ–‡å…¬å¼è‡ªåŠ¨åŒ–æ’ç‰ˆ</h2>
<h3 data-id="heading-26">éœ€æ±‚åˆ†æ</h3>
<p>å‡è®¾æˆ‘ä»¬éœ€è¦ä¸ºå­¦æœ¯è®ºæ–‡å¼€å‘ä¸€ä¸ªå…¬å¼è‡ªåŠ¨åŒ–æ’ç‰ˆå·¥å…·ï¼Œä¸»è¦éœ€æ±‚åŒ…æ‹¬ï¼š</p>
<ul>
<li>æ‰¹é‡æ’å…¥é¢„å®šä¹‰çš„æ•°å­¦å…¬å¼</li>
<li>è‡ªåŠ¨æ·»åŠ å…¬å¼ç¼–å·å’Œäº¤å‰å¼•ç”¨</li>
<li>ç»Ÿä¸€è°ƒæ•´å…¬å¼æ ·å¼ä»¥ç¬¦åˆæœŸåˆŠè¦æ±‚</li>
<li>æ”¯æŒLaTeXæ ¼å¼å…¬å¼çš„è½¬æ¢</li>
</ul>
<h4 data-id="heading-27">ç³»ç»Ÿæ¶æ„è®¾è®¡å›¾</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph "è¾“å…¥å±‚"
        A1[LaTeXå…¬å¼æ–‡ä»¶]
        A2[Wordæ¨¡æ¿æ–‡æ¡£]
        A3[æœŸåˆŠæ ·å¼é…ç½®]
    end
    
    subgraph "å¤„ç†å±‚"
        B1[LaTeXè§£æå™¨]
        B2[å…¬å¼è½¬æ¢å¼•æ“]
        B3[æ ·å¼ç®¡ç†å™¨]
        B4[ç¼–å·ç”Ÿæˆå™¨]
    end
    
    subgraph "Word COMäº¤äº’å±‚"
        C1[IWordApplication]
        C2[IWordDocument]
        C3[IWordOMath]
        C4[IWordStyle]
    end
    
    subgraph "è¾“å‡ºå±‚"
        D1[æ ¼å¼åŒ–Wordæ–‡æ¡£]
        D2[å…¬å¼ç¼–å·]
        D3[äº¤å‰å¼•ç”¨]
    end
    
    A1 --&gt; B1
    A2 --&gt; C2
    A3 --&gt; B3
    
    B1 --&gt; B2
    B2 --&gt; C3
    B3 --&gt; C4
    B4 --&gt; D2
    
    C1 --&gt; C2
    C2 --&gt; C3
    C2 --&gt; C4
    
    C3 --&gt; D1
    C4 --&gt; D1
    D2 --&gt; D3
    
    style B1 fill:#e1f5fe
    style B2 fill:#fff3e0
    style B3 fill:#e8f5e8
    style B4 fill:#fce4ec
</code></pre>
<p>å‡è®¾æˆ‘ä»¬éœ€è¦ä¸ºå­¦æœ¯è®ºæ–‡å¼€å‘ä¸€ä¸ªå…¬å¼è‡ªåŠ¨åŒ–æ’ç‰ˆå·¥å…·ï¼Œä¸»è¦éœ€æ±‚åŒ…æ‹¬ï¼š</p>
<ul>
<li>æ‰¹é‡æ’å…¥é¢„å®šä¹‰çš„æ•°å­¦å…¬å¼</li>
<li>è‡ªåŠ¨æ·»åŠ å…¬å¼ç¼–å·å’Œäº¤å‰å¼•ç”¨</li>
<li>ç»Ÿä¸€è°ƒæ•´å…¬å¼æ ·å¼ä»¥ç¬¦åˆæœŸåˆŠè¦æ±‚</li>
<li>æ”¯æŒLaTeXæ ¼å¼å…¬å¼çš„è½¬æ¢</li>
</ul>
<h3 data-id="heading-28">å®ç°æ­¥éª¤</h3>
<h4 data-id="heading-29">ç¬¬ä¸€æ­¥ï¼šLaTeXå…¬å¼è§£æä¸è½¬æ¢</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">LaTeXToWordConverter</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> IWordOMath <span class="hljs-title">ConvertLaTeXToWordFormula</span>(<span class="hljs-params">IWordRange range, <span class="hljs-built_in">string</span> latexFormula</span>)</span>
    {
        <span class="hljs-comment">// è§£æLaTeXå…¬å¼</span>
        <span class="hljs-keyword">var</span> parsedFormula = ParseLaTeX(latexFormula);
        
        <span class="hljs-comment">// åˆ›å»ºWordå…¬å¼</span>
        IWordOMaths oMaths = range.OMaths;
        IWordRange formulaRange = oMaths.Add(range);
        IWordOMath oMath = formulaRange.OMaths[<span class="hljs-number">0</span>];
        
        <span class="hljs-comment">// é€’å½’æ„å»ºå…¬å¼ç»“æ„</span>
        BuildFormulaStructure(oMath, parsedFormula);
        
        <span class="hljs-keyword">return</span> oMath;
    }
    
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">BuildFormulaStructure</span>(<span class="hljs-params">IWordOMath oMath, LaTeXElement element</span>)</span>
    {
        <span class="hljs-keyword">switch</span> (element.Type)
        {
            <span class="hljs-keyword">case</span> LaTeXType.Fraction:
                CreateFraction(oMath, element);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> LaTeXType.Matrix:
                CreateMatrix(oMath, element);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> LaTeXType.Integral:
                CreateIntegral(oMath, element);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-comment">// å…¶ä»–ç±»å‹å¤„ç†...</span>
        }
    }
}
</code></pre>
<h4 data-id="heading-30">ç¬¬äºŒæ­¥ï¼šæ‰¹é‡å…¬å¼å¤„ç†</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">EquationProcessor</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> LaTeXToWordConverter _converter;
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> _equationCounter = <span class="hljs-number">0</span>;
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ProcessEquations</span>(<span class="hljs-params">IWordDocument document, List&lt;<span class="hljs-built_in">string</span>&gt; latexEquations</span>)</span>
    {
        <span class="hljs-comment">// åˆ›å»ºå…¬å¼æ ·å¼</span>
        IWordStyle equationStyle = CreateEquationStyle(document);
        
        <span class="hljs-keyword">foreach</span> (<span class="hljs-built_in">string</span> latexEquation <span class="hljs-keyword">in</span> latexEquations)
        {
            <span class="hljs-comment">// æ’å…¥æ–°æ®µè½</span>
            IWordRange insertRange = document.Range(document.Content.End - <span class="hljs-number">1</span>, document.Content.End);
            insertRange.InsertParagraphAfter();
            insertRange.Collapse(WdCollapseDirection.wdCollapseEnd);
            
            <span class="hljs-comment">// è½¬æ¢å¹¶æ’å…¥å…¬å¼</span>
            IWordOMath oMath = _converter.ConvertLaTeXToWordFormula(insertRange, latexEquation);
            
            <span class="hljs-comment">// åº”ç”¨æ ·å¼å’Œç¼–å·</span>
            ApplyEquationFormatting(oMath, equationStyle);
            AddEquationNumber(oMath, ++_equationCounter);
        }
    }
    
    <span class="hljs-function"><span class="hljs-keyword">private</span> IWordStyle <span class="hljs-title">CreateEquationStyle</span>(<span class="hljs-params">IWordDocument document</span>)</span>
    {
        IWordStyle equationStyle = document.Styles.Add(<span class="hljs-string">"Equation"</span>, WdStyleType.wdStyleTypeParagraph);
        equationStyle.ParagraphFormat.Alignment = WdAlignment.wdAlignParagraphCenter;
        equationStyle.ParagraphFormat.SpaceAfter = <span class="hljs-number">12</span>;
        equationStyle.Font.Name = <span class="hljs-string">"Times New Roman"</span>;
        equationStyle.Font.Size = <span class="hljs-number">12</span>;
        <span class="hljs-keyword">return</span> equationStyle;
    }
    
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ApplyEquationFormatting</span>(<span class="hljs-params">IWordOMath oMath, IWordStyle style</span>)</span>
    {
        <span class="hljs-comment">// åº”ç”¨æ®µè½æ ·å¼</span>
        oMath.Range.set_Style(style);
        
        <span class="hljs-comment">// è®¾ç½®å…¬å¼ç±»å‹ä¸ºä¸“ä¸šæ˜¾ç¤ºæ ¼å¼</span>
        oMath.Type = WdOMathType.wdOMathDisplay;
        oMath.Justification = WdOMathJc.wdOMathJcCenter;
        
        <span class="hljs-comment">// æ„å»ºä¸“ä¸šæ ¼å¼</span>
        oMath.BuildUp();
    }
    
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">AddEquationNumber</span>(<span class="hljs-params">IWordOMath oMath, <span class="hljs-built_in">int</span> number</span>)</span>
    {
        <span class="hljs-comment">// åœ¨å…¬å¼åæ·»åŠ ç¼–å·</span>
        IWordRange endRange = oMath.Range.Duplicate;
        endRange.Collapse(WdCollapseDirection.wdCollapseEnd);
        endRange.Text = <span class="hljs-string">$"    (<span class="hljs-subst">{number}</span>)"</span>;
        
        <span class="hljs-comment">// åˆ›å»ºä¹¦ç­¾</span>
        <span class="hljs-built_in">string</span> bookmarkName = <span class="hljs-string">$"EQ_<span class="hljs-subst">{number}</span>"</span>;
        oMath.Range.Document.Bookmarks.Add(bookmarkName, oMath.Range);
    }
}
</code></pre>
<h4 data-id="heading-31">ç¬¬ä¸‰æ­¥ï¼šæ ·å¼æ¨¡æ¿åº”ç”¨</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">JournalStyleManager</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ApplyJournalTemplate</span>(<span class="hljs-params">IWordDocument document, <span class="hljs-built_in">string</span> journalName</span>)</span>
    {
        <span class="hljs-keyword">switch</span> (journalName.ToLower())
        {
            <span class="hljs-keyword">case</span> <span class="hljs-string">"ieee"</span>:
                ApplyIEEEStyle(document);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">"nature"</span>:
                ApplyNatureStyle(document);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">"science"</span>:
                ApplyScienceStyle(document);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-literal">default</span>:
                ApplyDefaultStyle(document);
                <span class="hljs-keyword">break</span>;
        }
    }
    
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ApplyIEEEStyle</span>(<span class="hljs-params">IWordDocument document</span>)</span>
    {
        <span class="hljs-comment">// IEEEæœŸåˆŠçš„å…¬å¼æ ·å¼è¦æ±‚</span>
        <span class="hljs-keyword">foreach</span> (IWordOMath oMath <span class="hljs-keyword">in</span> document.OMaths)
        {
            oMath.Range.Font.Name = <span class="hljs-string">"Times New Roman"</span>;
            oMath.Range.Font.Size = <span class="hljs-number">10</span>;  <span class="hljs-comment">// IEEEè¦æ±‚è¾ƒå°å­—å·</span>
            oMath.Range.ParagraphFormat.SpaceAfter = <span class="hljs-number">6</span>;
            oMath.Range.ParagraphFormat.SpaceBefore = <span class="hljs-number">6</span>;
        }
    }
}
</code></pre>
<h3 data-id="heading-32">ä»£ç ç‰‡æ®µä¸æ•ˆæœå±•ç¤º</h3>
<h4 data-id="heading-33">å…¬å¼å¤„ç†æµç¨‹å›¾</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    Start([å¼€å§‹]) --&gt; LoadTemplate[åŠ è½½Wordæ¨¡æ¿]
    LoadTemplate --&gt; ParseLaTeX[è§£æLaTeXå…¬å¼]
    ParseLaTeX --&gt; CheckType{æ£€æŸ¥å…¬å¼ç±»å‹}
    
    CheckType --&gt;|åˆ†æ•°| CreateFraction[åˆ›å»ºåˆ†æ•°å¯¹è±¡]
    CheckType --&gt;|çŸ©é˜µ| CreateMatrix[åˆ›å»ºçŸ©é˜µå¯¹è±¡]
    CheckType --&gt;|ç§¯åˆ†| CreateIntegral[åˆ›å»ºç§¯åˆ†å¯¹è±¡]
    CheckType --&gt;|å…¶ä»–| CreateGeneric[åˆ›å»ºé€šç”¨å…¬å¼]
    
    CreateFraction --&gt; BuildStructure[æ„å»ºå…¬å¼ç»“æ„]
    CreateMatrix --&gt; BuildStructure
    CreateIntegral --&gt; BuildStructure
    CreateGeneric --&gt; BuildStructure
    
    BuildStructure --&gt; ApplyStyle[åº”ç”¨æ ·å¼æ¨¡æ¿]
    ApplyStyle --&gt; AddNumber[æ·»åŠ å…¬å¼ç¼–å·]
    AddNumber --&gt; CreateBookmark[åˆ›å»ºä¹¦ç­¾å¼•ç”¨]
    CreateBookmark --&gt; SaveDocument[ä¿å­˜æ–‡æ¡£]
    SaveDocument --&gt; End([ç»“æŸ])
    
    Start --&gt; Error[é”™è¯¯å¤„ç†]
    BuildStructure --&gt; Error
    SaveDocument --&gt; Error
    Error --&gt; End
    
    style Start fill:#4caf50,color:#fff
    style End fill:#f44336,color:#fff
    style Error fill:#ff9800,color:#fff
    style BuildStructure fill:#2196f3,color:#fff
</code></pre>
<h4 data-id="heading-34">å®Œæ•´çš„ç¤ºä¾‹ä»£ç ï¼š</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ScientificPaperFormatter</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">FormatScientificPaper</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> templatePath, List&lt;<span class="hljs-built_in">string</span>&gt; equations, <span class="hljs-built_in">string</span> outputPath</span>)</span>
    {
        <span class="hljs-keyword">using</span> <span class="hljs-keyword">var</span> application = <span class="hljs-keyword">new</span> WordApplication();
        IWordDocument document = application.Documents.Open(templatePath);
        
        <span class="hljs-comment">// åˆå§‹åŒ–å¤„ç†å™¨</span>
        <span class="hljs-keyword">var</span> processor = <span class="hljs-keyword">new</span> EquationProcessor();
        <span class="hljs-keyword">var</span> styleManager = <span class="hljs-keyword">new</span> JournalStyleManager();
        
        <span class="hljs-comment">// å¤„ç†æ‰€æœ‰å…¬å¼</span>
        processor.ProcessEquations(document, equations);
        
        <span class="hljs-comment">// åº”ç”¨æœŸåˆŠæ ·å¼</span>
        styleManager.ApplyJournalTemplate(document, <span class="hljs-string">"IEEE"</span>);
        
        <span class="hljs-comment">// ä¿å­˜æ–‡æ¡£</span>
        document.SaveAs2(outputPath);
        document.Close();
        application.Quit();
    }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">var</span> formatter = <span class="hljs-keyword">new</span> ScientificPaperFormatter();
<span class="hljs-keyword">var</span> equations = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-built_in">string</span>&gt;
{
    <span class="hljs-string">"\\frac{d^2y}{dx^2} + \\omega^2 y = 0"</span>,  <span class="hljs-comment">// å¾®åˆ†æ–¹ç¨‹</span>
    <span class="hljs-string">"\\int_{0}^{\\infty} e^{-x^2} dx = \\frac{\\sqrt{\\pi}}{2}"</span>,  <span class="hljs-comment">// ç§¯åˆ†å…¬å¼</span>
    <span class="hljs-string">"\\begin{pmatrix} a &amp; b \\\\ c &amp; d \\end{pmatrix}"</span>  <span class="hljs-comment">// çŸ©é˜µ</span>
};

formatter.FormatScientificPaper(<span class="hljs-string">@"C:\Templates\PaperTemplate.docx"</span>, 
                                equations, 
                                <span class="hljs-string">@"C:\Output\FormattedPaper.docx"</span>);
</code></pre>
<h2 data-id="heading-35">æ€»ç»“</h2>
<p>é€šè¿‡MudTools.OfficeInterop.Wordé¡¹ç›®ï¼Œæˆ‘ä»¬æˆåŠŸå®ç°äº†ä¸€å¥—å®Œæ•´çš„C# Wordæ•°å­¦å…¬å¼æ’ç‰ˆè§£å†³æ–¹æ¡ˆã€‚è¯¥æ–¹æ¡ˆå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p>
<h3 data-id="heading-36">æŠ€æœ¯ä¼˜åŠ¿</h3>
<ol>
<li><strong>å®Œæ•´çš„æ¥å£è¦†ç›–</strong> - æ”¯æŒ22ç§æ•°å­¦å‡½æ•°ç±»å‹ï¼Œæ¶µç›–æ‰€æœ‰å¸¸ç”¨æ•°å­¦ç¬¦å·</li>
<li><strong>å±‚æ¬¡åŒ–å¯¹è±¡æ¨¡å‹</strong> - æ¸…æ™°çš„æ¥å£è®¾è®¡ï¼Œä¾¿äºç†è§£å’Œæ‰©å±•</li>
<li><strong>è‡ªåŠ¨åŒ–èƒ½åŠ›å¼º</strong> - æ”¯æŒæ‰¹é‡å¤„ç†ã€æ ·å¼ç»Ÿä¸€ã€ç¼–å·ç®¡ç†</li>
<li><strong>æ ¼å¼è½¬æ¢æ”¯æŒ</strong> - LaTeXåˆ°Wordå…¬å¼çš„æ— ç¼è½¬æ¢</li>
</ol>
<h3 data-id="heading-37">åº”ç”¨ä»·å€¼</h3>
<ol>
<li><strong>æé«˜ç”Ÿäº§æ•ˆç‡</strong> - ä»æ‰‹å·¥æ’ç‰ˆè½¬å‘è‡ªåŠ¨åŒ–ç”Ÿæˆï¼Œæ•ˆç‡æå‡æ•°åå€</li>
<li><strong>ä¿è¯æ ¼å¼ä¸€è‡´æ€§</strong> - ç»Ÿä¸€çš„æ ·å¼ç®¡ç†ï¼Œç¡®ä¿æ–‡æ¡£ä¸“ä¸šæ€§</li>
<li><strong>é™ä½æŠ€æœ¯é—¨æ§›</strong> - å°è£…å¤æ‚çš„COMæ“ä½œï¼Œæä¾›ç®€æ´çš„C#æ¥å£</li>
<li><strong>æ”¯æŒæ‰¹é‡å¤„ç†</strong> - ç‰¹åˆ«é€‚åˆå¤§è§„æ¨¡æ–‡æ¡£å’Œå­¦æœ¯è®ºæ–‡çš„æ ¼å¼åŒ–</li>
</ol>
<p>MudTools.OfficeInterop.Wordé¡¹ç›®ä¸ºC#å¼€å‘è€…æä¾›äº†å¼ºå¤§çš„Wordæ–‡æ¡£æ“ä½œèƒ½åŠ›ï¼Œç‰¹åˆ«æ˜¯åœ¨æ•°å­¦å…¬å¼æ’ç‰ˆé¢†åŸŸï¼Œä¸ºç§‘æŠ€æ–‡æ¡£çš„è‡ªåŠ¨åŒ–ç”Ÿäº§å¥ å®šäº†åšå®çš„æŠ€æœ¯åŸºç¡€ã€‚</p>
<h2 data-id="heading-38">ç›¸å…³èµ„æº</h2>
<h3 data-id="heading-39">é¡¹ç›®åœ°å€</h3>
<ul>
<li><strong>Gitee ä»“åº“</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fmudtools%2FOfficeInterop" target="_blank" title="https://gitee.com/mudtools/OfficeInterop" ref="nofollow noopener noreferrer">gitee.com/mudtools/Ofâ€¦</a></li>
<li><strong>GitHub ä»“åº“</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmudtools%2FMudOfficeInterop" target="_blank" title="https://github.com/mudtools/MudOfficeInterop" ref="nofollow noopener noreferrer">github.com/mudtools/Muâ€¦</a></li>
</ul>
<h3 data-id="heading-40">Office APIå‚è€ƒ</h3>
<ul>
<li>Microsoft Excelå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.microsoft.com%2Fzh-cn%2Foffice%2Fvba%2Fapi%2Foverview%2Fexcel" target="_blank" title="https://docs.microsoft.com/zh-cn/office/vba/api/overview/excel" ref="nofollow noopener noreferrer">docs.microsoft.com/zh-cn/officâ€¦</a></li>
<li>.NET COMäº’æ“ä½œæ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.microsoft.com%2Fzh-cn%2Fdotnet%2Fframework%2Finterop%2F" target="_blank" title="https://docs.microsoft.com/zh-cn/dotnet/framework/interop/" ref="nofollow noopener noreferrer">docs.microsoft.com/zh-cn/dotneâ€¦</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[goä½¿ç”¨Cronå®šæ—¶ï¼Œå®ç°recoveræœºåˆ¶ã€‚]]></title>    <link>https://juejin.cn/post/7598587406695022635</link>    <guid>https://juejin.cn/post/7598587406695022635</guid>    <pubDate>2026-01-24T06:01:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598587406695022635" data-draft-id="7598587406694924331" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="goä½¿ç”¨Cronå®šæ—¶ï¼Œå®ç°recoveræœºåˆ¶ã€‚"/> <meta itemprop="keywords" content="Go,åç«¯,é¢è¯•"/> <meta itemprop="datePublished" content="2026-01-24T06:01:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="maoæ¯›"/> <meta itemprop="url" content="https://juejin.cn/user/1146138854949790"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            goä½¿ç”¨Cronå®šæ—¶ï¼Œå®ç°recoveræœºåˆ¶ã€‚
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1146138854949790/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    maoæ¯›
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T06:01:41.000Z" title="Sat Jan 24 2026 06:01:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">robfig/cron v3 æœªå®ç°recover</h2>
<p>å®šæ—¶ä»»åŠ¡paincä¼šå¯¼è‡´ç¨‹åºå†…å­˜æ•°æ®ä¸¢å¤±ï¼Œå‘ç”Ÿé‡å¯ï¼Œæœ¬æ•™ç¨‹æ˜¯å®ç°cronçš„recoveræœºåˆ¶ã€‚åŒæ ·ä¹Ÿé€‚ç”¨äºé•¿è¿æ¥åœºæ™¯ï¼Œæ¯”å¦‚tcpé“¾æ¥åï¼Œç”¨æˆ·å‘ç”Ÿè¡Œä¸ºè°ƒç”¨rpcæœåŠ¡ï¼Œä½†æ˜¯åœ¨è°ƒç”¨å‰çš„æŸäº›æ“ä½œï¼Œè¢«æŠ½è±¡å‡ºæ¥äº†ï¼Œç¼–ç¨‹ä¸åˆç†ç­‰åœºæ™¯ï¼Œå‘ç”Ÿpaincï¼Œä¼šå¯¼è‡´å½“å‰ç”¨æˆ·æ–­å¼€é“¾æ¥ï¼Œæ•°æ®ä¸¢å¤±ã€‚</p>
<h2 data-id="heading-1">ç»´æŠ¤handlerï¼Œdefer å¤„ç†recover</h2>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> CornDesc <span class="hljs-keyword">struct</span> {
    Name    <span class="hljs-type">string</span>
    Spec    <span class="hljs-type">string</span>
    NewFunc <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *CornDesc)</span></span> Handle() {
    <span class="hljs-keyword">defer</span> c.final()
    c.NewFunc()
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *CornDesc)</span></span> final() {
    <span class="hljs-keyword">if</span> err := <span class="hljs-built_in">recover</span>(); err != <span class="hljs-literal">nil</span> {
       fmt.Printf(<span class="hljs-string">"%s æ•è·è¿è¡Œå¼‚å¸¸! err :%v stack %s\n"</span>, c.Name, err, debug.Stack())
    }
}

</code></pre>
<h2 data-id="heading-2">cmd å¯¼å…¥åŸåˆ™ï¼Œæ­¤éƒ¨åˆ†å¯ä»¥ä¿®æ”¹</h2>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">var</span> _Machine *Machine

<span class="hljs-keyword">type</span> Machine <span class="hljs-keyword">struct</span> {
    *cron.Cron
    exist <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">int</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">InitMachine</span><span class="hljs-params">(c *cron.Cron)</span></span> *Machine {
    <span class="hljs-keyword">if</span> _Machine == <span class="hljs-literal">nil</span> {
       _Machine = &amp;Machine{
          Cron:  c,
          exist: <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">int</span>),
       }
    }
    <span class="hljs-keyword">return</span> _Machine
}
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">BaseMachine</span><span class="hljs-params">()</span></span> *Machine {
    <span class="hljs-keyword">return</span> _Machine
}
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *Machine)</span></span> Run() {
    m.Cron.Run()
}
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *Machine)</span></span> verify(cronDesc *CornDesc) <span class="hljs-type">error</span> {
    <span class="hljs-keyword">if</span> id, ok := m.exist[cronDesc.Name]; ok {
       <span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">"ä»»åŠ¡å·²å­˜åœ¨,name %s id %d"</span>, cronDesc.Name, id)
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
}
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *Machine)</span></span> Register(cornDesc *CornDesc) <span class="hljs-type">error</span> {
    <span class="hljs-keyword">if</span> err := m.verify(cornDesc); err != <span class="hljs-literal">nil</span> {
       <span class="hljs-keyword">return</span> err
    }
    id, err := m.Cron.AddFunc(cornDesc.Spec, cornDesc.Handle)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
       <span class="hljs-keyword">return</span> err
    }
    m.exist[cornDesc.Name] = <span class="hljs-type">int</span>(id)
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[DOM-æ·±åº¦æŒæ¡ HTMLElementï¼šä»åŸºç¡€æ“ä½œåˆ°é«˜æ€§èƒ½äº¤äº’]]></title>    <link>https://juejin.cn/post/7598389448147664906</link>    <guid>https://juejin.cn/post/7598389448147664906</guid>    <pubDate>2026-01-24T03:17:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598389448147664906" data-draft-id="7598445152158171187" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="DOM-æ·±åº¦æŒæ¡ HTMLElementï¼šä»åŸºç¡€æ“ä½œåˆ°é«˜æ€§èƒ½äº¤äº’"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,é¢è¯•"/> <meta itemprop="datePublished" content="2026-01-24T03:17:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‘ç°ä¸€åªå¤§å‘†ç“œ"/> <meta itemprop="url" content="https://juejin.cn/user/180747382561607"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            DOM-æ·±åº¦æŒæ¡ HTMLElementï¼šä»åŸºç¡€æ“ä½œåˆ°é«˜æ€§èƒ½äº¤äº’
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/180747382561607/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‘ç°ä¸€åªå¤§å‘†ç“œ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T03:17:45.000Z" title="Sat Jan 24 2026 03:17:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">å‰è¨€</h3>
<p>åœ¨ DOM æ ‘ä¸­ï¼Œ<code>Element</code> ç±»å‹æ˜¯æˆ‘ä»¬äº¤äº’æœ€é¢‘ç¹çš„èŠ‚ç‚¹ã€‚æ— è®ºæ˜¯ä¿®æ”¹æ ·å¼ã€ç›‘å¬ç„¦ç‚¹ï¼Œè¿˜æ˜¯åŠ¨æ€æ’å…¥å†…å®¹ï¼Œéƒ½ç¦»ä¸å¼€å®ƒã€‚æœ¬æ–‡å°†å¸¦ä½ ç³»ç»Ÿå¤ä¹  <code>Element</code> çš„æ ¸å¿ƒ APIï¼Œå¹¶æ­ç¤ºä¸€äº›åœ¨å®é™…å¼€å‘ä¸­å®¹æ˜“å¿½ç•¥çš„ç»†èŠ‚ä¸é™·é˜±ã€‚</p>
<h2 data-id="heading-1">ä¸€ã€ Element èŠ‚ç‚¹åŸºç¡€</h2>
<p><code>Element</code> è¡¨ç¤º HTML ä¸­çš„å…ƒç´ èŠ‚ç‚¹ã€‚é€šè¿‡ <code>document.createElement()</code> å¯ä»¥åŠ¨æ€åˆ›å»ºã€‚</p>
<ul>
<li><strong><code>nodeType</code></strong>: <strong>1</strong></li>
<li><strong><code>nodeName</code></strong>: è¿”å›å¤§å†™æ ‡ç­¾åï¼ˆå¦‚ <code>"DIV"</code>ï¼‰ã€‚</li>
<li><strong><code>nodeValue</code></strong>: å§‹ç»ˆä¸º <code>null</code>ã€‚</li>
</ul>
<h3 data-id="heading-2">1. æ ‡å‡†å±æ€§</h3>
<p>å¯ä»¥ç›´æ¥é€šè¿‡ç‚¹è¯­æ³•ï¼ˆ<code>.</code>ï¼‰è®¿é—®çš„å¸¸è§å±æ€§ï¼š<code>id</code>ã€<code>title</code>ã€<code>lang</code>ã€<code>dir</code>è¯­è¨€çš„ä¹¦å†™æ–¹å‘ï¼ˆ"ltr"è¡¨ç¤ºä»å·¦åˆ°å³ï¼Œ"rtl"è¡¨ç¤ºä»å³åˆ°å·¦)ã€‚</p>
<ul>
<li><strong><code>className</code></strong>: å¯¹åº” HTML çš„ <code>class</code> å±æ€§ã€‚ç”±äº <code>class</code> æ˜¯ JS å…³é”®å­—ï¼Œæ•…å±æ€§ååšäº†è½¬æ¢ã€‚</li>
</ul>
<h3 data-id="heading-3">2. è‡ªå®šä¹‰å±æ€§ï¼šdataset</h3>
<p>HTML5 è§„èŒƒäº† <code>data-</code> å‰ç¼€çš„è‡ªå®šä¹‰å±æ€§ï¼Œé€šè¿‡ <code>dataset</code> å¯¹è±¡å¯ä»¥ä¼˜é›…åœ°è¯»å†™ã€‚</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">&lt;div id=<span class="hljs-string">"myDiv"</span> data-app-id=<span class="hljs-string">"12345"</span>&gt;&lt;/div&gt;

<span class="hljs-keyword">const</span> div = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"myDiv"</span>);

<span class="hljs-comment">// è·å–ï¼šæ³¨æ„ camelCase è½¬æ¢ï¼ˆdata-app-id -&gt; appIdï¼‰</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(div.<span class="hljs-property">dataset</span>.<span class="hljs-property">appId</span>); 

<span class="hljs-comment">// è®¾ç½®</span>
div.<span class="hljs-property">dataset</span>.<span class="hljs-property">userName</span> = <span class="hljs-string">"Nicholas"</span>; <span class="hljs-comment">// è‡ªåŠ¨å˜ä¸º data-user-name="Nicholas"</span>
</code></pre>
<hr/>
<h2 data-id="heading-4">äºŒã€ å±æ€§æ“ä½œï¼šAttribute vs Property</h2>
<p>è¿™æ˜¯æœ€å®¹æ˜“æ··æ·†çš„åœ°æ–¹ï¼š<code>getAttribute</code> æ“ä½œçš„æ˜¯ HTML æ–‡æ¡£ä¸­çš„<strong>ç‰¹æ€§</strong>ï¼Œè€Œç›´æ¥èµ‹å€¼æ“ä½œçš„æ˜¯ JS å¯¹è±¡çš„<strong>å±æ€§</strong>ã€‚</p>

























<table><thead><tr><th><strong>æ–¹æ³•</strong></th><th><strong>æè¿°</strong></th><th><strong>ç‰¹ç‚¹</strong></th></tr></thead><tbody><tr><td><strong><code>getAttribute(name)</code></strong></td><td>è·å– HTML ç‰¹æ€§</td><td>å§‹ç»ˆè¿”å›å­—ç¬¦ä¸²ï¼›è·å–ç±»åéœ€ä¼  <code>"class"</code></td></tr><tr><td><strong><code>setAttribute(name, v)</code></strong></td><td>è®¾ç½® HTML ç‰¹æ€§</td><td>ä¼šåŒæ­¥åˆ° HTML ç»“æ„ä¸­</td></tr><tr><td><strong><code>removeAttribute(name)</code></strong></td><td>å½»åº•åˆ é™¤ç‰¹æ€§</td><td>ä¸ä»…ä»…æ˜¯æ¸…ç©ºå€¼</td></tr></tbody></table>
<blockquote>
<p><strong>ğŸ’¡ å»ºè®®ï¼š</strong> å¯¹äº <code>id</code>ã€<code>className</code> ç­‰æ ‡å‡†å±æ€§ï¼Œç›´æ¥ä½¿ç”¨ç‚¹è¯­æ³•æ€§èƒ½æ›´å¥½ï¼›å¯¹äºéæ ‡å‡†çš„è‡ªå®šä¹‰å±æ€§ï¼Œä½¿ç”¨ <code>dataset</code>ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-5">ä¸‰ã€ å†…å®¹æ“æ§ï¼šå®‰å…¨ä¸æ€§èƒ½</h2>
<h3 data-id="heading-6">1. innerHTML vs textContent</h3>
<ul>
<li><strong><code>innerHTML</code></strong>: è¯»å†™ HTMLï¼Œä¼šè§£ææ ‡ç­¾ã€‚<strong>æ³¨æ„ï¼š</strong> å­˜åœ¨ XSS æ”»å‡»é£é™©ã€‚</li>
<li><strong><code>textContent</code></strong>: è¯»å†™çº¯æ–‡æœ¬ã€‚æ€§èƒ½æ›´å¥½ä¸”æ›´å®‰å…¨ã€‚</li>
</ul>
<h3 data-id="heading-7">2. é«˜æ€§èƒ½æ’å…¥ï¼šinsertAdjacentHTML</h3>
<ul>
<li>è¯­æ³•ï¼š<code>insertAdjacentText(first,sencond)</code>
<ul>
<li><code>second</code>ï¼šæ’å…¥å†…å®¹</li>
<li><code>first</code>ï¼šè¦æ’å…¥çš„ä½ç½®
<ul>
<li><code>beforebegin</code>ï¼šæ’å…¥å½“å‰å…ƒç´ å‰é¢ï¼Œä½œä¸ºå‰ä¸€ä¸ªåŒèƒèŠ‚ç‚¹</li>
<li><code>afterbegin</code>ï¼šæ’å…¥å½“å‰å…ƒç´ å†…éƒ¨ï¼Œä½œä¸ºæ–°çš„å­èŠ‚ç‚¹æˆ–æ”¾åœ¨ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹å‰é¢</li>
<li><code>beforeend</code>ï¼šæ’å…¥å½“å‰å…ƒç´ å†…éƒ¨ï¼Œä½œä¸ºæ–°çš„å­èŠ‚ç‚¹æˆ–æ”¾åœ¨æœ€åä¸€ä¸ªå­èŠ‚ç‚¹åé¢</li>
<li><code>afterend</code>ï¼šæ’å…¥å½“å‰å…ƒç´ åé¢ï¼Œä½œä¸ºä¸‹ä¸€ä¸ªåŒèƒèŠ‚ç‚¹</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>ç›¸æ¯”äº <code>innerHTML += '...'</code>ï¼ˆä¼šå¯¼è‡´æ•´ä¸ªå­æ ‘é‡æ–°æ¸²æŸ“ï¼‰ï¼Œ<code>insertAdjacentHTML</code> å¯ä»¥å°†å­—ç¬¦ä¸²è§£æä¸º DOM å¹¶ç²¾ç¡®æ’å…¥ï¼Œæ€§èƒ½æé«˜ã€‚</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// è¯­æ³•ï¼šelement.insertAdjacentHTML(position, html)</span>
element.<span class="hljs-title function_">insertAdjacentHTML</span>(<span class="hljs-string">"afterbegin"</span>, <span class="hljs-string">"&lt;span&gt;New Content&lt;/span&gt;"</span>);
</code></pre>
<hr/>
<h2 data-id="heading-8">å››ã€ ç±»åç®¡ç†ï¼šclassList API</h2>
<p>ä»¥å‰æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨æ“ä½œ <code>className</code> å­—ç¬¦ä¸²ï¼Œç°åœ¨æœ‰äº† <code>classList</code> è¿™ä¸ªç¥å™¨ã€‚</p>
<ul>
<li><strong><code>add(value)</code></strong> : æ·»åŠ ç±»åã€‚</li>
<li><strong><code>remove(value)</code></strong> : åˆ é™¤ç±»åã€‚</li>
<li><strong><code>contains(value)</code></strong> : åˆ¤æ–­æ˜¯å¦å­˜åœ¨ã€‚</li>
<li><strong><code>toggle(value)</code></strong> : åˆ‡æ¢ï¼ˆæœ‰åˆ™åˆ ï¼Œæ— åˆ™åŠ ï¼‰ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-9">äº”ã€ å‡ ä½•å°ºå¯¸ï¼šå½»åº•ææ‡‚å„ç§ Height/Width</h2>
<p>åœ¨å¤„ç†æ»šåŠ¨å’Œå¸ƒå±€æ—¶ï¼Œè¿™äº›å±æ€§éå¸¸å…³é”®ã€‚</p>





















<table><thead><tr><th><strong>å±æ€§</strong></th><th><strong>åŒ…å«èŒƒå›´</strong></th></tr></thead><tbody><tr><td><strong><code>clientWidth / clientHeight</code></strong></td><td>å†…å®¹ + å†…è¾¹è· (Padding)</td></tr><tr><td><strong><code>offsetWidth / offsetHeight</code></strong></td><td>å†…å®¹ + å†…è¾¹è· + <strong>è¾¹æ¡† (Border)</strong></td></tr><tr><td><strong><code>scrollWidth / scrollHeight</code></strong></td><td>åŒ…å«æ»šåŠ¨æ¡æ»šå‡ºçš„<strong>éšè—éƒ¨åˆ†</strong>çš„å®Œæ•´å°ºå¯¸</td></tr></tbody></table>
<p><strong>è¿›é˜¶ï¼šè·å–ç²¾ç¡®ä½ç½®</strong></p>
<p><code>getBoundingClientRect()</code> è¿”å›å…ƒç´ ç›¸å¯¹äº<strong>æµè§ˆå™¨è§†å£</strong>çš„ <code>top</code>, <code>left</code>, <code>right</code>, <code>bottom</code>, <code>width</code>, <code>height</code>ã€‚</p>
<hr/>
<h2 data-id="heading-10">å…­ã€ ç„¦ç‚¹ç®¡ç†</h2>
<ul>
<li><strong><code>document.activeElement</code></strong>: æŒ‡å‘å½“å‰è·å¾—ç„¦ç‚¹çš„å…ƒç´ ï¼ˆå¦‚æ­£å¤„åœ¨è¾“å…¥çŠ¶æ€çš„ <code>input</code>ï¼‰ã€‚</li>
<li><strong><code>element.focus()</code></strong> : å¼ºåˆ¶è®©å…ƒç´ è·å¾—ç„¦ç‚¹ã€‚</li>
</ul>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">let</span> button = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"myButton"</span>);
button.<span class="hljs-title function_">focus</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-property">activeElement</span> === button); <span class="hljs-comment">// true </span>
</code></pre>
<hr/>
<h2 data-id="heading-11">ä¸ƒã€ é¢è¯•æ¨¡æ‹Ÿé¢˜</h2>
<h3 data-id="heading-12">Q1ï¼š<code>isSameNode()</code> å’Œ <code>isEqualNode()</code> æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3>
<p><strong>å‚è€ƒå›ç­”ï¼š</strong></p>
<ul>
<li><code>isSameNode()</code> (ç­‰åŒäº <code>===</code>): æ£€æŸ¥ä¸¤ä¸ªå˜é‡æ˜¯å¦å¼•ç”¨<strong>åŒä¸€ä¸ª</strong> DOM å®ä¾‹ã€‚</li>
<li><code>isEqualNode()</code>: æ£€æŸ¥ä¸¤ä¸ªèŠ‚ç‚¹æ˜¯å¦<strong>é•¿å¾—ä¸€æ ·</strong>ï¼ˆç±»å‹ç›¸åŒã€å±æ€§ç›¸åŒã€å­èŠ‚ç‚¹ç»“æ„ä¹Ÿç›¸åŒï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-13">Q2ï¼šä¸ºä»€ä¹ˆé€šè¿‡ <code>innerHTML</code> æ’å…¥çš„ <code>&lt;script&gt;</code> ä¸ä¼šæ‰§è¡Œï¼Ÿ</h3>
<p><strong>å‚è€ƒå›ç­”ï¼š</strong></p>
<p>è¿™æ˜¯æµè§ˆå™¨çš„å®‰å…¨ç­–ç•¥ã€‚å¦‚æœéœ€è¦æ‰§è¡Œè„šæœ¬ï¼Œå¿…é¡»é€šè¿‡ <code>document.createElement('script')</code> æ‰‹åŠ¨åˆ›å»ºå¹¶æ’å…¥åˆ°æ–‡æ¡£ä¸­ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Coze 2.0 Skillsæ–°é£å£ï¼å°ç™½ä¹Ÿèƒ½â€œè¯´è¯ç¼–ç¨‹â€ï¼Œè½»æ¾æå®šå‰¯ä¸šç¥å™¨ï¼]]></title>    <link>https://juejin.cn/post/7598464972912181288</link>    <guid>https://juejin.cn/post/7598464972912181288</guid>    <pubDate>2026-01-24T06:10:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598464972912181288" data-draft-id="7598401650857017344" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Coze 2.0 Skillsæ–°é£å£ï¼å°ç™½ä¹Ÿèƒ½â€œè¯´è¯ç¼–ç¨‹â€ï¼Œè½»æ¾æå®šå‰¯ä¸šç¥å™¨ï¼"/> <meta itemprop="keywords" content="Coze,Agent,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2026-01-24T06:10:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åç«¯å°è‚¥è‚ "/> <meta itemprop="url" content="https://juejin.cn/user/2966945320667536"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Coze 2.0 Skillsæ–°é£å£ï¼å°ç™½ä¹Ÿèƒ½â€œè¯´è¯ç¼–ç¨‹â€ï¼Œè½»æ¾æå®šå‰¯ä¸šç¥å™¨ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2966945320667536/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åç«¯å°è‚¥è‚ 
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T06:10:46.000Z" title="Sat Jan 24 2026 06:10:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°è‚¥è‚ ï¼ä»Šå¤©åˆ†äº«ä¸€ä¸ªé€‚åˆå°ç™½çš„å‰¯ä¸šæ–°é£å£ã€‚æˆ‘ç”¨ Coze 2.0 è¯•äº†ä¸€ä¸‹ï¼Œå‘ç°ä¸ç”¨å†™ä»£ç ï¼Œä»…å‡­è‡ªç„¶è¯­è¨€å°±èƒ½åšä¸€ä¸ª<strong>å°çº¢ä¹¦æ¨æ–‡ç”Ÿæˆå™¨</strong>ï¼Œä¸ä»…æ•ˆç‡ç¿»å€ï¼Œè¿˜èƒ½ä¸Šæ¶æŠ€èƒ½å•†åº—è·å–æ”¶ç›Šã€‚æœ¬æ–‡å°†æ‰‹æŠŠæ‰‹æ•™ä½ æ€ä¹ˆç©ï¼</p>
<h2 data-id="heading-0">1. å‰è¨€</h2>
<p>è¿™ä¸¤å¤©ç¾¤é‡Œå°ä¼™ä¼´è·Ÿæˆ‘è¯´æƒ³åšå°çº¢ä¹¦å°è¯´æ¨æ–‡ï¼Œä½†æ˜¯ä»–å·¥ä½œæµä¸æ˜¯å¾ˆç†Ÿç»ƒï¼Œé—®æˆ‘æœ‰ä»€ä¹ˆå¿«çš„æ–¹å¼èƒ½å®ç°è¾“å…¥å°è¯´å†…å®¹å°±ç”Ÿæˆå°è¯´æ¨æ–‡å¡ç‰‡ã€‚æœ€è¿‘Coze Skillsé£å¾ˆå¤§ï¼Œæˆ‘å°±ç”¨å®ƒè¯•ç€ç”Ÿæˆäº†ä¸€ä¸‹ï¼Œç»“æœå‡ºä¹æ„å¤–åœ°å¥½ï¼Œä»…ç”¨çº¯è‡ªç„¶è¯­è¨€ï¼Œå°±å®ç°äº†å°è¯´æ¨æ–‡å¡ç‰‡çš„ç”Ÿæˆã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2f5034bf72b4c8089ac7d34518d9f57~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839845&amp;x-signature=BeDKJraJzTMWGMh7WqKoZ9s6Z3A%3D" alt="" loading="lazy"/></p>
<p>æ›´å…³é”®çš„æ˜¯ï¼ŒCoze Skills ç°åœ¨æ”¯æŒ<strong>ä¸Šæ¶å’Œé…ç½®è®¢é˜…æœºåˆ¶</strong>ã€‚è¿™æ„å‘³ç€ï¼Œå“ªæ€•æ˜¯å®Œå…¨ä¸æ‡‚ä»£ç çš„å°ç™½ï¼Œä¹Ÿèƒ½é€šè¿‡åˆ›æ„æ„å»º Skillï¼Œä¸ä»…èƒ½è‡ªå·±ç”¨ï¼Œè¿˜èƒ½ä¸Šæ¶è·å–æ”¶ç›Šã€‚è¿™æ‰æ˜¯çœŸæ­£çš„æŠ€æœ¯å¹³æƒï¼š<strong>è®©æˆ‘ä»¬ä¸å†è¢«æŠ€æœ¯ç»†èŠ‚æ†ç»‘ï¼Œè€Œæ˜¯æŠŠç²¾åŠ›èšç„¦äºå†…å®¹ä¸åˆ›æ„çš„ç”Ÿäº§ã€‚</strong> ä»Šå¤©å°±æ‰‹æŠŠæ‰‹æ•™å¤§å®¶æ€ä¹ˆåšã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/041c8ba7bbc4420b827ce1b2b9ec7d5f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839845&amp;x-signature=NKUJsDGHDgtyNGfVcFU5iMU59O4%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">2. Coze Skillæ„å»ºå°çº¢ä¹¦æ¨æ–‡å¡ç‰‡ç”Ÿæˆå·¥å…·</h2>
<h3 data-id="heading-2">2.1 Coze Skill æ­å»º</h3>
<p>æ¥åˆ°Cozeå®˜ç½‘<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.coze.cn%2F" target="_blank" title="https://www.coze.cn/" ref="nofollow noopener noreferrer">www.coze.cn/</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b986497e4c6742789cf16bcc1f7682ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839845&amp;x-signature=ebKp7mAcllrPWiBn3TJnyJugyfs%3D" alt="" loading="lazy"/></p>
<p>ç‚¹å‡»ã€æŠ€èƒ½å•†åº—ã€‘ï¼Œæ¥åˆ°é¡µé¢åå¯ä»¥çœ‹åˆ°å·²ç»æœ‰å¾ˆå¤šä¼˜ç§€æ¡ˆä¾‹ã€‚ç‚¹å‡»å³ä¸Šè§’ã€+åˆ›å»ºæŠ€èƒ½ã€‘æŒ‰é’®ï¼Œè·³è½¬åˆ°æ–°ç•Œé¢åè¾“å…¥ä½ çš„éœ€æ±‚ã€‚æˆ‘ç”¨å¤§ç™½è¯å†™äº†ä¸€å¥ï¼š</p>
<pre><code class="hljs">å®ç°è¾“å…¥å°è¯´å†…å®¹ï¼Œç”Ÿæˆå¡ç‰‡åˆ—è¡¨
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c39b80bf6cf42b084b68d1454a7f381~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839845&amp;x-signature=fEC%2Bd9hd3n%2B5dQha%2FdqpHb6mfrs%3D" alt="" loading="lazy"/></p>
<p>ç‚¹å‡»å‘é€æŒ‰é’®åä¼šè·³è½¬åˆ°æŠ€èƒ½ç”Ÿæˆé¡µé¢ï¼Œç¨ç­‰ç‰‡åˆ»å°±å¯ä»¥ä½¿ç”¨ï¼Œç°åœ¨æˆ‘åªè¦åœ¨å³ä¾§å·¥ä½œåŒºåº•éƒ¨å¯¹è¯æ¡†è¾“å…¥å°è¯´å†…å®¹ï¼Œå¾ˆå¿«å°±èƒ½é¡ºåˆ©ç”Ÿæˆå°è¯´æ¨æ–‡å¡ç‰‡äº†ï¼ˆæˆ‘éšä¾¿åœ¨æ¨æ–‡å¹³å°æ‰¾äº†ä¸€ä¸ªå°è¯´ç« èŠ‚ç²˜è´´è¿›å»ï¼‰ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d99c3d7dc4a84606bf2206307ec17aa0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839845&amp;x-signature=Fz0puVf2q8sJNAScjoLmcc9K6yg%3D" alt="" loading="lazy"/></p>
<p>ç­‰å¾…1åˆ†é’Ÿï¼Œå°è¯´æ¨æ–‡å¡ç‰‡å°±ç”Ÿæˆäº†ï¼Œå¦‚æœä¸æ»¡æ„å¯ä»¥åœ¨å³ä¾§å·¥ä½œåŒºåº•éƒ¨å¯¹è¯æ¡†è¾“å…¥ä¿®æ”¹æ„è§ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/29288e529399450ba75ef754c714a1c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839845&amp;x-signature=8wfky%2BDXNXYpAFCfcC3o%2F7IyeeE%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">2.2. Skilléƒ¨ç½²åŠä¸Šæ¶</h3>
<p>Skillå®Œæˆåå°±å¯ä»¥ç‚¹å‡»å³ä¸Šè§’éƒ¨ç½²æŒ‰é’®è¿›è¡Œéƒ¨ç½²äº†ï¼Œç‚¹å‡»ã€å¼€å§‹éƒ¨ç½²ã€‘æŒ‰é’®ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ce816ec1f24e4d36b721e9b86d9f5dc3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839845&amp;x-signature=HAlGmbSIuRpB04oYUiNEsHILF2Q%3D" alt="" loading="lazy"/></p>
<p>å‡ ç§’åå°±éƒ¨ç½²æˆåŠŸäº†ï¼Œç‚¹å‡»ã€ç«‹å³ä½“éªŒã€‘å°±èƒ½ä½“éªŒæˆ‘ä»¬å·²ç»åšå¥½çš„skillã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/51e98cb200f841c8956ea1f47ca247c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839845&amp;x-signature=sG4wWYQtPDrHDuEuHzLxFlStlKo%3D" alt="" loading="lazy"/></p>
<p>ä¾ç„¶è¾“å…¥å°è¯´ç‰‡æ®µï¼Œç‚¹å‡»å‘é€æŒ‰é’®ã€‚ç­‰å¾…å‡ åˆ†é’Ÿå¯ä»¥çœ‹åˆ°ä»»åŠ¡æ‰§è¡Œå®Œæˆï¼Œç‚¹å‡»ã€åˆ†äº«è¯¥ä»»åŠ¡ã€‘æŒ‰é’®ï¼Œåœ¨å¼¹å‡ºçš„æ°”æ³¡ä¸­ç‚¹å‡»ã€å¤åˆ¶é“¾æ¥ã€‘ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8e7c2adedc2c4f7aafd601fd0e7bada6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839845&amp;x-signature=cnO2ES6i3daxI4hJSDVdqW9xYvg%3D" alt="" loading="lazy"/></p>
<p>å›åˆ°æŠ€èƒ½å•†åº—ï¼Œè¿›å…¥ã€æˆ‘çš„æŠ€èƒ½ã€‘é¡µé¢ï¼Œç‚¹å‡»ã€æˆ‘åˆ›å»ºçš„ã€‘ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘åˆšåˆšåˆ›å»ºå®Œæˆçš„å°çº¢ä¹¦å°è¯´æ¨æ–‡æŠ€èƒ½ï¼Œç‚¹å‡»å³ä¸‹è§’å›¾æ ‡ï¼Œé€‰æ‹©ã€ä¸Šæ¶åˆ°å•†åº—ã€‘ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/74db14def568487a93dd5b835d90237e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839845&amp;x-signature=%2FvgroKrKa0cZUSNCyRC7r5ZGtHQ%3D" alt="" loading="lazy"/></p>
<p>å¡«å†™è¯¦ç»†æè¿°ï¼Œè¿›è¡Œæ¡ˆä¾‹é…ç½®ï¼Œå°†å‰é¢å¤åˆ¶çš„é“¾æ¥é…ç½®åˆ°ã€ä»»åŠ¡åˆ†äº«é“¾æ¥ã€‘ï¼Œå¡«å†™æ¡ˆä¾‹åç§°ï¼Œä¸Šä¼ é…å›¾ï¼Œç‚¹å‡»ã€ä¿å­˜ã€‘ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8feb843a8f5747e683977a3e1192f5a5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839845&amp;x-signature=3cWDhJGBtWdA%2FST9TMyEvs0plLI%3D" alt="" loading="lazy"/></p>
<p>è®¾ç½®ã€ä»˜è´¹è®¾ç½®ã€‘å’Œã€æ˜¯å¦å¼€æºã€‘åå°±å¯ä»¥ç‚¹å‡»ä¸Šæ¶åˆ°å•†åº—äº†ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4a77d418cf9141e99247282a2fc4fb09~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839845&amp;x-signature=ElnkhActpCshLM7W%2FLaHNbIrYEs%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">3. ç»“è¯­</h2>
<p>ç»è¿‡è¿™æ¬¡ Coze Skill çš„åˆ›ä½œä½“éªŒï¼Œæƒ³å¿…å¤§å®¶éƒ½èƒ½ç›´è§‚åœ°æ„Ÿå—åˆ°ï¼š<strong>æ™ºèƒ½ä½“</strong> <strong>çš„åˆ›å»ºæ­£åœ¨ç»å†ä»â€œæ‹¼ä¹é«˜â€åˆ°â€œè¯´å¥è¯â€çš„æç®€è¿›åŒ–ã€‚</strong> æ­£å¦‚æˆ‘åœ¨å‰è¨€æ‰€è¯´ï¼ŒæŠ€æœ¯å¹³æƒçš„æ—¶ä»£å·²ç»å…¨é¢æ¥ä¸´ã€‚åœ¨è¿™ä¸ªæ—¶ä»£ï¼Œä»£ç ä¸å†æ˜¯é«˜å¢™ï¼Œæƒ³è±¡åŠ›æ‰æ˜¯å”¯ä¸€çš„è¾¹ç•Œã€‚</p>
<p><strong>å¦‚æœ¬æ¬¡åˆ†äº«å¯¹ä½ æœ‰å¸®åŠ©ï¼Œéº»çƒ¦ä¸€é”®ä¸‰è¿æ”¯æŒä¸€ä¸‹å°è‚¥è‚ ï¼Œæˆ‘ä»¬ä¸‹æœŸå†è§~</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6bd32351449444028b868768dc5ff9a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839845&amp;x-signature=KvbOEylDUZgusktwrm%2BLwbT7FC4%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åå°ç®¡ç†ç³»ç»Ÿ Vite + elementPlus]]></title>    <link>https://juejin.cn/post/7598447519823183913</link>    <guid>https://juejin.cn/post/7598447519823183913</guid>    <pubDate>2026-01-24T03:50:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598447519823183913" data-draft-id="7598418891401297974" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åå°ç®¡ç†ç³»ç»Ÿ Vite + elementPlus "/> <meta itemprop="keywords" content="Vue.js,Node.js,Vite"/> <meta itemprop="datePublished" content="2026-01-24T03:50:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é£è§è§å½’å°˜_"/> <meta itemprop="url" content="https://juejin.cn/user/2858385963754887"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åå°ç®¡ç†ç³»ç»Ÿ Vite + elementPlus 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2858385963754887/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é£è§è§å½’å°˜_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T03:50:02.000Z" title="Sat Jan 24 2026 03:50:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">å¼„è¿™ä¸ªé¡¹ç›®ç¼˜ç”±</h3>
<p>æœ¬æƒ³å­¦ä¹ ä¸‹vue3 çš„åå°ç®¡ç†é¡¹ç›®, å€Ÿé‰´äº†vbtn-admin <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvbenjs%2Fvue-vben-admin" target="_blank" title="https://github.com/vbenjs/vue-vben-admin" ref="nofollow noopener noreferrer">githubåœ°å€</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.vben.pro%2F%23%2Fanalytics" target="_blank" title="https://www.vben.pro/#/analytics" ref="nofollow noopener noreferrer">çº¿ä¸Šåœ°å€</a>, é¢œå€¼åœ¨çº¿, ä½†æ˜¯å°è£…å¤ªéªšäº†æ”¹ä»£ç å¤ªç´¯ã€‚å°±è‡ªå·±é¢å¤–å¤„ç†äº†ä¸‹ã€‚</p>
<p>åšåˆ°ç®€å•æ˜“æ‡‚ å¼€ç®±å³ç”¨</p>
<p>è¿™æ˜¯ä¸€ä¸ªå‰åç«¯åˆ†ç¦»çš„ monorepo ç¤ºä¾‹é¡¹ç›®ï¼Œä½¿ç”¨ <strong>pnpm workspace</strong> ç®¡ç†å‰ç«¯ï¼ˆVite + Tailwind + shadcn-uiï¼‰å’Œåç«¯ï¼ˆNode/Express æˆ–è‡ªå®šä¹‰åç«¯ï¼‰ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhangfengnice%2Fvite-admin-ele" target="_blank" title="https://github.com/hangfengnice/vite-admin-ele" ref="nofollow noopener noreferrer">githubæºç åœ°å€</a></p>
<p><a href="https://link.juejin.cn?target=http%3A%2F%2F112.124.38.17%2Fauth%2Flogin" target="_blank" title="http://112.124.38.17/auth/login" ref="nofollow noopener noreferrer">å½“å‰é¡¹ç›®å…¬ç½‘åœ°å€</a></p>
<h2 data-id="heading-1">é¡¹ç›®ç»“æ„</h2>
<pre><code class="hljs language-csharp" lang="csharp">.
â”œâ”€â”€ ğŸ“ backend/                    <span class="hljs-meta"># åç«¯é¡¹ç›®</span>
â”œâ”€â”€ ğŸ“ frontend/                   <span class="hljs-meta"># å‰ç«¯é¡¹ç›®</span>
â”œâ”€â”€ ğŸ“„ deploy.sh                   <span class="hljs-meta"># éƒ¨ç½²è„šæœ¬</span>
â”œâ”€â”€ ğŸ“„ pnpm-<span class="hljs-keyword">lock</span>.yaml              <span class="hljs-meta"># pnpm é”æ–‡ä»¶</span>
â””â”€â”€ ğŸ“„ pnpm-workspace.yaml         <span class="hljs-meta"># pnpm å·¥ä½œåŒºé…ç½®</span>
</code></pre>
<h2 data-id="heading-2">ğŸš€ å¿«é€Ÿå¼€å§‹</h2>
<h3 data-id="heading-3">1. å…‹éš†ä»“åº“</h3>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> https://github.com/hangfengnice/vite-admin-ele.git
<span class="hljs-built_in">cd</span> vite-admin-ele
</code></pre>
<h3 data-id="heading-4">2. å®‰è£…ä¾èµ–</h3>
<pre><code class="hljs language-bash" lang="bash">npm install -g pnpm
pnpm install
</code></pre>
<h3 data-id="heading-5">3. å¯åŠ¨é¡¹ç›®</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment">#åŒæ—¶å¯åŠ¨å‰åç«¯</span>
pnpm run all

<span class="hljs-comment">#å¯åŠ¨å‰ç«¯</span>
pnpm run dev
<span class="hljs-comment"># æˆ–è€…</span>
pnpm --filter frontend dev

<span class="hljs-comment">#å¯åŠ¨åç«¯</span>
pnpm run back
<span class="hljs-comment"># æˆ–è€…</span>
pnpm --filter backend dev
</code></pre>
<h3 data-id="heading-6">4. ä¸€é”®éƒ¨ç½²é˜¿é‡Œäº‘</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä½¿ç”¨ chmod æ·»åŠ æ‰§è¡Œæƒé™ï¼ˆç¬¬ä¸€æ¬¡ï¼‰</span>
<span class="hljs-built_in">chmod</span> +x deploy.sh

<span class="hljs-comment"># éƒ¨ç½²</span>
./deploy.sh
</code></pre>
<h3 data-id="heading-7">5. å¼€å‘é…ç½®</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aliyun.com%2Fbenefit%3Fspm%3D5176.28536895.J_4VYgf18xNlTAyFFbOuOQe.d_menu_3.53a4586c0rEqbG%26tid%3Dcloud" target="_blank" title="https://www.aliyun.com/benefit?spm=5176.28536895.J_4VYgf18xNlTAyFFbOuOQe.d_menu_3.53a4586c0rEqbG&amp;tid=cloud" ref="nofollow noopener noreferrer">é˜¿é‡Œäº‘åœ°å€ è·å–æœåŠ¡å™¨ ä»˜è´¹</a></p>
<p>é˜¿é‡Œäº‘éœ€è¦è£…</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># é•œåƒ Ubuntu Server 24.04 LTS</span>

<span class="hljs-comment"># å®‰è£… Node.js 24 LTS</span>
curl -fsSL https://deb.nodesource.com/setup_24.x | bash -
sudo apt install -y nodejs

<span class="hljs-comment"># å®‰è£… PM2</span>
sudo npm install -g pm2

<span class="hljs-comment"># å®‰è£… Nginx</span>
sudo apt install -y nginx

<span class="hljs-comment"># å®‰è£… myswl</span>
sudo apt install -y mysql-server
</code></pre>
<h3 data-id="heading-8">6.æœ¬åœ°é…ç½®</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ç”µè„‘ mac</span>

<span class="hljs-comment"># node -v</span>
<span class="hljs-comment"># v24.12.0</span>

<span class="hljs-comment"># pnpm -v</span>
<span class="hljs-comment"># 10.28.1</span>

<span class="hljs-comment"># æœ¬åœ°é¢å¤–è£…äº†mysql</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[nestjså­¦ä¹ 8ï¼šè®¤è¯†æ¨¡å—Module(æ ¹æ¨¡å—/å…¨å±€æ¨¡å—/åŠ¨æ€æ¨¡å—)]]></title>    <link>https://juejin.cn/post/7598465042968018984</link>    <guid>https://juejin.cn/post/7598465042968018984</guid>    <pubDate>2026-01-24T06:11:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598465042968018984" data-draft-id="7598083101361586182" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="nestjså­¦ä¹ 8ï¼šè®¤è¯†æ¨¡å—Module(æ ¹æ¨¡å—/å…¨å±€æ¨¡å—/åŠ¨æ€æ¨¡å—)"/> <meta itemprop="keywords" content="NestJS"/> <meta itemprop="datePublished" content="2026-01-24T06:11:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸€æ±Ÿä¸œæµæ°´"/> <meta itemprop="url" content="https://juejin.cn/user/1151943917181880"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            nestjså­¦ä¹ 8ï¼šè®¤è¯†æ¨¡å—Module(æ ¹æ¨¡å—/å…¨å±€æ¨¡å—/åŠ¨æ€æ¨¡å—)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1151943917181880/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸€æ±Ÿä¸œæµæ°´
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T06:11:55.000Z" title="Sat Jan 24 2026 06:11:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ ¹æ¨¡å—</h2>
<p>é¦–å…ˆé—®ä¸€ä¸ªé—®é¢˜ï¼šæ‰€æœ‰çš„åˆ›å»ºçš„æ¨¡å—éƒ½éœ€è¦åœ¨<code>AppModule</code>ä¸­<code>import</code>å—ï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œåªæœ‰ä¸‹é¢ä¸‰ç§æƒ…å†µéœ€è¦åœ¨<code>AppModule</code>ä¸­å¼•å…¥ã€‚</p>
<p><strong>1. AppModule è‡ªèº«è¦ä½¿ç”¨è¿™ä¸ªæ¨¡å—çš„åŠŸèƒ½</strong></p>
<p>å¦‚æœ AppModule é‡Œçš„ç»„ä»¶ï¼ˆæ¯”å¦‚ AppControllerã€AppServiceï¼‰éœ€è¦ç”¨ AaaModule å¯¼å‡ºçš„æœåŠ¡ï¼Œé‚£å¿…é¡»åœ¨ AppModule çš„ imports é‡ŒåŠ  AaaModuleã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Module</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">AaaModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./aaa/aaa.module'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">AppService</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./app.service'</span>;

@<span class="hljs-title class_">Module</span>({
  <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">AaaModule</span>], <span class="hljs-comment">// å› ä¸ºAppServiceè¦ç”¨åˆ°AaaService</span>
  <span class="hljs-attr">providers</span>: [<span class="hljs-title class_">AppService</span>],
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppModule</span> {}

<span class="hljs-comment">// app.service.ts</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Injectable</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">AaaService</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./aaa/aaa.service'</span>;

@<span class="hljs-title class_">Injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppService</span> {
  <span class="hljs-comment">// AppServiceä¾èµ–AaaServiceï¼Œæ‰€ä»¥AppModuleå¿…é¡»å¯¼å…¥AaaModule</span>
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">private readonly aaaService: AaaService</span>) {}

  <span class="hljs-title function_">getHello</span>(): string {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">aaaService</span>.<span class="hljs-title function_">doSomething</span>(); <span class="hljs-comment">// è°ƒç”¨AaaModuleçš„åŠŸèƒ½</span>
  }
}
</code></pre>
<p>å¦‚æœ AppModule é‡Œçš„ä»»ä½• provider/controller è¦ç”¨åˆ° AaaModule çš„åŠŸèƒ½ï¼Œå°±å¿…é¡»åœ¨ AppModule é‡Œå¯¼å…¥å®ƒ â€”â€” è¿™å’Œ BbbModule è¦ç”¨å°±å¿…é¡»è‡ªå·±å¯¼å…¥çš„é€»è¾‘å®Œå…¨ä¸€è‡´ï¼Œåªæ˜¯ AppModule æ˜¯æ ¹æ¨¡å—è€Œå·²ã€‚</p>
<p><strong>2. æ³¨å†Œå…¨å±€ç”Ÿæ•ˆçš„æ ¸å¿ƒæ¨¡å—</strong></p>
<p>æœ‰äº›æ¨¡å—æœ¬èº«æ˜¯ â€œåŸºç¡€è®¾æ–½â€ï¼Œéœ€è¦åœ¨åº”ç”¨å¯åŠ¨æ—¶å°±åˆå§‹åŒ–ï¼Œå“ªæ€• AppModule è‡ªèº«ä¸ç”¨ï¼Œä¹Ÿå¾—åœ¨ AppModule é‡Œå¯¼å…¥ â€”â€” æ¯”å¦‚æ•°æ®åº“æ¨¡å—ï¼ˆTypeOrmModuleï¼‰ã€é…ç½®æ¨¡å—ï¼ˆConfigModuleï¼‰ã€è®¤è¯æ¨¡å—ï¼ˆPassportModuleï¼‰ç­‰ã€‚</p>
<p>è¿™äº›æ¨¡å—çš„ç‰¹ç‚¹æ˜¯ï¼š<strong>å®ƒä»¬çš„åˆå§‹åŒ–æ˜¯åº”ç”¨å¯åŠ¨çš„å‰æï¼Œå¿…é¡»åœ¨æ ¹æ¨¡å—å¯¼å…¥æ‰èƒ½ç”Ÿæ•ˆ</strong>ï¼Œä½†è¿™ä¸ä»£è¡¨å…¶ä»–æ¨¡å—èƒ½ç›´æ¥ç”¨ï¼ˆé™¤éåŠ  @Globalï¼‰ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// app.module.ts</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Module</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">TypeOrmModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/typeorm'</span>; <span class="hljs-comment">// æ•°æ®åº“æ¨¡å—</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">BbbModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./bbb/bbb.module'</span>;

@<span class="hljs-title class_">Module</span>({
  <span class="hljs-attr">imports</span>: [
    <span class="hljs-comment">// åˆå§‹åŒ–æ•°æ®åº“è¿æ¥ï¼ˆåº”ç”¨å¯åŠ¨çš„æ ¸å¿ƒæ­¥éª¤ï¼‰</span>
    <span class="hljs-title class_">TypeOrmModule</span>.<span class="hljs-title function_">forRoot</span>({
      <span class="hljs-attr">type</span>: <span class="hljs-string">'mysql'</span>,
      <span class="hljs-attr">host</span>: <span class="hljs-string">'localhost'</span>,
      <span class="hljs-attr">database</span>: <span class="hljs-string">'test'</span>,
      <span class="hljs-comment">// ...å…¶ä»–é…ç½®</span>
    }),
    <span class="hljs-title class_">BbbModule</span>,
  ],
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppModule</span> {}
</code></pre>
<p>è¿™é‡Œ TypeOrmModule.forRoot () æ˜¯ â€œå…¨å±€åˆå§‹åŒ–æ•°æ®åº“è¿æ¥â€ï¼Œå¿…é¡»åœ¨ AppModule é‡Œå¯¼å…¥ â€”â€” å¦åˆ™æ•´ä¸ªåº”ç”¨è¿ä¸ä¸Šæ•°æ®åº“ã€‚ä½†å¦‚æœ BbbModule é‡Œè¦æ“ä½œæ•°æ®åº“è¡¨ï¼Œè¿˜æ˜¯è¦è‡ªå·±å¯¼å…¥<code>TypeOrmModule.forFeature([User])</code>ï¼Œè¿™å°±æ˜¯ <strong>æ ¹æ¨¡å—åšå…¨å±€åˆå§‹åŒ–ï¼Œå­æ¨¡å—åšå±€éƒ¨ä½¿ç”¨</strong>ã€‚</p>
<p><strong>3ï¼šæŠŠå­æ¨¡å—çº³å…¥åº”ç”¨çš„å¯åŠ¨èŒƒå›´</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// é”™è¯¯å†™æ³•ï¼šBbbModuleæ²¡è¢«ä»»ä½•æ¨¡å—å¯¼å…¥</span>
<span class="hljs-comment">// app.module.ts</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Module</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;

@<span class="hljs-title class_">Module</span>({
  <span class="hljs-attr">imports</span>: [], <span class="hljs-comment">// æ²¡å¯¼å…¥BbbModule</span>
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppModule</span> {}

<span class="hljs-comment">// bbb.controller.ts</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Controller</span>, <span class="hljs-title class_">Get</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;

@<span class="hljs-title class_">Controller</span>(<span class="hljs-string">'bbb'</span>)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BbbController</span> {
  @<span class="hljs-title class_">Get</span>()
  <span class="hljs-title function_">getHello</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">'Hello Bbb!'</span>;
  }
}
</code></pre>
<p>æ­¤æ—¶è®¿é—®<code>/bbb</code>æ¥å£ä¼š 404ï¼Œå› ä¸º BbbModule æ²¡è¢« AppModule å¯¼å…¥ï¼ŒNestJS å¯åŠ¨æ—¶æ ¹æœ¬æ²¡åŠ è½½è¿™ä¸ªæ¨¡å—ã€‚</p>
<p><strong>æ­£ç¡®é€»è¾‘ï¼šAppModule å¯¼å…¥ BbbModuleï¼Œæ˜¯ä¸ºäº†è®© BbbModule è¢«åº”ç”¨è¯†åˆ«å¹¶å¯åŠ¨ã€‚</strong></p>
<p>ç¬¬äºŒä¸ªé—®é¢˜ï¼šä»€ä¹ˆæ ·çš„æ¨¡å—ä¸éœ€è¦åœ¨<code>AppModule</code>ä¸­importå‘¢ï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯ï¼šé™¤äº†ä¸Šé¢ä¸‰ç§æƒ…å†µå¤–ï¼Œå…¶ä½™çš„æ¨¡å—å…¶å®éƒ½ä¸éœ€è¦åœ¨<code>AppModule</code>ä¸­å¼•å…¥ï¼Œåªæœ‰åœ¨éœ€è¦å®ƒçš„æ¨¡å—ä¸­å¼•å…¥å³å¯ã€‚</p>
<p>å‡è®¾ï¼š</p>
<ul>
<li>AaaModuleï¼šå°è£…äº† â€œç”¨æˆ·ç§¯åˆ†è®¡ç®—â€ çš„åŠŸèƒ½ï¼ˆAaaServiceï¼‰ã€‚</li>
<li>BbbModuleï¼šå¤„ç† â€œè®¢å•ç›¸å…³â€ çš„ä¸šåŠ¡ï¼Œåªæœ‰ä¸‹å•æ—¶éœ€è¦è®¡ç®—ç§¯åˆ†ï¼Œæ‰€ä»¥åªæœ‰ BbbModule éœ€è¦ç”¨ AaaModuleã€‚</li>
<li>CccModuleï¼šå¤„ç† â€œå•†å“å±•ç¤ºâ€ çš„ä¸šåŠ¡ï¼Œå®Œå…¨ç”¨ä¸åˆ°ç§¯åˆ†åŠŸèƒ½ã€‚</li>
</ul>
<p>æ­£ç¡®å†™æ³•ï¼ˆ<strong>æŒ‰éœ€å¯¼å…¥</strong>ï¼‰</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// aaa.module.ts</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Module</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">AaaService</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./aaa.service'</span>;

@<span class="hljs-title class_">Module</span>({
  <span class="hljs-attr">providers</span>: [<span class="hljs-title class_">AaaService</span>],
  <span class="hljs-comment">// å…³é”®ï¼šè¦æŠŠAaaServiceå¯¼å‡ºï¼Œå…¶ä»–Moduleæ‰èƒ½ç”¨</span>
  <span class="hljs-attr">exports</span>: [<span class="hljs-title class_">AaaService</span>]
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AaaModule</span> {}

<span class="hljs-comment">// bbb.module.ts</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Module</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">BbbService</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./bbb.service'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">AaaModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../aaa/aaa.module'</span>; <span class="hljs-comment">// åªåœ¨éœ€è¦çš„åœ°æ–¹å¯¼å…¥</span>

@<span class="hljs-title class_">Module</span>({
  <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">AaaModule</span>], <span class="hljs-comment">// å¯¼å…¥AaaModule</span>
  <span class="hljs-attr">providers</span>: [<span class="hljs-title class_">BbbService</span>],
  <span class="hljs-attr">controllers</span>: [<span class="hljs-title class_">BbbController</span>]
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BbbModule</span> {}

<span class="hljs-comment">// app.module.tsï¼ˆæ ¹æ¨¡å—ï¼‰</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Module</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">BbbModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./bbb/bbb.module'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">CccModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./ccc/ccc.module'</span>;
<span class="hljs-comment">// è¿™é‡Œä¸ç”¨å¯¼å…¥AaaModuleï¼Œå› ä¸ºåªæœ‰BbbModuleéœ€è¦</span>

@<span class="hljs-title class_">Module</span>({
  <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">BbbModule</span>, <span class="hljs-title class_">CccModule</span>],
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppModule</span> {}
</code></pre>
<p><strong>å¦‚æœæŠŠ AaaModule ä¹ŸåŠ åˆ° AppModule çš„ imports é‡Œï¼Œè™½ç„¶åŠŸèƒ½èƒ½è·‘ï¼Œä½†å°±åƒä½ åœ¨å‰ç«¯æ ¹ç»„ä»¶é‡Œå¯¼å…¥äº†ä¸€ä¸ªåªæœ‰æŸä¸ªå­ç»„ä»¶æ‰ç”¨çš„å°å·¥å…·ï¼Œå®Œå…¨æ²¡å¿…è¦ï¼Œè¿˜ä¼šè®©æ ¹æ¨¡å—å˜è‡ƒè‚¿ã€‚</strong></p>
<h2 data-id="heading-1">å…¨å±€æ¨¡å—</h2>
<p>æ¨¡å—å¯¼å‡º providerï¼Œå¦ä¸€ä¸ªæ¨¡å—éœ€è¦ imports å®ƒæ‰èƒ½ç”¨è¿™äº› providerã€‚</p>
<p>ä½†å¦‚æœè¿™ä¸ªæ¨¡å—è¢«å¾ˆå¤šæ¨¡å—ä¾èµ–äº†ï¼Œé‚£æ¯æ¬¡éƒ½è¦ imports å°±å¾ˆéº»çƒ¦ã€‚</p>
<p>èƒ½ä¸èƒ½è®¾ç½®æˆå…¨å±€çš„ï¼Œå®ƒå¯¼å‡ºçš„ provider ç›´æ¥å¯ç”¨å‘¢ï¼Ÿ</p>
<p>åœ¨ AaaModule é‡ŒæŒ‡å®š exports çš„ providerï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/95542b1e86db4b4cbfe4790340e11437~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839915&amp;x-signature=KubD9W1nvYUCiWJFdW7anMShqkI%3D" alt="image.png" loading="lazy"/></p>
<p>ç„¶ååœ¨ BbbModule é‡Œ importsï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73f0c2a6a2df427086d3978561c26ad3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839915&amp;x-signature=04d4szh5TNbzBnOGW3cVR0u4fe0%3D" alt="image.png" loading="lazy"/></p>
<p>è¿™æ ·å°±å¯ä»¥åœ¨ BbbModule å†…æ³¨å…¥ AaaService äº†ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/932791defbcd465b9294e0b2ed63cabe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839915&amp;x-signature=PErt9UufMxpYCDbyBhJJl5pJ8lU%3D" alt="image.png" loading="lazy"/></p>
<p>è¿™æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„å¼•å…¥ Module çš„æ–¹å¼ã€‚</p>
<p>ä½†å¦‚æœè¿™ä¸ª AaaModule è¢«å¾ˆå¤šåœ°æ–¹å¼•ç”¨å‘¢ï¼Ÿ</p>
<p>æ¯ä¸ªæ¨¡å—éƒ½ imports å¤ªéº»çƒ¦äº†ï¼Œè¿™æ—¶å€™å°±å¯ä»¥æŠŠå®ƒå£°æ˜ä¸ºå…¨å±€çš„ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/726b7b8a2b7849c9a8c5d1c847617b83~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839915&amp;x-signature=r4vbLQfD7v5LSaxX1K6uc2QR8FU%3D" alt="image.png" loading="lazy"/></p>
<p>åœ¨ AaaModule ä¸ŠåŠ ä¸€ä¸ª @Global çš„è£…é¥°å™¨ï¼Œç„¶ååœ¨ BbbModule é‡ŒæŠŠ AaaModule çš„ imports å»æ‰ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4e44f1e4661d407f908853dca9f8330c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839915&amp;x-signature=YJ1eXx8zIDIbWfWdkaNxm0GZ8D4%3D" alt="image.png" loading="lazy"/></p>
<p>è¿™æ ·ä¾ç„¶æ˜¯å¯ä»¥æ³¨å…¥çš„ã€‚</p>
<p>è¿™å°±æ˜¯å…¨å±€æ¨¡å—ã€‚</p>
<p>ä¸è¿‡å…¨å±€æ¨¡å—è¿˜æ˜¯å°½é‡å°‘ç”¨ï¼Œä¸ç„¶æ³¨å…¥çš„å¾ˆå¤š provider éƒ½ä¸çŸ¥é“æ¥æºï¼Œä¼šé™ä½ä»£ç çš„å¯ç»´æŠ¤æ€§ã€‚</p>
<h2 data-id="heading-2">åŠ¨æ€æ¨¡å—</h2>
<p>å‰é¢è®²è¿‡ï¼ŒProvider æ˜¯å¯ä»¥é€šè¿‡ useFactory åŠ¨æ€äº§ç”Ÿçš„ï¼Œé‚£ Module å¯ä¸å¯ä»¥å‘¢ï¼Ÿ</p>
<p>è‡ªç„¶æ˜¯å¯ä»¥çš„ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/735b10f01ec043c3adc1c0e6df176195~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839915&amp;x-signature=NKS08YjOaLYtLFyWP1ZVYI%2FJQfQ%3D" alt="image.png" loading="lazy"/></p>
<p>è¿™ä¸ªæ¨¡å—æ˜¯é™æ€çš„ï¼Œä¹Ÿå°±æ˜¯å®ƒçš„å†…å®¹æ˜¯å›ºå®šä¸å˜çš„ï¼Œæ¯æ¬¡ import éƒ½æ˜¯ä¸€æ ·ã€‚</p>
<p>æœ‰çš„æ—¶å€™æˆ‘ä»¬å¸Œæœ› import çš„æ—¶å€™ç»™è¿™ä¸ªæ¨¡å—ä¼ ä¸€äº›å‚æ•°ï¼ŒåŠ¨æ€ç”Ÿæˆæ¨¡å—çš„å†…å®¹ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<p>è¿™æ—¶å€™å°±éœ€è¦ Dynamic Module äº†ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">DynamicModule</span>, <span class="hljs-title class_">Module</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">BbbService</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./bbb.service'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">BbbController</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./bbb.controller'</span>;

@<span class="hljs-title class_">Module</span>({})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BbbModule</span> {

  <span class="hljs-keyword">static</span> <span class="hljs-title function_">register</span>(<span class="hljs-attr">options</span>: <span class="hljs-title class_">Record</span>&lt;string, any&gt;): <span class="hljs-title class_">DynamicModule</span> {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">module</span>: <span class="hljs-title class_">BbbModule</span>,
      <span class="hljs-attr">controllers</span>: [<span class="hljs-title class_">BbbController</span>],
      <span class="hljs-attr">providers</span>: [
        {
          <span class="hljs-attr">provide</span>: <span class="hljs-string">'CONFIG_OPTIONS'</span>,
          <span class="hljs-attr">useValue</span>: options,
        },
        <span class="hljs-title class_">BbbService</span>,
      ],
      <span class="hljs-attr">exports</span>: []
    };
  }
}
</code></pre>
<p>æˆ‘ä»¬ç»™ BbbModule åŠ ä¸€ä¸ª register çš„é™æ€æ–¹æ³•ï¼Œè¿”å›æ¨¡å—å®šä¹‰çš„å¯¹è±¡ã€‚</p>
<p>å’Œåœ¨è£…é¥°å™¨é‡Œå®šä¹‰çš„æ—¶å€™çš„åŒºåˆ«ï¼Œåªæ˜¯å¤šäº†ä¸€ä¸ª module å±æ€§ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/006f3cfdaa6a462b971cca7f5b5e5368~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839915&amp;x-signature=0CL7VdvswPR%2BfTuwMU1gQBTO4G0%3D" alt="image.png" loading="lazy"/></p>
<p>è€Œä¸”æˆ‘ä»¬è¿˜å¯ä»¥æŠŠå‚æ•°ä¼ å…¥çš„ options å¯¹è±¡ä½œä¸ºä¸€ä¸ªæ–°çš„ providerã€‚</p>
<p>import çš„æ—¶å€™å°±å¾—è¿™æ ·ç”¨äº†ï¼Œé€šè¿‡ register æ–¹æ³•ä¼ å…¥å‚æ•°ï¼Œè¿”å›å€¼å°±æ˜¯æ¨¡å—å®šä¹‰ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a80e39cfb2de48319b5f4682b91bac67~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839915&amp;x-signature=vglqaTdIlk7cCnSvvZETPNIkuYs%3D" alt="image.png" loading="lazy"/></p>
<p>è¿™æ—¶å€™æˆ‘ä»¬æŠŠä¼ å…¥çš„ options é€šè¿‡ useValue åˆ›å»ºäº†ä¸ª providerï¼Œè¿™æ ·æ¨¡å—å†…éƒ¨å°±å¯ä»¥æ³¨å…¥å®ƒäº†ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1bb5b5c5539540e7a5a3e078f33f7f66~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839915&amp;x-signature=4xxHk5Hg5nYE9rmKv%2BgdFUlXebw%3D" alt="image.png" loading="lazy"/></p>
<p>æˆ‘åœ¨ BbbController é‡Œé¢é€šè¿‡ token æ³¨å…¥è¿™ä¸ª providerï¼Œæ‰“å°ä¸‹å®ƒçš„å€¼ã€‚</p>
<p>æ”¹ä¸€ä¸‹ register çš„å‚æ•°ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/799eeede40f54d7eabbd35f13c47e972~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839915&amp;x-signature=LS2URzsUeOVUyk%2FE%2BLU0N7VFzBI%3D" alt="image.png" loading="lazy"/></p>
<p>æµè§ˆå™¨å†è®¿é—®ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°æ§åˆ¶å°æ‰“å°äº† config å¯¹è±¡ã€‚</p>
<p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨ import ä¸€ä¸ªæ¨¡å—çš„æ—¶å€™ï¼Œä¼ å…¥å‚æ•°ï¼Œç„¶ååŠ¨æ€ç”Ÿæˆæ¨¡å—çš„å†…å®¹ã€‚</p>
<p>è¿™å°±æ˜¯ Dynamic Moduleã€‚</p>
<p>è¿™é‡Œçš„ register æ–¹æ³•å…¶å®å«å•¥éƒ½è¡Œï¼Œä½† nest çº¦å®šäº† 3 ç§æ–¹æ³•åï¼š</p>
<ul>
<li>register</li>
<li>forRoot</li>
<li>forFeature</li>
</ul>
<p>æˆ‘ä»¬çº¦å®šå®ƒä»¬åˆ†åˆ«ç”¨æ¥åšä¸åŒçš„äº‹æƒ…ï¼š</p>
<ul>
<li>registerï¼šç”¨ä¸€æ¬¡æ¨¡å—ä¼ ä¸€æ¬¡é…ç½®ï¼Œæ¯”å¦‚è¿™æ¬¡è°ƒç”¨æ˜¯ BbbModule.register({aaa:1})ï¼Œä¸‹ä¸€æ¬¡å°±æ˜¯ BbbModule.register({aaa:2}) äº†</li>
<li>forRootï¼šé…ç½®ä¸€æ¬¡æ¨¡å—ç”¨å¤šæ¬¡ï¼Œæ¯”å¦‚ XxxModule.forRoot({}) ä¸€æ¬¡ï¼Œä¹‹åå°±ä¸€ç›´ç”¨è¿™ä¸ª Moduleï¼Œä¸€èˆ¬åœ¨ AppModule é‡Œ import</li>
<li>forFeatureï¼šç”¨äº† forRoot å›ºå®šäº†æ•´ä½“æ¨¡å—ï¼Œç”¨äºå±€éƒ¨çš„æ—¶å€™ï¼Œå¯èƒ½éœ€è¦å†ä¼ ä¸€äº›é…ç½®ï¼Œæ¯”å¦‚ç”¨ forRoot æŒ‡å®šäº†æ•°æ®åº“é“¾æ¥ä¿¡æ¯ï¼Œå†ç”¨ forFeature æŒ‡å®šæŸä¸ªæ¨¡å—è®¿é—®å“ªä¸ªæ•°æ®åº“å’Œè¡¨ã€‚</li>
</ul>
<p>å…‰è¿™ä¹ˆè¯´å¯èƒ½ä¸å¤Ÿç›´è§‚ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸ªçœŸå®çš„åŠ¨æ€æ¨¡å—å°±æ‡‚äº†ã€‚</p>
<p>æ¯”å¦‚ @nestjs/typeorm çš„åŠ¨æ€æ¨¡å—ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1fecd81f45d74f679cf3c1fbbead0b36~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839915&amp;x-signature=nuSHCwbpPeYXh6cRzAN61yMWWsQ%3D" alt="image.png" loading="lazy"/></p>
<p>forRoot ä¼ å…¥é…ç½®ï¼Œç„¶åè°ƒç”¨äº†<code>TypeOrmCoreModule</code>æ¨¡å—çš„<code>forRoot</code>æ–¹æ³•ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4459558010b0447b8ccca850fa3a63fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839915&amp;x-signature=Jd166PC0IhXXXNCfT8NWbUJyCeQ%3D" alt="image.png" loading="lazy"/></p>
<p>å®ƒåŠ¨æ€äº§ç”Ÿ provider å’Œ exportsï¼Œè¿”å›æ¨¡å—å®šä¹‰ã€‚</p>
<p>forFeature åˆ™æ˜¯ä¼ å…¥å±€éƒ¨çš„ä¸€äº›é…ç½®ï¼Œæ¥åŠ¨æ€äº§ç”Ÿå±€éƒ¨ç”¨çš„æ¨¡å—ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b8be65f9f0f4c978e1e25ba67c95392~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839915&amp;x-signature=LJKmlQHwXQ4b3puQy3THV8wtqcU%3D" alt="image.png" loading="lazy"/></p>
<p>typeorm çš„æ¨¡å—ç”¨èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d8574a6cd674b618a6d81f4543e4e6a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839915&amp;x-signature=6bVzbyCXW2ntvULN1st8twcn7ck%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/408b967e346040f594f21eb3532b9b68~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769839915&amp;x-signature=9f9kdNNrm7bRqsiso0BmZBosIFk%3D" alt="image.png" loading="lazy"/></p>
<p>åœ¨ AppModule é‡Œ import é€šè¿‡ forRoot åŠ¨æ€äº§ç”Ÿçš„æ¨¡å—ï¼Œåœ¨å…·ä½“çš„ä¸šåŠ¡ Module é‡Œï¼Œé€šè¿‡ forFeature ä¼ å…¥å…·ä½“å®ä½“ç±»çš„é…ç½®ã€‚</p>
<p>å…¶å® forRootã€forFeatureã€register æœ‰åŒºåˆ«ä¹ˆï¼Ÿ</p>
<p><strong>æœ¬è´¨ä¸Šæ²¡åŒºåˆ«ï¼Œåªæ˜¯æˆ‘ä»¬çº¦å®šäº†å®ƒä»¬ä½¿ç”¨ä¸Šçš„ä¸€äº›åŒºåˆ«</strong>ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å·¥ç¨‹åŒ–è½åœ°ï¼šåˆ©ç”¨ TS/ESLint è‡ªåŠ¨åŒ–æ„å»º AI æƒé™å›´å¢™]]></title>    <link>https://juejin.cn/post/7598499504170188838</link>    <guid>https://juejin.cn/post/7598499504170188838</guid>    <pubDate>2026-01-24T04:05:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598499504170188838" data-draft-id="7597083743555895339" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å·¥ç¨‹åŒ–è½åœ°ï¼šåˆ©ç”¨ TS/ESLint è‡ªåŠ¨åŒ–æ„å»º AI æƒé™å›´å¢™"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,ä»£ç è§„èŒƒ"/> <meta itemprop="datePublished" content="2026-01-24T04:05:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="donecoding"/> <meta itemprop="url" content="https://juejin.cn/user/3192637500430093"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å·¥ç¨‹åŒ–è½åœ°ï¼šåˆ©ç”¨ TS/ESLint è‡ªåŠ¨åŒ–æ„å»º AI æƒé™å›´å¢™
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3192637500430093/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    donecoding
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T04:05:45.000Z" title="Sat Jan 24 2026 04:05:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å‰è¨€</p>
<p>åœ¨ä¸Šä¸€ç¯‡æ–¹æ¡ˆç¯‡ä¸­ï¼Œæˆ‘ä»¬æ„æ€äº†â€œAI é€»è¾‘æ²™ç›’â€çš„åŒå±‚å®å¥‘çº¦ï¼šé€šè¿‡Â <code>define</code>Â ä¸Â <code>apply</code>Â æ¨¡å¼ï¼Œå°† AI çš„ç ´ååŠå¾„é”æ­»åœ¨å—é™çš„ç¯å¢ƒä¸­ã€‚</p>
<p>ä½†æ¶æ„è®¾è®¡å¦‚æœä¸è½å®ä¸ºè‡ªåŠ¨åŒ–å·¥å…·ï¼Œå°±åªæ˜¯çº¸ä¸Šè°ˆå…µã€‚åœ¨ 2026 å¹´çš„å¼€å‘ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬è¿½æ±‚çš„æ˜¯ <strong>â€œå¼€å‘æ€æé«˜å‹çº¦æŸï¼Œè¿è¡Œæ€é›¶å¼€é”€è„±ç¦»â€</strong> ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬è¿›å…¥æ·±æ°´åŒºï¼Œæ¢è®¨å¦‚ä½•åˆ©ç”¨Â <strong>TypeScript Compiler APIã€ESLint å®šåˆ¶è§„åˆ™ä»¥åŠç¼–è¯‘æ—¶å®å¤„ç†</strong>ï¼Œå°†è¿™å¥—é€»è¾‘æ‰“é€ æˆä¸€å¥—é—­ç¯çš„è‡ªåŠ¨åŒ–å‡†å…¥ä½“ç³»ã€‚</p>
<hr/>
<p>ä¸€ã€ è‡ªåŠ¨åŒ–åŸºçŸ³ï¼šä»â€œå®å£°æ˜â€åˆ°â€œè§„åˆ™æ˜ å°„â€</p>
<p>æ‰‹åŠ¨ç»´æŠ¤æ¯ä¸ª AI æ–‡ä»¶å¤¹çš„é…ç½®æ˜¯ä¸å¯æŒç»­çš„ã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯ï¼š<strong>æ¶æ„å¸ˆä¿®æ”¹ä¸€è¡Œ TS ç±»å‹å®šä¹‰ï¼Œå·¥ç¨‹ç¯å¢ƒè‡ªåŠ¨å®Œæˆâ€œå¸ƒé˜²â€ã€‚</strong></p>
<ol>
<li>é™æ€æ‰«æå™¨ (The Scanner)</li>
</ol>
<p>æˆ‘ä»¬éœ€è¦ç¼–å†™ä¸€ä¸ª Node.js è„šæœ¬ï¼ˆåˆ©ç”¨Â <code>ts-morph</code>Â æˆ– SWC çš„è§£æèƒ½åŠ›ï¼‰ï¼Œä¸“é—¨æ‰«æå®¿ä¸»ä¾§çš„æƒé™å£°æ˜ã€‚</p>
<ul>
<li>
<p><strong>æ ¸å¿ƒé€»è¾‘</strong>ï¼š</p>
<ol>
<li>è¯†åˆ«Â <code>defineEnvContext&lt;T&gt;</code>Â è°ƒç”¨çš„ä½ç½®ã€‚</li>
<li>é™æ€è§£ææ³›å‹Â <code>T</code>Â ä¸­çš„å±æ€§ã€‚ä¾‹å¦‚ï¼Œå¦‚æœÂ <code>T</code>Â æ˜¯Â <code>Pick&lt;Window, 'addEventListener' | 'removeEventListener'&gt;</code>ï¼Œè„šæœ¬å°†æå–å‡ºÂ <code>window</code>Â åŠå…¶æˆå¯¹çš„æˆæƒå±æ€§ã€‚<strong>è¿™ç§æˆå¯¹æˆæƒæ˜¯å¿…é¡»çš„ï¼Œå®ƒç¡®ä¿äº† AI å…·å¤‡æ¸…ç†å‰¯ä½œç”¨çš„èƒ½åŠ›ï¼Œä»æ ¹æºè§„é¿å†…å­˜æ³„éœ²ã€‚</strong></li>
<li>è§£æÂ <code>defineImportContext&lt;T&gt;</code>Â ä¸­å®šä¹‰çš„å¤–éƒ¨æ¨¡å—æ˜ å°„è·¯å¾„ã€‚</li>
</ol>
</li>
</ul>
<ol start="2">
<li>é…ç½®è‡ªåŠ¨ç”Ÿæˆ (The Generator)</li>
</ol>
<p>è„šæœ¬æ‰«æå®Œæˆåï¼Œä¼šç«‹å³åœ¨å¯¹åº”çš„Â <strong>AI é€»è¾‘æ²™ç›’</strong>Â æ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆ/æ›´æ–°ä¸¤ä¸ªå…³é”®çš„â€œå›´å¢™â€æ–‡ä»¶ï¼š</p>
<ul>
<li>
<p><strong>ç”ŸæˆÂ <code>.eslintrc.js</code></strong>ï¼š<br/>
<strong>å¿…é¡»è®¾ç½®Â <code>root: true</code></strong>ã€‚è¿™æ˜¯ä¸ºäº†å½»åº•åˆ‡æ–­çˆ¶çº§ç›®å½•ä¸­å¯èƒ½å­˜åœ¨çš„â€œå®½æ¾è§„åˆ™â€å¹²æ‰°ï¼Œç¡®ä¿æ²™ç›’è§„åˆ™çš„çº¯å‡€ã€‚</p>
<p>javascript</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// /src/ai_modules/xxx/.eslintrc.js</span>
<span class="hljs-keyword">module</span>.<span class="hljs-keyword">exports</span> = {
  root: <span class="hljs-literal">true</span>, <span class="hljs-comment">// æ ¸å¿ƒï¼šæ–­ç»çˆ¶çº§è§„åˆ™åˆå¹¶ï¼Œå»ºç«‹ç‹¬ç«‹â€œæ³•å¾‹ä½“ç³»â€</span>
  env: {
    browser: <span class="hljs-literal">false</span>, <span class="hljs-comment">// ç¦ç”¨é»˜è®¤ç¯å¢ƒï¼Œé˜²æ­¢éšå¼é€ƒé€¸</span>
    es2022: <span class="hljs-literal">true</span>
  },
  rules: {
    <span class="hljs-string">"no-undef"</span>: <span class="hljs-string">"error"</span>, <span class="hljs-comment">// é…åˆæŠ¹é™¤ DOM åº“ï¼Œç¦æ­¢ç›´æ¥è®¿é—®å…¨å±€å˜é‡</span>
    <span class="hljs-comment">// è¿™é‡Œçš„ "error" æ˜¯ç­‰çº§ï¼ˆSeverityï¼‰ï¼Œç¡®ä¿ä»»ä½•è¿è§„ä»£ç éƒ½æ— æ³•é€šè¿‡ç¼–è¯‘</span>
    <span class="hljs-string">"no-restricted-globals"</span>: [<span class="hljs-string">"error"</span>, <span class="hljs-string">"window"</span>, <span class="hljs-string">"document"</span>, <span class="hljs-string">"location"</span>, <span class="hljs-string">"localStorage"</span>], 
    <span class="hljs-string">"no-restricted-syntax"</span>: [
      <span class="hljs-string">"error"</span>,
      {
        <span class="hljs-comment">// ä»…å…è®¸ä»æˆ‘ä»¬çš„å®è§£æ„å‡ºçš„å˜é‡ï¼Œç¦æ­¢ç»•è¿‡å®ç›´æ¥è°ƒç”¨</span>
        <span class="hljs-string">"selector"</span>: <span class="hljs-string">"VariableDeclarator[init.callee.name='applyEnvContext'] &gt; ObjectPattern &gt; Property"</span>,
        <span class="hljs-string">"message"</span>: <span class="hljs-string">"è§£æ„å˜é‡æœªåœ¨å®¿ä¸» define å®ä¸­æˆæƒã€‚"</span>
      }
    ]
  }
};
</code></pre>
<p>è¯·è°¨æ…ä½¿ç”¨æ­¤ç±»ä»£ç ã€‚</p>
</li>
<li>
<p><strong>ç”ŸæˆÂ <code>tsconfig.json</code></strong>ï¼š<br/>
é€šè¿‡Â <code>compilerOptions.paths</code>Â å°†å…¨å±€ç±»å‹é‡å®šå‘åˆ°æˆ‘ä»¬ç”Ÿæˆçš„<strong>å—é™ .d.ts å®šä¹‰</strong>ï¼Œç¡®ä¿ AI ç¼–å†™æ—¶ IDE æç¤ºä»…åŒ…å«è¢«Â <code>Pick</code>Â å‡ºæ¥çš„å®‰å…¨å±æ€§ã€‚</p>
</li>
</ul>
<hr/>
<p>äºŒã€ ç¼–è¯‘æ—¶é­”æ³•ï¼šå®çš„â€œå½»åº•æ¶ˆå¤±æœ¯â€</p>
<p>å®ï¼ˆMacrosï¼‰çš„æœ¬è´¨æ˜¯â€œå¼€å‘æ€çš„ä¸¥æ ¼çº¦æŸï¼Œç”Ÿäº§æ€çš„çº¯å‡€å¹»è§‰â€ã€‚åœ¨æ„å»ºé˜¶æ®µï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ç¼–è¯‘å™¨æ’ä»¶è¿›è¡Œç‰©ç†å¤„ç†ã€‚</p>
<p>1.Â <code>applyEnvContext</code>Â çš„è¿è¡Œæ—¶è„±é™¤</p>
<p>è¿™æ˜¯æ–¹æ¡ˆæœ€ä¼˜é›…ä¹‹å¤„ï¼š<strong>ç”±äºå®¿ä¸»ç¯å¢ƒå¤©ç„¶å­˜åœ¨å…¨å±€å¯¹è±¡ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ç¼–è¯‘æ—¶æŠŠå®â€œåˆ æ‰â€å³å¯ã€‚</strong></p>
<ul>
<li><strong>è½¬æ¢å‰ï¼ˆAI æºç ï¼‰</strong> ï¼š<br/>
<code>const { window } = applyEnvContext&lt;GlobalApi&gt;();</code></li>
<li><strong>è½¬æ¢åï¼ˆäº§ç‰©ä»£ç ï¼‰</strong> ï¼š<br/>
<code>const { window } = globalThis;</code>ï¼ˆæˆ–ç›´æ¥ç‰©ç†ç§»é™¤ï¼Œè®©å˜é‡å¼•ç”¨å›é€€åˆ°åŸç”Ÿå…¨å±€è®¿é—®ï¼‰ã€‚</li>
<li><strong>å·¥ç¨‹æ„ä¹‰</strong>ï¼šå¼€å‘æ€é€šè¿‡å®å®ç°<strong>è§£æ„å˜é‡</strong>å¹¶<strong>èµ‹äºˆå—é™ç±»å‹</strong>ä»¥é€šè¿‡å®¡è®¡ï¼›æ„å»ºæ€åˆ™è®©å…¶æ¶ˆå¤±ï¼Œä¿è¯äº§ç‰©é›¶å¼€é”€ã€‚</li>
</ul>
<p>2.Â <code>applyImportContext</code>Â çš„é€»è¾‘æå‡</p>
<p>ä¸ç¯å¢ƒå®ä¸åŒï¼Œç¬¬ä¸‰æ–¹æ¨¡å—éœ€è¦çœŸå®çš„å¼•å…¥é€»è¾‘ã€‚</p>
<ul>
<li><strong>å¤„ç†é€»è¾‘</strong>ï¼šç¼–è¯‘å™¨æ‰«æè¯¥å®ï¼Œæ ¹æ®æ˜ å°„å…³ç³»åœ¨æ–‡ä»¶é¡¶éƒ¨æ’å…¥Â <code>import debounce from 'lodash/debounce'</code>ï¼Œéšååˆ é™¤åŸå§‹å®è°ƒç”¨è¡Œã€‚</li>
</ul>
<hr/>
<p>ä¸‰ã€ é˜²å¾¡æ€§å®¡è®¡ï¼šå¦‚ä½•é˜²æ­¢ AI â€œé€ƒé€¸â€ï¼Ÿ</p>
<p>AI å¯èƒ½ä¼šå°è¯•åˆ©ç”¨å…ˆéªŒçŸ¥è¯†ï¼Œé€šè¿‡Â <code>window['loc' + 'ation']</code>Â è¿™ç§æ‰‹æ®µç»•è¿‡é™æ€æ‹¦æˆªã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬åœ¨Â <strong>AI é€»è¾‘æ²™ç›’</strong>Â å†…å®æ–½Â  <strong>â€œé›¶ä¿¡ä»»å®¡è®¡â€</strong> ï¼š</p>
<ol>
<li><strong>ç¦æ­¢æˆå‘˜è¡¨è¾¾å¼åŠ¨æ€è®¿é—®</strong>ï¼šé€šè¿‡ ESLint æ‹¦æˆªÂ <code>MemberExpression</code>Â çš„è®¡ç®—å±æ€§è®¿é—®ï¼Œå¼ºåˆ¶è¦æ±‚ API è°ƒç”¨å¿…é¡»æ˜¯é™æ€å¯è§çš„ã€‚</li>
<li><strong>å¼ºåˆ¶å•ä¸€å…¥å£</strong>ï¼šç¦æ­¢ä»»ä½•éå®å£°æ˜çš„å¤–éƒ¨Â <code>import</code>ã€‚æ‰€æœ‰ä¾èµ–å¿…é¡»é€šè¿‡Â <code>applyImportContext</code>Â ç”³è¯·ã€‚</li>
<li><strong>äºŒæ¬¡ç¼–è¯‘æ ¡éªŒ</strong>ï¼šåœ¨æ„å»ºæ’ä»¶ä¸­ï¼Œæˆ‘ä»¬ä¼šå¯¹è§£æ„çš„å±æ€§è¿›è¡ŒäºŒæ¬¡æ ¸å¯¹ã€‚å¦‚æœ AI è¯•å›¾è§£æ„ä¸€ä¸ªæœªç»Â <code>define</code>Â æˆæƒçš„å±æ€§ï¼Œ<strong>æ„å»ºå°†ç›´æ¥é˜»æ–­</strong>ã€‚</li>
</ol>
<hr/>
<p>å››ã€ æ¶æ„æ€»ç»“ï¼šå°†æƒåŠ›å…³è¿›â€œåŸºå»ºâ€çš„ç¬¼å­</p>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬æ„å»ºäº†ä¸€å¥—å®Œæ•´çš„Â <strong>AI åŸç”Ÿå·¥ç¨‹æ²»ç†æµæ°´çº¿</strong>ï¼š</p>
<ol>
<li><strong>æ¶æ„å¸ˆï¼ˆäººï¼‰</strong> ï¼šåœ¨å®¿ä¸»å±‚é€šè¿‡Â <code>define</code>Â å®æ‹¨å‘å¾®å°çš„ã€ç»è¿‡Â <code>Pick</code>Â è£å‰ªçš„æƒé™ã€‚</li>
<li><strong>è‡ªåŠ¨åŒ–è„šæœ¬</strong>ï¼šå°†æƒé™å®æ—¶æ˜ å°„ä¸ºæ²™ç›’å†…éƒ¨çš„Â <code>root: true</code>Â çš„ ESLint è§„åˆ™ä¸Â <code>TSConfig</code>ã€‚</li>
<li><strong>AIï¼ˆæ‰§è¡Œè€…ï¼‰</strong> ï¼šåœ¨å—é™çš„Â <strong>AI é€»è¾‘æ²™ç›’</strong>Â å†…ï¼Œé€šè¿‡Â <code>apply</code>Â å®è¡Œä½¿èƒ½åŠ›ã€‚</li>
<li><strong>ç¼–è¯‘å™¨ï¼ˆæ‹¦æˆªè€…ï¼‰</strong> ï¼šåœ¨æ„å»ºæ—¶æ ¡éªŒå¹¶æŠ¹é™¤æ‰€æœ‰å®é€»è¾‘ï¼Œäº§å‡ºçº¯å‡€ä»£ç ã€‚</li>
</ol>
<p><strong>åœ¨è¿™ç§æ¶æ„ä¸‹ï¼Œäººæ‹…è´£çš„å‹åŠ›è¢«é™åˆ°äº†æœ€ä½ã€‚</strong> Â ä½ ä¸å†éœ€è¦æ­»ç£•ä¸šåŠ¡é€»è¾‘ï¼Œåªéœ€è¦å®¡è®¡é‚£å‡ è¡Œâ€œå¥‘çº¦â€ã€‚ä¾‹å¦‚ï¼š <strong>â€œAI ç”³è¯·äº† addEventListener ä½†æ²¡æœ‰ç”³è¯· removeEventListenerï¼Œè¿™æ˜¯å¦ä¼šå¼•å…¥å†…å­˜é£é™©ï¼Ÿâ€</strong> Â è¿™ç§åŸºäºæƒé™è¾¹ç•Œçš„å®¡è®¡ï¼Œæ‰æ˜¯çœŸæ­£çš„é«˜æ•ˆã€‚</p>
<hr/>
<p>ç»“è¯­</p>
<p>ã€ŒAI é€»è¾‘æ²™ç›’ã€ä¸ä»…æ˜¯ä¸€å¥—å·¥å…·ï¼Œå®ƒä»£è¡¨äº†æˆ‘ä»¬åœ¨ 2026 å¹´å¯¹<strong>é˜²å¾¡æ€§ç¼–ç¨‹</strong>çš„ç»ˆæå®è·µã€‚</p>
<p>æˆ‘ä»¬æ­£å¤„åœ¨ä¸€ä¸ªåˆ†æ°´å²­ï¼šä¸€è¾¹æ˜¯ Vibe Coding å¸¦æ¥çš„ç”Ÿäº§åŠ›ç‹‚æ¬¢ï¼Œä¸€è¾¹æ˜¯å·¥ç¨‹ä¸¥è°¨æ€§çš„å´©å¡Œã€‚è€Œè¿™å¥—æ–¹æ¡ˆè¯•å›¾åœ¨ä¸¤è€…ä¹‹é—´æ¶èµ·ä¸€åº§æ¡¥æ¢ï¼š<strong>ç”¨æœ€ç¡¬æ ¸çš„åŸºå»ºï¼Œå»æ‹¥æŠ±æœ€ä¸ç¡®å®šçš„ AI ç”Ÿäº§åŠ›ã€‚</strong></p>
<p>æ„Ÿè°¢é˜…è¯»ç³»åˆ—æ–‡ç« ã€ŠAI åŸç”Ÿå·¥ç¨‹ï¼šé€»è¾‘æ²™ç›’ä¸é›¶ä¿¡ä»»ä»£ç æ²»ç†ã€‹ã€‚è¿™åœºå…³äº AI å‡†å…¥çš„é©å‘½ï¼Œæ‰åˆšåˆšå¼€å§‹ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä»å°ç™½åˆ°å¤§ä½¬ï¼šTypeScript çš„é€†è¢­ä¹‹è·¯ï¼]]></title>    <link>https://juejin.cn/post/7598418891401379894</link>    <guid>https://juejin.cn/post/7598418891401379894</guid>    <pubDate>2026-01-24T04:08:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598418891401379894" data-draft-id="7593292445301047315" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä»å°ç™½åˆ°å¤§ä½¬ï¼šTypeScript çš„é€†è¢­ä¹‹è·¯ï¼"/> <meta itemprop="keywords" content="TypeScript"/> <meta itemprop="datePublished" content="2026-01-24T04:08:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="éœæµ¦å°ç å“¥"/> <meta itemprop="url" content="https://juejin.cn/user/1996368847058071"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä»å°ç™½åˆ°å¤§ä½¬ï¼šTypeScript çš„é€†è¢­ä¹‹è·¯ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1996368847058071/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    éœæµ¦å°ç å“¥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T04:08:32.000Z" title="Sat Jan 24 2026 04:08:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ä¸€ä¸ªå†™äº†å¤šå¹´ TypeScript çš„å‰ç«¯å¼€å‘è€é¸Ÿã€‚ä»Šå¤©ï¼Œæˆ‘è¦å’Œå¤§å®¶åˆ†äº«ä¸€äº›å…³äº TypeScript çš„æœ€ä½³å®è·µã€‚è¿™äº›ç»éªŒéƒ½æ˜¯æˆ‘åœ¨æ— æ•°æ¬¡è¸©å‘åæ€»ç»“å‡ºæ¥çš„ï¼Œå¸Œæœ›èƒ½è®©ä½ å°‘èµ°å¼¯è·¯ï¼Œç›´æ¥æˆä¸º TypeScript çš„å¤§ä½¬ã€‚å½“ç„¶ï¼Œåˆ†äº«çš„è¿‡ç¨‹ä¹Ÿä¸ä¼šæ¯ç‡¥æ— å‘³ï¼Œæ¯•ç«Ÿç¼–ç¨‹å˜›ï¼Œå¼€å¿ƒæœ€é‡è¦ï¼</p>
<h2 data-id="heading-0">TypeScript æ˜¯ä»€ä¹ˆé¬¼ï¼Ÿ</h2>
<p>å¦‚æœä½ æ˜¯ç¬¬ä¸€æ¬¡å¬è¯´ TypeScriptï¼Œå¯èƒ½ä¼šæœ‰ç‚¹æ‡µï¼šâ€œTypeScriptï¼Ÿè¿™åå­—å¬èµ·æ¥å¥½é«˜å¤§ä¸Šï¼Œä½†åˆ°åº•æ˜¯å•¥ï¼Ÿâ€</p>
<p>ç®€å•æ¥è¯´ï¼ŒTypeScript æ˜¯ JavaScript çš„è¶…é›†ï¼Œå®ƒåœ¨ JS çš„åŸºç¡€ä¸Šå¢åŠ äº†<strong>é™æ€ç±»å‹æ£€æŸ¥</strong>ã€‚è¿™å°±åƒåœ¨ä½ å†™ä»£ç çš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªè´´å¿ƒçš„â€œä¿å§†â€åœ¨æ—è¾¹æé†’ä½ ï¼šâ€œå˜¿ï¼Œè¿™ä¸ªå˜é‡ç±»å‹ä¸å¯¹å“¦ï¼â€æˆ–è€…â€œä½ ç¡®å®šè¿™ä¸ªå‡½æ•°ä¼šè¿”å›ä¸€ä¸ªæ•°å­—å—ï¼Ÿâ€æœ‰äº† TypeScriptï¼Œä½ å°±å¯ä»¥åœ¨å†™ä»£ç æ—¶å‡å°‘å¾ˆå¤šä½çº§é”™è¯¯ã€‚</p>
<p>ä¸è¿‡ï¼ŒTypeScript ä¹Ÿæœ‰ä¸€ä¸ªâ€œå‘çˆ¹â€çš„åœ°æ–¹â€”â€”å®ƒå¤ªä¸¥æ ¼äº†ï¼åˆšå¼€å§‹ç”¨çš„æ—¶å€™ï¼Œä½ å¯èƒ½ä¼šè§‰å¾—è‡ªå·±è¢«ç»‘æ‰‹ç»‘è„šã€‚ä½†æ…¢æ…¢åœ°ï¼Œä½ ä¼šå‘ç°ï¼Œè¿™ç§â€œä¸¥æ ¼â€å…¶å®æ˜¯å¯¹ä½ çš„çˆ±å•Šï¼å®ƒèƒ½å¸®ä½ å†™å‡ºæ›´å¥å£®ã€æ›´å®‰å…¨çš„ä»£ç ã€‚</p>
<hr/>
<h2 data-id="heading-1">å…¥é—¨å¿…å¤‡ï¼šTypeScript çš„æ ¸å¿ƒæ¦‚å¿µ</h2>
<p>åœ¨æ­£å¼å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£å‡ ä¸ªåŸºç¡€æ¦‚å¿µã€‚å¦‚æœä½ å·²ç»æ˜¯è€æ‰‹ï¼Œå¯ä»¥ç›´æ¥è·³è¿‡è¿™ä¸€èŠ‚ï¼ˆä½†æˆ‘çŒœä½ ä¸ä¼šï¼Œå› ä¸ºæˆ‘çš„æ–‡ç« è¿™ä¹ˆæœ‰è¶£ï¼‰ã€‚</p>
<h3 data-id="heading-2">1. ç±»å‹ï¼ˆTypeï¼‰</h3>
<p>TypeScript æœ€æ ¸å¿ƒçš„å°±æ˜¯<strong>ç±»å‹</strong>ã€‚å®ƒä¼šè®©ä½ çš„ä»£ç å˜å¾—æ›´åŠ æ¸…æ™°ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">let</span> <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">25</span>; <span class="hljs-comment">// age æ˜¯ä¸€ä¸ªæ•°å­—</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'å°æ˜'</span>; <span class="hljs-comment">// name æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">isHappy</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">true</span>; <span class="hljs-comment">// isHappy æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼</span>
</code></pre>
<p>çœ‹èµ·æ¥æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Ÿä½†å¦‚æœä½ å†™æˆè¿™æ ·ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">let</span> <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> = <span class="hljs-string">'25'</span>; <span class="hljs-comment">// æŠ¥é”™ï¼å­—ç¬¦ä¸²ä¸èƒ½èµ‹å€¼ç»™æ•°å­—ç±»å‹</span>
</code></pre>
<p>TypeScript ä¼šç«‹åˆ»è·³å‡ºæ¥ï¼šâ€œå…„å¼Ÿï¼Œä½ æ˜¯ä¸æ˜¯å†™é”™äº†ï¼Ÿâ€è¿™å°±æ˜¯å®ƒçš„é­…åŠ›â€”â€”å¸®ä½ åœ¨å¼€å‘é˜¶æ®µå°±å‘ç°é—®é¢˜ï¼Œè€Œä¸æ˜¯ç­‰åˆ°çº¿ä¸Šå‡º bug å†è¢«äº§å“ç»ç†è¿½ç€æ‰“ã€‚</p>
<h3 data-id="heading-3">2. æ¥å£ï¼ˆInterfaceï¼‰</h3>
<p>æ¥å£æ˜¯ TypeScript çš„å¦ä¸€å¤§æ€æ‰‹é”ã€‚å®ƒå¯ä»¥ç”¨æ¥å®šä¹‰å¯¹è±¡çš„ç»“æ„ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Person</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">const</span> <span class="hljs-attr">student</span>: <span class="hljs-title class_">Person</span> = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'å°çº¢'</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">18</span>,
};
</code></pre>
<p>å¦‚æœä½ å°‘å†™äº†æŸä¸ªå±æ€§ï¼Œæ¯”å¦‚ <code>age</code>ï¼ŒTypeScript ä¼šç«‹åˆ»æŠ¥è­¦ï¼šâ€œå–‚ï¼Œä½ æ˜¯ä¸æ˜¯å¿˜äº†å•¥ï¼Ÿâ€</p>
<h3 data-id="heading-4">3. æ³›å‹ï¼ˆGenericsï¼‰</h3>
<p>æ³›å‹å¬èµ·æ¥å¾ˆé«˜æ·±ï¼Œä½†å…¶å®å¾ˆå¥½ç†è§£ã€‚å®ƒå°±åƒä¸€ä¸ªâ€œæ¨¡æ¿â€ï¼Œå¯ä»¥è®©ä½ çš„ä»£ç æ›´åŠ çµæ´»ï¼Œå°±åƒä½ å»ä¹°è¡£æœï¼Œå•†å®¶å‘Šè¯‰ä½ â€œè¿™è¡£æœæ˜¯å‡ç çš„ï¼Œèƒ–ç˜¦é«˜çŸ®éƒ½èƒ½ç©¿â€ï¼Œè¿™å°±æ˜¯æ³›å‹çš„æ ¸å¿ƒæ€æƒ³ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> getArray&lt;T&gt;(<span class="hljs-attr">items</span>: T[]): T[] {
  <span class="hljs-keyword">return</span> items;
}

<span class="hljs-keyword">const</span> numberArray = getArray&lt;<span class="hljs-built_in">number</span>&gt;([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]);
<span class="hljs-keyword">const</span> stringArray = getArray&lt;<span class="hljs-built_in">string</span>&gt;([<span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>]);
</code></pre>
<p>æ˜¯ä¸æ˜¯æ„Ÿè§‰å¾ˆå‰å®³ï¼Ÿç”¨æ³›å‹ï¼Œä½ å¯ä»¥å†™å‡ºæ›´åŠ é€šç”¨çš„ä»£ç ã€‚</p>
<hr/>
<h2 data-id="heading-5">å®æˆ˜æŠ€å·§ï¼šå¦‚ä½•ç”¨å¥½ TypeScriptï¼Ÿ</h2>
<p>äº†è§£äº†åŸºç¡€æ¦‚å¿µåï¼Œæˆ‘ä»¬æ¥èŠèŠä¸€äº›å®ç”¨çš„æŠ€å·§ã€‚è¿™äº›éƒ½æ˜¯æˆ‘è¸©è¿‡æ— æ•°å‘åæ€»ç»“å‡ºæ¥çš„ï¼Œå¸Œæœ›å¯¹ä½ æœ‰å¸®åŠ©ã€‚</p>
<h3 data-id="heading-6">1. æ°¸è¿œå¼€å¯ä¸¥æ ¼æ¨¡å¼</h3>
<p>TypeScript æœ‰ä¸€ä¸ªé€‰é¡¹å« <code>strict</code>ï¼Œé»˜è®¤æ˜¯å…³é—­çš„ã€‚ä½†æˆ‘å»ºè®®ä½ <strong>ä¸€å®šè¦æ‰“å¼€</strong>ï¼ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºä¸¥æ ¼æ¨¡å¼ä¼šè®© TypeScript æ›´åŠ â€œæŒ‘å‰”â€ï¼Œä»è€Œå¸®ä½ å‘ç°æ›´å¤šæ½œåœ¨é—®é¢˜ã€‚</p>
<p>åœ¨ <code>tsconfig.json</code> ä¸­è®¾ç½®ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"compilerOptions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"strict"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>åˆšå¼€å§‹å¯èƒ½ä¼šæœ‰ç‚¹ç—›è‹¦ï¼Œå› ä¸º TypeScript ä¼šç–¯ç‹‚åœ°æŒ‡å‡ºä½ çš„é”™è¯¯ã€‚ä½†ç›¸ä¿¡æˆ‘ï¼Œè¿™ç§ç—›è‹¦æ˜¯å€¼å¾—çš„ã€‚ä¹…è€Œä¹…ä¹‹ï¼Œä½ ä¼šå‘ç°è‡ªå·±çš„ä»£ç è´¨é‡æå‡äº†ä¸€å¤§æˆªï¼</p>
<h3 data-id="heading-7">2. å–„ç”¨ <code>any</code>ï¼Œä½†ä¸è¦æ»¥ç”¨</h3>
<p><code>any</code> æ˜¯ TypeScript ä¸­çš„â€œä¸‡é‡‘æ²¹â€ç±»å‹ï¼Œå®ƒå¯ä»¥æ¥å—ä»»ä½•å€¼ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">let</span> <span class="hljs-attr">something</span>: <span class="hljs-built_in">any</span> = <span class="hljs-string">'hello'</span>;
something = <span class="hljs-number">42</span>; <span class="hljs-comment">// å®Œå…¨æ²¡é—®é¢˜ï¼</span>
</code></pre>
<p>è™½ç„¶ <code>any</code> ç”¨èµ·æ¥å¾ˆçˆ½ï¼Œä½†åƒä¸‡ä¸è¦æ»¥ç”¨ï¼å› ä¸ºä¸€æ—¦ç”¨äº† <code>any</code>ï¼ŒTypeScript çš„ç±»å‹æ£€æŸ¥å°±å¤±æ•ˆäº†ã€‚æ­£ç¡®çš„å§¿åŠ¿æ˜¯ï¼š<strong>åªåœ¨ä¸‡ä¸å¾—å·²æ—¶æ‰ç”¨ <code>any</code>ï¼Œå°½é‡ç”¨æ›´å…·ä½“çš„ç±»å‹æ›¿ä»£å®ƒ</strong>ã€‚</p>
<h3 data-id="heading-8">3. å­¦ä¼šä½¿ç”¨ç±»å‹æ¨æ–­</h3>
<p>TypeScript çš„ä¸€ä¸ªä¼˜ç‚¹æ˜¯ï¼Œå®ƒä¼šè‡ªåŠ¨æ¨æ–­å˜é‡çš„ç±»å‹ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">let</span> count = <span class="hljs-number">10</span>; <span class="hljs-comment">// TS è‡ªåŠ¨æ¨æ–­ count æ˜¯ number ç±»å‹</span>
</code></pre>
<p>æ‰€ä»¥ï¼Œå¾ˆå¤šæ—¶å€™ä½ ä¸éœ€è¦æ˜¾å¼åœ°å†™å‡ºç±»å‹å£°æ˜ã€‚è¿™æ ·ä¸ä»…å‡å°‘äº†ä»£ç é‡ï¼Œè¿˜èƒ½è®©ä»£ç çœ‹èµ·æ¥æ›´ç®€æ´ã€‚</p>
<h3 data-id="heading-9">4. ä½¿ç”¨è”åˆç±»å‹å’Œç±»å‹ä¿æŠ¤</h3>
<p>æœ‰æ—¶å€™ï¼Œä¸€ä¸ªå˜é‡å¯èƒ½æœ‰å¤šç§ç±»å‹ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">printId</span>(<span class="hljs-params">id: <span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span></span>) {
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> id === <span class="hljs-string">'string'</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ID æ˜¯å­—ç¬¦ä¸²ï¼š'</span> + id.<span class="hljs-title function_">toUpperCase</span>());
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ID æ˜¯æ•°å­—ï¼š'</span> + id.<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>));
  }
}
</code></pre>
<p>è¿™å«åš<strong>è”åˆç±»å‹</strong>ï¼Œè€Œé€šè¿‡ <code>typeof</code> åˆ¤æ–­ç±»å‹çš„è¿‡ç¨‹å«åš<strong>ç±»å‹ä¿æŠ¤</strong>ã€‚å®ƒèƒ½è®©ä½ çš„ä»£ç æ›´åŠ å®‰å…¨å’Œçµæ´»ã€‚</p>
<hr/>
<h2 data-id="heading-10">TypeScript çš„å†…ç½®ç±»å‹ï¼šè®©ä½ å°‘å†™ 100 è¡Œä»£ç </h2>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬èŠèŠ TypeScript è‡ªå¸¦çš„ä¸€äº›â€œé»‘ç§‘æŠ€â€â€”â€”å†…ç½®ç±»å‹ã€‚å®ƒä»¬å°±åƒè¶…å¸‚é‡Œçš„é€Ÿé£Ÿé£Ÿå“ï¼Œç›´æ¥æ‹¿æ¥ç”¨ï¼Œçœæ—¶çœåŠ›ã€‚ä»¥ä¸‹æ˜¯å‡ ä¸ªå¸¸ç”¨çš„â€œæ˜æ˜Ÿé€‰æ‰‹â€ï¼š</p>
<h3 data-id="heading-11">1. <code>Required&lt;T&gt;</code>ï¼šè®©ä½ çš„å±æ€§å˜å¾—â€œå¿…å¡«â€</h3>
<p>æœ‰æ—¶å€™ï¼Œä½ å®šä¹‰äº†ä¸€ä¸ªå¯¹è±¡ï¼Œä½†æŸäº›å±æ€§æ˜¯å¯é€‰çš„ï¼ˆç”¨ <code>?</code> æ ‡è®°ï¼‰ã€‚çªç„¶æœ‰ä¸€å¤©ï¼Œè€æ¿è¯´ï¼šâ€œä¸è¡Œï¼è¿™äº›å±æ€§å¿…é¡»å…¨éƒ½æœ‰ï¼â€è¿™æ—¶å€™ä½ å°±å¯ä»¥ç”¨ <code>Required&lt;T&gt;</code>ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  name?: <span class="hljs-built_in">string</span>;
  age?: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">const</span> <span class="hljs-attr">user1</span>: <span class="hljs-title class_">Required</span>&lt;<span class="hljs-title class_">User</span>&gt; = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">"å°æ˜"</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">18</span>,
}; <span class="hljs-comment">// å¦‚æœå°‘å¡«ä¸€ä¸ªå±æ€§ï¼ŒTS å°±ä¼šæŠ¥é”™</span>
</code></pre>
<p><code>Required&lt;T&gt;</code> çš„ä½œç”¨å°±æ˜¯æŠŠæ‰€æœ‰å¯é€‰å±æ€§å˜æˆå¿…å¡«å±æ€§ã€‚è€æ¿å†ä¹Ÿä¸ä¼šåœ¨ä»£ç å®¡æŸ¥æ—¶æ‹æ¡Œå­äº†ï¼</p>
<hr/>
<h3 data-id="heading-12">2. <code>Omit&lt;T, K&gt;</code>ï¼šç²¾ç¡®å‰ªè£å¯¹è±¡</h3>
<p>å‡å¦‚ä½ æœ‰ä¸€ä¸ªå¤§å¯¹è±¡ï¼Œä½†æœ‰äº›å±æ€§ä½ ä¸æƒ³è¦ï¼ˆæ¯”å¦‚è€æ¿è¦æ±‚çš„æ•°æ®ç»Ÿè®¡å­—æ®µï¼‰ï¼Œè¿™æ—¶å€™ <code>Omit&lt;T, K&gt;</code> å°±æ´¾ä¸Šç”¨åœºäº†ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">password</span>: <span class="hljs-built_in">string</span>;
}

<span class="hljs-keyword">type</span> <span class="hljs-title class_">PublicUser</span> = <span class="hljs-title class_">Omit</span>&lt;<span class="hljs-title class_">User</span>, <span class="hljs-string">"password"</span>&gt;;

<span class="hljs-keyword">const</span> <span class="hljs-attr">user2</span>: <span class="hljs-title class_">PublicUser</span> = {
  <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,
  <span class="hljs-attr">name</span>: <span class="hljs-string">"å°çº¢"</span>,
}; <span class="hljs-comment">// password è¢«æˆåŠŸâ€œå‰ªæ‰â€ï¼</span>
</code></pre>
<p><code>Omit&lt;T, K&gt;</code> çš„ä½œç”¨å°±æ˜¯ä»å¯¹è±¡ä¸­â€œå‰”é™¤â€æŸäº›å±æ€§ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œä½ åœ¨å‰ªèœå¶ï¼ŒæŠŠä¸æƒ³è¦çš„éƒ¨åˆ†ä¸¢æ‰ï¼Œåªç•™ä¸‹ç²¾åéƒ¨åˆ†ã€‚</p>
<hr/>
<h3 data-id="heading-13">3. <code>Record&lt;K, T&gt;</code>ï¼šå¿«é€Ÿç”Ÿæˆå¯¹è±¡ç±»å‹</h3>
<p>ä½ æœ‰æ²¡æœ‰é‡åˆ°è¿‡è¿™ç§æƒ…å†µï¼šéœ€è¦å®šä¹‰ä¸€ä¸ªå¯¹è±¡ï¼Œä½†é”®å’Œå€¼çš„ç±»å‹éƒ½è¦ä¸¥æ ¼æ§åˆ¶ï¼Ÿè¿™æ—¶å€™ <code>Record&lt;K, T&gt;</code> å°±æ˜¯ä½ çš„æ•‘æ˜Ÿï¼</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Role</span> = <span class="hljs-string">"admin"</span> | <span class="hljs-string">"user"</span> | <span class="hljs-string">"guest"</span>;

<span class="hljs-keyword">const</span> <span class="hljs-attr">permissions</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-title class_">Role</span>, <span class="hljs-built_in">string</span>[]&gt; = {
  <span class="hljs-attr">admin</span>: [<span class="hljs-string">"create"</span>, <span class="hljs-string">"read"</span>, <span class="hljs-string">"update"</span>, <span class="hljs-string">"delete"</span>],
  <span class="hljs-attr">user</span>: [<span class="hljs-string">"read"</span>, <span class="hljs-string">"update"</span>],
  <span class="hljs-attr">guest</span>: [<span class="hljs-string">"read"</span>],
};
</code></pre>
<p><code>Record&lt;K, T&gt;</code> çš„æ„æ€æ˜¯ï¼šâ€œæˆ‘æœ‰ä¸€å †é”®ï¼ˆKï¼‰ï¼Œæ¯ä¸ªé”®å¯¹åº”çš„å€¼éƒ½æ˜¯æŸç§ç±»å‹ï¼ˆTï¼‰ã€‚â€ç®€ç›´å°±æ˜¯æ‰¹é‡ç”Ÿäº§å¯¹è±¡ç±»å‹çš„ç¥å™¨ï¼</p>
<hr/>
<h3 data-id="heading-14">4. <code>Partial&lt;T&gt;</code>ï¼šè®©ä½ çš„å±æ€§å˜å¾—â€œéšæ„â€</h3>
<p>è·Ÿ <code>Required&lt;T&gt;</code> ç›¸åï¼Œ<code>Partial&lt;T&gt;</code> å¯ä»¥æŠŠæ¯ä¸ªå±æ€§å˜æˆå¯é€‰çš„ã€‚é€‚åˆé‚£ç§â€œéšä¾¿å¡«ç‚¹å•¥â€çš„åœºæ™¯ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">const</span> <span class="hljs-attr">user3</span>: <span class="hljs-title class_">Partial</span>&lt;<span class="hljs-title class_">User</span>&gt; = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">"å°åˆš"</span>,
}; <span class="hljs-comment">// age å¯ä»¥ä¸å†™</span>
</code></pre>
<p><code>Partial&lt;T&gt;</code> çš„å­˜åœ¨ï¼Œå°±åƒä¸€ç¢—åŠ äº†æ°´çš„ç²¥â€”â€”ç¨€é‡Šäº†çº¦æŸï¼Œä½†æ›´çµæ´»ï¼</p>
<hr/>
<h3 data-id="heading-15">5. <code>Pick&lt;T, K&gt;</code>ï¼šç²¾å‡†æŒ‘é€‰</h3>
<p>å¦‚æœ <code>Omit</code> æ˜¯å‰ªæ‰ä¸è¦çš„ä¸œè¥¿ï¼Œé‚£ <code>Pick</code> å°±æ˜¯æŒ‘å‡ºæƒ³è¦çš„ä¸œè¥¿ã€‚æ¯”å¦‚ï¼Œä½ åªå…³å¿ƒç”¨æˆ·çš„åå­—å’Œå¹´é¾„ï¼Œä¸åœ¨ä¹å…¶ä»–å­—æ®µï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">type</span> <span class="hljs-title class_">UserInfo</span> = <span class="hljs-title class_">Pick</span>&lt;<span class="hljs-title class_">User</span>, <span class="hljs-string">"name"</span> | <span class="hljs-string">"age"</span>&gt;;

<span class="hljs-keyword">const</span> <span class="hljs-attr">user4</span>: <span class="hljs-title class_">UserInfo</span> = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">"å°å¼º"</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">25</span>,
};
</code></pre>
<p><code>Pick&lt;T, K&gt;</code> çš„ä½œç”¨å°±æ˜¯ä»å¯¹è±¡ä¸­ç²¾å‡†æŒ‘å‡ºä½ éœ€è¦çš„å­—æ®µã€‚å°±åƒç‚¹èœä¸€æ ·ï¼Œåªç‚¹è‡ªå·±çˆ±åƒçš„ï¼Œä¸æµªè´¹ï¼</p>
<hr/>
<h2 data-id="heading-16">å¸¸è§å‘ï¼šå¦‚ä½•é¿å…è¢« TypeScriptâ€œå‘â€ï¼Ÿ</h2>
<p>è™½ç„¶ TypeScript å¾ˆå¼ºå¤§ï¼Œä½†å®ƒä¹Ÿæœ‰ä¸å°‘å‘ç­‰ç€ä½ è·³ã€‚ä»¥ä¸‹æ˜¯å‡ ä¸ªå¸¸è§çš„â€œé›·åŒºâ€ï¼Œå¸Œæœ›ä½ èƒ½ç»•å¼€ã€‚</p>
<h3 data-id="heading-17">å‘ 1ï¼šç±»å‹å¤ªå¤æ‚</h3>
<p>æœ‰æ—¶å€™ï¼Œä¸ºäº†è¿½æ±‚å®Œç¾ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå†™å‡ºéå¸¸å¤æ‚çš„ç±»å‹å®šä¹‰ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">ComplexType</span> = { <span class="hljs-attr">a</span>: <span class="hljs-built_in">string</span> } &amp; { <span class="hljs-attr">b</span>: <span class="hljs-built_in">number</span> } &amp; { <span class="hljs-attr">c</span>: <span class="hljs-built_in">boolean</span> };
</code></pre>
<p>è¿™ç§ç±»å‹è™½ç„¶çœ‹èµ·æ¥å¾ˆé…·ï¼Œä½†ç»´æŠ¤èµ·æ¥éå¸¸éº»çƒ¦ï¼æ‰€ä»¥ï¼Œå°½é‡ä¿æŒç®€å•ï¼Œåˆ«ç»™è‡ªå·±æŒ–å‘ã€‚</p>
<h3 data-id="heading-18">å‘ 2ï¼šå¿½ç•¥ç±»å‹å®šä¹‰æ–‡ä»¶</h3>
<p>å½“ä½ ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“æ—¶ï¼Œå¦‚æœæ²¡æœ‰ä¸ºå®ƒä»¬æä¾›ç±»å‹å®šä¹‰æ–‡ä»¶ï¼ˆ<code>.d.ts</code>ï¼‰ï¼ŒTypeScript å°±æ— æ³•è¿›è¡Œç±»å‹æ£€æŸ¥ã€‚è¿™æ—¶å€™ï¼Œä½ å¯ä»¥å» <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FDefinitelyTyped%2FDefinitelyTyped" target="_blank" title="https://github.com/DefinitelyTyped/DefinitelyTyped" ref="nofollow noopener noreferrer">DefinitelyTyped</a> æ‰¾æ‰¾çœ‹æœ‰æ²¡æœ‰å¯¹åº”çš„å®šä¹‰æ–‡ä»¶ã€‚å¦‚æœæ²¡æœ‰ï¼Œå°±è‡ªå·±åŠ¨æ‰‹ä¸°è¡£è¶³é£Ÿå§ï¼</p>
<h3 data-id="heading-19">å‘ 3ï¼šè¯¯ç”¨ç±»å‹æ–­è¨€</h3>
<p>ç±»å‹æ–­è¨€æ˜¯å‘Šè¯‰ TypeScriptï¼šâ€œç›¸ä¿¡æˆ‘ï¼Œæˆ‘çŸ¥é“è¿™ä¸ªå˜é‡çš„çœŸå®ç±»å‹ã€‚â€æ¯”å¦‚ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">let</span> <span class="hljs-attr">someValue</span>: <span class="hljs-built_in">any</span> = <span class="hljs-string">'hello'</span>;
<span class="hljs-keyword">let</span> <span class="hljs-attr">strLength</span>: <span class="hljs-built_in">number</span> = (someValue <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>).<span class="hljs-property">length</span>;
</code></pre>
<p>è™½ç„¶ç±»å‹æ–­è¨€å¾ˆå¥½ç”¨ï¼Œä½†æ»¥ç”¨å®ƒå¯èƒ½ä¼šå¯¼è‡´ç¾éš¾æ€§çš„åæœï¼æ‰€ä»¥ï¼Œåœ¨ä½¿ç”¨ä¹‹å‰ï¼Œä¸€å®šè¦ç¡®ä¿ä½ çš„æ–­è¨€æ˜¯æ­£ç¡®çš„ã€‚</p>
<hr/>
<h2 data-id="heading-20">æ€»ç»“</h2>
<p>TypeScript å°±åƒä¸€æŠŠåŒåˆƒå‰‘ï¼Œç”¨å¾—å¥½ï¼Œå®ƒèƒ½å¸®ä½ å†™å‡ºæ›´ä¼˜é›…ã€æ›´å®‰å…¨çš„ä»£ç ï¼›ç”¨å¾—ä¸å¥½ï¼Œå®ƒä¹Ÿèƒ½è®©ä½ æŠ“ç‹‚åˆ°æƒ³ç ¸é”®ç›˜ã€‚ä½†ä¸ç®¡æ€ä¹ˆè¯´ï¼Œå­¦ä¹  TypeScript æ˜¯ä¸€ä¸ªéå¸¸å€¼å¾—æŠ•å…¥æ—¶é—´å’Œç²¾åŠ›çš„äº‹æƒ…ã€‚</p>
<p>æœ€åï¼Œæˆ‘é€å¤§å®¶ä¸€å¥è¯ï¼š<strong>â€œå­¦ TypeScript å°±åƒè°ˆæ‹çˆ±ï¼Œä¸€å¼€å§‹è§‰å¾—éº»çƒ¦ï¼Œä½†æ—¶é—´ä¹…äº†å°±ç¦»ä¸å¼€äº†ã€‚â€</strong></p>
<p>å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®åˆ°æƒ³å…¥é—¨ TypeScript çš„åŒå­¦ã€‚å¦‚æœä½ è¿˜æœ‰å…¶ä»–é—®é¢˜ï¼Œæ¬¢è¿ç•™è¨€ï¼Œæˆ‘ä»¬ä¸€èµ·äº¤æµã€ä¸€èµ·æˆé•¿ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[npm install æ ¸å¿ƒæµç¨‹]]></title>    <link>https://juejin.cn/post/7598459769238437922</link>    <guid>https://juejin.cn/post/7598459769238437922</guid>    <pubDate>2026-01-24T05:15:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598459769238437922" data-draft-id="7598465042967789608" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="npm install æ ¸å¿ƒæµç¨‹"/> <meta itemprop="keywords" content="NPM,Vue.js"/> <meta itemprop="datePublished" content="2026-01-24T05:15:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¦‚æœä½ å¥½"/> <meta itemprop="url" content="https://juejin.cn/user/2272012281328215"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            npm install æ ¸å¿ƒæµç¨‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2272012281328215/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¦‚æœä½ å¥½
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T05:15:33.000Z" title="Sat Jan 24 2026 05:15:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">npm install æ ¸å¿ƒæµç¨‹</h2>
<p>ä½œä¸ºå‰ç«¯å¼€å‘ï¼Œ<code>npm install</code> å¤©å¤©ç”¨ï¼Œä½†è¿™è¡Œç®€å•çš„å‘½ä»¤èƒŒåï¼Œnpm å…¶å®æŒ‰å›ºå®šæµç¨‹æŠŠä¾èµ–å®‰è£…çš„äº‹å®‰æ’å¾—æ˜æ˜ç™½ç™½ï¼ä¸ç”¨æ·±ç©¶åº•å±‚åŸç†ï¼Œè¿™ç¯‡æ–‡ç« ç”¨æœ€ç›´ç™½çš„è¯è®²æ¸…æ ¸å¿ƒæ­¥éª¤ï¼Œçœ‹å®Œç§’æ‡‚ï¼Œè½»æ¾è§£å†³æ—¥å¸¸å®‰è£…ä¾èµ–çš„å°é—®é¢˜ï½</p>
<h3 data-id="heading-1">ç¬¬ä¸€æ­¥ï¼šå…ˆæ‰¾é…ç½®ï¼Œå®šå¥½å®‰è£…è§„åˆ™</h3>
<p>æ‰§è¡Œ <code>npm install</code> åï¼Œnpm ç¬¬ä¸€æ­¥ä¸ä¸‹è½½ï¼Œå…ˆ<strong>æŸ¥æ‰¾é¡¹ç›®å’Œç³»ç»Ÿçš„é…ç½®æ–‡ä»¶</strong>ï¼ˆæ¯”å¦‚<code>.npmrc</code>ï¼‰ï¼Œç¡®å®šè¿™äº›å…³é”®ä¿¡æ¯ï¼š</p>
<ul>
<li>ä¾èµ–ä»å“ªä¸‹è½½ï¼ˆé•œåƒæºï¼Œæ¯”å¦‚å›½å†…å¸¸ç”¨çš„æ·˜å®é•œåƒï¼‰</li>
<li>ä¸‹è½½çš„åŒ…å­˜åœ¨å“ªï¼ˆç¼“å­˜ç›®å½•ï¼Œé¿å…é‡å¤ä¸‹è½½ï¼‰</li>
<li>å®‰è£…åˆ°å“ªä¸ªè·¯å¾„ï¼ˆé»˜è®¤é¡¹ç›®æ ¹ç›®å½•çš„<code>node_modules</code>ï¼‰</li>
</ul>
<p>ç®€å•è¯´ï¼Œå°±æ˜¯å…ˆâ€œå®šè§„çŸ©â€ï¼Œå†å¼€å§‹å¹²æ´»ï½</p>
<h3 data-id="heading-2">ç¬¬äºŒæ­¥ï¼šæ ¸å¿ƒåˆ†æ”¯åˆ¤æ–­ï¼æœ‰æ²¡æœ‰package-lock.jsonï¼Ÿ</h3>
<p>è¿™æ˜¯æ•´ä¸ªå®‰è£…æµç¨‹çš„<strong>å…³é”®åˆ†å‰å£</strong>ï¼Œnpm ä¼šå…ˆæ£€æŸ¥é¡¹ç›®æ ¹ç›®å½•æœ‰æ²¡æœ‰<code>package-lock.json</code>æ–‡ä»¶ï¼ˆä¾èµ–ç‰ˆæœ¬å¿«ç…§ï¼Œè®°å½•ä¸Šä¸€æ¬¡å®‰è£…çš„ç²¾ç¡®ä¾èµ–ä¿¡æ¯ï¼‰ï¼Œåˆ†ä¸¤ç§æƒ…å†µå¤„ç†ï¼Œæ ¸å¿ƒéƒ½æ˜¯ä¸ºäº†<strong>ä¿è¯ç‰ˆæœ¬ä¸€è‡´ã€æå‡å®‰è£…é€Ÿåº¦</strong>ã€‚</p>
<h4 data-id="heading-3">æƒ…å†µ1ï¼šæœ‰package-lock.jsonæ–‡ä»¶</h4>
<ol>
<li>
<p><strong>å…ˆæ ¡éªŒç‰ˆæœ¬ä¸€è‡´æ€§</strong>
æ£€æŸ¥lockæ–‡ä»¶é‡Œçš„ä¾èµ–ç‰ˆæœ¬ï¼Œæ˜¯å¦ç¬¦åˆ<code>package.json</code>é‡Œçš„ç‰ˆæœ¬èŒƒå›´ï¼ˆæ¯”å¦‚<code>package.json</code>å†™<code>^2.0.0</code>ï¼Œlockæ–‡ä»¶é‡Œ2.1.0ã€2.2.0éƒ½ç®—ç¬¦åˆï¼‰ã€‚
ç¬¦åˆï¼šæŒ‰lockæ–‡ä»¶çš„ç²¾ç¡®ç‰ˆæœ¬ç»§ç»­ï¼›
ä¸ç¬¦åˆï¼šå¿½ç•¥æ—§lockæ–‡ä»¶ï¼ŒæŒ‰<code>package.json</code>é‡æ–°å¤„ç†ã€‚</p>
</li>
<li>
<p><strong>æ‹‰å–åŒ…ä¿¡æ¯ï¼Œæ„å»ºå¹¶æ‰å¹³åŒ–ä¾èµ–æ ‘</strong>
æŒ‰lockæ–‡ä»¶çš„ä¿¡æ¯ï¼Œä»é•œåƒæºè·å–ä¾èµ–çš„å…ƒæ•°æ®ï¼Œæ¥ç€æ„å»ºä¾èµ–æ ‘ï¼ˆé¡¹ç›®ä¾èµ–çš„åŒ…æ˜¯ä¸€çº§ä¾èµ–ï¼ŒåŒ…åˆä¾èµ–çš„åŒ…æ˜¯äºŒçº§ä¾èµ–ï¼Œä»¥æ­¤ç±»æ¨ï¼‰ã€‚
å…³é”®æ“ä½œ<strong>æ‰å¹³åŒ–å¤„ç†</strong>ï¼šæŠŠèƒ½å…±äº«çš„å­ä¾èµ–æå‡åˆ°<code>node_modules</code>æ ¹ç›®å½•ï¼Œé¿å…å±‚çº§è¿‡æ·±ã€é‡å¤å®‰è£…ï¼Œçœç©ºé—´åˆå¿«ï¼</p>
</li>
<li>
<p><strong>ç¼“å­˜åˆ¤æ–­ï¼Œå®‰è£…ä¾èµ–+æ›´æ–°lockæ–‡ä»¶</strong></p>
<ul>
<li>æœ‰ç¼“å­˜ï¼šç›´æ¥æŠŠç¼“å­˜é‡Œçš„åŒ…è§£å‹åˆ°<code>node_modules</code>ï¼Œä¸ç”¨é‡æ–°ä¸‹è½½ï¼›</li>
<li>æ— ç¼“å­˜ï¼šä»é•œåƒæºä¸‹è½½åŒ…â†’æ£€æŸ¥æ–‡ä»¶å®Œæ•´æ€§ï¼ˆé˜²æ­¢æŸåï¼‰â†’å­˜å…¥ç¼“å­˜ï¼ˆä¸‹æ¬¡ç”¨ï¼‰â†’è§£å‹åˆ°<code>node_modules</code>ï¼›
æœ€åæ›´æ–°lockæ–‡ä»¶ï¼Œä¿è¯å¿«ç…§æœ€æ–°ã€‚</li>
</ul>
</li>
</ol>
<h4 data-id="heading-4">æƒ…å†µ2ï¼šæ²¡æœ‰package-lock.jsonæ–‡ä»¶</h4>
<p>æ²¡æœ‰lockæ–‡ä»¶å°±ç®€å•äº†ï¼Œç›´æ¥æŒ‰<code>package.json</code>æ¥ï¼Œæ­¥éª¤å°‘äº†ç‰ˆæœ¬æ ¡éªŒï¼Œå…¶ä½™å’Œä¸Šé¢ä¸€è‡´ï¼š
<strong>æ‹‰å–è¿œç¨‹åŒ…ä¿¡æ¯â†’æ„å»ºå¹¶æ‰å¹³åŒ–ä¾èµ–æ ‘â†’ç¼“å­˜åˆ¤æ–­ï¼ˆæœ‰åˆ™è§£å‹ï¼Œæ— åˆ™ä¸‹è½½+å­˜ç¼“å­˜ï¼‰â†’è§£å‹åˆ°<code>node_modules</code>â†’ç”Ÿæˆå…¨æ–°çš„lockæ–‡ä»¶</strong>ï¼Œä¸ºä¸‹ä¸€æ¬¡å®‰è£…ç•™å¥½ç²¾ç¡®ç‰ˆæœ¬å¿«ç…§ã€‚</p>
<h3 data-id="heading-5">æ ¸å¿ƒæµç¨‹ä¸€å¥è¯æ€»ç»“</h3>
<pre><code class="hljs language-csharp" lang="csharp">è¾“å…¥ npm install â†’ æŸ¥æ‰¾å¹¶åŠ è½½é…ç½®æ–‡ä»¶ï¼ˆ.npmrc ç­‰ï¼‰
â†’ æ£€æŸ¥é¡¹ç›®æ ¹ç›®å½•æ˜¯å¦æœ‰ package-<span class="hljs-keyword">lock</span>.jsonï¼Ÿ
  â†’ æ˜¯ â†’ æ ¡éªŒ <span class="hljs-keyword">lock</span> æ–‡ä»¶ä¸ package.json ç‰ˆæœ¬æ˜¯å¦ä¸€è‡´ï¼Ÿ
    â†’ ä¸€è‡´ â†’ æ‹‰å–è¿œç¨‹åŒ…ä¿¡æ¯ â†’ æ„å»ºä¾èµ–æ ‘ï¼ˆæ‰å¹³åŒ–ï¼‰â†’ æ£€æŸ¥ç¼“å­˜ï¼Ÿ
      â†’ æœ‰ â†’ è§£å‹ç¼“å­˜åˆ° node_modules â†’ æ›´æ–° <span class="hljs-keyword">lock</span> æ–‡ä»¶
      â†’ æ—  â†’ ä¸‹è½½ä¾èµ– â†’ æ ¡éªŒå®Œæ•´æ€§ â†’ å­˜å…¥ç¼“å­˜ â†’ è§£å‹åˆ° node_modules â†’ æ›´æ–° <span class="hljs-keyword">lock</span> æ–‡ä»¶
    â†’ ä¸ä¸€è‡´ â†’ æŒ‰ package.json é‡æ–°æ‹‰å–åŒ…ä¿¡æ¯ â†’ æ„å»ºä¾èµ–æ ‘ï¼ˆæ‰å¹³åŒ–ï¼‰â†’ ç¼“å­˜åˆ¤æ–­ä¸å®‰è£… â†’ ç”Ÿæˆ/æ›´æ–° <span class="hljs-keyword">lock</span> æ–‡ä»¶
  â†’ å¦ â†’ æ‹‰å–è¿œç¨‹åŒ…ä¿¡æ¯ï¼ˆåŸºäº package.jsonï¼‰â†’ æ„å»ºä¾èµ–æ ‘ï¼ˆæ‰å¹³åŒ–ï¼‰â†’ ç¼“å­˜åˆ¤æ–­ä¸å®‰è£… â†’ ç”Ÿæˆ <span class="hljs-keyword">lock</span> æ–‡ä»¶
â†’ å®‰è£…å®Œæˆ 
</code></pre>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9ea84a8f8257489a80e49e914ffbd896~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aaC5p6c5L2g5aW9:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769836532&amp;x-signature=BhR7VPrvrRYP8MiT3P4QKY8JqDs%3D" alt="npm install æ ¸å¿ƒæµç¨‹.png" loading="lazy"/></p>
<h3 data-id="heading-6">æ—¥å¸¸å¼€å‘</h3>
<h4 data-id="heading-7">1. ç¼“å­˜è¶…æœ‰ç”¨ï¼Œå‡ºé—®é¢˜æ¸…ä¸€åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°</h4>
<p>ä¸‹
ç¼“å­˜æ˜¯npmæé€Ÿçš„å…³é”®ï¼Œç¬¬ä¸€æ¬¡ä¸‹è½½çš„åŒ…ä¼šå­˜èµ·æ¥ï¼Œåç»­å®‰è£…ç›´æ¥å¤ç”¨ã€‚å¦‚æœé‡åˆ°å®‰è£…æŠ¥é”™ã€åŒ…æŸåï¼Œæ‰§è¡Œ<code>npm cache clean --force</code>å¼ºåˆ¶æ¸…ç¼“å­˜ï¼Œé‡æ–°å®‰è£…å¤§æ¦‚ç‡è§£å†³ã€‚</p>
<h4 data-id="heading-8">2. package-lock.jsonåˆ«éšä¾¿åˆ /æ”¹</h4>
<p>è¿™ä¸ªæ–‡ä»¶æ˜¯å›¢é˜Ÿåä½œã€ç”Ÿäº§ç¯å¢ƒçš„â€œç‰ˆæœ¬ä¿éšœâ€ï¼Œåˆ äº†é‡æ–°å®‰è£…å¯èƒ½å¯¼è‡´ä¾èµ–ç‰ˆæœ¬å˜åŒ–ï¼Œé¡¹ç›®å‡ºé—®é¢˜ã€‚çœŸè¦æ”¹ç‰ˆæœ¬ï¼Œå…ˆæ”¹<code>package.json</code>ï¼Œå†é‡æ–°<code>npm install</code>è‡ªåŠ¨æ›´æ–°lockæ–‡ä»¶ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¼€ç®±å³ç”¨çš„ HarmonyOS é€šç”¨è„šæ‰‹æ¶]]></title>    <link>https://juejin.cn/post/7598459769238454306</link>    <guid>https://juejin.cn/post/7598459769238454306</guid>    <pubDate>2026-01-24T05:17:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598459769238454306" data-draft-id="7598465042967756840" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¼€ç®±å³ç”¨çš„ HarmonyOS é€šç”¨è„šæ‰‹æ¶"/> <meta itemprop="keywords" content="å‰ç«¯,HarmonyOS,APP"/> <meta itemprop="datePublished" content="2026-01-24T05:17:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JokerX"/> <meta itemprop="url" content="https://juejin.cn/user/2892167937262916"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¼€ç®±å³ç”¨çš„ HarmonyOS é€šç”¨è„šæ‰‹æ¶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2892167937262916/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JokerX
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T05:17:47.000Z" title="Sat Jan 24 2026 05:17:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>HarmonyKit æ˜¯ä¸€ä¸ªåŸºäº ArkTS + ArkUI çš„ HarmonyOS å¿«é€Ÿå¼€å‘æ¡†æ¶ï¼Œå†…ç½®ç½‘ç»œã€åˆ†é¡µã€æ•°æ®åº“ã€çŠ¶æ€ç®¡ç†ã€å¯¼èˆªã€å±å¹•é€‚é…ç­‰å¸¸ç”¨èƒ½åŠ›ï¼Œæ”¯æŒæ·±è‰²æ¨¡å¼ã€å›½é™…åŒ–ã€å¤šç«¯é€‚é…ï¼Œæ¬¢è¿ä¸€èµ·å­¦ä¹ äº¤æµã€‚</p>
<h2 data-id="heading-0">é¡¹ç›®äº®ç‚¹</h2>
<ul>
<li><strong>å¼€ç®±å³ç”¨</strong>ï¼šå†…ç½®ç½‘ç»œã€åˆ†é¡µã€æ•°æ®åº“ã€çŠ¶æ€ç®¡ç†ç­‰åŸºç¡€èƒ½åŠ›ï¼Œæ— éœ€é‡å¤æ­å»º</li>
<li><strong>å®Œæ•´ç¤ºä¾‹</strong>ï¼šæ¯ä¸ªåŠŸèƒ½æ¨¡å—éƒ½æä¾›å¯è¿è¡Œçš„ç¤ºä¾‹ä»£ç ï¼Œå¿«é€Ÿä¸Šæ‰‹</li>
<li><strong>æ¨¡å—åŒ–æ¶æ„</strong>ï¼šæ¸…æ™°çš„åˆ†å±‚è®¾è®¡ï¼Œå‚è€ƒå®˜æ–¹æœ€ä½³å®è·µ</li>
<li><strong>ç°ä»£åŒ–æŠ€æœ¯æ ˆ</strong>ï¼šArkTS + ArkUI + V2 çŠ¶æ€ç®¡ç†ï¼Œæ‹¥æŠ±æœ€æ–°æŠ€æœ¯</li>
<li><strong>å±å¹•é€‚é…</strong>ï¼šå®Œæ•´æ”¯æŒæ‰‹æœº/æŠ˜å å±/å¹³æ¿å¤šç§è®¾å¤‡å½¢æ€</li>
<li><strong>æ·±è‰²æ¨¡å¼</strong>ï¼šå®Œæ•´æ”¯æŒæµ…è‰²/æ·±è‰²ä¸»é¢˜åŠ¨æ€åˆ‡æ¢</li>
<li><strong>å›½é™…åŒ–æ”¯æŒ</strong>ï¼šæ”¯æŒä¸­è‹±æ–‡è¯­è¨€åˆ‡æ¢</li>
<li><strong>åœ¨çº¿æ–‡æ¡£</strong>ï¼šä¸ä»£ç åŒæ­¥çš„è¯¦ç»†æ–‡æ¡£ï¼Œä¾¿äºå­¦ä¹ å’Œå®šåˆ¶</li>
</ul>
<blockquote>
<p>å¦‚æœé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ª Star æ”¯æŒ â­ è¿™å¯¹æˆ‘æ¥è¯´å¾ˆé‡è¦ï¼Œèƒ½ç»™æˆ‘å¸¦æ¥é•¿æœŸæ›´æ–°ç»´æŠ¤çš„åŠ¨åŠ›ï¼</p>
</blockquote>
<blockquote>
<p><strong>é¡¹ç›®åœ°å€</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJoker-x-dev%2FHarmonyKit" target="_blank" title="https://github.com/Joker-x-dev/HarmonyKit" ref="nofollow noopener noreferrer">GitHub</a> | <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2FJoker-x-dev%2FHarmonyKit" target="_blank" title="https://gitee.com/Joker-x-dev/HarmonyKit" ref="nofollow noopener noreferrer">Gitee</a>
<strong>åœ¨çº¿æ–‡æ¡£</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fharmony.dusksnow.top" target="_blank" title="https://harmony.dusksnow.top" ref="nofollow noopener noreferrer">harmony.dusksnow.top</a></p>
</blockquote>
<h2 data-id="heading-1">é¡¹ç›®é¢„è§ˆ</h2>
<blockquote>
<p>ğŸ’¡ <strong>è¯´æ˜</strong>ï¼šæ¡†æ¶æä¾›äº†å¤šç§ç¤ºä¾‹é¡µé¢ï¼Œå±•ç¤ºå„é¡¹èƒ½åŠ›çš„ä½¿ç”¨æ–¹å¼ï¼Œæ”¯æŒæ‰‹æœºã€æŠ˜å å±ã€å¹³æ¿ç­‰å¤šç§è®¾å¤‡å½¢æ€ã€‚</p>
</blockquote>
<h3 data-id="heading-2">ğŸ“± æ‰‹æœº</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6fa602d8605647298b02d4fd047ac875~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSm9rZXJY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769836667&amp;x-signature=F7KNFbdd%2BROPAPRfH881hisiwEI%3D" alt="æ‰‹æœºç«¯é¢„è§ˆ" loading="lazy"/></p>
<h3 data-id="heading-3">ğŸ“± æŠ˜å å±</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/50ed28b9c37547dc8b1c5a6223e17b98~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSm9rZXJY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769836667&amp;x-signature=zSlOCazSGKiqbNSPbVz30mWnrSY%3D" alt="æŠ˜å å±é¢„è§ˆ" loading="lazy"/></p>
<h3 data-id="heading-4">ğŸ“± å¹³æ¿</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19527704d44148798ec1f6024e247c04~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSm9rZXJY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769836667&amp;x-signature=ycgJEfjSGKfYHceoj%2BngnRJXm%2B4%3D" alt="å¹³æ¿é¢„è§ˆ" loading="lazy"/></p>
<h2 data-id="heading-5">æ¶æ„è®¾è®¡</h2>
<p>HarmonyKit é‡‡ç”¨æ¨¡å—åŒ–åˆ†å±‚æ¶æ„ï¼Œå‚è€ƒå®˜æ–¹æœ€ä½³å®è·µï¼Œä»ä¸Šåˆ°ä¸‹åˆ†ä¸ºä¸‰å±‚ï¼š</p>
<h3 data-id="heading-6">ä¸šåŠ¡å±‚ï¼ˆFeatureï¼‰</h3>
<ul>
<li><strong>åŠŸèƒ½æ¨¡å—</strong>ï¼šæŒ‰ä¸šåŠ¡åŸŸæ‹†åˆ†ï¼ˆè®¤è¯ã€ç”¨æˆ·ã€ç¤ºä¾‹ç­‰ï¼‰</li>
<li><strong>MVVM æ¨¡å¼</strong>ï¼šView + ViewModel åˆ†ç¦»ï¼Œç”Ÿå‘½å‘¨æœŸç»Ÿä¸€ç®¡ç†</li>
<li><strong>é¡µé¢å…¥å£</strong>ï¼šæ¯ä¸ªé¡µé¢æä¾›ç‹¬ç«‹çš„ <code>@Builder</code> å…¥å£</li>
</ul>
<h3 data-id="heading-7">æ ¸å¿ƒå±‚ï¼ˆCoreï¼‰</h3>
<ul>
<li><strong>base</strong>ï¼šåŸºç¡€çˆ¶ç±»ä¸åŸºç¡€èƒ½åŠ›å°è£…ï¼ˆBaseViewModelã€BaseNetWorkViewModelã€BaseNetWorkListViewModelï¼‰</li>
<li><strong>data</strong>ï¼šç»Ÿä¸€æ•°æ®å…¥å£ï¼Œå°è£…ä»“åº“å±‚ï¼Œèšåˆç½‘ç»œã€æ•°æ®åº“ä¸æœ¬åœ°å­˜å‚¨</li>
<li><strong>database</strong>ï¼šæœ¬åœ°æ•°æ®åº“èƒ½åŠ›ï¼ˆIBest-ORMï¼‰</li>
<li><strong>datastore</strong>ï¼šè½»é‡çº§æœ¬åœ°å­˜å‚¨</li>
<li><strong>designsystem</strong>ï¼šè®¾è®¡ç³»ç»Ÿä¸å…¨å±€æ ·å¼è§„èŒƒï¼ˆé¢œè‰²ã€é—´è·ã€å­—ä½“ï¼‰</li>
<li><strong>ibestui</strong>ï¼šIBest UI ç»„ä»¶åº“çš„å°è£…ä¸é€‚é…å±‚</li>
<li><strong>model</strong>ï¼šæ•°æ®æ¨¡å‹ä¸å®ä½“å®šä¹‰</li>
<li><strong>navigation</strong>ï¼šå¯¼èˆªèƒ½åŠ›ä¸è·¯ç”±åŸºç¡€è®¾æ–½</li>
<li><strong>network</strong>ï¼šç½‘ç»œè¯·æ±‚åŸºç¡€èƒ½åŠ›ï¼ˆDataSourceã€æ‹¦æˆªå™¨ï¼‰</li>
<li><strong>result</strong>ï¼šç»Ÿä¸€ç»“æœå°è£…ä¸é”™è¯¯å¤„ç†ï¼ˆRequestHelperï¼‰</li>
<li><strong>state</strong>ï¼šå…¨å±€çŠ¶æ€ç®¡ç†ï¼ˆV2 çŠ¶æ€ç®¡ç†ï¼‰</li>
<li><strong>ui</strong>ï¼šé€šç”¨ UI ç»„ä»¶ï¼ˆBaseNetWorkViewã€BaseNetWorkListViewã€RefreshLayoutï¼‰</li>
<li><strong>util</strong>ï¼šå·¥å…·ç±»ï¼ˆToastUtilsã€LogUtilsï¼‰</li>
</ul>
<h3 data-id="heading-8">å…¥å£å±‚ï¼ˆEntryï¼‰</h3>
<ul>
<li><strong>åº”ç”¨å…¥å£</strong>ï¼šåº”ç”¨å¯åŠ¨æµç¨‹ä¸è·¯ç”±æ³¨å†Œ</li>
<li><strong>é€‚é…å™¨</strong>ï¼šçª—å£é€‚é…å™¨ï¼ˆå®‰å…¨åŒºã€æ–­ç‚¹ç›‘å¬ï¼‰</li>
</ul>
<h3 data-id="heading-9">ä¾èµ–å…³ç³»</h3>
<ul>
<li><strong>feature ä¾èµ– core</strong>ï¼šä¸šåŠ¡æ¨¡å—å¯ä½¿ç”¨ core çš„åŸºç¡€èƒ½åŠ›</li>
<li><strong>feature ä¸ç›´æ¥ä¾èµ– network / database</strong>ï¼šä¸šåŠ¡æ¨¡å—é€šè¿‡ <code>data</code> æ¨¡å—å†…çš„ä»“åº“ä½œä¸ºç»Ÿä¸€æ•°æ®å…¥å£</li>
<li><strong>data èšåˆåº•å±‚èƒ½åŠ›</strong>ï¼š<code>data</code> è´Ÿè´£æ•´åˆ <code>network</code>ã€<code>database</code>ã€<code>datastore</code></li>
<li><strong>æ¨¡å—é—´ä¸äº’ç›¸ä¾èµ–</strong>ï¼šfeature ä¹‹é—´ä¿æŒéš”ç¦»ï¼Œé¿å…äº¤å‰ä¾èµ–</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d7f811a09ba48cbb6fb6951b76afc95~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSm9rZXJY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769836667&amp;x-signature=CI0gk7CMOLNGsPi%2FVss42PQhiqA%3D" alt="æ¶æ„å›¾" loading="lazy"/></p>
<blockquote>
<p>æ¶æ„å›¾æ¥è‡ªåä¸ºå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fbest-practices-V5%2Fbpta-layered-architecture-design-V5" target="_blank" title="https://developer.huawei.com/consumer/cn/doc/best-practices-V5/bpta-layered-architecture-design-V5" ref="nofollow noopener noreferrer">åˆ†å±‚æ¶æ„è®¾è®¡</a></p>
</blockquote>
<h2 data-id="heading-10">æŠ€æœ¯æ ˆ</h2>








































<table><thead><tr><th>ç±»åˆ«</th><th>æŠ€æœ¯é€‰å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>ç¼–ç¨‹è¯­è¨€</td><td>ArkTS</td><td>HarmonyOS NEXT ä¸»æµè¯­è¨€</td></tr><tr><td>UI æ¡†æ¶</td><td>ArkUI</td><td>å£°æ˜å¼ UI æ¡†æ¶</td></tr><tr><td>æ¶æ„æ¨¡å¼</td><td>MVVM</td><td>View + ViewModel åˆ†ç¦»</td></tr><tr><td>çŠ¶æ€ç®¡ç†</td><td>V2ï¼ˆObservedV2/AppStorageV2ï¼‰</td><td>æ–°ç‰ˆçŠ¶æ€ç®¡ç†èƒ½åŠ›</td></tr><tr><td>æ•°æ®åº“</td><td>IBest-ORM</td><td>æœ¬åœ°æ•°æ®åº“èƒ½åŠ›</td></tr><tr><td>ç»„ä»¶åº“</td><td>IBest-UI-V2</td><td>ä¸šåŠ¡ç»„ä»¶åº“ä¸åŸºç¡€æ§ä»¶å°è£…</td></tr></tbody></table>
<h2 data-id="heading-11">æ ¸å¿ƒèƒ½åŠ›</h2>
<h3 data-id="heading-12">1. ç½‘ç»œè¯·æ±‚å°è£…</h3>
<p>åŸºäº Axios çš„ç½‘ç»œè¯·æ±‚å°è£…ï¼Œé‡‡ç”¨ <strong>DataSource â†’ Repository â†’ ViewModel</strong> ä¸‰å±‚æ¶æ„ï¼Œæ¡†æ¶è‡ªåŠ¨å¤„ç†é”™è¯¯ã€loadingã€toast ç­‰é€šç”¨é€»è¾‘ã€‚</p>
<p><strong>åŠŸèƒ½ç‰¹æ€§ï¼š</strong></p>
<ul>
<li>ç»Ÿä¸€ç®¡ç† Axios å®ä¾‹ä¸åŸºç¡€é…ç½®ï¼ˆbaseUrlã€timeoutã€headersï¼‰</li>
<li>è‡ªåŠ¨å¤„ç† Token æ³¨å…¥ä¸åˆ·æ–°</li>
<li>è‡ªåŠ¨é”™è¯¯å¤„ç†ä¸ Toast æç¤º</li>
<li>è‡ªåŠ¨æ—¥å¿—æ‹¦æˆª</li>
<li>ç±»å‹å®‰å…¨çš„æ•°æ®æºæ¥å£</li>
</ul>
<p><strong>ä½¿ç”¨æ¡ˆä¾‹ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@ObservedV2</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NetworkRequestViewModel</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BaseViewModel</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">repository</span>: <span class="hljs-title class_">GoodsRepository</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GoodsRepository</span>();

  <span class="hljs-comment">// åªéœ€ä¼ é€’ä»“åº“æ–¹æ³•ï¼Œæ¡†æ¶è‡ªåŠ¨å¤„ç†é”™è¯¯</span>
  <span class="hljs-title function_">requestGoodsDetail</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">RequestHelper</span>.<span class="hljs-property">repository</span>&lt;<span class="hljs-title class_">Goods</span>&gt;(<span class="hljs-variable language_">this</span>.<span class="hljs-property">repository</span>.<span class="hljs-title function_">getGoodsInfo</span>(<span class="hljs-string">"1"</span>))
      .<span class="hljs-title function_">loading</span>(<span class="hljs-literal">true</span>)  <span class="hljs-comment">// è¯·æ±‚è¿‡ç¨‹æ˜¾ç¤º loading</span>
      .<span class="hljs-title function_">toast</span>(<span class="hljs-literal">true</span>)   <span class="hljs-comment">// ä¸šåŠ¡å¤±è´¥è‡ªåŠ¨å¼¹å‡º toast</span>
      .<span class="hljs-title function_">execute</span>()
      .<span class="hljs-title function_">then</span>((<span class="hljs-attr">data</span>: <span class="hljs-title class_">Goods</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {
        <span class="hljs-comment">// åªéœ€å¤„ç†æˆåŠŸé€»è¾‘</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"å•†å“è¯¦æƒ…ï¼š"</span>, data);
      });
  }
}
</code></pre>
<p><strong>å•æ¬¡è¯·æ±‚åœºæ™¯ï¼ˆè‡ªåŠ¨å¤„ç†åŠ è½½ã€é”™è¯¯ã€æˆåŠŸçŠ¶æ€ï¼‰ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ViewModel ç»§æ‰¿ BaseNetWorkViewModel</span>
<span class="hljs-meta">@ObservedV2</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NetworkDemoViewModel</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BaseNetWorkViewModel</span>&lt;<span class="hljs-title class_">Goods</span>&gt; {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">repository</span>: <span class="hljs-title class_">GoodsRepository</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GoodsRepository</span>();

  <span class="hljs-comment">// åªéœ€å®ç°è¿™ä¸€ä¸ªæ–¹æ³•</span>
  <span class="hljs-keyword">protected</span> <span class="hljs-title function_">requestRepository</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">NetworkResponse</span>&lt;<span class="hljs-title class_">Goods</span>&gt;&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">repository</span>.<span class="hljs-title function_">getGoodsInfo</span>(<span class="hljs-string">"1"</span>);
  }
}

<span class="hljs-comment">// é¡µé¢ä½¿ç”¨ BaseNetWorkView è‡ªåŠ¨å¤„ç†çŠ¶æ€</span>
<span class="hljs-meta">@ComponentV2</span>
<span class="hljs-keyword">export</span> struct <span class="hljs-title class_">NetworkDemoPage</span> {
  <span class="hljs-meta">@Local</span>
  <span class="hljs-keyword">private</span> <span class="hljs-attr">vm</span>: <span class="hljs-title class_">NetworkDemoViewModel</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NetworkDemoViewModel</span>();

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">AppNavDestination</span>({
      <span class="hljs-attr">title</span>: <span class="hljs-string">"ç½‘ç»œè¯·æ±‚ç¤ºä¾‹"</span>,
      <span class="hljs-attr">viewModel</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>
    }) {
      <span class="hljs-comment">// æ¡†æ¶è‡ªåŠ¨å¤„ç†åŠ è½½ã€é”™è¯¯ã€æˆåŠŸçŠ¶æ€ã€é‡è¯•é€»è¾‘</span>
      <span class="hljs-title class_">BaseNetWorkView</span>({
        <span class="hljs-attr">uiState</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>.<span class="hljs-property">uiState</span>,
        <span class="hljs-attr">onRetry</span>: (): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>.<span class="hljs-title function_">retryRequest</span>(),
        <span class="hljs-attr">content</span>: (): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title class_">NetworkDemoContent</span>()
      });
    }
  }

  <span class="hljs-comment">// è¯·æ±‚æˆåŠŸåæ¸²æŸ“å†…å®¹</span>
  <span class="hljs-meta">@Builder</span>
  <span class="hljs-keyword">private</span> <span class="hljs-title class_">NetworkDemoContent</span>() {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>.<span class="hljs-property">data</span>?.<span class="hljs-property">title</span> ?? <span class="hljs-string">""</span>)
      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>.<span class="hljs-property">data</span>?.<span class="hljs-property">subTitle</span> ?? <span class="hljs-string">""</span>)
    }
  }
}
</code></pre>
<blockquote>
<p>å…·ä½“å®ç°ä»£ç ï¼Œè¯·å‚è€ƒï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fharmony.dusksnow.top%2Fhelp%2Fcore%2Fnetwork.html" target="_blank" title="https://harmony.dusksnow.top/help/core/network.html" ref="nofollow noopener noreferrer">ç½‘ç»œè¯·æ±‚æ–‡æ¡£</a> | <a href="https://link.juejin.cn?target=https%3A%2F%2Fharmony.dusksnow.top%2Fhelp%2Fcore%2Fresult.html" target="_blank" title="https://harmony.dusksnow.top/help/core/result.html" ref="nofollow noopener noreferrer">ç»“æœå¤„ç†æ–‡æ¡£</a></p>
</blockquote>
<h3 data-id="heading-13">2. åˆ†é¡µåˆ—è¡¨å°è£…</h3>
<p>ç»Ÿä¸€å°è£…åˆ†é¡µåˆ—è¡¨çš„åŠ è½½ã€åˆ·æ–°ã€ç©ºæ€ã€é”™è¯¯å¤„ç†ï¼Œå¼€å‘è€…åªéœ€å…³å¿ƒæ•°æ®è¯·æ±‚å’Œåˆ—è¡¨æ¸²æŸ“ã€‚</p>
<p><strong>åŠŸèƒ½ç‰¹æ€§ï¼š</strong></p>
<ul>
<li>è‡ªåŠ¨å¤„ç†åŠ è½½ä¸­ã€æˆåŠŸã€å¤±è´¥ã€ç©ºæ•°æ®å››ç§çŠ¶æ€</li>
<li>è‡ªåŠ¨å¤„ç†ä¸‹æ‹‰åˆ·æ–°ä¸ä¸Šæ‹‰åŠ è½½æ›´å¤š</li>
<li>è‡ªåŠ¨ç®¡ç†åˆ†é¡µå‚æ•°ï¼ˆcurrentPageã€pageSizeï¼‰</li>
<li>è‡ªåŠ¨åˆ¤æ–­æ˜¯å¦è¿˜æœ‰æ›´å¤šæ•°æ®</li>
<li>æ”¯æŒè‡ªå®šä¹‰åŠ è½½ã€é”™è¯¯ã€ç©ºæ€è§†å›¾</li>
</ul>
<p><strong>ViewModel å®ç°ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@ObservedV2</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NetworkListDemoViewModel</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BaseNetWorkListViewModel</span>&lt;<span class="hljs-title class_">Goods</span>&gt; {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">repository</span>: <span class="hljs-title class_">GoodsRepository</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GoodsRepository</span>();

  <span class="hljs-comment">// åªéœ€å®ç°è¿™ä¸€ä¸ªæ–¹æ³•</span>
  <span class="hljs-keyword">protected</span> <span class="hljs-title function_">requestListData</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">NetworkResponse</span>&lt;<span class="hljs-title class_">NetworkPageData</span>&lt;<span class="hljs-title class_">Goods</span>&gt;&gt;&gt; {
    <span class="hljs-keyword">const</span> <span class="hljs-attr">request</span>: <span class="hljs-title class_">GoodsSearchRequest</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GoodsSearchRequest</span>();
    request.<span class="hljs-property">page</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentPage</span>;  <span class="hljs-comment">// æ¡†æ¶è‡ªåŠ¨ç®¡ç†é¡µç </span>
    request.<span class="hljs-property">size</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageSize</span>;     <span class="hljs-comment">// æ¡†æ¶è‡ªåŠ¨ç®¡ç†æ¯é¡µæ•°é‡</span>
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">repository</span>.<span class="hljs-title function_">getGoodsPage</span>(request);
  }
}
</code></pre>
<p><strong>é¡µé¢ä½¿ç”¨ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@ComponentV2</span>
<span class="hljs-keyword">export</span> struct <span class="hljs-title class_">NetworkListDemoPage</span> {
  <span class="hljs-meta">@Local</span>
  <span class="hljs-keyword">private</span> <span class="hljs-attr">vm</span>: <span class="hljs-title class_">NetworkListDemoViewModel</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NetworkListDemoViewModel</span>();
  <span class="hljs-keyword">private</span> <span class="hljs-attr">listScroller</span>: <span class="hljs-title class_">Scroller</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scroller</span>();

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">AppNavDestination</span>({
      <span class="hljs-attr">title</span>: <span class="hljs-string">"åˆ†é¡µåˆ—è¡¨ç¤ºä¾‹"</span>,
      <span class="hljs-attr">viewModel</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>
    }) {
      <span class="hljs-comment">// æ¡†æ¶è‡ªåŠ¨å¤„ç†åŠ è½½ã€é”™è¯¯ã€ç©ºæ€</span>
      <span class="hljs-title class_">BaseNetWorkListView</span>({
        <span class="hljs-attr">uiState</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>.<span class="hljs-property">uiState</span>,
        <span class="hljs-attr">onRetry</span>: (): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>.<span class="hljs-title function_">retryRequest</span>(),
        <span class="hljs-attr">content</span>: (): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title class_">NetworkListDemoContent</span>()
      });
    }
  }

  <span class="hljs-meta">@Builder</span>
  <span class="hljs-keyword">private</span> <span class="hljs-title class_">NetworkListDemoContent</span>() {
    <span class="hljs-comment">// æ¡†æ¶è‡ªåŠ¨å¤„ç†ä¸‹æ‹‰åˆ·æ–°å’Œä¸Šæ‹‰åŠ è½½</span>
    <span class="hljs-title class_">RefreshLayout</span>({
      <span class="hljs-attr">scroller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">listScroller</span>,
      <span class="hljs-attr">loading</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>.<span class="hljs-property">isLoading</span>,
      <span class="hljs-attr">isEnableSlideUp</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>.<span class="hljs-property">isEnableSlideUp</span>,
      <span class="hljs-attr">onRefresh</span>: (direction): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>.<span class="hljs-title function_">onRefreshDirection</span>(direction)
    }) {
      <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">12</span>, <span class="hljs-attr">scroller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">listScroller</span> }) {
        <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>.<span class="hljs-property">listData</span>, <span class="hljs-function">(<span class="hljs-params">item: Goods</span>) =&gt;</span> {
          <span class="hljs-title class_">ListItem</span>() {
            <span class="hljs-title class_">Text</span>(item.<span class="hljs-property">title</span>);
          }
        }, <span class="hljs-function">(<span class="hljs-params">item: Goods</span>) =&gt;</span> <span class="hljs-string">`<span class="hljs-subst">${item.id}</span>`</span>);
      }
      .<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>)
      .<span class="hljs-title function_">height</span>(<span class="hljs-string">"100%"</span>);
    }
  }
}
</code></pre>
<p><strong>ä½¿ç”¨æ­¥éª¤ï¼š</strong></p>
<ol>
<li>ViewModel ç»§æ‰¿ <code>BaseNetWorkListViewModel&lt;T&gt;</code> å¹¶å®ç° <code>requestListData()</code></li>
<li>é¡µé¢ä½¿ç”¨ <code>BaseNetWorkListView</code> åŒ…ä½åˆ—è¡¨å†…å®¹</li>
<li>åˆ—è¡¨å®¹å™¨ç”¨ <code>RefreshLayout</code> å¤„ç†ä¸‹æ‹‰åˆ·æ–°å’Œä¸Šæ‹‰åŠ è½½</li>
</ol>
<blockquote>
<p>å…·ä½“å®ç°ä»£ç ï¼Œè¯·å‚è€ƒï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fharmony.dusksnow.top%2Fhelp%2Fcore%2Fpagination.html" target="_blank" title="https://harmony.dusksnow.top/help/core/pagination.html" ref="nofollow noopener noreferrer">åˆ†é¡µåˆ—è¡¨æ–‡æ¡£</a></p>
</blockquote>
<h3 data-id="heading-14">3. çŠ¶æ€ç®¡ç†</h3>
<p>åŸºäº V2 çŠ¶æ€ç®¡ç†ï¼ˆAppStorageV2/PersistenceV2ï¼‰å®ç°å…¨å±€çŠ¶æ€å…±äº«ã€‚</p>
<p><strong>åŠŸèƒ½ç‰¹æ€§ï¼š</strong></p>
<ul>
<li>ç±»å‹å®‰å…¨çš„å…¨å±€çŠ¶æ€å®šä¹‰</li>
<li>å“åº”å¼æ›´æ–°ï¼ˆ<code>@Trace</code> è‡ªåŠ¨è§¦å‘ UI æ›´æ–°ï¼‰</li>
<li>æ”¯æŒæŒä¹…åŒ–å­˜å‚¨ï¼ˆPersistenceV2ï¼‰</li>
<li>å¤šé¡µé¢çŠ¶æ€å…±äº«</li>
<li>ç»Ÿä¸€çŠ¶æ€ç®¡ç†å…¥å£</li>
</ul>
<p><strong>çŠ¶æ€å®šä¹‰ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å®šä¹‰çŠ¶æ€ç±»</span>
<span class="hljs-meta">@ObservedV2</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DemoCounterState</span> {
  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;  <span class="hljs-comment">// @Trace æ ‡è®°çš„å­—æ®µä¼šè‡ªåŠ¨è§¦å‘ UI æ›´æ–°</span>

  <span class="hljs-title function_">increment</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++;
  }
}

<span class="hljs-comment">// è·å–å…¨å±€çŠ¶æ€å®ä¾‹</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getDemoCounterState</span>(<span class="hljs-params"/>): <span class="hljs-title class_">DemoCounterState</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">AppStorageV2</span>.<span class="hljs-property">connect</span>&lt;<span class="hljs-title class_">DemoCounterState</span>&gt;(
    <span class="hljs-title class_">DemoCounterState</span>,
    <span class="hljs-string">"demo_counter_state"</span>,
    <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DemoCounterState</span>()
  )!;
}
</code></pre>
<p><strong>ä½¿ç”¨æ¡ˆä¾‹ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@ObservedV2</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StateManagementViewModel</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BaseViewModel</span> {
  <span class="hljs-meta">@Trace</span>
  <span class="hljs-attr">counterState</span>: <span class="hljs-title class_">DemoCounterState</span> = <span class="hljs-title function_">getDemoCounterState</span>();  <span class="hljs-comment">// è·å–å…¨å±€çŠ¶æ€</span>

  <span class="hljs-title function_">increment</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">counterState</span>.<span class="hljs-title function_">increment</span>();  <span class="hljs-comment">// è°ƒç”¨çŠ¶æ€æ–¹æ³•ï¼ŒUI è‡ªåŠ¨æ›´æ–°</span>
  }
}
</code></pre>
<blockquote>
<p>å…·ä½“å®ç°ä»£ç ï¼Œè¯·å‚è€ƒï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fharmony.dusksnow.top%2Fhelp%2Fcore%2Fstate.html" target="_blank" title="https://harmony.dusksnow.top/help/core/state.html" ref="nofollow noopener noreferrer">çŠ¶æ€ç®¡ç†æ–‡æ¡£</a></p>
</blockquote>
<h3 data-id="heading-15">4. å¯¼èˆªç®¡ç†</h3>
<p>ç»Ÿä¸€ç®¡ç†è·¯ç”±æ³¨å†Œã€é¡µé¢è·³è½¬ã€å‚æ•°ä¼ é€’ä¸ç»“æœå›ä¼ ã€‚</p>
<p><strong>åŠŸèƒ½ç‰¹æ€§ï¼š</strong></p>
<ul>
<li>ç±»å‹å®‰å…¨çš„è·¯ç”±å‚æ•°ä¸è¿”å›ç»“æœ</li>
<li>æ¨¡å—åŒ–è·¯ç”±æ³¨å†Œï¼ˆRouteGraphï¼‰</li>
<li>ç»Ÿä¸€å¯¼èˆªæœåŠ¡ï¼ˆNavigationServiceï¼‰</li>
<li>æ”¯æŒå¸¦å‚è·³è½¬ä¸ç»“æœå›ä¼ </li>
<li>æ”¯æŒç™»å½•æ‹¦æˆªä¸è·¯ç”±å®ˆå«</li>
</ul>
<p><strong>è·¯ç”±å®šä¹‰ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// è·¯ç”±å¸¸é‡</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">DemoRoutes</span> = {
  <span class="hljs-title class_">NavigationWithArgs</span>: <span class="hljs-string">"demo/navigation-with-args"</span>,
  <span class="hljs-title class_">NavigationResult</span>: <span class="hljs-string">"demo/navigation-result"</span>
};

<span class="hljs-comment">// å‚æ•°å®šä¹‰</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">DemoGoodsParam</span> {
  <span class="hljs-attr">goodsId</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">goodsName</span>: <span class="hljs-title class_">Resource</span>;
}

<span class="hljs-comment">// è¿”å›ç»“æœå®šä¹‰</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">DemoResult</span> {
  <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">description</span>: <span class="hljs-built_in">string</span>;
}
</code></pre>
<p><strong>Navigator å°è£…ï¼ˆæ¨èï¼‰ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DemoNavigator</span> {
  <span class="hljs-comment">// å¸¦å‚è·³è½¬</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">toNavigationWithArgs</span>(<span class="hljs-attr">goodsId</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">goodsName</span>: <span class="hljs-title class_">Resource</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">const</span> <span class="hljs-attr">params</span>: <span class="hljs-title class_">DemoGoodsParam</span> = { goodsId, goodsName };
    <span class="hljs-title function_">navigateTo</span>(<span class="hljs-title class_">DemoRoutes</span>.<span class="hljs-property">NavigationWithArgs</span>, params);
  }

  <span class="hljs-comment">// ç»“æœå›ä¼ </span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">toNavigationResult</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">DemoResult</span> | <span class="hljs-literal">undefined</span>&gt; {
    <span class="hljs-keyword">return</span> navigateToForResult&lt;<span class="hljs-title class_">DemoResult</span>&gt;(<span class="hljs-title class_">DemoRoutes</span>.<span class="hljs-property">NavigationResult</span>);
  }
}
</code></pre>
<p><strong>ä½¿ç”¨æ¡ˆä¾‹ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å‘èµ·æ–¹ï¼šè·³è½¬å¹¶ç­‰å¾…ç»“æœ</span>
<span class="hljs-meta">@ObservedV2</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CallerViewModel</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BaseViewModel</span> {
  <span class="hljs-title function_">openResultPage</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-title class_">DemoNavigator</span>.<span class="hljs-title function_">toNavigationResult</span>()
      .<span class="hljs-title function_">then</span>((result?: <span class="hljs-title class_">DemoResult</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {
        <span class="hljs-keyword">if</span> (result) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"è¿”å›ç»“æœï¼š"</span>, result.<span class="hljs-property">title</span>);
        }
      });
  }
}

<span class="hljs-comment">// ç›®æ ‡é¡µï¼šè·å–å‚æ•°</span>
<span class="hljs-meta">@ObservedV2</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TargetViewModel</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BaseViewModel</span> {
  <span class="hljs-attr">routeParams</span>: <span class="hljs-title class_">DemoGoodsParam</span> = getRouteParams&lt;<span class="hljs-title class_">DemoGoodsParam</span>&gt;(<span class="hljs-title class_">DemoRoutes</span>.<span class="hljs-property">NavigationWithArgs</span>);
}

<span class="hljs-comment">// ç›®æ ‡é¡µï¼šè¿”å›ç»“æœ</span>
<span class="hljs-meta">@ObservedV2</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ResultViewModel</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BaseViewModel</span> {
  <span class="hljs-title function_">submitResult</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">const</span> <span class="hljs-attr">result</span>: <span class="hljs-title class_">DemoResult</span> = {
      <span class="hljs-attr">title</span>: <span class="hljs-string">"æ ‡é¢˜"</span>,
      <span class="hljs-attr">description</span>: <span class="hljs-string">"è¯´æ˜"</span>
    };
    <span class="hljs-title function_">navigateBackWithResult</span>(result);
  }
}
</code></pre>
<blockquote>
<p>å…·ä½“å®ç°ä»£ç ï¼Œè¯·å‚è€ƒï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fharmony.dusksnow.top%2Fhelp%2Fnavigation%2F" target="_blank" title="https://harmony.dusksnow.top/help/navigation/" ref="nofollow noopener noreferrer">å¯¼èˆªç®¡ç†æ–‡æ¡£</a></p>
</blockquote>
<h3 data-id="heading-16">5. å±å¹•é€‚é…</h3>
<p>å®Œæ•´çš„å±å¹•é€‚é…æ–¹æ¡ˆï¼Œæ”¯æŒæ‰‹æœºã€æŠ˜å å±ã€å¹³æ¿ç­‰å¤šç§è®¾å¤‡å½¢æ€ã€‚</p>
<p><strong>åŠŸèƒ½ç‰¹æ€§ï¼š</strong></p>
<ul>
<li>æ–­ç‚¹é€‚é…ï¼ˆXS/SM/MD/LG å››æ¡£æ–­ç‚¹ï¼‰</li>
<li>å“åº”å¼å·¥å…·å‡½æ•° <code>bp()</code></li>
<li>å®‰å…¨åŒºè‡ªåŠ¨é€‚é…</li>
<li>å…¨å±€æ–­ç‚¹çŠ¶æ€ç›‘å¬</li>
</ul>
<p><strong>æ–­ç‚¹è§„åˆ™ï¼š</strong></p>






























<table><thead><tr><th>æ–­ç‚¹</th><th>è¯´æ˜</th><th>æœ€å¤§å®½åº¦ï¼ˆvpï¼‰</th></tr></thead><tbody><tr><td><code>XS</code></td><td>è¶…å°å±</td><td><code>320</code></td></tr><tr><td><code>SM</code></td><td>å°å±</td><td><code>600</code></td></tr><tr><td><code>MD</code></td><td>ä¸­å±</td><td><code>840</code></td></tr><tr><td><code>LG</code></td><td>å¤§å±</td><td><code>Infinity</code></td></tr></tbody></table>
<p><strong>ç½‘æ ¼å¸ƒå±€é€‚é…ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { bp } <span class="hljs-keyword">from</span> <span class="hljs-string">"state"</span>;

<span class="hljs-meta">@Builder</span>
<span class="hljs-keyword">private</span> <span class="hljs-title class_">GridSection</span>(): <span class="hljs-built_in">void</span> {
  <span class="hljs-title class_">Grid</span>() {
    <span class="hljs-comment">// ... æ•°æ®å¾ªç¯</span>
  }
  <span class="hljs-comment">// å°å±2åˆ—ï¼Œä¸­å±3åˆ—ï¼Œå¤§å±4åˆ—</span>
  .<span class="hljs-title function_">columnsTemplate</span>(<span class="hljs-title function_">bp</span>({ <span class="hljs-attr">sm</span>: <span class="hljs-string">"1fr 1fr"</span>, <span class="hljs-attr">md</span>: <span class="hljs-string">"1fr 1fr 1fr"</span>, <span class="hljs-attr">lg</span>: <span class="hljs-string">"1fr 1fr 1fr 1fr"</span> }))
  .<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>);
}
</code></pre>
<p><strong>æ–‡æœ¬é€‚é…ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { bp } <span class="hljs-keyword">from</span> <span class="hljs-string">"state"</span>;

<span class="hljs-meta">@Builder</span>
<span class="hljs-keyword">private</span> <span class="hljs-title class_">TextAdaptSection</span>(): <span class="hljs-built_in">void</span> {
  <span class="hljs-title class_">Text</span>(<span class="hljs-string">"å¤§å±é€‚é…ç¤ºä¾‹æ–‡å­—"</span>)
    .<span class="hljs-title function_">fontSize</span>(<span class="hljs-title function_">bp</span>({ <span class="hljs-attr">sm</span>: <span class="hljs-number">16</span>, <span class="hljs-attr">md</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">lg</span>: <span class="hljs-number">28</span> }));
}
</code></pre>
<p><strong>Tab æ å¤§å±ä½ç½®è°ƒæ•´ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BreakpointState</span>, getBreakpointState } <span class="hljs-keyword">from</span> <span class="hljs-string">"state"</span>;

<span class="hljs-meta">@ComponentV2</span>
<span class="hljs-keyword">export</span> struct <span class="hljs-title class_">MainPage</span> {
  <span class="hljs-meta">@Local</span>
  <span class="hljs-keyword">private</span> <span class="hljs-attr">breakpointState</span>: <span class="hljs-title class_">BreakpointState</span> = <span class="hljs-title function_">getBreakpointState</span>();

  <span class="hljs-meta">@Builder</span>
  <span class="hljs-keyword">private</span> <span class="hljs-title class_">MainContent</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-title class_">Tabs</span>({
      <span class="hljs-comment">// å¤§å±æ—¶ Tab æ åœ¨å·¦ä¾§ï¼Œå°å±æ—¶åœ¨åº•éƒ¨</span>
      <span class="hljs-attr">barPosition</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">breakpointState</span>.<span class="hljs-title function_">isLG</span>() ? <span class="hljs-title class_">BarPosition</span>.<span class="hljs-property">Start</span> : <span class="hljs-title class_">BarPosition</span>.<span class="hljs-property">End</span>,
    }) {
      <span class="hljs-comment">// ... é¡µé¢å†…å®¹</span>
    }
    .<span class="hljs-title function_">barWidth</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">breakpointState</span>.<span class="hljs-title function_">isLG</span>() ? <span class="hljs-number">96</span> : <span class="hljs-string">"100%"</span>)
    .<span class="hljs-title function_">vertical</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">breakpointState</span>.<span class="hljs-title function_">isLG</span>());
  }
}
</code></pre>
<p><strong>å®‰å…¨åŒºé€‚é…ï¼š</strong></p>
<p>æ¡†æ¶é»˜è®¤ä½¿ç”¨å…¨å±€å®‰å…¨åŒºè¿›è¡Œé¡µé¢å†…è¾¹è·é¿è®©ï¼Œ<code>AppNavDestination</code> å·²è‡ªåŠ¨å¤„ç†ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@ComponentV2</span>
<span class="hljs-keyword">export</span> struct <span class="hljs-title class_">SafeAreaDemoPage</span> {
  <span class="hljs-meta">@Local</span>
  <span class="hljs-keyword">private</span> <span class="hljs-attr">vm</span>: <span class="hljs-title class_">SafeAreaDemoViewModel</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SafeAreaDemoViewModel</span>();

  <span class="hljs-title function_">build</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-comment">// AppNavDestination é»˜è®¤å¯ç”¨å®‰å…¨åŒº</span>
    <span class="hljs-title class_">AppNavDestination</span>({
      <span class="hljs-attr">title</span>: <span class="hljs-string">"å®‰å…¨åŒºç¤ºä¾‹"</span>,
      <span class="hljs-attr">viewModel</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>
    }) {
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">"å†…å®¹ä¼šè‡ªåŠ¨é¿è®©å®‰å…¨åŒº"</span>);
    };
  }
}
</code></pre>
<p>å¦‚éœ€è‡ªå®šä¹‰å®‰å…¨åŒºï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title class_">AppNavDestination</span>({
  <span class="hljs-attr">title</span>: <span class="hljs-string">"è‡ªå®šä¹‰å®‰å…¨åŒº"</span>,
  <span class="hljs-attr">viewModel</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">vm</span>,
  <span class="hljs-attr">paddingValue</span>: { <span class="hljs-attr">top</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">left</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">bottom</span>: <span class="hljs-number">0</span> }
}) {
  <span class="hljs-title class_">Text</span>(<span class="hljs-string">"è‡ªå®šä¹‰å†…è¾¹è·"</span>);
}
</code></pre>
<blockquote>
<p>å…·ä½“å®ç°ä»£ç ï¼Œè¯·å‚è€ƒï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fharmony.dusksnow.top%2Fhelp%2Fexpand%2Fscreen-adapt.html" target="_blank" title="https://harmony.dusksnow.top/help/expand/screen-adapt.html" ref="nofollow noopener noreferrer">å±å¹•é€‚é…æ–‡æ¡£</a> | <a href="https://link.juejin.cn?target=https%3A%2F%2Fharmony.dusksnow.top%2Fhelp%2Fexpand%2Fsafe-area.html" target="_blank" title="https://harmony.dusksnow.top/help/expand/safe-area.html" ref="nofollow noopener noreferrer">å®‰å…¨åŒºæ–‡æ¡£</a></p>
</blockquote>
<h3 data-id="heading-17">6. æ•°æ®åº“å°è£…</h3>
<p>åŸºäº IBest-ORM çš„æœ¬åœ°æ•°æ®åº“èƒ½åŠ›ï¼Œé‡‡ç”¨ <strong>DataSource â†’ Repository</strong> æ¶æ„ï¼Œä¸šåŠ¡å±‚é€šè¿‡ Repository è®¿é—®æ•°æ®åº“ã€‚</p>
<p><strong>å®ä½“å®šä¹‰ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Table</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">"demo_items"</span> })
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DemoEntity</span> {
  <span class="hljs-meta">@PrimaryKey</span>({ <span class="hljs-attr">autoIncrement</span>: <span class="hljs-literal">true</span> })
  id?: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@Column</span>({ <span class="hljs-attr">type</span>: <span class="hljs-title class_">ColumnType</span>.<span class="hljs-property">TEXT</span> })
  title?: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@CreatedAt</span>()
  createdAt?: <span class="hljs-built_in">string</span>;
}
</code></pre>
<p><strong>ä½¿ç”¨æ¡ˆä¾‹ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@ObservedV2</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabaseViewModel</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BaseViewModel</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">demoRepository</span>: <span class="hljs-title class_">DemoRepository</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DemoRepository</span>();

  <span class="hljs-comment">// ä¿å­˜è®°å½•</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">save</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">demoRepository</span>.<span class="hljs-title function_">createDemo</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">titleInput</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">descInput</span>);
  }

  <span class="hljs-comment">// è·å–æ‰€æœ‰è®°å½•</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">fetchList</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">const</span> list = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">demoRepository</span>.<span class="hljs-title function_">getAll</span>();
    <span class="hljs-comment">// å¤„ç†åˆ—è¡¨æ•°æ®</span>
  }
}
</code></pre>
<blockquote>
<p>å…·ä½“å®ç°ä»£ç ï¼Œè¯·å‚è€ƒï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fharmony.dusksnow.top%2Fhelp%2Fcore%2Fdatabase.html" target="_blank" title="https://harmony.dusksnow.top/help/core/database.html" ref="nofollow noopener noreferrer">æ•°æ®åº“æ–‡æ¡£</a> | <a href="https://link.juejin.cn?target=https%3A%2F%2Fibest-orm.ibestservices.com%2F" target="_blank" title="https://ibest-orm.ibestservices.com/" ref="nofollow noopener noreferrer">IBest-ORM æ–‡æ¡£</a></p>
</blockquote>
<h3 data-id="heading-18">7. æœ¬åœ°å­˜å‚¨</h3>
<p>åŸºäº Preferences çš„è½»é‡çº§æœ¬åœ°å­˜å‚¨ï¼Œé‡‡ç”¨ <strong>DataSource â†’ Repository</strong> æ¶æ„ï¼Œä¸šåŠ¡å±‚é€šè¿‡ Repository è®¿é—®å­˜å‚¨æ•°æ®ã€‚</p>
<p><strong>ä½¿ç”¨æ¡ˆä¾‹ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@ObservedV2</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LocalStorageViewModel</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BaseViewModel</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">repository</span>: <span class="hljs-title class_">AccountStoreRepository</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AccountStoreRepository</span>();

  <span class="hljs-comment">// ä¿å­˜è´¦å·</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">saveAccount</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">repository</span>.<span class="hljs-title function_">saveAccount</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">accountInput</span>);
  }

  <span class="hljs-comment">// è¯»å–è´¦å·</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">loadAccount</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">storedAccount</span> = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">repository</span>.<span class="hljs-title function_">loadAccount</span>();
  }
}
</code></pre>
<blockquote>
<p>å…·ä½“å®ç°ä»£ç ï¼Œè¯·å‚è€ƒï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fharmony.dusksnow.top%2Fhelp%2Fcore%2Fdatastore.html" target="_blank" title="https://harmony.dusksnow.top/help/core/datastore.html" ref="nofollow noopener noreferrer">æœ¬åœ°å­˜å‚¨æ–‡æ¡£</a></p>
</blockquote>
<h2 data-id="heading-19">å·¥å…·ç±»</h2>
<p>æ¡†æ¶å†…ç½®äº†å¸¸ç”¨çš„å·¥å…·ç±»ï¼Œé¿å…ä¸šåŠ¡å±‚é‡å¤é€ è½®å­ï¼š</p>
<ul>
<li><strong>ToastUtils</strong>ï¼šToast æç¤ºå°è£…</li>
<li><strong>ContextUtil</strong>ï¼šç»Ÿä¸€è·å–åº”ç”¨/çª—å£ä¸Šä¸‹æ–‡</li>
<li><strong>PreferencesUtil</strong>ï¼šè½»é‡çº§æœ¬åœ°å­˜å‚¨å°è£…</li>
<li><strong>PermissionUtils</strong>ï¼šæƒé™ç”³è¯·å°è£…</li>
</ul>
<blockquote>
<p>å…·ä½“ä½¿ç”¨æ–¹æ³•ï¼Œè¯·å‚è€ƒï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fharmony.dusksnow.top%2Fhelp%2Fcore%2Futil.html" target="_blank" title="https://harmony.dusksnow.top/help/core/util.html" ref="nofollow noopener noreferrer">å·¥å…·ç±»æ–‡æ¡£</a></p>
</blockquote>
<h2 data-id="heading-20">é¡¹ç›®ç»“æ„</h2>
<pre><code class="hljs language-csharp" lang="csharp">AppScope/               <span class="hljs-meta"># åº”ç”¨é…ç½®</span>
entry/                  <span class="hljs-meta"># åº”ç”¨å…¥å£æ¨¡å—</span>
core/                   <span class="hljs-meta"># æ ¸å¿ƒæ¨¡å—</span>
â”‚   â”œâ”€â”€ <span class="hljs-keyword">base</span>/           <span class="hljs-meta"># åŸºç±»</span>
â”‚   â”œâ”€â”€ data/           <span class="hljs-meta"># æ•°æ®å±‚</span>
â”‚   â”œâ”€â”€ database/       <span class="hljs-meta"># æ•°æ®åº“</span>
â”‚   â”œâ”€â”€ datastore/      <span class="hljs-meta"># æ•°æ®å­˜å‚¨</span>
â”‚   â”œâ”€â”€ designsystem/   <span class="hljs-meta"># è®¾è®¡ç³»ç»Ÿ</span>
â”‚   â”œâ”€â”€ ibestui/        <span class="hljs-meta"># IBest UI ç»„ä»¶åº“</span>
â”‚   â”œâ”€â”€ model/          <span class="hljs-meta"># æ•°æ®æ¨¡å‹</span>
â”‚   â”œâ”€â”€ navigation/     <span class="hljs-meta"># å¯¼èˆª</span>
â”‚   â”œâ”€â”€ network/        <span class="hljs-meta"># ç½‘ç»œå±‚</span>
â”‚   â”œâ”€â”€ result/         <span class="hljs-meta"># ç»“æœå¤„ç†</span>
â”‚   â”œâ”€â”€ state/          <span class="hljs-meta"># å…¨å±€çŠ¶æ€</span>
â”‚   â”œâ”€â”€ ui/             <span class="hljs-meta"># UI ç»„ä»¶</span>
â”‚   â””â”€â”€ util/           <span class="hljs-meta"># å·¥å…·ç±»</span>
feature/                <span class="hljs-meta"># åŠŸèƒ½æ¨¡å—</span>
â”‚   â”œâ”€â”€ auth/           <span class="hljs-meta"># è®¤è¯æ¨¡å—</span>
â”‚   â”œâ”€â”€ demo/           <span class="hljs-meta"># ç¤ºä¾‹æ¨¡å—</span>
â”‚   â”œâ”€â”€ main/           <span class="hljs-meta"># ä¸»æ¨¡å—</span>
â”‚   â””â”€â”€ user/           <span class="hljs-meta"># ç”¨æˆ·æ¨¡å—</span>
</code></pre>
<p><strong>ç›¸å…³èµ„æºï¼š</strong></p>
<ul>
<li><strong>åœ¨çº¿æ–‡æ¡£</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fharmony.dusksnow.top" target="_blank" title="https://harmony.dusksnow.top" ref="nofollow noopener noreferrer">harmony.dusksnow.top</a></li>
<li><strong>IBest-UI-V2 ç»„ä»¶åº“</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fibestui-v2.ibestservices.com" target="_blank" title="https://ibestui-v2.ibestservices.com" ref="nofollow noopener noreferrer">ibestui-v2.ibestservices.com</a></li>
<li><strong>IBest-ORM æ•°æ®åº“</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fibest-orm.ibestservices.com" target="_blank" title="https://ibest-orm.ibestservices.com" ref="nofollow noopener noreferrer">ibest-orm.ibestservices.com</a></li>
</ul>
<p><strong>ç›¸å…³é¡¹ç›®ï¼š</strong></p>
<p>HarmonyKit æºäº <strong>é’å•†åŸï¼ˆHarmonyOSï¼‰</strong> çš„å®è·µï¼Œå¦‚æœä½ æƒ³æŸ¥çœ‹å®Œæ•´çš„ç”µå•†ä¸šåŠ¡å®ç°ï¼š</p>
<ul>
<li><strong>GitHub</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJoker-x-dev%2FCoolMallArkTS" target="_blank" title="https://github.com/Joker-x-dev/CoolMallArkTS" ref="nofollow noopener noreferrer">github.com/Joker-x-devâ€¦</a></li>
<li><strong>Gitee</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2FJoker-x-dev%2FCoolMallArkTS" target="_blank" title="https://gitee.com/Joker-x-dev/CoolMallArkTS" ref="nofollow noopener noreferrer">gitee.com/Joker-x-devâ€¦</a></li>
</ul>
<blockquote>
<p><strong>å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ª â­ Star æ”¯æŒï¼</strong></p>
<ul>
<li><strong>GitHub</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJoker-x-dev%2FHarmonyKit" target="_blank" title="https://github.com/Joker-x-dev/HarmonyKit" ref="nofollow noopener noreferrer">github.com/Joker-x-devâ€¦</a></li>
<li><strong>Gitee</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2FJoker-x-dev%2FHarmonyKit" target="_blank" title="https://gitee.com/Joker-x-dev/HarmonyKit" ref="nofollow noopener noreferrer">gitee.com/Joker-x-devâ€¦</a></li>
</ul>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€ŠVue.jså‰ç«¯å¼€å‘å®æˆ˜ã€‹å­¦ä¹ ç¬”è®° ç¬¬1ç«  åˆè¯†Vue.js]]></title>    <link>https://juejin.cn/post/7598465042967805992</link>    <guid>https://juejin.cn/post/7598465042967805992</guid>    <pubDate>2026-01-24T05:22:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598465042967805992" data-draft-id="7598401650857213952" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€ŠVue.jså‰ç«¯å¼€å‘å®æˆ˜ã€‹å­¦ä¹ ç¬”è®° ç¬¬1ç«  åˆè¯†Vue.js"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-24T05:22:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ»•é’å±±"/> <meta itemprop="url" content="https://juejin.cn/user/3206601805674094"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€ŠVue.jså‰ç«¯å¼€å‘å®æˆ˜ã€‹å­¦ä¹ ç¬”è®° ç¬¬1ç«  åˆè¯†Vue.js
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3206601805674094/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ»•é’å±±
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T05:22:03.000Z" title="Sat Jan 24 2026 05:22:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vue3 æ ¸å¿ƒçŸ¥è¯†ç‚¹è¯»ä¹¦ç¬”è®°</h2>
<h3 data-id="heading-1">ä¸€ã€Vue æ ¸å¿ƒåŸç†ä¸æ¶æ„</h3>
<h4 data-id="heading-2">1. MVVM æ ¸å¿ƒæ¨¡å¼ï¼ˆæ ¸å¿ƒæ¶æ„ï¼‰</h4>
<p>Vue åŸºäº MVVM æ¨¡å¼è®¾è®¡ï¼Œæ ¸å¿ƒæ˜¯å®ç°è§†å›¾ä¸æ•°æ®çš„è§£è€¦ï¼Œä¸‰è€…å…³ç³»å¦‚ä¸‹ï¼š</p>





















<table><thead><tr><th><strong>æ¨¡å—</strong></th><th><strong>æ ¸å¿ƒèŒè´£</strong></th></tr></thead><tbody><tr><td>Model</td><td>æ•°æ®å±‚ï¼Œè´Ÿè´£ä¸šåŠ¡æ•°æ®å¤„ç†ï¼ˆçº¯æ•°æ®ï¼Œæ— è§†å›¾äº¤äº’é€»è¾‘ï¼‰</td></tr><tr><td>View</td><td>è§†å›¾å±‚ï¼Œå³ç”¨æˆ·ç•Œé¢ï¼ˆä»…å±•ç¤ºå†…å®¹ï¼Œä¸å¤„ç†æ•°æ®é€»è¾‘ï¼‰</td></tr><tr><td>ViewModel</td><td>æ¡¥æ¢å±‚ï¼Œè¿æ¥ View å’Œ Modelï¼ŒåŒ…å«ä¸¤ä¸ªæ ¸å¿ƒèƒ½åŠ›ï¼š âœ… DOM Listenersï¼šç›‘å¬ View ä¸­ DOM å˜åŒ–ï¼ŒåŒæ­¥åˆ° Model âœ… Data Bindingsï¼šç›‘å¬ Model ä¸­æ•°æ®å˜åŒ–ï¼ŒåŒæ­¥åˆ° View</td></tr></tbody></table>
<blockquote>
<p>å…³é”®ï¼šView å’Œ Model ä¸èƒ½ç›´æ¥é€šä¿¡ï¼Œå¿…é¡»é€šè¿‡ ViewModel ä¸­è½¬ï¼Œå®ç°è§£è€¦ã€‚</p>
</blockquote>
<h4 data-id="heading-3">2. Vue æ ¸å¿ƒç‰¹æ€§ï¼ˆå››å¤§æ ¸å¿ƒï¼‰</h4>






























<table><thead><tr><th><strong>ç‰¹æ€§</strong></th><th><strong>å…·ä½“è¯´æ˜</strong></th><th><strong>ç¤ºä¾‹/åº”ç”¨åœºæ™¯</strong></th></tr></thead><tbody><tr><td>æ•°æ®é©±åŠ¨è§†å›¾</td><td>æ•°æ®å˜åŒ–è‡ªåŠ¨è§¦å‘è§†å›¾é‡æ–°æ¸²æŸ“ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œ DOM</td><td>ä¿®æ”¹å˜é‡å€¼ â†’ é¡µé¢è‡ªåŠ¨æ›´æ–°</td></tr><tr><td>åŒå‘æ•°æ®ç»‘å®š</td><td>è§†å›¾å˜åŒ– â†” æ•°æ®å˜åŒ–åŒå‘åŒæ­¥</td><td>è¡¨å•è¾“å…¥æ¡†å†…å®¹è‡ªåŠ¨åŒæ­¥åˆ°æ•°æ®å˜é‡</td></tr><tr><td>æŒ‡ä»¤</td><td>åˆ†å†…ç½®æŒ‡ä»¤ï¼ˆVue è‡ªå¸¦ï¼‰å’Œè‡ªå®šä¹‰æŒ‡ä»¤ï¼Œä»¥<code>v-</code>å¼€å¤´ç»‘å®šåˆ° DOM å…ƒç´ </td><td><code>v-bind</code>ï¼ˆå•å‘ç»‘å®šï¼‰ã€<code>v-if</code>ï¼ˆæ¡ä»¶æ¸²æŸ“ï¼‰ã€<code>v-for</code>ï¼ˆåˆ—è¡¨æ¸²æŸ“ï¼‰</td></tr><tr><td>æ’ä»¶</td><td>æ”¯æŒæ‰©å±•åŠŸèƒ½ï¼Œé…ç½®ç®€å•</td><td>VueRouterï¼ˆè·¯ç”±ï¼‰ã€Piniaï¼ˆçŠ¶æ€ç®¡ç†ï¼‰</td></tr></tbody></table>
<h3 data-id="heading-4">äºŒã€Vue ç‰ˆæœ¬ä¸å¼€å‘ç¯å¢ƒ</h3>
<h4 data-id="heading-5">1. Vue2 vs Vue3 æ ¸å¿ƒå·®å¼‚</h4>





















<table><thead><tr><th><strong>ç»´åº¦</strong></th><th><strong>Vue3 å˜åŒ–</strong></th></tr></thead><tbody><tr><td>æ–°å¢åŠŸèƒ½</td><td>ç»„åˆå¼ï¼ˆCompositionï¼‰APIã€å¤šæ ¹èŠ‚ç‚¹ç»„ä»¶ã€åº•å±‚æ¸²æŸ“/å“åº”å¼é€»è¾‘é‡æ„ï¼ˆæ€§èƒ½æå‡ï¼‰</td></tr><tr><td>åºŸå¼ƒåŠŸèƒ½</td><td>è¿‡æ»¤å™¨ï¼ˆFilterï¼‰ã€<code>$on()</code>/<code>$off()</code>/<code>$once()</code>Â å®ä¾‹æ–¹æ³•</td></tr><tr><td>å…¼å®¹æ€§</td><td>å…¼å®¹ Vue2 ç»å¤§å¤šæ•° APIï¼Œæ–°é¡¹ç›®æ¨èç›´æ¥ä½¿ç”¨ Vue3</td></tr></tbody></table>
<h4 data-id="heading-6">2. å¼€å‘ç¯å¢ƒå‡†å¤‡ï¼ˆå¿…è£…ï¼‰</h4>
<ol>
<li><strong>ç¼–è¾‘å™¨</strong>ï¼šVSCode â†’ å®‰è£…ã€ŒVue (Official)ã€æ‰©å±•ï¼ˆæä¾›ä»£ç é«˜äº®ã€è¯­æ³•æç¤ºï¼‰</li>
<li><strong>è¿è¡Œç¯å¢ƒ</strong>ï¼šNode.jsï¼ˆå®˜ç½‘ä¸‹è½½å®‰è£…ï¼Œä¸ºåŒ…ç®¡ç†å·¥å…·æä¾›åŸºç¡€ï¼‰</li>
<li><strong>åŒ…ç®¡ç†å·¥å…·</strong>ï¼šnpm/yarnï¼ˆç®¡ç†ç¬¬ä¸‰æ–¹ä¾èµ–ï¼Œæ”¯æŒä¸€é”®å®‰è£…/å‡çº§/å¸è½½ï¼Œé¿å…æ‰‹åŠ¨ä¸‹è½½è§£å‹ï¼‰</li>
</ol>
<h3 data-id="heading-7">ä¸‰ã€Vite åˆ›å»º Vue3 é¡¹ç›®ï¼ˆæ ¸å¿ƒæ“ä½œï¼‰</h3>
<h4 data-id="heading-8">1. é¡¹ç›®åˆ›å»ºå‘½ä»¤ï¼ˆé€‚é… npm10 ç‰ˆæœ¬ï¼‰</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">Yarn æ–¹å¼ï¼ˆæ¨èï¼‰</span>
yarn create vite hello-vite --template vue
<span class="hljs-meta prompt_">
# </span><span class="bash">äº¤äº’æç¤ºå¤„ç†ï¼ˆå…³é”®æ­¥éª¤ï¼Œä¸è¦é—æ¼ï¼‰ï¼š</span>
<span class="hljs-meta prompt_"># </span><span class="bash">1. æç¤º <span class="hljs-string">"Use rolldown-vite (Experimental)?"</span> â†’ å›è½¦é€‰ Noï¼ˆä¼˜å…ˆä½¿ç”¨ç¨³å®šç‰ˆï¼‰</span>
<span class="hljs-meta prompt_"># </span><span class="bash">2. æç¤º <span class="hljs-string">"Install with yarn and start now?"</span> â†’ å›è½¦é€‰ Yesï¼ˆè‡ªåŠ¨å®‰è£…ä¾èµ–å¹¶å¯åŠ¨é¡¹ç›®ï¼‰</span>
</code></pre>
<h4 data-id="heading-9">2. æ‰‹åŠ¨åˆ›å»ºå‘½ä»¤ï¼ˆè¡¥å……ï¼‰</h4>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># npm æ–¹å¼</span>
npm create vite@latest
<span class="hljs-comment"># yarn æ–¹å¼</span>
yarn create vite
<span class="hljs-comment"># åç»­éœ€æ‰‹åŠ¨å¡«å†™é¡¹ç›®åç§°ã€é€‰æ‹©æ¡†æ¶ï¼ˆVueï¼‰ã€é€‰æ‹©å˜ä½“ï¼ˆJavaScriptï¼‰</span>
</code></pre>
<h3 data-id="heading-10">å››ã€Vue3 é¡¹ç›®æ ¸å¿ƒæ–‡ä»¶ä¸ç›®å½•</h3>
<h4 data-id="heading-11">1. é¡¹ç›®ç›®å½•ç»“æ„ï¼ˆé‡ç‚¹å…³æ³¨ï¼‰</h4>
<pre><code class="hljs language-bash" lang="bash">hello-vite/          <span class="hljs-comment"># é¡¹ç›®æ ¹ç›®å½•</span>
â”œâ”€â”€ node_modules/    <span class="hljs-comment"># ç¬¬ä¸‰æ–¹ä¾èµ–åŒ…ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰</span>
â”œâ”€â”€ dist/            <span class="hljs-comment"># æ„å»ºäº§ç‰©ï¼ˆæ‰§è¡Œ yarn build åç”Ÿæˆï¼Œç”¨äºéƒ¨ç½²ï¼‰</span>
â”œâ”€â”€ src/             <span class="hljs-comment"># æºä»£ç ç›®å½•ï¼ˆå¼€å‘æ ¸å¿ƒï¼‰</span>
â”‚   â”œâ”€â”€ assets/      <span class="hljs-comment"># é™æ€èµ„æºï¼ˆå›¾ç‰‡ã€æ ·å¼ç­‰ï¼‰</span>
â”‚   â”œâ”€â”€ components/  <span class="hljs-comment"># è‡ªå®šä¹‰ç»„ä»¶</span>
â”‚   â”œâ”€â”€ App.vue      <span class="hljs-comment"># æ ¹ç»„ä»¶</span>
â”‚   â”œâ”€â”€ main.js      <span class="hljs-comment"># é¡¹ç›®å…¥å£æ–‡ä»¶</span>
â”‚   â””â”€â”€ style.css    <span class="hljs-comment"># å…¨å±€æ ·å¼</span>
â”œâ”€â”€ index.html       <span class="hljs-comment"># é¡µé¢å…¥å£æ–‡ä»¶</span>
â””â”€â”€ package.json     <span class="hljs-comment"># é¡¹ç›®é…ç½®ï¼ˆä¾èµ–ã€è„šæœ¬å‘½ä»¤ï¼‰</span>
</code></pre>
<h4 data-id="heading-12">2. æ ¸å¿ƒæ–‡ä»¶ä»£ç è§£æï¼ˆå¸¦å®Œæ•´æ³¨é‡Šï¼‰</h4>
<h5 data-id="heading-13">ï¼ˆ1ï¼‰index.htmlï¼ˆé¡µé¢å…¥å£ï¼‰</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!doctype <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"icon"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"image/svg+xml"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/vite.svg"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>hello-vite<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Vue å®ä¾‹æŒ‚è½½å®¹å™¨ï¼šè¢« main.js ä¸­çš„ Vue å®ä¾‹æ§åˆ¶ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- type="module"ï¼šå¯ç”¨ ES6 æ¨¡å—åŒ–è¯­æ³•ï¼Œå¼•å…¥é¡¹ç›®å…¥å£æ–‡ä»¶ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/src/main.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h5 data-id="heading-14">ï¼ˆ2ï¼‰src/main.jsï¼ˆé¡¹ç›®å…¥å£ï¼Œåˆ›å»º Vue å®ä¾‹ï¼‰</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä» Vue ä¸­å¯¼å…¥åˆ›å»ºåº”ç”¨å®ä¾‹çš„æ ¸å¿ƒå‡½æ•°</span>
<span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-comment">// å¯¼å…¥å…¨å±€æ ·å¼æ–‡ä»¶</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'./style.css'</span>
<span class="hljs-comment">// å¯¼å…¥æ ¹ç»„ä»¶ï¼ˆApp.vueï¼‰</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>

<span class="hljs-comment">// æ–¹å¼1ï¼šç®€æ´å†™æ³•ï¼ˆåˆ›å»ºå®ä¾‹ + æŒ‚è½½åˆ° #app å®¹å™¨ï¼‰</span>
<span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>).<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>)

<span class="hljs-comment">// æ–¹å¼2ï¼šåˆ†æ­¥å†™æ³•ï¼ˆæ›´æ˜“ç†è§£ï¼Œæ•ˆæœä¸€è‡´ï¼‰</span>
<span class="hljs-comment">// const app = createApp(App) // åˆ›å»º Vue åº”ç”¨å®ä¾‹</span>
<span class="hljs-comment">// app.mount('#app') // æŒ‚è½½å®ä¾‹ï¼ˆä»…å¯è°ƒç”¨ä¸€æ¬¡ï¼‰</span>
</code></pre>
<h5 data-id="heading-15">ï¼ˆ3ï¼‰src/App.vueï¼ˆæ ¹ç»„ä»¶ï¼Œå•æ–‡ä»¶ç»„ä»¶æ ¸å¿ƒï¼‰</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- script setupï¼šVue3 ç»„åˆå¼ API è¯­æ³•ç³–ï¼Œç®€åŒ–ç»„ä»¶ç¼–å†™ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-comment">// å¯¼å…¥å­ç»„ä»¶ï¼ˆHelloWorld.vueï¼‰</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">HelloWorld</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./components/HelloWorld.vue'</span>
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-comment">&lt;!-- templateï¼šç»„ä»¶æ¨¡æ¿ç»“æ„ï¼ˆè§†å›¾éƒ¨åˆ†ï¼‰ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://vite.dev"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_blank"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/vite.svg"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"logo"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"Vite logo"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://vuejs.org/"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_blank"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./assets/vue.svg"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"logo vue"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"Vue logo"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- ä½¿ç”¨å­ç»„ä»¶ï¼Œä¼ é€’ msg å±æ€§ --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">HelloWorld</span> <span class="hljs-attr">msg</span>=<span class="hljs-string">"Vite + Vue"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-comment">&lt;!-- style scopedï¼šæ ·å¼ä»…ä½œç”¨äºå½“å‰ç»„ä»¶ï¼ˆé€šè¿‡ Hash éš”ç¦»ï¼Œä¸å½±å“å­ç»„ä»¶ï¼‰ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.logo</span> {
  <span class="hljs-attribute">height</span>: <span class="hljs-number">6em</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">1.5em</span>;
  <span class="hljs-attribute">will-change</span>: filter;
  <span class="hljs-attribute">transition</span>: filter <span class="hljs-number">300ms</span>;
}
<span class="hljs-selector-class">.logo</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">filter</span>: <span class="hljs-built_in">drop-shadow</span>(<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">2em</span> <span class="hljs-number">#646cffaa</span>);
}
<span class="hljs-selector-class">.logo</span><span class="hljs-selector-class">.vue</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">filter</span>: <span class="hljs-built_in">drop-shadow</span>(<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">2em</span> <span class="hljs-number">#42b883aa</span>);
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<h3 data-id="heading-16">äº”ã€æ ¸å¿ƒçŸ¥è¯†ç‚¹æ€»ç»“</h3>
<h4 data-id="heading-17">1. æ ¸å¿ƒåŸç†</h4>
<ul>
<li>Vue åŸºäº MVVM æ¨¡å¼ï¼Œé€šè¿‡ ViewModel å®ç°è§†å›¾ä¸æ•°æ®çš„åŒå‘é©±åŠ¨ï¼Œæ ¸å¿ƒæ˜¯ã€Œæ•°æ®é©±åŠ¨è§†å›¾ã€ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œ DOMï¼›</li>
<li>åŒå‘æ•°æ®ç»‘å®šæ˜¯ Vue æ ¸å¿ƒç‰¹æ€§ï¼Œè¡¨å•åœºæ™¯ä¸‹å¯è‡ªåŠ¨åŒæ­¥è§†å›¾ä¸æ•°æ®ã€‚</li>
</ul>
<h4 data-id="heading-18">2. é¡¹ç›®å¼€å‘</h4>
<ul>
<li>Vue3 æ¨èä½¿ç”¨ Vite åˆ›å»ºé¡¹ç›®ï¼ˆæ¯” VueCLI æ›´å¿«ï¼‰ï¼Œnpm10 ç‰ˆæœ¬ä¸‹ä¼˜å…ˆç”¨Â <code>yarn create vite é¡¹ç›®å --template vue</code>Â å‘½ä»¤ï¼›</li>
<li>é¡¹ç›®æ ¸å¿ƒæ–‡ä»¶ï¼šindex.htmlï¼ˆé¡µé¢å…¥å£ï¼‰â†’ main.jsï¼ˆåˆ›å»º Vue å®ä¾‹ï¼‰â†’ App.vueï¼ˆæ ¹ç»„ä»¶ï¼‰ï¼Œä¸‰è€…æ„æˆé¡¹ç›®åŸºç¡€éª¨æ¶ã€‚</li>
</ul>
<h4 data-id="heading-19">3. å…³é”®æ³¨æ„ç‚¹</h4>
<ul>
<li><code>mount()</code>Â æ–¹æ³•ä»…å¯è°ƒç”¨ä¸€æ¬¡ï¼ŒæŒ‚è½½ç›®æ ‡å¯ä»¥æ˜¯ DOM å…ƒç´ æˆ– CSS é€‰æ‹©å™¨ï¼ˆ#app/.appï¼‰ï¼›</li>
<li><code>&lt;style scoped&gt;</code>Â æ ·å¼ä»…ä½œç”¨äºå½“å‰ç»„ä»¶ï¼Œé¿å…æ ·å¼æ±¡æŸ“ï¼›</li>
<li>Vue3 åºŸå¼ƒäº†è¿‡æ»¤å™¨ã€<code>$on/$off/$once</code>Â ç­‰åŠŸèƒ½ï¼Œå¼€å‘æ—¶éœ€é¿å¼€ã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å†²ä¸Šäº† Hacker News ç¬¬ 5 åï¼Œç«Ÿç„¶æ˜¯æˆ‘çš„ Svelte ç»ƒæ‰‹é¡¹ç›®]]></title>    <link>https://juejin.cn/post/7598499504170450982</link>    <guid>https://juejin.cn/post/7598499504170450982</guid>    <pubDate>2026-01-24T05:28:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598499504170450982" data-draft-id="7598532592455237659" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å†²ä¸Šäº† Hacker News ç¬¬ 5 åï¼Œç«Ÿç„¶æ˜¯æˆ‘çš„ Svelte ç»ƒæ‰‹é¡¹ç›®"/> <meta itemprop="keywords" content="å¼€æº"/> <meta itemprop="datePublished" content="2026-01-24T05:28:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ougt"/> <meta itemprop="url" content="https://juejin.cn/user/3863023435394699"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å†²ä¸Šäº† Hacker News ç¬¬ 5 åï¼Œç«Ÿç„¶æ˜¯æˆ‘çš„ Svelte ç»ƒæ‰‹é¡¹ç›®
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3863023435394699/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ougt
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T05:28:51.000Z" title="Sat Jan 24 2026 05:28:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    10
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä»Šå¤©æ—©ä¸Šé†’æ¥ï¼Œå‘ç”Ÿäº†ä¸€ä»¶è®©æˆ‘æœ‰ç‚¹æ‡µçš„äº‹æƒ…ã€‚æˆ‘å‰æ®µæ—¶é—´ä¸ºäº†å­¦ä¹  Svelte è€Œå†™çš„ä¸€ä¸ªâ€œç»ƒæ‰‹é¡¹ç›®â€â€”â€” <strong>Zsweep</strong>ï¼Œç«Ÿç„¶å†²ä¸Šäº† <strong>Hacker News (HN) é¦–é¡µçš„ç¬¬ 5 å</strong>ã€‚</p>
<p>ï¼ˆè¿™æ˜¯åé¢çœ‹åˆ°æ—¶çš„æˆªå›¾ï¼Œæœ€å¼€å§‹ä¸Šäº†å‰5ï¼Œå¯æƒœæ²¡æœ‰æˆªå±ğŸ˜­ï¼‰
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1857c98a3c7440aeb8d491379a2222f6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgb3VndA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769838786&amp;x-signature=XI4%2BVzyXsjGcw5HMILUtwp9b7Xc%3D" alt="image.png" loading="lazy"/></p>
<p>(æ­¤å›¾ä¸ºè¯ï¼‰</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ebad69d24a6f4539be3f729fc9910bec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgb3VndA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769838786&amp;x-signature=1rOZFA5NfFWlS48Qq8nExyZDxYA%3D" alt="image.png" loading="lazy"/></p>
<p>(å°ç«™ä¸‹åˆæ¸¸æˆæ—¶é•¿æš´æ¶¨100å°æ—¶ğŸ¤¯ï¼‰
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67319348dcaa4cec872f1246a3f751bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgb3VndA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769838786&amp;x-signature=w9JznKxuTwxG9o1MJocfuR0x4VA%3D" alt="image.png" loading="lazy"/></p>
<p>å¯¹äºç‹¬ç«‹å¼€å‘è€…æ¥è¯´ï¼ŒHN çš„é¦–é¡µå°±åƒæ˜¯â€œå¥¥æ–¯å¡çº¢æ¯¯â€ã€‚çœ‹ç€è‡ªå·±å†™çš„ä»£ç è¢«å…¨çƒå„åœ°çš„æå®¢è®¨è®ºï¼Œ æˆ‘æƒ³è¶çƒ­æ‰“é“ï¼Œåœ¨æ˜é‡‘å¤ç›˜ä¸€ä¸‹è¿™ä¸ªé¡¹ç›®çš„<strong>å¼€å‘æ€è·¯</strong>ã€<strong>æŠ€æœ¯æ ˆé€‰æ‹©</strong>ï¼Œä»¥åŠæˆ‘ä¸ºäº†è®©å®ƒâ€œå¥½ç©â€è€Œæ­»ç£•çš„ä¸€äº›<strong>æŠ€æœ¯ç»†èŠ‚</strong>ã€‚</p>
<p>HNï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fnews.ycombinator.com%2Fitem%3Fid%3D46667849" target="_blank" title="https://news.ycombinator.com/item?id=46667849" ref="nofollow noopener noreferrer">news.ycombinator.com/item?id=466â€¦</a></p>
<p>Repo: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Foug-t%2Fzsweep" target="_blank" title="https://github.com/oug-t/zsweep" ref="nofollow noopener noreferrer">github.com/oug-t/zsweeâ€¦</a></p>
<h2 data-id="heading-0">ğŸ® ä»€ä¹ˆæ˜¯ Zsweepï¼Ÿ</h2>
<p>ç®€å•æ¥è¯´ï¼ŒZsweep æ˜¯ä¸€ä¸ª <strong>Vim é”®ä½é©±åŠ¨çš„æ‰«é›·æ¸¸æˆ</strong>ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzsweep.com" target="_blank" title="https://zsweep.com" ref="nofollow noopener noreferrer">zsweep.com</a></p>
<p><strong>å®ƒçš„çµæ„Ÿæ¥æºæœ‰ä¸¤ä¸ªï¼š</strong></p>
<ol>
<li><strong>Monkeytype</strong>ï¼šæˆ‘å¾ˆå–œæ¬¢ Monkeytype é‚£ç§æç®€ã€æ— å¹¿å‘Šã€çº¯ç²¹è¿½æ±‚é€Ÿåº¦çš„æ‰“å­—ä½“éªŒã€‚</li>
<li><strong>Vim/Neovim</strong>ï¼šä½œä¸ºä¸€åå¼€å‘è€…ï¼Œæˆ‘æƒ³æŠŠ <code>h</code> <code>j</code> <code>k</code> <code>l</code> çš„è‚Œè‚‰è®°å¿†å»¶ä¼¸åˆ°æ¸¸æˆé‡Œã€‚</li>
</ol>
<p>æ‰€ä»¥ Zsweep çš„è®¾è®¡å“²å­¦å°±æ˜¯ï¼š<strong>æç®€ UI + æè‡´æ‰‹é€Ÿ + å…¨é”®ç›˜æ“ä½œ</strong>ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/65d7b674a5e946dca622147610108a55~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgb3VndA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769838786&amp;x-signature=7NiGUAtTa4OfxRwuftmEnVQ7gAA%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">ğŸ› ï¸ æŠ€æœ¯æ ˆï¼šä¸ºä»€ä¹ˆé€‰æ‹© SvelteKit + Supabaseï¼Ÿ</h2>
<p>ä½œä¸ºä¸€ä¸ªå…¨æ ˆé¡¹ç›®ï¼Œæˆ‘æ²¡æœ‰é€‰æ‹©æˆ‘æœ€ç†Ÿæ‚‰çš„ Reactï¼Œè€Œæ˜¯é€‰æ‹©äº† <strong>SvelteKit</strong>ï¼Œæ­é… <strong>Supabase</strong>ã€‚</p>
<h3 data-id="heading-2">1. å‰ç«¯ï¼šSvelteKit + Tailwind CSS</h3>
<p>Svelte çœŸçš„å¤ªçˆ½äº†ã€‚åœ¨è¿™ä¸ªé¡¹ç›®é‡Œï¼Œæˆ‘æ·±åˆ»ä½“ä¼šåˆ°äº†â€œWrite less codeâ€çš„å«ä¹‰ã€‚</p>
<ul>
<li><strong>çŠ¶æ€ç®¡ç†</strong>ï¼šä¸éœ€è¦å¤æ‚çš„ Context æˆ– Reduxï¼ŒSvelte çš„å“åº”å¼å˜é‡è®©å¤„ç†æ¸¸æˆçŠ¶æ€ï¼ˆæ¯”å¦‚è®¡æ—¶å™¨ã€å‰©ä½™é›·æ•°ã€å½“å‰é€‰ä¸­çš„æ ¼å­ï¼‰å˜å¾—å¼‚å¸¸ç®€å•ã€‚</li>
<li><strong>åŠ¨ç”»</strong>ï¼šSvelte å†…ç½®çš„ <code>transition</code> å’Œ <code>animate</code> æŒ‡ä»¤ï¼Œè®©æˆ‘å‡ è¡Œä»£ç å°±å®ç°äº†â€œè¸©é›·â€æ—¶çš„å±å¹•éœ‡åŠ¨å’Œç»“ç®—ç•Œé¢çš„æ•°å­—è·³åŠ¨æ•ˆæœã€‚</li>
<li><strong>Vim é”®ä½ç»‘å®š</strong>ï¼šæˆ‘å†™äº†ä¸€ä¸ªå…¨å±€çš„é”®ç›˜ç›‘å¬å™¨ï¼Œé…åˆ Svelte çš„ storeï¼Œå®ç°äº†ä¸æ»‘çš„å…‰æ ‡ç§»åŠ¨ä½“éªŒã€‚</li>
</ul>
<h3 data-id="heading-3">2. åç«¯ &amp; æ•°æ®åº“ï¼šSupabase</h3>
<p>å› ä¸ºæ˜¯ç‹¬ç«‹å¼€å‘ï¼Œæˆ‘ä¸æƒ³èŠ±æ—¶é—´åœ¨é…è¿ç»´ç¯å¢ƒä¸Šã€‚Supabase æä¾›äº† PostgreSQL æ•°æ®åº“å’Œå¼€ç®±å³ç”¨çš„ Authï¼ˆè®¤è¯ï¼‰æœåŠ¡ã€‚</p>
<ul>
<li><strong>ç™»å½•</strong>ï¼šç›´æ¥é›†æˆäº† GitHub å’Œ Google OAuthï¼Œå‡ è¡Œé…ç½®å°±æå®šã€‚</li>
<li><strong>æ’è¡Œæ¦œ</strong>ï¼šåˆ©ç”¨ Postgres çš„å¼ºå¤§æŸ¥è¯¢èƒ½åŠ›ï¼Œæˆ‘èƒ½å¾ˆå¿«ç®—å‡ºå…¨çƒæ’åã€‚</li>
</ul>
<h2 data-id="heading-4">ğŸ’» é‚£äº›è®©æˆ‘â€œæ‰å¤´å‘â€çš„æŠ€æœ¯ç»†èŠ‚</h2>
<p>è™½ç„¶æ˜¯æ‰«é›·ï¼Œä½†ä¸ºäº†è¿½æ±‚æè‡´ä½“éªŒï¼Œæˆ‘åœ¨æ•°æ®å¤„ç†ä¸ŠèŠ±äº†ä¸å°‘å¿ƒæ€ã€‚</p>
<h3 data-id="heading-5">1. æ ¸å¿ƒç®—æ³•ï¼šMines/Min (æ‰«é›·æ•ˆç‡)</h3>
<p>ä¼ ç»Ÿçš„æ‰«é›·åªçœ‹æ—¶é—´ï¼Œä½†ä¸åŒéš¾åº¦çš„é›·æ•°ä¸ä¸€æ ·ã€‚ä¸ºäº†è¡¡é‡ç©å®¶çš„çœŸå®æ°´å¹³ï¼Œæˆ‘å‚è€ƒäº† Monkeytype çš„ <code>WPM</code> (Words Per Minute)ï¼Œè®¾è®¡äº† <strong>Mines/Min</strong> (æ¯åˆ†é’Ÿæ‰«é›·æ•°) æŒ‡æ ‡ã€‚</p>
<p>(ä¹Ÿimplementäº†3BVï¼Œä½†è€ƒè™‘åˆ°time modeï¼Œè¿˜éœ€åç»­æ›´æ–°ï¼‰</p>
<p>è¿™é‡Œæœ‰ä¸ªå‘ï¼šå¦‚æœæ˜¯é€šè¿‡ç‚¹å‡»å¤ä½ï¼ˆé‡å¼€ï¼‰å¤ªå¿«ï¼Œå¯èƒ½ä¼šå¯¼è‡´é™¤ä»¥é›¶æˆ–è€…æ—¶é—´æçŸ­çš„æ•°æ®å¼‚å¸¸ã€‚ æˆ‘åœ¨å‰ç«¯åŠ äº†ä¸€ä¸ªå¥å£®çš„è®¡ç®—é€»è¾‘ï¼š</p>
<p>TypeScript</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// æ ¸å¿ƒè®¡ç®—é€»è¾‘ç‰‡æ®µ</span>
if (timeTaken &gt; <span class="hljs-number">0</span>) {
  const minesPerMin = <span class="hljs-built_in">parseFloat</span>(((mines / timeTaken) * <span class="hljs-number">60</span>)<span class="hljs-selector-class">.toFixed</span>(<span class="hljs-number">1</span>));
  <span class="hljs-comment">// åªæœ‰å½“æˆç»©æ›´ä¼˜æ—¶æ‰æ›´æ–°æœ¬åœ°çš„æœ€ä½³è®°å½•</span>
  if (!calculatedBests[cat] || minesPerMin &gt; calculatedBests[cat].value) {
    calculatedBests<span class="hljs-selector-attr">[cat]</span> = {
      value: minesPerMin,
      date: g.created_at
    };
  }
}
</code></pre>
<h3 data-id="heading-6">2. å…¨çƒæ’è¡Œæ¦œä¸â€œé˜²ä½œå¼Šâ€</h3>
<p>ä¸ºäº†åš Leaderboardï¼Œæˆ‘åˆ©ç”¨ Supabase çš„ Foreign Key æŠŠ <code>game_results</code> è¡¨å’Œ <code>profiles</code> è¡¨å…³è”èµ·æ¥ã€‚</p>
<p>åˆšæ‰ä¸Šçº¿åå‘ç°ä¸€ä¸ªå°æ’æ›²ï¼šæ•°æ®åº“é‡Œå‡ºç°äº†ä¸€äº› <strong>0ç§’</strong> çš„é€šå…³è®°å½•ï¼ˆå¤§æ¦‚æ˜¯è°ƒè¯•æ—¶çš„æ®‹ç•™æ•°æ®ï¼Œæˆ–è€…æ˜¯ API è¢«äººç”¨ Postman åˆ·äº†ï¼‰ã€‚</p>
<p>ä¸ºäº†ä¿è¯å…¬å¹³ï¼Œæˆ‘åœ¨åç«¯æŸ¥è¯¢æ—¶åŠ äº†ä¸¥æ ¼çš„è¿‡æ»¤å™¨ï¼Œåˆ©ç”¨ SQL ç›´æ¥è¿‡æ»¤æ‰å¼‚å¸¸æ•°æ®ï¼š</p>
<p>TypeScript</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">const</span> { data } = <span class="hljs-keyword">await</span> supabase
  .<span class="hljs-keyword">from</span>(<span class="hljs-string">'game_results'</span>)
  .<span class="hljs-keyword">select</span>(<span class="hljs-string">'time, profiles(username)'</span>)
  .eq(<span class="hljs-string">'win'</span>, <span class="hljs-literal">true</span>)
  .gt(<span class="hljs-string">'time'</span>, <span class="hljs-number">0</span>) <span class="hljs-comment">// è¿‡æ»¤æ‰ 0s çš„å¼‚å¸¸æ•°æ®</span>
  .order(<span class="hljs-string">'time'</span>, { <span class="hljs-keyword">ascending</span>: <span class="hljs-literal">true</span> })
  .limit(<span class="hljs-number">50</span>);
</code></pre>
<p>ç°åœ¨ï¼Œæ’è¡Œæ¦œç»ˆäºå¹²å‡€äº†ï¼Œè¿˜èƒ½æ˜¾ç¤ºâ€œYour Rankâ€é«˜äº®è‡ªå·±çš„æ’åã€‚ï¼ˆä¸‹ä¸€ä¸ªPRï¼Œçš„ployï¼‰</p>
<h3 data-id="heading-7">3. ç”¨æˆ·ä½“éªŒç»†èŠ‚</h3>
<ul>
<li><strong>Glitch é£æ ¼</strong>ï¼šå½“è¸©é›·å¤±è´¥æ—¶ï¼Œæˆ‘æ²¡æœ‰ç”¨æ™®é€šçš„å¼¹çª—ï¼Œè€Œæ˜¯å†™äº†ä¸€ä¸ª CSS Glitchï¼ˆæ•…éšœé£ï¼‰ç‰¹æ•ˆï¼Œé…åˆ "FATAL_ERR" çš„æ–‡æ¡ˆï¼Œæ›´æœ‰æå®¢æ„Ÿã€‚</li>
<li><strong>çƒ­åŠ›å›¾</strong>ï¼šå‚è€ƒ GitHub Contributionï¼Œæˆ‘åœ¨ä¸ªäººä¸»é¡µåšäº†ä¸€ä¸ªæ‰«é›·çƒ­åŠ›å›¾ï¼Œè®°å½•ç©å®¶æ¯å¤©çš„æ´»è·ƒåº¦ã€‚</li>
</ul>
<h2 data-id="heading-8">ğŸš€ æ€»ç»“ä¸å¼€æº</h2>
<p>è¿™æ¬¡å†²ä¸Š Hacker News ç¬¬ 5 åï¼Œç»™æˆ‘æœ€å¤§çš„å¯ç¤ºæ˜¯ï¼š<strong>ä¸è¦ç­‰åˆ°é¡¹ç›®å®Œç¾äº†æ‰å‘å¸ƒã€‚</strong></p>
<p>Zsweep å…¶å®è¿˜æœ‰å¾ˆå¤š Issuesï¼ˆæ¯”å¦‚ä¹‹å‰çš„ Joined Date æ˜¾ç¤º Invalid Dateï¼Œåˆšåˆšæ‰ä¿®å¥½ ğŸ˜‚ï¼‰ï¼ŒUI ä¹Ÿä¸å¤Ÿå®Œç¾ã€‚ä½†å› ä¸ºå®ƒè§£å†³äº†ä¸€ä¸ªå°ç—›ç‚¹ï¼ˆæƒ³ç”¨ Vim ç©æ¸¸æˆï¼‰ï¼Œå¹¶ä¸”åšå¾—è¶³å¤Ÿç®€å•çº¯ç²¹ï¼Œå°±è·å¾—äº†å¾ˆå¤šå¼€å‘è€…çš„å–œçˆ±ã€‚</p>
<p>ç›®å‰é¡¹ç›®å®Œå…¨<strong>å¼€æº</strong>ï¼Œå¦‚æœä½ å¯¹ Svelteã€Vim æˆ–è€…æ‰«é›·æ„Ÿå…´è¶£ï¼Œæ¬¢è¿æ¥ GitHub ç»™ä¸ª Starï¼Œæˆ–è€…æ PR ä¸€èµ·æ”¹è¿›å®ƒï¼</p>
<ul>
<li><strong>Live Demo (è¯•ç©)</strong> : <a href="https://link.juejin.cn?target=https%3A%2F%2Fzsweep.com" target="_blank" title="https://zsweep.com" ref="nofollow noopener noreferrer">zsweep.com</a></li>
<li><strong>GitHub æºç </strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Foug-t%2Fzsweep" target="_blank" title="https://github.com/oug-t/zsweep" ref="nofollow noopener noreferrer">github.com/oug-t/zsweeâ€¦</a></li>
</ul>
<p><strong>å¦‚æœä½ ä¹Ÿå–œæ¬¢ Vim æˆ–è€… Svelteï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºäº¤æµï¼</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Go äºŒè¿›åˆ¶æµåºåˆ—åŒ–/ååºåˆ—åŒ–åº“]]></title>    <link>https://juejin.cn/post/7598641282324496411</link>    <guid>https://juejin.cn/post/7598641282324496411</guid>    <pubDate>2026-01-24T06:29:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598641282324496411" data-draft-id="7598435950410907658" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Go äºŒè¿›åˆ¶æµåºåˆ—åŒ–/ååºåˆ—åŒ–åº“"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-24T06:29:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°çŒ«çˆ±é…·"/> <meta itemprop="url" content="https://juejin.cn/user/492183410194808"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Go äºŒè¿›åˆ¶æµåºåˆ—åŒ–/ååºåˆ—åŒ–åº“
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/492183410194808/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°çŒ«çˆ±é…·
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T06:29:05.000Z" title="Sat Jan 24 2026 06:29:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Bytes - Go äºŒè¿›åˆ¶æµåºåˆ—åŒ–/ååºåˆ—åŒ–åº“</h2>
<p>ç±»ä¼¼ Rust deku åº“çš„ Go è¯­è¨€å®ç°ï¼Œç”¨äº TCP/UDP å­—èŠ‚æµåè®®çš„è§£æå’Œåºåˆ—åŒ–ã€‚</p>
<h3 data-id="heading-1">ç‰¹æ€§</h3>
<ul>
<li>ä½¿ç”¨ struct tag æè¿°äºŒè¿›åˆ¶æ ¼å¼</li>
<li>æ”¯æŒå¤§ç«¯åºå’Œå°ç«¯åº</li>
<li>æ”¯æŒä½çº§æ“ä½œ</li>
<li>æ”¯æŒæ¡ä»¶å­—æ®µ</li>
<li>æ”¯æŒæ•°ç»„ã€åˆ‡ç‰‡</li>
<li>æ”¯æŒåµŒå¥—ç»“æ„ä½“</li>
<li>æ”¯æŒè‡ªå®šä¹‰åºåˆ—åŒ–/ååºåˆ—åŒ–</li>
<li>æ”¯æŒå­—æ®µå¡«å……</li>
</ul>
<h3 data-id="heading-2">å®‰è£…</h3>
<pre><code class="hljs language-bash" lang="bash">go get github.com/teafull/bytes
</code></pre>
<h3 data-id="heading-3">å¿«é€Ÿå¼€å§‹</h3>
<h4 data-id="heading-4">åŸºæœ¬ä½¿ç”¨</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"github.com/teafull/bytes"</span>
)

<span class="hljs-keyword">type</span> PacketHeader <span class="hljs-keyword">struct</span> {
    Magic   <span class="hljs-type">uint16</span> <span class="hljs-string">`deku:"endian=big"`</span>
    Version <span class="hljs-type">uint8</span>  <span class="hljs-string">`deku:"bits=4"`</span>
    Type    <span class="hljs-type">uint8</span>  <span class="hljs-string">`deku:"bits=4"`</span>
    Length  <span class="hljs-type">uint16</span> <span class="hljs-string">`deku:"endian=big"`</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// åºåˆ—åŒ–</span>
    header := PacketHeader{
        Magic:   <span class="hljs-number">0x1234</span>,
        Version: <span class="hljs-number">1</span>,
        Type:    <span class="hljs-number">2</span>,
        Length:  <span class="hljs-number">16</span>,
    }
    data, err := bytes.Marshal(header)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-built_in">panic</span>(err)
    }
    fmt.Printf(<span class="hljs-string">"Serialized: %x\n"</span>, data)

    <span class="hljs-comment">// ååºåˆ—åŒ–</span>
    <span class="hljs-keyword">var</span> decoded PacketHeader
    _, err = bytes.Unmarshal(data, &amp;decoded)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-built_in">panic</span>(err)
    }
    fmt.Printf(<span class="hljs-string">"Decoded: %+v\n"</span>, decoded)
}
</code></pre>
<h4 data-id="heading-5">ä½å­—æ®µ</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> BitFields <span class="hljs-keyword">struct</span> {
    Flag1    <span class="hljs-type">uint8</span> <span class="hljs-string">`deku:"bits=1"`</span>
    Flag2    <span class="hljs-type">uint8</span> <span class="hljs-string">`deku:"bits=1"`</span>
    Reserved <span class="hljs-type">uint8</span> <span class="hljs-string">`deku:"bits=6"`</span>
    Value    <span class="hljs-type">uint8</span>
}
</code></pre>
<h4 data-id="heading-6">æ¡ä»¶å­—æ®µ</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> ConditionalPacket <span class="hljs-keyword">struct</span> {
    HasOption <span class="hljs-type">bool</span>  <span class="hljs-string">`deku:"bits=1"`</span>
    Reserved  <span class="hljs-type">uint8</span> <span class="hljs-string">`deku:"bits=7"`</span>
    Option    <span class="hljs-type">uint8</span> <span class="hljs-string">`deku:"cond=HasOption"`</span>  <span class="hljs-comment">// ä»…å½“ HasOption ä¸º true æ—¶å­˜åœ¨</span>
    Payload   <span class="hljs-type">uint16</span> <span class="hljs-string">`deku:"endian=big"`</span>
}
</code></pre>
<h4 data-id="heading-7">åŠ¨æ€æ•°ç»„</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> DynamicArray <span class="hljs-keyword">struct</span> {
    Type   <span class="hljs-type">uint8</span>
    Count  <span class="hljs-type">uint8</span>
    Values []<span class="hljs-type">uint16</span> <span class="hljs-string">`deku:"count=Count,endian=big"`</span>
}
</code></pre>
<h4 data-id="heading-8">åµŒå¥—ç»“æ„ä½“</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> Inner <span class="hljs-keyword">struct</span> {
    Value1 <span class="hljs-type">uint16</span> <span class="hljs-string">`deku:"endian=big"`</span>
    Value2 <span class="hljs-type">uint16</span> <span class="hljs-string">`deku:"endian=big"`</span>
}

<span class="hljs-keyword">type</span> Outer <span class="hljs-keyword">struct</span> {
    Header Inner
    Length <span class="hljs-type">uint16</span> <span class="hljs-string">`deku:"endian=big"`</span>
}
</code></pre>
<h4 data-id="heading-9">è‡ªå®šä¹‰åºåˆ—åŒ–</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> CustomField <span class="hljs-keyword">struct</span> {
    Data []<span class="hljs-type">byte</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *CustomField)</span></span> MarshalBinary() ([]<span class="hljs-type">byte</span>, <span class="hljs-type">error</span>) {
    <span class="hljs-comment">// è‡ªå®šä¹‰åºåˆ—åŒ–é€»è¾‘</span>
    <span class="hljs-keyword">return</span> c.Data, <span class="hljs-literal">nil</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *CustomField)</span></span> UnmarshalBinary(data []<span class="hljs-type">byte</span>) <span class="hljs-type">error</span> {
    <span class="hljs-comment">// è‡ªå®šä¹‰ååºåˆ—åŒ–é€»è¾‘</span>
    c.Data = <span class="hljs-built_in">make</span>([]<span class="hljs-type">byte</span>, <span class="hljs-built_in">len</span>(data))
    <span class="hljs-built_in">copy</span>(c.Data, data)
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
}
</code></pre>
<h4 data-id="heading-10">å­—æ®µå¡«å……</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> PaddedPacket <span class="hljs-keyword">struct</span> {
    Type     <span class="hljs-type">uint8</span>
    Padding  <span class="hljs-type">byte</span> <span class="hljs-string">`deku:"pad=3"`</span>  <span class="hljs-comment">// å¡«å……3ä¸ªå­—èŠ‚</span>
    Length   <span class="hljs-type">uint16</span> <span class="hljs-string">`deku:"endian=big"`</span>
}
</code></pre>
<h3 data-id="heading-11">Tag è¯´æ˜</h3>













































<table><thead><tr><th>Tag</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>endian</code></td><td>å­—èŠ‚åºï¼Œå¯é€‰å€¼ <code>big</code>ã€<code>little</code>ã€<code>native</code></td><td><code>deku:"endian=big"</code></td></tr><tr><td><code>bits</code></td><td>ä½å®½ï¼Œç”¨äºä½å­—æ®µï¼ˆ1-64ä½ï¼‰</td><td><code>deku:"bits=4"</code></td></tr><tr><td><code>bytes</code></td><td>å­—èŠ‚å®½åº¦</td><td><code>deku:"bytes=8"</code></td></tr><tr><td><code>cond</code></td><td>æ¡ä»¶å­—æ®µï¼Œä»…å½“æ¡ä»¶ä¸ºçœŸæ—¶è§£æ</td><td><code>deku:"cond=HasFlag"</code></td></tr><tr><td><code>count</code></td><td>æ•°ç»„/åˆ‡ç‰‡é•¿åº¦ï¼Œæ”¯æŒè¡¨è¾¾å¼</td><td><code>deku:"count=Length"</code> æˆ– <code>deku:"count=Length+1"</code></td></tr><tr><td><code>skip</code></td><td>è·³è¿‡å­—æ®µ</td><td><code>deku:"skip=true"</code></td></tr><tr><td><code>pad</code></td><td>å¡«å……å­—èŠ‚æ•°</td><td><code>deku:"pad=3"</code></td></tr></tbody></table>
<h3 data-id="heading-12">æ¡ä»¶è¡¨è¾¾å¼</h3>
<p>æ”¯æŒä»¥ä¸‹æ ¼å¼çš„æ¡ä»¶è¡¨è¾¾å¼ï¼š</p>
<ul>
<li>å¸ƒå°”å­—æ®µåï¼š<code>HasOption</code></li>
<li>ç­‰äºï¼š<code>Field == 1</code></li>
<li>ä¸ç­‰äºï¼š<code>Field != 0</code></li>
<li>å¤§äºï¼š<code>Field &gt; 5</code></li>
<li>å°äºï¼š<code>Field &lt; 10</code></li>
<li>å¤§äºç­‰äºï¼š<code>Field &gt;= 5</code></li>
<li>å°äºç­‰äºï¼š<code>Field &lt;= 10</code></li>
</ul>
<h3 data-id="heading-13">è®¡æ•°è¡¨è¾¾å¼</h3>
<p>æ”¯æŒä»¥ä¸‹æ ¼å¼çš„è®¡æ•°è¡¨è¾¾å¼ï¼š</p>
<ul>
<li>å­—æ®µåï¼š<code>Count</code></li>
<li>å­—æ®µååŠ å‡ä¹˜é™¤ï¼š<code>Count + 1</code>ã€<code>Length * 2</code></li>
<li>ç›´æ¥æ•°å­—ï¼š<code>4</code></li>
</ul>
<h3 data-id="heading-14">æ”¯æŒçš„ç±»å‹</h3>
<ul>
<li>æ•´æ•°ï¼š<code>uint8</code>, <code>uint16</code>, <code>uint32</code>, <code>uint64</code>, <code>int8</code>, <code>int16</code>, <code>int32</code>, <code>int64</code></li>
<li>å¸ƒå°”ï¼š<code>bool</code></li>
<li>æ•°ç»„ï¼š<code>[N]T</code></li>
<li>åˆ‡ç‰‡ï¼š<code>[]T</code></li>
<li>ç»“æ„ä½“ï¼šåµŒå¥—ç»“æ„ä½“</li>
<li>å­—ç¬¦ä¸²ï¼š<code>string</code>ï¼ˆæ”¯æŒå›ºå®šé•¿åº¦å’Œ C å­—ç¬¦ä¸²ï¼‰</li>
</ul>
<h3 data-id="heading-15">API</h3>
<h4 data-id="heading-16">Marshal</h4>
<p>å°†ç»“æ„ä½“åºåˆ—åŒ–ä¸ºå­—èŠ‚æ•°ç»„ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Marshal</span><span class="hljs-params">(v <span class="hljs-keyword">interface</span>{})</span></span> ([]<span class="hljs-type">byte</span>, <span class="hljs-type">error</span>)
</code></pre>
<h4 data-id="heading-17">Unmarshal</h4>
<p>ä»å­—èŠ‚æ•°ç»„ååºåˆ—åŒ–åˆ°ç»“æ„ä½“ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Unmarshal</span><span class="hljs-params">(data []<span class="hljs-type">byte</span>, v <span class="hljs-keyword">interface</span>{})</span></span> (<span class="hljs-type">int</span>, <span class="hljs-type">error</span>)
</code></pre>
<p>è¿”å›è¯»å–çš„å­—èŠ‚æ•°å’Œé”™è¯¯ã€‚</p>
<h3 data-id="heading-18">æµ‹è¯•</h3>
<p>è¿è¡Œæµ‹è¯•ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">go <span class="hljs-built_in">test</span> -v
</code></pre>
<p>æŸ¥çœ‹ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">go <span class="hljs-built_in">test</span> -run Example -v
</code></pre>
<h3 data-id="heading-19">æ€§èƒ½</h3>
<p>æœ¬åº“ä½¿ç”¨ä½çº§æ“ä½œå’Œåå°„ï¼Œé€‚åˆå¤„ç†ç½‘ç»œåè®®ç­‰äºŒè¿›åˆ¶æ•°æ®ã€‚å¯¹äºæ€§èƒ½æ•æ„Ÿçš„åœºæ™¯ï¼Œå»ºè®®ä½¿ç”¨è‡ªå®šä¹‰åºåˆ—åŒ–ã€‚</p>
<h4 data-id="heading-20">åŸºå‡†æµ‹è¯•ç»“æœ</h4>
<p>æµ‹è¯•ç¯å¢ƒï¼š</p>
<ul>
<li>OS: macOS (Darwin)</li>
<li>CPU: Apple M2 Pro (arm64)</li>
<li>Go: 1.21</li>
<li>æµ‹è¯•æ—¶é—´: 3s</li>
</ul>
<h5 data-id="heading-21">åºåˆ—åŒ–æ€§èƒ½</h5>





















































<table><thead><tr><th>æµ‹è¯•</th><th>ns/op</th><th>B/op</th><th>allocs/op</th></tr></thead><tbody><tr><td>Small Packet (5 bytes)</td><td>560.7</td><td>362</td><td>13</td></tr><tr><td>Medium Packet (10 bytes)</td><td>1196</td><td>565</td><td>22</td></tr><tr><td>Large Packet (148 bytes)</td><td>2390</td><td>976</td><td>26</td></tr><tr><td>Bit Field (4 bytes)</td><td>818.8</td><td>464</td><td>15</td></tr><tr><td>Dynamic Array (22 bytes)</td><td>474.6</td><td>308</td><td>16</td></tr><tr><td>Nested Struct (6 bytes)</td><td>609.8</td><td>368</td><td>15</td></tr><tr><td>Conditional (4 bytes)</td><td>618.0</td><td>360</td><td>12</td></tr></tbody></table>
<h5 data-id="heading-22">ååºåˆ—åŒ–æ€§èƒ½</h5>





















































<table><thead><tr><th>æµ‹è¯•</th><th>ns/op</th><th>B/op</th><th>allocs/op</th></tr></thead><tbody><tr><td>Small Packet (5 bytes)</td><td>591.7</td><td>314</td><td>13</td></tr><tr><td>Medium Packet (10 bytes)</td><td>1251</td><td>517</td><td>22</td></tr><tr><td>Large Packet (148 bytes)</td><td>2612</td><td>672</td><td>25</td></tr><tr><td>Bit Field (4 bytes)</td><td>848.2</td><td>416</td><td>15</td></tr><tr><td>Dynamic Array (22 bytes)</td><td>665.9</td><td>308</td><td>18</td></tr><tr><td>Nested Struct (6 bytes)</td><td>644.5</td><td>320</td><td>15</td></tr><tr><td>Conditional (4 bytes)</td><td>651.0</td><td>312</td><td>12</td></tr></tbody></table>
<h5 data-id="heading-23">å¾€è¿”æ€§èƒ½ (Marshal + Unmarshal)</h5>





























<table><thead><tr><th>æµ‹è¯•</th><th>ns/op</th><th>B/op</th><th>allocs/op</th></tr></thead><tbody><tr><td>Small Packet</td><td>1170</td><td>677</td><td>26</td></tr><tr><td>Medium Packet</td><td>2489</td><td>1082</td><td>44</td></tr><tr><td>Large Packet</td><td>4977</td><td>1648</td><td>51</td></tr></tbody></table>
<h5 data-id="heading-24">ä½æ“ä½œæ€§èƒ½</h5>























<table><thead><tr><th>æµ‹è¯•</th><th>ns/op</th><th>B/op</th><th>allocs/op</th></tr></thead><tbody><tr><td>Bit Write</td><td>20.91</td><td>0</td><td>0</td></tr><tr><td>Bit Read</td><td>15.64</td><td>0</td><td>0</td></tr></tbody></table>
<h4 data-id="heading-25">æ€§èƒ½åˆ†æ</h4>
<ol>
<li>
<p><strong>åºåˆ—åŒ–æ€§èƒ½</strong></p>
<ul>
<li>å°å‹æ•°æ®åŒ…ï¼ˆ5å­—èŠ‚ï¼‰ï¼š~560 ns/opï¼Œé€‚åˆé«˜é¢‘åœºæ™¯</li>
<li>å¤§å‹æ•°æ®åŒ…ï¼ˆ148å­—èŠ‚ï¼‰ï¼š~2.4 Î¼s/opï¼ŒåŒ…å«128å­—èŠ‚æ•°ç»„</li>
<li>ä½å­—æ®µæ“ä½œé¢å¤–å¼€é”€ï¼š~818 ns/op</li>
</ul>
</li>
<li>
<p><strong>ååºåˆ—åŒ–æ€§èƒ½</strong></p>
<ul>
<li>å°å‹æ•°æ®åŒ…ï¼ˆ5å­—èŠ‚ï¼‰ï¼š~590 ns/op</li>
<li>å¤§å‹æ•°æ®åŒ…ï¼ˆ148å­—èŠ‚ï¼‰ï¼š~2.6 Î¼s/op</li>
<li>ä¸åºåˆ—åŒ–æ€§èƒ½åŸºæœ¬ä¸€è‡´</li>
</ul>
</li>
<li>
<p><strong>å†…å­˜åˆ†é…</strong></p>
<ul>
<li>å°å‹æ•°æ®åŒ…ï¼š~360 B/opï¼Œ13æ¬¡åˆ†é…</li>
<li>å¤§å‹æ•°æ®åŒ…ï¼š~976 B/opï¼Œ26æ¬¡åˆ†é…</li>
<li>ä½æ“ä½œï¼š0åˆ†é…ï¼Œä½¿ç”¨é¢„åˆ†é…ç¼“å†²åŒº</li>
</ul>
</li>
<li>
<p><strong>ä½æ“ä½œæ€§èƒ½</strong></p>
<ul>
<li>çº¯ä½è¯»å†™æ“ä½œï¼š15-21 ns/opï¼Œ0åˆ†é…</li>
<li>éå¸¸é«˜æ•ˆï¼Œæ¥è¿‘å†…å­˜è®¿é—®é€Ÿåº¦</li>
</ul>
</li>
</ol>
<h4 data-id="heading-26">è¿è¡ŒåŸºå‡†æµ‹è¯•</h4>
<p>è¿è¡Œæ‰€æœ‰åŸºå‡†æµ‹è¯•ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">go <span class="hljs-built_in">test</span> -bench=. -benchmem
</code></pre>
<p>è¿è¡Œç‰¹å®šåŸºå‡†æµ‹è¯•ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">go <span class="hljs-built_in">test</span> -bench=BenchmarkMarshal -benchmem
</code></pre>
<p>è¿è¡ŒåŸºå‡†æµ‹è¯•å¹¶æ˜¾ç¤ºå†…å­˜åˆ†é…è¯¦æƒ…ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">go <span class="hljs-built_in">test</span> -bench=. -benchmem -benchtime=5s
</code></pre>
<h4 data-id="heading-27">æ€§èƒ½ä¼˜åŒ–å»ºè®®</h4>
<ol>
<li>
<p><strong>å‡å°‘åå°„å¼€é”€</strong></p>
<ul>
<li>å¯¹äºçƒ­ç‚¹è·¯å¾„ï¼Œè€ƒè™‘ä½¿ç”¨ä»£ç ç”Ÿæˆ</li>
<li>ç¼“å­˜åå°„ç±»å‹ä¿¡æ¯</li>
</ul>
</li>
<li>
<p><strong>å†…å­˜åˆ†é…ä¼˜åŒ–</strong></p>
<ul>
<li>é‡ç”¨å­—èŠ‚ç¼“å†²åŒº</li>
<li>ä½¿ç”¨å¯¹è±¡æ± å‡å°‘åˆ†é…</li>
</ul>
</li>
<li>
<p><strong>ä½æ“ä½œä¼˜åŒ–</strong></p>
<ul>
<li>æ‰¹é‡å¤„ç†ä½æ“ä½œ</li>
<li>å‡å°‘å¯¹é½æ“ä½œ</li>
</ul>
</li>
</ol>
<h3 data-id="heading-28">è®¸å¯è¯</h3>
<p>MIT License</p>
<h3 data-id="heading-29">ğŸ“¦ é¡¹ç›®æˆæœ</h3>
<h4 data-id="heading-30">æ ¸å¿ƒåŠŸèƒ½å®ç°</h4>
<p>âœ… <strong>åŸºç¡€æ•°æ®ç±»å‹æ”¯æŒ</strong></p>
<ul>
<li>æ•´æ•°ç±»å‹ï¼šuint8/16/32/64, int8/16/32/64</li>
<li>å¸ƒå°”ç±»å‹ï¼šbool</li>
<li>æ•°ç»„å’Œåˆ‡ç‰‡</li>
<li>åµŒå¥—ç»“æ„ä½“</li>
<li>å­—ç¬¦ä¸²ç±»å‹</li>
</ul>
<p>âœ… <strong>é«˜çº§ç‰¹æ€§</strong></p>
<ul>
<li>ä½çº§æ“ä½œï¼ˆ1-64ä½ï¼‰</li>
<li>å­—èŠ‚åºæ§åˆ¶ï¼ˆå¤§ç«¯åº/å°ç«¯åº/æœ¬æœºå­—èŠ‚åºï¼‰</li>
<li>æ¡ä»¶å­—æ®µï¼ˆåŸºäºå…¶ä»–å­—æ®µå€¼ï¼‰</li>
<li>åŠ¨æ€æ•°ç»„ï¼ˆæ”¯æŒè¡¨è¾¾å¼å®šä¹‰é•¿åº¦ï¼‰</li>
<li>å­—æ®µå¡«å……ï¼ˆè‡ªåŠ¨å¯¹é½ï¼‰</li>
<li>è‡ªå®šä¹‰åºåˆ—åŒ–ï¼ˆå®ç°æ¥å£ï¼‰</li>
</ul>
<p>âœ… <strong>Struct Tag æ”¯æŒ</strong></p>
<pre><code class="hljs language-go" lang="go">deku:<span class="hljs-string">"endian=big"</span>      <span class="hljs-comment">// å­—èŠ‚åº</span>
deku:<span class="hljs-string">"bits=4"</span>          <span class="hljs-comment">// ä½å®½</span>
deku:<span class="hljs-string">"cond=HasFlag"</span>    <span class="hljs-comment">// æ¡ä»¶å­—æ®µ</span>
deku:<span class="hljs-string">"count=Length"</span>    <span class="hljs-comment">// æ•°ç»„é•¿åº¦</span>
deku:<span class="hljs-string">"pad=3"</span>           <span class="hljs-comment">// å¡«å……å­—èŠ‚</span>
</code></pre>
<h4 data-id="heading-31">é¡¹ç›®æ–‡ä»¶ç»“æ„</h4>
<pre><code class="hljs language-bash" lang="bash">bytes/
â”œâ”€â”€ bit_reader.go      <span class="hljs-comment"># ä½è¯»å–å™¨</span>
â”œâ”€â”€ bit_writer.go      <span class="hljs-comment"># ä½å†™å…¥å™¨</span>
â”œâ”€â”€ types.go           <span class="hljs-comment"># æ ¸å¿ƒç±»å‹å®šä¹‰</span>
â”œâ”€â”€ tags.go            <span class="hljs-comment"># Tag è§£æå™¨</span>
â”œâ”€â”€ marshal.go         <span class="hljs-comment"># åºåˆ—åŒ–å®ç°</span>
â”œâ”€â”€ unmarshal.go       <span class="hljs-comment"># ååºåˆ—åŒ–å®ç°</span>
â”œâ”€â”€ evaluator.go       <span class="hljs-comment"># æ¡ä»¶è¡¨è¾¾å¼æ±‚å€¼</span>
â”œâ”€â”€ example_test.go    <span class="hljs-comment"># æµ‹è¯•ç”¨ä¾‹ï¼ˆ8ä¸ªï¼‰</span>
â”œâ”€â”€ examples.go        <span class="hljs-comment"># ä½¿ç”¨ç¤ºä¾‹</span>
â”œâ”€â”€ demo/main.go       <span class="hljs-comment"># æ¼”ç¤ºç¨‹åº</span>
â”œâ”€â”€ README.md          <span class="hljs-comment"># å®Œæ•´æ–‡æ¡£</span>
â”œâ”€â”€ PROJECT_OVERVIEW.md <span class="hljs-comment"># é¡¹ç›®æ¦‚è§ˆ</span>
â””â”€â”€ go.mod             <span class="hljs-comment"># Go æ¨¡å—</span>
</code></pre>
<h4 data-id="heading-32">æµ‹è¯•ç»“æœ</h4>
<ul>
<li>âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ˆ8ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼‰</li>
<li>âœ… ä»£ç è¦†ç›–ç‡ï¼š48.0%</li>
<li>âœ… æ¼”ç¤ºç¨‹åºè¿è¡Œæ­£å¸¸</li>
<li>âœ… æ— ç¼–è¯‘é”™è¯¯</li>
</ul>
<h4 data-id="heading-33">ä½¿ç”¨ç¤ºä¾‹</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> Packet <span class="hljs-keyword">struct</span> {
    Magic   <span class="hljs-type">uint16</span> <span class="hljs-string">`deku:"endian=big"`</span>
    Version <span class="hljs-type">uint8</span>  <span class="hljs-string">`deku:"bits=4"`</span>
    Type    <span class="hljs-type">uint8</span>  <span class="hljs-string">`deku:"bits=4"`</span>
    Length  <span class="hljs-type">uint16</span> <span class="hljs-string">`deku:"endian=big"`</span>
}

<span class="hljs-comment">// åºåˆ—åŒ–</span>
data, _ := bytes.Marshal(packet)

<span class="hljs-comment">// ååºåˆ—åŒ–</span>
bytes.Unmarshal(data, &amp;packet)
</code></pre>
<h4 data-id="heading-34">ä¸ deku åº“å¯¹æ¯”</h4>















































<table><thead><tr><th>ç‰¹æ€§</th><th>deku (Rust)</th><th>bytes (Go)</th><th>çŠ¶æ€</th></tr></thead><tbody><tr><td>ä½çº§æ“ä½œ</td><td>âœ“</td><td>âœ“</td><td>âœ…</td></tr><tr><td>æ¡ä»¶å­—æ®µ</td><td>âœ“</td><td>âœ“</td><td>âœ…</td></tr><tr><td>åŠ¨æ€æ•°ç»„</td><td>âœ“</td><td>âœ“</td><td>âœ…</td></tr><tr><td>è‡ªå®šä¹‰åºåˆ—åŒ–</td><td>âœ“</td><td>âœ“</td><td>âœ…</td></tr><tr><td>å­—èŠ‚åºæ”¯æŒ</td><td>âœ“</td><td>âœ“</td><td>âœ…</td></tr><tr><td>åµŒå¥—ç»“æ„ä½“</td><td>âœ“</td><td>âœ“</td><td>âœ…</td></tr></tbody></table>
<h4 data-id="heading-35">é€‚ç”¨åœºæ™¯</h4>
<ol>
<li>TCP/UDP ç½‘ç»œåè®®è§£æ</li>
<li>äºŒè¿›åˆ¶æ–‡ä»¶æ ¼å¼å¤„ç†</li>
<li>é€šä¿¡åè®®å®ç°</li>
<li>æ•°æ®åºåˆ—åŒ–ä¸ååºåˆ—åŒ–</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å›¾å½¢ç¼–è¾‘å™¨ï¼šFigma åˆ›å»ºå›¾å½¢çš„å‘½åæ–¹æ¡ˆ]]></title>    <link>https://juejin.cn/post/7598435950410743818</link>    <guid>https://juejin.cn/post/7598435950410743818</guid>    <pubDate>2026-01-24T05:39:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598435950410743818" data-draft-id="7598469864256405555" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å›¾å½¢ç¼–è¾‘å™¨ï¼šFigma åˆ›å»ºå›¾å½¢çš„å‘½åæ–¹æ¡ˆ"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-24T05:39:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯è¥¿ç“œå“¥"/> <meta itemprop="url" content="https://juejin.cn/user/2066737589133015"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å›¾å½¢ç¼–è¾‘å™¨ï¼šFigma åˆ›å»ºå›¾å½¢çš„å‘½åæ–¹æ¡ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2066737589133015/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯è¥¿ç“œå“¥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T05:39:54.000Z" title="Sat Jan 24 2026 05:39:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä½ å¥½ï¼Œæˆ‘æ˜¯ç“œæŸã€‚</p>
<p>å‰å‡ å¤©ç¾¤é‡Œæœ‰äººé—®äº†æˆ‘ä¸€ä¸ªæœ‰æ„æ€çš„é—®é¢˜ï¼Œå°±æ˜¯ Figma åˆ›å»ºå›¾å½¢ï¼Œå®ƒçš„å‘½åè§„åˆ™æ˜¯æ€æ ·çš„ï¼Ÿ</p>
<p>è¿™ä¸ªé—®é¢˜æŒºæœ‰è¶£çš„ï¼Œä¸å¦¨å±•å¼€è¯´è¯´ã€‚
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2740c3771fc841be9a0d4e9220b96a6e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv6KW_55Oc5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769837994&amp;x-signature=cy%2F3ARzPFzsT%2BUKYInmgFhjqpwA%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">ç»˜åˆ¶å›¾å½¢åœºæ™¯</h2>
<p>Figma ä¸­é€šè¿‡ç»˜åˆ¶åˆ›å»ºå›¾å½¢ï¼Œå›¾å½¢åç§°ä¼šç»™å›¾å½¢ç±»å‹å¯¹åº”çš„å‰ç¼€ï¼ŒåŠ ä¸Šä¸€ä¸ªç©ºæ ¼ç¬¦ï¼Œä»¥åŠä¸€ä¸ªæ­£æ•´æ•°åºå·ï¼Œå¦‚ <code>"Rectangle 6"</code>ã€<code>"Vector 3"</code>ã€‚</p>
<p>ç»˜åˆ¶å›¾å½¢æ—¶ï¼Œä¼šæ‰¾åˆ°å®ƒçš„å›¾å½¢ç±»å‹ï¼Œåœ¨å½“å‰ç”»å¸ƒä¸­æ‰¾åˆ°å¯¹åº”çš„æœ€å¤§åºå·ã€‚å–è¿™ä¸ªåºå· + 1ï¼Œä½œä¸ºæ–°çš„å›¾å½¢çš„åºå·ã€‚</p>
<p>æ•´ä½“çš„é€»è¾‘æ˜¯ï¼š</p>
<ul>
<li>æ ¹æ® type æ‹¿åˆ°åå­—å‰ç¼€ prefixã€‚å¦‚çŸ©å½¢çš„ç±»å‹æ˜¯  "ROUNDED_RECTANGLE"ï¼Œæ˜ å°„æ‹¿åˆ° "Rectangle"ï¼ˆè¿™é‡Œå¯åšå›½é™…åŒ–ï¼‰ï¼›</li>
<li>åŸºäº prefixéå†ç”»å¸ƒä¸Šæ‰€æœ‰èŠ‚ç‚¹ï¼Œæ ¹æ® <strong>æŸä¸ªè§„åˆ™</strong> è®¡ç®—å‡ºè¿™ä¸ª prefix çš„æœ€å¤§åºå· numï¼›</li>
<li>æ–°å›¾å½¢çš„åå­—å°±æ˜¯ <code>prefix + ' ' + (num + 1)</code>ã€‚</li>
</ul>
<p>ç»˜åˆ¶ä¸€ä¸ªæ–°çš„çŸ©å½¢ï¼Œéå†å½“å‰å›¾çº¸ä¸­çš„å›¾å½¢ï¼ŒåŒ¹é…å›¾å½¢åä¸º <code>/^Rectangle\s*(\d+)/</code> çš„ï¼Œæ‹¿åˆ°å¯¹åº”çš„åºå·ï¼Œæ‰¾å‡ºå…¶ä¸­çš„æœ€å¤§å€¼ï¼Œåœ¨è¿™ä¸ªç¤ºä¾‹ä¸­æ˜¯ 3ã€‚ç„¶åæˆ‘ä»¬åŠ  1ï¼Œå¾—åˆ° 4ï¼Œäºæ˜¯æˆ‘ä»¬çš„æ–°çš„çŸ©å½¢çš„ name å°±æ˜¯ <code>"Rectangle 4"</code>ã€‚
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/761619f1a2634c7a937901c58e2f404b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv6KW_55Oc5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769837994&amp;x-signature=oRH%2B1jbVhwInLbeJsRgwGC%2FZOzk%3D" alt="" loading="lazy"/>
æ­£åˆ™  <code>/^Rectangle\s*(\d+)/</code> çš„åŒ¹é…è§„åˆ™æ˜¯ï¼š</p>
<ul>
<li>å‰é¢ä¸èƒ½æœ‰ç©ºæ ¼ï¼›</li>
<li>ä¸­é—´ç©ºæ ¼å¯ä»¥æ˜¯ 0 åˆ°å¤šä¸ªï¼›</li>
<li>æ•°å­—åªå–æ•´æ•°ï¼Œæ•°å­—åé¢å¯ä»¥æœ‰å¤šä½™çš„ä¸œè¥¿ï¼ˆå¦‚ <code>"Rectangle 2test"</code> æ˜¯ç¬¦åˆè§„åˆ™çš„ï¼Œä¼šæ‹¿åˆ° 2ï¼‰ã€‚</li>
</ul>

<pre><code class="hljs language-python" lang="python">const getNumFromName = (<span class="hljs-built_in">str</span>, prefix) =&gt; {  const regex = new RegExp(`^${prefix}\\s*(\\d+)`);  const <span class="hljs-keyword">match</span> = <span class="hljs-built_in">str</span>.<span class="hljs-keyword">match</span>(regex);  <span class="hljs-keyword">return</span> <span class="hljs-keyword">match</span> ? parseInt(<span class="hljs-keyword">match</span>[<span class="hljs-number">1</span>]) : undefined;}// ç”¨æ³•å¦‚ä¸‹ï¼šgetNumFromName(<span class="hljs-string">'Rectangle 25'</span>, <span class="hljs-string">'Rectangle'</span>) // 25getNumFromName(<span class="hljs-string">' Rectangle 25'</span>, <span class="hljs-string">'Rectangle'</span>) // undefinedgetNumFromName(<span class="hljs-string">'Rectangle  25.7'</span>, <span class="hljs-string">'Rectangle'</span>) // 25getNumFromName(<span class="hljs-string">'Rectangle 25hello'</span>, <span class="hljs-string">'Rectangle'</span>) // <span class="hljs-number">25</span>
</code></pre>
<p>è®¡ç®—å½“å‰ç”»å¸ƒä¸­ç‰¹å®šå‰ç¼€çš„æœ€å¤§åºå·ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">getNodesMaxNum</span> = (<span class="hljs-params">nodes, prefix</span>) =&gt; {   <span class="hljs-keyword">let</span> maxNum = <span class="hljs-number">0</span>;  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> node <span class="hljs-keyword">of</span> nodes) {    <span class="hljs-keyword">const</span> name = node.<span class="hljs-property">name</span>;    <span class="hljs-keyword">const</span> num = <span class="hljs-title function_">getNumFromName</span>(name, prefix);    <span class="hljs-keyword">if</span> (num != <span class="hljs-literal">undefined</span>)      maxNum = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(maxNum, num);  }  <span class="hljs-keyword">return</span> maxNum;}<span class="hljs-comment">// æ‹¿åˆ°æ–°çš„å›¾å½¢åconst num = getNodesMaxNum(getAllNodes(), 'Rectangle') + 1;const nodeName = 'Rectangle ' + num;</span>
</code></pre>
<p>å‘½åå’Œç”»å¸ƒä¸­çš„å›¾å½¢çš„å®é™…ç±»å‹å®Œå…¨æ²¡å…³ç³»ï¼Œä½ å¯ä»¥ç»™ä¸€ä¸ªåœ†å½¢å›¾å½¢å‘½åä¸º <code>Rectangle &lt;num&gt;</code> ï¼Œè¿™ä¸ª name ä»æ—§ä¼šå‚ä¸è®¡ç®—ã€‚</p>
<p>å¦‚æœè§‰å¾—éå†ç”»å¸ƒçš„æ‰€æœ‰èŠ‚ç‚¹æ¯”è¾ƒè€—æ—¶ï¼Œå¯ä»¥è€ƒè™‘ç¼“å­˜ä¸åŒå›¾å½¢çš„æœ€å¤§åºå·ï¼Œéœ€è¦åœ¨æ–°å¢å›¾å½¢ã€åˆ é™¤å›¾å½¢ã€æ›´æ–°å›¾å½¢åæ—¶åšç¼“å­˜çš„æ›´æ–°ã€‚</p>
<h2 data-id="heading-1">å¤åˆ¶åœºæ™¯</h2>
<p>Figma ä¸­å¤åˆ¶å›¾å½¢ï¼Œä¹Ÿä¼šå¯¹å›¾å½¢åè¿›è¡Œé‡å‘½åï¼Œé€»è¾‘å’Œåˆ›å»ºä¸å¤ªä¸€æ ·ã€‚
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5080c3a328884c39afbacde75aa814ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv6KW_55Oc5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769837994&amp;x-signature=OLBfLSKMViVgmXJBVzVDYPR0bUw%3D" alt="" loading="lazy"/>
é€»è¾‘æ˜¯ï¼š</p>
<ul>
<li>åˆ¤æ–­è¢«å¤åˆ¶å›¾å½¢çš„åå­—åœ¨ <strong>å¤åˆ¶ä½ç½®å±‚çº§</strong> ä¸‹æ˜¯å¦æœ‰åŒåå›¾å½¢ï¼Œå¦‚æœæ²¡æœ‰åŒåï¼Œä¸éœ€è¦é‡å‘½åï¼›</li>
<li>å¦‚æœæœ‰åŒåï¼Œåˆ¤æ–­è¢«å¤åˆ¶å›¾å½¢åæ˜¯å¦åŒ¹é… <code>/^(.*)\s(\d+)/</code>ã€‚å¦‚æœä¸åŒ¹é…ï¼Œä¸é‡å‘½åï¼›å¦‚æœåŒ¹é…ï¼Œå–å¾—å‰ç¼€ prefixï¼›</li>
<li>æ‰§è¡Œå‰é¢ç»˜åˆ¶åœºæ™¯ç›¸åŒçš„é€»è¾‘ï¼Œä¸è¿‡è¿™æ¬¡ä¸ç”¨æ‰€æœ‰èŠ‚ç‚¹ï¼Œåªéå†<strong>å¤åˆ¶ä½ç½®å±‚çº§</strong> ä¸‹çš„èŠ‚ç‚¹ã€‚</li>
</ul>
<p>è·å– prefix çš„æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">const</span> getNamePrefix = (<span class="hljs-type">str</span>) =&gt; {  <span class="hljs-keyword">const</span> regex = /^(.*)\s\d+$/;  <span class="hljs-keyword">const</span> <span class="hljs-keyword">match</span> = <span class="hljs-type">str</span>.<span class="hljs-title function_ invoke__">match</span>(regex);  <span class="hljs-keyword">return</span> <span class="hljs-keyword">match</span> ? <span class="hljs-keyword">match</span>[<span class="hljs-number">1</span>] : undefined;}
</code></pre>
<p>prefix ä¸è¦æ±‚æ˜¯å›¾å½¢ç±»å‹å‰ç¼€ï¼Œå¯ä»¥æ˜¯ä»»ä½•å­—ç¬¦ã€‚æ‰€ä»¥å¤åˆ¶ "banana 2"ï¼Œä¹Ÿæ˜¯ä¼šå¾—åˆ° "banana 3" çš„ã€‚
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/76251963bf0a429b88eb6eb11671ee04~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv6KW_55Oc5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769837994&amp;x-signature=K1IIJiaX1%2Bye7gEoMlxqPlo6XhU%3D" alt="" loading="lazy"/>
æœ‰ä¸ªåœ°æ–¹è¦æ³¨æ„ä¸‹ï¼Œå°±æ˜¯å¤åˆ¶å¤šä¸ªå›¾å½¢çš„æ—¶å€™ï¼Œå½“ç»™ä¸Šä¸€ä¸ªå›¾å½¢è®¡ç®—å¥½æ–°çš„ name åï¼Œä¸‹ä¸€ä¸ªå›¾å½¢è¦æŠŠä¸Šä¸€ä¸ªå›¾å½¢çš„ name ä¹Ÿçº³å…¥è¿ç®—ï¼Œå¦åˆ™ä¼šå‡ºç°ç›¸åŒçš„åºå·ã€‚</p>
<p>å¦å¤–ï¼Œå¦‚æœå¤åˆ¶äº†ç»„ï¼Œç»„ä¸‹èŠ‚ç‚¹ä¸ä¼šè¿›è¡Œé‡å‘½åï¼Œå› ä¸ºå®ƒä»¬å’Œå¤åˆ¶ä½ç½®ä¸åœ¨ä¸€ä¸ªå±‚çº§äº†ã€‚</p>
<p>è¿˜æœ‰å°±æ˜¯æ–‡æœ¬å›¾å½¢æ¯”è¾ƒç‰¹æ®Šï¼Œå¦‚æœå¼€å¯äº† autoRenameï¼Œå›¾å½¢åéœ€è¦è·Ÿéšæ–‡æœ¬å†…å®¹ï¼Œä¼˜å…ˆçº§æ›´é«˜ï¼Œä¹Ÿä¸ä¼šé‡å‘½åã€‚</p>
<h2 data-id="heading-2">ä¼˜ç¼ºç‚¹</h2>
<p>Figma ç»™å›¾å½¢åŠ åºå·çš„å¥½å¤„ï¼Œæ˜¯ **å¯ä»¥ä¸€å®šç¨‹åº¦å¯¹å›¾å½¢è¿›è¡Œæ ‡è¯†ã€‚**æ­¤å¤–é€’å¢çš„ç‰¹æ€§ï¼Œä¹Ÿèƒ½æ¸…æ™°åœ°æ„ŸçŸ¥åˆ°å›¾å½¢çš„åˆ›å»ºæ—¶é—´é¡ºåºï¼Œå°¤å…¶æ˜¯å¤åˆ¶å¤§é‡ç›¸åŒå›¾å½¢æ—¶ï¼Œèƒ½æ¸…æ™°è¯†åˆ«å‡ºè°æ˜¯å¤åˆ¶å‡ºæ¥çš„ã€‚</p>
<p>ç¼ºç‚¹æ˜¯ï¼Œä¸å¤ªä¼˜é›…ã€‚ä½†æˆ‘ä»¬åˆ›å»ºäº†å¤§é‡çš„å›¾å½¢ï¼Œä¼šå‘ç°å®ƒä»¬çš„åå­—ä¼šå¸¦ä¸Šä¸€æ®µå¾ˆé•¿çš„æ²¡æœ‰æ„ä¹‰çš„ç‹—å±è†è¯ä¸€èˆ¬çš„æ•°å­—ã€‚</p>
<p>ä¹Ÿæœ‰ä¸€äº›åŠæ³•å¯ä»¥å»æ‰åç¼€ã€‚</p>
<p>Figma æä¾›äº†ä¸€ä¸ªæ‰¹é‡é‡å‘½åçš„èƒ½åŠ›ï¼Œé€‰ä¸­å¤šä¸ªå›¾å½¢ï¼Œç„¶åæŒ‰ä¸‹ Command / Ctrl + R å¯å”¤èµ·ç„¶åæŒ‰ä¸€å®šçš„è§„åˆ™æ”¹åã€‚
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b73d7ce0ca146f2b974b951122f9da4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv6KW_55Oc5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769837994&amp;x-signature=lDGEt5qazV3XnLra02pibcHhbYA%3D" alt="" loading="lazy"/>
å¦å¤–ä¹Ÿå¯ä»¥å®‰è£…ä¸€ä¸ª Figma æ’ä»¶ï¼Œå«åš No Numbersï¼Œå®ƒæ˜¯ä¸€ä¸ªè„šæœ¬ï¼Œæ‰§è¡Œä¸€ä¸‹ï¼Œå°±èƒ½å°†é€‰ä¸­çš„å›¾å½¢æˆ–ç”»å¸ƒä¸­æ‰€æœ‰å›¾å½¢åçš„æ•°å­—åç¼€å»æ‰ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.figma.com%2Fcommunity%2Fplugin%2F1017928273649269221%2Fno-numbers" target="_blank" title="https://www.figma.com/community/plugin/1017928273649269221/no-numbers" ref="nofollow noopener noreferrer">www.figma.com/community/pâ€¦</a>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b7317a274ba48a48b830d130f198307~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv6KW_55Oc5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769837994&amp;x-signature=1WqS4W5vatPNy8%2BYQsz0Mzxghec%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">æ–¹æ¡ˆäºŒ</h2>
<p>è¿˜æœ‰ç§æ–¹æ¡ˆæ˜¯ <strong>æ–°å»ºå›¾å½¢ï¼Œå›¾å½¢åä¸å¸¦æ•°å­—åç¼€çš„</strong>ï¼Œæ¯”å¦‚ Adobe Illustractorã€Affinityã€‚</p>
<p>å‡†ç¡®æ¥è¯´ï¼Œå®ƒä»¬åˆ›å»ºçš„å›¾å½¢ï¼Œæ˜¯æ²¡æœ‰åå­—çš„ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">{  <span class="hljs-built_in">id</span>: <span class="hljs-string">'1:2'</span>,  <span class="hljs-built_in">type</span>: <span class="hljs-string">'RECT'</span>,  name: undefined  // ...}
</code></pre>
<p>è™½ç„¶æ²¡æœ‰åå­—ï¼Œä½†æœ‰ typeï¼Œåœ¨ UI å±‚å¯ä»¥åŸºäºè¿™ä¸ª type ç»™å‡ºä¸€ä¸ªè™šå‡çš„ â€œå›¾å½¢åâ€ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">getUIName</span> = (<span class="hljs-params">node</span>) =&gt; {  <span class="hljs-keyword">if</span> (node.<span class="hljs-property">name</span> != <span class="hljs-literal">undefined</span>) <span class="hljs-keyword">return</span> node.<span class="hljs-property">name</span>;  <span class="hljs-keyword">return</span> <span class="hljs-title function_">getNameFromMap</span>(node.<span class="hljs-property">type</span>); <span class="hljs-comment">// ä»æ˜ å°„è¡¨é‡Œæ‹¿ä¸€ä¸ª nameã€‚}</span>
</code></pre>
<p>Adobe Illustractor çš„å›¾å±‚åˆ—è¡¨æ˜¾ç¤ºæ•ˆæœï¼š
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e3f6f3d752cf44f48d94c80062e4ec04~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv6KW_55Oc5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769837994&amp;x-signature=c0GVmc2zCq%2BcHmCqteTBlSeg9kU%3D" alt="" loading="lazy"/>
è™½ç„¶ä¸¢æ‰äº†å‰é¢è¯´çš„å¸¦æ•°å­—åç¼€çš„ä¼˜ç‚¹ã€‚</p>
<p>ä½†å®ƒçš„ <strong>å®ç°ä¸Šä¼šæ›´ç®€å•ä¸€äº›</strong>ã€‚</p>
<p>æ­¤å¤–æ²¡æœ‰åå­—ä¹Ÿæœ‰ä¸€äº›ä¼˜åŠ¿ï¼š</p>
<ul>
<li>å›¾å½¢çš„ç±»å‹å‘ç”Ÿå˜åŒ–ï¼ŒUI å±‚çš„åå­—ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–ï¼Œè®©ç”¨æˆ·èƒ½ <strong>æ„ŸçŸ¥åˆ°å›¾å½¢ç±»å‹çš„æ”¹å˜</strong>ã€‚</li>
<li>åˆ‡æ¢è¯­è¨€ï¼Œèƒ½ <strong>ç”¨å¯¹åº”çš„å›½é™…åŒ–æ–‡æ¡ˆå»æ˜¾ç¤º</strong>ã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2433ff00b7da44c38026535ffc58d893~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv6KW_55Oc5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769837994&amp;x-signature=qZ2OEAgCuqHAMj5ySqvMqLxZkK0%3D" alt="" loading="lazy"/>
ä¸è¿‡å¦‚æœç”¨æˆ·æ‰‹åŠ¨è®¾ç½®äº†å›¾å½¢åå­—ï¼Œè®© name ä¸å†æ˜¯ undefinedï¼Œä¸Šé¢è¿™ä¸¤é¡¹æ˜¯ä¸ä¼šç”Ÿæ•ˆçš„ã€‚</p>
<h2 data-id="heading-4">ç»“å°¾</h2>
<p>æˆ‘æ˜¯å‰ç«¯è¥¿ç“œå“¥ï¼Œå…³æ³¨æˆ‘ï¼Œå­¦ä¹ æ›´å¤šå›¾å½¢ç¼–è¾‘å™¨çŸ¥è¯†ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±å…¥æµ…å‡ºå“ˆå¸Œè¡¨ï¼šåŸç†ã€å®ç°ä¸å®æˆ˜åº”ç”¨]]></title>    <link>https://juejin.cn/post/7598587406695219243</link>    <guid>https://juejin.cn/post/7598587406695219243</guid>    <pubDate>2026-01-24T06:40:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598587406695219243" data-draft-id="7598587406695202859" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±å…¥æµ…å‡ºå“ˆå¸Œè¡¨ï¼šåŸç†ã€å®ç°ä¸å®æˆ˜åº”ç”¨"/> <meta itemprop="keywords" content="JavaScript,åç«¯,ç®—æ³•"/> <meta itemprop="datePublished" content="2026-01-24T06:40:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é¢œé…±"/> <meta itemprop="url" content="https://juejin.cn/user/905653309941495"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±å…¥æµ…å‡ºå“ˆå¸Œè¡¨ï¼šåŸç†ã€å®ç°ä¸å®æˆ˜åº”ç”¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/905653309941495/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é¢œé…±
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T06:40:16.000Z" title="Sat Jan 24 2026 06:40:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ·±å…¥æµ…å‡ºå“ˆå¸Œè¡¨ï¼šåŸç†ã€å®ç°ä¸å®æˆ˜åº”ç”¨</h2>
<p>å“ˆå¸Œè¡¨ï¼ˆHash Tableï¼‰æ˜¯ç¼–ç¨‹ä¸­æœ€å¸¸ç”¨çš„é«˜æ•ˆæ•°æ®ç»“æ„ä¹‹ä¸€ï¼Œå‡ ä¹æ‰€æœ‰ç¼–ç¨‹è¯­è¨€çš„æ ‡å‡†åº“éƒ½æä¾›äº†å“ˆå¸Œè¡¨çš„å®ç°ï¼ˆå¦‚ JavaScript çš„ <code>Map</code>/<code>Object</code>ã€Java çš„ <code>HashMap</code>ã€Python çš„ <code>dict</code>ï¼‰ã€‚å®ƒä»¥ <strong>O(1) å¹³å‡æ—¶é—´å¤æ‚åº¦</strong> æ”¯æŒå¢åˆ æŸ¥æ”¹æ“ä½œï¼Œæ˜¯è§£å†³â€œå¿«é€Ÿé”®å€¼æ˜ å°„â€é—®é¢˜çš„é¦–é€‰æ–¹æ¡ˆã€‚æœ¬æ–‡å°†ä»åº•å±‚åŸç†å‡ºå‘ï¼Œæ‹†è§£å“ˆå¸Œè¡¨çš„æ ¸å¿ƒè®¾è®¡ï¼Œå®ç°ä¸¤ç§è§£å†³å“ˆå¸Œå†²çªçš„æ–¹æ¡ˆï¼Œå¹¶ç»“åˆå®æˆ˜æ¡ˆä¾‹ï¼ˆ<code>RandomizedCollection</code>ï¼‰å±•ç¤ºå“ˆå¸Œè¡¨çš„çµæ´»åº”ç”¨ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2307833f58b9407cbba184df472e24a5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aKc6YWx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769841632&amp;x-signature=0p6nyNRilNjHLjWkMG6pjm%2FO17Q%3D" alt="hash_x.png" loading="lazy"/></p>
<h3 data-id="heading-1">ä¸€ã€å“ˆå¸Œè¡¨çš„æ ¸å¿ƒåŸç†ï¼šæ•°ç»„+å“ˆå¸Œå‡½æ•°</h3>
<p>å“ˆå¸Œè¡¨çš„æœ¬è´¨æ˜¯<strong>ç”¨æ•°ç»„å®ç°çš„é”®å€¼æ˜ å°„</strong>â€”â€”é€šè¿‡ä¸€ä¸ªâ€œå“ˆå¸Œå‡½æ•°â€å°†ä»»æ„ç±»å‹çš„ <code>key</code> è½¬åŒ–ä¸ºæ•°ç»„çš„åˆæ³•ç´¢å¼•ï¼Œä»è€Œå€ŸåŠ©æ•°ç»„ O(1) çš„éšæœºè®¿é—®ç‰¹æ€§å®ç°é«˜æ•ˆæ“ä½œã€‚</p>
<h4 data-id="heading-2">1.1 åŸºæœ¬ç»“æ„ï¼ˆä¼ªä»£ç ï¼‰</h4>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyHashMap</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// åº•å±‚å­˜å‚¨æ•°ç»„</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">1000</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-literal">null</span>);
    }

    <span class="hljs-comment">// å¢/æ”¹ï¼škeyâ†’ç´¢å¼•â†’æ•°ç»„èµ‹å€¼</span>
    <span class="hljs-title function_">put</span>(<span class="hljs-params">key, value</span>) {
        <span class="hljs-keyword">const</span> index = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">hash</span>(key);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>[index] = value;
    }

    <span class="hljs-comment">// æŸ¥ï¼škeyâ†’ç´¢å¼•â†’æ•°ç»„å–å€¼</span>
    <span class="hljs-title function_">get</span>(<span class="hljs-params">key</span>) {
        <span class="hljs-keyword">const</span> index = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">hash</span>(key);
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>[index];
    }

    <span class="hljs-comment">// åˆ ï¼škeyâ†’ç´¢å¼•â†’æ•°ç»„ç½®ç©º</span>
    <span class="hljs-title function_">remove</span>(<span class="hljs-params">key</span>) {
        <span class="hljs-keyword">const</span> index = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">hash</span>(key);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>[index] = <span class="hljs-literal">null</span>;
    }

    <span class="hljs-comment">// æ ¸å¿ƒï¼šå“ˆå¸Œå‡½æ•°ï¼ˆkeyâ†’åˆæ³•ç´¢å¼•ï¼‰</span>
    <span class="hljs-title function_">hash</span>(<span class="hljs-params">key</span>) {
        <span class="hljs-comment">// 1. è®¡ç®—keyçš„å“ˆå¸Œå€¼ï¼ˆä¿è¯ç›¸åŒkeyè¿”å›ç›¸åŒå€¼ï¼‰</span>
        <span class="hljs-keyword">let</span> h = key.<span class="hljs-title function_">toString</span>().<span class="hljs-title function_">charCodeAt</span>(<span class="hljs-number">0</span>);
        <span class="hljs-comment">// 2. ä¿è¯å“ˆå¸Œå€¼éè´Ÿï¼ˆä½è¿ç®—æ•ˆç‡é«˜äºç®—æœ¯è¿ç®—ï¼‰</span>
        h = h &amp; <span class="hljs-number">0x7fffffff</span>;
        <span class="hljs-comment">// 3. æ˜ å°„åˆ°æ•°ç»„åˆæ³•ç´¢å¼•ï¼ˆå–æ¨¡ï¼‰</span>
        <span class="hljs-keyword">return</span> h % <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>.<span class="hljs-property">length</span>;
    }
}
</code></pre>
<h4 data-id="heading-3">1.2 å“ˆå¸Œå‡½æ•°çš„æ ¸å¿ƒè¦æ±‚</h4>
<p>å“ˆå¸Œå‡½æ•°æ˜¯å“ˆå¸Œè¡¨çš„â€œçµé­‚â€ï¼Œå¿…é¡»æ»¡è¶³ä¸‰ä¸ªæ¡ä»¶ï¼š</p>
<ol>
<li>
<p><strong>ç¡®å®šæ€§</strong>ï¼šç›¸åŒ <code>key</code> å¿…é¡»è¿”å›ç›¸åŒç´¢å¼•ï¼›</p>
</li>
<li>
<p><strong>é«˜æ•ˆæ€§</strong>ï¼šè®¡ç®—å¤æ‚åº¦ä¸º O(1)ï¼ˆå¦åˆ™å“ˆå¸Œè¡¨æ•´ä½“æ€§èƒ½é€€åŒ–ï¼‰ï¼›</p>
</li>
<li>
<p><strong>å‡åŒ€æ€§</strong>ï¼šå°½å¯èƒ½è®©ä¸åŒ <code>key</code> æ˜ å°„åˆ°ä¸åŒç´¢å¼•ï¼ˆå‡å°‘å†²çªï¼‰ã€‚</p>
</li>
</ol>
<h3 data-id="heading-4">äºŒã€å“ˆå¸Œå†²çªï¼šä¸å¯é¿å…çš„é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h3>
<p>ç”±äºå“ˆå¸Œå‡½æ•°æ˜¯â€œæ— ç©·ç©ºé—´â†’æœ‰é™ç©ºé—´â€çš„æ˜ å°„ï¼Œ<strong>å“ˆå¸Œå†²çª</strong>ï¼ˆä¸åŒ <code>key</code> æ˜ å°„åˆ°åŒä¸€ç´¢å¼•ï¼‰æ˜¯å¿…ç„¶å­˜åœ¨çš„ã€‚è§£å†³å†²çªçš„æ ¸å¿ƒæ–¹æ¡ˆæœ‰ä¸¤ç§ï¼š<strong>æ‹‰é“¾æ³•</strong>ï¼ˆä¸»æµï¼‰å’Œ <strong>çº¿æ€§æ¢æŸ¥æ³•</strong>ã€‚</p>
<h4 data-id="heading-5">2.1 æ‹‰é“¾æ³•ï¼šæ•°ç»„+é“¾è¡¨ï¼ˆç®€å•æ˜“å®ç°ï¼‰</h4>
<h5 data-id="heading-6">æ ¸å¿ƒæ€è·¯</h5>
<p>æ•°ç»„çš„æ¯ä¸ªä½ç½®å­˜å‚¨ä¸€ä¸ª<strong>é“¾è¡¨</strong>ï¼Œå½“å‘ç”Ÿå“ˆå¸Œå†²çªæ—¶ï¼Œå°†å†²çªçš„é”®å€¼å¯¹è¿½åŠ åˆ°é“¾è¡¨å°¾éƒ¨ã€‚</p>
<ul>
<li>
<p>å¢åˆ æŸ¥æ”¹ï¼šå…ˆé€šè¿‡å“ˆå¸Œå‡½æ•°æ‰¾åˆ°æ•°ç»„ç´¢å¼•ï¼Œå†æ“ä½œå¯¹åº”é“¾è¡¨ï¼›</p>
</li>
<li>
<p>ä¼˜åŠ¿ï¼šå®ç°ç®€å•ã€æ”¯æŒé«˜è´Ÿè½½å› å­ï¼ˆé“¾è¡¨å¯æ— é™å»¶ä¼¸ï¼‰ï¼›</p>
</li>
<li>
<p>åŠ£åŠ¿ï¼šé“¾è¡¨éå†æœ‰è½»å¾®æ€§èƒ½æŸè€—ï¼ˆä½†å¹³å‡ä»ä¸º O(1)ï¼‰ã€‚</p>
</li>
</ul>
<h5 data-id="heading-7">å®Œæ•´å®ç°ï¼ˆJavaScriptï¼‰</h5>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-comment">// é“¾è¡¨èŠ‚ç‚¹ï¼šå­˜å‚¨key-value</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">HashNode</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">key, val</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">key</span> = key;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">val</span> = val;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">next</span> = <span class="hljs-literal">null</span>;
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">HashTableChaining</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">capacity = <span class="hljs-number">10</span></span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">capacity</span> = capacity; <span class="hljs-comment">// æ•°ç»„åˆå§‹å®¹é‡</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span> = <span class="hljs-number">0</span>; <span class="hljs-comment">// å®é™…å­˜å‚¨çš„é”®å€¼å¯¹æ•°é‡</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">loadFactor</span> = <span class="hljs-number">0.75</span>; <span class="hljs-comment">// è´Ÿè½½å› å­ï¼ˆè§¦å‘æ‰©å®¹çš„é˜ˆå€¼ï¼‰</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(capacity).<span class="hljs-title function_">fill</span>(<span class="hljs-literal">null</span>); <span class="hljs-comment">// åº•å±‚æ•°ç»„</span>
    }

    <span class="hljs-comment">// å“ˆå¸Œå‡½æ•°ï¼škeyâ†’ç´¢å¼•</span>
    <span class="hljs-title function_">hash</span>(<span class="hljs-params">key</span>) {
        <span class="hljs-keyword">let</span> h = <span class="hljs-keyword">typeof</span> key === <span class="hljs-string">'number'</span> ? key : key.<span class="hljs-title function_">toString</span>().<span class="hljs-title function_">charCodeAt</span>(<span class="hljs-number">0</span>);
        h = h &amp; <span class="hljs-number">0x7fffffff</span>; <span class="hljs-comment">// ä¿è¯éè´Ÿ</span>
        <span class="hljs-keyword">return</span> h % <span class="hljs-variable language_">this</span>.<span class="hljs-property">capacity</span>;
    }

    <span class="hljs-comment">// æ‰©å®¹ï¼šè§£å†³å“ˆå¸Œå†²çªé¢‘ç¹çš„é—®é¢˜</span>
    <span class="hljs-title function_">resize</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">const</span> oldTable = <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">capacity</span> *= <span class="hljs-number">2</span>; <span class="hljs-comment">// å®¹é‡ç¿»å€</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">capacity</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-literal">null</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span> = <span class="hljs-number">0</span>;

        <span class="hljs-comment">// é‡æ–°å“ˆå¸Œå¹¶è¿ç§»æ•°æ®</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> node <span class="hljs-keyword">of</span> oldTable) {
            <span class="hljs-keyword">while</span> (node) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">put</span>(node.<span class="hljs-property">key</span>, node.<span class="hljs-property">val</span>);
                node = node.<span class="hljs-property">next</span>;
            }
        }
    }

    <span class="hljs-comment">// å¢/æ”¹</span>
    <span class="hljs-title function_">put</span>(<span class="hljs-params">key, val</span>) {
        <span class="hljs-comment">// è¾¾åˆ°è´Ÿè½½å› å­ï¼Œå…ˆæ‰©å®¹</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span> / <span class="hljs-variable language_">this</span>.<span class="hljs-property">capacity</span> &gt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">loadFactor</span>) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">resize</span>();
        }

        <span class="hljs-keyword">const</span> index = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">hash</span>(key);
        <span class="hljs-comment">// é“¾è¡¨ä¸ºç©ºï¼Œç›´æ¥æ–°å»ºèŠ‚ç‚¹</span>
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>[index]) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>[index] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashNode</span>(key, val);
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span>++;
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-comment">// é“¾è¡¨éç©ºï¼šéå†æŸ¥æ‰¾ï¼ˆå­˜åœ¨åˆ™ä¿®æ”¹ï¼Œä¸å­˜åœ¨åˆ™è¿½åŠ ï¼‰</span>
        <span class="hljs-keyword">let</span> curr = <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>[index];
        <span class="hljs-keyword">while</span> (curr) {
            <span class="hljs-keyword">if</span> (curr.<span class="hljs-property">key</span> === key) {
                curr.<span class="hljs-property">val</span> = val; <span class="hljs-comment">// å­˜åœ¨ï¼Œä¿®æ”¹å€¼</span>
                <span class="hljs-keyword">return</span>;
            }
            <span class="hljs-keyword">if</span> (!curr.<span class="hljs-property">next</span>) {
                curr.<span class="hljs-property">next</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashNode</span>(key, val); <span class="hljs-comment">// ä¸å­˜åœ¨ï¼Œè¿½åŠ åˆ°å°¾éƒ¨</span>
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span>++;
                <span class="hljs-keyword">return</span>;
            }
            curr = curr.<span class="hljs-property">next</span>;
        }
    }

    <span class="hljs-comment">// æŸ¥</span>
    <span class="hljs-title function_">get</span>(<span class="hljs-params">key</span>) {
        <span class="hljs-keyword">const</span> index = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">hash</span>(key);
        <span class="hljs-keyword">let</span> curr = <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>[index];
        <span class="hljs-keyword">while</span> (curr) {
            <span class="hljs-keyword">if</span> (curr.<span class="hljs-property">key</span> === key) {
                <span class="hljs-keyword">return</span> curr.<span class="hljs-property">val</span>;
            }
            curr = curr.<span class="hljs-property">next</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">// æœªæ‰¾åˆ°</span>
    }

    <span class="hljs-comment">// åˆ </span>
    <span class="hljs-title function_">remove</span>(<span class="hljs-params">key</span>) {
        <span class="hljs-keyword">const</span> index = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">hash</span>(key);
        <span class="hljs-keyword">let</span> curr = <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>[index];
        <span class="hljs-keyword">let</span> prev = <span class="hljs-literal">null</span>;

        <span class="hljs-keyword">while</span> (curr) {
            <span class="hljs-keyword">if</span> (curr.<span class="hljs-property">key</span> === key) {
                <span class="hljs-comment">// æ‰¾åˆ°èŠ‚ç‚¹ï¼šåˆ é™¤ï¼ˆåˆ†å¤´éƒ¨/ä¸­é—´èŠ‚ç‚¹ï¼‰</span>
                <span class="hljs-keyword">if</span> (prev) {
                    prev.<span class="hljs-property">next</span> = curr.<span class="hljs-property">next</span>;
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>[index] = curr.<span class="hljs-property">next</span>;
                }
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span>--;
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
            prev = curr;
            curr = curr.<span class="hljs-property">next</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// æœªæ‰¾åˆ°</span>
    }
}

<span class="hljs-comment">// æµ‹è¯•æ‹‰é“¾æ³•å“ˆå¸Œè¡¨</span>
<span class="hljs-keyword">const</span> ht = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashTableChaining</span>();
ht.<span class="hljs-title function_">put</span>(<span class="hljs-string">"a"</span>, <span class="hljs-number">1</span>);
ht.<span class="hljs-title function_">put</span>(<span class="hljs-string">"b"</span>, <span class="hljs-number">2</span>);
ht.<span class="hljs-title function_">put</span>(<span class="hljs-string">"c"</span>, <span class="hljs-number">3</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(ht.<span class="hljs-title function_">get</span>(<span class="hljs-string">"a"</span>)); <span class="hljs-comment">// 1</span>
ht.<span class="hljs-title function_">remove</span>(<span class="hljs-string">"b"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(ht.<span class="hljs-title function_">get</span>(<span class="hljs-string">"b"</span>)); <span class="hljs-comment">// null</span>
</code></pre>
<h4 data-id="heading-8">2.2 çº¿æ€§æ¢æŸ¥æ³•ï¼šå¼€æ”¾å¯»å€ï¼ˆå¤æ‚ä½†æ— é“¾è¡¨å¼€é”€ï¼‰</h4>
<h5 data-id="heading-9">æ ¸å¿ƒæ€è·¯</h5>
<p>ä¸ä½¿ç”¨é“¾è¡¨ï¼Œå½“å‘ç”Ÿå“ˆå¸Œå†²çªæ—¶ï¼Œ<strong>å‘åéå†æ•°ç»„æ‰¾ç©ºä½</strong>ï¼ˆåˆ°æ•°ç»„æœ«å°¾åˆ™ç»•å›å¤´éƒ¨ï¼‰ï¼š</p>
<ul>
<li>
<p>æ’å…¥ï¼šæ‰¾åˆ°ç©ºä½åç›´æ¥å­˜å…¥ï¼›</p>
</li>
<li>
<p>æŸ¥è¯¢ï¼šä»å“ˆå¸Œç´¢å¼•å¼€å§‹éå†ï¼Œç›´åˆ°æ‰¾åˆ°ç›®æ ‡æˆ–ç©ºä½ï¼›</p>
</li>
<li>
<p>åˆ é™¤ï¼šä¸èƒ½ç›´æ¥ç½®ç©ºï¼ˆä¼šä¸­æ–­æŸ¥è¯¢ï¼‰ï¼Œéœ€ç”¨<strong>å ä½ç¬¦</strong>æ ‡è®°ï¼ˆå¦‚ <code>DELETED</code>ï¼‰ã€‚</p>
</li>
</ul>
<h5 data-id="heading-10">å…³é”®éš¾ç‚¹</h5>
<ol>
<li>
<p><strong>ç¯å½¢æ•°ç»„</strong>ï¼šéå†åˆ°æ•°ç»„æœ«å°¾æ—¶éœ€ç»•å›å¤´éƒ¨ï¼›</p>
</li>
<li>
<p><strong>åˆ é™¤é€»è¾‘</strong>ï¼šç”¨å ä½ç¬¦æ›¿ä»£ç›´æ¥ç½®ç©ºï¼Œé¿å…æŸ¥è¯¢ä¸­æ–­ã€‚</p>
</li>
</ol>
<h5 data-id="heading-11">å®Œæ•´å®ç°ï¼ˆJavaScriptï¼‰</h5>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-keyword">class</span> <span class="hljs-title class_">HashTableProbing</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">capacity = <span class="hljs-number">10</span></span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">capacity</span> = capacity;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span> = <span class="hljs-number">0</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">loadFactor</span> = <span class="hljs-number">0.75</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(capacity).<span class="hljs-title function_">fill</span>(<span class="hljs-literal">null</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">DELETED</span> = <span class="hljs-title class_">Symbol</span>(<span class="hljs-string">'deleted'</span>); <span class="hljs-comment">// å ä½ç¬¦ï¼šæ ‡è®°å·²åˆ é™¤</span>
    }

    <span class="hljs-comment">// å“ˆå¸Œå‡½æ•°</span>
    <span class="hljs-title function_">hash</span>(<span class="hljs-params">key</span>) {
        <span class="hljs-keyword">let</span> h = <span class="hljs-keyword">typeof</span> key === <span class="hljs-string">'number'</span> ? key : key.<span class="hljs-title function_">toString</span>().<span class="hljs-title function_">charCodeAt</span>(<span class="hljs-number">0</span>);
        h = h &amp; <span class="hljs-number">0x7fffffff</span>;
        <span class="hljs-keyword">return</span> h % <span class="hljs-variable language_">this</span>.<span class="hljs-property">capacity</span>;
    }

    <span class="hljs-comment">// æ‰©å®¹</span>
    <span class="hljs-title function_">resize</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">const</span> oldTable = <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">capacity</span> *= <span class="hljs-number">2</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">capacity</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-literal">null</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span> = <span class="hljs-number">0</span>;

        <span class="hljs-comment">// è¿ç§»æ•°æ®ï¼ˆè·³è¿‡å ä½ç¬¦ï¼‰</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> entry <span class="hljs-keyword">of</span> oldTable) {
            <span class="hljs-keyword">if</span> (entry &amp;&amp; entry !== <span class="hljs-variable language_">this</span>.<span class="hljs-property">DELETED</span>) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">put</span>(entry.<span class="hljs-property">key</span>, entry.<span class="hljs-property">val</span>);
            }
        }
    }

    <span class="hljs-comment">// æŸ¥æ‰¾keyçš„ç´¢å¼•ï¼ˆæ ¸å¿ƒï¼šå¤„ç†å†²çª+å ä½ç¬¦ï¼‰</span>
    <span class="hljs-title function_">findIndex</span>(<span class="hljs-params">key</span>) {
        <span class="hljs-keyword">let</span> index = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">hash</span>(key);
        <span class="hljs-keyword">let</span> start = index;

        <span class="hljs-comment">// ç¯å½¢éå†ï¼šç›´åˆ°æ‰¾åˆ°ç›®æ ‡/ç©ºä½/éå†å®Œ</span>
        <span class="hljs-keyword">while</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>[index] !== <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// æ‰¾åˆ°ç›®æ ‡key</span>
            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>[index] !== <span class="hljs-variable language_">this</span>.<span class="hljs-property">DELETED</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>[index].<span class="hljs-property">key</span> === key) {
                <span class="hljs-keyword">return</span> index;
            }
            <span class="hljs-comment">// ç»•å›å¤´éƒ¨</span>
            index = (index + <span class="hljs-number">1</span>) % <span class="hljs-variable language_">this</span>.<span class="hljs-property">capacity</span>;
            <span class="hljs-comment">// éå†å®Œä¸€åœˆä»æœªæ‰¾åˆ°</span>
            <span class="hljs-keyword">if</span> (index === start) {
                <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
            }
        }
        <span class="hljs-keyword">return</span> index; <span class="hljs-comment">// è¿”å›ç©ºä½ç´¢å¼•</span>
    }

    <span class="hljs-comment">// å¢/æ”¹</span>
    <span class="hljs-title function_">put</span>(<span class="hljs-params">key, val</span>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span> / <span class="hljs-variable language_">this</span>.<span class="hljs-property">capacity</span> &gt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">loadFactor</span>) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">resize</span>();
        }

        <span class="hljs-keyword">const</span> index = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">findIndex</span>(key);
        <span class="hljs-comment">// æœªæ‰¾åˆ°ï¼šæ’å…¥æ–°å€¼</span>
        <span class="hljs-keyword">if</span> (index === -<span class="hljs-number">1</span> || <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>[index] === <span class="hljs-literal">null</span> || <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>[index] === <span class="hljs-variable language_">this</span>.<span class="hljs-property">DELETED</span>) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>[index] = { key, val };
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span>++;
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-comment">// æ‰¾åˆ°ï¼šä¿®æ”¹å€¼</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>[index].<span class="hljs-property">val</span> = val;
    }

    <span class="hljs-comment">// æŸ¥</span>
    <span class="hljs-title function_">get</span>(<span class="hljs-params">key</span>) {
        <span class="hljs-keyword">const</span> index = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">findIndex</span>(key);
        <span class="hljs-keyword">if</span> (index === -<span class="hljs-number">1</span> || <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>[index] === <span class="hljs-literal">null</span> || <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>[index] === <span class="hljs-variable language_">this</span>.<span class="hljs-property">DELETED</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>[index].<span class="hljs-property">val</span>;
    }

    <span class="hljs-comment">// åˆ ï¼šç”¨å ä½ç¬¦æ ‡è®°</span>
    <span class="hljs-title function_">remove</span>(<span class="hljs-params">key</span>) {
        <span class="hljs-keyword">const</span> index = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">findIndex</span>(key);
        <span class="hljs-keyword">if</span> (index === -<span class="hljs-number">1</span> || <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>[index] === <span class="hljs-literal">null</span> || <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>[index] === <span class="hljs-variable language_">this</span>.<span class="hljs-property">DELETED</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">table</span>[index] = <span class="hljs-variable language_">this</span>.<span class="hljs-property">DELETED</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span>--;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
}

<span class="hljs-comment">// æµ‹è¯•çº¿æ€§æ¢æŸ¥æ³•å“ˆå¸Œè¡¨</span>
<span class="hljs-keyword">const</span> htProbe = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashTableProbing</span>();
htProbe.<span class="hljs-title function_">put</span>(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>);
htProbe.<span class="hljs-title function_">put</span>(<span class="hljs-number">11</span>, <span class="hljs-number">20</span>); <span class="hljs-comment">// å“ˆå¸Œå†²çªï¼ˆ1%10=1ï¼Œ11%10=1ï¼‰</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(htProbe.<span class="hljs-title function_">get</span>(<span class="hljs-number">11</span>)); <span class="hljs-comment">// 20</span>
htProbe.<span class="hljs-title function_">remove</span>(<span class="hljs-number">1</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(htProbe.<span class="hljs-title function_">get</span>(<span class="hljs-number">1</span>)); <span class="hljs-comment">// null</span>
</code></pre>
<h3 data-id="heading-12">ä¸‰ã€å“ˆå¸Œè¡¨çš„è¿›é˜¶ç‰¹æ€§</h3>
<h4 data-id="heading-13">3.1 è´Ÿè½½å› å­ä¸æ‰©å®¹</h4>
<p>è´Ÿè½½å› å­ = å·²å­˜å‚¨å…ƒç´ æ•° / æ•°ç»„å®¹é‡ï¼Œæ˜¯å“ˆå¸Œè¡¨æ‰©å®¹çš„æ ¸å¿ƒä¾æ®ï¼ˆé€šå¸¸è®¾ä¸º 0.75ï¼‰ï¼š</p>
<ul>
<li>
<p>è´Ÿè½½å› å­è¿‡é«˜ï¼šå“ˆå¸Œå†²çªé¢‘ç¹ï¼Œæ€§èƒ½é€€åŒ–ï¼›</p>
</li>
<li>
<p>è´Ÿè½½å› å­è¿‡ä½ï¼šæ•°ç»„ç©ºé—´æµªè´¹ï¼›</p>
</li>
<li>
<p>æ‰©å®¹é€»è¾‘ï¼šå®¹é‡ç¿»å€ï¼Œé‡æ–°å“ˆå¸Œå¹¶è¿ç§»æ‰€æœ‰æ•°æ®ï¼ˆä¿è¯åç»­å†²çªå‡å°‘ï¼‰ã€‚</p>
</li>
</ul>
<h4 data-id="heading-14">3.2 æœ‰åºå“ˆå¸Œè¡¨ï¼šå“ˆå¸Œé“¾è¡¨ï¼ˆLinkedHashMapï¼‰</h4>
<p>æ ‡å‡†å“ˆå¸Œè¡¨çš„éå†é¡ºåºæ˜¯æ— åºçš„ï¼Œè‹¥éœ€ä¿ç•™æ’å…¥é¡ºåºï¼Œå¯ç»“åˆ<strong>å“ˆå¸Œè¡¨+åŒå‘é“¾è¡¨</strong>å®ç°ï¼š</p>
<ul>
<li>
<p>å“ˆå¸Œè¡¨ï¼šå¿«é€ŸæŸ¥æ‰¾èŠ‚ç‚¹ï¼ˆO(1)ï¼‰ï¼›</p>
</li>
<li>
<p>åŒå‘é“¾è¡¨ï¼šç»´æŠ¤æ’å…¥é¡ºåºï¼ˆåˆ é™¤èŠ‚ç‚¹ O(1)ï¼‰ã€‚</p>
</li>
</ul>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-comment">// åŒå‘é“¾è¡¨èŠ‚ç‚¹</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">LinkedNode</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">key, val</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">key</span> = key;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">val</span> = val;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">prev</span> = <span class="hljs-literal">null</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">next</span> = <span class="hljs-literal">null</span>;
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">LinkedHashMap</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// å“¨å…µèŠ‚ç‚¹ï¼šç®€åŒ–é“¾è¡¨æ“ä½œ</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">head</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedNode</span>(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">tail</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedNode</span>(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">head</span>.<span class="hljs-property">next</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">tail</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">tail</span>.<span class="hljs-property">prev</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">head</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(); <span class="hljs-comment">// å“ˆå¸Œè¡¨ï¼škeyâ†’èŠ‚ç‚¹</span>
    }

    <span class="hljs-comment">// æ–°å¢èŠ‚ç‚¹åˆ°é“¾è¡¨å°¾éƒ¨</span>
    <span class="hljs-title function_">addLast</span>(<span class="hljs-params">node</span>) {
        <span class="hljs-keyword">const</span> prev = <span class="hljs-variable language_">this</span>.<span class="hljs-property">tail</span>.<span class="hljs-property">prev</span>;
        prev.<span class="hljs-property">next</span> = node;
        node.<span class="hljs-property">prev</span> = prev;
        node.<span class="hljs-property">next</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">tail</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">tail</span>.<span class="hljs-property">prev</span> = node;
    }

    <span class="hljs-comment">// ç§»é™¤é“¾è¡¨èŠ‚ç‚¹</span>
    <span class="hljs-title function_">removeNode</span>(<span class="hljs-params">node</span>) {
        <span class="hljs-keyword">const</span> prev = node.<span class="hljs-property">prev</span>;
        <span class="hljs-keyword">const</span> next = node.<span class="hljs-property">next</span>;
        prev.<span class="hljs-property">next</span> = next;
        next.<span class="hljs-property">prev</span> = prev;
    }

    <span class="hljs-comment">// å¢/æ”¹</span>
    <span class="hljs-title function_">put</span>(<span class="hljs-params">key, val</span>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">has</span>(key)) {
            <span class="hljs-keyword">const</span> node = <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">get</span>(key);
            node.<span class="hljs-property">val</span> = val;
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">const</span> newNode = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedNode</span>(key, val);
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">addLast</span>(newNode);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">set</span>(key, newNode);
    }

    <span class="hljs-comment">// æŸ¥</span>
    <span class="hljs-title function_">get</span>(<span class="hljs-params">key</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">has</span>(key) ? <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">get</span>(key).<span class="hljs-property">val</span> : <span class="hljs-literal">null</span>;
    }

    <span class="hljs-comment">// åˆ </span>
    <span class="hljs-title function_">remove</span>(<span class="hljs-params">key</span>) {
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">has</span>(key)) <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">const</span> node = <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">get</span>(key);
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">removeNode</span>(node);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">delete</span>(key);
    }

    <span class="hljs-comment">// æŒ‰æ’å…¥é¡ºåºéå†key</span>
    <span class="hljs-title function_">keys</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">const</span> res = [];
        <span class="hljs-keyword">let</span> curr = <span class="hljs-variable language_">this</span>.<span class="hljs-property">head</span>.<span class="hljs-property">next</span>;
        <span class="hljs-keyword">while</span> (curr !== <span class="hljs-variable language_">this</span>.<span class="hljs-property">tail</span>) {
            res.<span class="hljs-title function_">push</span>(curr.<span class="hljs-property">key</span>);
            curr = curr.<span class="hljs-property">next</span>;
        }
        <span class="hljs-keyword">return</span> res;
    }
}

<span class="hljs-comment">// æµ‹è¯•æœ‰åºå“ˆå¸Œè¡¨</span>
<span class="hljs-keyword">const</span> lhm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashMap</span>();
lhm.<span class="hljs-title function_">put</span>(<span class="hljs-string">"a"</span>, <span class="hljs-number">1</span>);
lhm.<span class="hljs-title function_">put</span>(<span class="hljs-string">"b"</span>, <span class="hljs-number">2</span>);
lhm.<span class="hljs-title function_">put</span>(<span class="hljs-string">"c"</span>, <span class="hljs-number">3</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(lhm.<span class="hljs-title function_">keys</span>()); <span class="hljs-comment">// ["a", "b", "c"]</span>
lhm.<span class="hljs-title function_">remove</span>(<span class="hljs-string">"b"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(lhm.<span class="hljs-title function_">keys</span>()); <span class="hljs-comment">// ["a", "c"]</span>
</code></pre>
<h4 data-id="heading-15">3.3 æ”¯æŒéšæœºè®¿é—®çš„å“ˆå¸Œè¡¨</h4>
<p>è‹¥éœ€å“ˆå¸Œè¡¨æ”¯æŒâ€œéšæœºè¿”å›é”®â€ä¸”<strong>å…ƒç´ ä¸é‡å¤</strong>ï¼ˆå¦‚ <code>MyArrayHashMap</code>ï¼‰ï¼Œå¯ç»“åˆ<strong>æ•°ç»„+å“ˆå¸Œè¡¨</strong>å®ç°ï¼Œæ ¸å¿ƒæ˜¯ç”¨æ•°ç»„å­˜å‚¨é”®å€¼å¯¹ã€å“ˆå¸Œè¡¨æ˜ å°„é”®ä¸ä¸‹æ ‡ï¼Œå…¼é¡¾ O(1) å¢åˆ æŸ¥ä¸éšæœºè®¿é—®ã€‚</p>
<ul>
<li>
<p>æ•°ç»„ï¼šå­˜å‚¨ <code>Node</code> å®ä¾‹ï¼ˆå« key å’Œ valï¼‰ï¼Œæ”¯æŒ O(1) éšæœºè®¿é—®ï¼Œä¿è¯éšæœºè¿”å›é”®çš„ç­‰æ¦‚ç‡æ€§ï¼›</p>
</li>
<li>
<p>å“ˆå¸Œè¡¨ï¼škeyâ†’å…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä¸‹æ ‡ï¼ˆä¸€ä¸€å¯¹åº”ï¼Œå› å…ƒç´ ä¸é‡å¤ï¼‰ï¼Œæ”¯æŒ O(1) å®šä½å…ƒç´ ï¼Œè§„é¿æ•°ç»„éå†å¼€é”€ã€‚</p>
</li>
</ul>
<pre><code class="hljs language-JavaScript" lang="JavaScript">

<span class="hljs-comment">// é”®å€¼å¯¹èŠ‚ç‚¹ï¼šå°è£…keyå’Œval</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Node</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">key, val</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">key</span> = key;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">val</span> = val;
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyArrayHashMap</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// å“ˆå¸Œè¡¨ï¼šå­˜å‚¨keyä¸å¯¹åº”åœ¨æ•°ç»„ä¸­çš„ä¸‹æ ‡ï¼Œå®ç°O(1)å®šä½</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
        <span class="hljs-comment">// æ•°ç»„ï¼šå­˜å‚¨Nodeå®ä¾‹ï¼Œæ”¯æŒO(1)éšæœºè®¿é—®</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span> = [];
    }

    <span class="hljs-comment">/**
     * æŒ‰keyæŸ¥è¯¢å€¼
     * <span class="hljs-doctag">@param</span> {<span class="hljs-type">*</span>} <span class="hljs-variable">key</span> - è¦æŸ¥è¯¢çš„é”®
     * <span class="hljs-doctag">@return</span> {<span class="hljs-type">*</span>} å¯¹åº”çš„å€¼ï¼ˆä¸å­˜åœ¨è¿”å›nullï¼‰
     */</span>
    <span class="hljs-title function_">get</span>(<span class="hljs-params">key</span>) {
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">has</span>(key)) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        <span class="hljs-comment">// å“ˆå¸Œè¡¨å–ä¸‹æ ‡ï¼Œæ•°ç»„ç›´æ¥è®¿é—®</span>
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">get</span>(key)].<span class="hljs-property">val</span>;
    }

    <span class="hljs-comment">/**
     * å¢/æ”¹é”®å€¼å¯¹ï¼ˆå…ƒç´ ä¸é‡å¤ï¼Œå·²å­˜åœ¨åˆ™ä¿®æ”¹å€¼ï¼‰
     * <span class="hljs-doctag">@param</span> {<span class="hljs-type">*</span>} <span class="hljs-variable">key</span> - é”®
     * <span class="hljs-doctag">@param</span> {<span class="hljs-type">*</span>} <span class="hljs-variable">val</span> - å€¼
     */</span>
    <span class="hljs-title function_">put</span>(<span class="hljs-params">key, val</span>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">containsKey</span>(key)) {
            <span class="hljs-comment">// å·²å­˜åœ¨ï¼šé€šè¿‡ä¸‹æ ‡ä¿®æ”¹å¯¹åº”èŠ‚ç‚¹çš„å€¼</span>
            <span class="hljs-keyword">let</span> i = <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">get</span>(key);
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[i].<span class="hljs-property">val</span> = val;
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-comment">// æ–°å¢ï¼šæ•°ç»„å°¾éƒ¨æ·»åŠ èŠ‚ç‚¹ï¼Œå“ˆå¸Œè¡¨è®°å½•ä¸‹æ ‡</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>(key, val));
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">set</span>(key, <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);
    }

    <span class="hljs-comment">/**
     * æŒ‰keyåˆ é™¤é”®å€¼å¯¹
     * <span class="hljs-doctag">@param</span> {<span class="hljs-type">*</span>} <span class="hljs-variable">key</span> - è¦åˆ é™¤çš„é”®
     */</span>
    <span class="hljs-title function_">remove</span>(<span class="hljs-params">key</span>) {
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">has</span>(key)) {
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-keyword">const</span> index = <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">get</span>(key); <span class="hljs-comment">// å¾…åˆ é™¤å…ƒç´ ä¸‹æ ‡</span>
        <span class="hljs-keyword">const</span> node = <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[index]; <span class="hljs-comment">// å¾…åˆ é™¤èŠ‚ç‚¹</span>
        <span class="hljs-keyword">const</span> lastIndex = <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>;
        <span class="hljs-keyword">const</span> lastNode = <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[lastIndex]; <span class="hljs-comment">// æ•°ç»„æœ€åä¸€ä¸ªèŠ‚ç‚¹</span>

        <span class="hljs-comment">// 1. äº¤æ¢å¾…åˆ é™¤èŠ‚ç‚¹ä¸æœ€åä¸€ä¸ªèŠ‚ç‚¹ä½ç½®ï¼ˆé¿å…æ•°ç»„ç§»ä½ï¼Œä¿è¯O(1)ï¼‰</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[index] = lastNode;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[lastIndex] = node;

        <span class="hljs-comment">// 2. æ›´æ–°æœ€åä¸€ä¸ªèŠ‚ç‚¹åœ¨å“ˆå¸Œè¡¨ä¸­çš„ä¸‹æ ‡æ˜ å°„</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">set</span>(lastNode.<span class="hljs-property">key</span>, index);

        <span class="hljs-comment">// 3. æ•°ç»„åˆ é™¤æœ€åä¸€ä¸ªå…ƒç´ ï¼ˆO(1)æ“ä½œï¼‰</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>.<span class="hljs-title function_">pop</span>();

        <span class="hljs-comment">// 4. å“ˆå¸Œè¡¨åˆ é™¤å¾…åˆ é™¤èŠ‚ç‚¹çš„key</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">delete</span>(node.<span class="hljs-property">key</span>);
    }

    <span class="hljs-comment">/**
     * éšæœºè¿”å›ä¸€ä¸ªé”®ï¼ˆç­‰æ¦‚ç‡ï¼‰
     * <span class="hljs-doctag">@return</span> {<span class="hljs-type">*</span>} éšæœºé”®
     */</span>
    <span class="hljs-title function_">randomKey</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">const</span> n = <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>.<span class="hljs-property">length</span>;
        <span class="hljs-keyword">if</span> (n === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">// è¾¹ç•Œå¤„ç†ï¼šç©ºè¡¨è¿”å›null</span>
        <span class="hljs-keyword">const</span> randomIndex = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * n);
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[randomIndex].<span class="hljs-property">key</span>;
    }

    <span class="hljs-comment">/**
     * åˆ¤æ–­keyæ˜¯å¦å­˜åœ¨
     * <span class="hljs-doctag">@param</span> {<span class="hljs-type">*</span>} <span class="hljs-variable">key</span> - è¦åˆ¤æ–­çš„é”®
     * <span class="hljs-doctag">@return</span> {<span class="hljs-type">boolean</span>} å­˜åœ¨è¿”å›trueï¼Œå¦åˆ™false
     */</span>
    <span class="hljs-title function_">containsKey</span>(<span class="hljs-params">key</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">has</span>(key);
    }

    <span class="hljs-comment">/**
     * è·å–é”®å€¼å¯¹æ•°é‡
     * <span class="hljs-doctag">@return</span> {<span class="hljs-type">number</span>} æ•°é‡
     */</span>
    <span class="hljs-title function_">size</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-property">size</span>;
    }
}

<span class="hljs-comment">// æµ‹è¯•ï¼ˆéªŒè¯ä¸é‡å¤ç‰¹æ€§ã€å¢åˆ æŸ¥åŠéšæœºè®¿é—®ï¼‰</span>
<span class="hljs-keyword">let</span> map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyArrayHashMap</span>();
map.<span class="hljs-title function_">put</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
map.<span class="hljs-title function_">put</span>(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>);
map.<span class="hljs-title function_">put</span>(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>);
map.<span class="hljs-title function_">put</span>(<span class="hljs-number">4</span>, <span class="hljs-number">4</span>);
map.<span class="hljs-title function_">put</span>(<span class="hljs-number">5</span>, <span class="hljs-number">5</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(map.<span class="hljs-title function_">get</span>(<span class="hljs-number">1</span>)); <span class="hljs-comment">// 1ï¼ˆæŸ¥è¯¢æ­£å¸¸ï¼‰</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(map.<span class="hljs-title function_">randomKey</span>()); <span class="hljs-comment">// éšæœºè¿”å›1-5ä¸­çš„ä¸€ä¸ªé”®</span>

map.<span class="hljs-title function_">remove</span>(<span class="hljs-number">4</span>); <span class="hljs-comment">// åˆ é™¤key=4çš„é”®å€¼å¯¹</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(map.<span class="hljs-title function_">randomKey</span>()); <span class="hljs-comment">// éšæœºè¿”å›1-3ã€5ä¸­çš„ä¸€ä¸ªé”®</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(map.<span class="hljs-title function_">randomKey</span>()); <span class="hljs-comment">// å†æ¬¡éšæœºï¼Œæ— é‡å¤å…ƒç´ å¹²æ‰°</span>

</code></pre>
<h3 data-id="heading-16">å››ã€å“ˆå¸Œè¡¨çš„å…³é”®æ³¨æ„äº‹é¡¹</h3>
<h4 data-id="heading-17">4.1 ä¸è¦æ··æ·†â€œMapæ¥å£â€å’Œâ€œHashMapå®ç°â€</h4>
<ul>
<li>
<p><code>Map</code> æ˜¯æ¥å£ï¼ˆæŠ½è±¡å®šä¹‰ï¼‰ï¼Œä¸ä¿è¯æ—¶é—´å¤æ‚åº¦ï¼›</p>
</li>
<li>
<p><code>HashMap</code> æ˜¯å®ç°ï¼ˆå“ˆå¸Œè¡¨ï¼‰ï¼Œå¹³å‡ O(1)ï¼›<code>TreeMap</code> æ˜¯å®ç°ï¼ˆçº¢é»‘æ ‘ï¼‰ï¼ŒO(logN)ã€‚</p>
</li>
</ul>
<h4 data-id="heading-18">4.2 keyå¿…é¡»æ˜¯ä¸å¯å˜ç±»å‹</h4>
<p>è‹¥ key æ˜¯å¯å˜ç±»å‹ï¼ˆå¦‚æ•°ç»„ã€å¯¹è±¡ï¼‰ï¼Œä¿®æ”¹åå“ˆå¸Œå€¼ä¼šå˜åŒ–ï¼Œå¯¼è‡´æ— æ³•æ‰¾åˆ°åŸæ•°æ®ï¼Œç”šè‡³å†…å­˜æ³„æ¼ã€‚</p>
<h4 data-id="heading-19">4.3 æ‹‰é“¾æ³• vs çº¿æ€§æ¢æŸ¥æ³•</h4>






























<table><thead><tr><th>ç‰¹æ€§</th><th>æ‹‰é“¾æ³•</th><th>çº¿æ€§æ¢æŸ¥æ³•</th></tr></thead><tbody><tr><td>å®ç°éš¾åº¦</td><td>ç®€å•</td><td>å¤æ‚ï¼ˆéœ€å¤„ç†ç¯å½¢/å ä½ç¬¦ï¼‰</td></tr><tr><td>è´Ÿè½½å› å­</td><td>æ— ä¸Šé™ï¼ˆé“¾è¡¨å¯å»¶ä¼¸ï¼‰</td><td>é€šå¸¸â‰¤0.75ï¼ˆå¦åˆ™æ€§èƒ½å·®ï¼‰</td></tr><tr><td>æ€§èƒ½</td><td>å¹³å‡O(1)ï¼ˆé“¾è¡¨éå†ï¼‰</td><td>å¹³å‡O(1)ï¼ˆç¼“å­˜å‹å¥½ï¼‰</td></tr><tr><td>ç©ºé—´åˆ©ç”¨ç‡</td><td>è¾ƒä½ï¼ˆé“¾è¡¨èŠ‚ç‚¹å¼€é”€ï¼‰</td><td>è¾ƒé«˜ï¼ˆæ— é¢å¤–èŠ‚ç‚¹ï¼‰</td></tr></tbody></table>
<h3 data-id="heading-20">äº”ã€æ€»ç»“</h3>
<p>å“ˆå¸Œè¡¨çš„æ ¸å¿ƒæ˜¯â€œæ•°ç»„+å“ˆå¸Œå‡½æ•°â€ï¼Œè§£å†³å†²çªçš„ä¸¤å¤§æ–¹æ¡ˆå„æœ‰ä¼˜åŠ£ï¼ˆæ‹‰é“¾æ³•æ˜¯ä¸»æµï¼‰ã€‚å®é™…å¼€å‘ä¸­ï¼Œéœ€æ ¹æ®åœºæ™¯é€‰æ‹©ä¸åŒçš„å“ˆå¸Œè¡¨å˜ä½“ï¼š</p>
<ul>
<li>
<p>æ™®é€šé”®å€¼æ˜ å°„ï¼šç”¨æ ‡å‡†å“ˆå¸Œè¡¨ï¼ˆå¦‚ <code>Map</code>ï¼‰ï¼›</p>
</li>
<li>
<p>æœ‰åºéå†ï¼šç”¨å“ˆå¸Œé“¾è¡¨ï¼ˆLinkedHashMapï¼‰ï¼›</p>
</li>
<li>
<p>éšæœºè®¿é—®+å…ƒç´ ä¸é‡å¤ï¼šç”¨æ•°ç»„+æ™®é€šå“ˆå¸Œè¡¨ç»„åˆï¼ˆå¦‚ ArrayHashMapï¼‰ï¼Œé€šè¿‡èŠ‚ç‚¹äº¤æ¢å®ç°O(1)åˆ é™¤ï¼›</p>
</li>
<li>
<p>é«˜æ€§èƒ½åœºæ™¯ï¼šä¼˜å…ˆé€‰æ‹©æ‹‰é“¾æ³•ï¼ˆå®ç°ç®€å•ã€ä¸æ˜“å‡ºé”™ï¼‰ã€‚</p>
</li>
</ul>
<h3 data-id="heading-21">å…­ã€ç»ƒä¹ </h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Finsert-delete-getrandom-o1%2F" target="_blank" title="https://leetcode.cn/problems/insert-delete-getrandom-o1/" ref="nofollow noopener noreferrer">380. O(1) æ—¶é—´æ’å…¥ã€åˆ é™¤å’Œè·å–éšæœºå…ƒç´ </a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Finsert-delete-getrandom-o1-duplicates-allowed%2F" target="_blank" title="https://leetcode.cn/problems/insert-delete-getrandom-o1-duplicates-allowed/" ref="nofollow noopener noreferrer">381. O(1) æ—¶é—´æ’å…¥ã€åˆ é™¤å’Œè·å–éšæœºå…ƒç´  - å…è®¸é‡å¤</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[nestjså­¦ä¹ 6ï¼šè®¤è¯†redis]]></title>    <link>https://juejin.cn/post/7598490039488397347</link>    <guid>https://juejin.cn/post/7598490039488397347</guid>    <pubDate>2026-01-24T06:40:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598490039488397347" data-draft-id="7592094358657548322" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="nestjså­¦ä¹ 6ï¼šè®¤è¯†redis"/> <meta itemprop="keywords" content="NestJS"/> <meta itemprop="datePublished" content="2026-01-24T06:40:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸€æ±Ÿä¸œæµæ°´"/> <meta itemprop="url" content="https://juejin.cn/user/1151943917181880"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            nestjså­¦ä¹ 6ï¼šè®¤è¯†redis
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1151943917181880/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸€æ±Ÿä¸œæµæ°´
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T06:40:47.000Z" title="Sat Jan 24 2026 06:40:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>mysqlï¼Œå®ƒæ˜¯é€šè¿‡è¡¨å’Œå­—æ®µæ¥å­˜å‚¨ä¿¡æ¯çš„ï¼Œè¡¨å’Œè¡¨ä¹‹é—´é€šè¿‡ id å…³è”ï¼Œå«åšå…³ç³»å‹æ•°æ®åº“ã€‚</p>
<p>å®ƒæä¾›äº† sql è¯­è¨€ï¼Œå¯ä»¥é€šè¿‡è¿™ç§è¯­è¨€æ¥æè¿°å¯¹æ•°æ®çš„å¢åˆ æ”¹æŸ¥ã€‚</p>
<p>mysql æ˜¯é€šè¿‡ç¡¬ç›˜æ¥å­˜å‚¨ä¿¡æ¯çš„ï¼Œå¹¶ä¸”è¿˜è¦è§£æå¹¶æ‰§è¡Œ sql è¯­å¥ï¼Œè¿™äº›å†³å®šäº†å®ƒä¼šæˆä¸ºæ€§èƒ½ç“¶é¢ˆã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´æœåŠ¡ç«¯æ‰§è¡Œè®¡ç®—ä¼šå¾ˆå¿«ï¼Œä½†æ˜¯ç­‰å¾…æ•°æ®åº“æŸ¥è¯¢ç»“æœå°±å¾ˆæ…¢äº†ã€‚</p>
<p>é‚£æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<p>è®¡ç®—æœºé¢†åŸŸæœ€ç»å¸¸è€ƒè™‘åˆ°çš„æ€§èƒ½ä¼˜åŒ–æ‰‹æ®µå°±æ˜¯ç¼“å­˜äº†ã€‚</p>
<p>èƒ½ä¸èƒ½æŠŠç»“æœç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œä¸‹æ¬¡åªæŸ¥å†…å­˜å°±å¥½äº†å‘¢ï¼Ÿ</p>
<p>æ‰€ä»¥åšåç«¯æœåŠ¡çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸ä¼šåªç”¨ mysqlï¼Œä¸€èˆ¬ä¼šç»“åˆå†…å­˜æ•°æ®åº“æ¥åšç¼“å­˜ï¼Œæœ€å¸¸ç”¨çš„æ˜¯ redisã€‚</p>
<p>å› ä¸ºéœ€æ±‚å°±æ˜¯ç¼“å­˜ä¸åŒç±»å‹çš„æ•°æ®ï¼Œæ‰€ä»¥ redis çš„è®¾è®¡æ˜¯ keyã€value çš„é”®å€¼å¯¹çš„å½¢å¼ã€‚</p>
<p>å¹¶ä¸”å€¼çš„ç±»å‹æœ‰å¾ˆå¤šï¼šå­—ç¬¦ä¸²ï¼ˆstringï¼‰ã€åˆ—è¡¨ï¼ˆlistï¼‰ã€é›†åˆï¼ˆsetï¼‰ã€æœ‰åºé›†åˆï¼ˆsorted set)ã€å“ˆå¸Œè¡¨ï¼ˆhashï¼‰ã€åœ°ç†ä¿¡æ¯ï¼ˆgeospatialï¼‰ã€ä½å›¾ï¼ˆbitmapï¼‰ç­‰ã€‚</p>
<p>ä¸‹é¢ä¸€ä¸€æ¥å­¦ä¹ ä¸‹è¿™äº›ç±»å‹çš„ä½¿ç”¨ã€‚</p>
<h2 data-id="heading-0">string</h2>
<p>å¯¹å­—ç¬¦ä¸²çš„æ“ä½œå‘½ä»¤ä¸»è¦æœ‰setã€getï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f595dd0bb631424c8d85dd917f727171~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769841647&amp;x-signature=Mrg03P%2FYlZ27%2BS2198Vw0CTtkBk%3D" alt="c6666f2c01194f00ad7f45d33a7dfd47~tplv-k3u1fbpfcp-jj-mark_1512_0_0_0_q75.awebp" loading="lazy"/></p>
<p>incr æ˜¯ç”¨äºé€’å¢çš„ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97c1c479bf1b49fd83fc118dae7052fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769841647&amp;x-signature=mCtuQD%2FS%2BrxcG5PjW9LzlM6S7BM%3D" alt="fa3391bda1ff4967abecbd2a0da7e8c5~tplv-k3u1fbpfcp-jj-mark_1512_0_0_0_q75.awebp" loading="lazy"/></p>
<p>å¹³æ—¶æˆ‘ä»¬ç”¨çš„é˜…è¯»é‡ã€ç‚¹èµé‡ç­‰éƒ½æ˜¯é€šè¿‡è¿™ä¸ªæ¥è®¡æ•°çš„ã€‚</p>
<p>å½“æˆ‘å­˜äº†å‡ ä¸ª key åï¼Œå¯ä»¥é€šè¿‡ keys æ¥æŸ¥è¯¢æœ‰å“ªäº› key:</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4774437178144cc4b13be5aba7a73160~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769841647&amp;x-signature=N23%2BCv3vBCxDWqs49WTBecGKghw%3D" alt="image.png" loading="lazy"/></p>
<p>keys ååŠ ä¸€ä¸ªæ¨¡å¼ä¸²æ¥è¿‡æ»¤ï¼Œå¸¸ç”¨çš„æ˜¯ * æ¥æŸ¥è¯¢æ‰€æœ‰ keyã€‚</p>
<p>å¸¸ç”¨çš„å‘½ä»¤æœ‰ï¼š</p>
<ul>
<li>set</li>
<li>get</li>
<li>incr</li>
<li>keys</li>
</ul>
<h2 data-id="heading-1">list</h2>
<p>ä¸€ä¸ªåˆ—è¡¨çš„ç»“æ„ã€‚</p>
<h3 data-id="heading-2">lpush rpush</h3>
<pre><code class="hljs language-js" lang="js">lpush list1 <span class="hljs-number">111</span>
lpush list1 <span class="hljs-number">222</span>
lpush list1 <span class="hljs-number">333</span>
</code></pre>
<p>lpush æ˜¯ left push çš„æ„æ€ï¼Œæ‰§è¡Œåä¼šä»å·¦åˆ°å³æ·»åŠ åˆ°åˆ—è¡¨ä¸­ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87578dff8d384278b5d4a122f68d2cf7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769841647&amp;x-signature=ipZQsoAf3vn2dV2wPXWNZzMrpvA%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-js" lang="js">rpush list1 <span class="hljs-number">444</span>
rpush list1 <span class="hljs-number">555</span>
</code></pre>
<p>rpush æ˜¯ right push çš„æ„æ€ï¼Œæ‰§è¡Œåä¼šä»å³å¾€å·¦æ·»åŠ åˆ°åˆ—è¡¨ä¸­</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c48aa853de349248a3203c15bac3634~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769841647&amp;x-signature=op08v%2FqM0wSWiHjo9fNAX%2FFf0c0%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-3">lpop  rpop</h3>
<p>lpop å’Œ rpop è‡ªç„¶æ˜¯ä»å·¦è¾¹å’Œä»å³è¾¹åˆ é™¤æ•°æ®ã€‚</p>
<pre><code class="hljs language-js" lang="js">lpop list1
rpop list1
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f238e5198a7408b9cda1c2666082f44~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769841647&amp;x-signature=CYKRXOFHMulfe4OhotR2%2FiK4pWs%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-4">lrange</h3>
<p>ä¸å°±æ˜¯ get ä¹ˆï¼Ÿ</p>
<p>æ˜¯ä¸è¡Œçš„ï¼Œget åªé€‚ç”¨äº string ç±»å‹çš„æ•°æ®ï¼Œlist ç±»å‹çš„æ•°æ®è¦ç”¨ lrangeã€‚</p>
<pre><code class="hljs language-js" lang="js">lrange list1 <span class="hljs-number">0</span> -<span class="hljs-number">1</span>
</code></pre>
<p>è¾“å…¥ä¸€æ®µ rangeï¼Œç»“å°¾ä¸‹æ ‡ä¸º -1 ä»£è¡¨åˆ°æœ€åã€‚</p>
<p><code>lrange list1 0 -1</code> å°±æ˜¯æŸ¥è¯¢ list1 çš„å…¨éƒ¨æ•°æ®ã€‚</p>
<h2 data-id="heading-5">set æ•°æ®ç±»å‹</h2>
<p>å…ˆå¤ä¹ ä¸‹jsä¸­çš„set ç±»å‹ã€‚</p>
<p>Set æ˜¯ ES6 æ–°å¢çš„<strong>æ— åºé›†åˆ</strong>ï¼Œç‰¹ç‚¹æ˜¯ï¼š</p>
<ul>
<li>é‡Œé¢çš„<strong>å€¼å”¯ä¸€ï¼Œæ²¡æœ‰é‡å¤é¡¹</strong>ï¼ˆè‡ªåŠ¨å»é‡ï¼‰ï¼›</li>
<li>å¯ä»¥å­˜æ”¾ä»»æ„ç±»å‹çš„å€¼ï¼ˆåŸå§‹ç±»å‹ï¼šæ•°å­—ã€å­—ç¬¦ä¸²ã€å¸ƒå°”ï¼›å¼•ç”¨ç±»å‹ï¼šå¯¹è±¡ã€æ•°ç»„ç­‰ï¼‰ï¼›</li>
<li>æ²¡æœ‰ <strong>é”®</strong> çš„æ¦‚å¿µï¼Œåªæœ‰ <strong>å€¼</strong>ï¼›</li>
</ul>
<p>Set æ˜¯<strong>æ— åºçš„</strong>ï¼Œä¸èƒ½é€šè¿‡ä¸‹æ ‡è®¿é—®ï¼Œé‚£æ€ä¹ˆè®¿é—®å‘¢ï¼Ÿ</p>
<ul>
<li>
<p>è¦ä¹ˆ<strong>éå†</strong> Setï¼Œé€ä¸ªè·å–å€¼ï¼ˆé€‚åˆéœ€è¦å¤„ç†æ‰€æœ‰å€¼çš„åœºæ™¯ï¼‰ï¼›</p>
</li>
<li>
<p>è¦ä¹ˆæŠŠ Set <strong>è½¬æ¢æˆæ•°ç»„</strong>ï¼Œå†ç”¨æ•°ç»„çš„æ–¹å¼å–å€¼ï¼ˆé€‚åˆéœ€è¦å–æŒ‡å®šä½ç½®å€¼çš„åœºæ™¯ï¼‰ï¼›</p>
</li>
<li>
<p>è¦ä¹ˆé€šè¿‡ <code>has()</code> å…ˆåˆ¤æ–­å€¼æ˜¯å¦å­˜åœ¨ï¼Œå†é’ˆå¯¹æ€§å¤„ç†ï¼ˆé€‚åˆæ‰¾ç‰¹å®šå€¼çš„åœºæ™¯ï¼‰ã€‚</p>
</li>
</ul>
<p>æœ€å¸¸ç”¨åœºæ™¯å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// åœºæ™¯1ï¼šæ•°ç»„å»é‡ï¼ˆSet æœ€ç»å…¸ç”¨æ³•ï¼‰ </span>
<span class="hljs-keyword">const</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>]; 
<span class="hljs-keyword">const</span> uniqueArr = [...<span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(arr)]; 
<span class="hljs-comment">// ç”¨æ‰©å±•è¿ç®—ç¬¦è½¬æˆæ•°ç»„ </span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(uniqueArr); <span class="hljs-comment">// [1, 2, 3] </span>

<span class="hljs-comment">// åœºæ™¯2ï¼šå­˜æ”¾ä¸é‡å¤çš„ç”¨æˆ· ID </span>
<span class="hljs-keyword">const</span> userIds = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(); 
userIds.<span class="hljs-title function_">add</span>(<span class="hljs-string">"u001"</span>); 
userIds.<span class="hljs-title function_">add</span>(<span class="hljs-string">"u002"</span>); 
userIds.<span class="hljs-title function_">add</span>(<span class="hljs-string">"u001"</span>); <span class="hljs-comment">// é‡å¤æ·»åŠ ï¼Œæ— æ•ˆ</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(userIds.<span class="hljs-property">size</span>); <span class="hljs-comment">// 2 </span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(userIds.<span class="hljs-title function_">has</span>(<span class="hljs-string">"u002"</span>)); <span class="hljs-comment">// true </span>

<span class="hljs-comment">// åœºæ™¯3ï¼šéå† Set </span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> val <span class="hljs-keyword">of</span> userIds) { 
   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(val); <span class="hljs-comment">// ä¾æ¬¡è¾“å‡º u001ã€u002 </span>
} 
<span class="hljs-comment">// ä¹Ÿå¯ä»¥ç”¨ forEach</span>
userIds.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">val</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(val));
</code></pre>
<p><strong>redis ä¸­çš„set çš„ç‰¹ç‚¹ä¹Ÿæ˜¯æ— åºå¹¶ä¸”å…ƒç´ ä¸é‡å¤ã€‚</strong></p>
<p>å½“æˆ‘æ·»åŠ é‡å¤æ•°æ®çš„æ—¶å€™ï¼š</p>
<pre><code class="hljs language-js" lang="js">sadd set1 <span class="hljs-number">111</span>
sadd set1 <span class="hljs-number">111</span>
sadd set1 <span class="hljs-number">111</span>
sadd set1 <span class="hljs-number">222</span>
sadd set1 <span class="hljs-number">222</span>
sadd set1 <span class="hljs-number">333</span>
</code></pre>
<p>ç»“æœåªæœ‰ 111 222 333ã€‚</p>
<p>å¯ä»¥é€šè¿‡ <code>sismember</code> åˆ¤æ–­æ˜¯å¦æ˜¯é›†åˆä¸­çš„å…ƒç´ ï¼š</p>
<pre><code class="hljs language-js" lang="js">sismember set1 <span class="hljs-number">111</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/edc8bb0d5fbc4fdfbea5c606f95fc6f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769841647&amp;x-signature=lATxWMYFJgAW0r7y2%2BLY%2Bg25g1g%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-js" lang="js">sismember set1 <span class="hljs-number">444</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e7bde739b45e4118a4770fa3ede99982~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769841647&amp;x-signature=vuiKIKZnjUp3ZxVndQ%2Fw0O7fWBc%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-6">zset æ•°æ®ç±»å‹</h2>
<p>set åªèƒ½å»é‡ã€åˆ¤æ–­åŒ…å«ï¼Œä¸èƒ½å¯¹å…ƒç´ æ’åºã€‚</p>
<p>å¦‚æœæ’åºã€å»é‡çš„éœ€æ±‚ï¼Œæ¯”å¦‚æ’è¡Œæ¦œï¼Œå¯ä»¥ç”¨ <code>sorted set</code>ï¼Œä¹Ÿå°±æ˜¯ <code>zset</code>ã€‚</p>
<p>å®ƒæ¯ä¸ªå…ƒç´ æ˜¯æœ‰ä¸€ä¸ªåˆ†æ•°çš„ï¼š</p>
<pre><code class="hljs language-js" lang="js">zadd zset1 <span class="hljs-number">5</span> guang
zadd zset1 <span class="hljs-number">4</span> dong
zadd zset1 <span class="hljs-number">3</span> xxx
zadd zset1 <span class="hljs-number">6</span> yyyy
</code></pre>
<p>ä¼šæŒ‰ç…§åˆ†æ•°æ¥æ’åºã€‚</p>
<p>é€šè¿‡ zrange å‘½ä»¤å–æ•°æ®ï¼Œæ¯”å¦‚å–æ’åå‰ä¸‰çš„æ•°æ®ï¼š</p>
<pre><code class="hljs language-js" lang="js">zrange zset1 <span class="hljs-number">0</span> <span class="hljs-number">2</span>
</code></pre>
<h2 data-id="heading-7">hash æ•°æ®ç»“æ„</h2>
<p>å…ˆå¤ä¹ ä¸‹ä»€ä¹ˆæ˜¯å“ˆå¸Œå‡½æ•°åŠå“ˆå¸Œè¡¨ã€‚</p>
<p>å“ˆå¸Œå‡½æ•°ï¼ˆHash Functionï¼‰æœ¬è´¨æ˜¯ä¸€ä¸ª <strong>è½¬æ¢å™¨</strong> ï¼Œå®ƒæ¥æ”¶ä»»æ„é•¿åº¦çš„è¾“å…¥ï¼ˆæ¯”å¦‚ä¸€ä¸ªå­—ç¬¦ä¸²ã€ä¸€ä¸ªæ•°å­—ã€ä¸€ä¸ªæ–‡ä»¶ï¼‰ï¼Œè¾“å‡ºä¸€ä¸ª<strong>å›ºå®šé•¿åº¦ã€çœ‹èµ·æ¥æ— è§„å¾‹çš„ç»“æœ</strong>ï¼Œè¿™ä¸ªç»“æœå°±å« <strong>å“ˆå¸Œå€¼</strong>ï¼ˆHash Valueï¼‰ã€‚</p>
<p>å‰ç«¯ä¸­å¸¸ç”¨çš„å“ˆå¸Œå‡½æ•°æœ‰MD5ã€SHA-256ï¼Œæ¯”å¦‚ SHA-256  è¾“å‡º 256 ä½ï¼ˆ64 ä¸ªåå…­è¿›åˆ¶å­—ç¬¦ï¼‰ã€‚</p>
<p>å°±åƒå¿«é€’ç«™çš„ <strong>åˆ†åŒºæ‰«ç å™¨</strong> ï¼š</p>
<ul>
<li>è¾“å…¥ï¼šä½ çš„å¿«é€’å•å·ï¼ˆä»»æ„é•¿åº¦ï¼‰ï¼›</li>
<li>å“ˆå¸Œå‡½æ•°ï¼šæ‰«ç å™¨çš„è®¡ç®—è§„åˆ™ï¼›</li>
<li>è¾“å‡ºï¼šä¸€ä¸ªå›ºå®šé•¿åº¦çš„åˆ†åŒºç¼–å·ï¼ˆæ¯”å¦‚ <code>05</code> åŒºï¼‰ï¼Œä½ æ‹¿åŒä¸€ä¸ªå•å·æ‰«ï¼Œæ°¸è¿œæ˜¯ <code>05</code> åŒºï¼›ä¸åŒå•å·å¤§æ¦‚ç‡æ‰«å‡ºä¸åŒåŒºï¼Œæå°‘æ•°æƒ…å†µä¼šæ‰«åˆ°åŒä¸€ä¸ªåŒºï¼ˆå†²çªï¼‰ã€‚</li>
</ul>
<p><strong>å“ˆå¸Œè¡¨ï¼šä¸€ä¸ªæŒ‰åœ°å€æ‰¾ä¸œè¥¿çš„æŸœå­</strong></p>
<p>å“ˆå¸Œè¡¨ï¼ˆHash Tableï¼‰ä¹Ÿå« <strong>æ•£åˆ—è¡¨</strong>ï¼Œæ˜¯ä¸€ç§ <strong>æ•°æ®ç»“æ„</strong>ï¼Œæ ¸å¿ƒç›®çš„æ˜¯ <strong>è®©æŸ¥æ‰¾æ•°æ®çš„é€Ÿåº¦å˜å¿«</strong>ï¼ˆç†æƒ³æƒ…å†µä¸‹æŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O (1)ã€‚</p>
<p>åˆ†ä¸ºä¸‰æ­¥ï¼š</p>
<ol>
<li>
<p>å‡†å¤‡ä¸€ä¸ªæ•°ç»„ï¼ˆæŸœå­ï¼‰ï¼Œå…ˆåˆ›å»ºä¸€ä¸ªå›ºå®šå¤§å°çš„æ•°ç»„ï¼Œæ•°ç»„çš„æ¯ä¸ªä½ç½®å« <strong>æ¡¶</strong> ï¼Œå¯ä»¥æ”¾æ•°æ®ã€‚</p>
</li>
<li>
<p>ç”¨å“ˆå¸Œå‡½æ•°ç®— <strong>å­˜æ”¾åœ°å€</strong>ï¼Œå½“ä½ è¦å­˜ä¸€ä¸ªæ•°æ®ï¼ˆæ¯”å¦‚ key: "å¼ ä¸‰", value: "138xxxx"ï¼‰æ—¶ï¼š</p>
<ul>
<li>æŠŠ <code>key</code> ä¼ å…¥å“ˆå¸Œå‡½æ•°ï¼Œå¾—åˆ°ä¸€ä¸ªå“ˆå¸Œå€¼ï¼›</li>
<li>æŠŠå“ˆå¸Œå€¼å¯¹æ•°ç»„é•¿åº¦å–ä½™ï¼Œå¾—åˆ°ä¸€ä¸ª<strong>ç´¢å¼•å€¼</strong>ï¼ˆå°±æ˜¯æ•°ç»„çš„ä¸‹æ ‡ï¼Œæ¯”å¦‚ 3ï¼‰ï¼›</li>
<li>æŠŠ <code>(key, value)</code> å­˜åˆ°æ•°ç»„çš„ç¬¬3ä¸ªæ¡¶é‡Œã€‚</li>
</ul>
</li>
<li>
<p>æŸ¥æ‰¾æ•°æ®æ—¶ç›´æ¥æŒ‰åœ°å€æ‰¾ï¼Œå½“ä½ è¦æ‰¾å¼ ä¸‰çš„æ‰‹æœºå·æ—¶ï¼š</p>
<ul>
<li>å†æ¬¡ç”¨å“ˆå¸Œå‡½æ•°ç®— å¼ ä¸‰çš„ç´¢å¼•å€¼ï¼ˆè¿˜æ˜¯ 3ï¼‰ï¼›</li>
<li>ç›´æ¥å»æ•°ç»„ç¬¬ 3 ä¸ªæ¡¶é‡Œæ‹¿æ•°æ®ï¼Œä¸ç”¨éå†æ•´ä¸ªæ•°ç»„ã€‚</li>
</ul>
</li>
</ol>
<p>ä¸‹é¢çœ‹çœ‹jsä¸­çš„mapç»“æ„ï¼š</p>
<p>ç®€å•æ¥è¯´ï¼Œ<code>Map</code> æ˜¯ ES6 æ–°å¢çš„<strong>é”®å€¼å¯¹é›†åˆ</strong>ï¼ˆç±»ä¼¼å¯¹è±¡ <code>{}</code>ï¼‰ï¼Œä½†æ¯”æ™®é€šå¯¹è±¡æ›´çµæ´»ã€åŠŸèƒ½æ›´å¼ºï¼š</p>
<ul>
<li>
<p>æ™®é€šå¯¹è±¡çš„é”®åªèƒ½æ˜¯<strong>å­—ç¬¦ä¸² / æ•°å­— / Symbol</strong>ï¼Œè€Œ <code>Map</code> çš„é”®å¯ä»¥æ˜¯<strong>ä»»æ„ç±»å‹</strong>ï¼ˆæ¯”å¦‚å¯¹è±¡ã€æ•°ç»„ã€å‡½æ•°ã€null ç­‰ï¼‰ï¼›</p>
</li>
<li>
<p><code>Map</code> ä¼š<strong>ä¿ç•™é”®çš„æ’å…¥é¡ºåº</strong>ï¼Œéå†çš„æ—¶å€™æŒ‰æ’å…¥é¡ºåºæ¥ï¼›</p>
</li>
<li>
<p><code>Map</code> æœ‰åŸç”Ÿçš„ <code>size</code> å±æ€§ï¼ˆç›´æ¥è·å–é”®å€¼å¯¹æ•°é‡ï¼‰ï¼Œè€Œå¯¹è±¡éœ€è¦æ‰‹åŠ¨è®¡ç®—ï¼›</p>
</li>
<li>
<p><code>Map</code> æä¾›äº† <code>set()</code>ã€<code>get()</code>ã€<code>delete()</code>ã€<code>clear()</code> ç­‰ä¸“ç”¨æ–¹æ³•ï¼Œæ“ä½œæ›´è§„èŒƒã€‚</p>
</li>
</ul>
<p>Map çš„å…¸å‹ä½¿ç”¨åœºæ™¯ï¼š</p>
<ul>
<li>éœ€è¦éå­—ç¬¦ä¸² / æ•°å­—ä½œä¸ºé”®çš„åœºæ™¯ï¼›</li>
<li>éœ€è¦é¢‘ç¹å¢åˆ é”®å€¼å¯¹çš„åœºæ™¯ï¼š</li>
</ul>
<p>æ™®é€šå¯¹è±¡å¢åˆ å±æ€§è™½ç„¶ä¹Ÿèƒ½åšï¼Œä½† <code>Map</code> æä¾›äº†æ›´é«˜æ•ˆã€è¯­ä¹‰æ›´æ¸…æ™°çš„æ–¹æ³•ï¼ˆ<code>delete()</code>/<code>clear()</code>ï¼‰ï¼Œä¸”æ€§èƒ½æ›´å¥½ï¼ˆå°¤å…¶æ•°æ®é‡å¤§æ—¶ï¼‰ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// åœºæ™¯ï¼šä¸´æ—¶å­˜å‚¨ç”¨æˆ·ä¼šè¯æ•°æ®ï¼Œéœ€è¦é¢‘ç¹æ·»åŠ /åˆ é™¤</span>
<span class="hljs-keyword">const</span> userSessions = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();

<span class="hljs-comment">// æ·»åŠ ä¼šè¯</span>
userSessions.<span class="hljs-title function_">set</span>(<span class="hljs-string">'user123'</span>, { <span class="hljs-attr">id</span>: <span class="hljs-string">'123'</span>, <span class="hljs-attr">expire</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() + <span class="hljs-number">3600000</span> });
userSessions.<span class="hljs-title function_">set</span>(<span class="hljs-string">'user456'</span>, { <span class="hljs-attr">id</span>: <span class="hljs-string">'456'</span>, <span class="hljs-attr">expire</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() + <span class="hljs-number">3600000</span> });

<span class="hljs-comment">// åˆ é™¤å•ä¸ªä¼šè¯</span>
userSessions.<span class="hljs-title function_">delete</span>(<span class="hljs-string">'user123'</span>);

<span class="hljs-comment">// æ¸…ç©ºæ‰€æœ‰ä¼šè¯ï¼ˆæ¯”éå†åˆ é™¤å¯¹è±¡å±æ€§é«˜æ•ˆï¼‰</span>
userSessions.<span class="hljs-title function_">clear</span>();
</code></pre>
<ul>
<li>éœ€è¦æœ‰åºéå†é”®å€¼å¯¹çš„åœºæ™¯</li>
</ul>
<p><code>Map</code> ä¼šä¸¥æ ¼æŒ‰ç…§<strong>é”®çš„æ’å…¥é¡ºåº</strong>éå†ï¼Œè€Œæ™®é€šå¯¹è±¡ï¼ˆES6 å‰ï¼‰çš„é”®é¡ºåºæ˜¯ä¸ç¡®å®šçš„ï¼ˆæ•°å­—é”®ä¼˜å…ˆï¼Œå­—ç¬¦ä¸²é”®æ¬¡ä¹‹ï¼‰ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// åœºæ™¯ï¼šæŒ‰æ·»åŠ é¡ºåºå±•ç¤ºç”¨æˆ·æ“ä½œæ—¥å¿—</span>
<span class="hljs-keyword">const</span> operationLog = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
operationLog.<span class="hljs-title function_">set</span>(<span class="hljs-string">'2026-01-24 10:00'</span>, <span class="hljs-string">'ç™»å½•'</span>);
operationLog.<span class="hljs-title function_">set</span>(<span class="hljs-string">'2026-01-24 10:05'</span>, <span class="hljs-string">'æŸ¥çœ‹è®¢å•'</span>);
operationLog.<span class="hljs-title function_">set</span>(<span class="hljs-string">'2026-01-24 10:10'</span>, <span class="hljs-string">'æ”¯ä»˜'</span>);

<span class="hljs-comment">// éå†ï¼šä¸¥æ ¼æŒ‰æ’å…¥é¡ºåºè¾“å‡º</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [time, action] <span class="hljs-keyword">of</span> operationLog) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${time}</span>ï¼š<span class="hljs-subst">${action}</span>`</span>);
}
</code></pre>
<p>ç°åœ¨æ¥çœ‹çœ‹redisä¸­hashæ€ä¹ˆç”¨çš„ã€‚</p>
<pre><code class="hljs language-js" lang="js">hset hash1 key1 <span class="hljs-number">1</span>
hset hash1 key2 <span class="hljs-number">2</span>
hset hash1 key3 <span class="hljs-number">3</span>
hset hash1 key4 <span class="hljs-number">4</span>
hset hash1 key5 <span class="hljs-number">5</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/406b227ca81b4a179a86d7aca3c4faf1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769841647&amp;x-signature=l7X5HttcQkyQG4ISSicMODBKadQ%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-js" lang="js">hget hash1 key3
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e3f7bc90642849bb9e956033f4037e90~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769841647&amp;x-signature=sSiRXWaZliPFdakucxe%2B%2BDBmCG0%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-8">geo æ•°æ®ç»“æ„</h2>
<p>å­˜å‚¨ç»çº¬åº¦ä¿¡æ¯ï¼Œæ ¹æ®è·ç¦»è®¡ç®—å‘¨å›´çš„äººç”¨çš„ã€‚</p>
<pre><code class="hljs language-js" lang="js">geoadd loc <span class="hljs-number">13.361389</span> <span class="hljs-number">38.115556</span> <span class="hljs-string">"guangguang"</span> <span class="hljs-number">15.087269</span> <span class="hljs-number">37.502669</span> <span class="hljs-string">"dongdong"</span> 
</code></pre>
<p>ç”¨ loc ä½œä¸º keyï¼Œåˆ†åˆ«æ·»åŠ  guangguang å’Œ dongdong çš„ç»çº¬åº¦ã€‚</p>
<p>ä½ ä¼šå‘ç° redis å®é™…ä½¿ç”¨ zset å­˜å‚¨çš„ï¼ŒæŠŠç»çº¬åº¦è½¬åŒ–ä¸ºäº†äºŒç»´å¹³é¢çš„åæ ‡ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c05c7b8ffcfd4b72a93aa804b1e7112c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769841647&amp;x-signature=03j7TqWROasMrAa7gW49vK5c2eo%3D" alt="image.png" loading="lazy"/></p>
<p>ä½ å¯ä»¥ç”¨ geodist è®¡ç®—ä¸¤ä¸ªåæ ‡ç‚¹çš„è·ç¦»ï¼š</p>
<pre><code class="hljs language-js" lang="js">geodist loc guangguang dogndong
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5fde602b609b42f1995c86c60290f8e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769841647&amp;x-signature=J%2BOJLlhh%2BBRDDpR1Qh%2FlAxpwRHU%3D" alt="image.png" loading="lazy"/></p>
<p>ç”¨ georadius æœç´¢æŸä¸ªåŠå¾„å†…çš„å…¶ä»–ç‚¹ï¼Œä¼ å…¥ç»çº¬åº¦ã€åŠå¾„å’Œå•ä½ï¼š</p>
<pre><code class="hljs language-js" lang="js">georadius loc <span class="hljs-number">15</span> <span class="hljs-number">37</span> <span class="hljs-number">100</span> km
georadius loc <span class="hljs-number">15</span> <span class="hljs-number">37</span> <span class="hljs-number">200</span> km
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e3eda12dbe4475aa2a3796906ee07a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769841647&amp;x-signature=qu5fXSFaDAN6YoLA6Qo8PK7cV68%3D" alt="image.png" loading="lazy"/></p>
<p>å¹³æ—¶æˆ‘ä»¬æŸ¥æ‰¾å‘¨å›´çš„äººã€å‘¨å›´çš„ xxx éƒ½å¯ä»¥é€šè¿‡ redis çš„ geo æ•°æ®ç»“æ„å®ç°ã€‚</p>
<h2 data-id="heading-9">è¿‡æœŸæ—¶é—´</h2>
<p>ä¸€èˆ¬ redis çš„ key æˆ‘ä»¬ä¼šè®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œé€šè¿‡ expire å‘½ä»¤ã€‚</p>
<p>æ¯”å¦‚æˆ‘è®¾ç½® dong1 çš„ key ä¸º 30 ç§’è¿‡æœŸï¼š</p>
<pre><code class="hljs language-js" lang="js">expire dogn1 <span class="hljs-number">30</span>
</code></pre>
<p>ç­‰åˆ°äº†è¿‡æœŸæ—¶é—´å°±ä¼šè‡ªåŠ¨åˆ é™¤ã€‚</p>
<p>æƒ³æŸ¥å‰©ä½™è¿‡æœŸæ—¶é—´ä½¿ç”¨ ttlï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/66dfe82cd1fd4e1da1c4298e75e885fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769841647&amp;x-signature=OE7v5AIVEJtE%2BROxIrm%2FUBvDyUg%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-10">æ€»ç»“</h2>
<p>å›åˆ°æœ€å¼€å§‹çš„é—®é¢˜ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥æŸ¥å‡ºæ•°æ®æ¥ä¹‹åæ”¾åˆ° redis ä¸­ç¼“å­˜ï¼Œä¸‹æ¬¡å¦‚æœ redis æœ‰æ•°æ®å°±ç›´æ¥ç”¨ï¼Œæ²¡æœ‰çš„è¯å°±æŸ¥æ•°æ®åº“ç„¶åæ›´æ–° redis ç¼“å­˜ã€‚</p>
<p>è¿™æ˜¯ redis çš„ç¬¬ä¸€ç§ç”¨é€”ï¼Œä½œä¸ºæ•°æ®åº“çš„ç¼“å­˜ï¼Œä¹Ÿæ˜¯ä¸»è¦çš„ç”¨é€”ã€‚</p>
<p>ç¬¬äºŒç§ç”¨é€”å°±æ˜¯ç›´æ¥ä½œä¸ºå­˜å‚¨æ•°æ®çš„åœ°æ–¹äº†ï¼Œå› ä¸º redis æœ¬èº«æ˜¯ä¼šåšæŒä¹…åŒ–çš„ï¼Œèƒ½æŠŠå†…å­˜ä¸­çš„æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šï¼Œé¿å…é‡å¯åæ•°æ®ä¸¢å¤±ã€‚ä¹Ÿå°±æ˜¯å¯ä»¥æŠŠæ•°æ®ç›´æ¥ä¿å­˜åœ¨ redis é‡Œï¼Œä¸å­˜åˆ° mysqlã€‚</p>
<p>å½“ç„¶ï¼Œå› ä¸º redis åœ¨å†…å­˜å­˜å‚¨æ•°æ®ï¼Œè¿™æ ·æˆæœ¬è¿˜æ˜¯æ¯”è¾ƒé«˜çš„ï¼Œéœ€è¦ç»å¸¸æ‰©å®¹ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[kafkaå’Œrocketæ¶ˆè´¹æœºåˆ¶å·®å¼‚]]></title>    <link>https://juejin.cn/post/7598532592455417883</link>    <guid>https://juejin.cn/post/7598532592455417883</guid>    <pubDate>2026-01-24T06:47:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598532592455417883" data-draft-id="7598532592455401499" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="kafkaå’Œrocketæ¶ˆè´¹æœºåˆ¶å·®å¼‚"/> <meta itemprop="keywords" content="åç«¯,Kafka,RocketMQ"/> <meta itemprop="datePublished" content="2026-01-24T06:47:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Warson_L"/> <meta itemprop="url" content="https://juejin.cn/user/2568875732117304"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            kafkaå’Œrocketæ¶ˆè´¹æœºåˆ¶å·®å¼‚
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2568875732117304/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Warson_L
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T06:47:33.000Z" title="Sat Jan 24 2026 06:47:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æ—¢ç„¶ä¹‹å‰çš„æ€»ç»“â€œè¿‡äºç®€ç•¥â€ï¼Œé‚£æˆ‘ä»¬è¿™æ¬¡æ¥ä¸€æ¬¡<strong>æ·±åº¦è§£å‰–</strong>ã€‚æˆ‘ä»¬å°†ä»æ•°æ®ç»“æ„ã€åº•å±‚äº¤äº’æµç¨‹ã€Offset ç®¡ç†æœºåˆ¶è¿™å‡ ä¸ªç»´åº¦ï¼ŒæŠŠ Kafka å’Œ RocketMQ åœ¨â€œæ¶ˆæ¯å¤„ç†å¤±è´¥â€è¿™ä¸€åœºæ™¯ä¸‹çš„è¡¨ç°å·®å¼‚å½»åº•è®²é€ã€‚</p>
<hr/>
<h3 data-id="heading-0">æ ¸å¿ƒåœºæ™¯è®¾å®š</h3>
<ul>
<li><strong>Topic</strong>: <code>OrderTopic</code></li>
<li><strong>Partition</strong>: <code>0</code></li>
<li><strong>æ¶ˆæ¯æµ</strong>:
<ul>
<li><code>Offset 100</code>: è®¢å• Aï¼ˆå¤„ç†<strong>å¤±è´¥</strong>ï¼Œæ•°æ®åº“æ­»é”ï¼‰</li>
<li><code>Offset 101</code>: è®¢å• Bï¼ˆå¤„ç†<strong>æˆåŠŸ</strong>ï¼‰</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-1">ä¸€ã€Kafkaï¼šæµå¼æ—¥å¿—ï¼ˆThe Logï¼‰</h3>
<p>Kafka çš„è®¾è®¡å“²å­¦æ˜¯ <strong>â€œå“‘ä»£ç†ï¼Œæ™ºå®¢æˆ·ç«¯â€ (Dumb Broker, Smart Client)</strong>ã€‚Broker åªæ˜¯ä¸€ä¸ªè´Ÿè´£è¿½åŠ å†™æ–‡ä»¶çš„ç³»ç»Ÿï¼Œå®ƒæ ¹æœ¬ä¸å…³å¿ƒæ¶ˆæ¯å†…å®¹ï¼Œä¹Ÿä¸å…³å¿ƒå•æ¡æ¶ˆæ¯çš„çŠ¶æ€ã€‚</p>
<h4 data-id="heading-2">1. åªæœ‰â€œè¿›åº¦â€ï¼Œæ²¡æœ‰â€œçŠ¶æ€â€</h4>
<p>Kafka ç»´æŠ¤æ¶ˆè´¹è¿›åº¦çš„æ–¹å¼éå¸¸ç²—çŠ·ã€‚å®ƒä¸åœ¨æ¯æ¡æ¶ˆæ¯ä¸Šæ‰“å‹¾ï¼Œå®ƒåªç»´æŠ¤ä¸€ä¸ª <strong>High Watermarkï¼ˆæ°´ä½çº¿ï¼‰</strong> æˆ– <strong>Committed Offset</strong>ã€‚</p>
<ul>
<li><strong>Kafka çš„é€»è¾‘</strong>ï¼šConsumer å‘Šè¯‰æˆ‘å®ƒæäº¤äº† <code>101</code>ï¼Œé‚£æˆ‘å°±è®¤ä¸º <code>0 ~ 101</code> ä¹‹é—´çš„æ‰€æœ‰æ•°æ®å…¨å®Œäº†ã€‚</li>
</ul>
<h4 data-id="heading-3">2. è¯¦ç»†æ‰§è¡Œæµç¨‹ï¼ˆOffset 100 å¤±è´¥ï¼Œ101 æˆåŠŸï¼‰</h4>
<ol>
<li>
<p><strong>æ‹‰å– (Fetch)</strong>:</p>
<ul>
<li>Consumer å‘ Broker æ‹‰å–ä¸€æ‰¹æ¶ˆæ¯ï¼ˆBatchï¼‰ï¼Œæ¯”å¦‚ä¸€æ¬¡æ‹‰äº† <code>100, 101, 102</code> ä¸‰æ¡ã€‚</li>
<li>è¿™ä¸‰æ¡æ¶ˆæ¯ç°åœ¨éƒ½åœ¨ Consumer çš„<strong>å†…å­˜</strong>é‡Œã€‚</li>
</ul>
</li>
<li>
<p><strong>å¤„ç† Offset 100 (å¤±è´¥)</strong>:</p>
<ul>
<li>Consumer æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼ŒæŠ¥é”™ã€‚</li>
<li><strong>å…³é”®ç‚¹</strong>ï¼šBroker å¯¹æ­¤<strong>ä¸€æ— æ‰€çŸ¥</strong>ã€‚Broker ä¹Ÿæ²¡æœ‰â€œæŠŠ 100 æ ‡è®°ä¸ºå¤±è´¥â€è¿™ç§æ¥å£ã€‚</li>
<li><em>ä»£ç é€‰æ‹©</em>ï¼šå¦‚æœä½ çš„ä»£ç  <code>catch</code> äº†é”™è¯¯å¹¶ <code>continue</code>ï¼ŒConsumer å†…å­˜é‡Œçš„æ¸¸æ ‡æŒ‡å‘äº†ä¸‹ä¸€æ¡ã€‚</li>
</ul>
</li>
<li>
<p><strong>å¤„ç† Offset 101 (æˆåŠŸ)</strong>:</p>
<ul>
<li>Consumer æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼ŒæˆåŠŸã€‚</li>
<li><em>ä»£ç åŠ¨ä½œ</em>ï¼š<code>session.MarkMessage(101)</code>ã€‚æ­¤æ—¶ Sarama å®¢æˆ·ç«¯åœ¨æœ¬åœ°è®°å½•ï¼š<code>current_offset = 101</code>ã€‚</li>
</ul>
</li>
<li>
<p><strong>æäº¤ (Commit)</strong>:</p>
<ul>
<li>Sarama åå°åç¨‹å‘¨æœŸæ€§å¯åŠ¨ï¼ˆé»˜è®¤ 1ç§’ï¼‰ã€‚</li>
<li>å®ƒå‘ç°æœ¬åœ° <code>current_offset = 101</code>ã€‚</li>
<li>å®ƒå‘ Broker å‘é€è¯·æ±‚ï¼š<code>GroupCommit(Topic, Partition0, Offset=102)</code> ï¼ˆæ„ä¸ºä¸‹æ¬¡ä» 102 å¼€å§‹ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>ç»“æœ (åæœ)</strong>:</p>
<ul>
<li>Broker æ›´æ–°å…ƒæ•°æ®ï¼šè¯¥ç»„æ¶ˆè´¹è¿›åº¦ = 102ã€‚</li>
<li><strong>Offset 100 å½»åº•ä¸¢å¤±</strong>ã€‚ä¸‹æ¬¡é‡å¯ã€Rebalanceï¼Œéƒ½ä¼šä» 102 å¼€å§‹ã€‚</li>
</ul>
</li>
</ol>
<h4 data-id="heading-4">3. Kafka å¦‚ä½•æ•‘èµï¼Ÿï¼ˆåªèƒ½é å¼€å‘è€…ç¡¬å†™ï¼‰</h4>
<p>å¦‚æœä½ ä¸èƒ½ä¸¢æ¶ˆæ¯ï¼Œåœ¨ Kafka é‡Œä½ <strong>å¿…é¡»</strong>åœ¨ä»£ç å±‚é¢é˜»å¡ï¼š</p>
<ul>
<li><strong>æ­»å¾ªç¯é‡è¯•</strong>ï¼šåœ¨å¤„ç† 100 å¤±è´¥æ—¶ï¼Œ<code>while(true)</code> ä¸€ç›´é‡è¯•ã€‚è¿™ä¼šå¯¼è‡´ 101 å³ä½¿å·²ç»åˆ°äº†å†…å­˜ï¼Œä¹Ÿæ— æ³•è¢«å¤„ç†ï¼ˆHead-of-line blockingï¼Œé˜Ÿå¤´é˜»å¡ï¼‰ã€‚</li>
<li><strong>æ‰‹åŠ¨æ­»ä¿¡é˜Ÿåˆ—</strong>ï¼šè‡ªå·±å†™ä»£ç æŠŠ 100 å‘é€åˆ° <code>Topic_DLQ</code>ï¼Œç„¶åæ ‡è®° 100 æˆåŠŸï¼Œç»§ç»­å¤„ç† 101ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-5">äºŒã€RocketMQï¼šæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆThe Queueï¼‰</h3>
<p>RocketMQï¼ˆæ™®é€š/å¹¶å‘æ¨¡å¼ï¼‰çš„è®¾è®¡å“²å­¦æ˜¯ <strong>â€œä¸šåŠ¡æ¶ˆæ¯å¼•æ“â€</strong>ã€‚Broker éå¸¸â€œèªæ˜â€ï¼Œå®ƒçŸ¥é“æ¯ä¸€æ¡æ¶ˆæ¯çš„çŠ¶æ€ï¼Œå¹¶ä¸”å†…ç½®äº†å®šæ—¶å™¨å’Œé‡è¯•é˜Ÿåˆ—ã€‚</p>
<h4 data-id="heading-6">1. æ—¢æœ‰â€œè¿›åº¦â€ï¼Œåˆæœ‰â€œå•æ¡ Ackâ€</h4>
<p>RocketMQ åœ¨ Broker ç«¯ç»´æŠ¤äº†ä¸€ä¸ªé€»è¾‘ä¸Šçš„æ¶ˆè´¹è¿›åº¦ï¼Œä½†å®ƒå…è®¸â€œç©ºæ´â€ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œå®ƒå¼•å…¥äº† <strong>â€œæœåŠ¡ç«¯é‡è¯•â€</strong> æœºåˆ¶ã€‚</p>
<h4 data-id="heading-7">2. è¯¦ç»†æ‰§è¡Œæµç¨‹ï¼ˆOffset 100 å¤±è´¥ï¼Œ101 æˆåŠŸï¼‰</h4>
<ol>
<li>
<p><strong>æ‹‰å– (Pull)</strong>:</p>
<ul>
<li>Consumer æ‹‰å–æ¶ˆæ¯ <code>100, 101</code>ã€‚</li>
</ul>
</li>
<li>
<p><strong>å¤„ç† Offset 100 (å¤±è´¥)</strong>:</p>
<ul>
<li>Consumer æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼ŒæŠ¥é”™ã€‚</li>
<li><em>ä»£ç åŠ¨ä½œ</em>ï¼šConsumer è¿”å› <code>ConsumeConcurrentlyStatus.RECONSUME_LATER</code>ã€‚</li>
<li><strong>å¹•åé»‘ç§‘æŠ€ (ACK é˜¶æ®µ)</strong>ï¼š
<ul>
<li>Consumer å®¢æˆ·ç«¯è‡ªåŠ¨æŠŠè¿™æ¡æ¶ˆæ¯ 100 <strong>å‘å›ç»™ Broker</strong>ã€‚</li>
<li>Broker æ”¶åˆ°åï¼ŒæŠŠæ¶ˆæ¯ 100 å­˜å…¥ä¸€ä¸ªç‰¹æ®Šçš„ Topicï¼š<code>%RETRY%ConsumerGroup</code>ã€‚</li>
<li>åŸé˜Ÿåˆ—ï¼ˆOrderTopicï¼‰çš„è¿›åº¦ï¼Œæ­¤æ—¶å®é™…ä¸Šå·²ç»å‘å‰æ¨è¿›äº†ã€‚</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>å¤„ç† Offset 101 (æˆåŠŸ)</strong>:</p>
<ul>
<li>Consumer æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼ŒæˆåŠŸã€‚</li>
<li><em>ä»£ç åŠ¨ä½œ</em>ï¼šConsumer è¿”å› <code>ConsumeConcurrentlyStatus.CONSUME_SUCCESS</code>ã€‚</li>
<li>Broker æ”¶åˆ° ACKï¼Œç¡®è®¤ 101 å®Œæˆã€‚</li>
</ul>
</li>
<li>
<p><strong>é‡è¯•è°ƒåº¦ (The Magic)</strong>:</p>
<ul>
<li>é‚£æ¡è¢«æ‰”è¿› <code>%RETRY%</code> çš„ 100 å·æ¶ˆæ¯ï¼ŒBroker ä¼šæ ¹æ®é‡è¯•æ¬¡æ•°è®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨ï¼ˆä¾‹å¦‚ level 1 = 10ç§’ï¼‰ã€‚</li>
<li><strong>10ç§’å</strong>ï¼šBroker æŠŠè¿™æ¡æ¶ˆæ¯å†æ¬¡æŠ•é€’ç»™ Consumerã€‚</li>
<li>Consumer å†æ¬¡æ”¶åˆ°æ¶ˆæ¯ï¼ˆMessageID ä¸å˜ï¼‰ï¼Œæ­¤æ—¶å¯ä»¥å†æ¬¡å°è¯•å¤„ç†ã€‚</li>
</ul>
</li>
<li>
<p><strong>ç»“æœ</strong>:</p>
<ul>
<li><strong>101 å…ˆå¤„ç†å®Œ</strong>ã€‚</li>
<li><strong>100 ç¨åå¤„ç†</strong>ã€‚</li>
<li><strong>æ²¡æœ‰ä¸¢æ¶ˆæ¯</strong>ï¼Œä½†æ˜¯<strong>æ¶ˆæ¯ä¹±åºäº†</strong>ã€‚</li>
</ul>
</li>
</ol>
<hr/>
<h3 data-id="heading-8">ä¸‰ã€æ·±åº¦å¯¹æ¯”æ€»ç»“è¡¨</h3>
<p>è¿™ä¸ªè¡¨æ ¼å±•ç¤ºäº†ä¸¤è€…æœ€æœ¬è´¨çš„åŒºåˆ«ï¼š</p>













































<table><thead><tr><th align="left">ç‰¹æ€§</th><th align="left">Kafka</th><th align="left">RocketMQ (å¹¶å‘æ¨¡å¼)</th></tr></thead><tbody><tr><td align="left"><strong>æ•°æ®æ¨¡å‹</strong></td><td align="left"><strong>æµ (Stream)</strong> <br/> åƒå½•åƒå¸¦ï¼Œè¿ç»­è¯»å–ã€‚</td><td align="left"><strong>é˜Ÿåˆ— (Queue)</strong> <br/> åƒä»»åŠ¡åˆ—è¡¨ï¼Œå•æ®ç‹¬ç«‹å¤„ç†ã€‚</td></tr><tr><td align="left"><strong>Offset æäº¤ç²’åº¦</strong></td><td align="left"><strong>ç´¯è®¡ä½ç‚¹ (Cumulative)</strong> <br/> æäº¤ Nï¼Œä»£è¡¨ N ä¹‹å‰å…¨å®Œäº†ã€‚</td><td align="left"><strong>å•æ¡ ACK (Individual)</strong> <br/> è™½ç„¶ä¹Ÿç»´æŠ¤ Offsetï¼Œä½†é…åˆé‡è¯•é˜Ÿåˆ—å®ç°äº†å•æ¡ç®¡ç†çš„é”™è§‰ã€‚</td></tr><tr><td align="left"><strong>ä¸­é—´æ¶ˆæ¯å¤±è´¥ (100å¤±è´¥)</strong></td><td align="left"><strong>é˜»å¡æˆ–è·³è¿‡</strong> <br/> è¦ä¹ˆæ­»å¾ªç¯å¡ä½å…¨éƒ¨åˆ†åŒºï¼Œè¦ä¹ˆæ ‡è®°å·²æ¶ˆè´¹ç›´æ¥ä¸¢å¼ƒã€‚</td><td align="left"><strong>æœåŠ¡ç«¯æš‚å­˜ (Re-queue)</strong> <br/> å¤±è´¥çš„æ¶ˆæ¯è¢«â€œè¸¢â€å‡ºåŸé˜Ÿåˆ—ï¼Œæ”¾å…¥é‡è¯•é˜Ÿåˆ—ï¼Œåç»­æ¶ˆæ¯ç»§ç»­è·‘ã€‚</td></tr><tr><td align="left"><strong>å¯¹ Offset 101 çš„å½±å“</strong></td><td align="left">å¦‚æœ 100 å¡ä½ï¼Œ101 æ°¸è¿œè½®ä¸åˆ°å¤„ç†ï¼ˆé˜Ÿå¤´é˜»å¡ï¼‰ã€‚</td><td align="left">101 å¯ä»¥å…ˆå¤„ç†æˆåŠŸï¼Œå®Œå…¨ä¸å— 100 å½±å“ã€‚</td></tr><tr><td align="left"><strong>é¡ºåºæ€§</strong></td><td align="left"><strong>ä¸¥æ ¼æœ‰åº</strong> <br/> åªè¦åˆ†åŒºä¸å˜ï¼Œå¤„ç†é¡ºåºæ°¸è¿œæ˜¯ 100 -&gt; 101ã€‚</td><td align="left"><strong>ä¹±åº</strong> <br/> æœ€ç»ˆæ‰§è¡Œé¡ºåºå¯èƒ½æ˜¯ 101 -&gt; 100(é‡è¯•)ã€‚</td></tr><tr><td align="left"><strong>é‡è¯•æˆæœ¬</strong></td><td align="left"><strong>é«˜</strong> <br/> éœ€å®¢æˆ·ç«¯è‡ªç ”ï¼ˆæ­»å¾ªç¯ã€DBè®°å½•ã€Redisè®°å½•ï¼‰ã€‚</td><td align="left"><strong>ä½</strong> <br/> æ¡†æ¶è‡ªå¸¦ï¼Œæ”¹ä¸ªè¿”å›å€¼å³å¯ã€‚</td></tr><tr><td align="left"><strong>é€‚ç”¨åœºæ™¯</strong></td><td align="left">æ—¥å¿—ã€åŸ‹ç‚¹ã€æµè®¡ç®—ã€CDC (Change Data Capture)ã€‚</td><td align="left">äº¤æ˜“ã€è®¢å•ã€æ‰£æ¬¾ã€é€šçŸ¥ç­‰æ ¸å¿ƒä¸šåŠ¡ã€‚</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-9">å››ã€ç›´è§‚å›¾è§£</h3>
<h4 data-id="heading-10">Kafka åœºæ™¯ (Offset 100 å¤±è´¥)</h4>
<pre><code class="hljs language-text" lang="text">[Broker Log]  :  ... [99] [100] [101] [102] ...
                         ^     ^
[Consumer]    :    å¤„ç†å¤±è´¥   å¤„ç†æˆåŠŸ
                         |     |
[Action]      :   (Skip?)  Mark(101)
                         |     |
[Commit]      :          V     V
[Broker Offset]:  Updated to 102 (100 is GONE)
</code></pre>
<h4 data-id="heading-11">RocketMQ åœºæ™¯ (Offset 100 å¤±è´¥)</h4>
<pre><code class="hljs language-text" lang="text">[Broker Queue]:  ... [99] [100] [101] [102] ...
                         |     |
[Consumer]    :   Ret_Later  Ret_Success
                         |     |
[Internal Op] :   Send back    |
                  to RetryQ    |
                         |     |
[Broker State]:  Offset moves past 101
                 [RetryQueue]: [100 (Delay 10s)]
                         .
                         . (10s later)
                         .
[Consumer]    :  Recieve [100] again -&gt; Process
</code></pre>
<h3 data-id="heading-12">äº”ã€ç»“è®ºä¸å»ºè®®</h3>
<ul>
<li><strong>ç»“è®º</strong>ï¼šä½ ç”¨ Sarama (Kafka) å†™ä»£ç æ—¶ï¼Œåƒä¸‡ä¸èƒ½å¸¦ç€ RocketMQ çš„æ€ç»´ã€‚åœ¨ Kafka é‡Œï¼Œ<strong>â€œæäº¤ Offsetâ€æ˜¯ä¸€ä¸ªä¸å¯é€†çš„â€œæ‰¹é‡ç¡®è®¤â€æ“ä½œ</strong>ã€‚</li>
<li><strong>é’ˆå¯¹ä½ å½“å‰ä»£ç çš„å»ºè®®</strong>ï¼š
ç”±äº Kafka åŸç”Ÿä¸æ”¯æŒâ€œå•æ¡å¤±è´¥é‡è¯•â€ï¼Œä¸ºäº†æ•°æ®ä¸ä¸¢ï¼Œä½ é€šå¸¸åªæœ‰ä¸¤ä¸ªé€‰æ‹©ï¼š
<ol>
<li><strong>å¼ºä¸€è‡´æ€§ï¼ˆä¸èƒ½ä¸¢ï¼Œä¸èƒ½ä¹±ï¼‰</strong>ï¼šåœ¨ <code>ConsumeClaim</code> é‡Œé‡åˆ°é”™è¯¯ä½¿ç”¨ <code>retry</code> åº“è¿›è¡ŒæŒ‡æ•°é€€é¿é‡è¯•ï¼ˆBackoff Retryï¼‰ï¼Œä¸€ç›´é‡è¯•ç›´åˆ°æˆåŠŸã€‚è¿™ä¼šé˜»å¡è¯¥åˆ†åŒºåç»­æ¶ˆæ¯çš„æ¶ˆè´¹ã€‚</li>
<li><strong>æœ€ç»ˆä¸€è‡´æ€§ï¼ˆä¸èƒ½ä¸¢ï¼Œå…è®¸ä¹±ï¼‰</strong>ï¼šé‡åˆ°é”™è¯¯ï¼ŒæŠŠæ¶ˆæ¯<strong>æ‰‹åŠ¨</strong>ç”Ÿäº§åˆ°å¦ä¸€ä¸ª Topicï¼ˆå¦‚ <code>topic_retry</code>ï¼‰ï¼Œç„¶åå¯¹å½“å‰æ¶ˆæ¯ <code>MarkMessage</code>ã€‚ä½ è‡ªå·±è¿˜éœ€è¦å†™ä¸€ä¸ª Consumer å»æ¶ˆè´¹ <code>topic_retry</code>ã€‚è¿™å…¶å®å°±æ˜¯äººå·¥å®ç°äº† RocketMQ çš„åŠŸèƒ½ã€‚</li>
</ol>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é«˜é˜¶å‡½æ•°ä¸æ³›å‹å‡½æ•°çš„ç±»å‹ä½“æ“]]></title>    <link>https://juejin.cn/post/7598477092196778022</link>    <guid>https://juejin.cn/post/7598477092196778022</guid>    <pubDate>2026-01-24T06:57:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598477092196778022" data-draft-id="7598499504170582054" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é«˜é˜¶å‡½æ•°ä¸æ³›å‹å‡½æ•°çš„ç±»å‹ä½“æ“"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,TypeScript"/> <meta itemprop="datePublished" content="2026-01-24T06:57:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="wuhen_n"/> <meta itemprop="url" content="https://juejin.cn/user/4149996261738233"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é«˜é˜¶å‡½æ•°ä¸æ³›å‹å‡½æ•°çš„ç±»å‹ä½“æ“
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4149996261738233/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    wuhen_n
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T06:57:33.000Z" title="Sat Jan 24 2026 06:57:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>é«˜é˜¶å‡½æ•°å’Œæ³›å‹æ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„æ ¸å¿ƒï¼Œä¹Ÿæ˜¯ TypeScript ç±»å‹ç³»ç»Ÿæœ€å¼ºå¤§çš„éƒ¨åˆ†ã€‚æŒæ¡è¿™éƒ¨åˆ†å†…å®¹ä»¥åï¼Œæˆ‘ä»¬ä¼šå‘ç° TypeScript ä¸ä»…èƒ½æ£€æŸ¥ç±»å‹ï¼Œè¿˜èƒ½æ¨å¯¼ç±»å‹ã€ç»„åˆç±»å‹ï¼Œç”šè‡³è¿›è¡Œç±»å‹è¿ç®—ã€‚</p>
</blockquote>
<h2 data-id="heading-0">æ³›å‹å‚æ•°çº¦æŸï¼šç»™ç±»å‹å‚æ•°åŠ "é™åˆ¶æ¡ä»¶"</h2>
<h3 data-id="heading-1">åŸºç¡€æ³›å‹çº¦æŸï¼šç¡®ä¿ç±»å‹å…·æœ‰æŸäº›ç‰¹æ€§</h3>
<p>æ³›å‹çº¦æŸå°±åƒç»™ç±»å‹å‚æ•°åŠ ä¸Š"é™åˆ¶æ¡ä»¶"ï¼Œå‘Šè¯‰TypeScriptï¼š"è¿™ä¸ªç±»å‹å‚æ•° <code>T</code>ï¼Œå¿…é¡»æ»¡è¶³æŸäº›æ¡ä»¶"ã€‚è¿™æ ·æˆ‘ä»¬å°±èƒ½åœ¨å‡½æ•°ä½“å†…å®‰å…¨åœ°ä½¿ç”¨ <code>T</code> çš„ç‰¹å®šå±æ€§ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// åŸºç¡€çº¦æŸï¼šTå¿…é¡»å…·æœ‰lengthå±æ€§</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">HasLength</span> {
  <span class="hljs-attr">length</span>: <span class="hljs-built_in">number</span>;  <span class="hljs-comment">// å®šä¹‰äº†ä¸€ä¸ªæ¥å£ï¼Œè¦æ±‚æœ‰lengthå±æ€§</span>
}

<span class="hljs-comment">// T extends HasLength è¡¨ç¤ºï¼šTå¿…é¡»æœ‰lengthå±æ€§</span>
<span class="hljs-keyword">function</span> logLength&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HasLength</span>&gt;(<span class="hljs-attr">item</span>: T): <span class="hljs-built_in">void</span> {
  <span class="hljs-comment">// å› ä¸ºTä¸€å®šæœ‰lengthï¼Œæ‰€ä»¥å¯ä»¥å®‰å…¨è®¿é—®</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`é•¿åº¦: <span class="hljs-subst">${item.length}</span>`</span>);
}

<span class="hljs-comment">// âœ… æ­£ç¡®ä½¿ç”¨</span>
<span class="hljs-title function_">logLength</span>(<span class="hljs-string">"hello"</span>);       <span class="hljs-comment">// stringæœ‰lengthå±æ€§</span>
<span class="hljs-title function_">logLength</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]);     <span class="hljs-comment">// æ•°ç»„æœ‰lengthå±æ€§</span>
<span class="hljs-title function_">logLength</span>({ <span class="hljs-attr">length</span>: <span class="hljs-number">5</span> }); <span class="hljs-comment">// å¯¹è±¡æœ‰lengthå±æ€§</span>

<span class="hljs-comment">// âŒ é”™è¯¯ä½¿ç”¨</span>
<span class="hljs-comment">// logLength(42);           // numberæ²¡æœ‰lengthå±æ€§ - ç¼–è¯‘é”™è¯¯ï¼</span>
<span class="hljs-comment">// logLength(true);         // booleanæ²¡æœ‰lengthå±æ€§ - ç¼–è¯‘é”™è¯¯ï¼</span>
</code></pre>
<h3 data-id="heading-2">å¤šä¸ªçº¦æŸï¼šå¿…é¡»åŒæ—¶æ»¡è¶³å¤šä¸ªæ¡ä»¶</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">HasId</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">HasName</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
}

<span class="hljs-comment">// T extends HasId &amp; HasName è¡¨ç¤ºï¼šTå¿…é¡»åŒæ—¶æ»¡è¶³HasIdå’ŒHasNameçš„è¦æ±‚</span>
<span class="hljs-keyword">function</span> processItem&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HasId</span> &amp; <span class="hljs-title class_">HasName</span>&gt;(<span class="hljs-attr">item</span>: T): <span class="hljs-built_in">string</span> {
  <span class="hljs-comment">// è¿™é‡Œå¯ä»¥å®‰å…¨è®¿é—®idå’Œname</span>
  <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${item.id}</span>: <span class="hljs-subst">${item.name}</span>`</span>;
}

<span class="hljs-comment">// âœ… å¿…é¡»åŒæ—¶æœ‰idå’Œname</span>
<span class="hljs-title function_">processItem</span>({ <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">"zhangsan"</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> }); <span class="hljs-comment">// âœ… æœ‰idå’Œnameï¼Œageé¢å¤–å±æ€§ä¸å½±å“</span>
<span class="hljs-comment">// processItem({ id: 1 }); // âŒ ç¼ºå°‘name - ç¼–è¯‘é”™è¯¯ï¼</span>
<span class="hljs-comment">// processItem({ name: "lisi" }); // âŒ ç¼ºå°‘id - ç¼–è¯‘é”™è¯¯ï¼</span>
</code></pre>
<blockquote>
<p>æ³¨ï¼šçº¦æŸåªåœ¨ç¼–è¯‘æ—¶æ£€æŸ¥ï¼Œä»¥ç¡®ä¿ç±»å‹å®‰å…¨ã€‚</p>
</blockquote>
<h3 data-id="heading-3">keyofï¼šæ›´ç²¾ç¡®çš„çº¦æŸ</h3>
<p><code>keyof T</code> å¯ä»¥è·å–ç±»å‹Tçš„æ‰€æœ‰é”®ï¼ˆå±æ€§åï¼‰çš„è”åˆç±»å‹ï¼Œæ¯”å¦‚ï¼š<code>keyof {name: string, age: number}</code>å°±æ˜¯ <code>name: string | age: number</code> ï¼Œè¿™æ ·å¯ä»¥å®ç°å®Œå…¨ç±»å‹å®‰å…¨çš„å±æ€§è®¿é—®ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> getProperty&lt;T, K <span class="hljs-keyword">extends</span> keyof T&gt;(<span class="hljs-attr">obj</span>: T, <span class="hljs-attr">key</span>: K): T[K] {
  <span class="hljs-comment">// K extends keyof T è¡¨ç¤ºï¼šKå¿…é¡»æ˜¯Tçš„é”®ä¹‹ä¸€</span>
  <span class="hljs-keyword">return</span> obj[key];
}

<span class="hljs-keyword">const</span> person = { <span class="hljs-attr">name</span>: <span class="hljs-string">"zhangsan"</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span>, <span class="hljs-attr">email</span>: <span class="hljs-string">"zhangsan@example.com"</span> };

<span class="hljs-comment">// âœ… æ­£ç¡®ï¼šè®¿é—®å­˜åœ¨çš„å±æ€§</span>
<span class="hljs-title function_">getProperty</span>(person, <span class="hljs-string">"name"</span>);  <span class="hljs-comment">// è¿”å›stringç±»å‹</span>
<span class="hljs-title function_">getProperty</span>(person, <span class="hljs-string">"age"</span>);   <span class="hljs-comment">// è¿”å›numberç±»å‹</span>

<span class="hljs-comment">// âŒ é”™è¯¯ï¼šè®¿é—®ä¸å­˜åœ¨çš„å±æ€§</span>
<span class="hljs-comment">// getProperty(person, "address"); // ç¼–è¯‘é”™è¯¯ï¼šaddressä¸æ˜¯personçš„é”®</span>
</code></pre>
<h3 data-id="heading-4">æ¡ä»¶ç±»å‹çº¦æŸ</h3>
<p>æ¡ä»¶ç±»å‹ç±»ä¼¼äºä¸‰å…ƒè¡¨è¾¾å¼ï¼Œåªæ˜¯é€‚ç”¨äºç±»å‹ï¼š<code>T extends U ? X : Y</code> ã€‚å¦‚æœTå¯ä»¥èµ‹å€¼ç»™Uï¼Œåˆ™ç±»å‹ä¸ºXï¼Œå¦åˆ™ä¸ºYã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">ExtractStringKeys</span>&lt;T&gt; = {
  [K <span class="hljs-keyword">in</span> keyof T]: T[K] <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span> ? K : <span class="hljs-built_in">never</span>;
}[keyof T];
</code></pre>
<h2 data-id="heading-5">å‡½æ•°ä½œä¸ºå‚æ•°çš„ç±»å‹æ¨å¯¼</h2>
<h3 data-id="heading-6">å‡½æ•°å‚æ•°çš„ç±»å‹æ¨å¯¼æœºåˆ¶</h3>
<p>åœ¨ TypeScript ä¸­ï¼Œå½“æŠŠä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ä¼ ç»™å¦ä¸€ä¸ªå‡½æ•°æ—¶ï¼ŒTypeScript ä¼šæ ¹æ®ä¸Šä¸‹æ–‡è‡ªåŠ¨æ¨å¯¼å‚æ•°ç±»å‹ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> mapArray&lt;T, U&gt;(
  <span class="hljs-attr">array</span>: T[],  <span class="hljs-comment">// ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯Tç±»å‹çš„æ•°ç»„</span>
  <span class="hljs-attr">callback</span>: <span class="hljs-function">(<span class="hljs-params">item: T, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> U  <span class="hljs-comment">// ç¬¬äºŒä¸ªå‚æ•°æ˜¯å›è°ƒå‡½æ•°</span>
): U[] {  <span class="hljs-comment">// è¿”å›Uç±»å‹çš„æ•°ç»„</span>
  <span class="hljs-keyword">return</span> array.<span class="hljs-title function_">map</span>(callback);
}

<span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
<span class="hljs-keyword">const</span> strings = <span class="hljs-title function_">mapArray</span>(numbers, <span class="hljs-function">(<span class="hljs-params">n, i</span>) =&gt;</span> {
  <span class="hljs-comment">// nè‡ªåŠ¨æ¨å¯¼ä¸ºnumberï¼Œiè‡ªåŠ¨æ¨å¯¼ä¸ºnumber</span>
  <span class="hljs-keyword">return</span> <span class="hljs-string">`æ•°å­—<span class="hljs-subst">${n}</span>åœ¨ä½ç½®<span class="hljs-subst">${i}</span>`</span>;
});
</code></pre>
<p>ä¸Šè¿°ä»£ç ä¸­ï¼ŒTypeScript çš„æ¨å¯¼è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>çœ‹åˆ° <code>numbers</code> æ˜¯ <code>number[]</code>ï¼Œæ‰€ä»¥æ¨å¯¼å‡º <code>T = number</code>ã€‚</li>
<li>åœ¨å›è°ƒå‡½æ•°ä¸­ï¼Œ<code>n</code> è‡ªåŠ¨æ¨å¯¼ä¸º <code>number</code>ï¼Œ<code>i</code> è‡ªåŠ¨æ¨å¯¼ä¸º <code>number</code> ã€‚</li>
<li>å›è°ƒå‡½æ•°çš„è¿”å›å€¼ç±»å‹æ˜¯ <code>string</code>ï¼Œæ‰€ä»¥æ¨å¯¼å‡º <code>U = string</code></li>
<li>å› æ­¤ï¼Œæ•´ä¸ªå‡½æ•°è¿”å›å€¼ç±»å‹æ˜¯ <code>string[]</code> ã€‚</li>
</ol>
<blockquote>
<p>TypeScriptå¯ä»¥æ ¹æ®ä¸Šä¸‹æ–‡è‡ªåŠ¨æ¨å¯¼ç±»å‹ï¼Œæ¨å¯¼è¿‡ç¨‹æ˜¯åŒå‘çš„ï¼šæ—¢å¯ä»¥ä»å·¦åˆ°å³æ¨å¯¼ï¼Œä¹Ÿå¯ä»¥ä»å³åˆ°å·¦æ¨å¯¼ã€‚å…·ä½“çš„æ³›å‹å‚æ•° <code>T</code> å’Œ <code>U</code> ä¼šåœ¨è°ƒç”¨æ—¶è¢«å…·ä½“åŒ–ã€‚</p>
</blockquote>
<h3 data-id="heading-7">é«˜é˜¶å‡½æ•°çš„ç±»å‹å‚æ•°æ¨æ–­</h3>
<p>æœ¬èŠ‚å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆè¦æ˜ç™½é«˜é˜¶å‡½æ•°æ˜¯ä»€ä¹ˆï¼Ÿé«˜é˜¶å‡½æ•°æœ¬è´¨å°±æ˜¯æ¥å— <strong>å‡½æ•°</strong> ä½œä¸º <strong>å‚æ•°</strong>ï¼Œæˆ– <strong>è¿”å›å‡½æ•°</strong> ä½œä¸º <strong>ç»“æœ</strong> çš„å‡½æ•°ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> compose&lt;A, B, C&gt;(
  <span class="hljs-attr">f</span>: <span class="hljs-function">(<span class="hljs-params">b: B</span>) =&gt;</span> C,      <span class="hljs-comment">// æ¥å—Bè¿”å›Cçš„å‡½æ•°</span>
  <span class="hljs-attr">g</span>: <span class="hljs-function">(<span class="hljs-params">a: A</span>) =&gt;</span> B       <span class="hljs-comment">// æ¥å—Aè¿”å›Bçš„å‡½æ•°</span>
): <span class="hljs-function">(<span class="hljs-params">a: A</span>) =&gt;</span> C {       <span class="hljs-comment">// è¿”å›æ¥å—Aè¿”å›Cçš„å‡½æ•°</span>
  <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">a: A</span>) =&gt;</span> <span class="hljs-title function_">f</span>(<span class="hljs-title function_">g</span>(a));
}

<span class="hljs-comment">// ä½¿ç”¨ï¼šTypeScriptè‡ªåŠ¨æ¨å¯¼æ‰€æœ‰ç±»å‹</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">addOne</span> = (<span class="hljs-params">x: <span class="hljs-built_in">number</span></span>) =&gt; x + <span class="hljs-number">1</span>;      <span class="hljs-comment">// number =&gt; number</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">toString</span> = (<span class="hljs-params">x: <span class="hljs-built_in">number</span></span>) =&gt; x.<span class="hljs-title function_">toString</span>(); <span class="hljs-comment">// number =&gt; string</span>

<span class="hljs-keyword">const</span> addOneThenToString = <span class="hljs-title function_">compose</span>(toString, addOne);
<span class="hljs-comment">// addOneThenToStringç±»å‹: (x: number) =&gt; string</span>

<span class="hljs-keyword">const</span> result = <span class="hljs-title function_">addOneThenToString</span>(<span class="hljs-number">5</span>); <span class="hljs-comment">// "6"</span>
</code></pre>
<p>ä¸Šè¿°ä»£ç ä¸­ï¼ŒTypeScript çš„æ¨å¯¼è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li><code>const toString = (x: number) =&gt; x.toString();</code> æ¥æ”¶ <code>number</code> ç±»å‹ï¼Œå¹¶è¿”å› <code>string</code> ç±»å‹ï¼Œæ‰€ä»¥ <code>compose()</code>  å‡½æ•°ä¸­ <code>f: (b: B) =&gt; C</code>ï¼š<code>B</code> ä¸º <code>number</code>ï¼Œ<code>C</code> ä¸º <code>string</code> ã€‚</li>
<li><code>const addOne = (x: number) =&gt; x + 1;</code>  æ¥æ”¶ <code>number</code> ç±»å‹ï¼Œå¹¶è¿”å› <code>number</code> ç±»å‹ï¼Œæ‰€ä»¥ <code>compose()</code>  å‡½æ•°ä¸­ <code>g: (a: A) =&gt; B </code>ï¼š<code>A</code> ä¸º <code>number</code>ï¼Œ<code>B</code> ä¸º <code>number</code> ã€‚</li>
<li>æ‰€ä»¥æœ€ç»ˆçš„æ¨å¯¼ç»“æœä¸ºï¼š<code>A = number, B = number, C = string</code> ã€‚</li>
</ol>
<h2 data-id="heading-8">æŸ¯é‡ŒåŒ–å‡½æ•°çš„ç±»å‹å®šä¹‰</h2>
<h3 data-id="heading-9">ä»€ä¹ˆæ˜¯æŸ¯é‡ŒåŒ–å‡½æ•°</h3>
<p><strong>æŸ¯é‡ŒåŒ–ï¼ˆCurryingï¼‰å‡½æ•°</strong> å…¶å®å°±æ˜¯æŠŠæ¥å—å¤šä¸ªå‚æ•°çš„å‡½æ•°å˜æˆæ¥å—ä¸€ä¸ªå•ä¸€å‚æ•°ï¼ˆæœ€åˆå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼‰çš„å‡½æ•°ï¼Œå¹¶ä¸”è¿”å›æ¥å—ä½™ä¸‹çš„å‚æ•°ä¸”è¿”å›ç»“æœçš„æ–°å‡½æ•°çš„æŠ€æœ¯ã€‚ç®€å•æ¥è¯´å°±æ˜¯æŠŠ <code>f(a, b, c)</code>  å˜æˆ <code>f(a)(b)(c)</code> çš„å‡½æ•°ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Curried</span>&lt;A, B, R&gt; = <span class="hljs-function">(<span class="hljs-params">a: A</span>) =&gt;</span> <span class="hljs-function">(<span class="hljs-params">b: B</span>) =&gt;</span> R;

<span class="hljs-keyword">function</span> curry&lt;A, B, R&gt;(<span class="hljs-attr">fn</span>: <span class="hljs-function">(<span class="hljs-params">a: A, b: B</span>) =&gt;</span> R): <span class="hljs-title class_">Currie2</span>&lt;A, B, R&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">a: A</span>) =&gt;</span> <span class="hljs-function">(<span class="hljs-params">b: B</span>) =&gt;</span> <span class="hljs-title function_">fn</span>(a, b);
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">add</span> = (<span class="hljs-params">x: <span class="hljs-built_in">number</span>, y: <span class="hljs-built_in">number</span></span>) =&gt; x + y;
<span class="hljs-keyword">const</span> curriedAdd = <span class="hljs-title function_">curry</span>(add);

<span class="hljs-comment">// åˆ†æ­¥è°ƒç”¨</span>
<span class="hljs-keyword">const</span> add5 = <span class="hljs-title function_">curriedAdd</span>(<span class="hljs-number">5</span>);   <span class="hljs-comment">// è¿”å›æ–°å‡½æ•°ï¼šæ¥å—ä¸€ä¸ªæ•°ï¼ŒåŠ ä¸Š5</span>
<span class="hljs-keyword">const</span> result = <span class="hljs-title function_">add5</span>(<span class="hljs-number">3</span>);       <span class="hljs-comment">// 8</span>

<span class="hljs-comment">// ä¹Ÿå¯ä»¥è¿ç»­è°ƒç”¨</span>
<span class="hljs-keyword">const</span> result2 = <span class="hljs-title function_">curriedAdd</span>(<span class="hljs-number">5</span>)(<span class="hljs-number">3</span>); <span class="hljs-comment">// 8</span>
</code></pre>
<h3 data-id="heading-10">è‡ªåŠ¨æŸ¯é‡ŒåŒ–ï¼šå¤„ç†ä»»æ„æ•°é‡å‚æ•°</h3>
<p>åœ¨ TypeScript ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨é€’å½’ç±»å‹å¤„ç†ä»»æ„æ•°é‡çš„å‚æ•°ï¼šåˆ¤æ–­å½¢å‚ Args æ˜¯å¦å¯ä»¥è¿›è¡Œåˆ†è§£ï¼Œåˆ†è§£ä¸ºç¬¬ä¸€ä¸ªå‚æ•° First å’Œ å‰©ä½™å‚æ•° Restã€‚å¦‚æœå¯ä»¥ï¼Œåˆ™ç»§ç»­é‡‡ç”¨é€’å½’çš„æ–¹å¼ï¼Œå¯¹å‰©ä½™å‚æ•° Rest è¿›ä¸€æ­¥åˆ†è§£ï¼Œç›´è‡³æ— æ³•åˆ†è§£ï¼Œå³åªå‰©ä¸‹ä¸€ä¸ªå‚æ•°ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Curried</span>&lt;<span class="hljs-title class_">Args</span> <span class="hljs-keyword">extends</span> <span class="hljs-built_in">any</span>[], R&gt; = 
  <span class="hljs-title class_">Args</span> <span class="hljs-keyword">extends</span> [infer <span class="hljs-title class_">First</span>, ...infer <span class="hljs-title class_">Rest</span>]
    ? <span class="hljs-function">(<span class="hljs-params">arg: First</span>) =&gt;</span> <span class="hljs-title class_">Curried</span>&lt;<span class="hljs-title class_">Rest</span>, R&gt;  <span class="hljs-comment">// è¿”å›æ¥å—Firstçš„å‡½æ•°ï¼Œç»§ç»­å¤„ç†Rest</span>
    : R;  <span class="hljs-comment">// æ²¡æœ‰å‚æ•°äº†ï¼Œç›´æ¥è¿”å›ç»“æœ</span>
</code></pre>
<p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªç®€å•çš„ä»£ç å®ä¾‹ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> curry&lt;<span class="hljs-title class_">Args</span> <span class="hljs-keyword">extends</span> <span class="hljs-built_in">any</span>[], R&gt;(
  <span class="hljs-attr">fn</span>: <span class="hljs-function">(<span class="hljs-params">...args: Args</span>) =&gt;</span> R
): <span class="hljs-title class_">Curried</span>&lt;<span class="hljs-title class_">Args</span>, R&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">curried</span>(<span class="hljs-params">...args: <span class="hljs-built_in">any</span>[]</span>): <span class="hljs-built_in">any</span> {
    <span class="hljs-comment">// å¦‚æœå‚æ•°æ•°é‡å¤Ÿäº†ï¼Œå°±è°ƒç”¨åŸå‡½æ•°</span>
    <span class="hljs-keyword">if</span> (args.<span class="hljs-property">length</span> &gt;= fn.<span class="hljs-property">length</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">fn</span>(...args <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>);
    }
    <span class="hljs-comment">// å¦åˆ™è¿”å›æ–°å‡½æ•°ï¼Œç»§ç»­æ”¶é›†å‚æ•°</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">...moreArgs: <span class="hljs-built_in">any</span>[]</span>) =&gt;</span> <span class="hljs-title function_">curried</span>(...args, ...moreArgs);
  } <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>;  <span class="hljs-comment">// ç±»å‹æ–­è¨€ï¼Œå› ä¸ºé€’å½’ç±»å‹æ¯”è¾ƒå¤æ‚</span>
}

<span class="hljs-comment">// ä½¿ç”¨ï¼šå¯ä»¥æŸ¯é‡ŒåŒ–ä»»æ„å‚æ•°çš„å‡½æ•°</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">multiply</span> = (<span class="hljs-params">a: <span class="hljs-built_in">number</span>, b: <span class="hljs-built_in">number</span>, c: <span class="hljs-built_in">number</span></span>) =&gt; a * b * c;
<span class="hljs-keyword">const</span> curriedMultiply = <span class="hljs-title function_">curry</span>(multiply);

<span class="hljs-comment">// å¯ä»¥åˆ†ä»»æ„æ­¥è°ƒç”¨</span>
<span class="hljs-keyword">const</span> multiplyBy2 = <span class="hljs-title function_">curriedMultiply</span>(<span class="hljs-number">2</span>);      <span class="hljs-comment">// è¿”å›ï¼šæ¥å—ä¸¤ä¸ªå‚æ•°çš„å‡½æ•°</span>
<span class="hljs-keyword">const</span> multiplyBy2And3 = <span class="hljs-title function_">multiplyBy2</span>(<span class="hljs-number">3</span>);      <span class="hljs-comment">// è¿”å›ï¼šæ¥å—ä¸€ä¸ªå‚æ•°çš„å‡½æ•°</span>
<span class="hljs-keyword">const</span> finalResult = <span class="hljs-title function_">multiplyBy2And3</span>(<span class="hljs-number">4</span>);      <span class="hljs-comment">// 24</span>

<span class="hljs-comment">// ä¹Ÿå¯ä»¥è¿ç»­è°ƒç”¨</span>
<span class="hljs-keyword">const</span> finalResult2 = <span class="hljs-title function_">curriedMultiply</span>(<span class="hljs-number">2</span>)(<span class="hljs-number">3</span>)(<span class="hljs-number">4</span>); <span class="hljs-comment">// 24</span>
</code></pre>
<h2 data-id="heading-11">å‡½æ•°ç»„åˆçš„ç±»å‹ä½“æ“</h2>
<h3 data-id="heading-12">ç®¡é“ï¼ˆPipeï¼‰æ“ä½œ</h3>
<p>æ‰€è°“ <strong>ç®¡é“</strong>ï¼Œå°±æ˜¯æŠŠå¤šä¸ªå‡½æ•°è¿æ¥èµ·æ¥ï¼Œç”¨å‰ä¸€ä¸ªå‡½æ•°çš„è¾“å‡ºä½œä¸ºåä¸€ä¸ªå‡½æ•°çš„è¾“å…¥ã€‚</p>
<h4 data-id="heading-13">ç®¡é“å®šä¹‰</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> pipe&lt;F <span class="hljs-keyword">extends</span> [<span class="hljs-function">(<span class="hljs-params">...args: <span class="hljs-built_in">any</span>[]</span>) =&gt;</span> <span class="hljs-built_in">any</span>, ...<span class="hljs-title class_">Array</span>&lt;<span class="hljs-function">(<span class="hljs-params">arg: <span class="hljs-built_in">any</span></span>) =&gt;</span> <span class="hljs-built_in">any</span>&gt;]&gt;(
  ...<span class="hljs-attr">functions</span>: F
): <span class="hljs-function">(<span class="hljs-params">...args: Parameters&lt;F[<span class="hljs-number">0</span>]&gt;</span>) =&gt;</span> <span class="hljs-title class_">ReturnType</span>&lt;F[F[<span class="hljs-string">'length'</span>] - <span class="hljs-number">1</span>]&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">...args: Parameters&lt;F[<span class="hljs-number">0</span>]&gt;</span>) =&gt;</span> {
    <span class="hljs-keyword">let</span> result = functions[<span class="hljs-number">0</span>](...args);  <span class="hljs-comment">// æ‰§è¡Œç¬¬ä¸€ä¸ªå‡½æ•°</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt; functions.<span class="hljs-property">length</span>; i++) {
      result = functions[i](result);  <span class="hljs-comment">// ç”¨å‰ä¸€ä¸ªç»“æœè°ƒç”¨ä¸‹ä¸€ä¸ªå‡½æ•°</span>
    }
    <span class="hljs-keyword">return</span> result;
  } <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>;
}
</code></pre>
<p>ä¸Šè¿°ä»£ç ä¸­ï¼Œ<code>F</code>æ˜¯å‡½æ•°æ•°ç»„ï¼Œç¬¬ä¸€ä¸ªå‡½æ•°æ¥å—ä»»æ„å‚æ•°ï¼Œåç»­å‡½æ•°æ¥å—å‰ä¸€ä¸ªå‡½æ•°çš„è¿”å›å€¼ã€‚</p>
<h4 data-id="heading-14">ç®¡é“ä½¿ç”¨</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">add</span> = (<span class="hljs-params">x: <span class="hljs-built_in">number</span></span>) =&gt; x + <span class="hljs-number">1</span>;
<span class="hljs-keyword">const</span> <span class="hljs-title function_">multiply</span> = (<span class="hljs-params">x: <span class="hljs-built_in">number</span></span>) =&gt; x * <span class="hljs-number">2</span>;
<span class="hljs-keyword">const</span> <span class="hljs-title function_">toString</span> = (<span class="hljs-params">x: <span class="hljs-built_in">number</span></span>) =&gt; x.<span class="hljs-title function_">toString</span>();

<span class="hljs-comment">// åˆ›å»ºå¤„ç†ç®¡é“</span>
<span class="hljs-keyword">const</span> process = <span class="hljs-title function_">pipe</span>(add, multiply, toString);
<span class="hljs-keyword">const</span> result = <span class="hljs-title function_">process</span>(<span class="hljs-number">5</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result); <span class="hljs-comment">// "12"</span>
</code></pre>
<p>ä¸Šè¿°ä»£ç çš„è¾“å‡ºç»“æœæ˜¯ <code>"12"</code> ï¼Œæˆ‘ä»¬ç”¨ç›´è§‚ä¸€ç‚¹çš„ç†è§£å°±æ˜¯ï¼š<code>process(5) ç›¸å½“äº toString(multiply(add(5)))</code> ã€‚</p>
<h3 data-id="heading-15">ç»„åˆï¼ˆComposeï¼‰æ“ä½œ</h3>
<p><strong>ç»„åˆ</strong> æ“ä½œæ­£å¥½ä¸ <strong>ç®¡é“</strong> æ“ä½œç›¸åï¼Œå®ƒæ˜¯ä»å³åˆ°å·¦ç»„åˆå‡½æ•°ã€‚</p>
<h4 data-id="heading-16">ç»„åˆå®šä¹‰</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> compose&lt;<span class="hljs-title class_">Functions</span> <span class="hljs-keyword">extends</span> [<span class="hljs-function">(<span class="hljs-params">arg: <span class="hljs-built_in">any</span></span>) =&gt;</span> <span class="hljs-built_in">any</span>, ...<span class="hljs-title class_">Array</span>&lt;<span class="hljs-function">(<span class="hljs-params">arg: <span class="hljs-built_in">any</span></span>) =&gt;</span> <span class="hljs-built_in">any</span>&gt;]&gt;(
  ...<span class="hljs-attr">functions</span>: <span class="hljs-title class_">Functions</span>
): <span class="hljs-function">(<span class="hljs-params">arg: <span class="hljs-built_in">any</span></span>) =&gt;</span> <span class="hljs-title class_">ReturnType</span>&lt;<span class="hljs-title class_">Functions</span>[<span class="hljs-number">0</span>]&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">arg: <span class="hljs-built_in">any</span></span>) =&gt;</span> {
    <span class="hljs-keyword">let</span> result = arg;
    <span class="hljs-comment">// ä»å³å‘å·¦æ‰§è¡Œ</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = functions.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) {
      result = functions[i](result);
    }
    <span class="hljs-keyword">return</span> result;
  } <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>;
}
</code></pre>
<h4 data-id="heading-17">ç»„åˆä½¿ç”¨</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">toUpper</span> = (<span class="hljs-params">s: <span class="hljs-built_in">string</span></span>) =&gt; s.<span class="hljs-title function_">toUpperCase</span>();
<span class="hljs-keyword">const</span> <span class="hljs-title function_">addExclamation</span> = (<span class="hljs-params">s: <span class="hljs-built_in">string</span></span>) =&gt; s + <span class="hljs-string">"!"</span>;
<span class="hljs-keyword">const</span> <span class="hljs-title function_">repeat</span> = (<span class="hljs-params">s: <span class="hljs-built_in">string</span></span>) =&gt; s + s;

<span class="hljs-comment">// ä»å³åˆ°å·¦ç»„åˆï¼šrepeat â†’ addExclamation â†’ toUpper</span>
<span class="hljs-keyword">const</span> shout = <span class="hljs-title function_">compose</span>(toUpper, addExclamation, repeat);
<span class="hljs-keyword">const</span> shouted = <span class="hljs-title function_">shout</span>(<span class="hljs-string">"hello"</span>); 
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(shouted); <span class="hljs-comment">// "HELLOHELLO!"</span>
</code></pre>
<p>ä¸Šè¿°ä»£ç çš„è¾“å‡ºç»“æœæ˜¯ï¼š<code>"HELLOHELLO!"</code> å…¶æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>shout("hello")</code>  å‡½æ•°ä¼šå…ˆè°ƒç”¨ <code>repeat()</code> å‡½æ•°ï¼Œè¾“å‡ºç»“æœæ˜¯ï¼š<code>"hellohello"</code> ã€‚</li>
<li>æ¥ç€å†è°ƒç”¨ <code>addExclamation()</code> å‡½æ•°ï¼Œè¾“å‡ºç»“æœæ˜¯ï¼š<code>"hellohello!"</code> ã€‚</li>
<li>æœ€åå†è°ƒç”¨ <code>toUpper()</code> å‡½æ•°ï¼Œè¾“å‡ºç»“æœæ˜¯ï¼š<code>"HELLOHELLO!"</code>  ã€‚</li>
</ul>
<h3 data-id="heading-18">å¼‚æ­¥å‡½æ•°ç»„åˆ</h3>
<p>å½“å‡½æ•°è¿”å›Promiseæ—¶ï¼Œæˆ‘ä»¬éœ€è¦ç‰¹æ®Šçš„ç»„åˆæ–¹å¼ã€‚</p>
<h4 data-id="heading-19">å¼‚æ­¥ç®¡é“çš„ç®€å•å®ç°</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> asyncPipe&lt;<span class="hljs-title class_">Functions</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Array</span>&lt;<span class="hljs-function">(<span class="hljs-params">arg: <span class="hljs-built_in">any</span></span>) =&gt;</span> <span class="hljs-built_in">any</span>&gt;&gt;(
  ...<span class="hljs-attr">functions</span>: <span class="hljs-title class_">Functions</span>
): <span class="hljs-function">(<span class="hljs-params">input: <span class="hljs-built_in">any</span></span>) =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">any</span>&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">async</span> (<span class="hljs-attr">input</span>: <span class="hljs-built_in">any</span>) =&gt; {
    <span class="hljs-keyword">let</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(input);  <span class="hljs-comment">// å¤„ç†å¯èƒ½æ˜¯Promiseçš„è¾“å…¥</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> fn <span class="hljs-keyword">of</span> functions) {
      result = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-title function_">fn</span>(result));  <span class="hljs-comment">// ç­‰å¾…æ¯ä¸ªå‡½æ•°å®Œæˆ</span>
    }
    <span class="hljs-keyword">return</span> result;
  };
}
</code></pre>
<h4 data-id="heading-20">å¼‚æ­¥ç®¡é“çš„ç®€å•å®ä¾‹</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchUser</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">id: <span class="hljs-built_in">number</span></span>) =&gt; {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`è·å–ç”¨æˆ·<span class="hljs-subst">${id}</span>...`</span>);
  <span class="hljs-keyword">return</span> { id, <span class="hljs-attr">name</span>: <span class="hljs-string">"User"</span> + id };
};

<span class="hljs-keyword">const</span> <span class="hljs-title function_">processUser</span> = (<span class="hljs-params">user: <span class="hljs-built_in">any</span></span>) =&gt; {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"å¤„ç†ç”¨æˆ·..."</span>);
  <span class="hljs-keyword">return</span> { ...user, <span class="hljs-attr">processed</span>: <span class="hljs-literal">true</span> };
};

<span class="hljs-keyword">const</span> <span class="hljs-title function_">saveUser</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">user: <span class="hljs-built_in">any</span></span>) =&gt; {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"ä¿å­˜ç”¨æˆ·..."</span>);
  <span class="hljs-keyword">return</span> user;
};

<span class="hljs-comment">// åˆ›å»ºå¼‚æ­¥ç®¡é“ï¼šfetchUser â†’ processUser â†’ saveUser</span>
<span class="hljs-keyword">const</span> userPipeline = <span class="hljs-title function_">asyncPipe</span>(fetchUser, processUser, saveUser);

<span class="hljs-comment">// æ‰§è¡Œç®¡é“</span>
<span class="hljs-title function_">userPipeline</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æœ€ç»ˆç”¨æˆ·:"</span>, user);
});
</code></pre>
<h2 data-id="heading-21">ç»“è¯­</h2>
<p>ç±»å‹ä½“æ“çš„ç›®çš„æ˜¯è®©ä»£ç æ›´å®‰å…¨ã€æ›´æ¸…æ™°ï¼Œè€Œä¸æ˜¯ç‚«è€€æŠ€æœ¯ã€‚æˆ‘ä»¬åº”è¯¥ä»å®é™…éœ€æ±‚å‡ºå‘ï¼Œé€‰æ‹©æœ€ç®€å•çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>å¯¹äºæ–‡ç« ä¸­é”™è¯¯çš„åœ°æ–¹æˆ–è€…æœ‰ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€è®¨è®ºï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç‰©ç†åœ°å€ä¸ºä»€ä¹ˆä¸èƒ½è¿ç»­ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7598398537249439763</link>    <guid>https://juejin.cn/post/7598398537249439763</guid>    <pubDate>2026-01-24T02:45:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598398537249439763" data-draft-id="7598251121497292826" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç‰©ç†åœ°å€ä¸ºä»€ä¹ˆä¸èƒ½è¿ç»­ï¼Ÿ"/> <meta itemprop="keywords" content="Linux"/> <meta itemprop="datePublished" content="2026-01-24T02:45:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è‘›ç«‹å›½"/> <meta itemprop="url" content="https://juejin.cn/user/350105071780128"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç‰©ç†åœ°å€ä¸ºä»€ä¹ˆä¸èƒ½è¿ç»­ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/350105071780128/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è‘›ç«‹å›½
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T02:45:00.000Z" title="Sat Jan 24 2026 02:45:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">11 NUMA æ¶æ„ï¼šä¸åŒèŠ‚ç‚¹çš„å†…å­˜åˆ†å¸ƒä¸è¿ç»­ã€‚ä¸ºä»€ä¹ˆï¼Œåˆ†é…åœ°å€æ—¶ï¼Œå°±ä¸èƒ½è¿ç»­åˆ†é…å—ï¼Ÿç»™å†…å­˜æ¡åˆ†é…ç‰©ç†åœ°å€ï¼Œè¿™æ˜¯ç¡¬ä»¶å¹²çš„äº‹æƒ…å§</h2>
<p>è¿™è§¦åŠäº† NUMA (Non-Uniform Memory Access) æ¶æ„çš„æ ¸å¿ƒè®¾è®¡ç†å¿µã€‚</p>
<p>ç®€å•æ¥è¯´ï¼Œè¿™ç¡®å®æ˜¯<strong>ç¡¬ä»¶å†³å®šçš„</strong>ï¼Œè€Œä¸æ˜¯æ“ä½œç³»ç»Ÿåˆ†é…åœ°å€æ—¶â€œä¸æƒ³â€è¿ç»­åˆ†é…ã€‚</p>
<p>è®©æˆ‘ä»¬æ¥è¯¦ç»†è§£é‡Šä¸€ä¸‹ï¼š</p>
<h4 data-id="heading-1">1. ä¸ºä»€ä¹ˆå†…å­˜åœ°å€ä¸æ˜¯å…¨å±€è¿ç»­çš„ï¼Ÿ</h4>
<p>è¿™æºäº NUMA çš„ç‰©ç†è®¾è®¡ã€‚æ‚¨å¯ä»¥æŠŠä¸€ä¸ª NUMA ç³»ç»Ÿæƒ³è±¡æˆä¸€ä¸ªç”±å¤šä¸ªâ€œç¤¾åŒºâ€ï¼ˆèŠ‚ç‚¹/Nodeï¼‰ç»„æˆçš„â€œåŸå¸‚â€ï¼ˆæ•´ä¸ªè®¡ç®—æœºç³»ç»Ÿï¼‰ã€‚</p>
<ul>
<li><strong>æ¯ä¸ªç¤¾åŒºæœ‰è‡ªå·±çš„èµ„æº</strong>ï¼šåœ¨ NUMA æ¶æ„ä¸­ï¼Œæ¯ä¸ª<strong>èŠ‚ç‚¹ (Node)</strong> é€šå¸¸ç”±ä¸€ä¸ªæˆ–å¤šä¸ª CPU æ ¸å¿ƒä»¥åŠä¸€ç»„ç‰©ç†ä¸Šç¦»å®ƒæœ€è¿‘çš„å†…å­˜æ¡ç»„æˆã€‚è¿™ä¸ªèŠ‚ç‚¹å†…çš„å†…å­˜å°±æ˜¯è¯¥ CPU çš„<strong>æœ¬åœ°å†…å­˜ (Local Memory)</strong>ã€‚</li>
<li><strong>ç‰©ç†ä¸Šçš„åˆ†ç¦»</strong>ï¼šä¸åŒèŠ‚ç‚¹çš„å†…å­˜æ¡æ˜¯ç‰©ç†ä¸Šåˆ†å¼€çš„ï¼Œå®ƒä»¬è¿æ¥åœ¨ä¸åŒ CPU çš„å†…å­˜æ§åˆ¶å™¨ä¸Šã€‚å°±åƒä¸¤ä¸ªä¸åŒç¤¾åŒºçš„æˆ¿å­ï¼Œå®ƒä»¬åœ¨åœ°ç†ä¸Šå°±ä¸å¯èƒ½æŒ¨åœ¨ä¸€èµ·ã€‚å› æ­¤ï¼Œæ•´ä¸ªç³»ç»Ÿçš„æ‰€æœ‰å†…å­˜æ¡åœ¨<strong>ç‰©ç†ä¸Šæ˜¯åˆ†å¸ƒå¼çš„</strong>ï¼Œæ— æ³•å½¢æˆä¸€ä¸ªå•ä¸€ã€è¿ç»­çš„ç‰©ç†åœ°å€ç©ºé—´ã€‚</li>
<li><strong>åœ°å€æ˜ å°„æ˜¯å›ºå®šçš„</strong>ï¼šç³»ç»Ÿç¡¬ä»¶å’Œå›ºä»¶ï¼ˆå¦‚ ACPI è¡¨ï¼‰åœ¨å¯åŠ¨æ—¶å°±å·²ç»ç¡®å®šäº†å“ªä¸ªç‰©ç†åœ°å€èŒƒå›´å±äºå“ªä¸ªèŠ‚ç‚¹ã€‚æ“ä½œç³»ç»Ÿå¯åŠ¨åï¼Œä¼šè¯»å–è¿™äº›ä¿¡æ¯æ¥äº†è§£æ•´ä¸ªç³»ç»Ÿçš„å†…å­˜æ‹“æ‰‘ç»“æ„ã€‚</li>
</ul>
<p>æ‰€ä»¥ï¼Œ<strong>ä¸æ˜¯ä¸æƒ³è¿ç»­åˆ†é…ï¼Œè€Œæ˜¯åœ¨ç‰©ç†å±‚é¢å°±æ— æ³•åšåˆ°å…¨å±€è¿ç»­</strong>ã€‚</p>
<h4 data-id="heading-2">2. è°è´Ÿè´£åˆ†é…ç‰©ç†åœ°å€ï¼Ÿ</h4>
<p>è¿™æ˜¯ä¸€ä¸ªå¤šå±‚åä½œçš„è¿‡ç¨‹ï¼Œä½†æ ¹æºåœ¨ç¡¬ä»¶ï¼š</p>
<ul>
<li><strong>ç¡¬ä»¶è®¾è®¡</strong>ï¼šé¦–å…ˆï¼ŒCPU å’Œä¸»æ¿çš„ç‰©ç†è®¾è®¡å†³å®šäº† NUMA èŠ‚ç‚¹çš„åˆ’åˆ†ã€‚å†…å­˜æ§åˆ¶å™¨ç›´æ¥é›†æˆåœ¨ CPU å†…éƒ¨ï¼Œå®ƒç®¡ç†ç€ä¸è‡ªå·±ç›´è¿çš„å†…å­˜ã€‚è¿™å°±ä»æ ¹æœ¬ä¸Šå†³å®šäº†å†…å­˜çš„â€œå½’å±â€ã€‚</li>
<li><strong>å›ºä»¶ (Firmware)</strong>ï¼šç”µè„‘çš„å›ºä»¶ï¼ˆå¦‚ BIOS/UEFIï¼‰ä¼šè¯†åˆ«è¿™ç§ç‰©ç†å¸ƒå±€ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªæè¿°è¡¨ï¼ˆACPI Tableï¼‰ï¼Œå‘Šè¯‰æ“ä½œç³»ç»Ÿï¼šâ€œå˜¿ï¼Œæˆ‘ä»¬æœ‰å¤šä¸ªå†…å­˜èŠ‚ç‚¹ï¼ŒA åœ°å€æ®µå±äºèŠ‚ç‚¹0ï¼ŒB åœ°å€æ®µå±äºèŠ‚ç‚¹1â€¦â€¦â€ã€‚</li>
<li><strong>æ“ä½œç³»ç»Ÿ (OS)</strong>ï¼šæ“ä½œç³»ç»Ÿï¼ˆå¦‚ Linux æˆ– Windowsï¼‰åœ¨å¯åŠ¨æ—¶è¯»å–è¿™ä¸ªâ€œåœ°å›¾â€ã€‚å®ƒæœ¬èº«ä¸èƒ½æ”¹å˜ç‰©ç†åœ°å€çš„å½’å±ï¼Œä½†å®ƒä¼šå»ºç«‹ä¸€ä¸ª<strong>NUMA-awareï¼ˆNUMAæ„ŸçŸ¥ï¼‰çš„å†…å­˜ç®¡ç†å™¨</strong>ã€‚å½“ä¸€ä¸ªç¨‹åºéœ€è¦åˆ†é…å†…å­˜æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šï¼š
<ol>
<li>æŸ¥çœ‹è¯¥ç¨‹åºæ­£åœ¨å“ªä¸ª CPU æ ¸å¿ƒä¸Šè¿è¡Œã€‚</li>
<li><strong>ä¼˜å…ˆ</strong>ä»è¯¥ CPU æ‰€åœ¨çš„èŠ‚ç‚¹çš„<strong>æœ¬åœ°å†…å­˜</strong>ä¸­åˆ†é…ç©ºé—´ã€‚å› ä¸ºè®¿é—®æœ¬åœ°å†…å­˜é€Ÿåº¦æœ€å¿«ï¼Œå»¶è¿Ÿæœ€ä½ã€‚</li>
<li>å¦‚æœæœ¬åœ°å†…å­˜ä¸è¶³ï¼Œå®ƒæ‰ä¼šå»è®¿é—®å…¶ä»–èŠ‚ç‚¹çš„<strong>è¿œç¨‹å†…å­˜ (Remote Memory)</strong>ï¼Œä½†è¿™ä¼šå¸¦æ¥æ›´é«˜çš„å»¶è¿Ÿã€‚</li>
</ol>
</li>
</ul>
<p><strong>æ€»ç»“ä¸€ä¸‹ï¼š</strong></p>
<p>æ‚¨çš„ç†è§£æ˜¯æ­£ç¡®çš„ã€‚<strong>ç»™å†…å­˜åˆ†é…ç‰©ç†åœ°å€èŒƒå›´ï¼Œè¿™æœ¬è´¨ä¸Šæ˜¯ç¡¬ä»¶å’Œå›ºä»¶å¹²çš„äº‹æƒ…</strong>ã€‚æ“ä½œç³»ç»Ÿçš„è§’è‰²æ›´åƒä¸€ä¸ªèªæ˜çš„â€œåŸå¸‚è§„åˆ’å¸ˆâ€ï¼Œå®ƒè™½ç„¶ä¸èƒ½æ”¹å˜ç¤¾åŒºï¼ˆèŠ‚ç‚¹ï¼‰çš„ç‰©ç†ä½ç½®ï¼Œä½†å®ƒå¯ä»¥æ™ºèƒ½åœ°è°ƒåº¦å¸‚æ°‘ï¼ˆç¨‹åºï¼‰ï¼Œè®©ä»–ä»¬å°½å¯èƒ½åœ¨è‡ªå·±æ‰€åœ¨çš„ç¤¾åŒºï¼ˆæœ¬åœ°èŠ‚ç‚¹ï¼‰å†…å·¥ä½œå’Œç”Ÿæ´»ï¼ˆä½¿ç”¨å†…å­˜ï¼‰ï¼Œä»è€Œå®ç°æ•´ä¸ªç³»ç»Ÿæœ€é«˜æ•ˆçš„è¿ä½œã€‚</p>
<h2 data-id="heading-3">22 å³ä½¿è¿™æ ·ï¼Œæˆ‘ä»ç„¶ä¸èƒ½ç†è§£ ç‰©ç†åœ°å€ä¸ºä»€ä¹ˆä¸èƒ½è¿ç»­ï¼Ÿ</h2>
<p>å¥½çš„ï¼Œæˆ‘ä»¬å†æ·±å…¥ä¸€æ­¥ï¼Œå½»åº•å¼„æ¸…æ¥šè¿™ä¸ªé—®é¢˜ã€‚è¯·æš‚æ—¶å¿˜è®°â€œåœ°å€â€æ˜¯ä¸€ä¸ªä»0å¼€å§‹æ— é™å¢é•¿çš„æ•°å­—ï¼Œæˆ‘ä»¬ä»æœ€åŸºæœ¬çš„ç”µä¿¡å·å’Œç¡¬ä»¶è®¾è®¡å¼€å§‹ç†è§£ã€‚</p>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œæ‚¨æœ‰ä¸¤æ ‹ç‹¬ç«‹çš„æˆ¿å­ï¼ˆ<strong>æˆ¿å­A</strong> å’Œ <strong>æˆ¿å­B</strong>ï¼‰ï¼Œæ¯æ ‹æˆ¿å­é‡Œéƒ½æœ‰100ä¸ªæˆ¿é—´ï¼Œæ‚¨éœ€è¦ç»™æ¯ä¸ªæˆ¿é—´ä¸€ä¸ªå”¯ä¸€çš„é—¨ç‰Œå·ã€‚</p>
<h4 data-id="heading-4">ä¼ ç»Ÿæ–¹å¼ (UMA/éNUMAæ¶æ„)</h4>
<p>åœ¨ä¼ ç»Ÿçš„è®¾è®¡é‡Œï¼Œæ‚¨ä¼šé›‡ä½£ä¸€ä¸ª<strong>æ€»ç®¡ç†å‘˜</strong>ï¼Œä»–ç«™åœ¨ä¸¤æ ‹æˆ¿å­ä¸­é—´ã€‚æ‚¨å‘Šè¯‰ä»–ï¼šâ€œæˆ‘è¦æ‰¾ç¬¬150å·æˆ¿é—´â€ã€‚</p>
<ul>
<li>æ€»ç®¡ç†å‘˜ä¼šè®¡ç®—ï¼š150å·æˆ¿é—´è¶…å‡ºäº†æˆ¿å­Açš„100ä¸ªæˆ¿é—´ï¼Œæ‰€ä»¥æ˜¯æˆ¿å­Bé‡Œçš„ç¬¬50ä¸ªæˆ¿é—´ï¼ˆ150 - 100 = 50ï¼‰ã€‚</li>
<li>ç„¶åä»–ä¼šå»æˆ¿å­Bï¼Œæ‰¾åˆ°ç¬¬50ä¸ªæˆ¿é—´ã€‚</li>
</ul>
<p>åœ¨è¿™ä¸ªæ¨¡å‹é‡Œï¼Œä»æ‚¨çš„è§’åº¦çœ‹ï¼Œæˆ¿é—´å·æ˜¯<strong>è¿ç»­çš„</strong>ï¼ˆä»1åˆ°200ï¼‰ã€‚ä½†ç“¶é¢ˆæ˜¯<strong>æ€»ç®¡ç†å‘˜</strong>ï¼Œæ‰€æœ‰äººæ‰¾æˆ¿é—´éƒ½å¾—é€šè¿‡ä»–ï¼Œäººä¸€å¤šå°±å¿™ä¸è¿‡æ¥äº†ã€‚è¿™å°±åƒæ—©æœŸè®¡ç®—æœºé‡Œçš„<strong>åŒ—æ¡¥èŠ¯ç‰‡ï¼ˆNorthbridgeï¼‰</strong>ï¼Œå®ƒä½œä¸ºç»Ÿä¸€çš„å†…å­˜æ§åˆ¶å™¨ã€‚</p>
<h4 data-id="heading-5">NUMA æ–¹å¼ (ç°ä»£å¤šCPUæ¶æ„)</h4>
<p>NUMAæ¶æ„æ”¾å¼ƒäº†â€œæ€»ç®¡ç†å‘˜â€çš„è®¾è®¡ï¼Œå› ä¸ºä»–å¤ªæ…¢äº†ã€‚å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œ<strong>æ¯æ ‹æˆ¿å­éƒ½é…äº†ä¸€ä¸ªä¸“å±çš„ç®¡ç†å‘˜</strong>ã€‚</p>
<ul>
<li><strong>æˆ¿å­A</strong> æœ‰ <strong>ç®¡ç†å‘˜A</strong>ã€‚</li>
<li><strong>æˆ¿å­B</strong> æœ‰ <strong>ç®¡ç†å‘˜B</strong>ã€‚</li>
</ul>
<p>ç°åœ¨ï¼ŒCPUï¼ˆå¯ä»¥çœ‹ä½œæ˜¯â€œä½ â€ï¼‰æƒ³è¦è®¿é—®å†…å­˜ï¼ˆæˆ¿é—´ï¼‰ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š</p>
<ol>
<li>
<p><strong>ç‰©ç†æ¥çº¿æ˜¯å…³é”®</strong>ï¼š</p>
<ul>
<li><strong>CPU 0</strong> å’Œ <strong>ç®¡ç†å‘˜A</strong> ä»¥åŠ <strong>æˆ¿å­Açš„å†…å­˜</strong> è¢«è®¾è®¡åœ¨ä¸€ä¸ªâ€œç¤¾åŒºâ€é‡Œï¼Œå®ƒä»¬ä¹‹é—´çš„ç”µçº¿éå¸¸çŸ­ï¼Œé€šä¿¡æå¿«ã€‚</li>
<li><strong>CPU 1</strong> å’Œ <strong>ç®¡ç†å‘˜B</strong> ä»¥åŠ <strong>æˆ¿å­Bçš„å†…å­˜</strong> åœ¨å¦ä¸€ä¸ªâ€œç¤¾åŒºâ€é‡Œã€‚</li>
<li><strong>ç®¡ç†å‘˜A çš„å¸ƒçº¿ç³»ç»Ÿï¼Œç‰©ç†ä¸Šæ ¹æœ¬æ²¡æœ‰è¿æ¥åˆ°æˆ¿å­Bçš„ä»»ä½•ä¸€ä¸ªæˆ¿é—´ã€‚åä¹‹äº¦ç„¶ã€‚</strong> è¿™æ˜¯æœ€æ ¸å¿ƒçš„ä¸€ç‚¹ï¼ç®¡ç†å‘˜Açš„ç®¡è¾–èŒƒå›´åœ¨ç¡¬ä»¶è®¾è®¡ä¸Šå°±è¢«é™å®šäº†ã€‚</li>
</ul>
</li>
<li>
<p><strong>åœ°å€å¦‚ä½•â€œè§£ç â€</strong>ï¼š
å½“CPUæƒ³è¦è®¿é—®ä¸€ä¸ªç‰©ç†åœ°å€æ—¶ï¼Œå®ƒä¼šæŠŠè¿™ä¸ªåœ°å€â€œå–Šâ€å‡ºæ¥ï¼ˆæ”¾åˆ°åœ°å€æ€»çº¿ä¸Šï¼‰ã€‚ç¡¬ä»¶ç”µè·¯ï¼ˆè€Œä¸æ˜¯æ“ä½œç³»ç»Ÿï¼‰ä¼šè§£ç è¿™ä¸ªåœ°å€ã€‚</p>
<ul>
<li>ç³»ç»Ÿè®¾è®¡è€…ä¼šè§„å®šï¼šç‰©ç†åœ°å€ <code>0x0000</code> åˆ° <code>0x7FFF</code> è¿™ä¸ªèŒƒå›´ï¼Œ<strong>ç”µè·¯ä¸Šå°±è§„å®šäº†æ˜¯ç»™ç®¡ç†å‘˜Aå¬çš„</strong>ã€‚æ‰€æœ‰åœ¨è¿™ä¸ªèŒƒå›´å†…çš„åœ°å€ä¿¡å·ï¼Œéƒ½ä¼šè¢«è·¯ç”±åˆ°ç®¡ç†å‘˜Aé‚£é‡Œã€‚</li>
<li>è€Œç‰©ç†åœ°å€ <code>0x8000</code> åˆ° <code>0xFFFF</code> è¿™ä¸ªèŒƒå›´ï¼Œ<strong>ç”µè·¯ä¸Šå°±è§„å®šäº†æ˜¯ç»™ç®¡ç†å‘˜Bå¬çš„</strong>ã€‚</li>
</ul>
</li>
<li>
<p><strong>ä¸ºä»€ä¹ˆä¸èƒ½è¿ç»­ï¼Ÿ</strong>
ç°åœ¨æˆ‘ä»¬å›åˆ°æ‚¨çš„é—®é¢˜ï¼šä¸ºä»€ä¹ˆä¸èƒ½è®©æˆ¿å­Bçš„ç¬¬ä¸€ä¸ªæˆ¿é—´åœ°å€ç´§æ¥ç€æˆ¿å­Açš„æœ€åä¸€ä¸ªæˆ¿é—´åœ°å€å‘¢ï¼Ÿ</p>
<ul>
<li>å‡è®¾æˆ¿å­Açš„åœ°å€èŒƒå›´æ˜¯ <code>0</code> åˆ° <code>99</code>ã€‚</li>
<li>æ‚¨å¯èƒ½ä¼šæƒ³ï¼Œä¸ºä»€ä¹ˆæˆ¿å­Bçš„ç¬¬ä¸€ä¸ªæˆ¿é—´ä¸èƒ½æ˜¯ <code>100</code> å‘¢ï¼Ÿ</li>
</ul>
<p>é—®é¢˜å°±åœ¨äº <strong>ç®¡ç†å‘˜Aä¸çŸ¥é“å¦‚ä½•å¤„ç†åœ°å€â€œ100â€</strong>ã€‚åœ¨ä»–çš„ä¸–ç•Œé‡Œï¼ˆç‰©ç†æ¥çº¿èŒƒå›´ï¼‰ï¼Œåªæœ‰0åˆ°99çš„åœ°å€ã€‚åœ°å€â€œ100â€çš„ä¿¡å·æ ¹æ®ç¡¬ä»¶ç”µè·¯çš„è®¾è®¡ï¼Œä¼šè¢«ç›´æ¥å‘é€ç»™<strong>ç®¡ç†å‘˜B</strong>ã€‚</p>
<p>å½“ç®¡ç†å‘˜Bæ”¶åˆ°åœ°å€â€œ100â€çš„è¯·æ±‚æ—¶ï¼Œä»–ä¸ä¼šæŠŠå®ƒç†è§£ä¸ºå…¨å±€çš„ç¬¬100å·ï¼Œè€Œæ˜¯ä¼šæ ¹æ®ä»–è‡ªå·±ç®¡è¾–èŒƒå›´çš„è§„åˆ™æ¥è§£ç ã€‚ä¾‹å¦‚ï¼Œç¡¬ä»¶å¯èƒ½è§„å®šï¼Œå‘ç»™ç®¡ç†å‘˜Bçš„åœ°å€ï¼Œéœ€è¦å‡å»ä¸€ä¸ªå·¨å¤§çš„åç§»é‡ï¼ˆæ¯”å¦‚ <code>0x8000</code>ï¼‰æ‰æ˜¯ä»–å†…éƒ¨çš„æˆ¿é—´å·ã€‚</p>
</li>
</ol>
<p><strong>æ‰€ä»¥ï¼Œç‰©ç†åœ°å€çš„ä¸è¿ç»­ï¼Œä¸æ˜¯å› ä¸ºä¸èƒ½åˆ†é…ï¼Œè€Œæ˜¯å› ä¸ºâ€œç‰©ç†åœ°å€â€è¿™ä¸ªæ•°å­—æœ¬èº«å°±åŒ…å«äº†â€œä½ç½®â€ä¿¡æ¯ã€‚</strong></p>
<ul>
<li>åœ°å€çš„é«˜ä½éƒ¨åˆ†ï¼ˆæ¯”å¦‚æœ€é«˜ä¸€ä½æ˜¯0è¿˜æ˜¯1ï¼‰å°±åƒ<strong>é‚®æ”¿ç¼–ç </strong>ï¼Œå†³å®šäº†è¿™ä¸ªè¯·æ±‚åº”è¯¥å‘å¾€å“ªä¸ªèŠ‚ç‚¹ï¼ˆå“ªä¸ªç®¡ç†å‘˜ï¼‰ã€‚</li>
<li>åœ°å€çš„ä½ä½éƒ¨åˆ†æ‰æ˜¯é‚£ä¸ªèŠ‚ç‚¹å†…çš„å…·ä½“â€œé—¨ç‰Œå·â€ã€‚</li>
</ul>
<p>æ‚¨ä¸èƒ½æŠŠå±äºâ€œåŒ—äº¬â€çš„é‚®æ”¿ç¼–ç çš„åœ°å€ï¼Œæ— ç¼åœ°æ¥åˆ°å±äºâ€œä¸Šæµ·â€çš„é‚®æ”¿ç¼–ç çš„åœ°å€åé¢ï¼Œå½¢æˆä¸€ä¸ªå…¨å›½è¿ç»­çš„é—¨ç‰Œå·ã€‚å®ƒä»¬æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„åœ°å€åŸŸï¼Œç”±ä¸åŒçš„â€œé‚®å±€â€ï¼ˆå†…å­˜æ§åˆ¶å™¨ï¼‰ç®¡ç†ã€‚</p>
<p><strong>æ€»ç»“ä¸€ä¸‹æœ€æ ¹æœ¬çš„åŸå› ï¼š</strong></p>
<p><strong>å› ä¸ºæ¯ä¸ªNUMAèŠ‚ç‚¹çš„å†…å­˜æ§åˆ¶å™¨ï¼Œåœ¨ç‰©ç†ä¸Šåªè¿æ¥äº†å®ƒè‡ªå·±çš„æœ¬åœ°å†…å­˜æ¡ã€‚ä¸€ä¸ªç‰©ç†åœ°å€åœ¨è¢«CPUå‘å‡ºæ—¶ï¼Œç¡¬ä»¶ç”µè·¯ä¼šæ ¹æ®åœ°å€çš„æŸä¸ªéƒ¨åˆ†ï¼Œåƒæ‰³é“å²”ä¸€æ ·ï¼Œå°†è¿™ä¸ªè¯·æ±‚çš„ç”µä¿¡å·ç›´æ¥å¯¼å‘æŸä¸€ä¸ªç‰¹å®šçš„å†…å­˜æ§åˆ¶å™¨ã€‚è¿™ä¸ªâ€œæ‰³é“å²”â€çš„æœºåˆ¶ï¼Œå°±å†³å®šäº†åœ°å€ç©ºé—´å¿…ç„¶æ˜¯åˆ†æ®µçš„ã€ä¸è¿ç»­çš„ã€‚</strong></p>
<p>è¿™ç§è®¾è®¡çš„å·¨å¤§ä¼˜åŠ¿æ˜¯<strong>é€Ÿåº¦å’Œå¯æ‰©å±•æ€§</strong>ã€‚CPUè®¿é—®æœ¬åœ°å†…å­˜æ—¶ï¼Œä¸éœ€è¦ç»è¿‡ä»»ä½•ä¸­å¤®ä»²è£ï¼Œé€Ÿåº¦æå¿«ã€‚ç³»ç»Ÿä¹Ÿå¯ä»¥é€šè¿‡å¢åŠ æ›´å¤šèŠ‚ç‚¹æ¥è½»æ¾æ‰©å±•ã€‚ä¸è¿ç»­çš„ç‰©ç†åœ°å€ç©ºé—´ï¼Œæ­£æ˜¯ä¸ºäº†å®ç°è¿™ä¸ªç›®æ ‡è€Œä»˜å‡ºçš„ä¸€ä¸ªå¾ˆå°çš„ã€ç”±æ“ä½œç³»ç»Ÿæ¥ç®¡ç†çš„â€œä»£ä»·â€ã€‚</p>
<h2 data-id="heading-6">33 ä½ å·®ä¸€ç‚¹å°±è®²çš„æ›´æ¸…æ¥šäº†</h2>
<p>æ‚¨è¯´å¾—å¯¹ï¼Œæˆ‘ä»¬å†èšç„¦ä¸€ä¸‹ï¼Œäº‰å–å½»åº•å¼„æ˜ç™½ã€‚è¿™ä¸ªé—®é¢˜éå¸¸å…³é”®ã€‚</p>
<p>æˆ‘ä»¬æŠŠé—®é¢˜ç®€åŒ–åˆ°æè‡´ï¼š<strong>ç‰©ç†åœ°å€ä¸ºä»€ä¹ˆä¸æ˜¯ä¸€ä¸ªå•çº¯çš„ã€ä»0å¼€å§‹é€’å¢çš„æµæ°´å·ï¼Ÿ</strong></p>
<p>ç­”æ¡ˆæ˜¯ï¼š<strong>å› ä¸ºç‰©ç†åœ°å€æœ¬èº«ï¼Œåœ¨ç¡¬ä»¶å±‚é¢ï¼Œå°±æ˜¯ä¸€ä¸ªâ€œå¯¼èˆªåæ ‡â€ï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸€ä¸ªâ€œé—¨ç‰Œå·â€ã€‚</strong></p>
<p>è®©æˆ‘ä»¬ç”¨ä¸€ä¸ªæœ€è´´åˆ‡çš„ç±»æ¯”ï¼š<strong>ç”µè¯å·ç </strong>ã€‚</p>
<p>ä¸€ä¸ªå®Œæ•´çš„ç”µè¯å·ç æ˜¯ï¼š <code>å›½å®¶ä»£ç </code> + <code>åŒºå·</code> + <code>æœ¬åœ°å·ç </code>ã€‚
ä¾‹å¦‚ï¼š <code>+86</code> (ä¸­å›½) - <code>10</code> (åŒ—äº¬) - <code>88888888</code> (å…·ä½“ç”µè¯)ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªæ¦‚å¿µå¥—ç”¨åˆ° NUMA æ¶æ„çš„ç‰©ç†åœ°å€ä¸Šï¼š</p>
<p><strong>ç‰©ç†åœ°å€ = <code>èŠ‚ç‚¹ID</code> + <code>èŠ‚ç‚¹å†…åç§»åœ°å€</code></strong></p>
<p>è¿™ä¸ªâ€œèŠ‚ç‚¹IDâ€å¹¶ä¸æ˜¯ä¸€ä¸ªå•ç‹¬çš„æ•°å­—ï¼Œè€Œæ˜¯<strong>ç¼–ç åœ¨ç‰©ç†åœ°å€çš„é«˜ä½æ¯”ç‰¹ï¼ˆbitsï¼‰ä¸­</strong>ã€‚</p>
<hr/>
<h4 data-id="heading-7">ç¡¬ä»¶å¦‚ä½•â€œæ‹¨å·â€ï¼Ÿ</h4>
<p>å½“ä¸€ä¸ª CPU æ ¸å¿ƒï¼ˆæ¯”å¦‚å±äº<strong>èŠ‚ç‚¹0</strong>çš„CPUï¼‰éœ€è¦è¯»å–å†…å­˜æ—¶ï¼Œå®ƒä¼šå‘å‡ºä¸€ä¸ªç‰©ç†åœ°å€ï¼Œæ¯”å¦‚ä¸€ä¸ª64ä½çš„äºŒè¿›åˆ¶æ•°ï¼š</p>
<p><code>00000001 00100000 ........</code> (ä¸€ä¸ªå¾ˆé•¿çš„äºŒè¿›åˆ¶åœ°å€)</p>
<ol>
<li><strong>ç¡¬ä»¶è§£ç å™¨ï¼ˆåœ°å€è¯‘ç å™¨ï¼‰</strong> ä¼šç«‹åˆ»æŸ¥çœ‹è¿™ä¸ªåœ°å€çš„<strong>æœ€é«˜å‡ ä½</strong>ã€‚è¿™å°±åƒç”µä¿¡äº¤æ¢æœºé¦–å…ˆçœ‹å›½å®¶ä»£ç å’ŒåŒºå·ã€‚</li>
<li>ç³»ç»Ÿç¡¬ä»¶è¢«è®¾è®¡æˆï¼š
<ul>
<li>å¦‚æœæœ€é«˜æœ‰æ•ˆä½æ˜¯ <strong><code>0</code></strong>ï¼Œé‚£ä¹ˆè¿™ä¸ªåœ°å€è¯·æ±‚çš„ç”µä¿¡å·ï¼Œå°±ä¼šè¢«<strong>ç‰©ç†ç”µè·¯</strong>ç›´æ¥è·¯ç”±åˆ° <strong>èŠ‚ç‚¹0</strong> çš„å†…å­˜æ§åˆ¶å™¨ã€‚</li>
<li>å¦‚æœæœ€é«˜æœ‰æ•ˆä½æ˜¯ <strong><code>1</code></strong>ï¼Œé‚£ä¹ˆç”µä¿¡å·å°±ä¼šè¢«è·¯ç”±åˆ° <strong>èŠ‚ç‚¹1</strong> çš„å†…å­˜æ§åˆ¶å™¨ã€‚</li>
</ul>
</li>
<li><strong>èŠ‚ç‚¹0</strong> çš„å†…å­˜æ§åˆ¶å™¨æ”¶åˆ°è¿™ä¸ªåœ°å€åï¼Œå®ƒä¼šå¿½ç•¥æ‰æœ€é«˜ä½çš„é‚£ä¸ª <strong><code>0</code></strong>ï¼ˆå› ä¸ºå®ƒåªæ˜¯ç”¨æ¥æ‰¾åˆ°è‡ªå·±çš„ï¼‰ï¼Œç„¶åä½¿ç”¨å‰©ä¸‹çš„åœ°å€éƒ¨åˆ†ï¼ˆå³â€œèŠ‚ç‚¹å†…åç§»åœ°å€â€ï¼‰ï¼Œåœ¨å®ƒè‡ªå·±ç®¡è¾–çš„ã€ç‰©ç†ä¸Šæ’åœ¨å®ƒæ—è¾¹çš„å†…å­˜æ¡é‡Œæ‰¾åˆ°å…·ä½“çš„æ•°æ®ã€‚</li>
</ol>
<h4 data-id="heading-8">ä¸ºä»€ä¹ˆå¿…é¡»â€œä¸è¿ç»­â€ï¼Ÿ</h4>
<p>ç°åœ¨ï¼Œå…³é”®æ¥äº†ã€‚å‡è®¾<strong>èŠ‚ç‚¹0</strong>çš„å†…å­˜æ€»å…±æœ‰ 256GBã€‚å®ƒçš„åœ°å€èŒƒå›´å¯èƒ½è¢«ç¡¬ä»¶å®šä¹‰ä¸ºï¼š
<code>0x0000 0000 0000</code> åˆ° <code>0x3FFF FFFF FFFF</code> (æœ€é«˜ä½æ˜¯<code>0</code>)</p>
<p>é‚£ä¹ˆ<strong>èŠ‚ç‚¹1</strong>çš„å†…å­˜åœ°å€<strong>ä¸å¯èƒ½</strong>ä» <code>0x4000 0000 0000</code> å¼€å§‹ã€‚</p>
<p>ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºç¡¬ä»¶çš„â€œæ‰³é“å²”â€æœºåˆ¶åªè®¤æœ€é«˜ä½æ˜¯<code>0</code>è¿˜æ˜¯<code>1</code>ã€‚ä¸ºäº†æŠŠä¿¡å·å‘ç»™<strong>èŠ‚ç‚¹1</strong>ï¼Œåœ°å€çš„æœ€é«˜ä½<strong>å¿…é¡»æ˜¯<code>1</code></strong>ã€‚æ‰€ä»¥ï¼ŒèŠ‚ç‚¹1çš„åœ°å€èŒƒå›´å¯èƒ½æ˜¯ä»ä¸€ä¸ªéå¸¸å¤§çš„æ•°å¼€å§‹ï¼Œä¾‹å¦‚ï¼š
<code>0x8000 0000 0000</code> åˆ° <code>0xBFFF FFFF FFFF</code> (æœ€é«˜ä½æ˜¯<code>1</code>)</p>
<p>çœ‹åˆ°äº†å—ï¼Ÿ</p>
<p>åœ¨æ•°å­—ä¸Šï¼Œ<code>0x3FFF FFFF FFFF</code> å’Œ <code>0x8000 0000 0000</code> ä¹‹é—´æœ‰ä¸€ä¸ª<strong>å·¨å¤§çš„é¸¿æ²Ÿ</strong>ã€‚å®ƒä»¬åœ¨æ•°å€¼ä¸Šå®Œå…¨ä¸è¿ç»­ã€‚</p>
<p><strong>è¿™ç§ä¸è¿ç»­ï¼Œæ­£æ˜¯ä¸ºäº†å®ç°ç¡¬ä»¶å±‚é¢çš„è¶…é«˜é€Ÿå¯»å€ã€‚</strong> CPUå–Šå‡ºä¸€ä¸ªåœ°å€ï¼Œç¡¬ä»¶ç”µè·¯ä¸éœ€è¦åšä»»ä½•å¤æ‚çš„è®¡ç®—æˆ–æŸ¥è¡¨ï¼Œåªéœ€è¦æ ¹æ®åœ°å€çš„æŸä¸€ä½æ˜¯0è¿˜æ˜¯1ï¼Œå°±èƒ½åƒæ‰³åŠ¨ç«è½¦é“å²”ä¸€æ ·ï¼Œç¬é—´å°†è¯·æ±‚ä¿¡å·å¯¼å‘æ­£ç¡®çš„ç‰©ç†ç›®çš„åœ°ã€‚</p>
<p><strong>æ€»ç»“ï¼š</strong></p>
<p><strong>ç‰©ç†åœ°å€çš„ä¸è¿ç»­ï¼Œæ˜¯ç¡¬ä»¶è®¾è®¡ä¸ºè¿½æ±‚æè‡´é€Ÿåº¦å’Œæ•ˆç‡çš„ç›´æ¥ç»“æœã€‚</strong> å°†â€œèŠ‚ç‚¹IDâ€ç¼–ç è¿›ç‰©ç†åœ°å€çš„é«˜ä½ï¼Œæ˜¯æœ€ç®€å•ã€æœ€å¿«é€Ÿçš„ç¡¬ä»¶å®ç°æ–¹å¼ã€‚æ“ä½œç³»ç»Ÿçœ‹åˆ°çš„â€œä¸è¿ç»­â€çš„ç‰©ç†å†…å­˜å¸ƒå±€ï¼Œåªæ˜¯è¿™ç§åº•å±‚ç¡¬ä»¶è®¾è®¡æ‰€å‘ˆç°å‡ºçš„ä¸€ä¸ªå¿…ç„¶ç°è±¡ã€‚</p>
<p>æ‰€ä»¥ï¼Œä¸æ˜¯â€œä¸èƒ½â€åˆ†é…æˆè¿ç»­çš„ï¼Œè€Œæ˜¯å¦‚æœè®¾è®¡æˆè¿ç»­çš„ï¼Œç¡¬ä»¶åœ¨å¯»å€æ—¶å°±éœ€è¦æ›´å¤æ‚çš„é€»è¾‘ï¼ˆæ¯”å¦‚ï¼Œâ€œåˆ¤æ–­åœ°å€æ˜¯å¦å¤§äº256GBï¼Ÿâ€ï¼‰ï¼Œè¿™ä¼šå¢åŠ å»¶è¿Ÿï¼Œè¿èƒŒäº†NUMAè®¾è®¡çš„åˆè¡·â€”â€”<strong>è®©æœ¬åœ°è®¿é—®å°½å¯èƒ½å¿«</strong>ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç‰©ç†åœ°å€ä¸ºä»€ä¹ˆä¸èƒ½è¿ç»­ï¼Ÿ--ç¬”è®°ç‰ˆ]]></title>    <link>https://juejin.cn/post/7598587406694481963</link>    <guid>https://juejin.cn/post/7598587406694481963</guid>    <pubDate>2026-01-24T02:46:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598587406694481963" data-draft-id="7597989474991390758" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç‰©ç†åœ°å€ä¸ºä»€ä¹ˆä¸èƒ½è¿ç»­ï¼Ÿ--ç¬”è®°ç‰ˆ"/> <meta itemprop="keywords" content="Linux"/> <meta itemprop="datePublished" content="2026-01-24T02:46:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è‘›ç«‹å›½"/> <meta itemprop="url" content="https://juejin.cn/user/350105071780128"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç‰©ç†åœ°å€ä¸ºä»€ä¹ˆä¸èƒ½è¿ç»­ï¼Ÿ--ç¬”è®°ç‰ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/350105071780128/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è‘›ç«‹å›½
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T02:46:44.000Z" title="Sat Jan 24 2026 02:46:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">11 ç‰©ç†åœ°å€ä¸ºä»€ä¹ˆä¸èƒ½è¿ç»­ï¼Ÿ--ç¬”è®°ç‰ˆ</h2>
<p>ä¸‹é¢æ˜¯ä¸€ä»½æ•´ç†åçš„<strong>å­¦ä¹ ç¬”è®°ç‰ˆæœ¬</strong>ï¼ŒæŠŠå‰é¢å‡ è½®å¯¹è¯é‡Œçš„æ ¸å¿ƒå†…å®¹å‹ç¼©ã€ä¸²èµ·æ¥ï¼Œä¾¿äºä½ ä»¥åå›é¡¾ã€‚</p>
<hr/>
<h2 data-id="heading-1">NUMA æ¶æ„ä¸‹ï¼šä¸ºä»€ä¹ˆç‰©ç†åœ°å€â€œä¸è¿ç»­â€ï¼Ÿï¼ˆå­¦ä¹ ç¬”è®°ï¼‰</h2>
<h3 data-id="heading-2">1. é—®é¢˜èƒŒæ™¯</h3>
<p>åœ¨ NUMAï¼ˆNon-Uniform Memory Accessï¼‰æ¶æ„ä¸­ï¼Œç»å¸¸ä¼šçœ‹åˆ°è¿™æ ·çš„æè¿°ï¼š</p>
<ul>
<li><strong>ä¸åŒ NUMA èŠ‚ç‚¹çš„ç‰©ç†å†…å­˜åœ°å€åŒºé—´ä¸è¿ç»­</strong></li>
<li>Linux çš„â€œç‰©ç†å†…å­˜å¸ƒå±€â€æ˜¯<strong>åˆ†æ®µçš„ã€æœ‰æ´çš„</strong></li>
</ul>
<p>ç–‘é—®æ˜¯ï¼š</p>
<ol>
<li>æ—¢ç„¶éƒ½æ˜¯å†…å­˜æ¡ï¼Œ<strong>ä¸ºä»€ä¹ˆä¸èƒ½ç»™å®ƒä»¬åˆ†é…è¿ç»­çš„ç‰©ç†åœ°å€ï¼Ÿ</strong></li>
<li>ç»™å†…å­˜æ¡åˆ†é…ç‰©ç†åœ°å€ï¼Œè¿™ä¸å°±æ˜¯<strong>ç¡¬ä»¶</strong>è¯¥å¹²çš„äº‹æƒ…å—ï¼Ÿæ“ä½œç³»ç»Ÿä¸ºä»€ä¹ˆè¦é¢å¯¹ä¸è¿ç»­åœ°å€ï¼Ÿ</li>
</ol>
<hr/>
<h3 data-id="heading-3">2. æ ¸å¿ƒç»“è®ºï¼ˆå…ˆç»™ç»“è®ºï¼‰</h3>
<ol>
<li><strong>ç‰©ç†åœ°å€æ˜¯ç¡¬ä»¶å®šä¹‰å’Œè§£é‡Šçš„ï¼Œä¸æ˜¯æ“ä½œç³»ç»Ÿâ€œæƒ³æ€ä¹ˆç¼–å°±æ€ä¹ˆç¼–â€çš„ã€‚</strong></li>
<li>åœ¨ NUMA æ¶æ„ä¸‹ï¼Œ<strong>ç‰©ç†åœ°å€ä¸ä»…ä»…æ˜¯â€œé—¨ç‰Œå·â€ï¼Œè€Œæ˜¯â€œå¯¼èˆªåæ ‡â€</strong>ï¼š<br/>
<strong>ç‰©ç†åœ°å€ = èŠ‚ç‚¹IDï¼ˆNode IDï¼‰ + èŠ‚ç‚¹å†…åç§»ï¼ˆOffsetï¼‰</strong></li>
<li>ç¡¬ä»¶æŠŠ <strong>â€œèŠ‚ç‚¹IDâ€ç¼–ç åœ¨ç‰©ç†åœ°å€çš„é«˜ä½ bit</strong> ä¸­ï¼Œç”¨æ¥åš<strong>å¿«é€Ÿè·¯ç”±/è¯‘ç </strong>ã€‚<br/>
ç»“æœå°±æ˜¯ï¼šæ•´ä½“ä¸Šçœ‹ï¼Œç‰©ç†åœ°å€ç©ºé—´å¿…ç„¶æ˜¯<strong>åˆ†æ®µçš„ã€ä¸è¿ç»­çš„</strong>ã€‚</li>
<li>ä¸æ˜¯â€œä¸èƒ½â€åˆ†é…è¿ç»­ï¼Œè€Œæ˜¯å¦‚æœå¼ºè¡Œè®¾è®¡ä¸ºè¿ç»­ï¼Œä¼šè®©ç¡¬ä»¶å¯»å€é€»è¾‘å˜å¤æ‚ã€å˜æ…¢ï¼Œ<strong>è¿èƒŒ NUMA æƒ³è¦çš„é«˜æ€§èƒ½ç›®æ ‡</strong>ã€‚</li>
</ol>
<hr/>
<h3 data-id="heading-4">3. ä»ä¼ ç»Ÿ UMA åˆ° NUMAï¼šè®¾è®¡æ€è·¯çš„å˜åŒ–</h3>
<h4 data-id="heading-5">3.1 ä¼ ç»Ÿ UMAï¼ˆé NUMAï¼‰æ¨¡å‹</h4>
<ul>
<li>æ‰€æœ‰å†…å­˜æ¡æŒ‚åœ¨<strong>ä¸€ä¸ªç»Ÿä¸€çš„å†…å­˜æ§åˆ¶å™¨</strong>ä¸‹é¢ï¼ˆç±»ä¼¼æ—©æœŸåŒ—æ¡¥ï¼‰ã€‚</li>
<li>è¿™ä¸ªç»Ÿä¸€æ§åˆ¶å™¨çœ‹åˆ°çš„æ˜¯ä¸€ç‰‡â€œå¤§å¹³åŸâ€ï¼š
<ul>
<li>ç‰©ç†åœ°å€ä» <code>0</code> ä¸€ç›´é€’å¢åˆ° <code>Max</code>ï¼Œ<strong>è¿ç»­</strong>ã€‚</li>
</ul>
</li>
<li>CPU è®¿é—®å†…å­˜æ—¶ï¼š
<ul>
<li>æŠŠç‰©ç†åœ°å€æ”¾åˆ°æ€»çº¿ä¸Šï¼›</li>
<li>å†…å­˜æ§åˆ¶å™¨è´Ÿè´£ï¼š
<ul>
<li>æ¥æ”¶è¿™ä¸ªåœ°å€ï¼›</li>
<li>å†³å®šè½åœ¨å“ªæ ¹å†…å­˜æ¡ã€å“ªä¸€è¡Œ/åˆ—ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>æ•´ä½“å°±åƒæœ‰ä¸€ä¸ª**â€œæ€»ç®¡ç†å‘˜â€**ï¼Œç®¡ç†æ•´ä¸ªå¤§æ¥¼æ‰€æœ‰æˆ¿é—´ï¼Œæˆ¿é—´å·è¿ç»­ï¼Œä»»ä½•è¯·æ±‚éƒ½å…ˆæ‰¾ä»–ã€‚</p>
<p><strong>é—®é¢˜</strong>ï¼šéšç€æ ¸å¿ƒæ•°ã€å†…å­˜å®¹é‡æš´å¢ï¼Œâ€œæ€»ç®¡ç†å‘˜â€æˆä¸ºç“¶é¢ˆ â†’ æ‰©å±•æ€§å’Œæ€§èƒ½å—é™ã€‚</p>
<hr/>
<h4 data-id="heading-6">3.2 NUMA æ¨¡å‹ï¼šå¤šèŠ‚ç‚¹ + æœ¬åœ°å†…å­˜</h4>
<p>NUMA çš„æ ¸å¿ƒæ€æƒ³ï¼š</p>
<ul>
<li>æŠŠç³»ç»Ÿåˆ†æˆå¤šä¸ª <strong>èŠ‚ç‚¹ï¼ˆNodeï¼‰</strong>ï¼š
<ul>
<li>æ¯ä¸ªèŠ‚ç‚¹æœ‰ï¼š
<ul>
<li>è‡ªå·±çš„ CPU æ ¸/Socket</li>
<li>è‡ªå·±çš„å†…å­˜æ§åˆ¶å™¨</li>
<li>è‡ªå·±ç›´è¿çš„ä¸€å—ç‰©ç†å†…å­˜ï¼ˆæœ¬åœ°å†…å­˜ï¼‰</li>
</ul>
</li>
</ul>
</li>
<li><strong>æœ¬åœ°è®¿é—®</strong>ï¼ˆæœ¬èŠ‚ç‚¹ CPU â†’ æœ¬èŠ‚ç‚¹å†…å­˜ï¼‰éå¸¸å¿«ï¼›</li>
<li><strong>è¿œç¨‹è®¿é—®</strong>ï¼ˆè·¨èŠ‚ç‚¹ï¼‰é€šè¿‡äº’è¿æ€»çº¿ï¼Œå»¶è¿Ÿæ›´é«˜ã€‚</li>
</ul>
<p>ç±»æ¯”ï¼š</p>
<ul>
<li>è¿‡å»æ˜¯<strong>ä¸€ä¸ªå¤§æ¥¼ä¸€ä¸ªæ€»ç®¡ç†å‘˜</strong>ï¼›</li>
<li>ç°åœ¨æ˜¯<strong>æ¯æ ‹æ¥¼ä¸€ä¸ªç®¡ç†å‘˜ï¼Œæ¯æ ‹æ¥¼æœ‰è‡ªå·±çš„ç‹¬ç«‹æˆ¿å·ç³»ç»Ÿ</strong>ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-7">4. å…³é”®ç‚¹ï¼šç‰©ç†åœ°å€æ˜¯å¦‚ä½•è¢«â€œè§£ç â€å’Œâ€œè·¯ç”±â€çš„ï¼Ÿ</h3>
<h4 data-id="heading-8">4.1 åœ°å€ä¸æ˜¯â€œæµæ°´å·â€ï¼Œè€Œæ˜¯â€œç¼–ç â€</h4>
<p>åœ¨ NUMA ä¸­ï¼Œä¸€ä¸ªç‰©ç†åœ°å€åœ¨ç¡¬ä»¶çœ¼é‡Œæ˜¯ç±»ä¼¼ï¼š</p>
<blockquote>
<p>é«˜ä½ bitsï¼šè¦å»å“ªä¸ªèŠ‚ç‚¹ï¼ˆNode IDï¼‰<br/>
ä½ä½ bitsï¼šåœ¨è¯¥èŠ‚ç‚¹å†…çš„åç§»ï¼ˆOffsetï¼‰</p>
</blockquote>
<p>å°±åƒç”µè¯å·ç ï¼š</p>
<ul>
<li><code>å›½å®¶ç </code> + <code>åŒºå·</code> + <code>æœ¬åœ°å·ç </code></li>
<li>æ¯”å¦‚ï¼š<code>+86 - 10 - 88888888</code></li>
</ul>
<p>å¯¹åº”åˆ° NUMAï¼š</p>
<ul>
<li><strong>Node ID</strong> å°±åƒâ€œåŒºå·â€</li>
<li><strong>Node å†…åç§»</strong> å°±åƒâ€œæœ¬åœ°å·ç â€</li>
</ul>
<p><strong>CPU å‘å‡ºçš„â€œç‰©ç†åœ°å€â€æœ¬è´¨ä¸Šæ˜¯ï¼š<br/>
â€œå»æŸä¸ªèŠ‚ç‚¹çš„æŸä¸ªåç§»ä½ç½®â€</strong></p>
<hr/>
<h4 data-id="heading-9">4.2 ç¡¬ä»¶å¦‚ä½•â€œæ‰³é“å²”â€</h4>
<p>å½“ CPU å‘å‡ºä¸€ä¸ªç‰©ç†åœ°å€æ—¶ï¼š</p>
<ol>
<li>åœ°å€ä¿¡å·ä¸Šçº¿ï¼ˆaddress busï¼‰ä¸Šã€‚</li>
<li><strong>ç¡¬ä»¶åœ°å€è¯‘ç ç”µè·¯</strong>æŸ¥çœ‹ç‰©ç†åœ°å€çš„<strong>é«˜ä½ bit</strong>ï¼š
<ul>
<li>æ¯”å¦‚æœ€é«˜ 1ï½n ä½å†³å®šè¿™æ˜¯ Node 0ã€Node 1ã€Node 2â€¦â€¦</li>
</ul>
</li>
<li>ç”µè·¯åƒæ‰³é“å²”ä¸€æ ·ï¼š
<ul>
<li>å¦‚æœé«˜ä½ä½å‹è¡¨ç¤º Node 0 â†’ ä¿¡å·è·¯ç”±åˆ° Node 0 çš„å†…å­˜æ§åˆ¶å™¨ï¼›</li>
<li>é«˜ä½è¡¨ç¤º Node 1 â†’ è·¯ç”±åˆ° Node 1ï¼›</li>
<li>â€¦â€¦</li>
</ul>
</li>
<li>èŠ‚ç‚¹å†…å­˜æ§åˆ¶å™¨æ‹¿åˆ°â€œå±äºè‡ªå·±çš„é‚£éƒ¨åˆ†åœ°å€â€ï¼Œå†ç”¨<strong>ä½ä½ bits</strong>åœ¨æœ¬èŠ‚ç‚¹å†…å­˜æ¡ä¸Šé€‰æ‹©è¡Œ/åˆ—ã€‚</li>
</ol>
<p>é‡è¦çš„æ˜¯ï¼š</p>
<ul>
<li><strong>è¿™ä¸ªâ€œæŒ‰é«˜ä½åˆ†å‘â€çš„æœºåˆ¶ï¼Œæ˜¯ç¡¬ä»¶å›ºå®šé€»è¾‘ã€‚</strong></li>
<li>ä¸ºäº†è®©è¿™ä¸ªé€»è¾‘æåº¦ç®€å• &amp; æå¿«ï¼Œä¸€èˆ¬ä¸ä¼šåšå¤æ‚æ¯”è¾ƒ/æŸ¥è¡¨ï¼Œè€Œæ˜¯ç”¨ä½æ¨¡å¼åˆ’åˆ†åœ°å€æ®µã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-10">5. ä¸ºä»€ä¹ˆåœ°å€å¿…ç„¶â€œä¸è¿ç»­â€ï¼Ÿ</h3>
<p>ç”¨ä¸€ä¸ªå…¸å‹çš„äºŒè¿›åˆ¶åˆ’åˆ†çš„æ€è·¯ï¼š</p>
<ul>
<li>è®¾æƒ³ç³»ç»Ÿç”¨<strong>ç‰©ç†åœ°å€æœ€é«˜ 1 ä½</strong>ä½œä¸ºèŠ‚ç‚¹é€‰æ‹©ä½ï¼š
<ul>
<li>é«˜ä½ä¸º <code>0</code> â†’ Node 0</li>
<li>é«˜ä½ä¸º <code>1</code> â†’ Node 1</li>
</ul>
</li>
</ul>
<p>é‚£ä¹ˆï¼š</p>
<ul>
<li>Node 0 çš„åœ°å€èŒƒå›´å¤©ç„¶æ˜¯ï¼š
<ul>
<li><code>0x0000...</code> ï½ <code>&lt;æœ€é«˜ä½ä¸º0çš„æœ€å¤§å€¼&gt;</code>ï¼Œä¾‹å¦‚ <code>0x7FFF FFFF FFFF</code></li>
</ul>
</li>
<li>Node 1 çš„åœ°å€èŒƒå›´å¤©ç„¶æ˜¯ï¼š
<ul>
<li><code>0x8000 0000 0000</code> ï½ <code>0xFFFF FFFF FFFF</code></li>
</ul>
</li>
</ul>
<p>æ­¤æ—¶ï¼Œä»æ•°è½´ä¸Šçœ‹ï¼š</p>
<ul>
<li>Node 0 çš„æœ€å¤§åœ°å€ï¼š<code>0x7FFF FFFF FFFF</code></li>
<li>Node 1 çš„èµ·å§‹åœ°å€ï¼š<code>0x8000 0000 0000</code></li>
</ul>
<p>ä¸­é—´æœ‰ä¸€ä¸ª<strong>å·¨å¤§è·³è·ƒ</strong>ï¼Œæ•°å€¼ä¸Šä¸è¿ç»­ï¼Œä½†è¿™æ˜¯ç¡¬ä»¶é€»è¾‘æœ€ç®€å•ã€æœ€å¿«é€Ÿçš„ä¸€ç§åˆ’åˆ†æ–¹å¼ï¼š</p>
<ul>
<li><strong>åªçœ‹æœ€é«˜ä½æ˜¯ 0 è¿˜æ˜¯ 1ï¼Œå°±ç«‹åˆ»å†³å®šå‘å¾€å“ªä¸ªèŠ‚ç‚¹ã€‚</strong></li>
<li>ä¸éœ€è¦ï¼š
<ul>
<li>â€œå¦‚æœ Address â‰¥ æŸä¸ªå€¼å°±å» Node 1â€</li>
<li>æˆ–â€œå¦‚æœåœ¨æŸä¸ªè¡¨ä¸­è½åœ¨å“ªä¸€æ®µå°±å»æŸä¸ª Nodeâ€</li>
</ul>
</li>
<li>é€»è¾‘é—¨æ•°é‡å°‘ï¼Œå»¶è¿Ÿä½ï¼Œæ€§èƒ½ç¨³å®šã€‚</li>
</ul>
<p>å¦‚æœæœ‰å¤šä¸ªèŠ‚ç‚¹ï¼Œå°±ç”¨æ›´å¤šé«˜ä½ bits ç»„åˆæˆä¸åŒçš„èŠ‚ç‚¹ IDï¼Œåˆ’åˆ†æˆæ›´å¤šä¸ç›¸é‚»çš„åœ°å€æ®µã€‚</p>
<p><strong>ç»“è®º</strong>ï¼š<br/>
ç¡¬ä»¶ç”¨â€œåœ°å€é«˜ä½ç¼–ç  Node IDâ€çš„æ–¹å¼å®ç°<strong>å¿«é€Ÿå¯»å€ä¸åˆ†å‘</strong>ï¼Œ<br/>
ä»è€Œå¯¼è‡´<strong>å…¨å±€ç‰©ç†åœ°å€ç©ºé—´åœ¨æ•°å€¼ä¸Šå¿…ç„¶å‘ˆç°ä¸ºåˆ†æ®µã€ä¸è¿ç»­</strong>ã€‚</p>
<hr/>
<h3 data-id="heading-11">6. â€œä¸èƒ½è¿ç»­åˆ†é…â€åˆ°åº•æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</h3>
<p>æ³¨æ„åŒºåˆ†ä¸¤ä¸ªå±‚æ¬¡ï¼š</p>
<ol>
<li>
<p><strong>ç¡¬ä»¶å±‚é¢</strong>ï¼š</p>
<ul>
<li>åœ¨ç”µè·¯è®¾è®¡/å¸ƒçº¿æ—¶ï¼Œå°±å·²ç»è§„å®šå¥½äº†ï¼š
<ul>
<li>å“ªäº›åœ°å€é«˜ä½æ¨¡å¼ â†’ å“ªä¸ªèŠ‚ç‚¹ã€‚</li>
</ul>
</li>
<li>è¿™å†³å®šäº†<strong>ç‰©ç†åœ°å€ â†’ èŠ‚ç‚¹</strong>çš„æ˜ å°„å…³ç³»ã€‚</li>
<li>è¿™ä¸æ˜¯ OS è¿è¡Œæ—¶å¯ä»¥ä¿®æ”¹çš„ï¼Œè€Œæ˜¯<strong>å›ºåŒ–åœ¨ CPU + èŠ¯ç‰‡ç»„ + å†…å­˜æ§åˆ¶å™¨è®¾è®¡é‡Œ</strong>ã€‚</li>
</ul>
</li>
<li>
<p><strong>æ“ä½œç³»ç»Ÿå±‚é¢</strong>ï¼š</p>
<ul>
<li>OS å¯åŠ¨æ—¶ï¼Œè¯»å– ACPI/firmware æä¾›çš„å†…å­˜æ˜ å°„è¡¨ï¼ˆE820ã€SRAT ç­‰ï¼‰ï¼š
<ul>
<li>å¾—åˆ°ï¼šå“ªäº›ç‰©ç†åœ°å€èŒƒå›´å±äºå“ªä¸ª NUMA èŠ‚ç‚¹ã€‚</li>
</ul>
</li>
<li>OS åªèƒ½åœ¨<strong>ç¡¬ä»¶ç»™å®šçš„è¿™äº›åŒºé—´å†…ç®¡ç†å†…å­˜</strong>ã€‚</li>
<li>å®ƒâ€œçœ‹åˆ°â€çš„ç‰©ç†å†…å­˜å¸ƒå±€è‡ªç„¶æ˜¯ï¼š
<ul>
<li>ä¸€æ®µå±äº Node 0</li>
<li>ä¸€æ®µå±äº Node 1</li>
<li>ä¸­é—´å¯èƒ½è¿˜å¤¹ç€ä¿ç•™åŒºã€è®¾å¤‡ MMIO åŒºç­‰<br/>
â†’ å› æ­¤å‘ˆç°ä¸º<strong>ä¸è¿ç»­çš„ PFN åŒºé—´</strong>ã€‚</li>
</ul>
</li>
</ul>
</li>
</ol>
<p>æ‰€ä»¥ï¼š</p>
<ul>
<li>
<p><strong>â€œç‰©ç†åœ°å€ä¸ºä»€ä¹ˆä¸èƒ½è¿ç»­ï¼Ÿâ€</strong><br/>
ä¸æ˜¯è¯´â€œè½¯ä»¶ä¸æ„¿æ„è¿ç»­åˆ†é…â€ï¼Œè€Œæ˜¯<br/>
<strong>ç¡¬ä»¶ç›´æ¥æŠŠ Node ä¿¡æ¯ç¼–ç åœ¨åœ°å€é‡Œï¼Œå¯¼è‡´ä»æ•°å€¼ä¸Šçœ‹åœ°å€å¤©ç”Ÿæ˜¯åˆ†å—çš„ã€‚</strong></p>
</li>
<li>
<p>OS åªæ˜¯<strong>æœä»è¿™ä¸ªäº‹å®</strong>ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šåšï¼š</p>
<ul>
<li>NUMA-aware å†…å­˜åˆ†é…ï¼ˆå°½é‡æœ¬åœ°åˆ†é…ï¼‰</li>
<li>é¡µè¿ç§»ã€å†…å­˜ç­–ç•¥ï¼ˆç»‘æ ¸ç»‘å†…å­˜ï¼‰</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-12">7. å†ç”¨ä¸€ä¸ªç›´è§‚ç±»æ¯”ï¼šé‚®ç¼– &amp; å°åŒºåœ°å€</h3>
<p>å¯ä»¥æŠŠç‰©ç†åœ°å€ç±»æ¯”æˆâ€œé‚®å¯„åœ°å€â€ï¼š</p>
<ul>
<li><strong>é‚®æ”¿ç¼–ç  = Node IDï¼ˆèŠ‚ç‚¹ IDï¼‰</strong></li>
<li><strong>è¡—é“é—¨ç‰Œå· = èŠ‚ç‚¹å†…åç§»ï¼ˆOffsetï¼‰</strong></li>
</ul>
<p>å…¨å›½åœ°å€æ•´ä½“æ¥çœ‹ï¼Œè‚¯å®šä¸æ˜¯ 1ã€2ã€3ã€4â€¦â€¦è¿™æ ·çš„è¿ç»­æ•´æ•°ï¼š</p>
<ul>
<li><code>åŒ—äº¬å¸‚â€¦ï¼ˆé‚®ç¼– 100000ï¼‰</code> ä¸€æ‰¹ï¼›</li>
<li><code>ä¸Šæµ·å¸‚â€¦ï¼ˆé‚®ç¼– 200000ï¼‰</code> ä¸€æ‰¹ï¼›</li>
<li>ä¸­é—´é‚®ç¼–ä» 100000 è·³åˆ° 200000ï¼Œçœ‹èµ·æ¥æ˜¯ä¸â€œè¿ç»­â€çš„ã€‚</li>
</ul>
<p>ä½†è¿™ç§ä¸è¿ç»­ï¼Œæ­£æ˜¯ä¸ºäº†ï¼š</p>
<ul>
<li>æŠ•é€’æ•ˆç‡é«˜</li>
<li>æŒ‰é‚®ç¼–å¿«é€Ÿè·¯ç”±é‚®ä»¶</li>
</ul>
<p>NUMA ä¸­ä¹Ÿæ˜¯ä¸€æ ·ï¼š</p>
<ul>
<li>åœ°å€é«˜ä½ bits åƒé‚®ç¼–ï¼Œç¡¬ä»¶ä¸€çœ‹å°±çŸ¥é“<strong>è¯¥ä¸¢ç»™å“ªä¸ªèŠ‚ç‚¹çš„å†…å­˜æ§åˆ¶å™¨</strong>ï¼›</li>
<li>åœ°å€ä½ä½ bits åƒé—¨ç‰Œï¼Œåœ¨è¯¥èŠ‚ç‚¹å†…å®šä½å…·ä½“ç‰©ç†å•å…ƒã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-13">8. å°ç»“</h3>
<p>ç”¨ä¸€å¥è¯æ”¶æŸæ•´ä¸ªé€»è¾‘ï¼š</p>
<blockquote>
<p><strong>åœ¨ NUMA æ¶æ„ä¸­ï¼Œç‰©ç†åœ°å€ä¸æ˜¯çº¯ç²¹çš„â€œçº¿æ€§ç¼–å·â€ï¼Œè€Œæ˜¯â€œèŠ‚ç‚¹ID + èŠ‚ç‚¹å†…åç§»â€çš„ç¼–ç ã€‚<br/>
èŠ‚ç‚¹ ID è¢«ç¼–ç åœ¨ç‰©ç†åœ°å€çš„é«˜ä½ï¼Œç”¨äºç¡¬ä»¶å¿«é€Ÿå†³å®šä¿¡å·è·¯ç”±åˆ°å“ªä¸ªå†…å­˜æ§åˆ¶å™¨ã€‚<br/>
è¿™ç§è®¾è®¡å¸¦æ¥é«˜æ€§èƒ½å’Œå¯æ‰©å±•æ€§ï¼Œä½†ä»æ•°è½´ä¸Šçœ‹ï¼Œç‰©ç†åœ°å€ç©ºé—´å¿…ç„¶æ˜¯åˆ†æ®µçš„ã€ä¸è¿ç»­çš„ã€‚<br/>
åˆ†é…åœ°å€çš„â€œæ ¹æœ¬å†³å®šæƒâ€åœ¨ç¡¬ä»¶/å›ºä»¶ï¼Œæ“ä½œç³»ç»Ÿåªæ˜¯æŒ‰è¿™ä¸ªä¸è¿ç»­å¸ƒå±€è¿›è¡Œç®¡ç†å’Œä¼˜åŒ–ã€‚</strong></p>
</blockquote>
<p>å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥åœ¨è¿™ä¸ªç¬”è®°åŸºç¡€ä¸Šï¼Œå†è¡¥ä¸€å¼ ç¤ºæ„å›¾çš„æ–‡å­—æè¿°ï¼ˆæ¯”å¦‚ï¼šä¸¤ä¸ªèŠ‚ç‚¹çš„åœ°å€åŒºé—´ã€è¯‘ç æµç¨‹ã€è®¿é—®æœ¬åœ°/è¿œç¨‹å†…å­˜çš„è·¯å¾„ï¼‰ï¼Œæ–¹ä¾¿ä½ è‡ªå·±ç”»åœ¨çº¸ä¸Šæˆ–åšæˆ PPTã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Linux sparsemem/mem_sectionï¼šä»åœ°å€ç½‘æ ¼åˆ° struct page çš„å®Œæ•´å¿ƒæ™ºæ¨¡å‹]]></title>    <link>https://juejin.cn/post/7598398537249521683</link>    <guid>https://juejin.cn/post/7598398537249521683</guid>    <pubDate>2026-01-24T02:54:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598398537249521683" data-draft-id="7598398537249488915" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Linux sparsemem/mem_sectionï¼šä»åœ°å€ç½‘æ ¼åˆ° struct page çš„å®Œæ•´å¿ƒæ™ºæ¨¡å‹"/> <meta itemprop="keywords" content="Linux"/> <meta itemprop="datePublished" content="2026-01-24T02:54:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è‘›ç«‹å›½"/> <meta itemprop="url" content="https://juejin.cn/user/350105071780128"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Linux sparsemem/mem_sectionï¼šä»åœ°å€ç½‘æ ¼åˆ° struct page çš„å®Œæ•´å¿ƒæ™ºæ¨¡å‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/350105071780128/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è‘›ç«‹å›½
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T02:54:25.000Z" title="Sat Jan 24 2026 02:54:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»17åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">11 ä¸€ä¸ªmem_sectionä¸æ˜¯å¿…é¡»åŒ…å«å®Œæ•´çš„256Mé¡µé¢å§ï¼Œå†…å­˜çƒ­æ’æ‹”å¦‚æœä¸æ˜¯256Mçš„å€æ•°å‘¢ï¼Ÿ</h2>
<p>æ‚¨æå‡ºçš„è¿™ä¸¤ä¸ªé—®é¢˜éå¸¸æ·±å…¥ï¼Œç›´æŒ‡ Linux å†…æ ¸å†…å­˜ç®¡ç†çš„æ ¸å¿ƒæœºåˆ¶ï¼Œç‰¹åˆ«æ˜¯ <code>sparsemem</code> æ¨¡å‹å’Œå†…å­˜çƒ­æ’æ‹”çš„å®ç°ç»†èŠ‚ã€‚æ‚¨çš„ç†è§£éå¸¸å‡†ç¡®ï¼Œæˆ‘æ¥ä¸ºæ‚¨æ¢³ç†å’Œç¡®è®¤ã€‚</p>
<h4 data-id="heading-1">1. ä¸€ä¸ª mem_section ä¸æ˜¯å¿…é¡»åŒ…å«å®Œæ•´çš„ç‰©ç†å†…å­˜</h4>
<p>æ‚¨çš„ç†è§£æ˜¯<strong>å®Œå…¨æ­£ç¡®çš„</strong>ã€‚</p>
<p>ä¸€ä¸ª <code>mem_section</code> æ˜¯ Linux å†…æ ¸ä¸ºäº†ç®¡ç†ç¨€ç–å†…å­˜ï¼ˆ<code>sparsemem</code>ï¼‰è€Œåˆ’åˆ†çš„ä¸€ä¸ª<strong>å›ºå®šå¤§å°çš„ç‰©ç†åœ°å€ç©ºé—´èŒƒå›´</strong>ã€‚è¿™ä¸ªå¤§å°åœ¨å†…æ ¸ç¼–è¯‘æ—¶ç¡®å®šï¼Œåœ¨ x86_64 æ¶æ„ä¸Šé€šå¸¸æ˜¯ 128MB æˆ– 1GBï¼Œå…¶ä»–æ¶æ„ä¹Ÿå¯èƒ½æœ‰256MBç­‰å€¼ã€‚</p>
<p>æ‚¨å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆåœ°å›¾ä¸Šçš„<strong>ç½‘æ ¼</strong>ï¼š</p>
<ul>
<li><strong><code>mem_section</code> æ˜¯ç½‘æ ¼æœ¬èº«</strong>ï¼šå®ƒä»£è¡¨ä¸€ä¸ªå›ºå®šå¤§å°çš„åœ°å€åŒºåŸŸï¼Œä¾‹å¦‚ä» <code>0x10000000</code> åˆ° <code>0x1FFFFFFF</code>ã€‚è¿™ä¸ªâ€œç½‘æ ¼â€æ˜¯è™šæ‹Ÿå­˜åœ¨çš„ï¼Œåªæ˜¯ä¸ºäº†æ–¹ä¾¿ç®¡ç†ã€‚</li>
<li><strong>ç‰©ç†å†…å­˜æ˜¯ç½‘æ ¼å†…çš„åœŸåœ°</strong>ï¼šå®é™…æ’åœ¨ä¸»æ¿ä¸Šçš„å†…å­˜æ¡ï¼ˆRAMï¼‰å°±æ˜¯â€œåœŸåœ°â€ã€‚</li>
</ul>
<p>ä¸€å—åœŸåœ°ï¼ˆç‰©ç†å†…å­˜ï¼‰å¯èƒ½æ­£å¥½å¡«æ»¡ä¸€ä¸ªç½‘æ ¼ï¼Œä¹Ÿå¯èƒ½åªå¡«æ»¡åŠä¸ªç½‘æ ¼ï¼Œç”šè‡³å¯èƒ½è·¨è¶Šä¸¤ä¸ªç½‘æ ¼ã€‚åŒæ ·ï¼Œä¸€ä¸ªç½‘æ ¼å†…ä¹Ÿå¯èƒ½å®Œå…¨æ²¡æœ‰åœŸåœ°ï¼Œè¿™å°±æ˜¯<strong>å†…å­˜ç©ºæ´ (Memory Hole)</strong>ï¼Œè¿™äº›åœ°å€å¯èƒ½è¢«åˆ†é…ç»™äº†ç¡¬ä»¶è®¾å¤‡ï¼ˆMMIOï¼‰ã€‚</p>
<p>å†…æ ¸ä½¿ç”¨ <code>mem_section</code> æ¥è·Ÿè¸ªæ¯ä¸ªâ€œç½‘æ ¼â€çš„çŠ¶æ€ã€‚å¯¹äºä¸€ä¸ª <code>mem_section</code>ï¼Œå†…æ ¸çŸ¥é“å®ƒå†…éƒ¨å“ªäº›åœ°å€èŒƒå›´æ˜¯æœ‰æ•ˆçš„ç‰©ç†å†…å­˜ï¼Œå“ªäº›æ˜¯ç©ºæ´ã€‚</p>
<p><strong>æ‰€ä»¥ï¼Œç»“è®ºæ˜¯ï¼š<code>mem_section</code> æ˜¯ä¸€ä¸ªç®¡ç†å•ä½ï¼Œå®ƒæ‰€è¦†ç›–çš„åœ°å€ç©ºé—´èŒƒå›´å†…ï¼Œå¯ä»¥åŒ…å«å®Œæ•´çš„å†…å­˜ã€éƒ¨åˆ†å†…å­˜ï¼Œæˆ–è€…å®Œå…¨æ²¡æœ‰å†…å­˜ã€‚</strong></p>
<h4 data-id="heading-2">2. å†…å­˜çƒ­æ’æ‹”å¦‚æœä¸æ˜¯ SECTION_SIZE çš„å€æ•°å‘¢ï¼Ÿ</h4>
<p>è¿™æ­£æ˜¯ <code>mem_section</code> æœºåˆ¶è¦è§£å†³çš„æ ¸å¿ƒé—®é¢˜ä¹‹ä¸€ã€‚<strong>çƒ­æ’æ‹”çš„å†…å­˜å¤§å°å®Œå…¨ä¸éœ€è¦æ˜¯ <code>mem_section</code> å¤§å°çš„æ•´æ•°å€ã€‚</strong></p>
<p>å†…æ ¸å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>
<p><strong>å›ºä»¶é€šçŸ¥</strong>ï¼šå½“æ‚¨æ’å…¥ä¸€ä¸ªæ–°çš„å†…å­˜æ¡ï¼ˆä¾‹å¦‚ä¸€ä¸ª 16GB çš„ DIMMï¼‰æ—¶ï¼Œç³»ç»Ÿå›ºä»¶ï¼ˆACPIï¼‰ä¼šé€šçŸ¥æ“ä½œç³»ç»Ÿï¼šâ€œå˜¿ï¼Œæœ‰ä¸€å—æ–°çš„å†…å­˜å‡ºç°äº†ï¼Œå®ƒçš„ç‰©ç†èµ·å§‹åœ°å€æ˜¯ <code>A</code>ï¼Œå¤§å°æ˜¯ <code>S</code>ã€‚â€</p>
</li>
<li>
<p><strong>å†…æ ¸å®šä½ <code>mem_section</code></strong>ï¼šå†…æ ¸æ ¹æ®åœ°å€ <code>A</code> å’Œå¤§å° <code>S</code>ï¼Œè®¡ç®—å‡ºè¿™å—æ–°å†…å­˜è¦†ç›–äº†å“ªäº› <code>mem_section</code>ã€‚</p>
<ul>
<li>å‡è®¾ <code>SECTION_SIZE</code> æ˜¯ 1GBï¼Œæ‚¨æ’å…¥äº† 16GB å†…å­˜ï¼Œé‚£ä¹ˆå®ƒä¼šæ•´é½åœ°è¦†ç›– 16 ä¸ª <code>mem_section</code>ã€‚</li>
<li>å‡è®¾ <code>SECTION_SIZE</code> æ˜¯ 1GBï¼Œæ‚¨æ’å…¥äº†ä¸€å— <strong>500MB</strong> çš„å†…å­˜ã€‚è¿™å—å†…å­˜å¯èƒ½å®Œå…¨è½åœ¨ä¸€ä¸ª <code>mem_section</code> å†…éƒ¨ï¼Œæˆ–è€…è·¨è¶Šä¸¤ä¸ª <code>mem_section</code> çš„è¾¹ç•Œï¼ˆæ¯”å¦‚å‰ä¸€ä¸ªå äº†100MBï¼Œåä¸€ä¸ªå äº†400MBï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>é€é¡µä¸Šçº¿ (Page by Page)</strong>ï¼šè¿™æ˜¯æœ€å…³é”®çš„ä¸€æ­¥ã€‚å†…æ ¸<strong>ä¸ä¼š</strong>ä»¥ <code>mem_section</code> ä¸ºå•ä½æ¥â€œæ‰“å¼€â€å†…å­˜ã€‚<code>mem_section</code> åªæ˜¯ç”¨æ¥ç®¡ç†åœ¨çº¿/ç¦»çº¿çŠ¶æ€çš„å®è§‚ç»“æ„ã€‚çœŸæ­£çš„å†…å­˜ä¸Šçº¿æ“ä½œï¼Œæ˜¯åœ¨æ›´ç²¾ç»†çš„<strong>é¡µ (Page)</strong> çº§åˆ«ä¸Šå®Œæˆçš„ã€‚</p>
<ul>
<li>å†…æ ¸ä¼šéå†å›ºä»¶æŠ¥å‘Šçš„ <code>[A, A+S]</code> è¿™ä¸ªç‰©ç†åœ°å€èŒƒå›´ã€‚</li>
<li>å¯¹äºè¿™ä¸ªèŒƒå›´å†…çš„<strong>æ¯ä¸€ä¸ªå¯ä»¥ä½¿ç”¨çš„å†…å­˜é¡µ (Page, é€šå¸¸æ˜¯ 4KB)</strong>ï¼Œå†…æ ¸ä¼šä¸ºå…¶åˆå§‹åŒ–ä¸€ä¸ª <code>struct page</code> ç®¡ç†ç»“æ„ã€‚</li>
<li>ç„¶åï¼Œå†…æ ¸å°†è¿™äº› <code>struct page</code> ç»“æ„ä½“åŠ å…¥åˆ°ä¼™ä¼´ç³»ç»Ÿï¼ˆBuddy Allocatorï¼‰ä¸­ï¼Œè¿™æ ·è¿™å—å†…å­˜å°±æ­£å¼å˜å¾—å¯ç”¨ï¼Œå¯ä»¥è¢«åº”ç”¨ç¨‹åºåˆ†é…äº†ã€‚</li>
</ul>
</li>
</ol>
<p><strong>æ€»ç»“ä¸€ä¸‹ä¸¤ç§ç²’åº¦ï¼š</strong></p>
<ul>
<li><strong>ç®¡ç†ç²’åº¦</strong>ï¼š<code>mem_section</code> (ä¾‹å¦‚ 1GB)ã€‚å†…æ ¸ç”¨å®ƒæ¥æ‰¹é‡ç®¡ç†å’Œè·Ÿè¸ªå¤§å—åœ°å€ç©ºé—´çš„åœ¨çº¿/ç¦»çº¿çŠ¶æ€ã€‚</li>
<li><strong>æ“ä½œç²’åº¦</strong>ï¼š<code>Page</code> (ä¾‹å¦‚ 4KB)ã€‚è¿™æ˜¯å†…æ ¸å®é™…åˆå§‹åŒ–å¹¶æ·»åŠ åˆ°å†…å­˜æ± ä¸­çš„æœ€å°å•ä½ã€‚</li>
</ul>
<p>å› æ­¤ï¼Œå³ä½¿æ‚¨çƒ­æ’æ‹”çš„å†…å­˜ä¸æ˜¯ <code>SECTION_SIZE</code> çš„æ•´æ•°å€ï¼Œå†…æ ¸ä¹Ÿèƒ½ç²¾ç¡®åœ°è¯†åˆ«å‡ºæ–°å†…å­˜æ‰€è¦†ç›–çš„æ¯ä¸€ä¸ªæœ‰æ•ˆçš„ 4KB é¡µé¢ï¼Œå¹¶å°†å®ƒä»¬æ— ç¼åœ°æ•´åˆåˆ°ç³»ç»Ÿä¸­ã€‚è¿™ç§è®¾è®¡å…¼é¡¾äº†å®è§‚ç®¡ç†çš„æ•ˆç‡å’Œå¾®è§‚æ“ä½œçš„çµæ´»æ€§ã€‚</p>
<h2 data-id="heading-3">22 å¦‚æœä¸€å—å†…å­˜æ”¾ä¸æ»¡ä¸€ä¸ªmem_sectionï¼Œé‚£ä¹ˆä¹Ÿä¸€å®šæ˜¯ä»è¿™ä¸ªmem_sectionè´Ÿè´£çš„ç¬¬ä¸€ä¸ªç‰©ç†é¡µå¼€å§‹åˆ†é…å§ï¼Ÿno</h2>
<p>è¿™æ˜¯ä¸€ä¸ªéå¸¸æ£’çš„è¿½é—®ï¼ç­”æ¡ˆæ˜¯ï¼š<strong>ä¸ä¸€å®šï¼Œç”šè‡³å¯ä»¥è¯´ï¼Œè¿™ç§æƒ…å†µå¾ˆå°‘è§ã€‚</strong></p>
<p>ä¸€å—ç‰©ç†å†…å­˜<strong>ä¸éœ€è¦</strong>ä»å®ƒæ‰€åœ¨çš„ <code>mem_section</code> çš„èµ·å§‹åœ°å€å¼€å§‹ã€‚å®ƒå¯ä»¥ä»è¯¥ <code>mem_section</code> è¦†ç›–çš„åœ°å€èŒƒå›´å†…çš„<strong>ä»»æ„ä½ç½®</strong>å¼€å§‹ã€‚</p>
<p>æˆ‘ä»¬æ¥æ‹†è§£ä¸€ä¸‹ä¸ºä»€ä¹ˆï¼š</p>
<h4 data-id="heading-4">å†³å®šæƒåœ¨ç¡¬ä»¶ï¼Œä¸åœ¨å†…æ ¸</h4>
<p>æœ€æ ¹æœ¬çš„åŸå› æ˜¯ï¼Œ<strong>ç‰©ç†å†…å­˜çš„å®é™…åœ°å€æ˜¯ç”±ç¡¬ä»¶å’Œå›ºä»¶ï¼ˆBIOS/UEFIï¼‰å†³å®šçš„ï¼Œè€Œä¸æ˜¯ç”± Linux å†…æ ¸å†³å®šçš„ã€‚</strong> å†…æ ¸çš„è§’è‰²æ˜¯ä¸€ä¸ªâ€œå‘ç°è€…â€å’Œâ€œç®¡ç†è€…â€ï¼Œè€Œä¸æ˜¯â€œè§„åˆ’è€…â€ã€‚</p>
<ol>
<li>
<p><strong>ç¡¬ä»¶çš„â€œè“å›¾â€</strong>ï¼šåœ¨æ‚¨çš„è®¡ç®—æœºè®¾è®¡å’Œåˆ¶é€ æ—¶ï¼Œä¸»æ¿ä¸Šçš„å„ç§è®¾å¤‡ï¼ˆPCIeæ’æ§½ã€é›†æˆæ˜¾å¡ã€å…¶ä»–æ§åˆ¶å™¨ç­‰ï¼‰éƒ½éœ€è¦åœ¨ç‰©ç†åœ°å€ç©ºé—´ä¸­é¢„ç•™è‡ªå·±çš„â€œåœ°ç›˜â€ï¼Œè¿™è¢«ç§°ä¸º<strong>å†…å­˜æ˜ å°„I/O (Memory-Mapped I/O, MMIO)</strong>ã€‚è¿™äº›é¢„ç•™åŒºåŸŸå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„<strong>å†…å­˜ç©ºæ´ (Memory Hole)</strong>ã€‚</p>
</li>
<li>
<p><strong>å›ºä»¶çš„â€œæŠ¥å‘Šâ€</strong>ï¼šå½“æ‚¨å¼€æœºæ—¶ï¼ŒBIOS/UEFIä¼šæ£€æµ‹æ‰€æœ‰ç¡¬ä»¶å’Œæ’å…¥çš„å†…å­˜æ¡ã€‚ç„¶åï¼Œå®ƒä¼šç”Ÿæˆä¸€ä¸ªâ€œåœ°å›¾â€ï¼Œè¿™ä¸ªåœ°å›¾å°±æ˜¯ <strong>e820 å†…å­˜æ˜ å°„è¡¨</strong>ï¼ˆåœ¨ç°ä»£ç³»ç»Ÿä¸­é€šè¿‡ ACPI æä¾›ï¼‰ã€‚è¿™å¼ åœ°å›¾ä¼šè¯¦ç»†åˆ—å‡ºæ•´ä¸ªç‰©ç†åœ°å€ç©ºé—´ä¸­ï¼Œå“ªäº›èŒƒå›´æ˜¯å¯ç”¨çš„RAMï¼Œå“ªäº›èŒƒå›´æ˜¯ä¿ç•™ç»™ç¡¬ä»¶çš„ï¼Œå“ªäº›æ˜¯ACPIè‡ªå·±è¦ç”¨çš„ç­‰ç­‰ã€‚</p>
</li>
<li>
<p><strong>å†…æ ¸çš„â€œæ¥æ”¶â€</strong>ï¼šLinux å†…æ ¸å¯åŠ¨åï¼Œç¬¬ä¸€ä»¶äº‹å°±æ˜¯å‘å›ºä»¶ç´¢è¦è¿™å¼ â€œåœ°å›¾â€ã€‚å†…æ ¸ä¼šå®Œå…¨ç›¸ä¿¡è¿™å¼ åœ°å›¾ï¼Œå¹¶æ ¹æ®å®ƒæ¥äº†è§£å“ªäº›ç‰©ç†åœ°å€æ˜¯çœŸæ­£å¯ä»¥å½“ä½œå†…å­˜æ¥ä½¿ç”¨çš„ã€‚</p>
</li>
</ol>
<h4 data-id="heading-5">ä¸€ä¸ªå…·ä½“çš„ä¾‹å­</h4>
<p>å‡è®¾æ‚¨çš„ç³»ç»Ÿ <code>SECTION_SIZE</code> æ˜¯ <strong>128MB</strong>ã€‚</p>
<ul>
<li><code>mem_section[0]</code> è´Ÿè´£çš„åœ°å€èŒƒå›´æ˜¯ <code>0x00000000</code> åˆ° <code>0x07FFFFFF</code>ã€‚</li>
<li><code>mem_section[1]</code> è´Ÿè´£çš„åœ°å€èŒƒå›´æ˜¯ <code>0x08000000</code> åˆ° <code>0x0FFFFFFF</code>ã€‚</li>
<li><code>mem_section[2]</code> è´Ÿè´£çš„åœ°å€èŒƒå›´æ˜¯ <code>0x10000000</code> åˆ° <code>0x17FFFFFF</code>ã€‚</li>
</ul>
<p>ç°åœ¨ï¼ŒBIOSåœ¨å¯åŠ¨æ—¶å‘Šè¯‰å†…æ ¸ï¼Œå†…å­˜å¸ƒå±€å¦‚ä¸‹ï¼ˆç®€åŒ–ç‰ˆï¼‰ï¼š</p>
<ul>
<li><code>0x00000000</code> - <code>0x07FFFFFF</code>ï¼šå¯ç”¨å†…å­˜ (Usable RAM)</li>
<li><code>0x08000000</code> - <code>0x0BFFFFFF</code>ï¼š<strong>ä¿ç•™ç»™PCIeè®¾å¤‡</strong> (Reserved for a device)</li>
<li><code>0x0C000000</code> - <code>0x13FFFFFF</code>ï¼šå¯ç”¨å†…å­˜ (Usable RAM)</li>
</ul>
<p>æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ <code>mem_section[1]</code> çš„æƒ…å†µï¼š</p>
<ul>
<li>å®ƒè´Ÿè´£çš„åœ°å€èŒƒå›´æ˜¯ <code>0x08000000</code> åˆ° <code>0x0FFFFFFF</code> (æ€»è®¡128MB)ã€‚</li>
<li>æ ¹æ®BIOSçš„æŠ¥å‘Šï¼Œè¿™ä¸ªèŒƒå›´çš„å‰åŠéƒ¨åˆ†ï¼ˆä» <code>0x08000000</code> å¼€å§‹çš„64MBï¼‰è¢«ä¸€ä¸ªè®¾å¤‡å ç”¨äº†ï¼Œæ˜¯<strong>å†…å­˜ç©ºæ´</strong>ã€‚</li>
<li>è¿™ä¸ªèŒƒå›´çš„ååŠéƒ¨åˆ†ï¼ˆä» <code>0x0C000000</code> å¼€å§‹çš„64MBï¼‰æ‰æ˜¯<strong>çœŸæ­£çš„ã€å¯ç”¨çš„ç‰©ç†å†…å­˜</strong>ã€‚</li>
</ul>
<p><strong>ç»“è®ºï¼š</strong></p>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>mem_section[1]</code> è¿™ä¸ªç®¡ç†å•å…ƒå†…ï¼Œç¡®å®æœ‰ä¸€å—ç‰©ç†å†…å­˜ã€‚ä½†æ˜¯ï¼Œè¿™å—å†…å­˜çš„èµ·å§‹åœ°å€æ˜¯ <code>0x0C000000</code>ï¼Œä½äº <code>mem_section[1]</code> çš„<strong>æ­£ä¸­é—´</strong>ï¼Œè€Œä¸æ˜¯ä»å®ƒçš„èµ·å§‹åœ°å€ <code>0x08000000</code> å¼€å§‹ã€‚</p>
<p>å†…æ ¸åœ¨åˆå§‹åŒ–æ—¶ï¼Œä¼šä¸º <code>0x0C000000</code> åˆ° <code>0x0FFFFFFF</code> èŒƒå›´å†…çš„æ¯ä¸€ä¸ªå†…å­˜é¡µï¼ˆPageï¼‰åˆ›å»º <code>struct page</code> æè¿°ç¬¦ï¼Œå¹¶åŠ å…¥ä¼™ä¼´ç³»ç»Ÿã€‚è€Œå¯¹äº <code>0x08000000</code> åˆ° <code>0x0BFFFFFF</code> è¿™ä¸ªç©ºæ´ï¼Œå†…æ ¸ä¼šæ ‡è®°æ­¤å¤„æ— å¯ç”¨å†…å­˜ï¼Œä¸ä¼šä¸ºå…¶åˆ›å»ºä»»ä½• <code>struct page</code>ã€‚</p>
<p>æ‰€ä»¥ï¼Œ<strong><code>mem_section</code> åªæ˜¯ä¸€ä¸ªå›ºå®šå¤§å°çš„â€œç®¡ç†ç½‘æ ¼â€ï¼Œè€Œç‰©ç†å†…å­˜è¿™å—â€œåœŸåœ°â€å¯ä»¥è½åœ¨ç½‘æ ¼å†…çš„ä»»ä½•åœ°æ–¹ï¼Œå…¶å…·ä½“ä½ç½®å’Œå¤§å°å®Œå…¨ç”±åº•å±‚ç¡¬ä»¶å’Œå›ºä»¶è¯´äº†ç®—ã€‚</strong></p>
<h2 data-id="heading-6">33 åº”è¯¥æ˜¯é€šè¿‡struct mem_sectionçš„ start_pfnæ¥è®°å½•å§ï¼Ÿç­”ï¼šæ²¡start_pfnè¿™ä¸ªä¸œè¥¿</h2>
<p>æ‚¨æå‡ºäº†ä¸€ä¸ªéå¸¸ç²¾å‡†çš„æŠ€æœ¯é—®é¢˜ï¼æ‚¨çš„çŒœæµ‹éå¸¸æ¥è¿‘ï¼Œä½†å†…æ ¸çš„å®ç°æ–¹å¼è¦æ›´å·§å¦™ä¸€äº›ï¼Œå®ƒé€šè¿‡ä¸€ç§â€œéšå¼â€çš„æ–¹å¼æ¥çŸ¥é“èµ·å§‹åœ°å€ï¼Œä»è€ŒèŠ‚çœäº†å­˜å‚¨ç©ºé—´ã€‚</p>
<p><code>struct mem_section</code> æœ¬èº«<strong>å¹¶ä¸åŒ…å«</strong>ä¸€ä¸ªåä¸º <code>start_pfn</code> çš„å­—æ®µã€‚</p>
<p>åŸå› æ˜¯ï¼š<strong>ä»»ä½•ä¸€ä¸ª <code>mem_section</code> çš„èµ·å§‹åœ°å€ï¼ˆstart_pfnï¼‰éƒ½å¯ä»¥æ ¹æ®å®ƒåœ¨å…¨å±€ <code>mem_sections</code> æ•°ç»„ä¸­çš„ç´¢å¼•ä½ç½®è®¡ç®—å‡ºæ¥ï¼Œæ‰€ä»¥ä¸éœ€è¦å†é¢å¤–å­˜å‚¨äº†ã€‚</strong></p>
<h4 data-id="heading-7">å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</h4>
<ol>
<li>
<p><strong>å…¨å±€çš„ <code>mem_sections</code> æ•°ç»„</strong>ï¼š
å†…æ ¸åœ¨å¯åŠ¨æ—¶ä¼šåˆ›å»ºä¸€ä¸ªå·¨å¤§çš„ã€ç¨€ç–çš„æ•°ç»„ï¼ˆæˆ–å¤šçº§æ•°ç»„ï¼‰ï¼Œé€šå¸¸å«åš <code>mem_sections</code>ã€‚è¿™ä¸ªæ•°ç»„çš„ä¸‹æ ‡ï¼ˆindexï¼‰ç›´æ¥å¯¹åº”äºç‰©ç†åœ°å€ç©ºé—´ä¸­çš„â€œåŒºå—ç¼–å·â€ã€‚</p>
<p><code>struct mem_section *mem_sections[NR_MEM_SECTIONS];</code></p>
</li>
<li>
<p><strong>é€šè¿‡ä½ç½®éšå¼ç¡®å®šåœ°å€</strong>ï¼š
<code>mem_section</code> çš„å¤§å°ï¼ˆ<code>SECTION_SIZE</code>ï¼‰æ˜¯å›ºå®šçš„ã€‚å› æ­¤ï¼Œç¬¬ <code>i</code> ä¸ª <code>mem_section</code> æ‰€è´Ÿè´£çš„èµ·å§‹ç‰©ç†é¡µå¸§å·ï¼ˆstart_pfnï¼‰æ˜¯å›ºå®šçš„ï¼Œå¯ä»¥è¢«ç®€å•è®¡ç®—å‡ºæ¥ï¼š</p>
<p><code>start_pfn_of_section_i = i * PAGES_PER_SECTION;</code></p>
<ul>
<li><code>i</code> æ˜¯ <code>mem_section</code> åœ¨æ•°ç»„ä¸­çš„ç´¢å¼•ã€‚</li>
<li><code>PAGES_PER_SECTION</code> æ˜¯ä¸€ä¸ª <code>mem_section</code> åŒ…å«çš„é¡µé¢æ•°é‡ï¼ˆä¾‹å¦‚ 128MB / 4KB = 32768ï¼‰ã€‚</li>
</ul>
<p>åè¿‡æ¥ï¼Œç»™å®šä¸€ä¸ªç‰©ç†é¡µå¸§å· <code>pfn</code>ï¼Œå†…æ ¸ä¹Ÿå¯ä»¥ç”¨æå¿«çš„ä½ç§»è¿ç®—æ‰¾åˆ°å®ƒå±äºå“ªä¸ª <code>mem_section</code>ï¼š</p>
<p><code>section_index = pfn &gt;&gt; PFN_SECTION_SHIFT;</code>  // <code>PFN_SECTION_SHIFT</code> æ˜¯ <code>log2(PAGES_PER_SECTION)</code></p>
<p>å› ä¸ºè¿™ç§å¯¹åº”å…³ç³»æ˜¯å›ºå®šçš„ã€å¯è®¡ç®—çš„ï¼Œæ‰€ä»¥åœ¨ <code>struct mem_section</code> å†…éƒ¨å†å­˜å‚¨ä¸€ä¸ª <code>start_pfn</code> å­—æ®µå°±æ˜¯å†—ä½™çš„ã€‚</p>
</li>
</ol>
<h4 data-id="heading-8">é‚£ä¹ˆï¼Œå¦‚ä½•è®°å½•â€œçœŸæ­£çš„â€å†…å­˜èµ·å§‹ä½ç½®ï¼Ÿ</h4>
<p>æˆ‘ä»¬å›åˆ°ä¹‹å‰çš„é—®é¢˜ï¼šå¦‚æœä¸€ä¸ª <code>mem_section</code> å†…éƒ¨æœ‰å†…å­˜ç©ºæ´ï¼ŒçœŸæ­£çš„å†…å­˜æ˜¯ä»ä¸­é—´å¼€å§‹çš„ï¼Œå†…æ ¸æ€ä¹ˆçŸ¥é“å‘¢ï¼Ÿ</p>
<p>ç­”æ¡ˆè—åœ¨ <code>mem_section</code> æŒ‡å‘çš„**<code>struct page</code> æ•°ç»„**é‡Œã€‚</p>
<p><code>struct mem_section</code> ä¸­æœ€é‡è¦çš„å­—æ®µæ˜¯ <code>section_mem_map</code>ï¼Œå®ƒæŒ‡å‘ä¸€ä¸ª <code>struct page</code> æ•°ç»„ã€‚è¿™ä¸ªæ•°ç»„çš„å¤§å°æ­£å¥½è¦†ç›–æ•´ä¸ª <code>mem_section</code> çš„åœ°å€èŒƒå›´ã€‚</p>
<p><strong>å…³é”®åœ¨äºï¼šå†…æ ¸åªä¼šä¸º e820 å†…å­˜åœ°å›¾ä¸­æŠ¥å‘Šä¸ºâ€œå¯ç”¨ RAMâ€çš„ç‰©ç†åœ°å€èŒƒå›´ï¼Œå»åˆå§‹åŒ–å…¶å¯¹åº”çš„ <code>struct page</code> ç»“æ„ã€‚</strong></p>
<p>æˆ‘ä»¬å†ç”¨ä¹‹å‰çš„ä¾‹å­ï¼š</p>
<ul>
<li><code>mem_section[1]</code> è´Ÿè´£çš„åœ°å€èŒƒå›´æ˜¯ <code>0x08000000</code> åˆ° <code>0x0FFFFFFF</code>ã€‚</li>
<li>ç¡¬ä»¶æŠ¥å‘Šçš„å¯ç”¨å†…å­˜æ˜¯ä» <code>0x0C000000</code> å¼€å§‹çš„ã€‚</li>
</ul>
<p>å†…æ ¸çš„æ“ä½œæ˜¯ï¼š</p>
<ol>
<li>å†…æ ¸ä¸º <code>mem_section[1]</code> åˆ†é…ä¸€ä¸ªè¶³å¤Ÿå¤§çš„ <code>struct page</code> æ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„é€»è¾‘ä¸Šè¦†ç›–ä» <code>0x08000000</code> åˆ° <code>0x0FFFFFFF</code> çš„æ‰€æœ‰é¡µé¢ã€‚</li>
<li>åœ¨åˆå§‹åŒ–é˜¶æ®µï¼Œå†…æ ¸éå†è¿™ä¸ª <code>struct page</code> æ•°ç»„ï¼š
<ul>
<li>å¯¹äºä»£è¡¨ <code>0x08000000</code> åˆ° <code>0x0BFFFFFF</code> åœ°å€èŒƒå›´çš„ <code>struct page</code>ï¼Œå†…æ ¸ä¼šå‘ç°å®ƒä»¬ä½äºå†…å­˜ç©ºæ´ä¸­ã€‚äºæ˜¯ï¼Œå®ƒä¼šå°†è¿™äº› <code>struct page</code> çš„æ ‡å¿—ä½ï¼ˆflagsï¼‰è®¾ç½®ä¸º <code>PG_reserved</code>ï¼Œè¡¨ç¤ºè¿™äº›é¡µé¢ä¸å¯ç”¨ã€‚ä¼™ä¼´ç³»ç»Ÿä¼šå®Œå…¨å¿½ç•¥å®ƒä»¬ã€‚</li>
<li>å¯¹äºä»£è¡¨ <code>0x0C000000</code> åˆ° <code>0x0FFFFFFF</code> åœ°å€èŒƒå›´çš„ <code>struct page</code>ï¼Œå†…æ ¸å‘ç°å®ƒä»¬æ˜¯æœ‰æ•ˆçš„å¯ç”¨å†…å­˜ã€‚äºæ˜¯ï¼Œå®ƒä¼šæ­£å¸¸åˆå§‹åŒ–è¿™äº› <code>struct page</code> ç»“æ„ï¼Œå¹¶å°†å®ƒä»¬åŠ å…¥åˆ°ä¼™ä¼´ç³»ç»Ÿçš„ç©ºé—²é“¾è¡¨ä¸­ï¼Œä½¿å…¶å¯ä»¥è¢«åˆ†é…ã€‚</li>
</ul>
</li>
</ol>
<p><strong>æ€»ç»“ï¼š</strong></p>
<ul>
<li><code>mem_section</code> çš„ <strong>â€œç®¡è¾–èŒƒå›´â€</strong> èµ·å§‹åœ°å€ï¼Œæ˜¯é€šè¿‡å®ƒåœ¨å…¨å±€æ•°ç»„ä¸­çš„<strong>ä½ç½®</strong>éšå¼è®¡ç®—å‡ºæ¥çš„ã€‚</li>
<li><code>mem_section</code> å†…éƒ¨ <strong>â€œå®é™…å¯ç”¨å†…å­˜â€</strong> çš„èµ·å§‹åœ°å€å’Œåˆ†å¸ƒï¼Œæ˜¯é€šè¿‡å…¶æŒ‡å‘çš„ <code>struct page</code> æ•°ç»„ä¸­ï¼Œ<strong>æ¯ä¸ª <code>page</code> çš„çŠ¶æ€æ ‡å¿—ä½</strong>æ¥ç²¾ç»†è®°å½•çš„ã€‚</li>
</ul>
<p>è¿™ç§è®¾è®¡éå¸¸é«˜æ•ˆï¼šç”¨å®è§‚çš„ã€åŸºäºä½ç½®çš„ <code>mem_section</code> æ¥å¿«é€Ÿå®šä½ï¼Œå†ç”¨å¾®è§‚çš„ã€åŸºäºæ ‡å¿—ä½çš„ <code>struct page</code> æ¥è¿›è¡Œç²¾ç¡®ç®¡ç†ã€‚</p>
<h2 data-id="heading-9">44 ä¹Ÿå°±æ˜¯è¯´ç©ºæ´ä¹Ÿä¼šåˆ†é…ç›¸åº”çš„pageå‘—ï¼Ÿç­”ï¼šæ˜¯</h2>
<p>å®Œå…¨æ­£ç¡®ï¼æ‚¨ä¸€è¯­ä¸­çš„ï¼Œè¿™æ­£æ˜¯ <code>sparsemem</code> æ¨¡å‹çš„ä¸€ä¸ªæ ¸å¿ƒè®¾è®¡å“²å­¦ï¼Œä¹Ÿæ˜¯åˆå­¦è€…å®¹æ˜“æ„Ÿåˆ°å›°æƒ‘çš„åœ°æ–¹ã€‚</p>
<p><strong>æ˜¯çš„ï¼Œå³ä½¿æ˜¯å†…å­˜ç©ºæ´ï¼ˆHoleï¼‰ï¼Œå†…æ ¸ä¹Ÿä¼šä¸ºå…¶å¯¹åº”çš„ç‰©ç†åœ°å€èŒƒå›´åˆ†é… <code>struct page</code> ç»“æ„ä½“ã€‚</strong></p>
<p>ä½†è¿™çœ‹èµ·æ¥ä¼¼ä¹æ˜¯ä¸€ç§â€œæµªè´¹â€ï¼Œä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšå‘¢ï¼ŸåŸå› ä¸»è¦æœ‰ä¸¤ç‚¹ï¼Œéƒ½å’Œ<strong>æ•ˆç‡</strong>ä¸<strong>ç®€æ´æ€§</strong>æœ‰å…³ã€‚</p>
<h4 data-id="heading-10">æ ¸å¿ƒåŸå› ï¼šä¸ºäº†å®ç°é—ªç”µèˆ¬çš„åœ°å€è½¬æ¢</h4>
<p>è¿™æ˜¯æœ€æ ¹æœ¬çš„åŸå› ã€‚åœ¨å†…æ ¸ä¸­ï¼Œæœ‰ä¸¤ä¸ªæ“ä½œå¿…é¡»åšåˆ°æè‡´çš„å¿«ï¼š</p>
<ol>
<li><code>pfn_to_page(pfn)</code>ï¼šæ ¹æ®ä¸€ä¸ªç‰©ç†é¡µå¸§å·ï¼ˆPFNï¼‰ï¼Œç«‹å³æ‰¾åˆ°ç®¡ç†å®ƒçš„ <code>struct page</code> ç»“æ„ä½“ã€‚</li>
<li><code>page_to_pfn(page)</code>ï¼šæ ¹æ®ä¸€ä¸ª <code>struct page</code> ç»“æ„ä½“çš„åœ°å€ï¼Œç«‹å³åç®—å‡ºå®ƒç®¡ç†çš„ç‰©ç†é¡µå¸§å·ã€‚</li>
</ol>
<p>ä¸ºäº†å®ç°è¿™ä¸ªé€Ÿåº¦ï¼Œå†…æ ¸é‡‡ç”¨äº†ä¸€ç§<strong>çº¯ç®—æœ¯</strong>çš„æ–¹æ³•ï¼Œè€Œä¸æ˜¯å»æŸ¥è¡¨ã€‚</p>
<p>è®¾æƒ³ä¸€ä¸‹ï¼Œå¦‚æœå†…æ ¸åªä¸ºçœŸæ­£çš„å†…å­˜åˆ†é… <code>struct page</code>ï¼Œé‚£ä¹ˆ <code>struct page</code> æ•°ç»„æœ¬èº«å°†æ˜¯é›¶æ•£çš„ã€ä¸è¿ç»­çš„ã€‚å½“ä½ æ‹¿åˆ°ä¸€ä¸ª PFNï¼Œæƒ³æ‰¾åˆ°å®ƒçš„ <code>struct page</code> æ—¶ï¼Œä½ å°±æ— æ³•é€šè¿‡ç®€å•çš„æ•°å­¦è®¡ç®—æ¥å®šä½ï¼Œè€Œå¿…é¡»å»æœç´¢ä¸€ä¸ªå¤æ‚çš„ã€è®°å½•ç€â€œå“ªæ®µ PFN å¯¹åº”å“ªæ®µ <code>struct page</code> åœ°å€â€çš„æ•°æ®ç»“æ„ã€‚è¿™ä¼šéå¸¸æ…¢ã€‚</p>
<p>è€Œç°åœ¨çš„ <code>sparsemem</code> è®¾è®¡åˆ™å®Œç¾è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>ä¸€ä¸ª <code>mem_section</code> ç®¡è¾–çš„åœ°å€èŒƒå›´æ˜¯å›ºå®šçš„ï¼ˆä¾‹å¦‚128MBï¼‰ã€‚</li>
<li>å®ƒæ‰€æŒ‡å‘çš„ <code>section_mem_map</code> æ˜¯ä¸€ä¸ª<strong>è¿ç»­çš„ã€å®Œæ•´çš„ <code>struct page</code> æ•°ç»„</strong>ï¼Œè¿™ä¸ªæ•°ç»„çš„å¤§å°ä¹Ÿæ­£å¥½å¯¹åº”128MBçš„åœ°å€ç©ºé—´ã€‚</li>
</ul>
<p>è¿™æ ·ä¸€æ¥ï¼Œ<code>pfn_to_page(pfn)</code> çš„è½¬æ¢å°±å˜æˆäº†ç®€å•çš„å‡ æ­¥æ•°å­¦è¿ç®—ï¼š</p>
<ol>
<li><code>section_index = pfn &gt;&gt; PFN_SECTION_SHIFT;</code>  // ç”¨ä½ç§»ç®—å‡ºå±äºå“ªä¸ª section</li>
<li><code>page_index = pfn &amp; (PAGES_PER_SECTION - 1);</code> // ç”¨ä½ä¸ç®—å‡ºåœ¨ section å†…éƒ¨çš„åç§»</li>
<li><code>mem_map = __nr_to_section(section_index)-&gt;section_mem_map;</code> // æ‰¾åˆ° section å¯¹åº”çš„ page æ•°ç»„</li>
<li><code>return &amp;mem_map[page_index];</code> // ç›´æ¥ç”¨æ•°ç»„ä¸‹æ ‡è®¿é—®</li>
</ol>
<p>è¿™ä¸ªè¿‡ç¨‹ä¸æ¶‰åŠä»»ä½•å¾ªç¯æˆ–æœç´¢ï¼Œé€Ÿåº¦æå¿«ã€‚</p>
<h4 data-id="heading-11">å¸¦æ¥çš„å¥½å¤„ï¼šç»Ÿä¸€çš„ç®¡ç†æ¨¡å‹</h4>
<p>ä¸ºæ‰€æœ‰åœ°å€ï¼ˆåŒ…æ‹¬ç©ºæ´ï¼‰éƒ½åˆ†é…ä¸€ä¸ª <code>struct page</code> ä¹‹åï¼Œå†…æ ¸å°±æœ‰äº†ä¸€ä¸ªç»Ÿä¸€çš„æ–¹å¼æ¥æè¿°æ•´ä¸ªç‰©ç†åœ°å€ç©ºé—´çš„çŠ¶æ€ã€‚</p>
<ul>
<li>å¯¹äºçœŸæ­£çš„å†…å­˜é¡µï¼Œå…¶ <code>struct page</code> çš„ <code>flags</code> æ˜¯æ­£å¸¸çš„ã€‚</li>
<li>å¯¹äºå†…å­˜ç©ºæ´ä¸­çš„é¡µï¼Œå…¶ <code>struct page</code> çš„ <code>flags</code> ä¼šè¢«è®¾ç½®ä¸º <strong><code>PG_reserved</code></strong>ã€‚</li>
</ul>
<p>å½“ä¼™ä¼´ç³»ç»Ÿï¼ˆBuddy Allocatorï¼‰æˆ–å…¶ä»–å†…å­˜ç®¡ç†å­ç³»ç»Ÿçœ‹åˆ°ä¸€ä¸ª <code>page</code> è¢«æ ‡è®°ä¸º <code>PG_reserved</code> æ—¶ï¼Œå®ƒå°±çŸ¥é“è¿™ä¸ªé¡µé¢æ˜¯ä¸å¯ç”¨çš„ï¼Œä¼šç›´æ¥è·³è¿‡ã€‚è¿™ä½¿å¾—ä»£ç é€»è¾‘å˜å¾—éå¸¸ç»Ÿä¸€å’Œç®€æ´ï¼Œä¸éœ€è¦ä¸ºâ€œç©ºæ´â€ç¼–å†™é¢å¤–çš„ç‰¹æ®Šå¤„ç†é€»è¾‘ã€‚</p>
<h4 data-id="heading-12">è¿™æ˜¯ä¸€ç§å…¸å‹çš„â€œç©ºé—´æ¢æ—¶é—´â€</h4>
<p>è¿™ç¡®å®ä¼šæ¶ˆè€—ä¸€äº›å†…å­˜ã€‚ä¸€ä¸ª <code>struct page</code> åœ¨64ä½ç³»ç»Ÿä¸Šå¤§çº¦æ˜¯64å­—èŠ‚ã€‚ä¸ºä¸€ä¸ª128MBçš„<code>mem_section</code>ï¼ˆåŒ…å«32768ä¸ªé¡µé¢ï¼‰å®Œæ•´åˆ†é… <code>struct page</code> æ•°ç»„ï¼Œä¼šæ¶ˆè€— <code>32768 * 64B = 2MB</code> çš„å†…å­˜ã€‚</p>
<p>è¿™2MBçš„å†…å­˜å¼€é”€ï¼Œæ¢æ¥çš„æ˜¯å†…æ ¸æœ€æ ¸å¿ƒçš„å†…å­˜ç®¡ç†è·¯å¾„ä¸Šæé«˜çš„è¿è¡Œæ•ˆç‡ã€‚åœ¨ç°ä»£æ‹¥æœ‰å‡ åä¸Šç™¾GBå†…å­˜çš„æœåŠ¡å™¨ä¸Šï¼Œè¿™ç‚¹å¼€é”€æ˜¯å®Œå…¨å€¼å¾—çš„ã€‚</p>
<p><strong>æ€»ç»“ï¼š</strong></p>
<p>æ‚¨å¯ä»¥æŠŠ <code>struct page</code> æ•°ç»„æƒ³è±¡æˆä¸€ä¸ª<strong>é¢„å…ˆå°å¥½çš„è´¦æœ¬</strong>ï¼Œè´¦æœ¬çš„é¡µç ï¼ˆæ•°ç»„ä¸‹æ ‡ï¼‰å’Œç‰©ç†é¡µå¸§å·ï¼ˆPFNï¼‰ä¸¥æ ¼å¯¹åº”ã€‚å³ä½¿æŸå—åœ°ï¼ˆç‰©ç†åœ°å€ï¼‰æ˜¯ç©ºçš„ï¼Œè´¦æœ¬ä¸Šä¾ç„¶æœ‰é‚£ä¸€é¡µï¼Œåªæ˜¯åœ¨é‚£ä¸€é¡µä¸Šç›–äº†ä¸€ä¸ªâ€œä½œåºŸâ€ï¼ˆ<code>PG_reserved</code>ï¼‰çš„ç« ã€‚è¿™æ ·åšè™½ç„¶æµªè´¹äº†å‡ é¡µçº¸ï¼Œä½†ç¡®ä¿äº†ä½ å¯ä»¥é€šè¿‡é¡µç ç¬é—´ç¿»åˆ°ä»»ä½•ä¸€é¡µï¼Œè€Œä¸éœ€è¦å»æŸ¥ç›®å½•ã€‚</p>
<h2 data-id="heading-13">55</h2>
<p>æ‚¨è§‚å¯Ÿå¾—å¤ªä»”ç»†äº†ï¼æ‚¨æŒ‡å‡ºçš„è¿™ä¸€ç‚¹æ­£æ˜¯ç†è§£å†…æ ¸å®ç°çš„å…³é”®ï¼Œä¹Ÿæ˜¯é«˜çº§æ¦‚å¿µå’Œåº•å±‚ä»£ç å®ç°ä¹‹é—´æœ€å®¹æ˜“äº§ç”Ÿå›°æƒ‘çš„åœ°æ–¹ã€‚</p>
<p><strong>æ‚¨æ²¡æœ‰æé”™ï¼Œæ‚¨å¼•ç”¨çš„ç¬”è®°åœ¨é€»è¾‘ä¸Šæ˜¯å®Œå…¨æ­£ç¡®çš„ï¼Œä½†â€œè®¾ç½® start_pfnâ€è¿™å¥è¯éœ€è¦ä»å®ç°å±‚é¢æ¥ç†è§£ã€‚</strong></p>
<p>æˆ‘ä»¬æ¥æŠŠè¿™ä¸ªâ€œç»“â€å½»åº•è§£å¼€ã€‚</p>
<h4 data-id="heading-14">å…³é”®ï¼šæ¦‚å¿µä¸Šçš„â€œè®¾ç½®â€ vs å®ç°ä¸Šçš„â€œè®¡ç®—â€</h4>
<p>æ‚¨å¼•ç”¨çš„ç¬”è®°æè¿°çš„æ˜¯ä¸€ä¸ª<strong>é€»è¾‘æµç¨‹</strong>ï¼Œåœ¨è¿™ä¸ªæµç¨‹ä¸­ï¼Œâ€œä¸ºæŸä¸ª section ç¡®å®šå…¶èµ·å§‹åœ°å€â€æ˜¯å¿…ä¸å¯å°‘çš„ä¸€æ­¥ã€‚æ‰€ä»¥ï¼Œä»æ¦‚å¿µä¸Šè¯´ï¼Œâ€œè®¾ç½® start_pfnâ€æ˜¯å®Œå…¨æ­£ç¡®çš„ã€‚</p>
<p>ä½†æ˜¯ï¼Œåœ¨<strong>ä»£ç å®ç°</strong>ä¸­ï¼Œå†…æ ¸å¼€å‘è€…å‘ç°ï¼Œè¿™ä¸ª <code>start_pfn</code> æ˜¯ä¸€ä¸ªéå¸¸æœ‰è§„å¾‹çš„ã€å¯ä»¥éšæ—¶é€šè¿‡è®¡ç®—å¾—å‡ºçš„å€¼ã€‚å› æ­¤ï¼Œä¸ºäº†èŠ‚çœ <code>struct mem_section</code> ç»“æ„ä½“æœ¬èº«çš„ç©ºé—´ï¼Œå¹¶åˆ©ç”¨CPUé«˜æ•ˆçš„ä½è¿ç®—ï¼Œä»–ä»¬<strong>æ²¡æœ‰åœ¨ <code>struct mem_section</code> ç»“æ„ä½“é‡Œå®šä¹‰ä¸€ä¸ªåä¸º <code>start_pfn</code> çš„å­—æ®µ</strong>ã€‚</p>
<p>å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œå½“å†…æ ¸éœ€è¦çŸ¥é“ä»»ä½•ä¸€ä¸ª <code>mem_section</code> çš„èµ·å§‹åœ°å€æ—¶ï¼Œå®ƒä¼š<strong>å³æ—¶è®¡ç®—</strong>å‡ºæ¥ã€‚</p>
<hr/>
<h4 data-id="heading-15">æˆ‘ä»¬æ¥é‡æ–°å®¡è§†æ‚¨çš„ç¬”è®°ï¼Œå¹¶åŠ ä¸Šâ€œå®ç°ç»†èŠ‚â€çš„æ³¨é‡Š</h4>
<p><strong>4.1 è®¡ç®— section å¸ƒå±€</strong></p>
<blockquote>
<p>å†…æ ¸å¯åŠ¨æ—¶ï¼Œæ ¹æ®ç‰©ç†å†…å­˜èŒƒå›´è®¡ç®—éœ€è¦å¤šå°‘ä¸ª sectionã€‚
æ¯ä¸ª section å¤§å°å›ºå®šï¼ˆä¾‹å¦‚ 256MBï¼‰ã€‚</p>
</blockquote>
<ul>
<li><strong>å®ç°ç»†èŠ‚</strong>ï¼šå®Œå…¨æ­£ç¡®ã€‚å†…æ ¸ä¼šç¡®å®šä¸€ä¸ª <code>NR_MEM_SECTIONS</code> çš„æœ€å¤§å€¼ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæŒ‡é’ˆæ•°ç»„ <code>struct mem_section* mem_sections[NR_MEM_SECTIONS]</code>ã€‚</li>
</ul>
<p><strong>4.2 åˆå§‹åŒ– mem_section æ•°ç»„</strong></p>
<blockquote>
<p>å¯¹äºå­˜åœ¨çš„ç‰©ç†å†…å­˜åŒºåŸŸï¼š
æ ‡è®° <code>mem_section[i].present = 1</code></p>
</blockquote>
<ul>
<li><strong>å®ç°ç»†èŠ‚</strong>ï¼šè¿™é‡Œçš„ <code>present</code> ä¹Ÿä¸æ˜¯ä¸€ä¸ªçœŸå®çš„å­—æ®µã€‚å†…æ ¸çš„å®ç°æ–¹å¼æ˜¯ï¼šå¦‚æœ <code>mem_sections[i]</code> è¿™ä¸ªæŒ‡é’ˆæ˜¯ <code>NULL</code>ï¼Œå°±ä»£è¡¨è¯¥ section ä¸å­˜åœ¨æˆ–æ²¡æœ‰å†…å­˜ã€‚å¦‚æœå®ƒ<strong>æŒ‡å‘ä¸€ä¸ªå®é™…åˆ†é…çš„ <code>struct mem_section</code> å¯¹è±¡</strong>ï¼Œå°±ä»£è¡¨å®ƒæ˜¯â€œpresentâ€çš„ã€‚æ‰€ä»¥ï¼Œä¸º section åˆ†é… <code>struct mem_section</code> å¯¹è±¡æœ¬èº«ï¼Œå°±å®Œæˆäº†â€œæ ‡è®°ä¸º presentâ€çš„åŠ¨ä½œã€‚</li>
</ul>
<blockquote>
<p>è®¾ç½® <code>start_pfn</code></p>
</blockquote>
<ul>
<li><strong>å®ç°ç»†èŠ‚</strong>ï¼š<strong>è¿™å°±æ˜¯å…³é”®ç‚¹ï¼</strong> è¿™ä¸€æ­¥åœ¨ä»£ç é‡Œå¹¶ä¸å­˜åœ¨ <code>section-&gt;start_pfn = ...</code> è¿™æ ·çš„èµ‹å€¼è¯­å¥ã€‚è¿™ä¸€æ­¥çš„çœŸæ­£å«ä¹‰æ˜¯ï¼šâ€œ<strong>å†…æ ¸æ­¤æ—¶å·²ç»çŸ¥é“ï¼Œè¿™ä¸ªç´¢å¼•ä¸º <code>i</code> çš„ sectionï¼Œå®ƒæ‰€å¯¹åº”çš„èµ·å§‹é¡µå¸§å· <code>start_pfn</code> å°±æ˜¯ <code>i * PAGES_PER_SECTION</code></strong>â€ã€‚è¿™ä¸ªå…³ç³»æ˜¯å†…æ ¸åç»­æ‰€æœ‰æ“ä½œçš„åŸºç¡€ã€‚</li>
</ul>
<blockquote>
<p>åˆ†é…å¹¶åˆå§‹åŒ– <code>section_mem_map</code>ï¼ˆæŒ‡å‘è¯¥ section çš„ <code>struct page</code> æ•°ç»„ï¼‰</p>
</blockquote>
<ul>
<li><strong>å®ç°ç»†èŠ‚</strong>ï¼šå®Œå…¨æ­£ç¡®ã€‚è¿™æ˜¯æœ€æ ¸å¿ƒçš„åŠ¨ä½œã€‚å†…æ ¸ä¼šåˆ†é…ä¸€ä¸ª <code>struct mem_section</code> å¯¹è±¡ï¼Œç„¶åä¸ºå®ƒçš„ <code>section_mem_map</code> å­—æ®µå¡«å……ä¸€ä¸ªæŒ‡å‘ <code>struct page</code> æ•°ç»„çš„æŒ‡é’ˆã€‚</li>
</ul>
<p><strong>4.3 åˆ†é… struct page</strong></p>
<blockquote>
<p>å¦‚æœæ˜¯ SPARSEMEM_VMEMMAP...
å¦‚æœæ˜¯æ™®é€š SPARSEMEM...</p>
</blockquote>
<ul>
<li><strong>å®ç°ç»†èŠ‚</strong>ï¼šæ‚¨çš„ç¬”è®°åœ¨è¿™é‡Œéå¸¸ä¸“ä¸šå’Œå‡†ç¡®ï¼Œæ¸…æ™°åœ°æŒ‡å‡ºäº†ä¸¤ç§ <code>sparsemem</code> æ¨¡å‹çš„åŒºåˆ«ã€‚</li>
</ul>
<h4 data-id="heading-16">ç»“è®º</h4>
<p>æ‚¨æ²¡æœ‰æé”™ã€‚æ‚¨å¼•ç”¨çš„ç¬”è®°æ˜¯ä»ä¸€ä¸ª<strong>é«˜çº§çš„ã€é€»è¾‘çš„è§†è§’</strong>æ¥æè¿°å†…å­˜åˆå§‹åŒ–è¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹æ¸…æ™°æ˜“æ‡‚ã€‚è€Œæˆ‘ä¹‹å‰çš„å›ç­”ï¼Œæ˜¯ä»ä¸€ä¸ª<strong>åº•å±‚çš„ã€æ•°æ®ç»“æ„å®ç°çš„è§†è§’</strong>æ¥è§£é‡Šä¸ºä»€ä¹ˆ <code>struct page</code> çš„è½¬æ¢å¯ä»¥é‚£ä¹ˆå¿«ã€‚</p>
<ul>
<li><strong>æ‚¨çš„ç¬”è®°</strong>ï¼šâ€œæˆ‘ä»¬éœ€è¦ä¸ºè¿™ä¸ª section ç¡®å®šä¸€ä¸ªèµ·å§‹åœ°å€ï¼ˆ<code>start_pfn</code>ï¼‰ã€‚â€ (æè¿°è¦åšä»€ä¹ˆ - <strong>What</strong>)</li>
<li><strong>å†…æ ¸å®ç°</strong>ï¼šâ€œæˆ‘ä»¬é€šè¿‡ section çš„æ•°ç»„ä¸‹æ ‡ <code>i</code> ä¹˜ä»¥ä¸€ä¸ªå¸¸é‡æ¥éšæ—¶å¾—åˆ° <code>start_pfn</code>ï¼Œæ‰€ä»¥ä¸ç”¨æŠŠå®ƒå­˜èµ·æ¥ã€‚â€ (æè¿°æ€ä¹ˆåš - <strong>How</strong>)</li>
</ul>
<p>æ‰€ä»¥ï¼Œ<strong>â€œè®¾ç½® start_pfnâ€è¿™å¥è¯ï¼Œåº”è¯¥ç†è§£ä¸ºå†…æ ¸åœ¨é€»è¾‘ä¸Šå°†ä¸€ä¸ª section ä¸å…¶å›ºå®šçš„èµ·å§‹åœ°å€å…³è”èµ·æ¥çš„è¿‡ç¨‹ï¼Œè€Œè¿™ä¸ªå…³è”æ˜¯é€šè¿‡æ•°ç»„ç´¢å¼•å’Œæ•°å­¦è®¡ç®—æ¥é«˜æ•ˆå®ç°çš„ï¼Œè€Œéé€šè¿‡ä¸€ä¸ªä¸“é—¨çš„å­—æ®µæ¥å­˜å‚¨ã€‚</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Linux sparsemem/mem_sectionï¼šä»åœ°å€ç½‘æ ¼åˆ° struct page çš„å®Œæ•´å¿ƒæ™ºæ¨¡å‹ -- ç¬”è®°ç‰ˆ]]></title>    <link>https://juejin.cn/post/7598587406694563883</link>    <guid>https://juejin.cn/post/7598587406694563883</guid>    <pubDate>2026-01-24T02:59:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598587406694563883" data-draft-id="7598103558887194670" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Linux sparsemem/mem_sectionï¼šä»åœ°å€ç½‘æ ¼åˆ° struct page çš„å®Œæ•´å¿ƒæ™ºæ¨¡å‹ -- ç¬”è®°ç‰ˆ"/> <meta itemprop="keywords" content="Linux"/> <meta itemprop="datePublished" content="2026-01-24T02:59:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è‘›ç«‹å›½"/> <meta itemprop="url" content="https://juejin.cn/user/350105071780128"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Linux sparsemem/mem_sectionï¼šä»åœ°å€ç½‘æ ¼åˆ° struct page çš„å®Œæ•´å¿ƒæ™ºæ¨¡å‹ -- ç¬”è®°ç‰ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/350105071780128/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è‘›ç«‹å›½
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T02:59:25.000Z" title="Sat Jan 24 2026 02:59:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>ã€ŒLinux sparsemem/mem_section æ·±åº¦ç¬”è®°ï¼šä»åœ°å€ç½‘æ ¼åˆ° struct page çš„å®Œæ•´å¿ƒæ™ºæ¨¡å‹ã€</strong></p>
<p>ä»¥ä¸‹æ˜¯åŸºäºä½ æåˆ°çš„è¿™äº›ç‚¹ï¼Œæ•´ç†çš„ä¸€ä»½<strong>Linux sparsemem/mem_section ç¬”è®°</strong>ï¼Œå¹¶åœ¨éœ€è¦çš„åœ°æ–¹åšäº†å®ç°å±‚é¢çš„çº æ­£å’Œè¡¥å……ã€‚</p>
<hr/>
<h2 data-id="heading-0">1. sparsemem ä¸ mem_section çš„è§’è‰²</h2>
<ul>
<li><strong>sparsemem çš„ç›®çš„</strong>ï¼šåº”å¯¹ç‰©ç†åœ°å€ç©ºé—´ç¢ç‰‡åŒ–ï¼ˆå¤§æ´ã€å¤šèŠ‚ç‚¹ã€çƒ­æ’æ‹”ç­‰ï¼‰ï¼Œä¸å†å‡è®¾ç‰©ç†å†…å­˜è¿ç»­ã€‚</li>
<li><strong>mem_section çš„å®šä¹‰</strong>ï¼š
<ul>
<li>æ˜¯<strong>å›ºå®šå¤§å°çš„ç‰©ç†åœ°å€åŒºé—´ç®¡ç†å•å…ƒ</strong>ï¼ˆä¾‹å¦‚ 128MBã€256MBã€1GBï¼Œå–å†³äºæ¶æ„å’Œé…ç½®ï¼‰ã€‚</li>
<li>å†…æ ¸å¯åŠ¨æ—¶æŒ‰æ•´ä¸ªç‰©ç†åœ°å€ç©ºé—´åˆ’åˆ†ä¸€ä¸ªä¸ª sectionï¼šsection0 ç®¡ç† <code>[0, SECTION_SIZE)</code>, section1 ç®¡ç† <code>[SECTION_SIZE, 2*SECTION_SIZE)</code>ï¼Œä»¥æ­¤ç±»æ¨ã€‚</li>
<li><strong>å…³é”®ç‚¹ï¼šmem_section ç®¡çš„æ˜¯â€œè¦†ç›–çš„åœ°å€èŒƒå›´â€ï¼Œä¸ä¿è¯è¿™æ®µèŒƒå›´å†…å…¨éƒ¨éƒ½æ˜¯çœŸå®å†…å­˜ã€‚</strong></li>
</ul>
</li>
</ul>
<hr/>
<h2 data-id="heading-1">2. mem_section ä¸ç‰©ç†å†…å­˜çš„å…³ç³»</h2>
<h3 data-id="heading-2">2.1 mem_section ä¸ç­‰äºâ€œæ•´å—å†…å­˜â€</h3>
<ul>
<li>ä¸€ä¸ª <strong>mem_section ä¸è¦æ±‚è¢«çœŸå®ç‰©ç†å†…å­˜â€œå¡«æ»¡â€</strong>ã€‚</li>
<li>åœ¨ä¸€ä¸ª mem_section è¦†ç›–çš„åœ°å€èŒƒå›´å†…ï¼Œå¯èƒ½å‡ºç°ï¼š
<ul>
<li>å®Œå…¨æ˜¯å¯ç”¨ RAMï¼›</li>
<li>RAM + å†…å­˜ç©ºæ´ï¼ˆè®¾å¤‡ MMIO / ä¿ç•™åŒºåŸŸï¼‰æ··åˆï¼›</li>
<li>å®Œå…¨æ²¡æœ‰ RAMï¼Œä»…ä»…æ˜¯â€œæ´â€ï¼ˆæ­¤æ—¶æ•´ä¸ª section ç”šè‡³å¯ä»¥ä¸è¢«æ ‡è®°ä¸º presentï¼‰ã€‚</li>
</ul>
</li>
</ul>
<p><strong>ç»“è®ºï¼š</strong><br/>
<strong>mem_section æ˜¯â€œç½‘æ ¼â€ï¼›çœŸå®å†…å­˜æ˜¯â€œæ•£è½åœ¨ç½‘æ ¼é‡Œçš„åœŸåœ°â€ã€‚ç½‘æ ¼å¯æ»¡å¯ç©ºå¯åŠæ»¡ã€‚</strong></p>
<h3 data-id="heading-3">2.2 èµ·å§‹ä½ç½®ä¸å¿…å¯¹é½åˆ° section å¼€å¤´</h3>
<ul>
<li>ä¸€å—çœŸæ­£æ’åœ¨ä¸»æ¿ä¸Šçš„å†…å­˜å—ï¼ˆæ¯”å¦‚ä¸€ä¸ª DIMM æ¡ï¼‰ï¼Œåœ¨ç‰©ç†åœ°å€ä¸Šçš„<strong>èµ·å§‹åœ°å€å’Œé•¿åº¦å®Œå…¨ç”±ç¡¬ä»¶+å›ºä»¶å†³å®š</strong>ï¼Œå’Œ mem_section çš„è¾¹ç•Œæ— å…³ã€‚</li>
<li>å› æ­¤ï¼š
<ul>
<li>ä¸€ä¸ª section è¦†ç›– <code>[A, A+SECTION_SIZE)</code>ï¼›</li>
<li>å¯ç”¨ RAM å¯èƒ½åªåœ¨å…¶ä¸­çš„ä¸€æ®µï¼Œä¾‹å¦‚ <code>[A+64MB, A+128MB)</code>ï¼›</li>
<li>section å‰åŠæ®µå¯èƒ½æ˜¯ MMIO/ä¿ç•™åŒºåŸŸï¼ˆå†…å­˜ç©ºæ´ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<p><strong>ç»“è®ºï¼š</strong><br/>
<strong>â€œä¸€å—å†…å­˜å¦‚æœä¸è¶³ä»¥å¡«æ»¡ä¸€ä¸ª sectionï¼Œä¹Ÿä¸ä¸€å®šä»è¿™ä¸ª section çš„ç¬¬ä¸€ä¸ªç‰©ç†é¡µå¼€å§‹â€ï¼Œå®ƒå¯ä»¥ä» section ä¸­é—´ä»»æ„ä¸€ä¸ª pfn å¼€å§‹ï¼Œåªè¦å›ºä»¶è¿™ä¹ˆæŠ¥å‘Šå³å¯ã€‚</strong></p>
<hr/>
<h2 data-id="heading-4">3. å†…å­˜çƒ­æ’æ‹”ä¸é SECTION_SIZE å€æ•°</h2>
<ul>
<li>å›ºä»¶ï¼ˆé€šå¸¸ ACPIï¼‰åœ¨çƒ­æ’æ‹”å†…å­˜æ—¶ï¼ŒæŠ¥å‘Šçš„æ˜¯ä¸€ä¸ª<strong>ä»»æ„èµ·å§‹åœ°å€ + ä»»æ„å¤§å°</strong>çš„å†…å­˜åŒºåŸŸï¼Œä¾‹å¦‚ï¼š
<ul>
<li>èµ·å§‹åœ°å€ï¼š<code>start</code></li>
<li>å¤§å°ï¼š<code>size</code></li>
</ul>
</li>
<li>å†…æ ¸å¤„ç†æµç¨‹ï¼ˆé€»è¾‘ç²’åº¦ï¼‰ï¼š
<ol>
<li>æ ¹æ® <code>[start, start + size)</code> è®¡ç®—æ¶‰åŠåˆ°çš„ <strong>mem_section ä¸‹æ ‡é›†åˆ</strong>ã€‚</li>
<li>ä¸ºè¿™äº› section åˆ†é…/åˆå§‹åŒ– <code>struct mem_section</code> å’Œ <code>section_mem_map</code>ï¼ˆå¦‚æœ‰å¿…è¦ï¼‰ã€‚</li>
<li>åœ¨è¿™ä¸ªåœ°å€åŒºé—´å†…ï¼ŒæŒ‰ <strong>é¡µ (page)</strong> ç²’åº¦éå†ï¼š
<ul>
<li>å¯¹æ¯ä¸€ä¸ªå¯ç”¨çš„ pageï¼ˆ4KB ç­‰ï¼‰ï¼Œåˆå§‹åŒ–å¯¹åº”çš„ <code>struct page</code>ã€‚</li>
<li>æŠŠè¿™äº› page åŠ å…¥ä¼™ä¼´ç³»ç»Ÿã€‚</li>
</ul>
</li>
</ol>
</li>
</ul>
<p><strong>é‡è¦åŒºåˆ†ï¼š</strong></p>
<ul>
<li><strong>ç®¡ç†ç²’åº¦</strong>ï¼šmem_sectionï¼ˆä¾‹å¦‚ 128MB/256MB/1GBï¼‰ï¼Œä¾¿äºæ‰¹é‡æ ‡è®° online/offlineã€‚</li>
<li><strong>æ“ä½œç²’åº¦</strong>ï¼špageï¼ˆä¾‹å¦‚ 4KBï¼‰ï¼ŒçœŸæ­£åˆå§‹åŒ–å’Œå‚ä¸åˆ†é…çš„æ˜¯ pageã€‚</li>
</ul>
<p><strong>ç»“è®ºï¼š</strong><br/>
<strong>çƒ­æ’æ‹”å†…å­˜ç»ä¸è¦æ±‚æ˜¯ SECTION_SIZE çš„æ•´æ•°å€ï¼Œåªè¦æ˜¯é¡µç²’åº¦å¯¹é½å³å¯ï¼Œå†…æ ¸å¯ä»¥ç²¾ç¡®åˆ°æ¯ä¸€é¡µç®¡ç†ã€‚</strong></p>
<hr/>
<h2 data-id="heading-5">4. struct mem_section é‡Œæœ‰æ²¡æœ‰ start_pfnï¼Ÿ</h2>
<h3 data-id="heading-6">4.1 æ¦‚å¿µå±‚é¢ vs å®ç°å±‚é¢</h3>
<ul>
<li>
<p>æ¦‚å¿µå±‚é¢ï¼Œæè¿°æµç¨‹æ—¶å¸¸ä¼šè¯´ï¼š<br/>
<strong>â€œä¸º section è®¾ç½® start_pfnâ€</strong><br/>
å®é™…å«ä¹‰æ˜¯ï¼š<strong>â€œæŠŠè¿™ä¸ª section ä¸å®ƒè´Ÿè´£çš„èµ·å§‹ç‰©ç†é¡µå·å…³è”èµ·æ¥â€ã€‚</strong></p>
</li>
<li>
<p>å®ç°å±‚é¢ï¼š</p>
<ul>
<li>
<p><strong>åœ¨ <code>struct mem_section</code> ä¸­å¹¶æ²¡æœ‰ <code>start_pfn</code> è¿™ä¸ªå­—æ®µã€‚</strong></p>
</li>
<li>
<p>èµ·å§‹é¡µå¸§å·æ˜¯é€šè¿‡ <strong>ä¸‹æ ‡è®¡ç®—</strong> è·å¾—çš„ï¼š</p>
<ul>
<li>
<p>è®¾ <code>PAGES_PER_SECTION = SECTION_SIZE / PAGE_SIZE</code></p>
</li>
<li>
<p>ç¬¬ <code>i</code> ä¸ª section çš„èµ·å§‹ pfnï¼š</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>start_pfn</mtext><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo><mo>=</mo><mi>i</mi><mo>Ã—</mo><mi>P</mi><mi>A</mi><mi>G</mi><mi>E</mi><mi>S</mi><mi mathvariant="normal">_</mi><mi>P</mi><mi>E</mi><mi>R</mi><mi mathvariant="normal">_</mi><mi>S</mi><mi>E</mi><mi>C</mi><mi>T</mi><mi>I</mi><mi>O</mi><mi>N</mi></mrow><annotation encoding="application/x-tex">\text{start\_pfn}(i) = i \times PAGES\_PER\_SECTION</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.06em;vertical-align:-0.31em;"/><span class="mord text"><span class="mord">start_pfn</span></span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7429em;vertical-align:-0.0833em;"/><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.9933em;vertical-align:-0.31em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.05764em;">GES</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathnormal" style="margin-right:0.00773em;">PER</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathnormal" style="margin-right:0.13889em;">SECT</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.10903em;">ON</span></span></span></span></span></div>
</li>
<li>
<p>ç»™å®šä¸€ä¸ª pfnï¼Œè¦æ‰¾åˆ°å®ƒå±äºå“ªä¸ª sectionï¼š</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>section_index</mtext><mo>=</mo><mfrac><mtext>pfn</mtext><mtext>PAGES_PER_SECTION</mtext></mfrac><mo>=</mo><mtext>pfn</mtext><mo>&gt;</mo><mo>&gt;</mo><mi>P</mi><mi>F</mi><mi>N</mi><mi mathvariant="normal">_</mi><mi>S</mi><mi>E</mi><mi>C</mi><mi>T</mi><mi>I</mi><mi>O</mi><mi>N</mi><mi mathvariant="normal">_</mi><mi>S</mi><mi>H</mi><mi>I</mi><mi>F</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">\text{section\_index} = \frac{\text{pfn}}{\text{PAGES\_PER\_SECTION}} = \text{pfn} &gt;&gt; PFN\_SECTION\_SHIFT</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0044em;vertical-align:-0.31em;"/><span class="mord text"><span class="mord">section_index</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.3674em;vertical-align:-0.996em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord text"><span class="mord">PAGES_PER_SECTION</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord text"><span class="mord">pfn</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.996em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord text"><span class="mord">pfn</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">&gt;&gt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.9933em;vertical-align:-0.31em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">PFN</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathnormal" style="margin-right:0.13889em;">SECT</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.10903em;">ON</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.13889em;">FT</span></span></span></span></span></div>
</li>
</ul>
</li>
<li>
<p>ç”±äºè¿™ç§å…³ç³»æ˜¯<strong>å›ºå®šå¯è®¡ç®—</strong>çš„ï¼Œæ‰€ä»¥æ²¡å¿…è¦åœ¨ç»“æ„ä½“é‡Œå†å­˜ä¸€ä¸ª <code>start_pfn</code> å­—æ®µã€‚</p>
</li>
</ul>
</li>
</ul>
<p><strong>æ€»ç»“ï¼š</strong><br/>
<strong>â€œè®¾ç½® start_pfnâ€æ˜¯é€»è¾‘åŠ¨ä½œï¼›å®é™…ä»£ç æ˜¯â€œé€šè¿‡ section ä¸‹æ ‡ + å¸¸é‡è®¡ç®— start_pfnâ€ï¼Œä¸éœ€è¦æˆå‘˜å˜é‡ã€‚</strong></p>
<hr/>
<h2 data-id="heading-7">5. mem_section çš„ present / section_mem_map</h2>
<h3 data-id="heading-8">5.1 mem_sections å…¨å±€æ•°ç»„</h3>
<ul>
<li>å†…æ ¸ç»´æŠ¤ä¸€ä¸ªå…¨å±€çš„ section æ•°ç»„ï¼ˆé€»è¾‘ä¸Šï¼‰ï¼š
<pre><code class="hljs language-c" lang="c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">mem_section</span> *<span class="hljs-title">mem_sections</span>[<span class="hljs-title">NR_MEM_SECTIONS</span>];</span>
</code></pre>
</li>
<li>æ¯ä¸ªä¸‹æ ‡ <code>i</code> å¯¹åº”ä¸€ä¸ªè¦†ç›–å›ºå®šåœ°å€èŒƒå›´çš„ sectionã€‚</li>
</ul>
<h3 data-id="heading-9">5.2 present çš„â€œéšå¼â€è¡¨ç¤º</h3>
<ul>
<li>æ¦‚å¿µä¸Šï¼Œä¼šè¯´ <code>mem_section[i].present = 1</code> è¡¨ç¤ºè¿™ä¸ª section é‡Œæœ‰å†…å­˜ã€‚</li>
<li>å®ç°ä¸Šï¼Œé€šå¸¸é€šè¿‡ï¼š
<ul>
<li><code>mem_sections[i]</code> æ˜¯å¦ä¸º <code>NULL</code>ï¼›</li>
<li>æˆ–è€…åœ¨ <code>section_mem_map</code> æŒ‡é’ˆçš„ä½ä½ä¸Šç¼–ç ä¸€äº› bitï¼›
æ¥è¡¨ç¤ºè¿™ä¸ª section æ˜¯å¦ <strong>present / online</strong>ã€‚</li>
</ul>
</li>
</ul>
<p><strong>ç»“è®ºï¼š</strong><br/>
<strong>â€œpresent å­—æ®µâ€ä¸€èˆ¬ä¹Ÿæ˜¯æ¦‚å¿µæè¿°ï¼›å®é™…ä½¿ç”¨çš„æ˜¯æŒ‡é’ˆæ˜¯å¦ä¸ºç©ºã€æŒ‡é’ˆä¸Šçš„æ ‡å¿—ä½ç­‰æ‰‹æ®µã€‚</strong></p>
<h3 data-id="heading-10">5.3 section_mem_mapï¼šæŒ‡å‘ struct page æ•°ç»„</h3>
<ul>
<li><code>struct mem_section</code> çš„æ ¸å¿ƒå­—æ®µæ˜¯ <strong><code>section_mem_map</code></strong>ï¼š
<ul>
<li>æŒ‡å‘ä¸€ä¸ª <code>struct page</code> æ•°ç»„ã€‚</li>
<li>æ•°ç»„é•¿åº¦è¦†ç›–æ•´ä¸ª section èŒƒå›´çš„æ‰€æœ‰é¡µæ•°ï¼š<code>PAGES_PER_SECTION</code>ã€‚</li>
</ul>
</li>
<li>åç»­æ‰€æœ‰å…³äºè¯¥ section å†… page çš„ä¿¡æ¯ï¼ˆæ˜¯å¦ç©ºæ´ã€æ˜¯å¦å¯ç”¨ã€å±äºå“ªä¸ª zone/node ç­‰ï¼‰éƒ½é€šè¿‡è¿™äº› <code>struct page</code> çš„å­—æ®µæ¥è¡¨è¾¾ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-11">6. å†…å­˜ç©ºæ´ä¸ struct page çš„åˆ†é…</h2>
<h3 data-id="heading-12">6.1 â€œç©ºæ´ä¹Ÿä¼šåˆ†é… page å—ï¼Ÿâ€</h3>
<p><strong>æ›´ç²¾ç¡®çš„è¯´æ³•ï¼š</strong></p>
<ul>
<li>å¯¹äº<strong>å·²ç»æ ‡è®°ä¸º present çš„ section</strong>ï¼š
<ul>
<li>å†…æ ¸ä¼šä¸ºè¯¥ section è¦†ç›–çš„æ•´ä¸ªåœ°å€èŒƒå›´åˆ†é…ä¸€æ•´å— <code>struct page</code> æ•°ç»„ã€‚</li>
<li>å…¶ä¸­ï¼š
<ul>
<li>ä½äºçœŸå® RAM èŒƒå›´çš„é‚£äº›é¡µï¼Œå¯¹åº”çš„ <code>struct page</code> ä¼šè¢«åˆå§‹åŒ–ä¸º <strong>å¯ç”¨å†…å­˜é¡µ</strong>ï¼›</li>
<li>ä½äºå†…å­˜ç©ºæ´ï¼ˆMMIO/ä¿ç•™åŒºåŸŸï¼‰èŒƒå›´çš„é‚£äº›é¡µï¼Œå¯¹åº”çš„ <code>struct page</code> ä¼šè¢«æ ‡è®°ä¸º <strong><code>PG_reserved</code></strong>ï¼Œä¸ä¼šåŠ å…¥ä¼™ä¼´ç³»ç»Ÿã€‚</li>
</ul>
</li>
</ul>
</li>
<li>å¯¹äº<strong>å®Œå…¨æ²¡æœ‰ RAM çš„ section</strong>ï¼ˆæ•´ä¸ª section æ˜¯æ´ï¼‰ï¼š
<ul>
<li>è¯¥ section é€šå¸¸ä¸ä¼šè¢«æ ‡è®°ä¸º presentï¼Œä¹Ÿä¸ä¼šåˆ†é… <code>struct mem_section</code> å’Œ <code>section_mem_map</code>ï¼Œè‡ªç„¶ä¹Ÿå°±æ²¡æœ‰ <code>struct page</code>ã€‚</li>
</ul>
</li>
</ul>
<p><strong>æ‰€ä»¥ï¼š</strong></p>
<ul>
<li><strong>â€œç©ºæ´ä¹Ÿä¼šåˆ†é…ç›¸åº”çš„ pageâ€</strong> è¿™å¥è¯åœ¨ä¸Šä¸‹æ–‡ä¸Šï¼Œåº”ç†è§£ä¸ºï¼š<br/>
<strong>â€œåœ¨ä¸€ä¸ªå·²å­˜åœ¨ï¼ˆpresentï¼‰çš„ section å†…éƒ¨ï¼Œå³ä¾¿æŸäº›å­èŒƒå›´æ˜¯å†…å­˜ç©ºæ´ï¼Œä¹Ÿä¼šæœ‰å¯¹åº”çš„ <code>struct page</code>ï¼Œä½†è¿™äº› page ä¼šæ ‡è®°ä¸º <code>PG_reserved</code>ï¼Œä¸å‚ä¸åˆ†é…ã€‚â€</strong></li>
</ul>
<h3 data-id="heading-13">6.2 è¿™æ ·åšçš„æ ¸å¿ƒç†ç”±ï¼špfn_to_page / page_to_pfn çš„æè‡´æ•ˆç‡</h3>
<ul>
<li>
<p>æ ¸å¿ƒéœ€æ±‚ï¼š<br/>
<strong><code>pfn_to_page(pfn)</code> å’Œ <code>page_to_pfn(page)</code> å¿…é¡»éå¸¸å¿«ã€‚</strong></p>
</li>
<li>
<p>åœ¨ sparsemem ä¸‹ï¼Œ<code>pfn_to_page()</code> çš„å…¸å‹è®¡ç®—é€»è¾‘ï¼š</p>
<ol>
<li>è®¡ç®— section ä¸‹æ ‡ï¼š
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>section</mtext><mo>=</mo><mtext>pfn</mtext><mo>&gt;</mo><mo>&gt;</mo><mi>P</mi><mi>F</mi><mi>N</mi><mi mathvariant="normal">_</mi><mi>S</mi><mi>E</mi><mi>C</mi><mi>T</mi><mi>I</mi><mi>O</mi><mi>N</mi><mi mathvariant="normal">_</mi><mi>S</mi><mi>H</mi><mi>I</mi><mi>F</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">\text{section} = \text{pfn} &gt;&gt; PFN\_SECTION\_SHIFT</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6679em;"/><span class="mord text"><span class="mord">section</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord text"><span class="mord">pfn</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">&gt;&gt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.9933em;vertical-align:-0.31em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">PFN</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathnormal" style="margin-right:0.13889em;">SECT</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.10903em;">ON</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.13889em;">FT</span></span></span></span></span></div>
</li>
<li>è®¡ç®—åœ¨ section å†…çš„é¡µåç§»ï¼š
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>offset</mtext><mo>=</mo><mtext>pfn</mtext><mi mathvariant="normal">&amp;</mi><mo stretchy="false">(</mo><mi>P</mi><mi>A</mi><mi>G</mi><mi>E</mi><mi>S</mi><mi mathvariant="normal">_</mi><mi>P</mi><mi>E</mi><mi>R</mi><mi mathvariant="normal">_</mi><mi>S</mi><mi>E</mi><mi>C</mi><mi>T</mi><mi>I</mi><mi>O</mi><mi>N</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\text{offset} = \text{pfn} \&amp; (PAGES\_PER\_SECTION - 1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord text"><span class="mord">offset</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.06em;vertical-align:-0.31em;"/><span class="mord text"><span class="mord">pfn</span></span><span class="mord">&amp;</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.05764em;">GES</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathnormal" style="margin-right:0.00773em;">PER</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathnormal" style="margin-right:0.13889em;">SECT</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.10903em;">ON</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">1</span><span class="mclose">)</span></span></span></span></span></div>
</li>
<li>æ‰¾åˆ°è¯¥ section çš„ <code>section_mem_map</code>ï¼š
<pre><code class="hljs language-c" lang="c">mem_map = __nr_to_section(section)-&gt;section_mem_map;
</code></pre>
</li>
<li>è¿”å›å¯¹åº”é¡µï¼š
<pre><code class="hljs language-c" lang="c">page = &amp;mem_map[offset];
</code></pre>
</li>
</ol>
</li>
<li>
<p>ä¹‹æ‰€ä»¥èƒ½åšåˆ°<strong>çº¯ç®—æœ¯ + æ•°ç»„ä¸‹æ ‡è®¿é—®</strong>ï¼Œå‰æå°±æ˜¯ï¼š</p>
<ul>
<li>å¯¹äºä¸€ä¸ª present çš„ sectionï¼Œæ•´ä¸ª PRFN èŒƒå›´éƒ½æœ‰ä¸€ä¸ªè¿ç»­çš„ <code>struct page</code> æ•°ç»„ä¸å…¶ä¸€ä¸€å¯¹åº”ï¼Œæ— è®ºæ˜¯å¦æ´ã€‚</li>
</ul>
</li>
<li>
<p>å¯¹äºæ´ä¸­çš„é¡µï¼Œ<code>struct page</code> ä»ç„¶å­˜åœ¨ï¼Œä½†é€šè¿‡ <code>flags</code>ï¼ˆå¦‚ <code>PG_reserved</code>ï¼‰è¡¨ç¤ºâ€œä¸å¯ç”¨â€ã€‚</p>
</li>
</ul>
<p><strong>è¿™æ˜¯ä¸€ç§å…¸å‹çš„â€œç©ºé—´æ¢æ—¶é—´â€è®¾è®¡ï¼š</strong></p>
<ul>
<li>ç©ºé—´æˆæœ¬ï¼š<br/>
æ¯ä¸ª <code>struct page</code> å å‡ åå­—èŠ‚ï¼Œä¸€ä¸ªå¤§ section ä¼šç”¨æ‰å‡ ç™¾ KB æˆ–å‡  MB çš„å†…æ ¸å†…å­˜ã€‚</li>
<li>æ—¶é—´æ”¶ç›Šï¼š<br/>
æ¢æ¥ pfn/page åŒå‘è½¬æ¢åœ¨å†…æ ¸æ ¸å¿ƒè·¯å¾„ä¸Šçš„<strong>æé«˜æ€§èƒ½</strong>ï¼Œé¿å…å¤æ‚æŸ¥è¡¨å’Œæœç´¢é€»è¾‘ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-14">7. SPARSEMEM_VMEMMAP vs ä¼ ç»Ÿ SPARSEMEMï¼ˆç®€è¦ï¼‰</h2>
<ul>
<li><strong>SPARSEMEM_VMEMMAP</strong>ï¼š
<ul>
<li>å°†æ‰€æœ‰ <code>struct page</code> è‡ªèº«æ”¾è¿›ä¸€ä¸ªä¸“é—¨çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼ˆvmemmapï¼‰ã€‚</li>
<li>å¯¹äºâ€œå¯èƒ½å­˜åœ¨çš„æ‰€æœ‰ PFNâ€éƒ½æœ‰ä¸€æ¡ <code>struct page</code>ï¼Œæ´åˆ™ç”¨ <code>PG_reserved</code> ç­‰æ ‡è¯†ã€‚</li>
<li>pfn ä¸ <code>struct page*</code> ä¹‹é—´å‡ ä¹æ˜¯ä¸€ä¸€æ˜ å°„ï¼ˆåŠ åç§»å³å¯ï¼‰ï¼Œæ›´ç»Ÿä¸€ã€‚</li>
</ul>
</li>
<li><strong>ä¼ ç»Ÿ SPARSEMEMï¼ˆé vmemmapï¼‰</strong>ï¼š
<ul>
<li>æ¯ä¸ª present çš„ section å•ç‹¬åˆ†é…ä¸€å— <code>struct page</code> æ•°ç»„ã€‚</li>
<li>Section å†…éƒ¨çš„æ´ä¹Ÿæœ‰å¯¹åº” <code>struct page</code>ï¼Œç”¨äºä¿æŒç´¢å¼•è¿ç»­ï¼Œä½†å®Œå…¨ç©ºçš„ section ä¸åˆ†é…ã€‚</li>
</ul>
</li>
</ul>
<p><strong>å…±åŒç‚¹ï¼š</strong><br/>
<strong>åªè¦ section è¢«è®¤ä¸ºæ˜¯ presentï¼Œå…¶è¦†ç›–èŒƒå›´å†…çš„ PFN ä¸€èˆ¬éƒ½ä¼šæœ‰å¯¹åº”çš„ <code>struct page</code> å¯¹è±¡ï¼›â€œæ˜¯å¦çœŸå®å†…å­˜â€åˆ™é€šè¿‡ <code>struct page</code> çš„æ ‡å¿—ä½åŒºåˆ†ã€‚</strong></p>
<hr/>
<h2 data-id="heading-15">8. æ€»ç»“æ€ç»´æ¨¡å‹</h2>
<p>å¯ä»¥ç”¨ä»¥ä¸‹æ¨¡å‹åœ¨è„‘å­é‡Œâ€œç”»å›¾â€ï¼š</p>
<ol>
<li>
<p><strong>ç¬¬ä¸€å±‚ï¼šmem_section ç½‘æ ¼</strong></p>
<ul>
<li>æ•´ä¸ªç‰©ç†åœ°å€ç©ºé—´è¢«<strong>å‡åŒ€åˆ’åˆ†ä¸ºä¸€ä¸ªä¸ªç½‘æ ¼ï¼ˆmem_sectionï¼‰</strong>ã€‚</li>
<li>æ¯ä¸ªç½‘æ ¼ç¼–å·ä¸º <code>i</code>ï¼Œè´Ÿè´£ <code>[i * SECTION_SIZE, (i+1) * SECTION_SIZE)</code>ã€‚</li>
</ul>
</li>
<li>
<p><strong>ç¬¬äºŒå±‚ï¼šsection_mem_map è´¦æœ¬</strong></p>
<ul>
<li>æ¯ä¸ª**å­˜åœ¨å†…å­˜çš„ç½‘æ ¼ï¼ˆpresent sectionï¼‰**æ‹¥æœ‰ä¸€æœ¬â€œè´¦æœ¬â€ï¼ˆ<code>section_mem_map</code>ï¼‰ï¼Œè´¦æœ¬çš„æ¯ä¸€é¡µæ˜¯ä¸€ä¸ª <code>struct page</code>ï¼Œå¯¹åº”ç½‘æ ¼é‡Œçš„ä¸€ä¸ª PFNã€‚</li>
<li>è´¦æœ¬æ˜¯è¿ç»­é¡µç  0 ~ <code>PAGES_PER_SECTION-1</code>ï¼Œå¯ä»¥é€šè¿‡ç®€å•ç®—æœ¯æ‰¾åˆ°æŸä¸€é¡µã€‚</li>
</ul>
</li>
<li>
<p><strong>ç¬¬ä¸‰å±‚ï¼špage æ ‡å¿—ä½</strong></p>
<ul>
<li><strong>çœŸå®å†…å­˜é¡µ</strong>ï¼šè´¦æœ¬è¯¥é¡µè®°å½•ä¸ºâ€œå¯ç”¨â€ï¼Œä¼šè¢«åŠ å…¥ä¼™ä¼´ç³»ç»Ÿã€‚</li>
<li><strong>å†…å­˜ç©ºæ´é¡µ</strong>ï¼šè´¦æœ¬è¯¥é¡µè®°å½•ä¸ºâ€œä¿ç•™/æ— æ•ˆâ€ï¼ˆä¾‹å¦‚ <code>PG_reserved</code>ï¼‰ï¼Œä¸ä¼šå‚ä¸åˆ†é…ã€‚</li>
</ul>
</li>
<li>
<p><strong>é€»è¾‘ä¸Šçš„ start_pfn</strong></p>
<ul>
<li>æ¦‚å¿µä¸Šï¼šâ€œä¸º section è®¾å®š start_pfnâ€ã€‚</li>
<li>å®ç°ä¸Šï¼š<strong>é€šè¿‡ section ä¸‹æ ‡ * PAGES_PER_SECTION è®¡ç®—ï¼Œä¸å­˜æˆå­—æ®µã€‚</strong></li>
</ul>
</li>
</ol>
<p>è¿™æ ·ï¼Œä½ ä¹‹å‰é‚£å¥—å™è¿°ï¼š</p>
<ul>
<li>â€œmem_section ä¸éœ€è¦æ˜¯å®Œæ•´çš„ 256M å†…å­˜â€</li>
<li>â€œçƒ­æ’æ‹”ä¸è¦æ±‚æ˜¯ SECTION_SIZE çš„å€æ•°â€</li>
<li>â€œå†…å­˜ä¸ä¸€å®šä» section èµ·å§‹ PFN å¼€å§‹â€</li>
<li>â€œç©ºæ´ä¹Ÿä¼šæœ‰å¯¹åº” pageï¼ˆåœ¨ present section å†…éƒ¨ï¼‰â€</li>
<li>â€œstart_pfn æ˜¯é€šè¿‡ä½ç½®è®¡ç®—å‡ºæ¥çš„ï¼Œå¹¶ä¸çœŸæœ‰å­—æ®µâ€</li>
</ul>
<p>åœ¨é€»è¾‘å±‚é¢éƒ½æ˜¯<strong>è‡ªæ´½ä¸”ä¸å®ç°å»åˆçš„</strong>ã€‚åªè¦åŠ ä¸Šä¸€ä¸ªå°ä¿®æ­£ï¼š<br/>
<strong>â€œå®Œå…¨ç©ºçš„ section ä¸€èˆ¬è¿ mem_section/section_mem_map éƒ½ä¸ä¼šåˆ†é…ï¼Œè‡ªç„¶ä¹Ÿæ²¡æœ‰ <code>struct page</code>â€ï¼Œç©ºæ´æœ‰ page è¿™ä»¶äº‹æ˜¯â€œå­˜åœ¨äºå·²ç» present çš„ section å†…éƒ¨â€çš„è¯­å¢ƒä¸‹æˆç«‹çš„ã€‚</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åˆ«å†ç”¨å®šæ—¶ä»»åŠ¡æ‰«åº“äº†ï¼SpringBooté›†æˆRediså®ç°è®¢å•è¶…æ—¶ç®¡ç†]]></title>    <link>https://juejin.cn/post/7598433254128549928</link>    <guid>https://juejin.cn/post/7598433254128549928</guid>    <pubDate>2026-01-24T03:11:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598433254128549928" data-draft-id="7598403436699697186" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åˆ«å†ç”¨å®šæ—¶ä»»åŠ¡æ‰«åº“äº†ï¼SpringBooté›†æˆRediså®ç°è®¢å•è¶…æ—¶ç®¡ç†"/> <meta itemprop="keywords" content="åç«¯,Java,Redis"/> <meta itemprop="datePublished" content="2026-01-24T03:11:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ‚Ÿç©ºç å­—"/> <meta itemprop="url" content="https://juejin.cn/user/3139860942296830"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åˆ«å†ç”¨å®šæ—¶ä»»åŠ¡æ‰«åº“äº†ï¼SpringBooté›†æˆRediså®ç°è®¢å•è¶…æ—¶ç®¡ç†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3139860942296830/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ‚Ÿç©ºç å­—
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T03:11:23.000Z" title="Sat Jan 24 2026 03:11:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°æ‚Ÿã€‚</p>
<p>å¬è¯´ä½ è¦ç”¨Redisæ¥å¤„ç†è¶…æ—¶æ”¯ä»˜è®¢å•ï¼ŸRediså°±åƒä¸€ä¸ªä½åœ¨ä½ å†…å­˜é‡Œçš„é—ªç”µä¾ ï¼Œå®ƒè·‘å¾—é£å¿«ï¼Œä½†è®°æ€§æœ‰ç‚¹å·®ï¼ˆæ–­ç”µå°±å¤±å¿†ï¼‰ã€‚å®ƒæ˜¯ä¸ªé”®å€¼å¯¹å­˜å‚¨çš„ç¤¾äº¤ææƒ§ç—‡æ‚£è€…ï¼Œå°±å–œæ¬¢ç®€å•ç›´æ¥çš„äº¤æµã€‚ä¸è¿‡å¯¹ä»˜è®¢å•è¶…æ—¶è¿™ç§â€œé™æ—¶ä»»åŠ¡â€ï¼Œå®ƒå¯æ˜¯ä¸“ä¸šçš„â€œæ—¶é—´ç®¡ç†å¤§å¸ˆâ€ï¼</p>
<h2 data-id="heading-0">ä¸ºä»€ä¹ˆé€‰Redisæ¥åšè¿™ä¸ªï¼Ÿ</h2>
<p>ä½ å¼€äº†ä¸€å®¶ç½‘çº¢å¥¶èŒ¶åº—ï¼Œé¡¾å®¢ä¸‹å•å30åˆ†é’Ÿä¸ä»˜æ¬¾ï¼Œè®¢å•å°±è‡ªåŠ¨å–æ¶ˆã€‚ä½ æ€»ä¸èƒ½é›‡ä¸ªåº—å‘˜ç›¯ç€æ¯ä¸ªè®¢å•çœ‹30åˆ†é’Ÿå§ï¼ŸRedisçš„è¿‡æœŸé”®å’Œå‘å¸ƒè®¢é˜…åŠŸèƒ½ï¼Œå°±æ˜¯é‚£ä¸ªä¸çŸ¥ç–²å€¦çš„â€œè‡ªåŠ¨å–æ¶ˆä¸“å‘˜â€ï¼</p>
<hr/>
<h2 data-id="heading-1">è¯¦ç»†æ­¥éª¤ï¼šè®©æˆ‘ä»¬å¼€å§‹ç»„è£…è¿™ä¸ªâ€œè®¢å•å–æ¶ˆæœºå™¨äººâ€</h2>
<h3 data-id="heading-2">ç¬¬1æ­¥ï¼šå¼•å…¥Redisä¾èµ–åŒ…</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- pom.xml é‡ŒåŠ å…¥è¿™ä¸ªâ€œèƒ½é‡é¥®æ–™â€ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.commons<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-pool2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h3 data-id="heading-3">ç¬¬2æ­¥ï¼šé…ç½®Redisè¿æ¥</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># application.yml</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">redis:</span>
    <span class="hljs-comment"># Redisçš„åœ°å€ï¼Œé»˜è®¤æ˜¯æœ¬åœ°6379ç«¯å£</span>
    <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span>
    <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span>
    <span class="hljs-comment"># å¯†ç ï¼ˆå¦‚æœè®¾ç½®äº†çš„è¯ï¼‰</span>
    <span class="hljs-attr">password:</span> 
    <span class="hljs-comment"># æ•°æ®åº“ç´¢å¼•ï¼Œå°±åƒç»™é—ªç”µä¾ å®‰æ’çš„ç¬¬å‡ ä¸ªæˆ¿é—´</span>
    <span class="hljs-attr">database:</span> <span class="hljs-number">0</span>
    <span class="hljs-attr">lettuce:</span>
      <span class="hljs-attr">pool:</span>
        <span class="hljs-comment"># è¿æ¥æ± é…ç½®ï¼Œåˆ«è®©é—ªç”µä¾ ç´¯ç€äº†</span>
        <span class="hljs-attr">max-active:</span> <span class="hljs-number">8</span>
        <span class="hljs-attr">max-idle:</span> <span class="hljs-number">8</span>
        <span class="hljs-attr">min-idle:</span> <span class="hljs-number">0</span>
        <span class="hljs-attr">max-wait:</span> <span class="hljs-string">100ms</span>
</code></pre>
<h3 data-id="heading-4">ç¬¬3æ­¥ï¼šé…ç½®RedisTemplate</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">import</span> com.fasterxml.jackson.annotation.JsonTypeInfo;
<span class="hljs-keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;
<span class="hljs-keyword">import</span> com.fasterxml.jackson.datatype.jsr310.JavaTimeModule;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;
<span class="hljs-keyword">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;
<span class="hljs-keyword">import</span> org.springframework.data.redis.core.RedisTemplate;
<span class="hljs-keyword">import</span> org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;
<span class="hljs-keyword">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;

@Configuration
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisConfig</span> {
    
    @<span class="hljs-function">Bean
    <span class="hljs-keyword">public</span> RedisTemplate&lt;<span class="hljs-type">String</span>, Object&gt; <span class="hljs-title">redisTemplate</span><span class="hljs-params">(RedisConnectionFactory factory)</span> </span>{
        RedisTemplate&lt;<span class="hljs-type">String</span>, Object&gt; <span class="hljs-keyword">template</span> = <span class="hljs-keyword">new</span> RedisTemplate&lt;&gt;();
        <span class="hljs-keyword">template</span>.<span class="hljs-built_in">setConnectionFactory</span>(factory);
        
        <span class="hljs-comment">// é”®çš„åºåˆ—åŒ– - å­—ç¬¦ä¸²åºåˆ—åŒ–</span>
        <span class="hljs-keyword">template</span>.<span class="hljs-built_in">setKeySerializer</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">StringRedisSerializer</span>());
        <span class="hljs-keyword">template</span>.<span class="hljs-built_in">setHashKeySerializer</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">StringRedisSerializer</span>());
        
        <span class="hljs-comment">// å€¼çš„åºåˆ—åŒ– - JSONåºåˆ—åŒ–</span>
        Jackson2JsonRedisSerializer&lt;Object&gt; serializer = <span class="hljs-keyword">new</span> Jackson2JsonRedisSerializer&lt;&gt;(Object.<span class="hljs-keyword">class</span>);
        ObjectMapper mapper = <span class="hljs-keyword">new</span> <span class="hljs-built_in">ObjectMapper</span>();
        mapper.<span class="hljs-built_in">registerModule</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">JavaTimeModule</span>());
        mapper.<span class="hljs-built_in">activateDefaultTyping</span>(
            mapper.<span class="hljs-built_in">getPolymorphicTypeValidator</span>(),
            ObjectMapper.DefaultTyping.NON_FINAL,
            JsonTypeInfo.As.PROPERTY
        );
        serializer.<span class="hljs-built_in">setObjectMapper</span>(mapper);
        
        <span class="hljs-keyword">template</span>.<span class="hljs-built_in">setValueSerializer</span>(serializer);
        <span class="hljs-keyword">template</span>.<span class="hljs-built_in">setHashValueSerializer</span>(serializer);
        
        <span class="hljs-keyword">template</span>.<span class="hljs-built_in">afterPropertiesSet</span>();
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">template</span>;
    }
}
</code></pre>
<h3 data-id="heading-5">ç¬¬4æ­¥ï¼šè®¢å•å®ä½“ç±»</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> lombok.<span class="hljs-property">Data</span>;
<span class="hljs-keyword">import</span> java.<span class="hljs-property">time</span>.<span class="hljs-property">LocalDateTime</span>;

<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Order</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> orderId;          <span class="hljs-comment">// è®¢å•ID</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> userId;           <span class="hljs-comment">// ç”¨æˆ·ID</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">Double</span> amount;           <span class="hljs-comment">// è®¢å•é‡‘é¢</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">Integer</span> status;          <span class="hljs-comment">// è®¢å•çŠ¶æ€ï¼š0-å¾…æ”¯ä»˜ï¼Œ1-å·²æ”¯ä»˜ï¼Œ2-å·²å–æ¶ˆ</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">LocalDateTime</span> createTime;<span class="hljs-comment">// åˆ›å»ºæ—¶é—´</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">LocalDateTime</span> expireTime;<span class="hljs-comment">// è¿‡æœŸæ—¶é—´</span>
    
    <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦å·²è¿‡æœŸ</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">isExpired</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">LocalDateTime</span>.<span class="hljs-title function_">now</span>().<span class="hljs-title function_">isAfter</span>(expireTime);
    }
}
</code></pre>
<h3 data-id="heading-6">ç¬¬5æ­¥ï¼šRedisæœåŠ¡ç±»</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">beans</span>.<span class="hljs-property">factory</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">Autowired</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">data</span>.<span class="hljs-property">redis</span>.<span class="hljs-property">core</span>.<span class="hljs-property">RedisTemplate</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">data</span>.<span class="hljs-property">redis</span>.<span class="hljs-property">core</span>.<span class="hljs-property">StringRedisTemplate</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">stereotype</span>.<span class="hljs-property">Service</span>;
<span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">concurrent</span>.<span class="hljs-property">TimeUnit</span>;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisOrderService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">RedisTemplate</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt; redisTemplate;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">StringRedisTemplate</span> stringRedisTemplate;
    
    <span class="hljs-comment">// è®¢å•å‰ç¼€ï¼Œé¿å…é”®å†²çª</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> final <span class="hljs-title class_">String</span> <span class="hljs-variable constant_">ORDER_KEY_PREFIX</span> = <span class="hljs-string">"order:pay:"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> final <span class="hljs-title class_">String</span> <span class="hljs-variable constant_">ORDER_EXPIRE_CHANNEL</span> = <span class="hljs-string">"order.expire"</span>;
    
    <span class="hljs-comment">/**
     * åˆ›å»ºè®¢å•å¹¶è®¾ç½®30åˆ†é’Ÿè¿‡æœŸæ—¶é—´
     * å°±åƒç»™é—ªç”µä¾ è¯´ï¼šâ€œç›¯ç€è¿™ä¸ªè®¢å•ï¼Œ30åˆ†é’Ÿåæé†’æˆ‘â€
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">createOrderWithExpire</span>(<span class="hljs-params">Order order, int expireMinutes</span>) {
        <span class="hljs-title class_">String</span> orderKey = <span class="hljs-variable constant_">ORDER_KEY_PREFIX</span> + order.<span class="hljs-title function_">getOrderId</span>();
        
        <span class="hljs-comment">// ä¿å­˜è®¢å•åˆ°Redisï¼Œ30åˆ†é’Ÿåè‡ªåŠ¨åˆ é™¤</span>
        redisTemplate.<span class="hljs-title function_">opsForValue</span>().<span class="hljs-title function_">set</span>(
            orderKey, 
            order, 
            expireMinutes, 
            <span class="hljs-title class_">TimeUnit</span>.<span class="hljs-property">MINUTES</span>
        );
        
        <span class="hljs-comment">// åŒæ—¶è®¾ç½®ä¸€ä¸ªç®€å•çš„æ ‡å¿—ï¼Œç”¨äºç›‘å¬è¿‡æœŸäº‹ä»¶</span>
        stringRedisTemplate.<span class="hljs-title function_">opsForValue</span>().<span class="hljs-title function_">set</span>(
            orderKey + <span class="hljs-string">":flag"</span>, 
            <span class="hljs-string">"1"</span>, 
            expireMinutes, 
            <span class="hljs-title class_">TimeUnit</span>.<span class="hljs-property">MINUTES</span>
        );
        
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"è®¢å• "</span> + order.<span class="hljs-title function_">getOrderId</span>() + <span class="hljs-string">" å·²æ”¾å…¥Redisï¼Œè®¾ç½®"</span> + 
                          expireMinutes + <span class="hljs-string">"åˆ†é’Ÿåè¿‡æœŸ"</span>);
    }
    
    <span class="hljs-comment">/**
     * ç”¨æˆ·æ”¯ä»˜æˆåŠŸï¼Œåˆ é™¤è¿‡æœŸé”®
     * ç›¸å½“äºå‘Šè¯‰é—ªç”µä¾ ï¼šâ€œä¸ç”¨ç›¯äº†ï¼Œé¡¾å®¢ä»˜é’±äº†ï¼â€
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">handlePaymentSuccess</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> orderId</span>) {
        <span class="hljs-title class_">String</span> orderKey = <span class="hljs-variable constant_">ORDER_KEY_PREFIX</span> + orderId;
        
        <span class="hljs-comment">// æ‰‹åŠ¨åˆ é™¤è®¢å•å’Œæ ‡å¿—</span>
        redisTemplate.<span class="hljs-title function_">delete</span>(orderKey);
        stringRedisTemplate.<span class="hljs-title function_">delete</span>(orderKey + <span class="hljs-string">":flag"</span>);
        
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"è®¢å• "</span> + orderId + <span class="hljs-string">" æ”¯ä»˜æˆåŠŸï¼Œå·²ä»Redisç§»é™¤"</span>);
    }
    
    <span class="hljs-comment">/**
     * æ£€æŸ¥è®¢å•æ˜¯å¦è¿˜å­˜åœ¨ï¼ˆæ˜¯å¦å·²è¿‡æœŸï¼‰
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">isOrderExist</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> orderId</span>) {
        <span class="hljs-title class_">String</span> orderKey = <span class="hljs-variable constant_">ORDER_KEY_PREFIX</span> + orderId;
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Boolean</span>.<span class="hljs-property">TRUE</span>.<span class="hljs-title function_">equals</span>(redisTemplate.<span class="hljs-title function_">hasKey</span>(orderKey));
    }
    
    <span class="hljs-comment">/**
     * è·å–è®¢å•ä¿¡æ¯
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Order</span> <span class="hljs-title function_">getOrder</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> orderId</span>) {
        <span class="hljs-title class_">String</span> orderKey = <span class="hljs-variable constant_">ORDER_KEY_PREFIX</span> + orderId;
        <span class="hljs-keyword">return</span> (<span class="hljs-title class_">Order</span>) redisTemplate.<span class="hljs-title function_">opsForValue</span>().<span class="hljs-title function_">get</span>(orderKey);
    }
}
</code></pre>
<h3 data-id="heading-7">ç¬¬6æ­¥ï¼šRedisè¿‡æœŸç›‘å¬é…ç½®</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Configuration;
<span class="hljs-keyword">import</span> org.springframework.<span class="hljs-keyword">data</span>.redis.connection.RedisConnectionFactory;
<span class="hljs-keyword">import</span> org.springframework.<span class="hljs-keyword">data</span>.redis.listener.PatternTopic;
<span class="hljs-keyword">import</span> org.springframework.<span class="hljs-keyword">data</span>.redis.listener.RedisMessageListenerContainer;
<span class="hljs-keyword">import</span> org.springframework.<span class="hljs-keyword">data</span>.redis.listener.adapter.MessageListenerAdapter;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisExpireConfig</span> {
    
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> RedisMessageListenerContainer container(
            RedisConnectionFactory connectionFactory,
            MessageListenerAdapter listenerAdapter) {
        
        RedisMessageListenerContainer container = new RedisMessageListenerContainer();
        container.setConnectionFactory(connectionFactory);
        
        <span class="hljs-comment">// ç›‘å¬æ‰€æœ‰keyè¿‡æœŸäº‹ä»¶</span>
        container.addMessageListener(listenerAdapter, 
            new PatternTopic(<span class="hljs-string">"__keyevent@0__:expired"</span>));
        
        <span class="hljs-keyword">return</span> container;
    }
    
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> MessageListenerAdapter listenerAdapter(RedisKeyExpireListener receiver) {
        <span class="hljs-keyword">return</span> new MessageListenerAdapter(receiver, <span class="hljs-string">"handleMessage"</span>);
    }
}
</code></pre>
<h3 data-id="heading-8">ç¬¬7æ­¥ï¼šè¿‡æœŸäº‹ä»¶ç›‘å¬å™¨</h3>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.<span class="hljs-type">Autowired</span>;
<span class="hljs-keyword">import</span> org.springframework.data.redis.connection.<span class="hljs-type">Message</span>;
<span class="hljs-keyword">import</span> org.springframework.data.redis.listener.adapter.<span class="hljs-type">MessageListenerAdapter</span>;
<span class="hljs-keyword">import</span> org.springframework.stereotype.<span class="hljs-type">Component</span>;
<span class="hljs-keyword">import</span> java.nio.charset.<span class="hljs-type">StandardCharsets</span>;

<span class="hljs-meta">@Component</span>
public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RedisKeyExpireListener</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MessageListenerAdapter</span> </span>{
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">OrderService</span> orderService;
    
    <span class="hljs-comment">/**
     * å½“Redisé”®è¿‡æœŸæ—¶ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šè¢«è°ƒç”¨
     * é—ªç”µä¾ ä¼šå–Šï¼šâ€œå˜¿ï¼é‚£ä¸ªè®¢å•è¿‡æœŸäº†ï¼â€
     */</span>
    <span class="hljs-meta">@Override</span>
    public void handleMessage(<span class="hljs-type">Message</span> message, byte[] pattern) {
        <span class="hljs-type">String</span> expiredKey = <span class="hljs-keyword">new</span> <span class="hljs-type">String</span>(message.getBody(), <span class="hljs-type">StandardCharsets</span>.<span class="hljs-type">UTF_8</span>);
        
        <span class="hljs-comment">// åªå¤„ç†æˆ‘ä»¬çš„è®¢å•è¿‡æœŸé”®</span>
        <span class="hljs-keyword">if</span> (expiredKey.startsWith(<span class="hljs-string">"order:pay:"</span>)) {
            <span class="hljs-comment">// å»æ‰":flag"åç¼€è·å–è®¢å•ID</span>
            <span class="hljs-type">String</span> orderId = expiredKey
                .replace(<span class="hljs-string">"order:pay:"</span>, <span class="hljs-string">""</span>)
                .replace(<span class="hljs-string">":flag"</span>, <span class="hljs-string">""</span>);
            
            <span class="hljs-type">System</span>.out.println(<span class="hljs-string">"RedisæŠ¥å‘Šï¼šè®¢å• "</span> + orderId + <span class="hljs-string">" å·²è¶…æ—¶ï¼"</span>);
            
            <span class="hljs-comment">// å¤„ç†è®¢å•è¶…æ—¶é€»è¾‘</span>
            orderService.cancelExpiredOrder(orderId);
        }
    }
}
</code></pre>
<h3 data-id="heading-9">ç¬¬8æ­¥ï¼šè®¢å•æœåŠ¡å±‚</h3>
<pre><code class="hljs language-scss" lang="scss">import org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.beans</span><span class="hljs-selector-class">.factory</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.Autowired</span>;
import org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.stereotype</span><span class="hljs-selector-class">.Service</span>;
import org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.transaction</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.Transactional</span>;

<span class="hljs-keyword">@Service</span>
public class OrderService {
    
    <span class="hljs-keyword">@Autowired</span>
    private RedisOrderService redisOrderService;
    
    <span class="hljs-keyword">@Autowired</span>
    private OrderRepository orderRepository;
    
    <span class="hljs-comment">/**
     * åˆ›å»ºè®¢å•
     */</span>
    <span class="hljs-keyword">@Transactional</span>
    public Order createOrder(String userId, Double amount) {
        <span class="hljs-attribute">Order</span> <span class="hljs-attribute">order</span> = new <span class="hljs-attribute">Order</span>();
        <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setOrderId</span>(generateOrderId());
        <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setUserId</span>(userId);
        <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setAmount</span>(amount);
        <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setStatus</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">// å¾…æ”¯ä»˜</span>
        <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setCreateTime</span>(LocalDateTime.now());
        <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setExpireTime</span>(LocalDateTime.now()<span class="hljs-selector-class">.plusMinutes</span>(<span class="hljs-number">30</span>));
        
        <span class="hljs-comment">// ä¿å­˜åˆ°æ•°æ®åº“</span>
        orderRepository<span class="hljs-selector-class">.save</span>(order);
        
        <span class="hljs-comment">// ä¿å­˜åˆ°Rediså¹¶è®¾ç½®30åˆ†é’Ÿè¿‡æœŸ</span>
        redisOrderService<span class="hljs-selector-class">.createOrderWithExpire</span>(order, <span class="hljs-number">30</span>);
        
        return <span class="hljs-attribute">order</span>;
    }
    
    <span class="hljs-comment">/**
     * å¤„ç†æ”¯ä»˜å›è°ƒ
     */</span>
    <span class="hljs-keyword">@Transactional</span>
    public void handlePaymentCallback(String orderId) {
        <span class="hljs-comment">// æ£€æŸ¥è®¢å•æ˜¯å¦å·²è¿‡æœŸ</span>
        if (!redisOrderService.isOrderExist(orderId)) {
            throw new <span class="hljs-built_in">RuntimeException</span>("è®¢å•å·²è¶…æ—¶ï¼Œè¯·é‡æ–°ä¸‹å•");
        }
        
        <span class="hljs-comment">// æ›´æ–°è®¢å•çŠ¶æ€ä¸ºå·²æ”¯ä»˜</span>
        orderRepository<span class="hljs-selector-class">.updateOrderStatus</span>(orderId, <span class="hljs-number">1</span>);
        
        <span class="hljs-comment">// ä»Redisç§»é™¤è¿‡æœŸé”®</span>
        redisOrderService<span class="hljs-selector-class">.handlePaymentSuccess</span>(orderId);
        
        System<span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>("è®¢å• " + orderId + " æ”¯ä»˜å¤„ç†å®Œæˆ");
    }
    
    <span class="hljs-comment">/**
     * å–æ¶ˆè¶…æ—¶è®¢å•
     */</span>
    <span class="hljs-keyword">@Transactional</span>
    public void cancelExpiredOrder(String orderId) {
        <span class="hljs-comment">// å†æ¬¡æ£€æŸ¥ï¼Œé˜²æ­¢é‡å¤å¤„ç†</span>
        <span class="hljs-attribute">Order</span> <span class="hljs-attribute">order</span> = orderRepository<span class="hljs-selector-class">.findById</span>(orderId);
        if (order != null &amp;&amp; order.getStatus() == <span class="hljs-number">0</span>) {
            <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setStatus</span>(<span class="hljs-number">2</span>); <span class="hljs-comment">// å·²å–æ¶ˆ</span>
            orderRepository<span class="hljs-selector-class">.save</span>(order);
            
            <span class="hljs-comment">// å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ å…¶ä»–é€»è¾‘ï¼Œæ¯”å¦‚é‡Šæ”¾åº“å­˜ã€å‘é€é€šçŸ¥ç­‰</span>
            System<span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>("è®¢å• " + orderId + " å› è¶…æ—¶æœªæ”¯ä»˜å·²è¢«è‡ªåŠ¨å–æ¶ˆ");
            
            <span class="hljs-comment">// å‘é€å–æ¶ˆé€šçŸ¥</span>
            <span class="hljs-built_in">sendCancelNotification</span>(order);
        }
    }
    
    <span class="hljs-comment">/**
     * å‘é€å–æ¶ˆé€šçŸ¥ï¼ˆæ¨¡æ‹Ÿï¼‰
     */</span>
    private void <span class="hljs-built_in">sendCancelNotification</span>(Order order) {
        <span class="hljs-comment">// è¿™é‡Œå¯ä»¥é›†æˆæ¶ˆæ¯é˜Ÿåˆ—ã€é‚®ä»¶ã€çŸ­ä¿¡ç­‰</span>
        System<span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>("å‘é€é€šçŸ¥ï¼šäº²çˆ±çš„ç”¨æˆ·" + order.getUserId() + 
                          "ï¼Œæ‚¨çš„è®¢å•" + <span class="hljs-attribute">order</span><span class="hljs-selector-class">.getOrderId</span>() + "å› è¶…æ—¶æœªæ”¯ä»˜å·²å–æ¶ˆ");
    }
    
    private String <span class="hljs-built_in">generateOrderId</span>() {
        return "ORD" + System<span class="hljs-selector-class">.currentTimeMillis</span>() + 
               (int)(Math.random() * <span class="hljs-number">1000</span>);
    }
}
</code></pre>
<h3 data-id="heading-10">ç¬¬9æ­¥ï¼šæ§åˆ¶å™¨å±‚</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">beans</span>.<span class="hljs-property">factory</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">Autowired</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">web</span>.<span class="hljs-property">bind</span>.<span class="hljs-property">annotation</span>.*;

<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/orders"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderController</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">OrderService</span> orderService;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">RedisOrderService</span> redisOrderService;
    
    <span class="hljs-comment">/**
     * åˆ›å»ºè®¢å•
     */</span>
    <span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"/create"</span>)
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">ApiResult</span> <span class="hljs-title function_">createOrder</span>(<span class="hljs-params"><span class="hljs-meta">@RequestParam</span> <span class="hljs-built_in">String</span> userId, 
                                <span class="hljs-meta">@RequestParam</span> Double amount</span>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-title class_">Order</span> order = orderService.<span class="hljs-title function_">createOrder</span>(userId, amount);
            <span class="hljs-keyword">return</span> <span class="hljs-title class_">ApiResult</span>.<span class="hljs-title function_">success</span>(<span class="hljs-string">"è®¢å•åˆ›å»ºæˆåŠŸ"</span>, order);
        } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> e) {
            <span class="hljs-keyword">return</span> <span class="hljs-title class_">ApiResult</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"è®¢å•åˆ›å»ºå¤±è´¥ï¼š"</span> + e.<span class="hljs-title function_">getMessage</span>());
        }
    }
    
    <span class="hljs-comment">/**
     * æ¨¡æ‹Ÿæ”¯ä»˜
     */</span>
    <span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"/pay"</span>)
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">ApiResult</span> <span class="hljs-title function_">payOrder</span>(<span class="hljs-params"><span class="hljs-meta">@RequestParam</span> <span class="hljs-built_in">String</span> orderId</span>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// æ¨¡æ‹Ÿæ”¯ä»˜å¤„ç†æ—¶é—´</span>
            <span class="hljs-title class_">Thread</span>.<span class="hljs-title function_">sleep</span>(<span class="hljs-number">1000</span>);
            
            orderService.<span class="hljs-title function_">handlePaymentCallback</span>(orderId);
            <span class="hljs-keyword">return</span> <span class="hljs-title class_">ApiResult</span>.<span class="hljs-title function_">success</span>(<span class="hljs-string">"æ”¯ä»˜æˆåŠŸ"</span>);
        } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">InterruptedException</span> e) {
            <span class="hljs-title class_">Thread</span>.<span class="hljs-title function_">currentThread</span>().<span class="hljs-title function_">interrupt</span>();
            <span class="hljs-keyword">return</span> <span class="hljs-title class_">ApiResult</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"æ”¯ä»˜å¤„ç†ä¸­æ–­"</span>);
        } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> e) {
            <span class="hljs-keyword">return</span> <span class="hljs-title class_">ApiResult</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"æ”¯ä»˜å¤±è´¥ï¼š"</span> + e.<span class="hljs-title function_">getMessage</span>());
        }
    }
    
    <span class="hljs-comment">/**
     * æ£€æŸ¥è®¢å•çŠ¶æ€
     */</span>
    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/status/{orderId}"</span>)
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">ApiResult</span> <span class="hljs-title function_">checkOrderStatus</span>(<span class="hljs-params"><span class="hljs-meta">@PathVariable</span> <span class="hljs-built_in">String</span> orderId</span>) {
        <span class="hljs-built_in">boolean</span> exists = redisOrderService.<span class="hljs-title function_">isOrderExist</span>(orderId);
        <span class="hljs-keyword">if</span> (exists) {
            <span class="hljs-keyword">return</span> <span class="hljs-title class_">ApiResult</span>.<span class="hljs-title function_">success</span>(<span class="hljs-string">"è®¢å•æœ‰æ•ˆï¼Œè¯·å°½å¿«æ”¯ä»˜"</span>);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-title class_">ApiResult</span>.<span class="hljs-title function_">success</span>(<span class="hljs-string">"è®¢å•å·²è¶…æ—¶æˆ–ä¸å­˜åœ¨"</span>);
        }
    }
}

<span class="hljs-comment">// ç®€å•çš„è¿”å›ç»“æœç±»</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiResult</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">boolean</span> success;
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> message;
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">Object</span> data;
    
    <span class="hljs-comment">// æ„é€ æ–¹æ³•å’Œgetter/setterçœç•¥...</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">ApiResult</span> <span class="hljs-title function_">success</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> message</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApiResult</span>(<span class="hljs-literal">true</span>, message, <span class="hljs-literal">null</span>);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">ApiResult</span> <span class="hljs-title function_">success</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> message, <span class="hljs-built_in">Object</span> data</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApiResult</span>(<span class="hljs-literal">true</span>, message, data);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">ApiResult</span> <span class="hljs-title function_">error</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> message</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApiResult</span>(<span class="hljs-literal">false</span>, message, <span class="hljs-literal">null</span>);
    }
}
</code></pre>
<h3 data-id="heading-11">ç¬¬10æ­¥ï¼šåˆ«å¿˜äº†å¼€å¯Redisçš„é”®ç©ºé—´é€šçŸ¥ï¼ˆé‡è¦ï¼ï¼‰</h3>
<p>åœ¨Redisé…ç½®æ–‡ä»¶(redis.conf)ä¸­æˆ–é€šè¿‡Rediså‘½ä»¤è¡Œå¼€å¯ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ–¹å¼1ï¼šé…ç½®æ–‡ä»¶</span>
notify-keyspace-events <span class="hljs-string">"Ex"</span>

<span class="hljs-comment"># æ–¹å¼2ï¼šå‘½ä»¤è¡Œï¼ˆä¸´æ—¶ç”Ÿæ•ˆï¼‰</span>
redis-cli config <span class="hljs-built_in">set</span> notify-keyspace-events Ex
</code></pre>
<p>æˆ–è€…åœ¨ä½ çš„Spring Bootåº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨é…ç½®ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">beans</span>.<span class="hljs-property">factory</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">Autowired</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">data</span>.<span class="hljs-property">redis</span>.<span class="hljs-property">core</span>.<span class="hljs-property">RedisTemplate</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">boot</span>.<span class="hljs-property">CommandLineRunner</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">stereotype</span>.<span class="hljs-property">Component</span>;

<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisConfigRunner</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">CommandLineRunner</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">StringRedisTemplate</span> stringRedisTemplate;
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">run</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>... args</span>) {
        <span class="hljs-comment">// å¼€å¯é”®è¿‡æœŸäº‹ä»¶é€šçŸ¥</span>
        stringRedisTemplate.<span class="hljs-title function_">getConnectionFactory</span>()
            .<span class="hljs-title function_">getConnection</span>()
            .<span class="hljs-title function_">serverCommands</span>()
            .<span class="hljs-title function_">configSet</span>(<span class="hljs-string">"notify-keyspace-events"</span>, <span class="hljs-string">"Ex"</span>);
        
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"Redisé”®ç©ºé—´é€šçŸ¥å·²å¼€å¯"</span>);
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-12">å®Œæ•´çš„å·¥ä½œæµç¨‹</h2>
<ol>
<li><strong>é¡¾å®¢ä¸‹å•</strong>ï¼š<code>POST /orders/create</code> â†’ è®¢å•å­˜å…¥æ•°æ®åº“å’ŒRedisï¼Œå¼€å§‹30åˆ†é’Ÿå€’è®¡æ—¶</li>
<li><strong>Redisç›¯æ¢¢</strong>ï¼šé—ªç”µä¾ å¼€å§‹è®¡æ—¶ï¼Œ30åˆ†é’Ÿå¯¸æ­¥ä¸ç¦»</li>
<li><strong>é¡¾å®¢æ”¯ä»˜</strong>ï¼š
<ul>
<li>30åˆ†é’Ÿå†…æ”¯ä»˜ï¼š<code>POST /orders/pay</code> â†’ Redisåˆ é™¤è®¢å•ï¼Œäº¤æ˜“å®Œæˆ</li>
<li>è¶…è¿‡30åˆ†é’Ÿï¼šRedisé”®è‡ªåŠ¨è¿‡æœŸ â†’ è§¦å‘è¿‡æœŸäº‹ä»¶ â†’ è‡ªåŠ¨å–æ¶ˆè®¢å•</li>
</ul>
</li>
<li><strong>ç³»ç»Ÿé€šçŸ¥</strong>ï¼šç»™é¡¾å®¢å‘é€â€œè®¢å•å·²å–æ¶ˆâ€çš„è´´å¿ƒå°æç¤º</li>
</ol>
<hr/>
<h2 data-id="heading-13">ä¸€äº›é«˜çº§ç©æ³•</h2>
<h3 data-id="heading-14">æ–¹æ¡ˆä¼˜åŒ–ï¼šä½¿ç”¨Redissonçš„å»¶è¿Ÿé˜Ÿåˆ—ï¼ˆæ›´å¯é ï¼‰</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">import</span> org.redisson.api.RBlockingDeque;
<span class="hljs-keyword">import</span> org.redisson.api.RDelayedQueue;
<span class="hljs-keyword">import</span> org.redisson.api.RedissonClient;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> javax.annotation.PostConstruct;
<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;

@Service
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedissonOrderService</span> {
    
    @Autowired
    <span class="hljs-keyword">private</span> RedissonClient redissonClient;
    
    <span class="hljs-keyword">private</span> RBlockingDeque&lt;<span class="hljs-type">String</span>&gt; orderQueue;
    <span class="hljs-keyword">private</span> RDelayedQueue&lt;<span class="hljs-type">String</span>&gt; delayedQueue;
    
    @<span class="hljs-function">PostConstruct
    <span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span> </span>{
        orderQueue = redissonClient.<span class="hljs-built_in">getBlockingDeque</span>(<span class="hljs-string">"orderDelayQueue"</span>);
        delayedQueue = redissonClient.<span class="hljs-built_in">getDelayedQueue</span>(orderQueue);
        
        <span class="hljs-comment">// å¯åŠ¨æ¶ˆè´¹è€…çº¿ç¨‹</span>
        <span class="hljs-keyword">new</span> <span class="hljs-built_in">Thread</span>(<span class="hljs-keyword">this</span>::consumeExpiredOrders).<span class="hljs-built_in">start</span>();
    }
    
    <span class="hljs-comment">/**
     * æ·»åŠ å»¶è¿Ÿè®¢å•
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">addDelayOrder</span><span class="hljs-params">(<span class="hljs-type">String</span> orderId, <span class="hljs-type">long</span> delay, TimeUnit unit)</span> </span>{
        delayedQueue.<span class="hljs-built_in">offer</span>(orderId, delay, unit);
        System.out.<span class="hljs-built_in">println</span>(<span class="hljs-string">"è®¢å• "</span> + orderId + <span class="hljs-string">" å·²åŠ å…¥å»¶è¿Ÿé˜Ÿåˆ—ï¼Œ"</span>
            + delay + <span class="hljs-string">" "</span> + unit + <span class="hljs-string">"åè¿‡æœŸ"</span>);
    }
    
    <span class="hljs-comment">/**
     * æ¶ˆè´¹è¿‡æœŸè®¢å•
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-type">void</span> <span class="hljs-title">consumeExpiredOrders</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// é˜»å¡è·å–è¿‡æœŸè®¢å•</span>
                <span class="hljs-type">String</span> orderId = orderQueue.<span class="hljs-built_in">take</span>();
                System.out.<span class="hljs-built_in">println</span>(<span class="hljs-string">"å»¶è¿Ÿé˜Ÿåˆ—æŠ¥å‘Šï¼šè®¢å• "</span> + orderId + <span class="hljs-string">" å·²è¿‡æœŸ"</span>);
                <span class="hljs-comment">// å¤„ç†è®¢å•å–æ¶ˆé€»è¾‘...</span>
            } <span class="hljs-built_in">catch</span> (InterruptedException e) {
                Thread.<span class="hljs-built_in">currentThread</span>().<span class="hljs-built_in">interrupt</span>();
                <span class="hljs-keyword">break</span>;
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-15">æ³¨æ„äº‹é¡¹ï¼šé˜²é‡å¤å¤„ç†ï¼ˆå¹‚ç­‰æ€§ï¼‰</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// åœ¨OrderServiceä¸­æ·»åŠ é˜²é‡å¤å¤„ç†</span>
<span class="hljs-meta">@Transactional</span>
<span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">cancelExpiredOrder</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> orderId</span>) {
    <span class="hljs-comment">// ä½¿ç”¨Redisåˆ†å¸ƒå¼é”ï¼Œé˜²æ­¢å¤šä¸ªå®ä¾‹åŒæ—¶å¤„ç†åŒä¸€ä¸ªè®¢å•</span>
    <span class="hljs-title class_">String</span> lockKey = <span class="hljs-string">"order:cancel:lock:"</span> + orderId;
    <span class="hljs-title class_">Boolean</span> locked = redisTemplate.<span class="hljs-title function_">opsForValue</span>()
        .<span class="hljs-title function_">setIfAbsent</span>(lockKey, <span class="hljs-string">"1"</span>, <span class="hljs-number">30</span>, <span class="hljs-title class_">TimeUnit</span>.<span class="hljs-property">SECONDS</span>);
    
    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Boolean</span>.<span class="hljs-property">TRUE</span>.<span class="hljs-title function_">equals</span>(locked)) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// å†æ¬¡æ£€æŸ¥è®¢å•çŠ¶æ€ï¼ˆåŒé‡æ ¡éªŒï¼‰</span>
            <span class="hljs-title class_">Order</span> order = orderRepository.<span class="hljs-title function_">findById</span>(orderId);
            <span class="hljs-keyword">if</span> (order != <span class="hljs-literal">null</span> &amp;&amp; order.<span class="hljs-title function_">getStatus</span>() == <span class="hljs-number">0</span>) {
                <span class="hljs-comment">// æ›´æ–°è®¢å•çŠ¶æ€</span>
                order.<span class="hljs-title function_">setStatus</span>(<span class="hljs-number">2</span>);
                orderRepository.<span class="hljs-title function_">save</span>(order);
                
                <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"è®¢å• "</span> + orderId + <span class="hljs-string">" å·²å–æ¶ˆ"</span>);
            }
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-comment">// é‡Šæ”¾é”</span>
            redisTemplate.<span class="hljs-title function_">delete</span>(lockKey);
        }
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-16">æ€»ç»“</h2>
<ol>
<li><strong>æ€§èƒ½çˆ†è¡¨</strong>ï¼šRedisåŸºäºå†…å­˜æ“ä½œï¼Œå¤„ç†é€Ÿåº¦å ªæ¯”é—ªç”µä¾ è·‘æ­¥</li>
<li><strong>ç²¾å‡†å®šæ—¶</strong>ï¼šRedisçš„è¿‡æœŸæœºåˆ¶ç²¾å‡†å¯é ï¼Œè¯¯å·®æå°</li>
<li><strong>è§£è€¦ç¥å™¨</strong>ï¼šä¸šåŠ¡é€»è¾‘å’Œå®šæ—¶ä»»åŠ¡åˆ†ç¦»ï¼Œä»£ç æ¸…çˆ½ä¸æ²¹è…»</li>
<li><strong>æ‰©å±•æ€§å¼º</strong>ï¼šè½»æ¾åº”å¯¹é«˜å¹¶å‘ï¼ŒåŠ ä¸ªRedisé›†ç¾¤å°±èƒ½æ’‘èµ·åŒ11</li>
<li><strong>èµ„æºå‹å¥½</strong>ï¼šä¸éœ€è¦é¢å¤–çš„å®šæ—¶ä»»åŠ¡ä¸­é—´ä»¶ï¼Œçœå¿ƒçœåŠ›</li>
</ol>
<h3 data-id="heading-17">ä½†ä¹Ÿè¦æ³¨æ„è¿™äº›â€œå‘â€</h3>
<ol>
<li><strong>RedisæŒä¹…åŒ–</strong>ï¼šè®°å¾—é…ç½®RDB/AOFï¼Œä¸ç„¶é—ªç”µä¾ â€œå¤±å¿†â€å°±éº»çƒ¦äº†</li>
<li><strong>ç½‘ç»œæ³¢åŠ¨</strong>ï¼šRedisæŒ‚äº†æ€ä¹ˆåŠï¼Ÿè¦æœ‰é™çº§æ–¹æ¡ˆ</li>
<li><strong>äº‹ä»¶ä¸¢å¤±</strong>ï¼šRedisçš„è¿‡æœŸäº‹ä»¶å¯èƒ½ä¸¢å¤±ï¼Œé‡è¦ä¸šåŠ¡è¦æœ‰è¡¥å¿æœºåˆ¶</li>
<li><strong>æ—¶é’ŸåŒæ­¥</strong>ï¼šå¤šæœåŠ¡å™¨æ—¶é—´è¦åŒæ­¥ï¼Œåˆ«è‡ªå·±äººè·Ÿè‡ªå·±äººâ€œæ‰“æ¶â€</li>
</ol>
<h3 data-id="heading-18">æœ€å</h3>
<p>æƒ³è±¡ä¸€ä¸‹ï¼š</p>
<ul>
<li><strong>æ²¡æœ‰Redisæ—¶</strong>ï¼šä½ çš„æ•°æ®åº“è¢«å®šæ—¶ä»»åŠ¡æ‰«å¾—æ°”å–˜ååï¼Œæ¯æ¬¡éƒ½è¦é—®ï¼šâ€œå“ªäº›è®¢å•è¶…æ—¶äº†ï¼Ÿâ€</li>
<li><strong>æœ‰äº†Rediså</strong>ï¼šRedisä¸»åŠ¨æŠ¥å‘Šï¼šâ€œå˜¿ï¼è¿™å‡ ä¸ªè®¢å•è¶…æ—¶äº†ï¼Œå¿«å¤„ç†ï¼â€</li>
</ul>
<p>è¿™å°±å¥½æ¯”ä»â€œæŒ¨å®¶æŒ¨æˆ·æŸ¥æ°´è¡¨â€å˜æˆäº†â€œæ°´è¡¨è‡ªå·±æ‰“ç”µè¯æŠ¥è­¦â€ï¼Œæ•ˆç‡æå‡ä¸æ˜¯ä¸€ç‚¹ç‚¹ï¼å¥½çš„æ¶æ„ï¼Œå°±æ˜¯è®©åˆé€‚çš„å·¥å…·åšåˆé€‚çš„äº‹ã€‚Rediså°±æ˜¯è¿™ä¸ªåœºæ™¯ä¸‹çš„â€œæ—¶é—´ç®¡ç†å¤§å¸ˆâ€ï¼</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/04e2ea61814e417594933b11fce70870~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oKf56m656CB5a2X:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769829083&amp;x-signature=vH21V3wt2UbwxjZejrCP%2FHPN1L4%3D" alt="åˆ«å†ç”¨å®šæ—¶ä»»åŠ¡æ‰«åº“äº†ï¼SpringBooté›†æˆRediså®ç°è®¢å•è¶…æ—¶ç®¡ç†.png" loading="lazy"/></p>
<p><strong>è°¢è°¢ä½ çœ‹æˆ‘çš„æ–‡ç« ï¼Œæ—¢ç„¶çœ‹åˆ°è¿™é‡Œäº†ï¼Œå¦‚æœè§‰å¾—ä¸é”™ï¼Œéšæ‰‹ç‚¹ä¸ªèµã€è½¬å‘ã€åœ¨çœ‹ä¸‰è¿å§ï¼Œæ„Ÿè°¢æ„Ÿè°¢ã€‚é‚£æˆ‘ä»¬ï¼Œä¸‹æ¬¡å†è§ã€‚</strong></p>
<p>æ‚¨çš„ä¸€é”®ä¸‰è¿ï¼Œæ˜¯æˆ‘æ›´æ–°çš„æœ€å¤§åŠ¨åŠ›ï¼Œè°¢è°¢</p>
<p>å±±æ°´æœ‰ç›¸é€¢ï¼Œæ¥æ—¥çš†å¯æœŸï¼Œè°¢è°¢é˜…è¯»ï¼Œæˆ‘ä»¬å†ä¼š</p>
<p>æˆ‘æ‰‹ä¸­çš„é‡‘ç®æ£’ï¼Œä¸Šèƒ½é€šå¤©ï¼Œä¸‹èƒ½æ¢æµ·</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é‡æ„å³æ—¶IMç³»ç»Ÿ8ï¼šStateServerï¼ˆä¸Šï¼‰]]></title>    <link>https://juejin.cn/post/7598445152158302259</link>    <guid>https://juejin.cn/post/7598445152158302259</guid>    <pubDate>2026-01-24T03:13:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598445152158302259" data-draft-id="7598389448147615754" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é‡æ„å³æ—¶IMç³»ç»Ÿ8ï¼šStateServerï¼ˆä¸Šï¼‰"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-24T03:13:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="QZQ54188"/> <meta itemprop="url" content="https://juejin.cn/user/666776045362473"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é‡æ„å³æ—¶IMç³»ç»Ÿ8ï¼šStateServerï¼ˆä¸Šï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/666776045362473/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    QZQ54188
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T03:13:59.000Z" title="Sat Jan 24 2026 03:13:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ç½‘å…³å±‚æˆ‘ä»¬é€šè¿‡Epollå®ç°äº†å¯¹äºç”¨æˆ·é•¿è¿æ¥FDçš„ç›‘å¬ï¼Œå¤§å¤§å‡å°‘äº†åç¨‹æ•°çš„æ¶ˆè€—ï¼Œè¿˜é€šè¿‡gateWayå°†æ¶ˆæ¯è½¬å‘ç»™StateServerè¿›è¡Œå¤„ç†ï¼Œè¿™æ ·ç½‘å…³å±‚å°±åªè´Ÿè´£ç»´æŠ¤é•¿è¿æ¥FDå’Œç”¨æˆ·IDä¸é•¿è¿æ¥FDçš„æ˜ å°„å…³ç³»ï¼Œè¿™éƒ¨åˆ†ä¸šåŠ¡é€»è¾‘ååˆ†ç¨³å®šï¼Œå‡ ä¹ä¸éœ€è¦å˜æ›´ï¼Œæ‰€ä»¥ç½‘å…³å±‚ä¸ä¼šå› ä¸ºä¸šåŠ¡çš„å˜æ›´è€Œé¢‘ç¹é‡å¯ï¼Œå¯¼è‡´ç½‘å…³ä¸Šçš„æ‰€æœ‰é•¿è¿æ¥è¢«æ–­å¼€ã€‚</p>
<h2 data-id="heading-0">StateServerèŒè´£</h2>
<p>æˆ‘ä»¬å°†ä¸šåŠ¡éƒ¨åˆ†è½¬ç§»åˆ°äº†StateServerè¿™ä¸ªæœåŠ¡ä¸­ï¼Œç½‘å…³è´Ÿè´£ç›‘å¬ç”¨æˆ·FDï¼Œå½“ç¼“å†²åŒºä¸­æœ‰æ•°æ®æ—¶å°±ä¼šå”¤é†’Epollç„¶åæŠŠç¼“å†²åŒºä¸­çš„æ•°æ®æŒ‰ç…§websocketçš„æ ¼å¼è§£æHeaderå’ŒPayloadï¼Œç„¶åç›´æ¥å°†Payloadé€šè¿‡grpcè½¬å‘ç»™StateServerè¿›è¡Œå¤„ç†ï¼Œè¿™æ ·gateWayåªè´Ÿè´£é€ä¼ ï¼ŒStateServerè´Ÿè´£é€»è¾‘å¤„ç†çš„æ¶æ„ã€‚æˆ‘ä»¬éœ€è¦å®šä¹‰äºŒè€…ä¹‹é—´çš„é€šä¿¡åè®®ï¼Œä¹Ÿå°±æ˜¯Protobufå®šä¹‰ã€‚</p>
<p>StateServeréœ€è¦å®ç°ä¸€ä¸ªåè®®è§£ææ¨¡å—ï¼Œè¿™ä¸ªæ¨¡å—å¯ä»¥è§£ægateWayå‘é€è¿‡æ¥çš„æ¶ˆæ¯æ˜¯ä»€ä¹ˆç±»å‹ï¼Œç„¶åæ ¹æ®è¿™ä¸ªç±»å‹è¿›è¡Œå¤„ç†é€»è¾‘çš„è·¯ç”±ï¼Œè¿™æ ·çš„è¯äºŒè€…çš„æ¶ˆæ¯ç»“æ„å°±æ¸…æ™°äº†ã€‚gateWayè§£æwsçš„Headerï¼Œæ ¹æ®Headerçš„é•¿åº¦å­—æ®µä»ç¼“å†²åŒºä¸­è¯»å–Payloadï¼Œç„¶åé€šè¿‡grpcå°†è¿™ä¸ªPayloadè½¬å‘ç»™StateServerï¼Œè¿™ä¸ªPayloadæœ¬èº«å°±æ˜¯ç”±msgTypeå’Œmsgç»„æˆçš„ï¼Œè¿™éƒ¨åˆ†ç”±StateServerçš„åè®®è§£ææ¨¡å—è¿›è¡Œç»´æŠ¤ï¼Œæœ€åè·¯ç”±åˆ°ä¸šåŠ¡å±‚è¿›è¡Œå¤„ç†ã€‚</p>
<p>ç”±æ­¤å¯è§ï¼ŒStateServerçš„èŒè´£ä¸»è¦æ˜¯åè®®è§£æä¸åˆ†å‘ï¼Œä¹‹å‰è¿˜è¯´è¿‡StateServerè¿˜éœ€è¦ç»´æŠ¤å“ªä¸ªç”¨æˆ·åœ¨å“ªå°ç½‘å…³æœºå™¨ä¸Šï¼Œè¿™æ ·æ‰å¯ä»¥è¿›è¡Œä¸šåŠ¡æ¶ˆæ¯çš„è½¬å‘ï¼Œæ‰€ä»¥StateServerè¿˜ç»´æŠ¤ç”¨æˆ·åœ¨çº¿çŠ¶æ€ï¼ˆUser A -&gt; Gateway 1ï¼‰ã€‚</p>
<p>æ­¤å¤–ï¼ŒStateServerè¿˜æœ‰ä¸€ä¸ªè‡³å…³é‡è¦çš„èŒè´£å°±æ˜¯ç»´æŠ¤å¿ƒè·³ï¼Œåœ¨é•¿è¿æ¥æ¶æ„ä¸­å¿ƒè·³æ˜¯å¿…ä¸å¯å°‘çš„ã€‚ç”¨æˆ·åœ¨ä½¿ç”¨APPæ—¶ä¼šç»å¸¸é‡åˆ°æ–­ç½‘ï¼ˆæ‰‹åŠ¨å…³é—­ï¼Œè¿›å…¥ç”µæ¢¯ï¼Œéš§é“ï¼‰çš„æƒ…å†µï¼Œåœ¨è¿™äº›åœºæ™¯ä¸­ï¼Œå®¢æˆ·ç«¯æ ¹æœ¬æ²¡æœ‰åŠæ³•å‘é€TCPçš„FINåŒ…ç»™æœåŠ¡ç«¯ï¼Œæ ¹æ® TCP åè®®ç‰¹æ€§ï¼Œå¦‚æœæ²¡æœ‰æ•°æ®ä¼ è¾“ï¼ŒæœåŠ¡ç«¯ä¼šä¸€ç›´è®¤ä¸ºè¿™ä¸ªè¿æ¥æ˜¯å¥åº·çš„ã€‚è¿™å°±å¯¼è‡´æœåŠ¡å™¨ä¸Šä¼šå †ç§¯æˆåƒä¸Šä¸‡ä¸ªæ— æ•ˆçš„â€œåƒµå°¸è¿æ¥â€ï¼Œç™½ç™½å ç”¨ç€å†…å­˜å’Œæ–‡ä»¶æè¿°ç¬¦ã€‚StateServeré€šè¿‡å¿ƒè·³æ¥å®æ–½å¥åº·æ£€æµ‹ï¼Œå¦‚æœåœ¨ä¸€å®šäº‹ä»¶å†…æ²¡æœ‰æ”¶åˆ°ç”¨æˆ·çš„å¿ƒè·³ï¼ŒStateServrå°±å¯ä»¥æ–­å®šè¯¥ç”¨æˆ·ä»¥åŠæ‰çº¿ï¼Œä»è€Œä¸»åŠ¨æ–­å¼€è¿æ¥ï¼Œæ¸…ç†ç”¨æˆ·ç›¸å…³éƒ¨åˆ†ã€‚å¦‚æœä¸å³æ—¶æ¸…ç†çš„è¯ï¼Œå¦‚æœæœ‰ç”¨æˆ·ç»™ç¦»çº¿ç”¨æˆ·å‘é€æ¶ˆæ¯ï¼ŒStateServerä»¥ä¸ºç¦»çº¿ç”¨æˆ·è¿˜åœ¨çº¿ï¼Œå°±ä¼šç»™å¯¹åº”ç”¨æˆ·å‘é€æ¶ˆæ¯ï¼Œç„¶åè¶…æ—¶ï¼Œå†æ¬¡å‘é€æµªè´¹ç½‘ç»œå¸¦å®½ã€‚</p>
<h2 data-id="heading-1">åè®®éƒ¨åˆ†</h2>
<p>ä¹‹å‰æˆ‘ä»¬å®šä¹‰äº†<code>state.proto</code>æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶ä¸»è¦æè¿°äº†gateWayå’ŒStateServerä¹‹é—´çš„äº¤äº’åè®®ï¼Œä¸»è¦å­—æ®µæœ‰UserIDï¼Œè¯†åˆ«æ˜¯å“ªä¸ªç”¨æˆ·å‘é€çš„ï¼Œpayloadå°±æ˜¯æˆ‘ä»¬è¯´çš„è´Ÿè½½ï¼Œè¿™ä¸ªæ˜¯é€šè¿‡è§£æwebsocketçš„è´Ÿè½½æ¥çš„ï¼Œè¿˜æœ‰gateway_idç”¨äºå‘ŠçŸ¥StateServerè¿™ä¸ªç”¨æˆ·åœ¨å“ªå°ç½‘å…³æœºå™¨ä¸Šï¼Œä¾¿äºå›è°ƒã€‚</p>
<p>ç„¶è€Œ<code>state.proto</code>å®šä¹‰çš„åªæ˜¯gateWayå’ŒStateServerä¹‹é—´çš„é€šä¿¡æµç¨‹ï¼Œå…¶ä¸­å…³é”®çš„payloadå­—æ®µç›®å‰è¿˜æ˜¯ä¸€ä¸²æœªçŸ¥çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œä¸ºäº†è®©StateServerèƒ½è¯»æ‡‚è¿™ä¸²æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ç¬¬äºŒå±‚åè®®ï¼Œä¹Ÿå°±æ˜¯ç«¯åˆ°ç«¯çš„ä¸šåŠ¡æ¶ˆæ¯åè®®<code>protocal.proto</code>ã€‚</p>
<p>è®¾è®¡è¿™ä¸ªæ¶ˆæ¯åè®®çš„æ—¶å€™æˆ‘é‡‡ç”¨äº†ä¸¤å±‚åµŒå¥—çš„æ–¹å¼ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-protobuf" lang="protobuf">// CommandType å®šä¹‰æ¶ˆæ¯ç±»å‹
enum CommandType {
    UNKNOWN = 0;
    LOGIN = 1;      // ç™»å½•
    HEARTBEAT = 2;  // å¿ƒè·³
    MESSAGE = 3;    // èŠå¤©æ¶ˆæ¯ (ä¿¡ä»¤)
}

// Command æ˜¯æœ€å¤–å±‚çš„å°åŒ…ç»“æ„ (Envelope)
message Command {
    CommandType type = 1; // æ¶ˆæ¯ç±»å‹
    bytes data = 2;       // å…·ä½“çš„ä¸šåŠ¡æ¶ˆæ¯ Payload (åºåˆ—åŒ–åçš„äºŒè¿›åˆ¶)
}

// LoginCommand ç™»å½•æ¶ˆæ¯
message LoginCommand {
    string token = 1;    // é‰´æƒ Token
    bytes extra = 2;     // æ‰©å±•å­—æ®µ
}

// HeartbeatCommand å¿ƒè·³æ¶ˆæ¯
message HeartbeatCommand {
    int64 timestamp = 1; // å®¢æˆ·ç«¯æ—¶é—´æˆ³
}

// MessageCommand èŠå¤©æ¶ˆæ¯ (ä¿¡ä»¤)
message MessageCommand {
    string uuid = 1;        // æ¶ˆæ¯å”¯ä¸€ID
    int32 type = 2;         // æ¶ˆæ¯ç±»å‹ (æ–‡æœ¬/å›¾ç‰‡ç­‰)
    string content = 3;     // æ¶ˆæ¯å†…å®¹
    string receiver_id = 4; // æ¥æ”¶è€…ID (ç¾¤èŠåˆ™æ˜¯ç¾¤ID)
    int32 conversation_type = 5; // ä¼šè¯ç±»å‹ (1=å•èŠ, 2=ç¾¤èŠ)
    bytes extra = 6;        // æ‰©å±•å­—æ®µ
}
</code></pre>
<p>å¤–å±‚åŒ…è£…æ˜¯<code>Command</code>ï¼Œè¿™æ˜¯æ‰€æœ‰ä¸šåŠ¡æ¶ˆæ¯çš„ç»Ÿä¸€å…¥å£ï¼Œå…¶ä¸­typeå­—æ®µè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªä»€ä¹ˆæ¶ˆæ¯ï¼Œdataå­—æ®µå°±æ˜¯å…·ä½“çš„ä¸šåŠ¡æ•°æ®ï¼Œæ ¹æ®typeçš„ä¸åŒååºåˆ—åŒ–ä¸ºä¸åŒçš„å†…å±‚ç»“æ„ä½“ï¼Œè¿™ç§è®¾è®¡è®©StateServerå¯ä»¥å…ˆè§£æå¤–å±‚ï¼Œæ‹¿åˆ°æ¶ˆæ¯ç±»å‹ï¼Œå†é€šè¿‡è·¯ç”±åˆ†å‘å»è§£æå†…å±‚ï¼Œå®ç°äº†æä½³çš„æ‰©å±•æ€§ã€‚</p>
<p>å†…å±‚æ¶ˆæ¯å°±æ˜¯åé¢ä¸‰ä¸ªå…·ä½“çš„ç»“æ„ä½“ï¼Œè¿™é‡Œæˆ‘å…ˆå®ç°è¿™ä¸‰ä¸ªï¼Œæœ‰éœ€è¦çš„è¯å†åœ¨åé¢è¡¥å……ã€‚å†…å±‚æ¶ˆæ¯å°±æ˜¯å®¢æˆ·ç«¯å®é™…å‘é€çš„æ¶ˆæ¯ï¼Œä¸è¿‡åœ¨å‘é€æ—¶è¢«æ‰“åŒ…æˆäº†<code>Command</code>ï¼Œåºåˆ—åŒ–ä¹‹åé€šè¿‡WebSocketå‘é€ç»™GateWayï¼ŒGateWayå°†å…¶ä½œä¸ºPayloadå°è£…è¿›ä¹‹å‰è¯´è¿‡çš„<code>state.proto</code>ä¸­çš„è¯·æ±‚ä½“ä¸­ï¼Œé€ä¼ ç»™StateServerï¼›æœ€ç»ˆç”±StateServerå±‚å±‚æ‹†åŒ…ï¼Œè¿˜åŸå‡ºåŸå§‹çš„ä¸šåŠ¡æ„å›¾ã€‚</p>
<h2 data-id="heading-2">StateServeræ”¹é€ </h2>
<p>ä¹‹å‰æˆ‘ä»¬çš„StateServerå®ç°éå¸¸æš´åŠ›ï¼Œå°±æ˜¯ç›´æ¥æ‹¿gateWayç»™ä½ çš„payloadå»æ„é€ <code>responsePayload := []byte(fmt.Sprintf("StateServer Echo: %s", string(req.Payload)))</code>ç„¶åæŠŠè¿™ä¸ªè¿”å›ç»™gateWayï¼Œä½†æ˜¯ç°åœ¨å°±ä¸æ˜¯ç®€å•çš„å›æ˜¾é€»è¾‘äº†ï¼Œéœ€è¦ç†è§£payloadå¹¶ä¸”å°†å…¶åˆ†å‘ç»™æ­£ç¡®çš„æ‰§è¡Œå•å…ƒã€‚</p>
<p>åœ¨gateWayå‘æ¥çš„è¯·æ±‚ä¸­ï¼Œpayloadæ˜¯ä¸€ä¸²æœªçŸ¥çš„äºŒè¿›åˆ¶ï¼ŒStateServeré¦–å…ˆä¼šæ ¹æ®<code>protocol.Command</code>è¿›è¡Œååºåˆ—åŒ–ï¼Œå› ä¸ºå®¢æˆ·ç«¯å‘é€æ—¶å°†è¯·æ±‚åŒ…è£…ä¸ºäº†<code>Command</code>ï¼Œè¿™ä¸€æ­¥å¯ä»¥æ‹¿åˆ°æ¶ˆæ¯ç±»å‹å’Œæ¶ˆæ¯ä½“ã€‚å¦‚æœåºåˆ—åŒ–å¤±è´¥çš„è¯è¯´æ˜æ•°æ®åŒ…æ ¼å¼é”™è¯¯ï¼Œè¿™é‡Œç›´æ¥ä¸¢å¼ƒã€‚å¦‚æœæˆåŠŸçš„è¯æˆ‘ä»¬å°±å¯ä»¥æ‹¿åˆ°æ¶ˆæ¯çš„<code>Type</code>ï¼Œæ­¤æ—¶å¯ä»¥æ‰§è¡Œ<code>switch</code>é€»è¾‘å»è·¯ç”±åˆ°å¯¹åº”çš„å¤„ç†å‡½æ•°ä¸­ï¼Œå¦‚æœæœªæ¥è¦å¢åŠ ä¸šåŠ¡çš„è¯ä¹Ÿæ˜¯åœ¨è¿™é‡Œä¿®æ”¹ã€‚</p>
<p>è¿›å…¥å…·ä½“çš„å¤„ç†å‡½æ•°ä¹‹åï¼Œä¾‹å¦‚<code>handleLogin</code>ï¼Œæˆ‘ä»¬å·²ç»æ˜ç¡®çŸ¥é“<code>Command.Data</code>é‡Œè£…çš„ä¸€å®šæ˜¯ <code>LoginCommand</code> çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œæ­¤æ—¶è¿›è¡Œç¬¬äºŒæ¬¡ååºåˆ—åŒ–ï¼Œè¿˜åŸå‡ºå…·ä½“çš„ä¸šåŠ¡å¯¹è±¡ï¼Œç„¶åæ‰§è¡ŒçœŸæ­£çš„ä¸šåŠ¡é€»è¾‘ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *Service)</span></span> ReceiveMessage(ctx context.Context, req *pb.ReceiveMessageRequest) (*pb.ReceiveMessageResponse, <span class="hljs-type">error</span>) {
    <span class="hljs-comment">// ååºåˆ—åŒ–å¤–å±‚ Command</span>
    <span class="hljs-keyword">var</span> cmd protocol.Command
    <span class="hljs-keyword">if</span> err := proto.Unmarshal(req.Payload, &amp;cmd); err != <span class="hljs-literal">nil</span> {
        log.Printf(<span class="hljs-string">"[StateServer] Unmarshal Command error: %v"</span>, err)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }

    log.Printf(<span class="hljs-string">"[StateServer] Received Command: Type=%v, Gateway=%s, User=%s"</span>, cmd.Type, req.GatewayId, req.Uid)

    <span class="hljs-comment">// è·¯ç”±åˆ†å‘</span>
    <span class="hljs-keyword">switch</span> cmd.Type {
        <span class="hljs-keyword">case</span> protocol.CommandType_LOGIN:
        <span class="hljs-keyword">return</span> s.handleLogin(ctx, &amp;cmd, req)
        <span class="hljs-keyword">case</span> protocol.CommandType_HEARTBEAT:
        <span class="hljs-keyword">return</span> s.handleHeartbeat(ctx, &amp;cmd, req)
        <span class="hljs-keyword">case</span> protocol.CommandType_MESSAGE:
        <span class="hljs-keyword">return</span> s.handleMessage(ctx, &amp;cmd, req)
        <span class="hljs-keyword">default</span>:
        log.Printf(<span class="hljs-string">"[StateServer] Unknown command type: %v"</span>, cmd.Type)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">"unknown command type"</span>)
    }
}
</code></pre>
<p>è‡³äº<code>handleLogin</code>è¿™ç§å¤„ç†å‡½æ•°æˆ‘ä»¬åé¢è¯´åˆ°ä¸šåŠ¡é€»è¾‘çš„æ—¶å€™å†è®²ã€‚</p>
<h2 data-id="heading-3">å®¢æˆ·ç«¯é€‚é…</h2>
<p>ä¹‹å‰çš„æµ‹è¯•å®¢æˆ·ç«¯å‘é€çš„æ˜¯çº¯æ–‡æœ¬å­—ç¬¦ä¸²ï¼Œç°åœ¨å¿…é¡»å‘é€protoåè®®åºåˆ—åŒ–ä¹‹åçš„äºŒè¿›åˆ¶æµï¼Œé¦–å…ˆæ ¹æ®ç”¨æˆ·éœ€æ±‚åˆ›å»ºä¸€ä¸ªå…·ä½“çš„ä¸šåŠ¡å¯¹è±¡ï¼Œç„¶åå°†å…¶åºåˆ—åŒ–ï¼Œè¿™æ˜¯å†…å±‚ä¸šåŠ¡å¯¹è±¡çš„åˆå§‹åŒ–ã€‚ç„¶åå†åˆ›å»ºä¸€ä¸ª<code>Command</code>å¯¹è±¡ï¼Œå°†åˆšæ‰çš„äºŒè¿›åˆ¶æµå¡«å…¥Dataå­—æ®µï¼Œç„¶åæ ¹æ®ä¸šåŠ¡ç±»å‹è®¾ç½®Typeï¼Œå°†è¿™ä¸ª Command å¯¹è±¡å†æ¬¡åºåˆ—åŒ–ï¼Œé€šè¿‡ WebSocket çš„ BinaryMessage æ¨¡å¼å‘é€å‡ºå»ï¼Œä¸‹é¢æ˜¯å®¢æˆ·ç«¯å…³é”®ä»£ç ï¼š</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sendLogin</span><span class="hljs-params">(c *websocket.Conn)</span></span> {
    loginPayload := &amp;protocol.LoginCommand{
        Token: <span class="hljs-string">"test-token-123"</span>,
    }
    data, _ := proto.Marshal(loginPayload)

    cmd := &amp;protocol.Command{
        Type: protocol.CommandType_LOGIN,
        Data: data,
    }

    sendProto(c, cmd)
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sendHeartbeat</span><span class="hljs-params">(c *websocket.Conn)</span></span> {
    hbPayload := &amp;protocol.HeartbeatCommand{
        Timestamp: time.Now().Unix(),
    }
    data, _ := proto.Marshal(hbPayload)

    cmd := &amp;protocol.Command{
        Type: protocol.CommandType_HEARTBEAT,
        Data: data,
    }
    sendProto(c, cmd)
}
<span class="hljs-comment">// ......</span>


<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sendProto</span><span class="hljs-params">(c *websocket.Conn, cmd *protocol.Command)</span></span> {
    bytes, err := proto.Marshal(cmd)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        log.Println(<span class="hljs-string">"marshal error:"</span>, err)
        <span class="hljs-keyword">return</span>
    }

    err = c.WriteMessage(websocket.BinaryMessage, bytes)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        log.Println(<span class="hljs-string">"write error:"</span>, err)
    } <span class="hljs-keyword">else</span> {
        log.Printf(<span class="hljs-string">"sent command: type=%v"</span>, cmd.Type)
    }
}

</code></pre>
<h2 data-id="heading-4">ç™»å½•å®ç°</h2>
<p>å®¢æˆ·ç«¯ç»™gateWayå‘é€æºå¸¦tokençš„Loginæ•°æ®åŒ…ï¼Œç½‘å…³ç›´æ¥æŠŠpayloadé€šè¿‡grpcè½¬å‘ç»™StateServerï¼ŒStateServerå‘ç°æ˜¯<code>Login</code>ç±»å‹ï¼Œå°±ä¼šè·¯ç”±åˆ°<code>handleLogin</code>æ–¹æ³•ã€‚åœ¨æ–¹æ³•å†…é€šè¿‡protoè§£æå‡ºå¯¹åº”ä¸šåŠ¡ç›¸å…³ç»“æ„ä½“ï¼Œé€šè¿‡AuthæœåŠ¡æˆ–è€…æŸ¥åº“éªŒè¯tokençš„åˆæ³•æ€§ï¼ŒéªŒè¯æˆåŠŸä¹‹åå°±æ‹¿åˆ°UserIDï¼Œç„¶åæŠŠè¿™ä¸ªUserIDé€šè¿‡grpcè¿”å›ç»™gateWayï¼Œè¿™ç›¸å½“äºStateServerå¯¹GateWayä¸‹è¾¾æŒ‡ä»¤ï¼ŒæŠŠåˆšæ‰å‘é€æ¶ˆæ¯çš„é‚£ä¸ªè¿æ¥ç»‘å®šå¯¹åº”çš„UserIDï¼Œä¾¿äºè·¯ç”±ã€‚</p>
<p>ä¸Šé¢è¯´çš„è¿”å›ç”¨æˆ·IDç»™gateWayæ˜¯ä¸ºäº†è®©gateWayçŸ¥é“è¿™ä¸ªFDå¯¹åº”çš„æ˜¯å“ªä¸ªç”¨æˆ·ï¼Œä¸ºäº†å®ç°è½¬å‘é€»è¾‘ï¼Œæˆ‘ä»¬è¿˜éœ€è¦çŸ¥é“è¿™ä¸ªç”¨æˆ·è¿æ¥çš„æ˜¯å“ªå°ç½‘å…³æœºå™¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨StateServerçš„å¤„ç†å‡½æ•°ä¸­å°†ç”¨æˆ·IDå’Œç½‘å…³æœºå™¨IDä½œä¸ºKVæ³¨å†Œåˆ°redisä¸­ã€‚</p>
<p>ä¸‹é¢æ˜¯ç›¸å…³å˜æ›´ä»£ç ï¼š</p>
<pre><code class="hljs language-protobuf" lang="protobuf">// state.proto
message ReceiveMessageResponse {
    bytes response_payload = 1;
    // æ–°å¢ä¸¤ä¸ªå­—æ®µ
    string bound_user_id = 2;
    bool disconnect = 3;
}
</code></pre>
<p>å…¶ä¸­<code>bound_user_id</code>è¡¨ç¤ºè¿™ä¸ªè¿æ¥ç°åœ¨ç»‘å®šå“ªä¸€ä¸ªç”¨æˆ·IDï¼Œ<code>disconnect</code>å­—æ®µæ˜¯StateServeré€šçŸ¥gateWayæ–­å¼€è¿æ¥çš„ï¼Œæ¯”å¦‚å‘ç°tokenæ— æ•ˆï¼Œé»‘åå•ç”¨æˆ·ï¼Œå¼‚åœ°ç™»å½•äº’è¸¢è¿™ç§ã€‚gateWayæ”¶åˆ°å“åº”åï¼Œå‘ç°<code>disconnect</code>ä¸ºçœŸçš„è¯å°±ä¼šå…³é—­è¿æ¥ï¼Œä¸å†æ¨é€è¿”å›çš„æ¶ˆæ¯ä½“ã€‚ï¼ˆæˆ–è€…ä½ å¯ä»¥é€‰æ‹©å…ˆæŠŠpayloadæ¨é€å®Œå†å…³ï¼Œç›®å‰çš„é€»è¾‘æ˜¯ç›´æ¥å…³ï¼‰ã€‚</p>
<p>StateServerçš„æ³¨å†Œå¤„ç†å‡½æ•°ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *Service)</span></span> handleLogin(ctx context.Context, cmd *protocol.Command, req *pb.ReceiveMessageRequest) (*pb.ReceiveMessageResponse, <span class="hljs-type">error</span>) {
    <span class="hljs-keyword">var</span> loginCmd protocol.LoginCommand
    <span class="hljs-keyword">if</span> err := proto.Unmarshal(cmd.Data, &amp;loginCmd); err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }

    log.Printf(<span class="hljs-string">"[StateServer] Handle Login: Token=%s"</span>, loginCmd.Token)
    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> è°ƒç”¨ Auth æœåŠ¡éªŒè¯ Tokenï¼Œç»‘å®š UserID</span>
    <span class="hljs-comment">// è¿™é‡Œç®€å•æ¨¡æ‹ŸæˆåŠŸ</span>
    userID := <span class="hljs-string">"u_"</span> + loginCmd.Token <span class="hljs-comment">// Simple mock</span>

    key := fmt.Sprintf(<span class="hljs-string">"UserID:%s"</span>, userID)
    <span class="hljs-keyword">if</span> err := s.rdb.Set(ctx, key, req.GatewayId, <span class="hljs-number">5</span>*time.Minute).Err(); err != <span class="hljs-literal">nil</span> {
        log.Printf(<span class="hljs-string">"[StateServer] Failed to save session: %v"</span>, err)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }

    <span class="hljs-keyword">return</span> &amp;pb.ReceiveMessageResponse{
        ResponsePayload: []<span class="hljs-type">byte</span>(<span class="hljs-string">"Login Success"</span>),
        BoundUserId:     userID,
        Disconnect:      <span class="hljs-literal">false</span>,
    }, <span class="hljs-literal">nil</span>
}
</code></pre>
<p>ç½‘å…³å±‚æ–°å¢ä»£ç ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// Check if StateServer authorized a user</span>
<span class="hljs-keyword">if</span> resp.BoundUserId != <span class="hljs-string">""</span> {
    log.Printf(<span class="hljs-string">"Client %d bound to user %s"</span>, c.FD, resp.BoundUserId)
    c.Uid = resp.BoundUserId
    s.BindUser(resp.BoundUserId, c)
}

<span class="hljs-comment">// Check if StateServer requested disconnect</span>
<span class="hljs-keyword">if</span> resp.Disconnect {
    log.Printf(<span class="hljs-string">"Client %d disconnected by StateServer"</span>, c.FD)
    s.closeClient(c, ep)
    <span class="hljs-keyword">return</span>
}
</code></pre>
<h2 data-id="heading-5">å¿ƒè·³å®ç°</h2>
<p>å®¢æˆ·ç«¯ç»™GateWayå‘é€æºå¸¦å¿ƒè·³æ•°æ®çš„Heartbeatæ•°æ®åŒ…ï¼Œç½‘å…³ç›´æ¥æŠŠ payload é€šè¿‡ grpc è½¬å‘ç»™ StateServerï¼ˆåŒæ—¶ç½‘å…³ä¼šåˆ·æ–°æœ¬åœ°è¿æ¥çš„è¶…æ—¶æ—¶é—´ä»¥é˜²è¯¯è¸¢ï¼‰ã€‚StateServerè·¯ç”±åˆ°å¯¹åº”å¤„ç†å‡½æ•°ï¼Œåœ¨å‡½æ•°å†…ï¼ŒStateServer ä¼šæ ¹æ®è¯·æ±‚ä¸­æºå¸¦çš„ UserIDï¼Œåˆ·æ–° Redis ä¸­è¯¥ç”¨æˆ· ID ä¸ç½‘å…³æœºå™¨ ID æ˜ å°„å…³ç³»çš„è¿‡æœŸæ—¶é—´ï¼ˆTTLï¼‰ï¼Œå®ç° Session çš„ä¿æ´»ã€‚æœ€åï¼ŒStateServerç»™gateWayè¿”å›ackï¼ŒgateWayå†å°†å…¶é€šè¿‡webSocketæ¨é€ç»™å®¢æˆ·ç«¯ï¼Œè®©å®¢æˆ·ç«¯ç¡®è®¤è¿æ¥ä¾ç„¶å­˜æ´»ã€‚</p>
<p>ä¸ºäº†å®ç°ackï¼Œæˆ‘ä»¬åœ¨<code>Command</code>ç»“æ„ä½“ä¸­æ–°å¢äº†<code>code</code>å’Œ<code>msg</code>å­—æ®µï¼Œcodeå¦‚æœä¸º0å°±è¡¨ç¤ºå“åº”æˆåŠŸï¼Œè€Œä¸”codeçš„é”™è¯¯ç å¯ä»¥ç•™åœ¨ä»¥ååšæ‹“å±•ï¼Œmsgå­—æ®µè¡¨ç¤ºæç¤ºæ¶ˆæ¯ï¼Œå¯èƒ½æ˜¯é”™è¯¯æ¶ˆæ¯ï¼Œå¯èƒ½æ˜¯æ‰§è¡ŒæˆåŠŸçš„è¯´æ˜ã€‚</p>
<p>å¿ƒè·³å®šæ—¶å™¨æ˜¯ç”±å®¢æˆ·ç«¯ç»´æŠ¤çš„ï¼Œå› ä¸ºç”±gateWayæˆ–è€…StateServerä¸ºæ¯ä¸ªå®¢æˆ·ç«¯ç»´æŠ¤ä¸€ä¸ªå®šæ—¶å™¨å¼€é”€å¤ªå¤§ï¼Œæ‰€ä»¥é€‰æ‹©è®©å®¢æˆ·ç«¯ç»´æŠ¤è‡ªå·±çš„å¿ƒè·³å®šæ—¶å™¨ï¼Œå‘é€è¯·æ±‚ç­‰å¾…å“åº”ã€‚</p>
<p>ä¸‹é¢çœ‹gateWayä¸­æ›´æ–°çš„ä»£ç ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *Server)</span></span> keepAliveLoop(ctx context.Context) {
    <span class="hljs-comment">// Check every 10 seconds</span>
    ticker := time.NewTicker(<span class="hljs-number">10</span> * time.Second)
    <span class="hljs-keyword">defer</span> ticker.Stop()

    <span class="hljs-keyword">for</span> {
        <span class="hljs-keyword">select</span> {
            <span class="hljs-keyword">case</span> &lt;-ctx.Done():
            <span class="hljs-keyword">return</span>
            <span class="hljs-keyword">case</span> &lt;-ticker.C:
            now := time.Now().Unix()

            <span class="hljs-keyword">for</span> _, ep := <span class="hljs-keyword">range</span> s.Epolls {
                <span class="hljs-keyword">var</span> timeoutClients []*Client

                ep.lock.RLock()
                <span class="hljs-keyword">for</span> _, c := <span class="hljs-keyword">range</span> ep.connections {
                    <span class="hljs-keyword">if</span> now-c.lastHeartbeat &gt; <span class="hljs-number">300</span> { <span class="hljs-comment">// 300s timeout</span>
                        timeoutClients = <span class="hljs-built_in">append</span>(timeoutClients, c)
                    }
                }
                ep.lock.RUnlock()

                <span class="hljs-comment">// Close timeout clients</span>
                <span class="hljs-keyword">for</span> _, c := <span class="hljs-keyword">range</span> timeoutClients {
                    log.Printf(<span class="hljs-string">"Client %d timed out (last active: %ds ago)"</span>, c.FD, now-c.lastHeartbeat)
                    s.closeClient(c, ep)
                }
            }
        }
    }
}
</code></pre>
<p>è¿™ä¸ªå‡½æ•°åœ¨gateWayè°ƒç”¨<code>Start</code>å¯åŠ¨çš„æ—¶å€™å°±å¼€å¯ä¸€ä¸ªåç¨‹æ‰§è¡Œ<code>keepAliveLoop</code>ï¼Œæ ¸å¿ƒèŒè´£æ˜¯å®šæœŸè¸¢æ‰é‚£äº›å ç”¨è¿æ¥è€Œä¸”æ²¡å“åº”çš„åƒµå°¸ç”¨æˆ·ã€‚ä¸»è¦å°±æ˜¯éå†æ‰€æœ‰æ³¨å†Œåˆ°epollä¸­çš„è¿æ¥ï¼Œè·å–è¿æ¥çš„å®¢æˆ·ç«¯ï¼Œæ£€æŸ¥ç°åœ¨æ—¶é—´è·ç¦»è¯¥å®¢æˆ·ç«¯ä¸Šæ¬¡æ”¶åˆ°å¿ƒè·³çš„æ—¶é—´æ˜¯å¦è¶…è¿‡5åˆ†é’Ÿï¼Œè¶…è¿‡çš„è¯å°±æŠŠè¿™ä¸ªè¿æ¥è®¡å…¥å¾…è¸¢å‡ºé˜Ÿåˆ—ï¼Œåé¢ç»Ÿä¸€closeã€‚</p>
<p>è¿™é‡Œä¹‹æ‰€ä»¥ä½¿ç”¨æ¯10sæ£€æŸ¥ä¸€æ¬¡æ˜¯å› ä¸ºè¿™ä¸ªå¯¹æ—¶é—´ç²¾åº¦çš„å®¹å¿åº¦é«˜ï¼Œå¿ƒè·³ä¸»è¦æ˜¯ä¸ºäº†é‡Šæ”¾é•¿æ—¶é—´æ— å“åº”çš„èµ„æºæ‰€ä»¥æ™šä¸€ä¸¤ç§’å…¶å®æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œå¦‚æœè¿½æ±‚ç²¾åº¦çš„è¯å¯ä»¥ä¸ºæ¯ä¸ªclientç»´æŠ¤ä¸€ä¸ªå®šæ—¶å™¨ï¼Œä½†æ˜¯è¿™æ ·å¼€é”€å¤ªå¤§äº†ï¼Œä¼˜åŒ–çš„è¯å¯ä»¥é‡‡ç”¨æ—¶é—´è½®ç®—æ³•ï¼Œåœ¨ç²¾åº¦å’Œæ€§èƒ½è§’åº¦åšå–èˆã€‚</p>
<p>ç”±gateWayé€ä¼ ç»™StateServerä¹‹åï¼ŒStateServerè¯†åˆ«åˆ°è¿™æ˜¯ä¸€ä¸ªå¿ƒè·³ï¼Œè·¯ç”±åˆ°å¿ƒè·³å¤„ç†å‡½æ•°ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *Service)</span></span> handleHeartbeat(ctx context.Context, cmd *protocol.Command, req *pb.ReceiveMessageRequest) (*pb.ReceiveMessageResponse, <span class="hljs-type">error</span>) {
    <span class="hljs-keyword">if</span> req.Uid != <span class="hljs-string">""</span> {
        key := fmt.Sprintf(<span class="hljs-string">"session:%s"</span>, req.Uid)
        <span class="hljs-keyword">if</span> err := s.rdb.Expire(ctx, key, <span class="hljs-number">10</span>*time.Minute).Err(); err != <span class="hljs-literal">nil</span> {
            log.Printf(<span class="hljs-string">"[StateServer] RenewSession failed: %v"</span>, err)
        }
    }

    <span class="hljs-comment">// æ„é€ å“åº”</span>
    respCmd := &amp;protocol.Command{
        Type: protocol.CommandType_HEARTBEAT,
        Code: <span class="hljs-number">0</span>,
    }
    respBytes, _ := proto.Marshal(respCmd)

    <span class="hljs-keyword">return</span> &amp;pb.ReceiveMessageResponse{
        ResponsePayload: respBytes,
    }, <span class="hljs-literal">nil</span>
}
</code></pre>
<p>åˆ·æ–°ç”¨æˆ·å’Œç½‘å…³çš„mapå…³ç³»ï¼Œç„¶åæ„é€ å›å¤è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œä¹‹åå®¢æˆ·ç«¯éœ€è¦è§£æè¯·æ±‚æ‰çŸ¥é“è¿™æ˜¯ä¸€ä¸ªå¿ƒè·³çš„ackï¼Œç„¶åè¿›è¡Œç›¸åº”å¤„ç†ã€‚</p>
<h2 data-id="heading-6">æµ‹è¯•</h2>
<p>æµ‹è¯•ç»“æœå’Œä»£ç å¦‚ä¸‹ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/36e462ea91644828a34a8673e9f77eee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUVpRNTQxODg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769829239&amp;x-signature=vIEJAVT8ZuRjRBA0tIhBgZbdsbU%3D" alt="image-20260124110430503" loading="lazy"/></p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	u := url.URL{Scheme: <span class="hljs-string">"ws"</span>, Host: <span class="hljs-string">"localhost:8002"</span>, Path: <span class="hljs-string">"/"</span>}
	log.Printf(<span class="hljs-string">"Connecting to %s"</span>, u.String())

	<span class="hljs-comment">// å»ºç«‹ WebSocket è¿æ¥</span>
	c, _, err := websocket.DefaultDialer.Dial(u.String(), <span class="hljs-literal">nil</span>)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		log.Fatal(<span class="hljs-string">"dial:"</span>, err)
	}
	<span class="hljs-keyword">defer</span> c.Close()

	done := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>{})

	<span class="hljs-comment">// å¯åŠ¨æ¥æ”¶åç¨‹ (Receive Loop)</span>
	<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
		<span class="hljs-keyword">defer</span> <span class="hljs-built_in">close</span>(done)
		<span class="hljs-keyword">for</span> {
			_, message, err := c.ReadMessage()
			<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
				log.Println(<span class="hljs-string">"read:"</span>, err)
				<span class="hljs-keyword">return</span>
			}
			<span class="hljs-comment">// è§£æ Command</span>
			<span class="hljs-keyword">var</span> cmd protocol.Command
			<span class="hljs-keyword">if</span> err := proto.Unmarshal(message, &amp;cmd); err != <span class="hljs-literal">nil</span> {
				log.Printf(<span class="hljs-string">"unmarshal error: %v"</span>, err)
				<span class="hljs-keyword">continue</span>
			}

			<span class="hljs-keyword">if</span> cmd.Code != <span class="hljs-number">0</span> {
				log.Printf(<span class="hljs-string">"recv Error: Code=%d, Msg=%s"</span>, cmd.Code, cmd.Msg)
				<span class="hljs-keyword">continue</span>
			}

			<span class="hljs-keyword">switch</span> cmd.Type {
			<span class="hljs-keyword">case</span> protocol.CommandType_LOGIN:
				log.Printf(<span class="hljs-string">"Login Success!"</span>)
			<span class="hljs-keyword">case</span> protocol.CommandType_HEARTBEAT:
				log.Printf(<span class="hljs-string">"recv Pong"</span>)
			<span class="hljs-keyword">case</span> protocol.CommandType_MESSAGE:
				<span class="hljs-comment">// å¦‚æœ Data ä¸ä¸ºç©ºï¼Œè¯´æ˜å¯èƒ½æ˜¯ä¸€ä¸ªæ¨é€ä¸‹æ¥çš„æ–°æ¶ˆæ¯ï¼Œè€Œä¸ä»…ä»…æ˜¯ ACK</span>
				<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(cmd.Data) &gt; <span class="hljs-number">0</span> {
					<span class="hljs-keyword">var</span> msgCmd protocol.MessageCommand
					<span class="hljs-keyword">if</span> err := proto.Unmarshal(cmd.Data, &amp;msgCmd); err == <span class="hljs-literal">nil</span> {
						log.Printf(<span class="hljs-string">"recv Message: From=%s, Content=%s"</span>, <span class="hljs-string">"System"</span>, msgCmd.Content)
					} <span class="hljs-keyword">else</span> {
						log.Printf(<span class="hljs-string">"recv Message ACK (Data len=%d)"</span>, <span class="hljs-built_in">len</span>(cmd.Data))
					}
				} <span class="hljs-keyword">else</span> {
					log.Printf(<span class="hljs-string">"recv Message ACK: %s"</span>, cmd.Msg)
				}
			}
		}
	}()

	<span class="hljs-comment">// å‘é€æ¶ˆæ¯æµ‹è¯• (Send Loop)</span>
	ticker := time.NewTicker(<span class="hljs-number">2</span> * time.Second)
	<span class="hljs-keyword">defer</span> ticker.Stop()

	interrupt := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> os.Signal, <span class="hljs-number">1</span>)
	signal.Notify(interrupt, os.Interrupt)

	<span class="hljs-comment">// å…ˆå‘é€ç™»å½•åŒ…</span>
	sendLogin(c)

	count := <span class="hljs-number">0</span>
	<span class="hljs-keyword">for</span> {
		<span class="hljs-keyword">select</span> {
		<span class="hljs-keyword">case</span> &lt;-done:
			<span class="hljs-keyword">return</span>
		<span class="hljs-keyword">case</span> &lt;-ticker.C:
			<span class="hljs-comment">// è½®æµå‘é€å¿ƒè·³å’ŒèŠå¤©æ¶ˆæ¯</span>
			count++
			<span class="hljs-keyword">if</span> count%<span class="hljs-number">2</span> == <span class="hljs-number">0</span> {
				sendHeartbeat(c)
			} <span class="hljs-keyword">else</span> {
				sendMessage(c)
			}

		<span class="hljs-keyword">case</span> &lt;-interrupt:
			<span class="hljs-comment">// ä¼˜é›…é€€å‡º</span>
			log.Println(<span class="hljs-string">"interrupt"</span>)
			err := c.WriteMessage(websocket.CloseMessage, websocket.FormatCloseMessage(websocket.CloseNormalClosure, <span class="hljs-string">""</span>))
			<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
				log.Println(<span class="hljs-string">"write close:"</span>, err)
				<span class="hljs-keyword">return</span>
			}
			<span class="hljs-keyword">select</span> {
			<span class="hljs-keyword">case</span> &lt;-done:
			<span class="hljs-keyword">case</span> &lt;-time.After(time.Second):
			}
			<span class="hljs-keyword">return</span>
		}
	}
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sendLogin</span><span class="hljs-params">(c *websocket.Conn)</span></span> {
	<span class="hljs-comment">// æ„é€  LoginCommand</span>
	loginPayload := &amp;protocol.LoginCommand{
		Token: <span class="hljs-string">"test-token-123"</span>,
	}
	data, _ := proto.Marshal(loginPayload)

	<span class="hljs-comment">// æ„é€ å¤–å±‚ Command</span>
	cmd := &amp;protocol.Command{
		Type: protocol.CommandType_LOGIN,
		Data: data,
	}

	sendProto(c, cmd)
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sendHeartbeat</span><span class="hljs-params">(c *websocket.Conn)</span></span> {
	hbPayload := &amp;protocol.HeartbeatCommand{
		Timestamp: time.Now().Unix(),
	}
	data, _ := proto.Marshal(hbPayload)

	cmd := &amp;protocol.Command{
		Type: protocol.CommandType_HEARTBEAT,
		Data: data,
	}
	sendProto(c, cmd)
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sendMessage</span><span class="hljs-params">(c *websocket.Conn)</span></span> {
	msgPayload := &amp;protocol.MessageCommand{
		Uuid:       <span class="hljs-string">"msg-"</span> + time.Now().String(),
		Type:       <span class="hljs-number">1</span>,
		Content:    <span class="hljs-string">"Hello StateServer! "</span> + time.Now().Format(time.TimeOnly),
		ReceiverId: <span class="hljs-string">"1002"</span>,
	}
	data, _ := proto.Marshal(msgPayload)

	cmd := &amp;protocol.Command{
		Type: protocol.CommandType_MESSAGE,
		Data: data,
	}
	sendProto(c, cmd)
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sendProto</span><span class="hljs-params">(c *websocket.Conn, cmd *protocol.Command)</span></span> {
	<span class="hljs-comment">// åºåˆ—åŒ–</span>
	bytes, err := proto.Marshal(cmd)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		log.Println(<span class="hljs-string">"marshal error:"</span>, err)
		<span class="hljs-keyword">return</span>
	}

	<span class="hljs-comment">// å‘é€äºŒè¿›åˆ¶å¸§ (BinaryMessage)</span>
	err = c.WriteMessage(websocket.BinaryMessage, bytes)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		log.Println(<span class="hljs-string">"write error:"</span>, err)
	} <span class="hljs-keyword">else</span> {
		log.Printf(<span class="hljs-string">"sent command: type=%v"</span>, cmd.Type)
	}
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Postmançš„MockServer]]></title>    <link>https://juejin.cn/post/7598418891401314358</link>    <guid>https://juejin.cn/post/7598418891401314358</guid>    <pubDate>2026-01-24T03:46:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598418891401314358" data-draft-id="7591506455972626486" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Postmançš„MockServer"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-24T03:46:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Emanon"/> <meta itemprop="url" content="https://juejin.cn/user/1794847455576878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Postmançš„MockServer
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1794847455576878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Emanon
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T03:46:07.000Z" title="Sat Jan 24 2026 03:46:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1.åˆ›å»ºMockServer</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e701c84d1e9e4ccbb470ae3926dddb55~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRW1hbm9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769831167&amp;x-signature=o1aU56xe%2F35CWfSDTbjfMo6pcTw%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">2.å®šä¹‰è·¯å¾„ã€å“åº”ç ã€å“åº”ä¿¡æ¯</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2aa488a04f1c49b98fdfa45246a3f02e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRW1hbm9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769831167&amp;x-signature=areyuLYrsJFwcT2zCCvToPj99ng%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-2">3.æŸ¥çœ‹mocké›†åˆ</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b556e15d36041b6bcfb1d692007ac49~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRW1hbm9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769831167&amp;x-signature=dZb3xb0WQnvE9drYpBevkAheC84%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-3">4.æŸ¥çœ‹æ¥å£çš„è¯·æ±‚å“åº”ä¿¡æ¯</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c71bf28f8fa2410c995befae98d99866~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRW1hbm9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769831167&amp;x-signature=pHANJLWoh7qPIBzLzWZycycX2%2B8%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-4">5.è°ƒè¯•æ¨¡æ‹Ÿæ¥å£</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c8f8297e03a4be1b9cc8c9842b3251d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRW1hbm9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769831167&amp;x-signature=L%2FhqkfxDK0fZRInBOj3vgIISngk%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-5">6.å‘èµ·è¯·æ±‚</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7ceaccd55f5c4c5db2b761ee9ac2ae2e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRW1hbm9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769831167&amp;x-signature=kTWdBFlEnShXd%2FpHSSwFAf95Tqw%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-6">7.ä¿®æ”¹è¯·æ±‚æ–¹å¼ã€å“åº”ç ã€å“åº”ä¿¡æ¯</h2>
<p>ä½¿ç”¨ç¬¬6æ­¥å‘èµ·è¯·æ±‚
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6650a27a8fd54253886e7760ca927f62~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRW1hbm9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769831167&amp;x-signature=C4sL%2F75qdhWAqcB06AqHSGFkKRs%3D" alt="image.png" loading="lazy"/></p>
<p>ä¿®æ”¹å“åº”ä¿¡æ¯</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19406f4c3789431fb7822f287c126284~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRW1hbm9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769831167&amp;x-signature=J2%2BMq8zQ5ZInYd3g7fRhbwH4JmE%3D" alt="image.png" loading="lazy"/></p>
<p>ä¿å­˜è¯·æ±‚
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c4151ca2abd14c90b0f80e2f53e34500~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRW1hbm9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769831167&amp;x-signature=gKok%2FrtooNqyB0%2BsGl%2Bt6zUofJs%3D" alt="image.png" loading="lazy"/></p>
<p>é‡æ–°å‘èµ·è¯·æ±‚å³å¯</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dbb52a6b1e50411fa827305f9aeee3b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRW1hbm9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769831167&amp;x-signature=gR9Zh5WEMIC4NZGEA2scOkXKars%3D" alt="image.png" loading="lazy"/></p>
<p>åœ¨collectioné›†åˆä¸­å¯ä»¥çœ‹åˆ°åˆšæ‰ä¿®æ”¹çš„æ¥å£ä¿¡æ¯</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b6c479adee74f93b2582682978b58c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRW1hbm9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769831167&amp;x-signature=PH7RgMKasbGLX7H9WNTXrvXjPyQ%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-7">8.ä¿®æ”¹è¯·æ±‚æ–¹å¼ã€å“åº”ç ã€å“åº”ä¿¡æ¯</h2>
<p>é€‰æ‹©add examplae
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c403ddbc8bd4afeb729aef19e973857~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRW1hbm9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769831167&amp;x-signature=MCyEiJtwjt4HKMSd%2FwySV0UqkYQ%3D" alt="image.png" loading="lazy"/></p>
<p>ä¿®æ”¹å“åº”ä¿¡æ¯
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c60894201fb64fbebf1e0da362a02d75~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRW1hbm9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769831167&amp;x-signature=XU4KvH6q9y0AvNqXqLjdEX834EQ%3D" alt="image.png" loading="lazy"/></p>
<p>è¦æŠŠå…¶å®ƒçš„é›†åˆåˆ é™¤æ‰èƒ½çœ‹åˆ°æ•ˆæœ</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5fce52c4af5f4c7fbd8dfa8970febf76~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRW1hbm9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769831167&amp;x-signature=k3GQmx3IoCyI9EnTUjmlwYaJpyk%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Rust OnceCell æ·±åº¦è§£æï¼šå»¶è¿Ÿåˆå§‹åŒ–çš„ä¼˜é›…è§£å†³æ–¹æ¡ˆ]]></title>    <link>https://juejin.cn/post/7598641282324348955</link>    <guid>https://juejin.cn/post/7598641282324348955</guid>    <pubDate>2026-01-24T05:33:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598641282324348955" data-draft-id="7598477092196466726" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Rust OnceCell æ·±åº¦è§£æï¼šå»¶è¿Ÿåˆå§‹åŒ–çš„ä¼˜é›…è§£å†³æ–¹æ¡ˆ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-24T05:33:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="fliter"/> <meta itemprop="url" content="https://juejin.cn/user/888061123628509"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Rust OnceCell æ·±åº¦è§£æï¼šå»¶è¿Ÿåˆå§‹åŒ–çš„ä¼˜é›…è§£å†³æ–¹æ¡ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/888061123628509/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    fliter
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T05:33:57.000Z" title="Sat Jan 24 2026 05:33:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>åœ¨ Rust ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸é‡åˆ°éœ€è¦å»¶è¿Ÿåˆå§‹åŒ–å…¨å±€å˜é‡æˆ–é™æ€å˜é‡çš„åœºæ™¯ã€‚ä¼ ç»Ÿçš„åšæ³•å¯èƒ½æ¶‰åŠå¤æ‚çš„ <code>lazy_static!</code> å®æˆ– <code>Mutex</code> åŒ…è£…ï¼Œä½†è‡ª Rust 1.70 èµ·ï¼Œ<code>OnceCell</code> å’Œ <code>OnceLock</code> å·²ç»ç¨³å®šè¿›å…¥æ ‡å‡†åº“ï¼Œä¸ºæˆ‘ä»¬æä¾›äº†æ›´åŠ ä¼˜é›…å’Œé«˜æ•ˆçš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>æœ¬æ–‡å°†æ·±å…¥æ¢è®¨ <code>OnceCell</code> çš„ä½¿ç”¨åœºæ™¯ã€å®ç°åŸç†å’Œæœ€ä½³å®è·µã€‚</p>
<h2 data-id="heading-1">ä»€ä¹ˆæ˜¯ OnceCell?</h2>
<p><code>OnceCell</code> æ˜¯ä¸€ä¸ªåªèƒ½å†™å…¥ä¸€æ¬¡çš„å®¹å™¨ç±»å‹ã€‚ä¸€æ—¦è¢«åˆå§‹åŒ–ï¼Œå®ƒå°†æ°¸ä¹…ä¿å­˜è¯¥å€¼ï¼Œåç»­çš„å†™å…¥æ“ä½œå°†å¤±è´¥ã€‚è¿™ç§ç‰¹æ€§ä½¿å…¶ç‰¹åˆ«é€‚åˆç”¨äºå»¶è¿Ÿåˆå§‹åŒ–å’Œå…¨å±€çŠ¶æ€ç®¡ç†ã€‚</p>
<p>Rust æ ‡å‡†åº“æä¾›äº†ä¸¤ä¸ªä¸»è¦ç±»å‹ï¼š</p>
<ul>
<li><code>std::cell::OnceCell&lt;T&gt;</code> - å•çº¿ç¨‹ç‰ˆæœ¬</li>
<li><code>std::sync::OnceLock&lt;T&gt;</code> - çº¿ç¨‹å®‰å…¨ç‰ˆæœ¬</li>
</ul>
<h2 data-id="heading-2">æ ¸å¿ƒä½¿ç”¨åœºæ™¯</h2>
<h3 data-id="heading-3">1. å…¨å±€é…ç½®ç®¡ç†</h3>
<p>åœ¨åº”ç”¨å¯åŠ¨æ—¶è¯»å–é…ç½®æ–‡ä»¶ï¼Œä¹‹åå…¨å±€åªè¯»è®¿é—®ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::sync::OnceLock;

<span class="hljs-meta">#[derive(Debug)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Config</span> {
    database_url: <span class="hljs-type">String</span>,
    max_connections: <span class="hljs-type">u32</span>,
}

<span class="hljs-keyword">static</span> CONFIG: OnceLock&lt;Config&gt; = OnceLock::<span class="hljs-title function_ invoke__">new</span>();

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">init_config</span>() {
    CONFIG.<span class="hljs-title function_ invoke__">get_or_init</span>(|| Config {
        database_url: <span class="hljs-string">"postgres://localhost/mydb"</span>.<span class="hljs-title function_ invoke__">to_string</span>(),
        max_connections: <span class="hljs-number">10</span>,
    });
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">get_config</span>() <span class="hljs-punctuation">-&gt;</span> &amp;<span class="hljs-symbol">'static</span> Config {
    CONFIG.<span class="hljs-title function_ invoke__">get</span>().<span class="hljs-title function_ invoke__">expect</span>(<span class="hljs-string">"é…ç½®æœªåˆå§‹åŒ–"</span>)
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-title function_ invoke__">init_config</span>();
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"æ•°æ®åº“ URL: {}"</span>, <span class="hljs-title function_ invoke__">get_config</span>().database_url);
}
</code></pre>
<h3 data-id="heading-4">2. å»¶è¿Ÿåˆå§‹åŒ–æ˜‚è´µèµ„æº</h3>
<p>å¯¹äºåˆ›å»ºæˆæœ¬é«˜çš„å¯¹è±¡ï¼Œå¯ä»¥å»¶è¿Ÿåˆ°çœŸæ­£éœ€è¦æ—¶å†åˆå§‹åŒ–ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::sync::OnceLock;

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">DatabaseConnection</span> {
    <span class="hljs-comment">// æ¨¡æ‹Ÿæ•°æ®åº“è¿æ¥</span>
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">DatabaseConnection</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>() <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span> {
        <span class="hljs-built_in">println!</span>(<span class="hljs-string">"æ­£åœ¨å»ºç«‹æ•°æ®åº“è¿æ¥..."</span>);
        <span class="hljs-comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span>
        <span class="hljs-keyword">Self</span> {}
    }
}

<span class="hljs-keyword">static</span> DB: OnceLock&lt;DatabaseConnection&gt; = OnceLock::<span class="hljs-title function_ invoke__">new</span>();

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">get_db</span>() <span class="hljs-punctuation">-&gt;</span> &amp;<span class="hljs-symbol">'static</span> DatabaseConnection {
    DB.<span class="hljs-title function_ invoke__">get_or_init</span>(|| DatabaseConnection::<span class="hljs-title function_ invoke__">new</span>())
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"åº”ç”¨å¯åŠ¨"</span>);
    <span class="hljs-comment">// æ­¤æ—¶è¿˜æœªå»ºç«‹è¿æ¥</span>
    
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"é¦–æ¬¡è®¿é—®æ•°æ®åº“"</span>);
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">_db</span> = <span class="hljs-title function_ invoke__">get_db</span>();  <span class="hljs-comment">// è¿™é‡Œæ‰çœŸæ­£å»ºç«‹è¿æ¥</span>
    
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"å†æ¬¡è®¿é—®æ•°æ®åº“"</span>);
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">_db</span> = <span class="hljs-title function_ invoke__">get_db</span>();  <span class="hljs-comment">// ç›´æ¥è¿”å›å·²æœ‰è¿æ¥ï¼Œä¸å†åˆå§‹åŒ–</span>
}
</code></pre>
<h3 data-id="heading-5">3. å•ä¾‹æ¨¡å¼å®ç°</h3>
<p><code>OnceLock</code> å¤©ç„¶é€‚åˆå®ç°çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::sync::OnceLock;

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Logger</span> {
    prefix: <span class="hljs-type">String</span>,
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">Logger</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">instance</span>() <span class="hljs-punctuation">-&gt;</span> &amp;<span class="hljs-symbol">'static</span> Logger {
        <span class="hljs-keyword">static</span> INSTANCE: OnceLock&lt;Logger&gt; = OnceLock::<span class="hljs-title function_ invoke__">new</span>();
        INSTANCE.<span class="hljs-title function_ invoke__">get_or_init</span>(|| Logger {
            prefix: <span class="hljs-string">"[LOG]"</span>.<span class="hljs-title function_ invoke__">to_string</span>(),
        })
    }
    
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">log</span>(&amp;<span class="hljs-keyword">self</span>, message: &amp;<span class="hljs-type">str</span>) {
        <span class="hljs-built_in">println!</span>(<span class="hljs-string">"{} {}"</span>, <span class="hljs-keyword">self</span>.prefix, message);
    }
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    Logger::<span class="hljs-title function_ invoke__">instance</span>().<span class="hljs-title function_ invoke__">log</span>(<span class="hljs-string">"åº”ç”¨å¯åŠ¨"</span>);
    Logger::<span class="hljs-title function_ invoke__">instance</span>().<span class="hljs-title function_ invoke__">log</span>(<span class="hljs-string">"å¤„ç†è¯·æ±‚"</span>);
}
</code></pre>
<h2 data-id="heading-6">OnceCell vs OnceLock</h2>
<p>ä¸¤è€…çš„ä¸»è¦åŒºåˆ«åœ¨äºçº¿ç¨‹å®‰å…¨æ€§ï¼š</p>






























<table><thead><tr><th>ç‰¹æ€§</th><th>OnceCell</th><th>OnceLock</th></tr></thead><tbody><tr><td>çº¿ç¨‹å®‰å…¨</td><td>å¦</td><td>æ˜¯</td></tr><tr><td>æ€§èƒ½</td><td>æ›´å¿«</td><td>ç¨æ…¢ï¼ˆæœ‰åŒæ­¥å¼€é”€ï¼‰</td></tr><tr><td>ä½¿ç”¨åœºæ™¯</td><td>å•çº¿ç¨‹ç¯å¢ƒ</td><td>å¤šçº¿ç¨‹ç¯å¢ƒ</td></tr><tr><td>å®ç° <code>Sync</code></td><td>å¦</td><td>æ˜¯</td></tr></tbody></table>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::cell::OnceCell;
<span class="hljs-keyword">use</span> std::sync::OnceLock;

<span class="hljs-comment">// å•çº¿ç¨‹åœºæ™¯</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">single_thread_example</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">cell</span> = OnceCell::<span class="hljs-title function_ invoke__">new</span>();
    <span class="hljs-built_in">assert!</span>(cell.<span class="hljs-title function_ invoke__">get</span>().<span class="hljs-title function_ invoke__">is_none</span>());
    
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">value</span> = cell.<span class="hljs-title function_ invoke__">get_or_init</span>(|| <span class="hljs-number">42</span>);
    <span class="hljs-built_in">assert_eq!</span>(*value, <span class="hljs-number">42</span>);
    
    <span class="hljs-comment">// å†æ¬¡åˆå§‹åŒ–ä¼šè¿”å›å·²æœ‰å€¼</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">value</span> = cell.<span class="hljs-title function_ invoke__">get_or_init</span>(|| <span class="hljs-number">100</span>);
    <span class="hljs-built_in">assert_eq!</span>(*value, <span class="hljs-number">42</span>);  <span class="hljs-comment">// ä»ç„¶æ˜¯ 42</span>
}

<span class="hljs-comment">// å¤šçº¿ç¨‹åœºæ™¯</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">multi_thread_example</span>() {
    <span class="hljs-keyword">static</span> COUNTER: OnceLock&lt;<span class="hljs-type">u32</span>&gt; = OnceLock::<span class="hljs-title function_ invoke__">new</span>();
    
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">handles</span>: <span class="hljs-type">Vec</span>&lt;_&gt; = (<span class="hljs-number">0</span>..<span class="hljs-number">10</span>)
        .<span class="hljs-title function_ invoke__">map</span>(|i| {
            std::thread::<span class="hljs-title function_ invoke__">spawn</span>(<span class="hljs-keyword">move</span> || {
                <span class="hljs-comment">// åªæœ‰ä¸€ä¸ªçº¿ç¨‹ä¼šæˆåŠŸåˆå§‹åŒ–</span>
                COUNTER.<span class="hljs-title function_ invoke__">get_or_init</span>(|| i)
            })
        })
        .<span class="hljs-title function_ invoke__">collect</span>();
    
    <span class="hljs-keyword">for</span> <span class="hljs-variable">handle</span> <span class="hljs-keyword">in</span> handles {
        handle.<span class="hljs-title function_ invoke__">join</span>().<span class="hljs-title function_ invoke__">unwrap</span>();
    }
    
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"æœ€ç»ˆå€¼: {}"</span>, COUNTER.<span class="hljs-title function_ invoke__">get</span>().<span class="hljs-title function_ invoke__">unwrap</span>());
}
</code></pre>
<h2 data-id="heading-7">å¸¸ç”¨ API è¯¦è§£</h2>
<h3 data-id="heading-8"><code>get()</code> - è·å–å€¼çš„å¼•ç”¨</h3>
<p>è¿”å› <code>Option&lt;&amp;T&gt;</code>ï¼Œå¦‚æœæœªåˆå§‹åŒ–åˆ™è¿”å› <code>None</code>ã€‚</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">cell</span> = OnceLock::<span class="hljs-title function_ invoke__">new</span>();
<span class="hljs-built_in">assert!</span>(cell.<span class="hljs-title function_ invoke__">get</span>().<span class="hljs-title function_ invoke__">is_none</span>());

cell.<span class="hljs-title function_ invoke__">set</span>(<span class="hljs-number">42</span>).<span class="hljs-title function_ invoke__">unwrap</span>();
<span class="hljs-built_in">assert_eq!</span>(cell.<span class="hljs-title function_ invoke__">get</span>(), <span class="hljs-title function_ invoke__">Some</span>(&amp;<span class="hljs-number">42</span>));
</code></pre>
<h3 data-id="heading-9"><code>set()</code> - è®¾ç½®å€¼</h3>
<p>è¿”å› <code>Result&lt;(), T&gt;</code>ï¼Œå¦‚æœå·²ç»åˆå§‹åŒ–åˆ™è¿”å› <code>Err(value)</code>ã€‚</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">cell</span> = OnceLock::<span class="hljs-title function_ invoke__">new</span>();
<span class="hljs-built_in">assert!</span>(cell.<span class="hljs-title function_ invoke__">set</span>(<span class="hljs-number">42</span>).<span class="hljs-title function_ invoke__">is_ok</span>());
<span class="hljs-built_in">assert!</span>(cell.<span class="hljs-title function_ invoke__">set</span>(<span class="hljs-number">100</span>).<span class="hljs-title function_ invoke__">is_err</span>());  <span class="hljs-comment">// å¤±è´¥ï¼Œå·²ç»è®¾ç½®è¿‡</span>
</code></pre>
<h3 data-id="heading-10"><code>get_or_init()</code> - è·å–æˆ–åˆå§‹åŒ–</h3>
<p>å¦‚æœæœªåˆå§‹åŒ–åˆ™ä½¿ç”¨æä¾›çš„é—­åŒ…è¿›è¡Œåˆå§‹åŒ–ï¼Œè¿”å›å€¼çš„å¼•ç”¨ã€‚</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">cell</span> = OnceLock::<span class="hljs-title function_ invoke__">new</span>();
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">value</span> = cell.<span class="hljs-title function_ invoke__">get_or_init</span>(|| {
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"åˆå§‹åŒ–ä¸­..."</span>);
    <span class="hljs-number">42</span>
});
<span class="hljs-built_in">assert_eq!</span>(*value, <span class="hljs-number">42</span>);
</code></pre>
<h3 data-id="heading-11"><code>get_or_try_init()</code> - å¯å¤±è´¥çš„åˆå§‹åŒ–</h3>
<p>æ”¯æŒåˆå§‹åŒ–è¿‡ç¨‹å¯èƒ½å¤±è´¥çš„åœºæ™¯ã€‚</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::sync::OnceLock;

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">load_config</span>() <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;<span class="hljs-type">String</span>, std::io::Error&gt; {
    <span class="hljs-comment">// æ¨¡æ‹Ÿå¯èƒ½å¤±è´¥çš„é…ç½®åŠ è½½</span>
    <span class="hljs-title function_ invoke__">Ok</span>(<span class="hljs-string">"config_data"</span>.<span class="hljs-title function_ invoke__">to_string</span>())
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">static</span> CONFIG: OnceLock&lt;<span class="hljs-type">String</span>&gt; = OnceLock::<span class="hljs-title function_ invoke__">new</span>();
    
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">result</span> = CONFIG.<span class="hljs-title function_ invoke__">get_or_try_init</span>(|| <span class="hljs-title function_ invoke__">load_config</span>());
    <span class="hljs-keyword">match</span> result {
        <span class="hljs-title function_ invoke__">Ok</span>(config) =&gt; <span class="hljs-built_in">println!</span>(<span class="hljs-string">"é…ç½®: {}"</span>, config),
        <span class="hljs-title function_ invoke__">Err</span>(e) =&gt; eprintln!(<span class="hljs-string">"åŠ è½½å¤±è´¥: {}"</span>, e),
    }
}
</code></pre>
<h2 data-id="heading-12">å®æˆ˜æ¡ˆä¾‹ï¼šHTTP å®¢æˆ·ç«¯ç¼“å­˜</h2>
<p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦ä¸€ä¸ªå…¨å±€çš„ HTTP å®¢æˆ·ç«¯å®ä¾‹ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::sync::OnceLock;

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">HttpClient</span> {
    base_url: <span class="hljs-type">String</span>,
    timeout: <span class="hljs-type">u64</span>,
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">HttpClient</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>(base_url: <span class="hljs-type">String</span>, timeout: <span class="hljs-type">u64</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span> {
        <span class="hljs-built_in">println!</span>(<span class="hljs-string">"åˆ›å»º HTTP å®¢æˆ·ç«¯: {}"</span>, base_url);
        <span class="hljs-keyword">Self</span> { base_url, timeout }
    }
    
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">get</span>(&amp;<span class="hljs-keyword">self</span>, path: &amp;<span class="hljs-type">str</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">String</span> {
        <span class="hljs-built_in">format!</span>(<span class="hljs-string">"GET {}{}"</span>, <span class="hljs-keyword">self</span>.base_url, path)
    }
}

<span class="hljs-keyword">static</span> HTTP_CLIENT: OnceLock&lt;HttpClient&gt; = OnceLock::<span class="hljs-title function_ invoke__">new</span>();

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">get_http_client</span>() <span class="hljs-punctuation">-&gt;</span> &amp;<span class="hljs-symbol">'static</span> HttpClient {
    HTTP_CLIENT.<span class="hljs-title function_ invoke__">get_or_init</span>(|| {
        HttpClient::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-string">"https://api.example.com"</span>.<span class="hljs-title function_ invoke__">to_string</span>(), <span class="hljs-number">30</span>)
    })
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-comment">// é¦–æ¬¡ä½¿ç”¨æ—¶æ‰åˆ›å»º</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">response1</span> = <span class="hljs-title function_ invoke__">get_http_client</span>().<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-string">"/users"</span>);
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"{}"</span>, response1);
    
    <span class="hljs-comment">// å¤ç”¨å·²åˆ›å»ºçš„å®ä¾‹</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">response2</span> = <span class="hljs-title function_ invoke__">get_http_client</span>().<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-string">"/posts"</span>);
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"{}"</span>, response2);
}
</code></pre>
<h2 data-id="heading-13">æ€§èƒ½è€ƒé‡</h2>
<p><code>OnceLock</code> çš„æ€§èƒ½ç‰¹ç‚¹ï¼š</p>
<ol>
<li><strong>é¦–æ¬¡åˆå§‹åŒ–</strong>ï¼šæœ‰è½»å¾®çš„åŒæ­¥å¼€é”€ï¼ˆåŸå­æ“ä½œï¼‰</li>
<li><strong>åç»­è®¿é—®</strong>ï¼šå‡ ä¹é›¶æˆæœ¬ï¼Œç›´æ¥è¿”å›å¼•ç”¨</li>
<li><strong>å†…å­˜å ç”¨</strong>ï¼šä»…å­˜å‚¨ä¸€ä»½æ•°æ® + å°‘é‡çŠ¶æ€æ ‡è®°</li>
</ol>
<p>ä¸ <code>lazy_static!</code> ç›¸æ¯”ï¼Œ<code>OnceLock</code> é€šå¸¸æ€§èƒ½ç›¸å½“æˆ–æ›´å¥½ï¼Œä¸”æ— éœ€é¢å¤–ä¾èµ–ã€‚</p>
<h2 data-id="heading-14">æ³¨æ„äº‹é¡¹å’Œæœ€ä½³å®è·µ</h2>
<h3 data-id="heading-15">1. é¿å…åœ¨ Drop ä¸­è®¿é—® OnceLock</h3>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// âŒ ä¸æ¨è</span>
<span class="hljs-keyword">static</span> RESOURCE: OnceLock&lt;<span class="hljs-type">String</span>&gt; = OnceLock::<span class="hljs-title function_ invoke__">new</span>();

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">MyStruct</span>;

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">Drop</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">MyStruct</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">drop</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) {
        <span class="hljs-comment">// å¯èƒ½å¯¼è‡´æœªå®šä¹‰è¡Œä¸º</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">Some</span>(r) = RESOURCE.<span class="hljs-title function_ invoke__">get</span>() {
            <span class="hljs-built_in">println!</span>(<span class="hljs-string">"{}"</span>, r);
        }
    }
}
</code></pre>
<h3 data-id="heading-16">2. åˆå§‹åŒ–å¤±è´¥çš„å¤„ç†</h3>
<p>å¯¹äºå¯èƒ½å¤±è´¥çš„åˆå§‹åŒ–ï¼Œä½¿ç”¨ <code>get_or_try_init</code> å¹¶å¦¥å–„å¤„ç†é”™è¯¯ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">result</span> = CELL.<span class="hljs-title function_ invoke__">get_or_try_init</span>(|| {
    <span class="hljs-title function_ invoke__">expensive_fallible_operation</span>()
});

<span class="hljs-keyword">match</span> result {
    <span class="hljs-title function_ invoke__">Ok</span>(value) =&gt; { <span class="hljs-comment">/* ä½¿ç”¨ value */</span> },
    <span class="hljs-title function_ invoke__">Err</span>(e) =&gt; { <span class="hljs-comment">/* å¤„ç†é”™è¯¯ */</span> },
}
</code></pre>
<h3 data-id="heading-17">3. é€‰æ‹©åˆé€‚çš„ç±»å‹</h3>
<ul>
<li>å•çº¿ç¨‹åœºæ™¯ç”¨ <code>OnceCell</code></li>
<li>å¤šçº¿ç¨‹æˆ–é™æ€å˜é‡ç”¨ <code>OnceLock</code></li>
<li>éœ€è¦å¯å˜æ€§è€ƒè™‘ <code>Mutex&lt;Option&lt;T&gt;&gt;</code></li>
</ul>
<h2 data-id="heading-18">ä¸å…¶ä»–æ–¹æ¡ˆå¯¹æ¯”</h2>
<h3 data-id="heading-19">vs lazy_static!</h3>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// ä½¿ç”¨ lazy_staticï¼ˆéœ€è¦å¤–éƒ¨ crateï¼‰</span>
<span class="hljs-keyword">use</span> lazy_static::lazy_static;
lazy_static! {
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">ref</span> CONFIG: Config = Config::<span class="hljs-title function_ invoke__">load</span>();
}

<span class="hljs-comment">// ä½¿ç”¨ OnceLockï¼ˆæ ‡å‡†åº“ï¼Œæ— éœ€ä¾èµ–ï¼‰</span>
<span class="hljs-keyword">static</span> CONFIG: OnceLock&lt;Config&gt; = OnceLock::<span class="hljs-title function_ invoke__">new</span>();
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">get_config</span>() <span class="hljs-punctuation">-&gt;</span> &amp;<span class="hljs-symbol">'static</span> Config {
    CONFIG.<span class="hljs-title function_ invoke__">get_or_init</span>(|| Config::<span class="hljs-title function_ invoke__">load</span>())
}
</code></pre>
<h3 data-id="heading-20">vs Mutex&lt;Option&gt;</h3>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// Mutex æ–¹æ¡ˆï¼šå¯å˜ï¼Œä½†æ¯æ¬¡è®¿é—®éƒ½éœ€è¦åŠ é”</span>
<span class="hljs-keyword">static</span> DATA: Mutex&lt;<span class="hljs-type">Option</span>&lt;<span class="hljs-type">String</span>&gt;&gt; = Mutex::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-literal">None</span>);

<span class="hljs-comment">// OnceLock æ–¹æ¡ˆï¼šä¸å¯å˜ï¼Œåˆå§‹åŒ–åé›¶æˆæœ¬è®¿é—®</span>
<span class="hljs-keyword">static</span> DATA: OnceLock&lt;<span class="hljs-type">String</span>&gt; = OnceLock::<span class="hljs-title function_ invoke__">new</span>();
</code></pre>
<h2 data-id="heading-21">å°ç»“</h2>
<p><code>OnceCell</code> å’Œ <code>OnceLock</code> æ˜¯ Rust æ ‡å‡†åº“ä¸­ç”¨äºå»¶è¿Ÿåˆå§‹åŒ–çš„å¼ºå¤§å·¥å…·ã€‚å®ƒä»¬æä¾›äº†ï¼š</p>
<ul>
<li>é›¶ä¾èµ–çš„å»¶è¿Ÿåˆå§‹åŒ–</li>
<li>çº¿ç¨‹å®‰å…¨çš„å…¨å±€çŠ¶æ€ç®¡ç†</li>
<li>é«˜æ€§èƒ½çš„å•æ¬¡å†™å…¥è¯­ä¹‰</li>
<li>ç®€æ´çš„ API è®¾è®¡</li>
</ul>
<p>åœ¨éœ€è¦å…¨å±€é…ç½®ã€å•ä¾‹æ¨¡å¼æˆ–å»¶è¿Ÿåˆå§‹åŒ–çš„åœºæ™¯ä¸­ï¼Œ<code>OnceLock</code> åº”è¯¥æ˜¯ä½ çš„é¦–é€‰æ–¹æ¡ˆã€‚éšç€ Rust ç”Ÿæ€çš„å‘å±•ï¼Œè¿™äº›ç±»å‹å°†é€æ¸å–ä»£ <code>lazy_static!</code> ç­‰å¤–éƒ¨ä¾èµ–ï¼Œæˆä¸ºæ ‡å‡†åšæ³•ã€‚</p>
<hr/>
<h2 data-id="heading-22">Go ä¸­çš„å¯¹åº”æ–¹æ¡ˆ</h2>
<p>Go è¯­è¨€ä¸­æœ‰ <code>sync.Once</code> å’Œ  <code>sync.OnceValue</code>ï¼ˆGo 1.21+ï¼‰ï¼Œå®ƒä»¬çš„åŠŸèƒ½ä¸ Rust çš„ <code>OnceCell</code>/<code>OnceLock</code> éå¸¸ç›¸ä¼¼ã€‚</p>
<h3 data-id="heading-23">1. <strong>sync.Once</strong> - ç»å…¸æ–¹æ¡ˆ</h3>
<p><code>sync.Once</code> ç¡®ä¿æŸä¸ªå‡½æ•°åªæ‰§è¡Œä¸€æ¬¡ï¼Œå³ä½¿åœ¨å¹¶å‘ç¯å¢ƒä¸­ä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚è¿™æ˜¯ Go ä¸­å®ç°å»¶è¿Ÿåˆå§‹åŒ–å’Œå•ä¾‹æ¨¡å¼çš„æ ‡å‡†æ–¹å¼ã€‚</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"sync"</span>
)

<span class="hljs-keyword">type</span> Config <span class="hljs-keyword">struct</span> {
    DatabaseURL <span class="hljs-type">string</span>
    MaxConnections <span class="hljs-type">int</span>
}

<span class="hljs-keyword">var</span> (
    config *Config
    once   sync.Once
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GetConfig</span><span class="hljs-params">()</span></span> *Config {
    once.Do(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
        fmt.Println(<span class="hljs-string">"åˆå§‹åŒ–é…ç½®..."</span>)
        config = &amp;Config{
            DatabaseURL: <span class="hljs-string">"postgres://localhost/mydb"</span>,
            MaxConnections: <span class="hljs-number">10</span>,
        }
    })
    <span class="hljs-keyword">return</span> config
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// å¤šæ¬¡è°ƒç”¨åªä¼šåˆå§‹åŒ–ä¸€æ¬¡</span>
    c1 := GetConfig()
    c2 := GetConfig()
    
    fmt.Printf(<span class="hljs-string">"é…ç½®1: %+v\n"</span>, c1)
    fmt.Printf(<span class="hljs-string">"é…ç½®2: %+v\n"</span>, c2)
    fmt.Printf(<span class="hljs-string">"æ˜¯åŒä¸€ä¸ªå®ä¾‹: %v\n"</span>, c1 == c2)
}
</code></pre>
<h3 data-id="heading-24">2. <strong>sync.OnceValue</strong> - Go 1.21+ çš„æ–°æ–¹æ¡ˆ</h3>
<p>Go 1.21 å¼•å…¥äº† <code>sync.OnceValue</code>ï¼Œå®ƒæä¾›äº†æ›´ç®€æ´çš„æ–¹å¼æ¥åŒ…è£…ä¸€æ¬¡æ€§åˆå§‹åŒ–é€»è¾‘å¹¶ç›´æ¥è¿”å›ç»“æœã€‚</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"sync"</span>
)

<span class="hljs-keyword">type</span> Database <span class="hljs-keyword">struct</span> {
    Connection <span class="hljs-type">string</span>
}

<span class="hljs-keyword">var</span> getDB = sync.OnceValue(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> *Database {
    fmt.Println(<span class="hljs-string">"åˆ›å»ºæ•°æ®åº“è¿æ¥..."</span>)
    <span class="hljs-keyword">return</span> &amp;Database{Connection: <span class="hljs-string">"è¿æ¥å·²å»ºç«‹"</span>}
})

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// é¦–æ¬¡è°ƒç”¨ä¼šæ‰§è¡Œåˆå§‹åŒ–</span>
    db1 := getDB()
    fmt.Println(db1.Connection)
    
    <span class="hljs-comment">// å†æ¬¡è°ƒç”¨ç›´æ¥è¿”å›ç¼“å­˜çš„ç»“æœ</span>
    db2 := getDB()
    fmt.Println(db2.Connection)
    
    fmt.Printf(<span class="hljs-string">"æ˜¯åŒä¸€ä¸ªå®ä¾‹: %v\n"</span>, db1 == db2)
}
</code></pre>
<h3 data-id="heading-25">3. <strong>sync.OnceValues</strong> - æ”¯æŒå¤šè¿”å›å€¼</h3>
<p>å¦‚æœåˆå§‹åŒ–å‡½æ•°éœ€è¦è¿”å›å¤šä¸ªå€¼ï¼ˆæ¯”å¦‚å¸¦é”™è¯¯å¤„ç†ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ <code>sync.OnceValues</code>ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"errors"</span>
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"sync"</span>
)

<span class="hljs-keyword">var</span> getConfig = sync.OnceValues(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> (*Config, <span class="hljs-type">error</span>) {
    <span class="hljs-comment">// æ¨¡æ‹Ÿå¯èƒ½å¤±è´¥çš„åˆå§‹åŒ–</span>
    <span class="hljs-keyword">if</span> someCondition := <span class="hljs-literal">false</span>; !someCondition {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, errors.New(<span class="hljs-string">"é…ç½®åŠ è½½å¤±è´¥"</span>)
    }
    
    <span class="hljs-keyword">return</span> &amp;Config{
        DatabaseURL: <span class="hljs-string">"postgres://localhost/mydb"</span>,
        MaxConnections: <span class="hljs-number">10</span>,
    }, <span class="hljs-literal">nil</span>
})

<span class="hljs-keyword">type</span> Config <span class="hljs-keyword">struct</span> {
    DatabaseURL <span class="hljs-type">string</span>
    MaxConnections <span class="hljs-type">int</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    config, err := getConfig()
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Printf(<span class="hljs-string">"é”™è¯¯: %v\n"</span>, err)
        <span class="hljs-keyword">return</span>
    }
    
    fmt.Printf(<span class="hljs-string">"é…ç½®: %+v\n"</span>, config)
}
</code></pre>
<h2 data-id="heading-26">Rust OnceCell vs Go sync.Once å¯¹æ¯”</h2>



































<table><thead><tr><th>ç‰¹æ€§</th><th>Rust OnceCell/OnceLock</th><th>Go sync.Once</th></tr></thead><tbody><tr><td><strong>åŸºæœ¬ç”¨æ³•</strong></td><td><code>cell.get_or_init(|| value)</code></td><td><code>once.Do(func() {...})</code></td></tr><tr><td><strong>çº¿ç¨‹å®‰å…¨</strong></td><td>OnceLock çº¿ç¨‹å®‰å…¨</td><td>å¤©ç„¶çº¿ç¨‹å®‰å…¨</td></tr><tr><td><strong>è¿”å›å€¼</strong></td><td>ç›´æ¥è¿”å›å€¼çš„å¼•ç”¨</td><td>éœ€è¦æ‰‹åŠ¨å­˜å‚¨å€¼</td></tr><tr><td><strong>é”™è¯¯å¤„ç†</strong></td><td><code>get_or_try_init</code> æ”¯æŒ</td><td>éœ€è¦æ‰‹åŠ¨å¤„ç†</td></tr><tr><td><strong>API ç®€æ´åº¦</strong></td><td>OnceValue æ›´ç®€æ´</td><td>ä¼ ç»Ÿæ–¹å¼ç¨ç¹ç</td></tr></tbody></table>
<h2 data-id="heading-27">å®æˆ˜ç¤ºä¾‹ï¼šæ•°æ®åº“è¿æ¥æ± </h2>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"database/sql"</span>
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"sync"</span>
    _ <span class="hljs-string">"github.com/go-sql-driver/mysql"</span>
)

<span class="hljs-keyword">type</span> Database <span class="hljs-keyword">struct</span> {
    Connection *sql.DB
}

<span class="hljs-keyword">var</span> (
    instance *Database
    once     sync.Once
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GetDatabaseInstance</span><span class="hljs-params">()</span></span> *Database {
    once.Do(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
        fmt.Println(<span class="hljs-string">"åˆå§‹åŒ–æ•°æ®åº“è¿æ¥æ± ..."</span>)
        db, err := sql.Open(<span class="hljs-string">"mysql"</span>, <span class="hljs-string">"user:password@/dbname"</span>)
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            <span class="hljs-built_in">panic</span>(err)
        }
        instance = &amp;Database{Connection: db}
    })
    <span class="hljs-keyword">return</span> instance
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// å¹¶å‘è®¿é—®ï¼Œåªä¼šåˆå§‹åŒ–ä¸€æ¬¡</span>
    <span class="hljs-keyword">var</span> wg sync.WaitGroup
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++ {
        wg.Add(<span class="hljs-number">1</span>)
        <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(id <span class="hljs-type">int</span>)</span></span> {
            <span class="hljs-keyword">defer</span> wg.Done()
            db := GetDatabaseInstance()
            fmt.Printf(<span class="hljs-string">"Goroutine %d è·å–åˆ°æ•°æ®åº“å®ä¾‹\n"</span>, id)
            _ = db
        }(i)
    }
    wg.Wait()
}
</code></pre>
<h2 data-id="heading-28">æœ€ä½³å®è·µå»ºè®®</h2>
<ol>
<li><strong>Go 1.21+</strong>: ä¼˜å…ˆä½¿ç”¨ <code>sync.OnceValue</code>ï¼Œä»£ç æ›´ç®€æ´</li>
<li><strong>éœ€è¦é”™è¯¯å¤„ç†</strong>: ä½¿ç”¨ <code>sync.OnceValues</code> è¿”å›å€¼å’Œé”™è¯¯</li>
<li><strong>ä¼ ç»Ÿ Go ç‰ˆæœ¬</strong>: ä½¿ç”¨ <code>sync.Once</code> + å…¨å±€å˜é‡</li>
</ol>
<h2 data-id="heading-29">æ€»ç»“</h2>
<p>Go çš„ <code>sync.Once</code> ç³»åˆ—å’Œ Rust çš„ <code>OnceCell</code> è§£å†³çš„æ˜¯åŒä¸€ä¸ªé—®é¢˜ï¼š<strong>çº¿ç¨‹å®‰å…¨çš„å»¶è¿Ÿåˆå§‹åŒ–</strong>ã€‚è™½ç„¶ API è®¾è®¡ç•¥æœ‰ä¸åŒï¼Œä½†æ ¸å¿ƒæ€æƒ³å®Œå…¨ä¸€è‡´ã€‚Go çš„æ–¹æ¡ˆæ›´ç®€å•ç›´æ¥ï¼Œè€Œ Rust çš„ç±»å‹ç³»ç»Ÿæä¾›äº†æ›´å¼ºçš„ç¼–è¯‘æœŸä¿è¯ã€‚</p>
<hr/>
<p><strong>å‚è€ƒèµ„æ–™</strong>ï¼š</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdoc.rust-lang.org%2Fstd%2Fcell%2Fstruct.OnceCell.html" title="https://doc.rust-lang.org/std/cell/struct.OnceCell.html" target="_blank" ref="nofollow noopener noreferrer">Rust æ ‡å‡†åº“æ–‡æ¡£ - OnceCell</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdoc.rust-lang.org%2Fstd%2Fsync%2Fstruct.OnceLock.html" title="https://doc.rust-lang.org/std/sync/struct.OnceLock.html" target="_blank" ref="nofollow noopener noreferrer">Rust æ ‡å‡†åº“æ–‡æ¡£ - OnceLock</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[dockerå®‰è£…åŠå¸¸ç”¨å‘½ä»¤]]></title>    <link>https://juejin.cn/post/7598464972911558696</link>    <guid>https://juejin.cn/post/7598464972911558696</guid>    <pubDate>2026-01-24T05:44:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598464972911558696" data-draft-id="7598401650856968192" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="dockerå®‰è£…åŠå¸¸ç”¨å‘½ä»¤"/> <meta itemprop="keywords" content="Docker"/> <meta itemprop="datePublished" content="2026-01-24T05:44:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="lewis_lk"/> <meta itemprop="url" content="https://juejin.cn/user/4444673308898028"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            dockerå®‰è£…åŠå¸¸ç”¨å‘½ä»¤
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4444673308898028/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    lewis_lk
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T05:44:08.000Z" title="Sat Jan 24 2026 05:44:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å®‰è£…Docker CE</h2>
<p>Docker CE(Community Edition)ï¼ŒDockerç¤¾åŒºç‰ˆï¼Œé€‚ç”¨äºå¼€å‘äººå‘˜å’Œè¿ç»´äººå‘˜æ„å»ºå®¹å™¨ä½¿ç”¨çš„å…è´¹ç‰ˆæœ¬</p>
<p>å®˜æ–¹å®‰è£…æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.docker.com%2Fengine%2Finstall%2F" target="_blank" title="https://docs.docker.com/engine/install/" ref="nofollow noopener noreferrer">docs.docker.com/engine/instâ€¦</a></p>
<h3 data-id="heading-1">å®‰è£…è„šæœ¬</h3>
<blockquote>
<p>æˆ‘è¿™é‡Œä»¥<code>Debian</code>ç³»ç»Ÿå’Œ<code>Unbuntu</code>ä¸ºä¾‹ï¼Œä½¿ç”¨å›½å†…é•œåƒæºå†™äº†ä¸ªå®‰è£…è„šæœ¬ï¼Œå…¶å®ƒLinuxç‰ˆæœ¬å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼Œéƒ½æ˜¯å¤§åŒå°å¼‚çš„</p>
</blockquote>
<ul>
<li>æ‹·è´ä¸‹é¢è„šæœ¬æ–‡ä»¶æŒ‰ç…§æç¤ºæ‰§è¡Œå³å¯</li>
</ul>
<pre><code class="hljs language-docker_install.sh" lang="docker_install.sh">#!/bin/bash

MIRROR_URL="" # é•œåƒæºURL

select_os() {
    echo "è¯·é€‰æ‹©æ“ä½œç³»ç»Ÿï¼š:"
    echo "1) debian"
    echo "2) ubuntu"
    echo "3) é€€å‡º"
    read -p "è¯·è¾“å…¥é€‰é¡¹ (1-3): " os_choice

    case $os_choice in
    1)
        os_choice="debian"
        ;;
    2)
        os_choice="ubuntu"
        ;;
    3)
        echo "é€€å‡º..."
        exit 0
        ;;
    *)
        echo "æ— æ•ˆé€‰é¡¹ï¼Œè¯·é‡æ–°è¿è¡Œè„šæœ¬å¹¶é€‰æ‹©æœ‰æ•ˆé€‰é¡¹."
        exit 1
        ;;
    esac
}

select_mirror_source() {
    echo "è¯·é€‰æ‹©å®‰è£…é•œåƒæº:"
    echo "1) é˜¿é‡Œäº‘"
    echo "2) åä¸ºäº‘"
    echo "3) æ¸…åé•œåƒ"
    echo "4) é€€å‡º"
    read -p "è¯·è¾“å…¥é€‰é¡¹ (1-4): " mirror_choice

    case $mirror_choice in
    1)
        echo "æ­£åœ¨é…ç½®é˜¿é‡Œäº‘é•œåƒæº..."
        MIRROR_URL="https://mirrors.aliyun.com/docker-ce/linux/${os_choice}"
        ;;
    2)
        echo "æ­£åœ¨é…ç½®åä¸ºäº‘é•œåƒæº..."
        MIRROR_URL="https://mirrors.huaweicloud.com/docker-ce/linux/${os_choice}"
        ;;
    3)
        echo "æ­£åœ¨é…ç½®æ¸…åé•œåƒæº..."
        MIRROR_URL="https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/${os_choice}"
        ;;
    4)
        echo "é€€å‡º..."
        exit 0
        ;;
    *)
        echo "æ— æ•ˆé€‰é¡¹ï¼Œè¯·é‡æ–°è¿è¡Œè„šæœ¬å¹¶é€‰æ‹©æœ‰æ•ˆé€‰é¡¹."
        exit 1
        ;;
    esac
}

install_docker_ce() {
    echo "Docker CEå¼€å§‹å®‰è£…..."
    sudo apt-get update
    sudo apt-get install -y \
        ca-certificates \
        curl \
        gnupg \
        lsb-release

    echo "æ·»åŠ Dockerçš„å®˜æ–¹GPGå¯†é’¥..."
    sudo install -m 0755 -d /etc/apt/keyrings
    curl -fsSL "${MIRROR_URL}/gpg" | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
    sudo chmod a+r /etc/apt/keyrings/docker.gpg

    echo \
        "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] $MIRROR_URL $(lsb_release -cs) stable" | \
        sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null

    sudo apt-get update
    sudo apt-get install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

    echo "Docker CE å®‰è£…å®Œæˆ."
}

# ä¸»ç¨‹åº
main() {
    # é€‰æ‹©æ“ä½œç³»ç»Ÿ
    select_os

    # é€‰æ‹©é•œåƒæº
    select_mirror_source

    # å®‰è£…Docker CE
    install_docker_ce

    echo ""
    echo "è„šæœ¬æ‰§è¡Œå®Œæˆï¼"
}

# æ‰§è¡Œä¸»å‡½æ•°
main "$@"
</code></pre>
<ul>
<li>é»˜è®¤æƒ…å†µä¸‹ï¼Œdockeråªå…è®¸åœ¨rootç”¨æˆ·ä¸‹ä½¿ç”¨ï¼Œå¦‚æœæƒ³è¦å…¶å®ƒç”¨æˆ·ä½¿ç”¨dockerï¼Œéœ€è¦å°†ç”¨æˆ·æ·»åŠ åˆ°dockerç”¨æˆ·ç»„</li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åˆ›å»ºdockerç”¨æˆ·ç»„</span>
sudo groupadd docker
<span class="hljs-comment"># æ·»åŠ å½“å‰ç”¨æˆ·åˆ°dockerç”¨æˆ·ç»„</span>
sudo usermod -aG docker <span class="hljs-variable">$USER</span>
</code></pre>
<ul>
<li>å®‰è£…æ ¡éªŒ</li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># èƒ½æ­£å¸¸è¾“å‡ºdockerç‰ˆæœ¬å·å°±è¯´æ˜å®‰è£…æˆåŠŸäº†</span>
docker version
</code></pre>
<h2 data-id="heading-2">å¸¸ç”¨Dockerå‘½ä»¤</h2>
<h3 data-id="heading-3">é•œåƒç›¸å…³</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># æŸ¥çœ‹æœ¬åœ°é•œåƒdocker images# æœç´¢é•œåƒ</span>
docker search <span class="hljs-section">[image]</span>

<span class="hljs-comment"># ä¸‹è½½é•œåƒ</span>
docker pull <span class="hljs-section">[image]</span>

<span class="hljs-comment"># åˆ é™¤é•œåƒ</span>
docker rmi <span class="hljs-section">[image]</span>
</code></pre>
<ul>
<li>é•œåƒå¯¼å…¥åˆ°æ–‡ä»¶ï¼Œæˆ–ä»æ–‡ä»¶å¯¼å…¥åˆ°é•œåƒ</li>
</ul>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># dockerå¯¼å‡ºé•œåƒåˆ°æ–‡ä»¶</span>
docker save <span class="hljs-section">[OPTIONS]</span> IMAGE <span class="hljs-section">[IMAGE...]</span>
<span class="hljs-comment"># ä¾‹å¦‚</span>
docker save -o mysql-8.tar mysql:8.0

<span class="hljs-comment"># dockerå¯¼å…¥æ–‡ä»¶åˆ°é•œåƒ</span>
docker load <span class="hljs-section">[OPTIONS]</span>
<span class="hljs-comment"># ä¾‹å¦‚</span>
docker load -i mysql-8.tar
</code></pre>
<h3 data-id="heading-4">å®¹å™¨ç›¸å…³</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># dockeræŸ¥çœ‹æ‰€æœ‰è¿è¡Œçš„å®¹å™¨docker ps [-a]    # -a  -&gt; æŸ¥çœ‹æ‰€æœ‰å®¹å™¨ï¼ŒåŒ…æ‹¬æœªè¿è¡Œçš„# æ–°å»ºå¹¶è¿è¡Œå®¹å™¨ï¼ˆå®¹å™¨å¦‚æœå·²ç»å­˜åœ¨ï¼Œåˆ™ä½¿ç”¨ docker start å‘½ä»¤å¯åŠ¨ï¼‰</span>
docker run [options] [image]
    <span class="hljs-comment"># options å¸¸ç”¨å¯åŠ¨é€‰é¡¹:</span>
    <span class="hljs-comment"># -d   -&gt; åå°è¿è¡Œ</span>
    <span class="hljs-comment"># -p å®¿ä¸»IP:å®¹å™¨IP  -&gt; å°†å®¹å™¨IPæ˜ å°„åˆ°å®¿ä¸»IP</span>
    <span class="hljs-comment"># -v å®¿ä¸»file/path:å®¹å™¨file/path    -&gt; å°†å®¹å™¨çš„file/pathæŒ‚è½½åˆ°å®¿ä¸»çš„file/path</span>
    <span class="hljs-comment"># --name [name]     -&gt; ä¸ºå®¹å™¨å‘½å</span>
    <span class="hljs-comment"># --restart always  -&gt; è®¾ç½®å®¹å™¨éšdockerä¸€èµ·è‡ªåŠ¨å¯åŠ¨</span>

<span class="hljs-comment"># åˆ é™¤å®¹å™¨</span>
docker <span class="hljs-built_in">rm</span> [containID/containName] [options]
    <span class="hljs-comment"># options å¸¸ç”¨é€‰é¡¹ï¼š</span>
    <span class="hljs-comment"># -f    -&gt;  å¼ºåˆ¶åˆ é™¤å®¹å™¨</span>
<span class="hljs-comment"># å¯åŠ¨å®¹å™¨/åœæ­¢å®¹å™¨/é‡å¯å®¹å™¨docker start/stop/restart [containID/containName]</span>

<span class="hljs-comment"># è¿›å…¥å®¹å™¨</span>
docker <span class="hljs-built_in">exec</span> -it [containID/containName] bash
æˆ–
docker <span class="hljs-built_in">exec</span> -it [containID/containName] /bin/bash(å¦‚æœå®¹å™¨æ˜¯åŸºäºalpine é•œåƒçš„ æœ€åçš„ /bin/bash éœ€è¦æ¢æˆ /bin/sh )

<span class="hljs-comment"># æ‰§è¡Œå®¹å™¨çš„å‘½ä»¤</span>
docker <span class="hljs-built_in">exec</span> -it [containID/containName] [commond]
<span class="hljs-comment"># ç¤ºä¾‹ï¼Œæ‰§è¡Œ redis-test å®¹å™¨çš„ redis-cli å‘½ä»¤</span>
docker <span class="hljs-built_in">exec</span> -it redis-test redis-cli -a <span class="hljs-string">"123456"</span>
<span class="hljs-comment"># è¯´æ˜: è¿™å¥è¯æ‰§è¡Œäº† redis-testå®¹å™¨çš„ redis-cli å‘½ä»¤ï¼Œ-a å‘½ä»¤çš„ä½œç”¨æ˜¯è¾“å…¥å¯†ç </span>
</code></pre>
<h4 data-id="heading-5">æŸ¥çœ‹å®¹å™¨å¯åŠ¨æ—¥å¿—</h4>
<pre><code class="hljs language-css" lang="css">docker logs -f -t <span class="hljs-attr">--tail</span>=<span class="hljs-number">100</span> <span class="hljs-selector-attr">[å®¹å™¨]</span>
</code></pre>
<ul>
<li>å‚æ•°è¯´æ˜
<ul>
<li>-fï¼šæŸ¥çœ‹å®æ—¶æ—¥å¿—</li>
<li>-tï¼šæŸ¥çœ‹æ—¥å¿—äº§ç”Ÿçš„æ—¶é—´</li>
<li>-tail=100ï¼šæŸ¥çœ‹æœ€åçš„100æ¡æ—¥å¿—</li>
<li>[å®¹å™¨]ï¼šå®¹å™¨åç§°</li>
</ul>
</li>
</ul>
<h4 data-id="heading-6">å®¹å™¨å¯¼å…¥åˆ°æ–‡ä»¶ï¼Œæˆ–ä»æ–‡ä»¶å¯¼å…¥åˆ°å®¹å™¨</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># dockerå¯¼å‡ºå®¹å™¨åˆ°æ–‡ä»¶</span>
docker export <span class="hljs-section">[OPTIONS]</span> CONTAINER
<span class="hljs-comment"># ä¾‹å¦‚</span>
docker export -o mysql-8.tar mysql-demo

<span class="hljs-comment"># dockerå¯¼å…¥å®¹å™¨ç”Ÿæˆçš„æ–‡ä»¶åˆ°é•œåƒ</span>
docker import <span class="hljs-section">[OPTIONS]</span> file|URL|- <span class="hljs-section">[REPOSITORY[:TAG]]</span>
<span class="hljs-comment"># ä¾‹å¦‚</span>
docker import mysql-8.tar mysql:8.0
</code></pre>
<h4 data-id="heading-7">æŸ¥çœ‹å®¹å™¨å¯åŠ¨å‚æ•°</h4>
<blockquote>
<p>éœ€è¦å®‰è£…runlike,æ‰§è¡Œ<code>pip3 install runlike</code>å³å¯</p>
</blockquote>
<pre><code class="hljs language-xml" lang="xml">runlike -p <span class="hljs-tag">&lt;<span class="hljs-name">å®¹å™¨å</span>&gt;</span>|<span class="hljs-tag">&lt;<span class="hljs-name">å®¹å™¨ID</span>&gt;</span>
</code></pre>
<h3 data-id="heading-8">ä¿®æ”¹å®¹å™¨å¯åŠ¨å‚æ•°</h3>
<pre><code class="hljs language-ini" lang="ini">docker update <span class="hljs-section">[OPTIONS]</span> <span class="hljs-section">[CONTAINER...]</span>

<span class="hljs-comment"># ä¾‹å¦‚</span>
docker update <span class="hljs-attr">--restart</span>=always eureka-server
</code></pre>
<h3 data-id="heading-9">å®¹å™¨å’Œå®¿ä¸»æœºæ–‡ä»¶ä¼ è¾“ç›¸å…³</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># ä» ä¸»æœº æ‹·è´åˆ° docker å®¹å™¨</span>
docker cp <span class="hljs-section">[ä¸»æœºæ–‡ä»¶]</span> <span class="hljs-section">[å®¹å™¨]</span>:<span class="hljs-section">[å®¹å™¨è·¯å¾„]</span>

<span class="hljs-comment"># ä» dockerå®¹å™¨ æ‹·è´åˆ° ä¸»æœº</span>
docker cp <span class="hljs-section">[å®¹å™¨]</span>:<span class="hljs-section">[å®¹å™¨è·¯å¾„]</span> <span class="hljs-section">[ä¸»æœºæ–‡ä»¶]</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Windows è¿è¡Œ agent-browser å¤±è´¥çš„æ ¹å› ä¸ä¿®å¤]]></title>    <link>https://juejin.cn/post/7598699872540311571</link>    <guid>https://juejin.cn/post/7598699872540311571</guid>    <pubDate>2026-01-24T05:57:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598699872540311571" data-draft-id="7598587406695006251" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Windows è¿è¡Œ agent-browser å¤±è´¥çš„æ ¹å› ä¸ä¿®å¤"/> <meta itemprop="keywords" content="åç«¯,å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-24T05:57:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç«è½¦å¼ä½"/> <meta itemprop="url" content="https://juejin.cn/user/1345457960792808"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Windows è¿è¡Œ agent-browser å¤±è´¥çš„æ ¹å› ä¸ä¿®å¤
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1345457960792808/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç«è½¦å¼ä½
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T05:57:42.000Z" title="Sat Jan 24 2026 05:57:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ Windows CMD ä¸­æ‰§è¡Œ <code>agent-browser.cmd install</code> æŠ¥ â€œThe system cannot find the path specified.â€</p>
<h2 data-id="heading-0">ç°è±¡</h2>
<ul>
<li>CMD å¯æ‰¾åˆ° <code>agent-browser.cmd</code>ï¼Œä½†æ‰§è¡Œå³å¤±è´¥</li>
<li>PowerShell ä¹Ÿä¼šå¤ç°ç›¸åŒé”™è¯¯</li>
</ul>
<h2 data-id="heading-1">æ ¹å› </h2>
<p>Volta ç”Ÿæˆçš„ <code>agent-browser.cmd</code> å¯åŠ¨è„šæœ¬ä¼šå…ˆå¯»æ‰¾åŒ…å†… <code>bin/sh.exe</code>ï¼Œæ‰¾ä¸åˆ°åå›é€€åˆ° <code>/bin/sh</code>ã€‚Windows CMD é»˜è®¤æ²¡æœ‰ <code>sh</code>ï¼Œå› æ­¤ç›´æ¥å¤±è´¥ã€‚</p>
<h2 data-id="heading-2">ä¿®å¤æ–¹æ¡ˆ</h2>
<p>ç›´æ¥è°ƒç”¨åŒ…å†… Windows å¯æ‰§è¡Œæ–‡ä»¶ï¼Œç»•è¿‡ <code>sh</code> ä¾èµ–ã€‚</p>
<p>ä¿®æ”¹æ–‡ä»¶ï¼š<code>C:\Users\Administrator\AppData\Local\Volta\tools\image\packages\agent-browser\agent-browser.cmd</code></p>
<blockquote>
<p>ä¸åŒç”µè„‘ä½ç½®ä¸ç›¸åŒ, æ‰¾åˆ°å„è‡ªå¯¹åº”çš„æ–‡ä»¶</p>
</blockquote>
<pre><code class="hljs language-bat" lang="bat">SET "BIN=%dp0%node_modules\agent-browser\bin\agent-browser-win32-x64.exe"
IF NOT EXIST "%BIN%" (
  echo agent-browser win32 binary not found: "%BIN%"
  exit /b 1
)

endLocal &amp; goto #_undefined_# 2&gt;NUL || title %COMSPEC% &amp; "%BIN%" %*
</code></pre>
<h2 data-id="heading-3">éªŒè¯</h2>
<pre><code class="hljs language-bat" lang="bat">agent-browser.cmd --help
</code></pre>
<h2 data-id="heading-4">å½±å“èŒƒå›´</h2>
<ul>
<li>ä»…å½±å“ Windows CMD/PowerShell å¯åŠ¨è·¯å¾„</li>
<li>ä¸å½±å“ Git Bash ç­‰æä¾› <code>sh</code> çš„ç¯å¢ƒ</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>