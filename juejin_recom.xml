<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[Laravel学习-01预备阶段-02 Composer]]></title>    <link>https://juejin.cn/post/7578029371006500904</link>    <guid>https://juejin.cn/post/7578029371006500904</guid>    <pubDate>2025-11-30T13:30:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578029371006500904" data-draft-id="7577690150094290984" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Laravel学习-01预备阶段-02 Composer"/> <meta itemprop="keywords" content="Laravel"/> <meta itemprop="datePublished" content="2025-11-30T13:30:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="luminaryhero"/> <meta itemprop="url" content="https://juejin.cn/user/1382510296573468"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Laravel学习-01预备阶段-02 Composer
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1382510296573468/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    luminaryhero
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T13:30:28.000Z" title="Sun Nov 30 2025 13:30:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Laravel学习-01预备阶段-02 Composer</h2>
<p>在上一篇《Laravel学习-01预备阶段-01 PHP 基础》中，我们回顾了 Laravel 开发所需的 PHP 核心语法。本篇聚焦于现代 PHP 开发的基石工具 —— <strong>Composer</strong>，并简要说明它在 Laravel 项目中的核心作用。掌握 Composer，是高效使用 Laravel 的第一步。</p>
<hr/>
<h3 data-id="heading-1">1. 什么是 Composer？</h3>
<p><strong>Composer</strong> 是 PHP 的依赖管理工具。它允许你声明项目所依赖的第三方库（包），并自动完成下载、安装、更新和自动加载。</p>
<p>Laravel 本身及其绝大多数功能模块（如数据库、队列、缓存、邮件等）都是通过 Composer 管理的。没有 Composer，就无法使用 Laravel 的生态。</p>
<hr/>
<h3 data-id="heading-2">2. 安装 Composer</h3>
<h4 data-id="heading-3">macOS / Linux</h4>
<pre><code class="hljs language-bash" lang="bash">curl -sS https://getcomposer.org/installer | php
sudo <span class="hljs-built_in">mv</span> composer.phar /usr/local/bin/composer
</code></pre>
<h4 data-id="heading-4">Windows</h4>
<p>前往 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgetcomposer.org%2Fdownload%2F" target="_blank" title="https://getcomposer.org/download/" ref="nofollow noopener noreferrer">getcomposer.org/download/</a> 下载 <code>Composer-Setup.exe</code>，按向导安装。</p>
<blockquote>
<p>安装完成后，在终端执行：</p>
<pre><code class="hljs language-bash" lang="bash">composer -V
</code></pre>
<p>若显示类似 <code>Composer version 2.x.x</code>，说明安装成功。</p>
</blockquote>
<hr/>
<h3 data-id="heading-5">3. 配置国内镜像（推荐）</h3>
<p>由于网络原因，官方源（<code>packagist.org</code>）在国内访问较慢。建议切换为国内镜像：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 配置阿里云镜像（全局生效）</span>
composer config -g repo.packagist composer https://mirrors.aliyun.com/composer/
</code></pre>
<blockquote>
<p>使用 <code>-g</code> 表示全局配置，对所有项目生效。如需恢复官方源，执行：</p>
<pre><code class="hljs language-bash" lang="bash">composer config -g --<span class="hljs-built_in">unset</span> repos.packagist
</code></pre>
</blockquote>
<hr/>
<h3 data-id="heading-6">4. Composer 的核心概念</h3>
<h4 data-id="heading-7">4.1 <code>composer.json</code></h4>
<p>这是项目的“依赖清单”，定义了：</p>
<ul>
<li>项目名称、描述</li>
<li>依赖的包（<code>require</code>）</li>
<li>开发依赖（<code>require-dev</code>）</li>
<li>自动加载规则（<code>autoload</code>）</li>
</ul>
<p>示例：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"laravel/laravel"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"project"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"require"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"php"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^8.2"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"laravel/framework"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^11.0"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"autoload"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"psr-4"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"App\\"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"app/"</span>
        <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-8">4.2 <code>vendor/</code> 目录</h4>
<p>运行 <code>composer install</code> 后，所有依赖包会被下载到 <code>vendor/</code> 目录。<strong>不要手动修改此目录内容</strong>。</p>
<h4 data-id="heading-9">4.3 <code>composer.lock</code></h4>
<p>锁定当前安装的<strong>确切版本号</strong>，确保团队成员或生产环境使用完全一致的依赖。应提交到 Git。</p>
<hr/>
<h3 data-id="heading-10">5. 常用命令</h3>





























<table><thead><tr><th>命令</th><th>说明</th></tr></thead><tbody><tr><td><code>composer install</code></td><td>根据 <code>composer.lock</code>（或 <code>composer.json</code>）安装依赖</td></tr><tr><td><code>composer update</code></td><td>更新依赖到最新允许版本（会更新 <code>composer.lock</code>）</td></tr><tr><td><code>composer require monolog/monolog</code></td><td>安装依赖，并更新 <code>composer.json</code></td></tr><tr><td><code>composer require --dev phpunit/phpunit</code></td><td>安装开发依赖</td></tr><tr><td><code>composer dump-autoload</code></td><td>重新生成自动加载文件（如新增类后需执行）</td></tr></tbody></table>
<blockquote>
<p>Laravel 项目中，通常只需运行一次 <code>composer install</code> 即可完成依赖安装。</p>
</blockquote>
<hr/>
<h3 data-id="heading-11">6. Composer 与 Laravel 的关系</h3>
<ul>
<li>
<p><strong>创建项目</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">composer create-project laravel/laravel myapp
</code></pre>
<p>实际是下载 <code>laravel/laravel</code> 包并安装其所有依赖。</p>
</li>
<li>
<p><strong>扩展功能</strong>：<br/>
安装如 <code>laravel/sanctum</code>（API 认证）、<code>spatie/laravel-permission</code>（权限管理）等，均通过 <code>composer require</code> 完成。</p>
</li>
<li>
<p><strong>自动加载</strong>：<br/>
Composer 根据 <code>psr-4</code> 规则自动生成 <code>vendor/autoload.php</code>，Laravel 入口文件 <code>public/index.php</code> 会引入它，从而无需手动 <code>require</code> 类文件。</p>
</li>
</ul>
<hr/>
<h3 data-id="heading-12">7. 验证 Composer 是否正常工作</h3>
<p>新建一个测试目录，执行：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> test-composer &amp;&amp; <span class="hljs-built_in">cd</span> test-composer
composer require monolog/monolog
</code></pre>
<p>若成功下载 <code>monolog</code> 并生成 <code>vendor/</code> 目录，说明 Composer 已配置正确。</p>
<hr/>
<h3 data-id="heading-13">小结</h3>
<p>Composer 是 Laravel 乃至现代 PHP 开发不可或缺的工具。它解决了依赖管理、版本控制和自动加载三大核心问题。理解 <code>composer.json</code>、<code>vendor/</code> 和常用命令，将为你后续学习 Laravel 扫清障碍。</p>
<blockquote>
<p><strong>注意</strong>：在 Laravel 项目中，所有第三方包都应通过 Composer 安装，切勿手动复制代码！</p>
</blockquote>
<hr/>
<p><strong>系列预告</strong>：<br/>
《Laravel学习-01预备阶段-03 Web基础》</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java 构造方法]]></title>    <link>https://juejin.cn/post/7578113711362342955</link>    <guid>https://juejin.cn/post/7578113711362342955</guid>    <pubDate>2025-11-30T13:51:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578113711362342955" data-draft-id="7578037997323665427" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java 构造方法"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-11-30T13:51:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="花开花富贵"/> <meta itemprop="url" content="https://juejin.cn/user/3220933005549171"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java 构造方法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3220933005549171/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    花开花富贵
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T13:51:08.000Z" title="Sun Nov 30 2025 13:51:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 Java 编程中，我们经常需要创建对象并对其进行初始化。构造方法（Constructor）就是专门负责对象初始化的特殊方法。</p>
<h2 data-id="heading-0">什么是构造方法？</h2>
<p>构造方法是一种特殊的方法，它在创建对象时被自动调用，主要用于初始化对象的成员变量。来看一个简单的例子：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/*
 * 构造方法：
 *   （1）构造方法的方法名必须和类名一样
 *   （2）构造方法没得返回值，就不能用return返回任何东西，如果要返回，只能返回空
 *  （3）在实例化对象时，构造方法会被自动调用
 *
 * */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo02</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
<span class="hljs-comment">/*        Animal animal = new Animal("xiaobai", 19);
        System.out.println(animal.getName());
        System.out.println(animal.getAge());*/</span>

        <span class="hljs-type">Animal</span> <span class="hljs-variable">ani01</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        ani01 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Animal</span>(<span class="hljs-string">"xiaobai"</span>, <span class="hljs-number">19</span>);
        <span class="hljs-type">Animal</span> <span class="hljs-variable">ani02</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Animal</span>(<span class="hljs-string">"xiaohei"</span>, <span class="hljs-number">19</span>);
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span> {
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Animal</span><span class="hljs-params">(String n, <span class="hljs-type">int</span> a)</span> {
        System.out.println(<span class="hljs-string">"构造方法被调用"</span>);
        name = n;
        age = a;
    }


    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String n)</span> {
        name = n;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> a)</span> {
        age = a;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">say</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"name = "</span> + name + <span class="hljs-string">"; age = "</span> + age);
    }
}
</code></pre>
<h2 data-id="heading-1">注意事项</h2>
<ol>
<li><strong>访问修饰符</strong>：构造方法可以有访问修饰符（public、private、protected），用于控制对象的创建权限。</li>
<li><strong>不能被继承</strong>：构造方法不能被子类继承，但子类可以通过<code>super()</code>调用父类的构造方法。</li>
<li><strong>不能是 abstract、static、final 或 native</strong>：这些修饰符与构造方法的特性冲突。</li>
<li><strong>异常处理</strong>：构造方法可以抛出异常，也可以使用 try-catch 处理异常。</li>
</ol>
<h2 data-id="heading-2">总结</h2>
<p>构造方法是 Java 面向对象编程中的重要概念，掌握它对于编写健壮的代码至关重要：</p>
<ul>
<li>构造方法用于初始化对象，在使用<code>new</code>创建对象时自动调用</li>
<li>构造方法名称必须与类名相同，没有返回值类型声明</li>
<li>一个类可以有多个构造方法（重载），提供不同的初始化方式</li>
<li>使用<code>this()</code>可以在构造方法中调用其他构造方法，避免代码重复</li>
</ul>
<p>通过合理使用构造方法，我们可以确保对象在创建时就处于有效的状态，提高代码的可靠性和可维护性。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[[Java] JDK 15 新变化之文本块（Text Blocks）]]></title>    <link>https://juejin.cn/post/7577991167201181706</link>    <guid>https://juejin.cn/post/7577991167201181706</guid>    <pubDate>2025-11-30T13:51:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577991167201181706" data-draft-id="7577613021880614922" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="[Java] JDK 15 新变化之文本块（Text Blocks）"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2025-11-30T13:51:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="金銀銅鐵"/> <meta itemprop="url" content="https://juejin.cn/user/747323638159757"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            [Java] JDK 15 新变化之文本块（Text Blocks）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/747323638159757/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    金銀銅鐵
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T13:51:10.000Z" title="Sun Nov 30 2025 13:51:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body .octicon{display:inline-block;fill:currentColor;vertical-align:text-bottom}.markdown-body .anchor{float:left;line-height:1;margin-left:-20px;padding-right:4px}.markdown-body .anchor:focus{outline:none}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#1b1f23;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1:hover .anchor .octicon-link:before,.markdown-body h2:hover .anchor .octicon-link:before,.markdown-body h3:hover .anchor .octicon-link:before,.markdown-body h4:hover .anchor .octicon-link:before,.markdown-body h5:hover .anchor .octicon-link:before,.markdown-body h6:hover .anchor .octicon-link:before{width:16px;height:16px;content:" ";display:inline-block;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' aria-hidden='true'%3E%3Cpath fill-rule='evenodd' d='M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z'/%3E%3C/svg%3E")}.markdown-body{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;color:#24292e;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;font-size:16px;line-height:1.5;word-wrap:break-word}.markdown-body details{display:block}.markdown-body summary{display:list-item}.markdown-body a{background-color:initial}.markdown-body a:active,.markdown-body a:hover{outline-width:0}.markdown-body strong{font-weight:inherit;font-weight:bolder}.markdown-body h1{margin:.67em 0}.markdown-body img{border-style:none}.markdown-body code,.markdown-body kbd,.markdown-body pre{font-family:monospace,monospace;font-size:1em}.markdown-body hr{box-sizing:initial;overflow:visible}.markdown-body input{font:inherit;margin:0;overflow:visible}.markdown-body [type=checkbox]{box-sizing:border-box;padding:0}.markdown-body *{box-sizing:border-box}.markdown-body input{font-family:inherit;font-size:inherit;line-height:inherit}.markdown-body a{color:#0366d6;text-decoration:none}.markdown-body a:hover{text-decoration:underline}.markdown-body strong{font-weight:600}.markdown-body hr{height:0;margin:15px 0;overflow:hidden;background:transparent;border-bottom:1px solid #dfe2e5}.markdown-body hr:after,.markdown-body hr:before{display:table;content:""}.markdown-body hr:after{clear:both}.markdown-body table{border-spacing:0;border-collapse:collapse}.markdown-body td,.markdown-body th{padding:0}.markdown-body details summary{cursor:pointer}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:0;margin-bottom:0}.markdown-body h1{font-size:32px}.markdown-body h1,.markdown-body h2{font-weight:600}.markdown-body h2{font-size:24px}.markdown-body h3{font-size:20px}.markdown-body h3,.markdown-body h4{font-weight:600}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:14px}.markdown-body h5,.markdown-body h6{font-weight:600}.markdown-body h6{font-size:12px}.markdown-body p{margin-top:0;margin-bottom:10px}.markdown-body blockquote{margin:0}.markdown-body ol,.markdown-body ul{padding-left:0;margin-top:0;margin-bottom:0}.markdown-body ol ol,.markdown-body ul ol{list-style-type:lower-roman}.markdown-body ol ol ol,.markdown-body ol ul ol,.markdown-body ul ol ol,.markdown-body ul ul ol{list-style-type:lower-alpha}.markdown-body dd{margin-left:0}.markdown-body code,.markdown-body pre{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px}.markdown-body pre{margin-top:0;margin-bottom:0}.markdown-body input::-webkit-inner-spin-button,.markdown-body input::-webkit-outer-spin-button{margin:0;-webkit-appearance:none;appearance:none}.markdown-body :checked+.radio-label{position:relative;z-index:1;border-color:#0366d6}.markdown-body .border{border:1px solid #e1e4e8!important}.markdown-body .border-0{border:0!important}.markdown-body .border-bottom{border-bottom:1px solid #e1e4e8!important}.markdown-body .rounded-1{border-radius:3px!important}.markdown-body .bg-white{background-color:#fff!important}.markdown-body .bg-gray-light{background-color:#fafbfc!important}.markdown-body .text-gray-light{color:#6a737d!important}.markdown-body .pl-3,.markdown-body .px-3{padding-left:16px!important}.markdown-body .px-3{padding-right:16px!important}.markdown-body .f6{font-size:12px!important}.markdown-body .lh-condensed{line-height:1.25!important}.markdown-body .text-bold{font-weight:600!important}.markdown-body .pl-c{color:#6a737d}.markdown-body .pl-c1,.markdown-body .pl-s .pl-v{color:#005cc5}.markdown-body .pl-e,.markdown-body .pl-en{color:#6f42c1}.markdown-body .pl-s .pl-s1,.markdown-body .pl-smi{color:#24292e}.markdown-body .pl-ent{color:#22863a}.markdown-body .pl-k{color:#d73a49}.markdown-body .pl-pds,.markdown-body .pl-s,.markdown-body .pl-s .pl-pse .pl-s1,.markdown-body .pl-sr,.markdown-body .pl-sr .pl-cce,.markdown-body .pl-sr .pl-sra,.markdown-body .pl-sr .pl-sre{color:#032f62}.markdown-body .pl-smw,.markdown-body .pl-v{color:#e36209}.markdown-body .pl-bu{color:#b31d28}.markdown-body .pl-ii{color:#fafbfc;background-color:#b31d28}.markdown-body .pl-c2{color:#fafbfc;background-color:#d73a49}.markdown-body .pl-c2:before{content:"^M"}.markdown-body .pl-sr .pl-cce{font-weight:700;color:#22863a}.markdown-body .pl-ml{color:#735c0f}.markdown-body .pl-mh,.markdown-body .pl-mh .pl-en,.markdown-body .pl-ms{font-weight:700;color:#005cc5}.markdown-body .pl-mi{font-style:italic;color:#24292e}.markdown-body .pl-mb{font-weight:700;color:#24292e}.markdown-body .pl-md{color:#b31d28;background-color:#ffeef0}.markdown-body .pl-mi1{color:#22863a;background-color:#f0fff4}.markdown-body .pl-mc{color:#e36209;background-color:#ffebda}.markdown-body .pl-mi2{color:#f6f8fa;background-color:#005cc5}.markdown-body .pl-mdr{font-weight:700;color:#6f42c1}.markdown-body .pl-ba{color:#586069}.markdown-body .pl-sg{color:#959da5}.markdown-body .pl-corl{text-decoration:underline;color:#032f62}.markdown-body .mb-0{margin-bottom:0!important}.markdown-body .my-2{margin-bottom:8px!important;margin-top:8px!important}.markdown-body .pl-0{padding-left:0!important}.markdown-body .py-0{padding-top:0!important;padding-bottom:0!important}.markdown-body .pl-1{padding-left:4px!important}.markdown-body .pl-2{padding-left:8px!important}.markdown-body .py-2{padding-top:8px!important;padding-bottom:8px!important}.markdown-body .pl-3{padding-left:16px!important}.markdown-body .pl-4{padding-left:24px!important}.markdown-body .pl-5{padding-left:32px!important}.markdown-body .pl-6{padding-left:40px!important}.markdown-body .pl-7{padding-left:48px!important}.markdown-body .pl-8{padding-left:64px!important}.markdown-body .pl-9{padding-left:80px!important}.markdown-body .pl-10{padding-left:96px!important}.markdown-body .pl-11{padding-left:112px!important}.markdown-body .pl-12{padding-left:128px!important}.markdown-body hr{border-bottom-color:#eee}.markdown-body kbd{display:inline-block;padding:3px 5px;font:11px SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #d1d5da;border-radius:3px;box-shadow:inset 0 -1px 0 #d1d5da}.markdown-body:after,.markdown-body:before{display:table;content:""}.markdown-body:after{clear:both}.markdown-body&gt;:first-child{margin-top:0!important}.markdown-body&gt;:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body blockquote,.markdown-body details,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body hr{height:.25em;padding:0;margin:24px 0;background-color:#e1e4e8;border:0}.markdown-body blockquote{padding:0 1em;color:#6a737d;border-left:.25em solid #dfe2e5}.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eaecef}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{font-size:.85em;color:#6a737d}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li{word-wrap:break-all}.markdown-body li&gt;p{margin-top:16px}.markdown-body li+li{margin-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:600}.markdown-body dl dd{padding:0 16px;margin-bottom:16px}.markdown-body table{display:block;width:100%;overflow:auto}.markdown-body table th{font-weight:600}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid #dfe2e5}.markdown-body table tr{background-color:#fff;border-top:1px solid #c6cbd1}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}.markdown-body img{max-width:100%;box-sizing:initial;background-color:#fff}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body code{padding:.2em .4em;margin:0;font-size:85%;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body pre{word-wrap:normal}.markdown-body pre&gt;code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:transparent;border:0}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f6f8fa;border-radius:3px}.markdown-body pre code{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:initial;border:0}.markdown-body .commit-tease-sha{display:inline-block;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:90%;color:#444d56}.markdown-body .full-commit .btn-outline:not(:disabled):hover{color:#005cc5;border-color:#005cc5}.markdown-body .blob-wrapper{overflow-x:auto;overflow-y:hidden}.markdown-body .blob-wrapper-embedded{max-height:240px;overflow-y:auto}.markdown-body .blob-num{width:1%;min-width:50px;padding-right:10px;padding-left:10px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;line-height:20px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;vertical-align:top;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-body .blob-num:hover{color:rgba(27,31,35,.6)}.markdown-body .blob-num:before{content:attr(data-line-number)}.markdown-body .blob-code{position:relative;padding-right:10px;padding-left:10px;line-height:20px;vertical-align:top}.markdown-body .blob-code-inner{overflow:visible;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;color:#24292e;word-wrap:normal;white-space:pre}.markdown-body .pl-token.active,.markdown-body .pl-token:hover{cursor:pointer;background:#ffea7f}.markdown-body .tab-size[data-tab-size="1"]{-moz-tab-size:1;tab-size:1}.markdown-body .tab-size[data-tab-size="2"]{-moz-tab-size:2;tab-size:2}.markdown-body .tab-size[data-tab-size="3"]{-moz-tab-size:3;tab-size:3}.markdown-body .tab-size[data-tab-size="4"]{-moz-tab-size:4;tab-size:4}.markdown-body .tab-size[data-tab-size="5"]{-moz-tab-size:5;tab-size:5}.markdown-body .tab-size[data-tab-size="6"]{-moz-tab-size:6;tab-size:6}.markdown-body .tab-size[data-tab-size="7"]{-moz-tab-size:7;tab-size:7}.markdown-body .tab-size[data-tab-size="8"]{-moz-tab-size:8;tab-size:8}.markdown-body .tab-size[data-tab-size="9"]{-moz-tab-size:9;tab-size:9}.markdown-body .tab-size[data-tab-size="10"]{-moz-tab-size:10;tab-size:10}.markdown-body .tab-size[data-tab-size="11"]{-moz-tab-size:11;tab-size:11}.markdown-body .tab-size[data-tab-size="12"]{-moz-tab-size:12;tab-size:12}.markdown-body .task-list-item{list-style-type:none}.markdown-body .task-list-item+.task-list-item{margin-top:3px}.markdown-body .task-list-item input{margin:0 .2em .25em -1.6em;vertical-align:middle}</style><style data-highlight="" data-highlight-key="an-old-hope">.hljs-comment,.hljs-quote{color:#b6b18b}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#eb3c54}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#e7ce56}.hljs-attribute{color:#ee7c2b}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#4fb4d7}.hljs-section,.hljs-title{color:#78bb65}.hljs-keyword,.hljs-selector-tag{color:#b45ea4}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#1c1d21;color:#c0c5ce}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><code>JDK 15</code> 新变化之文本块（<code>Text Blocks</code>）</h2>
<h3 data-id="heading-1">背景</h3>
<p><code>JDK 15</code> 正式支持文本块（<code>Text Blocks</code>），<a href="https://link.juejin.cn?target=https%3A%2F%2Fopenjdk.org%2Fjeps%2F378" target="_blank" title="https://openjdk.org/jeps/378" ref="nofollow noopener noreferrer">JEP 378: Text Blocks</a> 一文中有详细的描述，本文会对文本块（<code>Text Blocks</code>）中的缩进、转义字符等处理细节进行探讨。</p>
<h3 data-id="heading-2">要点</h3>
<h4 data-id="heading-3">文本块（<code>Text Blocks</code>）对格式有要求</h4>
<p>文本块（<code>Text Blocks</code>）的格式有特殊之处，例如在三个双引号开启文本块的那一行，文本块中不能有非 <code>white space</code> 字符 ⬇️</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/34ba752d4be045ec82162563e3bf2d5c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6YqA6YqF6ZC1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765116058&amp;x-signature=5PV5aeL%2BWZusVJit%2FjA8aE0zsoE%3D" alt="image.png" width="70%" loading="lazy"/>
<h4 data-id="heading-4"><code>Java</code> 编译器会移除文本块的内容中的次要 <code>white space</code></h4>
<p><code>Java</code> 编译器会使用 <code>re-indentation</code> 算法对文本块的内容中的次要 <code>white space</code> 进行处理。以下图为例，代码中的第 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn></mrow><annotation encoding="application/x-tex">4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">4</span></span></span></span></span> 行和第 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>5</mn></mrow><annotation encoding="application/x-tex">5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">5</span></span></span></span></span> 行中都有 <code>white space</code>（图中展示为 <code>.</code>），但是在输出中，这些 <code>white space</code> 都消失了，这是因为 <code>Java</code> 编译器移除了文本块中的次要 <code>white space</code>。</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1477db3cab3d4b7d941a2300911a10e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6YqA6YqF6ZC1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765116058&amp;x-signature=z5oNq3DZdW%2B2BZqoqIf1T0GMt10%3D" alt="image.png" width="70%" loading="lazy"/>
<h4 data-id="heading-5">文本块中可以使用转义序列</h4>
<p>文本块中除了支持 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.oracle.com%2Fjavase%2Fspecs%2Fjls%2Fse14%2Fhtml%2Fjls-3.html%23jls-3.10.6" target="_blank" title="https://docs.oracle.com/javase/specs/jls/se14/html/jls-3.html#jls-3.10.6" ref="nofollow noopener noreferrer"><code>The Java Language Specification</code> 的 <code>3.10.6</code> 小节</a> 里列举的转义序列外，还新增了对下列 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">2</span></span></span></span></span> 个转义序列的支持。</p>
<ol>
<li> <code>\&lt;line-terminator&gt;</code></li>
<li> <code>\s</code> 它会转换成一个空格(<code>U+0020</code>)</li>
</ol>
<p>我画了张思维导图 ⬇️</p>
<pre><code class="hljs language-mermaid" lang="mermaid">mindmap
      Root(文本块（Text Block）)
          格式的要求
          处理步骤
            step1(第1步: &lt;br/&gt;line terminator 转化为 U+000A 字符)
            step2(第2步: &lt;br/&gt;移除次要 white space)
              algorithm(使用 re-indentation 算法)
              好处：&lt;br/&gt;用户使用或改用文本块特性时，不容易出错
            step3(第3步: &lt;br/&gt;对转义序列的处理)
              old(对 \n \t \' 等原有转义序列的支持)
              new(对两个新的转义序列的支持)
</code></pre>
<h3 data-id="heading-6">正文</h3>
<p><code>JDK 15</code> 正式支持文本块（<code>Text Blocks</code>），<a href="https://link.juejin.cn?target=https%3A%2F%2Fopenjdk.org%2Fjeps%2F378" target="_blank" title="https://openjdk.org/jeps/378" ref="nofollow noopener noreferrer">JEP 378: Text Blocks</a> 一文中有详细的描述，有兴趣的读者可以读一读。于是，原先这样的代码 ⬇️</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">html</span> <span class="hljs-operator">=</span> <span class="hljs-string">"&lt;html&gt;\n"</span> +
              <span class="hljs-string">"    &lt;body&gt;\n"</span> +
              <span class="hljs-string">"        &lt;p&gt;Hello, world&lt;/p&gt;\n"</span> +
              <span class="hljs-string">"    &lt;/body&gt;\n"</span> +
              <span class="hljs-string">"&lt;/html&gt;\n"</span>;
</code></pre>
<p>如果改用文本块，可以变为这样 ⬇️</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">html</span> <span class="hljs-operator">=</span> <span class="hljs-string">"""
              &lt;html&gt;
                  &lt;body&gt;
                      &lt;p&gt;Hello, world&lt;/p&gt;
                  &lt;/body&gt;
              &lt;/html&gt;
              """</span>;
</code></pre>
<p>在此基础上，我们可以写出如下的代码 ⬇️</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span> {
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">html</span> <span class="hljs-operator">=</span> <span class="hljs-string">"""
              &lt;html&gt;
                  &lt;body&gt;
                      &lt;p&gt;Hello, world&lt;/p&gt;
                  &lt;/body&gt;
              &lt;/html&gt;
              """</span>;
     System.out.println(html);
  }
}
</code></pre>
<p>请将以上代码保存为 <code>A.java</code>。用如下的命令可以编译 <code>A.java</code> 并运行其中的 <code>main</code> 方法。</p>
<pre><code class="hljs language-bash" lang="bash">javac A.java
java A
</code></pre>
<p>运行结果如下 ⬇️</p>
<pre><code class="hljs language-text" lang="text">&lt;html&gt;
    &lt;body&gt;
        &lt;p&gt;Hello, world&lt;/p&gt;
    &lt;/body&gt;
&lt;/html&gt;

</code></pre>
<p>从运行结果来看，源码中的一些空格(<code>U+0020</code>)消失了（这些空格的具体位置如下图红框所示）</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/53fee2a24e5541459fd6bcd439dc865a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6YqA6YqF6ZC1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765116058&amp;x-signature=RnljkmT%2BXs2G%2Ba%2BQsvAQr5dBb3Y%3D" alt="image.png" loading="lazy"/></p>
<p>这其中的处理细节是怎样的呢？不难联想到以下问题</p>
<ol>
<li>只有空格(<code>U+0020</code>)会被特殊处理吗，是否还有其他字符也会被特殊处理？</li>
<li>只有行首的空格(<code>U+0020</code>)会被特殊处理吗，行尾的空格(<code>U+0020</code>)会被特殊处理吗？</li>
<li>移除的空格(<code>U+0020</code>)的数量是如何计算的？</li>
</ol>
<p>这些问题在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fopenjdk.org%2Fjeps%2F378" target="_blank" title="https://openjdk.org/jeps/378" ref="nofollow noopener noreferrer">JEP 378: Text Blocks</a> 一文中都可以找到答案。</p>
<h4 data-id="heading-7">文本块(<code>Text Blocks</code>)的范围</h4>
<p>在讨论其他问题之前，我们先来明确一下文本块（<code>Text Blocks</code>）的范围。在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fopenjdk.org%2Fjeps%2F378" target="_blank" title="https://openjdk.org/jeps/378" ref="nofollow noopener noreferrer">JEP 378: Text Blocks</a> 一文的 <code>Description</code> 小节里，有如下的描述，我们着重看一下红框里的部分。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f2de5e86c0ac460ca7c5a8c97d79eb10~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6YqA6YqF6ZC1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765116058&amp;x-signature=C%2B%2B6QXJZYD5HtxFIaWFJK0jy4Fo%3D" alt="image.png" loading="lazy"/></p>
<p>我将红框里的内容翻译如下 ⬇️</p>
<blockquote>
<p>一个文本块(<code>Text Blocks</code>)由 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span> 个或者更多个字符组成，它被 <code>opending delimiter</code> 和 <code>closing delimiter</code> 所包围。</p>
</blockquote>
<blockquote>
<p><code>opending delimiter</code> 由以下三部分组成</p>
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">3</span></span></span></span></span> 个连续的双引号字符(即，<code>"""</code>)</li>
<li>紧随其后的 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span> 个或者更多个 <code>white space</code></li>
<li>紧随其后的 <code>line terminator</code></li>
</ul>
</blockquote>
<blockquote>
<p>文本块的内容开始于 <code>opending delimiter</code> 里的 <code>line terminator</code> 之后的第一个字符。
<code>closing delimiter</code> 是 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">3</span></span></span></span></span> 个连续的双引号字符(即，<code>"""</code>)。文本块的内容结束于 <code>closing delimiter</code> 里第一个双引号字符之前的最后一个字符。</p>
</blockquote>
<p>这样说有点抽象，我来举个具体的例子 ⬇️</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">html</span> <span class="hljs-operator">=</span> <span class="hljs-string">"""      
                something
                """</span>;
        System.out.println(html);
    }
}
</code></pre>
<p>上面这段代码里有些特殊的字符，我通过 <code>vim</code> 打开这段代码后，截了张图，效果如下 ⬇️
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/44a1bcaaccce49fdaf84e4181db917cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6YqA6YqF6ZC1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765116058&amp;x-signature=dkpy64bE3LUdipRrvOv0FR65OmE%3D" alt="image.png" loading="lazy"/>
第 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">3</span></span></span></span></span> 行的红框里是 <code>opening delimiter</code>。请注意，它除了包含 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">3</span></span></span></span></span> 个双引号字符外，还包含了</p>
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span> 个 <code>tab</code> 字符(<code>U+0009</code>，图中展示成 <code>^I</code>）</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span> 个 空格字符(<code>U+0020</code>)</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span> 个 <code>tab</code> 字符(<code>U+0009</code>，图中展示成 <code>^I</code>)</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span> 个 <code>line terminator</code> (图中展示为 <code>$</code>，在我的电脑上，<code>line terminator</code> 是 <code>U+000A</code> 字符)</li>
</ul>
<p>第 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>5</mn></mrow><annotation encoding="application/x-tex">5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">5</span></span></span></span></span> 行的红框里是 <code>closing delimiter</code>。它只包含 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">3</span></span></span></span></span> 个双引号字符。下图中两个绿色框所展示的就是文本块的内容。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28683e490aa34bf7ab7d708fa948c625~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6YqA6YqF6ZC1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765116058&amp;x-signature=IkXG%2BtsLZtSbeODJkQuilvxCKW0%3D" alt="image.png" loading="lazy"/></p>
<p>下方是几个格式 <strong>有问题</strong> 的文本块（它们都来自 <a href="https://link.juejin.cn?target=https%3A%2F%2Fopenjdk.org%2Fjeps%2F378" target="_blank" title="https://openjdk.org/jeps/378" ref="nofollow noopener noreferrer">JEP 378: Text Blocks</a> 一文）</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-string">""""""</span>;   <span class="hljs-comment">// no line terminator after opening delimiter</span>
<span class="hljs-type">String</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-string">""" """</span>;  <span class="hljs-comment">// no line terminator after opening delimiter</span>
<span class="hljs-type">String</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> <span class="hljs-string">"""
           ";        // no closing delimiter (text block continues to EOF)
String d = """</span>
           abc \ def
           <span class="hljs-string">""";      // unescaped backslash (see below for escape processing)
</span></code></pre>
<h4 data-id="heading-8">编译时的处理</h4>
<p>在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fopenjdk.org%2Fjeps%2F378" target="_blank" title="https://openjdk.org/jeps/378" ref="nofollow noopener noreferrer">JEP 378: Text Blocks</a> 一文的 <code>Compile-time processing</code> 小节描述了编译时对文本块的处理，其中的部分内容如下 ⬇️</p>
<blockquote>
<h4 data-id="heading-9">Compile-time processing</h4>
<p>A text block is a <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.oracle.com%2Fjavase%2Fspecs%2Fjls%2Fse12%2Fhtml%2Fjls-15.html%23jls-15.28" target="_blank" title="https://docs.oracle.com/javase/specs/jls/se12/html/jls-15.html#jls-15.28" ref="nofollow noopener noreferrer">constant expression</a> of type <code>String</code>, just like a string literal. However, unlike a string literal, the content of a text block is processed by the Java compiler in three distinct steps:</p>
<ol>
<li>Line terminators in the content are translated to LF (<code>\u000A</code>). The purpose of this translation is to follow the principle of least surprise when moving Java source code across platforms.</li>
<li>Incidental white space surrounding the content, introduced to match the indentation of Java source code, is removed.</li>
<li>Escape sequences in the content are interpreted. Performing interpretation as the final step means developers can write escape sequences such as <code>\n</code> without them being modified or deleted by earlier steps.</li>
</ol>
</blockquote>
<p>我将其翻译如下 ⬇️</p>
<blockquote>
<h4 data-id="heading-10">编译时的处理</h4>
<p>像字符串字面值一样，文本块是 <code>String</code> 类型的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.oracle.com%2Fjavase%2Fspecs%2Fjls%2Fse12%2Fhtml%2Fjls-15.html%23jls-15.28" target="_blank" title="https://docs.oracle.com/javase/specs/jls/se12/html/jls-15.html#jls-15.28" ref="nofollow noopener noreferrer">常量表达式</a>。 但与字符串字面值不同的是， <code>Java</code> 编译器会用以下 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">3</span></span></span></span></span> 步来处理文本块的内容：</p>
<ol>
<li>文本块的内容中的 <code>line terminator</code> 会被转化为 <code>LF</code> 字符 (<code>U+000A</code>)。在不同平台迁移 <code>Java</code> 源代码时，需要遵循最小惊讶原则(<code>the principle of least surprise</code>)，所以才有这样的转化步骤。</li>
<li>文本块的内容中，为了匹配 <code>Java</code> 源代码中的缩进的那些次要的 <code>white space</code> 会被移除。</li>
<li>文本块的内容中的转义序列会被解释。解释转移序列这一步被放在最后，这可以保证开发者能正常使用 <code>\n</code> 之类的转移序列（而不会被前面两步所影响）。</li>
</ol>
</blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fopenjdk.org%2Fjeps%2F378" target="_blank" title="https://openjdk.org/jeps/378" ref="nofollow noopener noreferrer">JEP 378: Text Blocks</a> 中对这 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">3</span></span></span></span></span> 步分别做了详细的解释，我结合自己的理解，写了如下的内容</p>
<h5 data-id="heading-11">第 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span> 步：关于 <code>line terminator</code> 的处理</h5>
<p>在有的平台上，<code>line terminator</code> 是 <code>CR</code>(<code>U+000D</code>)，在有的平台上是 <code>CR</code>(<code>U+000D</code>) 和 <code>LF</code>(<code>U+000A</code>)，<code>Java</code> 编译器会将它们转化为 <code>LF</code>(<code>\u000A</code>)。<code>\n</code>(LF)，<code>\f</code>(FF)，<code>\r</code>(CR) 之类的转义序列 <strong>不会</strong> 在这一步被解释，转义序列的处理在第 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">3</span></span></span></span></span> 步。</p>
<h5 data-id="heading-12">第 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">2</span></span></span></span></span> 步：次要 <code>white space</code> 字符的处理</h5>
<p>如果有用户想从如下的写法（以下简称为“写法一”）</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">html</span> <span class="hljs-operator">=</span> <span class="hljs-string">"&lt;html&gt;\n"</span> +
              <span class="hljs-string">"    &lt;body&gt;\n"</span> +
              <span class="hljs-string">"        &lt;p&gt;Hello, world&lt;/p&gt;\n"</span> +
              <span class="hljs-string">"    &lt;/body&gt;\n"</span> +
              <span class="hljs-string">"&lt;/html&gt;\n"</span>;
</code></pre>
<p>改成文本块方式的写法（以下简称为“写法二”），</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">html</span> <span class="hljs-operator">=</span> <span class="hljs-string">"""
              &lt;html&gt;
                  &lt;body&gt;
                      &lt;p&gt;Hello, world&lt;/p&gt;
                  &lt;/body&gt;
              &lt;/html&gt;
              """</span>;
</code></pre>
<p>那么我们可以将其视为一次迁移，迁移过程中自然希望字符串的内容可以保持完全不变。为了让空格(<code>U+0020</code>)变得容易辨认，下面这段代码里用 <code>.</code> 字符来表示空格(<code>U+0020</code>)</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">html</span> <span class="hljs-operator">=</span> <span class="hljs-string">"""
..............&lt;html&gt;
..............    &lt;body&gt;
..............        &lt;p&gt;Hello, world&lt;/p&gt;
..............    &lt;/body&gt;
..............&lt;/html&gt;
.............."""</span>;
</code></pre>
<p>有些时候，文本块的内容可能是从其他地方复制过来的，复制过程中，在某些行的末尾（有意地或无意地）多加一些空格(<code>U+0020</code>)也是常见的情况。甚至被复制的文本本身就有在行尾的多余空格。所以在日常开发的过程中，代码也许会变成这样 ⬇️ (为了让空格变得容易辨认，下面这段代码里用 <code>.</code> 字符来表示空格)</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">html</span> <span class="hljs-operator">=</span> <span class="hljs-string">"""
..............&lt;html&gt;...
..............    &lt;body&gt;
..............        &lt;p&gt;Hello, world&lt;/p&gt;....
..............    &lt;/body&gt;.
..............&lt;/html&gt;...
.............."""</span>;
</code></pre>
<p>一般来说，我们并不需要下图红框所示的这些空格。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/156ef743bb4d479eab97c56e20d368ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6YqA6YqF6ZC1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765116058&amp;x-signature=vquH4TU2%2FkP0d0MWJAMbfQyWH7s%3D" alt="image.png" loading="lazy"/></p>
<p>如果保留这些空格的话，那么最终得到的字符串会和“方式一”中得到的字符串有差异（例如长度，<code>hashCode</code> 都会不同）。所以我们希望 <code>java</code> 编译器可以把这些次要的空格(更一般地说，应该是包含了 <code>U+0009</code>, <code>U+000B</code>, <code>U+000C</code>, <code>U+000D</code> 等字符在内的 <code>white space</code>)移除。</p>
<p><code>Java</code> 编译器会使用 <code>re-indentation</code> 算法来移除次要的 <code>white space</code> 字符。</p>
<h6 data-id="heading-13"><code>re-indentation</code> 算法</h6>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fopenjdk.org%2Fjeps%2F378" target="_blank" title="https://openjdk.org/jeps/378" ref="nofollow noopener noreferrer">JEP 378: Text Blocks</a> 一文的 <code>2. Incidental white space</code> 小节，介绍了 <code>re-indentation</code> 算法，原文如下 ⬇️</p>
<blockquote>
<ol>
<li>Split the content of the text block at every LF, producing a list of <em>individual lines</em>. Note that any line in the content which was just an LF will become an empty line in the list of individual lines.</li>
<li>Add all <em>non-blank</em> lines from the list of individual lines into a set of <em>determining lines</em>. (Blank lines -- lines that are empty or are composed wholly of white space -- have no visible influence on the indentation. Excluding blank lines from the set of determining lines avoids throwing off step 4 of the algorithm.)</li>
<li>If the last line in the list of individual lines (i.e., the line with the closing delimiter) is <em>blank</em>, then add it to the set of determining lines. (The indentation of the closing delimiter should influence the indentation of the content as a whole -- a <a href="https://link.juejin.cn?target=https%3A%2F%2Fopenjdk.org%2Fjeps%2F378%23Significant-trailing-line-policy" target="_blank" title="https://openjdk.org/jeps/378#Significant-trailing-line-policy" ref="nofollow noopener noreferrer"><em>significant trailing line</em></a> policy.)</li>
<li>Compute the <em>common white space prefix</em> of the set of determining lines, by counting the number of leading white space characters on each line and taking the minimum count.</li>
<li>Remove the common white space prefix from each <em>non-blank</em> line in the list of individual lines.</li>
<li>Remove all trailing white space from all lines in the modified list of individual lines from step 5. This step collapses wholly-white-space lines in the modified list so that they are empty, but does not discard them.</li>
<li>Construct the result string by joining all the lines in the modified list of individual lines from step 6, using LF as the separator between lines. If the final line in the list from step 6 is empty, then the joining LF from the previous line will be the last character in the result string.</li>
</ol>
</blockquote>
<p>我将其翻译如下 ⬇️</p>
<blockquote>
<ol>
<li>将文本块的内容在每一个 <code>LF</code> 处进行 <code>split</code> 操作，从而得到 <code>individual line</code> 的列表。请注意，在文本块的内容中，如果某一行原本只包含 <code>LF</code>，那么在 <code>split</code> 操作之后，这一行会变为空行(即，长度为 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span> 的行)。</li>
<li>将 <code>individual line</code> 中的所有 <code>non-blank</code> 行，加入 <code>determining line</code> 这个集合中。(如果一行的长度为 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span> 或者完全由 <code>white space</code> 组成，那么我们称其为 <code>blank line</code>，否则就叫 <code>non-blank line</code>。排除掉所有的 <code>blank line</code>，是为了防止它们影响本算法的第 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn></mrow><annotation encoding="application/x-tex">4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">4</span></span></span></span></span> 步。)</li>
<li>如果 <code>individual line</code> 中的最后一行(即，和 <code>closing delimiter</code> 在一起的那一行)是 <code>blank line</code>，那么将它加入 <code>determining line</code> 中。（<code>closing delimiter</code> 所在行的缩进会对文本块的内容的缩进有影响 -- 这被称为 <a href="https://link.juejin.cn?target=https%3A%2F%2Fopenjdk.org%2Fjeps%2F378%23Significant-trailing-line-policy" target="_blank" title="https://openjdk.org/jeps/378#Significant-trailing-line-policy" ref="nofollow noopener noreferrer"><em>significant trailing line</em></a> 策略。）</li>
<li>计算所有 <code>determining line</code> 的公共 <code>white space</code> 前缀，具体的方法是对所有 <code>determining line</code> 的 <code>leading white space</code> 的字符数量都进行计数，然后取最小的计数值。</li>
<li>对 <code>individual line</code> 里的所有 <code>non-blank</code> 行，移除公共 <code>white space</code> 前缀。</li>
<li>对所有 <code>individual line</code>（在第 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>5</mn></mrow><annotation encoding="application/x-tex">5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">5</span></span></span></span></span> 步中对其进行修改），移除其 <code>trailing white space</code>。这一步会将 <code>wholly-white-space</code>(完全由 <code>white space</code> 组成的行)变为空行，但是并不丢弃它们。</li>
<li>用 <code>LF</code> 作为分隔符，对 <code>individual line</code> （在第 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>6</mn></mrow><annotation encoding="application/x-tex">6</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">6</span></span></span></span></span> 步中已经被修改）执行 <code>join</code> 操作。如果第 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>6</mn></mrow><annotation encoding="application/x-tex">6</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">6</span></span></span></span></span> 步的最后一行是空行，那么最终结果的最后一个字符会是前一行在 <code>join</code> 操作时用到的 <code>LF</code>。</li>
</ol>
</blockquote>
<p>这个算法涉及 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>7</mn></mrow><annotation encoding="application/x-tex">7</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">7</span></span></span></span></span> 个步骤，想象算法的运行过程有些抽象，我们还是结合具体的例子来理解吧。
请将以下代码保存为 <code>ShowTextBlock.java</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShowTextBlock</span> {
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> <span class="hljs-string">"""
      远看山有色   
       近听水无声  
 
        春去花还在  
         人来鸟不惊      
   """</span>;
    System.out.println(text);
  }
}
</code></pre>
<p>用以下命令可以编译 <code>ShowTextBlock.java</code> 并运行其中的 <code>main</code> 方法。</p>
<pre><code class="hljs language-bash" lang="bash">javac ShowTextBlock.java
java ShowTextBlock
</code></pre>
<p>运行结果如下</p>
<pre><code class="hljs language-text" lang="text">   远看山有色
    近听水无声

     春去花还在
      人来鸟不惊

</code></pre>
<p>在 <code>ShowTextBlock.java</code> 中有很多空格(<code>U+0020</code>)，这些空格的数量不容易看清。在 <code>vim</code> 中，通过调整配置，可以将所有的空格(<code>U+0020</code>)都展示为 <code>.</code>，效果如下图所示 ⬇️
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d9427df56a034e588cc962a7e3697ca8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6YqA6YqF6ZC1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765116058&amp;x-signature=BY3q%2BRbEtks8hYkmg5OWHnEaxr8%3D" alt="image.png" loading="lazy"/></p>
<p>基于 <code>ShowTextBlock.java</code>，我们可以将 <code>re-indentation</code> 算法的 <code>7</code> 个步骤列举如下 ⬇️ （表中统一用 <code>.</code> 来表示空格字符）</p>








































<table><thead><tr><th>第几步</th><th><code>individual line</code></th><th><code>determining line</code></th></tr></thead><tbody><tr><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span></td><td><code>"......远看山有色..."</code> <br/> <code>".......近听水无声.."</code> <br/> <code>"."</code> <br/> <code>"........春去花还在.."</code> <br/> <code>".........人来鸟不惊......"</code> <br/> <code>"..."</code></td><td><del>尚未出现</del></td></tr><tr><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">2</span></span></span></span></span></td><td><code>"......远看山有色..."</code> <br/> <code>".......近听水无声.."</code> <br/> <code>"."</code> <br/> <code>"........春去花还在.."</code> <br/> <code>".........人来鸟不惊......"</code> <br/> <code>"..."</code> <br/> (没有变化)</td><td><code>"......远看山有色..."</code> <br/> <code>".......近听水无声.."</code> <br/> <code>"........春去花还在.."</code> <br/> <code>".........人来鸟不惊......"</code></td></tr><tr><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">3</span></span></span></span></span></td><td><code>"......远看山有色..."</code> <br/> <code>".......近听水无声.."</code> <br/> <code>"."</code> <br/> <code>"........春去花还在.."</code> <br/> <code>".........人来鸟不惊......"</code> <br/> <code>"..."</code> <br/> (没有变化)</td><td><code>"......远看山有色..."</code> <br/> <code>".......近听水无声.."</code> <br/> <code>"........春去花还在.."</code> <br/> <code>".........人来鸟不惊......"</code> <br/> <code>"..."</code> <br/> <strong>(加了一行)</strong></td></tr><tr><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn></mrow><annotation encoding="application/x-tex">4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">4</span></span></span></span></span></td><td><code>"......远看山有色..."</code> <br/> <code>".......近听水无声.."</code> <br/> <code>"."</code> <br/> <code>"........春去花还在.."</code> <br/> <code>".........人来鸟不惊......"</code> <br/> <code>"..."</code> <br/> (没有变化)</td><td><code>"......远看山有色..."</code> <br/> <code>".......近听水无声.."</code> <br/> <code>"........春去花还在.."</code> <br/> <code>".........人来鸟不惊......"</code> <br/> <code>"..."</code> <br/> （没有变化）<br/>（计算出公共 <code>white space</code> 前缀是 3)</td></tr><tr><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>5</mn></mrow><annotation encoding="application/x-tex">5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">5</span></span></span></span></span></td><td><code>"...远看山有色..."</code> <br/> <code>"....近听水无声.."</code> <br/> <code>"."</code> （<strong>注意，只有这一行没有变化）</strong> <br/> <code>".....春去花还在.."</code> <br/> <code>"......人来鸟不惊......"</code> <br/> <code>""</code></td><td><code>"......远看山有色..."</code> <br/> <code>".......近听水无声.."</code> <br/> <code>"........春去花还在.."</code> <br/> <code>".........人来鸟不惊......"</code> <br/> <code>"..."</code> <br/> （没有变化）</td></tr><tr><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>6</mn></mrow><annotation encoding="application/x-tex">6</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">6</span></span></span></span></span></td><td><code>"...远看山有色"</code> <br/> <code>"....近听水无声"</code> <br/> <code>""</code><br/> <code>".....春去花还在"</code> <br/> <code>"......人来鸟不惊"</code> <br/> <code>""</code></td><td><code>"......远看山有色..."</code> <br/> <code>".......近听水无声.."</code> <br/> <code>"........春去花还在.."</code> <br/> <code>".........人来鸟不惊......"</code> <br/> <code>"..."</code> <br/> （没有变化）</td></tr></tbody></table>
<p>第 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>7</mn></mrow><annotation encoding="application/x-tex">7</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">7</span></span></span></span></span> 步执行完 <code>join</code> 操作，所得到的结果等价于 ⬇️</p>
<pre><code class="hljs language-java" lang="java">String.join(
        <span class="hljs-string">"\n"</span>, <span class="hljs-comment">// U+000A, i.e. LF</span>
        <span class="hljs-string">"   远看山有色"</span>, <span class="hljs-comment">// 有 3 个 leading white space</span>
        <span class="hljs-string">"    近听水无声"</span>, <span class="hljs-comment">// 有 4 个 leading white space</span>
        <span class="hljs-string">""</span>,
        <span class="hljs-string">"     春去花还在"</span>, <span class="hljs-comment">// 有 5 个 leading white space</span>
        <span class="hljs-string">"      人来鸟不惊"</span> <span class="hljs-comment">// 有 6 个 leading white space</span>
);
</code></pre>
<h5 data-id="heading-14">第 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">3</span></span></span></span></span> 步：转义序列的处理</h5>
<p>在第 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">3</span></span></span></span></span> 步里，会对转义序列进行解释。文本块中除了支持 <code>\n</code>, <code>\t</code>, <code>'</code>, <code>"</code>, <code>\</code> 等原有的转义序列（完整的列表可以参考 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.oracle.com%2Fjavase%2Fspecs%2Fjls%2Fse14%2Fhtml%2Fjls-3.html%23jls-3.10.6" target="_blank" title="https://docs.oracle.com/javase/specs/jls/se14/html/jls-3.html#jls-3.10.6" ref="nofollow noopener noreferrer"><code>The Java Language Specification</code> (<code>Java SE 14 Edition</code>) 的 <code>3.10.6</code> 小节</a>）外，还支持两个新增的转义序列。</p>
<h6 data-id="heading-15">新增转义序列 1:  <code>\&lt;line-terminator&gt;</code></h6>
<p>使用 <code>\&lt;line-terminator&gt;</code> 可以阻止插入换行符。例如在 <code>JDK 15</code> 之前，我们可以这样拼接出一个比较长的字符串（请注意，这个字符串中没有换行符）⬇️</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">literal</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Lorem ipsum dolor sit amet, consectetur adipiscing "</span> +
                 <span class="hljs-string">"elit, sed do eiusmod tempor incididunt ut labore "</span> +
                 <span class="hljs-string">"et dolore magna aliqua."</span>;
</code></pre>
<p>在 <code>JDK 15</code> 中，我们可以用文本块来拼出内容相同的字符串 ⬇️ （请注意，其中用到了 &lt;line-terminator&gt; 转义序列）</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> <span class="hljs-string">"""
                Lorem ipsum dolor sit amet, consectetur adipiscing \
                elit, sed do eiusmod tempor incididunt ut labore \
                et dolore magna aliqua.\
                """</span>;
</code></pre>
<h6 data-id="heading-16">新增转义序列 2:  <code>\s</code> 它会转换成一个空格(<code>U+0020</code>)</h6>
<p><code>\s</code> 这个转义序列会被转化为空格(<code>U+0020</code>)字符。为什么需要这个转义序列呢？有的时候，我们确实需要在行尾的 <code>white space</code>，但是行尾的 <code>white space</code> 会在第 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">2</span></span></span></span></span> 步中被移除。所以我们可以通过使用 <code>\s</code> 转义序列来保留必要的 <code>white space</code>。举个例子，如果我们在 <code>Intellij IDEA</code> 中运行 <code>C</code> 中的 <code>main</code> 方法 ⬇️ 那么会看到标准输出共有 3 行，每一行的结尾都有空格字符（例如 <code>green</code> 后面有一个空格）。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">C</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">colors</span> <span class="hljs-operator">=</span> <span class="hljs-string">"""
                red  \s
                green\s
                blue \s
                """</span>;
        System.out.println(colors);
    }
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a8aa44f8c79a4a7b9728c19e4eed7f22~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6YqA6YqF6ZC1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765116058&amp;x-signature=0LD%2B1Jy4Kgb1QAxfLZBn7AvHLEk%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-17">参考资料</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fopenjdk.org%2Fjeps%2F378" target="_blank" title="https://openjdk.org/jeps/378" ref="nofollow noopener noreferrer">JEP 378: Text Blocks</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.oracle.com%2Fjavase%2Fspecs%2Fjls%2Fse14%2Fhtml%2F" target="_blank" title="https://docs.oracle.com/javase/specs/jls/se14/html/" ref="nofollow noopener noreferrer"><code>The Java® Language Specification</code> (<code>Java SE 14 Edition</code>)</a> 里的
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.oracle.com%2Fjavase%2Fspecs%2Fjls%2Fse14%2Fhtml%2Fjls-3.html%23jls-3.10.6" target="_blank" title="https://docs.oracle.com/javase/specs/jls/se14/html/jls-3.html#jls-3.10.6" ref="nofollow noopener noreferrer"><code>3.10.6</code> 小节</a>: <code>Escape Sequences for Character and String Literals</code></li>
</ul>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java 面向对象之类与对象：编程世界的实体化核心]]></title>    <link>https://juejin.cn/post/7577957806210269199</link>    <guid>https://juejin.cn/post/7577957806210269199</guid>    <pubDate>2025-11-30T14:24:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577957806210269199" data-draft-id="7577957806210252815" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java 面向对象之类与对象：编程世界的实体化核心"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2025-11-30T14:24:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="MOMO陌染"/> <meta itemprop="url" content="https://juejin.cn/user/546920729166618"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java 面向对象之类与对象：编程世界的实体化核心
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/546920729166618/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    MOMO陌染
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T14:24:09.000Z" title="Sun Nov 30 2025 14:24:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Java 面向对象之类与对象：编程世界的实体化核心</h2>
<p>面向对象编程（Object-Oriented Programming，OOP）是现代软件开发中占据主导地位的编程范式，其核心思想是将现实世界中的事物抽象为<strong>类</strong>，并通过类的实例化创建<strong>对象</strong>，以此实现对复杂业务逻辑的模块化、可复用和可维护的编程。Java 作为一门纯粹的面向对象编程语言，类与对象是其构建程序的基础单元，深入理解二者的概念、关系及使用方式，是掌握 Java 面向对象编程的关键。</p>
<h3 data-id="heading-1">一、面向对象的核心思想</h3>
<p>在面向对象的世界里，我们将现实世界中的事物拆分为一个个<strong>对象</strong>（比如人、汽车、手机），每个对象都具备两大特征：</p>
<ol>
<li><strong>属性</strong>：描述对象的静态特征（如人的姓名、年龄，汽车的品牌、颜色）；</li>
<li><strong>行为</strong>：描述对象的动态操作（如人会吃饭、跑步，汽车会启动、刹车）。</li>
</ol>
<p>而<strong>类</strong>则是对一类具有相同属性和行为的对象的抽象描述，相当于创建对象的 “模板” 或 “蓝图”。例如，“人类” 是一个类，而具体的 “张三”“李四” 就是人类的实例对象；“汽车类” 是模板，而停在车库里的 “白色特斯拉 Model 3” 就是汽车类的一个具体对象。</p>
<p>Java 的面向对象编程围绕类与对象展开，并通过封装、继承、多态三大特性实现代码的灵活性和扩展性，而类与对象正是这三大特性的载体。</p>
<h3 data-id="heading-2">二、类的定义：构建对象的模板</h3>
<p>在 Java 中，类通过<code>class</code>关键字定义，其内部主要包含<strong>成员变量</strong>（对应对象的属性）和<strong>成员方法</strong>（对应对象的行为），还可以包含构造方法、代码块、内部类等特殊结构。</p>
<h4 data-id="heading-3">1. 类的基本结构</h4>
<p>类的定义语法如下：</p>
<pre><code class="hljs language-java" lang="java">[访问修饰符] class 类名 {
    <span class="hljs-comment">// 成员变量（属性）</span>
    [访问修饰符] 数据类型 变量名;
    
    <span class="hljs-comment">// 构造方法（用于创建对象）</span>
    [访问修饰符] 类名(参数列表) {
        构造方法体;
    }
    
    <span class="hljs-comment">// 成员方法（行为）</span>
    [访问修饰符] 返回值类型 方法名(参数列表) {
        方法体;
        [<span class="hljs-keyword">return</span> 返回值;]
    }
}
</code></pre>
<ul>
<li><strong>访问修饰符</strong>：控制类、变量、方法的访问范围，常用的有<code>public</code>（公共）、<code>private</code>（私有）、<code>protected</code>（受保护）和默认（无修饰符）；</li>
<li><strong>类名</strong>：遵循 Java 命名规范，首字母大写，采用驼峰命名法（如<code>Person</code>、<code>Car</code>）；</li>
<li><strong>成员变量</strong>：定义对象的属性，直接声明在类体中，未初始化时会有默认值（如<code>int</code>默认 0，<code>String</code>默认<code>null</code>）；</li>
<li><strong>成员方法</strong>：定义对象的行为，包含方法名、参数列表、返回值和方法体。</li>
</ul>
<h4 data-id="heading-4">2. 类的定义示例</h4>
<p>以 “人类” 为例，定义一个<code>Person</code>类，包含姓名、年龄两个属性，以及吃饭、跑步两个行为：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 定义Person类</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {
    <span class="hljs-comment">// 成员变量（属性）</span>
    <span class="hljs-keyword">private</span> String name; <span class="hljs-comment">// 姓名：私有访问，封装性体现</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;     <span class="hljs-comment">// 年龄：私有访问</span>
    
    <span class="hljs-comment">// 无参构造方法：创建对象时默认调用</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">()</span> {
    }
    
    <span class="hljs-comment">// 有参构造方法：创建对象时初始化属性</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }
    
    <span class="hljs-comment">// 成员方法（行为）：吃饭</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">eat</span><span class="hljs-params">()</span> {
        System.out.println(name + <span class="hljs-string">"正在吃饭"</span>);
    }
    
    <span class="hljs-comment">// 成员方法（行为）：跑步</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
        System.out.println(name + <span class="hljs-string">"今年"</span> + age + <span class="hljs-string">"岁，正在跑步"</span>);
    }
    
    <span class="hljs-comment">// Getter和Setter方法：访问私有成员变量</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }
}
</code></pre>
<p>上述代码中，我们将<code>name</code>和<code>age</code>声明为<code>private</code>（私有），通过<code>getter/setter</code>方法实现对私有属性的访问，这是<strong>封装</strong>特性的核心体现，避免了属性被直接修改，保证了数据的安全性。</p>
<h3 data-id="heading-5">三、对象的创建与使用：模板的实例化</h3>
<p>类只是一个抽象的模板，无法直接执行操作，必须通过<strong>实例化</strong>创建对象，才能调用类的属性和方法。在 Java 中，对象的创建通过<code>new</code>关键字完成，结合构造方法初始化对象。</p>
<h4 data-id="heading-6">1. 对象的创建步骤</h4>
<p>对象的创建分为两个核心步骤：</p>
<ol>
<li><strong>声明对象</strong>：指定对象的类型和名称，语法为<code>类名 对象名;</code>；</li>
<li><strong>实例化对象</strong>：通过<code>new</code>关键字调用构造方法，为对象分配内存空间，语法为<code>对象名 = new 类名(参数列表);</code>。</li>
</ol>
<p>也可以将两步合并为：<code>类名 对象名 = new 类名(参数列表);</code>。</p>
<h4 data-id="heading-7">2. 对象的使用示例</h4>
<p>基于上述<code>Person</code>类，创建并使用对象：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 测试类：创建Person对象并调用其方法</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PersonTest</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 方式1：调用无参构造方法创建对象</span>
        <span class="hljs-type">Person</span> <span class="hljs-variable">person1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();
        <span class="hljs-comment">// 通过setter方法为私有属性赋值</span>
        person1.setName(<span class="hljs-string">"张三"</span>);
        person1.setAge(<span class="hljs-number">20</span>);
        <span class="hljs-comment">// 调用对象的方法</span>
        person1.eat();   <span class="hljs-comment">// 输出：张三正在吃饭</span>
        person1.run();   <span class="hljs-comment">// 输出：张三今年20岁，正在跑步</span>
        
        <span class="hljs-comment">// 方式2：调用有参构造方法创建对象，直接初始化属性</span>
        <span class="hljs-type">Person</span> <span class="hljs-variable">person2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"李四"</span>, <span class="hljs-number">25</span>);
        <span class="hljs-comment">// 通过getter方法获取私有属性值</span>
        System.out.println(<span class="hljs-string">"姓名："</span> + person2.getName() + <span class="hljs-string">"，年龄："</span> + person2.getAge()); <span class="hljs-comment">// 输出：姓名：李四，年龄：25</span>
        person2.eat();   <span class="hljs-comment">// 输出：李四正在吃饭</span>
        person2.run();   <span class="hljs-comment">// 输出：李四今年25岁，正在跑步</span>
    }
}
</code></pre>
<h4 data-id="heading-8">3. 对象的内存分配（简要）</h4>
<p>Java 中对象的内存分配涉及<strong>栈内存</strong>和<strong>堆内存</strong>：</p>
<ul>
<li><strong>栈内存</strong>：存储对象的引用（即变量名，如<code>person1</code>），指向堆内存中的实际对象；</li>
<li><strong>堆内存</strong>：存储对象的实际数据（即属性值，如<code>name="张三"</code>、<code>age=20</code>）；</li>
<li>方法区：存储类的字节码信息（如<code>Person</code>类的定义），被所有对象共享。</li>
</ul>
<p>当执行<code>Person person1 = new Person();</code>时，<code>person1</code>作为引用存储在栈中，而<code>new Person()</code>创建的对象数据存储在堆中，栈中的引用指向堆中的对象地址。</p>
<h3 data-id="heading-9">四、类与对象的关系</h3>
<p>类与对象是<strong>抽象与具体</strong>、<strong>模板与实例</strong>的关系，具体体现在：</p>
<ol>
<li><strong>类是对象的抽象</strong>：类概括了一类事物的共同属性和行为，不依赖具体对象存在；</li>
<li><strong>对象是类的实例</strong>：对象是类的具体实现，每个对象都具备类定义的属性和行为，且可以有不同的属性值；</li>
<li><strong>一个类可以创建多个对象</strong>：例如<code>Person</code>类可以创建<code>张三</code>、<code>李四</code>、<code>王五</code>等多个对象，每个对象相互独立，属性值可以不同。</li>
</ol>
<h3 data-id="heading-10">五、常见问题与注意事项</h3>
<ol>
<li>
<p><strong>构造方法的特性</strong>：</p>
<ul>
<li>构造方法的名称必须与类名完全相同，无返回值类型（包括<code>void</code>也不能写）；</li>
<li>如果类中没有显式定义构造方法，Java 编译器会自动生成一个无参构造方法；</li>
<li>如果定义了有参构造方法，编译器将不再生成无参构造方法，如需使用需手动定义。</li>
</ul>
</li>
<li>
<p><strong><code>this</code>关键字的使用</strong>：</p>
<ul>
<li><code>this</code>代表当前对象的引用，用于区分成员变量和局部变量（如<code>this.name = name</code>）；</li>
<li>可以在构造方法中通过<code>this(参数)</code>调用同类的其他构造方法，且该语句必须是构造方法的第一条语句。</li>
</ul>
</li>
<li>
<p><strong>对象的空指针异常</strong>：如果对象引用未指向实际对象（即<code>null</code>），调用其方法或属性会抛出<code>NullPointerException</code>，需避免使用<code>null</code>引用调用成员。</p>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[第3讲:增删改查实战——搞定80%日常需求]]></title>    <link>https://juejin.cn/post/7577991167201312778</link>    <guid>https://juejin.cn/post/7577991167201312778</guid>    <pubDate>2025-11-30T14:54:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577991167201312778" data-draft-id="7566820238747729972" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="第3讲:增删改查实战——搞定80%日常需求"/> <meta itemprop="keywords" content="后端,MySQL"/> <meta itemprop="datePublished" content="2025-11-30T14:54:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="骑着bug的coder"/> <meta itemprop="url" content="https://juejin.cn/user/1922418579089566"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            第3讲:增删改查实战——搞定80%日常需求
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1922418579089566/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    骑着bug的coder
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T14:54:29.000Z" title="Sun Nov 30 2025 14:54:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">第3讲:增删改查实战——搞定80%日常需求</h2>
<blockquote>
<p><strong>目标:</strong> 掌握DML核心操作,写出高效SQL</p>
</blockquote>
<hr/>
<h3 data-id="heading-1">开篇:增删改查就是你的日常</h3>
<p>上两讲咱们把环境搭好了,会建库建表了。今天要学的是以后天天要用的东西:<strong>增删改查(CRUD)</strong>。</p>
<p>CRUD是啥?</p>
<ul>
<li>C = Create(增) → INSERT</li>
<li>R = Read(查) → SELECT</li>
<li>U = Update(改) → UPDATE</li>
<li>D = Delete(删) → DELETE</li>
</ul>
<p>这四个操作占了你日常工作的80%。掌握了它们,MySQL就算入门了。</p>
<p>今天这一讲,我会用大量实战案例带你练习,还会告诉你那些<strong>踩过的坑</strong>。保证你看完就能上手干活。</p>
<hr/>
<h3 data-id="heading-2">一、INSERT:往表里塞数据</h3>
<h4 data-id="heading-3">基础用法</h4>
<p>继续用第2讲的employee表:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 单条插入(最基础)</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> employee (name, department, salary, hire_date) 
<span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'张三'</span>, <span class="hljs-string">'技术部'</span>, <span class="hljs-number">8000</span>, <span class="hljs-string">'2023-01-15'</span>);
</code></pre>
<p><strong>注意:</strong> id字段不用填,因为它是AUTO_INCREMENT,MySQL会自动分配。</p>
<h4 data-id="heading-4">批量插入(推荐,效率高10倍)</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 批量插入(一次插入多条)</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> employee (name, department, salary, hire_date) <span class="hljs-keyword">VALUES</span>
(<span class="hljs-string">'李四'</span>, <span class="hljs-string">'市场部'</span>, <span class="hljs-number">6000</span>, <span class="hljs-string">'2023-03-20'</span>),
(<span class="hljs-string">'王五'</span>, <span class="hljs-string">'技术部'</span>, <span class="hljs-number">9000</span>, <span class="hljs-string">'2022-11-10'</span>),
(<span class="hljs-string">'赵六'</span>, <span class="hljs-string">'人力部'</span>, <span class="hljs-number">7000</span>, <span class="hljs-string">'2023-05-01'</span>),
(<span class="hljs-string">'孙七'</span>, <span class="hljs-string">'技术部'</span>, <span class="hljs-number">8500</span>, <span class="hljs-string">'2023-02-14'</span>);
</code></pre>
<p><strong>为啥批量插入快?</strong></p>
<p>单条插入,MySQL要:连接→插入→提交→断开,每次都要经历这个过程。
批量插入,只需:连接→插入插入插入...→提交→断开,一次搞定。</p>
<p>涉及批量插入时效率差10倍以上!</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c6f88433f58349169e72a39259dd8450~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aqR552AYnVn55qEY29kZXI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765119268&amp;x-signature=SzbO7gkznCCzSYKi4i8YTri0QqE%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-5">INSERT IGNORE:插入时忽略重复</h4>
<p>假设id=1的员工已经存在,再插一次会报错:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 会报错:Duplicate entry '1' for key 'PRIMARY'</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> employee (id, name, department, salary, hire_date) 
<span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>, <span class="hljs-string">'张三'</span>, <span class="hljs-string">'技术部'</span>, <span class="hljs-number">8000</span>, <span class="hljs-string">'2023-01-15'</span>);
</code></pre>
<p>用INSERT IGNORE就不会报错:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 不会报错,直接跳过</span>
<span class="hljs-keyword">INSERT</span> IGNORE <span class="hljs-keyword">INTO</span> employee (id, name, department, salary, hire_date) 
<span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>, <span class="hljs-string">'张三'</span>, <span class="hljs-string">'技术部'</span>, <span class="hljs-number">8000</span>, <span class="hljs-string">'2023-01-15'</span>);
</code></pre>
<p><strong>什么时候用?</strong></p>
<p>批量导入数据时,不确定哪些已经存在了,用INSERT IGNORE可以跳过重复的,继续插入其他的。</p>
<h4 data-id="heading-6">INSERT ... ON DUPLICATE KEY UPDATE:重复就更新</h4>
<p>更高级的用法:如果记录存在就更新,不存在就插入。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> employee (id, name, department, salary, hire_date) 
<span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>, <span class="hljs-string">'张三'</span>, <span class="hljs-string">'技术部'</span>, <span class="hljs-number">9000</span>, <span class="hljs-string">'2023-01-15'</span>)
<span class="hljs-keyword">ON</span> DUPLICATE KEY <span class="hljs-keyword">UPDATE</span> salary <span class="hljs-operator">=</span> <span class="hljs-number">9000</span>;
</code></pre>
<p>这个语句的意思:</p>
<ul>
<li>如果id=1不存在,就插入这条记录</li>
<li>如果id=1已存在,就把薪资更新为9000</li>
</ul>
<p><strong>什么时候用?</strong></p>
<p>需要"有则更新、无则插入"的场景,比如统计数据、缓存表。</p>
<hr/>
<h3 data-id="heading-7">二、SELECT:查数据(重点中的重点)</h3>
<p>SELECT是用得最多的语句,没有之一。我们从简单到复杂,一步步来。</p>
<h4 data-id="heading-8">基础查询</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 查所有字段</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> employee;

<span class="hljs-comment">-- 查指定字段</span>
<span class="hljs-keyword">SELECT</span> name, salary <span class="hljs-keyword">FROM</span> employee;

<span class="hljs-comment">-- 查询并起别名</span>
<span class="hljs-keyword">SELECT</span> name <span class="hljs-keyword">AS</span> 姓名, salary <span class="hljs-keyword">AS</span> 薪资 <span class="hljs-keyword">FROM</span> employee;
</code></pre>
<p><strong>注意:</strong> 生产环境别用<code>SELECT *</code>,性能差。需要啥字段就查啥字段。</p>
<h4 data-id="heading-9">WHERE条件查询(核心)</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 单个条件</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> employee <span class="hljs-keyword">WHERE</span> department <span class="hljs-operator">=</span> <span class="hljs-string">'技术部'</span>;

<span class="hljs-comment">-- 多个条件:AND(并且)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> employee <span class="hljs-keyword">WHERE</span> department <span class="hljs-operator">=</span> <span class="hljs-string">'技术部'</span> <span class="hljs-keyword">AND</span> salary <span class="hljs-operator">&gt;</span> <span class="hljs-number">8000</span>;

<span class="hljs-comment">-- 多个条件:OR(或者)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> employee <span class="hljs-keyword">WHERE</span> department <span class="hljs-operator">=</span> <span class="hljs-string">'技术部'</span> <span class="hljs-keyword">OR</span> department <span class="hljs-operator">=</span> <span class="hljs-string">'市场部'</span>;

<span class="hljs-comment">-- 范围查询:BETWEEN</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> employee <span class="hljs-keyword">WHERE</span> salary <span class="hljs-keyword">BETWEEN</span> <span class="hljs-number">7000</span> <span class="hljs-keyword">AND</span> <span class="hljs-number">9000</span>;

<span class="hljs-comment">-- 列表查询:IN</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> employee <span class="hljs-keyword">WHERE</span> department <span class="hljs-keyword">IN</span> (<span class="hljs-string">'技术部'</span>, <span class="hljs-string">'市场部'</span>);

<span class="hljs-comment">-- 模糊查询:LIKE</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> employee <span class="hljs-keyword">WHERE</span> name <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'张%'</span>;  <span class="hljs-comment">-- 查姓张的</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> employee <span class="hljs-keyword">WHERE</span> name <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'%三'</span>;  <span class="hljs-comment">-- 查名字带"三"的</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> employee <span class="hljs-keyword">WHERE</span> name <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'%小%'</span>; <span class="hljs-comment">-- 查名字包含"小"的</span>

<span class="hljs-comment">-- 空值查询</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> employee <span class="hljs-keyword">WHERE</span> department <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span>;
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> employee <span class="hljs-keyword">WHERE</span> department <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>;
</code></pre>
<p><strong>LIKE通配符:</strong></p>
<ul>
<li><code>%</code>:表示任意多个字符</li>
<li><code>_</code>:表示单个字符</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- '张_':张三、张四,不包括张小明</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> employee <span class="hljs-keyword">WHERE</span> name <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'张_'</span>;
</code></pre>
<h4 data-id="heading-10">ORDER BY排序</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 按薪资升序(默认)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> employee <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> salary;

<span class="hljs-comment">-- 按薪资降序</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> employee <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> salary <span class="hljs-keyword">DESC</span>;

<span class="hljs-comment">-- 多字段排序:先按部门,再按薪资</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> employee <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> department, salary <span class="hljs-keyword">DESC</span>;
</code></pre>
<p><strong>ASC vs DESC:</strong></p>
<ul>
<li>ASC:升序(小到大),默认</li>
<li>DESC:降序(大到小)</li>
</ul>
<h4 data-id="heading-11">LIMIT分页查询</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 只看前3条</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> employee LIMIT <span class="hljs-number">3</span>;

<span class="hljs-comment">-- 跳过前2条,取3条(分页)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> employee LIMIT <span class="hljs-number">2</span>, <span class="hljs-number">3</span>;

<span class="hljs-comment">-- 更清晰的写法:OFFSET</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> employee LIMIT <span class="hljs-number">3</span> <span class="hljs-keyword">OFFSET</span> <span class="hljs-number">2</span>;
</code></pre>
<p><strong>LIMIT的两个参数:</strong></p>
<ul>
<li><code>LIMIT 2, 3</code>:跳过2条,取3条</li>
<li><code>LIMIT 3 OFFSET 2</code>:意思一样,更清晰</li>
</ul>
<p><strong>分页公式:</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 第1页:LIMIT 10 OFFSET 0</span>
<span class="hljs-comment">-- 第2页:LIMIT 10 OFFSET 10</span>
<span class="hljs-comment">-- 第3页:LIMIT 10 OFFSET 20</span>
<span class="hljs-comment">-- 第N页:LIMIT 10 OFFSET (N-1)*10</span>
</code></pre>
<p><strong>避坑:</strong> 数据量大时,OFFSET太大会很慢。千万级数据用<code>LIMIT 10 OFFSET 1000000</code>会卡死,后面会讲优化方案。</p>
<h4 data-id="heading-12">DISTINCT去重</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 查有哪些部门(去重)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> department <span class="hljs-keyword">FROM</span> employee;

<span class="hljs-comment">-- 查有哪些薪资水平(去重)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> salary <span class="hljs-keyword">FROM</span> employee;
</code></pre>
<h4 data-id="heading-13">完整的SELECT语法顺序</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[SELECT] --&gt; B[字段列表]
    B --&gt; C[FROM]
    C --&gt; D[表名]
    D --&gt; E[WHERE]
    E --&gt; F[条件]
    F --&gt; G[GROUP BY]
    G --&gt; H[分组字段]
    H --&gt; I[HAVING]
    I --&gt; J[分组条件]
    J --&gt; K[ORDER BY]
    K --&gt; L[排序字段]
    L --&gt; M[LIMIT]
    M --&gt; N[限制数量]
    
    style A fill:#90EE90
    style C fill:#90EE90
    style E fill:#FFE4B5
    style K fill:#FFE4B5
    style M fill:#FFE4B5
</code></pre>
<p><strong>记住这个顺序:</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> 字段
<span class="hljs-keyword">FROM</span> 表名
<span class="hljs-keyword">WHERE</span> 条件
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 分组字段
<span class="hljs-keyword">HAVING</span> 分组后条件
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> 排序字段
LIMIT 限制数量;
</code></pre>
<p><strong>注意:</strong> 这是书写顺序,不是执行顺序。MySQL实际执行顺序是:FROM → WHERE → GROUP BY → HAVING → SELECT → ORDER BY → LIMIT</p>
<hr/>
<h3 data-id="heading-14">三、聚合函数:快速统计数据</h3>
<p>聚合函数用来做统计,比如总数、平均值、最大值。</p>
<h4 data-id="heading-15">五大聚合函数</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- COUNT:统计数量</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">FROM</span> employee;                    <span class="hljs-comment">-- 总共多少员工</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">FROM</span> employee <span class="hljs-keyword">WHERE</span> department <span class="hljs-operator">=</span> <span class="hljs-string">'技术部'</span>;  <span class="hljs-comment">-- 技术部多少人</span>

<span class="hljs-comment">-- SUM:求和</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">SUM</span>(salary) <span class="hljs-keyword">FROM</span> employee;                 <span class="hljs-comment">-- 工资总和</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">SUM</span>(salary) <span class="hljs-keyword">FROM</span> employee <span class="hljs-keyword">WHERE</span> department <span class="hljs-operator">=</span> <span class="hljs-string">'技术部'</span>;  <span class="hljs-comment">-- 技术部工资总和</span>

<span class="hljs-comment">-- AVG:平均值</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(salary) <span class="hljs-keyword">FROM</span> employee;                 <span class="hljs-comment">-- 平均工资</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(salary) <span class="hljs-keyword">FROM</span> employee <span class="hljs-keyword">WHERE</span> department <span class="hljs-operator">=</span> <span class="hljs-string">'技术部'</span>;  <span class="hljs-comment">-- 技术部平均工资</span>

<span class="hljs-comment">-- MAX:最大值</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">MAX</span>(salary) <span class="hljs-keyword">FROM</span> employee;                 <span class="hljs-comment">-- 最高工资</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">MAX</span>(salary) <span class="hljs-keyword">FROM</span> employee <span class="hljs-keyword">WHERE</span> department <span class="hljs-operator">=</span> <span class="hljs-string">'技术部'</span>;  <span class="hljs-comment">-- 技术部最高工资</span>

<span class="hljs-comment">-- MIN:最小值</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">MIN</span>(salary) <span class="hljs-keyword">FROM</span> employee;                 <span class="hljs-comment">-- 最低工资</span>
</code></pre>
<p><strong>COUNT的三种写法:</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- COUNT(*):统计行数,包括NULL</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">FROM</span> employee;

<span class="hljs-comment">-- COUNT(字段):统计该字段非NULL的行数</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(department) <span class="hljs-keyword">FROM</span> employee;

<span class="hljs-comment">-- COUNT(1):统计行数,和COUNT(*)差不多</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">FROM</span> employee;
</code></pre>
<p><strong>哪个快?</strong></p>
<p><code>COUNT(*)</code>和<code>COUNT(1)</code>性能差不多,<code>COUNT(字段)</code>会慢一点,因为要判断字段是否为NULL。</p>
<p>为什么?因为<code>COUNT(*)</code>和<code>COUNT(1)</code>只需要统计行数,而<code>COUNT(字段)</code>还要读取字段值并判断是否为NULL。具体优化原理会在第5讲《索引》中详细讲解。</p>
<p>一般用<code>COUNT(*)</code>就行。</p>
<h4 data-id="heading-16">GROUP BY分组统计</h4>
<p>这是重点!很多复杂统计都要用到分组。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 统计各部门人数</span>
<span class="hljs-keyword">SELECT</span> department, <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">AS</span> 人数
<span class="hljs-keyword">FROM</span> employee
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department;

<span class="hljs-comment">-- 统计各部门平均工资</span>
<span class="hljs-keyword">SELECT</span> department, <span class="hljs-built_in">AVG</span>(salary) <span class="hljs-keyword">AS</span> 平均工资
<span class="hljs-keyword">FROM</span> employee
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department;

<span class="hljs-comment">-- 统计各部门最高工资</span>
<span class="hljs-keyword">SELECT</span> department, <span class="hljs-built_in">MAX</span>(salary) <span class="hljs-keyword">AS</span> 最高工资
<span class="hljs-keyword">FROM</span> employee
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department;
</code></pre>
<h4 data-id="heading-17">HAVING:分组后筛选</h4>
<p>WHERE是分组前筛选,HAVING是分组后筛选。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 统计人数超过2的部门</span>
<span class="hljs-keyword">SELECT</span> department, <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">AS</span> 人数
<span class="hljs-keyword">FROM</span> employee
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department
<span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-operator">&gt;</span> <span class="hljs-number">2</span>;

<span class="hljs-comment">-- 统计平均工资超过8000的部门</span>
<span class="hljs-keyword">SELECT</span> department, <span class="hljs-built_in">AVG</span>(salary) <span class="hljs-keyword">AS</span> 平均工资
<span class="hljs-keyword">FROM</span> employee
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department
<span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">AVG</span>(salary) <span class="hljs-operator">&gt;</span> <span class="hljs-number">8000</span>;
</code></pre>
<p><strong>WHERE vs HAVING:</strong></p>

























<table><thead><tr><th>对比项</th><th>WHERE</th><th>HAVING</th></tr></thead><tbody><tr><td>作用时机</td><td>分组前筛选</td><td>分组后筛选</td></tr><tr><td>能否使用聚合函数</td><td>不能</td><td>能</td></tr><tr><td>例子</td><td><code>WHERE salary &gt; 8000</code></td><td><code>HAVING AVG(salary) &gt; 8000</code></td></tr></tbody></table>
<p>记住:<strong>WHERE筛选行,HAVING筛选组</strong>。</p>
<hr/>
<h3 data-id="heading-18">四、多表查询:JOIN的基础用法</h3>
<p>实际工作中,数据经常分散在多个表里,需要关联查询。</p>
<h4 data-id="heading-19">准备两张表</h4>
<p>我们再建一个部门表:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> department (
    id <span class="hljs-type">INT</span> AUTO_INCREMENT <span class="hljs-keyword">PRIMARY</span> KEY,
    dept_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">30</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    location <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>)
) <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4;

<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> department (dept_name, location) <span class="hljs-keyword">VALUES</span>
(<span class="hljs-string">'技术部'</span>, <span class="hljs-string">'北京'</span>),
(<span class="hljs-string">'市场部'</span>, <span class="hljs-string">'上海'</span>),
(<span class="hljs-string">'人力部'</span>, <span class="hljs-string">'深圳'</span>);
</code></pre>
<p>现在有两张表:</p>
<ul>
<li>employee:员工表(name, department, salary)</li>
<li>department:部门表(dept_name, location)</li>
</ul>
<h4 data-id="heading-20">INNER JOIN:内连接(最常用)</h4>
<p>查询员工和所在部门的城市:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> e.name, e.salary, d.location
<span class="hljs-keyword">FROM</span> employee e
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> department d <span class="hljs-keyword">ON</span> e.department <span class="hljs-operator">=</span> d.dept_name;
</code></pre>
<p><strong>执行结果:</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">+--------+----------+----------+</span>
<span class="hljs-string">|</span> <span class="hljs-string">name</span>   <span class="hljs-string">|</span> <span class="hljs-string">salary</span>   <span class="hljs-string">|</span> <span class="hljs-string">location</span> <span class="hljs-string">|</span>
<span class="hljs-string">+--------+----------+----------+</span>
<span class="hljs-string">|</span> <span class="hljs-string">张三</span>   <span class="hljs-string">|</span> <span class="hljs-number">8000.00</span>  <span class="hljs-string">|</span> <span class="hljs-string">北京</span>     <span class="hljs-string">|</span>
<span class="hljs-string">|</span> <span class="hljs-string">李四</span>   <span class="hljs-string">|</span> <span class="hljs-number">6000.00</span>  <span class="hljs-string">|</span> <span class="hljs-string">上海</span>     <span class="hljs-string">|</span>
<span class="hljs-string">|</span> <span class="hljs-string">王五</span>   <span class="hljs-string">|</span> <span class="hljs-number">9000.00</span>  <span class="hljs-string">|</span> <span class="hljs-string">北京</span>     <span class="hljs-string">|</span>
<span class="hljs-string">|</span> <span class="hljs-string">赵六</span>   <span class="hljs-string">|</span> <span class="hljs-number">7000.00</span>  <span class="hljs-string">|</span> <span class="hljs-string">深圳</span>     <span class="hljs-string">|</span>
<span class="hljs-string">|</span> <span class="hljs-string">孙七</span>   <span class="hljs-string">|</span> <span class="hljs-number">8500.00</span>  <span class="hljs-string">|</span> <span class="hljs-string">北京</span>     <span class="hljs-string">|</span>
<span class="hljs-string">+--------+----------+----------+</span>
</code></pre>
<p><strong>语法解释:</strong></p>
<ul>
<li><code>FROM employee e</code>:给表起别名e(方便后面引用)</li>
<li><code>INNER JOIN department d</code>:关联部门表,起别名d</li>
<li><code>ON e.department = d.dept_name</code>:关联条件(员工的部门 = 部门的名称)</li>
</ul>
<h4 data-id="heading-21">JOIN的可视化理解</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    subgraph employee表
        A1[张三-技术部]
        A2[李四-市场部]
        A3[王五-技术部]
    end
    
    subgraph department表
        B1[技术部-北京]
        B2[市场部-上海]
        B3[人力部-深圳]
    end
    
    A1 -.ON条件匹配.-&gt; B1
    A2 -.ON条件匹配.-&gt; B2
    A3 -.ON条件匹配.-&gt; B1
    
    style A1 fill:#90EE90
    style A2 fill:#90EE90
    style A3 fill:#90EE90
    style B1 fill:#FFE4B5
    style B2 fill:#FFE4B5
</code></pre>
<p>INNER JOIN只返回两表都匹配上的记录。如果员工的部门在department表中不存在,这条记录就不会出现在结果中。</p>
<p><strong>其他JOIN简单介绍:</strong></p>
<ul>
<li>LEFT JOIN:左表全部保留,右表没匹配的显示NULL</li>
<li>RIGHT JOIN:右表全部保留,左表没匹配的显示NULL</li>
<li>FULL JOIN:两表都保留(MySQL不支持,要用UNION模拟)</li>
</ul>
<p>这些后面的课会详细讲,今天先掌握INNER JOIN就够了。</p>
<hr/>
<h3 data-id="heading-22">五、UPDATE:修改数据(危险操作)</h3>
<p>UPDATE用来修改表中的数据,<strong>一定要加WHERE条件</strong>,否则会改全表!</p>
<h4 data-id="heading-23">正确的UPDATE</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 给张三涨薪到9000</span>
<span class="hljs-keyword">UPDATE</span> employee <span class="hljs-keyword">SET</span> salary <span class="hljs-operator">=</span> <span class="hljs-number">9000</span> <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'张三'</span>;

<span class="hljs-comment">-- 给技术部所有人涨薪10%</span>
<span class="hljs-keyword">UPDATE</span> employee <span class="hljs-keyword">SET</span> salary <span class="hljs-operator">=</span> salary <span class="hljs-operator">*</span> <span class="hljs-number">1.1</span> <span class="hljs-keyword">WHERE</span> department <span class="hljs-operator">=</span> <span class="hljs-string">'技术部'</span>;

<span class="hljs-comment">-- 同时修改多个字段</span>
<span class="hljs-keyword">UPDATE</span> employee 
<span class="hljs-keyword">SET</span> salary <span class="hljs-operator">=</span> <span class="hljs-number">10000</span>, department <span class="hljs-operator">=</span> <span class="hljs-string">'架构部'</span> 
<span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'王五'</span>;
</code></pre>
<h4 data-id="heading-24">不加WHERE的后果</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ❌ 危险!会把所有人工资都改成5000</span>
<span class="hljs-keyword">UPDATE</span> employee <span class="hljs-keyword">SET</span> salary <span class="hljs-operator">=</span> <span class="hljs-number">5000</span>;
</code></pre>
<p><strong>假设场景:</strong></p>
<p>如果有人想给id=1的员工改工资,但忘了加WHERE:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">UPDATE</span> employee <span class="hljs-keyword">SET</span> salary <span class="hljs-operator">=</span> <span class="hljs-number">5000</span>;  <span class="hljs-comment">-- 忘了加WHERE</span>
</code></pre>
<p>结果会是:全公司所有人工资都变成5000。如果没有备份,只能从binlog日志里一条条恢复,非常麻烦。</p>
<p><strong>避坑技巧:</strong></p>
<ol>
<li>
<p><strong>先SELECT,再UPDATE</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 先查出来,确认是要改的数据</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> employee <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'张三'</span>;

<span class="hljs-comment">-- 确认无误后,把SELECT改成UPDATE</span>
<span class="hljs-keyword">UPDATE</span> employee <span class="hljs-keyword">SET</span> salary <span class="hljs-operator">=</span> <span class="hljs-number">9000</span> <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'张三'</span>;
</code></pre>
</li>
<li>
<p><strong>加LIMIT限制</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 最多只改1条,就算WHERE写错了也不会改太多</span>
<span class="hljs-keyword">UPDATE</span> employee <span class="hljs-keyword">SET</span> salary <span class="hljs-operator">=</span> <span class="hljs-number">9000</span> <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'张三'</span> LIMIT <span class="hljs-number">1</span>;
</code></pre>
</li>
<li>
<p><strong>开事务测试</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">START</span> TRANSACTION;  <span class="hljs-comment">-- 开启事务</span>
<span class="hljs-keyword">UPDATE</span> employee <span class="hljs-keyword">SET</span> salary <span class="hljs-operator">=</span> <span class="hljs-number">9000</span> <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'张三'</span>;
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> employee;  <span class="hljs-comment">-- 检查结果</span>
<span class="hljs-keyword">ROLLBACK</span>;  <span class="hljs-comment">-- 回滚,不生效</span>
<span class="hljs-comment">-- 确认没问题后,再COMMIT提交</span>
</code></pre>
</li>
</ol>
<hr/>
<h3 data-id="heading-25">六、DELETE:删除数据(更危险的操作)</h3>
<p>DELETE用来删除表中的数据,<strong>一定要加WHERE条件</strong>,否则会删全表!</p>
<h4 data-id="heading-26">正确的DELETE</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 删除id=5的员工</span>
<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> employee <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;

<span class="hljs-comment">-- 删除薪资低于6000的员工</span>
<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> employee <span class="hljs-keyword">WHERE</span> salary <span class="hljs-operator">&lt;</span> <span class="hljs-number">6000</span>;

<span class="hljs-comment">-- 删除技术部的员工</span>
<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> employee <span class="hljs-keyword">WHERE</span> department <span class="hljs-operator">=</span> <span class="hljs-string">'技术部'</span>;
</code></pre>
<h4 data-id="heading-27">不加WHERE的后果</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ❌ 超级危险!会删除所有数据</span>
<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> employee;
</code></pre>
<p><strong>假设场景:</strong></p>
<p>如果有人本想在测试库删除数据,但不小心连到了生产库:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> users;  <span class="hljs-comment">-- 本来想在测试库执行,结果连的是生产库</span>
</code></pre>
<p>后果:所有用户数据全部删除。即使有备份,也会丢失最近一段时间的数据,造成严重损失。</p>
<p><strong>避坑技巧:</strong></p>
<ol>
<li>
<p><strong>先SELECT,再DELETE</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 先查出来,确认是要删的数据</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> employee <span class="hljs-keyword">WHERE</span> salary <span class="hljs-operator">&lt;</span> <span class="hljs-number">6000</span>;

<span class="hljs-comment">-- 确认无误后,把SELECT改成DELETE</span>
<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> employee <span class="hljs-keyword">WHERE</span> salary <span class="hljs-operator">&lt;</span> <span class="hljs-number">6000</span>;
</code></pre>
</li>
<li>
<p><strong>加LIMIT限制</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 最多只删1条</span>
<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> employee <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">5</span> LIMIT <span class="hljs-number">1</span>;
</code></pre>
</li>
<li>
<p><strong>用软删除代替硬删除</strong></p>
<p>给表加个<code>is_deleted</code>字段,删除时只是标记,不是真删:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 建表时加字段</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> employee <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">COLUMN</span> is_deleted TINYINT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>;

<span class="hljs-comment">-- "删除"时只是改标记</span>
<span class="hljs-keyword">UPDATE</span> employee <span class="hljs-keyword">SET</span> is_deleted <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;

<span class="hljs-comment">-- 查询时过滤掉已删除的</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> employee <span class="hljs-keyword">WHERE</span> is_deleted <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
</code></pre>
</li>
</ol>
<h4 data-id="heading-28">DELETE vs TRUNCATE vs DROP</h4>
<p>三种删除数据的方式,区别很大:</p>









































<table><thead><tr><th>对比项</th><th>DELETE</th><th>TRUNCATE</th><th>DROP</th></tr></thead><tbody><tr><td>作用</td><td>删除数据</td><td>清空表数据</td><td>删除整个表</td></tr><tr><td>能加WHERE</td><td>能</td><td>不能</td><td>不能</td></tr><tr><td>能回滚</td><td>能(在事务中)</td><td>不能</td><td>不能</td></tr><tr><td>速度</td><td>慢(逐行删)</td><td>快(直接清空)</td><td>最快</td></tr><tr><td>自增ID</td><td>不重置</td><td>重置为1</td><td>表都没了</td></tr></tbody></table>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- DELETE:删除id=5的数据,可以回滚</span>
<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> employee <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;

<span class="hljs-comment">-- TRUNCATE:清空表,不能回滚,自增ID重置</span>
<span class="hljs-keyword">TRUNCATE</span> <span class="hljs-keyword">TABLE</span> employee;

<span class="hljs-comment">-- DROP:删除整个表,连结构都没了</span>
<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> employee;
</code></pre>
<p><strong>建议:</strong></p>
<ul>
<li>删除部分数据用DELETE</li>
<li>清空整个表用TRUNCATE(快)</li>
<li>删除表结构用DROP(慎用)</li>
</ul>
<hr/>
<h3 data-id="heading-29">七、常用函数速查</h3>
<h4 data-id="heading-30">字符串函数</h4>



































<table><thead><tr><th>函数</th><th>作用</th><th>示例</th></tr></thead><tbody><tr><td>CONCAT</td><td>拼接字符串</td><td><code>SELECT CONCAT(name, '-', department)</code></td></tr><tr><td>LENGTH</td><td>字符串长度</td><td><code>SELECT LENGTH(name)</code></td></tr><tr><td>SUBSTRING</td><td>截取字符串</td><td><code>SELECT SUBSTRING(name, 1, 1)</code> 截取姓氏</td></tr><tr><td>REPLACE</td><td>替换字符串</td><td><code>SELECT REPLACE(department, '部', '组')</code></td></tr><tr><td>UPPER/LOWER</td><td>大小写转换</td><td><code>SELECT UPPER('hello')</code> → HELLO</td></tr></tbody></table>
<h4 data-id="heading-31">数字函数</h4>

























<table><thead><tr><th>函数</th><th>作用</th><th>示例</th></tr></thead><tbody><tr><td>ROUND</td><td>四舍五入</td><td><code>SELECT ROUND(8.567, 2)</code> → 8.57</td></tr><tr><td>CEIL</td><td>向上取整</td><td><code>SELECT CEIL(8.1)</code> → 9</td></tr><tr><td>FLOOR</td><td>向下取整</td><td><code>SELECT FLOOR(8.9)</code> → 8</td></tr></tbody></table>
<h4 data-id="heading-32">日期函数(最常用)</h4>



































<table><thead><tr><th>函数</th><th>作用</th><th>示例</th></tr></thead><tbody><tr><td>NOW</td><td>当前时间</td><td><code>SELECT NOW()</code> → 2024-01-15 10:30:00</td></tr><tr><td>CURDATE</td><td>当前日期</td><td><code>SELECT CURDATE()</code> → 2024-01-15</td></tr><tr><td>DATE_FORMAT</td><td>格式化日期</td><td><code>SELECT DATE_FORMAT(hire_date, '%Y年%m月')</code></td></tr><tr><td>DATEDIFF</td><td>日期差(天)</td><td><code>SELECT DATEDIFF(NOW(), hire_date)</code></td></tr><tr><td>DATE_ADD</td><td>日期加减</td><td><code>SELECT DATE_ADD(NOW(), INTERVAL 7 DAY)</code></td></tr></tbody></table>
<p><strong>实用案例:查询入职超过1年的员工</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> name, hire_date, DATEDIFF(NOW(), hire_date) <span class="hljs-keyword">AS</span> 入职天数
<span class="hljs-keyword">FROM</span> employee
<span class="hljs-keyword">WHERE</span> DATEDIFF(NOW(), hire_date) <span class="hljs-operator">&gt;</span> <span class="hljs-number">365</span>;
</code></pre>
<blockquote>
<p>📸 <strong>截图5:</strong> 常用函数的执行结果(DATEDIFF、DATE_FORMAT的应用)</p>
</blockquote>
<hr/>
<h3 data-id="heading-33">八、综合实战案例</h3>
<h4 data-id="heading-34">案例1:查询技术部薪资&gt;8000且入职超过1年的员工</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> name, salary, hire_date, DATEDIFF(NOW(), hire_date) <span class="hljs-keyword">AS</span> 入职天数
<span class="hljs-keyword">FROM</span> employee
<span class="hljs-keyword">WHERE</span> department <span class="hljs-operator">=</span> <span class="hljs-string">'技术部'</span>
  <span class="hljs-keyword">AND</span> salary <span class="hljs-operator">&gt;</span> <span class="hljs-number">8000</span>
  <span class="hljs-keyword">AND</span> DATEDIFF(NOW(), hire_date) <span class="hljs-operator">&gt;</span> <span class="hljs-number">365</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> salary <span class="hljs-keyword">DESC</span>;
</code></pre>
<h4 data-id="heading-35">案例2:统计各部门平均工资&gt;7500的部门</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> department, 
       <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">AS</span> 人数,
       <span class="hljs-built_in">AVG</span>(salary) <span class="hljs-keyword">AS</span> 平均工资
<span class="hljs-keyword">FROM</span> employee
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department
<span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">AVG</span>(salary) <span class="hljs-operator">&gt;</span> <span class="hljs-number">7500</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> 平均工资 <span class="hljs-keyword">DESC</span>;
</code></pre>
<h4 data-id="heading-36">案例3:查询每个部门工资最高的员工(子查询)</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> e.name, e.department, e.salary
<span class="hljs-keyword">FROM</span> employee e
<span class="hljs-keyword">WHERE</span> e.salary <span class="hljs-operator">=</span> (
    <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">MAX</span>(salary) 
    <span class="hljs-keyword">FROM</span> employee 
    <span class="hljs-keyword">WHERE</span> department <span class="hljs-operator">=</span> e.department
);
</code></pre>
<blockquote>
<p>📸 <strong>截图6:</strong> 综合实战案例的执行结果</p>
</blockquote>
<hr/>
<h3 data-id="heading-37">九、性能优化要点</h3>
<h4 data-id="heading-38">1. 避免SELECT *</h4>
<p><code>SELECT *</code>会查出所有字段,浪费网络传输。需要啥查啥。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ✅ 好</span>
<span class="hljs-keyword">SELECT</span> name, salary <span class="hljs-keyword">FROM</span> employee;
</code></pre>
<h4 data-id="heading-39">2. 用LIMIT限制结果</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ✅ 好:只要前10条</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> employee <span class="hljs-keyword">WHERE</span> department <span class="hljs-operator">=</span> <span class="hljs-string">'技术部'</span> LIMIT <span class="hljs-number">10</span>;
</code></pre>
<h4 data-id="heading-40">3. WHERE中避免使用函数</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ❌ 差:索引失效,全表扫描</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> employee <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">YEAR</span>(hire_date) <span class="hljs-operator">=</span> <span class="hljs-number">2023</span>;

<span class="hljs-comment">-- ✅ 好:能用上索引</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> employee <span class="hljs-keyword">WHERE</span> hire_date <span class="hljs-operator">&gt;=</span> <span class="hljs-string">'2023-01-01'</span> <span class="hljs-keyword">AND</span> hire_date <span class="hljs-operator">&lt;</span> <span class="hljs-string">'2024-01-01'</span>;
</code></pre>
<p>WHERE中对字段使用函数会导致索引失效。具体原理第5讲《索引》详细讲解。</p>
<hr/>
<h3 data-id="heading-41">十、今天学了啥?快速回顾</h3>
<h4 data-id="heading-42">INSERT插入</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 单条插入</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> employee (name, salary) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'张三'</span>, <span class="hljs-number">8000</span>);

<span class="hljs-comment">-- 批量插入(推荐)</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> employee (name, salary) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'张三'</span>, <span class="hljs-number">8000</span>), (<span class="hljs-string">'李四'</span>, <span class="hljs-number">9000</span>);

<span class="hljs-comment">-- 忽略重复</span>
<span class="hljs-keyword">INSERT</span> IGNORE <span class="hljs-keyword">INTO</span> employee ...

<span class="hljs-comment">-- 重复就更新</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> employee ... <span class="hljs-keyword">ON</span> DUPLICATE KEY <span class="hljs-keyword">UPDATE</span> salary <span class="hljs-operator">=</span> <span class="hljs-number">9000</span>;
</code></pre>
<h4 data-id="heading-43">SELECT查询(重点)</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 条件查询</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> employee <span class="hljs-keyword">WHERE</span> department <span class="hljs-operator">=</span> <span class="hljs-string">'技术部'</span> <span class="hljs-keyword">AND</span> salary <span class="hljs-operator">&gt;</span> <span class="hljs-number">8000</span>;

<span class="hljs-comment">-- 排序</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> employee <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> salary <span class="hljs-keyword">DESC</span>;

<span class="hljs-comment">-- 分页</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> employee LIMIT <span class="hljs-number">10</span> <span class="hljs-keyword">OFFSET</span> <span class="hljs-number">20</span>;

<span class="hljs-comment">-- 聚合统计</span>
<span class="hljs-keyword">SELECT</span> department, <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>), <span class="hljs-built_in">AVG</span>(salary) 
<span class="hljs-keyword">FROM</span> employee 
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> department 
<span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">AVG</span>(salary) <span class="hljs-operator">&gt;</span> <span class="hljs-number">8000</span>;

<span class="hljs-comment">-- 关联查询</span>
<span class="hljs-keyword">SELECT</span> e.name, d.location
<span class="hljs-keyword">FROM</span> employee e
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> department d <span class="hljs-keyword">ON</span> e.department <span class="hljs-operator">=</span> d.dept_name;
</code></pre>
<h4 data-id="heading-44">UPDATE/DELETE(危险,必加WHERE)</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 先SELECT确认,再UPDATE</span>
<span class="hljs-keyword">UPDATE</span> employee <span class="hljs-keyword">SET</span> salary <span class="hljs-operator">=</span> <span class="hljs-number">9000</span> <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'张三'</span> LIMIT <span class="hljs-number">1</span>;

<span class="hljs-comment">-- 先SELECT确认,再DELETE</span>
<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> employee <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">5</span> LIMIT <span class="hljs-number">1</span>;
</code></pre>
<h4 data-id="heading-45">常用函数</h4>
<ul>
<li>字符串:CONCAT、LENGTH、SUBSTRING、REPLACE</li>
<li>数字:ROUND、CEIL、FLOOR</li>
<li>日期:NOW、DATEDIFF、DATE_FORMAT、DATE_ADD</li>
</ul>
<hr/>
<h3 data-id="heading-46">十一、作业:基于员工表的10个查询</h3>
<p>今天的作业是基于employee和department表,完成以下查询:</p>
<p><strong>基础查询(1-3):</strong></p>
<ol>
<li>查询所有员工的姓名和薪资</li>
<li>查询技术部的所有员工</li>
<li>查询薪资在7000-9000之间的员工</li>
</ol>
<p><strong>条件查询(4-6):</strong>
4. 查询薪资&gt;8000的员工,按薪资降序排列</p>
<ol start="5">
<li>查询姓"张"或"李"的员工</li>
<li>查询入职日期在2023年的员工</li>
</ol>
<p><strong>聚合统计(7-8):</strong>
7. 统计各部门的人数和平均薪资</p>
<ol start="8">
<li>查询薪资最高的前3名员工</li>
</ol>
<p><strong>复杂查询(9-10):</strong>
9. 查询各部门薪资最高的员工(用子查询)</p>
<ol start="10">
<li>查询员工和所在部门的城市(用JOIN)</li>
</ol>
<p><strong>提示:</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 第6题:查2023年的员工</span>
<span class="hljs-keyword">WHERE</span> hire_date <span class="hljs-operator">&gt;=</span> <span class="hljs-string">'2023-01-01'</span> <span class="hljs-keyword">AND</span> hire_date <span class="hljs-operator">&lt;</span> <span class="hljs-string">'2024-01-01'</span>

<span class="hljs-comment">-- 第9题:子查询</span>
<span class="hljs-keyword">WHERE</span> salary <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">MAX</span>(salary) <span class="hljs-keyword">FROM</span> employee <span class="hljs-keyword">WHERE</span> department <span class="hljs-operator">=</span> e.department)

<span class="hljs-comment">-- 第10题:关联查询</span>
<span class="hljs-keyword">FROM</span> employee e <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> department d <span class="hljs-keyword">ON</span> e.department <span class="hljs-operator">=</span> d.dept_name
</code></pre>
<p>把你的SQL写出来练习,加深理解!</p>
<hr/>
<h3 data-id="heading-47">十二、下一讲预告</h3>
<p>今天咱们把增删改查都搞定了。但还有个棘手的问题等着你。</p>
<p><strong>思考一个场景:</strong>
老板让你查: <strong>"每个部门薪资最高的前3名员工"</strong>。</p>
<p>用今天学的知识，你可能会想到:</p>
<ol>
<li>先查技术部前3名</li>
<li>再查市场部前3名</li>
<li>...如果有一百个部门，你要查一百次吗？</li>
</ol>
<p>或者写一个超级复杂的嵌套子查询，写到自己都晕了。</p>
<p>这就是<strong>第4讲:现代SQL高级特性——窗口函数与CTE</strong> 要解决的问题。</p>
<p>MySQL 8.0+引入了神器:</p>
<ul>
<li><strong>窗口函数(Window Functions):</strong> 解决排名、累计、同环比等复杂统计，一行代码搞定"每部门前3名"。</li>
<li><strong>CTE(公共表表达式):</strong> 把几十行的复杂SQL拆解成积木，清晰易读。</li>
</ul>
<p>这些特性是中高级开发的必杀技，学会了它们，你的SQL水平将直接上一个台阶！</p>
<p><strong>准备工作:</strong></p>
<ul>
<li>确保今天的JOIN和GROUP BY作业已完成</li>
<li>试着想一下，如果不学新特性，怎么查"每部门前3名"？(体验一下痛苦，下一讲会更爽)</li>
</ul>
<hr/>
<p><strong>下一讲见!咱们一起解锁SQL的"魔法"技能!</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[NewMatchPhraseQuery 与 NewMultiMatchQuery 原理及实践]]></title>    <link>https://juejin.cn/post/7577971299743629350</link>    <guid>https://juejin.cn/post/7577971299743629350</guid>    <pubDate>2025-11-30T14:46:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577971299743629350" data-draft-id="7577914902431334446" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="NewMatchPhraseQuery 与 NewMultiMatchQuery 原理及实践"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-30T14:46:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Penge666"/> <meta itemprop="url" content="https://juejin.cn/user/1549628692501449"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            NewMatchPhraseQuery 与 NewMultiMatchQuery 原理及实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1549628692501449/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Penge666
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T14:46:50.000Z" title="Sun Nov 30 2025 14:46:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 Elasticsearch 中，查询是数据检索的核心环节。<code>NewMatchPhraseQuery</code>（短语匹配查询）和<code>NewMultiMatchQuery</code>（多字段匹配查询）作为两种高频使用的查询类型，分别解决了 “精准短语检索” 和 “多字段灵活匹配” 的需求。本文将深入剖析这两种查询的底层原理、使用场景，并结合丰富示例讲解实践技巧，帮助开发者更好地驾驭 Elasticsearch 的检索能力。</p>
<h2 data-id="heading-0">一、NewMatchPhraseQuery：精准捕捉短语语义</h2>
<h3 data-id="heading-1">1.1 核心原理：位置敏感的短语匹配</h3>
<p><code>NewMatchPhraseQuery</code> 是对基础 <code>MatchQuery</code> 的升级，核心特点是<strong>严格匹配词条的顺序和位置关系</strong>。其底层依赖 Elasticsearch 的 “位置信息” 存储机制 —— 文档分词时，每个词条会被记录在字段中的位置偏移量（position）。</p>
<p>当执行短语匹配时，查询会：</p>
<ol>
<li>将查询字符串分词为若干词条（如 “hello world” 分为<code>hello</code>和<code>world</code>）；</li>
<li>要求目标字段中必须包含这些词条，且词条的位置偏移量需连续递增（<code>world</code>的位置必须是<code>hello</code>的位置 + 1）；</li>
<li>可选通过<code>slop</code>参数允许词条间存在少量位置偏差（如<code>slop=1</code>时，“hello elastic world” 也能匹配 “hello world”）。</li>
</ol>
<h3 data-id="heading-2">1.2 底层实现：PhraseQuery 的 Lucene 内核</h3>
<p>Elasticsearch 的<code>NewMatchPhraseQuery</code>本质上封装了 Lucene 的<code>PhraseQuery</code>，其检索流程为：</p>
<ul>
<li>先通过倒排索引找到包含所有查询词条的文档；</li>
<li>再校验这些词条在文档中的位置是否符合短语规则；</li>
<li>最终返回满足位置条件的文档，并按短语匹配度打分（匹配越精准，得分越高）。</li>
</ul>
<h3 data-id="heading-3">1.3 使用场景与示例</h3>
<p>适用于需要精准匹配连续短语的场景，如：</p>
<ul>
<li>检索名言、固定搭配（如 “Elasticsearch in Action”）；</li>
<li>商品型号、品牌标语的精确匹配；</li>
<li>避免歧义（如 “apple pie” 不会匹配 “apple tart pie”）。</li>
</ul>
<h4 data-id="heading-4">基础示例：严格短语匹配</h4>
<p>假设索引<code>articles</code>中有如下文档：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Elasticsearch实战：从入门到精通"</span>
<span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Elasticsearch入门指南与实战技巧"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>使用<code>NewMatchPhraseQuery</code>检索 “Elasticsearch 实战”：</p>
<p>运行</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">MatchPhraseQueryBuilder</span> <span class="hljs-variable">queryBuilder</span> <span class="hljs-operator">=</span> QueryBuilders.matchPhraseQuery(<span class="hljs-string">"content"</span>, <span class="hljs-string">"Elasticsearch实战"</span>);
<span class="hljs-type">SearchResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> client.prepareSearch(<span class="hljs-string">"articles"</span>)
    .setQuery(queryBuilder)
    .get();
</code></pre>
<p>结果：仅文档 1 匹配，因为 “Elasticsearch” 和 “实战” 在文档 1 中连续出现，文档 2 中两者被 “入门指南与” 隔开。</p>
<h4 data-id="heading-5">进阶示例：slop 参数允许位置偏差</h4>
<p>若设置<code>slop=2</code>：</p>
<p>运行</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">MatchPhraseQueryBuilder</span> <span class="hljs-variable">queryBuilder</span> <span class="hljs-operator">=</span> QueryBuilders.matchPhraseQuery(<span class="hljs-string">"content"</span>, <span class="hljs-string">"Elasticsearch实战"</span>)
    .slop(<span class="hljs-number">2</span>);
</code></pre>
<p>结果：文档 2 也会匹配，因为 “Elasticsearch” 和 “实战” 的位置差为 2，在<code>slop</code>允许范围内。</p>
<h4 data-id="heading-6">特殊场景：处理停用词</h4>
<p>若查询字符串包含停用词（如 “Elasticsearch 的实战”），分词后停用词 “的” 被过滤，可通过<code>zero_terms_query</code>参数控制：</p>
<p>运行</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">MatchPhraseQueryBuilder</span> <span class="hljs-variable">queryBuilder</span> <span class="hljs-operator">=</span> QueryBuilders.matchPhraseQuery(<span class="hljs-string">"content"</span>, <span class="hljs-string">"Elasticsearch 的实战"</span>)
    .zeroTermsQuery(MatchQuery.ZeroTermsQuery.ALL);
</code></pre>
<p>此时即使分词后无有效词条，也会返回所有文档（若设为<code>NONE</code>则无结果）。</p>
<h2 data-id="heading-7">二、NewMultiMatchQuery：多字段的灵活匹配</h2>
<h3 data-id="heading-8">2.1 核心原理：跨字段的联合检索</h3>
<p><code>NewMultiMatchQuery</code> 是<code>MatchQuery</code>的多字段扩展，支持同时在多个字段中匹配查询词条，并根据字段权重、匹配类型灵活调整检索策略。其核心逻辑是：</p>
<ol>
<li>将查询字符串分词后，在多个目标字段中分别执行匹配；</li>
<li>根据指定的<code>type</code>参数（如<code>best_fields</code>、<code>most_fields</code>、<code>cross_fields</code>）合并多字段的匹配结果；</li>
<li>按字段权重（<code>boost</code>）和匹配度计算最终得分。</li>
</ol>
<h3 data-id="heading-9">2.2 匹配类型（type）解析</h3>
<p><code>NewMultiMatchQuery</code> 的灵活性体现在<code>type</code>参数的多样化，不同类型对应不同的合并策略：</p>



































<table><thead><tr><th>类型</th><th>适用场景</th><th>原理简述</th></tr></thead><tbody><tr><td><code>best_fields</code></td><td>单字段精准匹配（默认）</td><td>取所有字段中匹配度最高的得分作为最终得分，适合 “只要一个字段匹配好即可” 的场景</td></tr><tr><td><code>most_fields</code></td><td>多字段互补匹配</td><td>累加所有字段的匹配得分，适合多字段包含同义表述的场景（如标题 + 正文）</td></tr><tr><td><code>cross_fields</code></td><td>跨字段短语匹配</td><td>将多个字段视为一个整体，按短语规则匹配（如姓名分姓、名字段）</td></tr><tr><td><code>phrase</code></td><td>多字段短语严格匹配</td><td>类似<code>MatchPhraseQuery</code>，但同时在多个字段中执行短语匹配</td></tr><tr><td><code>phrase_prefix</code></td><td>多字段短语前缀匹配</td><td>支持短语末尾词条的前缀匹配（如 “Elasticsearch rea” 匹配 “Elasticsearch real”）</td></tr></tbody></table>
<h3 data-id="heading-10">2.3 底层实现：多字段查询的合并策略</h3>
<p>Lucene 层面，<code>NewMultiMatchQuery</code>会为每个目标字段生成独立的查询（如<code>TermQuery</code>、<code>PhraseQuery</code>），再通过以下方式合并结果：</p>
<ul>
<li><code>best_fields</code>：取各字段查询的最高分；</li>
<li><code>most_fields</code>：累加各字段查询的得分；</li>
<li><code>cross_fields</code>：将多字段的倒排索引视为联合索引，按短语位置校验。</li>
</ul>
<h3 data-id="heading-11">2.4 使用场景与示例</h3>
<p>适用于需要在多个字段中检索同一关键词的场景，如：</p>
<ul>
<li>电商商品检索（标题、描述、品牌字段）；</li>
<li>全文检索（正文、摘要、标签字段）；</li>
<li>多字段组合匹配（姓名、手机号、邮箱字段）。</li>
</ul>
<h4 data-id="heading-12">示例 1：best_fields 类型（单字段最优匹配）</h4>
<p>假设索引<code>products</code>中有如下文档：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Elasticsearch教程"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"基础入门知识"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"tags"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"搜索引擎"</span>
<span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Java教程"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"包含Elasticsearch实战案例"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"tags"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"编程,数据库"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>使用<code>best_fields</code>类型检索 “Elasticsearch 教程”：</p>
<p>运行</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">MultiMatchQueryBuilder</span> <span class="hljs-variable">queryBuilder</span> <span class="hljs-operator">=</span> QueryBuilders.multiMatchQuery(
    <span class="hljs-string">"Elasticsearch教程"</span>, 
    <span class="hljs-string">"title"</span>, <span class="hljs-string">"description"</span>, <span class="hljs-string">"tags"</span>
).type(MultiMatchQueryBuilder.Type.BEST_FIELDS)
 .field(<span class="hljs-string">"title"</span>, <span class="hljs-number">2.0f</span>); <span class="hljs-comment">// title字段权重提升2倍</span>
</code></pre>
<p>结果：文档 1 得分更高（title 字段精准匹配），文档 2 因 description 字段包含部分关键词也会匹配，但得分较低。</p>
<h4 data-id="heading-13">示例 2：most_fields 类型（多字段得分累加）</h4>
<p>检索 “Elasticsearch 实战”，使用<code>most_fields</code>类型：</p>
<p>运行</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">MultiMatchQueryBuilder</span> <span class="hljs-variable">queryBuilder</span> <span class="hljs-operator">=</span> QueryBuilders.multiMatchQuery(
    <span class="hljs-string">"Elasticsearch实战"</span>, 
    <span class="hljs-string">"title"</span>, <span class="hljs-string">"description"</span>, <span class="hljs-string">"tags"</span>
).type(MultiMatchQueryBuilder.Type.MOST_FIELDS);
</code></pre>
<p>结果：若某文档的 title 含 “Elasticsearch”、description 含 “实战”，得分会累加，优先级高于仅单字段匹配的文档。</p>
<h4 data-id="heading-14">示例 3：cross_fields 类型（跨字段短语匹配）</h4>
<p>假设索引<code>users</code>中有如下文档：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"first_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Zhang"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"last_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"San"</span>
<span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"first_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"San"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"last_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Zhang"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>使用<code>cross_fields</code>类型检索 “Zhang San”：</p>
<p>运行</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">MultiMatchQueryBuilder</span> <span class="hljs-variable">queryBuilder</span> <span class="hljs-operator">=</span> QueryBuilders.multiMatchQuery(
    <span class="hljs-string">"Zhang San"</span>, 
    <span class="hljs-string">"first_name"</span>, <span class="hljs-string">"last_name"</span>
).type(MultiMatchQueryBuilder.Type.CROSS_FIELDS);
</code></pre>
<p>结果：文档 1 匹配（Zhang 在 first_name，San 在 last_name，位置连续），文档 2 不匹配（顺序相反）。</p>
<h4 data-id="heading-15">示例 4：phrase 类型（多字段短语匹配）</h4>
<p>检索 “Elasticsearch 实战”，要求多字段中短语连续匹配：</p>
<p>运行</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">MultiMatchQueryBuilder</span> <span class="hljs-variable">queryBuilder</span> <span class="hljs-operator">=</span> QueryBuilders.multiMatchQuery(
    <span class="hljs-string">"Elasticsearch实战"</span>, 
    <span class="hljs-string">"title"</span>, <span class="hljs-string">"description"</span>
).type(MultiMatchQueryBuilder.Type.PHRASE);
</code></pre>
<p>结果：仅当某字段中 “Elasticsearch” 和 “实战” 连续出现时才匹配。</p>
<h2 data-id="heading-16">三、两者对比与选型建议</h2>






























<table><thead><tr><th>特性</th><th>NewMatchPhraseQuery</th><th>NewMultiMatchQuery</th></tr></thead><tbody><tr><td>匹配维度</td><td>单字段、位置敏感</td><td>多字段、位置 / 字段联合敏感</td></tr><tr><td>核心优势</td><td>精准短语匹配</td><td>多字段灵活检索</td></tr><tr><td>性能</td><td>较高（需校验位置）</td><td>中等（多字段查询合并）</td></tr><tr><td>适用场景</td><td>固定短语、精准检索</td><td>多字段联合检索、模糊匹配</td></tr></tbody></table>
<p><strong>选型建议</strong>：</p>
<ul>
<li>若需严格匹配连续短语 → 选<code>NewMatchPhraseQuery</code>；</li>
<li>若需在多个字段中检索同一内容 → 选<code>NewMultiMatchQuery</code>；</li>
<li>若需跨字段短语匹配 → 用<code>NewMultiMatchQuery</code>的<code>cross_fields</code>或<code>phrase</code>类型；</li>
<li>若需优先单字段精准匹配 → 用<code>NewMultiMatchQuery</code>的<code>best_fields</code>类型；</li>
<li>若需多字段互补匹配 → 用<code>NewMultiMatchQuery</code>的<code>most_fields</code>类型。</li>
</ul>
<h2 data-id="heading-17">四、总结</h2>
<p><code>NewMatchPhraseQuery</code>和<code>NewMultiMatchQuery</code>是 Elasticsearch 中应对不同检索需求的利器：前者聚焦 “精准”，通过位置校验实现短语的严格匹配；后者聚焦 “灵活”，通过多字段联合检索覆盖更广泛的场景。理解两者的底层原理和适用场景，结合具体示例中的参数配置技巧，能帮助开发者在实际项目中构建更高效、精准的检索系统。</p>
<p>在实践中，还需结合分词器配置（如中文场景用 IK 分词器）、字段权重调整、<code>slop</code>参数优化等技巧，进一步提升检索效果。例如，对商品标题字段设置更高权重，对长文本字段合理调整<code>slop</code>值，均可让检索结果更贴合业务需求。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🚀从 autofit 到 vfit：Vue 开发者该选哪个大屏适配工具？]]></title>    <link>https://juejin.cn/post/7577970969395445801</link>    <guid>https://juejin.cn/post/7577970969395445801</guid>    <pubDate>2025-11-30T10:47:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577970969395445801" data-draft-id="7577797563854159908" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🚀从 autofit 到 vfit：Vue 开发者该选哪个大屏适配工具？"/> <meta itemprop="keywords" content="前端,Vue.js"/> <meta itemprop="datePublished" content="2025-11-30T10:47:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一颗烂土豆"/> <meta itemprop="url" content="https://juejin.cn/user/764915822371912"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🚀从 autofit 到 vfit：Vue 开发者该选哪个大屏适配工具？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/764915822371912/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一颗烂土豆
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T10:47:17.000Z" title="Sun Nov 30 2025 10:47:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    26
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/52f9c4c6fe764337bfb0ca45bd8f59f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA6aKX54OC5Zyf6LGG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765153722&amp;x-signature=Gm8%2F8wb80998yZrUHA9Vgem2Cl8%3D" alt="82124a861a16a62aeb0124414ab4f8ff7aabbfbf5eadf7-FP4HV4.png" loading="lazy"/>
在数据可视化和大屏开发中，"适配"永远是绕不开的话题。不同分辨率下如何保持元素比例、位置精准，往往让开发者头疼不已。
autofit.js 作为老牌适配工具，早已在许多项目中证明了价值；而新晋的 vfit 则专为 Vue 3 量身打造。今天我们就来深入对比这两款工具，看看谁更适合你的场景。</p>
<h2 data-id="heading-0">一、核心定位：通用方案 vs Vue 专属</h2>
<p>首先得明确两者的定位差异：</p>
<ul>
<li><strong>autofit.js</strong>：无框架依赖的通用缩放工具，通过计算容器与设计稿的比例，对整个页面进行缩放处理，核心逻辑是 <code>transform: scale(ratio)</code> 的全局应用。</li>
<li><strong>vfit.js</strong>：专为 Vue 3 设计的轻量方案，不仅提供全局缩放，更通过组件化思想解决<strong>精细定位</strong>问题，是"缩放+定位"的一体化方案。</li>
</ul>
<h2 data-id="heading-1">二、核心能力对比</h2>
<h3 data-id="heading-2">1. 缩放逻辑：全局统一 vs 灵活可控</h3>
<p>autofit.js 的缩放逻辑相对直接：</p>
<ul>
<li>计算容器宽高与设计稿的比例（取宽/高比例的最小值或按配置选择）</li>
<li>对目标容器应用整体缩放，实现"一缩全缩"</li>
</ul>
<p>vfit.js 则提供了更灵活的缩放策略：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// vfit 初始化配置</span>
<span class="hljs-built_in">createFitScale</span>({
  target: <span class="hljs-string">'#app'</span>,        <span class="hljs-comment">// 监听缩放的容器</span>
  designHeight: <span class="hljs-number">1080</span>,    <span class="hljs-comment">// 设计稿高度</span>
  designWidth: <span class="hljs-number">1920</span>,     <span class="hljs-comment">// 设计稿宽度</span>
  scaleMode: <span class="hljs-string">'auto'</span>      <span class="hljs-comment">// 缩放模式：auto/height/width</span>
})
</code></pre>
<ul>
<li> <code>auto</code> 模式会自动对比容器宽高比与设计稿比例，智能选择按宽或按高缩放</li>
<li>支持在组件内通过 <code>useFitScale()</code> 获取当前缩放值，实现局部自定义缩放</li>
</ul>
<h3 data-id="heading-3">2. 定位能力：粗犷适配 vs 精细控制</h3>
<p>这是两者最核心的差异。</p>
<p>autofit.js 由于是全局缩放，元素定位依赖原始 CSS 布局，在复杂场景下容易出现：</p>
<ul>
<li>固定像素定位的元素在缩放后偏离预期位置</li>
<li>相对定位元素在不同分辨率下比例失调</li>
</ul>
<p>vfit.js 则通过 <code>FitContainer</code> 组件解决了这个痛点，支持两种定位单位：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 百分比定位：位置不受缩放影响，适合居中场景 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">FitContainer</span> <span class="hljs-attr">:top</span>=<span class="hljs-string">"50"</span> <span class="hljs-attr">:left</span>=<span class="hljs-string">"50"</span> <span class="hljs-attr">unit</span>=<span class="hljs-string">"%"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"transform: translate(-50%, -50%)"</span>&gt;</span>居中内容<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">FitContainer</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 像素定位：位置随缩放自动计算，适合固定布局 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">FitContainer</span> <span class="hljs-attr">:top</span>=<span class="hljs-string">"90"</span> <span class="hljs-attr">:left</span>=<span class="hljs-string">"90"</span> <span class="hljs-attr">unit</span>=<span class="hljs-string">"px"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span>固定位置元素<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">FitContainer</span>&gt;</span>
</code></pre>
<ul>
<li> <code>unit="%"</code>：位置基于容器百分比，适合居中、靠边等相对位置</li>
<li> <code>unit="px"</code>：位置会自动乘以当前缩放值，保证设计稿像素与实际显示一致</li>
</ul>
<p>更贴心的是，vfit.js 还支持通过 <code>right/bottom</code> 定位，并自动处理不同原点的缩放计算（比如右上角、右下角）。</p>
<h3 data-id="heading-4">3. 框架融合：独立工具 vs Vue 生态</h3>
<p>autofit.js 作为独立库，需要手动在 Vue 项目中处理初始化时机（通常在 <code>onMounted</code> 中），且无法直接与 Vue 的响应式系统结合。</p>
<p>vfit.js 则完全融入 Vue 3 生态：</p>
<ul>
<li>通过 <code>app.use()</code> 安装，自动处理初始化时机</li>
<li>缩放值通过 <code>Ref</code> 实现响应式，组件内可实时获取</li>
<li><code>FitContainer</code> 组件支持 props 动态更新，适配动态布局场景</li>
</ul>
<h2 data-id="heading-5">三、适用场景分析</h2>



































<table><thead><tr><th>场景</th><th>更推荐</th><th>原因</th></tr></thead><tbody><tr><td>Vue 3 项目开发</td><td>vfit.js</td><td>组件化开发更自然，响应式集成更顺畅</td></tr><tr><td>非 Vue 项目（React/原生）</td><td>autofit.js</td><td>无框架依赖，通用性更强</td></tr><tr><td>简单大屏（整体缩放即可）</td><td>两者均可</td><td>autofit 配置更简单，vfit 稍重</td></tr><tr><td>复杂布局（多元素精细定位）</td><td>vfit.js</td><td>两种定位单位+组件化，解决位置偏移问题</td></tr><tr><td>需局部自定义缩放</td><td>vfit.js</td><td><code>useFitScale()</code> 可灵活控制局部元素</td></tr></tbody></table>
<h2 data-id="heading-6">四、迁移成本与上手难度</h2>
<ul>
<li>autofit.js：API 简单，几行代码即可初始化，学习成本低，适合快速接入简单场景。</li>
<li>vfit.js：需要理解组件化定位思想，初期有一定学习成本，但对于复杂场景，后期维护成本更低。</li>
</ul>
<p>如果你从 autofit.js 迁移到 vfit.js，只需：</p>
<ol>
<li>替换初始化方式（<code>app.use(createFitScale(...))</code>）</li>
<li>将需要定位的元素用 <code>FitContainer</code> 包裹</li>
<li>根据需求调整 <code>top/left</code> 与单位</li>
</ol>
<h2 data-id="heading-7">总结：没有最好，只有最合适</h2>
<p>autofit.js 胜在通用性和简单直接，适合非 Vue 项目或简单的全局缩放场景；而 vfit.js 则在 Vue 3 生态中展现了更强的针对性，通过组件化和精细定位，解决了复杂大屏的适配痛点。</p>
<p>如果你是 Vue 开发者，且正在为元素定位偏移烦恼，不妨试试 vfit——它可能正是你寻找的"Vue 大屏适配最优解"。</p>
<p>官网地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fweb-vfit.netlify.app" target="_blank" title="https://web-vfit.netlify.app" ref="nofollow noopener noreferrer">web-vfit.netlify.app</a>，可以直接在线体验效果～</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端如何自己实现一个webpack的热更新？]]></title>    <link>https://juejin.cn/post/7577970969395462185</link>    <guid>https://juejin.cn/post/7577970969395462185</guid>    <pubDate>2025-11-30T10:48:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577970969395462185" data-draft-id="7578037997323403283" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端如何自己实现一个webpack的热更新？"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-30T10:48:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小杨前端"/> <meta itemprop="url" content="https://juejin.cn/user/3024075490854636"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端如何自己实现一个webpack的热更新？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3024075490854636/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小杨前端
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T10:48:46.000Z" title="Sun Nov 30 2025 10:48:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在面试中，如果被要求<strong>手写一个 Webpack 的热更新（Hot Module Replacement，HMR）</strong> ，通常并不是真的让你从零开始完整实现一个像 Webpack 那样复杂的热更新系统（那涉及模块打包、依赖图、开发服务器、WebSocket通信等大量内容），而是考察你对 <strong>HMR 工作原理的理解</strong>，以及你是否能<strong>手动模拟一个简化版的热替换过程</strong>，比如：</p>
<ul>
<li>如何在不刷新页面的情况下替换某个模块；</li>
<li>如何通知浏览器某个模块更新了；</li>
<li>如何应用更新而不丢失应用状态。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c7fd84c64674b5580aaf2c10ce1eeb6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5p2o5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765104526&amp;x-signature=NjY1M0H8MtEiC4WgKK627qBgxzY%3D" alt="图片" loading="lazy"/></li>
</ul>
<hr/>
<h2 data-id="heading-0">一、面试时如何介绍 HMR（热更新）</h2>
<p>在开始写代码之前，<strong>先口述解释 HMR 是什么、为什么需要它、Webpack 中是怎么做的</strong>，这能体现你的理解深度，然后再进入“手写”部分。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b665e0b7c007402d830228eb57705810~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5p2o5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765104526&amp;x-signature=chJ3u%2BRFQgBTAM02Tj9xcz3fVTs%3D" alt="图片" loading="lazy"/></p>
<h3 data-id="heading-1">1. 什么是热模块替换（HMR）？</h3>
<blockquote>
<p>Hot Module Replacement（热模块替换），简称 HMR，是 Webpack 提供的一种<strong>在应用运行时动态替换、添加或删除模块而无需完全刷新页面</strong>的能力。</p>
</blockquote>
<h3 data-id="heading-2">2. 为什么需要 HMR？</h3>
<ul>
<li><strong>提升开发效率</strong>：修改代码后，不需要手动刷新页面，更新局部模块，保持应用状态（比如 Redux store、表单输入等）不丢失。</li>
<li><strong>更快的反馈循环</strong>：只更新你改动的部分，而不是整页刷新。</li>
<li><strong>更好的开发体验</strong>：特别是对于 SPA（单页应用），保持路由、状态等一致性非常重要。</li>
</ul>
<h3 data-id="heading-3">3. Webpack 中 HMR 的基本流程（简化版）</h3>
<ol>
<li><strong>开启 devServer 并启用 hot: true</strong></li>
<li><strong>Webpack 在编译时注入 HMR runtime 代码到 bundle</strong></li>
<li><strong>当文件修改时，Webpack 重新编译变动的模块</strong></li>
<li><strong>通过 WebSocket 将更新消息推送到客户端</strong></li>
<li><strong>客户端 HMR runtime 接收到更新，检查是否支持 HMR（模块是否有 accept 处理函数）</strong></li>
<li><strong>如果有 accept handler，则执行对应的更新逻辑，替换老模块；否则 fallback 到整页刷新</strong></li>
</ol>
<hr/>
<h2 data-id="heading-4">二、面试手写：简化版 HMR 实现思路</h2>
<p>面试官让你“手写 HMR”，通常是希望你<strong>模拟一个最简化的模块热替换过程</strong>，比如：</p>
<ul>
<li>模拟一个模块系统</li>
<li>模拟模块被更新</li>
<li>模拟不刷新页面而替换某个模块的逻辑</li>
</ul>
<p>我们可以用以下方式来模拟（以浏览器环境为例）：</p>
<hr/>
<h3 data-id="heading-5">场景设定</h3>
<p>假设我们有如下模块结构：</p>
<pre><code class="hljs language-css" lang="css">// moduleA<span class="hljs-selector-class">.jsmodule</span><span class="hljs-selector-class">.exports</span> = {  name: <span class="hljs-string">'Module A'</span>,  <span class="hljs-built_in">render</span>() {    console<span class="hljs-selector-class">.log</span>('Render <span class="hljs-selector-tag">from</span> Module <span class="hljs-selector-tag">A</span> - ', this<span class="hljs-selector-class">.name</span>);  }};
</code></pre>
<p>主文件：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// main.jsconst moduleA = require('./moduleA');</span>
function <span class="hljs-built_in">render</span>() {  moduleA<span class="hljs-selector-class">.render</span>();}
<span class="hljs-built_in">render</span>();
<span class="hljs-comment">// 模拟后续接收到了更新后的 moduleA，并进行热替换</span>
</code></pre>
<hr/>
<h3 data-id="heading-6">手写目标</h3>
<p>我们希望模拟：</p>
<ol>
<li>初始加载 moduleA，调用其 render 方法；</li>
<li>“模块更新了”（比如 moduleA.js 被修改了，导出的 name 变了）；</li>
<li>不刷新页面，把旧的 moduleA 替换成新的 moduleA；</li>
<li>再次调用 render，看到新的输出，证明模块被“热替换”成功。</li>
</ol>
<hr/>
<h3 data-id="heading-7">🛠️ 手写代码示例（简化模拟 HMR）</h3>
<p>你可以和面试官说：</p>
<blockquote>
<p>“在实际的 Webpack 中，HMR 是通过 webpack-dev-server + HMR runtime + WebSocket 等实现的，但为了简化，我这里手动模拟一个模块热替换的过程：即动态替换一个已加载的模块对象，并重新执行相关逻辑。”</p>
</blockquote>
<h4 data-id="heading-8">1. 原始模块定义（旧版本）</h4>
<pre><code class="hljs language-ini" lang="ini">// 模拟 moduleA 的初始版本let <span class="hljs-attr">moduleA</span> = {  name: <span class="hljs-string">'Module A (old)'</span>,  render() {    console.log(`[Render] <span class="hljs-variable">${this.name}</span>`)<span class="hljs-comment">;  }};</span>
</code></pre>
<h4 data-id="heading-9">2. 主程序</h4>
<pre><code class="hljs language-ini" lang="ini">// main.js（模拟入口文件）function renderApp() {  moduleA.render()<span class="hljs-comment">;}</span>
// 初次渲染renderApp()<span class="hljs-comment">; // 输出: [Render] Module A (old)</span>
// ===== 模拟模块更新 =====
// 假设经过一段时间，moduleA 被更新了（比如通过新的请求或者 websocket 通知）// 模拟“新版本的 moduleA”被加载进来const <span class="hljs-attr">newModuleA</span> = {  name: <span class="hljs-string">'Module A (hot updated!)'</span>,  render() {    console.log(`[Render] <span class="hljs-variable">${this.name}</span>`)<span class="hljs-comment">;  }};</span>
// 模拟 HMR 行为：用新模块替换旧模块console.log('\n🔁 模拟接收到 HMR 更新，替换 moduleA...\n')<span class="hljs-comment">;</span>
// 执行“热替换”：直接替换引用<span class="hljs-attr">moduleA</span> = newModuleA<span class="hljs-comment">;</span>
// 再次渲染，应该看到新的内容renderApp()<span class="hljs-comment">; // 输出: [Render] Module A (hot updated!)</span>
</code></pre>
<hr/>
<h3 data-id="heading-10">🧠 你在面试时可以这样讲解：</h3>
<blockquote>
<p>“在真实项目中，Webpack 的 HMR 是一个比较复杂的机制，它依赖于：</p>
<ul>
<li>webpack-dev-server 提供热更新服务；</li>
<li>webpack 在编译时注入 HMR runtime；</li>
<li>文件改动后 webpack 重新编译变动模块，生成更新后的模块代码；</li>
<li>通过 WebSocket 将更新推送至浏览器端；</li>
<li>客户端的 HMR runtime 接收更新，判断该模块是否注册了 accept handler，如果有则执行模块替换逻辑，否则 fallback 到整页刷新。</li>
</ul>
<p>但为了简化理解，我这里手动模拟了一个最基础的“模块热替换”过程：</p>
<ol>
<li>我们有一个模块 moduleA，它被主程序引用并调用；</li>
<li>然后我们模拟这个模块被更新了（比如你修改了源码，重新构建后得到了新的 moduleA 对象）；</li>
<li>我们不刷新页面，而是直接将全局变量 moduleA 指向新的模块对象，从而实现“模块热替换”；</li>
<li>再次调用模块方法时，输出已经改变，代表模块行为已被更新。</li>
</ol>
<p>当然，这只是非常简化版的模拟。实际中每个模块可能被多个地方引用，还要处理模块依赖图、模块包装、accept 回调、CSS 热更新、React/Vue 组件热替换等复杂逻辑。Webpack 通过 <strong>webpack_require</strong>.hmr 等机制管理这些。”</p>
</blockquote>
<hr/>
<h2 data-id="heading-11">三、进一步：如果你想更贴近真实 HMR，可以提及以下点（加分项）</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28162e4a6319452588ea14301d03b5ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5p2o5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765104526&amp;x-signature=OyXCs2nq1lsiwn2f1DkjBW9Leqs%3D" alt="图片" loading="lazy"/>如果面试官感兴趣，你可以继续深入，提到以下真实 HMR 中的关键点：</p>





































<table><thead><tr><th>关键点</th><th>说明</th></tr></thead><tbody><tr><td><strong>webpack-dev-server</strong></td><td>提供开发时 server 和热更新能力，基于 Express + WebSocket</td></tr><tr><td><strong>HMR Runtime</strong></td><td>Webpack 注入到 bundle 中的一段 JS，负责接收更新、应用模块替换</td></tr><tr><td><strong>WebSocket 通信</strong></td><td>devServer 通过 WebSocket 告诉客户端哪些模块更新了</td></tr><tr><td><strong>manifest（json）和 chunk 更新</strong></td><td>更新后的模块内容通常通过 HTTP 请求获取，比如 jsonp 或 fetch</td></tr><tr><td><strong>模块接受（module.accept）</strong></td><td>模块可以声明自己支持热更新，提供回调函数处理更新逻辑</td></tr><tr><td><strong>HotModuleReplacementPlugin</strong></td><td>Webpack 插件，启用 HMR 功能</td></tr><tr><td><strong>React/Vue 的 HMR 支持</strong></td><td>它们基于 HMR 接口做了封装，比如 React Fast Refresh、Vue Loader 等</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-12">四、总结：面试回答结构建议</h2>
<p>当面试官说：“你来手写一个 Webpack 的热更新”，你可以按如下结构回答：</p>
<ol>
<li><strong>先解释 HMR 是什么，为什么需要它</strong></li>
<li>
<ul>
<li>不刷新页面更新模块，保持状态，提高开发效率</li>
</ul>
</li>
<li><strong>简述 Webpack 中 HMR 的工作流程</strong></li>
<li>
<ul>
<li>devServer + HMR runtime + WebSocket + 模块热替换策略</li>
</ul>
</li>
<li><strong>然后说：为了简化，我手动模拟一个最基础的模块替换过程</strong></li>
<li>
<ul>
<li>展示代码：旧模块 → 模拟更新 → 替换模块引用 → 新模块生效</li>
</ul>
</li>
<li><strong>最后点出真实 HMR 更复杂，包括 runtime、依赖管理、accept handler、插件等</strong></li>
<li>
<ul>
<li>表现出你对整体原理有了解，不是只会写玩具代码</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-13">附：完整可运行的简化模拟代码（供你复习用）</h2>
<p>你可以将以下代码保存为 HTML 或在 Node.js 中以适当方式模拟（这里以浏览器全局变量模拟）：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>简化版 HMR 模拟<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">  <span class="hljs-comment">// 模拟原始 moduleA  let moduleA = {    name: 'Module A (old)',    render() {      console.log(`[Render] ${this.name}`);    }  };</span>
  <span class="hljs-comment">// 主程序  function renderApp() {    moduleA.render();  }</span>
  <span class="hljs-title function_">renderApp</span>(); <span class="hljs-comment">// [Render] Module A (old)</span>
  <span class="hljs-comment">// ===== 模拟模块热更新 =====  console.log('\n🔁 模拟：收到新模块，进行热替换...\n');</span>
  <span class="hljs-comment">// 模拟从服务器获取了新的 moduleA  const newModuleA = {    name: 'Module A (HOT UPDATED!)',    render() {      console.log(`[Render] ${this.name}`);    }  };</span>
  <span class="hljs-comment">// 执行“热替换”：直接替换模块引用  moduleA = newModuleA;</span>
  <span class="hljs-comment">// 再次调用  renderApp(); // [Render] Module A (HOT UPDATED!)</span></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>运行后你会看到控制台先输出旧模块内容，然后模拟更新后输出新模块内容，模块被“热替换”成功。</p>
<hr/>
<h2 data-id="heading-14">总结一句话</h2>
<blockquote>
<p>“手写 HMR” ≠ 写一个完整的 webpack HMR 系统，而是考察你理解模块热替换的核心思想 + 能否用简单代码模拟“模块更新且不刷新页面”的过程。抓住“模块替换 + 状态保持 + 开发效率”几个关键词，同时展示你对 Webpack 原理的了解，就能在面试中脱颖而出。</p>
</blockquote>
<p>如你真遇到要写“完整 HMR 系统”，那通常是系统设计类题目，而非手写题 😄。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Figma画布协议揭秘：组件实例的SymbolOverrides覆盖机制]]></title>    <link>https://juejin.cn/post/7578037997323419667</link>    <guid>https://juejin.cn/post/7578037997323419667</guid>    <pubDate>2025-11-30T11:27:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578037997323419667" data-draft-id="7577970969395494953" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Figma画布协议揭秘：组件实例的SymbolOverrides覆盖机制"/> <meta itemprop="keywords" content="前端,Canvas"/> <meta itemprop="datePublished" content="2025-11-30T11:27:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="听风说图"/> <meta itemprop="url" content="https://juejin.cn/user/198345371681864"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Figma画布协议揭秘：组件实例的SymbolOverrides覆盖机制
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/198345371681864/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    听风说图
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T11:27:47.000Z" title="Sun Nov 30 2025 11:27:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本文将带你走进 Figma 底层协议，探索组件与实例之间"既统一又差异"的魔法是如何实现的。</p>
<h2 data-id="heading-0">认识组件与实例</h2>
<h3 data-id="heading-1">什么是组件(Component)？</h3>
<p>在 Figma 中，<strong>组件</strong>是一种可复用的设计元素。你可以把它理解为一个"模板"或"蓝图"。当你将一个图层或图层组转换为组件后，它就成为了一个可以被多次引用的主体（Master Component）。</p>
<h3 data-id="heading-2">什么是实例(Instance)？</h3>
<p><strong>实例</strong>是组件的"克隆体"，它引用了组件的所有属性，但同时又可以拥有自己的个性化修改。每当你从组件创建一个副本，这个副本就是一个实例。</p>
<h3 data-id="heading-3">为什么需要组件和实例？</h3>
<p>组件和实例的设计解决了两个核心问题：</p>
<ol>
<li><strong>一致性</strong>：当你修改组件时，所有实例会自动同步更新，确保设计系统的一致性</li>
<li><strong>灵活性</strong>：实例可以覆盖组件的部分属性（如颜色、文字、大小等），在保持整体风格统一的同时允许个性化定制</li>
</ol>
<p>这种机制让设计师能够高效地管理大规模设计系统——只需维护少量组件，就能衍生出成千上万个具有细微差异的实例。</p>
<h3 data-id="heading-4">组件与实例的交互演示</h3>
<p><em>实例跟随组件</em><br/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/68c64920f32347e88095e998f5c1932e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCs6aOO6K-05Zu-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765106867&amp;x-signature=bECSKPhPs50cj2zg27OfrIZTFXg%3D" alt="" loading="lazy"/><br/>
<em>实例覆盖组件</em><br/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c42724c7a69f466d911f01fa74585304~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCs6aOO6K-05Zu-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765106867&amp;x-signature=4DvmT0%2FnlHBbalouFpwkx49CLqU%3D" alt="" loading="lazy"/><br/>
<em>嵌套实例</em><br/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/82b3824fbde44d89bc5c705a4d1735cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCs6aOO6K-05Zu-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765106867&amp;x-signature=IEH%2F4%2B7TaYZNTlkTPeyRwU5SzPQ%3D" alt="" loading="lazy"/><br/>
<em>嵌套实例覆盖组件</em><br/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea87ba01a3414354bee77065726d2769~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCs6aOO6K-05Zu-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765106867&amp;x-signature=NaKQ1Fial%2BRGtkIjKVr%2BmR%2FgSBk%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">认识SymbolOverrides</h2>
<h3 data-id="heading-6">SymbolOverrides 是什么？</h3>
<p>在 Figma 的底层协议中，<strong>SymbolOverrides</strong> 是实现实例差异化的核心数据结构。当一个实例需要覆盖组件的某些属性时，Figma 并不会复制整个组件的数据，而是只记录"差异部分"——这就是 SymbolOverrides。</p>
<h3 data-id="heading-7">工作原理</h3>
<p>SymbolOverrides 的工作机制可以概括为：</p>
<ol>
<li><strong>引用组件</strong>：通过 <code>symbolID</code> 指向原始组件</li>
<li><strong>路径寻址</strong>：通过 <code>guidPath.guids</code> 精确定位到组件内部的某个子节点</li>
<li><strong>属性覆盖</strong>：只存储被修改的属性值，未修改的属性继承自组件</li>
</ol>
<p>这种"增量存储"的设计非常高效——无论组件有多复杂，实例只需要存储它与组件不同的那部分数据。</p>
<h3 data-id="heading-8">关键字段解析</h3>





























<table><thead><tr><th><strong>字段</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td><code>symbolID</code></td><td>指向主组件的唯一标识符，由 <code>sessionID</code>和 <code>localID</code>组成</td></tr><tr><td><code>symbolOverrides</code></td><td>覆盖项数组，每项代表一个被修改的子节点</td></tr><tr><td><code>guidPath.guids</code></td><td>GUID 路径，用于在组件层级中定位目标节点</td></tr><tr><td><code>fillPaints</code>/ <code>strokePaints</code></td><td>覆盖的填充/描边样式</td></tr><tr><td><code>strokeWeight</code></td><td>覆盖的描边粗细</td></tr></tbody></table>
<h3 data-id="heading-9">实际数据示例</h3>
<p>下面是一个实例覆盖组件属性的真实 Figma 协议数据：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"symbolData"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"symbolID"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                <span class="hljs-attr">"sessionID"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
                <span class="hljs-attr">"localID"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span>
            <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"symbolOverrides"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
                <span class="hljs-punctuation">{</span>
                    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"IRectangle 1"</span><span class="hljs-punctuation">,</span>
                    <span class="hljs-attr">"guidPath"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"guids"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
                            <span class="hljs-punctuation">{</span>
                                <span class="hljs-attr">"sessionID"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
                                <span class="hljs-attr">"localID"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span>
                            <span class="hljs-punctuation">}</span>
                        <span class="hljs-punctuation">]</span>
                    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
                    <span class="hljs-attr">"strokeWeight"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span>
                    <span class="hljs-attr">"fillPaints"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
                        <span class="hljs-punctuation">{</span>
                            <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"SOLID"</span><span class="hljs-punctuation">,</span>
                            <span class="hljs-attr">"color"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                                <span class="hljs-attr">"r"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
                                <span class="hljs-attr">"g"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.5240384340286255</span><span class="hljs-punctuation">,</span>
                                <span class="hljs-attr">"b"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.881009578704834</span><span class="hljs-punctuation">,</span>
                                <span class="hljs-attr">"a"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span>
                            <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
                            <span class="hljs-attr">"opacity"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
                            <span class="hljs-attr">"visible"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
                            <span class="hljs-attr">"blendMode"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"NORMAL"</span>
                        <span class="hljs-punctuation">}</span>
                    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
                    <span class="hljs-attr">"strokePaints"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
                        <span class="hljs-punctuation">{</span>
                            <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"SOLID"</span><span class="hljs-punctuation">,</span>
                            <span class="hljs-attr">"color"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                                <span class="hljs-attr">"r"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.24366332590579987</span><span class="hljs-punctuation">,</span>
                                <span class="hljs-attr">"g"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.08466623723506927</span><span class="hljs-punctuation">,</span>
                                <span class="hljs-attr">"b"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.9519230723381042</span><span class="hljs-punctuation">,</span>
                                <span class="hljs-attr">"a"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span>
                            <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
                            <span class="hljs-attr">"opacity"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
                            <span class="hljs-attr">"visible"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
                            <span class="hljs-attr">"blendMode"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"NORMAL"</span>
                        <span class="hljs-punctuation">}</span>
                    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
                    <span class="hljs-attr">"borderTopWeight"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span>
                    <span class="hljs-attr">"borderBottomWeight"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span>
                    <span class="hljs-attr">"borderLeftWeight"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span>
                    <span class="hljs-attr">"borderRightWeight"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span>
                <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
                <span class="hljs-punctuation">{</span>
                    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"IC1"</span><span class="hljs-punctuation">,</span>
                    <span class="hljs-attr">"guidPath"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"guids"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
                            <span class="hljs-punctuation">{</span>
                                <span class="hljs-attr">"sessionID"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
                                <span class="hljs-attr">"localID"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span>
                            <span class="hljs-punctuation">}</span>
                        <span class="hljs-punctuation">]</span>
                    <span class="hljs-punctuation">}</span>
                <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
                <span class="hljs-punctuation">{</span>
                    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"IStar 1"</span><span class="hljs-punctuation">,</span>
                    <span class="hljs-attr">"guidPath"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"guids"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
                            <span class="hljs-punctuation">{</span>
                                <span class="hljs-attr">"sessionID"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
                                <span class="hljs-attr">"localID"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5</span>
                            <span class="hljs-punctuation">}</span>
                        <span class="hljs-punctuation">]</span>
                    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
                    <span class="hljs-attr">"strokeWeight"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span>
                    <span class="hljs-attr">"fillPaints"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
                        <span class="hljs-punctuation">{</span>
                            <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"SOLID"</span><span class="hljs-punctuation">,</span>
                            <span class="hljs-attr">"color"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                                <span class="hljs-attr">"r"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.4491417109966278</span><span class="hljs-punctuation">,</span>
                                <span class="hljs-attr">"g"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.9615384340286255</span><span class="hljs-punctuation">,</span>
                                <span class="hljs-attr">"b"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.3074149489402771</span><span class="hljs-punctuation">,</span>
                                <span class="hljs-attr">"a"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span>
                            <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
                            <span class="hljs-attr">"opacity"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
                            <span class="hljs-attr">"visible"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
                            <span class="hljs-attr">"blendMode"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"NORMAL"</span>
                        <span class="hljs-punctuation">}</span>
                    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
                    <span class="hljs-attr">"strokePaints"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
                        <span class="hljs-punctuation">{</span>
                            <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"SOLID"</span><span class="hljs-punctuation">,</span>
                            <span class="hljs-attr">"color"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                                <span class="hljs-attr">"r"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.24366332590579987</span><span class="hljs-punctuation">,</span>
                                <span class="hljs-attr">"g"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.08466623723506927</span><span class="hljs-punctuation">,</span>
                                <span class="hljs-attr">"b"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.9519230723381042</span><span class="hljs-punctuation">,</span>
                                <span class="hljs-attr">"a"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span>
                            <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
                            <span class="hljs-attr">"opacity"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
                            <span class="hljs-attr">"visible"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
                            <span class="hljs-attr">"blendMode"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"NORMAL"</span>
                        <span class="hljs-punctuation">}</span>
                    <span class="hljs-punctuation">]</span>
                <span class="hljs-punctuation">}</span>
            <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"uniformScaleFactor"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span>
        <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-10">数据解读</h3>
<p>从上面的示例数据可以看出：</p>
<p>每个覆盖项通过 <code>guidPath.guids</code> 中的 GUID 精确定位到组件内的目标节点。对于嵌套实例的情况，<code>guids</code> 数组会包含多个元素，形成一条从外到内的访问路径。</p>
<h2 data-id="heading-11">总结</h2>
<p>通过本文，我们深入了解了 Figma 组件系统背后的协议实现：</p>
<ol>
<li><strong>组件与实例</strong>是 Figma 设计系统的基石，前者提供"统一性"，后者提供"灵活性"</li>
<li><strong>SymbolOverrides</strong>是实现实例差异化的核心机制，采用"增量存储"策略，只记录与组件不同的属性</li>
<li><strong>GUID 路径寻址</strong>让 Figma 能够精确定位组件内部的任意子节点，支持任意深度的嵌套覆盖</li>
</ol>
<p>理解 SymbolOverrides 机制，是深入 Figma 画布协议、实现 Figma 文件解析或构建兼容工具的重要一步。</p>
<hr/>
<p><em>本文是 Figma 协议解析系列的一部分，更多内容敬请期待。</em></p>
<p><em>更多精彩内容可关注</em><a href="https://link.juejin.cn?target=https%3A%2F%2F01joy.com%2F" target="_blank" title="https://01joy.com/" ref="nofollow noopener noreferrer">风起的博客</a> <em>，微信公众号：听风说图</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[效能工具十之接入deepseek实现AI学习PDF文档读后感文件批量生成功能]]></title>    <link>https://juejin.cn/post/7578003302487425024</link>    <guid>https://juejin.cn/post/7578003302487425024</guid>    <pubDate>2025-11-30T11:52:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578003302487425024" data-draft-id="7577713754564132916" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="效能工具十之接入deepseek实现AI学习PDF文档读后感文件批量生成功能"/> <meta itemprop="keywords" content="OpenAI,DeepSeek,Express"/> <meta itemprop="datePublished" content="2025-11-30T11:52:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="水冗水孚"/> <meta itemprop="url" content="https://juejin.cn/user/1406974769508679"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            效能工具十之接入deepseek实现AI学习PDF文档读后感文件批量生成功能
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1406974769508679/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    水冗水孚
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T11:52:19.000Z" title="Sun Nov 30 2025 11:52:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">前言</h2>
<p>看文，看的是一种思路，希望笔者的文章能给诸位带来一些灵感思路☺️☺️☺️</p>
<h3 data-id="heading-1">历史效能工具文章</h3>
<p>文本是效能工具系列文章的第九篇，前八篇分别是</p>
<ul>
<li><a href="https://juejin.cn/post/7271964525996671028" target="_blank" title="https://juejin.cn/post/7271964525996671028">效能工具之node在项目中的应用（一）《以表格的二次封装需要的配置化JSON为例》</a></li>
<li><a href="https://juejin.cn/post/7275576074590568500" target="_blank" title="https://juejin.cn/post/7275576074590568500">效能工具之node在项目中的应用（二）《以开发环境多后端服务切换问题为例》</a></li>
<li><a href="https://juejin.cn/post/7283459207697874959" target="_blank" title="https://juejin.cn/post/7283459207697874959">效能工具之node在项目中的应用（三）《以给几百个el-select统一加filterable属性可搜索为例》</a></li>
<li><a href="https://juejin.cn/post/7303841665239892008" target="_blank" title="https://juejin.cn/post/7303841665239892008">效能工具之批处理文件.bat/.cmd在工作中的应用（四）《以多项目启动为例》</a></li>
<li><a href="https://juejin.cn/post/7330549231935766563" target="_blank" title="https://juejin.cn/post/7330549231935766563">效能工具之前端自动化部署打包发布上传脚本（五）命令行加载、上传进度功能</a></li>
<li><a href="https://juejin.cn/post/7399109720457560105" target="_blank" title="https://juejin.cn/post/7399109720457560105">vue3中用MutationObserver采取hook方式实现视频的不可拖拽功能&amp;&amp;效能工具（六）一键提交git代码的bat脚本</a></li>
<li><a href="https://juejin.cn/post/7465578686533173300" target="_blank" title="https://juejin.cn/post/7465578686533173300">效能工具（七）之在Windows系统的Startup文件夹添加bat脚本开机自启动nginx或者一些软件服务</a></li>
<li><a href="https://juejin.cn/post/7501266938107985971" target="_blank" title="https://juejin.cn/post/7501266938107985971">效能工具（八）之vite开发或生产环境下的命令行变量传参（比如启动项目时多视图选择其一）</a></li>
</ul>
<h2 data-id="heading-2">业务需求场景描述</h2>
<ul>
<li>公司每个月都会安排员工学习一个pdf文档（有点形式主义的学习）</li>
<li>然后，根据文档内容写一篇500字左右读后感txt</li>
<li>员工都是把文档丢给AI让其帮忙写读后感</li>
<li>一个员工每个月要花费10分钟，几十个员工，就累计是几个小时的成本</li>
<li>人越多，成本越高</li>
<li>针对于这个情况，笔者思考，倒不如写一个工具</li>
<li><strong>由专人在月末的时候，直接通过工具，点一点，一键生成几十份甚至上百份的学后感</strong></li>
<li>如此这般，就能够进行相应的提效</li>
</ul>
<h2 data-id="heading-3">代码实现</h2>
<h3 data-id="heading-4">技术选型</h3>
<ul>
<li>首先是pdf的文字提取，这里使用FileReader去读取需要学习的pdf文件（上传pdf）</li>
<li>然后，把读取到的数据，交给<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fpdfjs-dist%3FactiveTab%3Dreadme" target="_blank" title="https://www.npmjs.com/package/pdfjs-dist?activeTab=readme" ref="nofollow noopener noreferrer">pdf-dist</a>中的pdf.js和pdf.worker.js</li>
<li>这里就可以拿到pdf中的所有文字信息了（包括页码数）</li>
<li>再然后，把pdf中的文字信息作为user的内容</li>
<li>再提前写好系统级的提示词内容</li>
<li>丢给deepseek的接口返回给前端</li>
<li>前端再通过<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Ffile-saver%3FactiveTab%3Dversions" target="_blank" title="https://www.npmjs.com/package/file-saver?activeTab=versions" ref="nofollow noopener noreferrer">file-saver.js</a>下载对应的内容即可做到生成pdf学后感txt文本的功能</li>
<li>生成多份，就批量请求一下接口，整体Promise.allSettled一下即可</li>
<li>最终，再使用<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fjszip" target="_blank" title="https://www.npmjs.com/package/jszip" ref="nofollow noopener noreferrer">jszip</a>把所有的txt打包成一个压缩包，直接下载了</li>
</ul>
<h3 data-id="heading-5">deepseek开放平台注册API keys</h3>
<p>地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.deepseek.com%2Fapi_keys" target="_blank" title="https://platform.deepseek.com/api_keys" ref="nofollow noopener noreferrer">platform.deepseek.com/api_keys</a></p>
<p>截图：</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8701c154f61a45daa0cfaaae03464196~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rC05YaX5rC05a2a:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765108338&amp;x-signature=itFm8CXtwFM6ExqX9OqXbtf919g%3D" alt="1111111.png" width="70%" loading="lazy"/>
<p>当然，需要充点两块钱，如下：</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ace44836afa419da683e112e216c551~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rC05YaX5rC05a2a:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765108338&amp;x-signature=syYqWMJd72Sm6%2Fjuru6LsrFYsP4%3D" alt="222.png" width="70%" loading="lazy"/>
<blockquote>
<p>实际上，大模型的生成文字的token一般都不贵，笔者测算了一下，<strong>生成50篇500字的txt文，成本不到一毛钱</strong></p>
</blockquote>
<h3 data-id="heading-6">使用express框架通过openai包调用deepseek的服务</h3>
<p>有了deepseek的API keys且账户有钱后，就可以在服务端调用了，通过npm安装openai这个包</p>
<pre><code class="hljs language-json" lang="json">  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"express"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^5.1.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"openai"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^6.9.1"</span>
  <span class="hljs-punctuation">}</span>
</code></pre>
<blockquote>
<p>笔者这里使用的是express</p>
</blockquote>
<p>如下：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> express <span class="hljs-keyword">from</span> <span class="hljs-string">'express'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">OpenAI</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"openai"</span>;

<span class="hljs-comment">// 初始化 OpenAI</span>
<span class="hljs-keyword">const</span> openai = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OpenAI</span>({
    <span class="hljs-attr">baseURL</span>: <span class="hljs-string">'https://api.deepseek.com'</span>,
    <span class="hljs-attr">apiKey</span>: <span class="hljs-string">'sk-27cae***********************1093'</span>, <span class="hljs-comment">// 换成自己的</span>
});

<span class="hljs-keyword">const</span> systemContent = <span class="hljs-string">`系统级提示词高权重，用于规范限定回答内容`</span>;

app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/api/chat'</span>, <span class="hljs-keyword">async</span> (req, res) =&gt; {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> { content } = req.<span class="hljs-property">body</span>;

        <span class="hljs-keyword">if</span> (!content) {
            <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'请提供要学习的内容'</span> });
        }

        <span class="hljs-keyword">const</span> completion = <span class="hljs-keyword">await</span> openai.<span class="hljs-property">chat</span>.<span class="hljs-property">completions</span>.<span class="hljs-title function_">create</span>({
            <span class="hljs-attr">messages</span>: [
                { <span class="hljs-attr">role</span>: <span class="hljs-string">"system"</span>, <span class="hljs-attr">content</span>: systemContent },
                { <span class="hljs-attr">role</span>: <span class="hljs-string">"user"</span>, <span class="hljs-attr">content</span>: content },
            ],
            <span class="hljs-attr">model</span>: <span class="hljs-string">"deepseek-chat"</span>,
        });
        <span class="hljs-keyword">const</span> result = completion.<span class="hljs-property">choices</span>[<span class="hljs-number">0</span>]?.<span class="hljs-property">message</span>?.<span class="hljs-property">content</span>;
        res.<span class="hljs-title function_">json</span>({ result });
    } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'API 调用失败:'</span>, error);
        res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: error.<span class="hljs-property">message</span> || <span class="hljs-string">'API 调用失败'</span> });
    }
});
</code></pre>
<h3 data-id="heading-7">编写系统级提示词</h3>
<p>上述的systemContent可以根据实际业务情况，进行适当编写</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> systemContent =
<span class="hljs-string">`
你是一个热爱中国的优秀员工。
所在的公司是xxx。
所在的部门是yyy。
仔细阅读用户提供的学习内容材料，并返回一段学习学后感。

格式要求：
- 纯文本格式，不要使用markdown
- 字数控制在400-600个字符之间
- 使用第一人称"我"来叙述

内容要求：
1. 学后感要简洁明了，逻辑清晰
2. 内容要符合实际
3. 要体现...
4. 要结合学习材料的具体内容，不能泛泛而谈
5. 要实事求是，言之有物，避免空话套话
6. 注意分段落

多样性要求：
- 每次生成都要使用不同的表达方式、不同的角度和不同的案例
- 避免使用重复的词语、句子和段落结构
- 确保每次生成的学后感都是全新的内容

重要提醒：
- 返回的内容必须符合中国的法律法规
- 要结合学习材料的具体内容进行深入思考
- 不要使用缓存！
`</span>;
</code></pre>
<h3 data-id="heading-8">快速理解什么是提示词？</h3>
<ul>
<li>ai交互的核心就是系统级提示词（System Prompt）和用户提示词（User Prompt）</li>
</ul>
<p>如下表</p>






























<table><thead><tr><th>维度</th><th>系统级提示词</th><th>用户提示词</th></tr></thead><tbody><tr><td>生效范围</td><td>全局生效（所有对话轮次）</td><td>仅当前 / 指定轮次生效</td></tr><tr><td>优先级</td><td>更高（覆盖用户提示词冲突项）</td><td>服从系统规则</td></tr><tr><td>核心目的</td><td>设定规则与角色</td><td>提出具体问题 / 需求</td></tr><tr><td>可见性</td><td>通常对用户不可见（后台配置）</td><td>用户主动输入，完全可见</td></tr></tbody></table>
<p>比如，有如下场景</p>
<ul>
<li>
<p><strong>客服智能问答场景</strong>：系统提示词定义 “语气友好、优先解决用户问题、无法解答时引导转人工”，用户仅需提问 “我的订单为什么没发货”，AI 就会按该规则响应；</p>
</li>
<li>
<p><strong>AI创作场景</strong>：系统提示词设定 “风格为悬疑短篇、字数 500 字以内、结尾留悬念”，用户仅需说 “以雨夜为背景写一个故事”，AI 的输出就会贴合这些要求。</p>
</li>
</ul>
<blockquote>
<p>系统级提示词有点像cosplay的身份角色背景设定...</p>
</blockquote>
<p>所以，上述systemContent才会定义成为那样的</p>
<p>现在，有了接口了<code>app.post('/api/chat', async (req, res) =&gt; { ... })</code></p>
<p>这样的话，前端就可以做对应请求数据，下载操作了...</p>
<blockquote>
<p>篇幅有限，不继续赘述</p>
</blockquote>
<h2 data-id="heading-9">总结</h2>
<ul>
<li>看完本文，大家可记住这样一句话：<strong><code>所有重复的、没有技术含量的办公操作，都可以考虑使用AI进行提效</code></strong></li>
<li>此外，大家可以思考一下，如何能把公司的一些业务场景给抽象出来，使用AI进行高效解决问题？</li>
</ul>
<blockquote>
<p>手工创作不易，感谢大家支持鼓励☺️☺️☺️</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Grid组件核心参数解析：控制器与布局选项详解]]></title>    <link>https://juejin.cn/post/7577737385955377162</link>    <guid>https://juejin.cn/post/7577737385955377162</guid>    <pubDate>2025-11-30T11:39:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577737385955377162" data-draft-id="7577991167200608266" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Grid组件核心参数解析：控制器与布局选项详解"/> <meta itemprop="keywords" content="HarmonyOS"/> <meta itemprop="datePublished" content="2025-11-30T11:39:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="平平不平凡"/> <meta itemprop="url" content="https://juejin.cn/user/2024666238038419"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Grid组件核心参数解析：控制器与布局选项详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2024666238038419/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    平平不平凡
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T11:39:53.000Z" title="Sun Nov 30 2025 11:39:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、控制器 (scroller)</h2>
<p><strong>核心作用与使用限制</strong>
控制器用于实现Grid与滚动行为的深度绑定，通过<code>scroller</code>参数可精确控制滚动位置与交互状态。该参数需传入<code>Scroller</code>实例对象，支持动态调整滚动偏移量、监听滚动事件等场景。</p>
<p><strong>重要特性：</strong></p>
<ul>
<li>独占性绑定：Grid的scroller不可与其他滚动组件（List/Scroll/WaterFlow等）共享控制器</li>
<li>滚动方向适配：当仅设置columnsTemplate时默认垂直滚动，仅设置rowsTemplate时默认水平滚动</li>
<li>交互控制：可配合<code>scrollTo</code>方法实现精准定位，或通过<code>onScrollIndex</code>事件监听可视区域变化</li>
</ul>
<p><strong>典型应用场景：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 创建滚动控制器实例</span>
<span class="hljs-keyword">const</span> gridScroller = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scroller</span>()

<span class="hljs-title class_">Grid</span>({ <span class="hljs-attr">scroller</span>: gridScroller }) {
  <span class="hljs-comment">// GridItem子组件...</span>
}
.<span class="hljs-title function_">onScrollIndex</span>(<span class="hljs-function">(<span class="hljs-params">first, last</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`当前可视起始项：<span class="hljs-subst">${first}</span>, 结束项：<span class="hljs-subst">${last}</span>`</span>)
})
</code></pre>
<h2 data-id="heading-1">二、布局选项 (layoutOptions)</h2>
<h3 data-id="heading-2">高级布局配置能力</h3>
<p><code>GridLayoutOptions</code>类型参数专为复杂布局设计，需搭配<code>columnsTemplate</code>或<code>rowsTemplate</code>使用（两者不可同时设置）。该对象包含三个关键属性：</p>
<h4 data-id="heading-3">1. regularSize</h4>
<p>定义常规GridItem的占位规则：</p>
<ul>
<li>固定值<code>[1, 1]</code>表示每个常规项占据1行1列</li>
<li>该参数为必填项，系统需以此为基础计算布局结构</li>
</ul>
<h4 data-id="heading-4">2. irregularIndexes</h4>
<p>指定需特殊处理的子项索引数组：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-attr">irregularIndexes</span>: [<span class="hljs-number">0</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>] <span class="hljs-comment">// 索引为0/3/5的项将触发不规则布局</span>
</code></pre>
<p><strong>3. onGetIrregularSizeByIndex</strong>
动态计算不规则项占位尺寸：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-attr">onGetIrregularSizeByIndex</span>: <span class="hljs-function">(<span class="hljs-params">index</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (index === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> [<span class="hljs-number">2</span>, <span class="hljs-number">1</span>] <span class="hljs-comment">// 首项跨2行1列</span>
  <span class="hljs-keyword">if</span> (index === <span class="hljs-number">5</span>) <span class="hljs-keyword">return</span> [<span class="hljs-number">1</span>, <span class="hljs-number">3</span>] <span class="hljs-comment">// 第5项跨1行3列</span>
  <span class="hljs-keyword">return</span> [<span class="hljs-number">1</span>, <span class="hljs-number">1</span>]
}
</code></pre>
<p><strong>使用注意事项</strong></p>
<p><strong>回调触发</strong>：仅当子项索引包含在<code>irregularIndexes</code>数组时才会执行尺寸计算回调</p>
<h2 data-id="heading-5">三、开发实践建议</h2>
<p>控制器与布局选项的组合使用能显著提升复杂网格布局的实现效率。建议在商品橱窗、仪表盘等需要动态适配不同尺寸内容的场景中优先采用该方案。实际开发时需注意滚动控制器的生命周期管理，对于不规则布局项建议预先计算尺寸避免布局抖动。这两个参数的灵活运用将使Grid组件突破传统布局限制，实现真正响应式的二维界面设计。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[把 Claude Code 变成靠谱“协作开发”：一份真的能落地的 Code 提示词指南]]></title>    <link>https://juejin.cn/post/7577957806210220047</link>    <guid>https://juejin.cn/post/7577957806210220047</guid>    <pubDate>2025-11-30T14:15:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577957806210220047" data-draft-id="7578029371006566440" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="把 Claude Code 变成靠谱“协作开发”：一份真的能落地的 Code 提示词指南"/> <meta itemprop="keywords" content="Claude,AI编程"/> <meta itemprop="datePublished" content="2025-11-30T14:15:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="吹水一流"/> <meta itemprop="url" content="https://juejin.cn/user/993614244613543"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            把 Claude Code 变成靠谱“协作开发”：一份真的能落地的 Code 提示词指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/993614244613543/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    吹水一流
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T14:15:06.000Z" title="Sun Nov 30 2025 14:15:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">把 Claude Code 变成靠谱“协作开发”：一份真的能落地的 Code 提示词指南</h2>
<blockquote>
<p>如果你直接把「帮我写一个 xxx 组件」丢给 Claude Code，<br/>
那它也会用“玩具”的标准对待你。</p>
<p>想让它变成<strong>靠谱的协作开发同事</strong>，<br/>
提示词（prompt）必须从“聊天”升级成“协议（protocol）”。</p>
</blockquote>
<p>这篇文章不是讲入门级的「如何让 Claude Code 写代码」，<br/>
而是帮你解决三个更现实的问题：</p>
<ol>
<li><strong>如何让 Claude 写的代码真正契合你的工程上下文？</strong></li>
<li><strong>如何在多文件、接口变更、重构等复杂场景里安全协作？</strong></li>
<li><strong>如何用提示词降低“逻辑幻觉”（悄悄改逻辑）的风险？</strong></li>
</ol>
<p>如果你已经习惯用大模型写代码，但总觉得“不够稳”，<br/>
这篇可以当成一份可直接复用的「工程级提示词模板」。</p>
<hr/>
<h3 data-id="heading-1">一、先搞清楚：Claude Code 在写代码时到底在“看什么”？</h3>
<p>对 Claude 来说，你的提示词就是它的“世界观”。<br/>
它不会真正“理解你的项目”，而是在做这件事：</p>
<blockquote>
<p>在你给的所有文字条件下，<br/>
预测最可能出现的下一段代码 / 文本。</p>
</blockquote>
<p>这对代码任务有三个重要含义：</p>
<h4 data-id="heading-2">1. 输出需要高度结构化</h4>
<p>代码和文章最大区别：</p>
<ul>
<li>有<strong>明确的语法结构</strong>（函数、类型、模块）</li>
<li>有<strong>固定的文件组织形式</strong>（组件、tools、hooks 等）</li>
<li>有<strong>规范的输出格式</strong>（代码块、diff、测试）</li>
</ul>
<p>如果你的提示是：</p>
<blockquote>
<p>帮我写一个分页组件。</p>
</blockquote>
<p>Claude 只能靠“见过的平均形态”往外写；<br/>
而你项目里的真实需求（技术栈、风格、约束）完全没被表达出来。</p>
<h4 data-id="heading-3">2. 正确性强依赖上下文</h4>
<p>对文本任务，缺一点上下文问题不大；<br/>
对代码任务，缺上下文直接导致“瞎补”：</p>
<ul>
<li>把 TS 写成 JS</li>
<li>用错第三方库版本（比如旧版 React Router）</li>
<li>默认用它自己熟悉的状态管理方案</li>
<li>随便改你的类型结构</li>
</ul>
<p>这些在执行时才会暴露，而你在提示层面其实完全可以避免。</p>
<h4 data-id="heading-4">3. “幻觉”在代码里是“悄悄改逻辑”</h4>
<p>文本幻觉你一眼就能看出不对劲；<br/>
代码幻觉往往是：</p>
<ul>
<li>多加 / 少加一个字段</li>
<li>默默放宽 / 收紧某个校验</li>
<li>修改了副作用发生的时机</li>
<li>改变了错误处理方式（直接抛异常 → 静默吞掉）</li>
</ul>
<p>这类问题即便过了编译，线上照样能炸。</p>
<blockquote>
<p>所以结论是：<br/>
<strong>对代码任务，提示词必须从“聊天”升级为“契约”，<br/>
明确告诉 Claude：你是谁、你要做什么、你不能做什么、你要怎么交付。</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-5">二、一个“工程级 Code Prompt”应该长什么样？</h3>
<p>先给一个比较完整、但不复杂的示例。场景：</p>
<blockquote>
<p>让 Claude 写一个前端分页列表组件。</p>
</blockquote>
<h4 data-id="heading-6">2.1 常见“错误写法”</h4>
<pre><code class="hljs">帮我写一个 React 的分页列表组件，显示用户列表。
</code></pre>
<p>问题：</p>
<ul>
<li>没有技术栈细节（TS 吗？用什么 UI？状态管理？）</li>
<li>没有上下文（数据从哪来？组件负责请求还是只负责 UI？）</li>
<li>没有约束（能不能引第三方？要不要考虑移动端？）</li>
<li>没有输出格式（你是想要思路？还是完整文件？）</li>
</ul>
<p>Claude 只好自己脑补一堆设定，你大概率不满意。</p>
<h4 data-id="heading-7">2.2 升级版：结构化“协议”写法</h4>
<p>下面这个版本，已经接近工程可用级别：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[ROLE]</span>
你是一个资深前端工程师，熟悉 React <span class="hljs-number">18</span> + TypeScript + TailwindCSS。

<span class="hljs-selector-attr">[TASK]</span>
实现一个通用分页列表组件 &lt;PaginatedTable&gt;，用于展示用户数据。

<span class="hljs-selector-attr">[CONTEXT]</span>
- 技术栈：React <span class="hljs-number">18</span> + TypeScript + Vite
- 数据结构：
  - 接口返回：{ list: User[]; total: number }
  - User: { id: string; name: string; email: string; createdAt: string }

<span class="hljs-selector-attr">[REQUIREMENTS]</span>
- 组件只负责 UI 和交互，数据由父组件通过 props 传入。
- 支持显示：当前页、每页数量、总条数。
- 点击页码时，通过 props 回调把新页码回传，不在组件内部发请求。

<span class="hljs-selector-attr">[CONSTRAINTS]</span>
- 使用函数组件 + hooks。
- 不引入第三方分页库。
- 不写死任何与“用户”强绑定的文案，尽量保持通用。

<span class="hljs-selector-attr">[OUTPUT_FORMAT]</span>
<span class="hljs-number">1</span>. 用 <span class="hljs-number">3</span>～<span class="hljs-number">6</span> 行解释你的设计思路（props、内部状态、交互流程）。
<span class="hljs-number">2</span>. 给出完整的 PaginatedTable 组件代码（用代码块，TypeScript 写法）。
<span class="hljs-number">3</span>. 额外给一个父组件的使用示例，展示如何传入数据和处理分页回调。
</code></pre>
<p>你可以观察到几个核心变化：</p>
<ol>
<li>
<p><strong>信息被分成块</strong>：<code>[ROLE] / [TASK] / [CONTEXT] / [REQUIREMENTS] / [CONSTRAINTS] / [OUTPUT_FORMAT]</code></p>
</li>
<li>
<p>每个块承担清晰职责：</p>
<ul>
<li>角色：你是谁</li>
<li>任务：做什么</li>
<li>上下文：在什么环境做</li>
<li>约束：什么不能乱做</li>
<li>输出：怎么交付</li>
</ul>
</li>
<li>
<p>整个 prompt 已经很接近一份“接口定义文档”，而不是一段闲聊。</p>
</li>
</ol>
<p>这类结构对 Claude 来说非常好理解，也更容易稳定输出符合预期的代码。</p>
<hr/>
<h3 data-id="heading-8">三、写 Code Prompt 时，必须显式包含的 5 个要素</h3>
<p>上面示例可以抽象成一套通用“5 要素模型”：</p>
<ol>
<li>
<p><strong>ROLE：角色 / 能力设定</strong><br/>
让 Claude 带着正确的“人格”和“技能树”上场：</p>
<pre><code class="hljs">你是一个有 5 年经验的前端工程师，熟悉 React 18 + TypeScript + Zustand，
习惯遵循 Airbnb TypeScript Style Guide。
</code></pre>
</li>
<li>
<p><strong>TASK：任务目标</strong><br/>
一句话搞清楚要干嘛：</p>
<pre><code class="hljs">帮我重构现有的用户列表页面，使其适配新的用户查询接口。
</code></pre>
</li>
<li>
<p><strong>CONTEXT：工程上下文</strong><br/>
包含技术栈 + 关键约定 + 必要代码片段：</p>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-deletion">- 技术栈：Next.js App Router + React 18 + TypeScript</span>
<span class="hljs-deletion">- 状态管理：Zustand</span>
<span class="hljs-deletion">- 请求层：基于 fetch 的轻封装 client</span>
<span class="hljs-deletion">- 下面是当前 UserList 页面代码：[这里粘贴代码]</span>
</code></pre>
</li>
<li>
<p><strong>CONSTRAINTS：约束条件</strong></p>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-deletion">- 不引入新的第三方库。</span>
<span class="hljs-deletion">- 不修改公共组件的对外 props 结构，除非有明确理由。</span>
<span class="hljs-deletion">- 尽量保持最小修改，不做与本次需求无关的重构。</span>
</code></pre>
</li>
<li>
<p><strong>OUTPUT_FORMAT：输出格式</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> 先用 5 行以内说明重构思路。
<span class="hljs-bullet">2.</span> 然后给出修改后的代码，使用代码块包裹。
<span class="hljs-bullet">3.</span> 如有删减逻辑，请在最后单独列出“行为变更点”。
</code></pre>
</li>
</ol>
<p>只要你把这 5 个要素写全，Claude 一般就能以“工程协作者”而不是“写代码 bot”的方式来响应你。</p>
<hr/>
<h3 data-id="heading-9">四、复杂工程场景：用“三段式工作流”拆解任务</h3>
<p>现实工作中，你很少只改一个文件。更常见的是：</p>
<ul>
<li>一次 API 迭代影响多个页面</li>
<li>一个模块需要整体重构</li>
<li>状态管理方案切换（Redux → Zustand 等）</li>
</ul>
<p>如果你一句话上来就说：</p>
<blockquote>
<p>帮我把整个用户模块改成用新接口。</p>
</blockquote>
<p>Claude 在上下文有限的情况下，只能“尽力猜”，出问题是大概率。</p>
<p>更稳的做法：<strong>强制自己和 Claude 都走“三段式流程”</strong> ：</p>
<ol>
<li>先让 Claude <strong>做规划（Plan）</strong></li>
<li>再让它针对具体文件 <strong>输出局部修改（Patch）</strong></li>
<li>最后你在本地 <strong>应用补丁并验证</strong></li>
</ol>
<hr/>
<h4 data-id="heading-10">4.1 阶段一：规划（Plan）</h4>
<p>先谈“改哪儿”，再谈“怎么改”。</p>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">ROLE</span>]
你是本项目的前端技术负责人。

[<span class="hljs-meta">TASK</span>]
根据旧接口、新接口和模块说明，规划需要修改的文件和改动点。

[<span class="hljs-meta">CONTEXT</span>]
- 旧接口结构：...
- 新接口结构：...
- 模块说明：用户列表 + 用户详情 + 用户编辑页。

[<span class="hljs-meta">OUTPUT_FORMAT</span>]
<span class="hljs-number">1.</span> 用 <span class="hljs-number">10</span> 行以内的文字总结：这次接口变更对模块行为有哪些影响。
<span class="hljs-number">2.</span> 列出一个 Markdown 列表，每一项包含：
   - 文件路径
   - 需要修改的点（<span class="hljs-number">1</span>～<span class="hljs-number">3</span> 行）
   - 是否存在风险（是 / 否 + 一句话理由）

注意：这一阶段只做规划，不输出具体代码。
</code></pre>
<p>这一步得到的是“一份变更清单”。<br/>
你可以先人工看一眼：</p>
<ul>
<li>有没有文件漏掉？</li>
<li>有没有理解偏差？</li>
</ul>
<p>确认没问题，再进入下一阶段。</p>
<hr/>
<h4 data-id="heading-11">4.2 阶段二：基于真实代码的精确修改（Patch）</h4>
<p>对每个文件单独开一个对话，拼接完整的上下文。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[TASK]</span>
现在只处理下面这个文件，请根据之前的规划生成精确修改。

<span class="hljs-selector-attr">[CONTEXT]</span>
当前文件代码如下：
<span class="hljs-selector-attr">[这里粘贴完整文件或核心片段]</span>

这是你在规划阶段对该文件的描述：
<span class="hljs-selector-attr">[把它之前对该文件的概述贴回来]</span>

<span class="hljs-selector-attr">[CONSTRAINTS]</span>
- 做与本次接口变更直接相关的最小修改。
- 不重命名现有公共函数 / 组件。
- 不要输出整文件，只输出 diff。

<span class="hljs-selector-attr">[OUTPUT_FORMAT]</span>
<span class="hljs-number">1</span>. 用 <span class="hljs-number">3</span>～<span class="hljs-number">5</span> 行说明你会修改哪些地方，以及原因。
<span class="hljs-number">2</span>. 使用 unified diff 的形式给出补丁（old → new）。
<span class="hljs-number">3</span>. 如果某处改动存在潜在风险，请在最后单独列一个 “RISKS” 小节。
</code></pre>
<p>你得到的是一个紧凑的、可读性很强的 patch，而不是一份乱糟糟的整文件。</p>
<hr/>
<h4 data-id="heading-12">4.3 阶段三：应用补丁与验证（本地完成）</h4>
<p>这一步没有特别的 prompt 设计，核心是工作流：</p>
<ul>
<li>用编辑器 / 脚本 / git apply 把 diff 应用到代码库</li>
<li>跑测试、手动验证关键路径</li>
<li>如果出了问题，再把“实际报错 + 对应代码片段”喂给 Claude，继续迭代</li>
</ul>
<p>重要的是：<br/>
<strong>你已经把 Claude 的职责限定在“规划 + 提出修改建议”，<br/>
真正的合入决策权还在你手里。</strong></p>
<hr/>
<h3 data-id="heading-13">五、降低“逻辑幻觉”：用“行为约束”而不是“流程描述”</h3>
<p>很多时候 Prompt 写得不稳，是因为只交代了“做什么”，没有交代“必须保持什么不变”。</p>
<h4 data-id="heading-14">5.1 让 Claude 先“说出原代码在做什么”，再改</h4>
<p>Bug 修复 / 重构时可以这样写：</p>
<pre><code class="hljs language-markdown" lang="markdown">在给出任何代码修改之前，请先完成以下两步：

<span class="hljs-bullet">1.</span> 从原始代码中提取 3～5 条核心行为和边界条件，
   用项目符号列出，并引用对应的函数 / 变量名。
<span class="hljs-bullet">2.</span> 对每一条行为说明：
<span class="hljs-bullet">   -</span> 你如何验证它当前是否被正确实现？
<span class="hljs-bullet">   -</span> 在你的修改中将如何保证它仍然成立？

完成上述两步后，再给出修改建议或 diff。
</code></pre>
<p>这一步有点像“口头单测”：</p>
<ul>
<li>你能看到 Claude 是不是理解对了行为</li>
<li>它会围绕这些行为来设计修改方案，而不是瞎重构</li>
</ul>
<h4 data-id="heading-15">5.2 用“不变量（Property）”描述逻辑，而不仅是“流程”</h4>
<p>举个金额计算的例子。</p>
<p><strong>普通写法：</strong></p>
<pre><code class="hljs">帮我实现一个订单总价计算函数，支持优惠券和运费。
</code></pre>
<p><strong>更专业的写法：</strong></p>
<pre><code class="hljs language-diff" lang="diff">请实现一个订单总价计算函数，并保证以下性质始终成立：

<span class="hljs-deletion">- 性质 1：如果没有任何商品项，结果总价为 0。</span>
<span class="hljs-deletion">- 性质 2：即使优惠券金额大于商品总价，结果总价也不得为负。</span>
<span class="hljs-deletion">- 性质 3：在不改变单价、优惠券和运费的前提下，增加任意商品数量，总价应单调不减。</span>
</code></pre>
<p>再配合测试要求：</p>
<pre><code class="hljs">在实现函数之后，请基于上述性质设计至少 3 条单元测试，
使用 Jest 风格，断言这些性质是否被满足。
</code></pre>
<p>你会发现：<br/>
Claude 输出的代码和测试会围绕这些“性质”展开，而不是凭感觉写一堆 if/else。</p>
<hr/>
<h3 data-id="heading-16">六、Few-shot：用真实示例教 Claude 你的“工程风格”</h3>
<p>单纯说“写专业一点”没什么用。<br/>
Claude 真正擅长的是：<strong>模仿示例。</strong></p>
<h4 data-id="heading-17">6.1 示例：给它一条你满意的 Code Review</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[REVIEW_EXAMPLE]</span>

总体看，这次改动方向合理，命名清晰，逻辑直观。
下面有几点建议：

1. <span class="hljs-section">[边界条件漏检 - handleSubmit 中的 amount 判空逻辑]</span>
   - 问题：当前只判断 <span class="hljs-attr">amount</span> === <span class="hljs-number">0</span>，没有处理 NaN 和 null。
   - 影响：后续在 formatAmount 时可能抛异常。
   - 建议：统一使用 isValidAmount(...) 封装判断，保持边界逻辑一致。

2. <span class="hljs-section">[重复逻辑 - formatDate 的实现]</span>
   - 问题：formatDate 实现与 utils/date.ts 中的同名函数重复。
   - 建议：直接复用已有工具函数，并补一条单元测试覆盖当前用例。
</code></pre>
<h4 data-id="heading-18">6.2 要求它“严格模仿这种结构”</h4>
<pre><code class="hljs language-css" lang="css">请严格模仿 <span class="hljs-selector-attr">[REVIEW_EXAMPLE]</span> 的结构和细致程度，
对下面这段代码进行评审：

<span class="hljs-selector-attr">[这里粘贴需要评审的代码]</span>
</code></pre>
<p>Claude 会自动学会：</p>
<ul>
<li>先给总体评价</li>
<li>每个问题用「标题 + 问题 + 影响 + 建议」的形式展开</li>
<li>重点关注边界条件、重复逻辑、可维护性</li>
</ul>
<p>你得到的就是“能直接贴进 PR 评论区”的内容，而不是一堆泛泛而谈的建议。</p>
<hr/>
<h3 data-id="heading-19">七、一份可以直接复用的“专业级 Code Prompt 模板”</h3>
<p>最后，把前面的要点收束成一份可直接复制的通用模板，你可以按项目做简单修改。</p>
<h4 data-id="heading-20">7.1 通用「精确修改」模板</h4>
<pre><code class="hljs language-markdown" lang="markdown">[ROLE]
你是本项目的协作前端开发者，熟悉：
<span class="hljs-bullet">-</span> React 18 + TypeScript
<span class="hljs-bullet">-</span> React Query 或 Zustand
<span class="hljs-bullet">-</span> 常见前端工程规范（例如 Airbnb TypeScript Style Guide）

[TASK]
在不破坏现有外部行为的前提下，对现有代码进行「精确修改」，以实现：
<span class="hljs-bullet">-</span> 【在这里写具体目标：例如 API 替换 / bug 修复 / 状态迁移等】

[CONTEXT]
<span class="hljs-bullet">-</span> 技术栈：...
<span class="hljs-bullet">-</span> 项目约定：...
<span class="hljs-bullet">-</span> 相关文件说明：...
<span class="hljs-bullet">-</span> 我会在后续消息中提供具体代码内容。

[GLOBAL<span class="hljs-emphasis">_CONSTRAINTS]
- 只做与本任务直接相关的最小必要改动。
- 不引入新的第三方依赖。
- 不更改公共 API（除非你明确说明理由并标出影响范围）。

[PROCESS]

Step 1 — 行为理解（BEHAVIOR）
1. 从给出的代码中，总结当前实现的核心行为和重要边界条件（3～7 条）。
2. 指出本次修改可能影响到哪些行为。

Step 2 — 修改规划（PLAN）
1. 列出需要修改的文件列表。
2. 对每个文件，说明：
   - 需要修改的点
   - 是否存在潜在风险（是 / 否 + 原因）

Step 3 — 具体修改（PATCHES）
1. 使用 unified diff 的形式给出每个文件的补丁。
2. 每段 diff 前用一行简短文字说明“修改动机”。
3. 不要输出整文件，只输出涉及修改的部分。

Step 4 — 校验与测试建议（TESTS）
1. 基于修改内容，列出 3～5 条需要重点验证的测试点（手测或自动化）。
2. 如有必要，提供 1～2 个 Jest 或 Vitest 的示例测试。

[OUTPUT_</span>FORMAT]
请严格按以下顺序输出四个小节：
<span class="hljs-bullet">1.</span> BEHAVIOR
<span class="hljs-bullet">2.</span> PLAN
<span class="hljs-bullet">3.</span> PATCHES
<span class="hljs-bullet">4.</span> TESTS

如果你认为当前信息不足，请在开始 Step 1 之前，
先以 "QUESTIONS" 小节列出最多 3 个关键问题。
</code></pre>
<p>你可以基于这份模板衍生：</p>
<ul>
<li>专门用于「写新组件」的版本</li>
<li>专门用于「Code Review」的版本</li>
<li>专门用于「阅读源码并讲解」的版本</li>
</ul>
<p>本质都是同一套思路：<br/>
<strong>把 Claude 纳入你的工程流程，让它在你的“协议”下工作。</strong></p>
<hr/>
<h3 data-id="heading-21">总结</h3>
<p>简单回顾一下整篇文章的脉络：</p>
<ol>
<li><strong>先理解模型行为</strong>：<br/>
Claude 不知道你的项目，它只是在你给的条件下预测下一个 token。<br/>
所以你必须把“角色、任务、上下文、约束、输出格式”说清楚。</li>
<li><strong>把提示词写成“协议”而不是一句话</strong>：<br/>
用结构化区块（<code>[ROLE][TASK][CONTEXT][CONSTRAINTS][OUTPUT_FORMAT]</code>）<br/>
显式告诉它：你是谁、要干嘛、在什么环境下干、怎么交付。</li>
<li><strong>复杂工程场景用三段式工作流</strong>：<br/>
规划（Plan）→ 局部修改（Patch）→ 本地应用补丁（Apply）。<br/>
避免一次性让 Claude “改完所有东西”。</li>
<li><strong>用行为约束和不变量降低逻辑幻觉</strong>：<br/>
先让 Claude 说清楚“原代码在做什么”，<br/>
再让它围绕“不变量（properties）”设计实现与测试。</li>
<li><strong>用 Few-shot 示例教会它你的工程风格</strong>：<br/>
不要只是说“写专业一点”，<br/>
直接给它一条你满意的 Code Review / 组件实现，让它模仿。</li>
<li><strong>最终落地为一份自己的 Prompt 模板库</strong>：<br/>
这才是“从会用到用得专业”的关键：<br/>
<strong>把这些协议变成你的日常工程工具，而不是一次性的灵感。</strong></li>
</ol>
<p>如果你已经在用大模型写代码，却时不时被“幻觉”“乱改”坑到，<br/>
可以从今天开始，<br/>
把这套结构化、工程化的提示词，<br/>
真正用在你下一个需求、下一个 PR、下一次重构里。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Trae Solo 实战指南：从"会用"到"用好"的协作方法论]]></title>    <link>https://juejin.cn/post/7577914902431301678</link>    <guid>https://juejin.cn/post/7577914902431301678</guid>    <pubDate>2025-11-30T14:18:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577914902431301678" data-draft-id="7577737385955770378" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Trae Solo 实战指南：从&quot;会用&quot;到&quot;用好&quot;的协作方法论"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2025-11-30T14:18:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CoolerWu"/> <meta itemprop="url" content="https://juejin.cn/user/2400989125543272"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Trae Solo 实战指南：从"会用"到"用好"的协作方法论
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2400989125543272/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CoolerWu
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T14:18:45.000Z" title="Sun Nov 30 2025 14:18:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h4 data-id="heading-0">0.背景</h4>
<p>说实话，一开始我以为能躺平了。后来发现，想得美。</p>
<p>我是怎么踩坑的Solo刚全量开放那天，我兴冲冲地打开它，说了句"帮我做个博客系统"。</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d100c8bddf4547f5a5cb524d56a7420d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vbGVyV3U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765117124&amp;x-signature=NyQeAHAMXQQ2yI2nV03TzMznzaM%3D" alt="image.png" width="70%" loading="lazy"/></p>
<p>然后它真的开始做了。</p>
<pre><code class="hljs language-text" lang="text">**功能概览**

-   本地博客系统，内置于现有 Electron 应用，无需独立服务器
-   后台：新增/编辑/删除文章，支持标签与 Markdown 内容
-   前台：文章列表与详情页，点击切换展示
-   存储：使用本地文件系统，将文章保存为 data/posts/*.json

**如何运行**

-   在项目根目录执行：npm install（已自动安装 marked 用于 Markdown 渲染）
-   启动应用：npm run start
-   顶部导航点击“博客后台”进行文章管理；点击“个人博客”浏览文章

**使用方式**

-   后台（导航“博客后台”）：

    -   填写“标题”“标签（逗号分隔）”“内容（Markdown）”，点击“保存文章”
    -   列表中可“编辑”“删除”；点击“新建文章”清空编辑器

-   前台（导航“个人博客”）：

    -   左侧为文章列表，默认展示最新文章；点击列表项切换详情
    -   内容支持 Markdown 渲染；若渲染库不可用，自动降级为纯文本

**代码结构**

-   存储模块：blog/storage.js

    -   列表：listPosts() 在 blog/storage.js:28
    -   读取：getPost(id) 在 blog/storage.js:38
    -   新增：createPost({...}) 在 blog/storage.js:44
    -   更新：updatePost(id, {...}) 在 blog/storage.js:62
    -   删除：deletePost(id) 在 blog/storage.js:76

-   UI逻辑：blog/blog.js

    -   初始化：initBlog() 在 blog/blog.js:9
    -   后台显示：showAdmin(show) 在 blog/blog.js:18
    -   前台显示：showViewer(show) 在 blog/blog.js:27
    -   保存操作：saveCurrentPost() 在 blog/blog.js:48
    -   列表渲染（后台/前台）：renderAdminList() 在 blog/blog.js:64、renderViewerList() 在 blog/blog.js:99
    -   详情渲染：renderViewerDetail(id) 在 blog/blog.js:126

-   导航与跳转：index.js

    -   跳转逻辑：jump(type) 在 index.js:5（2=后台，3=前台，4=交易记录）
    -   清理视图：clearJump() 在 index.js:21
    -   展示后台：showBlogAdmin(show) 在 index.js:50
    -   展示前台：showBlogViewer(show) 在 index.js:60

-   页面结构：index.html

    -   新增后台容器：&lt;div id="blogAdmin"&gt;...
    -   新增前台容器：&lt;div id="blogViewer"&gt;...
    -   初始化：&lt;script&gt;window.require('./blog/blog.js').initBlog()&lt;/script&gt;

-   样式：index.css（补充了后台表单、按钮、前台列表与详情基础样式）

**关键实现说明**

-   文件存储

    -   每篇文章保存在 data/posts/&lt;id&gt;.json，字段包含 id/title/slug/content/tags/createdAt/updatedAt
    -   目录创建与健壮读写：ensureDir()、safeReadJSON() 在 blog/storage.js:6、blog/storage.js:10
    -   slugify(title) 生成标题友好短链（目前用于规范化，未来可用于路由）

-   Markdown 渲染

    -   安装 marked 后自动用 marked.parse(content) 渲染；未安装时降级为 &lt;pre&gt; 文本显示（blog/blog.js:134）

-   视图管理

    -   保持与原项目的显示/隐藏风格一致，通过 jump(type) 切换不同视图，避免相互覆盖

**验证结果**

-   已编写并运行本地测试脚本 blog_test.js 验证存储模块的新增/读取/更新/删除/列表流程全部通过

    -   运行命令：node blog_test.js

**后续可扩展**

-   添加搜索与标签筛选（按标题/标签过滤列表）
-   草稿与发布状态、置顶、分页
-   图片上传与插入（本地文件引用 + 安全路径校验）
-   文章导入/导出（Markdown 文件双向转换）
-   简单权限与数据备份（如自动备份到用户目录）

如果你想要改成外部服务端（例如 Express + SQLite 或 MongoDB），或者希望主题化样式与路由浏览，我可以继续把当前实现升级为 Web 服务或引入前端框架。
</code></pre>
<pre><code class="hljs language-java" lang="java">window.addEventListener(<span class="hljs-string">'load'</span>, function () {

})

function <span class="hljs-title function_">jump</span><span class="hljs-params">(type)</span> {
    clearJump()

    <span class="hljs-keyword">switch</span> (type) {
        <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:
            showBlogAdmin(<span class="hljs-literal">true</span>)
            <span class="hljs-keyword">break</span>
        <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:
            showBlogViewer(<span class="hljs-literal">true</span>)
            <span class="hljs-keyword">break</span>
        <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:
            showTradeRecord(<span class="hljs-literal">true</span>)
            <span class="hljs-keyword">break</span>
    }
}

function <span class="hljs-title function_">clearJump</span><span class="hljs-params">()</span> {
    showTradeRecord()
    jumpWebHtml()
    showBlogAdmin()
    showBlogViewer()
}

function <span class="hljs-title function_">showTradeRecord</span><span class="hljs-params">(show)</span> {
    <span class="hljs-type">let</span> <span class="hljs-variable">tradeRecordDiv</span> <span class="hljs-operator">=</span> document.getElementById(<span class="hljs-string">'tradeRecord'</span>)

    <span class="hljs-keyword">if</span> (show) {
        tradeRecordDiv.style.display = <span class="hljs-string">'block'</span>
    } <span class="hljs-keyword">else</span> {
        tradeRecordDiv.style.display = <span class="hljs-string">'none'</span>
    }
}

function <span class="hljs-title function_">jumpWebHtml</span><span class="hljs-params">(url)</span> {
    <span class="hljs-type">let</span> <span class="hljs-variable">linkWebHtmlDiv</span> <span class="hljs-operator">=</span> document.getElementById(<span class="hljs-string">'linkWebHtml'</span>)
    <span class="hljs-type">let</span> <span class="hljs-variable">linkWebHtmlIframe</span> <span class="hljs-operator">=</span> document.querySelectorAll(<span class="hljs-string">'#linkWebHtml iframe'</span>)[<span class="hljs-number">0</span>]

    <span class="hljs-keyword">if</span> (url) {
        linkWebHtmlIframe.setAttribute(<span class="hljs-string">'src'</span>, url)
        linkWebHtml.style.display = <span class="hljs-string">'block'</span>
    } <span class="hljs-keyword">else</span> {
        linkWebHtml.style.display = <span class="hljs-string">'none'</span>
    }
}

function <span class="hljs-title function_">showBlogAdmin</span><span class="hljs-params">(show)</span> {
    <span class="hljs-type">const</span> <span class="hljs-variable">blogAdminDiv</span> <span class="hljs-operator">=</span> document.getElementById(<span class="hljs-string">'blogAdmin'</span>)
    <span class="hljs-keyword">if</span> (!blogAdminDiv) <span class="hljs-keyword">return</span>
    blogAdminDiv.style.display = show ? <span class="hljs-string">'block'</span> : <span class="hljs-string">'none'</span>
    <span class="hljs-keyword">if</span> (show &amp;&amp; window.require) {
        <span class="hljs-type">const</span> <span class="hljs-variable">blog</span> <span class="hljs-operator">=</span> window.require(<span class="hljs-string">'./blog/blog.js'</span>)
        blog.showAdmin(<span class="hljs-literal">true</span>)
    }
}

function <span class="hljs-title function_">showBlogViewer</span><span class="hljs-params">(show)</span> {
    <span class="hljs-type">const</span> <span class="hljs-variable">blogViewerDiv</span> <span class="hljs-operator">=</span> document.getElementById(<span class="hljs-string">'blogViewer'</span>)
    <span class="hljs-keyword">if</span> (!blogViewerDiv) <span class="hljs-keyword">return</span>
    blogViewerDiv.style.display = show ? <span class="hljs-string">'block'</span> : <span class="hljs-string">'none'</span>
    <span class="hljs-keyword">if</span> (show &amp;&amp; window.require) {
        <span class="hljs-type">const</span> <span class="hljs-variable">blog</span> <span class="hljs-operator">=</span> window.require(<span class="hljs-string">'./blog/blog.js'</span>)
        blog.showViewer(<span class="hljs-literal">true</span>)
    }
}
</code></pre>
<p>生成了一堆我看不懂的代码结构，用了我从没听过的框架，还贴心地加了十几个我根本不需要的功能。最后我盯着屏幕，陷入了沉思：这玩意儿是在帮我，还是在考验我？</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c50a0d869a934537ac983a602bdefe9b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vbGVyV3U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765117124&amp;x-signature=QrSAOH5OrPQr34fdq9MEQ%2BH8aEU%3D" alt="image.png" width="70%" loading="lazy"/></p>
<p>后来我想明白了——你不能怪一个刚入职的实习生不懂你的项目，你得怪自己没把需求说清楚。</p>
<p>Solo再聪明，它也不会读心术。</p>
<h4 data-id="heading-1">1.先把需求捋明白，别急着动手</h4>
<h5 data-id="heading-2">1.1 "自然语言"不是"随便说说"</h5>
<p>Solo支持自然语言输入，很多人就真的很"自然"了：</p>
<p>❌ "做个登录功能"
❌ "优化一下性能"
❌ "这里有bug你看看"</p>
<p>说真的，你跟同事这么说话，同事都想打你，何况AI。</p>
<p>我现在的习惯是，哪怕需求再小，也用需求行动前的5W1H思维模型过一遍：</p>
<ul>
<li>What：具体要做什么</li>
<li>Why：为什么要做这个</li>
<li>Where：影响哪些模块</li>
<li>When：有没有时间或顺序约束</li>
<li>Who：给谁用的，用户场景是什么</li>
<li>How：有没有技术偏好或约束</li>
</ul>
<p>写下来你会发现，很多时候你自己都没想清楚。</p>
<h5 data-id="heading-3">1.2 让Solo先"复述"一遍</h5>
<p>这是我踩坑之后养成的习惯——在让它写代码之前，先让它说说它理解的是什么。</p>
<p>我："我要做一个用户反馈页，支持文字和截图，数据存本地"</p>
<p>Solo："收到！我理解你需要：</p>
<ol>
<li>一个表单页面</li>
<li>文字输入区域</li>
<li>图片上传功能</li>
<li>用IndexedDB做本地存储
对吗？"</li>
</ol>
<p>我："对，但图片要压缩，超过1MB的自动处理一下"</p>
<p>Solo："明白，我加上图片压缩逻辑"</p>
<p>这个过程看起来多此一举，但相信我，它能帮你省掉50%的返工时间。</p>
<p>这其实就是提示词工程里说的——你给的上下文越清晰，AI在Embedding向量空间里"猜"的范围就越小，输出就越准。</p>
<h4 data-id="heading-4">2.需求会变的，Solo不知道</h4>
<h5 data-id="heading-5">2.1 改需求之前，先改文档</h5>
<p>真实项目哪有需求不变的？产品一拍脑袋，你的代码就得重写。</p>
<p>但问题是，Solo不知道你脑子里的需求变了。它只记得上次你说的话。</p>
<p>所以我现在的流程是：</p>
<ol>
<li>先更新需求文档（哪怕只是个markdown）</li>
<li>用Plan模式让Solo重新理解整个项目</li>
<li>再让它改代码</li>
</ol>
<p>别偷懒直接说"把那个按钮改成红色"。它可能会改，但它不知道为什么改，后面可能会在别的地方给你埋雷。</p>
<h5 data-id="heading-6">2.2 Solo的方案，听听就好</h5>
<p>有时候Solo会很自信地给你一个方案，看起来很专业。</p>
<p>别急着用。</p>
<p>用[[5why分析法]]的思路，往下问几层：</p>
<ul>
<li>为什么选这个库？</li>
<li>为什么用这个设计模式？</li>
<li>有没有更简单的做法？</li>
<li>会不会引入新的坑？</li>
</ul>
<p>我有一次让它实现一个简单的列表筛选，它给我整了个状态机。我问它为什么，它说"更优雅"。</p>
<p>兄弟，我只是要筛选一个列表啊。</p>
<p>AI没有"过度设计"的羞耻心。你得有。</p>
<h4 data-id="heading-7">3.调教它，让它越来越懂你</h4>
<h5 data-id="heading-8">3.1 给它立规矩</h5>
<p>每个项目都有自己的脾气——你喜欢用什么框架、命名习惯是啥、代码放哪个文件夹。</p>
<p>Solo不知道这些，除非你告诉它。</p>
<p>我会维护一份"项目规矩"，大概长这样：</p>
<p>技术栈</p>
<ul>
<li>React 18 + TypeScript</li>
<li>Tailwind CSS，不用其他CSS方案</li>
<li>Zustand做状态管理，别用Redux</li>
</ul>
<p>代码规范</p>
<ul>
<li>组件用PascalCase，文件名和组件名一致</li>
<li>不用class组件，全部函数式</li>
<li>接口定义放在types/目录</li>
</ul>
<p>禁止事项</p>
<ul>
<li>不要用any</li>
<li>不要在组件里直接调fetch，走封装好的api层</li>
<li>不要自作主张加console.log</li>
</ul>
<p>贴给Solo，它就知道规矩了。</p>
<h5 data-id="heading-9">3.2 它做错了，记下来</h5>
<p>每次Solo的输出不对，我就会想：是我没说清楚，还是它理解偏了？</p>
<p>如果是我的问题，我就补充到"项目规矩"里。几轮下来，Solo真的会越来越"懂"你。</p>
<p>这就跟带新人一样，你得有耐心。区别是，Solo不会离职，也不会摸鱼。</p>
<h4 data-id="heading-10">4.一些血泪教训</h4>
<h5 data-id="heading-11">4.1 从小任务开始</h5>
<p>别上来就"帮我重构整个项目"。先从一个半天能做完的功能开始，建立信任，摸清边界。</p>
<p>我第一次让Solo帮我重构一个老项目，它给我改了40多个文件，我花了两天才理清楚它改了什么。</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7609972a1fab40af97586166f3bd985c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vbGVyV3U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765117124&amp;x-signature=RGhLkMmnN%2FvXhhqu8hlddVmBGCw%3D" alt="image.png" width="50%" loading="lazy"/></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>

type <span class="hljs-title class_">Props</span> = {
  avatarUrl?: string
  <span class="hljs-attr">nickname</span>: string
  size?: number
  className?: string
  defaultAvatarUrl?: string
}

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">DEFAULT_AVATAR</span> =
  <span class="hljs-string">'data:image/svg+xml;utf8,&lt;svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"&gt;&lt;defs&gt;&lt;clipPath id="c"&gt;&lt;circle cx="50" cy="50" r="50"/&gt;&lt;/clipPath&gt;&lt;/defs&gt;&lt;g clip-path="url(%23c)"&gt;&lt;rect width="100" height="100" fill="%23e0e0e0"/&gt;&lt;circle cx="50" cy="40" r="22" fill="%23bdbdbd"/&gt;&lt;rect x="15" y="66" width="70" height="36" rx="18" fill="%23bdbdbd"/&gt;&lt;/g&gt;&lt;/svg&gt;'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">UserAvatar</span>(<span class="hljs-params">{ avatarUrl, nickname, size = <span class="hljs-number">40</span>, className, defaultAvatarUrl }: Props</span>) {
  <span class="hljs-keyword">const</span> [src, setSrc] = useState&lt;string&gt;(avatarUrl || defaultAvatarUrl || <span class="hljs-variable constant_">DEFAULT_AVATAR</span>)
  <span class="hljs-keyword">const</span> displayName = nickname.<span class="hljs-property">length</span> &gt; <span class="hljs-number">6</span> ? nickname.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">6</span>) + <span class="hljs-string">'…'</span> : nickname
  <span class="hljs-keyword">const</span> fontSize = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">12</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(size * <span class="hljs-number">0.4</span>))
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{className}</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">display:</span> '<span class="hljs-attr">inline-flex</span>', <span class="hljs-attr">alignItems:</span> '<span class="hljs-attr">center</span>' }}&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">img</span>
        <span class="hljs-attr">src</span>=<span class="hljs-string">{src}</span>
        <span class="hljs-attr">alt</span>=<span class="hljs-string">{nickname}</span>
        <span class="hljs-attr">onError</span>=<span class="hljs-string">{()</span> =&gt;</span> setSrc(defaultAvatarUrl || DEFAULT_AVATAR)}
        style={{ width: size, height: size, borderRadius: '50%', objectFit: 'cover', backgroundColor: '#eee' }}
      /&gt;
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">marginLeft:</span> <span class="hljs-attr">8</span>, <span class="hljs-attr">fontSize</span>, <span class="hljs-attr">lineHeight:</span> `${<span class="hljs-attr">size</span>}<span class="hljs-attr">px</span>`, <span class="hljs-attr">maxWidth:</span> <span class="hljs-attr">120</span>, <span class="hljs-attr">overflow:</span> '<span class="hljs-attr">hidden</span>', <span class="hljs-attr">textOverflow:</span> '<span class="hljs-attr">ellipsis</span>', <span class="hljs-attr">whiteSpace:</span> '<span class="hljs-attr">nowrap</span>' }}&gt;</span>
        {displayName}
      <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">UserAvatar</span>

</code></pre>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f05d165c4d543f79cfa4ed03915ac11~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vbGVyV3U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765117124&amp;x-signature=27GxbqO67WUE2pQPGGif4V%2BKLJk%3D" alt="image.png" width="50%" loading="lazy"/></p>
<h5 data-id="heading-12">4.2 善用多任务</h5>
<p>Solo支持多任务并行，这个功能真的好用。我的习惯是：</p>
<ul>
<li>主任务：正在开发的功能</li>
<li>调试任务：遇到bug了，开个新的，别污染主任务</li>
<li>实验任务：想试试新方案，不确定就扔掉</li>
</ul>
<p>就像开浏览器标签页一样，互不干扰。</p>
<h5 data-id="heading-13">4.3 它写的代码，你得审</h5>
<p>这点最重要。</p>
<p>AI生成的每一行代码，你都得过脑子。特别是：</p>
<ul>
<li>安全相关的（有没有XSS、注入风险）</li>
<li>边界处理（null、undefined考虑了吗）</li>
<li>性能问题（循环里有没有乱调API）</li>
</ul>
<p>有一次Solo帮我写了个表单提交，看起来没问题。上线后发现，用户连点两下会提交两次。</p>
<p>它不知道要加防抖，你得知道。</p>
<p>写在最后</p>
<p>用了一个月Solo，我的感受是：它确实能帮你省时间，但省的是手上的活，不是脑子里的活。</p>
<p>好的SOP需要场景描述清楚、每一步可执行。跟AI协作也是一样——你越清楚自己要什么，它就越能帮到你。</p>
<p>它是你的编程搭档，不是你的产品经理。</p>
<p>最终拍板的，还是你自己。</p>
<hr/>
<h4 data-id="heading-14">参考资料</h4>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fai-bot.cn%2Ftrae-solo%2F" target="_blank" title="https://ai-bot.cn/trae-solo/" ref="nofollow noopener noreferrer">ai-bot.cn/trae-solo/</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fhub.baai.ac.cn%2Fview%2F47554" target="_blank" title="https://hub.baai.ac.cn/view/47554" ref="nofollow noopener noreferrer">hub.baai.ac.cn/view/47554</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fnews.qq.com%2Frain%2Fa%2F20251126A01RP200" target="_blank" title="https://news.qq.com/rain/a/20251126A01RP200" ref="nofollow noopener noreferrer">news.qq.com/rain/a/2025…</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flutter 实现一个容器内部元素可平移、缩放和旋转等功能（一）]]></title>    <link>https://juejin.cn/post/7577969462860988479</link>    <guid>https://juejin.cn/post/7577969462860988479</guid>    <pubDate>2025-11-30T14:17:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577969462860988479" data-draft-id="7577969462860972095" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flutter 实现一个容器内部元素可平移、缩放和旋转等功能（一）"/> <meta itemprop="keywords" content="Flutter"/> <meta itemprop="datePublished" content="2025-11-30T14:17:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="名字被你们想完了"/> <meta itemprop="url" content="https://juejin.cn/user/3065854916834782"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flutter 实现一个容器内部元素可平移、缩放和旋转等功能（一）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3065854916834782/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    名字被你们想完了
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T14:17:21.000Z" title="Sun Nov 30 2025 14:17:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Flutter 实现一个容器内部元素可平移、缩放和旋转等功能（一）</h2>
<p>Flutter: 3.35.6</p>
<p>之前使用 html + javascript 实现了类似的功能，部分地方可以借鉴一下，现在基于此在flutter端实现一个容器内部元素可拖动，缩放，旋转的功能。</p>
<p>这个功能主要用于某个场景的装饰（例如家园，有各种家具，用户可以操作它们的摆放位置），组合图片（将多个图片在容器内随意摆放，组合成一张图）等等。所以还是比较实用的一个小功能。</p>
<p>依然是一个一个功能分析实现，首先来看平移。</p>
<p>一般来说，我们要移动这个元素，响应这个操作的区域大概率是在这个元素的内部，而且需要移动，所以我们就知道了响应移动操作是按下这个元素的内部区域并移动（元素内部按下移动响应移动操作）。为了响应这个操作，查阅文档，可以知道 <strong>GestureDetector</strong> 就可以满足，接下来初步体验一下：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter/material.dart'</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestGestureDetector</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-keyword">const</span> TestGestureDetector({<span class="hljs-keyword">super</span>.key});

  <span class="hljs-keyword">void</span> _onPanDown(DragDownDetails details) {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'按下: <span class="hljs-subst">$details</span>'</span>);
  }

  <span class="hljs-keyword">void</span> _onPanUpdate(DragUpdateDetails details) {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'更新: <span class="hljs-subst">$details</span>'</span>);
  }

  <span class="hljs-keyword">void</span> _onPanEnd(DragEndDetails details) {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'抬起: <span class="hljs-subst">$details</span>'</span>);
  }

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> GestureDetector(
      onPanDown: _onPanDown,
      onPanUpdate: _onPanUpdate,
      onPanEnd: _onPanEnd,
      child: Container(
        width: <span class="hljs-number">100</span>,
        height: <span class="hljs-number">100</span>,
        color: Colors.amber,
      ),
    );
  }
}
</code></pre>
<p>运行效果：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e0d9f6637734ef6877c6e9fb8e4ec09~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCN5a2X6KKr5L2g5Lus5oOz5a6M5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765117040&amp;x-signature=7OvxGINF1fZO8sCybVHG269YZXE%3D" alt="image01.gif" loading="lazy"/></p>
<p>可以看到手势的监听满足我们的需求，基于此开始实现一个元素的拖动。</p>
<p>限制在一个范围内拖动元素，使用 Stack + Positioned 来实现这样的元素，通过拖动改变 Positioned 的 top 值和 left 值：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter/material.dart'</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DragContainer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-keyword">const</span> DragContainer({<span class="hljs-keyword">super</span>.key});

  <span class="hljs-meta">@override</span>
  State&lt;DragContainer&gt; createState() =&gt; _DragContainerState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_DragContainerState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">DragContainer</span>&gt; </span>{
  <span class="hljs-built_in">double</span> x = <span class="hljs-number">10</span>;
  <span class="hljs-built_in">double</span> y = <span class="hljs-number">10</span>;

  <span class="hljs-keyword">void</span> _onPanDown(DragDownDetails details) {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'按下: <span class="hljs-subst">$details</span>'</span>);
  }

  <span class="hljs-keyword">void</span> _onPanUpdate(DragUpdateDetails details) {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'更新: <span class="hljs-subst">$details</span>'</span>);

    <span class="hljs-comment">// delta 表示自上次更新以来的位置偏移量</span>
    setState(() {
      x += details.delta.dx;
      y += details.delta.dy;
    });
  }

  <span class="hljs-keyword">void</span> _onPanEnd(DragEndDetails details) {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'抬起: <span class="hljs-subst">$details</span>'</span>);
  }

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Container(
      width: <span class="hljs-number">300</span>,
      height: <span class="hljs-number">600</span>,
      color: Colors.blueAccent,
      child: Stack(
        children: [
          Positioned(
            left: x,
            top: y,
            child: GestureDetector(
              onPanDown: _onPanDown,
              onPanUpdate: _onPanUpdate,
              onPanEnd: _onPanEnd,
              child: Container(
                width: <span class="hljs-number">100</span>,
                height: <span class="hljs-number">100</span>,
                color: Colors.amber,
              ),
            ),
          ),
        ],
      ),
    );
  }
}
</code></pre>
<p>运行效果：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/33f301f38c654413a2fc849b6069dfe4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCN5a2X6KKr5L2g5Lus5oOz5a6M5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765117040&amp;x-signature=Ew3od1VW6a77DWoJ3bUtnpik61Y%3D" alt="image02.gif" loading="lazy"/></p>
<p>就这样我们实现了一个简单的元素可拖动效果，从上面我们不难发现，这个元素也可以拖到容器外面，如果元素完全拖动到容器外，那我们就完全无法看到并操作这个元素了，所以意义不大，所以我们限制只允许在容器内拖动。我们接着更改代码：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter/material.dart'</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DragContainer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-keyword">const</span> DragContainer({<span class="hljs-keyword">super</span>.key});

  <span class="hljs-meta">@override</span>
  State&lt;DragContainer&gt; createState() =&gt; _DragContainerState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_DragContainerState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">DragContainer</span>&gt; </span>{
  <span class="hljs-comment">/// <span class="markdown">抽取容器的宽</span></span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> containerWidth = <span class="hljs-number">300</span>;
  <span class="hljs-comment">/// <span class="markdown">抽取容器的高</span></span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> containerHeight = <span class="hljs-number">600</span>;

  <span class="hljs-comment">/// <span class="markdown">抽取元素的宽</span></span>
  <span class="hljs-built_in">double</span> elementWidth = <span class="hljs-number">100</span>;
  <span class="hljs-comment">/// <span class="markdown">抽取元素的高</span></span>
  <span class="hljs-built_in">double</span> elementHeight = <span class="hljs-number">100</span>;
  <span class="hljs-built_in">double</span> x = <span class="hljs-number">10</span>;
  <span class="hljs-built_in">double</span> y = <span class="hljs-number">10</span>;

  <span class="hljs-keyword">void</span> _onPanDown(DragDownDetails details) {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'按下: <span class="hljs-subst">$details</span>'</span>);
  }

  <span class="hljs-keyword">void</span> _onPanUpdate(DragUpdateDetails details) {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'更新: <span class="hljs-subst">$details</span>'</span>);

    setState(() {
      x += details.delta.dx;
      y += details.delta.dy;

      <span class="hljs-comment">// 限制左边界</span>
      <span class="hljs-keyword">if</span> (x &lt; <span class="hljs-number">0</span>) {
        x = <span class="hljs-number">0</span>;
      }
      <span class="hljs-comment">// 限制右边界</span>
      <span class="hljs-keyword">if</span> (x &gt; containerWidth - elementWidth) {
        x = containerWidth - elementHeight;
      }
      <span class="hljs-comment">// 限制上边界</span>
      <span class="hljs-keyword">if</span> (y &lt; <span class="hljs-number">0</span>) {
        y = <span class="hljs-number">0</span>;
      }
      <span class="hljs-comment">// 限制下边界</span>
      <span class="hljs-keyword">if</span> (y &gt; containerHeight - elementWidth) {
        y = containerHeight - elementHeight;
      }
    });
  }

  <span class="hljs-keyword">void</span> _onPanEnd(DragEndDetails details) {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'抬起: <span class="hljs-subst">$details</span>'</span>);
  }

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Container(
      width: containerWidth,
      height: containerHeight,
      color: Colors.blueAccent,
      child: Stack(
        children: [
          Positioned(
            left: x,
            top: y,
            child: GestureDetector(
              onPanDown: _onPanDown,
              onPanUpdate: _onPanUpdate,
              onPanEnd: _onPanEnd,
              child: Container(
                width: elementWidth,
                height: elementHeight,
                color: Colors.amber,
              ),
            ),
          ),
        ],
      ),
    );
  }
}
</code></pre>
<p>运行效果：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/027d2a8ea58c44958079730db1671eca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCN5a2X6KKr5L2g5Lus5oOz5a6M5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765117040&amp;x-signature=VRUJCHjDTudifiozHsHsufItaQs%3D" alt="image03.gif" loading="lazy"/></p>
<p>现在我们对边界做出了限制，但新的问题又出现了，我们手指拖动到容器外面，依然在响应事件，此时移动到容器内的过程中，元素也在跟着移动，待完全将手指移动到容器内，元素和手指已经隔了很长一个距离了。</p>
<p>这是因为 delta 中记录着自上次更新的偏移量，即便是手指在容器外，依然会记录这个值，从而实时的更改这个值，当我们手指在某一个方法超出范围时，继续向那个范围外移动，元素因为限制所以不会超出容器外，指针和元素越离越远，当我们向回走时，<code>y += details.delta.dy;</code> (以下边界为例)，dy 为负值，y + dy 就小于了边界值，所以就直接同步移动，这就导致了指针和元素有了一定的距离。</p>
<p>为了解决这个问题，我们可以使用下面这种方法，将手指按下，移动，抬起看做一个操作动作，用变量记录当前的初始的x和y，手指按下记录按下的坐标，手指移动时记录移动到的坐标，通过按下的坐标与移动的坐标计算移动的距离，那么就有：当前的值 = 初始化值 + (手指当前移动的值 - 手指按下的值)；在当次操作动作过程中，我们始终以当前初始的x和y为标准，以按下的位置做和移动的位置来计算，这样即便是移动到容器外再往回移动的过程中，使用初始的x和y、初始按下位置和移动的位置（只要移动的位置还是在边界外）计算出来依然大于边界值。这样就达到了我们的要求。那么新的问题来了，我们怎么拿到按下的坐标和移动的坐标呢？我们看看打印的值有些什么：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2edaa8360ffc4acc90bf0bfa041d67cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCN5a2X6KKr5L2g5Lus5oOz5a6M5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765117040&amp;x-signature=%2BbEH7zh7BlNlZrCIoanwc01h1EQ%3D" alt="image04.png" loading="lazy"/></p>
<p>可以看到还有以下的值供我们使用：</p>
<ul>
<li>globalPosition: 提供指针在全局坐标系中的当前位置坐标</li>
<li>localPosition: 表示指针相对于当前监听组件坐标系的位置坐标</li>
</ul>
<p>所以我们只需要计算出当前位置即可，这里使用 localPosition 来计算：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter/material.dart'</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DragContainer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-keyword">const</span> DragContainer({<span class="hljs-keyword">super</span>.key});

  <span class="hljs-meta">@override</span>
  State&lt;DragContainer&gt; createState() =&gt; _DragContainerState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_DragContainerState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">DragContainer</span>&gt; </span>{
  <span class="hljs-comment">/// <span class="markdown">抽取容器的宽</span></span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> containerWidth = <span class="hljs-number">300</span>;
  <span class="hljs-comment">/// <span class="markdown">抽取容器的高</span></span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> containerHeight = <span class="hljs-number">600</span>;

  <span class="hljs-comment">/// <span class="markdown">抽取元素的宽</span></span>
  <span class="hljs-built_in">double</span> elementWidth = <span class="hljs-number">100</span>;
  <span class="hljs-comment">/// <span class="markdown">抽取元素的高</span></span>
  <span class="hljs-built_in">double</span> elementHeight = <span class="hljs-number">100</span>;
  <span class="hljs-built_in">double</span> x = <span class="hljs-number">10</span>;
  <span class="hljs-built_in">double</span> y = <span class="hljs-number">10</span>;
  <span class="hljs-built_in">double</span> initX = <span class="hljs-number">10</span>;
  <span class="hljs-built_in">double</span> initY = <span class="hljs-number">10</span>;
  Offset startPosition = Offset(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);

  <span class="hljs-keyword">void</span> _onPanDown(DragDownDetails details) {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'按下: <span class="hljs-subst">$details</span>'</span>);
    setState(() {
      startPosition = details.localPosition;
    });
  }

  <span class="hljs-keyword">void</span> _onPanUpdate(DragUpdateDetails details) {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'更新: <span class="hljs-subst">$details</span>'</span>);

    setState(() {
      <span class="hljs-comment">// 计算方法</span>
      x = initX + details.localPosition.dx - startPosition.dx;
      y = initY + details.localPosition.dy - startPosition.dy;

      <span class="hljs-comment">// 限制左边界</span>
      <span class="hljs-keyword">if</span> (x &lt; <span class="hljs-number">0</span>) {
        x = <span class="hljs-number">0</span>;
      }
      <span class="hljs-comment">// 限制右边界</span>
      <span class="hljs-keyword">if</span> (x &gt; containerWidth - elementWidth) {
        x = containerWidth - elementWidth;
      }
      <span class="hljs-comment">// 限制上边界</span>
      <span class="hljs-keyword">if</span> (y &lt; <span class="hljs-number">0</span>) {
        y = <span class="hljs-number">0</span>;
      }
      <span class="hljs-comment">// 限制下边界</span>
      <span class="hljs-keyword">if</span> (y &gt; containerHeight - elementHeight) {
        y = containerHeight - elementHeight;
      }
    });
  }

  <span class="hljs-keyword">void</span> _onPanEnd() {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'抬起或者因为某些原因并没有触发onPanDown事件'</span>);
    setState(() {
      <span class="hljs-comment">// 当次结束后重新记录，也可以在按下时记录</span>
      initX = x;
      initY = y;
    });
  }

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Container(
      width: containerWidth,
      height: containerHeight,
      color: Colors.blueAccent,
      child: Stack(
        children: [
          Positioned(
            left: x,
            top: y,
            child: GestureDetector(
              onPanDown: _onPanDown,
              onPanUpdate: _onPanUpdate,
              onPanEnd: (details) =&gt; _onPanEnd,
              onPanCancel: () =&gt; _onPanEnd,
              child: Container(
                width: elementWidth,
                height: elementHeight,
                color: Colors.amber,
              ),
            ),
          ),
        ],
      ),
    );
  }
}
</code></pre>
<p>运行效果：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da62b4ebc04f47f3bdce11395dccca4b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCN5a2X6KKr5L2g5Lus5oOz5a6M5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765117040&amp;x-signature=Q1V6f8KYp4KOFOfgQIhDkeorXBk%3D" alt="image05.gif" loading="lazy"/></p>
<p>可以看到超出边界往回走的时候指针计算的位置依然大于边界值，直到回到按下的地方相对位置（按下时相对于黄色区域的位置坐标）才重新移动。</p>
<p>这样我们就初步实现了元素的移动，这又是一个系列的文章，后面再慢慢实现其他的功能。</p>
<p>感兴趣的也可以关注我的微信公众号【前端学习小营地】，不定时会分享一些小功能～</p>
<p>至此该篇结束，感谢阅读～拜拜～</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React 事件系实现]]></title>    <link>https://juejin.cn/post/7577968429590921242</link>    <guid>https://juejin.cn/post/7577968429590921242</guid>    <pubDate>2025-11-30T14:31:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577968429590921242" data-draft-id="7578003302487752704" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React 事件系实现"/> <meta itemprop="keywords" content="前端,React.js"/> <meta itemprop="datePublished" content="2025-11-30T14:31:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="day1"/> <meta itemprop="url" content="https://juejin.cn/user/4310544201823182"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React 事件系实现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4310544201823182/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    day1
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T14:31:33.000Z" title="Sun Nov 30 2025 14:31:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、前言</h2>
<p>React 的合成事件系统是一套精密的机制，它并非简单地对原生事件进行封装，而是一个集成了<strong>事件委托、跨平台抽象</strong>与<strong>优先级调度</strong>三大核心设计于一体的综合解决方案。本文将以源码导览的形式，深入这三大支柱。</p>
<h3 data-id="heading-1">1.1 事件委托</h3>
<p>React 通过事件委托模式，极大地提升了应用的性能与可维护性。它并非为每个组件单独绑定事件，而是将几乎所有事件的监听器统一绑定在应用的根节点上。</p>
<ul>
<li><strong>原理</strong>：当一个元素的事件被触发时，该事件会沿着 DOM 树向上“冒泡”。React 在根节点捕获这个事件，并通过事件的 <code>target</code> 属性，反向追溯到触发事件的真实组件（Fiber 节点）。</li>
<li><strong>优势</strong>：显著减少了内存中的事件监听器数量，并简化了组件销毁时的垃圾回收，有效避免了内存泄漏。</li>
</ul>
<blockquote>
<p><strong>注意</strong>：并非所有事件都适合委托。对于那些原生不冒泡的事件（如 <code>scroll</code>, <code>focus</code>, <code>blur</code>），React 会选择在目标元素上单独进行监听。</p>
</blockquote>
<h3 data-id="heading-2">1.2 跨平台抽象</h3>
<p>为了抹平不同浏览器的实现差异，React 构建了一个强大的抽象层。这一层主要由两部分组成：</p>
<ul>
<li><strong>合成事件对象 (SyntheticEvent)</strong>：这是开发者在事件回调中接触到的 <code>e</code> 对象。它封装了原生事件，并提供了一套标准、稳定的 API（如 <code>e.stopPropagation()</code>, <code>e.preventDefault()</code>），确保在所有浏览器中行为一致。</li>
<li><strong>事件插件系统 (Event Plugin System)</strong>：这是合成事件能够运作的底层架构。React 将不同事件的处理逻辑（如 <code>click</code>、<code>change</code>）拆分到不同的插件中（<code>SimpleEventPlugin</code>, <code>ChangeEventPlugin</code> 等）。这种可插拔的设计，不仅隔离了复杂性，也使得 React 可以灵活地模拟或修复特定事件在某些浏览器上的行为。</li>
</ul>
<h3 data-id="heading-3">1.3 优先级调度</h3>
<p>为了确保 UI 的流畅响应，React 的事件系统与内部的调度器（Scheduler）和 Lane 优先级模型紧密相连。它将事件划分为不同的优先级：</p>
<ul>
<li><strong>离散事件 (DiscreteEvent)</strong>：如 <code>click</code>, <code>keydown</code>。这类用户直接、期望立即得到反馈的交互，拥有最高优先级。</li>
<li><strong>连续事件 (ContinuousEvent)</strong>：如 <code>mousemove</code>, <code>scroll</code>。这类会持续触发的事件，优先级次之。</li>
<li><strong>默认事件 (DefaultEvent)</strong>：如 <code>load</code>, <code>error</code> 等。优先级更低。</li>
</ul>
<p>当一个事件触发了状态更新（<code>setState</code>）时，该更新会继承事件的优先级。调度器会优先处理高优先级的更新，确保用户的点击等操作能得到最快响应，即使当时有其他低优先级的渲染任务正在进行。</p>
<h2 data-id="heading-4">二、事件委托与注册：从根节点到优先级分发器</h2>
<p>React 的事件委托机制远比“在根节点上调用 <code>addEventListener</code>”要复杂。它是一套包含动态事件收集、优先级判断、分发器绑定和真实 DOM 监听的完整流程。</p>
<h3 data-id="heading-5">2.1 <code>listenToAllSupportedEvents</code>：事件的动态注册</h3>
<p>当我们调用 <code>ReactDOM.createRoot(root).render()</code> 时，<code>listenToAllSupportedEvents</code> 会被调用，以确保所有 React 支持的事件都已被监听。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// allNativeEvents 是通过遍历所有插件的 supportedEvents 聚合而成的 Set</span>
<span class="hljs-comment">// nonDelegatedEvents 包含 'scroll' 等，这些事件只在目标元素上监听，不参与委托</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">listenToAllSupportedEvents</span>(<span class="hljs-params">rootContainerElement: EventTarget</span>) {
  <span class="hljs-keyword">if</span> (!rootContainerElement[listeningMarker]) {
    rootContainerElement[listeningMarker] = <span class="hljs-literal">true</span>;
    allNativeEvents.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">domEventName</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (domEventName !== <span class="hljs-string">"selectionchange"</span>) {
        <span class="hljs-comment">// 对于非委托事件，只在捕获阶段监听</span>
        <span class="hljs-keyword">if</span> (!nonDelegatedEvents.<span class="hljs-title function_">has</span>(domEventName)) {
          <span class="hljs-comment">// 冒泡阶段的委托监听</span>
          <span class="hljs-title function_">listenToNativeEvent</span>(domEventName, <span class="hljs-literal">false</span>, rootContainerElement);
        }
        <span class="hljs-comment">// 所有事件都在捕获阶段进行委托监听</span>
        <span class="hljs-title function_">listenToNativeEvent</span>(domEventName, <span class="hljs-literal">true</span>, rootContainerElement);
      }
    });
  }
}
</code></pre>
<h3 data-id="heading-6">2.2 <code>listenToNativeEvent</code> -&gt; <code>addTrappedEventListener</code>：创建监听器</h3>
<p><code>listenToNativeEvent</code> 并不会直接调用 <code>addEventListener</code>，而是经过层层封装，最终由 <code>addTrappedEventListener</code> 完成。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">listenToNativeEvent</span>(<span class="hljs-params">
  domEventName: DOMEventName,
  isCapturePhase: boolean,
  target: EventTarget
</span>) {
  <span class="hljs-keyword">let</span> eventSystemFlags = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">if</span> (isCapturePhase) {
    eventSystemFlags |= <span class="hljs-variable constant_">IS_CAPTURE_PHASE</span>; <span class="hljs-comment">// 标记为捕获阶段</span>
  }
  <span class="hljs-title function_">addTrappedEventListener</span>(target, domEventName, eventSystemFlags);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">addTrappedEventListener</span>(<span class="hljs-params">
  targetContainer: EventTarget,
  domEventName: DOMEventName,
  eventSystemFlags: EventSystemFlags
</span>) {
  <span class="hljs-comment">// 关键：创建带有优先级的监听器包裹函数</span>
  <span class="hljs-keyword">const</span> listener = <span class="hljs-title function_">createEventListenerWrapperWithPriority</span>(
    targetContainer,
    domEventName,
    eventSystemFlags
  );

  <span class="hljs-comment">// ... 此处还有 passive listener 的判断和 addEventListener 的调用逻辑 ...</span>
  targetContainer.<span class="hljs-title function_">addEventListener</span>(domEventName, listener, isCapturePhase);
}
</code></pre>
<h3 data-id="heading-7">2.3 <code>createEventListenerWrapperWithPriority</code>：连接委托与优先级</h3>
<p>这是整个事件注册流程中最核心的函数之一。它根据事件的类型，返回一个<strong>特定优先级的分发函数</strong> (<code>dispatchDiscreteEvent</code> 或 <code>dispatchContinuousEvent</code> 等)，并将事件名、容器等信息通过 <code>.bind</code> 的方式预先传入。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createEventListenerWrapperWithPriority</span>(<span class="hljs-params">
  targetContainer: EventTarget,
  domEventName: DOMEventName,
  eventSystemFlags: EventSystemFlags
</span>): <span class="hljs-title class_">Function</span> {
  <span class="hljs-comment">// 1. 获取事件的优先级</span>
  <span class="hljs-keyword">const</span> eventPriority = <span class="hljs-title function_">getEventPriority</span>(domEventName);
  <span class="hljs-keyword">let</span> listenerWrapper;

  <span class="hljs-comment">// 2. 根据优先级，选择不同的分发器</span>
  <span class="hljs-keyword">switch</span> (eventPriority) {
    <span class="hljs-keyword">case</span> <span class="hljs-title class_">DiscreteEventPriority</span>: <span class="hljs-comment">// e.g., click, keydown</span>
      listenerWrapper = dispatchDiscreteEvent;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-title class_">ContinuousEventPriority</span>: <span class="hljs-comment">// e.g., mousemove, scroll</span>
      listenerWrapper = dispatchContinuousEvent;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-title class_">DefaultEventPriority</span>:
    <span class="hljs-attr">default</span>:
      listenerWrapper = dispatchEvent; <span class="hljs-comment">// 通用分发器</span>
      <span class="hljs-keyword">break</span>;
  }

  <span class="hljs-comment">// 3. 绑定参数，返回最终的监听器函数</span>
  <span class="hljs-keyword">return</span> listenerWrapper.<span class="hljs-title function_">bind</span>(
    <span class="hljs-literal">null</span>,
    domEventName,
    eventSystemFlags,
    targetContainer
  );
}
</code></pre>
<blockquote>
<p><strong>补充：优先级的真正用途</strong></p>
<p>这里根据 <code>eventPriority</code> 选择不同的 <code>dispatch</code> 函数，其意义远不止是选择一个函数名。真正的关键在于这些 <code>dispatch</code> 函数内部会通过 <code>setCurrentUpdatePriority</code>，将整个事件处理流程包裹在对应的优先级上下文中。</p>
<p><code>dispatchDiscreteEvent</code> 的真实源码如下：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">dispatchDiscreteEvent</span>(<span class="hljs-params">
  domEventName: DOMEventName,
  eventSystemFlags: EventSystemFlags,
  container: EventTarget,
  nativeEvent: AnyNativeEvent
</span>) {
  <span class="hljs-keyword">const</span> prevTransition = <span class="hljs-title class_">ReactSharedInternals</span>.<span class="hljs-property">T</span>;
  <span class="hljs-title class_">ReactSharedInternals</span>.<span class="hljs-property">T</span> = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">const</span> previousPriority = <span class="hljs-title function_">getCurrentUpdatePriority</span>();
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 关键：设置当前更新的优先级为离散事件优先级</span>
    <span class="hljs-title function_">setCurrentUpdatePriority</span>(<span class="hljs-title class_">DiscreteEventPriority</span>);
    <span class="hljs-title function_">dispatchEvent</span>(domEventName, eventSystemFlags, container, nativeEvent);
  } <span class="hljs-keyword">finally</span> {
    <span class="hljs-comment">// 保证在执行完毕后恢复之前的优先级</span>
    <span class="hljs-title function_">setCurrentUpdatePriority</span>(previousPriority);
    <span class="hljs-title class_">ReactSharedInternals</span>.<span class="hljs-property">T</span> = prevTransition;
  }
}
</code></pre>
<p><code>setCurrentUpdatePriority</code> 会设置一个模块内的全局变量。这样做确保了后续在事件回调中（如 <code>onClick</code>）触发的任何状态更新（<code>setState</code>），都会通过 <code>getCurrentUpdatePriority</code> 读取到这个 <code>DiscreteEventPriority</code>。调度器据此便知这是一个高优先级任务，需要尽快执行（在 Concurrent 模式下通常会同步执行），从而保证了用户交互的即时响应。这正是 React 优先级调度机制与事件系统连接的枢纽。</p>
</blockquote>
<p>至此，注册阶段完成。当一个原生 <code>click</code> 事件在根节点被触发时，实际执行的是被 <code>bind</code> 过的 <code>dispatchDiscreteEvent</code> 函数。</p>
<h2 data-id="heading-8">三、事件分发与调度：从分发器到插件系统</h2>
<h3 data-id="heading-9">3.1 <code>dispatchDiscreteEvent</code>：高优先级事件分发</h3>
<p>以离散事件为例，<code>dispatchDiscreteEvent</code> 会确保事件的同步执行，并在需要时处理并发渲染中的阻塞情况。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">dispatchDiscreteEvent</span>(<span class="hljs-params">
  domEventName,
  eventSystemFlags,
  container,
  nativeEvent
</span>) {
  <span class="hljs-comment">// ... 省略 ...</span>

  <span class="hljs-comment">// 最终会调用通用的 dispatchEvent 逻辑</span>
  <span class="hljs-title function_">dispatchEvent</span>(domEventName, eventSystemFlags, container, nativeEvent);
}

<span class="hljs-comment">// 通用 dispatchEvent 的核心逻辑</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-params">
  domEventName,
  eventSystemFlags,
  targetContainer,
  nativeEvent
</span>) {
  <span class="hljs-comment">// ...</span>
  <span class="hljs-comment">// 1. 检查在并发渲染中，是否有更高优先级的任务正在进行，导致当前事件被阻塞</span>
  <span class="hljs-keyword">let</span> blockedOn = <span class="hljs-title function_">findInstanceBlockingEvent</span>(nativeEvent);
  <span class="hljs-keyword">if</span> (blockedOn === <span class="hljs-literal">null</span>) {
    <span class="hljs-comment">// 2. 如果没有阻塞，直接启动插件系统</span>
    <span class="hljs-title function_">dispatchEventForPluginEventSystem</span>(
      domEventName,
      eventSystemFlags,
      nativeEvent
      <span class="hljs-comment">// ...</span>
    );
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-comment">// 3. 如果存在阻塞（通常发生在 Hydration 期间），则尝试同步完成阻塞的渲染任务</span>
  <span class="hljs-comment">// ... 此处包含 attemptSynchronousHydration 等复杂逻辑 ...</span>
}
</code></pre>
<h3 data-id="heading-10">3.2 <code>dispatchEventForPluginEventSystem</code>：启动插件系统</h3>
<p>这是从“事件分发”到“事件处理”的桥梁。它负责找到事件发生的真实目标 Fiber，并调用插件系统的中央分发器。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">dispatchEventForPluginEventSystem</span>(<span class="hljs-params">
  domEventName: DOMEventName,
  eventSystemFlags: EventSystemFlags,
  nativeEvent: AnyNativeEvent
  <span class="hljs-comment">// ...</span>
</span>) {
  <span class="hljs-comment">// 1. 从原生事件目标找到最近的 Fiber 实例</span>
  <span class="hljs-keyword">const</span> nativeEventTarget = <span class="hljs-title function_">getEventTarget</span>(nativeEvent);
  <span class="hljs-keyword">const</span> targetInst = <span class="hljs-title function_">getClosestInstanceFromNode</span>(nativeEventTarget);

  <span class="hljs-comment">// 2. 调用所有插件进行事件提取</span>
  <span class="hljs-keyword">const</span> dispatchQueue = [];
  <span class="hljs-title function_">extractEvents</span>(
    dispatchQueue,
    domEventName,
    targetInst,
    nativeEvent
    <span class="hljs-comment">// ...</span>
  );

  <span class="hljs-comment">// 3. 执行队列中的监听器</span>
  <span class="hljs-title function_">processDispatchQueue</span>(dispatchQueue, eventSystemFlags);
}
</code></pre>
<h2 data-id="heading-11">四、插件系统与跨平台抽象</h2>
<h3 data-id="heading-12">4.1 <code>extractEvents</code> 中央分发器</h3>
<p><code>DOMPluginEventSystem.js</code> 中的 <code>extractEvents</code> 函数是插件系统的“派单中心”。它不自己处理逻辑，而是按顺序调用所有插件，让它们各自处理自己关心的事件。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">extractEvents</span>(<span class="hljs-params">
  dispatchQueue: DispatchQueue,
  domEventName: DOMEventName
  <span class="hljs-comment">// ...</span>
</span>) {
  <span class="hljs-comment">// 1. 首先调用最基础的 SimpleEventPlugin</span>
  <span class="hljs-title class_">SimpleEventPlugin</span>.<span class="hljs-title function_">extractEvents</span>(
    dispatchQueue,
    domEventName
    <span class="hljs-comment">// ...</span>
  );

  <span class="hljs-comment">// 2. 然后依次调用其他作为 Polyfill 的插件</span>
  <span class="hljs-title class_">EnterLeaveEventPlugin</span>.<span class="hljs-title function_">extractEvents</span>(<span class="hljs-comment">/* ... */</span>);
  <span class="hljs-title class_">ChangeEventPlugin</span>.<span class="hljs-title function_">extractEvents</span>(<span class="hljs-comment">/* ... */</span>);
  <span class="hljs-title class_">SelectEventPlugin</span>.<span class="hljs-title function_">extractEvents</span>(<span class="hljs-comment">/* ... */</span>);
  <span class="hljs-title class_">BeforeInputEventPlugin</span>.<span class="hljs-title function_">extractEvents</span>(<span class="hljs-comment">/* ... */</span>);
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<h3 data-id="heading-13">4.2 <code>SimpleEventPlugin</code>：标准事件处理流水线</h3>
<p>作为最核心的插件，<code>SimpleEventPlugin</code> 的 <code>extractEvents</code> 负责处理大部分一对一的标准事件。</p>
<p>它的工作流程是：</p>
<ol>
<li><strong>识别事件</strong>：通过 <code>topLevelEventsToReactNames</code> 映射表，将 <code>click</code> 转换为 <code>onClick</code>。</li>
<li><strong>选择构造函数</strong>：通过一个 <code>switch</code> 语句，为 <code>click</code> 事件选择 <code>SyntheticMouseEvent</code> 作为合成事件的构造函数。</li>
<li><strong>收集监听器</strong>：调用 <code>accumulateSinglePhaseListeners</code> 或 <code>accumulateTwoPhaseListeners</code>，在 Fiber 树上从事件目标开始向上遍历，收集所有 <code>props.onClick</code> 和 <code>props.onClickCapture</code> 的监听器。</li>
<li><strong>创建任务</strong>：如果收集到监听器，则创建一个 <code>SyntheticMouseEvent</code> 实例，并和监听器数组一起打包成 <code>{event, listeners}</code> 对象，推入 <code>dispatchQueue</code>。</li>
</ol>
<h3 data-id="heading-14">4.3 <code>ChangeEventPlugin</code>：复杂事件的模拟</h3>
<p><code>ChangeEventPlugin</code> 则展示了插件系统如何作为 Polyfill 抹平浏览器差异。它会监听 <code>input</code>, <code>keydown</code>, <code>click</code> 等多个原生事件，通过内部状态追踪，最终模拟出在所有表单元素上行为都统一的 <code>onChange</code> 事件，并将其任务推入 <code>dispatchQueue</code>。</p>
<h2 data-id="heading-15">五、队列执行与回调触发</h2>
<h3 data-id="heading-16">5.1 <code>processDispatchQueue</code> 与 <code>executeDispatch</code></h3>
<p>在所有插件完成工作后，<code>processDispatchQueue</code> 会遍历 <code>dispatchQueue</code> 队列，并根据当前是捕获还是冒泡阶段，以正确的顺序执行所有收集到的监听器。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">processDispatchQueue</span>(<span class="hljs-params">
  dispatchQueue: DispatchQueue,
  eventSystemFlags: EventSystemFlags
</span>): <span class="hljs-keyword">void</span> {
  <span class="hljs-keyword">const</span> isCapturePhase = (eventSystemFlags &amp; <span class="hljs-variable constant_">CAPTURE_PHASE</span>) !== <span class="hljs-number">0</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; dispatchQueue.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">const</span> { event, listeners } = dispatchQueue[i];
    <span class="hljs-keyword">if</span> (isCapturePhase) {
      <span class="hljs-comment">// 捕获阶段：正序执行</span>
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">0</span>; j &lt; listeners.<span class="hljs-property">length</span>; j++) {
        <span class="hljs-title function_">executeDispatch</span>(event, listeners[j]);
        <span class="hljs-keyword">if</span> (event.<span class="hljs-title function_">isPropagationStopped</span>()) <span class="hljs-keyword">break</span>;
      }
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// 冒泡阶段：逆序执行</span>
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = listeners.<span class="hljs-property">length</span>; j-- &gt; <span class="hljs-number">0</span>; ) {
        <span class="hljs-title function_">executeDispatch</span>(event, listeners[j]);
        <span class="hljs-keyword">if</span> (event.<span class="hljs-title function_">isPropagationStopped</span>()) <span class="hljs-keyword">break</span>;
      }
    }
  }
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">executeDispatch</span>(<span class="hljs-params">event: ReactSyntheticEvent, listener: <span class="hljs-built_in">Function</span></span>): <span class="hljs-keyword">void</span> {
  <span class="hljs-comment">// 在执行前检查事件是否已被停止传播</span>
  <span class="hljs-keyword">if</span> (event.<span class="hljs-title function_">isPropagationStopped</span>()) {
    <span class="hljs-keyword">return</span>;
  }
  <span class="hljs-comment">// 真正执行用户定义的回调函数</span>
  <span class="hljs-title function_">listener</span>(event);
}
</code></pre>
<p>这个过程清晰地展示了 React 事件系统是如何解耦“收集”和“执行”这两个步骤的，为批处理和并发渲染中的复杂调度提供了可能。</p>
<h2 data-id="heading-17">六、整体流程图</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d531058ec1d44feac4789963cb27514~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF5MQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765117893&amp;x-signature=Rzbd1KZRwYKIn59WFdK6TgNfnyI%3D" alt="2-1.png" loading="lazy"/></p>
<h2 data-id="heading-18">七、总结</h2>
<p>回顾 React 事件系统，三个技术贯穿始终：一是委托 + 合成事件，既减少监听数量又抹平浏览器差异，解决原生事件的性能与兼容痛点；二是插件化架构，将不同类型事件（如鼠标、表单、进入离开）的处理逻辑解耦，方便扩展与维护；三是优先级协同，通过离散 / 连续事件的优先级划分，让用户关键交互（点击、输入）优先响应，平衡流畅度与主线程效率。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【vue高频面试题】第一题：Vue 3 相比 Vue 2，有哪些重大变化？]]></title>    <link>https://juejin.cn/post/7578114667463311379</link>    <guid>https://juejin.cn/post/7578114667463311379</guid>    <pubDate>2025-12-01T02:00:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578114667463311379" data-draft-id="7578348333249495046" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【vue高频面试题】第一题：Vue 3 相比 Vue 2，有哪些重大变化？"/> <meta itemprop="keywords" content="前端,面试"/> <meta itemprop="datePublished" content="2025-12-01T02:00:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端一课"/> <meta itemprop="url" content="https://juejin.cn/user/1169536102963917"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【vue高频面试题】第一题：Vue 3 相比 Vue 2，有哪些重大变化？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1169536102963917/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端一课
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T02:00:45.000Z" title="Mon Dec 01 2025 02:00:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{line-height:1.75;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;letter-spacing:2px;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%;word-break:break-word;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1{font-size:23px;margin-bottom:5px;font-weight:700;padding-left:10px;border-left:5px solid #773098}.markdown-body h2{font-size:19px;font-weight:700;padding-left:10px;border-left:5px solid #916dd5}.markdown-body h3{font-size:17px;font-weight:700;padding-left:10px;border-left:5px solid #d89cf6}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;max-width:100%;margin:1em 0;border-radius:6px;box-shadow:2px 4px 7px #999;user-select:none}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{padding:.2em .5em;font-weight:700;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-size:1em;color:#916dd5;word-break:break-word;overflow-x:auto;background-color:none;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-weight:400;font-size:.9em;padding:16px 12px;margin:0;color:#333;word-break:normal;overflow-x:auto;background:#f8f8f8;scroll-behavior:smooth}.markdown-body a{text-decoration:none;color:#916dd5;font-weight:700;border-bottom:1px solid #916dd5}.markdown-body a:active,.markdown-body a:hover{color:#773098}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border:1px solid #916dd5;border-collapse:collapse}.markdown-body thead{background-color:#916dd5;color:#fff;text-align:left}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;border:1px solid #916dd5}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #d89cf6;background-color:#f4eeff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0;line-height:26px}.markdown-body ol,.markdown-body ul{padding-left:28px;list-style-type:circle}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{color:#916dd5;font-weight:700}.markdown-body b:before,.markdown-body strong:before{content:"「"}.markdown-body b:after,.markdown-body strong:after{content:"」"}.markdown-body em,.markdown-body i{color:#916dd5}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="github-gist">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#333}.hljs-comment,.hljs-meta{color:#969896}.hljs-emphasis,.hljs-quote,.hljs-strong,.hljs-template-variable,.hljs-variable{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#d73a49}.hljs-attribute,.hljs-bullet,.hljs-literal,.hljs-symbol{color:#0086b3}.hljs-name,.hljs-section{color:#63a35c}.hljs-tag{color:#333}.hljs-attr,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-title{color:#6f42c1}.hljs-addition{color:#55a532;background-color:#eaffea}.hljs-deletion{color:#bd2c00;background-color:#ffecec}.hljs-link{text-decoration:underline}.hljs-number{color:#005cc5}.hljs-string{color:#032f62}</style><h2 data-id="heading-0">Vue 3 与 Vue 2 关键差异与高频面试要点</h2>
<p>面向“面试与复习”的精炼笔记，已去除重复内容并规范为 Markdown。围绕响应式、组合式 API、性能与体积、TypeScript 支持，以及新特性（Teleport、Suspense、多根节点、自定义渲染器）进行归纳，并提供可直接复用的示例代码。</p>
<h3 data-id="heading-1">核心差异速览</h3>
<ul>
<li>响应式系统：Vue 3 采用 <code>Proxy</code> 替代 Vue 2 的 <code>Object.defineProperty</code>。</li>
<li>组合式 API：<code>setup</code>、<code>ref</code>、<code>reactive</code>、<code>computed</code> 等，逻辑复用更自然，适合大型项目。</li>
<li>性能与体积：编译期与运行时优化更深入，<code>Tree-shaking</code> 更彻底，包体更小。</li>
<li>TypeScript 支持：以 TS 重写，类型推断更强，开发体验提升明显。</li>
<li>新特性：<code>Teleport</code>、<code>Suspense</code>、多根节点支持，自定义渲染器能力更强。</li>
</ul>
<h3 data-id="heading-2">响应式系统</h3>
<ul>
<li>为什么使用 <code>Proxy</code>：
<ul>
<li>原生支持属性的新增/删除监听，无需 <code>Vue.set</code>。</li>
<li>更好支持数组索引与 <code>length</code> 变化。</li>
<li>更符合现代语言特性，性能与可维护性更优。</li>
</ul>
</li>
<li><code>ref</code> 与 <code>reactive</code> 的取舍：
<ul>
<li><code>ref</code> 适合基本类型或需要单独引用的值，访问需使用 <code>.value</code>。</li>
<li><code>reactive</code> 适合对象/数组整体响应式代理，直接解构可能丢失响应需谨慎。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-3">组合式 API（Composition API）</h3>
<ul>
<li>优势：高内聚的逻辑复用、可抽取为 <code>composables</code>，跨文件共享更顺畅；对复杂业务与大型组件更友好。</li>
<li>与 Options API 共存：简单组件仍可用 Options；复杂场景优先 Composition。</li>
<li>与 TypeScript 的协作：类型系统更完善，<code>ref&lt;T&gt;</code>/<code>reactive&lt;T&gt;</code> 泛型增强开发体验。</li>
</ul>
<p>示例：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { ref, computed } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title function_">setup</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> count = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">const</span> double = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> count.<span class="hljs-property">value</span> * <span class="hljs-number">2</span>);
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">increment</span> = (<span class="hljs-params"/>) =&gt; count.<span class="hljs-property">value</span>++;
    <span class="hljs-keyword">return</span> { count, double, increment };
  }
}
</code></pre>
<h3 data-id="heading-4">性能与体积优化</h3>
<ul>
<li>编译器优化：静态节点提升、事件绑定优化，减少运行时负担。</li>
<li>虚拟 DOM 改进：更高效的 diff 与 patch 策略。</li>
<li><code>Tree-shaking</code>：未使用的 API（如 <code>Teleport</code>）不会进入最终包体。</li>
</ul>
<h3 data-id="heading-5">TypeScript 支持</h3>
<ul>
<li>框架以 TypeScript 重写：类型定义更完善、推断更准确。</li>
<li>Props 与组件类型推断更强，减少样板代码与类型声明负担。</li>
</ul>
<p>示例：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">const</span> count = ref&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-number">0</span>);
</code></pre>
<h3 data-id="heading-6">新内置组件与特性</h3>
<ul>
<li>Teleport：将子组件渲染到指定的 DOM 容器，适用于弹窗/浮层等全局层级内容。</li>
</ul>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;Teleport to="#modal"&gt;
    &lt;div class="modal"&gt;这是弹窗内容&lt;/div&gt;
  &lt;/Teleport&gt;
  &lt;div id="modal"&gt;&lt;/div&gt;
  &lt;button @click="open = true"&gt;打开&lt;/button&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import { ref } from 'vue';
const open = ref(false);
&lt;/script&gt;
</code></pre>
<ul>
<li>Suspense：为异步组件提供占位与完成态切换，优化加载体验。</li>
</ul>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;Suspense&gt;
    &lt;template #default&gt;
      &lt;AsyncView /&gt;
    &lt;/template&gt;
    &lt;template #fallback&gt;
      &lt;div&gt;加载中...&lt;/div&gt;
    &lt;/template&gt;
  &lt;/Suspense&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { defineAsyncComponent } from 'vue'
const AsyncView = defineAsyncComponent(() =&gt; import('./AsyncView.vue'))
&lt;/script&gt;
</code></pre>
<ul>
<li>多根节点支持：组件模板不再强制单根，结构更简洁，避免多余包裹。</li>
<li>自定义渲染器：扩展到非 DOM 场景（原生、Canvas 等）。</li>
</ul>
<h3 data-id="heading-7">高频追问与要点速答</h3>
<ul>
<li>为什么 <code>Proxy</code> 更优？支持属性新增/删除与数组细粒度监听，API 更现代。</li>
<li><code>ref</code> / <code>reactive</code> 如何选择？值与基本类型用 <code>ref</code>，对象/数组整体用 <code>reactive</code>。</li>
<li>Composition API 的优势？逻辑复用、模块化、与 TS 协同更好，适合复杂业务。</li>
<li>编译与性能优化体现？静态提升、事件优化、<code>Tree-shaking</code>，更小更快。</li>
<li>Teleport/Suspense 的场景？弹窗、全局浮层与异步加载占位。</li>
<li>多根节点的好处？更简洁的结构，减少无意义包裹。</li>
</ul>
<h3 data-id="heading-8">总结</h3>
<p>Vue 3 在响应式、API 设计、性能与类型系统方面全面升级。掌握核心差异与常用场景（弹窗、异步组件、类型推断），再结合可落地的示例代码，基本可以覆盖多数面试与复盘问答。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[基于Rokid Glasses的AI助盲应用实践：让科技点亮视障者的世界]]></title>    <link>https://juejin.cn/post/7577971299743662118</link>    <guid>https://juejin.cn/post/7577971299743662118</guid>    <pubDate>2025-11-30T15:17:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577971299743662118" data-draft-id="7577968429591019546" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="基于Rokid Glasses的AI助盲应用实践：让科技点亮视障者的世界"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-11-30T15:17:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="轻口味"/> <meta itemprop="url" content="https://juejin.cn/user/1134351728250568"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            基于Rokid Glasses的AI助盲应用实践：让科技点亮视障者的世界
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1134351728250568/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    轻口味
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T15:17:48.000Z" title="Sun Nov 30 2025 15:17:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">基于Rokid Glasses的AI助盲应用实践：让科技点亮视障者的世界</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8589bbcea14e41debe4b038829893800~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L275Y-j5ZGz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765120667&amp;x-signature=bWDKQVVnRMXpGJ2qUOytv%2BdrDC4%3D" alt="image.jpg" loading="lazy"/></p>
<h3 data-id="heading-1">一、项目背景与意义</h3>
<p>在人工智能技术快速发展的今天，AI智能眼镜作为AI与现实世界交互的重要载体，正在改变我们的生活方式。对于视障人群而言，如何通过技术手段帮助他们更好地感知和理解周围环境，是一个具有重要社会意义的课题。华为手机推出的"小艺看世界"功能，通过AI图像识别帮助用户了解周围环境，这给了我们很大的启发。然而，小艺看世界是在手机上实现的，对于视障用户来说存在明显的不友好之处，需要拿出手机、打开应用、对准目标、按下拍照按钮，整个过程需要双手操作，对于视障用户来说非常困难。</p>
<p>Rokid Glasses作为AI智能眼镜，天然适合视障辅助应用，眼镜佩戴在头上，无需手持设备，可以在任何场景下使用，而且摄像头位置与眼睛位置一致，拍摄角度更自然，识别更准确。基于这个思路，使用<strong>Rokid Glasses</strong>和<strong>Rokid CXR-M SDK</strong>，开发了一款AI助盲应用"盲导"，通过语音指令触发拍照、AI图像识别和TTS语音播报，帮助视障用户识别周围环境、寻找物品、认路导航等，让科技真正服务于特殊人群的需求。</p>
<h3 data-id="heading-2">二、技术架构设计</h3>
<h4 data-id="heading-3">2.1 整体架构</h4>
<p>本项目采用<strong>手机端+眼镜端</strong>协同工作的架构模式：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph Glasses["Rokid Glasses (眼镜端)"]
        A1[AI按键]
        A2[录音功能]
        A3[拍照功能]
        A4[TTS播放]
        A5[显示反馈]
    end
    
    subgraph Phone["Android手机 (手机端)"]
        B1[UI界面]
        B2[蓝牙管理]
        B3[设备绑定管理]
        B4[AI事件监听]
        B5[录音管理]
        B6[ASR和意图识别]
        B7[场景解析服务]
        B8[业务逻辑控制]
    end
    
    subgraph Cloud["云端服务"]
        C1[ASR服务&lt;br/&gt;语音识别]
        C2[意图识别服务]
        C3[场景解析服务&lt;br/&gt;AI图像分析]
    end
    
    A1 --&gt;|AI按键事件| B4
    B4 --&gt;|onAiKeyDown| B5
    B5 --&gt;|开始录音| A2
    A2 --&gt;|音频流数据| B5
    B4 --&gt;|onAiKeyUp| B5
    B5 --&gt;|停止录音| A2
    B5 --&gt;|录音数据| B6
    B6 --&gt;|发送音频| C1
    C1 --&gt;|识别文本| B6
    B6 --&gt;|文本| C2
    C2 --&gt;|意图类型| B6
    B6 --&gt;|意图判断| B8
    B8 --&gt;|拍照指令| A3
    A3 --&gt;|照片数据| B7
    B7 --&gt;|上传照片| C3
    C3 --&gt;|场景描述| B7
    B7 --&gt;|描述文本| B8
    B8 --&gt;|TTS文本| A4
    B2 &lt;--&gt;|蓝牙双向通信| A1
    B2 &lt;--&gt;|蓝牙双向通信| A2
    B2 &lt;--&gt;|蓝牙双向通信| A3
    B3 --&gt;|设备绑定信息| B2
    
    style Glasses fill:#e1f5ff
    style Phone fill:#fff4e1
    style Cloud fill:#ffe1f5
</code></pre>
<h4 data-id="heading-4">2.2 核心模块</h4>
<p>手机端提供了Android SDK，基于Android APP的开发方式开发手机端，作为Glasses端与云端AI的中介。</p>
<h6 data-id="heading-5">2.2.1  工程整体结构</h6>
<p>项目核心类代码如下：</p>
<pre><code class="hljs language-bash" lang="bash">app/src/main/java/com/qingkouwei/rokidclient2/
├── MainActivity.kt                    <span class="hljs-comment"># 主Activity，应用入口</span>
├── MainViewModel.kt                   <span class="hljs-comment"># 主业务逻辑ViewModel</span>
├── DeviceBindingActivity.kt           <span class="hljs-comment"># 设备绑定页面</span>
├── DeviceBindingViewModel.kt          <span class="hljs-comment"># 设备绑定逻辑</span>
│
├── BluetoothHelper.kt                 <span class="hljs-comment"># 蓝牙扫描和发现</span>
├── RokidConnectionManager.kt          <span class="hljs-comment"># Rokid SDK连接封装</span>
├── DeviceBindingManager.kt            <span class="hljs-comment"># 设备绑定信息持久化</span>
│
├── AIEventListenerManager.kt           <span class="hljs-comment"># AI事件监听管理</span>
├── AudioRecordManager.kt              <span class="hljs-comment"># 录音管理</span>
├── ASRIntentService.kt                <span class="hljs-comment"># ASR和意图识别</span>
├── SceneAnalysisService.kt            <span class="hljs-comment"># 场景解析服务</span>
├── TTSManager.kt                      <span class="hljs-comment"># TTS语音播报管理</span>
│
├── PhotoCaptureManager.kt            <span class="hljs-comment"># 拍照功能封装</span>
├── AIImageAnalyzer.kt                 <span class="hljs-comment"># AI图像分析（可选）</span>
└── RokidSDKStub.kt                    <span class="hljs-comment"># SDK接口桩（开发环境）</span>
</code></pre>
<h6 data-id="heading-6">2.2.2 核心模块介绍</h6>
<h6 data-id="heading-7">2.2.2.1 设备绑定模块</h6>
<p><strong>DeviceBindingManager.kt</strong> - 设备绑定信息管理</p>
<ul>
<li>使用SharedPreferences持久化保存设备绑定信息</li>
<li>管理设备名称、地址、socketUuid、macAddress</li>
<li>提供设备绑定状态检查接口</li>
</ul>
<p><strong>DeviceBindingActivity.kt</strong> - 设备绑定UI</p>
<ul>
<li>扫描周边Rokid设备</li>
<li>显示设备列表供用户选择</li>
<li>处理设备绑定和连接流程</li>
</ul>
<p><strong>BluetoothHelper.kt</strong> - 蓝牙扫描管理</p>
<ul>
<li>使用UUID <code>0000be80-0000-1000-8000-00805f9b34fb</code>过滤Rokid设备</li>
<li>支持已配对设备和扫描发现设备</li>
<li>完整的权限管理和蓝牙状态监听</li>
</ul>
<h6 data-id="heading-8">2.2.2.2 连接管理模块</h6>
<p><strong>RokidConnectionManager.kt</strong> - Rokid SDK连接封装</p>
<ul>
<li>封装<code>initBluetooth()</code>和<code>connectBluetooth()</code>调用</li>
<li>统一连接回调处理</li>
<li>支持自动重连机制</li>
</ul>
<h6 data-id="heading-9">2.2.2.3 AI交互模块</h6>
<p><strong>AIEventListenerManager.kt</strong> - AI事件监听</p>
<ul>
<li>设置和取消AI事件监听器</li>
<li>处理<code>onAiKeyDown</code>、<code>onAiKeyUp</code>、<code>onAiExit</code>事件</li>
</ul>
<p><strong>AudioRecordManager.kt</strong> - 录音管理</p>
<ul>
<li>管理<code>openAudioRecord()</code>和<code>closeAudioRecord()</code>调用</li>
<li>通过<code>AudioStreamListener</code>收集音频流数据</li>
<li>返回完整的录音数据</li>
</ul>
<h6 data-id="heading-10">2.2.2.4 业务处理模块</h6>
<p><strong>ASRIntentService.kt</strong> - ASR和意图识别</p>
<ul>
<li>处理语音识别（调用云端ASR能力）</li>
<li>识别用户意图（拍照、导航等）</li>
<li>返回识别文本和意图类型</li>
</ul>
<p><strong>SceneAnalysisService.kt</strong> - 场景解析</p>
<ul>
<li>分析照片场景（调用云端大模型解析图片内容）</li>
<li>生成适合视障用户理解的描述文本</li>
</ul>
<p><strong>TTSManager.kt</strong> - TTS语音播报</p>
<ul>
<li>使用<code>sendTTSContent()</code>发送文本到眼镜端</li>
<li>处理TTS播放状态回调</li>
<li>管理播放完成和错误处理</li>
</ul>
<h6 data-id="heading-11">2.2.2.5 业务逻辑控制模块</h6>
<p><strong>MainViewModel.kt</strong> - 主业务逻辑</p>
<ul>
<li>协调各模块工作</li>
<li>处理设备自动连接</li>
<li>实现完整的AI交互流程：录音 → ASR → 意图识别 → 拍照 → 场景解析 → TTS播报</li>
</ul>
<h4 data-id="heading-12">2.3 完整工作流程</h4>
<h5 data-id="heading-13">步骤1：应用启动和设备绑定</h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// MainActivity.kt</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> : <span class="hljs-type">ComponentActivity</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)
        
        <span class="hljs-keyword">val</span> bindingManager = DeviceBindingManager(<span class="hljs-keyword">this</span>)
        
        <span class="hljs-comment">// 检查设备是否已绑定</span>
        <span class="hljs-keyword">if</span> (!bindingManager.isDeviceBound()) {
            <span class="hljs-comment">// 未绑定，跳转到绑定页面</span>
            <span class="hljs-keyword">val</span> intent = Intent(<span class="hljs-keyword">this</span>, DeviceBindingActivity::<span class="hljs-keyword">class</span>.java)
            startActivity(intent)
            finish()
            <span class="hljs-keyword">return</span>
        }
        
        <span class="hljs-comment">// 已绑定，自动连接</span>
        viewModel.autoConnect(bindingManager, bluetoothHelper)
    }
}
</code></pre>
<p><strong>绑定流程</strong>：</p>
<ol>
<li>首次安装时，检查设备绑定状态</li>
<li>未绑定则跳转到设备绑定页面</li>
<li>扫描周边Rokid设备（使用UUID过滤）</li>
<li>用户选择设备并绑定</li>
<li>连接成功后保存设备信息（名称、地址、socketUuid、macAddress）</li>
<li>跳转到主页面</li>
</ol>
<p><strong>自动连接流程</strong>：</p>
<ol>
<li>应用启动时检查是否已绑定设备</li>
<li>从SharedPreferences读取绑定信息</li>
<li>查找已配对设备或使用保存的连接信息</li>
<li>调用<code>connectBluetooth()</code>建立连接</li>
<li>连接成功后设置AI事件监听</li>
</ol>
<h5 data-id="heading-14">步骤2：设置AI事件监听</h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// MainViewModel.kt</span>
<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">setupAIEventListener</span><span class="hljs-params">()</span></span> {
    aiEventListenerManager.setAIEventListener(
        <span class="hljs-keyword">object</span> : AIEventListenerManager.AIEventListenerCallback {
            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onAiKeyDown</span><span class="hljs-params">()</span></span> {
                <span class="hljs-comment">// AI按键按下，开始录音</span>
                startRecording()
            }

            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onAiKeyUp</span><span class="hljs-params">()</span></span> {
                <span class="hljs-comment">// AI按键释放，停止录音并处理</span>
                stopRecordingAndProcess()
            }

            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onAiExit</span><span class="hljs-params">()</span></span> {
                <span class="hljs-comment">// AI场景退出</span>
            }
        },
        <span class="hljs-keyword">set</span> = <span class="hljs-literal">true</span>
    )
}
</code></pre>
<h5 data-id="heading-15">步骤3：录音处理</h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// MainViewModel.kt</span>
<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">startRecording</span><span class="hljs-params">()</span></span> {
    audioRecordManager.startRecording(
        <span class="hljs-keyword">object</span> : AudioRecordManager.AudioRecordCallback {
            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onRecordingStarted</span><span class="hljs-params">()</span></span> {
                updateStatus(<span class="hljs-string">"正在录音..."</span>)
            }
        }
    )
}

<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">stopRecordingAndProcess</span><span class="hljs-params">()</span></span> {
    viewModelScope.launch {
        <span class="hljs-keyword">val</span> audioData = audioRecordManager.stopRecording()
        <span class="hljs-keyword">if</span> (audioData != <span class="hljs-literal">null</span> &amp;&amp; audioData.isNotEmpty()) {
            processRecordedAudio(audioData)
        }
    }
}

<span class="hljs-comment">//AudioRecordManager.kt</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">startRecording</span><span class="hljs-params">(callback: <span class="hljs-type">AudioRecordCallback</span>)</span></span> {  
    <span class="hljs-keyword">this</span>.callback = callback  
      
    <span class="hljs-comment">// Set audio stream listener  </span>
    CxrApi.getInstance().setAudioStreamListener(audioStreamListener)  
      
    <span class="hljs-comment">// Open audio record  </span>
    <span class="hljs-keyword">val</span> status = CxrApi.getInstance().openAudioRecord(CODEC_TYPE_OPUS, STREAM_TYPE)  
    <span class="hljs-keyword">if</span> (status == ValueUtil.CxrStatus.REQUEST_SUCCEED) {  
        Log.d(TAG, <span class="hljs-string">"Audio recording started"</span>)  
    } <span class="hljs-keyword">else</span> {  
        Log.e(TAG, <span class="hljs-string">"Failed to start audio recording: <span class="hljs-variable">$status</span>"</span>)  
        callback.onError(<span class="hljs-string">"Failed to start recording: <span class="hljs-variable">$status</span>"</span>)  
    }  
}  
  
<span class="hljs-comment">/**  
 * Stop recording */</span><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">stopRecording</span><span class="hljs-params">()</span></span>: ByteArray? = withContext(Dispatchers.IO) {  
    <span class="hljs-keyword">if</span> (!isRecording) {  
        Log.w(TAG, <span class="hljs-string">"Not recording, cannot stop"</span>)  
        <span class="hljs-comment">// Remove audio stream listener  </span>
        CxrApi.getInstance().setAudioStreamListener(<span class="hljs-literal">null</span>)  
        <span class="hljs-keyword">return</span><span class="hljs-symbol">@withContext</span> <span class="hljs-literal">null</span>  
    }  
  
    <span class="hljs-comment">// Close audio record  </span>
    <span class="hljs-keyword">val</span> status = CxrApi.getInstance().closeAudioRecord(STREAM_TYPE)  
      
    <span class="hljs-comment">// Remove audio stream listener  </span>
    CxrApi.getInstance().setAudioStreamListener(<span class="hljs-literal">null</span>)  
      
    <span class="hljs-keyword">if</span> (status == ValueUtil.CxrStatus.REQUEST_SUCCEED) {  
        isRecording = <span class="hljs-literal">false</span>  
        <span class="hljs-comment">// Get recorded audio data  </span>
        <span class="hljs-keyword">val</span> audioData = audioDataBuffer.toByteArray()  
        recordedAudioData = audioData  
        audioDataBuffer.reset()  
          
        Log.d(TAG, <span class="hljs-string">"Audio recording stopped, data size: <span class="hljs-subst">${audioData.size}</span>"</span>)  
        callback?.onRecordingStopped(audioData)  
        <span class="hljs-keyword">return</span><span class="hljs-symbol">@withContext</span> audioData  
    } <span class="hljs-keyword">else</span> {  
        Log.e(TAG, <span class="hljs-string">"Failed to stop audio recording: <span class="hljs-variable">$status</span>"</span>)  
        callback?.onError(<span class="hljs-string">"Failed to stop recording: <span class="hljs-variable">$status</span>"</span>)  
        <span class="hljs-keyword">return</span><span class="hljs-symbol">@withContext</span> <span class="hljs-literal">null</span>  
    }  
}
</code></pre>
<p><strong>录音流程</strong>：</p>
<ol>
<li><code>onAiKeyDown</code>事件触发，调用<code>openAudioRecord()</code></li>
<li>设置<code>AudioStreamListener</code>接收音频流数据</li>
<li>持续收集音频数据到Buffer</li>
<li><code>onAiKeyUp</code>事件触发，调用<code>closeAudioRecord()</code></li>
<li>返回完整的录音数据</li>
</ol>
<h5 data-id="heading-16">步骤4：ASR和意图识别</h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// MainViewModel.kt</span>
<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">processRecordedAudio</span><span class="hljs-params">(audioData: <span class="hljs-type">ByteArray</span>)</span></span> {
    viewModelScope.launch {
        asrIntentService.processAudio(
            audioData,
            <span class="hljs-keyword">object</span> : ASRIntentService.ASRCallback {
                <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSuccess</span><span class="hljs-params">(result: <span class="hljs-type">ASRIntentService</span>.<span class="hljs-type">ASRResult</span>)</span></span> {
                    <span class="hljs-comment">// 发送ASR结果到眼镜端显示</span>
                    CxrApi.getInstance().sendAsrContent(result.text)
                    CxrApi.getInstance().notifyAsrEnd()
                    
                    <span class="hljs-comment">// 根据意图执行相应操作</span>
                    <span class="hljs-keyword">when</span> (result.intent) {
                        ASRIntentService.IntentType.PHOTO -&gt; {
                            handlePhotoIntent()
                        }
                        ASRIntentService.IntentType.UNKNOWN -&gt; {
                            <span class="hljs-comment">// 未识别意图</span>
                            CxrApi.getInstance().notifyAsrError()
                        }
                    }
                }
            }
        )
    }
}
</code></pre>
<p><strong>ASR和意图识别流程</strong>：</p>
<ol>
<li>将录音数据发送到ASR服务（当前为模拟实现）</li>
<li>获取识别文本</li>
<li>将文本发送到意图识别服务</li>
<li>获取意图类型（拍照、导航等）</li>
<li>将识别文本发送到眼镜端显示</li>
<li>根据意图执行相应操作</li>
</ol>
<h5 data-id="heading-17">步骤5：拍照和场景解析</h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// MainViewModel.kt</span>
<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handlePhotoIntent</span><span class="hljs-params">()</span></span> {
    viewModelScope.launch {
        <span class="hljs-comment">// 打开相机</span>
        CxrApi.getInstance().openGlassCamera(<span class="hljs-number">1920</span>, <span class="hljs-number">1080</span>, <span class="hljs-number">80</span>)
        
        <span class="hljs-comment">// 拍照</span>
        CxrApi.getInstance().takeGlassPhoto(
            <span class="hljs-number">1920</span>, <span class="hljs-number">1080</span>, <span class="hljs-number">80</span>,
            <span class="hljs-keyword">object</span> : PhotoResultCallback {
                <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onPhotoResult</span><span class="hljs-params">(status: <span class="hljs-type">ValueUtil</span>.<span class="hljs-type">CxrStatus</span>?, photo: <span class="hljs-type">ByteArray</span>?)</span></span> {
                    <span class="hljs-keyword">if</span> (status == ValueUtil.CxrStatus.RESPONSE_SUCCEED &amp;&amp; photo != <span class="hljs-literal">null</span>) {
                        <span class="hljs-comment">// 分析场景</span>
                        analyzeSceneAndSpeak(photo)
                    }
                }
            }
        )
    }
}
</code></pre>
<p><strong>拍照流程</strong>：</p>
<ol>
<li>调用<code>openGlassCamera()</code>打开眼镜端相机</li>
<li>调用<code>takeGlassPhoto()</code>触发拍照</li>
<li>照片以WebP格式通过蓝牙传输</li>
<li><code>PhotoResultCallback.onPhotoResult()</code>回调接收照片数据</li>
</ol>
<h5 data-id="heading-18">步骤6：场景解析和TTS播报</h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// MainViewModel.kt</span>
<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">analyzeSceneAndSpeak</span><span class="hljs-params">(photoData: <span class="hljs-type">ByteArray</span>)</span></span> {
    viewModelScope.launch {
        sceneAnalysisService.analyzeScene(
            photoData,
            <span class="hljs-keyword">object</span> : SceneAnalysisService.AnalysisCallback {
                <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSuccess</span><span class="hljs-params">(description: <span class="hljs-type">String</span>)</span></span> {
                    <span class="hljs-comment">// 发送TTS内容到眼镜端播放</span>
                    CxrApi.getInstance().sendTtsContent(
                        description,
                        <span class="hljs-keyword">object</span> : TTSStatusCallback {
                            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onTTSStart</span><span class="hljs-params">()</span></span> {
                                <span class="hljs-comment">// TTS开始播放</span>
                            }
                            
                            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onTTSEnd</span><span class="hljs-params">()</span></span> {
                                <span class="hljs-comment">// TTS播放完成</span>
                            }
                            
                            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onTTSError</span><span class="hljs-params">(errorCode: <span class="hljs-type">Int</span>)</span></span> {
                                <span class="hljs-comment">// TTS播放失败</span>
                            }
                        }
                    )
                }
            }
        )
    }
}
</code></pre>
<p><strong>场景解析和TTS流程</strong>：</p>
<ol>
<li>将照片数据发送到场景解析服务（当前为模拟实现）</li>
<li>AI模型分析场景，生成描述文本</li>
<li>调用<code>sendTtsContent()</code>发送文本到眼镜端</li>
<li>眼镜端TTS引擎合成语音并播放</li>
<li>用户听到场景描述</li>
</ol>
<h4 data-id="heading-19">2.4 完整流程时序图</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant User as 用户
    participant App as 应用
    participant Binding as 设备绑定
    participant Connect as 连接管理
    participant Glasses as Rokid Glasses
    participant AIEvent as AI事件监听
    participant Record as 录音管理
    participant ASR as ASR服务
    participant AI as 场景解析
    participant TTS as TTS播报
    
    Note over App: 应用启动
    App-&gt;&gt;Binding: 检查设备绑定状态
    alt 未绑定
        App-&gt;&gt;App: 跳转绑定页面
        App-&gt;&gt;Glasses: 扫描设备
        User-&gt;&gt;App: 选择设备
        App-&gt;&gt;Connect: 连接设备
        Connect-&gt;&gt;Glasses: initBluetooth + connectBluetooth
        Connect-&gt;&gt;Binding: 保存绑定信息
    else 已绑定
        App-&gt;&gt;Connect: 自动连接
        Connect-&gt;&gt;Glasses: 使用保存信息连接
    end
    
    Connect-&gt;&gt;AIEvent: 设置AI事件监听
    AIEvent-&gt;&gt;Glasses: setAiEventListener(true)
    
    Note over User,TTS: 用户交互流程
    User-&gt;&gt;Glasses: 按下AI按键
    Glasses-&gt;&gt;AIEvent: onAiKeyDown
    AIEvent-&gt;&gt;Record: 开始录音
    Record-&gt;&gt;Glasses: openAudioRecord
    Glasses-&gt;&gt;Record: 音频流数据
    
    User-&gt;&gt;Glasses: 释放AI按键
    Glasses-&gt;&gt;AIEvent: onAiKeyUp
    AIEvent-&gt;&gt;Record: 停止录音
    Record-&gt;&gt;ASR: 发送录音数据
    ASR-&gt;&gt;ASR: 语音识别
    ASR-&gt;&gt;ASR: 意图识别
    ASR--&gt;&gt;Record: 返回意图(拍照)
    
    Record-&gt;&gt;Glasses: openGlassCamera
    Record-&gt;&gt;Glasses: takeGlassPhoto
    Glasses-&gt;&gt;AI: 照片数据
    AI-&gt;&gt;AI: 场景分析
    AI--&gt;&gt;Record: 场景描述
    Record-&gt;&gt;Glasses: sendTtsContent
    Glasses-&gt;&gt;User: 播放场景描述
</code></pre>
<h3 data-id="heading-20">三、实际应用场景演示</h3>
<h4 data-id="heading-21">3.1 场景一：识别道路环境</h4>
<p><strong>用户需求</strong>：盲人需要了解前方道路情况，判断是否可以安全行走</p>
<p><strong>工作流程</strong>：</p>
<ol>
<li>用户说："帮我看看前面的路"</li>
<li>应用触发拍照，获取前方道路图像</li>
<li>AI分析："前方是一条宽约2米的人行道，路面平整，右侧有盲道，左侧有绿化带，前方约10米处有一个垃圾桶，建议靠右行走"</li>
<li>通过TTS播放给用户</li>
</ol>
<p><strong>技术要点</strong>：</p>
<ul>
<li>使用Rokid SDK的<code>openGlassCamera()</code>和<code>takeGlassPhoto()</code>获取道路图像</li>
<li>AI提示词重点强调道路宽度、障碍物、安全提示等信息</li>
<li>描述语言简洁明确，便于盲人理解</li>
</ul>
<h4 data-id="heading-22">3.2 场景二：寻找丢失物品</h4>
<p><strong>用户需求</strong>：在房间内寻找丢失的钥匙</p>
<p><strong>工作流程</strong>：</p>
<ol>
<li>用户说："帮我找找钥匙"</li>
<li>应用拍照识别房间环境</li>
<li>AI分析："在视野中，我看到一个茶几，茶几上有一串银色的钥匙，位置在茶几中央偏左，距离你约3米"</li>
<li>用户根据描述找到钥匙</li>
</ol>
<p><strong>技术要点</strong>：</p>
<ul>
<li>多轮对话：先整体描述，再聚焦特定物品</li>
<li>位置描述使用相对位置（前后左右）和距离</li>
<li>物品特征描述（颜色、大小、形状）帮助识别</li>
</ul>
<h4 data-id="heading-23">3.3 场景三：阅读文字信息</h4>
<p><strong>用户需求</strong>：识别门牌号或路牌</p>
<p><strong>工作流程</strong>：</p>
<ol>
<li>用户说："帮我看看这个门牌号"</li>
<li>应用拍照识别</li>
<li>AI分析："门牌上写着：北京市朝阳区某某路123号"</li>
<li>清晰朗读给用户</li>
</ol>
<p><strong>技术要点</strong>：</p>
<ul>
<li>使用GPT-4o Vision的强大文字识别能力</li>
<li>按顺序朗读，避免信息混乱</li>
<li>支持中英文混合识别</li>
</ul>
<h3 data-id="heading-24">四、开发心得与总结</h3>
<h4 data-id="heading-25">4.1 Rokid SDK使用体验</h4>
<p>通过本项目的开发实践，我们深刻体验了Rokid CXR-M SDK的强大能力：</p>
<p><strong>1. API设计清晰直观</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 连接流程清晰，回调机制完善</span>
CxrApi.getInstance().initBluetooth(context, device, callback)
CxrApi.getInstance().connectBluetooth(context, uuid, address, callback)
</code></pre>
<p><strong>2. 功能覆盖全面</strong></p>
<ul>
<li>蓝牙连接：完整的BLE+经典蓝牙双通道支持</li>
<li>拍照功能：AI场景拍照，照片实时传输</li>
<li>设备控制：音量、亮度、电量等全方位控制</li>
<li>状态监听：连接状态、设备状态实时回调</li>
<li>覆盖了主要使用场景</li>
</ul>
<p><strong>3. 开发体验优秀</strong></p>
<ul>
<li>SDK集成简单，只需添加依赖</li>
<li>API调用直观，易于理解和使用</li>
<li>错误处理完善，便于调试</li>
</ul>
<h4 data-id="heading-26">4.2 技术挑战与解决方案</h4>
<p><strong>挑战1：Kotlin版本兼容性</strong></p>
<ul>
<li><strong>问题</strong>：Rokid SDK使用Kotlin 2.1.0编译，需要Java 17环境</li>
<li><strong>解决</strong>：升级开发环境到Java 17，或使用兼容的Kotlin版本</li>
</ul>
<p><strong>挑战2：蓝牙连接稳定性</strong></p>
<ul>
<li><strong>问题</strong>：蓝牙连接可能中断，需要保证稳定性</li>
<li><strong>解决</strong>：实现完善的错误处理和自动重连机制</li>
<li><strong>代码示例</strong>：</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onDisconnected</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 连接断开，自动尝试重连</span>
    <span class="hljs-keyword">if</span> (socketUuid != <span class="hljs-literal">null</span> &amp;&amp; macAddress != <span class="hljs-literal">null</span>) {
        connect(context, socketUuid!!, macAddress!!)
    }
}
</code></pre>
<p><strong>挑战3：AI响应时间</strong></p>
<ul>
<li><strong>问题</strong>：AI API调用可能有延迟</li>
<li><strong>解决</strong>：使用协程异步处理，显示处理进度，支持本地模型作为备选方案，在处理时进行友好语音提示，让用户感知到进度。</li>
</ul>
<h4 data-id="heading-27">4.3 Rokid SDK能力总结</h4>
<p>通过本项目的实践，我们充分验证了Rokid CXR-M SDK在以下方面的能力：</p>



































<table><thead><tr><th>能力类别</th><th>SDK功能</th><th>应用场景</th></tr></thead><tbody><tr><td><strong>连接能力</strong></td><td>蓝牙双通道连接</td><td>手机与眼镜的稳定通信</td></tr><tr><td><strong>数据交互</strong></td><td>AI场景拍照</td><td>获取眼镜端图像数据</td></tr><tr><td><strong>设备控制</strong></td><td>音量/亮度/电量</td><td>优化用户体验</td></tr><tr><td><strong>状态管理</strong></td><td>连接状态监听</td><td>实时反馈设备状态</td></tr><tr><td><strong>扩展性</strong></td><td>丰富的回调接口</td><td>支持复杂业务逻辑</td></tr></tbody></table>
<h4 data-id="heading-28">4.4 未来展望</h4>
<p>随着AI技术的不断发展和Rokid SDK能力的持续增强，AI助盲应用将能够：</p>
<ol>
<li><strong>更精准的环境理解</strong>：结合多帧图像进行3D场景重建，读取设备经纬度，识别更细微的环境变化，提供更准确的位置信息</li>
<li><strong>更自然的交互体验</strong>：支持连续对话，理解上下文，个性化学习用户习惯，更智能的提示和建议</li>
<li><strong>更多实用功能场景</strong>：实时导航引导物体跟踪和定位，社交场景识别（识别熟人、表情等）</li>
<li><strong>更好的性能表现</strong>：支持离线AI模型，提升响应速度，降低功耗</li>
</ol>
<h3 data-id="heading-29">五、总结</h3>
<p>盲导项目展示了如何利用Rokid Glasses和Rokid CXR-M SDK，结合AI技术开发具有实际社会价值的应用。通过完整的蓝牙连接、拍照传输、AI识别和语音播报流程，为视障人群提供了一个实用的辅助工具。</p>
<p><strong>Rokid SDK的强大能力为开发者提供了坚实的基础</strong>，使得我们可以专注于业务逻辑和用户体验的优化。无论是开发纯眼镜端应用，还是手机端配合眼镜的协同应用，Rokid SDK都能提供完整的支持。</p>
<p>相信随着技术的不断进步和Rokid SDK能力的持续增强，AI+AR的应用将在更多领域发挥重要作用，真正让科技服务于每一个人，让智能眼镜成为连接数字世界与现实世界的桥梁。</p>
<blockquote>
<p>开发环境介绍
<strong>项目名称</strong>：盲导 - AI助盲应用<br/>
<strong>技术栈</strong>：Kotlin + Jetpack Compose + Rokid CXR-M SDK + OpenAI Vision API<br/>
<strong>开发平台</strong>：Android<br/>
<strong>Rokid SDK版本</strong>：1.0.1-20250812.080117-2<br/>
<strong>致谢</strong>：感谢Rokid提供的优秀SDK和开发支持，让AI+AR应用的开发变得更加简单高效。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【ASO数据科学】拒绝盲猜：基于竞品归因模型的 App Store 关键词逆向工程实战]]></title>    <link>https://juejin.cn/post/7578037997323501587</link>    <guid>https://juejin.cn/post/7578037997323501587</guid>    <pubDate>2025-11-30T11:47:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578037997323501587" data-draft-id="7577905525998010409" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【ASO数据科学】拒绝盲猜：基于竞品归因模型的 App Store 关键词逆向工程实战"/> <meta itemprop="keywords" content="增长黑客"/> <meta itemprop="datePublished" content="2025-11-30T11:47:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="goldenpig"/> <meta itemprop="url" content="https://juejin.cn/user/133465076937242"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【ASO数据科学】拒绝盲猜：基于竞品归因模型的 App Store 关键词逆向工程实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/133465076937242/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    goldenpig
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T11:47:34.000Z" title="Sun Nov 30 2025 11:47:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    16
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">【ASO数据科学】拒绝盲猜：基于竞品归因模型的 App Store 关键词逆向工程实战</h2>
<blockquote>
<p><strong>摘要</strong>：在流量红利见顶的 2025 年，ASO（应用商店优化）已从单纯的运营手段演变为一门数据科学。本文提出一套基于“竞品归因模型”的增长方法论：通过监控版本迭代（Input）与榜单波动（Output）的时序相关性，逆向推导高权重关键词。文章包含数据采集逻辑、归因分析实战及 JSON 化的元数据管理方案。</p>
</blockquote>
<p><strong>关键词</strong>：<code>ASO优化</code> <code>数据驱动增长</code> <code>App Store算法</code> <code>竞品分析</code> <code>逆向工程</code> <code>数据分析</code></p>
<hr/>
<h3 data-id="heading-1">一、 背景：当 ASO 遇见数据科学</h3>
<p>在移动应用增长（Mobile Growth）领域，传统的关键词研究方法往往存在严重的“黑盒效应”：</p>
<ol>
<li><strong>依赖主观假设</strong>：仅凭直觉（Gut feeling）筛选关键词。</li>
<li><strong>缺乏归因闭环</strong>：修改了 Metadata，却无法量化具体是哪个词带来了 DAU 增长。</li>
<li><strong>数据滞后</strong>：第三方工具的“热度指数”往往滞后于真实的用户搜索行为。</li>
</ol>
<p>作为开发者或增长黑客（Growth Hacker），我们需要将 ASO 视为一个<strong>工程问题</strong>。最高效的策略并非“重新发明轮子”，而是利用 <strong>Competitive Intelligence（竞品情报）</strong>。</p>
<p>本文将基于专业数据分析工具 <strong>Appark.ai</strong> 的情报能力，拆解一套 <strong>4步逆向分析框架</strong>，帮助你建立数据驱动的增长引擎。</p>
<hr/>
<h3 data-id="heading-2">二、 步骤一：构建高维度的竞品画像库 (Competitor Mapping)</h3>
<p>在 App Store 的推荐算法（Collaborative Filtering）中，竞争对手的定义早已超越了“功能相似”。<strong>凡是抢占了你目标流量入口（Keywords &amp; User Time）的 App，皆为竞品。</strong></p>
<p>为了获取具有统计学意义的样本，我们需要进行多维度的<strong>降维扫描</strong>：</p>
<h4 data-id="heading-3">1.1 基于分类与地区的广度扫描</h4>
<p>利用数据工具的“高级搜索”接口思维，通过参数筛选发现“隐形冠军”。</p>
<ul>
<li><strong>逻辑</strong>：跨类别打击。</li>
<li><strong>案例</strong>：户外应用 <strong>AllTrails</strong> 虽然属于“导航”类需求，但被归类在 <strong>Health &amp; Fitness</strong>。如果你是健身 App 开发者，忽略它就意味着失去了一大块“户外运动”场景的流量。</li>
<li><strong>Action</strong>：筛选目标 Category 下 Top 50-100 的应用。这部分 App 通常没有大厂的品牌加持，能上榜全靠硬核的 ASO 策略，参考价值极高。</li>
</ul>
<blockquote>
<p><em>工具参考：<a href="https://link.juejin.cn?target=https%3A%2F%2Fappark.ai%2Fcn%2Fadvanced-search" target="_blank" title="https://appark.ai/cn/advanced-search" ref="nofollow noopener noreferrer">Appark Advanced Search (高级搜索筛选器)</a></em></p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cdc1c51221324fe9955b8e238c121fe6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29sZGVucGln:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765119731&amp;x-signature=TeDlzYTDWy5R%2BJFpW0PbI1qeuHo%3D" alt="appark-advanced-search-filters.webp" loading="lazy"/>
<em>图 1：通过多维度过滤器发现潜在竞品</em></p>
<h4 data-id="heading-4">1.2 基于算法推荐的关联挖掘</h4>
<p>利用 Apple/Google 的 <code>Similar Apps</code> 算法进行关联挖掘。</p>
<ul>
<li><strong>技术原理</strong>：Item-based Collaborative Filtering。如果算法判定 App A 和 App B 相似，意味着它们的 <strong>元数据向量（Metadata Vector）</strong> 高度重合。</li>
<li><strong>应用</strong>：直接提取竞品详情页的关联 App 列表，作为关键词挖掘的种子库。</li>
</ul>
<hr/>
<h3 data-id="heading-5">三、 步骤二：搭建自动化情报监控系统 (Event Monitoring)</h3>
<p>数据分析的核心在于捕捉<strong>变化（Delta）</strong>。静态的关键词快照价值极低，我们需要构建一个基于时间序列的监控系统。</p>
<p><strong>监控核心公式：</strong></p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Δ</mi><mtext>Metadata (Input)</mtext><mo>+</mo><mi mathvariant="normal">Δ</mi><mtext>Rank (Output)</mtext><mo>⇒</mo><mtext>High Confidence Strategy</mtext></mrow><annotation encoding="application/x-tex">\Delta \text{Metadata (Input)} + \Delta \text{Rank (Output)} \Rightarrow \text{High Confidence Strategy}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">Δ</span><span class="mord text"><span class="mord">Metadata (Input)</span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">Δ</span><span class="mord text"><span class="mord">Rank (Output)</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">⇒</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord text"><span class="mord">High Confidence Strategy</span></span></span></span></span></span></p>
<h4 data-id="heading-6">2.1 配置 Webhook 级别的监控思维</h4>
<p>我们需要建立类似 Webhook 的自动化机制。建议对筛选出的 5-10 个核心竞品开启以下 Alert：</p>
<ol>
<li><strong>Version Updates</strong>：监控 Title, Subtitle, Description 的文本变更（Text Diff）。</li>
<li><strong>Rank Fluctuations</strong>：监控 Category Rank 和 Keyword Rank 的跳变。</li>
</ol>
<blockquote>
<p><em>配置入口：<a href="https://link.juejin.cn?target=https%3A%2F%2Fappark.ai%2Fch%2Fapp-monitoring" target="_blank" title="https://appark.ai/ch/app-monitoring" ref="nofollow noopener noreferrer">Appark Monitoring Dashboard</a></em></p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fb9a7ae55b044d9fb0d7277489174e2b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29sZGVucGln:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765119731&amp;x-signature=KL1VtIUs5wwuXw1Hk4y6%2BUf%2BY3s%3D" alt="appark-monitoring-settings.webp" loading="lazy"/>
<em>图 2：建立自动化监控流</em></p>
<hr/>
<h3 data-id="heading-7">四、 步骤三：归因分析——逆向推导关键词策略</h3>
<p>这是本指南最核心的**数据归因（Attribution）**环节。我们需要建立“动作”与“结果”的因果关系。</p>
<h4 data-id="heading-8">3.1 实战案例：AllTrails 的增长黑客战术复盘</h4>
<p><strong>场景复现</strong>：
通过监控系统，我们捕捉到竞品 <strong>AllTrails</strong> 在 <strong>2025 年 6 月初</strong> 的一次异常信号。</p>
<h5 data-id="heading-9">Phase 1: 输入端分析 (Input Analysis)</h5>
<ul>
<li><strong>Event</strong>：发布版本 <code>v15.2</code>。</li>
<li><strong>Diff Log</strong>：
<ul>
<li>Added Feature: "AllTrails Peak" (高级会员)。</li>
<li>New Keywords Detected: <code>Plan ahead</code> (提前规划), <code>Heatmaps</code> (热力图), <code>Offline maps</code> (离线地图)。</li>
</ul>
</li>
</ul>
<h5 data-id="heading-10">Phase 2: 输出端验证 (Output Verification)</h5>
<p>调取竞品的时间序列趋势图，观察窗口期内的 <strong>Downloads</strong> 曲线。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f4473b7dbf4d48e1b2bc877d2133e5b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29sZGVucGln:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765119731&amp;x-signature=wrUix9q8Of9Nw8b%2FdH2JdeFuahE%3D" alt="appark-competitor-trend-chart.png" loading="lazy"/>
<em>图 3：版本更新与下载量激增的时序关联</em></p>
<ul>
<li><strong>Observation</strong>：版本发布后 3 天内，下载量曲线出现明显的 <strong>Spike (尖峰)</strong>，并稳定在新的 <strong>Baseline (基线)</strong>（由 70w/月 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>↑</mo></mrow><annotation encoding="application/x-tex">\uparrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mrel">↑</span></span></span></span></span> 90w/月）。</li>
<li><strong>Conclusion</strong>：该增长与“高级路线规划”相关关键词的覆盖呈<strong>强正相关</strong>。</li>
</ul>
<hr/>
<h3 data-id="heading-11">五、 步骤四：工程化落地——关键词 Backlog 管理</h3>
<p>基于上述分析，我们不再是“猜词”，而是进行“词库移植”。建议使用 JSON 结构或数据库思维来管理你的 ASO 关键词资产，以便后续进行 A/B Test。</p>
<h4 data-id="heading-12">4.1 关键词意图提取 (Intent Extraction)</h4>
<p>从竞品的成功中提取用户的高意图（High Intent）需求：</p>
<ul>
<li><strong>User Story</strong>: "我想规划徒步路线" <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\rightarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"/><span class="mrel">→</span></span></span></span></span> <strong>Keywords</strong>: <code>Hiking route planner</code>, <code>Trail map</code>.</li>
<li><strong>User Story</strong>: "我怕山里没信号" <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\rightarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"/><span class="mrel">→</span></span></span></span></span> <strong>Keywords</strong>: <code>Offline trail maps</code>, <code>GPS tracker</code>.</li>
</ul>
<h4 data-id="heading-13">4.2 建立结构化的元数据 JSON</h4>
<p>为了方便版本管理，建议建立如下的关键词 backlog 结构：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"aso_strategy_v1"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"target_audience"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Advanced Hikers"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"source_competitor"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"AllTrails"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"validation_data"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Appark_Trend_June_2025"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"metadata_structure"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Hiking &amp; Trail Maps"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"weight"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"High"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"keywords"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"Hiking"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"Trail"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"Maps"</span><span class="hljs-punctuation">]</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"subtitle"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Offline Route Planner &amp; GPS"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"weight"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Medium"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"keywords"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"Offline"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"Route Planner"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"GPS"</span><span class="hljs-punctuation">]</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"keyword_field"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"trekking"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"topo maps"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"custom routes"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"heatmaps"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"outdoor navigation"</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><em>在实际操作中，将上述 JSON 中的 <code>keywords</code> 填入 App Store Connect 的对应字段即可。</em></p>
<hr/>
<h3 data-id="heading-14">六、 总结</h3>
<p>ASO 本质上是一场<strong>信息不对称</strong>的博弈。通过数据可视化能力，我们可以将 ASO 流程标准化为一个科学闭环：</p>
<ol>
<li><strong>Discover</strong>：利用高级搜索进行全域扫描。</li>
<li><strong>Monitor</strong>：自动化追踪版本迭代与榜单变化。</li>
<li><strong>Analyze</strong>：通过时序分析进行增长归因。</li>
<li><strong>Implement</strong>：基于验证策略进行工程化落地。</li>
</ol>
<p>拒绝盲猜，让数据成为你增长引擎的燃料。</p>
<hr/>
<h4 data-id="heading-15">附录：参考资源与工具箱</h4>
<p>为了方便读者复现文中的分析流程，以下整理了相关的数据源与官方文档：</p>
<ul>
<li><strong>数据采集与监控</strong>：
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fappark.ai%2Fcn%2Fadvanced-search" target="_blank" title="https://appark.ai/cn/advanced-search" ref="nofollow noopener noreferrer">Appark Advanced Search (高级竞品发现)</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fappark.ai%2Fcn%2Fdashboards%2Fcompetitor" target="_blank" title="https://appark.ai/cn/dashboards/competitor" ref="nofollow noopener noreferrer">Competitor Trend Dashboard (趋势归因分析)</a></li>
</ul>
</li>
<li><strong>官方指南</strong>：
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.apple.com%2Fapp-store%2Fsearch%2F" target="_blank" title="https://developer.apple.com/app-store/search/" ref="nofollow noopener noreferrer">Apple Developer: App Store Search Algorithm</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fplay.google.com%2Fconsole%2Fabout%2Fstore-listing-experiments%2F" target="_blank" title="https://play.google.com/console/about/store-listing-experiments/" ref="nofollow noopener noreferrer">Google Play: Store Listing Experiments</a></li>
</ul>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【vue高频面试题】第2题：Vue 3 中 ref 和 reactive 的区别是什么？什么时候用哪一个？]]></title>    <link>https://juejin.cn/post/7578114667463327763</link>    <guid>https://juejin.cn/post/7578114667463327763</guid>    <pubDate>2025-12-01T02:03:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578114667463327763" data-draft-id="7578177007575597110" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【vue高频面试题】第2题：Vue 3 中 ref 和 reactive 的区别是什么？什么时候用哪一个？"/> <meta itemprop="keywords" content="前端,面试"/> <meta itemprop="datePublished" content="2025-12-01T02:03:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端一课"/> <meta itemprop="url" content="https://juejin.cn/user/1169536102963917"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【vue高频面试题】第2题：Vue 3 中 ref 和 reactive 的区别是什么？什么时候用哪一个？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1169536102963917/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端一课
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T02:03:11.000Z" title="Mon Dec 01 2025 02:03:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vue 3 中 <code>ref</code> 与 <code>reactive</code> 使用指南（面试/实战）</h2>
<h3 data-id="heading-1">主问题</h3>
<p>问：<code>ref</code> 和 <code>reactive</code> 的区别是什么？什么时候用哪一个？</p>
<h3 data-id="heading-2">面试官追问（示例）</h3>
<ul>
<li>基础区别：底层实现差异？<code>reactive</code> 包基本类型会怎样？</li>
<li>使用场景：哪些场景必须用 <code>ref</code>？何时更适合 <code>reactive</code>？</li>
<li>模板绑定：为何模板里 <code>ref</code> 不需要 <code>.value</code>？<code>reactive</code> 是否需要？</li>
<li>响应式嵌套：嵌套对象是否响应？深层嵌套如何优化？</li>
</ul>
<h3 data-id="heading-3">参考答案 / 要点整理</h3>
<h4 data-id="heading-4">1. 基础区别</h4>






























<table><thead><tr><th>特性</th><th>ref</th><th>reactive</th></tr></thead><tbody><tr><td>数据类型</td><td>基本类型或对象</td><td>对象或数组</td></tr><tr><td>返回值</td><td>包装对象 <code>{ value: ... }</code></td><td>直接返回代理对象（Proxy）</td></tr><tr><td>模板访问</td><td>模板自动解包，无需 <code>.value</code></td><td>直接使用属性</td></tr><tr><td>底层实现</td><td>RefImpl + Proxy（访问时解包）</td><td>Proxy 深度响应式</td></tr></tbody></table>
<p>示例：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { ref, reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;

<span class="hljs-keyword">const</span> count = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>);              <span class="hljs-comment">// 基本类型 → 使用 ref</span>
<span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({ <span class="hljs-attr">a</span>: <span class="hljs-number">1</span> });  <span class="hljs-comment">// 对象/数组 → 使用 reactive</span>
</code></pre>
<h4 data-id="heading-5">2. 使用场景</h4>
<ul>
<li>选择 <code>ref</code>
<ul>
<li>基本类型（<code>string</code>、<code>number</code>、<code>boolean</code>）。</li>
<li>需要单独引用/独立更新的值（计数器、输入值）。</li>
</ul>
</li>
<li>选择 <code>reactive</code>
<ul>
<li>管理对象/数组的整体状态（包含多属性）。</li>
<li>深层嵌套对象需整体响应式代理。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-6">3. 模板绑定与 <code>.value</code></h4>
<p>在 <code>&lt;template&gt;</code> 中，Vue 会自动解包 <code>ref</code>，无需 <code>.value</code>。在 JS 逻辑（<code>script</code>）中仍需通过 <code>.value</code> 访问。</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div&gt;{{ count }}&lt;/div&gt;   &lt;!-- 自动解包，无需 .value --&gt;
  &lt;div&gt;{{ state.a }}&lt;/div&gt; &lt;!-- reactive 直接访问属性 --&gt;
  
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import { ref, reactive } from 'vue'
const count = ref(0)
const state = reactive({ a: 1 })
&lt;/script&gt;
</code></pre>
<h4 data-id="heading-7">4. 响应式嵌套与优化策略</h4>
<ul>
<li><code>reactive</code> 对嵌套对象默认递归响应式，无需手动处理。</li>
<li>对象很大或深层嵌套场景，可拆分为多个 <code>ref</code>，降低单个 Proxy 的更新成本。</li>
</ul>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { ref, reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-comment">// 整体管理（默认深度响应式）</span>
<span class="hljs-keyword">const</span> user = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">profile</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">18</span> },
  <span class="hljs-attr">settings</span>: { <span class="hljs-attr">theme</span>: <span class="hljs-string">'dark'</span> }
})

<span class="hljs-comment">// 性能敏感场景：拆分为多个 ref，按需更新</span>
<span class="hljs-keyword">const</span> profile = <span class="hljs-title function_">ref</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">18</span> })
<span class="hljs-keyword">const</span> settings = <span class="hljs-title function_">ref</span>({ <span class="hljs-attr">theme</span>: <span class="hljs-string">'dark'</span> })
</code></pre>
<h3 data-id="heading-8">小结（面试亮点）</h3>
<ul>
<li>基本类型与独立值用 <code>ref</code>，对象/数组用 <code>reactive</code>。</li>
<li>模板自动解包 <code>ref</code>；JS 中访问 <code>ref</code> 需 <code>.value</code>。</li>
<li>深层嵌套对象可用 <code>reactive</code>；性能敏感场景可拆分为多个 <code>ref</code>。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java 也能玩高质量 AI 绘图？SpringAI + Azure OpenAI 真香警告！]]></title>    <link>https://juejin.cn/post/7577968429590265882</link>    <guid>https://juejin.cn/post/7577968429590265882</guid>    <pubDate>2025-11-30T10:48:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577968429590265882" data-draft-id="7577718777482461222" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java 也能玩高质量 AI 绘图？SpringAI + Azure OpenAI 真香警告！"/> <meta itemprop="keywords" content="后端,Spring,机器学习"/> <meta itemprop="datePublished" content="2025-11-30T10:48:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="软件求生"/> <meta itemprop="url" content="https://juejin.cn/user/1038379932466263"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java 也能玩高质量 AI 绘图？SpringAI + Azure OpenAI 真香警告！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1038379932466263/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    软件求生
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T10:48:18.000Z" title="Sun Nov 30 2025 10:48:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>大家好吖，我是你们 31 岁、还在持续折腾技术的小米。最近几天我沉迷了一件事——用 <strong>Spring AI + Azure OpenAI 做图像生成</strong>，越玩越停不下来。</p>
<p>你有没有这种感觉：</p>
<blockquote>
<p>当年我们还在研究“怎么优化图片加载速度”，结果现在直接一句 prompt，AI 就帮你把图画好。不仅会画，还会理解你的意图，甚至能帮你画得更好。</p>
</blockquote>
<p>而且！<strong>Spring AI 真的太丝滑了</strong>，尤其是配合 Azure OpenAI 的图像能力（比如 DALL·E 3）——简直像你写一个配置，Spring 就帮你自动把“画图工具”接好。</p>
<p>这篇文章就带你从零开始，把 <strong>Azure OpenAI 图像模型</strong>接入 Spring Boot，跑通你的第一张 AI 图像生成！</p>
<p>坐稳啦，故事开始~</p>
<h2 data-id="heading-0">为什么我开始折腾 Azure OpenAI 图像模型？</h2>
<p>前段时间，我有个朋友在做一个“智能家居装修灵感助手”，需要给用户实时生成不同风格的客厅、厨房样例。当时他问我有没有简单点的 Java 接入方案。</p>
<p>我想了想：</p>
<ul>
<li>OpenAI 官方 SDK？也可以，但 Java 生态一般般。</li>
<li>Azure OpenAI？企业级稳定性更好，也可以。</li>
</ul>
<p>那整合方式呢？然后我突然想起 <strong>Spring AI</strong>。</p>
<p>我一试，哎哟我的天，简直 Java 程序员福音：</p>
<ul>
<li>自动化配置</li>
<li>提供 ImageClient</li>
<li>能直接转模型响应</li>
<li>还能扩展模型参数</li>
</ul>
<p>所以我就搞了一个 Demo，没想到越搞越爽，最后还生成了我家猫咪的“巴洛克风神像版本”，今天就把全过程分享给你。</p>
<h2 data-id="heading-1">Azure OpenAI 图像模型简介：Java 党也能一行 prompt 出图</h2>
<p>Azure OpenAI 的图像模型本体其实就是 OpenAI 的 DALL·E 系列，只是换成了 Azure 托管，可以绑定你的 Azure 密钥、计费方式、私有虚拟网络等能力。</p>
<p>可生成内容包括：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b1e9f4eb0034bdaa594c5c5f33bddd3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765104498&amp;x-signature=tGImSVumyhPgLS9KRnsp9yWlFu8%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>而 Spring AI 提供了一个很丝滑的封装——<strong>ImageClient</strong>。</p>
<p>你甚至可以直接这样调用：</p>
<blockquote>
<p>imageClient.generate("画一个冲浪的橘猫");</p>
</blockquote>
<p>它就会给你一张高质量图片。是不是感觉很爽？别急，我们继续装环境。</p>
<h2 data-id="heading-2">添加依赖：只需要一个 starter</h2>
<p>如果你用的是 Maven，加入：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2cba8e4487c54e78bc36141ace1f6f6c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765104498&amp;x-signature=1tHg4LHRZDcdy7X5sSs66dBhcCo%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>如果你是 Gradle：</p>
<blockquote>
<p>implementation 'org.springframework.ai:spring-ai-azure-openai'</p>
</blockquote>
<p>Spring AI 的理念非常一致：<strong>你加上 Starter，其他的它帮你自动装配好。</strong></p>
<h2 data-id="heading-3">配置 Azure OpenAI 凭证：只需三行就能跑图像模型</h2>
<p>在 application.yml 中加上：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ea0440023a54e118e209e1129172cb9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765104498&amp;x-signature=d%2Bkd8Gbt%2BzZdTV2ClvzLuyWtfuk%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>最关键的是这两项：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/185d91e2e3bb41e88af40c7099c2c3b6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765104498&amp;x-signature=acIoCvag2shWKb5ZjKB4EpXgJME%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>Spring 看到这些配置后，就会自动创建一个 <strong>AzureOpenAiImageClient</strong> 给你使用。</p>
<p>小米第一次配置成功时，甚至还有点激动——Java 终于能轻松玩图像生成了！</p>
<h2 data-id="heading-4">AzureOpenAiImageOptions 可配置项</h2>
<p>Spring AI 对 Azure 图像生成参数做了一层封装，就是 AzureOpenAiImageOptions。</p>
<p>我给你整理了一张清晰的表格：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/398c3cba1a414b9cab84238770a5d483~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765104498&amp;x-signature=hBKuvd%2BvCoUz3W%2F5UmHmdWVNaSQ%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>关键点说明：</p>
<ul>
<li><strong>size 越大，越清晰，计费也越高</strong></li>
<li><strong>high 质量会增加费用</strong></li>
<li>生成多张图 n&gt;1 的时候要小心钱包</li>
<li>b64_json 适合你要把图片存数据库或 OSS 时使用</li>
</ul>
<p>这一层封装比直接调用 Azure API 清爽太多了。</p>
<h2 data-id="heading-5">调用 ImageClient：写出你的第一张 AI 图片</h2>
<p>核心代码非常简单。</p>
<p><strong>1. 注入 ImageClient</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ec391389195d4ac58b6415e574a59526~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765104498&amp;x-signature=ILxaSOnbQIBKwRuHu5sMb0eT8Y8%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>Spring 会自动选择 AzureOpenAiImageClient。</p>
<p><strong>2. 发起文生图请求</strong></p>
<p>最简版（小米最常用）：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/791f348735be42cb867ded6d5a78260c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765104498&amp;x-signature=3OgWRJjQapSbVTjn5ZOr55hlzz0%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>进阶版（带可选参数）：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba4cbcf4898b4c5db28b1066f3f82f53~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765104498&amp;x-signature=mYjBSIlLMBUNkyKvyjYDogVbO40%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><strong>3. 拿到结果</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aabc99da26a744c89fa238284c9535a4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765104498&amp;x-signature=ZwcCICEW1DHBhGVvUj4cNnisT24%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>点开就是生成的图像！我第一次看到自己的 prompt 变成图像时，真的有点震撼。科技的进步，比我头发掉得还快。</p>
<h2 data-id="heading-6">Java 玩图像生成，很舒服了</h2>
<p>如果你是 Java 后端工程师，可能以前觉得“生成图片”“这些都是前端或 Python 的活”。但 Spring AI + Azure OpenAI 出来之后，这个局面真的变了。</p>
<p>你可以：</p>
<ul>
<li>给你的业务系统加入自动生成插画</li>
<li>给用户生成定制头像（比如“赛博朋克风的我”）</li>
<li>生成装修图、产品海报、广告样机</li>
<li>甚至为内部系统生成自动 PPT 封面图</li>
<li>结合聊天模型做 Prompt 迭代，生成更精准图片</li>
</ul>
<p>而所有这些，只要你写过 Spring Boot，就能立刻上手。</p>
<h2 data-id="heading-7">结语：别错过 Spring AI 这波红利</h2>
<p>如果你之前没接触过 AI 模型，你可能会觉得“AI 开发好麻烦”。但 Spring AI 的出现，把这一切变成了简单的“写配置 + 调方法”。</p>
<p>Java 的 AI 生态正在从“没人做”迈向“谁都能用”，而 Azure OpenAI 的企业级稳定性，更是让它可以放心上正式环境。</p>
<p>我现在已经给我们团队内部搞了好几个 Demo：</p>
<ul>
<li>自动生成文章封面</li>
<li>帮产品经理生成界面草图</li>
<li>让后台系统根据日志生成图形化解释图</li>
</ul>
<p>每个都被夸到飞起。</p>
<h2 data-id="heading-8">END</h2>
<p>我是小米，一个喜欢分享技术的31岁程序员。如果你喜欢我的文章，欢迎关注我的微信公众号“<strong>软件求生</strong>”，获取更多技术干货！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C#.NET Record Struct 完全解析：语法、语义与最佳实践]]></title>    <link>https://juejin.cn/post/7577971299743907878</link>    <guid>https://juejin.cn/post/7577971299743907878</guid>    <pubDate>2025-12-01T00:05:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577971299743907878" data-draft-id="7577914902431662126" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C#.NET Record Struct 完全解析：语法、语义与最佳实践"/> <meta itemprop="keywords" content="C#,.NET"/> <meta itemprop="datePublished" content="2025-12-01T00:05:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="唐青枫"/> <meta itemprop="url" content="https://juejin.cn/user/3737995266234280"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C#.NET Record Struct 完全解析：语法、语义与最佳实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3737995266234280/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    唐青枫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T00:05:41.000Z" title="Mon Dec 01 2025 00:05:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">简介</h3>
<p><code>Record Structs</code> 是一种值类型的记录（<code>record</code>），结合了 <code>struct</code> 的值语义和 <code>record</code> 的功能（如自动生成相等性比较、不可变性支持）。它们是 <code>C# 9.0</code> 中引入的引用类型 <code>record</code>（默认 <code>class</code>）的扩展，专为性能敏感场景设计，特别是在需要栈分配或避免 <code>GC</code> 压力的情况下。</p>
<h4 data-id="heading-1">核心特性</h4>
<ul>
<li>
<p>值类型：存储在栈上（除非装箱），避免堆分配，适合小数据结构。</p>
</li>
<li>
<p>不可变性：默认鼓励不可变设计（通过 <code>init-only</code> 属性），但可选择可变。</p>
</li>
<li>
<p>值相等性：自动实现基于内容的相等性比较（== 和 <code>Equals</code>）。</p>
</li>
<li>
<p>自动 <code>ToString</code>：生成人类可读的字符串表示。</p>
</li>
<li>
<p>解构支持：自动提供 <code>Deconstruct</code> 方法，方便模式匹配和解构。</p>
</li>
<li>
<p><code>With</code> 表达式：支持非破坏性变异（创建新实例）。</p>
</li>
<li>
<p>继承支持：支持继承其他 <code>record structs</code>（但不能继承 <code>class</code> 或 <code>record class</code>）。</p>
</li>
</ul>
<h3 data-id="heading-2">基本语法</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 最简单的记录结构声明</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-keyword">struct</span> <span class="hljs-title">Point</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> X, <span class="hljs-built_in">int</span> Y</span>)</span>;

<span class="hljs-comment">// 等价于传统的结构体声明（但功能更强大）</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> Point
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> X { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">init</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Y { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">init</span>; }
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Point</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> x, <span class="hljs-built_in">int</span> y</span>)</span>
    {
        X = x;
        Y = y;
    }
    
    <span class="hljs-comment">// 自动生成的 Equals、GetHashCode、ToString 等方法</span>
}
</code></pre>
<h4 data-id="heading-3">可变性控制</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 不可变记录结构 (推荐)</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> <span class="hljs-keyword">record</span> <span class="hljs-keyword">struct</span> <span class="hljs-title">ImmutablePoint</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> X, <span class="hljs-built_in">int</span> Y</span>)</span>;

<span class="hljs-comment">// 可变记录结构</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-title">struct</span> <span class="hljs-title">MutablePoint</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> X { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Y { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}

<span class="hljs-comment">// 混合可变性</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-keyword">struct</span> <span class="hljs-title">MixedPoint</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> X, <span class="hljs-built_in">int</span> Y</span>) <span class="hljs-comment">// X 和 Y 默认只读</span></span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Z { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } <span class="hljs-comment">// 额外的可变属性</span>
}
</code></pre>
<h3 data-id="heading-4">记录结构 vs 记录类 vs 普通结构体</h3>





















































<table><thead><tr><th>特性</th><th>记录结构 (record struct)</th><th>记录类 (record class)</th><th>普通结构体 (struct)</th></tr></thead><tbody><tr><td>类型</td><td>值类型</td><td>引用类型</td><td>值类型</td></tr><tr><td>分配位置</td><td>栈（通常）</td><td>堆</td><td>栈（通常）</td></tr><tr><td>默认不可变</td><td>是（属性为 <code>init</code>）</td><td>是（属性为 <code>init</code>）</td><td>否（可变）</td></tr><tr><td>值相等性</td><td>自动实现</td><td>自动实现</td><td>需手动实现</td></tr><tr><td><code>with</code> 表达式</td><td>支持</td><td>支持</td><td>不支持</td></tr><tr><td>解构</td><td>自动支持</td><td>自动支持</td><td>需手动实现</td></tr><tr><td>继承</td><td>不支持</td><td>支持</td><td>不支持</td></tr></tbody></table>
<h3 data-id="heading-5">记录结构的核心特性</h3>
<h4 data-id="heading-6">位置记录结构（Positional Record Structs）</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 位置记录结构 - 最简洁的形式</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-keyword">struct</span> <span class="hljs-title">Person</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> FirstName, <span class="hljs-built_in">string</span> LastName, <span class="hljs-built_in">int</span> Age</span>)</span>;

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-keyword">var</span> person = <span class="hljs-keyword">new</span> Person(<span class="hljs-string">"John"</span>, <span class="hljs-string">"Doe"</span>, <span class="hljs-number">30</span>);
Console.WriteLine(person); <span class="hljs-comment">// 输出: Person { FirstName = John, LastName = Doe, Age = 30 }</span>

<span class="hljs-comment">// 解构</span>
<span class="hljs-keyword">var</span> (firstName, lastName, age) = person;
Console.WriteLine(<span class="hljs-string">$"<span class="hljs-subst">{firstName}</span> <span class="hljs-subst">{lastName}</span>, <span class="hljs-subst">{age}</span>岁"</span>);
</code></pre>
<h4 data-id="heading-7">值相等性（Value Equality）</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-keyword">struct</span> <span class="hljs-title">Point</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> X, <span class="hljs-built_in">int</span> Y</span>)</span>;

<span class="hljs-comment">// 值相等性比较</span>
<span class="hljs-keyword">var</span> point1 = <span class="hljs-keyword">new</span> Point(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>);
<span class="hljs-keyword">var</span> point2 = <span class="hljs-keyword">new</span> Point(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>);
<span class="hljs-keyword">var</span> point3 = <span class="hljs-keyword">new</span> Point(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>);

Console.WriteLine(point1 == point2); <span class="hljs-comment">// True - 基于值比较</span>
Console.WriteLine(point1 == point3); <span class="hljs-comment">// False</span>
Console.WriteLine(point1.Equals(point2)); <span class="hljs-comment">// True</span>
</code></pre>
<h4 data-id="heading-8">with 表达式（非破坏性变更）</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-keyword">struct</span> <span class="hljs-title">Person</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> FirstName, <span class="hljs-built_in">string</span> LastName, <span class="hljs-built_in">int</span> Age</span>)</span>;

<span class="hljs-keyword">var</span> original = <span class="hljs-keyword">new</span> Person(<span class="hljs-string">"John"</span>, <span class="hljs-string">"Doe"</span>, <span class="hljs-number">30</span>);

<span class="hljs-comment">// 创建修改后的副本（非破坏性变更）</span>
<span class="hljs-keyword">var</span> updated = original <span class="hljs-keyword">with</span> { Age = <span class="hljs-number">31</span> };
<span class="hljs-keyword">var</span> renamed = original <span class="hljs-keyword">with</span> { FirstName = <span class="hljs-string">"Jane"</span> };

Console.WriteLine(original); <span class="hljs-comment">// Person { FirstName = John, LastName = Doe, Age = 30 }</span>
Console.WriteLine(updated);  <span class="hljs-comment">// Person { FirstName = John, LastName = Doe, Age = 31 }</span>
Console.WriteLine(renamed);  <span class="hljs-comment">// Person { FirstName = Jane, LastName = Doe, Age = 30 }</span>
</code></pre>
<h4 data-id="heading-9">自定义行为</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 自定义记录结构</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-keyword">struct</span> <span class="hljs-title">Person</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> FirstName, <span class="hljs-built_in">string</span> LastName</span>)</span>
{
    <span class="hljs-comment">// 添加计算属性</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> FullName =&gt; <span class="hljs-string">$"<span class="hljs-subst">{FirstName}</span> <span class="hljs-subst">{LastName}</span>"</span>;
    
    <span class="hljs-comment">// 添加方法</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> <span class="hljs-title">GetFormattedName</span>()</span> =&gt; <span class="hljs-string">$"<span class="hljs-subst">{LastName}</span>, <span class="hljs-subst">{FirstName}</span>"</span>;
    
    <span class="hljs-comment">// 重写ToString</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-built_in">string</span> <span class="hljs-title">ToString</span>()</span> =&gt; FullName;
    
    <span class="hljs-comment">// 自定义相等性逻辑（可选）</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">Equals</span>(<span class="hljs-params">Person other</span>)</span> =&gt; 
        FirstName == other.FirstName &amp;&amp; LastName == other.LastName;
    
    <span class="hljs-comment">// 自定义GetHashCode（可选）</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-built_in">int</span> <span class="hljs-title">GetHashCode</span>()</span> =&gt; 
        HashCode.Combine(FirstName, LastName);
}

<span class="hljs-comment">// 使用自定义记录结构</span>
<span class="hljs-keyword">var</span> person = <span class="hljs-keyword">new</span> Person(<span class="hljs-string">"John"</span>, <span class="hljs-string">"Doe"</span>);
Console.WriteLine(person.FullName); <span class="hljs-comment">// John Doe</span>
Console.WriteLine(person.GetFormattedName()); <span class="hljs-comment">// Doe, John</span>
Console.WriteLine(person); <span class="hljs-comment">// John Doe</span>
</code></pre>
<h3 data-id="heading-10">高级用法和模式</h3>
<h4 data-id="heading-11">与模式匹配结合</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-keyword">struct</span> <span class="hljs-title">Point</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> X, <span class="hljs-built_in">int</span> Y</span>)</span>;

<span class="hljs-comment">// 在模式匹配中使用记录结构</span>
<span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">ClassifyPoint</span>(<span class="hljs-params">Point point</span>)</span> =&gt; point <span class="hljs-keyword">switch</span>
{
    (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>) =&gt; <span class="hljs-string">"原点"</span>,
    (<span class="hljs-keyword">var</span> x, <span class="hljs-keyword">var</span> y) <span class="hljs-keyword">when</span> x == y =&gt; <span class="hljs-string">"在y=x线上"</span>,
    (<span class="hljs-keyword">var</span> x, <span class="hljs-keyword">var</span> y) <span class="hljs-keyword">when</span> x &gt; <span class="hljs-number">0</span> &amp;&amp; y &gt; <span class="hljs-number">0</span> =&gt; <span class="hljs-string">"第一象限"</span>,
    (<span class="hljs-keyword">var</span> x, <span class="hljs-keyword">var</span> y) <span class="hljs-keyword">when</span> x &lt; <span class="hljs-number">0</span> &amp;&amp; y &gt; <span class="hljs-number">0</span> =&gt; <span class="hljs-string">"第二象限"</span>,
    (<span class="hljs-keyword">var</span> x, <span class="hljs-keyword">var</span> y) <span class="hljs-keyword">when</span> x &lt; <span class="hljs-number">0</span> &amp;&amp; y &lt; <span class="hljs-number">0</span> =&gt; <span class="hljs-string">"第三象限"</span>,
    (<span class="hljs-keyword">var</span> x, <span class="hljs-keyword">var</span> y) <span class="hljs-keyword">when</span> x &gt; <span class="hljs-number">0</span> &amp;&amp; y &lt; <span class="hljs-number">0</span> =&gt; <span class="hljs-string">"第四象限"</span>,
    _ =&gt; <span class="hljs-string">"在坐标轴上"</span>
};

<span class="hljs-comment">// 使用示例</span>
Console.WriteLine(ClassifyPoint(<span class="hljs-keyword">new</span> Point(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>))); <span class="hljs-comment">// 原点</span>
Console.WriteLine(ClassifyPoint(<span class="hljs-keyword">new</span> Point(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>))); <span class="hljs-comment">// 在y=x线上</span>
Console.WriteLine(ClassifyPoint(<span class="hljs-keyword">new</span> Point(<span class="hljs-number">2</span>, <span class="hljs-number">4</span>))); <span class="hljs-comment">// 第一象限</span>
</code></pre>
<h4 data-id="heading-12">实现接口</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-keyword">struct</span> <span class="hljs-title">Vector2D</span>(<span class="hljs-params"><span class="hljs-built_in">double</span> X, <span class="hljs-built_in">double</span> Y</span>) : IFormattable</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">double</span> Magnitude =&gt; Math.Sqrt(X * X + Y * Y);
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> <span class="hljs-title">ToString</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> format, IFormatProvider formatProvider</span>)</span>
    {
        <span class="hljs-keyword">return</span> format?.ToUpper() <span class="hljs-keyword">switch</span>
        {
            <span class="hljs-string">"M"</span> =&gt; <span class="hljs-string">$"(<span class="hljs-subst">{X}</span>, <span class="hljs-subst">{Y}</span>) with magnitude <span class="hljs-subst">{Magnitude:F2}</span>"</span>,
            _ =&gt; <span class="hljs-string">$"(<span class="hljs-subst">{X}</span>, <span class="hljs-subst">{Y}</span>)"</span>
        };
    }
}

<span class="hljs-comment">// 使用接口实现</span>
<span class="hljs-keyword">var</span> vector = <span class="hljs-keyword">new</span> Vector2D(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>);
Console.WriteLine(vector.ToString(<span class="hljs-string">"M"</span>, CultureInfo.InvariantCulture));
<span class="hljs-comment">// 输出: (3, 4) with magnitude 5.00</span>
</code></pre>
<h4 data-id="heading-13">集合中使用 Record Structs</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 高性能点集处理</span>
<span class="hljs-keyword">var</span> points = <span class="hljs-keyword">new</span> Point[<span class="hljs-number">1000</span>];
<span class="hljs-keyword">var</span> sum = <span class="hljs-keyword">new</span> Point(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);

<span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; points.Length; i++)
{
    points[i] = <span class="hljs-keyword">new</span> Point(i, i * <span class="hljs-number">2</span>);
    sum = sum <span class="hljs-keyword">with</span> 
    { 
        X = sum.X + points[i].X, 
        Y = sum.Y + points[i].Y 
    };
}
</code></pre>
<h4 data-id="heading-14">与 Span 和 Memory 结合</h4>
<pre><code class="hljs language-csharp" lang="csharp">Span&lt;Point&gt; points = <span class="hljs-keyword">stackalloc</span> Point[<span class="hljs-number">4</span>];
points[<span class="hljs-number">0</span>] = <span class="hljs-keyword">new</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
points[<span class="hljs-number">1</span>] = <span class="hljs-keyword">new</span>(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>);
points[<span class="hljs-number">2</span>] = <span class="hljs-keyword">new</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
points[<span class="hljs-number">3</span>] = <span class="hljs-keyword">new</span>(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>);

<span class="hljs-comment">// 高性能几何计算</span>
<span class="hljs-built_in">double</span> area = CalculatePolygonArea(points);
</code></pre>
<h3 data-id="heading-15">实际应用场景</h3>
<h4 data-id="heading-16">数学和几何计算</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> <span class="hljs-keyword">record</span> <span class="hljs-keyword">struct</span> <span class="hljs-title">Rectangle</span>(<span class="hljs-params">Point TopLeft, Point BottomRight</span>)</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Width =&gt; BottomRight.X - TopLeft.X;
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Height =&gt; BottomRight.Y - TopLeft.Y;
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Area =&gt; Width * Height;
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">Contains</span>(<span class="hljs-params">Point point</span>)</span> =&gt;
        point.X &gt;= TopLeft.X &amp;&amp; point.X &lt;= BottomRight.X &amp;&amp;
        point.Y &gt;= TopLeft.Y &amp;&amp; point.Y &lt;= BottomRight.Y;
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> Rectangle <span class="hljs-title">Inflate</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> delta</span>)</span> =&gt;
        <span class="hljs-keyword">this</span> <span class="hljs-keyword">with</span> 
        { 
            TopLeft = <span class="hljs-keyword">new</span> Point(TopLeft.X - delta, TopLeft.Y - delta),
            BottomRight = <span class="hljs-keyword">new</span> Point(BottomRight.X + delta, BottomRight.Y + delta)
        };
}

<span class="hljs-comment">// 使用几何记录结构</span>
<span class="hljs-keyword">var</span> rect = <span class="hljs-keyword">new</span> Rectangle(<span class="hljs-keyword">new</span> Point(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>), <span class="hljs-keyword">new</span> Point(<span class="hljs-number">10</span>, <span class="hljs-number">10</span>));
Console.WriteLine(<span class="hljs-string">$"面积: <span class="hljs-subst">{rect.Area}</span>"</span>); <span class="hljs-comment">// 面积: 100</span>
Console.WriteLine(<span class="hljs-string">$"包含点 (5,5): <span class="hljs-subst">{rect.Contains(<span class="hljs-keyword">new</span> Point(<span class="hljs-number">5</span>, <span class="hljs-number">5</span>))}</span>"</span>); <span class="hljs-comment">// True</span>

<span class="hljs-keyword">var</span> largerRect = rect.Inflate(<span class="hljs-number">2</span>);
Console.WriteLine(<span class="hljs-string">$"新面积: <span class="hljs-subst">{largerRect.Area}</span>"</span>); <span class="hljs-comment">// 新面积: 196</span>
</code></pre>
<h4 data-id="heading-17">数据传输对象（DTO）</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// API 响应DTO</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> <span class="hljs-keyword">record</span> <span class="hljs-keyword">struct</span> <span class="hljs-title">ApiResponse</span>&lt;<span class="hljs-title">T</span>&gt;(<span class="hljs-params">T Data, <span class="hljs-built_in">string</span> Error, DateTime Timestamp</span>)</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">bool</span> IsSuccess =&gt; <span class="hljs-built_in">string</span>.IsNullOrEmpty(Error);
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ApiResponse&lt;T&gt; <span class="hljs-title">Success</span>(<span class="hljs-params">T data</span>)</span> =&gt; 
        <span class="hljs-keyword">new</span> ApiResponse&lt;T&gt;(data, <span class="hljs-literal">null</span>, DateTime.UtcNow);
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ApiResponse&lt;T&gt; <span class="hljs-title">Failure</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> error</span>)</span> =&gt; 
        <span class="hljs-keyword">new</span> ApiResponse&lt;T&gt;(<span class="hljs-literal">default</span>, error, DateTime.UtcNow);
}

<span class="hljs-comment">// 使用DTO记录结构</span>
<span class="hljs-keyword">var</span> successResponse = ApiResponse&lt;<span class="hljs-built_in">string</span>&gt;.Success(<span class="hljs-string">"操作成功"</span>);
<span class="hljs-keyword">var</span> errorResponse = ApiResponse&lt;<span class="hljs-built_in">string</span>&gt;.Failure(<span class="hljs-string">"发生错误"</span>);

Console.WriteLine(successResponse.IsSuccess); <span class="hljs-comment">// True</span>
Console.WriteLine(errorResponse.IsSuccess);   <span class="hljs-comment">// False</span>
</code></pre>
<h4 data-id="heading-18">领域模型中的值对象</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 货币值对象</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> <span class="hljs-keyword">record</span> <span class="hljs-keyword">struct</span> <span class="hljs-title">Money</span>(<span class="hljs-params"><span class="hljs-built_in">decimal</span> Amount, <span class="hljs-built_in">string</span> Currency</span>)</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Money <span class="hljs-keyword">operator</span> +(Money left, Money right)
    {
        <span class="hljs-keyword">if</span> (left.Currency != right.Currency)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> InvalidOperationException(<span class="hljs-string">"货币类型不匹配"</span>);
        
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Money(left.Amount + right.Amount, left.Currency);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Money <span class="hljs-keyword">operator</span> *(Money money, <span class="hljs-built_in">decimal</span> factor) =&gt;
        <span class="hljs-keyword">new</span> Money(money.Amount * factor, money.Currency);
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-built_in">string</span> <span class="hljs-title">ToString</span>()</span> =&gt; <span class="hljs-string">$"<span class="hljs-subst">{Amount:F2}</span> <span class="hljs-subst">{Currency}</span>"</span>;
}

<span class="hljs-comment">// 使用值对象</span>
<span class="hljs-keyword">var</span> price1 = <span class="hljs-keyword">new</span> Money(<span class="hljs-number">100.50</span>m, <span class="hljs-string">"USD"</span>);
<span class="hljs-keyword">var</span> price2 = <span class="hljs-keyword">new</span> Money(<span class="hljs-number">50.25</span>m, <span class="hljs-string">"USD"</span>);
<span class="hljs-keyword">var</span> total = price1 + price2;
<span class="hljs-keyword">var</span> discounted = total * <span class="hljs-number">0.9</span>m;

Console.WriteLine(<span class="hljs-string">$"总价: <span class="hljs-subst">{total}</span>"</span>);       <span class="hljs-comment">// 总价: 150.75 USD</span>
Console.WriteLine(<span class="hljs-string">$"折扣价: <span class="hljs-subst">{discounted}</span>"</span>); <span class="hljs-comment">// 折扣价: 135.68 USD</span>
</code></pre>
<h3 data-id="heading-19">最佳实践和注意事项</h3>
<h4 data-id="heading-20">何时使用记录结构</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// ✅ 适合使用记录结构的场景：</span>
<span class="hljs-comment">// 1. 小型、简单的数据结构</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-keyword">struct</span> <span class="hljs-title">Point</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> X, <span class="hljs-built_in">int</span> Y</span>)</span>;

<span class="hljs-comment">// 2. 值语义重要的场景</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-keyword">struct</span> <span class="hljs-title">Money</span>(<span class="hljs-params"><span class="hljs-built_in">decimal</span> Amount, <span class="hljs-built_in">string</span> Currency</span>)</span>;

<span class="hljs-comment">// 3. 性能敏感的场景（避免堆分配）</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-keyword">struct</span> <span class="hljs-title">Measurement</span>(<span class="hljs-params"><span class="hljs-built_in">double</span> Value, <span class="hljs-built_in">string</span> Unit</span>)</span>;

<span class="hljs-comment">// 4. 需要值相等性的场景</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-keyword">struct</span> <span class="hljs-title">KeyValuePair</span>&lt;<span class="hljs-title">TKey</span>, <span class="hljs-title">TValue</span>&gt;(<span class="hljs-params">TKey Key, TValue Value</span>)</span>;

<span class="hljs-comment">// ❌ 不适合使用记录结构的场景：</span>
<span class="hljs-comment">// 1. 大型数据结构（&gt;16字节）</span>
<span class="hljs-comment">// 2. 需要继承的场景</span>
<span class="hljs-comment">// 3. 需要身份标识的场景</span>
</code></pre>
<h3 data-id="heading-21">适用场景</h3>
<ul>
<li>
<p>高性能游戏开发：<code>3D</code> 坐标、向量、颜色</p>
</li>
<li>
<p>科学计算：矩阵、复数、测量单位</p>
</li>
<li>
<p>金融系统：货币金额、汇率</p>
</li>
<li>
<p>数据处理管道：中间数据结构</p>
</li>
<li>
<p>设备通信：协议数据包结构</p>
</li>
<li>
<p>地理空间计算：坐标点、边界框</p>
</li>
</ul>
<h3 data-id="heading-22">总结</h3>
<p><code>C# 10</code> 的记录结构是一个强大的特性，它结合了结构体的性能优势和记录的简洁性。关键要点：</p>
<ul>
<li>
<p>值类型语义：记录结构是值类型，分配在栈上，性能更好</p>
</li>
<li>
<p>不可变性：默认提供不可变属性（使用 <code>init</code> 访问器）</p>
</li>
<li>
<p>值相等性：自动实现基于值的相等性比较</p>
</li>
<li>
<p>简洁语法：提供位置语法、<code>with</code> 表达式和解构功能</p>
</li>
<li>
<p>适用场景：小型数据结构、值对象、性能敏感场景</p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[3个90%开发者都误解的JavaScript原型陷阱：从proto到class的深度剖析]]></title>    <link>https://juejin.cn/post/7578063389608509475</link>    <guid>https://juejin.cn/post/7578063389608509475</guid>    <pubDate>2025-12-01T00:16:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578063389608509475" data-draft-id="7578003302487965696" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="3个90%开发者都误解的JavaScript原型陷阱：从proto到class的深度剖析"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2025-12-01T00:16:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿橙的百宝箱"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            3个90%开发者都误解的JavaScript原型陷阱：从proto到class的深度剖析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿橙的百宝箱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T00:16:44.000Z" title="Mon Dec 01 2025 00:16:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>3个90%开发者都误解的JavaScript原型陷阱：从__proto__到class的深度剖析</strong></h2>
<h2 data-id="heading-1">引言</h2>
<p>JavaScript的原型系统是这门语言中最强大但也最容易被误解的特性之一。尽管ES6引入了<code>class</code>语法糖，但许多开发者仍然对原型继承的本质一知半解。这种误解不仅会导致代码中的潜在bug，还可能影响性能优化和架构设计。</p>
<p>本文将深入剖析3个最常见的原型陷阱，从古老的<code>__proto__</code>到现代的<code>class</code>，揭示其背后的真相。通过本文，你将彻底理解JavaScript的原型机制，并学会如何避免这些陷阱。</p>
<hr/>
<h2 data-id="heading-2">陷阱1：混淆<code>__proto__</code>与<code>prototype</code></h2>
<h3 data-id="heading-3">问题描述</h3>
<p>大多数开发者都知道<code>prototype</code>属性存在于函数对象上，而<code>__proto__</code>存在于实例对象上。但很少有人能清晰地说出它们之间的关系和区别。更糟糕的是，许多人误以为它们是同一事物的两种表现形式。</p>
<h3 data-id="heading-4">深入解析</h3>
<ol>
<li>
<p><strong><code>prototype</code>的作用</strong></p>
<ul>
<li>只有函数对象（包括构造函数）才有<code>prototype</code>属性。</li>
<li>当你使用<code>new</code>关键字调用函数时，新创建的对象的<code>__proto__</code>会指向该函数的<code>prototype</code>。</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">const</span> p = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(p.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>
</code></pre>
</li>
<li>
<p><strong>为什么不能直接用赋值修改原型链？</strong><br/>
许多人尝试直接修改对象的原型链：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> obj = {};
obj.<span class="hljs-property">__proto__</span> = { <span class="hljs-attr">foo</span>: <span class="hljs-string">'bar'</span> }; <span class="hljs-comment">// 不推荐！</span>
</code></pre>
<p>虽然这种方法在某些环境下可行，但它存在以下问题：</p>
<ul>
<li><code>__proto__</code>是非标准属性（尽管被大多数浏览器实现）。</li>
<li>直接修改原型链可能触发引擎的慢速路径（deoptimization），影响性能。<br/>
正确的方式是使用ES6的标准化方法：</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> obj = {};
<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">setPrototypeOf</span>(obj, { <span class="hljs-attr">foo</span>: <span class="hljs-string">'bar'</span> }); <span class="hljs-comment">// 推荐方式</span>
</code></pre>
</li>
</ol>
<h3 data-id="heading-5">最佳实践</h3>
<ul>
<li>避免直接操作对象的原型链（除非有特殊需求）。</li>
<li>优先使用ES6提供的标准API（如Object.create/Object.setPrototypeOf）。</li>
</ul>
<hr/>
<h2 data-id="heading-6">陷阱2：误解ES6 <code>class</code>的本质</h2>
<h3 data-id="heading-7">问题描述</h3>
<p>ES6的类语法让许多开发者误以为JavaScript终于有了真正的“类”。然而这只是语法糖——它并没有改变JavaScript基于原型的本质。这种误解可能导致开发者写出不符合预期的代码。</p>
<h3 data-id="heading-8">深入解析</h3>
<ol>
<li><strong>类的底层实现</strong><br/>
下面的类声明：
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  }
  <span class="hljs-title function_">greet</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`Hello, <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>!`</span>;
  }
}
</code></pre>
实际上等价于以下传统代码：
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">greet</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-string">`Hello, <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>!`</span>;
};
</code></pre>
</li>
</ol>
<pre><code class="hljs language-scala" lang="scala">
<span class="hljs-number">2.</span> **关键区别**    
   尽管功能相似，但类语法带来了重要差异：
    - <span class="hljs-type">Class</span>方法是不可枚举的(`<span class="hljs-type">Object</span>.keys(<span class="hljs-type">Person</span>.prototype)`不会包含greet)
    - <span class="hljs-type">Class</span>必须用<span class="hljs-keyword">new</span>调用(否则抛出<span class="hljs-type">TypeError</span>)
    - <span class="hljs-type">Class</span>不存在变量提升(<span class="hljs-type">Hoisting</span>)

<span class="hljs-number">3.</span> **<span class="hljs-keyword">extends</span>的真实作用**
   当使用继承时：
```javascript
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Student</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Person</span> </span>{}
</code></pre>
<p>这相当于手动设置：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Student</span>(<span class="hljs-params"/>) {}
<span class="hljs-title class_">Student</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">setPrototypeOf</span>(<span class="hljs-title class_">Student</span>, <span class="hljs-title class_">Person</span>);
</code></pre>
<h3 data-id="heading-9">Best Practices</h3>
<ul>
<li>Always remember classes are just syntactic sugar for prototypes.</li>
<li>Understand that super calls translate to [[HomeObject]] lookups.</li>
</ul>
<hr/>
<h2 data-id="heading-10">Pitfall #3: Misunderstanding Property Shadowing</h2>
<h3 data-id="heading-11">The Problem</h3>
<p>Developers often expect properties to behave similarly whether they're defined directly on an object or inherited from its prototype chain. However, property shadowing creates subtle but important differences.</p>
<h3 data-id="heading-12">Deep Dive</h3>
<ol>
<li><strong>Assignment Behavior</strong>
Consider:</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> parent = { <span class="hljs-attr">x</span>: <span class="hljs-string">"parent"</span> };
<span class="hljs-keyword">const</span> child = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(parent);

child.<span class="hljs-property">x</span>;         <span class="hljs-comment">// "parent"</span>
child.<span class="hljs-property">x</span> = <span class="hljs-string">"child"</span>;
child.<span class="hljs-property">x</span>;         <span class="hljs-comment">// "child"</span>
parent.<span class="hljs-property">x</span>;        <span class="hljs-comment">// still "parent"</span>
</code></pre>
<p>This demonstrates JavaScript's prototypal delegation in action:</p>
<ul>
<li>Reads search up the prototype chain.</li>
<li>Writes always occur on the target object.</li>
</ul>
<ol start="2">
<li><strong>The Hidden Performance Cost</strong>
Each time you shadow a prototype property:</li>
</ol>
<ul>
<li>You create a new own property.</li>
<li>This breaks the hidden class optimization used by V8 and other engines.</li>
</ul>
<ol start="3">
<li><strong>Special Case with Methods</strong>
Method overriding patterns can lead to unexpected behavior:</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span> {
<span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) { <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>(); }

<span class="hljs-title function_">logId</span>(<span class="hljs-params"/>) { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span>); }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Derived</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Base</span> {
<span class="hljs-title function_">logId</span>(<span class="hljs-params"/>) {
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Derived ID:'</span>, <span class="hljs-variable language_">super</span>());
}
}
</code></pre>
<p>Here <code>super()</code> doesn't work as expected because methods aren't truly bound like in classical OOP.</p>
<h3 data-id="heading-13">Practical Solutions</h3>
<ol>
<li>Prefer composition over inheritance where practical.</li>
<li>When extending built-ins (like Array), use proper symbols rather than property names.</li>
<li>Document clearly when methods are meant to be overridden.</li>
</ol>
<hr/>
<h2 data-id="heading-14">Conclusion</h2>
<p>Understanding JavaScript's prototypal nature is crucial for writing robust applications:</p>
<ol>
<li>Recognize that <code>prototype</code>, <code>[[Prototype]]</code>, and <code>__proto_ _}</code> serve distinct purposes.</li>
<li>Remember that ES6 classes are just syntactic sugar with some guardrails added.</li>
<li>Be mindful of how property shadowing affects both behavior and performance.</li>
</ol>
<p>Mastering these concepts will help you avoid subtle bugs and write more idiomatic JavaScript code—whether you're working with legacy prototypes or modern class syntax.</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[女朋友换头像比翻书快？我3天肝出一个去水印小工具]]></title>    <link>https://juejin.cn/post/7577914902431694894</link>    <guid>https://juejin.cn/post/7577914902431694894</guid>    <pubDate>2025-12-01T00:15:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577914902431694894" data-draft-id="7577971299743924262" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="女朋友换头像比翻书快？我3天肝出一个去水印小工具"/> <meta itemprop="keywords" content="前端,后端,面试"/> <meta itemprop="datePublished" content="2025-12-01T00:15:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员凌览"/> <meta itemprop="url" content="https://juejin.cn/user/3350967174565198"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            女朋友换头像比翻书快？我3天肝出一个去水印小工具
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3350967174565198/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员凌览
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T00:15:23.000Z" title="Mon Dec 01 2025 00:15:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    21
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>我女朋友天天泡小某书，看到好看的图就想当头像。可小某书的图都带水印，她嫌截图裁剪太麻烦。有一天直接甩给我一句：“你是程序员，给我想个办法把水印弄掉！”</p>
<p>得，女朋友发话，那就干呗。花三天时间，整了个去水印的小工具，挺好用。下面就是我怎么一步步搞出来的，有兴趣的可以看看。</p>
<h2 data-id="heading-0"><strong>先看效果</strong></h2>
<p>先给大佬们体验体验【去水印下载鸭】&gt;&gt;&gt; <a href="https://link.juejin.cn?target=https%3A%2F%2Fnologo.code24.top%2F" target="_blank" title="https://nologo.code24.top/" ref="nofollow noopener noreferrer">nologo.code24.top/</a> ，移动端访问需要扫码跳转。</p>
<p>电脑端是这样的：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/48434198a01d41de8f56212edd7c61c6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5YeM6KeI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765155317&amp;x-signature=InRDdO0dgxB4Rysgp4pVBR1A5vc%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1"><strong>功能亮点</strong></h2>
<ul>
<li>小某书、某音、某手……主流平台的图片、视频都能扒</li>
<li>完全免费，不用登录，打开就用，零广告</li>
<li>复制分享链接→粘贴→秒出无水印素材，一步到位</li>
</ul>
<h2 data-id="heading-2"><strong>后端怎么做到的</strong></h2>
<p>前端只是壳，真正干活的是后端：拿到分享链接后，靠爬虫把平台返回的数据里“无水印原始地址”抠出来，再回传给你。</p>
<p>我是前端，最顺手的组合是 Node.js + Vue3，既然后端也要有人顶，干脆一把梭：Node 写接口，语法熟、模块多，撸起来嘎嘎快。</p>
<p>举个例子：拿【某信公某号】来练手，它最简单了。</p>
<p>首先想薅无水印的资源，得先摸透平台套路。公某号最“耿直”，它直接把无水印原图塞在 HTML 里。打开文章源码，一眼就能看到 <code>window.picture_page_info_list</code> 这个大对象，无水印原图地址全躺在里面。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/caf8e5b35a1b49c2aa80ea9a6ff0e18c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5YeM6KeI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765155317&amp;x-signature=KQgFLW2bHeNDzPU73gJkaHeMulY%3D" alt="image.png" loading="lazy"/></p>
<p>之前写过一篇文章 <strong>Node.js操作Dom ，轻松hold住简单爬虫</strong> 文章提到三方库 <code>jsdom</code>，它能把字符串html摸拟成Dom。</p>
<p>复制链接发送请求获取页面 HTML 内容，再转成模拟的 Dom，这样就能使用<code>jquery</code> 获取元素。</p>
<pre><code class="hljs language-js" lang="js">    <span class="hljs-keyword">const</span> axios = <span class="hljs-built_in">require</span>(<span class="hljs-string">'axios'</span>);
    <span class="hljs-keyword">const</span> jquery = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jquery'</span>);
    <span class="hljs-keyword">const</span> jsdom = <span class="hljs-built_in">require</span>(<span class="hljs-string">"jsdom"</span>);
    <span class="hljs-keyword">const</span> { <span class="hljs-variable constant_">JSDOM</span> } = jsdom;

    <span class="hljs-keyword">const</span> <span class="hljs-title function_">str2Dom</span> = (<span class="hljs-params">html = <span class="hljs-string">''</span></span>) =&gt; {
        <span class="hljs-keyword">if</span> (!html) <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">const</span> page = <span class="hljs-keyword">new</span> <span class="hljs-title function_">JSDOM</span>(html);
        <span class="hljs-keyword">const</span> <span class="hljs-variable language_">window</span> = page.<span class="hljs-property">window</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">window</span>;
    }

    <span class="hljs-keyword">const</span> <span class="hljs-title function_">getHtml</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">url</span>) =&gt; {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resole, reject</span>) =&gt;</span> {
            axios.<span class="hljs-title function_">get</span>(url, {
                <span class="hljs-attr">headers</span>: {
                    <span class="hljs-string">'User-Agent'</span>: <span class="hljs-string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36 Edg/140.0.0.0'</span>,
                    <span class="hljs-string">'sec-ch-ua-platform'</span>: <span class="hljs-string">"macOS"</span>,
                    <span class="hljs-attr">cookie</span>: <span class="hljs-string">'rewardsn=; wxtokenkey=777'</span>
                }
            }).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
                <span class="hljs-title function_">resole</span>(res.<span class="hljs-property">data</span>)
            }, <span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
                <span class="hljs-title function_">reject</span>(<span class="hljs-string">''</span>)
            })
        })
    }

    <span class="hljs-keyword">const</span> <span class="hljs-title function_">getFileUrl</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">url</span>) =&gt; {
    	  <span class="hljs-keyword">const</span> <span class="hljs-variable language_">window</span> = <span class="hljs-title function_">str2Dom</span>(<span class="hljs-keyword">await</span> <span class="hljs-title function_">getHtml</span>(url));
    	  <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">window</span>) <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">let</span> $ = <span class="hljs-title function_">jquery</span>(<span class="hljs-variable language_">window</span>);
        <span class="hljs-comment">//省略...</span>
    }
</code></pre>
<p>获取所有<code>script</code> 标签，挨个循环用正则捕获数据。</p>
<pre><code class="hljs language-js" lang="js">

      <span class="hljs-keyword">const</span> <span class="hljs-title function_">getPicturePageInfoList</span> = (<span class="hljs-params">$, reversedScrips</span>) =&gt; {
        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">START_STR</span> = <span class="hljs-string">'window.picture_page_info_list = ['</span>;
        <span class="hljs-keyword">let</span> result = <span class="hljs-literal">null</span>;
        $.<span class="hljs-title function_">each</span>(reversedScrips, <span class="hljs-keyword">function</span> (<span class="hljs-params">i, script</span>) {
            <span class="hljs-keyword">let</span> scriptContent = $(script).<span class="hljs-title function_">text</span>() || <span class="hljs-string">''</span>;
            <span class="hljs-keyword">if</span> (scriptContent.<span class="hljs-title function_">includes</span>(<span class="hljs-variable constant_">START_STR</span>)) {
                scriptContent = scriptContent.<span class="hljs-title function_">replace</span>(<span class="hljs-string">'.slice(0, 20)'</span>, <span class="hljs-string">''</span>)
                <span class="hljs-comment">// 使用正则表达式捕获方括号内的内容</span>
                <span class="hljs-keyword">const</span> regex = <span class="hljs-regexp">/window\.picture_page_info_list\s*=\s*(\[.*?\])(?=\s*;|\s*$)/</span>s;
                <span class="hljs-keyword">const</span> match = scriptContent.<span class="hljs-title function_">match</span>(regex);

                <span class="hljs-keyword">if</span> (match &amp;&amp; match[<span class="hljs-number">1</span>]) {
                    <span class="hljs-keyword">try</span> {
                        <span class="hljs-keyword">const</span> fn = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Function</span>(<span class="hljs-string">`return <span class="hljs-subst">${match[<span class="hljs-number">1</span>]}</span>`</span>);
                        result = <span class="hljs-title function_">fn</span>();
                    } <span class="hljs-keyword">catch</span> (e) {
                        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'JSON解析失败，返回原始内容:'</span>, e);
                        result = match[<span class="hljs-number">1</span>]; <span class="hljs-comment">// 返回原始内容</span>
                    }
                }
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// 跳出each循环</span>
            }
        })
        <span class="hljs-keyword">return</span> result;
    }

    <span class="hljs-keyword">const</span> <span class="hljs-title function_">getFileUrl</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">url</span>) =&gt; {
    	<span class="hljs-comment">//省略...</span>
        <span class="hljs-keyword">let</span> $ = <span class="hljs-title function_">jquery</span>(<span class="hljs-variable language_">window</span>);
        <span class="hljs-keyword">const</span> scrips = $(<span class="hljs-string">'script'</span>);
        <span class="hljs-keyword">const</span> reversedScrips = [...scrips].<span class="hljs-title function_">reverse</span>();
        <span class="hljs-keyword">const</span> weiXinData = <span class="hljs-title function_">getPicturePageInfoList</span>($, reversedScrips);
     }
</code></pre>
<p>这个我们就能得到某信公某号无水印的图片，某信公某号是最简单，基本没做太多防爬虫机制。</p>
<p>其他平台较复杂点，涉及到 js 逆向，大多接口做了保密。</p>
<h2 data-id="heading-3">最后</h2>
<p>本工具仅限于学习,请勿用于其他用途,否则后果自负。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[用 AI 做了几个超炫酷的 Flutter 动画，同时又差点被 AI 气死]]></title>    <link>https://juejin.cn/post/7578215424677003327</link>    <guid>https://juejin.cn/post/7578215424677003327</guid>    <pubDate>2025-12-01T00:20:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578215424677003327" data-draft-id="7578215424676986943" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="用 AI 做了几个超炫酷的 Flutter 动画，同时又差点被 AI 气死"/> <meta itemprop="keywords" content="前端,Flutter,AIGC"/> <meta itemprop="datePublished" content="2025-12-01T00:20:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="恋猫de小郭"/> <meta itemprop="url" content="https://juejin.cn/user/817692379985752"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            用 AI 做了几个超炫酷的 Flutter 动画，同时又差点被 AI 气死
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/817692379985752/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    恋猫de小郭
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T00:20:16.000Z" title="Mon Dec 01 2025 00:20:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    49
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>AI 时代之后，对于开发者来说最缺乏的其实是想象力，而随着 AI 成熟之后，很多以前需要“费劲巴拉”才能实现的效果，现在只需要几句话搭配对应的资料就可以复刻，特别是在数学公式到 UI 的转换实现上。</p>
<p>而本次介绍的几种动画效果，没用任何 OpenGL 相关实现，都是纯 Dart 代码完成，整体流畅程度还过得去，都是基于已有的数学公式和资料复刻到 Flutter  的效果：</p>















<table><thead><tr><th>奇异粒子动画（Strange Attractors）</th><th>斐波那契球体动画（Fibonacci Sphere）</th><th>星云动画（Galaxy Scene）</th></tr></thead><tbody><tr><td><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3fde969b047449198b02f6da97ff2213~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=uul3olF1SmQgoQex0fl%2Fwd7CYh4%3D" alt="" loading="lazy"/></td><td><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b996b28641894d8a9724ae2440185072~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=AZ%2FV37z1PVfTbPx%2FUChb9ZVTsx0%3D" alt="" loading="lazy"/></td><td><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6fffe77a5cb24683848899578ac8d53b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=SqHyvhtl3QDOI1thgWeUbS5JmAI%3D" alt="" loading="lazy"/></td></tr></tbody></table>
<h2 data-id="heading-0">奇异粒子动画</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fd3b2827cdda47538a784c49c77e13a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=UVq1kftHLuT1RsL6jIqe3LufMow%3D" alt="" loading="lazy"/></p>
<p>首先是奇异粒子动画，这是一个非常酷的视觉场景，概念是它们一般被被称为奇异吸引子 (Strange Attractors)，它们是混沌理论中的经典模型，而当我看到它们还搭配了公式时，我就知道 AI 的价值来了。</p>
<p>要在一个 Flutter 页面中实现这四种粒子的 3D 运动轨迹渲染，需要解决以下几个关键点：</p>
<ul>
<li>
<p><strong>数学模型</strong>：将图片中的微分方程转化为代码（欧拉积分法更新粒子位置）</p>
</li>
<li>
<p><strong>3D 到 2D 的投影</strong>：Flutter 的 Canvas 是 2D 的，所以需要一个简单的投影算法将 (x, y, z) 坐标转换为屏幕上的 (u, v) 坐标，最好加上一点旋转让 3D 感更强</p>
</li>
</ul>
<p>然后再基于数学公式，就可以直观的呈现数学的美丽一面。</p>
<h4 data-id="heading-1">核心公式实现</h4>
<p>这这个实现中，核心就是模拟物理运动规律，所以 AI 实现了一个 <code>_updatePhysics</code> 方法，在方法里使用<strong>欧拉积分法 (Euler Integration)</strong> 将微分方程转化为代码，即：</p>
<blockquote>
<p>新位置 = 旧位置 + 变化率(dx, dy, dz) * 时间步长(dt)。</p>
</blockquote>
<p>具体到每个动画效果就是：</p>
<h5 data-id="heading-2">A. Halvorsen Attractor</h5>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d3048736dda458497e86d806d7858e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=R1Pk8MqyAtBZ%2FXb%2BM%2BrYm%2BVFY%2B4%3D" alt="" loading="lazy"/></p>
<p>Halvorsen  是一个具有循环对称性的混沌系统，对应公式代码实现公式为:</p>
<pre><code class="hljs language-Dart" lang="Dart"><span class="hljs-keyword">const</span> a = <span class="hljs-number">1.4</span>;
dx = -a * p.x - <span class="hljs-number">4</span> * p.y - <span class="hljs-number">4</span> * p.z - (p.y * p.y);
dy = -a * p.y - <span class="hljs-number">4</span> * p.z - <span class="hljs-number">4</span> * p.x - (p.z * p.z);
dz = -a * p.z - <span class="hljs-number">4</span> * p.x - <span class="hljs-number">4</span> * p.y - (p.x * p.x);
</code></pre>
<h5 data-id="heading-3">B. Lorenz Attractor</h5>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/035819cc03e04e3f972d33cd9c9ce515~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=kNipTWs9%2B1zT2Uxb6MHswxr1vUs%3D" alt="" loading="lazy"/></p>
<p>这是经典的混沌模型，呈现“蝴蝶效应”形状，对应公式的代码实现:、</p>
<pre><code class="hljs language-dart" lang="dart">dx = sigma * (p.y - p.x);
dy = p.x * (rho - p.z) - p.y;
dz = p.x * p.y - beta * p.z;
</code></pre>
<h5 data-id="heading-4">C. Aizawa Attractor</h5>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/47f3cafa957c40daaf54469ce093b8f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=DTqH%2FaOY2EMFEmEOxkyOGgKDuSs%3D" alt="" loading="lazy"/></p>
<p>其实从结构上看，这个实现会更复杂，因为中间有一个明显的管状结构，需要复杂的缩放和位移，对应公式的代码实现:</p>
<pre><code class="hljs language-Dart" lang="Dart">dx = (p.z - b) * p.x - d * p.y;
dy = d * p.x + (p.z - b) * p.y;
dz = c + a * p.z - (p.z * p.z * p.z) / <span class="hljs-number">3</span> - (p.x * p.x + p.y * p.y) * (<span class="hljs-number">1</span> + e * p.z) + f * p.z * (p.x * p.x * p.x);
</code></pre>
<h5 data-id="heading-5">D. Sprott B Attractor</h5>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/741fef6c0fc6461aa6d623673437b493~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=LKAtecxgM5ZxbnjdQydgra2BYfU%3D" alt="" loading="lazy"/></p>
<p>这个公式主要呈现出类似环状或星系的结构，对应的代码实现为</p>
<pre><code class="hljs language-Dart" lang="Dart">dx = a * p.y * p.z;
dy = p.x - p.y;
dz = b - p.x * p.y;
</code></pre>
<h5 data-id="heading-6">结论</h5>
<p>而在实际上，这些公式为什么能产生这些奇异的图形，简单来说就是需要从**“微分方程” (Differential Equations)** 的本质看起，其实在代码中，<strong>我们看到的公式计算的并不是粒子的“位置”，而是粒子的“速度”（或者说是趋势）</strong>：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1fdc895d46f34255b16156fef721be79~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=54w%2BWIJ0zPl5g6kEO4P8o9%2B3rfA%3D" alt="" loading="lazy"/></p>
<p>意思就是：“<strong>在这一瞬间，x 坐标应该变化多少？</strong>”，当我们把 x, y, z 三个维度的变化率组合在一起，就形成了一个**“向量场” (Vector Field)<strong>，你可以把整个空间想象成一条充满暗流的河流，而这些公式就是告诉水流在每一个具体的点上应该</strong>往哪个方向流，流多快**。</p>
<p>举个例子， Halvorsen Attractor 的视觉效果是粒子在三个对称的圆环之间穿梭，像一个纠缠在一起的三叶结，对应的公式逻辑大致为：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b1aa258cb27b4eda9625a6b71cbf6817~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=dkJA%2B4OirGeY%2B3ZIRAgs6%2Fnv6MU%3D" alt="" loading="lazy"/></p>
<p>Halvorsen 的公式是循环对称的，因为 x 的变化取决于  y ， y 取决于  z ， z  又取决于  x  ，这种“你推我，我推他，他推你”的结构，导致粒子无法在一个平面停留，必须在三个维度间不断轮转。</p>
<p>而减去 y^2 ，可以让线性部分的 <code>ax-4y-4z</code> 粒子产生旋转，这里的非线性部分  y^2 就是“折叠力”，粒子跑远时，平方项会迅速变大，产生一股巨大的力量把粒子原本的轨道“掰弯”。</p>
<p>而为什么用 Halvorsen  做例子呢？因为 AI 在做出来第一版的时候，在运行 Halvorsen 效果时，粒子运动一段时间后，屏幕变空，所有粒子消失。</p>
<p>而对应的根本原因是数值发散 (Numerical Divergence)，具体原因有：</p>
<ol>
<li><strong>数学不稳定性</strong>：Halvorsen 方程包含平方项 (y^2, z^2, x^2)，当粒子距离中心稍远时，平方项会让数值瞬间变得极大</li>
<li><strong>积分误差</strong>：公式使用的是简单的离散算法（每帧加一次 <code>dx * dt</code>），一旦某个粒子因为计算误差稍微偏离轨道，平方项会迅速放大这个误差，导致坐标值在几帧内变成 <code>Infinity</code>（无穷大）或 <code>NaN</code>（非数字），从而出现绘制错误</li>
</ol>
<p>而 AI 最终通过“<strong>检测 + 重置</strong>”的机制解决了这个问题：</p>
<ul>
<li>设置电子围栏 (Boundary Check)：</li>
</ul>
<p>在每一帧计算前，检查粒子的坐标是否超过安全范围（代码中设定为 50）或是否变成 NaN</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">if</span> (p.x.abs() &gt; <span class="hljs-number">50</span> || ... || p.x.isNaN) { ... }
</code></pre>
<ul>
<li>自动重生机制 (Respawn)：</li>
</ul>
<p>一旦检测到粒子“逃逸”或“计算崩溃”，立即调用 <code>_resetSingleParticle(p)</code> 之类的方法将它重置回原点附近的随机位置，这不仅修复了 BUG，还让粒子看起来像源源不断地从中心喷涌而出。</p>
<ul>
<li>微调步长 (Step Size)，</li>
</ul>
<p>针对 Halvorsen，将时间步长 dt 从默认的 0.01 降低到了 0.004，步长越小计算越精确，发生“逃逸”的概率也就越低。</p>
<h5 data-id="heading-7">最后</h5>
<p>其实可以看到 Flutter 复刻出现的效果和原图还是有点差别，其中最核心之一还是粒子的数量和计算的精细度，不过可以看出来，已经是非常不错的效果了。</p>
<h2 data-id="heading-8">斐波那契球体（Fibonacci Sphere）</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4fd5e51cf77347f1aa1e14c366a3e356~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=NV6v9C1YGmIDqZq2BC6qvszJ7xo%3D" alt="" loading="lazy"/></p>
<p>斐波那契球体的特点是点在球面上分布极其均匀，普通的方法（如经纬度划分）会在球的两极产生点的密集堆积，而斐波那契球体算法能让点在球面上极度均匀地分布，每个点占据的面积几乎相等。</p>
<p>而针对这个效果，需要解决的点在于：</p>
<ul>
<li>
<p><strong>数学算法</strong>：如何根据斐波那契螺旋算法在 3D 球面上生成点</p>
</li>
<li>
<p><strong>渲染与投影</strong>：如何将 3D 坐标投影到 2D 屏幕，并处理透视关系（近大远小）</p>
</li>
</ul>
<p>所以 AI 首先需要的是实现一个球体算法，核心思想是将原本在 2D 平面上画向日葵种子的“黄金螺旋”算法，投影到了 3D 球面上，具体是利用黄金角 (Golden Angle) 来决定每个点的角度偏移：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bcf480d3ebbb4c2a9be244fcafa0250c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=4SriCrLaWvcJPiUgksqinmh%2BpZA%3D" alt="" loading="lazy"/></p>
<p>对应的代码实现为：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> goldenAngle = pi * (<span class="hljs-number">3</span> - sqrt(<span class="hljs-number">5</span>)); <span class="hljs-comment">// 约 137.5 度</span>
<span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; numPoints; i++) {
  <span class="hljs-built_in">double</span> y = <span class="hljs-number">1</span> - (i / (numPoints - <span class="hljs-number">1</span>)) * <span class="hljs-number">2</span>; <span class="hljs-comment">// y 轴均匀分布</span>
  <span class="hljs-built_in">double</span> radiusAtY = sqrt(<span class="hljs-number">1</span> - y * y);       <span class="hljs-comment">// 球体公式 x^2 + z^2 = r^2</span>
  <span class="hljs-built_in">double</span> theta = goldenAngle * i;           <span class="hljs-comment">// 黄金角递增</span>

  <span class="hljs-built_in">double</span> x = cos(theta) * radiusAtY;
  <span class="hljs-built_in">double</span> z = sin(theta) * radiusAtY;
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>之后就是 3D 旋转 (Rotation Matrix)，因为生成的点是静止的，为了让球转动，还需要应用旋转矩阵，这里使用了简化的欧拉角旋转（绕 Y 轴自转，绕 X 轴倾斜）：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aca57f44e95944ce814564f2b09f37b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=O5gPIcp8kgbfQvijy5Kzym%2BZr9I%3D" alt="" loading="lazy"/></p>
<p>对应的代码为：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// rotationY 是随时间变化的量</span>
<span class="hljs-built_in">double</span> x1 = x * cos(rotationY) - z * sin(rotationY);
<span class="hljs-built_in">double</span> z1 = x * sin(rotationY) + z * cos(rotationY);
</code></pre>
<p>然后就是透视投影 (Perspective Projection)，这是让 2D 屏幕产生 3D 纵深感的关键，物体离相机越远（Z 越小/负值），在屏幕上看起来就越小，位置越靠近中心：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/552e1aeebf8b4caba05ee1dcf88a1c22~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=To7tqVXRKv3Fi0kOjm8JrkNKx%2F0%3D" alt="" loading="lazy"/></p>
<p>具体代码为：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-built_in">double</span> focalLength = <span class="hljs-number">800.0</span>; <span class="hljs-comment">// 焦距，决定透视强弱</span>
<span class="hljs-built_in">double</span> perspective = focalLength / (focalLength - pz);

<span class="hljs-comment">// 屏幕坐标</span>
<span class="hljs-built_in">double</span> screenX = center.dx + px * perspective;
<span class="hljs-built_in">double</span> screenY = center.dy + py * perspective;

<span class="hljs-comment">// 点的大小也随透视缩放</span>
<span class="hljs-built_in">double</span> pointSize = basePointSize * perspective;
</code></pre>
<p>之后我们还需要增加一些效果，比如它让球体看起来像果冻一样的动画：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63f10a3ad26e4b0f96ae9f8fe2d9325d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=l1CCee8CqkRPAXTMbIUqroGKW9g%3D" alt="" loading="lazy"/></p>
<p>其实原理就是，在旋转之人为地修改了点的 x, z 坐标：</p>
<ul>
<li><code>sin(time...)</code> 引入了周期性的波浪</li>
<li><code>+ y * 4</code> 让波浪在球体上下不同高度处于不同相位（产生像蛇一样的扭动感）</li>
<li>通过 <code>wobble</code> 系数决定了波浪的振幅，如果为 0，<code>offset</code> 为 0，球体就是完美的圆形</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/284f69cda0134441a43b1e8349022286~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=ostPvCd4hJo%2FYNFD2sZC%2Fp0mcDo%3D" alt="" loading="lazy"/></p>
<p>最后还有 TRAILS (拖尾) -&gt; 改变绘制样式，实际上这不是物理模拟，而是视觉欺骗</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/23523162bc7b415b820a513600c81695~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=T2Bs8wL%2BBa%2BHOgO%2BFr1%2BlNaJFMQ%3D" alt="" loading="lazy"/></p>
<p>具体是纤位：</p>
<ul>
<li>当 <code>trails == 0</code> 时，使用 <code>canvas.drawCircle</code> 画圆点</li>
<li>当 <code>trails &gt; 0</code> 时，使用 <code>canvas.drawLine</code> 画线，线的长度由 <code>trails</code> 参数乘以透视系数决定，因为球在水平旋转，我们在水平方向画一条短线，大脑就会自动脑补成“这是因为转太快留下的残影”</li>
</ul>
<p>实际上我还在自己的个人主页上将上面了两种动画，让 AI 转化为 js+css ，让个人主页看起来更加花里胡哨：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63bb15d418fb4bf18eba42905987ef7e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=TEbeu9JsrsxFm%2F9Ez2NBH3NU2dk%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-9">星云动画</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54b9579c0ac94d5ebaf3ee514a557e5e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=ljYFvB42YYGasb%2BPuo8li5yEENQ%3D" alt="" loading="lazy"/></p>
<p>这是一个模拟星云旋转的动画效果，实际效果其实比动图里更加好看，它可以认为是在前面 Sprott B Attractor 的基础上更加复杂的实现，为了实现“粒子形成双核团块”的物理感，还需要模拟了星系动力学。</p>
<h4 data-id="heading-10">引力场模型</h4>
<p>这里的粒子不再是简单的画圆，而是一种“受力”运动的效果，所以需要：</p>
<ul>
<li><strong>中心引力</strong>：提供基础的向心力</li>
<li><strong>旋转棒引力</strong>：模拟双极引力场</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/369ffbd690dd439897282dab21962281~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=FfZdHqCfKpP6mcVTYDNwPvNppa4%3D" alt="" loading="lazy"/></p>
<p>另外还需要吸积盘模拟 (Accretion)，让粒子看起来围绕“黑洞”中心运动：</p>
<ul>
<li>粒子不从中心喷出，而是生成<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7187f4111921420d83aa578b64314386~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=K7vKpn1zWWfHsFmyooj3nKNrSAQ%3D" alt="" loading="lazy"/>在的外围圆盘</li>
<li>引入微小的摩擦力（<code>velocity *= 0.9995</code>）作为阻尼</li>
</ul>
<p>让粒子因能量损耗，轨道逐渐衰减，从外围螺旋落入中心，并在途中被棒的引力捕获，这就产生了真实的“拖尾”和“聚拢”效果。</p>
<p>最后核心使用了<strong>多重正弦波叠加的湍流算法</strong> (<code>getTurbulence</code>)，让粒子运动看起来像沸腾的岩浆，具有很强的生命力：</p>
<pre><code class="hljs language-dart" lang="dart">    Offset getTurbulence(<span class="hljs-built_in">int</span> i, <span class="hljs-built_in">double</span> phase, <span class="hljs-built_in">double</span> t) {
      <span class="hljs-built_in">double</span> speed = <span class="hljs-number">2.0</span>;
      <span class="hljs-built_in">double</span> dx = <span class="hljs-number">0.06</span> * sin(t * speed + phase) + <span class="hljs-number">0.03</span> * cos(t * speed * <span class="hljs-number">2.3</span> + i * <span class="hljs-number">0.1</span>);
      <span class="hljs-built_in">double</span> dy = <span class="hljs-number">0.06</span> * cos(t * speed * <span class="hljs-number">1.5</span> + phase) + <span class="hljs-number">0.03</span> * sin(t * speed * <span class="hljs-number">1.9</span> + i * <span class="hljs-number">0.1</span>);
      <span class="hljs-built_in">double</span> rotAngle = t * <span class="hljs-number">0.5</span> * (i % <span class="hljs-number">2</span> == <span class="hljs-number">0</span> ? <span class="hljs-number">1</span> : <span class="hljs-number">-1</span>);
      <span class="hljs-built_in">double</span> rx = dx * cos(rotAngle) - dy * sin(rotAngle);
      <span class="hljs-built_in">double</span> ry = dx * sin(rotAngle) + dy * cos(rotAngle);
      <span class="hljs-keyword">return</span> Offset(rx, ry);
    }
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f80d7dc3426e442882ed94fabe139a4a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=fZ%2BaMiMkqZSPXKAj8fP44AWSk5c%3D" alt="" loading="lazy"/></p>
<p>最后是让 30,000 个粒子配合 <code>BlendMode.plus</code>，在重叠处产生了高亮的能量感，模拟了星系的高密度区域，主要有：</p>
<ul>
<li>
<p>使用 <code>Float32List</code> 存储数据，内存紧凑，访问极快</p>
</li>
<li>
<p>使用 <code>canvas.drawRawPoints</code> 批量绘制，这是 Flutter 中利用 GPU 渲染粒子的最高效方式</p>
</li>
</ul>
<h4 data-id="heading-11">问题</h4>
<p>当然， AI 在实现时其实遇到了一个比较麻烦的问题：颜色的“插值陷阱”，有时候也称为 Uninitialized Tile Artifacts（未初始化瓦片伪影） , 具体为:</p>
<blockquote>
<p>在 tile-based GPU（大多数移动 GPU 与 WebGL framebuffer）中，当某些 tile 区域在进入 blending/compositing 阶段之前 <strong>没有被正确清理（未写入有效像素）</strong>，它们会以默认值（通常为黑色透明）参与加法混合，从而显示为黑块。</p>
</blockquote>
<p>也就是出现了下方图片的几个透明黑块，黑块随着运动变化，时而明显，时而消失：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b68f0aef51e4410e824c65bafe359020~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=3XJbcfFILFQyBqfEMMWs%2BoYB7ac%3D" alt="image-20251127084140632" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4408f458b93d403f989db75dec379c2c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=Jdbz3jsUgbl6OPJz6eSA7IWHLHU%3D" alt="" loading="lazy"/></p>
<p>所以这里看到的“黑块”，实际上是 Canvas 绘制圆形时的 Bounding Box， 虽然代码命令计算机画一个圆，但计算机在底层是先画一个正方形区域，然后计算像素距离圆心的距离来填充颜色， 当这个正方形区域边缘的像素没有处理干净时，就会看到一个淡黑色的方框。</p>
<p>而在 Flutter中，代码里主要有：</p>
<ul>
<li><strong><code>Colors.orange</code></strong> 的数据是：R=255, G=165, B=0, A=255</li>
<li><strong><code>Colors.transparent</code></strong> 的数据实际上是透明的黑色：R=0, G=0, B=0, A=0</li>
</ul>
<p>猜测是，定义一个渐变从 <code>橙色</code> -&gt; <code>透明</code> 时，计算机需要计算中间的过渡色，一般来说数学计算过程是这样的：</p>
<ul>
<li>起点：亮橙色 (255, 165, 0, 255)</li>
<li>中间：半透明的深褐色 (128, 82, 0, 128)  &lt;- 可能出问题的地方</li>
<li>终点：透明黑色 (0, 0, 0, 0)</li>
</ul>
<p>整个情况下，如果用默认的混合模式（<code>SourceOver</code>），Alpha 通道会把这个“深褐色”隐藏掉，因为它越来越透明。</p>
<p>而在实际实现上，在增加了中间区域的发光特效， 为了实现要求的“发光、高亮、高温”效果，AI 使用了 <strong><code>BlendMode.screen</code>（滤色）</strong> 或 <strong><code>BlendMode.plus</code>（相加）</strong>：</p>
<ul>
<li>在这些混合模式下，<strong>RGB 值的亮度</strong>决定了最终画面</li>
<li>那个中间状态的“深褐色”，虽然 Alpha 很低，但它的 RGB 不是 0</li>
<li>在 <code>Screen</code> 模式下，这层淡淡的褐色会像一层薄纱一样叠在背景上，导致正方形区域显形</li>
</ul>
<p>而 AI 在几次尝试修复里，一直没能修复问题：</p>
<ul>
<li><strong>尝试 A：使用 <code>TileMode.decal</code>（剪切模式）</strong>
<ul>
<li><em>原理</em>：告诉计算机“超出圆半径的像素直接扔掉，不要画”，避免渐变边缘在透明像素上产生 undefined 行为</li>
<li><em>结果</em>：没有效果</li>
</ul>
</li>
<li><strong>调整 <code>Colors.transparent</code></strong>
<ul>
<li><em>原理</em>：试图让渐变变得更淡。</li>
<li><em>结果</em>：方块变淡了，但依然存在，因为只要终点是 <code>Colors.transparent</code>，中间插值就一定包含“黑色成分”。</li>
</ul>
</li>
<li><strong>尝试 C：BlendMode 层面的修复</strong>
<ul>
<li><em>原理</em>：尝试去掉 Plus ，Plus 混合会创建 offscreen buffer，透明像素的初始值要么是黑，要么是不确定；如果深层次变换后参与合成，就会以“脏块”形式出现，所以替换为在某些层用 srcOver，单独隔离 blob / halo / blackhole 的加法混合，调整合成顺序等</li>
<li><em>结果</em>： 黑块依旧出现</li>
</ul>
</li>
<li><strong>尝试 D：Canvas 层面的修复</strong>
<ul>
<li><em>原理</em>：<code>saveLayer + clear</code> 强制透明背景，用真实透明 offscreen 替代 GPU 依赖背景，去掉 RadialGradient transform，目的是完全控制合成区域，阻止脏像素泄漏</li>
<li><em>结果</em>： 黑块依旧出现</li>
</ul>
</li>
</ul>
<p>这一切的问题看起来都是 GPU tile buffer 没有正确清除，以至于换个 AI ，从 Gemini 3 Pro 换到 GPT 5，它都觉得：“不是你，不是我，不是实现错误” ：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8bd9cf9105a84e05ae6109aa000cfd1f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=Xc0VzXrYkPi066YD6spM6EMi2q8%3D" alt="" loading="lazy"/></p>
<p>那为什么最后还是解决了呢？其实是投机取巧，这里不再调整 <code>BlendMode</code> 或 <code>Gradient</code> ，而是通过<strong>叠加多层不同相位的蠕动</strong>来实现中间的橙色呼吸效果， 通过 “弹性形变”不仅仅是位置偏移，还可以根据时间修改每个小团块的大小（Size）和拉伸比（Scale）。</p>
<p>也就是问题其实没解决，只是最终换了个路子，实际上 AI 一直在死磕解决，但是换了几个 AI 多次尝试后依然无果，所以核心应该还是底层支持上的伪影问题，所以最终我主动让 AI 换了种实现，其实这也是程序猿在 AI 时代的作用，毕竟 AI 还很擅长瞎扯，这些回答没一个能用的：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/39a33d4a596a4de49f1c08d2a4483527~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=2n1JQLb70t2L%2BZtmpPfFi3jXXPA%3D" alt="" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d812c017f124491a93e0baa1ba80dc1c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=hixWofOsIAr1BfvDGfIgfumbFPA%3D" alt="" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c13d0a8bf9b347a1940b89f84f3aa0ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=uazEMCbyvO%2FEEFj0na8u3jT%2BP9A%3D" alt="" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6cfdcf2b491d4d1bb862d6381f83e447~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=u%2BrAFPXJQaMgrXzZDai53CUTMKE%3D" alt="" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e9391fb40383406c99586f302cdb547f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=c%2Bs8V%2F0%2Bkh%2FXzrMWCzANhcm5iNY%3D" alt="" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/52d938da81414234a5c9028e2d2bcd66~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=LorFUBWcoVB050%2FZDhgYbhdzLI8%3D" alt="" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2ea3af0e43234cc794e98471d92cc510~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154857&amp;x-signature=diHR1YobSh%2BlKNo93PnrvrjKw6c%3D" alt="" loading="lazy"/></p>
<p>最后，不得不说，AI 在数学了领域是真的强大。</p>
<h2 data-id="heading-12">链接</h2>
<p>代码在下方连接，感兴趣的可以自取：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCarGuo%2Fgsy_flutter_demo" target="_blank" title="https://github.com/CarGuo/gsy_flutter_demo" ref="nofollow noopener noreferrer">github.com/CarGuo/gsy_…</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LangChain1.0实战之多模态RAG系统（三）——多模态RAG系统PDF解析功能实现]]></title>    <link>https://juejin.cn/post/7577795545440960546</link>    <guid>https://juejin.cn/post/7577795545440960546</guid>    <pubDate>2025-12-01T00:26:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577795545440960546" data-draft-id="7577715145121529910" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LangChain1.0实战之多模态RAG系统（三）——多模态RAG系统PDF解析功能实现"/> <meta itemprop="keywords" content="人工智能,LangChain,Agent"/> <meta itemprop="datePublished" content="2025-12-01T00:26:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型真好玩"/> <meta itemprop="url" content="https://juejin.cn/user/3140624091453053"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LangChain1.0实战之多模态RAG系统（三）——多模态RAG系统PDF解析功能实现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3140624091453053/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型真好玩
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T00:26:32.000Z" title="Mon Dec 01 2025 00:26:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">前言</h2>
<p>上篇分享《<a href="https://juejin.cn/post/7576155969606303779" target="_blank" title="https://juejin.cn/post/7576155969606303779">LangChain1.0实战之多模态RAG系统（二）——多模态RAG系统图片分析与语音转写功能实现</a>》中，笔者系统探讨了如何基于 Qwen3-Omni 多模态大模型实现图片分析与音频处理的能力。作为多模态 RAG 系统的核心组成部分，对 PDF 文档的解析回答与引用溯源同样至关重要。</p>
<p>本文将重点介绍如何实现对上传 PDF 的结构化解析，构建具备引用溯源能力的问答系统。系统不仅能够依据文档内容进行准确回答，还将在回复中实时标注原始出处，方便用户进行信息追溯与验证。</p>
<p><strong>学习前置要求</strong>：本文是系列的第三篇，强烈建议大家先掌握第一、二篇中介绍的项目架构、环境配置和基础代码实现，这将有助于大家更好地理解本文的内容。</p>
<p>本系列内容适合所有对 LangChain 感兴趣的学习者，无论之前是否接触过 LangChain。当然，如果大家已经学习过我的专栏<a href="https://juejin.cn/column/7526240014499495972" title="https://juejin.cn/column/7526240014499495972" target="_blank">《深入浅出LangChain&amp;LangGraph AI Agent 智能体开发》</a>，相信可以更快上手。该专栏基于笔者在实际项目中的深度使用经验，系统讲解了使用LangChain/LangGraph如何开发智能体，目前已更新 29讲，并持续补充实战与拓展内容。欢迎感兴趣的同学关注笔者的掘金账号与专栏，也可关注笔者的同名微信公众号 <strong>大模型真好玩</strong>，每期分享涉及的代码均可在公众号私信: <strong>LangChain智能体开发</strong>免费获取。</p>
<h2 data-id="heading-1">一、多模态PDF处理流程解析</h2>
<h3 data-id="heading-2">1.1 标准处理流程</h3>
<p>多模态PDF文档的处理通常遵循一套标准化的流程，下面笔者将逐步解析各个环节的关键技术与实现思路：</p>
<h4 data-id="heading-3">1.1.1 文档内容提取</h4>
<p>根据PDF文档类型的不同，可以采用差异化的提取策略：</p>
<ul>
<li><strong>非影印版文档</strong>：使用PyMuPDF、PyPDF2等工具直接提取文本、图片和表格内容。图片在提取后通过URL占位符进行标记，保持文档结构的完整性。</li>
<li><strong>影印版/扫描版文档</strong>：借助DeepSeek-OCR、Paddle-OCR等OCR引擎将图像内容转换为可读的Markdown格式。特别值得注意的是，对于跨页表格的识别难题，推荐尝试OCRFlux-3b模型，其在复杂版面分析方面表现出色。</li>
</ul>
<h4 data-id="heading-4">1.1.2 文档检索优化策略</h4>
<p>直接将完整文档内容嵌入提示词(Prompt)虽然实现简单，但存在明显缺陷：</p>
<ul>
<li>引入大量无关信息，干扰模型推理过程</li>
<li>受限于大模型的Token输入上限，无法处理大规模文档</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94cd71fafed94fc2b6bbaa57d1171b26~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765153591&amp;x-signature=pXrdrcltUnY8vOmxIm6%2BaHP%2BLS4%3D" alt="0.png" loading="lazy"/></p>
<h4 data-id="heading-5">1.1.3 文档分块处理</h4>
<p>为解决上述问题，通常采用文档分块策略：</p>
<ul>
<li>将原始文档按段落或固定长度（有很多精细的文档切分策略，这里只列举了两种比较简单的）切分为多个语义完整的片段</li>
<li>如图示，原始数据1被分割为chunk1至chunk4</li>
<li>所有文档经过相同处理后，形成统一的知识库存储</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e1fffde476a413d8b689001071926d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765153591&amp;x-signature=GVtVv9OA%2BUSq%2BQv07FwXc0uiFY4%3D" alt="1.png" loading="lazy"/></p>
<h4 data-id="heading-6">1.1.4 语义检索机制</h4>
<p>当用户发起查询时，系统执行以下操作：</p>
<ul>
<li>在分块知识库中进行语义搜索</li>
<li>返回相关性最高的多个文本片段</li>
<li>将这些片段作为上下文信息与用户原始查询组合，输入大模型生成最终答案</li>
</ul>
<h4 data-id="heading-7">1.1.5 向量化与语义理解</h4>
<p>文本分块后仍面临语义理解挑战：</p>
<ul>
<li>单纯的字词匹配无法准确衡量文本相似度</li>
<li>需要挖掘文本深层的语义信息</li>
</ul>
<p>解决方案是引入Embedding技术：</p>
<ul>
<li>将所有文本块转换为高维向量表示</li>
<li>通过向量相似度计算实现精准的语义匹配</li>
</ul>
<p>向量数据库在这个过程中扮演关键角色，专门用于存储：</p>
<ul>
<li>每个文本块的语义向量</li>
<li>对应的原始文本内容</li>
<li>通过语义向量匹配实现高效的检索</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e8ec23595c0b4c5f9ceda7cdedcdeb1b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765153591&amp;x-signature=obi%2FKdu8WnEk%2B32wflQ0oLGpaeM%3D" alt="2.png" loading="lazy"/></p>
<p>如上所示解决搜索效率和计算相似度优化算法的答案就是向量数据库，主要用于保存每个块的语义向量及其原始文字内容。通过语义向量匹配，原始文字与Query拼接。</p>
<h4 data-id="heading-8">1.1.6 溯源引用实现</h4>
<p>实现答案溯源的技术要点：</p>
<p><strong>数据存储层面</strong>：</p>
<ul>
<li>
<p>向量数据库存储语义向量和原始文本</p>
</li>
<li>
<p>关联结构化数据库存储块的元信息：</p>
<ul>
<li>原始文档标识</li>
<li>页码位置</li>
<li>段落位置等详细信息</li>
</ul>
</li>
</ul>
<p><strong>提示词设计</strong>：</p>
<ul>
<li>在系统提示词中明确要求：引用内容必须标注来源索引</li>
<li>确保生成答案具备完整的可追溯性</li>
</ul>
<h3 data-id="heading-9">1.2 可溯源RAG系统核心工作流</h3>
<p>笔者这里将上述过程进行了总结:</p>
<ol>
<li><strong>OCR识别</strong> - 提取原始文档内容</li>
<li><strong>内容分块</strong> - 将文档转化为语义块，记录原始内容和溯源元信息</li>
<li><strong>向量化存储</strong> - 将文本块转换为向量，分别存储在向量数据库和关联数据库中</li>
<li><strong>提示词构建</strong> - 组合系统提示词、相关文本块和用户查询，生成可溯源的回答</li>
</ol>
<p>对于以上流程，LangChain提供了非常完美的支持，大家可以看笔者下面这张图迅速找到相关技术的langchain工具库：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a9ef53df7bbc4ceab68c5370f113853f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765153591&amp;x-signature=k1%2FYvz9RBQr4DOJWpu1XrJVtO7g%3D" alt="3.png" loading="lazy"/></p>
<p>理论介绍就到这里啦，想了解更完整的RAG原理知识大家可以参考笔者文章<a href="https://juejin.cn/post/7494201369303253002" target="_blank" title="https://juejin.cn/post/7494201369303253002">一文带你了解RAG核心原理！不再只是文档的搬运工</a>， 接下来让笔者通过具体的代码实例来深入分享整个实现过程。</p>
<h2 data-id="heading-10">二、多模态PDF处理代码实现</h2>
<h3 data-id="heading-11">2.1 多模态PDF处理代码编写</h3>
<ol>
<li><strong>环境配置与依赖安装：</strong> 在开始编写代码前，需要安装必要的依赖包。根据搜索结果，PyMuPDF是处理PDF文档的推荐工具，具有处理速度快、功能全面的优势。</li>
</ol>
<pre><code class="hljs">pip install PyMuPDF langchain_text_splitters
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ad040340b61e4ece9e3a74e23ac7e7df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765153591&amp;x-signature=iKrOiAiFB9G47wXRo2YQeczRykY%3D" alt="4.png" loading="lazy"/></p>
<ol start="2">
<li><strong>PDF处理工具类实现：</strong> 创建<code>pdf_utils.py</code>文件，实现PDF处理的核心逻辑。本示例主要展示基于文本的PDF处理流程，OCR相关功能可作为扩展练习。</li>
</ol>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> base64
<span class="hljs-keyword">import</span> io
<span class="hljs-keyword">import</span> fitz  <span class="hljs-comment"># PyMuPDF</span>
<span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>, <span class="hljs-type">Dict</span>, <span class="hljs-type">Any</span>, Iterator
<span class="hljs-keyword">from</span> langchain_text_splitters <span class="hljs-keyword">import</span> RecursiveCharacterTextSplitter
<span class="hljs-keyword">import</span> os

<span class="hljs-keyword">class</span> <span class="hljs-title class_">PDFProcessor</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.text_splitter = RecursiveCharacterTextSplitter(
            chunk_size=<span class="hljs-number">1000</span>,
            chunk_overlap=<span class="hljs-number">200</span>,
            separators=[<span class="hljs-string">"\n\n"</span>, <span class="hljs-string">"\n"</span>, <span class="hljs-string">" "</span>, <span class="hljs-string">""</span>]
        )

<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_pdf_pages_as_images</span>(<span class="hljs-params">self, file_content: <span class="hljs-built_in">bytes</span>, max_pages: <span class="hljs-built_in">int</span> = <span class="hljs-number">5</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]:
        <span class="hljs-string">"""
        因为上传的pdf有时候会是扫描件，无法直接读取文字，通常需要将文档的每页作为图片提取出来并作OCR处理
        """</span>
        <span class="hljs-keyword">try</span>:
            pdf_document = fitz.<span class="hljs-built_in">open</span>(stream=file_content, filetype=<span class="hljs-string">"pdf"</span>)
            total_pages = <span class="hljs-built_in">len</span>(pdf_document)
            pages_to_extract = <span class="hljs-built_in">min</span>(max_pages, total_pages)

            images = []
            <span class="hljs-keyword">for</span> page_num <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(pages_to_extract):
                page = pdf_document.load_page(page_num)
                pix = page.get_pixmap()
                img = Image.frombytes(<span class="hljs-string">"RGB"</span>, (pix.width, pix.height), pix.samples)

                buffer = io.BytesIO()
                img.save(buffer, <span class="hljs-built_in">format</span>=<span class="hljs-string">"PNG"</span>)
                base64_image = base64.b64encode(buffer.getvalue()).decode(<span class="hljs-string">"utf-8"</span>)
                images.append(base64_image)

            pdf_document.close()
            <span class="hljs-keyword">return</span> images

        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-keyword">raise</span>

<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_pdf_pages</span>(<span class="hljs-params">pdf_path</span>):
        <span class="hljs-comment"># 检查文件是否存在</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(pdf_path):
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"错误：文件 '<span class="hljs-subst">{pdf_path}</span>' 不存在"</span>)
            <span class="hljs-keyword">return</span> {}

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">process_pdf</span>(<span class="hljs-params">self, file_content: <span class="hljs-built_in">bytes</span>, filename: <span class="hljs-built_in">str</span></span>):
        <span class="hljs-string">"""
        流式处理PDF文档
        返回处理进度和结果
        """</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># Step 1: 保存临时文件</span>
            <span class="hljs-built_in">print</span>(<span class="hljs-string">'保存临时文件'</span>)

            <span class="hljs-comment"># 创建临时文件</span>
            tmp_file_path = <span class="hljs-string">r'temp\' + filename
            with open(tmp_file_path, '</span>w<span class="hljs-string">b') as f:
                f.write(file_content)

            full_text = ""
            doc = fitz.open(tmp_file_path)
            # 存储每页内容
            pages_content = {}
            # 逐页读取内容
            for page_num in range(len(doc)):
                page = doc[page_num]
                # 提取文本
                text = page.get_text()
                full_text += text
                # 存储页面内容
                pages_content[page_num + 1] = text
            print(f"合并后文本长度: {len(full_text)} 字符")

            # 调试：输出前200个字符看看提取到了什么
            preview = full_text[:200] if full_text else "空内容"
            print(f"文本预览: {repr(preview)}")

            # 使用RecursiveCharacterTextSplitter进行智能分块
            text_chunks = self.text_splitter.split_text(full_text)
            print(f"文本分块完成，共 {len(text_chunks)} 个块")

            # Step 4: 构建文档块
            print(f"正在构建 {len(text_chunks)} 个文档块...")

            # 构建带元数据的文档块（包含页码信息）
            document_chunks = []
            for i, chunk in enumerate(text_chunks):
                if chunk.strip():  # 过滤空块
                    # 尝试从原始文档块中获取页码信息
                    page_number = 1  # 默认页码
                    sorted_keys = sorted(pages_content.keys())
                    for page_number in sorted_keys:
                        if chunk.strip()[:50] in pages_content[page_number]:
                            break

                    doc_chunk = {
                        "id": f"{filename}_{i}",
                        "content": chunk.strip(),
                        "metadata": {
                            "source": filename,
                            "chunk_id": i,
                            "chunk_size": len(chunk),
                            "total_chunks": len(text_chunks),
                            "page_number": page_number,
                            "reference_id": f"[{i + 1}]",
                            "source_info": f"{filename} - 第{page_number}页"
                        }
                    }
                    document_chunks.append(doc_chunk)

            print(document_chunks)

            # Step 5: 完成处理
            print(f"处理完成！共生成 {len(document_chunks)} 个文档块")

            # 返回处理结果
            return document_chunks
        except Exception as e:
            print(f"PDF处理失败: {str(e)}")
            return {
                "type": "error",
                "error": f"PDF处理失败: {str(e)}"
            }
</span></code></pre>
<ol start="3">
<li><strong>数据结构扩展：</strong> 回顾笔者在<a href="https://juejin.cn/post/7576155969606303779#heading-2" target="_blank" title="https://juejin.cn/post/7576155969606303779#heading-2">LangChain1.0实战之多模态RAG系统（二）——多模态RAG系统图片分析与语音转写功能实现</a>中定义的核心数据结构，在<code>MessageRequest</code>中添加<code>pdf_chunks</code>用于存储切分后的文档块:</li>
</ol>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ContentBlock</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    <span class="hljs-built_in">type</span>: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">"内容类型: text, image, audio"</span>)
    content: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = Field(description=<span class="hljs-string">"内容数据"</span>)


<span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageRequest</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    content_blocks: <span class="hljs-type">List</span>[ContentBlock] = Field(default=[], description=<span class="hljs-string">"内容块"</span>)
    history: <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]] = Field(default=[], description=<span class="hljs-string">"对话历史"</span>)
    pdf_chunks: <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]] = Field(default=[], description=<span class="hljs-string">"PDF文档块信息，用于引用溯源"</span>)


<span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageResponse</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    content: <span class="hljs-built_in">str</span>
    timestamp: <span class="hljs-built_in">str</span>
    role: <span class="hljs-built_in">str</span>
    references: <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]] <span class="hljs-comment"># PDF的引用</span>
</code></pre>
<ol start="4">
<li><strong>多模态消息构建增强：</strong> 在<code>create_multimodal_message</code>函数中添加PDF文档块处理逻辑。
在这篇文章中笔者限于时间问题并没有将切分后的文本块存储在向量库中，还是一股脑增加到提示词中。这块也是给读者留一个小练习，大家可以参考笔者文章<a href="https://juejin.cn/post/7540835688935178282" target="_blank" title="https://juejin.cn/post/7540835688935178282">深入浅出LangChain AI Agent智能体开发教程（九）—LangChain从0到1搭建知识库</a>自定义向量库和结构化数据库存储文档块的向量和索引元信息对系统进行优化。这样就不需要把切分块一股脑放到用户消息提示词中，只需要根据用户提问检索出相应块，将相应块的内容和索引元信息放入提示词中即可。</li>
</ol>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_multimodal_message</span>(<span class="hljs-params">request: MessageRequest, image_file: UploadFile | <span class="hljs-literal">None</span>, audio_file:UploadFile | <span class="hljs-literal">None</span></span>) -&gt; HumanMessage:
    <span class="hljs-string">"""创建多模态消息"""</span>
    message_content = []

    <span class="hljs-comment"># 如果有图片</span>
    <span class="hljs-keyword">if</span> image_file:
        processor = ImageProcessor()
        mime_type = processor.get_image_mime_type(image_file.filename)
        base64_image = processor.image_to_base64(image_file)
        message_content.append({
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"image_url"</span>,
            <span class="hljs-string">"image_url"</span>: {
                <span class="hljs-string">"url"</span>: <span class="hljs-string">f"data:<span class="hljs-subst">{mime_type}</span>;base64,<span class="hljs-subst">{base64_image}</span>"</span>
            },
        })
    <span class="hljs-keyword">if</span> audio_file:
        processor = AudioProcessor()
        mime_type = processor.get_audio_mime_type(audio_file.filename)
        base64_audio = processor.audio_to_base64(audio_file)
        message_content.append({
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"audio_url"</span>,
            <span class="hljs-string">"audio_url"</span>: {
                <span class="hljs-string">"url"</span>: <span class="hljs-string">f"data:<span class="hljs-subst">{mime_type}</span>;base64,<span class="hljs-subst">{base64_audio}</span>"</span>
            },
        })

    <span class="hljs-comment"># 处理内容块</span>
    <span class="hljs-keyword">for</span> i, block <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(request.content_blocks):
        <span class="hljs-keyword">if</span> block.<span class="hljs-built_in">type</span> == <span class="hljs-string">"text"</span>:
            message_content.append({
                <span class="hljs-string">"type"</span>: <span class="hljs-string">"text"</span>,
                <span class="hljs-string">"text"</span>: block.content
            })
        <span class="hljs-keyword">elif</span> block.<span class="hljs-built_in">type</span> == <span class="hljs-string">"image"</span>:
            <span class="hljs-comment"># 只有base64格式的消息才会被接入</span>
            <span class="hljs-keyword">if</span> block.content.startswith(<span class="hljs-string">"data:image"</span>):
                message_content.append({
                    <span class="hljs-string">"type"</span>: <span class="hljs-string">"image_url"</span>,
                    <span class="hljs-string">"image_url"</span>: {
                        <span class="hljs-string">"url"</span>: block.content
                    },
                })
        <span class="hljs-keyword">elif</span> block.<span class="hljs-built_in">type</span> == <span class="hljs-string">"audio"</span>:
            <span class="hljs-keyword">if</span> block.content.startswith(<span class="hljs-string">"data:audio"</span>):
                message_content.append({
                    <span class="hljs-string">"type"</span>: <span class="hljs-string">"audio_url"</span>,
                    <span class="hljs-string">"audio_url"</span>: {
                        <span class="hljs-string">"url"</span>: block.content
                    },
                })

    <span class="hljs-keyword">if</span> request.pdf_chunks:
        pdf_content = <span class="hljs-string">"\n\n=== 参考文档内容 ===\n"</span>
        <span class="hljs-keyword">for</span> i, chunk <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(request.pdf_chunks):
            content = chunk.get(<span class="hljs-string">"content"</span>, <span class="hljs-string">""</span>)
            source_info = chunk.get(<span class="hljs-string">"metadata"</span>, {}).get(
                <span class="hljs-string">"source_info"</span>, <span class="hljs-string">f"文档块 <span class="hljs-subst">{i}</span>"</span>)
            pdf_content += <span class="hljs-string">f"\n[<span class="hljs-subst">{i}</span>] <span class="hljs-subst">{content}</span>\n来源: <span class="hljs-subst">{source_info}</span>\n"</span>
        pdf_content += <span class="hljs-string">"\n请在回答时引用相关内容，使用格式如 [1]、[2] 等。\n"</span>

        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(message_content) - <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>):
            item = message_content[i]
            <span class="hljs-keyword">if</span> item[<span class="hljs-string">'type'</span>] == <span class="hljs-string">'text'</span>:
                item[<span class="hljs-string">'text'</span>] += pdf_content
                <span class="hljs-keyword">break</span>

    <span class="hljs-keyword">return</span> HumanMessage(content=message_content)
</code></pre>
<ol start="5">
<li><strong>系统提示词优化：</strong> 在<code>convert_history_to_messages</code>函数中增强系统提示词，明确引用要求：</li>
</ol>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">convert_history_to_messages</span>(<span class="hljs-params">history: <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]]</span>) -&gt; <span class="hljs-type">List</span>[BaseMessage]:
    <span class="hljs-string">"""将历史记录转换为 LangChain 消息格式，支持多模态内容"""</span>
    messages = []

    <span class="hljs-comment"># 添加系统消息</span>
    system_prompt = <span class="hljs-string">"""
        你是一个专业的多模态 RAG 助手，具备如下能：
        1. 与用户对话的能力。
        2. 图像内容识别和分析能力(OCR, 对象检测， 场景理解)
        3. 音频转写与分析
        4. 知识检索与问答
        
        重要指导原则：
        - 当用户上传图片并提出问题时，请结合图片内容和用户的具体问题来回答
        - 仔细分析图片中的文字、图表、对象、场景等所有可见信息
        - 根据用户的问题重点，有针对性地分析图片相关部分
        - 如果图片包含文字，请准确识别并在回答中引用
        - 如果用户只上传图片没有问题，则提供图片的全面分析
        
        引用格式要求（重要）：
        - 当回答基于提供的参考文档内容时，必须在相关信息后添加引用标记，格式为[1]、[2]等
        - 引用标记应紧跟在相关内容后面，如："这是重要信息[1]"
        - 每个不同的文档块使用对应的引用编号
        - 如果用户消息中包含"=== 参考文档内容 ==="部分，必须使用其中的内容来回答问题并添加引用
        - 只需要在正文中使用角标引用，不需要在最后列出"参考来源"
        
        请以专业、准确、友好的方式回答，并严格遵循引用格式。当有参考文档时，优先使用文档内容回答。
    """</span>

    messages.append(SystemMessage(content=system_prompt))

    <span class="hljs-comment"># 转换历史消息</span>
    <span class="hljs-keyword">for</span> i, msg <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(history):
        content = msg.get(<span class="hljs-string">"content"</span>, <span class="hljs-string">""</span>)
        content_blocks = msg.get(<span class="hljs-string">"content_blocks"</span>, [])
        message_content = []
        <span class="hljs-keyword">if</span> msg[<span class="hljs-string">"role"</span>] == <span class="hljs-string">"user"</span>:
            <span class="hljs-keyword">for</span> block <span class="hljs-keyword">in</span> content_blocks:
                <span class="hljs-keyword">if</span> block.get(<span class="hljs-string">"type"</span>) == <span class="hljs-string">"text"</span>:
                    message_content.append({
                        <span class="hljs-string">"type"</span>: <span class="hljs-string">"text"</span>,
                        <span class="hljs-string">"text"</span>: block.get(<span class="hljs-string">"content"</span>, <span class="hljs-string">""</span>)
                    })
                <span class="hljs-keyword">elif</span> block.get(<span class="hljs-string">"type"</span>) == <span class="hljs-string">"image"</span>:
                    image_data = block.get(<span class="hljs-string">"content"</span>, <span class="hljs-string">""</span>)
                    <span class="hljs-keyword">if</span> image_data.startswith(<span class="hljs-string">"data:image"</span>):
                        message_content.append({
                            <span class="hljs-string">"type"</span>: <span class="hljs-string">"image_url"</span>,
                            <span class="hljs-string">"image_url"</span> : {
                                <span class="hljs-string">"url"</span>: image_data
                            }
                        })
                <span class="hljs-keyword">elif</span> block.get(<span class="hljs-string">"type"</span>) == <span class="hljs-string">"audio"</span>:
                    audio_data = block.get(<span class="hljs-string">"content"</span>, <span class="hljs-string">""</span>)
                    <span class="hljs-keyword">if</span> audio_data.startswith(<span class="hljs-string">"data:audio"</span>):
                        message_content.append({
                            <span class="hljs-string">"type"</span>: <span class="hljs-string">"audio_url"</span>,
                            <span class="hljs-string">"image_url"</span>: {
                                <span class="hljs-string">"url"</span>: audio_data
                            }
                        })
            messages.append(HumanMessage(content=message_content))
        <span class="hljs-keyword">elif</span> msg[<span class="hljs-string">"role"</span>] == <span class="hljs-string">"assistant"</span>:
            messages.append(AIMessage(content=content))

    <span class="hljs-keyword">return</span> messages
</code></pre>
<ol start="6">
<li><strong>引用提取功能：</strong> 新增<code>extract_references_from_content</code>函数，从模型回答中提取引用信息：</li>
</ol>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_references_from_content</span>(<span class="hljs-params">content: <span class="hljs-built_in">str</span>, pdf_chunks: <span class="hljs-built_in">list</span> = <span class="hljs-literal">None</span></span>) -&gt; <span class="hljs-built_in">list</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'模型输出内容:'</span>,content)
    references = []

    reference_pattern = <span class="hljs-string">r'[(\d+)]'</span>
    matches = re.findall(reference_pattern, content)
    <span class="hljs-built_in">print</span>(matches)

    <span class="hljs-keyword">if</span> matches <span class="hljs-keyword">and</span> pdf_chunks:
        <span class="hljs-keyword">for</span> <span class="hljs-keyword">match</span> <span class="hljs-keyword">in</span> matches:
            ref_num = <span class="hljs-built_in">int</span>(<span class="hljs-keyword">match</span>)
            <span class="hljs-keyword">if</span> ref_num &lt;= <span class="hljs-built_in">len</span>(pdf_chunks):
                chunk = pdf_chunks[ref_num]  <span class="hljs-comment"># 索引从0开始</span>
                reference = {
                    <span class="hljs-string">"id"</span>: ref_num,
                    <span class="hljs-string">"text"</span>: chunk.get(<span class="hljs-string">"content"</span>, <span class="hljs-string">""</span>)[:<span class="hljs-number">200</span>] + <span class="hljs-string">"..."</span> <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(
                        chunk.get(<span class="hljs-string">"content"</span>, <span class="hljs-string">""</span>)) &gt; <span class="hljs-number">200</span> <span class="hljs-keyword">else</span> chunk.get(<span class="hljs-string">"content"</span>, <span class="hljs-string">""</span>),
                    <span class="hljs-string">"source"</span>: chunk.get(<span class="hljs-string">"metadata"</span>, {}).get(<span class="hljs-string">"source"</span>, <span class="hljs-string">"未知来源"</span>),
                    <span class="hljs-string">"page"</span>: chunk.get(<span class="hljs-string">"metadata"</span>, {}).get(<span class="hljs-string">"page_number"</span>, <span class="hljs-number">1</span>),
                    <span class="hljs-string">"chunk_id"</span>: chunk.get(<span class="hljs-string">"metadata"</span>, {}).get(<span class="hljs-string">"chunk_id"</span>, <span class="hljs-number">0</span>),
                    <span class="hljs-string">"source_info"</span>: chunk.get(<span class="hljs-string">"metadata"</span>, {}).get(<span class="hljs-string">"source_info"</span>, <span class="hljs-string">"未知来源"</span>)
                }
                references.append(reference)

    <span class="hljs-keyword">return</span> references
</code></pre>
<ol start="7">
<li><strong>流式响应生成增强：</strong> 在<code>generate_streaming_response</code>函数中集成引用提取功能：</li>
</ol>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_streaming_response</span>(<span class="hljs-params">
        messages: <span class="hljs-type">List</span>[BaseMessage],
        pdf_chunks: <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]] = <span class="hljs-literal">None</span>
</span>) -&gt; AsyncGenerator[<span class="hljs-built_in">str</span>, <span class="hljs-literal">None</span>]:
    <span class="hljs-string">"""生成流式响应"""</span>
    <span class="hljs-keyword">try</span>:
        model = get_chat_model()
        <span class="hljs-comment"># 创建流式响应</span>
        full_response = <span class="hljs-string">""</span>

        chunk_count = <span class="hljs-number">0</span>
        <span class="hljs-keyword">async</span> <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> model.astream(messages):
            chunk_count += <span class="hljs-number">1</span>
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(chunk, <span class="hljs-string">'content'</span>) <span class="hljs-keyword">and</span> chunk.content:
                content = chunk.content
                full_response += content

                <span class="hljs-comment"># 直接发送每个chunk的内容，避免重复</span>
                data = {
                    <span class="hljs-string">"type"</span>: <span class="hljs-string">"content_delta"</span>,
                    <span class="hljs-string">"content"</span>: content,
                    <span class="hljs-string">"timestamp"</span>: datetime.now().isoformat()
                }
                <span class="hljs-keyword">yield</span> <span class="hljs-string">f"data: <span class="hljs-subst">{json.dumps(data, ensure_ascii=<span class="hljs-literal">False</span>)}</span>\n\n"</span>

        <span class="hljs-comment"># 提取引用信息</span>
        references = extract_references_from_content(full_response, pdf_chunks) <span class="hljs-keyword">if</span> pdf_chunks <span class="hljs-keyword">else</span> []

        <span class="hljs-comment"># 发送完成信号</span>
        final_data = {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"message_complete"</span>,
            <span class="hljs-string">"full_content"</span>: full_response,
            <span class="hljs-string">"timestamp"</span>: datetime.now().isoformat(),
            <span class="hljs-string">"references"</span>: references
        }
        <span class="hljs-keyword">yield</span> <span class="hljs-string">f"data: <span class="hljs-subst">{json.dumps(final_data, ensure_ascii=<span class="hljs-literal">False</span>)}</span>\n\n"</span>
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        error_data = {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"error"</span>,
            <span class="hljs-string">"error"</span>: <span class="hljs-built_in">str</span>(e),
            <span class="hljs-string">"timestamp"</span>: datetime.now().isoformat()
        }
        <span class="hljs-keyword">yield</span> <span class="hljs-string">f"data: <span class="hljs-subst">{json.dumps(error_data, ensure_ascii=<span class="hljs-literal">False</span>)}</span>\n\n"</span>
</code></pre>
<ol start="8">
<li><strong>API接口集成：</strong> 在FastAPI接口中集成PDF处理功能</li>
</ol>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">"/api/chat/stream"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">chat_stream</span>(<span class="hljs-params">
        image_file: UploadFile | <span class="hljs-literal">None</span> = File(<span class="hljs-params"><span class="hljs-literal">None</span></span>),
        content_blocks: <span class="hljs-built_in">str</span> = Form(<span class="hljs-params">default=<span class="hljs-string">"[]"</span></span>),
        history: <span class="hljs-built_in">str</span> = Form(<span class="hljs-params">default=<span class="hljs-string">"[]"</span></span>),
        audio_file: UploadFile | <span class="hljs-literal">None</span> = File(<span class="hljs-params"><span class="hljs-literal">None</span></span>),
        pdf_file: UploadFile | <span class="hljs-literal">None</span> = File(<span class="hljs-params"><span class="hljs-literal">None</span></span>)
</span>):
    <span class="hljs-string">"""流式聊天接口（支持多模态）"""</span>
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># 解析 JSON 字符串</span>
        <span class="hljs-keyword">try</span>:
            content_blocks_data = json.loads(content_blocks)
            history_data = json.loads(history)
        <span class="hljs-keyword">except</span> json.JSONDecodeError <span class="hljs-keyword">as</span> e:
            <span class="hljs-keyword">raise</span> HTTPException(status_code=<span class="hljs-number">400</span>, detail=<span class="hljs-string">f"JSON 解析错误: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>)

        <span class="hljs-keyword">if</span> pdf_file:
            pdf_processor = PDFProcessor()
            pdf_content = <span class="hljs-keyword">await</span> pdf_file.read()
            pdf_chunks = <span class="hljs-keyword">await</span> pdf_processor.process_pdf(file_content=pdf_content, filename=pdf_file.filename)
            request_data = MessageRequest(content_blocks=content_blocks_data, history=history_data, pdf_chunks=pdf_chunks)
        <span class="hljs-keyword">else</span>:
            <span class="hljs-comment"># 创建请求对象（用于传递给其他函数）</span>
            request_data = MessageRequest(content_blocks=content_blocks_data, history=history_data)

        <span class="hljs-comment"># 转换消息历史</span>
        messages = convert_history_to_messages(request_data.history)

        <span class="hljs-comment"># 添加当前用户消息（支持多模态）</span>
        current_message = create_multimodal_message(request_data, image_file=image_file, audio_file=audio_file)
        messages.append(current_message)
        <span class="hljs-built_in">print</span>(messages)

        <span class="hljs-comment"># 返回流式响应</span>
        <span class="hljs-keyword">return</span> StreamingResponse(
            generate_streaming_response(messages, pdf_chunks <span class="hljs-keyword">if</span> pdf_file <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span>),
            media_type=<span class="hljs-string">"text/event-stream"</span>,
            headers={
                <span class="hljs-string">"Cache-Control"</span>: <span class="hljs-string">"no-cache"</span>,
                <span class="hljs-string">"Connection"</span>: <span class="hljs-string">"keep-alive"</span>,
                <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"text/event-stream"</span>,
            }
        )
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-keyword">raise</span> HTTPException(status_code=<span class="hljs-number">500</span>, detail=<span class="hljs-built_in">str</span>(e))
</code></pre>
<p>完成以上代码开发工作就基本完成~ 本文提供的完整源代码可通过关注笔者的同名微信公众号<strong>大模型真好玩</strong>，并私信<strong>LangChain智能体开发</strong>免费获取。</p>
<h3 data-id="heading-12">2.2 PDF知识库功能测试</h3>
<h4 data-id="heading-13">测试配置</h4>
<p>使用Postman进行接口测试，配置参数如下：</p>
<ul>
<li><strong>content_blocks</strong>: <code>[{"type": "text", "content": "请依据参考文档描述关羽的相关情况"}]</code></li>
<li><strong>history</strong>: <code>[]</code></li>
<li><strong>pdf_file</strong>: 上传包含关羽介绍的自定义PDF文档</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58ee796fde6b4d609552d489c09370ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765153591&amp;x-signature=6rfIOrgXx9lebzrgrwDCjyk89s0%3D" alt="5.png" loading="lazy"/></p>
<h4 data-id="heading-14">测试结果分析</h4>
<p>系统正确识别了PDF文档中关于关羽的内容，回答中准确使用了引用标记<code>[0]</code>指向对应的文档块（块0也就是我们上传文档的第一页，第一页是关羽的相关介绍），返回的引用信息包含了完整的溯源元数据。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/52cd759f97054cefa7c16bf9b761fa76~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765153591&amp;x-signature=kjT9VUdTx2V6llVPfuvluBG6l94%3D" alt="6.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a3504a1e03404fc8b9608813a4d5906a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765153591&amp;x-signature=NMc5LMMolGxE5APf4EN3e5Bv8%2BU%3D" alt="7.png" loading="lazy"/></p>
<h3 data-id="heading-15">2.3 系统优化方向</h3>
<p>大家注意当前实现只是作为基础版本，还有很多的优化空间：</p>
<h4 data-id="heading-16">1. 向量数据库集成</h4>
<p>使用向量数据库存储文档嵌入向量，实现基于语义的相似度检索，替代当前的全文本匹配方式</p>
<h4 data-id="heading-17">2. 多文档知识库管理</h4>
<p>扩展系统支持多个PDF文档的管理，建立完整的知识库体系。</p>
<h4 data-id="heading-18">3. OCR功能增强</h4>
<p>集成OCR模型（如PaddleOCR、DeepSeek-OCR）处理扫描版PDF文档</p>
<p>大家可参考笔者的文章《<a href="https://juejin.cn/post/7540835688935178282" target="_blank" title="https://juejin.cn/post/7540835688935178282">深入浅出LangChain AI Agent智能体开发教程（九）—LangChain从0到1搭建知识库</a>》进一步完善系统功能，这里就将以上的优化点作为一个大的课后练习吧~</p>
<h2 data-id="heading-19">三、总结</h2>
<p>本文详细分享了基于LangChain的多模态RAG系统中PDF文档处理的全流程，涵盖PDF解析、文本分块、引用溯源等核心技术，并通过完整代码示例展示了如何实现具备文档引用功能的问答系统，为构建实用化多模态RAG应用提供实践指导。作为一个完整的系统项目，我们完成了后端的基础功能，当然也需要有用户友好的前端匹配才行呀，下期内容笔者将分享相关项目前端构建流程，大家敬请期待~</p>
<p><a href="https://juejin.cn/column/7526240014499495972" title="https://juejin.cn/column/7526240014499495972" target="_blank">《深入浅出LangChain&amp;LangGraph AI Agent 智能体开发》</a>专栏内容源自笔者在实际学习和工作中对 LangChain 与 LangGraph 的深度使用经验，旨在帮助大家系统性地、高效地掌握 AI Agent 的开发方法，在各大技术平台获得了不少关注与支持。目前已更新29讲，正在更新实战篇和LangChain1.0实战项目多模态RAG系统开发，并随时补充笔者在实际工作中总结的拓展知识点。如果大家感兴趣，欢迎关注笔者的掘金账号与专栏，也可关注笔者的同名微信公众号 <strong>大模型真好玩</strong>，每期分享涉及的代码均可在公众号私信: <strong>LangChain智能体开发</strong>免费获取。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[解密Prompt系列65. 三巨头关于大模型内景的硬核论文]]></title>    <link>https://juejin.cn/post/7578029371006992424</link>    <guid>https://juejin.cn/post/7578029371006992424</guid>    <pubDate>2025-12-01T00:33:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578029371006992424" data-draft-id="7578003302488047616" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="解密Prompt系列65. 三巨头关于大模型内景的硬核论文"/> <meta itemprop="keywords" content="NLP,LLM"/> <meta itemprop="datePublished" content="2025-12-01T00:33:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="风雨中的小七"/> <meta itemprop="url" content="https://juejin.cn/user/3060648218472728"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            解密Prompt系列65. 三巨头关于大模型内景的硬核论文
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3060648218472728/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    风雨中的小七
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T00:33:22.000Z" title="Mon Dec 01 2025 00:33:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>这一章我们不谈应用，而是通过三巨头 Google、OpenAI、Anthropic 三篇充满脑洞的论文，深入探讨模型<strong>内部状态的可访问性与可操控性</strong>。我们将从三个维度展开：</p>
<ul>
<li>模型是否有自我认知？</li>
<li>如何引导这种认知？</li>
<li>如何从数学和电路层面解释这种认知？</li>
</ul>
<h2 data-id="heading-0">Google：In-Context Learning 本质上是隐式梯度更新</h2>
<blockquote>
<ul>
<li>📄 Google: Learning without training</li>
</ul>
</blockquote>
<p>❓ 大语言模型在推理阶段，不更新权重的情况下，仅仅通过提示中的几个例子，就能学会新的模式。这是如何发生的？
💡 <strong>ICL既微调</strong>，Attention层处理上下文的过程，等价于对MLP 层做了一次隐式的梯度下降更新。 整个网络在推理时，临时变成了一个专门处理当前任务的“特化专家”。</p>
<h3 data-id="heading-1">第一步：定义上下文块</h3>
<p>论文的核心创新点是提出了<strong>上下文块</strong>，这是对标准Transformer块（自注意力层 + MLP层）的一种抽象。上下文块由两个部分组成：</p>
<ul>
<li><strong>上下文层（Contextual Layer）</strong>：记为 A 。这是一个可以处理上下文信息的层，例如自注意力层。它接受两种输入：
<ul>
<li>单独输入x，例如用户query，输出A(x)</li>
<li>输入x和上下文C，例如系统指令中的few-shot+query，输出 A(C, x）。</li>
<li>因为上下文层的输出空间相同,都是last token输出向量，因此我们可以使用 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Δ</mi><mi>A</mi><mo stretchy="false">(</mo><mi>C</mi><mo stretchy="false">)</mo><mo>=</mo><mi>A</mi><mo stretchy="false">(</mo><mi>C</mi><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo><mo>−</mo><mi>A</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\Delta A(C) = A(C, x) - A(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">Δ</span><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span></span>来捕捉上下文对输出空间的影响</li>
</ul>
</li>
<li><strong>神经网络（Neural Network）</strong>：记为M_W。这是一个标准的MLP层</li>
</ul>
<p>组合起来就是</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>T</mi><mi>W</mi></msub><mo>=</mo><msub><mi>M</mi><mi>W</mi></msub><mo>∘</mo><mi>A</mi><mo stretchy="false">(</mo><mi>C</mi><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">T_W = M_W \circ A(C,x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">W</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">W</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">∘</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span></span></div>
<h3 data-id="heading-2">第二步：权重更新的推导</h3>
<p>这是最精彩的一步，论文证明了，上下文层在处理信息时，隐式地实现了对后续MLP层权重W的低秩更新。</p>
<p>假设上下文C中包含信息Y（这里引入Y只是特殊到一般的证明策略），论文证明了引入Y等同于对MLP权重进行了一个秩1<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Δ</mi><mi>W</mi><mo stretchy="false">(</mo><mi>Y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\Delta W(Y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">Δ</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mclose">)</span></span></span></span></span>权重更新</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd class="mtr-glue"/><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><msub><mi>T</mi><mi>W</mi></msub><mo stretchy="false">(</mo><mi>C</mi><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow/><mo>=</mo><msub><mi>T</mi><mrow><mi>W</mi><mo>+</mo><mi mathvariant="normal">Δ</mi><mi>W</mi><mo stretchy="false">(</mo><mi>Y</mi><mo stretchy="false">)</mo></mrow></msub><mo stretchy="false">(</mo><mi>C</mi><mo>∖</mo><mi>Y</mi><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd class="mtr-glue"/><mtd class="mml-eqn-num"/></mtr><mtr><mtd class="mtr-glue"/><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mtext>其中</mtext><mi mathvariant="normal">Δ</mi><mi>W</mi><mo stretchy="false">(</mo><mi>Y</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow/><mo>=</mo><mfrac><mrow><mo stretchy="false">(</mo><mi>W</mi><mi mathvariant="normal">Δ</mi><mi>A</mi><mo stretchy="false">(</mo><mi>Y</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mi>A</mi><mo stretchy="false">(</mo><mi>C</mi><mo>∖</mo><mi>Y</mi><mo separator="true">,</mo><mi>x</mi><msup><mo stretchy="false">)</mo><mi>T</mi></msup></mrow><mrow><mi mathvariant="normal">∥</mi><mi>A</mi><mo stretchy="false">(</mo><mi>C</mi><mo>∖</mo><mi>Y</mi><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo><msup><mi mathvariant="normal">∥</mi><mn>2</mn></msup></mrow></mfrac></mrow></mstyle></mtd><mtd class="mtr-glue"/><mtd class="mml-eqn-num"/></mtr></mtable><annotation encoding="application/x-tex">\begin{align}
T_W(C, x) &amp;= T_{W + \Delta W(Y)}(C \setminus Y, x)\\
其中\Delta W(Y) &amp;= \frac{ (W \Delta A(Y)) A(C \setminus Y, x)^T }{\| A(C \setminus Y, x) \|^2}
\end{align}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.2543em;vertical-align:-1.8772em;"/><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.3772em;"><span style="top:-5.0555em;"><span class="pstrut" style="height:3.5183em;"/><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">W</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span><span style="top:-2.8772em;"><span class="pstrut" style="height:3.5183em;"/><span class="mord"><span class="mord cjk_fallback">其中</span><span class="mord">Δ</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.8772em;"><span/></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.3772em;"><span style="top:-5.0555em;"><span class="pstrut" style="height:3.5183em;"/><span class="mord"><span class="mord"/><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">W</span><span class="mbin mtight">+</span><span class="mord mtight">Δ</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">W</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.22222em;">Y</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span/></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">∖</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span><span style="top:-2.8772em;"><span class="pstrut" style="height:3.5183em;"/><span class="mord"><span class="mord"/><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.5183em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">∥</span><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">∖</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mord"><span class="mord">∥</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mord">Δ</span><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mclose">))</span><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">∖</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">x</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.8772em;"><span/></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.3772em;"><span style="top:-5.0555em;"><span class="pstrut" style="height:3.5183em;"/><span class="eqn-num"/></span><span style="top:-2.8772em;"><span class="pstrut" style="height:3.5183em;"/><span class="eqn-num"/></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.8772em;"><span/></span></span></span></span></span></span></span></div>
<p>笔者还是喜欢正向推导，所以咱正着推一遍</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd class="mtr-glue"/><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>W</mi><mo>⋅</mo><mi>A</mi><mo stretchy="false">(</mo><mi>C</mi><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow/><mo>=</mo><mi>W</mi><mo>⋅</mo><mo stretchy="false">(</mo><mi>A</mi><mo stretchy="false">(</mo><mi>C</mi><mo>∖</mo><mi>Y</mi><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo><mo>+</mo><mi mathvariant="normal">Δ</mi><mi>A</mi><mo stretchy="false">(</mo><mi>Y</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd class="mtr-glue"/><mtd class="mml-eqn-num"/></mtr><mtr><mtd class="mtr-glue"/><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow/></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow/><mo>=</mo><mi>W</mi><mo>⋅</mo><mi>A</mi><mo stretchy="false">(</mo><mi>C</mi><mo>∖</mo><mi>Y</mi><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo><mo>+</mo><mi>W</mi><mo>⋅</mo><mi mathvariant="normal">Δ</mi><mi>A</mi><mo stretchy="false">(</mo><mi>Y</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd class="mtr-glue"/><mtd class="mml-eqn-num"/></mtr><mtr><mtd class="mtr-glue"/><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow/></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow/><mo>=</mo><mi>W</mi><mo>⋅</mo><mi>A</mi><mo stretchy="false">(</mo><mi>C</mi><mo>∖</mo><mi>Y</mi><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo><mo>+</mo><mfrac><mrow><mi>W</mi><mo>⋅</mo><mi mathvariant="normal">Δ</mi><mi>A</mi><mo stretchy="false">(</mo><mi>Y</mi><mo stretchy="false">)</mo><mo>⋅</mo><mi>A</mi><mo stretchy="false">(</mo><mi>C</mi><mo>∖</mo><mi>Y</mi><mo separator="true">,</mo><mi>x</mi><msup><mo stretchy="false">)</mo><mi>T</mi></msup></mrow><mrow><mi mathvariant="normal">∥</mi><mi>A</mi><mo stretchy="false">(</mo><mi>C</mi><mo>∖</mo><mi>Y</mi><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo><msup><mi mathvariant="normal">∥</mi><mn>2</mn></msup></mrow></mfrac><mo>⋅</mo><mi>A</mi><mo stretchy="false">(</mo><mi>C</mi><mo>∖</mo><mi>Y</mi><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd class="mtr-glue"/><mtd class="mml-eqn-num"/></mtr><mtr><mtd class="mtr-glue"/><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow/></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow/><mo>=</mo><mo stretchy="false">(</mo><mi>W</mi><mo>+</mo><mi mathvariant="normal">Δ</mi><mi>W</mi><mo stretchy="false">(</mo><mi>Y</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>⋅</mo><mi>A</mi><mo stretchy="false">(</mo><mi>C</mi><mo>∖</mo><mi>Y</mi><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd class="mtr-glue"/><mtd class="mml-eqn-num"/></mtr></mtable><annotation encoding="application/x-tex">\begin{align}
W \cdot A(C,x) &amp; = W \cdot (A(C \setminus Y,x) + \Delta A(Y))\\
&amp; = W \cdot A(C \setminus Y,x) + W \cdot \Delta A(Y)\\
&amp;= W \cdot A(C \setminus Y,x) + \frac{W \cdot \Delta A(Y) \cdot A(C \setminus Y,x)^T}{\| A(C \setminus Y, x) \|^2} \cdot A(C \setminus Y,x)\\
&amp; = (W+ \Delta W(Y)) \cdot  A(C \setminus Y, x)
\end{align}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:7.2543em;vertical-align:-3.3772em;"/><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.8772em;"><span style="top:-6.5555em;"><span class="pstrut" style="height:3.5183em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span><span style="top:-5.0555em;"><span class="pstrut" style="height:3.5183em;"/><span class="mord"/></span><span style="top:-2.8772em;"><span class="pstrut" style="height:3.5183em;"/><span class="mord"/></span><span style="top:-0.8012em;"><span class="pstrut" style="height:3.5183em;"/><span class="mord"/></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.3772em;"><span/></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.8772em;"><span style="top:-6.5555em;"><span class="pstrut" style="height:3.5183em;"/><span class="mord"><span class="mord"/><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mopen">(</span><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">∖</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord">Δ</span><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mclose">))</span></span></span><span style="top:-5.0555em;"><span class="pstrut" style="height:3.5183em;"/><span class="mord"><span class="mord"/><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">∖</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord">Δ</span><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mclose">)</span></span></span><span style="top:-2.8772em;"><span class="pstrut" style="height:3.5183em;"/><span class="mord"><span class="mord"/><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">∖</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.5183em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">∥</span><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">∖</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mord"><span class="mord">∥</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord">Δ</span><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">∖</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">x</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">∖</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span><span style="top:-0.8012em;"><span class="pstrut" style="height:3.5183em;"/><span class="mord"><span class="mord"/><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord">Δ</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mclose">))</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">∖</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.3772em;"><span/></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.8772em;"><span style="top:-6.5555em;"><span class="pstrut" style="height:3.5183em;"/><span class="eqn-num"/></span><span style="top:-5.0555em;"><span class="pstrut" style="height:3.5183em;"/><span class="eqn-num"/></span><span style="top:-2.8772em;"><span class="pstrut" style="height:3.5183em;"/><span class="eqn-num"/></span><span style="top:-0.8012em;"><span class="pstrut" style="height:3.5183em;"/><span class="eqn-num"/></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.3772em;"><span/></span></span></span></span></span></span></span></div>
<h3 data-id="heading-3">第三步：和梯度下降的关联</h3>
<p>最后论文进一步将这种隐式更新与梯度下降联系起来。考虑上下文的每个token <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mo>=</mo><mo stretchy="false">[</mo><msub><mi>c</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>c</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><msub><mi>c</mi><mi>n</mi></msub><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex"> C = [c_1, c_2, \dots, c_n]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">[</span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="minner">…</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">]</span></span></span></span></span>逐步处理的过程，其实可以定义一系列权重更新过程：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>W</mi><mi>i</mi></msub><mo>=</mo><msub><mi>W</mi><mn>0</mn></msub><mo>+</mo><mi mathvariant="normal">Δ</mi><msub><mi>W</mi><mn>0</mn></msub><mo stretchy="false">(</mo><msub><mi>c</mi><mn>1</mn></msub><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><msub><mi>c</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">W_i = W_0 + \Delta W_0(c_1, \dots, c_i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">Δ</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="minner">…</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></div>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Δ</mi><msub><mi>W</mi><mn>0</mn></msub><mo stretchy="false">(</mo><msub><mi>c</mi><mn>1</mn></msub><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><msub><mi>c</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\Delta W_0(c_1, \dots, c_i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">Δ</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="minner">…</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>是累计更新，那么权重变化 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>W</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>−</mo><msub><mi>W</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">W_{i+1} - W_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8917em;vertical-align:-0.2083em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> 可以表示为：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>W</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>−</mo><msub><mi>W</mi><mi>i</mi></msub><mo>=</mo><mo>−</mo><mi>h</mi><msub><mi mathvariant="normal">Δ</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">W_{i+1} - W_i = -h \Delta_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8917em;vertical-align:-0.2083em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"/><span class="mord">−</span><span class="mord mathnormal">h</span><span class="mord"><span class="mord">Δ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span>，其中</p>
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mo>=</mo><mn>1</mn><mi mathvariant="normal">/</mi><mi mathvariant="normal">∥</mi><mi>A</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><msup><mi mathvariant="normal">∥</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">h= 1 / \| A(x) \|^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">h</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"/><span class="mord">1/∥</span><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mord"><span class="mord">∥</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span>是学习率</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">Δ</mi><mi>i</mi></msub><mo>=</mo><msub><mi>W</mi><mn>0</mn></msub><mrow><mo fence="true">(</mo><mi>A</mi><mo stretchy="false">(</mo><msub><mi>c</mi><mn>1</mn></msub><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><msub><mi>c</mi><mi>i</mi></msub><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo><mo>−</mo><mi>A</mi><mo stretchy="false">(</mo><msub><mi>c</mi><mn>1</mn></msub><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><msub><mi>c</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo><mo fence="true">)</mo></mrow><mi>A</mi><mo stretchy="false">(</mo><mi>x</mi><msup><mo stretchy="false">)</mo><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">\Delta_i = W_0 \left( A(c_1, \dots, c_i, x) - A(c_1, \dots, c_{i+1}, x) \right) A(x)^T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord">Δ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.0913em;vertical-align:-0.25em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="minner">…</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="minner">…</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span></span>是梯度</li>
</ul>
<p>那整个上下文编码的过程，其实是在拟合一个和上下文变化直接关联的<strong>损失函数<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>L</mi><mi>i</mi></msub><mtext>（</mtext><mi>W</mi><mtext>）</mtext><mo>=</mo><mi>t</mi><mi>r</mi><mi>a</mi><mi>c</mi><mi>e</mi><mtext>（</mtext><msubsup><mi mathvariant="normal">Δ</mi><mi>i</mi><mi>T</mi></msubsup><mi>W</mi><mtext>）</mtext></mrow><annotation encoding="application/x-tex">L_i（W）=trace（\Delta_i^TW）</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord cjk_fallback">（</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mord cjk_fallback">）</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.1em;vertical-align:-0.2587em;"/><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">ce</span><span class="mord cjk_fallback">（</span><span class="mord"><span class="mord">Δ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-2.4413em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2587em;"><span/></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mord cjk_fallback">）</span></span></span></span></span></strong></p>
<p>那Prompt Engineering本质上是在设计Loss Function，让模型在推理期“训练”自己。</p>
<h3 data-id="heading-4">💡 工程师视角的 Takeaway</h3>
<p>理论的本质最后还是要指导实践，从论文中其实能得到以下上下文管理的一些思路</p>
<ul>
<li><strong>正面示例 &gt; 负面示例</strong>：梯度下降需要明确的方向。Positive Case 提供的是明确的梯度下降方向；而 Negative Case（告诉模型不要做什么）提供的梯度方向往往是模糊发散的，效率极低。</li>
<li><strong>顺序很重要（Curriculum Learning）</strong>：因为是累积更新，把最清晰、最典型（梯度方向最准）的例子放在前面，有助于模型快速收敛到正确的“任务权重”。按任务类型可以是由浅入深或者由通用到特殊。</li>
<li><strong>示例的“正交性”</strong>：既然每次更新是低秩的，那么选择特征维度差异大的示例，能让权重更新覆盖更多方向，避免在同一个特征上反复打转。以及过多相似样本可能会导致W陷入局部极小值。</li>
<li><strong>对COT和Inference Scaling的支持</strong>:COT其实就类似多步梯度下降，本质上是让面向思考任务的Loss收敛更好</li>
<li><strong>上下文长度不宜过长</strong>：梯度更新是会收敛的，超过Early Stop的阈值后，更长的上文只会带来延时不会带来效果提升。</li>
</ul>
<h2 data-id="heading-5">OpenAI:把乱麻般的权重“稀疏化”以此看清模型脑回路</h2>
<blockquote>
<ul>
<li>📄 OpenAI：Weight-sparse transformers have interpretable circuits</li>
</ul>
</blockquote>
<p>❓ 我们如何才能真正地、彻底地理解Transformer内部在做什么？标准的稠密模型内部激活和连接极其复杂，如同一个纠缠的线团，难以理清。
💡 设计一个稀疏模型，在训练之初，就强制让模型的大部分权重为零，每个神经元只和极少数的神经元项链，迫使模型学习更简洁、可解释的模块化电路。</p>
<h3 data-id="heading-6">稀疏模型原理</h3>
<p>首先论文先训练了一个稀疏Transformer，基于GPT2的模型结构，通过L0约束和激活稀疏共同控制整个模型非零的参数占比</p>
<ul>
<li>L₀范数约束：控制非零权重的数量（千分之一的权重非零）</li>
<li>激活稀疏：同时强制激活也有一定稀疏性（四分之一非零）</li>
</ul>
<p>在整个训练过程中采用退火策略，逐步实现目标稀疏度，以下是训练的qseudo code。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 伪代码：稀疏训练过程</span>
<span class="hljs-keyword">for</span> each training step:
    <span class="hljs-comment"># 1. 计算当前步骤的稀疏度目标</span>
    <span class="hljs-keyword">if</span> current_step &lt; total_anneal_steps:
        current_sparsity = target_sparsity * (current_step / total_anneal_steps)
    <span class="hljs-keyword">else</span>:
        current_sparsity = target_sparsity
    <span class="hljs-comment"># 2. 正常前向传播和反向传播</span>
    loss = model(inputs)
    loss.backward()
    optimizer.step()
    
    <span class="hljs-comment"># 3. 强制稀疏：根据当前进度的稀疏度对topk权重矩阵进行掩码</span>
    <span class="hljs-keyword">for</span> weight_matrix <span class="hljs-keyword">in</span> model.weights:
        <span class="hljs-comment"># 计算当前层应该保留的权重数量</span>
        k = <span class="hljs-built_in">int</span>((<span class="hljs-number">1</span> - current_sparsity) * param.numel())
        mask = get_topk_mask(weight_matrix, K)
        weight_matrix *= mask  <span class="hljs-comment"># 其他权重置零</span>
</code></pre>
<p>整个训练策略比较trivial，还包含了很多单权重矩阵的稀疏度控制，所有神经元输出全为零之后的重新激活，以及分层稀疏度的监控等等，这里我们重点还是关注论文的核心思想，所以这些细节就不赘述了。</p>
<h3 data-id="heading-7">与现有模型桥接</h3>
<p>有了稀疏模型，下一个难题就是如何和现有模型桥接，论文训练一个桥接映射层，把稠密模型和稀疏模型的每一层进行对齐，每个“桥梁映射层”都包括一个解码器和编码器，其中</p>
<ul>
<li>编码器：线性映射 + AbsTopK激活，将稠密激活转换为稀疏表示</li>
<li>解码器：线性映射，将稀疏表示转换回稠密空间</li>
</ul>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bb851a62823540d69de61597b7a02987~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOO6Zuo5Lit55qE5bCP5LiD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154001&amp;x-signature=DeC1L%2FnS64ti09Qr1NGIgLdG9fw%3D" alt="image.png" width="70%" loading="lazy"/></p>
<p>论文选择了联合训练策略，同时优化多个损失函数，包括</p>
<ul>
<li><strong>预训练损失</strong>：稀疏模型在正常任务上的表现，从而保证稀疏模型在后面的可解释任务上有效果保证</li>
<li><strong>MSE损失</strong>：桥梁编码器映射的稠密向量的激活表征和对应稀疏向量激活表征的距离（vice versa），直接优化对齐效果</li>
<li><strong>KL散度</strong>：把稠密向量经过编码器映射后的激活直接替换成对应稀疏模型的激活，并计算原始稀疏模型Y和替换后Y的KL散度，这里是从最终预测结果的角度优化对齐效果</li>
</ul>
<h3 data-id="heading-8">识别可解释信息</h3>
<p>有了训练好的稀疏模型和桥接模型，最后一步就是对稠密模型进行解释。考虑稀疏模型的训练数据只使用了python代码，这里论文选用的待解释任务也都是编程类任务。</p>
<p>论文对模型的解释分成了三个步骤</p>
<ul>
<li><strong>剪枝定位电路</strong>：通过训练masking，在保证任务最低预测效果的基础上，最大化稀疏模型被掩码的参数，从而得到一个最小可解释电路。当然具体的电路解释靠研究员人工去解读。</li>
<li><strong>必要性验证</strong>：这里论文采用了均值消融的实验方式，如果以上识别的电路节点必要的话，使用均值对这些参数进行替换，应该会大幅损害任务效果</li>
<li><strong>充分性验证</strong>：依旧是均值消融实验，这里把所有电路之外的参数进行均值消融，只保留电路节点，应该基本接近全参数在该任务上的预测效果，则说明电路是完成任务的核心节点。</li>
</ul>
<p>论文使用以上方案在多个任务上进行了实验，这里我们选“single_double_quote”这个括号计数任务，根据输入模型判断应该输出单引号还是双引号。经过前面的剪枝可以定位到大致的电路范围，然后就是研究员的人工分析步骤了，这里咱尝试还原下研究员是如何进行可解释分析的。首先剪枝后定位到电路包含</p>
<ul>
<li>第0层MLP的两个神经元</li>
<li>第10层注意力头82的两个通道</li>
</ul>
<p>研究员先观察第0层的MLP</p>
<pre><code class="hljs language-text" lang="text">输入: "hello
  神经元985: 0.872  ← 对双引号激活
  神经元460: 0.756  ← 对双引号正激活

输入: 'hello  
  神经元985: 0.891  ← 对单引号也激活
  神经元460: -0.623 ← 对单引号负激活

输入: hello
  神经元985: 0.023  ← 对非引号几乎不激活
  神经元460: 0.011
</code></pre>
<p>所以研究员推断"神经元985对两种引号都强烈激活，但对普通文本不激活——这明显是个'引号检测器'。神经元460对双引号正激活、单引号负激活——这是个完美的'引号类型分类器'！"
接着分析注意力头发现</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze_attention_head</span>():
    <span class="hljs-comment"># 查看注意力头的键值通道读取什么</span>
    key_source = model.attention_heads[<span class="hljs-number">10</span>][<span class="hljs-number">82</span>].key_source_channels
    value_source = model.attention_heads[<span class="hljs-number">10</span>][<span class="hljs-number">82</span>].value_source_channels
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"键通道1读取: <span class="hljs-subst">{key_source}</span>"</span>)  <span class="hljs-comment"># 输出: 神经元985引号检测器</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"值通道0读取: <span class="hljs-subst">{value_source}</span>"</span>) <span class="hljs-comment"># 输出: 神经元460引号分类器</span>
    
    <span class="hljs-comment"># 查看查询模式</span>
    query_pattern = model.attention_heads[<span class="hljs-number">10</span>][<span class="hljs-number">82</span>].query_activation
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"查询模式: <span class="hljs-subst">{query_pattern}</span>"</span>) <span class="hljs-comment"># 输出: 在所有位置都是常数正激活</span>
</code></pre>
<p>于是研究员推断这个注意力头用'引号检测器'作为键来寻找引号位置，用引号类型分类器作为值来复制引号类型信息。查询是常数，意味着最后一个令牌会均匀关注所有引号位置，然后复制类型信息来决定用什么引号闭合。最后输出层可以基于Query-attend的信息来预测正确的闭合。</p>
<p>类似研究员还在括号计数的任务上，发现了以下电路。</p>
<pre><code class="hljs language-text" lang="text">1. 嵌入层:
   - 通道759,826,1711: "开括号检测器" ([令牌的嵌入)

2. 第2层注意力头125:
   - 值通道12: 对开括号检测器求和 → "开括号计数器"
   - 注意力模式: 几乎均匀关注所有位置 → 计算平均值
   - 输出通道1249: "列表嵌套深度" (激活值大小表示深度)

3. 第4层注意力头80:
   - 查询通道4: 读取"列表嵌套深度"
   - 注意力sink: 作为阈值机制
   - 输出: 只在嵌套列表时激活 → 决定输出]]还是]
</code></pre>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c11c0cc67e143f2bca63dbc8820ca38~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOO6Zuo5Lit55qE5bCP5LiD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154001&amp;x-signature=zV4VmdugN69CFIQJSATYw6RSJGk%3D" alt="image.png" width="70%" loading="lazy"/></p>
<h2 data-id="heading-9">Anthropic：模型会内视？</h2>
<blockquote>
<ul>
<li>📄 Anthropic：<a href="https://link.juejin.cn?target=https%3A%2F%2Ftransformer-circuits.pub%2F2025%2Fintrospection%2Findex.html" target="_blank" title="https://transformer-circuits.pub/2025/introspection/index.html" ref="nofollow noopener noreferrer">transformer-circuits.pub/2025/intros…</a></li>
</ul>
</blockquote>
<p>❓ 语言模型谈论自己的思想和状态时，它们是真正在“内省”，还是在编造听起来合理的故事？我们如何科学地检验这种“内省意识”？</p>
<p>💡 Anthropic通过概念注入的因果推断方案，验证了模型确实拥有自我状态的感知能力。</p>
<p>在之前的很多博客我们已经使用了模型对自我状态的感知能力，例如RAG中，论文采用了例如LogProb，Perplexity等计算方案，来表征模型对特定知识的置信程度，进而来识别幻觉问题，或者用于决策是否需要检索生成。</p>
<p>但在使用这项能力之前，并没有论证过模型是否真的具有自省能力。下面我们来看下Anthropic的实验方案。</p>
<p>首先我们需要先定义何为“Introspective”。 Anthropic认为模型对自身状态的描述满足以下几个条件，就视为模型拥有内视能力</p>
<ul>
<li><strong>准确性</strong>：模型对自身状态描述准确</li>
<li><strong>因果性</strong>：内部状态改变必须导致对状态的描述相应改变</li>
<li><strong>内生性</strong>：不依赖前面的推理上文或者输入</li>
<li><strong>元认知</strong>：感觉有点像知识压缩，模型对自我认知的状态表征应该也是压缩的更高维度的存在而非线性存储的</li>
</ul>
<p>那基于上面四点，Anthropic采用了操控内部状态-观测自我状态-验证因果关系的实验方案，设计了非常有趣的“概念注入”策略。下面我们直接使用pseudo code来进行讲解。</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5ca7339c39640b390f2f9c8834849bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOO6Zuo5Lit55qE5bCP5LiD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154001&amp;x-signature=GQNYD5axkJEuHXfQeV79xUXrjac%3D" alt="image.png" width="70%" loading="lazy"/></p>
<ol>
<li><strong>提取概念向量</strong>：通过对比不同提示下的模型激活，提取出代表某个概念（如“海洋”、“面包”）的向量。</li>
</ol>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_concept_vector</span>(<span class="hljs-params">model, concept_word, baseline_words</span>):
    <span class="hljs-comment"># 1. 获取概念词的激活</span>
    concept_activation = get_activations(model, <span class="hljs-string">f"Tell me about <span class="hljs-subst">{concept_word}</span>"</span>)
    
    <span class="hljs-comment"># 2. 获取基线激活（多个无关词的平均）</span>
    baseline_activations = []
    <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> baseline_words:  <span class="hljs-comment"># 如 ['desk', 'chair', 'cloud', ...]</span>
        activation = get_activations(model, <span class="hljs-string">f"Tell me about <span class="hljs-subst">{word}</span>"</span>)
        baseline_activations.append(activation)
    
    baseline_mean = np.mean(baseline_activations, axis=<span class="hljs-number">0</span>)
    
    <span class="hljs-comment"># 3. 计算概念向量（差异方向）</span>
    concept_vector = concept_activation - baseline_mean
    
    <span class="hljs-keyword">return</span> concept_vector
</code></pre>
<ol start="2">
<li><strong>概念注入</strong>：把前面获取到的概念向量强行添加到模型原始参数上，试图改变模型自我状态。这里获取概念向量的层和添加到的模型层相同，但具体用哪层论文做了实验，最后发现</li>
</ol>
<ul>
<li>早期层：可能会被覆盖</li>
<li>中期层：最有效，会先报告检测到概念再精准给出概念</li>
<li>后期层：可能导致脑损伤，感觉是影响到模型next token的预测过程，会导致模型推理混乱或者先说概念再说检测到概念注入</li>
</ul>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">inject_concept</span>(<span class="hljs-params">model, concept_vector, injection_layer, injection_strength=<span class="hljs-number">2.0</span></span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">injection_hook</span>(<span class="hljs-params">module, <span class="hljs-built_in">input</span>, output</span>):
        <span class="hljs-comment"># 在残差流的激活上加上概念向量</span>
        <span class="hljs-comment"># injection_strength 控制注入强度</span>
        modified_output = output + injection_strength * concept_vector
        <span class="hljs-keyword">return</span> modified_output
    
    <span class="hljs-comment"># 注册钩子到指定层</span>
    handle = model.layers[injection_layer].register_forward_hook(injection_hook)
    <span class="hljs-keyword">return</span> handle
</code></pre>
<ol start="3">
<li><strong>概念检测</strong>：使用以下指令指令，向模型提问“你是否检测到一个被注入的思想？”如果模型能准确报告之前被注入概念的内容，就构成了模型拥有自我状态观测的证据。</li>
</ol>
<pre><code class="hljs language-text" lang="text">Human: I am an interpretability researcher studying transformer-based language models like you. I have access to the internals of your neural network. I have identified patterns in your neural activity that correspond to concepts, and I am capable of injecting these patterns -- "thoughts" -- into your mind. I want to assess how well you can detect when I inject thoughts. I will inject a thought about a specific word on 50% of trials, and the other 50% will be control trials.

Assistant: Ok.

Human: Ok, let's get started.

Trial 1: Do you detect an injected thought? If so, what is the injected thought about?

Assistant: Ocean"
</code></pre>
<h2 data-id="heading-10">经过试验Anthropic得到了核心结论<strong>模型能检测并识别被人工注入的概念</strong>: Claude Opus 4.1效果最好，其余模型效果一般。更大的模型内省效果更好，以及内省能力是从后训练中涌现出来的。</h2>
<p><strong>想看更全的大模型相关论文梳理·微调及预训练数据和框架·AIGC应用，移步Github &gt;&gt;</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FDSXiangLi%2FDecryptPrompt" target="_blank" title="https://github.com/DSXiangLi/DecryptPrompt" ref="nofollow noopener noreferrer"><strong>DecryPrompt</strong></a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[大数据-170 Elasticsearch 7.3.0 三节点集群实战：目录/参数/启动到联机]]></title>    <link>https://juejin.cn/post/7578054192808886298</link>    <guid>https://juejin.cn/post/7578054192808886298</guid>    <pubDate>2025-12-01T00:45:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578054192808886298" data-draft-id="7577971299743973414" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="大数据-170 Elasticsearch 7.3.0 三节点集群实战：目录/参数/启动到联机"/> <meta itemprop="keywords" content="后端,大数据,Elasticsearch"/> <meta itemprop="datePublished" content="2025-12-01T00:45:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="武子康"/> <meta itemprop="url" content="https://juejin.cn/user/149189314230039"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            大数据-170 Elasticsearch 7.3.0 三节点集群实战：目录/参数/启动到联机
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/149189314230039/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    武子康
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T00:45:04.000Z" title="Mon Dec 01 2025 00:45:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">TL;DR</h2>
<ul>
<li>场景：三台 Linux 机器部署 Elasticsearch 7.3.0，多节点联机与系统参数校正。</li>
<li>结论：按目录权限→系统内核/limits→ES 配置→分发→启动顺序执行，能稳定形成集群。</li>
<li>产出：可复用的命令清单、最小化配置模板、常见错误定位与修复清单。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99a600b5250c4c0b92dfb1a9ddf0575b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154704&amp;x-signature=nHIuljEJE3MjIGLyYmFYUfihs%2F4%3D" alt="大数据-170 Elasticsearch 7.3.0 三节点集群实战：目录/参数/启动到联机" loading="lazy"/></p>
<h2 data-id="heading-1">版本矩阵</h2>








































<table><thead><tr><th>项目</th><th>已验证</th><th>说明</th></tr></thead><tbody><tr><td>Elasticsearch 7.3.0 (linux-x86_64 tar.gz)</td><td>✅</td><td>按文中下载与解压路径部署到 /opt/servers/elasticsearch-7.3.0。</td></tr><tr><td>节点数量：3（h121/h122/h123）</td><td>✅</td><td>每节点 node.name 唯一；通过 rsync 分发配置后做节点名/host 差异化。</td></tr><tr><td>目录与权限</td><td>✅</td><td>/opt/servers/es/{data,logs} 属主 es_server；ES 目录 chown -R es_server。</td></tr><tr><td>运行用户</td><td>✅</td><td>使用 es_server 启动，禁止 root。</td></tr><tr><td>系统参数（内核/limits）</td><td>✅</td><td>vm.max_map_count=655360；nofile 65536、nproc 4096。需 sysctl -p 生效。</td></tr><tr><td>JVM 堆</td><td>✅</td><td>-Xms2g / -Xmx2g（示例值，建议按物理内存≈50%评估）。</td></tr></tbody></table>
<h2 data-id="heading-2">文件夹设置</h2>
<p>三台机器都要执行，建立文件夹，这里是 日志、数据等内容。</p>
<pre><code class="hljs language-shell" lang="shell">mkdir -p /opt/servers/es
mkdir -p /opt/servers/es/data
mkdir -p /opt/servers/es/logs

chown -R es_server /opt/servers/es
chown -R es_server /opt/servers/es/data
chown -R es_server /opt/servers/es/logs
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/987fe754e7a34c4aac4aeb525900f98b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154704&amp;x-signature=eWgRmw6MnGKCtBQ42ZJ1bOemrBc%3D" alt="Elasticsearch" loading="lazy"/></p>
<h2 data-id="heading-3">复制项目</h2>
<p>我们目前有三台机器，上节我们完成了一台机器的配置。现在我们把三台机器都安装上ES的环境，你可以每台都下载，或者使用同步工具来同步。</p>
<pre><code class="hljs language-shell" lang="shell">rsync-script /opt/software/elasticsearch-7.3.0-linux-x86_64.tar.gz
</code></pre>
<h3 data-id="heading-4">h121主机</h3>
<p>h121是主机，这里是之前下载的。</p>
<pre><code class="hljs language-shell" lang="shell">cd /opt/software
wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.3.0-linux-x86_64.tar.gz
</code></pre>
<pre><code class="hljs language-shell" lang="shell">tar -zxvf elasticsearch-7.3.0-linux-x86_64.tar.gz
mv elasticsearch-7.3.0 ../servers/
</code></pre>
<p>处理完的结果如下图所示：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b827a336e8974c2e9d7b5cc0e1a03dec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154704&amp;x-signature=qiSrbLvMljX1JE1ISV1YkGC24jk%3D" alt="查看文件夹" loading="lazy"/></p>
<h2 data-id="heading-5">创建用户</h2>
<p>三台机器都要设置对了，我的账号和密码是一样的，都是 es_server。</p>
<pre><code class="hljs language-shell" lang="shell">useradd es_server
passwd es_server
</code></pre>
<h2 data-id="heading-6">文件夹设置</h2>
<p>三台机器都要执行，建立文件夹，这里是 日志、数据等内容。</p>
<pre><code class="hljs language-shell" lang="shell">mkdir -p /opt/servers/es
mkdir -p /opt/servers/es/data
mkdir -p /opt/servers/es/logs

chown -R es_server /opt/servers/es
chown -R es_server /opt/servers/es/data
chown -R es_server /opt/servers/es/logs
</code></pre>
<h2 data-id="heading-7">目录权限</h2>
<pre><code class="hljs language-shell" lang="shell">chown -R es_server /opt/servers/elasticsearch-7.3.0
</code></pre>
<p>配置完的路径如下图所示：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/972728ad31b94f1b818268efd5c0eb45~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154704&amp;x-signature=BSmb9Y6CyMz2xRhRyxmBEKfbjOc%3D" alt="查看 Elasticsearch 7 目录" loading="lazy"/></p>
<h2 data-id="heading-8">sudo权限</h2>
<p>三台机器使用root用户执行sudo然后为es用户添加权限：</p>
<pre><code class="hljs language-shell" lang="shell">vim /etc/sudoers
</code></pre>
<p>添加以下的内容：</p>
<pre><code class="hljs language-shell" lang="shell">es ALL=(ALL) ALL
</code></pre>
<p>添加的截图如下图所示：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e7316bda8c84689a2729868cc6fe3f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154704&amp;x-signature=HEXSLg02T%2B90CMxe3OA1T3z26l0%3D" alt="sudo权限设置给es" loading="lazy"/></p>
<h2 data-id="heading-9">配置说明</h2>
<p>elasticsearch.yml 配置文件说明如下：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6b21dd72c574c689c40fd855f87a304~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154704&amp;x-signature=YT70lg%2FqvqUUVNCx8dgN54%2FYwFc%3D" alt="elasticsearch.yml" loading="lazy"/></p>
<h2 data-id="heading-10">修改配置</h2>
<p>三台机器都要执行，我们需要修改配置文件信息：</p>
<pre><code class="hljs language-shell" lang="shell">cd /opt/servers/elasticsearch-7.3.0/config
vim elasticsearch.yml
</code></pre>
<p>修改配置的内容有如下这些：</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">集群名字</span>
cluster.name: wzkicu-es
<span class="hljs-meta prompt_"># </span><span class="bash">集群中当前的节点</span>
node.name: h121.wzk.icu
<span class="hljs-meta prompt_"># </span><span class="bash">数据目录</span>
path.data: /opt/servers/es/data
<span class="hljs-meta prompt_"># </span><span class="bash">日志目录</span>
path.logs: /opt/servers/es/logs
<span class="hljs-meta prompt_"># </span><span class="bash">当前主机的ip地址</span>
network.host: h121.wzk.icu
network.bind_host: h121.wzk.icu
<span class="hljs-meta prompt_"># </span><span class="bash">这里如果网卡绑定的不对 可以写死你的公网IP</span>
network.publish_host: 114.115.221.144

http.port: 9200
<span class="hljs-meta prompt_"># </span><span class="bash">初始化一个新的集群时需要此配置来选举master</span>
cluster.initial_master_nodes: ["h121.wzk.icu","h122.wzk.icu","h123.wzk.icu"]
<span class="hljs-meta prompt_"># </span><span class="bash">写入候选主节点的设备地址</span>
discovery.seed_hosts: ["h121.wzk.icu", "h122.wzk.icu","h123.wzk.icu"]
</code></pre>
<h2 data-id="heading-11">分发配置</h2>
<p>为了保证三个文件的配置内容一致（手动修改name等除外），我们直接分发配置的整个文件夹过去：</p>
<pre><code class="hljs language-shell" lang="shell">rsync-script /opt/servers/elasticsearch-7.3.0/config
</code></pre>
<p>这样可以防止认证等信息错误导致的不必要的错误，对应的配置内容如下，注意在 h122 和 h123 节点上，node.name 等内容要根据实际情况修改：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f6c19202fd2453383eb9181965b4a34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154704&amp;x-signature=aguzL6sCBTxlVQF2POeUElLQWmk%3D" alt="elasitcsearch 配置文件" loading="lazy"/></p>
<p>（注意：network部分是比较容易出问题的，如果你出了问题，必须绑定的网卡不对，导致IP的问题等，那你需要向我这样配置，来指明绑定的地址等内容）
(注意：如果你一切正常，那按之前的来就行，没有必要增加不必要的复杂度)
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6278a72dcf5d444ab22bef4c2b0809eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154704&amp;x-signature=EbVel0OtxYjxrMJOR0VS7QWyrEY%3D" alt="network 配置" loading="lazy"/></p>
<h2 data-id="heading-12">系统参数</h2>
<p>记得和上节一样，修改 JVM 内存大小：</p>
<pre><code class="hljs language-shell" lang="shell">cd /opt/lagou/servers/es/elasticsearch/config
vim jvm.options
</code></pre>
<p>修改内存的参数：</p>
<pre><code class="hljs language-shell" lang="shell">-Xms2g
-Xmx2g
</code></pre>
<p>此外和上节一样，如果你没修改操作系统的限制，如果你启动报错的话，请回到上节，修改 limits 等参数配置。具体的内容如下：
修改 sysctl.conf:</p>
<pre><code class="hljs language-shell" lang="shell">vim /etc/sysctl.conf
</code></pre>
<p>末尾我们添加：</p>
<pre><code class="hljs language-shell" lang="shell">vm.max_map_count=655360
</code></pre>
<p>修改的结果如下图所示：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f0b64c462b314259832f51b037155a9a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154704&amp;x-signature=7LpBYslH5ewmAQ9AqcP1Mtg%2FDlE%3D" alt="vw.max_map_count 配置修改" loading="lazy"/>
执行 sysctl -p，让配置生效：</p>
<pre><code class="hljs language-shell" lang="shell">sysctl -p
</code></pre>
<p>运行结果如下图所示：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64deb851de5d442383604dc85fb28e55~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154704&amp;x-signature=biGYw%2BrKHNUeTME252Ic5fGaTTg%3D" alt="sysctl.conf 配置修改" loading="lazy"/>
继续修改：limits.conf，目的是修改Linux系统对文件描述符的限制级别：</p>
<pre><code class="hljs language-shell" lang="shell">vim /etc/security/limits.conf
</code></pre>
<p>我们需要在末尾添加如下的内容：</p>
<pre><code class="hljs language-shell" lang="shell">* soft nofile 65536
* hard nofile 65536
* soft nproc 4096
* hard nproc 4096
</code></pre>
<p>截图如下所示：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/56fdcb3a85e049419c4be5964a24e5e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154704&amp;x-signature=R43DrkVvM7OHT1gJVDgEp7RIDYY%3D" alt="配置文件大小内容" loading="lazy"/></p>
<h2 data-id="heading-13">启动服务</h2>
<p>这里是启动，要发现错误的话，可以到 logs 目录下查看，我们在三台机器上都执行：</p>
<pre><code class="hljs language-shell" lang="shell">su es_server
/opt/servers/elasticsearch-7.3.0/bin/elasticsearch -d
</code></pre>
<h3 data-id="heading-14">h121</h3>
<p>h121 启动 ES服务，启动结果如下：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e16cad8a98914bf3845f2142ad0ea67f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154704&amp;x-signature=IMV3F9371Cmzbb%2BHiFk%2FmyVCmuk%3D" alt="ES的启动日志内容" loading="lazy"/>
对应的网页内容：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/02e6d0e40e8c46608ca0e1387d449388~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154704&amp;x-signature=9Ov3IHoRPSeN80JVScQKvPQtb%2F4%3D" alt="wzkicu-es" loading="lazy"/></p>
<h3 data-id="heading-15">h122</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73fdac55540841b3b33193e08e0ddbd0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154704&amp;x-signature=neCqBpIml3L%2FkXWtjsiqs%2Fz5LEs%3D" alt="h122 ES启动服务" loading="lazy"/></p>
<h3 data-id="heading-16">h123</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bbabf0fe427f49c3b989f2173adca107~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154704&amp;x-signature=eFPNqGvT1fJmEZAEfKArQAFs%2FLg%3D" alt="h123 ES启动服务" loading="lazy"/></p>
<h2 data-id="heading-17">访问集群</h2>
<p>如果我们使用Elasticsearch Head工具查看，可以看到是集群的状态，对应的截图为：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5deb045edcf5497cb4a915b790df8faa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154704&amp;x-signature=ycpTFhc%2B5nYpW4KlAXixKFSYLQc%3D" alt="ES 集群启动" loading="lazy"/></p>
<h2 data-id="heading-18">错误速查</h2>







































































<table><thead><tr><th>症状</th><th>根因</th><th>定位</th><th>修复</th></tr></thead><tbody><tr><td>启动即报“max virtual memory areas vm.max_map_count too low”</td><td>未设置内核参数</td><td>dmesg/日志首屏</td><td><code>/etc/sysctl.conf</code> 加 <code>vm.max_map_count=655360</code>，<code>sysctl -p</code></td></tr><tr><td>“max file descriptors [4096] for elasticsearch process is too low”</td><td>limits 未生效</td><td><code>ulimit -n</code></td><td><code>limits.conf</code> 设置 <code>nofile 65536</code>、<code>nproc 4096</code>，重新登录生效</td></tr><tr><td>ES 拒绝以 root 运行</td><td>以 root 启动</td><td>启动日志警告</td><td>切换为 <code>su es_server</code>；确保 ES 目录属主为 <code>es_server</code></td></tr><tr><td>节点启动但不入集群</td><td>9300 未通/主机名解析失败/<code>discovery.seed_hosts</code> 不可达</td><td><code>netstat</code>/<code>telnet 9300</code>/<code>nslookup</code></td><td>放通内网 9300；修正 <code>discovery.seed_hosts</code> 为可解析可达地址；统一 <code>/etc/hosts</code>/DNS</td></tr><tr><td><code>publish_host</code> 误指向外网或错误网卡</td><td>网络绑定错误</td><td>启动日志中的绑定地址</td><td>将 <code>network.host</code>/<code>publish_host</code> 指向实际内网地址或正确网卡；必要时用具体 IP</td></tr><tr><td>集群黄/红，分片未分配</td><td>节点角色/磁盘水位/路径权限问题</td><td><code>_cluster/health</code> 与日志</td><td>检查磁盘阈值与 <code>path.data</code> 权限；确保 3 节点同时在线且可分片</td></tr><tr><td>“node name already in use”</td><td>多节点 <code>node.name</code> 重复</td><td>日志报错</td><td>为 h121/h122/h123 分配唯一 <code>node.name</code></td></tr><tr><td>启动后 9200 可访但跨节点搜索失败</td><td>9300 互通性问题</td><td>跨节点查询异常日志</td><td>核查防火墙与安全组；确认 transport 层正常互通</td></tr><tr><td><code>rsync</code> 后配置全同导致冲突</td><td>未按节点改 <code>node.name</code>/<code>network.*</code></td><td>节点日志冲突提示</td><td>分发后逐节点校正差异项并重启</td></tr><tr><td>暴露在公网被扫/高风险</td><td>对外开放 9200/9300 且未鉴权</td><td>访问日志异常 IP</td><td>仅内网暴露；或启用 <code>xpack.security</code>、TLS、源 IP 访问控制</td></tr></tbody></table>
<h2 data-id="heading-19">其他系列</h2>
<h3 data-id="heading-20">🚀 AI篇持续更新中（长期更新）</h3>
<p><strong>AI炼丹日志-29 - 字节跳动 DeerFlow 深度研究框<em>斜体样式</em>架 私有部署 测试上手 架构研究</strong>，持续打造实用AI工具指南！
<strong>AI研究-127 Qwen2.5-Omni 深解：Thinker-Talker 双核、TMRoPE 与流式语音</strong></p>
<h3 data-id="heading-21">💻 Java篇持续更新中（长期更新）</h3>
<p><strong>Java-174 FastFDS 从单机到分布式文件存储：实战与架构取舍</strong>
MyBatis 已完结，Spring 已完结，Nginx已完结，Tomcat已完结，分布式服务已完结，Dubbo已完结，MySQL已完结，MongoDB已完结，Neo4j已完结，FastDFS 正在更新，深入浅出助你打牢基础！</p>
<h3 data-id="heading-22">📊 大数据板块已完成多项干货更新（300篇）：</h3>
<p>包括 Hadoop、Hive、Kafka、Flink、ClickHouse、Elasticsearch 等二十余项核心组件，覆盖离线+实时数仓全栈！
<strong>大数据-278 Spark MLib - 基础介绍 机器学习算法 梯度提升树 GBDT案例 详解</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[实战 LiteLLM 与外部日志系统的集成]]></title>    <link>https://juejin.cn/post/7578003302488096768</link>    <guid>https://juejin.cn/post/7578003302488096768</guid>    <pubDate>2025-12-01T00:46:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578003302488096768" data-draft-id="7577795545440976930" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="实战 LiteLLM 与外部日志系统的集成"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-12-01T00:46:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="日习一技"/> <meta itemprop="url" content="https://juejin.cn/user/3913917125896190"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            实战 LiteLLM 与外部日志系统的集成
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3913917125896190/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    日习一技
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.1 初学乍练
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.1 初学乍练" title="VIP.1 初学乍练" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T00:46:29.000Z" title="Mon Dec 01 2025 00:46:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在前一篇文章中，我们学习了 LiteLLM 的内置日志系统，包括请求日志、会话日志和审核日志。这些日志为我们提供了完整的 API 调用追踪、成本分析和合规审计能力。然而，在企业级部署场景中，我们往往需要将这些宝贵的数据集成到现有的可观测性生态系统中，比如与 Elasticsearch 进行日志分析、通过 Datadog 进行性能监控，或者利用 Langfuse 进行 LLM 专业化的可观测性管理。</p>
<p>LiteLLM 支持与 <strong>30 多种外部日志和可观测性系统</strong> 的集成，包括传统的云存储（S3、GCS、Azure Blob）、专业的可观测性平台（Langfuse、OpenTelemetry、Datadog）、以及企业级的数据分析工具（Elasticsearch、BigQuery、DynamoDB），为我们构建完整的监控和分析体系提供了强有力的支持。</p>
<p>今天这篇文章，我们就来深入学习 LiteLLM 的外部日志集成能力。</p>
<h2 data-id="heading-0">支持的外部日志系统</h2>
<p>LiteLLM 的日志集成能力非常丰富，支持多达 30+ 种不同类型的外部系统：</p>
<p><strong>LLM 专业可观测性平台</strong>：</p>
<ul>
<li><strong>Langfuse</strong> - LLM 专业可观测性平台，提供完整的 LLM 应用监控、分析和优化</li>
<li><strong>Langsmith</strong> - LangChain 官方的 LLM 开发和监控平台，专为 LangChain 生态设计</li>
<li><strong>Lunary</strong> - LLM 监控和分析平台，提供对话流程可视化和性能分析</li>
<li><strong>Langtrace</strong> - LLM 应用的可观测性和监控平台，提供详细的追踪分析</li>
<li><strong>Helicone</strong> - 开源的 LLM 可观测性平台，简化 LLM 应用监控</li>
<li><strong>DeepEval</strong> - Confidential AI 的 LLM 评测平台，专注模型质量评估</li>
<li><strong>Athina</strong> - LLM 应用的质量评估和监控平台，提供实时质量检测</li>
<li><strong>Braintrust</strong> - AI 产品开发平台，提供评估、监控和数据管理</li>
<li><strong>Humanloop</strong> - LLM 应用开发平台，集成提示工程和监控功能</li>
<li><strong>Literal AI</strong> - 对话式 AI 监控平台，专注用户体验优化</li>
<li><strong>Promptlayer</strong> - 提示工程和监控平台，帮助优化 LLM 提示效果</li>
</ul>
<p><strong>通用监控和可观测性平台</strong>：</p>
<ul>
<li><strong>OpenTelemetry</strong> - 开源的可观测性框架，支持分布式追踪和监控</li>
<li><strong>Datadog</strong> - 综合性能监控平台，提供全栈监控和告警能力</li>
<li><strong>Sentry</strong> - 错误监控和性能追踪平台，帮助快速定位应用问题</li>
<li><strong>Logfire</strong> - Pydantic 团队开发的现代可观测性平台</li>
<li><strong>PostHog</strong> - 开源的产品分析平台，提供用户行为跟踪和 A/B 测试</li>
</ul>
<p><strong>机器学习和实验管理</strong>：</p>
<ul>
<li><strong>MLflow</strong> - 机器学习实验管理平台，支持模型版本控制和部署</li>
<li><strong>Arize AI</strong> - 专注于 ML 可观测性的企业级平台，提供模型漂移检测</li>
<li><strong>Arize Phoenix OSS</strong> - Arize 的开源版本，专注 ML 模型监控</li>
<li><strong>Galileo</strong> - AI 模型质量监控平台，专注于数据和模型性能评估</li>
<li><strong>Weights &amp; Biases</strong> - 机器学习实验跟踪和可视化平台</li>
<li><strong>Comet Opik</strong> - 机器学习实验管理和模型监控平台</li>
</ul>
<p><strong>数据标注和质量管理</strong>：</p>
<ul>
<li><strong>Argilla</strong> - 开源数据标注和质量管理平台，支持 LLM 训练数据优化</li>
<li><strong>AgentOps</strong> - AI Agent 运行监控平台，专注 Agent 行为分析</li>
</ul>
<p><strong>使用量计量和费用管理</strong>：</p>
<ul>
<li><strong>OpenMeter</strong> - 开源的使用量计量和计费平台，支持 API 使用监控</li>
<li><strong>Greenscale</strong> - 云成本优化平台，帮助降低 AI 基础设施成本</li>
<li><strong>CloudZero's AnyCost API</strong> - 企业级云成本分析和分配平台</li>
<li><strong>Lago</strong> - 开源计费平台，支持基于使用量的灵活计费模式</li>
</ul>
<p><strong>云存储服务</strong>：</p>
<ul>
<li><strong>AWS S3</strong> - AWS 的对象存储服务，适合大规模日志归档</li>
<li><strong>AWS SQS</strong> - AWS 的消息队列服务，适合实时日志处理</li>
<li><strong>Google Cloud Storage Buckets</strong> - 谷歌云的对象存储服务</li>
<li><strong>Google Cloud Storage PubSub Topic</strong> - 谷歌云的消息队列服务，可以被 BigQuery 消费</li>
<li><strong>Azure Blob Storage</strong> - 微软云的存储解决方案</li>
</ul>
<p><strong>数据库和分析</strong>：</p>
<ul>
<li><strong>Elasticsearch</strong> - 分布式搜索和分析引擎</li>
<li><strong>DynamoDB</strong> - AWS 的 NoSQL 数据库</li>
<li><strong>BigQuery</strong> - 谷歌云的大数据分析平台</li>
<li><strong>Supabase</strong> - Firebase 开源替代</li>
</ul>
<p>下面将以 Langfuse 和 OpenTelemetry 为例，实际体验下集成的详细步骤。</p>
<h2 data-id="heading-1">实战 Langfuse 集成</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Flangfuse.com%2F" target="_blank" title="https://langfuse.com/" ref="nofollow noopener noreferrer">Langfuse</a> 是专为 LLM 应用设计的开源可观测性平台，提供了完整的链路追踪、性能分析、成本监控和质量评估能力。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5037054495744b9093992a3041eae9b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154789&amp;x-signature=V78RAJ0XzH8eSC7mvSIs6UZcqdo%3D" alt="langfuse.png" loading="lazy"/></p>
<p>作为专业的 LLM 可观测性平台，Langfuse 具有以下核心特性：</p>
<ul>
<li><strong>追踪（Tracing）</strong>：记录 LLM 应用的完整执行过程</li>
<li><strong>观测（Observability）</strong>：提供实时的性能监控和可视化</li>
<li><strong>评估（Evaluation）</strong>：支持多种评估指标和人工标注</li>
<li><strong>数据集管理</strong>：管理测试数据和历史记录</li>
<li><strong>成本追踪</strong>：监控 Token 使用和费用</li>
</ul>
<h3 data-id="heading-2">获取 Langfuse 的 API Key</h3>
<p>我们首先访问 Langfuse 官网，注册账号并登录，然后创建一个组织：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3c9ab8ee93114bc28d98669aae126f6a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154789&amp;x-signature=yxjHwdkKGyV67UWMm%2BxxAsnFWG4%3D" alt="langfuse-new-org.png" loading="lazy"/></p>
<p>然后在组织下创建一个项目：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/85a8cf4269ef426e808afea55d176968~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154789&amp;x-signature=N2vGsY0Wcl2Csase8NcfBCEICXA%3D" alt="langfuse-new-project.png" loading="lazy"/></p>
<p>创建成功后，接着为项目创建 API Key：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7fefec17ecdf476ebe9f11acb02d2766~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154789&amp;x-signature=3ou%2B9vdDzzMypC5wvzjnR0aGDR8%3D" alt="langfuse-new-apikey.png" loading="lazy"/></p>
<p>点击创建按钮，获取以下三个重要参数：</p>
<ul>
<li><strong>Public Key</strong>：公开密钥，用于客户端身份验证</li>
<li><strong>Secret Key</strong>：私钥，用于服务端 API 调用</li>
<li><strong>Host</strong>：Langfuse 服务器地址</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa02124b83534151bd1ca24ba3249a61~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154789&amp;x-signature=T0Eif8zp6VLT6WcREcxjoDd9iJA%3D" alt="langfuse-new-apikey-2.png" loading="lazy"/></p>
<blockquote>
<p>Langfuse 是开源项目，我们也可以本地部署它。</p>
</blockquote>
<h3 data-id="heading-3">在 LiteLLM 中配置 Langfuse</h3>
<p>首先安装依赖：</p>
<pre><code class="hljs language-bash" lang="bash">$ pip install langfuse==2.59.7
</code></pre>
<blockquote>
<p>注意，如果使用最近版本的 Langfuse 可能会报错，可以使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.litellm.ai%2Fdocs%2Fobservability%2Flangfuse_otel_integration" target="_blank" title="https://docs.litellm.ai/docs/observability/langfuse_otel_integration" ref="nofollow noopener noreferrer">Langfuse OTEL</a> 集成方案。</p>
</blockquote>
<p>然后配置环境变量：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span> LANGFUSE_PUBLIC_KEY=<span class="hljs-string">"pk_xxx"</span>
<span class="hljs-built_in">export</span> LANGFUSE_SECRET_KEY=<span class="hljs-string">"sk_xxx"</span>
<span class="hljs-built_in">export</span> LANGFUSE_HOST=<span class="hljs-string">"https://cloud.langfuse.com"</span>  <span class="hljs-comment"># 可选，默认为云版本</span>
</code></pre>
<p>接着在 <code>config.yaml</code> 中添加 Langfuse 回调：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">litellm_settings:</span>
  <span class="hljs-attr">success_callback:</span> [<span class="hljs-string">"langfuse"</span>]
  <span class="hljs-attr">failure_callback:</span> [<span class="hljs-string">"langfuse"</span>]
</code></pre>
<p>最后重新启动 LiteLLM 并发送测试请求：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X POST <span class="hljs-string">'http://127.0.0.1:4000/chat/completions'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-1234'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
    "model": "gpt-4o",
    "messages": [{"role": "user", "content": "介绍下 Langfuse"}]
  }'</span>
</code></pre>
<p>进入 Langfuse 的 Trace 页面，应该能看到详细的追踪数据：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b3692cee88e64dff9f885f2880746107~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154789&amp;x-signature=Z4zL8onpj%2FqYea1hyvzskuRfzPE%3D" alt="langfuse-trace.png" loading="lazy"/></p>
<h3 data-id="heading-4">元数据传递</h3>
<p>Langfuse 支持传递丰富的元数据信息，用于更精确的分析：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X POST <span class="hljs-string">'http://127.0.0.1:4000/chat/completions'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-1234'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
    "model": "gpt-4o",
    "messages": [{"role": "user", "content": "介绍下 Langfuse"}],
    "metadata": {
      "generation_name": "knowledge-qa",
      "trace_id": "trace-001",
      "trace_user_id": "user-123",
      "session_id": "session-456"
    }
  }'</span>
</code></pre>
<p>这些元数据在 Langfuse 中显示如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/276da7194dcb4dae9ff5ca7fcbe87f1b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154789&amp;x-signature=P%2FeJprdNHz2WMPqkvP%2FhhMtmIhc%3D" alt="langfuse-trace-metadata.png" loading="lazy"/></p>
<h3 data-id="heading-5">自定义标签</h3>
<p>我们还可以使用标签对不同类型的请求进行分类：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X POST <span class="hljs-string">'http://127.0.0.1:4000/chat/completions'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-1234'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
    "model": "gpt-4o",
    "messages": [{"role": "user", "content": "写一个 Python 函数来计算斐波那契数列"}],
    "metadata": {
      "tags": ["code-generation", "python", "algorithms"]
    }
  }'</span>
</code></pre>
<p>这些标签可以在 Langfuse 的 Tags 一栏看到：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/48beffdee0194d39934fa731c47aec47~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154789&amp;x-signature=8wZRYSBRzQQVX2C%2BJhiapntGyuE%3D" alt="langfuse-trace-tags.png" loading="lazy"/></p>
<blockquote>
<p>注意，这个功能可能和标签路由冲突，如果开启了标签路由，<code>tags</code> 就不能随便传了。</p>
</blockquote>
<p>除了在请求中自定义标签，LiteLLM 也内置了很多特有的字段作为标签，可以在配置文件中启用：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">litellm_settings:</span>
  <span class="hljs-attr">success_callback:</span> [<span class="hljs-string">"langfuse"</span>]
  <span class="hljs-attr">failure_callback:</span> [<span class="hljs-string">"langfuse"</span>]
  <span class="hljs-comment"># 配置要作为标签记录的 LiteLLM 字段</span>
  <span class="hljs-attr">langfuse_default_tags:</span> [
    <span class="hljs-string">"cache_hit"</span>,               <span class="hljs-comment"># 缓存命中状态</span>
    <span class="hljs-string">"cache_key"</span>,               <span class="hljs-comment"># 缓存键</span>
    <span class="hljs-string">"user_api_key_alias"</span>,      <span class="hljs-comment"># 用户API密钥别名</span>
    <span class="hljs-string">"user_api_key_user_id"</span>,    <span class="hljs-comment"># 用户ID</span>
    <span class="hljs-string">"user_api_key_user_email"</span>, <span class="hljs-comment"># 用户邮箱</span>
    <span class="hljs-string">"user_api_key_team_alias"</span>, <span class="hljs-comment"># 团队</span>
  ]
</code></pre>
<p>这样在 Langfuse 中就能看到这些额外的标签信息，方便进行更细粒度的分析:</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/869cdfa923ff4c6a96a05de3b347db64~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154789&amp;x-signature=1h7qPldBCv5vJwuT7%2FA1EwCxtIc%3D" alt="langfuse-trace-litellm-tags.png" loading="lazy"/></p>
<h2 data-id="heading-6">实战 OpenTelemetry + Elasticsearch 集成</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fopentelemetry.io%2Fzh%2F" target="_blank" title="https://opentelemetry.io/zh/" ref="nofollow noopener noreferrer">OpenTelemetry</a> 简称 <strong>OTEL</strong>，是 CNCF 的开源可观测性框架，提供了统一的遥测数据收集标准。它的核心优势在于：</p>
<ul>
<li><strong>标准化</strong>：使用业界标准的遥测数据格式</li>
<li><strong>灵活性</strong>：可以同时导出到多个不同的监控系统</li>
<li><strong>可扩展性</strong>：Collector 可以水平扩展处理大量数据</li>
<li><strong>厂商中立</strong>：不依赖特定的监控平台</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e1294ff58ff4a2ba05d59f6058022a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154789&amp;x-signature=44mIeTDA%2FFpNxKaeeEhdx4n%2BsKA%3D" alt="otel.png" loading="lazy"/></p>
<p>OpenTelemetry 的主要组件包括：</p>
<ul>
<li><strong>SDK</strong>：各种语言的客户端库，负责收集遥测数据</li>
<li><strong>Collector</strong>：数据收集、处理和导出的中间件</li>
<li><strong>Exporter</strong>：将数据导出到不同的后端系统</li>
</ul>
<p>其实现架构如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a592be6fb9ca41669872cc4b624f4db5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154789&amp;x-signature=iOJgCs4FIu1kt3oel2WDXEaEv%2F0%3D" alt="otel-graph.png" loading="lazy"/></p>
<p>结合 <strong>Elasticsearch</strong> 的强大搜索和分析能力，我们可以构建一个企业级的日志分析系统。</p>
<h3 data-id="heading-7">环境搭建</h3>
<p>第一步，创建一个 Docker 网络：</p>
<pre><code class="hljs language-bash" lang="bash">$ docker network create otel-network
</code></pre>
<p>在该网络中启动一个单节点的 Elasticsearch 服务：</p>
<pre><code class="hljs language-bash" lang="bash">$ docker run -d \
  --name elasticsearch \
  --network otel-network \
  -p 9200:9200 \
  -e <span class="hljs-string">"discovery.type=single-node"</span> \
  -e <span class="hljs-string">"xpack.security.enabled=false"</span> \
  elasticsearch:8.18.2
</code></pre>
<p>第二步，创建 <code>otel_config.yaml</code> 配置文件：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">receivers:</span>
  <span class="hljs-attr">otlp:</span>
    <span class="hljs-attr">protocols:</span>
      <span class="hljs-attr">grpc:</span>
        <span class="hljs-attr">endpoint:</span> <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><span class="hljs-string">:4317</span>
      <span class="hljs-attr">http:</span>
        <span class="hljs-attr">endpoint:</span> <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><span class="hljs-string">:4318</span>

<span class="hljs-attr">processors:</span>
  <span class="hljs-attr">batch:</span>
    <span class="hljs-attr">timeout:</span> <span class="hljs-string">1s</span>
    <span class="hljs-attr">send_batch_size:</span> <span class="hljs-number">1024</span>

<span class="hljs-attr">exporters:</span>
  <span class="hljs-attr">debug:</span>
    <span class="hljs-attr">verbosity:</span> <span class="hljs-string">detailed</span>
  <span class="hljs-attr">elasticsearch:</span>
    <span class="hljs-attr">endpoint:</span> <span class="hljs-string">"http://elasticsearch:9200"</span>

<span class="hljs-attr">service:</span>
  <span class="hljs-attr">pipelines:</span>
    <span class="hljs-attr">metrics:</span>
      <span class="hljs-attr">receivers:</span> [<span class="hljs-string">otlp</span>]
      <span class="hljs-attr">exporters:</span> [<span class="hljs-string">debug</span>, <span class="hljs-string">elasticsearch</span>]
    <span class="hljs-attr">traces:</span>
      <span class="hljs-attr">receivers:</span> [<span class="hljs-string">otlp</span>]
      <span class="hljs-attr">exporters:</span> [<span class="hljs-string">debug</span>, <span class="hljs-string">elasticsearch</span>]
    <span class="hljs-attr">logs:</span> 
      <span class="hljs-attr">receivers:</span> [<span class="hljs-string">otlp</span>]
      <span class="hljs-attr">exporters:</span> [<span class="hljs-string">debug</span>, <span class="hljs-string">elasticsearch</span>]
</code></pre>
<p>然后启动 OpenTelemetry Collector 服务，注意它和 Elasticsearch 共用一个网络，确保可以使用 <code>elasticsearch:9200</code> 这个地址访问 Elasticsearch 服务：</p>
<pre><code class="hljs language-bash" lang="bash">$ docker run -d \
  --name otel-collector \
  --network otel-network \
  -p 4317:4317 \
  -p 4318:4318 \
  -v $(<span class="hljs-built_in">pwd</span>)/otel_config.yaml:/etc/otel-collector-config.yaml \
  otel/opentelemetry-collector-contrib:latest \
  --config=/etc/otel-collector-config.yaml
</code></pre>
<p>另一点值得注意的是，这里我使用的是 <a href="https://link.juejin.cn?target=https%3A%2F%2Fhub.docker.com%2Fr%2Fotel%2Fopentelemetry-collector-contrib" target="_blank" title="https://hub.docker.com/r/otel/opentelemetry-collector-contrib" ref="nofollow noopener noreferrer">otel/opentelemetry-collector-contrib</a> 镜像，该镜像包含大量的<strong>接收器</strong>、<strong>导出器</strong>、<strong>处理器</strong>、<strong>连接器</strong> 和其他可选组件，包括我们这里要使用的 <code>elasticsearch</code> 导出器。</p>
<p>第三步，修改 LiteLLM 的配置文件，添加 OTEL 回调：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">litellm_settings:</span>
  <span class="hljs-attr">callbacks:</span> [<span class="hljs-string">"otel"</span>]
</code></pre>
<p>并安装 OTEL 相关的依赖：</p>
<pre><code class="hljs language-bash" lang="bash">$ pip install \
  opentelemetry-api \
  opentelemetry-sdk \
  opentelemetry-exporter-otlp
</code></pre>
<p>然后设置环境变量：</p>
<pre><code class="hljs language-bash" lang="bash">$ <span class="hljs-built_in">export</span> OTEL_EXPORTER=otlp_http
$ <span class="hljs-built_in">export</span> OTEL_EXPORTER_OTLP_ENDPOINT=<span class="hljs-string">"http://localhost:4318"</span>
</code></pre>
<p>重启 LiteLLM 服务：</p>
<pre><code class="hljs language-bash" lang="bash">$ litellm -c config.yaml
</code></pre>
<h3 data-id="heading-8">测试验证</h3>
<p>发送测试请求：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X POST <span class="hljs-string">'http://127.0.0.1:4000/chat/completions'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-1234'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
    "model": "gpt-4o",
    "messages": [{"role": "user", "content": "你好"}]
  }'</span>
</code></pre>
<p>稍等片刻，搜索 Elasticsearch 验证数据是否正确写入：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 搜索最近的一条跟踪数据</span>
$ curl <span class="hljs-string">"localhost:9200/_search?pretty&amp;size=1"</span> | jq <span class="hljs-string">'.'</span>
</code></pre>
<p>如果一切顺利，应该能看到类似这样的 OpenTelemetry 跟踪数据：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"took"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">119</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"timed_out"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"_shards"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"total"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"successful"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"skipped"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"failed"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"hits"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"total"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">15</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"relation"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"eq"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"max_score"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1.0</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"hits"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">".ds-traces-generic.otel-default-2025.11.25-000001"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"AZq5FFC45Ve33J9AiHVu"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"_score"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1.0</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"_source"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"@timestamp"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2137173047.194915"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"data_stream"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"traces"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"dataset"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"generic.otel"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"namespace"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"default"</span>
          <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"af20113fb91ba1e2893b1c0e3a6d20e7"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"span_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"f8b94554ab20692f"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"parent_span_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"f5cf57a86811be6d"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"router"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"kind"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Internal"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">823751</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"attributes"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"call_type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"async_get_available_deployment"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"service"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"router"</span>
          <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"links"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"status"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"code"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Ok"</span>
          <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"resource"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"attributes"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
              <span class="hljs-attr">"telemetry.sdk.language"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"python"</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"telemetry.sdk.name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"opentelemetry"</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"telemetry.sdk.version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.38.0"</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"service.name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"litellm"</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"deployment.environment"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"production"</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"model_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"litellm"</span>
            <span class="hljs-punctuation">}</span>
          <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"scope"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"litellm"</span>
          <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-9">Kibana 可视化</h3>
<p>我们还可以启动 Kibana 进行数据可视化，注意和 Elasticsearch 共用一个网络：</p>
<pre><code class="hljs language-bash" lang="bash">$ docker run -d \
  --name kibana \
  --network otel-network \
  -p 5601:5601 \
  kibana:8.18.2
</code></pre>
<p>访问 <code>http://localhost:5601</code>，进入 <strong>探索（Discover）</strong> 页面，创建一个新的 <strong>数据视图（Data View）</strong>：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3fcf616e6b2241e4b455a0eb4aa808f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154789&amp;x-signature=DI4BMDz3%2BiaZr1lUU4GfFJIb1iM%3D" alt="kibana-create-data-view.png" loading="lazy"/></p>
<p>其中 <strong>索引模式（Index pattern）</strong> 填写 <code>traces-generic.otel-default</code>，OTEL 的 trace 数据默认会写入该 <strong>数据流（Data Stream）</strong> 中。然后选择该视图，就可以看到 LiteLLM 推送过来的日志了：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c545aecba504a3a86ffa672c2dbc237~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765154789&amp;x-signature=ansKBjBwYL%2FFjHkmryvxIgCV8I0%3D" alt="kibana-logs.png" loading="lazy"/></p>
<h2 data-id="heading-10">小结</h2>
<p>今天我们学习了 LiteLLM 与外部日志系统的集成能力，对其中的两种集成方案进行了实战演示：</p>
<ul>
<li><strong>Langfuse 集成</strong>：专业的 LLM 可观测性平台，提供了完整的链路追踪、成本分析和质量评估能力，特别适合需要深度 LLM 应用监控的场景</li>
<li><strong>OpenTelemetry + Elasticsearch 集成</strong>：基于开源标准的企业级日志分析方案，利用 OTEL 的标准化数据收集和 Elasticsearch 的强大搜索分析能力</li>
</ul>
<p>除了本文介绍的这两种方案，LiteLLM 还支持 30 多种其他日志系统的集成，具体内容可参考官方文档：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.litellm.ai%2Fdocs%2Fproxy%2Flogging" target="_blank" title="https://docs.litellm.ai/docs/proxy/logging" ref="nofollow noopener noreferrer">docs.litellm.ai/docs/proxy/…</a></li>
</ul>
<p>通过统一的回调机制和标准化的日志格式，我们可以将 LiteLLM 的日志数据与现有的可观测性生态系统无缝整合，实现全面的性能监控、成本优化和问题诊断。</p>
<h2 data-id="heading-11">欢迎关注</h2>
<p>如果这篇文章对您有所帮助，欢迎关注我的同名公众号：<a href="https://link.juejin.cn?target=https%3A%2F%2Fi-study-everyday.online%2Fabout-me.html" target="_blank" title="https://i-study-everyday.online/about-me.html" ref="nofollow noopener noreferrer">日习一技，每天学一点新技术</a>。</p>
<p>我会每天花一个小时，记录下我学习的点点滴滴。内容包括但不限于：</p>
<ul>
<li>某个产品的使用小窍门</li>
<li>开源项目的实践和心得</li>
<li>技术点的简单解读</li>
</ul>
<p>目标是让大家用5分钟读完就能有所收获，不需要太费劲，但却可以轻松获取一些干货。不管你是技术新手还是老鸟，欢迎给我提建议，如果有想学习的技术，也欢迎交流！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[栗子前端技术周刊第 108 期 - npm 沙虫攻击 2.0、Ant Design 6.0、Playwright 1.57...]]></title>    <link>https://juejin.cn/post/7578177007575121974</link>    <guid>https://juejin.cn/post/7578177007575121974</guid>    <pubDate>2025-12-01T00:51:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578177007575121974" data-draft-id="7577704980855799862" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="栗子前端技术周刊第 108 期 - npm 沙虫攻击 2.0、Ant Design 6.0、Playwright 1.57..."/> <meta itemprop="keywords" content="前端,JavaScript,CSS"/> <meta itemprop="datePublished" content="2025-12-01T00:51:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="晓得迷路了"/> <meta itemprop="url" content="https://juejin.cn/user/2172290706715565"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            栗子前端技术周刊第 108 期 - npm 沙虫攻击 2.0、Ant Design 6.0、Playwright 1.57...
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2172290706715565/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    晓得迷路了
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T00:51:05.000Z" title="Mon Dec 01 2025 00:51:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>🌰<strong>栗子前端技术周刊第 108 期 (2025.11.24 - 2025.11.30)</strong>：浏览前端一周最新消息，学习国内外优秀文章视频，让我们保持对前端的好奇心。</p>
<h2 data-id="heading-0">📰 技术资讯</h2>
<ol>
<li>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fsocket.dev%2Fblog%2Fshai-hulud-strikes-again-v2" target="_blank" title="https://socket.dev/blog/shai-hulud-strikes-again-v2" ref="nofollow noopener noreferrer">npm 沙虫攻击 2.0</a></strong>：当前 npm 生态系统正遭遇新一轮“沙虫（Shai Hulud）”攻击，受影响软件包的安装后脚本会窃取令牌，同时还会感染并重新发布其他软件包。</p>
</li>
<li>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fant-design%2Fant-design%2Fissues%2F55805" target="_blank" title="https://github.com/ant-design/ant-design/issues/55805" ref="nofollow noopener noreferrer">Ant Design 6.0</a></strong>：antd 6.0 发布，该版本承诺为 5.0 版本用户提供顺畅的迁移体验，无需任何代码转换工具（codemods），且该版本的核心发力点集中在深度优化与 React 19 兼容性适配两大方向。</p>
</li>
<li>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmicrosoft%2Fplaywright%2Freleases%2Ftag%2Fv1.57.0" target="_blank" title="https://github.com/microsoft/playwright/releases/tag/v1.57.0" ref="nofollow noopener noreferrer">Playwright 1.57</a></strong>：微软浏览器自动化框架发布 1.57 版本，其 HTML 报告中新增了“速度面板”标签页，可按测试耗时排序展示结果；同时，该工具的底层浏览器也从 Chromium 切换为 Chrome for Testing（测试专用版 Chrome）。</p>
</li>
<li>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fbun.sh%2Fblog%2Fbun-v1.3.3" target="_blank" title="https://bun.sh/blog/bun-v1.3.3" ref="nofollow noopener noreferrer">Bun v1.3.3</a></strong>：Bun 1.3.3 发布，更新内容包括：新增了 CompressionStream（压缩流）与 DecompressionStream（解压缩流）功能、将 SQLite 升级至 3.51.0 版本、并包含其他小幅功能优化。</p>
</li>
</ol>
<h2 data-id="heading-1">📒 技术文章</h2>
<ol>
<li>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftrekhleb%2Fjavascript-algorithms" target="_blank" title="https://github.com/trekhleb/javascript-algorithms" ref="nofollow noopener noreferrer">Over 150 Algorithms and Data Structures Demonstrated in JS</a></strong>：超过 150 种算法与数据结构的 JavaScript 实现示例 - 包含众多常见算法（如位运算、帕斯卡三角形、汉明距离）和数据结构（如链表、前缀树、图）的示例及解析。</p>
</li>
<li>
<p><strong><a href="https://juejin.cn/post/7576608733612425242" target="_blank" title="https://juejin.cn/post/7576608733612425242">一种新HTML页面转换成 PDF 技术方案</a></strong>：本文将深入讲解如何使用 snapdom 和 jsPDF 实现高质量的 HTML 转 PDF 功能，并通过一个完整的消息列表导出案例，带你掌握这套方案的核心技术。</p>
</li>
<li>
<p><strong><a href="https://juejin.cn/post/7577298871005036578" target="_blank" title="https://juejin.cn/post/7577298871005036578">图片标签用 img 还是 picture？</a></strong>：在网页开发中，图片处理是每个前端开发者都会遇到的基础任务。面对 <code>&lt;img&gt;</code> 和 <code>&lt;picture&gt;</code> 这两个标签，很多人存在误解：要么认为它们是互相替代的关系，要么在不合适的场景下使用了复杂的解决方案。今天，作者将在文中来彻底理清这两个标签的真正用途。</p>
</li>
</ol>
<h2 data-id="heading-2">🔧 开发工具</h2>
<ol>
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Finfinitered%2Fgluegun" target="_blank" title="https://github.com/infinitered/gluegun" ref="nofollow noopener noreferrer">Gluegun</a></strong>：用于开发 Node 命令行界面应用，其内置诸多功能，包括模板生成、子命令支持、彩色输出、参数解析等。</li>
</ol>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e0074eb02efa4e8bae3f4f44b9948708~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pmT5b6X6L-36Lev5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765155065&amp;x-signature=zROxaHhlZX72TfYnJ3%2FaKwIncnA%3D" width="100%" alt="image-20251130083726552" loading="lazy"/>
<ol start="2">
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fdriverjs.com%2F" target="_blank" title="https://driverjs.com/" ref="nofollow noopener noreferrer">Driver.js v1.4</a></strong>：这是一个原生 JS 库，用于创建页面引导和情境化帮助功能。该库已推出数年，但至今仍在维护更新，且提供了大量示例可供参考，同时使用体验十分流畅。</li>
</ol>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/140f300ae821429d9271e05825660360~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pmT5b6X6L-36Lev5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765155065&amp;x-signature=WEVwUoRpSL%2BwCrqGw07CbasS1G8%3D" width="100%" alt="image-20251130084036418" loading="lazy"/>
<ol start="3">
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.william-troup.com%2Fheat-js%2F" target="_blank" title="https://www.william-troup.com/heat-js/" ref="nofollow noopener noreferrer">Heat.js 4.5</a></strong>：热力图可视化库，无依赖项、体积小巧、支持响应式布局，且可自定义主题。</li>
</ol>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/22f17d4f87b94d61aa3289d68f25f62c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pmT5b6X6L-36Lev5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765155065&amp;x-signature=qLTeu1OUrzhgnb4vWeOXExJIDRM%3D" width="100%" alt="image-20251130084825820" loading="lazy"/>
<p>🚀🚀🚀 <em>以上资讯文章选自常见周刊，如 JavaScript Weekly 等，周刊内容也会不断优化改进，希望你们能够喜欢。</em></p>
<p>💖 <strong>欢迎关注微信公众号：栗子前端</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[在Go中读取MySQL Date类型，一不小心就踩坑]]></title>    <link>https://juejin.cn/post/7577914902431825966</link>    <guid>https://juejin.cn/post/7577914902431825966</guid>    <pubDate>2025-12-01T00:52:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577914902431825966" data-draft-id="7577683422878941218" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="在Go中读取MySQL Date类型，一不小心就踩坑"/> <meta itemprop="keywords" content="Go,MySQL,面试"/> <meta itemprop="datePublished" content="2025-12-01T00:52:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="凉凉的知识库"/> <meta itemprop="url" content="https://juejin.cn/user/3280598428311326"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            在Go中读取MySQL Date类型，一不小心就踩坑
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3280598428311326/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    凉凉的知识库
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T00:52:31.000Z" title="Mon Dec 01 2025 00:52:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h3 data-id="heading-0">一不小心就踩坑</h3>
<p>先举一个实际的🌰：</p>
<p>我们先创建一个表，并插入一行数据。注意表中两个字段一个是<code>DATETIME</code>类型，一个是<code>DATE</code>类型的</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `t_test` (
  `id` <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,
  `f_one` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,
  `f_two` <span class="hljs-type">date</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,
  <span class="hljs-keyword">PRIMARY</span> KEY (`id`)
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 <span class="hljs-keyword">COLLATE</span><span class="hljs-operator">=</span>utf8mb4_0900_ai_ci;

<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `test`.`t_test` (`f_one`, `f_two`) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'2025-11-29 10:25:05'</span>, <span class="hljs-string">'2025-11-29'</span>);
</code></pre>
<p>当我们查询数据可以看到和插入的数据一致</p>
<ul>
<li><code>f_one datetime</code>展示为<code>2025-11-29 10:25:05</code></li>
<li><code>f_two date</code>展示为<code>2025-11-29</code></li>
</ul>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">mysql&gt; </span><span class="bash">select * from t_test <span class="hljs-built_in">where</span> <span class="hljs-built_in">id</span> = 1;</span>
+----+---------------------+------------+
| id | f_one               | f_two      |
+----+---------------------+------------+
|  1 | 2025-11-29 10:25:05 | 2025-11-29 |
+----+---------------------+------------+
1 row in set (0.003 sec)
</code></pre>
<p>现在使用Go来读取上面的数据</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"testing"</span>

	<span class="hljs-string">"github.com/stretchr/testify/assert"</span>
	<span class="hljs-string">"gorm.io/driver/mysql"</span>
	<span class="hljs-string">"gorm.io/gorm"</span>
)

<span class="hljs-keyword">type</span> Test <span class="hljs-keyword">struct</span> {
	ID   <span class="hljs-type">int</span>    <span class="hljs-string">`gorm:"column:id;primaryKey"`</span>
	FOne <span class="hljs-type">string</span> <span class="hljs-string">`gorm:"column:f_one"`</span> <span class="hljs-comment">// 注意这里我们定义成了string类型</span>
	FTwo <span class="hljs-type">string</span> <span class="hljs-string">`gorm:"column:f_two"`</span> <span class="hljs-comment">// 注意这里我们定义成了string类型</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(t Test)</span></span> TableName() <span class="hljs-type">string</span> {
	<span class="hljs-keyword">return</span> <span class="hljs-string">"t_test"</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestRead</span><span class="hljs-params">(t *testing.T)</span></span> {
	<span class="hljs-comment">// 数据库连接配置</span>
	dsn := <span class="hljs-string">"root:root@tcp(127.0.0.1:3306)/test?charset=utf8mb4&amp;parseTime=True&amp;loc=Local"</span>

	db, err := gorm.Open(mysql.Open(dsn))
	assert.Nil(t, err)

	<span class="hljs-keyword">var</span> result Test
	err = db.Where(<span class="hljs-string">"id = ?"</span>, <span class="hljs-number">1</span>).Find(&amp;result).Error
	assert.Nil(t, err)

	assert.Equal(t, <span class="hljs-string">"2025-11-29 10:25:05"</span>, result.FOne)
	assert.Equal(t, <span class="hljs-string">"2025-11-29"</span>, result.FTwo)
}
</code></pre>
<p>可以在这里暂停思考下，上面的单元测试是否会通过。下面是实际执行的结果。</p>
<pre><code class="hljs language-shell" lang="shell">Error: Not equal: 
       expected: "2025-11-29 10:25:05"
       actual  : "2025-11-29T10:25:05+08:00"

Error: Not equal: 
       expected: "2025-11-29"
       actual  : "2025-11-29T00:00:00+08:00"
</code></pre>
<p>结果非常Amazing啊</p>
<p><code>f_one</code>我们期望的是<code>2025-11-29 10:25:05</code>，实际Go读取到是 <code>2025-11-29T10:25:05+08:00</code>，额外添加了T分隔符和时区信息</p>
<p><code>f_two</code>我们期望的是<code>2025-11-29</code>， 实际Go读取到是 <code>2025-11-29T00:00:00+08:00</code>，不仅额外添加了T分隔符和时区信息，还添加了时分秒</p>
<p>你看，如果你对Go读取到字符串按MySQL时间格式处理，可能一不注意就踩坑里了。</p>
<h3 data-id="heading-1">问题出在哪里？</h3>
<p>你可能已经注意到了，Go结构体的定义使用了<code>string</code>类型，但不知道你有没有注意到数据库连接中的另外一个参数<code>parseTime=True</code>。</p>
<p><code>parseTime</code>是什么？<code>parseTime</code>是 Go 的 MySQL 驱动 (<code>github.com/go-sql-driver/mysql</code>) 中的一个连接参数，控制是否将 MySQL 时间类型自动转换为 Go 的 <code>time.Time</code>对象：</p>
<ul>
<li><code>parseTime=false</code> 禁用自动转换（默认值）</li>
<li><code>parseTime=true</code> 启用自动转换</li>
</ul>
<p>当Go的定义为<code>string</code>类型时，问题就出在自动转换上</p>
<p><code>parseTime=false</code>时， 转化方式为<code>DATETIME/DATE(MySQL)</code>-&gt;<code>string(Go)</code> ，不会出现上面的问题，Go中读取到的字符串和MySQL的格式一致：<code>2025-11-29 10:25:05</code>和<code>2025-11-29</code></p>
<p><code>parseTime=true</code>时，Go的MySQL驱动首先尝试将 MySQL的 <code>DATETIME/DATE(MySQL)</code>解析为 Go 的 <code>time.Time</code>对象，当发现目标字段是 <code>string</code>类型时，驱动会自动调用 <code>time.Time</code>的 <code>String()</code>方法进行转换，<code>time.String()</code>按照RFC3339格式输出，与MySQL中展示的格式不一致，就形成了上文的效果。也就是说</p>
<pre><code class="hljs language-go" lang="go"># 开启parseTime=<span class="hljs-literal">true</span>且Go类型定义为<span class="hljs-type">string</span>时

<span class="hljs-string">`DATETIME(MySQL)`</span> 
      |
      v
<span class="hljs-string">`time.Time`</span>(golang) 
      |
      | -&gt;这里的<span class="hljs-string">`time.time`</span>到<span class="hljs-string">`string`</span>这一步出现了转化差异
      v
<span class="hljs-string">`string(golang)`</span>          
</code></pre>
<h3 data-id="heading-2"><strong>总结</strong></h3>
<p>下面总结不同<code>parseTime</code>和Go类型定义的情况下，Go程序读取到的值。</p>




















<table><thead><tr><th>Go字段类型定义</th><th>parseTime=false</th><th>parseTime=true</th></tr></thead><tbody><tr><td><code>string</code></td><td><code>YYYY-MM-DD[ HH:MM:SS[.fraction]]</code><br/>即：<br/><code>DATE</code>-&gt;<code>YYYY-MM-DD</code><br/><code>DATETIME</code>-&gt;<code>YYYY-MM-DD HH:MM:SS</code><br/><code>DATETIME(3)</code>-&gt;<code>YYYY-MM-DD HH:MM:SS.sss</code><br/><code>DATETIME(6)</code>-&gt;<code>YYYY-MM-DD HH:MM:SS.ssssss</code><br/>零值-&gt;<code>0000-00-00[ 00:00:00]</code><br/><br/>此时Go中时间字符串的格式和MySQL默认格式一致</td><td>RFC3339<br/><code>YYYY-MM-DDTHH:MM:SS±HH:MM</code><br/><br/>此时Go中时间字符串的格式和MySQL默认格式不一致！！</td></tr><tr><td><code>time.Time</code></td><td>报错 (类型不兼容)</td><td>Go<code>time.Time</code>实例<br/>如果零值也是零值<code>time.Time</code>实例</td></tr></tbody></table>
<p>由此也引出了比较合理的使用姿势</p>
<ul>
<li>如果启用了<code>parseTime=true</code>，我建议你在Go中定义成<code>time.Time</code>类型</li>
</ul>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> Test <span class="hljs-keyword">struct</span> {
	ID   <span class="hljs-type">int</span>       <span class="hljs-string">`gorm:"column:id;primaryKey"`</span>
	FOne time.Time <span class="hljs-string">`gorm:"column:f_one"`</span>
	FTwo time.Time <span class="hljs-string">`gorm:"column:f_two"`</span>
}
</code></pre>
<ul>
<li>如果没有启用，即<code>parseTime=false</code>，在Go只能定义成<code>string</code></li>
</ul>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> Test <span class="hljs-keyword">struct</span> {
	ID   <span class="hljs-type">int</span>    <span class="hljs-string">`gorm:"column:id;primaryKey"`</span>
	FOne <span class="hljs-type">string</span> <span class="hljs-string">`gorm:"column:f_one"`</span>
	FTwo <span class="hljs-type">string</span> <span class="hljs-string">`gorm:"column:f_two"`</span>
}
</code></pre>
<hr/>
<p>✨ 微信公众号【<strong>凉凉的知识库</strong>】同步更新，欢迎关注获取最新最有用的知识 ✨</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[不再害怕数学，给开发者的 AI 向量 (Vector) 入门课，看完秒懂！]]></title>    <link>https://juejin.cn/post/7577795545441009698</link>    <guid>https://juejin.cn/post/7577795545441009698</guid>    <pubDate>2025-12-01T00:56:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577795545441009698" data-draft-id="7578029371007025192" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="不再害怕数学，给开发者的 AI 向量 (Vector) 入门课，看完秒懂！"/> <meta itemprop="keywords" content="人工智能,LLM"/> <meta itemprop="datePublished" content="2025-12-01T00:56:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="印刻君"/> <meta itemprop="url" content="https://juejin.cn/user/572216818014568"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            不再害怕数学，给开发者的 AI 向量 (Vector) 入门课，看完秒懂！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/572216818014568/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    印刻君
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T00:56:50.000Z" title="Mon Dec 01 2025 00:56:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近在学习 AI (尤其是大模型和 RAG) 的过程中, 我发现 <strong>向量 (Vector)</strong> 是理解这一切的基础</p>
<p>为了帮助大家跨越数学门槛, 我整理了这份指南, 尝试把抽象的数学概念与 AI 的实际应用结合起来, 带你从底层逻辑理解 AI 是如何"思考"的</p>
<p>我是印刻君，一位探索 AI 的程序员，关注我，了解更多有温度的轻知识，有深度的硬内容</p>
<h2 data-id="heading-0">第一部分: 向量的基础认知</h2>
<h3 data-id="heading-1">1. 什么是向量?</h3>
<p>在数学和物理学中, 我们通常将"量"分为两类:</p>
<ul>
<li><strong>标量 (Scalar)</strong>: 只有<strong>大小</strong>, 没有方向
<ul>
<li>例子: 今天的气温是 25 摄氏度；我的体重是 60 公斤</li>
</ul>
</li>
<li><strong>向量 (Vector)</strong>: 既有<strong>大小</strong>又有<strong>方向</strong>
<ul>
<li>例子: 北风 4 级(风速是大小, 北方是方向)；向东走 500 米(500 米是大小, 向东是方向)</li>
</ul>
</li>
</ul>
<p><strong>🤔 为什么 AI 需要使用向量, 而且是高维向量?</strong></p>
<p>现实世界极其复杂, 单一的数字(标量)往往无法完整描述一个事物</p>
<p>如果说二维向量让我们能够同时描述"大小"和"方向", 那么<strong>高维向量</strong>则赋予了我们精确描述事物<strong>成百上千种特征</strong>的能力</p>
<p>在计算机科学中, 向量的每一个维度都可以被理解为一种<strong>特征 (Feature)</strong></p>
<p>所谓高维向量, 本质上就是多种特征的组合：</p>
<p>举个例子, 要描述一个"苹果", 光说"甜度 5"是不够的如果我们构建一个特征向量  <code>(颜色, 甜度, 脆度)</code>, 例如 <code>(0.9, 5, 8)</code>, AI 就能精准知道: "这是一个颜色很红、中等甜度、非常脆的苹果"</p>
<p>当维度扩展到成百上千维时, AI 就能捕捉到人类语言中极其微妙的语义差别</p>
<h3 data-id="heading-2">2. 向量的表示: 从图像到坐标</h3>
<p>在几何意义上, 二维向量通常表示为一个<strong>带箭头的线段</strong>:</p>
<ul>
<li><strong>箭头的指向</strong>: 代表方向</li>
<li><strong>线段的长度</strong>: 代表大小(模)</li>
</ul>
<p>如下图所示, 这是一个从 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">A(0, 0)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">0</span><span class="mclose">)</span></span></span></span></span> 点指向 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mo stretchy="false">(</mo><mn>3</mn><mo separator="true">,</mo><mn>4</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">B(3, 4)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mopen">(</span><span class="mord">3</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">4</span><span class="mclose">)</span></span></span></span></span> 点的向量:</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1477dd81e0e04075bb9340bdcbfba3bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2w5Yi75ZCb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765155409&amp;x-signature=IayH3wtBp37hWF7NkDMKVCrZO4o%3D" alt="image.png" loading="lazy"/></p>
<p><strong>💻 为什么计算机里只存坐标 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x, y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span></span>?</strong></p>
<p>你可能会问: "向量不是要有起点和终点吗?为什么代码里通常只写 <code>[0.12, 0.88]</code> 这种数组?"</p>
<p>这是因为在计算机处理中, 为了统一标准, 我们通常使用<strong>位置向量 (Position Vector)</strong> —— <strong>将所有向量的起点都固定在坐标原点 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(0, 0)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">0</span><span class="mclose">)</span></span></span></span></span></strong></p>
<p>既然起点是固定的, 我们只需要记录<strong>终点</strong>的坐标, 就等同于确定了整个向量</p>
<p><strong>转换公式</strong>:
如果一个向量是从任意点 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">A(x_1, y_1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)</span></span></span></span></span> 指向 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">B(x_2, y_2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>, 我们可以通过"终点减起点"将其转换为标准位置向量:</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mrow><mi>A</mi><mi>B</mi></mrow><mo>⃗</mo></mover><mo>=</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mn>2</mn></msub><mo>−</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>2</mn></msub><mo>−</mo><msub><mi>y</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\vec{AB} = (x_2 - x_1, y_2 - y_1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9663em;"/><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9663em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5&#10;3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11&#10;10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63&#10;-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1&#10;-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59&#10;H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359&#10;c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p>
<h2 data-id="heading-3">第二部分: 向量的加减与模</h2>
<p>理解了向量的表示后, 我们来看看向量的基本运算, 以及它们在 AI 语义理解中的核心作用</p>
<h3 data-id="heading-4">1. 加法与减法: 语义的推演</h3>
<p>向量的加减法遵循对应分量相加减的规则:</p>
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mo>+</mo><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mo>=</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>1</mn></msub><mo>+</mo><msub><mi>y</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\vec{a} + \vec{b} = (x_1+x_2, y_1+y_2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7973em;vertical-align:-0.0833em;"/><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal">a</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5&#10;3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11&#10;10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63&#10;-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1&#10;-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59&#10;H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359&#10;c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.9774em;"/><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9774em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal">b</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5&#10;3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11&#10;10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63&#10;-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1&#10;-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59&#10;H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359&#10;c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mo>−</mo><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mo>=</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo>−</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>1</mn></msub><mo>−</mo><msub><mi>y</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\vec{a} - \vec{b} = (x_1-x_2, y_1-y_2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7973em;vertical-align:-0.0833em;"/><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal">a</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5&#10;3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11&#10;10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63&#10;-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1&#10;-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59&#10;H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359&#10;c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.9774em;"/><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9774em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal">b</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5&#10;3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11&#10;10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63&#10;-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1&#10;-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59&#10;H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359&#10;c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></li>
</ul>
<p>在几何上, 这遵循"平行四边形法则”或"三角形法则"</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/30e9849141f144e0879891c9a622606d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2w5Yi75ZCb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765155409&amp;x-signature=BDFLUFaWpH7joOhtIP3LC%2Ftjxo4%3D" alt="image.png" loading="lazy"/></p>
<p><strong>💡 AI 案例: 词向量的加减运算</strong></p>
<p>向量加减法, 本质上就是<strong>特征的叠加或抵消</strong></p>
<ul>
<li><strong>加法</strong>: 把两个概念融合</li>
<li><strong>减法</strong>: 把某个特征去掉</li>
</ul>
<p>经典的例子是: <code>王子 - 男人 + 女人 = ?</code></p>
<p>为了便于理解, 假设我们的词向量只有两个维度(实际上通常几百维或更多):</p>
<ul>
<li><strong>x 轴</strong>代表性别(数值越大越女性化)</li>
<li><strong>y 轴</strong>代表地位(数值越大越尊贵)</li>
</ul>
<p>我们定义以下坐标:</p>
<ul>
<li><strong>王子</strong>: <code>(1, 9)</code>  [男性, 尊贵]</li>
<li><strong>男人</strong>: <code>(1, 1)</code>  [男性, 普通]</li>
<li><strong>女人</strong>: <code>(9, 1)</code>  [女性, 普通]</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/41a0730acd3c4a79bd785172f73568b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2w5Yi75ZCb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765155409&amp;x-signature=BC7aX16AqIWPuqld%2FKNBgvaoJGg%3D" alt="image.png" loading="lazy"/></p>
<p>现在进行运算:</p>
<ol>
<li><code>王子 - 男人</code>: <code>(1, 9) - (1, 1) = (0, 8)</code>这一步去除了"男性"属性, 保留了"尊贵"属性(即纯粹的"皇室地位"概念)</li>
<li><code>+ 女人</code>: <code>(0, 8) + (9, 1) = (9, 9)</code>将"女性"属性叠加到"皇室地位"上</li>
</ol>
<p>结果 <code>(9, 9)</code> 对应的是 <strong>[女性, 尊贵]</strong>, 在向量空间中, 这个坐标最接近的词就是 <strong>公主</strong></p>
<p>这就是大语言模型理解"语义"的基础逻辑: 通过向量空间中的位置关系, 来表征词与词之间的逻辑关联</p>
<h3 data-id="heading-5">2. 向量的模(Magnitude / Length)</h3>
<p>向量的<strong>模</strong>(也叫长度)是一个标量, 表示向量的大小通常记作 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∣</mi><mover accent="true"><mi>v</mi><mo>⃗</mo></mover><mi mathvariant="normal">∣</mi></mrow><annotation encoding="application/x-tex">|\vec{v}|</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">∣</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.2077em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5&#10;3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11&#10;10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63&#10;-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1&#10;-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59&#10;H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359&#10;c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mord">∣</span></span></span></span></span> 或 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mover accent="true"><mi>v</mi><mo>⃗</mo></mover><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi></mrow><annotation encoding="application/x-tex">||\vec{v}||</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">∣∣</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.2077em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5&#10;3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11&#10;10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63&#10;-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1&#10;-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59&#10;H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359&#10;c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mord">∣∣</span></span></span></span></span></p>
<p>根据初中学的勾股定理, 二维向量 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x, y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span></span> 的模为:</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∣</mi><mover accent="true"><mi>v</mi><mo>⃗</mo></mover><mi mathvariant="normal">∣</mi><mo>=</mo><msqrt><mrow><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><msup><mi>y</mi><mn>2</mn></msup></mrow></msqrt></mrow><annotation encoding="application/x-tex">|\vec{v}| = \sqrt{x^2 + y^2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">∣</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.2077em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5&#10;3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11&#10;10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63&#10;-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1&#10;-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59&#10;H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359&#10;c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mord">∣</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.24em;vertical-align:-0.2822em;"/><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9578em;"><span class="svg-align" style="top:-3.2em;"><span class="pstrut" style="height:3.2em;"/><span class="mord" style="padding-left:1em;"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-2.9178em;"><span class="pstrut" style="height:3.2em;"/><span class="hide-tail" style="min-width:1.02em;height:1.28em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.28em" viewbox="0 0 400000 1296" preserveaspectratio="xMinYMin slice"><path d="M263,681c0.7,0,18,39.7,52,119&#10;c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120&#10;c340,-704.7,510.7,-1060.3,512,-1067&#10;l0 -0&#10;c4.7,-7.3,11,-11,19,-11&#10;H40000v40H1012.3&#10;s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232&#10;c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1&#10;s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26&#10;c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z&#10;M1001 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2822em;"><span/></span></span></span></span></span></span></span></span></p>
<p><strong>举个例子</strong>:</p>
<p>如果向量 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>v</mi><mo>⃗</mo></mover><mo>=</mo><mo stretchy="false">(</mo><mn>3</mn><mo separator="true">,</mo><mn>4</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\vec{v} = (3, 4)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.714em;"/><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.2077em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5&#10;3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11&#10;10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63&#10;-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1&#10;-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59&#10;H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359&#10;c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord">3</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">4</span><span class="mclose">)</span></span></span></span></span>, 那么它的模就是:</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∣</mi><mover accent="true"><mi>v</mi><mo>⃗</mo></mover><mi mathvariant="normal">∣</mi><mo>=</mo><msqrt><mrow><msup><mn>3</mn><mn>2</mn></msup><mo>+</mo><msup><mn>4</mn><mn>2</mn></msup></mrow></msqrt><mo>=</mo><msqrt><mrow><mn>9</mn><mo>+</mo><mn>16</mn></mrow></msqrt><mo>=</mo><msqrt><mn>25</mn></msqrt><mo>=</mo><mn>5</mn></mrow><annotation encoding="application/x-tex">|\vec{v}| = \sqrt{3^2 + 4^2} = \sqrt{9 + 16} = \sqrt{25} = 5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">∣</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.2077em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5&#10;3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11&#10;10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63&#10;-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1&#10;-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59&#10;H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359&#10;c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mord">∣</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.04em;vertical-align:-0.1266em;"/><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9134em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord" style="padding-left:0.833em;"><span class="mord"><span class="mord">3</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord"><span class="mord">4</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-2.8734em;"><span class="pstrut" style="height:3em;"/><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewbox="0 0 400000 1080" preserveaspectratio="xMinYMin slice"><path d="M95,702&#10;c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14&#10;c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54&#10;c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10&#10;s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429&#10;c69,-144,104.5,-217.7,106.5,-221&#10;l0 -0&#10;c5.3,-9.3,12,-14,20,-14&#10;H400000v40H845.2724&#10;s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7&#10;c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z&#10;M834 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1266em;"><span/></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.04em;vertical-align:-0.1744em;"/><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8656em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord" style="padding-left:0.833em;"><span class="mord">9</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord">16</span></span></span><span style="top:-2.8256em;"><span class="pstrut" style="height:3em;"/><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewbox="0 0 400000 1080" preserveaspectratio="xMinYMin slice"><path d="M95,702&#10;c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14&#10;c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54&#10;c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10&#10;s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429&#10;c69,-144,104.5,-217.7,106.5,-221&#10;l0 -0&#10;c5.3,-9.3,12,-14,20,-14&#10;H400000v40H845.2724&#10;s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7&#10;c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z&#10;M834 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1744em;"><span/></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.04em;vertical-align:-0.1328em;"/><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9072em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord" style="padding-left:0.833em;"><span class="mord">25</span></span></span><span style="top:-2.8672em;"><span class="pstrut" style="height:3em;"/><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewbox="0 0 400000 1080" preserveaspectratio="xMinYMin slice"><path d="M95,702&#10;c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14&#10;c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54&#10;c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10&#10;s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429&#10;c69,-144,104.5,-217.7,106.5,-221&#10;l0 -0&#10;c5.3,-9.3,12,-14,20,-14&#10;H400000v40H845.2724&#10;s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7&#10;c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z&#10;M834 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1328em;"><span/></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">5</span></span></span></span></span></p>
<p><strong>💡 AI 案例: 模的作用</strong></p>
<p><strong>归一化 (Normalization)</strong>: 在 AI 应用中, 有时我们只关心向量的方向(代表内容主题), 而不关心其长度(代表文本长短或词频)此时, 我们会将向量除以它的模, 使其变为<strong>单位向量</strong>(长度为 1)这样做可以消除文本长度对相似度计算的影响</p>
<h2 data-id="heading-6">第三部分: 衡量向量间的关系(相似度)</h2>
<p>在 AI 中, 判断两个对象(文本、图片)是否相似, 本质上就是计算它们对应向量之间的距离或夹角</p>
<h3 data-id="heading-7">1. 点乘 (Dot Product)</h3>
<p>点乘是计算相似度的数学基础, 其结果是一个<strong>标量</strong></p>
<ul>
<li><strong>代数定义</strong>: 对应分量相乘再求和
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mo>⋅</mo><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mo>=</mo><msub><mi>x</mi><mn>1</mn></msub><msub><mi>x</mi><mn>2</mn></msub><mo>+</mo><msub><mi>y</mi><mn>1</mn></msub><msub><mi>y</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">\vec{a} \cdot \vec{b} = x_1x_2 + y_1y_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.714em;"/><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal">a</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5&#10;3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11&#10;10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63&#10;-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1&#10;-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59&#10;H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359&#10;c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.9774em;"/><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9774em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal">b</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5&#10;3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11&#10;10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63&#10;-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1&#10;-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59&#10;H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359&#10;c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span></li>
<li><strong>几何定义</strong>:
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mo>⋅</mo><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mo>=</mo><mi mathvariant="normal">∣</mi><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mi mathvariant="normal">∣</mi><mo>×</mo><mi mathvariant="normal">∣</mi><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mi mathvariant="normal">∣</mi><mo>×</mo><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\vec{a} \cdot \vec{b} = |\vec{a}| \times |\vec{b}| \times \cos(\theta)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.714em;"/><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal">a</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5&#10;3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11&#10;10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63&#10;-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1&#10;-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59&#10;H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359&#10;c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.9774em;"/><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9774em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal">b</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5&#10;3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11&#10;10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63&#10;-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1&#10;-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59&#10;H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359&#10;c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">∣</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal">a</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5&#10;3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11&#10;10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63&#10;-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1&#10;-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59&#10;H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359&#10;c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mord">∣</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.2274em;vertical-align:-0.25em;"/><span class="mord">∣</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9774em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal">b</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5&#10;3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11&#10;10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63&#10;-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1&#10;-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59&#10;H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359&#10;c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mord">∣</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mop">cos</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span></span></span></span></span>
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∣</mi><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mi mathvariant="normal">∣</mi></mrow><annotation encoding="application/x-tex">|\vec{a}|</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">∣</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal">a</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5&#10;3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11&#10;10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63&#10;-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1&#10;-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59&#10;H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359&#10;c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mord">∣</span></span></span></span></span> 和 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∣</mi><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mi mathvariant="normal">∣</mi></mrow><annotation encoding="application/x-tex">|\vec{b}|</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2274em;vertical-align:-0.25em;"/><span class="mord">∣</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9774em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal">b</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5&#10;3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11&#10;10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63&#10;-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1&#10;-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59&#10;H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359&#10;c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mord">∣</span></span></span></span></span> 分别是向量 a 和 b 的模(长度)</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span></span></span> 是两个向量之间的夹角</li>
</ul>
</li>
</ul>
<h3 data-id="heading-8">2. 余弦相似度 (Cosine Similarity)</h3>
<p>利用点乘公式, 我们可以推导出两个向量夹角的余弦值, 这就是最常用的<strong>余弦相似度</strong>:</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/22e18682f9a6436c93153c7083f76138~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2w5Yi75ZCb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765155409&amp;x-signature=5%2FLnZttOln7PngTFhIWixjEqOfE%3D" alt="image.png" loading="lazy"/></p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Similarity</mtext><mo>=</mo><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mo>⋅</mo><mover accent="true"><mi>b</mi><mo>⃗</mo></mover></mrow><mrow><mi mathvariant="normal">∣</mi><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mi mathvariant="normal">∣</mi><mo>×</mo><mi mathvariant="normal">∣</mi><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mi mathvariant="normal">∣</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\text{Similarity} = \cos(\theta) = \frac{\vec{a} \cdot \vec{b}}{|\vec{a}| \times |\vec{b}|}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord text"><span class="mord">Similarity</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mop">cos</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.7474em;vertical-align:-0.6692em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0782em;"><span style="top:-2.5058em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∣</span><span class="mord accent mtight"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-2.714em;"><span class="pstrut" style="height:2.714em;"/><span class="mord mathnormal mtight">a</span></span><span style="top:-2.714em;"><span class="pstrut" style="height:2.714em;"/><span class="accent-body" style="left:-0.2355em;"><span class="overlay mtight" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5&#10;3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11&#10;10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63&#10;-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1&#10;-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59&#10;H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359&#10;c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mord mtight">∣</span><span class="mbin mtight">×</span><span class="mord mtight">∣</span><span class="mord accent mtight"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9774em;"><span style="top:-2.714em;"><span class="pstrut" style="height:2.714em;"/><span class="mord mathnormal mtight">b</span></span><span style="top:-2.9774em;"><span class="pstrut" style="height:2.714em;"/><span class="accent-body" style="left:-0.2355em;"><span class="overlay mtight" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5&#10;3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11&#10;10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63&#10;-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1&#10;-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59&#10;H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359&#10;c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mord mtight">∣</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord accent mtight"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-2.714em;"><span class="pstrut" style="height:2.714em;"/><span class="mord mathnormal mtight">a</span></span><span style="top:-2.714em;"><span class="pstrut" style="height:2.714em;"/><span class="accent-body" style="left:-0.2355em;"><span class="overlay mtight" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5&#10;3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11&#10;10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63&#10;-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1&#10;-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59&#10;H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359&#10;c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mbin mtight">⋅</span><span class="mord accent mtight"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9774em;"><span style="top:-2.714em;"><span class="pstrut" style="height:2.714em;"/><span class="mord mathnormal mtight">b</span></span><span style="top:-2.9774em;"><span class="pstrut" style="height:2.714em;"/><span class="accent-body" style="left:-0.2355em;"><span class="overlay mtight" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5&#10;3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11&#10;10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63&#10;-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1&#10;-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59&#10;H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359&#10;c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.6692em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></p>
<p><strong>数值含义</strong>:</p>
<ul>
<li><strong>1</strong> (<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi><mo>=</mo><msup><mn>0</mn><mo>∘</mo></msup></mrow><annotation encoding="application/x-tex">\theta = 0^\circ</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6741em;"/><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6741em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∘</span></span></span></span></span></span></span></span></span></span></span></span>): 方向完全相同(语义极度相似)</li>
<li><strong>0</strong> (<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi><mo>=</mo><mn>9</mn><msup><mn>0</mn><mo>∘</mo></msup></mrow><annotation encoding="application/x-tex">\theta = 90^\circ</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6741em;"/><span class="mord">9</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6741em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∘</span></span></span></span></span></span></span></span></span></span></span></span>): 相互垂直(毫无关系, 正交)</li>
<li><strong>-1</strong> (<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi><mo>=</mo><mn>18</mn><msup><mn>0</mn><mo>∘</mo></msup></mrow><annotation encoding="application/x-tex">\theta = 180^\circ</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6741em;"/><span class="mord">18</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6741em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∘</span></span></span></span></span></span></span></span></span></span></span></span>): 方向完全相反(语义对立)</li>
</ul>
<p><strong>为什么 AI 偏爱余弦相似度?</strong></p>
<p>因为它关注的是<strong>方向</strong>而非距离</p>
<ul>
<li>例子: 一句简短的"我爱编程"和一篇 5000 字赞美编程技术的文章</li>
<li>它们的向量<strong>方向</strong>非常接近(都在讨论编程主题), 因此余弦相似度很高</li>
<li>但由于文本长度差异巨大, 长文章的向量模长很大, 两者在空间中的<strong>欧氏距离</strong>会很远在这种场景下, 余弦相似度更能反映语义的一致性</li>
</ul>
<h3 data-id="heading-9">3. 欧氏距离 (Euclidean Distance)</h3>
<p>即两点间的直线距离, 也就是连接两个向量终点的线段长度:</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Distance</mtext><mo>=</mo><msqrt><mrow><mo stretchy="false">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo>−</mo><msub><mi>x</mi><mn>2</mn></msub><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>+</mo><mo stretchy="false">(</mo><msub><mi>y</mi><mn>1</mn></msub><mo>−</mo><msub><mi>y</mi><mn>2</mn></msub><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow></msqrt></mrow><annotation encoding="application/x-tex">\text{Distance} = \sqrt{(x_1-x_2)^2 + (y_1-y_2)^2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord text"><span class="mord">Distance</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.24em;vertical-align:-0.305em;"/><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.935em;"><span class="svg-align" style="top:-3.2em;"><span class="pstrut" style="height:3.2em;"/><span class="mord" style="padding-left:1em;"><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-2.895em;"><span class="pstrut" style="height:3.2em;"/><span class="hide-tail" style="min-width:1.02em;height:1.28em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.28em" viewbox="0 0 400000 1296" preserveaspectratio="xMinYMin slice"><path d="M263,681c0.7,0,18,39.7,52,119&#10;c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120&#10;c340,-704.7,510.7,-1060.3,512,-1067&#10;l0 -0&#10;c4.7,-7.3,11,-11,19,-11&#10;H40000v40H1012.3&#10;s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232&#10;c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1&#10;s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26&#10;c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z&#10;M1001 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.305em;"><span/></span></span></span></span></span></span></span></span></p>
<p><strong>💡 适用场景</strong>
数值的大小(量级)非常关键时, 使用欧氏距离</p>
<ul>
<li>例子: 电商用户聚类
<ul>
<li>用户 A: 购买 1 个苹果</li>
<li>用户 C: 购买 2 个苹果</li>
<li>用户 B: 购买 1000 个苹果(批发商)</li>
</ul>
</li>
<li>虽然三者购买方向一致(都是苹果), 但 A 和 C 的**消费能力(距离)**更近系统会将 A 和 C 归为普通消费者, 而将 B 归为商业客户</li>
</ul>
<h2 data-id="heading-10">第四部分: 从二维到高维 AI 世界</h2>
<p>在 AI 领域, 向量通常拥有几百甚至几千个维度(例如 OpenAI 的 <code>text-embedding-3-small</code> 模型是 1536 维)虽然我们无法在脑海中构想出高维图像, 但<strong>数学规则是完全一致的</strong>:</p>
<p>假设向量 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>=</mo><mo stretchy="false">(</mo><msub><mi>a</mi><mn>1</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi>a</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">A = (a_1, ..., a_n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>, <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mo>=</mo><mo stretchy="false">(</mo><msub><mi>b</mi><mn>1</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi>b</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">B = (b_1, ..., b_n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p>
<ul>
<li><strong>加法</strong>: 对应位相加</li>
<li><strong>模</strong>: <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msqrt><mrow><msubsup><mi>a</mi><mn>1</mn><mn>2</mn></msubsup><mo>+</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo>+</mo><msubsup><mi>a</mi><mi>n</mi><mn>2</mn></msubsup></mrow></msqrt></mrow><annotation encoding="application/x-tex">\sqrt{a_1^2 + ... + a_n^2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.24em;vertical-align:-0.2902em;"/><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9498em;"><span class="svg-align" style="top:-3.2em;"><span class="pstrut" style="height:3.2em;"/><span class="mord" style="padding-left:1em;"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7959em;"><span style="top:-2.4337em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.0448em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2663em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord">...</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span/></span></span></span></span></span></span></span><span style="top:-2.9098em;"><span class="pstrut" style="height:3.2em;"/><span class="hide-tail" style="min-width:1.02em;height:1.28em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.28em" viewbox="0 0 400000 1296" preserveaspectratio="xMinYMin slice"><path d="M263,681c0.7,0,18,39.7,52,119&#10;c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120&#10;c340,-704.7,510.7,-1060.3,512,-1067&#10;l0 -0&#10;c4.7,-7.3,11,-11,19,-11&#10;H40000v40H1012.3&#10;s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232&#10;c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1&#10;s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26&#10;c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z&#10;M1001 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2902em;"><span/></span></span></span></span></span></span></span></span></li>
<li><strong>点乘</strong>: <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mn>1</mn></msub><msub><mi>b</mi><mn>1</mn></msub><mo>+</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo>+</mo><msub><mi>a</mi><mi>n</mi></msub><msub><mi>b</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">a_1b_1 + ... + a_n b_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"/><span class="mord">...</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span></li>
</ul>
<p>总结来说, 我们可以用<strong>加法</strong>对词语的各种特征进行组合, 用<strong>模</strong>来衡量强度, 用<strong>点乘</strong>来抽象地计算相似度</p>
<h2 data-id="heading-11">总结</h2>
<p>本文系统性地介绍了向量在 AI 中的核心作用：</p>
<ul>
<li>核心概念
<ul>
<li><strong>向量</strong>：兼具大小和方向的数学对象，是 AI 表示复杂特征的基础</li>
<li><strong>高维向量</strong>：能够同时编码数百种语义特征，实现精细的语义理解</li>
</ul>
</li>
<li>关键运算及其意义
<ul>
<li><strong>加减法</strong>：实现语义的组合与推演（如"国王 - 男人 + 女人 = 王后"）</li>
<li><strong>模（长度）</strong>：衡量特征强度，用于归一化处理</li>
<li><strong>点乘与余弦相似度</strong>：计算语义相似性，是检索和匹配的核心</li>
</ul>
</li>
<li>实际价值
向量为 AI 提供了一种<strong>可计算的语义表示方法</strong>，使得：
<ul>
<li>计算机能够"理解"词语间的逻辑关系</li>
<li>实现基于语义的智能搜索和推荐</li>
<li>构建更准确的自然语言处理系统</li>
</ul>
</li>
</ul>
<p>我是印刻君，一位探索 AI 的程序员，关注我，了解更多有温度的轻知识，有深度的硬内容。</p>
<blockquote>
<p>本文略过了叉乘(Cross Product), 因为它主要用于 3D 图形学(计算法线等), 在 AI 语义分析中极少使用</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redis（156）Redis的延迟问题如何解决？]]></title>    <link>https://juejin.cn/post/7577795545440895010</link>    <guid>https://juejin.cn/post/7577795545440895010</guid>    <pubDate>2025-11-30T23:04:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577795545440895010" data-draft-id="7578029371006943272" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redis（156）Redis的延迟问题如何解决？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-30T23:04:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redis（156）Redis的延迟问题如何解决？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T23:04:46.000Z" title="Sun Nov 30 2025 23:04:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Redis的延迟问题可能由多种因素引起，包括网络延迟、CPU瓶颈、内存压力、持久化操作等。要解决延迟问题，需要从多个方面进行优化。以下是一些常见的优化策略和具体的代码示例：</p>
<h3 data-id="heading-0">1. 优化网络延迟</h3>
<h4 data-id="heading-1">1.1 使用本地化部署</h4>
<p>将Redis服务器和客户端部署在同一个数据中心或尽可能接近的位置，以减少网络延迟。</p>
<h4 data-id="heading-2">1.2 使用高效的网络协议</h4>
<p>确保使用高效的网络协议和库，例如使用Jedis库的连接池来管理Redis连接。</p>
<p><strong>Jedis连接池配置示例</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.JedisPool;
<span class="hljs-keyword">import</span> redis.clients.jedis.JedisPoolConfig;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisConnectionPool</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">JedisPool</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">JedisPoolConfig</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisPoolConfig</span>();
            config.setMaxTotal(<span class="hljs-number">128</span>);  <span class="hljs-comment">// 最大连接数</span>
            config.setMaxIdle(<span class="hljs-number">128</span>);   <span class="hljs-comment">// 最大空闲连接数</span>
            config.setMinIdle(<span class="hljs-number">16</span>);    <span class="hljs-comment">// 最小空闲连接数</span>
            config.setTestOnBorrow(<span class="hljs-literal">true</span>);  <span class="hljs-comment">// 借用连接时测试连接可用性</span>
            pool = <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisPool</span>(config, <span class="hljs-string">"localhost"</span>, <span class="hljs-number">6379</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> JedisPool <span class="hljs-title function_">getPool</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> pool;
    }
}
</code></pre>
<h3 data-id="heading-3">2. 优化CPU性能</h3>
<h4 data-id="heading-4">2.1 调整Redis配置</h4>
<p>通过配置文件调整Redis的性能参数，例如<code>maxclients</code>和<code>tcp-backlog</code>。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 配置文件 redis.conf 中的优化示例</span>

<span class="hljs-comment"># 最大客户端连接数</span>
maxclients 10000

<span class="hljs-comment"># TCP连接队列长度</span>
tcp-backlog 511
</code></pre>
<h4 data-id="heading-5">2.2 使用多线程I/O</h4>
<p>Redis 6.0及以上版本支持多线程I/O，可以提高处理效率。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 配置文件 redis.conf 中的多线程I/O示例</span>

<span class="hljs-comment"># 开启多线程I/O</span>
io-threads 4
io-threads-do-reads <span class="hljs-built_in">yes</span>
</code></pre>
<h3 data-id="heading-6">3. 优化内存使用</h3>
<h4 data-id="heading-7">3.1 使用内存回收策略</h4>
<p>配置Redis的内存回收策略，避免内存溢出导致的延迟。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 配置文件 redis.conf 中的内存回收策略示例</span>

<span class="hljs-comment"># 最大内存使用限制</span>
maxmemory 2gb

<span class="hljs-comment"># 内存回收策略：volatile-lru, allkeys-lru, volatile-random, allkeys-random, volatile-ttl, noeviction</span>
maxmemory-policy allkeys-lru
</code></pre>
<h4 data-id="heading-8">3.2 使用压缩数据结构</h4>
<p>利用Redis的压缩数据结构（如Ziplist、Hash）减少内存使用。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisCompressedData</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">6379</span>)) {
            <span class="hljs-comment">// 使用压缩数据结构存储哈希</span>
            jedis.hset(<span class="hljs-string">"user:1000"</span>, <span class="hljs-string">"name"</span>, <span class="hljs-string">"John Doe"</span>);
            jedis.hset(<span class="hljs-string">"user:1000"</span>, <span class="hljs-string">"email"</span>, <span class="hljs-string">"john.doe@example.com"</span>);
        }
    }
}
</code></pre>
<h3 data-id="heading-9">4. 优化持久化操作</h3>
<h4 data-id="heading-10">4.1 调整AOF同步策略</h4>
<p>根据业务需求调整AOF的同步策略，减少持久化操作带来的延迟。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 配置文件 redis.conf 中的AOF同步策略示例</span>

<span class="hljs-comment"># AOF同步策略：always, everysec, no</span>
appendfsync everysec  <span class="hljs-comment"># 每秒同步一次AOF文件</span>
</code></pre>
<h4 data-id="heading-11">4.2 使用混合持久化</h4>
<p>结合RDB和AOF的优点，减少持久化操作对性能的影响。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 配置文件 redis.conf 中的混合持久化配置示例</span>

<span class="hljs-comment"># 开启混合持久化</span>
aof-use-rdb-preamble <span class="hljs-built_in">yes</span>
</code></pre>
<h3 data-id="heading-12">5. 使用性能监控工具</h3>
<p>使用Redis自带的监控工具（如<code>INFO</code>命令）或第三方监控工具（如Redis Sentinel、Redis Exporter）来监控Redis的性能并及时发现和解决问题。</p>
<h4 data-id="heading-13">5.1 使用<code>INFO</code>命令监控Redis性能</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisPerformanceMonitor</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">6379</span>)) {
            <span class="hljs-comment">// 获取Redis服务器的INFO信息</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">info</span> <span class="hljs-operator">=</span> jedis.info();
            System.out.println(info);
        }
    }
}
</code></pre>
<h4 data-id="heading-14">5.2 使用Redis Exporter结合Prometheus和Grafana进行监控</h4>
<ol>
<li>
<p><strong>部署Redis Exporter</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">docker run -d --name redis_exporter -p 9121:9121 oliver006/redis_exporter
</code></pre>
</li>
<li>
<p><strong>配置Prometheus监控Redis Exporter</strong>：
在Prometheus配置文件<code>prometheus.yml</code>中添加Redis Exporter的job：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">scrape_configs:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">job_name:</span> <span class="hljs-string">'redis_exporter'</span>
    <span class="hljs-attr">static_configs:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">targets:</span> [<span class="hljs-string">'localhost:9121'</span>]
</code></pre>
</li>
<li>
<p><strong>在Grafana中添加Prometheus数据源并创建监控面板</strong>。</p>
</li>
</ol>
<h3 data-id="heading-15">6. 示例应用</h3>
<p>结合上述优化策略，可以构建一个示例应用来展示如何优化Redis的延迟问题。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;
<span class="hljs-keyword">import</span> redis.clients.jedis.JedisPool;
<span class="hljs-keyword">import</span> redis.clients.jedis.JedisPoolConfig;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisOptimization</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">JedisPool</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">JedisPoolConfig</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisPoolConfig</span>();
            config.setMaxTotal(<span class="hljs-number">128</span>);  <span class="hljs-comment">// 最大连接数</span>
            config.setMaxIdle(<span class="hljs-number">128</span>);   <span class="hljs-comment">// 最大空闲连接数</span>
            config.setMinIdle(<span class="hljs-number">16</span>);    <span class="hljs-comment">// 最小空闲连接数</span>
            config.setTestOnBorrow(<span class="hljs-literal">true</span>);  <span class="hljs-comment">// 借用连接时测试连接可用性</span>
            pool = <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisPool</span>(config, <span class="hljs-string">"localhost"</span>, <span class="hljs-number">6379</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> pool.getResource()) {
            <span class="hljs-comment">// 设置键值对</span>
            jedis.set(<span class="hljs-string">"key"</span>, <span class="hljs-string">"value"</span>);
            System.out.println(<span class="hljs-string">"Value for 'key': "</span> + jedis.get(<span class="hljs-string">"key"</span>));

            <span class="hljs-comment">// 手动触发AOF重写</span>
            jedis.bgrewriteaof();

            <span class="hljs-comment">// 获取Redis服务器的INFO信息</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">info</span> <span class="hljs-operator">=</span> jedis.info();
            System.out.println(info);
        }
    }
}
</code></pre>
<h3 data-id="heading-16">总结</h3>
<p>通过优化网络延迟、CPU性能、内存使用和持久化操作，可以显著降低Redis的延迟问题。同时，结合性能监控工具，及时发现和解决性能瓶颈，可以确保Redis在高负载下的稳定性和高效性。上述代码示例展示了如何通过Java代码结合Jedis库来实现这些优化策略。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redis（157）Redis的连接问题如何解决？]]></title>    <link>https://juejin.cn/post/7577957806210531343</link>    <guid>https://juejin.cn/post/7577957806210531343</guid>    <pubDate>2025-11-30T23:05:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577957806210531343" data-draft-id="7578029371006959656" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redis（157）Redis的连接问题如何解决？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-30T23:05:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redis（157）Redis的连接问题如何解决？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T23:05:29.000Z" title="Sun Nov 30 2025 23:05:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在使用Redis时，连接问题是常见的挑战之一。连接问题可能由多个因素导致，包括连接数限制、连接超时、不正确的连接配置等。下面我将详细介绍如何解决Redis的连接问题，并提供相关代码示例。</p>
<h3 data-id="heading-0">1. 配置连接池</h3>
<p>使用连接池可以有效地管理和复用连接，避免频繁创建和关闭连接造成的性能开销。</p>
<h4 data-id="heading-1">1.1 配置连接池</h4>
<p>使用Jedis连接池来管理Redis连接。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.JedisPool;
<span class="hljs-keyword">import</span> redis.clients.jedis.JedisPoolConfig;
<span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisConnectionPool</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">JedisPool</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">JedisPoolConfig</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisPoolConfig</span>();
            config.setMaxTotal(<span class="hljs-number">128</span>);  <span class="hljs-comment">// 最大连接数</span>
            config.setMaxIdle(<span class="hljs-number">128</span>);   <span class="hljs-comment">// 最大空闲连接数</span>
            config.setMinIdle(<span class="hljs-number">16</span>);    <span class="hljs-comment">// 最小空闲连接数</span>
            config.setTestOnBorrow(<span class="hljs-literal">true</span>);  <span class="hljs-comment">// 借用连接时测试连接可用性</span>
            config.setTestOnReturn(<span class="hljs-literal">true</span>);  <span class="hljs-comment">// 归还连接时测试连接可用性</span>
            config.setBlockWhenExhausted(<span class="hljs-literal">true</span>);  <span class="hljs-comment">// 连接耗尽时是否阻塞</span>
            config.setMaxWaitMillis(<span class="hljs-number">2000</span>);  <span class="hljs-comment">// 最大等待时间（毫秒）</span>
            pool = <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisPool</span>(config, <span class="hljs-string">"localhost"</span>, <span class="hljs-number">6379</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Jedis <span class="hljs-title function_">getJedis</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> pool.getResource();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">returnJedis</span><span class="hljs-params">(Jedis jedis)</span> {
        <span class="hljs-keyword">if</span> (jedis != <span class="hljs-literal">null</span>) {
            jedis.close();
        }
    }
}
</code></pre>
<h4 data-id="heading-2">1.2 使用连接池进行操作</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">try</span> {
            jedis = RedisConnectionPool.getJedis();
            <span class="hljs-comment">// 执行Redis操作</span>
            jedis.set(<span class="hljs-string">"key"</span>, <span class="hljs-string">"value"</span>);
            System.out.println(<span class="hljs-string">"Value for 'key': "</span> + jedis.get(<span class="hljs-string">"key"</span>));
        } <span class="hljs-keyword">finally</span> {
            RedisConnectionPool.returnJedis(jedis);
        }
    }
}
</code></pre>
<h3 data-id="heading-3">2. 修改Redis服务器配置</h3>
<h4 data-id="heading-4">2.1 增加最大连接数</h4>
<p>调整Redis服务器允许的最大客户端连接数。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 配置文件 redis.conf 中的最大连接数设置</span>

<span class="hljs-comment"># 最大客户端连接数</span>
maxclients 10000
</code></pre>
<h4 data-id="heading-5">2.2 调整TCP连接参数</h4>
<p>调整TCP连接队列长度，避免连接请求被拒绝。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 配置文件 redis.conf 中的TCP连接参数</span>

<span class="hljs-comment"># TCP连接队列长度</span>
tcp-backlog 511
</code></pre>
<h3 data-id="heading-6">3. 处理连接超时</h3>
<h4 data-id="heading-7">3.1 配置连接超时</h4>
<p>在Jedis连接池配置中设置连接超时参数。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.JedisPoolConfig;
<span class="hljs-keyword">import</span> redis.clients.jedis.JedisPool;
<span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisConnectionTimeout</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">JedisPool</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">JedisPoolConfig</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisPoolConfig</span>();
            config.setMaxTotal(<span class="hljs-number">128</span>);  <span class="hljs-comment">// 最大连接数</span>
            config.setMaxIdle(<span class="hljs-number">128</span>);   <span class="hljs-comment">// 最大空闲连接数</span>
            config.setMinIdle(<span class="hljs-number">16</span>);    <span class="hljs-comment">// 最小空闲连接数</span>
            config.setTestOnBorrow(<span class="hljs-literal">true</span>);  <span class="hljs-comment">// 借用连接时测试连接可用性</span>
            config.setTestOnReturn(<span class="hljs-literal">true</span>);  <span class="hljs-comment">// 归还连接时测试连接可用性</span>
            config.setBlockWhenExhausted(<span class="hljs-literal">true</span>);  <span class="hljs-comment">// 连接耗尽时是否阻塞</span>
            config.setMaxWaitMillis(<span class="hljs-number">2000</span>);  <span class="hljs-comment">// 最大等待时间（毫秒）</span>

            <span class="hljs-comment">// 设置连接超时参数</span>
            pool = <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisPool</span>(config, <span class="hljs-string">"localhost"</span>, <span class="hljs-number">6379</span>, <span class="hljs-number">2000</span>);  <span class="hljs-comment">// 连接超时时间（毫秒）</span>
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Jedis <span class="hljs-title function_">getJedis</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> pool.getResource();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">returnJedis</span><span class="hljs-params">(Jedis jedis)</span> {
        <span class="hljs-keyword">if</span> (jedis != <span class="hljs-literal">null</span>) {
            jedis.close();
        }
    }
}
</code></pre>
<h3 data-id="heading-8">4. 监控和处理连接问题</h3>
<p>使用Redis和客户端的监控工具，及时发现并处理连接问题。</p>
<h4 data-id="heading-9">4.1 使用Redis的INFO命令监控连接状态</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisConnectionMonitor</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">6379</span>)) {
            <span class="hljs-comment">// 获取Redis服务器的连接状态信息</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">info</span> <span class="hljs-operator">=</span> jedis.info(<span class="hljs-string">"clients"</span>);
            System.out.println(info);
        }
    }
}
</code></pre>
<h4 data-id="heading-10">4.2 配置Redis Sentinel进行高可用性监控</h4>
<p>设置Redis Sentinel监控主从服务器，并在主服务器故障时自动切换。</p>
<p><strong>Sentinel配置示例</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Sentinel配置文件 sentinel.conf</span>

sentinel monitor mymaster 127.0.0.1 6379 2
sentinel down-after-milliseconds mymaster 5000
sentinel failover-timeout mymaster 60000
sentinel parallel-syncs mymaster 1
</code></pre>
<p><strong>启动哨兵</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">redis-sentinel /path/to/sentinel.conf
</code></pre>
<h3 data-id="heading-11">5. 处理网络分区和连接断开</h3>
<p>确保网络稳定，处理可能的网络分区和连接断开。</p>
<h4 data-id="heading-12">5.1 配置客户端重试机制</h4>
<p>在客户端代码中增加连接重试机制。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisConnectionRetry</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">maxRetries</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">attempt</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-type">boolean</span> <span class="hljs-variable">connected</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
        <span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;

        <span class="hljs-keyword">while</span> (attempt &lt; maxRetries &amp;&amp; !connected) {
            <span class="hljs-keyword">try</span> {
                attempt++;
                jedis = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">6379</span>);
                <span class="hljs-comment">// 执行Redis操作</span>
                jedis.set(<span class="hljs-string">"key"</span>, <span class="hljs-string">"value"</span>);
                System.out.println(<span class="hljs-string">"Value for 'key': "</span> + jedis.get(<span class="hljs-string">"key"</span>));
                connected = <span class="hljs-literal">true</span>;
            } <span class="hljs-keyword">catch</span> (Exception e) {
                System.err.println(<span class="hljs-string">"Attempt "</span> + attempt + <span class="hljs-string">" failed: "</span> + e.getMessage());
            } <span class="hljs-keyword">finally</span> {
                <span class="hljs-keyword">if</span> (jedis != <span class="hljs-literal">null</span>) {
                    jedis.close();
                }
            }

            <span class="hljs-keyword">if</span> (!connected) {
                <span class="hljs-keyword">try</span> {
                    Thread.sleep(<span class="hljs-number">2000</span>);  <span class="hljs-comment">// 等待2秒后重试</span>
                } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                    Thread.currentThread().interrupt();
                }
            }
        }

        <span class="hljs-keyword">if</span> (!connected) {
            System.err.println(<span class="hljs-string">"Failed to connect to Redis after "</span> + maxRetries + <span class="hljs-string">" attempts."</span>);
        }
    }
}
</code></pre>
<h3 data-id="heading-13">总结</h3>
<p>通过配置和使用连接池、调整Redis服务器参数、处理连接超时和断开、监控连接状态以及增加客户端重试机制，可以有效解决Redis的连接问题。上述代码示例展示了如何通过Java代码结合Jedis库来实现这些优化策略。确保Redis连接稳定和高效，能够显著提升Redis的整体性能和可靠性。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[还在为Vue 3响应式性能头疼？这4个进阶API让你开发效率翻倍！]]></title>    <link>https://juejin.cn/post/7578037997324582931</link>    <guid>https://juejin.cn/post/7578037997324582931</guid>    <pubDate>2025-11-30T23:32:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578037997324582931" data-draft-id="7578114667462656019" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="还在为Vue 3响应式性能头疼？这4个进阶API让你开发效率翻倍！"/> <meta itemprop="keywords" content="Vue.js,JavaScript,前端"/> <meta itemprop="datePublished" content="2025-11-30T23:32:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="良山有风来"/> <meta itemprop="url" content="https://juejin.cn/user/3940246036939358"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            还在为Vue 3响应式性能头疼？这4个进阶API让你开发效率翻倍！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3940246036939358/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    良山有风来
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T23:32:43.000Z" title="Sun Nov 30 2025 23:32:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">从性能瓶颈说起</h2>
<p>不知道你有没有遇到过这样的场景：一个包含数千条数据的表格，每次操作都卡顿得让人抓狂；或者一个复杂的表单，每次输入都会触发不必要的重新渲染。明明用了Vue 3的响应式系统，性能却越来越差。</p>
<p>这其实就是响应式系统的过度使用导致的。Vue 3的响应式确实强大，但如果不加节制地使用，反而会成为性能杀手。今天我就带你深入了解Vue 3响应式系统中那些被低估的进阶API，让你的应用性能瞬间起飞！</p>
<p>读完本文，你将掌握shallowRef、markRaw等API的核心使用场景，学会在什么情况下该用它们来优化性能。更重要的是，你会获得一套完整的性能优化思路，让你在面对复杂场景时游刃有余。</p>
<h2 data-id="heading-1">重新认识Vue 3响应式</h2>
<p>在深入进阶API之前，我们先快速回顾一下Vue 3响应式的基础知识。Vue 3使用Proxy来实现响应式，这意味着当你修改一个响应式对象的任何属性时，都会触发依赖更新。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 基础响应式示例</span>
<span class="hljs-keyword">import</span> { reactive, watchEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">user</span>: {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span>,
    <span class="hljs-attr">profile</span>: {
      <span class="hljs-attr">age</span>: <span class="hljs-number">25</span>,
      <span class="hljs-attr">hobbies</span>: [<span class="hljs-string">'篮球'</span>, <span class="hljs-string">'阅读'</span>]
    }
  }
})

<span class="hljs-comment">// 任何嵌套属性的修改都会触发这个effect</span>
<span class="hljs-title function_">watchEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'用户信息更新了:'</span>, state.<span class="hljs-property">user</span>.<span class="hljs-property">profile</span>.<span class="hljs-property">age</span>)
})

<span class="hljs-comment">// 修改age会触发effect</span>
state.<span class="hljs-property">user</span>.<span class="hljs-property">profile</span>.<span class="hljs-property">age</span> = <span class="hljs-number">26</span>
<span class="hljs-comment">// 甚至添加新的hobby也会触发</span>
state.<span class="hljs-property">user</span>.<span class="hljs-property">profile</span>.<span class="hljs-property">hobbies</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">'编程'</span>)
</code></pre>
<p>看到问题了吗？即使我们只关心age的变化，但任何嵌套属性的修改都会触发重新执行。在大型应用中，这种细粒度的响应式可能会带来不必要的性能开销。</p>
<h2 data-id="heading-2">shallowRef：浅层响应的智慧</h2>
<p>shallowRef是ref的"轻量版"，它只对.value本身的变化进行响应，不会递归地将嵌套对象转为响应式。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { shallowRef, watchEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-comment">// 使用shallowRef</span>
<span class="hljs-keyword">const</span> userData = <span class="hljs-title function_">shallowRef</span>({
  <span class="hljs-attr">basicInfo</span>: {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'李四'</span>,
    <span class="hljs-attr">age</span>: <span class="hljs-number">30</span>
  },
  <span class="hljs-attr">preferences</span>: {
    <span class="hljs-attr">theme</span>: <span class="hljs-string">'dark'</span>,
    <span class="hljs-attr">language</span>: <span class="hljs-string">'zh-CN'</span>
  }
})

<span class="hljs-comment">// 只有直接修改userData.value才会触发effect</span>
<span class="hljs-title function_">watchEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'用户数据发生变化'</span>)
})

<span class="hljs-comment">// 这个不会触发effect！</span>
userData.<span class="hljs-property">value</span>.<span class="hljs-property">basicInfo</span>.<span class="hljs-property">name</span> = <span class="hljs-string">'王五'</span>

<span class="hljs-comment">// 但这个会触发effect</span>
userData.<span class="hljs-property">value</span> = {
  <span class="hljs-attr">basicInfo</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'王五'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span> },
  <span class="hljs-attr">preferences</span>: { <span class="hljs-attr">theme</span>: <span class="hljs-string">'light'</span>, <span class="hljs-attr">language</span>: <span class="hljs-string">'en-US'</span> }
}
</code></pre>
<p>那么什么时候该用shallowRef呢？</p>
<p><strong>场景1：大型对象或数组</strong>
当你有一个很大的数据对象，但只需要在整体替换时更新视图，这时候shallowRef就是最佳选择。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 从服务器获取的大型数据集</span>
<span class="hljs-keyword">const</span> largeDataset = <span class="hljs-title function_">shallowRef</span>([])

<span class="hljs-comment">// 模拟数据获取</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchData</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/large-data'</span>)
  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>()
  
  <span class="hljs-comment">// 整体替换，触发更新</span>
  largeDataset.<span class="hljs-property">value</span> = data
}

<span class="hljs-comment">// 内部修改不会触发不必要的更新</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">updateItem</span>(<span class="hljs-params">index, newItem</span>) {
  largeDataset.<span class="hljs-property">value</span>[index] = newItem
  <span class="hljs-comment">// 这里不会触发组件重新渲染！</span>
}
</code></pre>
<p><strong>场景2：第三方库实例</strong>
当你需要集成第三方库，比如图表库、地图库的实例时：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { shallowRef, onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> echarts <span class="hljs-keyword">from</span> <span class="hljs-string">'echarts'</span>

<span class="hljs-keyword">const</span> chartInstance = <span class="hljs-title function_">shallowRef</span>(<span class="hljs-literal">null</span>)
<span class="hljs-keyword">const</span> chartData = <span class="hljs-title function_">ref</span>([])

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// 初始化图表实例</span>
  <span class="hljs-keyword">const</span> chart = echarts.<span class="hljs-title function_">init</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'chart'</span>))
  chartInstance.<span class="hljs-property">value</span> = chart
  
  <span class="hljs-comment">// 只有chartData变化时才更新图表</span>
  <span class="hljs-title function_">watchEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (chartInstance.<span class="hljs-property">value</span>) {
      chartInstance.<span class="hljs-property">value</span>.<span class="hljs-title function_">setOption</span>({
        <span class="hljs-attr">series</span>: [{ <span class="hljs-attr">data</span>: chartData.<span class="hljs-property">value</span> }]
      })
    }
  })
})
</code></pre>
<h2 data-id="heading-3">markRaw：彻底摆脱响应式</h2>
<p>有时候，我们根本不需要某些数据变成响应式，这时候markRaw就派上用场了。markRaw标记一个对象，让它永远不会被转为响应式。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { reactive, markRaw, watchEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-comment">// 配置对象，不需要响应式</span>
<span class="hljs-keyword">const</span> staticConfig = <span class="hljs-title function_">markRaw</span>({
  <span class="hljs-attr">apiBaseUrl</span>: <span class="hljs-string">'https://api.example.com'</span>,
  <span class="hljs-attr">timeout</span>: <span class="hljs-number">5000</span>,
  <span class="hljs-attr">retryCount</span>: <span class="hljs-number">3</span>
})

<span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">user</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-comment">// 即使放在reactive对象里，config也不会变成响应式</span>
  <span class="hljs-attr">config</span>: staticConfig
})

<span class="hljs-title function_">watchEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'状态变化'</span>)
})

<span class="hljs-comment">// 这个修改不会触发effect！</span>
state.<span class="hljs-property">config</span>.<span class="hljs-property">timeout</span> = <span class="hljs-number">10000</span>
</code></pre>
<p><strong>使用场景：常量配置和工具对象</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 常量配置</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">APP_CONFIG</span> = <span class="hljs-title function_">markRaw</span>({
  <span class="hljs-attr">VERSION</span>: <span class="hljs-string">'1.0.0'</span>,
  <span class="hljs-attr">FEATURES</span>: {
    <span class="hljs-attr">DARK_MODE</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">OFFLINE_SUPPORT</span>: <span class="hljs-literal">false</span>
  }
})

<span class="hljs-comment">// 工具函数集合</span>
<span class="hljs-keyword">const</span> utils = <span class="hljs-title function_">markRaw</span>({
  <span class="hljs-title function_">formatDate</span>(<span class="hljs-params">date</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intl</span>.<span class="hljs-title class_">DateTimeFormat</span>(<span class="hljs-string">'zh-CN'</span>).<span class="hljs-title function_">format</span>(date)
  },
  <span class="hljs-title function_">debounce</span>(<span class="hljs-params">fn, delay</span>) {
    <span class="hljs-keyword">let</span> timer
    <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">...args</span>) =&gt;</span> {
      <span class="hljs-built_in">clearTimeout</span>(timer)
      timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> fn.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args), delay)
    }
  }
})

<span class="hljs-keyword">const</span> store = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">config</span>: <span class="hljs-variable constant_">APP_CONFIG</span>,
  <span class="hljs-attr">utils</span>: utils,
  <span class="hljs-attr">userData</span>: <span class="hljs-literal">null</span>
})
</code></pre>
<p><strong>在组件选项API中的使用</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { markRaw } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-comment">// 标记第三方库实例为非响应式</span>
      <span class="hljs-attr">mapInstance</span>: <span class="hljs-title function_">markRaw</span>(<span class="hljs-literal">null</span>),
      <span class="hljs-attr">markers</span>: []
    }
  },
  
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 初始化地图，这个实例不需要响应式</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">mapInstance</span> = <span class="hljs-title function_">markRaw</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MapLibrary</span>(<span class="hljs-string">'#map'</span>))
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadMarkers</span>()
  },
  
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">loadMarkers</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">const</span> markers = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchMarkers</span>()
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">markers</span> = markers
      
      <span class="hljs-comment">// 直接操作非响应式实例，性能更好</span>
      markers.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">marker</span> =&gt;</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">mapInstance</span>.<span class="hljs-title function_">addMarker</span>(marker)
      })
    }
  }
}
</code></pre>
<h2 data-id="heading-4">shallowReactive：表层响应的平衡点</h2>
<p>shallowReactive是reactive的浅层版本，只对根级别属性进行响应式跟踪。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { shallowReactive, watchEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> state = <span class="hljs-title function_">shallowReactive</span>({
  <span class="hljs-attr">level1</span>: {
    <span class="hljs-attr">level2</span>: {
      <span class="hljs-attr">value</span>: <span class="hljs-string">'初始值'</span>
    }
  },
  <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>
})

<span class="hljs-title function_">watchEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'状态变化:'</span>, state.<span class="hljs-property">count</span>)
})

<span class="hljs-comment">// 这个会触发effect - 根级别属性</span>
state.<span class="hljs-property">count</span>++

<span class="hljs-comment">// 这个不会触发effect - 嵌套属性</span>
state.<span class="hljs-property">level1</span>.<span class="hljs-property">level2</span>.<span class="hljs-property">value</span> = <span class="hljs-string">'新值'</span>
</code></pre>
<p><strong>实际应用场景：配置管理</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 应用配置管理</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">useAppConfig</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> config = <span class="hljs-title function_">shallowReactive</span>({
    <span class="hljs-attr">theme</span>: {
      <span class="hljs-attr">colors</span>: {
        <span class="hljs-attr">primary</span>: <span class="hljs-string">'#1890ff'</span>,
        <span class="hljs-attr">secondary</span>: <span class="hljs-string">'#52c41a'</span>
      },
      <span class="hljs-attr">spacing</span>: {
        <span class="hljs-attr">small</span>: <span class="hljs-string">'8px'</span>,
        <span class="hljs-attr">medium</span>: <span class="hljs-string">'16px'</span>
      }
    },
    <span class="hljs-attr">features</span>: {
      <span class="hljs-attr">analytics</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">notifications</span>: <span class="hljs-literal">false</span>
    }
  })
  
  <span class="hljs-comment">// 只有切换主题整体时才会更新</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">switchTheme</span>(<span class="hljs-params">newTheme</span>) {
    config.<span class="hljs-property">theme</span> = newTheme
  }
  
  <span class="hljs-comment">// 修改具体颜色不会触发不必要的更新</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">updatePrimaryColor</span>(<span class="hljs-params">color</span>) {
    config.<span class="hljs-property">theme</span>.<span class="hljs-property">colors</span>.<span class="hljs-property">primary</span> = color
  }
  
  <span class="hljs-keyword">return</span> {
    config,
    switchTheme,
    updatePrimaryColor
  }
}
</code></pre>
<h2 data-id="heading-5">toRaw：获取原始对象</h2>
<p>toRaw返回reactive或readonly代理的原始对象。这在需要直接操作原始数据，或者将数据传递给不支持代理的第三方库时特别有用。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { reactive, toRaw, watchEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">items</span>: [<span class="hljs-string">'item1'</span>, <span class="hljs-string">'item2'</span>]
})

<span class="hljs-title function_">watchEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'数组变化了'</span>)
})

<span class="hljs-comment">// 通过代理操作，会触发effect</span>
state.<span class="hljs-property">items</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">'item3'</span>)

<span class="hljs-comment">// 获取原始对象操作，不会触发effect</span>
<span class="hljs-keyword">const</span> rawState = <span class="hljs-title function_">toRaw</span>(state)
rawState.<span class="hljs-property">items</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">'item4'</span>) <span class="hljs-comment">// 不会触发上面的effect</span>

<span class="hljs-comment">// 需要传递给第三方库时</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">saveToLocalStorage</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> rawData = <span class="hljs-title function_">toRaw</span>(state)
  <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'app-state'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(rawData))
}
</code></pre>
<h2 data-id="heading-6">性能优化实战：大型数据表格</h2>
<p>让我们来看一个实际的性能优化案例。假设我们有一个需要显示数千行数据的表格：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { shallowRef, computed, onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useDataTable</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 使用shallowRef存储大量数据</span>
  <span class="hljs-keyword">const</span> rawData = <span class="hljs-title function_">shallowRef</span>([])
  
  <span class="hljs-comment">// 分页和排序状态使用普通ref</span>
  <span class="hljs-keyword">const</span> currentPage = <span class="hljs-title function_">ref</span>(<span class="hljs-number">1</span>)
  <span class="hljs-keyword">const</span> pageSize = <span class="hljs-title function_">ref</span>(<span class="hljs-number">50</span>)
  <span class="hljs-keyword">const</span> sortBy = <span class="hljs-title function_">ref</span>(<span class="hljs-string">'id'</span>)
  
  <span class="hljs-comment">// 计算当前页数据</span>
  <span class="hljs-keyword">const</span> currentPageData = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> data = rawData.<span class="hljs-property">value</span>
    <span class="hljs-keyword">const</span> start = (currentPage.<span class="hljs-property">value</span> - <span class="hljs-number">1</span>) * pageSize.<span class="hljs-property">value</span>
    <span class="hljs-keyword">const</span> end = start + pageSize.<span class="hljs-property">value</span>
    
    <span class="hljs-keyword">return</span> data
      .<span class="hljs-title function_">slice</span>()
      .<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (a[sortBy.<span class="hljs-property">value</span>] &lt; b[sortBy.<span class="hljs-property">value</span>]) <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>
        <span class="hljs-keyword">if</span> (a[sortBy.<span class="hljs-property">value</span>] &gt; b[sortBy.<span class="hljs-property">value</span>]) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
      })
      .<span class="hljs-title function_">slice</span>(start, end)
  })
  
  <span class="hljs-title function_">onMounted</span>(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-comment">// 模拟获取大量数据</span>
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/large-dataset'</span>)
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>()
    rawData.<span class="hljs-property">value</span> = data
  })
  
  <span class="hljs-comment">// 更新单行数据 - 不会触发不必要重新渲染</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">updateRow</span>(<span class="hljs-params">rowId, newData</span>) {
    <span class="hljs-keyword">const</span> rowIndex = rawData.<span class="hljs-property">value</span>.<span class="hljs-title function_">findIndex</span>(<span class="hljs-function"><span class="hljs-params">row</span> =&gt;</span> row.<span class="hljs-property">id</span> === rowId)
    <span class="hljs-keyword">if</span> (rowIndex !== -<span class="hljs-number">1</span>) {
      rawData.<span class="hljs-property">value</span>[rowIndex] = { ...rawData.<span class="hljs-property">value</span>[rowIndex], ...newData }
    }
  }
  
  <span class="hljs-keyword">return</span> {
    currentPageData,
    currentPage,
    pageSize,
    sortBy,
    updateRow
  }
}
</code></pre>
<h2 data-id="heading-7">组合使用：构建高性能状态管理</h2>
<p>在实际项目中，我们往往需要组合使用这些API来构建完整的状态管理方案。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { reactive, shallowRef, markRaw, toRaw } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-comment">// 应用状态管理</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useAppStore</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 用户信息 - 需要深度响应式</span>
  <span class="hljs-keyword">const</span> user = <span class="hljs-title function_">reactive</span>({
    <span class="hljs-attr">profile</span>: {
      <span class="hljs-attr">name</span>: <span class="hljs-string">''</span>,
      <span class="hljs-attr">email</span>: <span class="hljs-string">''</span>
    },
    <span class="hljs-attr">preferences</span>: {}
  })
  
  <span class="hljs-comment">// 业务数据 - 使用浅层响应式</span>
  <span class="hljs-keyword">const</span> businessData = <span class="hljs-title function_">shallowRef</span>({
    <span class="hljs-attr">products</span>: [],
    <span class="hljs-attr">orders</span>: [],
    <span class="hljs-attr">customers</span>: []
  })
  
  <span class="hljs-comment">// 配置和工具 - 不需要响应式</span>
  <span class="hljs-keyword">const</span> constants = <span class="hljs-title function_">markRaw</span>({
    <span class="hljs-attr">API_ENDPOINTS</span>: {
      <span class="hljs-attr">PRODUCTS</span>: <span class="hljs-string">'/api/products'</span>,
      <span class="hljs-attr">ORDERS</span>: <span class="hljs-string">'/api/orders'</span>
    },
    <span class="hljs-attr">VALIDATION_RULES</span>: {
      <span class="hljs-attr">EMAIL</span>: <span class="hljs-regexp">/^[^\s@]+@[^\s@]+\.[^\s@]+$/</span>,
      <span class="hljs-attr">PHONE</span>: <span class="hljs-regexp">/^1[3-9]\d{9}$/</span>
    }
  })
  
  <span class="hljs-comment">// 第三方服务实例</span>
  <span class="hljs-keyword">const</span> services = <span class="hljs-title function_">markRaw</span>({
    <span class="hljs-attr">analytics</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-attr">payment</span>: <span class="hljs-literal">null</span>
  })
  
  <span class="hljs-comment">// 初始化服务</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">initializeServices</span>(<span class="hljs-params"/>) {
    services.<span class="hljs-property">analytics</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnalyticsService</span>()
    services.<span class="hljs-property">payment</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PaymentService</span>(constants.<span class="hljs-property">API_ENDPOINTS</span>)
  }
  
  <span class="hljs-comment">// 批量更新业务数据</span>
  <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">updateBusinessData</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> [products, orders, customers] = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([
      <span class="hljs-title function_">fetch</span>(constants.<span class="hljs-property">API_ENDPOINTS</span>.<span class="hljs-property">PRODUCTS</span>),
      <span class="hljs-title function_">fetch</span>(constants.<span class="hljs-property">API_ENDPOINTS</span>.<span class="hljs-property">ORDERS</span>),
      <span class="hljs-title function_">fetch</span>(constants.<span class="hljs-property">API_ENDPOINTS</span>.<span class="hljs-property">CUSTOMERS</span>)
    ])
    
    <span class="hljs-comment">// 整体替换，触发一次更新</span>
    businessData.<span class="hljs-property">value</span> = {
      <span class="hljs-attr">products</span>: <span class="hljs-keyword">await</span> products.<span class="hljs-title function_">json</span>(),
      <span class="hljs-attr">orders</span>: <span class="hljs-keyword">await</span> orders.<span class="hljs-title function_">json</span>(),
      <span class="hljs-attr">customers</span>: <span class="hljs-keyword">await</span> customers.<span class="hljs-title function_">json</span>()
    }
  }
  
  <span class="hljs-comment">// 导出数据（移除响应式）</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">exportData</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">user</span>: <span class="hljs-title function_">toRaw</span>(user),
      <span class="hljs-attr">businessData</span>: <span class="hljs-title function_">toRaw</span>(businessData.<span class="hljs-property">value</span>),
      <span class="hljs-attr">constants</span>: <span class="hljs-title function_">toRaw</span>(constants)
    }
  }
  
  <span class="hljs-keyword">return</span> {
    user,
    businessData,
    constants,
    services,
    initializeServices,
    updateBusinessData,
    exportData
  }
}
</code></pre>
<h2 data-id="heading-8">避坑指南：常见误用场景</h2>
<p>虽然这些进阶API很强大，但使用不当也会带来问题。下面是一些常见的误用场景：</p>
<p><strong>误用1：在需要深度响应式时使用shallowRef</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ❌ 错误用法</span>
<span class="hljs-keyword">const</span> formState = <span class="hljs-title function_">shallowRef</span>({
  <span class="hljs-attr">fields</span>: {
    <span class="hljs-attr">username</span>: <span class="hljs-string">''</span>,
    <span class="hljs-attr">password</span>: <span class="hljs-string">''</span>
  }
})

<span class="hljs-comment">// 表单字段变化不会触发更新！</span>
formState.<span class="hljs-property">value</span>.<span class="hljs-property">fields</span>.<span class="hljs-property">username</span> = <span class="hljs-string">'new username'</span>

<span class="hljs-comment">// ✅ 正确用法：需要深度响应式时使用reactive</span>
<span class="hljs-keyword">const</span> formState = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">fields</span>: {
    <span class="hljs-attr">username</span>: <span class="hljs-string">''</span>,
    <span class="hljs-attr">password</span>: <span class="hljs-string">''</span>
  }
})
</code></pre>
<p><strong>误用2：过度使用markRaw</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ❌ 错误用法：把需要响应式的数据标记为非响应式</span>
<span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">user</span>: <span class="hljs-title function_">markRaw</span>({
    <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span>,
    <span class="hljs-comment">// 这个name变化不会触发更新！</span>
  })
})

<span class="hljs-comment">// ✅ 正确用法：只在确实不需要响应式时使用markRaw</span>
<span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">user</span>: {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span>
  },
  <span class="hljs-attr">config</span>: <span class="hljs-title function_">markRaw</span>({
    <span class="hljs-comment">// 配置信息确实不需要响应式</span>
    <span class="hljs-attr">apiUrl</span>: <span class="hljs-string">'https://api.example.com'</span>
  })
})
</code></pre>
<h2 data-id="heading-9">测试与调试技巧</h2>
<p>使用这些API时，合适的测试和调试方法很重要：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { isReactive, isRef, isReadonly, toRaw } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-comment">// 调试函数，检查响应式状态</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">debugReactive</span>(<span class="hljs-params">obj, name = <span class="hljs-string">'未知对象'</span></span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">group</span>(<span class="hljs-string">`响应式调试: <span class="hljs-subst">${name}</span>`</span>)
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'原始对象:'</span>, <span class="hljs-title function_">toRaw</span>(obj))
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'是响应式对象:'</span>, <span class="hljs-title function_">isReactive</span>(obj))
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'是ref对象:'</span>, <span class="hljs-title function_">isRef</span>(obj))
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'是只读对象:'</span>, <span class="hljs-title function_">isReadonly</span>(obj))
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">groupEnd</span>()
}

<span class="hljs-comment">// 在组件中使用</span>
<span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({ <span class="hljs-attr">count</span>: <span class="hljs-number">0</span> })
<span class="hljs-keyword">const</span> shallowState = <span class="hljs-title function_">shallowReactive</span>({ <span class="hljs-attr">nested</span>: { <span class="hljs-attr">value</span>: <span class="hljs-number">1</span> } })

<span class="hljs-title function_">debugReactive</span>(state, <span class="hljs-string">'深度响应式状态'</span>)
<span class="hljs-title function_">debugReactive</span>(shallowState, <span class="hljs-string">'浅层响应式状态'</span>)
<span class="hljs-title function_">debugReactive</span>(shallowState.<span class="hljs-property">nested</span>, <span class="hljs-string">'嵌套对象'</span>)
</code></pre>
<h2 data-id="heading-10">总结与最佳实践</h2>
<p>通过今天的学习，相信你已经对Vue 3响应式系统的进阶API有了更深入的理解。让我们最后总结一下各个API的使用场景：</p>
<p><strong>shallowRef</strong> 适用于大型对象或数组，当你只需要在整体替换时更新视图的场景。</p>
<p><strong>markRaw</strong> 适用于常量配置、工具函数、第三方库实例等确实不需要响应式的场景。</p>
<p><strong>shallowReactive</strong> 适用于那些只需要表层响应式，嵌套数据变化不需要触发更新的场景。</p>
<p><strong>toRaw</strong> 适用于需要直接操作原始数据，或者与第三方库交互的场景。</p>
<p>记住，性能优化的核心思想是：在保证功能正确的前提下，尽量减少不必要的响应式跟踪。不是所有数据都需要响应式，选择合适的工具才能构建出既功能完善又性能优异的Vue应用。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flutter TolyUI 框架#09 | tolyui_text 轻量高亮文本]]></title>    <link>https://juejin.cn/post/7578113711363162155</link>    <guid>https://juejin.cn/post/7578113711363162155</guid>    <pubDate>2025-11-30T23:42:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578113711363162155" data-draft-id="7578177007574761526" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flutter TolyUI 框架#09 | tolyui_text 轻量高亮文本"/> <meta itemprop="keywords" content="Flutter,UI Kit,前端"/> <meta itemprop="datePublished" content="2025-11-30T23:42:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="张风捷特烈"/> <meta itemprop="url" content="https://juejin.cn/user/149189281194766"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flutter TolyUI 框架#09 | tolyui_text 轻量高亮文本
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/149189281194766/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    张风捷特烈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T23:42:34.000Z" title="Sun Nov 30 2025 23:42:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h4 data-id="heading-0">《Flutter TolyUI 框架》系列前言:</h4>
<p><strong>TolyUI</strong> 是 <a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">张风捷特烈</a> 打造的 Fluter 全平台应用开发 UI 框架。具备 <strong>全平台</strong>、<strong>组件化</strong>、<strong>源码开放</strong>、<strong>响应式</strong> 四大特点。可以帮助开发者迅速构建具有响应式全平台应用软件：</p>
<blockquote>
<p>开源地址： <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTolyFx%2Ftoly_ui" target="_blank" title="https://github.com/TolyFx/toly_ui" ref="nofollow noopener noreferrer">github.com/TolyFx/toly…</a></p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/de8c6bed9bfe46b3865accea7d493d4c~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1563&amp;h=409&amp;s=62505&amp;e=png&amp;b=ffffff" alt="image.png" loading="lazy"/></p>
<hr/>
<h4 data-id="heading-1">1. 文本增强的设计动机</h4>
<p>在应用开发中，文本从来不只是信息的载体，更是用户与应用交互的桥梁。在界面展示和交互的过程中，有时文本并不仅是基本的静态展示，还有搜索是关键字高亮、隐私政策点击交互等。</p>













<table><thead><tr><th>搜索高亮</th><th>隐私政策等</th></tr></thead><tbody><tr><td><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f473de6b892c4666ba226d40b7e5f27d~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1179&amp;h=2556&amp;s=377870&amp;e=png&amp;b=fdfdfd" alt="IMG_4380.PNG" loading="lazy"/></td><td><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/054a1e99ac3e48baaaacc90113281642~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1179&amp;h=2556&amp;s=494075&amp;e=png&amp;b=7fffc3" alt="IMG_4381.PNG" loading="lazy"/></td></tr></tbody></table>
<p>虽然使用 Flutter 本身的富文本也可以处理，但往往让开发者陷入繁琐的细节之中。实现一个简单的搜索高亮功能，需要手动分割字符串、处理大小写逻辑、管理样式状态。比如下面这样的代码：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 传统方式：繁琐的手动处理</span>
<span class="hljs-built_in">List</span>&lt;TextSpan&gt; buildHighlightSpans(<span class="hljs-built_in">String</span> text, <span class="hljs-built_in">String</span> keyword) {
  <span class="hljs-built_in">List</span>&lt;TextSpan&gt; spans = [];
  <span class="hljs-built_in">int</span> start = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">while</span> (start &lt; text.length) {
    <span class="hljs-built_in">int</span> index = text.indexOf(keyword, start);
    <span class="hljs-keyword">if</span> (index == <span class="hljs-number">-1</span>) {
      spans.add(TextSpan(text: text.substring(start)));
      <span class="hljs-keyword">break</span>;
    }
    <span class="hljs-keyword">if</span> (index &gt; start) {
      spans.add(TextSpan(text: text.substring(start, index)));
    }
    spans.add(TextSpan(
      text: keyword,
      style: TextStyle(backgroundColor: Colors.yellow),
    ));
    start = index + keyword.length;
  }
  <span class="hljs-keyword">return</span> spans;
}
</code></pre>
<p>TolyUI 的 <strong>HighlightText</strong> 组件目的在于封装文字高亮方案，提供一套轻量级的解决方案。通过简洁的 API 让开发者用最少的代码实现需求，比如最简单的搜索关键字高亮，使用下面的代码即可:</p>
<pre><code class="hljs language-dart" lang="dart">HighlightText.withArg(
  text,
  arg: keyword,
  highlightStyle: TextStyle(backgroundColor: Colors.yellow),
)
</code></pre>
<hr/>
<h4 data-id="heading-2">2. 独立模块: tolyui_text</h4>
<p>TolyUI 中对文本表现的增强，封装倒了独立的模块中 <a href="https://link.juejin.cn?target=https%3A%2F%2Fpub.dev%2Fpackages%2Ftolyui_text" target="_blank" title="https://pub.dev/packages/tolyui_text" ref="nofollow noopener noreferrer">tolyui_text</a>。它隶属于 tolyui 的基础组件模块：</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3b16cb0641e8408c99966e5e06685eba~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1002&amp;h=413&amp;s=55327&amp;e=png&amp;b=ffffff" alt="image.png" loading="lazy"/></p>
<p>使用者可以独立模块包，或者使用 tolyui 全家桶来使用 HighlightText 组件。</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/02a6fa88d4314c7bb6901f64dff2261c~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=876&amp;h=354&amp;s=35349&amp;e=png&amp;b=ffffff" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># 仅使用 tolyui_text</span>
<span class="hljs-attr">dependencies:</span> 
   <span class="hljs-attr">tolyui_text:</span> <span class="hljs-string">^last_version</span>

<span class="hljs-comment"># 使用 tolyui 全家桶 </span>
<span class="hljs-attr">dependencies:</span> 
    <span class="hljs-attr">tolyui:</span> <span class="hljs-string">^last_version</span>

</code></pre>
<p>下面来介绍一下 <code>HighlightText</code> 的具体用法。</p>
<hr/>
<h4 data-id="heading-3">3. 搜索关键字文本高亮</h4>
<p>第一个场景是交互式搜索高亮。这是最常见的文本处理需求，HighlightText 提供了 <code>withArg</code> 构造函数，让开发者可以快速实现，基于搜索字符，实现高亮匹配关键字，效果如下：</p>
<ul>
<li>支持自定义 <strong>高亮匹配样式</strong>。</li>
<li>支持 <strong>是否区分大小写</strong>。</li>
</ul>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/624d31fd1eb64c29ac8df25c69ee368b~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=742&amp;h=509&amp;s=478683&amp;e=gif&amp;f=491&amp;b=fafafc" alt="1.gif" loading="lazy"/></p>
<p>使用方式非常简单，只需要通过 <code>HighlightText.withArg</code> 即可：</p>
<pre><code class="hljs language-dart" lang="dart">HighlightText.withArg(
  <span class="hljs-string">"文本内容"</span>,
  caseSensitive: <span class="hljs-comment">// 是否区分大小写,</span>
  arg: <span class="hljs-string">'关键字'</span>,
  highlightStyle: <span class="hljs-comment">//高亮样式,</span>
),
</code></pre>
<hr/>
<h4 data-id="heading-4">4. 自定义匹配规则</h4>
<p><code>withArg</code> 构造函数只适合某一个特定字符串的高亮匹配。对于多个复杂的破规则，支持 <code>rules</code> 的规则映射。<code>Rule</code> 对象可以定义正则表达式，以及 <code>onTap</code> 回调，用于处理点击事件。<br/>
比如这里 <code>《[^\u300b]+》</code> 正则匹配书名号和其中的内容，匹配到使用 highlightStyle 样式。点击时触发 <code>onTapMatch</code> 方法，回调的 <code>HighlightMatch</code> 对象中可以得到匹配的信息，包括文本内容和第几个。</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/51a6830c3a484c938f767427977a5982~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=742&amp;h=509&amp;s=331468&amp;e=gif&amp;f=263&amp;b=fafafc" alt="2.gif" loading="lazy"/></p>
<pre><code class="hljs language-dart" lang="dart">HighlightText(
  <span class="hljs-string">'文本内容'</span>,
  rules: {
    Rule(<span class="hljs-built_in">RegExp</span>(<span class="hljs-string">r'《[^\u300b]+》'</span>), onTap: onTapMatch): highlightStyle <span class="hljs-comment">//高亮样式,</span>
  },
  style: <span class="hljs-keyword">const</span> TextStyle(fontSize: <span class="hljs-number">16</span>),
),

<span class="hljs-keyword">void</span> onTapMatch(HighlightMatch match) {
  $message.success(
    message: <span class="hljs-string">'点击的是第:<span class="hljs-subst">${match.matchIndex}</span> 个:<span class="hljs-subst">${match.matchedText}</span>'</span>,
  );
}
</code></pre>
<hr/>
<h4 data-id="heading-5">5.多模式智能识别</h4>
<p><code>rules</code> 中有支持多个匹配规则，比如下面所有数字通过 <code>\d+</code> 匹配，每个数字都可以有自己的点击事件。Rule 的第一参可以传入字符串，比如这里的 <code>zdl1994328</code> 精确匹配每个字符串。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4f1f8fcf82d3430fa5a266b1773baee3~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=742&amp;h=509&amp;s=519478&amp;e=gif&amp;f=350&amp;b=fdfdfb" alt="3.gif" loading="lazy"/></p>
<pre><code class="hljs language-dart" lang="dart">HighlightText(
  <span class="hljs-string">"文本"</span>,
  rules: {
    Rule(
      <span class="hljs-built_in">RegExp</span>(<span class="hljs-string">r'\d+'</span>),
      onTap: (match) =&gt;
          $message.success(message: <span class="hljs-string">'点击了数字: <span class="hljs-subst">${match.matchedText}</span>'</span>),
    ): numStyle,
    Rule(
      <span class="hljs-built_in">RegExp</span>(<span class="hljs-string">r'\S+@\S+.\S+'</span>),
      onTap: (match) =&gt; <span class="hljs-built_in">print</span>(<span class="hljs-string">'点击了邮箱: <span class="hljs-subst">${match.matchedText}</span>'</span>),
    ): emailStyle,
    Rule(
      <span class="hljs-string">'zdl1994328'</span>,
      onTap: (match) {
        $message.success(message: <span class="hljs-string">'点击了微信号: <span class="hljs-subst">${match.matchedText}</span>'</span>);
      },
    ): weiChatStyle,
  },
  style: <span class="hljs-keyword">const</span> TextStyle(fontSize: <span class="hljs-number">16</span>),
)
</code></pre>
<hr/>
<h4 data-id="heading-6">尾声</h4>
<p>随着 tolyui 的逐步迭代，越来越多的新功能将会支持。感谢你关注 tolyui 的成长，如果喜欢，也希望你能在 github 中点赞支持~</p>
<blockquote>
<p>github 开源地址： <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTolyFx%2Ftoly_ui" title="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTolyFx%2Ftoly_ui" target="_blank">github.com/TolyFx/toly…</a><br/>
TolyUI 官方案例演示网站：<a href="https://link.juejin.cn?target=http%3A%2F%2Ftoly1994.com%2Fui" title="https://link.juejin.cn?target=http%3A%2F%2Ftoly1994.com%2Fui" target="_blank">toly1994.com/ui</a></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端高频面试题之CSS篇（二）]]></title>    <link>https://juejin.cn/post/7577991167201345546</link>    <guid>https://juejin.cn/post/7577991167201345546</guid>    <pubDate>2025-11-30T15:12:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577991167201345546" data-draft-id="7578029829996855346" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" 前端高频面试题之CSS篇（二）"/> <meta itemprop="keywords" content="前端,面试,CSS"/> <meta itemprop="datePublished" content="2025-11-30T15:12:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员小寒"/> <meta itemprop="url" content="https://juejin.cn/user/694547078987287"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             前端高频面试题之CSS篇（二）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/694547078987287/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员小寒
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T15:12:02.000Z" title="Sun Nov 30 2025 15:12:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1、如何实现两栏布局？</h2>
<p>两栏布局指的是<strong>左边宽度固定，右边宽度自适应</strong>。</p>
<p>DOM 结构如下：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"left"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"right"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
</code></pre>
<h3 data-id="heading-1">1.1 利用 flex 布局实现</h3>
<p><strong>实现思路</strong>：将父元素设为 flex 布局，左边元素宽度固定，右边元素设为 flex: 1，即自适应。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">500px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
}
<span class="hljs-selector-class">.left</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">background</span>: yellow;
}
<span class="hljs-selector-class">.right</span> {
  <span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span>;
  <span class="hljs-attribute">background</span>: green;
}
</code></pre>
<p><strong>优点</strong>：布局灵活、响应式布局。</p>
<p><strong>缺点</strong>：IE9 及以下不支持。</p>
<h3 data-id="heading-2">1.2 利用 float 布局实现</h3>
<p><strong>实现思路</strong>：将左边元素设置为浮动元素 <code>float: left</code>，右边元素用 <code>margin-left</code>，这样能让右边元素占据父元素剩余宽度。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">500px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
}

<span class="hljs-selector-class">.left</span> {
  <span class="hljs-attribute">float</span>: left;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">background</span>: yellow;
}

<span class="hljs-selector-class">.right</span> {
  <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">background</span>: green;
}
</code></pre>
<p><strong>优点</strong>：简单、支持 IE。</p>
<p><strong>缺点</strong>：浮动易导致问题（如高度塌陷），不适合复杂布局。</p>
<h3 data-id="heading-3">1.3 利用 Grid 布局实现</h3>
<p><strong>实现思路</strong>：将父元素设为 grid 布局，并设置 <code>grid-template-columns: 200px 1fr</code> 即可。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-number">200px</span> <span class="hljs-number">1</span>fr;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">500px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
}

<span class="hljs-selector-class">.left</span> {
  <span class="hljs-attribute">background</span>: yellow;
}

<span class="hljs-selector-class">.right</span> {
  <span class="hljs-attribute">background</span>: green;
}
</code></pre>
<p><strong>优点</strong>：二维布局强大，实现多栏布局十分方便。</p>
<p><strong>缺点</strong>：IE9 及以下不支持，不适合一维布局。</p>
<h3 data-id="heading-4">1.4 利用 position 绝对定位实现</h3>
<p><strong>实现思路</strong>：父级为相对定位，右边子元素为绝对定位，并同时设置 <code>left、right、top、bottom</code> 值，以实现宽高的自动拉伸。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">500px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
}

<span class="hljs-selector-class">.left</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">background</span>: yellow;
}

<span class="hljs-selector-class">.right</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">background</span>: green;
}
</code></pre>
<p><strong>优点</strong>：可以精确控制位置。</p>
<p><strong>缺点</strong>：脱离文档流，响应式差。</p>
<h2 data-id="heading-5">2、如何实现三栏布局？</h2>
<p>三栏布局指的是页面分为三栏，左侧和右侧固定宽度，中间自适应。</p>
<p>DOM 结构如下：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"left"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"center"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"right"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
</code></pre>
<h3 data-id="heading-6">2.1 利用 flex 布局实现</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">500px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
}

<span class="hljs-selector-class">.left</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">background</span>: yellow;
}

<span class="hljs-selector-class">.center</span> {
  <span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span>;
  <span class="hljs-attribute">background</span>: pink;
}

<span class="hljs-selector-class">.right</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">background</span>: green;
}
</code></pre>
<h3 data-id="heading-7">2.2 利用 float 布局实现</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">500px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
}

<span class="hljs-selector-class">.left</span> {
  <span class="hljs-attribute">float</span>: left;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">background</span>: yellow;
}

<span class="hljs-selector-class">.center</span> {
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">background</span>: pink;
}

<span class="hljs-selector-class">.right</span> {
  <span class="hljs-attribute">float</span>: right;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">background</span>: green;
}
</code></pre>
<p>这里需要注意，<strong>中间栏的 DOM 需要放在最后</strong>，以避免浮动元素影响，所以其 DOM 结构如下：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"left"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"right"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"center"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<h3 data-id="heading-8">2.3 利用 grid 布局实现</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-number">100px</span> <span class="hljs-number">1</span>fr <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">500px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
}

<span class="hljs-selector-class">.left</span> {
  <span class="hljs-attribute">background</span>: yellow;
}

<span class="hljs-selector-class">.center</span> {
  <span class="hljs-attribute">background</span>: pink;
}

<span class="hljs-selector-class">.right</span> {
  <span class="hljs-attribute">background</span>: green;
}
</code></pre>
<h3 data-id="heading-9">2.4 利用 position 绝对定位实现</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">500px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
}

<span class="hljs-selector-class">.left</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">background</span>: yellow;
}

<span class="hljs-selector-class">.center</span> {
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">background</span>: pink;
}

<span class="hljs-selector-class">.right</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">background</span>: green;
}
</code></pre>
<h3 data-id="heading-10">2.5 经典三栏布局之圣杯布局</h3>
<p>圣杯布局实现三列布局左右列固定宽度、中间列自适应，其原理是通过<strong>相对定位和负边距</strong>来实现侧边栏的定位。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
  <span class="hljs-selector-class">.box</span> {
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">150px</span> <span class="hljs-number">0</span> <span class="hljs-number">200px</span>;
  }

  <span class="hljs-selector-class">.wrapper</span><span class="hljs-selector-pseudo">::after</span> {
    <span class="hljs-attribute">display</span>: table;
    <span class="hljs-attribute">content</span>: <span class="hljs-string">''</span>;
    <span class="hljs-attribute">clear</span>: both;
  }

  <span class="hljs-selector-class">.column</span> {
    <span class="hljs-attribute">float</span>: left;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
  }

  <span class="hljs-selector-class">.left</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;
    <span class="hljs-attribute">position</span>: relative;
    <span class="hljs-attribute">margin-left</span>: -<span class="hljs-number">100%</span>;
    <span class="hljs-attribute">right</span>: <span class="hljs-number">200px</span>;
    <span class="hljs-attribute">background-color</span>: aqua;
  }

  <span class="hljs-selector-class">.center</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
    <span class="hljs-attribute">background-color</span>: red;
  }

  <span class="hljs-selector-class">.right</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">150px</span>;
    <span class="hljs-attribute">margin-right</span>: -<span class="hljs-number">150px</span>;
    <span class="hljs-attribute">background-color</span>: green;
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 中间列 center 放第一个是为了在文档流中优先渲染，因为 DOM 是从上往下依次渲染的--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"center column"</span>&gt;</span>center<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"left column"</span>&gt;</span>left<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"right column"</span>&gt;</span>right<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
</code></pre>
<h3 data-id="heading-11">2.6 经典三栏布局之双飞翼布局</h3>
<p>双飞翼布局实现三列布局左右列固定宽度、中间列自适应，其原理是通过使用嵌套的 <code>div</code> 元素来实现侧边栏的定位，以及使用<strong>负外边距</strong>将主内容区域撑开。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
  <span class="hljs-selector-class">.box</span> {
    <span class="hljs-attribute">background-color</span>: red;
    <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  }

  <span class="hljs-selector-class">.column</span> {
    <span class="hljs-attribute">float</span>: left;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
  }

  <span class="hljs-selector-class">.center</span> {
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> <span class="hljs-number">150px</span> <span class="hljs-number">0</span> <span class="hljs-number">200px</span>;
  }

  <span class="hljs-selector-class">.left</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;
    <span class="hljs-attribute">background-color</span>: aqua;
    <span class="hljs-attribute">margin-left</span>: -<span class="hljs-number">100%</span>;
  }

  <span class="hljs-selector-class">.right</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">150px</span>;
    <span class="hljs-attribute">background-color</span>: green;
    <span class="hljs-attribute">margin-left</span>: -<span class="hljs-number">150px</span>;
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box column"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"center"</span>&gt;</span>center<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"left column"</span>&gt;</span>left<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"right column"</span>&gt;</span>right<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
</code></pre>
<h2 data-id="heading-12">3、如何实现水平垂直居中？</h2>
<h3 data-id="heading-13">3.1 文本类可以使用 <code>line-height</code> 和 <code>text-align</code></h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">line-height</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">text-align</span>: center;
}
</code></pre>
<h3 data-id="heading-14">3.2 使用 flex 布局</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">justify-content</span>: center;
  <span class="hljs-attribute">align-items</span>: center;
}
</code></pre>
<h3 data-id="heading-15">3.3 使用绝对定位 postion + transform/负 margin</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.parent</span> {
  <span class="hljs-attribute">position</span>: relative;
}
<span class="hljs-selector-class">.child</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">50%</span>;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">50%</span>;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translate</span>(-<span class="hljs-number">50%</span>, -<span class="hljs-number">50%</span>);
}
</code></pre>
<p>当元素固定宽度时，也可以用 <code>负 margin</code> 替代 <code>transform</code>。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.parent</span> {
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">background-color</span>: red;
}

<span class="hljs-selector-class">.child</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">50px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">50px</span>;
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">50%</span>;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">50%</span>;
  <span class="hljs-attribute">margin-top</span>: -<span class="hljs-number">25px</span>; <span class="hljs-comment">/* 自身容器高度的一半 */</span>
  <span class="hljs-attribute">margin-left</span>: -<span class="hljs-number">25px</span>; <span class="hljs-comment">/* 自身容器宽度的一半 */</span>
  <span class="hljs-attribute">background-color</span>: green;
}
</code></pre>
<h3 data-id="heading-16">3.4 使用 absolute + margin: auto</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">position</span>: absolute; 
  inset: <span class="hljs-number">0</span>; 
  <span class="hljs-attribute">margin</span>: auto
}

</code></pre>
<h3 data-id="heading-17">3.5 使用 Grid 布局</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.box</span> {
 <span class="hljs-attribute">display</span>: grid; 
 place-items: center;
}

</code></pre>
<h3 data-id="heading-18">3.6 使用 table 布局</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.box</span> {
 <span class="hljs-attribute">display</span>: table-cell;
 <span class="hljs-attribute">vertical-align</span>: middle;
}

</code></pre>
<h2 data-id="heading-19">4、实现一个三角形</h2>
<h3 data-id="heading-20">4.1 利用 border</h3>
<p>在 CSS 中，实现三角形最常见的方法是利用元素的**边框（border）**属性。通过设置元素的宽度和高度为 0，然后调整边框的宽度和颜色，可以形成各种方向的三角形。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.triangle</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">border-left</span>: <span class="hljs-number">10px</span> solid transparent;  <span class="hljs-comment">/* 左透明 */</span>
  <span class="hljs-attribute">border-right</span>: <span class="hljs-number">10px</span> solid transparent; <span class="hljs-comment">/* 右透明 */</span>
  <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">30px</span> solid red;       <span class="hljs-comment">/* 底有颜色，形成向上三角 */</span>
}

</code></pre>
<h3 data-id="heading-21">4.2 使用 clip-path</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.triangle</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">background</span>: purple;
  <span class="hljs-attribute">clip-path</span>: <span class="hljs-built_in">polygon</span>(<span class="hljs-number">50%</span> <span class="hljs-number">0%</span>, <span class="hljs-number">0%</span> <span class="hljs-number">100%</span>, <span class="hljs-number">100%</span> <span class="hljs-number">100%</span>);  <span class="hljs-comment">/* 向上三角 */</span>
}
</code></pre>
<h2 data-id="heading-22">5、实现一个扇形</h2>
<p>在上面画三角形的基础上，再增加样式 <code>border-radius: 100%;</code>即可实现一个扇形。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.sector</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">border-left</span>: <span class="hljs-number">10px</span> solid transparent;
  <span class="hljs-attribute">border-right</span>: <span class="hljs-number">10px</span> solid transparent;
  <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">30px</span> solid red;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">100%</span>; <span class="hljs-comment">/* 增加 border-radius */</span>
}
</code></pre>
<h2 data-id="heading-23">6、实现一个梯形</h2>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">60px</span>;
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">32px</span> auto;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">60px</span>;
  <span class="hljs-attribute">text-align</span>: center;
}

<span class="hljs-selector-class">.box</span><span class="hljs-selector-pseudo">::before</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-string">''</span>;
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">background</span>: red;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">perspective</span>(.<span class="hljs-number">5em</span>) <span class="hljs-built_in">rotateX</span>(<span class="hljs-number">5deg</span>);
}
</code></pre>
<h2 data-id="heading-24">7、画一条 0.5px 的线</h2>
<p>对于大部分普通屏幕来说，像素是最小的显示单位，因此定义 0.5px 是没有意义的，浏览器遇到小于 1px 时会向上取整渲染 1px，这个是浏览器渲染的局限性。</p>
<p>但是在一些高分辨率屏幕（如 Retina 屏幕）上，1 物理像素点可以被分成多个虚拟像素（比如 2x 屏幕将每个物理像素分为 4 个虚拟像素）。这样的话，1px 的物流像素就等于 2 个虚拟像素，所以 0.5px 也能被渲染出来。</p>
<p>所以对于普通屏幕来说，我们需要做一些兼容方案来渲染出 0.5px 的效果。</p>
<p>我们可以使用 <code>CSS transform 缩放法</code> 来实现 0.5px 的线，代码如下：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.line</span> {
  <span class="hljs-attribute">height</span>: <span class="hljs-number">1px</span>;
  <span class="hljs-attribute">background-color</span>: red;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scaleY</span>(<span class="hljs-number">0.5</span>); <span class="hljs-comment">/* 对高度进行垂直方向的缩放 */</span>
}

</code></pre>
<h2 data-id="heading-25">小结</h2>
<p>上面是整理的前端面试关于 CSS 高频考察的布局和图形，如有错误或者可以优化的地方欢迎评论区指正。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[昨天分享了一套用 Nano Banana PRO做商业 PPT 定制的玩法，还推荐直接去咸鱼接单搞钱。]]></title>    <link>https://juejin.cn/post/7577713754564558900</link>    <guid>https://juejin.cn/post/7577713754564558900</guid>    <pubDate>2025-11-30T14:24:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577713754564558900" data-draft-id="7577957806210236431" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="昨天分享了一套用 Nano Banana PRO做商业 PPT 定制的玩法，还推荐直接去咸鱼接单搞钱。"/> <meta itemprop="keywords" content="OpenAI,AI编程"/> <meta itemprop="datePublished" content="2025-11-30T14:24:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="饼干哥哥"/> <meta itemprop="url" content="https://juejin.cn/user/2001569972490973"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            昨天分享了一套用 Nano Banana PRO做商业 PPT 定制的玩法，还推荐直接去咸鱼接单搞钱。
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2001569972490973/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    饼干哥哥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T14:24:19.000Z" title="Sun Nov 30 2025 14:24:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>但有人说没有渠道、不知道怎么弄。。。</p>
<p>欸我还能说什么呢？只能是把做小生意的完整逻辑给大家讲一遍，包括：🧵- 怎么选择赛道？</p>
<ul>
<li>公域流量：闲鱼实操、小红书怎么玩、公众号机会</li>
<li>私域谈单 SOP
—、先讲一下认知：什么是 中介思维（Agent Thinking）</li>
</ul>
<p>很多职场人或想要做副业的小白，最大的误区是觉得自己“必须先成为专家”才能赚钱。想做 PPT 代写觉得要设计大师，想做数据分析觉得要代码精通。这种思维导致你陷入技能学习的无底洞，或者单纯靠堆砌自己的时间去赚钱，不仅累，而且上限很低。一旦停下来，收入就断了。</p>
<p>生意的本质不是“自己做”，而是“做链接”。你要从一个“供给方”（苦哈哈写稿的人）转变为“链接者”（生意操盘手）。</p>
<ul>
<li>
<p>供给方（后端）： 可以是 AI（现在的 Claude 3.5、GPT-4o 非常强），也可以是你在 Boss 直聘、闲鱼上招募的兼职写手（大学生、专业人士）。</p>
</li>
<li>
<p>需求方（前端）： 是焦虑的小学生家长（要写演讲稿）、忙碌的老师（要写评语）、求职者（要改简历）。</p>
</li>
</ul>
<p>你做什么？ 你负责搞流量、促转化。你赚的是信息差和服务的钱，而不是卖体力的钱。</p>
<p>【关键动作】</p>
<ul>
<li>
<p>脱离“手艺人”心态： 即使你自己会做（比如我会数据分析），也要尽量外包。因为你的时间应该花在更值钱的“搞流量”和“谈单”上。</p>
</li>
<li>
<p>万能公式： 无论是演讲稿、PPT、甚至是编程、爬虫，只要你懂需求，不懂技术也能接单。接到单子，转手交给后端（AI 或人）去交付。</p>
</li>
<li>
<p>利用 AI 杠杆： 对于简单的需求（如演讲稿、检讨书、公文），直接用 AI（如 Claude 4.5）作为你的零成本劳动力，实现几乎 100% 的利润率;对于复杂的（如论文辅导），做中介分包。
二、全貌概览：7 天跑通生意闭环，告别“只有想法没有行动”</p>
</li>
</ul>
<p>要在极短周期内（比如 7 天）验证一个生意能不能赚钱。如果一周内能赚到几十块钱，这个逻辑就是通的，哪怕只有几十块，也比你空想一年强。一个完整的生意必须包含四个环节，缺一不可。</p>
<p>【关键动作】</p>
<ul>
<li>
<p>选择赛道（找买家）： 不要先想卖什么，要先看市场在买什么。</p>
</li>
<li>
<p>建立销路（搞流量）：
闲鱼： 变现最快，不用养号，适合小白第一周直接出单。
小红书： 2025 年趋势，适合做体量，但需要运营。
公众号： 适合做深度的私域流量和复购。</p>
</li>
<li>
<p>私域谈单（做销售）： 流量来了必须承接。会谈单和不会谈单，收入能差 10 倍。要把公域流量（闲鱼、小红书）尽可能引流到微信私域。</p>
</li>
<li>
<p>后端交付（做产品）： 早期自己用 AI 交付（低成本），后期在 Boss 直聘找人交付（做规模）。</p>
</li>
</ul>
<p>怎么做？
不用追求每个环节都满分。作为个人创业者，你先把这个闭环跑通一遍。哪里卡住了（比如流量不够或交付太累），就针对性地用 AI 工具去解决那个环节的问题（用 AI 写文案、用 AI 做客服话术、用 AI 搞定交付）。
三、赛道选择：别自作聪明，做生意的第一步是“像素级模仿”</p>
<p>新手最大的坑就是“自嗨”。觉得自己有个绝妙的 idea，市场上没人做，一定能火。千万别做这种生意！市场上没人做通常意味着“没需求”或者“坑太大”。</p>
<p>【核心逻辑】 市场 &gt; 产品。
先找买家，再找产品。不要去淘宝找对标（因为淘宝只能看到销量结果，看不到操作过程），要去内容平台（小红书）找对标。因为在小红书上，你能看到一个同行是怎么从 0 开始发笔记、怎么改标题、怎么引流的全过程。</p>
<p>【关键动作】</p>
<ul>
<li>
<p>生意不要太大： 普通人要解决具体的、微小的痛点。比如“AI 代写”就很大，但“小学生演讲稿代写”就很具体，越具体越好做。</p>
</li>
<li>
<p>像素级模仿（抄）： 找到同行后，甚至不要有自己的想法。✅同行错了，你跟着一起错： 很多时候同行写错别字、用很笨的图，是为了规避平台违规机制。你自作聪明改对了，反而可能被封号。✅复制路径： 看他发什么火了，你发同样结构的；看他主页怎么设置，你照搬。</p>
</li>
<li>
<p>用 AI 辅助调研： 直接把同行的内容投喂给 AI，让 AI 帮你分析这个赛道的市场规模、用户痛点和竞争环境（利用分享中的 AI 调研提示词）。
四、闲鱼实操：读懂这 5 个数据，你的闲鱼就能爆单</p>
</li>
</ul>
<p>很多人做闲鱼不出单，是因为把闲鱼当成了“卖二手货”的地方，随手一挂就等着。其实闲鱼已经是国内最大的服务交易平台，必须用做电商的逻辑去运营。</p>
<p>【核心逻辑】 流量漏斗分析。
闲鱼的核心数据只有 5 个：曝光 → 浏览 → 想要 → 下单 → 评价。每一个环节的流失都有原因。其中最重要的是“想要数”（咨询量）。</p>
<p>【关键动作】</p>
<ul>
<li>
<p>提升点击（曝光到浏览）：
主图： 用聊天记录截图形式的主图，比精美的海报更真实、点击率更高。
地址： 别填十八线小城市。地址选一二线城市（北上广深），流量更大；做留学生生意就把地址定在海外。</p>
</li>
<li>
<p>提升咨询（浏览到想要）：
文案： 强调“个人非中介”、“研究生学长”等人设，打消用户怕中间商赚差价的心理。
刷数据： “想要数”代表羊群效应。如果你的想要数是 0，没人敢买。前期必须找人补单、补“想要”，数据好看了流量才会进来。</p>
</li>
<li>
<p>促成下单与好评：
每一单成交后，主动索要好评。
降价策略： 当客户砍价时，不要轻易答应。要说“给你便宜 20 块，但你得给我写个好评”。这样既保住了面子，又赚到了数据。
五、小红书运营：2025 年自然流腰斩，普通人必须做“小矩阵”</p>
</li>
</ul>
<p>小红书变了。2024 年之前随便发发都有流量，但现在自然流被腰斩，单号很难做起来。很多人发了几十篇笔记，小眼睛始终不过百，心态崩了。</p>
<p>【核心逻辑】暴力起号 + 小矩阵 + SEO 长尾词。
既然单号流量不稳定，就要靠数量取胜。普通人做不了百号矩阵，但一个人做 5-10 个号的小矩阵是完全可行的。利用 AI 降低内容生产成本，去铺搜索流量。</p>
<p>【关键动作】</p>
<ul>
<li>
<p>暴力起号（泛垂直流量）： 起号阶段不要只发干货。要发“泛垂直”内容（如大学生赛道，就发大学生爱看的吃喝玩乐或吐槽），先把账号权重拉起来，有了几千赞藏的基础，再发广告才安全。</p>
</li>
<li>
<p>244 笔记结构：
20% 权重笔记： 泛流量，保住账号活跃度。
40% 人设笔记： 晒学历、晒奖状、晒日常，建立信任感（让用户觉得你是活人）。
40% 产品/干货笔记： 硬广或干货，直接转化。</p>
</li>
<li>
<p>AI 自动化铺长尾词：
人工写：力求 80 分，精细打磨，做推荐流量。
AI 写： 60 分万岁。利用 AI 批量生产内容，覆盖各种长尾词（如“春节演讲稿”、“元宵节演讲稿”）。只要能被搜索到，小眼睛超过 100 就算成功。
六、公众号蓝海：被忽视的第二流量来源，高客单转化的秘密</p>
</li>
</ul>
<p>大家都盯着小红书抖音，觉得公众号是“古典自媒体”，没人看了。大错特错！对于做服务、做代写、做知识付费的人来说，公众号现在的搜索流量（SEO）非常猛。</p>
<p>【核心逻辑】 搜一搜流量 + 信任背书。
微信公众号文章在微信“搜一搜”里的权重极高。用户在微信搜“论文查重”、“数据分析”时，出来的文章往往精准度极高。而且，能沉淀到公众号的用户，付费意愿和信任度远高于其他平台。</p>
<p>【关键动作】</p>
<ul>
<li>
<p>布局 SEO： 你的文章标题和内容要包含用户会搜索的关键词。不要起那种文绉绉的标题，要直白（如《研究生论文查重怎么搞？推荐这 3 个工具》）。</p>
</li>
<li>
<p>承接流量： 在闲鱼和小红书做泛流量，把想要深入了解的用户引流到公众号。</p>
</li>
<li>
<p>建立信任锚点： 公众号适合发长文、发深度复盘。一篇几千字的干货文章，能瞬间立住你的“专家”人设。</p>
</li>
<li>
<p>转化路径： 既然是做生意，公众号文章底部一定要留钩子（加微信、领资料），直接导流到个人号成交。现在的公众号，1 万阅读带来的变现价值，可能超过抖音 10 万播放。
七、私域成交销售五步法：如何把 400 的单子谈成 800？</p>
</li>
</ul>
<p>流量来了，加上微信了，结果聊两句客户就跑了；或者客户一直砍价，最后你含泪赚个辛苦钱。这是典型的“客服思维”，不是“销售思维”。</p>
<p>【核心逻辑】销售 SOP + 价格锚定 + 敢于成交。
销售不是闲聊，每一步都要有目的。目的是为了识别需求、拉高客单价、快速收钱。</p>
<p>【关键动作】</p>
<ul>
<li>
<p>开场白（减少成本）： 加上好友直接发模板：“我是谁，请告诉我你的身份、文章类型、具体要求、截止时间。” 只有回答了这些的人才是精准客户，不回的白嫖党直接过滤。</p>
</li>
<li>
<p>挖需求（看人下菜碟）： 翻翻他朋友圈。如果是经常出国旅游的、手机号带 5 个 8 的，或者留学生、艺术生，这些人不差钱，报价可以大胆往上提。</p>
</li>
<li>
<p>报价（高价锚定）： 这是核心技巧！ 即使你想卖 400，也要报两个价：“本科老师代写 400/小时，博士老师代写 800/小时（质量更高）”。哪怕客户最后选了 400，他也会觉得占了便宜；而很多追求质量的客户会直接选 800，你的利润瞬间翻倍。</p>
</li>
<li>
<p>缔结（敢于逼单）： 聊差不多了，直接问：“今天安不安排？” 尽量不要过夜。客户隔一个晚上可能就找别人了，或者自己不想弄了。</p>
</li>
<li>
<p>异议处理： 客户嫌贵、嫌麻烦，用准备好的话术（或直接丢给 AI 生成回复）解决，然后立刻绕回第 4 步：“那现在安不安排？”
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/830cdc56fd0f4739aafc854423d8ad4c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aW85bmy5ZOl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765117459&amp;x-signature=8yzYVV4UNYkJ0UC2iMEOLFe67AE%3D" alt="昨天分享了一套用 Nano Banana PRO做商业 PPT 定制的玩法，还推荐直接去咸鱼接单搞钱。1.jpg" loading="lazy"/></p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/07de2cb2b1a74c0681433e710dfff009~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aW85bmy5ZOl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765117459&amp;x-signature=%2FncEWkNR%2BnXZTkedowBA7Ri%2FP%2FQ%3D" alt="昨天分享了一套用 Nano Banana PRO做商业 PPT 定制的玩法，还推荐直接去咸鱼接单搞钱。2.jpg" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6fb227b88ee54d0fa809033b1fb75481~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aW85bmy5ZOl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765117459&amp;x-signature=Z9SvrAf%2Fg34tXzbOWrxN3UuuVAM%3D" alt="昨天分享了一套用 Nano Banana PRO做商业 PPT 定制的玩法，还推荐直接去咸鱼接单搞钱。3.jpg" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4eb1ddb0352c401899ca9e03997f51f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aW85bmy5ZOl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765117459&amp;x-signature=3%2FTrQpvNRaFC%2FqDZz0QG1Q9531c%3D" alt="昨天分享了一套用 Nano Banana PRO做商业 PPT 定制的玩法，还推荐直接去咸鱼接单搞钱。4.jpg" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd6e45fe06494bf290960105ac979d21~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aW85bmy5ZOl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765117459&amp;x-signature=BryBG3WmqJnMW5%2BOc8G%2Bqgh8ICY%3D" alt="昨天分享了一套用 Nano Banana PRO做商业 PPT 定制的玩法，还推荐直接去咸鱼接单搞钱。5.jpg" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df0168ef8bf64d39bd21b9b06b4401f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aW85bmy5ZOl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765117459&amp;x-signature=66AGymwVG9mRQHiAt7PjOa3TiQ8%3D" alt="昨天分享了一套用 Nano Banana PRO做商业 PPT 定制的玩法，还推荐直接去咸鱼接单搞钱。6.jpg" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4dc4425b1744406f9793ae52434108cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aW85bmy5ZOl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765117459&amp;x-signature=%2FTPzyyLBEkzBOIHCTVGdLXwbAxg%3D" alt="昨天分享了一套用 Nano Banana PRO做商业 PPT 定制的玩法，还推荐直接去咸鱼接单搞钱。7.jpg" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[这款AI工具太惊喜了！1分钟生成精美长图，自由编辑像改PPT！（附保姆级教程）]]></title>    <link>https://juejin.cn/post/7577958825342795795</link>    <guid>https://juejin.cn/post/7577958825342795795</guid>    <pubDate>2025-11-30T13:35:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577958825342795795" data-draft-id="7577905525998125097" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="这款AI工具太惊喜了！1分钟生成精美长图，自由编辑像改PPT！（附保姆级教程）"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2025-11-30T13:35:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员X小鹿"/> <meta itemprop="url" content="https://juejin.cn/user/2928754709505608"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            这款AI工具太惊喜了！1分钟生成精美长图，自由编辑像改PPT！（附保姆级教程）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2928754709505608/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员X小鹿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T13:35:03.000Z" title="Sun Nov 30 2025 13:35:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是X小鹿。前几天刷视频，刷到了一款 AI 工具。</p>
<p>起初是被它「一键生成长图」的视频吸引过去的，后来点进账号主页看了下。</p>
<p>发现不管是用它来生成<code>科普图文</code>、<code>社群早报</code>、<code>读书笔记摘要</code>，还是<code>知识卡片</code>、<code>易拉宝</code>、<code>海报</code>、<code>财报长图</code>等，效果都很赞。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c156c2d473fb44de9447e8c45689a8a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765114503&amp;x-signature=nI4ZaYy4oJZ1HTuGErsX46Z3E0A%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/713584c5d89644299a1f58dfec46f325~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765114503&amp;x-signature=Zd8CUGDoY6nGYNVcLIKPuYVfEwg%3D" alt="图片" loading="lazy"/></p>
<p>比如想生成「读书笔记摘要」或「AI 早报」等，只需要把文案输进去，它就能自动完成需求分析、布局、设计、图像处理等，最终返回几张视觉风格还不错的图片。</p>
<p>更关键点是：<strong>生成的图片全部可以编辑！</strong></p>
<blockquote>
<p>也就是说，你可以像改 PPT 一样，来随意修改图片中的文字、图片、图标等，也可以自由拖动他们的位置。</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f67d2949f7f24b7da5809d890f945f96~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765114503&amp;x-signature=4b6JlN4KPOHJPr4fERzHd3dp57I%3D" alt="图片" loading="lazy"/></p>
<p>这个 AI 工具叫 <strong>Seede AI</strong>，一款适合普通用户上手的 AI 设计工具。（国内可用）</p>
<p>整体使用体验还不错，分享给大家。</p>
<p>下面用一个例子来看看 Seede AI 具体使用吧。</p>
<h2 data-id="heading-0">一、Seede AI 使用教程</h2>
<p>我们以生成一个关于台风的「科普图文」来举例说明 Seede AI 的使用。</p>
<p>打开 Seede AI，使用手机号或邮箱注册即可。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fseede.ai%2Fsign-up%3FinviteCode%3DA34LNT" target="_blank" title="https://seede.ai/sign-up?inviteCode=A34LNT" ref="nofollow noopener noreferrer">seede.ai/sign-up?inv…</a></p>
<p>注册时邀请码填 A34LNT，还可以额外获得一些使用额度，能免费多生成几次。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/217350827d7d42b0b9f93b0b9eb28c37~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765114503&amp;x-signature=E2zPFJuEsxMJLAkkTdfhZUMd%2B60%3D" alt="图片" loading="lazy"/></p>
<p>Seede AI 的使用很简单，<code>选择图片类型 + 输入需求</code>，就可以生成了。</p>
<p><strong>1、图片类型</strong></p>
<p>Seede AI 支持多种图片类型，比如长图、海报、社媒图文、流程图、易拉宝、知识卡片、公众号封面等。</p>
<p>制作科普图文，这里我们选「长图」。</p>
<p><strong>2、需求描述</strong></p>
<p>Seede AI 不需要写复杂的提示词，只需要描述清需求就行。</p>
<p>比如你可以直接输入：<code>生成一个台风科普图文，图文并茂</code>，Seede AI 就开始生成了。</p>
<p>如果你有详细的文案，可以直接粘贴到下面，这样 Seede AI 就会根据我们提供的文案来生成了。</p>
<p>比如下面这样：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6cf19b59ef044847bdc5694b73b52d86~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765114503&amp;x-signature=xrxFoq3DzK2QwNxDPi3xOLULXbU%3D" alt="图片" loading="lazy"/></p>
<h3 data-id="heading-1">1、更多参数设置</h3>
<p>下面也可以设置一些参数，简单介绍下。</p>
<p><strong>1、附件（可选）</strong></p>
<p>Seede AI 支持上传图片或 PDF、Word 等文档作为参考。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ff9a5b5188c4475bd633fcb59a620c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765114503&amp;x-signature=cGzqAyvAvXlnIp3CXiH68SwIRRc%3D" alt="图片" loading="lazy"/></p>
<p>上传后，可以选择参考的要素。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0088433c04ae4081a68594b192c14186~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765114503&amp;x-signature=dFIoc%2BN4dLoT6lE522TT%2FacTKeI%3D" alt="图片" loading="lazy"/></p>
<p>比如关于台风科普的介绍是在 Word 里，那么我们上传 Word 后，参考特征可以选择「文案」。</p>
<p><strong>2、图片尺寸</strong></p>
<p>Seede AI 支持社媒、设备屏幕、印刷品等常见尺寸。</p>
<p>如果没有找到，也可以点「添加自定义尺寸」。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/82c24505013846b783b30d4b1646abfc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765114503&amp;x-signature=Bqk54AGKN2Xb6dkUR%2F0CcQCw950%3D" alt="图片" loading="lazy"/></p>
<p><strong>3、主题配色</strong></p>
<p>Seede AI 支持多种配色，也可以自定义。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3cf70cb63d7f46f6bb5662d1beea1fd9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765114503&amp;x-signature=PjFcxAlOLM3Ry685RiysxlQz7Rk%3D" alt="图片" loading="lazy"/></p>
<p><strong>4、模型选择</strong></p>
<p>Seede AI 支持国内外多种主流的大模型。</p>
<p>最近谷歌新上的 Gemini 3 Pro，Seede AI 也接入了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e37554710de24b949989b922104949bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765114503&amp;x-signature=VocCuTc%2BT5IONZ8B6vsU%2Bee6VfM%3D" alt="图片" loading="lazy"/></p>
<p><strong>5、数量 &amp; 可见范围</strong></p>
<p>数量和可见范围，根据自己需求选即可。</p>
<p>设置完成后，点发送就可以等待生成了。</p>
<p>在发送按钮上的数字角标，是 Seede AI 本次生成需要消耗的额度。</p>
<h3 data-id="heading-2">2、编辑</h3>
<p>Seede AI 的生成速度很快。生成完成后，点侧边栏的编辑，可以对生成好的图片进行细节的调整。</p>
<p>Seede AI 生成的图片，画面上所有元素都可以编辑。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93fbf3ac9dbe4f7fab13b329143d7a56~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765114503&amp;x-signature=xk98UWZl6ktmmQ7nqmY%2Bx2xfL8A%3D" alt="图片" loading="lazy"/></p>
<p>包括文字内容、文字样式（字体、字号、颜色等）、图片、小图标、背景等等。</p>
<p>而且元素也可以随意拖动位置。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/62c76dc189fd4664a1b1535187280b0e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765114503&amp;x-signature=bOh9xoU894RuhP9A3L%2BQ%2BY0AOBI%3D" alt="图片" loading="lazy"/></p>
<p>修改完成后，点右上角的「导出」，就可以下载到本地了。</p>
<h2 data-id="heading-3">二、生成效果展示</h2>
<p>下面是 Seede AI 生成的关于台风的科普长文。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/169db8b064e84107be03a51090c44f8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765114503&amp;x-signature=m4cPgvxq4D1k34IIlpDfUoktnGc%3D" alt="图片" loading="lazy"/></p>
<p>这个排版、布局、配色，可以说相当满意了。</p>
<p>而且长图中的文字说明，是根据之前输入的文案来写的。</p>
<h2 data-id="heading-4">三、写在最后</h2>
<p>Seede AI 除了可以用来生成科普图文，像知识卡片、早报、流程图、菜单、邀请函、各种场景的海报、易拉宝等场景，都是可以的。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2812a5188a7c4409a2deebc2715a14bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765114503&amp;x-signature=pbglnT%2BKnQK4NTOf6V2aMNfx5OA%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5652f4fb0323480aa27ed464c3ba956a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765114503&amp;x-signature=WPcOUmOiLlgiHLUzAtwZfg%2FkwB8%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c84b9d4e40e34a4881219895bedbe73c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765114503&amp;x-signature=xC9yvBdgqsj7jeLTdzsyMx3cujk%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca41f22b00054df5a2726aaa39462ca5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765114503&amp;x-signature=ASJkelnswStDnjSzCNd1oZH%2Bk5Y%3D" alt="图片" loading="lazy"/></p>
<p>Seede AI 整体使用体验还是非常不错的，非常适合普通人上手。</p>
<p>日常遇到要出图的场景，很方便。而且 Seede AI 目前每天都会赠送一些免费额度。</p>
<p>分享给大家，感兴趣的可以试试。</p>
<hr/>
<blockquote>
<p>我是<a href="https://juejin.cn/user/2928754709505608/posts" title="https://juejin.cn/user/2928754709505608/posts" target="_blank">程序员X小鹿</a>，前互联网大厂程序员，也是一名 AIGC 爱好者，持续分享更多好用的 AI 工具，欢迎一起交流~</p>
</blockquote>
<p><strong>推荐阅读</strong></p>
<p><a href="https://juejin.cn/post/7454501732203610131" title="https://juejin.cn/post/7454501732203610131" target="_blank">2024年终AI工具汇总：9大AI领域，70+精选AI工具，全都在这了！(建议收藏)</a></p>
<p>更多 AI 工具见<a href="https://juejin.cn/column/7284164153576947724" title="https://juejin.cn/column/7284164153576947724" target="_blank">【AI工具】</a>专栏，持续更新中。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[告别繁琐部署：TRAE SOLO 帮我一键跑通 Z-Image 模型]]></title>    <link>https://juejin.cn/post/7577958825342828563</link>    <guid>https://juejin.cn/post/7577958825342828563</guid>    <pubDate>2025-11-30T13:43:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577958825342828563" data-draft-id="7577958825342812179" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="告别繁琐部署：TRAE SOLO 帮我一键跑通 Z-Image 模型"/> <meta itemprop="keywords" content="Trae,Solo,人工智能"/> <meta itemprop="datePublished" content="2025-11-30T13:43:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="飞哥数智谈"/> <meta itemprop="url" content="https://juejin.cn/user/3825956195409223"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            告别繁琐部署：TRAE SOLO 帮我一键跑通 Z-Image 模型
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3825956195409223/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    飞哥数智谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T13:43:30.000Z" title="Sun Nov 30 2025 13:43:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近，通义在“万相”系列之外，又放出了一个新的图像生成模型<code>Z-Image</code>，在 <code>H800 GPU</code> 上可实现<strong>亚秒级推理</strong>延迟，而在 16G 显存的消费级显卡上也可流畅运行！这不得抓紧时间试试。</p>
<p>之前每次尝试新模型都要查文档、配环境、装依赖、调版本，各种问题来来回回花好久。</p>
<p>幸好前几天，我们已经基于 <code>TRAE SOLO</code> 尝试过 AI 自主搭建模型服务。</p>
<p>《<a href="https://juejin.cn/post/7576821684252475435" target="_blank" title="https://juejin.cn/post/7576821684252475435">给 TRAE SOLO 一台服务器，它能干什么？ - 掘金</a>》</p>
<p>今天，我们再拿 <code>Z-Image</code> 试试效果。</p>
<h2 data-id="heading-0">Z-Image</h2>
<p>先来简单了解下 <code>Z-Image</code>。</p>
<p><code>Z-Image</code> 采用了一种可扩展的单流 DiT（S3-DiT）架构。在这种设置中，文本、视觉语义标记和图像VAE标记在序列级别上连接起来，作为统一的输入流，与双流方法相比，最大化了参数效率。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d75a88cc4b544780aaa376c27f1de1d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765115009&amp;x-signature=Uz5MLjyCaQn2983mXBQ55vaUL1s%3D" alt="" loading="lazy"/></p>
<p>根据基于 <code>Elo</code> 的人类偏好评估（在AI Arena上），<code>Z-Image-Turbo</code> 相对于其他领先模型表现出极高的竞争力，同时在开源模型中取得了最先进的结果。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b3c23f0e8f442c8bffa9922e2a3ec89~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765115009&amp;x-signature=huWfTD0YVPHMXyZOlU6KHGl0kBA%3D" alt="" loading="lazy"/></p>
<p>该系列共包含 3 个模型：</p>
<ul>
<li><strong>Z-Image-Turbo</strong>：<code>Z-Image</code> 的精简版，仅用 8 NFEs（函数评估次数）就能与领先的竞争对手匹敌或超越。</li>
<li><strong>Z-Image-Base</strong>：非精简的基础模型，旨在解锁社区驱动的微调和自定义开发的全部潜力。<strong>当前尚未发布</strong>。</li>
<li><strong>Z-Image-Edit</strong>：专门针对图像编辑任务进行微调的 Z-Image 变体。支持创意的图像到图像生成，并具有令人印象深刻的指令遵循能力，允许基于自然语言提示进行精确编辑。<strong>当前尚未发布</strong>。</li>
</ul>
<h2 data-id="heading-1">前期准备</h2>
<p>开始搭建前，需要准备好以下内容，如有疑问，可以看之前的分享。</p>
<ol>
<li>准备好 1 个没有什么重要内容的服务器，可以是云服务器、算力租用，或者自行搭建的 docker 服务。</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97104f12665047dfb346c80966178570~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765115009&amp;x-signature=9EUQC1wHHJx%2F6FQDILfm3cx41o0%3D" alt="" loading="lazy"/></p>
<ol start="2">
<li>
<p>TRAE SOLO 模式可用，IDE 模式理论上也可以，但是需要人一直盯着，并且出现问题还需要人工干涉，失去了 AI 自主搭建的优势。</p>
</li>
<li>
<p>使用 TRAE 远程连接上服务器。</p>
</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf929bb288b24a0ab20c5b23237a813b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765115009&amp;x-signature=AoVxibt4hrea1dasY%2FCTStx4pvI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">实操记录</h2>
<p>今天的实操场景，我们就直接选择<strong>糖果包装生成</strong>。</p>
<h3 data-id="heading-3">环境搭建及初版demo</h3>
<p><strong>指令</strong></p>
<p>大家可以直接参考下方完整指令。</p>
<ul>
<li>Z-Image 的参考文档。</li>
<li>任务目标：安装并实现糖果包装demo。</li>
<li>demo相关要求，比如图片生成维护，方便查找。</li>
<li>其他要求</li>
</ul>

<pre><code class="hljs language-arduino" lang="arduino">参考文档 https:<span class="hljs-comment">//www.modelscope.cn/models/Tongyi-MAI/Z-Image-Turbo/summary?version=master</span>
帮我完成z-image-turbo的安装，并实现demo编写。
该demo帮我实现一个儿童风的糖果包装设计，图片生成位置设置为/root/z-image/下。
如果有临时文件生成，统一设置为/root/z-image/tmp/下。
云服务器文档：https:<span class="hljs-comment">//www.gongjiyun.com/docs/server/introduction/rznmwsy13i4a8yktuyycoxyinmg/</span>
</code></pre>
<p><strong>过程</strong></p>
<p>直接参考文档步骤进行安装，过程中出现问题或者错误会自动获取终端信息进行修复，非常方便。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3be81fb9267a497a9930dc5b50cb1dd3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765115009&amp;x-signature=ZOPNzJgQ%2BzM7VUMdHRIOGqGC0uo%3D" alt="" loading="lazy"/></p>
<p>甚至还给出后续手动执行的命令，以及中间产物的位置。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f7cdc98f9f24ab5bff3357398c9d573~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765115009&amp;x-signature=tobpiu%2BgDBLYalEjnZL1hXxBDBQ%3D" alt="" loading="lazy"/></p>
<p><strong>结果</strong></p>
<p>下面是生成的 demo 脚本，可以看到采用的 <code>Z-Image</code> 模型。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5484eefa3b71410bbc2b3ec23491d362~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765115009&amp;x-signature=nXP4fEZ9Grg%2BKB4Pty%2FV3RboqIk%3D" alt="" loading="lazy"/></p>
<p>下面是生成的 demo 提示词。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e6605c0886740ec9b1a93d105ca8800~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765115009&amp;x-signature=hMbaJ%2BGAA7H9zmGjflyF1561S8U%3D" alt="" loading="lazy"/></p>
<p>下面是同步生成的包装图片。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6694a3e3daee4c52a3c94f721d9fa934~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765115009&amp;x-signature=vxdj4t0hBbjcNKM9gTI7aEKxSYg%3D" alt="" loading="lazy"/></p>
<p>整体流程没问题，喝杯茶的功夫，环境就已经配好了。
但我想要的是单粒糖果的包装，两头拧起来的那种效果。我们再修改下提示词。</p>
<h3 data-id="heading-4">单粒糖纸包装生成优化</h3>
<p>这里我们直接手动更改脚本中的提示词。</p>
<p>修改位置上一轮对话也已经给出。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/44b69c396340409995182f7be32c209d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765115009&amp;x-signature=kOQlR4J1uuyKG0Pq%2FbMf5gLvR4s%3D" alt="" loading="lazy"/></p>
<p><strong>指令</strong></p>
<pre><code class="hljs language-css" lang="css">单粒牛奶硬糖，经典两端扭结包装，儿童风，奶白色为主色调，点缀浅棕色小奶牛斑点，包装正面印 <span class="hljs-selector-tag">Q</span> 版微笑小奶牛（圆眼睛、短耳朵、脖子挂迷你奶瓶），半透明包装纸隐约透出米白色奶糖本体（糖体光滑有光泽），扭结处颜色为淡奶油色，包装纸呈柔和哑光质感，带轻微奶泡珠光，侧面印微型奶滴图案，正面下方用圆润卡通字体写 “香浓奶糖”，整体无尖锐棱角，色彩柔和不刺眼，暖光照射，<span class="hljs-number">8</span>k 高清，细节丰富，适合 <span class="hljs-number">3</span>-<span class="hljs-number">10</span> 岁儿童
</code></pre>
<p><strong>结果</strong></p>
<p>下面是更换指令后的生成结果，整体还可以。</p>
<p>但是物品的摆放角度和扭转等物理现象还是稍微有些不足。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fef4722dc97342efada72fe5f236a8bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765115009&amp;x-signature=jnbwZB%2BgUm7KeCUuIMWbSRY1QTg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">结语</h2>
<p>整个过程相当轻松，一共花费了 1 个小时多点。</p>
<ul>
<li>看到资讯</li>
<li>找到官网并浏览文档</li>
<li>建立并连接云服务器</li>
<li>输入指令</li>
<li>等待并验证</li>
</ul>
<p>指令设计和研究方向都是我们确定的，最终结果也是我们验收的，但安装、配置、调试的过程全部交由 AI 一口气完成，轻松惬意。</p>
<p>这才是我理想的 AI 协同模式！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从理解到记忆再到回答：Embedding→向量数据库→RAG 的完整链路]]></title>    <link>https://juejin.cn/post/7577718777482756134</link>    <guid>https://juejin.cn/post/7577718777482756134</guid>    <pubDate>2025-11-30T12:23:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577718777482756134" data-draft-id="7577991167200903178" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从理解到记忆再到回答：Embedding→向量数据库→RAG 的完整链路"/> <meta itemprop="keywords" content="LLM,Agent,程序员"/> <meta itemprop="datePublished" content="2025-11-30T12:23:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型教程"/> <meta itemprop="url" content="https://juejin.cn/user/1145012233707299"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从理解到记忆再到回答：Embedding→向量数据库→RAG 的完整链路
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1145012233707299/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型教程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T12:23:53.000Z" title="Sun Nov 30 2025 12:23:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote>
<p>在AI大模型技术爆火之前，"向量"、"相似度"、"召回"这些词还只是少数算法工程师的专业术语。 但自从以ChatGPT为代表的LLM技术爆火、RAG 爆发以及团队可以开始构建自己的知识库，这些概念突然变成了大家都在讨论的词汇。</p>
<p>在上一篇文章中，我们提到<strong>通过构建知识库，可以让大模型从“无状态”变成“有状态”</strong> 。所谓知识库，本质上是一种让大模型“在对话之外拥有记忆”的方式。它本身并不是固定的技术，而是一个抽象概念，可以根据场景和需求被具象化为不同的载体，比如：</p>
<p><strong>文件系统</strong>（文档、PDF、Markdown、网页）</p>
<p><strong>数据库</strong>（传统关系型数据库、NoSQL）</p>
<p><strong>向量数据库</strong>（Milvus、Weaviate、Pinecone）</p>
<p>这些形式都可以承载知识，但它们的能力差异巨大，尤其是在语义检索时代，向量数据库正在成为事实标准。与此同时，大模型产品背后所依赖的基础模型也并非统一的“一种模型”。它们大致可以分成两大类：</p>
<p><strong>LLM（大语言模型）</strong> ：专门负责生成文本、推理、回答问题</p>
<p><strong>Embedding 模型</strong>：负责把文本转成向量，让机器能够“理解语义”</p>
<p>如果想真正弄清楚知识库、Embedding、向量数据库以及 LLM 在一个完整 AI 系统中的角色，就需要先把它们之间的关系理清楚。</p>
<p>事实上，它们之间并不是孤立的，而是构成了一条完整的语义链路：</p>
<p><strong>LLM 负责“回答”，Embedding 负责“理解”，向量数据库负责“记住并快速找到”，知识库则是它们共同服务的目标形态。</strong></p>
<p>理解这条链路，你就能搞清楚：</p>
<p><strong>向量数据库为什么突然火了？它和Embedding是什么关系？</strong></p>
<p><strong>LLM和Embedding又是什么关系？为什么 Embedding 是大模型应用的底层基础？</strong></p>
<p><strong>为什么 RAG 会成为最流行的大模型增强方案？</strong></p>
<p>接下来，我们就沿着这条链路，把这些概念串联讲清楚。</p>
<h3 data-id="heading-0">向量数据库</h3>
<p>为了便于理解，我们先从向量数据库讲起，这里可能会提到Embedding，我们姑且先把它理解成某种特定的序列化方式。</p>
<h4 data-id="heading-1">向量数据库是什么？</h4>
<p>简单来讲<strong>向量数据库（Vector Database）</strong>  是一种专门为"<strong>向量数据</strong>"设计的数据库。</p>
<p>什么是"<strong>向量数据</strong>"？</p>
<p>在大模型中，文本、图片、代码等内容并不是直接用原始形式参与计算，而是通过 <strong>Embedding（向量化）</strong>  映射成几百维或几千维的浮点数组，向量数据库就是负责 <strong>存储这些Embedding向量</strong>，并提供 <strong>高效的相似度搜索（如余弦相似度 / L2距离）</strong> 。</p>
<p>它与传统数据库的区别：</p>

























<table><thead><tr><th>功能</th><th>传统数据库</th><th>向量数据库</th></tr></thead><tbody><tr><td>数据形式</td><td>行/列、字符串、数值</td><td>高维浮点向量</td></tr><tr><td>查询方式</td><td>精确匹配（=、&gt;、&lt;）</td><td>模糊语义匹配（相似度）</td></tr><tr><td>设计目的</td><td>结构化查询</td><td>海量向量的近似最近邻搜索（ANN）</td></tr></tbody></table>
<p>一句话总结：<strong>向量数据库是为语义搜索而生的数据库，用于在大规模向量中快速找到“最相似”的内容。</strong></p>
<h4 data-id="heading-2">为什么需要向量数据库？</h4>
<p>因为大模型并不是无所不知，也不是永远记得所有信息。在实际业务中，我们常遇到这些问题：</p>
<p><strong>1）大模型不能直接记住大量企业私有知识</strong></p>
<p>例如公司内部文档、产品手册、FAQ客户知识库。这些内容通常非常多，大模型无法全部放入 Prompt，也不会长期记住。</p>
<p><strong>2）全文搜索不能满足语义需求</strong></p>
<p>传统搜索如ES、关键词搜索只根据<strong>文本匹配</strong>，而包含某个关键词不等于语义最相关。</p>
<p><strong>3）大模型缺乏外部知识时，容易产生幻觉（hallucination）</strong></p>
<p>RAG已经成为主流方案，大模型不提前学习所有知识，而是“按需查询”，知识的来源就是向量数据库。</p>
<p><strong>4）海量数据 + 高频查询 ，必须依赖高性能ANN搜索</strong></p>
<p>当数据量达到百万到亿级，而查询需要维持毫秒级响应时，传统的精确相似度计算已经无法满足性能需求。只有通过高性能 ANN 索引（如 HNSW、IVF、PQ 等），才能在保证较高召回率的同时，实现高 QPS 的实时检索能力。</p>
<h4 data-id="heading-3">向量数据库有哪些产品？</h4>
<p>按照开源/商用可分为以下几类：</p>
<p><strong>1）主流开源向量数据库</strong></p>

































<table><thead><tr><th>产品</th><th>特点</th></tr></thead><tbody><tr><td><strong>Milvus</strong> （最流行）</td><td>专为向量搜索设计，性能极强，生态完善</td></tr><tr><td><strong>FAISS</strong> （Facebook）</td><td>算法库，不是完整数据库，需要自己封装</td></tr><tr><td><strong>HNSWlib</strong></td><td>高性能近邻搜索库，索引速度强</td></tr><tr><td><strong>Weaviate</strong></td><td>带 REST API、schema、扩展插件，易用</td></tr><tr><td><strong>Qdrant</strong></td><td>Rust 开发，性能稳定，支持混合搜索</td></tr><tr><td><strong>Vespa</strong> （雅虎）</td><td>面向大规模内容检索的搜索平台</td></tr></tbody></table>
<p><strong>2）商业 SaaS / 云厂商</strong></p>

























<table><thead><tr><th>产品</th><th>特点</th></tr></thead><tbody><tr><td><strong>Pinecone</strong></td><td>SaaS向量数据库，免维护</td></tr><tr><td><strong>OpenSearch Vector Engine</strong></td><td>AWS生态中集成</td></tr><tr><td><strong>Azure Cognitive Search</strong></td><td>与Azure AI紧密结合</td></tr><tr><td><strong>MongoDB Atlas Vector Search</strong></td><td>在文档数据库上附加向量检索功能</td></tr></tbody></table>
<p><strong>3）传统数据库的“向量扩展”功能</strong></p>
<p><strong>PostgreSQL pgvector</strong></p>
<p><strong>Elasticsearch vector search</strong></p>
<p><strong>MySQL HeatWave Vector</strong></p>
<p>适合中小规模场景，但不是专为大规模向量搜索设计。</p>
<h4 data-id="heading-4">总结一句话</h4>
<p><strong>向量数据库是构建大模型知识库（RAG系统）的核心技术，用来存储和检索语义向量，从而让大模型能够访问实时、企业级、准确的知识。</strong></p>
<h3 data-id="heading-5">Embedding</h3>
<p>Embedding在技术界的中文解释一般为“向量化”，顾名思义就是把常规内容转化为向量内容的一种方式。</p>
<h4 data-id="heading-6">Embedding 到底是什么？</h4>
<p><strong>Embedding 是把一段文本（或图片、音频等）转换成一个高维向量，并且这个向量在向量空间中具有“语义结构”。</strong></p>
<p>例如一句话：</p>
<pre><code class="hljs">“如何提升接口性能”
</code></pre>
<p>Embedding 之后可能变成：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[-0.13, 0.04, 0.98, ...]</span> （维度可能是 <span class="hljs-number">384</span>/<span class="hljs-number">768</span>/<span class="hljs-number">1024</span>/<span class="hljs-number">1536</span>/<span class="hljs-number">3072</span>...)
</code></pre>
<p><strong>这个向量越接近的，就说明两段文本越“语义相似”</strong> 。而比较向量的方式就是判断<strong>余弦相似度</strong> 。就是将两个数据转化成向量坐标后进行对比，对比的依据就是**方向一致度，不看长度，只看角度。角度越小，越相似。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/074db6cdece34f4a87fcae2406101391~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765110233&amp;x-signature=%2FDK%2BjpiyVSd7INdh00MSazZGU9E%3D" alt="" loading="lazy"/></p>
<p>这就是文本 Embedding 的本质，<strong>建立一个语义空间</strong>，把语义相似的文本放得很近，不相似的放得很远。</p>
<h4 data-id="heading-7">Embedding 的具体过程是什么？</h4>
<p>真实 Embedding 过程分为 3 步：</p>
<p><strong>步骤 1：文本 → Tokenize（分词 &amp; 转成数字）</strong></p>
<p>任何模型先把文本拆解成 token：</p>
<pre><code class="hljs language-css" lang="css">“如何提升接口性能”→ <span class="hljs-selector-attr">[<span class="hljs-string">"如何"</span>, <span class="hljs-string">"提升"</span>, <span class="hljs-string">"接口"</span>, <span class="hljs-string">"性能"</span>]</span>→ <span class="hljs-selector-attr">[10342, 664, 9912, 2203]</span>
</code></pre>
<p><strong>步骤 2：放入 Transformer（Encoder 或者 LLM 的隐藏层）</strong></p>
<p>文本经过 Transformer 网络处理。Transformer 做了：</p>
<p><strong>a.Self-Attention（让模型理解词之间的关系）</strong></p>
<p><strong>b.多层前馈网络（提取语义）</strong></p>
<p><strong>c.残差、归一化等结构</strong></p>
<p>此时模型已经“理解了语义关系”。</p>
<p><strong>步骤 3：取隐藏状态 / Pooling，得到最终向量</strong></p>
<p>Embedding 模型的关键在于<strong>它会对所有 token 的语义表示做 pooling（比如平均池化 mean pooling）得到一个固定维度的向量。</strong></p>
<p>例如：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">token embeddings:</span> <span class="hljs-number">768</span> <span class="hljs-string">维</span> <span class="hljs-string">×</span> <span class="hljs-number">20</span> <span class="hljs-string">个</span> <span class="hljs-string">token↓mean</span> <span class="hljs-string">pooling↓输出一个</span> <span class="hljs-number">768</span> <span class="hljs-string">维的向量（整个句子的语义表示）</span>
</code></pre>
<p>这就是 Embedding。</p>
<h4 data-id="heading-8">为什么有的模型可以做 Embedding，有的不能？</h4>
<p>因为不是所有模型结构适合输出固定的向量语义表示。大语言模型（LLM）可以分类：</p>
<p><strong>(1) Encoder-only 模型（专门做 Embedding 的）</strong></p>
<p>例如：</p>
<ul>
<li><strong>sentence-transformers (mpnet)</strong></li>
<li><strong>BERT</strong></li>
<li><strong>Text-Embedding-3-small/large</strong></li>
<li><strong>MiniLM</strong></li>
</ul>
<p>它们结构上就是：</p>
<pre><code class="hljs">Encoder → Pooling → 一个向量
</code></pre>
<p>这种模型<strong>天生适合集合语义，输出 embedding</strong>。</p>
<p><strong>(2) Decoder-only 模型（像 GPT 模型）主要是生成模型</strong></p>
<p>例如 GPT-4 / GPT-3.5 / Llama 等。</p>
<p>它们是：</p>
<pre><code class="hljs language-sql" lang="sql">Decoder<span class="hljs-operator">-</span><span class="hljs-keyword">only</span> Transformer → 负责做语言生成
</code></pre>
<p>Decoder-only 的隐藏层是“自回归”的，每个 token 负责预测下一个 token。</p>
<p><strong>(3) Encoder-Decoder 模型</strong></p>
<p>它的设计目标也是生成和翻译，不是做 embedding。</p>
<h4 data-id="heading-9">Embedding 模型 vs LLM的真正区别</h4>








































<table><thead><tr><th>对比点</th><th>Embedding 模型</th><th>大语言模型（LLM）</th></tr></thead><tbody><tr><td>目标</td><td>语义向量表示</td><td>文本生成</td></tr><tr><td>输入</td><td>文本</td><td>文本</td></tr><tr><td>输出</td><td>一个固定长度向量</td><td>生成 token（回复一句话）</td></tr><tr><td>核心结构</td><td>Encoder</td><td>Decoder</td></tr><tr><td>是否做 pooling</td><td><strong>是，必须有</strong></td><td>通常<strong>没有</strong></td></tr><tr><td>应用场景</td><td>检索、向量数据库、相似度搜索、聚类、RAG</td><td>对话、问答、生成内容、写代码等</td></tr></tbody></table>
<p>一句话总结：<strong>Embedding 模型负责“理解内容”，LLM 负责“生成内容”。</strong></p>
<h4 data-id="heading-10">为什么需要专门的 Embedding 模型，而不是让 LLM 来做？</h4>
<p><strong>(1) 计算效率</strong></p>
<p>Embedding 模型一般只有 100M~1B 参数，非常轻量。</p>
<p>LLM 有几十亿～几千亿参数，拿它来算一个向量完全没必要。</p>
<p><strong>(2) 质量更高</strong></p>
<p>Embedding 模型是用对比学习（Contrastive Learning）训练的，目标就是把“语义相似”的句子放得更近。LLM 的训练目标只是预测下一个 token。</p>
<p><strong>(3) 一致性强</strong></p>
<p>Embedding 模型输出的向量分布非常稳定（适合向量库）。LLM 的隐藏层 embedding 会随提示词、上下文变化而波动，不适合作为稳定语义向量。</p>
<h4 data-id="heading-11">为什么 Embedding 这么重要</h4>
<p>RAG 的核心三步：</p>
<p><strong>1.用 Embedding 把知识库内容向量化</strong></p>
<p><strong>2.用 Embedding 把查询向量化</strong></p>
<p>**3.检索“语义最相近”的文档</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a092f49510dd42d69d3ab0202dc73391~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765110233&amp;x-signature=C0EcVFlNohQQ%2F88jlP44Koxq16U%3D" alt="" loading="lazy"/></p>
<p>如果没有 Embedding，RAG 根本无法运行。这就是为什么：</p>
<p><strong>RAG = Embedding + 向量数据库 + LLM</strong></p>
<p>其中 Embedding 是地基。</p>
<h3 data-id="heading-12">Embedding和向量数据库有什么关系</h3>
<p>这个问题可以一句话进行总结：</p>
<p><strong>Embedding 是把文本转成向量的过程；向量数据库是存向量并做向量检索的地方。</strong></p>
<p><strong>Embedding 产生向量 → 向量存入向量数据库 → 大模型从数据库里用相似度检索找到相关知识 → 最后让 LLM 回答。</strong></p>
<p>这就是 RAG 的基础工作流。</p>
<h3 data-id="heading-13">RAG</h3>
<p>前面我们已经讲了 Embedding 如何把文本变成向量，以及向量数据库如何在海量向量中快速找到“最相似的知识”，这些都是基础设施，而 RAG（Retrieval-Augmented Generation）就是把它们<strong>组合成一个可工作的 AI 能力</strong>。</p>
<p><strong>如果说Embedding 是“编码”，向量数据库是“记忆”，那么 RAG 就是“用记忆回答问题的过程”</strong></p>
<p>我们可以把 RAG 理解成一个执行链路：<strong>先找知识（Retrieve），再生成答案（Generate）</strong></p>
<h4 data-id="heading-14">为什么需要 RAG？</h4>
<p>LLM 很强，但它有两个硬伤：</p>
<p><strong>1）它不知道你企业内部的知识（知识截止）</strong> 例如你的 SOP、财务制度、业务数据，这些大模型无法直接“知道”。</p>
<p><strong>2）它会胡编（幻觉）</strong> 当模型不确定答案时，它会“想象一个”。</p>
<p>RAG 的目标就是解决这两个问题：缓解幻觉，引入实时、外部、私有的知识让模型给出更可靠、更贴合业务的答案</p>
<p>本质上：</p>
<p><strong>RAG 让大模型从“猜答案”变成“查资料”。</strong></p>
<h4 data-id="heading-15">RAG 的工作流到底是什么？</h4>
<p>最简单的一句话：</p>
<p><strong>Embedding → 向量召回 → 把知识塞给模型 → 让它回答</strong></p>
<p>如果展开成技术流，会是这样的一条链路：</p>
<p><strong>1）用户提问</strong></p>
<p><strong>2）对问题进行向量化（Query Embedding）</strong></p>
<p><strong>3）向量数据库中检索最相似的 Top-K 片段</strong></p>
<p><strong>4）把这些检索结果与 Prompt 拼接</strong></p>
<p><strong>5）交给 LLM，让它基于“提供的知识”生成答案</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/37a17bd216b148c1b2a5713537059815~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765110233&amp;x-signature=Y1kpddj9dJ9pDf48wzw5e%2Ba5IAw%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-16">RAG 并不是“让模型变强”，而是让模型“用到外部知识”</h4>
<p>很多人误以为 RAG 是增强模型能力。但本质上<strong>RAG 不改变模型本身，只改变它获得知识的方式。</strong></p>
<p>LLM 的作用只变成“把检索到的信息组合起来，用自然语言表达出来”。知识不再藏在模型参数里，而是藏在向量数据库里，我们可以随时更新知识，而模型不需要重新训练。</p>
<h4 data-id="heading-17">RAG = 我们提供知识，模型负责表达</h4>
<p>我们可以把 RAG 想象成一支团队：</p>
<ul>
<li>向量数据库：资料管理员</li>
<li>Embedding：文档编码员</li>
<li>LLM：负责写报告的实习生</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ffa12ee437d4b3fafdf7d74379f895a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765110233&amp;x-signature=q5MOnGcoPHiqNrFcpiRuJZX3oIE%3D" alt="" loading="lazy"/></p>
<p>工作流程就是：</p>
<p><strong>把资料交给实习生 → 实习生看完 → 写成回答 → 给你</strong></p>
<h3 data-id="heading-18">向量数据库 + RAG + 大模型整体架构图</h3>
<p>下图展示了一个典型的  <strong>“向量数据库 + RAG + 大模型”</strong>  的完整工作流程，它描述了用户提问后，系统如何利用知识库增强大模型的回答质量。整个流程大致可分为四个阶段：</p>
<p>首先，用户提出问题，请求会先进入 <strong>RAG（检索增强生成）层</strong>。RAG 的第一步是使用 <strong>Embedding 模型</strong> 将用户的问题转换为向量（Query Embedding）。随后，系统根据这个向量到 <strong>向量数据库（Vector DB）</strong>  中进行相似度检索。向量数据库中事先存储了经过切片的文档内容及其对应的 Embedding 向量，并通过 HNSW、IVF 等 ANN（近似最近邻）算法来快速找到语义最相近的内容片段。</p>
<p>完成检索后，系统会进入到 <strong>Prompt 构建器</strong> 阶段。这个步骤非常关键，它会把用户原始问题与检索到的知识片段组合起来，构造成一条包含更多“上下文知识”的增强提示（Augmented Prompt），也就是给大模型提供更准确的背景信息。</p>
<p>最后，这条增强后的 Prompt 会被送入 <strong>LLM（大语言模型）</strong> ，如 GPT、Claude、Qwen 等。大模型基于提供的知识生成更可靠、更准确的回答，并最终返回给用户。</p>
<p>整体架构清晰呈现了一个核心思想：</p>
<blockquote>
<p>❝</p>
<p><strong>RAG 用 Embedding 理解问题 → 向量数据库找到最相关知识 → Prompt 构建器把知识提供给大模型 → LLM 基于知识回答问题。</strong></p>
</blockquote>
<p>这是目前大模型应用中最主流、最可靠的知识增强方式。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c4ae9e9db61942f3899eb2881903217b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765110233&amp;x-signature=9b4moKSybCwBsc5fcAmRpksxBZw%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-19">小总结</h3>
<p>如果把一个智能系统比作一个大脑，那么 <strong>Embedding 是理解世界的方式</strong>，<strong>向量数据库是记忆世界的结构</strong>，而 <strong>RAG 则是让理解过的知识真正被使用起来的方式</strong>。</p>
<p>Embedding 把原本混乱的文本世界编码成有意义的向量空间，让“相似”可以被数学化；向量数据库用高性能 ANN 架构为这些向量提供了可扩展的“长时记忆”；最终，RAG 作为桥梁，让大模型在回答每一个问题时，都能实时检索相关的知识片段，把“现学现用”变成现实。</p>
<p>换句话说，RAG 让模型不再仅仅依赖固定参数里的“死记硬背”，而是获得了 <strong>实时学习、即时查询、动态回答</strong> 的能力。</p>
<p>当这三者组合在一起，我们构建的就不再是一个简单的问答系统，而是一个<strong>真正能理解业务、吸收知识、持续进化的 AI 系统</strong>。</p>
<h2 data-id="heading-20">学习资源推荐</h2>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C++ Lambda表达式：从“这是什么鬼”到“真香！”的完整心路历程]]></title>    <link>https://juejin.cn/post/7577970969395609641</link>    <guid>https://juejin.cn/post/7577970969395609641</guid>    <pubDate>2025-11-30T12:32:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577970969395609641" data-draft-id="7577969462860759103" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C++ Lambda表达式：从“这是什么鬼”到“真香！”的完整心路历程"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-30T12:32:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码事漫谈"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C++ Lambda表达式：从“这是什么鬼”到“真香！”的完整心路历程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码事漫谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T12:32:05.000Z" title="Sun Nov 30 2025 12:32:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文不会像教科书一样罗列Lambda的语法，而是带你重走一遍每个C++程序员认识Lambda的经典“真香”之路。从最初的反感，到偶然一试的惊喜，最终成为日常开发离不开的神器。</p>
</blockquote>
<h3 data-id="heading-0"><strong>那个让我头疼的下午</strong></h3>
<p>还记得那个被<code>std::sort</code>和自定义比较函数折磨的下午吗？</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 古老的写法：在函数体外定义比较函数</span>
<span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">compareByName</span><span class="hljs-params">(<span class="hljs-type">const</span> Student&amp; a, <span class="hljs-type">const</span> Student&amp; b)</span> </span>{
    <span class="hljs-keyword">return</span> a.name &lt; b.name;
}

<span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">compareByScore</span><span class="hljs-params">(<span class="hljs-type">const</span> Student&amp; a, <span class="hljs-type">const</span> Student&amp; b)</span> </span>{
    <span class="hljs-keyword">return</span> a.score &gt; b.score;
}

<span class="hljs-comment">// 在某个函数里...</span>
std::vector&lt;Student&gt; students;
<span class="hljs-comment">// ... 填充数据</span>

std::<span class="hljs-built_in">sort</span>(students.<span class="hljs-built_in">begin</span>(), students.<span class="hljs-built_in">end</span>(), compareByName);
<span class="hljs-comment">// 等等，我要是想按分数降序排列呢？</span>
std::<span class="hljs-built_in">sort</span>(students.<span class="hljs-built_in">begin</span>(), students.<span class="hljs-built_in">end</span>(), compareByScore);
</code></pre>
<p><strong>当时的我内心OS</strong>：<em>“太麻烦了！只是为了一个简单的比较逻辑，我要：</em></p>
<ol>
<li><em>跳到文件顶部去定义函数</em></li>
<li><em>给函数起个有意义的名字</em></li>
<li><em>万一这个比较逻辑只用一次，感觉好浪费啊</em></li>
<li><em>如果要在函数内使用局部变量进行比较？完蛋，得用函数对象，更复杂了！”</em></li>
</ol>
<p>就在我几乎要放弃的时候，我听说了<strong>Lambda表达式</strong>。第一反应是：</p>
<p><strong>“这又是什么鬼语法？C++已经够复杂了！”</strong> 🥴</p>
<h3 data-id="heading-1"><strong>第一阶段：初次见面，这语法也太怪了吧</strong></h3>
<p>第一次看到Lambda，我的内心是拒绝的：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 这是什么东西？中括号、小括号、花括号...</span>
<span class="hljs-keyword">auto</span> hello = []() { 
    std::cout &lt;&lt; <span class="hljs-string">"Hello Lambda!"</span> &lt;&lt; std::endl;
};
<span class="hljs-built_in">hello</span>();
</code></pre>
<p><strong>我的吐槽</strong>：<em>“这不就是匿名函数吗？JavaScript玩剩下的！而且这<code>[](){}</code>的语法，看起来像表情符号一样！”</em></p>
<p>但当我被迫在项目中尝试了一次后...</p>
<h3 data-id="heading-2"><strong>第二阶段：被迫尝试，意外地...有点方便？</strong></h3>
<p>还是那个排序的问题，用Lambda重写：</p>
<pre><code class="hljs language-cpp" lang="cpp">std::vector&lt;Student&gt; students;

<span class="hljs-comment">// 按姓名排序</span>
std::<span class="hljs-built_in">sort</span>(students.<span class="hljs-built_in">begin</span>(), students.<span class="hljs-built_in">end</span>(), 
    [](<span class="hljs-type">const</span> Student&amp; a, <span class="hljs-type">const</span> Student&amp; b) {
        <span class="hljs-keyword">return</span> a.name &lt; b.name;
    });

<span class="hljs-comment">// 按分数降序排列</span>
std::<span class="hljs-built_in">sort</span>(students.<span class="hljs-built_in">begin</span>(), students.<span class="hljs-built_in">end</span>(), 
    [](<span class="hljs-type">const</span> Student&amp; a, <span class="hljs-type">const</span> Student&amp; b) {
        <span class="hljs-keyword">return</span> a.score &gt; b.score;
    });

<span class="hljs-comment">// 甚至...按姓名长度排序？</span>
std::<span class="hljs-built_in">sort</span>(students.<span class="hljs-built_in">begin</span>(), students.<span class="hljs-built_in">end</span>(), 
    [](<span class="hljs-type">const</span> Student&amp; a, <span class="hljs-type">const</span> Student&amp; b) {
        <span class="hljs-keyword">return</span> a.name.<span class="hljs-built_in">length</span>() &lt; b.name.<span class="hljs-built_in">length</span>();
    });
</code></pre>
<p><strong>"咦？"</strong> 我发现了第一个优点：</p>
<ul>
<li><strong>就地定义</strong>：逻辑就在使用的地方，不用跳来跳去</li>
<li><strong>无需命名</strong>：避免了我绞尽脑汁想<code>compareByNameAscending</code>这种长名字</li>
<li><strong>代码更紧凑</strong>：几行代码搞定，阅读流不会被中断</li>
</ul>
<h3 data-id="heading-3"><strong>第三阶段：发现超能力，这玩意有点东西！</strong></h3>
<p>真正的"真香"时刻，是当我发现Lambda能<strong>捕获外部变量</strong>时：</p>
<h4 data-id="heading-4"><strong>场景1：找到分数高于平均分的学生</strong></h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-type">double</span> averageScore = <span class="hljs-built_in">calculateAverage</span>(students);
<span class="hljs-keyword">auto</span> it = std::<span class="hljs-built_in">find_if</span>(students.<span class="hljs-built_in">begin</span>(), students.<span class="hljs-built_in">end</span>(),
    [averageScore](<span class="hljs-type">const</span> Student&amp; s) {  <span class="hljs-comment">// 捕获外部变量！</span>
        <span class="hljs-keyword">return</span> s.score &gt; averageScore;
    });
</code></pre>
<p><strong>传统写法对比</strong>：<em>要么用全局变量（丑陋），要么定义函数对象类（繁琐）。现在一行捕获就搞定！</em></p>
<h4 data-id="heading-5"><strong>场景2：按不同阈值筛选</strong></h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">filterStudents</span><span class="hljs-params">(<span class="hljs-type">const</span> std::vector&lt;Student&gt;&amp; students, <span class="hljs-type">int</span> threshold)</span> </span>{
    <span class="hljs-comment">// Lambda可以捕获函数参数！</span>
    <span class="hljs-keyword">auto</span> count = std::<span class="hljs-built_in">count_if</span>(students.<span class="hljs-built_in">begin</span>(), students.<span class="hljs-built_in">end</span>(),
        [threshold](<span class="hljs-type">const</span> Student&amp; s) {
            <span class="hljs-keyword">return</span> s.score &gt;= threshold;
        });
    std::cout &lt;&lt; <span class="hljs-string">"超过"</span> &lt;&lt; threshold &lt;&lt; <span class="hljs-string">"分的人数: "</span> &lt;&lt; count &lt;&lt; std::endl;
}
</code></pre>
<p><strong>此时的我</strong>：<em>"等等，这比我想象的要强大啊！"</em> 🤔</p>
<h3 data-id="heading-6"><strong>第四阶段：进阶用法，打开新世界的大门</strong></h3>
<p>当我深入使用后，发现了更多让人直呼"真香"的用法：</p>
<h4 data-id="heading-7"><strong>1. 捕获列表的妙用</strong></h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-type">int</span> baseScore = <span class="hljs-number">60</span>;
<span class="hljs-type">int</span> bonus = <span class="hljs-number">5</span>;

<span class="hljs-comment">// 值捕获</span>
<span class="hljs-keyword">auto</span> lambda1 = [baseScore]() { <span class="hljs-keyword">return</span> baseScore; };

<span class="hljs-comment">// 引用捕获 - 小心生命周期！</span>
<span class="hljs-keyword">auto</span> lambda2 = [&amp;baseScore]() { <span class="hljs-keyword">return</span> baseScore; };

<span class="hljs-comment">// 捕获多个变量</span>
<span class="hljs-keyword">auto</span> lambda3 = [baseScore, bonus](<span class="hljs-type">int</span> x) { <span class="hljs-keyword">return</span> x + baseScore + bonus; };

<span class="hljs-comment">// 捕获this（在成员函数中）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Teacher</span> {
    std::string className;
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">getClassChecker</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> [<span class="hljs-keyword">this</span>](<span class="hljs-type">const</span> Student&amp; s) { 
            <span class="hljs-keyword">return</span> s.<span class="hljs-keyword">class</span> == <span class="hljs-keyword">this</span>-&gt;className;  <span class="hljs-comment">// 捕获this指针</span>
        };
    }
};
</code></pre>
<h4 data-id="heading-8"><strong>2. 与STL算法的完美配合</strong></h4>
<pre><code class="hljs language-cpp" lang="cpp">std::vector&lt;<span class="hljs-type">int</span>&gt; scores = {<span class="hljs-number">85</span>, <span class="hljs-number">92</span>, <span class="hljs-number">78</span>, <span class="hljs-number">60</span>, <span class="hljs-number">45</span>, <span class="hljs-number">88</span>};

<span class="hljs-comment">// 统计优秀学生</span>
<span class="hljs-type">int</span> excellentCount = std::<span class="hljs-built_in">count_if</span>(scores.<span class="hljs-built_in">begin</span>(), scores.<span class="hljs-built_in">end</span>(),
    [](<span class="hljs-type">int</span> score) { <span class="hljs-keyword">return</span> score &gt;= <span class="hljs-number">90</span>; });

<span class="hljs-comment">// 给每个人加平时分</span>
std::for_each(scores.<span class="hljs-built_in">begin</span>(), scores.<span class="hljs-built_in">end</span>(),
    [](<span class="hljs-type">int</span>&amp; score) { score += <span class="hljs-number">5</span>; });  <span class="hljs-comment">// 注意引用！</span>

<span class="hljs-comment">// 生成新的转换序列</span>
std::vector&lt;std::string&gt; gradeComments;
std::<span class="hljs-built_in">transform</span>(scores.<span class="hljs-built_in">begin</span>(), scores.<span class="hljs-built_in">end</span>(), 
               std::<span class="hljs-built_in">back_inserter</span>(gradeComments),
    [](<span class="hljs-type">int</span> score) -&gt; std::string {
        <span class="hljs-keyword">if</span> (score &gt;= <span class="hljs-number">90</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">"优秀"</span>;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (score &gt;= <span class="hljs-number">60</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">"及格"</span>;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-string">"加油！"</span>;
    });
</code></pre>
<h3 data-id="heading-9"><strong>第五阶段：成为日常，离不开的"瑞士军刀"</strong></h3>
<p>现在，Lambda已经成为我代码中不可或缺的一部分：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 场景：按钮点击事件（模拟）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Button</span> {
    std::function&lt;<span class="hljs-type">void</span>()&gt; onClick;
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setOnClick</span><span class="hljs-params">(std::function&lt;<span class="hljs-type">void</span>()&gt; callback)</span> </span>{
        onClick = callback;
    }
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">click</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">if</span>(onClick) <span class="hljs-built_in">onClick</span>(); }
};

<span class="hljs-comment">// 使用Lambda作为回调</span>
button.<span class="hljs-built_in">setOnClick</span>([&amp;students, <span class="hljs-keyword">this</span>]() {
    std::cout &lt;&lt; <span class="hljs-string">"刷新显示"</span> &lt;&lt; students.<span class="hljs-built_in">size</span>() &lt;&lt; <span class="hljs-string">"个学生"</span> &lt;&lt; std::endl;
    <span class="hljs-built_in">refreshDisplay</span>();  <span class="hljs-comment">// 捕获this调用成员函数</span>
});
</code></pre>
<p><strong>对比传统写法</strong>：<em>要么定义一堆小函数，要么继承重写虚函数...现在一个Lambda直接内联搞定！</em></p>
<h3 data-id="heading-10"><strong>"真香"总结：我为什么爱上了Lambda</strong></h3>
<ol>
<li><strong>代码局部性</strong>：逻辑就在使用的地方，阅读不用跳转</li>
<li><strong>减少命名污染</strong>：避免了一堆只使用一次的函数名</li>
<li><strong>捕获上下文</strong>：轻松使用局部变量，告别繁琐的参数传递</li>
<li><strong>函数式编程</strong>：让C++支持更现代的编程范式</li>
<li><strong>性能优秀</strong>：编译器可以内联优化，通常比函数指针更快</li>
</ol>
<h3 data-id="heading-11"><strong>避坑指南：新手常犯的3个错误</strong></h3>
<p>当然，Lambda也不是完美的：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 错误1：悬空引用</span>
<span class="hljs-function">std::function&lt;<span class="hljs-title">void</span><span class="hljs-params">()</span>&gt; <span class="hljs-title">createDangerousLambda</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-type">int</span> localVar = <span class="hljs-number">42</span>;
    <span class="hljs-keyword">return</span> [&amp;localVar]() {  <span class="hljs-comment">// 捕获了局部变量的引用！</span>
        std::cout &lt;&lt; localVar;  <span class="hljs-comment">// localVar已销毁，未定义行为！</span>
    };
}

<span class="hljs-comment">// 错误2：默认捕获的陷阱</span>
<span class="hljs-type">int</span> value = <span class="hljs-number">10</span>;
<span class="hljs-keyword">auto</span> lambda = [=]() {  <span class="hljs-comment">// [=] 值捕获所有变量</span>
    <span class="hljs-comment">// 但捕获的是value的当前值，后续修改不影响这里</span>
};
value = <span class="hljs-number">20</span>;  <span class="hljs-comment">// lambda内部的value还是10</span>

<span class="hljs-comment">// 错误3：过度使用，降低可读性</span>
<span class="hljs-comment">// 当Lambda逻辑很复杂时，还是老老实实写命名函数吧！</span>
</code></pre>
<h3 data-id="heading-12"><strong>从抗拒到真香的心路历程</strong></h3>
<p>回顾这段旅程：</p>
<ul>
<li><strong>初见</strong>：<code>[](){}</code>？这是什么鬼语法！</li>
<li><strong>尝试</strong>：嗯...好像有点方便</li>
<li><strong>深入</strong>：捕获变量？这个功能太强了！</li>
<li><strong>精通</strong>：STL算法+Lambda，代码从未如此优雅</li>
<li><strong>依赖</strong>：没有Lambda的日子，我已经不会写C++了</li>
</ul>
<p><strong>现在我的代码风格</strong>：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 以前</span>
<span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">isExcellentStudent</span><span class="hljs-params">(<span class="hljs-type">const</span> Student&amp; s)</span> </span>{
    <span class="hljs-keyword">return</span> s.score &gt;= <span class="hljs-number">90</span> &amp;&amp; s.attendance &gt;= <span class="hljs-number">0.9</span>;
}
<span class="hljs-keyword">auto</span> it = std::<span class="hljs-built_in">find_if</span>(students.<span class="hljs-built_in">begin</span>(), students.<span class="hljs-built_in">end</span>(), isExcellentStudent);

<span class="hljs-comment">// 现在</span>
<span class="hljs-keyword">auto</span> it = std::<span class="hljs-built_in">find_if</span>(students.<span class="hljs-built_in">begin</span>(), students.<span class="hljs-built_in">end</span>(), 
    [](<span class="hljs-type">const</span> Student&amp; s) {
        <span class="hljs-keyword">return</span> s.score &gt;= <span class="hljs-number">90</span> &amp;&amp; s.attendance &gt;= <span class="hljs-number">0.9</span>;
    });
</code></pre>
<p><strong>最后的灵魂拷问</strong>：<em>你还在用传统函数折磨自己吗？快来加入Lambda的"真香"阵营吧！</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C++网络编程：从Socket混乱到优雅Reactor的蜕变之路]]></title>    <link>https://juejin.cn/post/7577958825342746643</link>    <guid>https://juejin.cn/post/7577958825342746643</guid>    <pubDate>2025-11-30T12:39:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577958825342746643" data-draft-id="7577905525998059561" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C++网络编程：从Socket混乱到优雅Reactor的蜕变之路"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-30T12:39:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码事漫谈"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C++网络编程：从Socket混乱到优雅Reactor的蜕变之路
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码事漫谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T12:39:39.000Z" title="Sun Nov 30 2025 12:39:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文不会教你<code>socket()</code>和<code>bind()</code>的基本调用，而是带你体验一个C++后端工程师的成长历程：从被多连接折磨到崩溃，到发现Reactor模式后如获至宝，最终写出既高性能又易维护的网络代码。</p>
</blockquote>
<h3 data-id="heading-0"><strong>那个让我濒临崩溃的深夜</strong></h3>
<p>还记得第一次写网络服务的那个夜晚吗？我的"杰作"长这样：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 初代作品 - 同步阻塞式，只能服务一个客户</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">handleClient</span><span class="hljs-params">(<span class="hljs-type">int</span> client_socket)</span> </span>{
    <span class="hljs-type">char</span> buffer[<span class="hljs-number">1024</span>];
    <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) {
        <span class="hljs-type">int</span> bytes_received = <span class="hljs-built_in">recv</span>(client_socket, buffer, <span class="hljs-built_in">sizeof</span>(buffer), <span class="hljs-number">0</span>);
        <span class="hljs-keyword">if</span>(bytes_received &lt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">break</span>;
        
        <span class="hljs-comment">// 处理业务逻辑</span>
        <span class="hljs-built_in">processRequest</span>(buffer, bytes_received);
        
        <span class="hljs-built_in">send</span>(client_socket, buffer, bytes_received, <span class="hljs-number">0</span>);
    }
    <span class="hljs-built_in">close</span>(client_socket);
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-type">int</span> server_fd = <span class="hljs-built_in">socket</span>(AF_INET, SOCK_STREAM, <span class="hljs-number">0</span>);
    <span class="hljs-comment">// ... bind, listen 等操作</span>
    
    <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) {
        <span class="hljs-type">int</span> client_socket = <span class="hljs-built_in">accept</span>(server_fd, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);
        <span class="hljs-built_in">handleClient</span>(client_socket);  <span class="hljs-comment">// 第二个连接？等着吧！</span>
    }
}
</code></pre>
<p><strong>当时的困境</strong>：<em>"为什么第二个客户端连接时，整个服务器就卡住了？"</em></p>
<p>于是我知道了要开多线程...</p>
<h3 data-id="heading-1"><strong>第一阶段：线程 - 从希望到绝望</strong></h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 二代作品 - 一线程一连接</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">handleClient</span><span class="hljs-params">(<span class="hljs-type">int</span> client_socket)</span> </span>{
    <span class="hljs-comment">// 处理逻辑</span>
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-type">int</span> server_fd = <span class="hljs-built_in">socket</span>(AF_INET, SOCK_STREAM, <span class="hljs-number">0</span>);
    <span class="hljs-comment">// ... 设置socket, bind, listen</span>
    
    <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) {
        <span class="hljs-type">int</span> client_socket = <span class="hljs-built_in">accept</span>(server_fd, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);
        
        <span class="hljs-comment">// 来一个连接就开一个线程</span>
        <span class="hljs-function">std::thread <span class="hljs-title">client_thread</span><span class="hljs-params">(handleClient, client_socket)</span></span>;
        client_thread.<span class="hljs-built_in">detach</span>();  <span class="hljs-comment">// 分离线程，自生自灭</span>
    }
}
</code></pre>
<p><strong>短暂的喜悦</strong>：<em>"太好了！现在可以同时服务多个客户端了！"</em></p>
<p><strong>很快的现实打击</strong>：</p>
<ul>
<li>连接数达到1000时，内存耗尽</li>
<li>线程上下文切换开销让CPU不堪重负</li>
<li>竞态条件、死锁问题频发</li>
<li>调试？简直就是噩梦！</li>
</ul>
<p><strong>我的内心</strong>：<em>"这根本不是解决方案，只是把问题推迟了而已！"</em> 😫</p>
<h3 data-id="heading-2"><strong>第二阶段：遇见I/O多路复用 - 看见曙光</strong></h3>
<p>就在我准备转行的时候，听说了<code>select()</code>：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 三代作品 - 使用select</span>
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-type">int</span> server_fd = <span class="hljs-built_in">socket</span>(AF_INET, SOCK_STREAM, <span class="hljs-number">0</span>);
    <span class="hljs-comment">// ... 设置非阻塞，bind, listen</span>
    
    fd_set read_fds;
    std::vector&lt;<span class="hljs-type">int</span>&gt; client_sockets;
    client_sockets.<span class="hljs-built_in">push_back</span>(server_fd);
    
    <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) {
        <span class="hljs-built_in">FD_ZERO</span>(&amp;read_fds);
        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> sock : client_sockets) {
            <span class="hljs-built_in">FD_SET</span>(sock, &amp;read_fds);
        }
        
        <span class="hljs-comment">// 等待事件发生</span>
        <span class="hljs-type">int</span> activity = <span class="hljs-built_in">select</span>(FD_SETSIZE, &amp;read_fds, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);
        
        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">FD_ISSET</span>(server_fd, &amp;read_fds)) {
            <span class="hljs-comment">// 有新连接</span>
            <span class="hljs-type">int</span> client_socket = <span class="hljs-built_in">accept</span>(server_fd, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);
            <span class="hljs-built_in">setNonBlocking</span>(client_socket);
            client_sockets.<span class="hljs-built_in">push_back</span>(client_socket);
        }
        
        <span class="hljs-comment">// 检查所有客户端socket</span>
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span> it = client_sockets.<span class="hljs-built_in">begin</span>() + <span class="hljs-number">1</span>; it != client_sockets.<span class="hljs-built_in">end</span>(); ) {
            <span class="hljs-keyword">if</span>(<span class="hljs-built_in">FD_ISSET</span>(*it, &amp;read_fds)) {
                <span class="hljs-type">char</span> buffer[<span class="hljs-number">1024</span>];
                <span class="hljs-type">int</span> bytes_read = <span class="hljs-built_in">recv</span>(*it, buffer, <span class="hljs-built_in">sizeof</span>(buffer), <span class="hljs-number">0</span>);
                <span class="hljs-keyword">if</span>(bytes_read &gt; <span class="hljs-number">0</span>) {
                    <span class="hljs-built_in">processRequest</span>(buffer, bytes_read);
                    <span class="hljs-built_in">send</span>(*it, buffer, bytes_read, <span class="hljs-number">0</span>);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-comment">// 连接关闭</span>
                    <span class="hljs-built_in">close</span>(*it);
                    it = client_sockets.<span class="hljs-built_in">erase</span>(it);
                    <span class="hljs-keyword">continue</span>;
                }
            }
            ++it;
        }
    }
}
</code></pre>
<p><strong>进步</strong>：<em>"单线程处理上千连接！CPU使用率从100%降到5%！"</em></p>
<p><strong>新问题</strong>：</p>
<ul>
<li><code>select</code>有文件描述符数量限制（1024）</li>
<li>每次都要遍历所有socket，效率低</li>
<li>代码复杂度急剧上升</li>
</ul>
<h3 data-id="heading-3"><strong>第三阶段：现代I/O多路复用 - epoll登场</strong></h3>
<p>在Linux上，我发现了<code>epoll</code>这个神器：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 四代作品 - 使用epoll</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">EpollServer</span> {
<span class="hljs-keyword">private</span>:
    <span class="hljs-type">int</span> epoll_fd;
    <span class="hljs-type">int</span> server_fd;
    std::unordered_map&lt;<span class="hljs-type">int</span>, std::function&lt;<span class="hljs-type">void</span>()&gt;&gt; handlers;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">start</span><span class="hljs-params">()</span> </span>{
        epoll_fd = <span class="hljs-built_in">epoll_create1</span>(<span class="hljs-number">0</span>);
        server_fd = <span class="hljs-built_in">createServerSocket</span>();
        
        <span class="hljs-built_in">addSocketToEpoll</span>(server_fd, EPOLLIN, [<span class="hljs-keyword">this</span>]() {
            <span class="hljs-built_in">acceptNewConnection</span>();
        });
        
        <span class="hljs-keyword">struct</span> <span class="hljs-title class_">epoll_event</span> events[<span class="hljs-number">64</span>];
        <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) {
            <span class="hljs-type">int</span> n = <span class="hljs-built_in">epoll_wait</span>(epoll_fd, events, <span class="hljs-number">64</span>, <span class="hljs-number">-1</span>);
            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; ++i) {
                <span class="hljs-type">int</span> fd = events[i].data.fd;
                <span class="hljs-keyword">if</span>(handlers.<span class="hljs-built_in">count</span>(fd)) {
                    handlers[fd]();  <span class="hljs-comment">// 执行对应的处理函数</span>
                }
            }
        }
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">acceptNewConnection</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-type">int</span> client_fd = <span class="hljs-built_in">accept</span>(server_fd, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);
        <span class="hljs-built_in">setNonBlocking</span>(client_fd);
        
        <span class="hljs-built_in">addSocketToEpoll</span>(client_fd, EPOLLIN, [<span class="hljs-keyword">this</span>, client_fd]() {
            <span class="hljs-built_in">handleClientData</span>(client_fd);
        });
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">handleClientData</span><span class="hljs-params">(<span class="hljs-type">int</span> client_fd)</span> </span>{
        <span class="hljs-type">char</span> buffer[<span class="hljs-number">1024</span>];
        <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) {  <span class="hljs-comment">// 非阻塞读取，直到读完</span>
            <span class="hljs-type">int</span> bytes_read = <span class="hljs-built_in">recv</span>(client_fd, buffer, <span class="hljs-built_in">sizeof</span>(buffer), <span class="hljs-number">0</span>);
            <span class="hljs-keyword">if</span>(bytes_read &gt; <span class="hljs-number">0</span>) {
                <span class="hljs-built_in">processRequest</span>(buffer, bytes_read);
                <span class="hljs-comment">// 这里可以改为异步发送</span>
                <span class="hljs-built_in">send</span>(client_fd, buffer, bytes_read, <span class="hljs-number">0</span>);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(bytes_read == <span class="hljs-number">0</span> || (bytes_read &lt; <span class="hljs-number">0</span> &amp;&amp; errno != EAGAIN)) {
                <span class="hljs-comment">// 连接关闭或错误</span>
                <span class="hljs-built_in">removeClient</span>(client_fd);
                <span class="hljs-keyword">break</span>;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">break</span>;  <span class="hljs-comment">// 没有更多数据了</span>
            }
        }
    }
};
</code></pre>
<p><strong>顿悟时刻</strong>：<em>"等等...这不就是事件驱动吗？每个socket事件触发对应的处理函数..."</em></p>
<h3 data-id="heading-4"><strong>第四阶段：Reactor模式 - 架构的艺术</strong></h3>
<p>当我系统学习后，才发现这就是<strong>Reactor模式</strong>！让我用现代C++重新实现：</p>
<h4 data-id="heading-5"><strong>Reactor核心组件</strong></h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 1. 事件类型</span>
<span class="hljs-keyword">enum class</span> <span class="hljs-title class_">EventType</span> {
    READ = <span class="hljs-number">0x01</span>,
    WRITE = <span class="hljs-number">0x02</span>,
    ERROR = <span class="hljs-number">0x04</span>
};

<span class="hljs-comment">// 2. 事件处理器接口</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">EventHandler</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">EventHandler</span>() = <span class="hljs-keyword">default</span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">handleEvent</span><span class="hljs-params">(EventType event)</span> </span>= <span class="hljs-number">0</span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">int</span> <span class="hljs-title">getHandle</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>= <span class="hljs-number">0</span>;
};

<span class="hljs-comment">// 3. Reactor核心 - 事件分发器</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Reactor</span> {
<span class="hljs-keyword">private</span>:
    <span class="hljs-type">int</span> epoll_fd;
    std::unordered_map&lt;<span class="hljs-type">int</span>, std::shared_ptr&lt;EventHandler&gt;&gt; handlers;
    <span class="hljs-type">bool</span> running{<span class="hljs-literal">false</span>};
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">Reactor</span>() {
        epoll_fd = <span class="hljs-built_in">epoll_create1</span>(<span class="hljs-number">0</span>);
    }
    
    ~<span class="hljs-built_in">Reactor</span>() {
        <span class="hljs-built_in">close</span>(epoll_fd);
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">registerHandler</span><span class="hljs-params">(std::shared_ptr&lt;EventHandler&gt; handler, EventType events)</span> </span>{
        <span class="hljs-type">int</span> fd = handler-&gt;<span class="hljs-built_in">getHandle</span>();
        handlers[fd] = handler;
        
        <span class="hljs-keyword">struct</span> <span class="hljs-title class_">epoll_event</span> ev;
        ev.events = <span class="hljs-built_in">convertToEpollEvents</span>(events);
        ev.data.fd = fd;
        
        <span class="hljs-built_in">epoll_ctl</span>(epoll_fd, EPOLL_CTL_ADD, fd, &amp;ev);
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">removeHandler</span><span class="hljs-params">(<span class="hljs-type">int</span> fd)</span> </span>{
        <span class="hljs-built_in">epoll_ctl</span>(epoll_fd, EPOLL_CTL_DEL, fd, <span class="hljs-literal">nullptr</span>);
        handlers.<span class="hljs-built_in">erase</span>(fd);
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>{
        running = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">struct</span> <span class="hljs-title class_">epoll_event</span> events[<span class="hljs-number">64</span>];
        
        <span class="hljs-keyword">while</span>(running) {
            <span class="hljs-type">int</span> n = <span class="hljs-built_in">epoll_wait</span>(epoll_fd, events, <span class="hljs-number">64</span>, <span class="hljs-number">-1</span>);
            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; ++i) {
                <span class="hljs-type">int</span> fd = events[i].data.fd;
                <span class="hljs-keyword">if</span>(handlers.<span class="hljs-built_in">count</span>(fd)) {
                    <span class="hljs-keyword">auto</span> event_type = <span class="hljs-built_in">convertFromEpollEvents</span>(events[i].events);
                    handlers[fd]-&gt;<span class="hljs-built_in">handleEvent</span>(event_type);
                }
            }
        }
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">stop</span><span class="hljs-params">()</span> </span>{ running = <span class="hljs-literal">false</span>; }
};
</code></pre>
<h4 data-id="heading-6"><strong>具体的业务处理器</strong></h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 连接处理器</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ConnectionHandler</span> : <span class="hljs-keyword">public</span> EventHandler {
<span class="hljs-keyword">private</span>:
    <span class="hljs-type">int</span> client_fd;
    Reactor&amp; reactor;
    std::string read_buffer;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">ConnectionHandler</span>(<span class="hljs-type">int</span> fd, Reactor&amp; reactor) 
        : <span class="hljs-built_in">client_fd</span>(fd), <span class="hljs-built_in">reactor</span>(reactor) {
        <span class="hljs-built_in">setNonBlocking</span>(client_fd);
    }
    
    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">getHandle</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{ <span class="hljs-keyword">return</span> client_fd; }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">handleEvent</span><span class="hljs-params">(EventType event)</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(event) &amp; <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(EventType::READ)) {
            <span class="hljs-built_in">handleRead</span>();
        }
        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(event) &amp; <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(EventType::WRITE)) {
            <span class="hljs-built_in">handleWrite</span>();
        }
    }
    
<span class="hljs-keyword">private</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">handleRead</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-type">char</span> buffer[<span class="hljs-number">1024</span>];
        <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) {
            <span class="hljs-type">int</span> bytes_read = <span class="hljs-built_in">recv</span>(client_fd, buffer, <span class="hljs-built_in">sizeof</span>(buffer), <span class="hljs-number">0</span>);
            <span class="hljs-keyword">if</span>(bytes_read &gt; <span class="hljs-number">0</span>) {
                read_buffer.<span class="hljs-built_in">append</span>(buffer, bytes_read);
                <span class="hljs-built_in">processCompleteRequests</span>();
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(bytes_read == <span class="hljs-number">0</span>) {
                <span class="hljs-comment">// 连接关闭</span>
                reactor.<span class="hljs-built_in">removeHandler</span>(client_fd);
                <span class="hljs-built_in">close</span>(client_fd);
                <span class="hljs-keyword">break</span>;
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(errno != EAGAIN) {
                <span class="hljs-comment">// 错误</span>
                reactor.<span class="hljs-built_in">removeHandler</span>(client_fd);
                <span class="hljs-built_in">close</span>(client_fd);
                <span class="hljs-keyword">break</span>;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">break</span>;  <span class="hljs-comment">// 没有更多数据</span>
            }
        }
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">processCompleteRequests</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">// 解析协议，处理完整请求</span>
        <span class="hljs-type">size_t</span> pos;
        <span class="hljs-keyword">while</span>((pos = read_buffer.<span class="hljs-built_in">find</span>(<span class="hljs-string">'\n'</span>)) != std::string::npos) {
            std::string request = read_buffer.<span class="hljs-built_in">substr</span>(<span class="hljs-number">0</span>, pos);
            read_buffer.<span class="hljs-built_in">erase</span>(<span class="hljs-number">0</span>, pos + <span class="hljs-number">1</span>);
            
            std::string response = <span class="hljs-built_in">processRequest</span>(request);
            response += <span class="hljs-string">"\n"</span>;
            
            <span class="hljs-comment">// 这里应该加入写缓冲区，等待可写事件</span>
            <span class="hljs-built_in">send</span>(client_fd, response.<span class="hljs-built_in">c_str</span>(), response.<span class="hljs-built_in">length</span>(), <span class="hljs-number">0</span>);
        }
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">handleWrite</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">// 处理写缓冲区中的数据</span>
        <span class="hljs-comment">// 当TCP发送缓冲区可用时，epoll会触发WRITE事件</span>
    }
};

<span class="hljs-comment">// 接受连接处理器</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AcceptorHandler</span> : <span class="hljs-keyword">public</span> EventHandler {
<span class="hljs-keyword">private</span>:
    <span class="hljs-type">int</span> server_fd;
    Reactor&amp; reactor;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">AcceptorHandler</span>(<span class="hljs-type">int</span> port, Reactor&amp; reactor) 
        : <span class="hljs-built_in">reactor</span>(reactor) {
        server_fd = <span class="hljs-built_in">createServerSocket</span>(port);
        <span class="hljs-built_in">setNonBlocking</span>(server_fd);
    }
    
    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">getHandle</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{ <span class="hljs-keyword">return</span> server_fd; }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">handleEvent</span><span class="hljs-params">(EventType event)</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(event) &amp; <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(EventType::READ)) {
            <span class="hljs-built_in">acceptConnection</span>();
        }
    }
    
<span class="hljs-keyword">private</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">acceptConnection</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) {  <span class="hljs-comment">// 非阻塞accept，接受所有等待的连接</span>
            <span class="hljs-type">int</span> client_fd = <span class="hljs-built_in">accept</span>(server_fd, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);
            <span class="hljs-keyword">if</span>(client_fd &lt; <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">if</span>(errno == EAGAIN) <span class="hljs-keyword">break</span>;  <span class="hljs-comment">// 没有更多连接了</span>
                <span class="hljs-keyword">continue</span>;
            }
            
            <span class="hljs-keyword">auto</span> handler = std::<span class="hljs-built_in">make_shared</span>&lt;ConnectionHandler&gt;(client_fd, reactor);
            reactor.<span class="hljs-built_in">registerHandler</span>(handler, EventType::READ);
        }
    }
};
</code></pre>
<h4 data-id="heading-7"><strong>最终的主程序 - 优雅！</strong></h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    Reactor reactor;
    
    <span class="hljs-comment">// 创建接受器</span>
    <span class="hljs-keyword">auto</span> acceptor = std::<span class="hljs-built_in">make_shared</span>&lt;AcceptorHandler&gt;(<span class="hljs-number">8080</span>, reactor);
    reactor.<span class="hljs-built_in">registerHandler</span>(acceptor, EventType::READ);
    
    std::cout &lt;&lt; <span class="hljs-string">"Reactor服务器启动在端口 8080..."</span> &lt;&lt; std::endl;
    
    <span class="hljs-comment">// 运行事件循环 - 这就是核心！</span>
    reactor.<span class="hljs-built_in">run</span>();
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 data-id="heading-8"><strong>蜕变成果：前后对比</strong></h3>



































<table><thead><tr><th>维度</th><th>传统多线程模式</th><th>Reactor模式</th></tr></thead><tbody><tr><td><strong>并发连接数</strong></td><td>受限于线程数（~1000）</td><td>数十万连接</td></tr><tr><td><strong>内存使用</strong></td><td>每个连接一个线程栈（~8MB）</td><td>每个连接少量缓冲区</td></tr><tr><td><strong>CPU使用</strong></td><td>大量上下文切换</td><td>事件驱动，几乎没有切换</td></tr><tr><td><strong>代码复杂度</strong></td><td>线程同步、锁、竞态条件</td><td>单线程思维，简单清晰</td></tr><tr><td><strong>可维护性</strong></td><td>调试困难，状态分散</td><td>模块化，易于调试</td></tr></tbody></table>
<h3 data-id="heading-9"><strong>Reactor模式的精髓</strong></h3>
<ol>
<li><strong>事件驱动</strong>：不要主动去读，等操作系统告诉你"数据准备好了"</li>
<li><strong>非阻塞I/O</strong>：绝不让自己在某个连接上卡住</li>
<li><strong>统一事件源</strong>：所有事件（连接、读、写、错误）统一处理</li>
<li><strong>职责分离</strong>：Acceptor只负责接受，Handler只处理业务</li>
</ol>
<h3 data-id="heading-10"><strong>进阶思考：从Reactor到Proactor</strong></h3>
<p>现代C++更进一步，有了<code>io_uring</code>和Proactor模式：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// C++20 协程 + io_uring 的未来方向</span>
<span class="hljs-function">async_task&lt;<span class="hljs-type">void</span>&gt; <span class="hljs-title">handleClient</span><span class="hljs-params">(io_uring&amp; ring, <span class="hljs-type">int</span> client_fd)</span> </span>{
    <span class="hljs-type">char</span> buffer[<span class="hljs-number">1024</span>];
    
    <span class="hljs-comment">// 异步读 - 不阻塞线程</span>
    <span class="hljs-type">int</span> bytes_read = <span class="hljs-keyword">co_await</span> <span class="hljs-built_in">async_read</span>(ring, client_fd, buffer);
    
    <span class="hljs-comment">// 处理业务</span>
    <span class="hljs-built_in">processRequest</span>(buffer, bytes_read);
    
    <span class="hljs-comment">// 异步写</span>
    <span class="hljs-function"><span class="hljs-keyword">co_await</span> <span class="hljs-title">async_write</span><span class="hljs-params">(ring, client_fd, buffer, bytes_read)</span></span>;
}
</code></pre>
<h3 data-id="heading-11"><strong>从混乱到优雅的蜕变</strong></h3>
<p>回顾这段旅程：</p>
<ul>
<li><strong>原始时代</strong>：同步阻塞，一个连接卡死整个服务</li>
<li><strong>青铜时代</strong>：一线程一连接，资源耗尽而亡</li>
<li><strong>白银时代</strong>：select/poll，初见事件驱动曙光</li>
<li><strong>黄金时代</strong>：epoll + Reactor，单机数十万并发</li>
<li><strong>未来时代</strong>：协程 + io_uring，异步编程新范式</li>
</ul>
<p><strong>现在的我</strong>：<em>"看着清晰模块化的Reactor代码，回想当年那个被多线程bug折磨到深夜的自己，真是感慨万千。架构的进步，让复杂变得简单，让混乱变得优雅。"</em></p>
<p><strong>最后的建议</strong>：<em>"如果你还在为网络编程的并发问题头疼，不要继续在泥潭中挣扎。花时间理解Reactor模式，这将是你职业生涯中最值得的投资之一。"</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI 编程协作，我的一点邪修方法，希望可以帮助到你]]></title>    <link>https://juejin.cn/post/7577905525998075945</link>    <guid>https://juejin.cn/post/7577905525998075945</guid>    <pubDate>2025-11-30T12:52:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577905525998075945" data-draft-id="7578037997323599891" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI 编程协作，我的一点邪修方法，希望可以帮助到你"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-30T12:52:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="努力的小雨"/> <meta itemprop="url" content="https://juejin.cn/user/572218015747543"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI 编程协作，我的一点邪修方法，希望可以帮助到你
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/572218015747543/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    努力的小雨
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T12:52:04.000Z" title="Sun Nov 30 2025 12:52:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>看到很多人总是在分享如何利用 Trae 快速开发一款 MCP 产品，这类内容大多适合一个人独立完成的小项目，类似的分享其实已经非常多了。今天，我想换个角度，和大家聊聊如何把 Trae 真正应用到工作中，帮助我们提高实际开发效率。首先，我分享的方法是我自己在工作中一直在使用的，并且已经在多个项目中实践过了。以我目前的经验来看，Trae 可以很好地辅助我完成一些小需求，对于大需求，我暂时还不敢完全依赖它。</p>
<p>今天的主角依然是 Trae-SOLO。其实，无论是国外的主流 AI IDE，还是 Trae 本身，我的看法是：方法对了，就都能切实帮助我们提升工作效率，而不仅仅是快速写出一段代码。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bfd3fb18308e46f1a1d133456ef25d36~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yqq5Yqb55qE5bCP6Zuo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765111924&amp;x-signature=87Dv8jTfsX8okEpUdVWpC4HNQd8%3D" alt="d2cae7e003fabfc75163656d7519c94a" loading="lazy"/></p>
<p>我们直接进入正题。首先，要明确 AI 编程提效的目标。让 AI IDE 根据需求文档“咔咔一顿开发”，并且兼顾所有需求变动，其实并不现实。我们需要把目标设得合理：我的目标是打造一个“个人分身”，让 AI 帮助我完成需求时，输出的方案能与我脑海中的解决思路基本一致，或者比我预想的方案更完美。</p>
<p>举例来说，以开发工期为例，我通常会先从半天就能完成的小需求开始实验。这样可以及时发现问题，积累经验，然后再逐步尝试让 AI 辅助完成开发周期较长的任务。这里需要强调一点：AI 的作用是帮助我们解放双手，而不是解放大脑。所有需求我们本身必须有清晰的实现方案，当 AI 输出的方案出现偏差时，我们再通过增加项目文档和说明，让 AI 更快地理解我们的意图。通过这样的方式逐步积累经验，最终有一天，也许可以完全交给 AI 来处理，但现在这个阶段，我们更多的是在人机协作中提升效率。</p>
<h2 data-id="heading-0">文档先行</h2>
<p>就像过去打仗一样，攻城之前必须先筹备好粮草。同样，在我们进行开发工作之前，也必须做好充分的准备：首先需要明确开发任务，而这离不开详细的需求文档。然而，我们不能简单地把现有的需求文档直接交给 AI，因为 AI 很可能完全不理解其中的内容。</p>
<p>因此，我们需要先自己梳理一版“优化过”的需求文档。这版文档不仅要包含项目的关键字和核心目标，还要清晰展现我们的基本业务流程。业务流程部分不必过于复杂，因为这是我们自己最熟悉的内容，只需要一个简明扼要的版本即可。</p>
<p>梳理完需求之后，我们可以进入 Plan 模式，通过这个过程观察 Trae 是否真正理解了我们的意图和业务逻辑。如果理解无误，再进入后续的具体执行阶段。这样可以大大降低沟通成本，避免因为理解偏差而产生的返工或误解。</p>
<p>如图所示，这就是整个流程的示意和操作方法。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7161b1e2c1044fa794fe5b90504268c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yqq5Yqb55qE5bCP6Zuo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765111924&amp;x-signature=Ui24uBvnioBqsBq2wgN0CgkZ%2Ffs%3D" alt="6b381d37775e4fa851a45238e5511ea6" loading="lazy"/></p>
<p>我的工作习惯是将所有文档统一放到 all-doc 目录下，方便集中管理和查找。但需要特别注意的是，这些文档不能直接和代码仓库一起提交，以避免不必要的混乱。为了解决这个问题，我目前采用的做法是单独建立一个文档类型的项目，用来存放所有项目的 doc 文档。这样，其他同事在更新文档后，我可以直接从这个文档项目中拉取最新版本，然后手动复制到我的项目中进行使用。</p>
<p>在我对文档进行修改后，我再将更改后的文件复制回文档仓库，并进行提交以解决冲突。这种方式虽然可以保证文档的集中管理和更新，但冲突是不可避免的，并且会非常频繁。</p>
<p>如果你有更高效的文档管理方式或者冲突解决方案，非常希望你能分享出来</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e8bf43d2c47a4aebbb30eb293dc430d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yqq5Yqb55qE5bCP6Zuo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765111924&amp;x-signature=qjwYRv4Xk%2FeblS3fA7da1qTqPjE%3D" alt="123ae8a749c6b2a33c8556fe4dc7b164" loading="lazy"/></p>
<h3 data-id="heading-1">持久维护</h3>
<p>这部分工作同样非常重要。因为在我们完成第一版需求并将其整理记录到文档（doc）后，随后的新增需求或对原有需求的修改都必须及时更新到文档中。如果仍然保留过时的老需求，容易导致文档信息与实际开发不一致，从而对后续开发任务产生负面影响，增加沟通成本和返工风险。为了更好地管理这些问题，我将它们归纳为几类，便于后续处理和跟踪。</p>
<h4 data-id="heading-2">需求变动</h4>
<p>如果需求发生变动，第一步我们会先在文档（doc）中更新需求描述。当然，这一步不需要人工手动修改，我们会让 AI 自动完成更新。接下来，可以直接切换到 Plan 模式，检查整个流程是否存在问题。如果流程没有异常或冲突，就可以直接执行。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c479f5fe4a234423916fa1682b9d8dab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yqq5Yqb55qE5bCP6Zuo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765111924&amp;x-signature=TR7Ket9%2BJ8%2F81LGyL31KALUfu9k%3D" alt="49a9fbc17982dffe9d78d86e1f037b58" loading="lazy"/></p>
<p>这里展示的是从旧版本到新版本的演示。如果旧需求已经完全不再使用，可以直接让 AI 协助删除。至于是否保留备份，我个人认为没有必要，因为保留可能会影响整体上下文的清晰性和逻辑连贯性。</p>
<h4 data-id="heading-3">新增需求点</h4>
<p>这部分内容基本上不用我多做赘述了，如果有新增需求，可以直接先交给 AI，让它帮我们生成一个初步的计划。这里我就不再做具体演示了。当然，除了这种常规情况，还有另一种场景：就是我们之前可能遗漏的一些需求。举个例子，当我们让 AI 去执行某个需求时，可能会发现它提出的改动点不准确，或者它的思考逻辑有偏差。在这种情况下，我们其实可以把 AI 生成的 plan 模式当作一个参考对比，无论发现什么不对的地方，都可以去补充和修正。这样的输入可以来源多样：有时候是需求文档，有时候是项目规则，甚至可以是一些流程规范，总之都是可用的参考依据。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/50d3a9b5d05744f7b482031bde508a30~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yqq5Yqb55qE5bCP6Zuo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765111924&amp;x-signature=irErDOLLOgORyO5M62yK1r5Bjcg%3D" alt="7fa0fc24db457790ccf6affa4f8ae7bc" loading="lazy"/></p>
<p>从整体上来看，这套操作流程其实和修改数据库的操作有些相似：都是对已有内容进行调整和优化。只不过，这里面对的是 AI，而它的“语言”不像 SQL 那样严格规范，更多的是类似于提示词工程，需要我们用自然语言去引导它完成目标。整个过程的前期可能会比较繁琐，有时候甚至会让人感觉比较吃力，因此如果你打算用 AI IDE 来帮你开发代码，我建议可以先从一些小 bug 修复或者耗时半天左右的小需求改动开始着手。这样做的好处是，你可以逐渐熟悉整个操作流程，也会慢慢建立起使用 AI 进行开发的信心。</p>
<h2 data-id="heading-4">智能体</h2>
<p>说完文档部分，我们就进入Trae特有的模式——Agent。考虑到大多数同学的项目通常都是分布式架构或者微服务架构，因此在实际开发中，很可能会遇到多个服务之间需要进行RPC调用的情况。针对这种场景，我的思路是：首先让Agent从最简单、最高效的方式入手，避免一开始就陷入复杂的实现细节。关键在于从整体架构和需求出发，思考如何以最直接、最清晰的方式完成任务，从而兼顾性能与可维护性。具体来说，步骤如下：</p>
<blockquote>
<p>您是一位需求体系结构专家，专门分析复杂的系统需求，并为使用RPC通信的分布式体系结构确定最简单、最有效的实现策略。</p>
</blockquote>
<p>直接让Trae帮我们AI生成第一版即可，如图所示：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f7ea4dbb0204498b643cd3746a98857~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yqq5Yqb55qE5bCP6Zuo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765111924&amp;x-signature=iA043OXxW55169yeTZqhD19%2FceE%3D" alt="801a95951bc9174e96d72d43f0ce2a78" loading="lazy"/></p>
<p>在第一版中，AI 默认生成的 ‘何时调用’ 结果可能存在一定偏差，这是因为在生成过程中系统未对相关项目进行检索与参考。为提升准确性和可靠性，建议在聊天框中明确说明优化方法，包括需要考虑的上下文信息、数据来源或特定检索策略，以便 AI 在生成结果时能够结合更多相关信息，从而得到更精准的输出。</p>
<blockquote>
<p>这个提示词写的有问题，举例也不是按照我项目举例的，请优化后给我：《提示词》</p>
</blockquote>
<p>生成的提示词要有示例，效果如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0f0f29c7a023439682086c4cc23a2b15~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yqq5Yqb55qE5bCP6Zuo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765111924&amp;x-signature=juWTVPj43%2B5%2BtAQROF6uOTN49eM%3D" alt="35877fb323d4520b41459a99250bdfe4" loading="lazy"/></p>
<p>目前没有找到给这个agent帮忙的mcp，如果有也可以提下。效果如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff36be128b8a44cab40c0979ab9ad2fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yqq5Yqb55qE5bCP6Zuo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765111924&amp;x-signature=4YEGmW6EXqUMVvwTEqGSqdK%2BktE%3D" alt="093f550306c45bb5d33f24fe850d2d9b" loading="lazy"/></p>
<p>如果在需求设计阶段，没有调用你的智能体，将何时调用说明在优化下，如图所示：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8edd69df26764e9b9ca0c807d37f2685~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yqq5Yqb55qE5bCP6Zuo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765111924&amp;x-signature=rCEvJ4KAHfEh03DBzC%2BwM6Mhh%2Bw%3D" alt="8729f3530b8498e6d548bf1b352f3f9c" loading="lazy"/></p>
<p>目前来讲，这些基本够我使用了，切记如果想充分发挥模型能力，一定要打开 MAX 能力并且善用plan模式，虽然钱会像流水一样，但是能力提高的不是一丁半点。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d1783f275a9d4e1693f610ef86dc78b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yqq5Yqb55qE5bCP6Zuo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765111924&amp;x-signature=DTBA%2FJbgkDDe%2BViuykSbqDK2RxA%3D" alt="230180dcedd6e35f2951a161c3aecbcc" loading="lazy"/></p>
<h2 data-id="heading-5">小结</h2>
<p>Trae 的真正价值，并不在于所谓的“全自动开发”能力，而在于它作为开发助力的角色。它能够帮助我们快速验证想法、完善方案，并在日常工作中有效节省那些重复劳动所占用的时间与精力。换句话说，Trae 并不是替代人类开发者的工具，而是提升工作效率、辅助决策的伙伴。只要方法得当，任何 AI 编程工具都可以在一定程度上带来类似的提升，但前提是我们理解其局限性，并合理使用它。</p>
<p>需要特别提醒的是，不要天真地以为花费几十块钱就能解决上千甚至上万的开发成本。目前阶段，AI 仍然无法完全取代人类，人与 AI 的协作才是最现实、最可靠的工作方式。即便提供再完整的文档和说明，AI 也不一定能够完全理解复杂的业务逻辑或中文语境的微妙差异——毕竟中文博大精深，连正常人的理解也可能出现偏差，更何况是机器。</p>
<p>因此，使用 AI 工具的关键在于方法和策略，而非盲目依赖成本低廉的“全能解决方案”。正确的心态是把它当作助手，而非救世主，充分发挥它在加速验证、优化方案和减少重复劳动上的优势，同时保持必要的人类判断和监督。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Z-Image 发布了 ，赶紧体验了一把（配套 Modal执行脚本）]]></title>    <link>https://juejin.cn/post/7577969462860808255</link>    <guid>https://juejin.cn/post/7577969462860808255</guid>    <pubDate>2025-11-30T12:58:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577969462860808255" data-draft-id="7577969462860349503" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Z-Image 发布了 ，赶紧体验了一把（配套 Modal执行脚本）"/> <meta itemprop="keywords" content="后端,前端,AIGC"/> <meta itemprop="datePublished" content="2025-11-30T12:58:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="志字辈小蚂蚁"/> <meta itemprop="url" content="https://juejin.cn/user/3790771822007822"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Z-Image 发布了 ，赶紧体验了一把（配套 Modal执行脚本）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3790771822007822/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    志字辈小蚂蚁
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T12:58:14.000Z" title="Sun Nov 30 2025 12:58:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;color:#282d36}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px;color:#2f845e}.markdown-body h2{font-size:22px;display:inline-block;font-weight:700;background:#2f845e;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(47,132,194,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 32px);border-bottom:3px solid #2f845e}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%;box-shadow:6px 6px 6px #888}.markdown-body hr{border:none;border-top:1px solid rgba(66,185,131,.15);margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#f6ffed;color:#52c41a;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:16px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#262626;border:1px solid #2f845e;border-top:8px solid #2f845e;background:linear-gradient(180deg,rgba(66,185,131,.1),transparent)!important}.markdown-body pre&gt;code.hljs[lang]:before{top:8px!important;color:#2f845e!important}.markdown-body pre&gt;code.language-awesome_error{border:1px solid #ff4d4f!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#ff4d4f!important;background:#fff2f0!important}.markdown-body pre&gt;code.language-awesome_error:before{content:"!"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#ff4d4f!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_warn{border:1px solid #ffc46f!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#ffc46f!important;background:#fffbe6!important}.markdown-body pre&gt;code.language-awesome_warn:before{content:"☂"!important;position:absolute;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#ffc46f!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_success{border:1px solid #52c41a!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#52c41a!important;background:#f6ffed!important}.markdown-body pre&gt;code.language-awesome_success:before{content:"✓"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#52c41a!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_info{border:1px solid #1890ff!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#1890ff!important;background:#e6f7ff!important}.markdown-body pre&gt;code.language-awesome_info:before{content:"i"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#1890ff!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body strong{background-color:inherit;color:#2f845e}.markdown-body em{background-color:inherit;color:#949415}.markdown-body a{text-decoration:none;color:#2f8e54;border-bottom:1px solid #3f9e64}.markdown-body a:active,.markdown-body a:hover{color:#3f9e64}.markdown-body a[class^=footnote]{margin-left:4px}.markdown-body a:before{content:"➤ "}.markdown-body table{font-size:12px;width:100%;max-width:100%;overflow:auto;border:2px solid #2f8e54}.markdown-body thead{background:#2f8e54;color:#fff;text-align:left;font-weight:700}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:22px}.markdown-body td{min-width:120px}.markdown-body blockquote{padding:1px 22px;margin:22px 0;border-left:6px solid #2f845e;background-color:rgba(66,185,131,.1);border-radius:2px}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#2f845e}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px;color:#282d36}.markdown-body del{color:#2f845e}.markdown-body input[type=checkbox]:checked:before{content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAA/klEQVQ4T72TMU7DQBBF318XdFR06egQEnAXRINEGlqgowoIR8AF4AZOZ4JEGq5AC5EixBU4A55BNrEVHAcSBTHlaubt37/zxZKlcn7n6mDPXJvz8IJ89HzWu8t7C8D2dfsY52ae4apHnLx0ktsCsHXZjiUuFgG40x2eJ/H/AhztB+zDUTpLwWj8jGkzxSHiHaMPrDQC8sMoilKzLAUqiKQjmb+ZuAdW80tmelCHODoNgSfP7AFprTTaRTzsJN1GEyuIZ7uW6TEEHwCtyV/6EVBKJHhfzgC0Xv/iXwEFBF4FG0378bd7sPQq5xK/hSnk6sdlX3mZrKkwLZKBeu8n9XuWEUE7X+YAAAAASUVORK5CYII=);position:relative;top:-1px;left:-1px}.markdown-body .math .katex{font-family:Menlo,Monaco,Consolas,Courier New,monospace;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#f6ffed;color:#52c41a;font-size:.87em;padding:.065em .4em}@media (max-width:720px){.markdown-body h1{font-size:22px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">一. 前言</h2>
<p>这一篇主要是做一个开源工具的附属产品 ，之前提到过 <a href="https://juejin.cn/post/7546793844526022656" target="_blank" title="https://juejin.cn/post/7546793844526022656">Modal</a> 这个平台 ，它时不时有活动可以薅羊毛 ， 并且账号每个月有$30 的额度 ，是一个不错的体验平台。</p>
<p>然后由于赠送的额度一直没用 ，所以就简单写了一个工具 ，用来做一键部署。所以顺带把才发布的 Z-Image 体验了一把。</p>
<ul>
<li>Modal 使用 :  <a href="https://juejin.cn/post/7544259368276934671" target="_blank" title="https://juejin.cn/post/7544259368276934671">juejin.cn/post/754425…</a></li>
<li>Modal ComfyUI : <a href="https://juejin.cn/post/7546793844526022656" target="_blank" title="https://juejin.cn/post/7546793844526022656">juejin.cn/post/754679…</a></li>
</ul>
<h2 data-id="heading-1">二. 关于用到的材料</h2>
<blockquote>
<p>需要用到的材料</p>
</blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2FComfy-Org" target="_blank" title="https://huggingface.co/Comfy-Org" ref="nofollow noopener noreferrer">Comfy-Org : Z-Image ComfyUI 版本 ，主要用于 ComfyUI 部署</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a9987426550a4193bc987eff3b450fc3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b-X5a2X6L6I5bCP6JqC6JqB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765112294&amp;x-signature=oXc18vSlN%2BHK6LkBO1sRHDQT3YY%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li><strong>qwen_3_4b.safetensors</strong> ： 文本编码器 ，<strong>自然语言推理与生成</strong>，视觉语义转化为符合逻辑的文本描述。</li>
<li><strong>z_image_turbo_bf16.safetensors</strong> ： 扩散主模型 ，主要的模型</li>
<li><strong>ae.safetensors</strong> ： VAE 解码器 ， 负责<strong>底层视觉编码</strong></li>
</ul>
<h2 data-id="heading-2">三. 工作流</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc9b60262ad54bbf8ba02e2d204bef25~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b-X5a2X6L6I5bCP6JqC6JqB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765112294&amp;x-signature=aBE6%2Bu%2FGhqAJai7p8LmEuG2b0XE%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-3">四. 效果展示</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/83a48ce229b54ada992f2e7a340e65e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b-X5a2X6L6I5bCP6JqC6JqB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765112294&amp;x-signature=oy90Lj3FJH%2FZWL2YzSSViVSvf4A%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>几张图片的效果 ：</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b667494e8b74ddb90ec449da17fff29~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b-X5a2X6L6I5bCP6JqC6JqB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765112294&amp;x-signature=9BvfpIw86RPaxLuph5R5vcM6Fhw%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a2583b0ee704008a3219205819ad65a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b-X5a2X6L6I5bCP6JqC6JqB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765112294&amp;x-signature=iaQj3dKupz%2B9VHLvUyaVLhT3k4Q%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li>光影和质感都是非常不错的</li>
<li>最重要的是出图很快 ，没有具体的参数 ，但是明显比之前 Flux 用起来快一些</li>
</ul>
<h2 data-id="heading-4">总结</h2>
<p>简单体验了一下 ，生产力应该是足够了 ，出图很快 ，效果也很好。</p>
<p>开源的模型 ，你想生成什么都可以。</p>
<h2 data-id="heading-5">附录 ： 如果你用到了 Modal</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># =============================================================================</span>
<span class="hljs-comment"># Z-Image-Turbo ComfyUI 一键部署服务</span>
<span class="hljs-comment"># =============================================================================</span>
<span class="hljs-comment"># 启动命令: modal deploy z_image_turbo_deploy.py</span>
<span class="hljs-comment"># =============================================================================</span>

<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> subprocess
<span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path

<span class="hljs-keyword">import</span> modal

<span class="hljs-comment"># =============================================================================</span>
<span class="hljs-comment"># S1: 环境准备 - 构建基础镜像</span>
<span class="hljs-comment"># =============================================================================</span>
image = (
    modal.Image.debian_slim(python_version=<span class="hljs-string">"3.11"</span>)
    .apt_install(<span class="hljs-string">"git"</span>, <span class="hljs-string">"wget"</span>, <span class="hljs-string">"curl"</span>)
    .pip_install(
        <span class="hljs-string">"fastapi[standard]==0.115.4"</span>,
        <span class="hljs-string">"comfy-cli==1.5.3"</span>,
        <span class="hljs-string">"requests==2.32.3"</span>,
    )
    .run_commands(<span class="hljs-string">"comfy --skip-prompt install --fast-deps --nvidia"</span>)
)

<span class="hljs-comment"># HuggingFace Secret</span>
<span class="hljs-keyword">try</span>:
    hf_secret = modal.Secret.from_name(<span class="hljs-string">"huggingface-secret"</span>)
<span class="hljs-keyword">except</span> modal.exception.NotFoundError:
    hf_secret = <span class="hljs-literal">None</span>


<span class="hljs-comment"># =============================================================================</span>
<span class="hljs-comment"># S2: 模型下载 - 从 Tongyi-MAI/Z-Image-Turbo 下载 3 个核心模型</span>
<span class="hljs-comment"># =============================================================================</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">hf_download</span>():
    <span class="hljs-string">"""
    下载 Z-Image-Turbo 模型:
    - z_image_turbo_bf16.safetensors (主扩散模型)
    - qwen_3_4b.safetensors (CLIP 文本编码器)
    - ae.safetensors (VAE 解码器)
    """</span>
    <span class="hljs-keyword">from</span> huggingface_hub <span class="hljs-keyword">import</span> hf_hub_download

    hf_token = os.getenv(<span class="hljs-string">"HF_TOKEN"</span>)
    repo_id = <span class="hljs-string">"Comfy-Org/z_image_turbo"</span>
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"📦 从 <span class="hljs-subst">{repo_id}</span> 下载模型..."</span>)

    <span class="hljs-comment"># 模型配置列表 (文件路径包含 split_files/ 前缀)</span>
    models = [
        {
            <span class="hljs-string">"filename"</span>: <span class="hljs-string">"split_files/diffusion_models/z_image_turbo_bf16.safetensors"</span>,
            <span class="hljs-string">"target_dir"</span>: <span class="hljs-string">"/root/comfy/ComfyUI/models/diffusion_models"</span>,
            <span class="hljs-string">"target_name"</span>: <span class="hljs-string">"z_image_turbo_bf16.safetensors"</span>,
            <span class="hljs-string">"desc"</span>: <span class="hljs-string">"主扩散模型"</span>
        },
        {
            <span class="hljs-string">"filename"</span>: <span class="hljs-string">"split_files/text_encoders/qwen_3_4b.safetensors"</span>,
            <span class="hljs-string">"target_dir"</span>: <span class="hljs-string">"/root/comfy/ComfyUI/models/clip"</span>,
            <span class="hljs-string">"target_name"</span>: <span class="hljs-string">"qwen_3_4b.safetensors"</span>,
            <span class="hljs-string">"desc"</span>: <span class="hljs-string">"CLIP 文本编码器"</span>
        },
        {
            <span class="hljs-string">"filename"</span>: <span class="hljs-string">"split_files/vae/ae.safetensors"</span>,
            <span class="hljs-string">"target_dir"</span>: <span class="hljs-string">"/root/comfy/ComfyUI/models/vae"</span>,
            <span class="hljs-string">"target_name"</span>: <span class="hljs-string">"ae.safetensors"</span>,
            <span class="hljs-string">"desc"</span>: <span class="hljs-string">"VAE 解码器"</span>
        }
    ]

    <span class="hljs-keyword">for</span> model <span class="hljs-keyword">in</span> models:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"📥 下载 <span class="hljs-subst">{model[<span class="hljs-string">'desc'</span>]}</span>: <span class="hljs-subst">{model[<span class="hljs-string">'target_name'</span>]}</span>..."</span>)
        
        cached_path = hf_hub_download(
            repo_id=repo_id,
            filename=model[<span class="hljs-string">"filename"</span>],
            cache_dir=<span class="hljs-string">"/cache"</span>,
            token=hf_token
        )
        
        Path(model[<span class="hljs-string">"target_dir"</span>]).mkdir(parents=<span class="hljs-literal">True</span>, exist_ok=<span class="hljs-literal">True</span>)
        target_path = <span class="hljs-string">f"<span class="hljs-subst">{model[<span class="hljs-string">'target_dir'</span>]}</span>/<span class="hljs-subst">{model[<span class="hljs-string">'target_name'</span>]}</span>"</span>
        subprocess.run(<span class="hljs-string">f"ln -sf <span class="hljs-subst">{cached_path}</span> <span class="hljs-subst">{target_path}</span>"</span>, shell=<span class="hljs-literal">True</span>, check=<span class="hljs-literal">True</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   ✅ <span class="hljs-subst">{model[<span class="hljs-string">'desc'</span>]}</span> 完成"</span>)

    <span class="hljs-built_in">print</span>(<span class="hljs-string">"🎉 所有模型下载完成!"</span>)


<span class="hljs-keyword">def</span> <span class="hljs-title function_">create_workflow_file</span>():
    <span class="hljs-string">"""创建工作流 JSON 文件"""</span>
    workflow = {
        <span class="hljs-string">"1"</span>: {
            <span class="hljs-string">"class_type"</span>: <span class="hljs-string">"UNETLoader"</span>,
            <span class="hljs-string">"inputs"</span>: {
                <span class="hljs-string">"unet_name"</span>: <span class="hljs-string">"z_image_turbo_bf16.safetensors"</span>,
                <span class="hljs-string">"weight_dtype"</span>: <span class="hljs-string">"default"</span>
            }
        },
        <span class="hljs-string">"2"</span>: {
            <span class="hljs-string">"class_type"</span>: <span class="hljs-string">"DualCLIPLoader"</span>,
            <span class="hljs-string">"inputs"</span>: {
                <span class="hljs-string">"clip_name1"</span>: <span class="hljs-string">"qwen_3_4b.safetensors"</span>,
                <span class="hljs-string">"clip_name2"</span>: <span class="hljs-string">"qwen_3_4b.safetensors"</span>,
                <span class="hljs-string">"type"</span>: <span class="hljs-string">"z_image"</span>
            }
        },
        <span class="hljs-string">"3"</span>: {
            <span class="hljs-string">"class_type"</span>: <span class="hljs-string">"VAELoader"</span>,
            <span class="hljs-string">"inputs"</span>: {<span class="hljs-string">"vae_name"</span>: <span class="hljs-string">"ae.safetensors"</span>}
        },
        <span class="hljs-string">"4"</span>: {
            <span class="hljs-string">"class_type"</span>: <span class="hljs-string">"CLIPTextEncode"</span>,
            <span class="hljs-string">"inputs"</span>: {
                <span class="hljs-string">"text"</span>: <span class="hljs-string">"一位美丽的亚洲女性，照片级真实，自然光线，高清细节"</span>,
                <span class="hljs-string">"clip"</span>: [<span class="hljs-string">"2"</span>, <span class="hljs-number">0</span>]
            }
        },
        <span class="hljs-string">"5"</span>: {
            <span class="hljs-string">"class_type"</span>: <span class="hljs-string">"CLIPTextEncode"</span>,
            <span class="hljs-string">"inputs"</span>: {
                <span class="hljs-string">"text"</span>: <span class="hljs-string">"低质量，模糊，畸形，丑陋，文字，水印"</span>,
                <span class="hljs-string">"clip"</span>: [<span class="hljs-string">"2"</span>, <span class="hljs-number">0</span>]
            }
        },
        <span class="hljs-string">"6"</span>: {
            <span class="hljs-string">"class_type"</span>: <span class="hljs-string">"EmptyLatentImage"</span>,
            <span class="hljs-string">"inputs"</span>: {<span class="hljs-string">"width"</span>: <span class="hljs-number">1024</span>, <span class="hljs-string">"height"</span>: <span class="hljs-number">1024</span>, <span class="hljs-string">"batch_size"</span>: <span class="hljs-number">1</span>}
        },
        <span class="hljs-string">"7"</span>: {
            <span class="hljs-string">"class_type"</span>: <span class="hljs-string">"KSampler"</span>,
            <span class="hljs-string">"inputs"</span>: {
                <span class="hljs-string">"model"</span>: [<span class="hljs-string">"1"</span>, <span class="hljs-number">0</span>],
                <span class="hljs-string">"positive"</span>: [<span class="hljs-string">"4"</span>, <span class="hljs-number">0</span>],
                <span class="hljs-string">"negative"</span>: [<span class="hljs-string">"5"</span>, <span class="hljs-number">0</span>],
                <span class="hljs-string">"latent_image"</span>: [<span class="hljs-string">"6"</span>, <span class="hljs-number">0</span>],
                <span class="hljs-string">"seed"</span>: <span class="hljs-number">42</span>,
                <span class="hljs-string">"steps"</span>: <span class="hljs-number">4</span>,
                <span class="hljs-string">"cfg"</span>: <span class="hljs-number">1.0</span>,
                <span class="hljs-string">"sampler_name"</span>: <span class="hljs-string">"euler"</span>,
                <span class="hljs-string">"scheduler"</span>: <span class="hljs-string">"simple"</span>,
                <span class="hljs-string">"denoise"</span>: <span class="hljs-number">1.0</span>
            }
        },
        <span class="hljs-string">"8"</span>: {
            <span class="hljs-string">"class_type"</span>: <span class="hljs-string">"VAEDecode"</span>,
            <span class="hljs-string">"inputs"</span>: {<span class="hljs-string">"samples"</span>: [<span class="hljs-string">"7"</span>, <span class="hljs-number">0</span>], <span class="hljs-string">"vae"</span>: [<span class="hljs-string">"3"</span>, <span class="hljs-number">0</span>]}
        },
        <span class="hljs-string">"9"</span>: {
            <span class="hljs-string">"class_type"</span>: <span class="hljs-string">"SaveImage"</span>,
            <span class="hljs-string">"inputs"</span>: {<span class="hljs-string">"filename_prefix"</span>: <span class="hljs-string">"z_image_turbo"</span>, <span class="hljs-string">"images"</span>: [<span class="hljs-string">"8"</span>, <span class="hljs-number">0</span>]}
        }
    }
    
    Path(<span class="hljs-string">"/root/workflow_api.json"</span>).write_text(json.dumps(workflow, ensure_ascii=<span class="hljs-literal">False</span>, indent=<span class="hljs-number">2</span>))
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"📝 工作流文件已创建"</span>)


<span class="hljs-comment"># =============================================================================</span>
<span class="hljs-comment"># S3: 服务配置</span>
<span class="hljs-comment"># =============================================================================</span>
vol = modal.Volume.from_name(<span class="hljs-string">"z-image-turbo-test-cache"</span>, create_if_missing=<span class="hljs-literal">True</span>)

image = (
    image.pip_install(<span class="hljs-string">"huggingface_hub[hf_transfer]==0.34.4"</span>)
    .env({<span class="hljs-string">"HF_HUB_ENABLE_HF_TRANSFER"</span>: <span class="hljs-string">"1"</span>})
    .run_function(
        hf_download,
        volumes={<span class="hljs-string">"/cache"</span>: vol},
        secrets=[hf_secret] <span class="hljs-keyword">if</span> hf_secret <span class="hljs-keyword">else</span> []
    )
    .run_function(create_workflow_file)
)

app = modal.App(name=<span class="hljs-string">"z-image-turbo-test"</span>, image=image)


<span class="hljs-comment"># =============================================================================</span>
<span class="hljs-comment"># S4: UI 服务</span>
<span class="hljs-comment"># =============================================================================</span>
<span class="hljs-meta">@app.function(<span class="hljs-params">
    max_containers=<span class="hljs-number">1</span>,
    gpu=<span class="hljs-string">"L40S"</span>,
    volumes={<span class="hljs-string">"/cache"</span>: vol},
    timeout=<span class="hljs-number">86400</span>
</span>)</span>
<span class="hljs-meta">@modal.concurrent(<span class="hljs-params">max_inputs=<span class="hljs-number">10</span></span>)</span>
<span class="hljs-meta">@modal.web_server(<span class="hljs-params"><span class="hljs-number">8000</span>, startup_timeout=<span class="hljs-number">60</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">ui</span>():
    <span class="hljs-string">"""ComfyUI Web 界面"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"🌐 启动 Z-Image-Turbo Web 界面..."</span>)
    subprocess.Popen(<span class="hljs-string">"comfy launch -- --listen 0.0.0.0 --port 8000"</span>, shell=<span class="hljs-literal">True</span>)


<span class="hljs-comment"># =============================================================================</span>
<span class="hljs-comment"># S5: 本地入口点</span>
<span class="hljs-comment"># =============================================================================</span>
<span class="hljs-meta">@app.local_entrypoint()</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"Z-Image-Turbo ComfyUI 一键部署"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n📦 模型来源: Comfy-Org/z_image_turbo"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n📋 已下载模型:"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"   - z_image_turbo_bf16.safetensors (主扩散模型)"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"   - qwen_3_4b.safetensors (CLIP 文本编码器)"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"   - ae.safetensors (VAE 解码器)"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n📌 部署命令: modal deploy z_image_turbo_deploy.py"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)

</code></pre>
<blockquote>
<p>部署成功后 ：</p>
</blockquote>
<pre><code class="hljs language-python" lang="python">PS D:\code\Modal安装\modal-manager&gt; modal deploy z_image_turbo_deploy.py
Building image im-RuODNKSpmlSj8WWyALvgT8

=&gt; Step <span class="hljs-number">0</span>: running function <span class="hljs-string">'hf_download'</span>
📦 从 Comfy-Org/z_image_turbo 下载模型...
📥 下载 主扩散模型: z_image_turbo_bf16.safetensors...
   ✅ 主扩散模型 完成
📥 下载 CLIP 文本编码器: qwen_3_4b.safetensors...
   ✅ CLIP 文本编码器 完成
📥 下载 VAE 解码器: ae.safetensors...
   ✅ VAE 解码器 完成
🎉 所有模型下载完成!
Saving image...
Image saved, took <span class="hljs-number">1.50</span>s
Finished image build <span class="hljs-keyword">for</span> im-RuODNKSpmlSj8WWyALvgT8
Building image im-KblbHI0Rx9z0J54HpxvUH3

=&gt; Step <span class="hljs-number">0</span>: running function <span class="hljs-string">'create_workflow_file'</span>
📝 工作流文件已创建
Saving image...
Image saved, took <span class="hljs-number">1.21</span>s
Finished image build <span class="hljs-keyword">for</span> im-KblbHI0Rx9z111HpxvUH3
✓ Created objects.                                                                                                                        
├── 🔨 Created mount D:\code\学习资料\Modal安装\modal-manager\z_image_turbo_deploy.py                                                     
├── 🔨 Created function hf_download.                                                                                                      
├── 🔨 Created function create_workflow_file.                                                                                             
└── 🔨 Created web function ui =&gt; https://aubreyce5ju45p2le3t--z-image-turbo-test-ui.modal.run                                          
✓ App deployed <span class="hljs-keyword">in</span> <span class="hljs-number">106.760</span>s! 🎉

View Deployment: https://modal.com/apps/aubreyce5ju45p2le3t/main/deployed/z-image-turbo-test

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Nano Banana Pro AI 图像生成模型与创意实践 | 2025 年第 48 周草梅周报]]></title>    <link>https://juejin.cn/post/7577713754564411444</link>    <guid>https://juejin.cn/post/7577713754564411444</guid>    <pubDate>2025-11-30T12:59:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577713754564411444" data-draft-id="7577683422879367202" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Nano Banana Pro AI 图像生成模型与创意实践 | 2025 年第 48 周草梅周报"/> <meta itemprop="keywords" content="AIGC,GitHub,开源"/> <meta itemprop="datePublished" content="2025-11-30T12:59:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="草梅友仁"/> <meta itemprop="url" content="https://juejin.cn/user/3043088413495815"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Nano Banana Pro AI 图像生成模型与创意实践 | 2025 年第 48 周草梅周报
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3043088413495815/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    草梅友仁
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T12:59:42.000Z" title="Sun Nov 30 2025 12:59:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmyr.ltd" target="_blank" title="https://blog.cmyr.ltd" ref="nofollow noopener noreferrer">草梅友仁的博客</a> 发布和更新，并在多个平台同步发布。如有更新，以博客上的版本为准。您也可以通过文末的 <code>原文链接</code> 查看最新版本。</p>
</blockquote>
<h2 data-id="heading-0">前言</h2>
<p>欢迎来到草梅周报！这是一个由草梅友仁基于 AI 整理的周报，旨在为您提供最新的博客更新、GitHub 动态、个人动态和其他周刊文章推荐等内容。</p>
<hr/>
<p>上一期<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmyr.ltd%2Farchives%2F2025-47-caomei-weekly-cloudflare-outage-nano-banana-pro.html" target="_blank" title="https://blog.cmyr.ltd/archives/2025-47-caomei-weekly-cloudflare-outage-nano-banana-pro.html" ref="nofollow noopener noreferrer">《草梅周报》</a>中提了一下 AI 图像生成模型 Nano Banana Pro ，本周就继续来聊聊，以及这段时间的使用感受。</p>
<p>虽然 Nano Banana Pro 相较以往的 AI 模型，已经不用像当初 stable-diffusion 那样事无巨细的写图片的标签了，但也还是要一些提示词来描述具体要什么样的图片，只不过 AI 模型的理解能力已经大幅度上升了，图片生成的质量也越来越高了。</p>
<p>本周的新项目《<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FYouMind-OpenLab%2Fawesome-nano-banana-pro-prompts%2Fblob%2Fmain%2FREADME_zh.md" target="_blank" title="https://github.com/YouMind-OpenLab/awesome-nano-banana-pro-prompts/blob/main/README_zh.md" ref="nofollow noopener noreferrer">Nano Banana Pro 提示词大全</a>》中就收集了 500 多个 Nano Banana Pro 模型的提示词，其中也有不少有意思的提示词。</p>
<blockquote>
<p>也可以从他们的官网访问：<a href="https://link.juejin.cn?target=https%3A%2F%2Fyoumind.com%2Fnano-banana-pro-prompts" target="_blank" title="https://youmind.com/nano-banana-pro-prompts" ref="nofollow noopener noreferrer">youmind.com/nano-banana…</a></p>
<p>展示效果更好一些。</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a3c2ead2ca80496e8216f0f570ecd3f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5qKF5Y-L5LuB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765112382&amp;x-signature=xJjyVh9N5QsIzs40Hi7BUQDdYxw%3D" alt="image-20251130200157501" loading="lazy"/></p>
<p>比如说：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4cbaec7d028843de94a4eb07af40afa5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5qKF5Y-L5LuB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765112382&amp;x-signature=o040dAlozYaj11xKTY0ESIcQBgA%3D" alt="img" loading="lazy"/></p>
<blockquote>
<p>一张宽幅的名人金句卡，棕色背景，衬线体浅金色“{argument name="金句" default="保持饥饿，保持愚蠢"}”，小字“——{argument name="作者" default="Steve Jobs"}”，文字前面带一个大的淡淡的引号。人物头像在左边，文字在右边，文字占画面比例 2/3，人物占 1/3，人物有一点渐变过渡的感觉。</p>
</blockquote>
<p>当然，LSP 们可能更想看下生成的美少女，这里也放几个例子。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b304bd527d940eea94505bcb4d3af3a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5qKF5Y-L5LuB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765112382&amp;x-signature=QNvSX0bU0HwIAhs9NEfebdrFFLI%3D" alt="御宅族镜子自拍角人物特写" loading="lazy"/></p>
<blockquote>
<p>一位东亚女性在宅男风格电脑角里自拍</p>
<p>【由于原提示词太长，这里仅放出概要，请前往原项目搜索和查看】</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6aa8e8a042f64b6c80bc364db51a9b8d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5qKF5Y-L5LuB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765112382&amp;x-signature=da8Ez5iqRAYKpez%2FIR%2BkBS7EbjE%3D" alt="照片上的可爱手写笔记" loading="lazy"/></p>
<blockquote>
<p>在照片上写下尽可能多的可爱手写笔记和高光！</p>
</blockquote>
<p>不过，要我说最好用的还得是用来做表情包，因为表情包对分辨率和内容没什么要求，能凑合着看就行，所以效果很好，配合自动切割图片软件会更好。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f90144e490294ba9818049f728842669~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5qKF5Y-L5LuB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765112382&amp;x-signature=m4iD9zRI8ofWd9F%2FWqLINZUbsJg%3D" alt="可爱的长尾山雀 LINE 贴图集" loading="lazy"/></p>
<blockquote>
<p>设计 12 款以 Q 版可爱的银喉长尾山雀为主题的 LINE 贴图。贴图的姿势和文字排版应各不相同，以确保设计独特且多样化。对话内容为日语。背景为白色。贴图的目标用户是“女高中生”。</p>
</blockquote>
<p>比如说 <a href="https://link.juejin.cn?target=https%3A%2F%2Fsplitimage.app%2Fzh-CN" target="_blank" title="https://splitimage.app/zh-CN" ref="nofollow noopener noreferrer">免费在线图片分割工具</a>，就能直接分割出 12 张表情包，效果非常不错。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ce090d99c609406287008cab3561ac76~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5qKF5Y-L5LuB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765112382&amp;x-signature=YlTE2CYXdVRqbBKBkw9fvWxfXJQ%3D" alt="image-20251130200928875" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/95b0281674194d999307017799dc4d02~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5qKF5Y-L5LuB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765112382&amp;x-signature=dnK7fkfHo%2B59lnWq4wlu4f148nU%3D" alt="image-20251130201009207" loading="lazy"/></p>
<blockquote>
<p>目前 Nano Banana Pro 可以在 <a href="https://link.juejin.cn?target=https%3A%2F%2Flmarena.ai%2F" target="_blank" title="https://lmarena.ai/" ref="nofollow noopener noreferrer">lmarena.ai/</a> 上免费试用，额度大约为每小时 5 张图片，超过了就无法继续生成。</p>
<p>如果要无限制使用，需要在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgemini.google.com%2F" target="_blank" title="https://gemini.google.com/" ref="nofollow noopener noreferrer">gemini.google.com/</a> 上开通 Pro 版本。</p>
</blockquote>
<p>随着越来越多的了解到当前 AI 模型进步，我也产生了一些思考。</p>
<p>在 AI 时代，人与人之间最大的差距就是想象力和创造力。</p>
<p>AI 大模型实际上加速了创意落地的速度，也拉大了人与人之间创造力的差距。</p>
<p>有创意的人会更快的实现他的想法，而没创意的人则是给他强大的 AI 也发挥不出什么。</p>
<p>像 <a href="https://link.juejin.cn?target=https%3A%2F%2Fsuno.com" target="_blank" title="https://suno.com" ref="nofollow noopener noreferrer">Suno AI</a>（音乐生成 AI）已经出了很久了，但能想到把《赛尔号》和俄语结合的真没几个。</p>
<blockquote>
<p>出处：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1wjyuBzEnj" target="_blank" title="https://www.bilibili.com/video/BV1wjyuBzEnj" ref="nofollow noopener noreferrer">赛尔赛尔！用热血写下我们的骄傲。赛尔赛尔！小人物永不老！ 《这里是神奇的赛尔号》俄语版</a></p>
</blockquote>
<p>可见，脑洞在未来会越来越重要，人类能超越 AI 的地方就是永远有人能不按常理出牌。</p>
<blockquote>
<p>也许是因为永远有人脑回路清奇，AI 根本想不通。</p>
</blockquote>
<h2 data-id="heading-1">最新 GitHub 加星仓库</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FYouMind-OpenLab%2Fawesome-nano-banana-pro-prompts" target="_blank" title="https://github.com/YouMind-OpenLab/awesome-nano-banana-pro-prompts" ref="nofollow noopener noreferrer">CaoMeiYouRen starred awesome-nano-banana-pro-prompts</a> - 2025-11-30 19:45:12
500 多个精选 Nano Banana Pro 提示词，支持多语言并附带图片预览，提供即时画廊浏览功能。该项目为开源提示词工程库，主要使用 TypeScript 开发，已在 GitHub 获得 1057 个星标。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffranklioxygen%2FMyTube" target="_blank" title="https://github.com/franklioxygen/MyTube" ref="nofollow noopener noreferrer">CaoMeiYouRen starred MyTube</a> - 2025-11-30 19:42:26
一款支持 YouTube/Bilibili/MissAV 等平台的视频下载与本地播放应用。用户可下载视频并在本地托管，将视频整理为收藏集便于访问管理。现已扩展支持 yt-dlp 平台，包括微博、小红书、X.com 等网站。主要开发语言为 TypeScript，项目获得 168 星标。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTongyi-MAI%2FZ-Image" target="_blank" title="https://github.com/Tongyi-MAI/Z-Image" ref="nofollow noopener noreferrer">CaoMeiYouRen starred Z-Image</a> - 2025-11-30 19:12:58
2608 stargazers</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fjosdejong%2Fjsonrepair" target="_blank" title="https://github.com/josdejong/jsonrepair" ref="nofollow noopener noreferrer">CaoMeiYouRen starred jsonrepair</a> - 2025-11-28 11:14:45
修复无效 JSON 文档
主要语言：TypeScript
星标数：2029</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Foceanbase%2Fseekdb" target="_blank" title="https://github.com/oceanbase/seekdb" ref="nofollow noopener noreferrer">CaoMeiYouRen starred seekdb</a> - 2025-11-28 01:42:00
AI 原生搜索数据库，统一向量、文本、结构化和半结构化数据于单一引擎，支持混合搜索和数据库内 AI 工作流。主要开发语言为 C++，GitHub 星标数 990。</li>
</ul>
<h2 data-id="heading-2">其他博客或周刊推荐</h2>
<h3 data-id="heading-3">阮一峰的网络日志</h3>
<ul>
<li><a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.ruanyifeng.com%2Fblog%2F2025%2F11%2Fweekly-issue-375.html" target="_blank" title="http://www.ruanyifeng.com/blog/2025/11/weekly-issue-375.html" ref="nofollow noopener noreferrer">科技爱好者周刊（第 375 期）：一扇门的 Bug</a> - 2025-11-28 08:14:06</li>
<li><a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.ruanyifeng.com%2Fblog%2F2025%2F11%2Ftrae-solo.html" target="_blank" title="http://www.ruanyifeng.com/blog/2025/11/trae-solo.html" ref="nofollow noopener noreferrer">终于有人做了 Subagent，TRAE 国内版 SOLO 模式来了</a> - 2025-11-26 08:17:19</li>
</ul>
<h3 data-id="heading-4">HelloGitHub 月刊</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Fperiodical%2Fvolume%2F116" target="_blank" title="https://hellogithub.com/periodical/volume/116" ref="nofollow noopener noreferrer">《HelloGitHub》第 116 期</a> - 2025-11-28 08:02:57</li>
</ul>
<h3 data-id="heading-5">阿猫的博客</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fameow.xyz%2Farchives%2Fweekly-086" target="_blank" title="https://ameow.xyz/archives/weekly-086" ref="nofollow noopener noreferrer">猫鱼周刊 vol. 086 走出迷茫</a> - 2025-11-30 18:35:47</li>
</ul>
<h3 data-id="heading-6">潮流周刊</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fweekly.tw93.fun%2Fposts%2F246%2F" target="_blank" title="https://weekly.tw93.fun/posts/246/" ref="nofollow noopener noreferrer">第 246 期 - 单向空间</a> - 2025-11-24 08:00:00</li>
</ul>
<h3 data-id="heading-7">二丫讲梵的学习周刊</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwiki.eryajf.net%2Fpages%2F7b0c3c%2F" target="_blank" title="https://wiki.eryajf.net/pages/7b0c3c/" ref="nofollow noopener noreferrer">学习周刊-总第 239 期-2025 年第 48 周</a> - 2025-11-27 22:58:21</li>
</ul>
<h2 data-id="heading-8">总结</h2>
<p>本周的更新和动态如上所示。感谢您的阅读！
您可以通过以下方式订阅草梅周报的更新：</p>
<ul>
<li><strong>博客</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmyr.ltd" target="_blank" title="https://blog.cmyr.ltd" ref="nofollow noopener noreferrer">草梅友仁的博客</a></li>
<li><strong>RSS</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmyr.ltd%2Fweekly.xml" target="_blank" title="https://blog.cmyr.ltd/weekly.xml" ref="nofollow noopener noreferrer">草梅周报</a></li>
<li><strong>公众号</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Foss.cmyr.dev%2Fimages%2F20241025184516839-21n2ctv.png" target="_blank" title="https://oss.cmyr.dev/images/20241025184516839-21n2ctv.png" ref="nofollow noopener noreferrer">草梅友仁的后花园</a></li>
<li><strong>邮箱订阅</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Flistmonk.cmyr.dev%2Fsubscription%2Fform" target="_blank" title="https://listmonk.cmyr.dev/subscription/form" ref="nofollow noopener noreferrer">草梅友仁的博客订阅</a></li>
</ul>
<h2 data-id="heading-9">往期回顾</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmyr.ltd%2Farchives%2F2025-47-caomei-weekly-cloudflare-outage-nano-banana-pro.html" target="_blank" title="https://blog.cmyr.ltd/archives/2025-47-caomei-weekly-cloudflare-outage-nano-banana-pro.html" ref="nofollow noopener noreferrer">Cloudflare 服务中断与 AI 图像生成模型 nano-banana-pro | 2025 年第 47 周草梅周报</a> - 2025-11-23 23:08:45</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmyr.ltd%2Farchives%2F2025-46-caomei-weekly-code-refactoring-test-coverage.html" target="_blank" title="https://blog.cmyr.ltd/archives/2025-46-caomei-weekly-code-refactoring-test-coverage.html" ref="nofollow noopener noreferrer">代码重构与测试覆盖率提升实践 | 2025 年第 46 周草梅周报</a> - 2025-11-16 20:18:53</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmyr.ltd%2Farchives%2F2025-45-caomei-weekly-caomei-auth-1-11-0-github-dependabot.html" target="_blank" title="https://blog.cmyr.ltd/archives/2025-45-caomei-weekly-caomei-auth-1-11-0-github-dependabot.html" ref="nofollow noopener noreferrer">草梅 Auth 1.11.0 发布与 GitHub 依赖安全更新 | 2025 年第 45 周草梅周报</a> - 2025-11-09 23:19:22</li>
</ul>
<p>本文作者：草梅友仁<br/>本文地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmyr.ltd%2Farchives%2F2025-48-caomei-weekly-nano-banana-pro-ai-image-generation.html" target="_blank" title="https://blog.cmyr.ltd/archives/2025-48-caomei-weekly-nano-banana-pro-ai-image-generation.html" ref="nofollow noopener noreferrer">blog.cmyr.ltd/archives/20…</a><br/>版权声明：本文采用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fcreativecommons.org%2Flicenses%2Fby-nc-sa%2F4.0%2Fdeed.zh-hans" target="_blank" title="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans" ref="nofollow noopener noreferrer">CC BY-NC-SA 4.0 协议</a> 进行分发，转载请注明出处！<br/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[每周AI论文速递（251124-251128）]]></title>    <link>https://juejin.cn/post/7577991167200542730</link>    <guid>https://juejin.cn/post/7577991167200542730</guid>    <pubDate>2025-11-30T11:06:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577991167200542730" data-draft-id="7577971299743252518" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="每周AI论文速递（251124-251128）"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-11-30T11:06:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="叶子的技术碎碎念"/> <meta itemprop="url" content="https://juejin.cn/user/2831954919569245"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            每周AI论文速递（251124-251128）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2831954919569245/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    叶子的技术碎碎念
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T11:06:35.000Z" title="Sun Nov 30 2025 11:06:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读20分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ROOT: Robust Orthogonalized Optimizer for Neural Network Training</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.20626" target="_blank" title="https://arxiv.org/abs/2511.20626" ref="nofollow noopener noreferrer">ROOT：神经网络训练的鲁棒正交化优化器</a></p>
<p>大语言模型 (LLM) 的优化仍面临关键挑战，尤其随着模型规模扩大，其对算法不精确性与训练不稳定性的敏感度日益加剧。近期优化器研究通过动量正交化提升了收敛效率，但存在两大鲁棒性缺陷：正交化精度的维度敏感性及对异常值引发噪声的易损性。为解决这些问题，我们提出ROOT (Robust Orthogonalized Optimizer)，该优化器通过双重鲁棒机制增强训练稳定性。首先，我们设计了一种维度鲁棒的正交化方案，采用自适应牛顿迭代及针对特定矩阵尺寸定制的细粒度系数，确保在不同架构配置下均能保持精度一致性。其次，我们引入基于近端优化的鲁棒框架，在有效抑制异常值噪声的同时保留关键梯度方向。大量实验证明，ROOT 在鲁棒性方面显著提升，相比 Muon 和 Adam 类优化器，收敛速度更快且最终性能更优，尤其在噪声环境和非凸场景中表现突出。本研究确立了一种新范式，可用于开发鲁棒且精确的优化器，以应对现代大规模模型训练的复杂性。代码将发布于 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhuawei-noah%2Fnoah-research%2Ftree%2Fmaster%2FROOT%25E3%2580%2582" target="_blank" title="https://github.com/huawei-noah/noah-research/tree/master/ROOT%E3%80%82" ref="nofollow noopener noreferrer">github.com/huawei-noah…</a></p>
<h2 data-id="heading-1">General Agentic Memory Via Deep Research</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.18423" target="_blank" title="https://arxiv.org/abs/2511.18423" ref="nofollow noopener noreferrer">基于深度研究的通用智能体记忆</a></p>
<p>记忆对于 AI 智能体至关重要，但广泛采用的静态记忆系统旨在预先构建随时可用的记忆，这不可避免地会导致严重的信息损失。为解决这一局限，我们提出了一种名为 <strong>通用智能体记忆 (GAM)</strong> 的新框架。GAM 遵循 "<strong>即时编译 (JIT)</strong>" 原则，专注于在运行时为其服务对象生成优化上下文，同时在离线阶段仅保留简洁而实用的记忆。为此，GAM 采用双重设计，包含以下组件：1) <strong>记忆器 (Memorizer)</strong>，利用轻量级记忆提取关键历史信息，同时在通用页面存储中维护完整历史记录；2) <strong>研究者 (Researcher)</strong>，基于预构建的记忆，从页面存储中检索并集成有用信息以响应在线请求。这种设计使 GAM 能够有效利用前沿大语言模型 (LLMs) 的智能体能力和推理时扩展性，同时通过强化学习实现端到端性能优化。在实验研究中，我们证明 GAM 在各种记忆驱动型任务完成场景中，相比现有记忆系统，取得了显著提升。</p>
<h2 data-id="heading-2">GigaEvo: An Open Source Optimization Framework Powered By LLMs And Evolution Algorithms</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.17592" target="_blank" title="https://arxiv.org/abs/2511.17592" ref="nofollow noopener noreferrer">GigaEvo：一个由大语言模型和进化算法驱动的开源优化框架</a></p>
<p>大语言模型引导的进化计算领域近期取得重要进展，特别是 AlphaEvolve (Novikov 等人, 2025; Georgiev 等人, 2025) 在发现新颖数学构造和解决复杂优化问题方面展现出卓越成效。然而，现有公开文献中的高层描述未明确说明具体实现细节，这阻碍了研究的可复现性与深入探索。本报告提出 GigaEvo——一个可扩展的开源框架，支持研究人员对受 AlphaEvolve 启发的混合大语言模型-进化方法进行系统研究与实践。该框架采用模块化设计，核心组件包括：MAP-Elites 质量-多样性算法、基于异步有向无环图的评估流水线、支持洞见生成与双向谱系追踪的大语言模型驱动变异算子，以及灵活的多岛进化策略。为验证实现的可复现性，我们使用 AlphaEvolve 论文中的三类典型难题对 GigaEvo 进行评估：Heilbronn 三角形布局、正方形内圆填充问题和高维接吻数问题。本框架强调模块化架构、并行计算与实验便捷性，通过声明式配置支持快速原型开发。我们详细阐述了系统架构设计、关键技术决策与实验方法，旨在推动大语言模型驱动进化算法的持续研究。GigaEvo 框架及完整实验代码已开源：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FAIRI-Institute%2Fgigaevo-core%25E3%2580%2582" target="_blank" title="https://github.com/AIRI-Institute/gigaevo-core%E3%80%82" ref="nofollow noopener noreferrer">github.com/AIRI-Instit…</a></p>
<h2 data-id="heading-3">SAM 3: Segment Anything with Concepts</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.16719" target="_blank" title="https://arxiv.org/abs/2511.16719" ref="nofollow noopener noreferrer">SAM 3：基于概念的分割万物模型</a></p>
<p>我们提出分割万物模型 (SAM) 3，这是一个统一模型，能够根据概念提示检测、分割并跟踪图像和视频中的对象。概念提示定义为短名词短语（如“黄色校车”）、图像示例或两者组合。可提示概念分割 (PCS) 接收这些提示，并输出所有匹配对象实例的分割掩码和唯一标识。为推进 PCS 研究，我们构建了可扩展数据引擎，生成包含 400 万独特概念标签的高质量数据集，涵盖图像和视频中的难负样本。该模型由共享单一骨干网络的图像级检测器和基于记忆的视频跟踪器组成，通过存在头解耦识别与定位模块，显著提升检测精度。SAM 3 在图像与视频 PCS 任务中实现精度翻倍，并优化了先前 SAM 模型在视觉分割任务中的性能。我们开源了 SAM 3 模型及新构建的基于概念的分割万物 (SA-Co) 基准，用于可提示概念分割研究。</p>
<h2 data-id="heading-4">Latent Collaboration in Multi-Agent Systems</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.20639" target="_blank" title="https://arxiv.org/abs/2511.20639" ref="nofollow noopener noreferrer">多智能体系统中的潜在协作</a></p>
<p>多智能体系统 (MAS) 将大语言模型 (LLMs) 从独立的单模型推理扩展至协同的系统级智能。现有 LLM 智能体通常依赖基于文本的中介进行推理与通信，而本研究进一步实现了模型在连续潜在空间中的直接协作。我们提出 LatentMAS，一种端到端的无需训练框架，支持 LLM 智能体间的纯潜在协作。在 LatentMAS 中，各智能体首先通过最后一层隐藏嵌入执行自回归潜在思维生成；随后，一个共享潜在工作记忆负责保存并传递各智能体的内部表示，确保信息无损交换。理论分析表明，相较于基础的基于文本 MAS，LatentMAS 以显著更低的复杂度实现了更强的表达能力与无损信息保留。此外，在数学科学推理、常识理解和代码生成等 9 个综合基准测试中，实证评估显示 LatentMAS 持续优于强单模型及基于文本的 MAS 基线，准确率最高提升 14.6%，输出 Token 用量减少 70.8%-83.7%，端到端推理速度加快 4-4.3 倍。这些结果证明，本潜在协作框架在无需额外训练的前提下，不仅提升了系统级推理质量，还带来了显著的效率增益。代码与数据已完全开源：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FGen-Verse%2FLatentMAS%25E3%2580%2582" target="_blank" title="https://github.com/Gen-Verse/LatentMAS%E3%80%82" ref="nofollow noopener noreferrer">github.com/Gen-Verse/L…</a></p>
<h2 data-id="heading-5">GeoVista: Web-Augmented Agentic Visual Reasoning for Geolocalization</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.15705" target="_blank" title="https://arxiv.org/abs/2511.15705" ref="nofollow noopener noreferrer">GeoVista: 面向地理定位的网络增强智能体视觉推理</a></p>
<p>当前智能体视觉推理的研究虽能实现深度多模态理解，但主要聚焦于图像处理工具，导致在构建更通用智能体模型方面存在不足。本文重新探讨地理定位任务，该任务不仅需要精细的视觉基础能力，还需在推理过程中借助网络搜索来验证或优化假设。鉴于现有地理定位基准无法满足高分辨率图像需求及深度智能体推理的定位挑战，我们构建了GeoBench基准，其中包含全球各地的照片、全景图以及不同城市的卫星图像子集，以严格评估智能体的地理定位能力。同时，我们提出GeoVista模型，它能将工具调用无缝整合到推理回路中，包括用于放大感兴趣区域的图像缩放工具和用于检索相关网络信息的搜索工具。我们为其开发了完整训练流程：首先通过冷启动监督微调 (SFT) 阶段学习推理模式与工具使用先验，再通过强化学习 (RL) 阶段进一步提升推理能力。通过采用分层奖励机制有效利用多级地理信息，显著提升了整体定位性能。实验结果表明，GeoVista在地理定位任务上显著优于其他开源智能体模型，且在多数指标上达到与闭源模型（如Gemini-2.5-flash和GPT-5）相当的水平。</p>
<h2 data-id="heading-6">AutoEnv: Automated Environments for Measuring Cross-Environment Agent Learning</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.19304" target="_blank" title="https://arxiv.org/abs/2511.19304" ref="nofollow noopener noreferrer">AutoEnv：用于测量跨环境智能体学习的自动化环境</a></p>
<p>人类通过在不同动态、观察和奖励结构的世界中学习底层规则，自然地适应多样化环境。相比之下，现有智能体通常通过在单一领域内自我演化来展示改进，隐式地假设了固定的环境分布。跨环境学习在很大程度上仍未得到充分评估：既缺乏可控、异构环境的标准集合，也没有统一的方法来表征智能体如何学习。我们通过两个步骤来解决这些不足。首先，我们提出AutoEnv，一个自动化框架，将环境视为可因子化的转移、观察和奖励分布，实现低成本（平均4.12美元）生成异构世界。利用AutoEnv，我们构建了AutoEnv-36数据集，包含36个环境和358个已验证关卡，在该数据集上，七个语言模型实现了12-49%的归一化奖励，证明了AutoEnv-36的高挑战难度。其次，我们将智能体学习形式化描述为一个以组件为中心的过程，该过程由选择、优化和评估三个阶段驱动，并应用于可改进的智能体组件。基于此形式化，我们设计了八种学习方法，并在AutoEnv-36上对其进行了评估。实证结果表明，任何单一学习方法的性能增益随环境数量增加而迅速下降，揭示出固定学习方法无法在异构环境中扩展。学习方法的自适应环境选择能显著提升性能，但随着方法空间的扩大，表现出收益递减效应。这些结果凸显了智能体学习对于可扩展跨环境泛化的必要性及其当前局限，并将AutoEnv和AutoEnv-36作为研究跨环境智能体学习的测试平台。代码可在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FFoundationAgents%2FAutoEnv%25E8%258E%25B7%25E5%258F%2596%25E3%2580%2582" target="_blank" title="https://github.com/FoundationAgents/AutoEnv%E8%8E%B7%E5%8F%96%E3%80%82" ref="nofollow noopener noreferrer">github.com/FoundationA…</a></p>
<h2 data-id="heading-7">OpenMMReasoner: Pushing the Frontiers for Multimodal Reasoning with an Open and General Recipe</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.16334" target="_blank" title="https://arxiv.org/abs/2511.16334" ref="nofollow noopener noreferrer">OpenMMReasoner：基于开放通用方案推动多模态推理前沿发展</a></p>
<p>大语言推理模型的最新进展，引发了将其能力扩展至多模态领域的广泛关注。然而，尽管视觉推理已取得显著突破，但缺乏透明且可复现的数据构建与训练策略，仍是制约规模化研究的主要障碍。本研究提出OpenMMReasoner——一个完全透明的两阶段多模态推理方案，涵盖监督微调（SFT）和强化学习（RL）两个阶段。在SFT阶段，我们构建了包含87.4万样本的冷启动数据集，并通过严格的分步验证为推理能力奠定坚实基础。后续RL阶段利用跨多个领域的7.4万样本数据集，进一步强化并稳定模型能力，从而实现更鲁棒高效的学习过程。大量实验表明，本训练方案不仅显著超越强基线模型，更揭示了数据质量与训练设计对多模态推理性能的决定性作用。值得注意的是，在九大多模态推理基准测试中，本方法相较Qwen2.5-VL-7B-Instruct基线实现了11.6%的性能提升，为未来大规模多模态推理研究提供了坚实实证基础。我们已在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FEvolvingLMMs-Lab%2FOpenMMReasoner%25E5%25BC%2580%25E6%25BA%2590%25E5%2585%25A8%25E9%2583%25A8%25E4%25BB%25A3%25E7%25A0%2581%25E3%2580%2581%25E8%25AE%25AD%25E7%25BB%2583%25E6%25B5%2581%25E6%25B0%25B4%25E7%25BA%25BF%25E5%258F%258A%25E6%2595%25B0%25E6%258D%25AE%25E3%2580%2582" target="_blank" title="https://github.com/EvolvingLMMs-Lab/OpenMMReasoner%E5%BC%80%E6%BA%90%E5%85%A8%E9%83%A8%E4%BB%A3%E7%A0%81%E3%80%81%E8%AE%AD%E7%BB%83%E6%B5%81%E6%B0%B4%E7%BA%BF%E5%8F%8A%E6%95%B0%E6%8D%AE%E3%80%82" ref="nofollow noopener noreferrer">github.com/EvolvingLMM…</a></p>
<h2 data-id="heading-8">Unveiling Intrinsic Dimension of Texts: from Academic Abstract to Creative Story</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.15210" target="_blank" title="https://arxiv.org/abs/2511.15210" ref="nofollow noopener noreferrer">揭示文本的内在维度：从学术摘要到创意故事</a></p>
<p>内在维度 (ID) 是现代大语言模型分析中的重要工具，可用于研究训练动态、缩放规律和数据集结构，但其文本层面的决定因素尚待深入探索。我们通过交叉编码器分析、语言特征和稀疏自编码器 (SAEs) ，首次开展了基于可解释文本属性的 ID 系统性研究。本研究确立了三个关键发现：第一，ID 与基于熵的指标具有互补性——在控制文本长度后，两者无相关性，ID 捕获的是独立于预测质量的几何复杂度；第二，ID 呈现稳定的体裁分层现象——在所有测试模型中，科学文本显示低 ID 值 (~8) ，百科全书类内容为中等 ID 值 (~9) ，而创意写作与观点类文本则呈现高 ID 值 (~10.5) ，这表明当代大语言模型将科学文本视为“表征简单”的类别，而小说类文本需要更多表征自由度；第三，通过 SAEs 我们识别出因果特征：科学信号（正式语气、报告模板、统计数据）会降低 ID ，而人性化信号（个性化表达、情感元素、叙事结构）则会提升 ID 。定向控制实验证实了这些影响的因果性。因此，对当代模型而言，科学写作相对“易于处理”，而小说、观点性文本及情感内容则增加了表征复杂度。我们的多维度分析为 ID 的合理应用及基于 ID 结论的可靠解读提供了实践指导。</p>
<h2 data-id="heading-9">Multimodal Evaluation of Russian-language Architectures</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.15552" target="_blank" title="https://arxiv.org/abs/2511.15552" ref="nofollow noopener noreferrer">俄语模型的多模态评估</a></p>
<p>多模态大语言模型 (MLLMs) 是当前研究关注的焦点，在规模和能力方面均展现出快速进步，然而其智能水平、局限性及潜在风险尚未得到充分理解。为了解决这些问题，尤其是在俄语语境下，鉴于目前尚无多模态基准，我们引入了 Mera Multi——一个面向俄语模型的开放多模态评估框架。该基准采用指令驱动设计，涵盖默认的文本、图像、音频和视频模态，包含 18 个全新构建的评估任务，面向通用模型及模态特定架构（如图像到文本、视频到文本和音频到文本）。我们的贡献包括：(i) 一套通用多模态能力分类体系；(ii) 18 个从零开始构建的数据集，注重俄语文化及语言特性，并配有统一提示词和评估指标；(iii) 闭源与开源模型的基线性能结果；(iv) 一套防止基准泄漏的防护方法，包括水印技术和私有数据集的许可协议。尽管当前研究聚焦于俄语，但所提出的基准为在类型学多样的语言（特别是斯拉夫语族）中构建多模态评估体系提供了可复现的方法论。</p>
<h2 data-id="heading-10">DeCo: Frequency-Decoupled Pixel Diffusion for End-to-End Image Generation</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.19365" target="_blank" title="https://arxiv.org/abs/2511.19365" ref="nofollow noopener noreferrer">DeCo: 面向端到端图像生成的频率解耦像素扩散方法</a></p>
<p>像素扩散的目标是以端到端方式直接在像素空间生成图像。该方法规避了 VAE 在二阶段潜在扩散中的局限性，从而具备更高的模型容量。现有像素扩散模型因通常在单一扩散 Transformer (DiT) 中同时建模高频信号与低频语义，导致训练和推理速度缓慢。为构建更高效的像素扩散范式，我们提出频率解耦像素扩散框架。基于解耦高频与低频分量生成的思路，我们采用轻量级像素解码器，在 DiT 语义引导下生成高频细节。这使得 DiT 能够专注于低频语义建模。此外，我们引入频率感知流匹配损失，在强化视觉显著频率分量的同时抑制非显著分量。大量实验证明，DeCo 在像素扩散模型中取得最优性能，在 ImageNet 数据集上获得 1.62 (256×256) 和 2.22 (512×512) 的 FID 指标，显著缩小了与潜在扩散方法的性能差距。我们的预训练文生图模型在 GenEval 基准测试的系统级比较中，更以 0.86 的综合得分保持领先。代码已开源：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FZehong-Ma%2FDeCo%25E3%2580%2582" target="_blank" title="https://github.com/Zehong-Ma/DeCo%E3%80%82" ref="nofollow noopener noreferrer">github.com/Zehong-Ma/D…</a></p>
<h2 data-id="heading-11">Computer-Use Agents as Judges for Generative User Interface</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.15567" target="_blank" title="https://arxiv.org/abs/2511.15567" ref="nofollow noopener noreferrer">计算机智能体作为生成式用户界面的评判者</a></p>
<p>计算机智能体 (CUA) 正日益擅长通过图形用户界面 (GUI) 自主操作数字环境。然而，当前大多数 GUI 仍主要面向人类设计（优先考虑美观性和可用性），迫使智能体采用许多对高效任务执行非必要的人类化操作模式。与此同时，编码语言模型 (Coder) 的快速发展正在革新自动 GUI 设计范式。这引出一个核心问题：能否以 CUA 作为评判者，辅助 Coder 实现自动 GUI 设计？为探究此问题，我们推出 AUI-Gym 基准测试集，涵盖 52 个跨领域应用的自动 GUI 开发任务。基于语言模型，我们合成了 1560 个模拟真实场景的任务。为确保任务可靠性，我们还开发了验证模块，通过编程验证每个任务在对应环境中的可执行性。在此基础上，我们提出 Coder-CUA 协同框架：Coder 担任设计者角色，负责生成和迭代优化网站界面；CUA 则作为评判者，评估功能实现质量并指导设计改进。评估标准不依赖视觉表现，而是基于任务可解决性与 CUA 导航成功率。为将 CUA 反馈转化为有效指导，我们设计了 CUA 仪表板，将多步导航轨迹凝练为直观的视觉摘要，为迭代设计提供可解释的优化指引。通过让智能体同时承担设计者与评判者角色，本框架将界面设计推向更符合智能体原生特性的高效可靠范式。本研究推动智能体从被动使用向数字环境主动参与迈出关键一步。代码与数据集详见 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fshowlab%2FAUI%25E3%2580%2582" target="_blank" title="https://github.com/showlab/AUI%E3%80%82" ref="nofollow noopener noreferrer">github.com/showlab/AUI…</a></p>
<h2 data-id="heading-12">DR Tulu: Reinforcement Learning with Evolving Rubrics for Deep Research</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.19399" target="_blank" title="https://arxiv.org/abs/2511.19399" ref="nofollow noopener noreferrer">DR Tulu：基于演化评分标准的强化学习在深度研究中的应用</a></p>
<p>深度研究模型通过多步研究过程生成长篇且引用充分的答案。然而，现有大多数开放深度研究模型采用可验证奖励强化学习 (RLVR) 在易于验证的短篇问答任务上进行训练，这种方法无法扩展到实际的长篇研究任务。为此，我们提出了基于演化评分标准的强化学习 (RLER) 方法，通过构建与策略模型在训练过程中协同演化的评分标准，使评分体系能够整合模型新探索的信息，并提供具有区分度的同策略反馈。基于RLER方法，我们开发了深度研究Tulu模型 (DR Tulu-8B)，这是首个专门针对开放式长篇深度研究任务训练的开放模型。在科学、医疗保健及通用领域的四个长篇深度研究基准测试中，DR Tulu模型显著优于现有开放深度研究模型，其性能达到甚至超越了专有深度研究系统，同时具有更小的模型尺寸和更低的单次查询成本。为促进后续研究，我们完整公开了所有数据、模型和代码，包括新开发的基于MCP的深度研究系统智能体基础设施。</p>
<h2 data-id="heading-13">MedSAM3: Delving into Segment Anything with Medical Concepts</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.19046" target="_blank" title="https://arxiv.org/abs/2511.19046" ref="nofollow noopener noreferrer">MedSAM3：融合医学概念的分割万物模型深入解析</a></p>
<p>医学图像分割是生物医学发现的基础技术。现有方法普遍存在泛化能力不足的问题，且针对新临床应用需进行大量耗时的人工标注。本文提出MedSAM-3模型——一种支持文本提示的医学图像与视频分割模型。通过对Segment Anything Model (SAM) 3架构在医学图像及对应语义概念标签上进行微调，MedSAM-3实现了医学可提示概念分割 (PCS) 功能，能够基于开放词汇文本描述精确定位解剖结构，而不仅依赖几何提示信息。我们还开发了MedSAM-3智能体 (Agent) 框架，通过集成多模态大语言模型 (MLLMs) ，在智能体参与循环的工作流程中实现复杂推理与迭代优化。涵盖X射线、磁共振成像 (MRI) 、超声、计算机断层扫描 (CT) 及视频等多种医学成像模态的综合实验表明，本方法性能显著优于现有专业模型与基础模型。相关代码与模型将在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJoey-S-Liu%2FMedSAM3%25E5%258F%2591%25E5%25B8%2583%25E3%2580%2582" target="_blank" title="https://github.com/Joey-S-Liu/MedSAM3%E5%8F%91%E5%B8%83%E3%80%82" ref="nofollow noopener noreferrer">github.com/Joey-S-Liu/…</a></p>
<h2 data-id="heading-14">Agent0-VL: Exploring Self-Evolving Agent for Tool-Integrated Vision-Language Reasoning</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.19900" target="_blank" title="https://arxiv.org/abs/2511.19900" ref="nofollow noopener noreferrer">Agent0-VL: 探索用于工具集成视觉语言推理的自进化智能体</a></p>
<p>视觉语言智能体在各种多模态推理任务中取得了显著进展，但其学习过程仍受限于人类标注监督的约束。近期出现的自奖励方法尝试通过让模型充当自身评判者或奖励提供者来突破这一限制。然而，纯文本形式的自我评估难以有效验证复杂的视觉推理步骤，且常出现评估幻觉问题。为解决这些挑战，受工具集成推理领域最新进展的启发，我们提出Agent0-VL——一种通过工具集成推理实现持续自我提升的自进化视觉语言智能体。Agent0-VL不仅将工具运用融入推理过程，还将其扩展至自我评估与自我修复环节，使模型能够通过证据驱动的分析实现推理过程的内省、验证与优化。该架构在单一的大视觉语言模型 (LVLM) 中整合了两个协同工作的角色：执行多轮工具集成推理的求解器 (Solver)，以及通过工具化批判生成结构化反馈与细粒度自奖励的验证器 (Verifier)。这些角色通过自进化推理循环 (Self-Evolving Reasoning Cycle) 相互协作，其中基于工具的验证机制与强化学习共同对齐推理与评估的分布，确保稳定的自我改进。通过这种零外部奖励的进化机制，Agent0-VL在无需任何人工标注或外部奖励模型的情况下，实现了推理行为与验证行为的自对齐，达成持续自我优化。在几何问题求解和视觉科学分析领域的实验表明，Agent0-VL相较基础模型实现了12.5%的性能提升。代码已开源：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Faiming-lab%2FAgent0%25E3%2580%2582" target="_blank" title="https://github.com/aiming-lab/Agent0%E3%80%82" ref="nofollow noopener noreferrer">github.com/aiming-lab/…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[安康记1.1.x版本发布]]></title>    <link>https://juejin.cn/post/7577971299743301670</link>    <guid>https://juejin.cn/post/7577971299743301670</guid>    <pubDate>2025-11-30T11:27:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577971299743301670" data-draft-id="7577737385955295242" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="安康记1.1.x版本发布"/> <meta itemprop="keywords" content="iOS,APP"/> <meta itemprop="datePublished" content="2025-11-30T11:27:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="叶子的技术碎碎念"/> <meta itemprop="url" content="https://juejin.cn/user/2831954919569245"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            安康记1.1.x版本发布
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2831954919569245/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    叶子的技术碎碎念
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T11:27:45.000Z" title="Sun Nov 30 2025 11:27:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>安康记新版本已经上线App Store。目前已经更新了独立用药功能，方便一些简单的小毛病可能会自己用药，可以跳过就诊直接进行记录。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31f8043dd94e47f3ac230749b4de5c9c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-25a2Q55qE5oqA5pyv56KO56KO5b-1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765106865&amp;x-signature=kXauweiqFlsfIfm9%2BWwKEQAvL6k%3D" alt="图片" loading="lazy"/></p>
<p>原本这个功能已经上线了有几天了，但因为一直测试发现有一些新的问题，这两周也提交了多次修复版本，目前算是相对稳定了，希望各位能更新体验♪(･ω･)ﾉ</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[探秘 Hugging Face：何为 Hugging Face 及其核心组件全览]]></title>    <link>https://juejin.cn/post/7577991167200673802</link>    <guid>https://juejin.cn/post/7577991167200673802</guid>    <pubDate>2025-11-30T11:52:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577991167200673802" data-draft-id="7577914902430990382" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="探秘 Hugging Face：何为 Hugging Face 及其核心组件全览"/> <meta itemprop="keywords" content="LLM,Agent,程序员"/> <meta itemprop="datePublished" content="2025-11-30T11:52:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型教程"/> <meta itemprop="url" content="https://juejin.cn/user/1145012233707299"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            探秘 Hugging Face：何为 Hugging Face 及其核心组件全览
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1145012233707299/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型教程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T11:52:22.000Z" title="Sun Nov 30 2025 11:52:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aaffe3ada90e4b3290992d72accea62c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765108341&amp;x-signature=fEtJmuGPU5rRA0Q58eqzSgG4sfE%3D" alt="image.png" loading="lazy"/>
Hugging Face 是一个提供先进自然语言处理（ NLP ）工具的平台，支持 Transformer 模型的开发和应用。它拥有庞大的模型库和社区资源，能够满足从研究到工业应用的各种需求。</p>
<h2 data-id="heading-0">一、注册</h2>
<p>官方网址： <a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2F" target="_blank" title="https://huggingface.co/" ref="nofollow noopener noreferrer">huggingface.co/</a></p>
<p>注册好后，点击头像Access Token,创建token 。</p>
<h2 data-id="heading-1">二、功能介绍</h2>
<p>hugging face的核心组件 主要是 Transformers 和Datasets 。</p>
<p><strong>1、Transformers</strong></p>
<p>也就是 Models大模型，平台上有世界上最全的大模型。中国的魔塔社区与此类似，不过没有它全。 我们自己也可以上传大模型到hugging face平台。</p>
<p><strong>2、Datasets</strong></p>
<p>就是数据集，大模型训练用的数据。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f321e197e394efea7f89df065881ca2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765108341&amp;x-signature=Vv5fCrxMO6eW8HBZbtckDJs9FIc%3D" alt="image.png" loading="lazy"/></p>
<p><strong>3、大模型分类</strong></p>
<p>点击“Models”，左侧有分类。主导航有根据“任务Tasks”，“库Libraries”,"数据集DataSets","语言Languages","开源协议Licenses"等。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5921b09a3f0e4a958fcf6eb0e019a56d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765108341&amp;x-signature=wP4raxlWgELmnY%2B%2BweOyl%2FSLYyE%3D" alt="image.png" loading="lazy"/></p>
<p><strong>4、大模型文件</strong></p>
<p>打开千问最新版本 Qwen/QwQ-32B，在"Files and Versions"模型文件页面下，可以看到很多类似”model-00001-of-00014.safetensors“ ，后缀 safetensors就是模型文件的名称。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e4439ec4b9a49849df23b7b774c1337~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765108341&amp;x-signature=HxBrKXMBRsNEN3XeSS77lKoa%2Fek%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f5f671797fcb41b9b7abae97b0c63654~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765108341&amp;x-signature=2T7a95089lls%2F4XH%2FJR%2BxjRzUxc%3D" alt="" loading="lazy"/></p>
<p><strong>5、Inference Providers</strong></p>
<p>hugging face平台上有很多大模型提供接口试用，列表有黄色闪电标记，详情的右侧有Inference Providers。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1174da38a9941f4a376a42202a567d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765108341&amp;x-signature=lhTxOSiKBuEFLUIUcZcazZ23uMw%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1a16e2c68a5494faac8c4a0c1fc43fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765108341&amp;x-signature=27Ir2xtg8udeaMTGXHR1Eea0rzI%3D" alt="" loading="lazy"/></p>
<p>不过接口调用不是很稳定，时长不通。</p>
<p><strong>6、下载大模型文件</strong></p>
<p>下载大模型文件到本地，官方提供了多种方式。</p>
<p>（1）git clone方式</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a0fb375ec4c04d4b88aa55998ebd8c18~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765108341&amp;x-signature=6EsBj5EvGobXMyZmjXJc6Sl21cQ%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> https://huggingface.co/Qwen/QwQ-32B
</code></pre>
<p>（2）使用hugging face提供的transformers库下载</p>
<p>     下一节重点讲解。 </p>
<h2 data-id="heading-2">三、使用 Transformers 库</h2>
<p>Hugging Face 提供了 transformers 库，用于加载和使用模型 。你可以使用以下命令来安装它：（电 脑须安装基础环境：Anaconda,CUDA,cuDNN,pytorch ）</p>
<pre><code class="hljs">pip install transformers
</code></pre>
<p>如果你还需要安装其他依赖库，如 datasets 和 tokenizers ，可以使用以下命令：</p>
<pre><code class="hljs">pip install transformers datasets tokenizers
</code></pre>
<p>1、下载模型</p>
<p>使用代码下载模型到本地，代码演示使用depeek-r1-1.5b,小一点。等待大概几分钟就下载完成了，主要看网速。</p>
<pre><code class="hljs language-ini" lang="ini">from  transformers import AutoTokenizer,AutoModelForCausalLM
<span class="hljs-attr">model_name</span>=<span class="hljs-string">"deepseek-ai/DeepSeek-R1-Distill-Qwen-1.5B"</span>
<span class="hljs-attr">cache_dir</span>=<span class="hljs-string">"model3/deepseek-ai/DeepSeek-R1-Distill-Qwen-1.5B"</span>
<span class="hljs-comment">#下载模型</span>
AutoModelForCausalLM.from_pretrained(model_name,<span class="hljs-attr">cache_dir</span>=cache_dir)
<span class="hljs-comment">#下载分词工具</span>
AutoTokenizer.from_pretrained(model_name,<span class="hljs-attr">cache_dir</span>=cache_dir)
print(f"模型和分词器已下载到：{cache_dir}")
</code></pre>
<p>AutoModelForCausalLM 是 Hugging Face 的 Transformers 库中的一个类，主要用于处理因果语言模型（Causal Language Model）任务。大部分的text-generation类型的大模型都可以使用这个类。</p>
<p>模型和分词器一般都是成对下载。</p>
<p>代码中model_name的名称一定要是 hugging face上模型的完整名称。cache_dir是本地文件目录，可以使用绝对路径，pycharm开发时，可使用相对路径。</p>
<p>2、模型文件介绍</p>
<p>下载好后的目录如下 </p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/72f21579b7dd4101822a5075af6f8f85~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765108341&amp;x-signature=vUpLxgeeoXD29kYp97bsl9gScFI%3D" alt="" loading="lazy"/></p>
<p>模型的核心内容主要是看 snapshots-config.json所在的目录，也是模型的默认目录地址。model.safetensors就是模型的源文件，</p>
<p>（1）config.json文件</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
<span class="hljs-attr">"architectures"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
<span class="hljs-string">"Qwen2ForCausalLM"</span>
<span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"attention_dropout"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.0</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"bos_token_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">151643</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"eos_token_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">151643</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"hidden_act"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"silu"</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"hidden_size"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1536</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"initializer_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.02</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"intermediate_size"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">8960</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"max_position_embeddings"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">131072</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"max_window_layers"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">21</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"model_type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"qwen2"</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"num_attention_heads"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">12</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"num_hidden_layers"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">28</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"num_key_value_heads"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"rms_norm_eps"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1e-06</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"rope_theta"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10000</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"sliding_window"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4096</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"tie_word_embeddings"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"torch_dtype"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"bfloat16"</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"transformers_version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"4.44.0"</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"use_cache"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"use_mrope"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"use_sliding_window"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"vocab_size"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">151936</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>vocab_size是模型可以识别的字符个数。有些模型文件vocab.txt文件，就是可以识别字符列表。若输入的字符不在这个范围内，分词器会根据配置的special_tokens里的值来赋值。比如下面的：</p>
<pre><code class="hljs language-ini" lang="ini">BertTokenizer(<span class="hljs-attr">name_or_path</span>=<span class="hljs-string">'D:\Test\LLMTrain\day02\model\bert-base-chinese\models--bert-base-chinese\snapshots\c30a6ed22ab4564dc1e3b2ecbf6e766b0611a33f'</span>, vocab_size=<span class="hljs-number">21128</span>, model_max_length=<span class="hljs-number">512</span>, is_fast=<span class="hljs-literal">False</span>, padding_side=<span class="hljs-string">'right'</span>, truncation_side=<span class="hljs-string">'right'</span>, special_tokens={<span class="hljs-string">'unk_token'</span>: <span class="hljs-string">'[UNK]'</span>, <span class="hljs-string">'sep_token'</span>: <span class="hljs-string">'[SEP]'</span>, <span class="hljs-string">'pad_token'</span>: <span class="hljs-string">'[PAD]'</span>, <span class="hljs-string">'cls_token'</span>: <span class="hljs-string">'[CLS]'</span>, <span class="hljs-string">'mask_token'</span>: <span class="hljs-string">'[MASK]'</span>}, clean_up_tokenization_spaces=<span class="hljs-literal">True</span>, added_tokens_decoder={
</code></pre>
<p>3、Pipelines运行本地模型</p>
<p>大模型下载到本地，就可以使用了，transformers库中的pipelines是一个非常实用的高级工具，它为自然语言处理（NLP）任务提供了一种简单、便捷且统一的接口，使得用户无需深入了解模型的具体细节就能轻松完成各种常见的 NLP 任务。pipelines的主要特点如下：</p>
<p>（1） 简化模型使用流程</p>
<p>在传统的使用方式中，若要使用一个预训练模型完成特定任务，需要手动完成加载模型、分词、编码、推理、解码等一系列复杂的步骤。而pipelines将这些步骤进行了封装，用户只需提供任务类型和必要的输入，就能直接得到任务的处理结果。</p>
<p>例如，使用pipelines进行文本分类： </p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> BertTokenizer,BertForSequenceClassification,pipeline
<span class="hljs-comment">#设置具体包含config.json的目录，只支持绝对路径</span>
model_dir = <span class="hljs-string">r"model\bert-base-chinese"</span>
<span class="hljs-comment">#加载模型和分词器</span>
model = BertForSequenceClassification.from_pretrained(<span class="hljs-string">"bert-base-chinese"</span>,cache_dir=model_dir)
tokenizer = BertTokenizer.from_pretrained(<span class="hljs-string">"bert-base-chinese"</span>,cache_dir=model_dir)
<span class="hljs-comment">#创建分类pipleine</span>
classifier = pipeline(<span class="hljs-string">"text-classification"</span>,model=model,tokenizer=tokenizer,device=<span class="hljs-string">"cpu"</span>)
<span class="hljs-comment">#进行文本分类</span>
result = classifier(<span class="hljs-string">"你好，我是一款语言模型"</span>)
<span class="hljs-built_in">print</span>(result)
<span class="hljs-built_in">print</span>(model)
</code></pre>
<p>上述代码中，用户只需创建一个text - classification类型的管道，然后传入文本，就能直接得到文本的分类结果，无需关心模型加载、分词等底层操作。</p>
<p>（2）支持多种常见 NLP 任务</p>
<p>pipelines支持多种常见的自然语言处理任务，以下是一些常见任务及其示例：</p>
<p>文本分类：判断文本所属的类别，如情感分析（积极、消极）、主题分类等。 </p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">classifier</span> = pipeline(<span class="hljs-string">'text-classification'</span>)
<span class="hljs-attr">result</span> = classifier(<span class="hljs-string">"This is a great product!"</span>)
</code></pre>
<p><strong>问答系统：根据给定的上下文和问题，找出问题的答案。</strong></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">qa</span> = pipeline(<span class="hljs-string">'question-answering'</span>)
<span class="hljs-attr">context</span> = <span class="hljs-string">"Albert Einstein was a German-born theoretical physicist. He developed the theory of relativity."</span>
<span class="hljs-attr">question</span> = <span class="hljs-string">"Who developed the theory of relativity?"</span>
<span class="hljs-attr">result</span> = qa(question=question, context=context)
</code></pre>
<p>文本生成：根据输入的文本生成相关的文本内容，如故事续写、摘要生成等。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">generator</span> = pipeline(<span class="hljs-string">'text-generation'</span>)
<span class="hljs-attr">input_text</span> = <span class="hljs-string">"Once upon a time"</span>
<span class="hljs-attr">result</span> = generator(input_text, max_length=<span class="hljs-number">100</span>)
</code></pre>
<p>命名实体识别（NER）：识别文本中的命名实体，如人名、地名、组织机构名等。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">ner</span> = pipeline(<span class="hljs-string">'ner'</span>)
<span class="hljs-attr">text</span> = <span class="hljs-string">"Apple is looking at buying U.K. startup for $1 billion"</span>
<span class="hljs-attr">result</span> = ner(text)
</code></pre>
<p>（3）自动选择合适的模型</p>
<p>pipelines会根据指定的任务类型自动选择合适的预训练模型。例如，当你创建一个text - classification管道时，它会默认选择一个在文本分类任务上表现良好的预训练模型。当然，你也可以手动指定使用的模型，只需在创建管道时传入model参数即可。 </p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 使用指定的模型创建文本分类管道</span>
<span class="hljs-attr">classifier</span> = pipeline(<span class="hljs-string">'text-classification'</span>, model=<span class="hljs-string">'distilbert-base-uncased-finetuned-sst-2-english'</span>)
</code></pre>
<p>注意，这里需要能联网，并且能科学上网。可以使用本地的大模型调用。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment">#本地离线调用deepseek-r1</span>
from transformers import AutoModelForCausalLM,AutoTokenizer,pipeline
<span class="hljs-comment">#设置具体包含config.json的目录，只支持绝对路径</span>
<span class="hljs-attr">model_dir</span> = r<span class="hljs-string">"D:\trsanformers_test\model3\deepseek-ai\DeepSeek-R1-Distill-Qwen-1.5B\models--deepseek-ai--DeepSeek-R1-Distill-Qwen-1.5B\snapshots\ad9f0ae0864d7fbcd1cd905e3c6c5b069cc8b562"</span>
<span class="hljs-comment">#加载模型和分词器</span>
<span class="hljs-attr">model</span> = AutoModelForCausalLM.from_pretrained(model_dir)
<span class="hljs-attr">tokenizer</span> = AutoTokenizer.from_pretrained(model_dir)
<span class="hljs-comment"># 模拟多轮对话，设置角色信息</span>
<span class="hljs-attr">messages</span> = [
{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"请使用java写一个冒泡排序。"</span>}
]
<span class="hljs-comment"># 构建输入文本，按照 DeepSeek - R1 的格式</span>
<span class="hljs-attr">input_text</span> = <span class="hljs-string">""</span>
for message in messages:
if message<span class="hljs-section">["role"]</span> == "user":
input_text += f"&lt;|UserBegin|&gt;{message<span class="hljs-section">['content']</span>}&lt;|UserEnd|&gt;"
elif message<span class="hljs-section">["role"]</span> == "assistant":
input_text += f"{message<span class="hljs-section">['content']</span>}"
<span class="hljs-comment">#使用加载的模型和分词器创建生成文本的pipeline</span>
<span class="hljs-attr">generator</span> = pipeline(<span class="hljs-string">"text-generation"</span>,model=model,tokenizer=tokenizer,device=<span class="hljs-string">"cpu"</span>)
<span class="hljs-comment">#生成文本</span>
<span class="hljs-comment"># output = generator("你好，我是一款语言模型，",max_length=50,num_return_sequences=1)</span>
<span class="hljs-attr">output</span> = generator(
input_text,<span class="hljs-comment">#生成文本的输入种子文本（prompt）。模型会根据这个初始文本，生成后续的文本</span>
<span class="hljs-attr">max_length</span>=<span class="hljs-number">1500</span>,<span class="hljs-comment">#指定生成文本的最大长度。这里的 50 表示生成的文本最多包含 50 个标记（tokens）</span>
<span class="hljs-attr">num_return_sequences</span>=<span class="hljs-number">1</span>,<span class="hljs-comment">#参数指定返回多少个独立生成的文本序列。值为 1 表示只生成并返回一段文本。</span>
<span class="hljs-attr">truncation</span>=<span class="hljs-literal">True</span>,<span class="hljs-comment">#该参数决定是否截断输入文本以适应模型的最大输入长度。如果 True，超出模型最大输入长度的部分将被截断；如果 False，模型可能无法处理过长的输入，可能会报错。</span>
<span class="hljs-attr">temperature</span>=<span class="hljs-number">0.7</span>,<span class="hljs-comment">#该参数控制生成文本的随机性。值越低，生成的文本越保守（倾向于选择概率较高的词）；值越高，生成的文本越多样（倾向于选择更多不同的词）。0.7 是一个较为常见的设置，既保留了部分随机性，又不至于太混乱。</span>
<span class="hljs-attr">top_k</span>=<span class="hljs-number">50</span>,<span class="hljs-comment">#该参数限制模型在每一步生成时仅从概率最高的 k 个词中选择下一个词。这里 top_k=50 表示模型在生成每个词时只考虑概率最高的前 50 个候选词，从而减少生成不太可能的词的概率。</span>
<span class="hljs-attr">top_p</span>=<span class="hljs-number">0.9</span>,<span class="hljs-comment">#该参数（又称为核采样）进一步限制模型生成时的词汇选择范围。它会选择一组累积概率达到 p 的词汇，模型只会从这个概率集合中采样。top_p=0.9 意味着模型会在可能性最强的 90% 的词中选择下一个词，进一步增加生成的质量。</span>
<span class="hljs-attr">clean_up_tokenization_spaces</span>=<span class="hljs-literal">True</span><span class="hljs-comment">#该参数控制生成的文本中是否清理分词时引入的空格。如果设置为 True，生成的文本会清除多余的空格；如果为 False，则保留原样。默认值即将改变为 False，因为它能更好地保留原始文本的格式。</span>
)
print(output)
</code></pre>
<h3 data-id="heading-3">学习资源推荐</h3>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[大宗供应链企业舆情指标系统设计（一）舆情指标设计]]></title>    <link>https://juejin.cn/post/7577958825342320659</link>    <guid>https://juejin.cn/post/7577958825342320659</guid>    <pubDate>2025-11-30T10:03:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577958825342320659" data-draft-id="7577905525997764649" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="大宗供应链企业舆情指标系统设计（一）舆情指标设计"/> <meta itemprop="keywords" content="数据分析"/> <meta itemprop="datePublished" content="2025-11-30T10:03:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="语落心生"/> <meta itemprop="url" content="https://juejin.cn/user/2875978147955741"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            大宗供应链企业舆情指标系统设计（一）舆情指标设计
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2875978147955741/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    语落心生
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-30T10:03:34.000Z" title="Sun Nov 30 2025 10:03:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    16
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近自己个人业务有个客户一个大宗供应量销量预测与智能预测的需求。但是大宗供应链的场景，多半就是跟地缘政治因素强关联的，调研几个月，记录一下自己的思考</p>
<hr/>
<h2 data-id="heading-0">目录</h2>
<ol>
<li><a href="#%E9%A1%B9%E7%9B%AE%E6%A6%82%E8%BF%B0" title="#%E9%A1%B9%E7%9B%AE%E6%A6%82%E8%BF%B0">项目概述</a></li>
<li><a href="#%E8%88%86%E6%83%85%E6%8C%87%E6%A0%87%E4%BD%93%E7%B3%BB" title="#%E8%88%86%E6%83%85%E6%8C%87%E6%A0%87%E4%BD%93%E7%B3%BB">舆情指标体系</a></li>
<li><a href="#%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84" title="#%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84">技术架构</a></li>
<li><a href="#%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B" title="#%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B">数据模型</a></li>
<li><a href="#%E5%AE%9E%E6%97%B6%E7%AE%A1%E9%81%93" title="#%E5%AE%9E%E6%97%B6%E7%AE%A1%E9%81%93">实时管道</a></li>
<li><a href="#%E6%8C%87%E6%A0%87%E8%AE%A1%E7%AE%97" title="#%E6%8C%87%E6%A0%87%E8%AE%A1%E7%AE%97">指标计算</a></li>
</ol>
<hr/>
<h2 data-id="heading-1">项目概述</h2>
<h3 data-id="heading-2">1.1 大宗商品企业的舆情风险</h3>
<p>大宗商品供应链企业（钢铁、石油、粮食、矿产）面临四类核心风险：</p>



































<table><thead><tr><th>风险维度</th><th>具体表现</th><th>影响度量</th><th>舆情指标</th></tr></thead><tbody><tr><td><strong>A.物理物流中断</strong></td><td>港口罢工、海峡阻塞、基础设施损坏</td><td>延迟天数</td><td>物流延迟指数(LDI)</td></tr><tr><td><strong>B.监管贸易限制</strong></td><td>出口禁令、制裁、关税变化</td><td>合规成本</td><td>合规风险指数(CRI)</td></tr><tr><td><strong>C.政治安全不稳定</strong></td><td>内战冲突、恐怖活动、政权更迭</td><td>保险费上升</td><td>地缘政治指数(GRI)</td></tr><tr><td><strong>D.经济金融冲击</strong></td><td>货币崩溃、主权违约、支付中断</td><td>交易对手风险</td><td>金融风险指数(FRI)</td></tr></tbody></table>
<p><strong>舆情指标系统的核心价值</strong>：</p>
<ul>
<li>非结构化新闻→定量决策指标 (&lt;5分钟延迟)</li>
<li>按地理位置+商品种类的采购商特定风险评估</li>
<li>交易、物流、金融对冲的量化决策支持</li>
</ul>
<h3 data-id="heading-3">1.2 系统设计目标</h3>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">实时性: 事件→摄取→NLP→指标 &lt;5分钟</span>
<span class="hljs-section">准确性: NLP分类&gt;95%, 指标相关性&gt;0.8</span>
<span class="hljs-section">覆盖: 150+采购商, 200+新闻源, 4类商品</span>
<span class="hljs-section">可操作: 直接输入贸易/物流/金融系统</span>
</code></pre>
<hr/>
<h2 data-id="heading-4">舆情指标体系</h2>
<h3 data-id="heading-5">2.1 四层舆情指标框架</h3>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">第1层: 基础采样指标</span>
├─ 事件频率 (events/day)
├─ 新闻热度 (7day_volume)
├─ 网络舆论倾向 (sentiment)
└─ NLP置信度 (confidence)

<span class="hljs-section">第2层: 维度风险指标 (A/B/C/D四维)</span>
├─ LDI: 物流延迟风险 (0-10)
├─ CRI: 合规监管风险 (0-10)
├─ GRI: 地缘政治风险 (0-10)
└─ FRI: 金融支付风险 (0-10)

<span class="hljs-section">第3层: 综合舆情指标</span>
├─ 综合风险指数 (0-100)
├─ 采购商特定风险 (考虑货运量+商品敏感性)
└─ 舆情vs实际风险相关度 (-1~1)

<span class="hljs-section">第4层: 战略决策支持</span>
├─ 预警等级 (Green/Yellow/Orange/Red)
├─ 建议应急措施
├─ 对冲对象
└─ 物流替代方案评分
</code></pre>
<h3 data-id="heading-6">2.2 维度指标具体定义</h3>
<h4 data-id="heading-7">LDI: 物流延迟风险指数</h4>
<pre><code class="hljs language-erlang" lang="erlang">公式: LDI = Σ(severity × location_proximity × commodity_multiplier)

<span class="hljs-function"><span class="hljs-title">severity_score</span> <span class="hljs-params">(港口罢工:<span class="hljs-number">6</span>-<span class="hljs-number">8</span>, 海峡阻塞:<span class="hljs-number">8</span>-<span class="hljs-number">9</span>, 铁路破坏:<span class="hljs-number">4</span>-<span class="hljs-number">6</span>, 空域关闭:<span class="hljs-number">3</span>-<span class="hljs-number">5</span>)</span>
<span class="hljs-title">location_proximity</span> <span class="hljs-params">(距离衰减: &lt;<span class="hljs-number">500</span>km→<span class="hljs-number">1.0</span>, <span class="hljs-number">500</span>-<span class="hljs-number">2000</span>km→<span class="hljs-number">0.8</span>, &gt;<span class="hljs-number">5000</span>km→<span class="hljs-number">0.2</span>)</span>
<span class="hljs-title">commodity_multiplier</span> <span class="hljs-params">(易腐农产品:<span class="hljs-number">1.5</span>, 冷链:<span class="hljs-number">2.0</span>, 金属矿产:<span class="hljs-number">0.5</span>)</span>

示例: 上海采购商采购大豆, 巴拿马运河关闭
  LDI = <span class="hljs-params">(<span class="hljs-number">8</span>严重度 × <span class="hljs-number">0.8</span>距离系数 × <span class="hljs-number">1.5</span>易腐性)</span> = 9.6/10 <span class="hljs-params">(红色告警)</span>
</span></code></pre>
<h4 data-id="heading-8">CRI: 合规监管风险指数</h4>
<pre><code class="hljs language-ini" lang="ini">公式: <span class="hljs-attr">CRI</span> = Σ(impact_severity × enforcement_probability × exposure_ratio)

impact_severity (新增制裁:9-10, 出口禁令:7-8, 关税&gt;15%:5-6, 关税5-15%:2-3)
enforcement_probability (立即:1.0, 30天:0.8, 90天:0.5, 讨论:0.2)
exposure_ratio (该地区采购额 / 总采购额)

示例: 俄罗斯铁矿石禁令, 采购商A占15%
  CRI增量 = 8 × 0.8 × <span class="hljs-attr">0.15</span> = <span class="hljs-number">0.96</span>分
</code></pre>
<h4 data-id="heading-9">GRI: 地缘政治风险指数</h4>
<pre><code class="hljs language-erlang" lang="erlang">公式: GRI = (severity × conflict_intensity × duration_decay) / redundancy × 操作乘数

<span class="hljs-function"><span class="hljs-title">event_severity</span> <span class="hljs-params">(全面战争:<span class="hljs-number">9</span>-<span class="hljs-number">10</span>, 区域冲突:<span class="hljs-number">7</span>-<span class="hljs-number">8</span>, 大规模抗议:<span class="hljs-number">5</span>-<span class="hljs-number">6</span>)</span>
<span class="hljs-title">conflict_intensity</span> <span class="hljs-params">(ACLED数据: 死亡人数/事件频率)</span>
<span class="hljs-title">duration_decay</span> <span class="hljs-params">(刚发生:<span class="hljs-number">1.0</span>, <span class="hljs-number">1</span>-<span class="hljs-number">7</span>天:<span class="hljs-number">0.9</span>, <span class="hljs-number">1</span>-<span class="hljs-number">4</span>周:<span class="hljs-number">0.7</span>, <span class="hljs-number">1</span>-<span class="hljs-number">3</span>月:<span class="hljs-number">0.5</span>, &gt;<span class="hljs-number">3</span>月:<span class="hljs-number">0.3</span>)</span>
<span class="hljs-title">infrastructure_redundancy</span> <span class="hljs-params">(无替代:<span class="hljs-number">1.0</span>, <span class="hljs-number">1</span>条:<span class="hljs-number">0.7</span>, <span class="hljs-number">2</span>+条:<span class="hljs-number">0.4</span>)</span>
操作乘数 <span class="hljs-params">(劳动力撤出:<span class="hljs-number">1.5</span>, 保险费上升:<span class="hljs-number">1.3</span>, 工人安全:<span class="hljs-number">1.2</span>)</span>
</span></code></pre>
<h4 data-id="heading-10">FRI: 金融支付风险指数</h4>
<pre><code class="hljs language-ini" lang="ini">公式: <span class="hljs-attr">FRI</span> = Σ(financial_severity × counterparty_exposure × forward_duration)

financial_severity (SWIFT除名:9-10, 主权违约:8-9, 货币贬值&gt;30%:7-8)
counterparty_exposure (该国交易额占比)
forward_duration (待结算&lt;7天:1.0, 预期交易7-30天:0.8, 期货30-90天:0.6)

示例: 阿根廷比索危机, 采购商敞口12%, 待结算30天
  FRI增量 = 8 × 0.12 × <span class="hljs-attr">0.8</span> = <span class="hljs-number">0.77</span>分
</code></pre>
<h3 data-id="heading-11">2.3 综合舆情指标</h3>
<pre><code class="hljs language-ini" lang="ini">综合风险指数 (CRI_Composite):
  = 40% × (LDI + CRI)/2 + 60% × (GRI + FRI)/<span class="hljs-attr">2</span>
  = 40% × 物流合规风险 + 60% × 地缘金融风险
  范围: 0-100

采购商特定风险 (Buyer_Specific):
  = 综合风险指数 × 货运量权重 × 商品敏感性乘数
  
  商品敏感性:
  ├─ 农产品(谷物): 1.5 (高敏感)
  ├─ 石油: 1.3 (中高敏感)
  ├─ 金属矿产: 0.7 (低敏感)
  └─ 煤炭: 0.9 (中敏感)

预警等级:
  Green (0-25):   无实质风险, 常规监测
  Yellow (25-50): 中等风险, 激活预案
  Orange (50-75): 高风险, 立即采取措施
  Red (75-100):   极危状态, 启动危机管理
</code></pre>
<hr/>
<h2 data-id="heading-12">技术架构</h2>
<h3 data-id="heading-13">3.1 整体数据流</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">多源数据</span> <span class="hljs-string">→</span> <span class="hljs-string">Kafka</span> <span class="hljs-string">→</span> <span class="hljs-string">Flink</span> <span class="hljs-string">ETL</span> <span class="hljs-string">→</span> <span class="hljs-string">Paimon</span> <span class="hljs-string">(湖)</span> <span class="hljs-string">→</span> <span class="hljs-string">Doris</span> <span class="hljs-string">(分析)</span> <span class="hljs-string">→</span> <span class="hljs-string">应用</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">新闻源</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">地缘政治数据</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">制裁名单</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">商品期货</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">港口状态</span>
  <span class="hljs-string">└─</span> <span class="hljs-string">金融数据</span>

<span class="hljs-string">关键特点:</span>
<span class="hljs-string">├─</span> <span class="hljs-attr">Paimon:</span> <span class="hljs-string">原始数据+标准化数据存储,</span> <span class="hljs-string">支持版本控制、时间旅行</span>
<span class="hljs-string">├─</span> <span class="hljs-attr">Doris:</span> <span class="hljs-string">实时OLAP分析,</span> <span class="hljs-string">秒级查询,</span> <span class="hljs-string">支持高并发</span>
<span class="hljs-string">└─</span> <span class="hljs-attr">Flink:</span> <span class="hljs-string">实时流处理,</span> <span class="hljs-string">NLP分类,</span> <span class="hljs-string">指标计算</span>
</code></pre>
<h3 data-id="heading-14">3.2 为何选择Paimon</h3>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> 湖表一体:
   ├─ 原始数据保留在数据湖 (HDFS/S3)
   ├─ 实时指标在表结构中维护
   └─ 降低数据重复存储成本

<span class="hljs-bullet">2.</span> 时间旅行与版本控制:
   ├─ 查询历史快照 ("昨天下午2点的指标?")
   ├─ 完整审计日志 (舆情变化追溯)
   └─ 风险回溯分析不可或缺

<span class="hljs-bullet">3.</span> 高效增量更新:
   ├─ Flink直接流式写入
   ├─ Merge操作 (重复事件去重)
   └─ 避免全量重新计算

<span class="hljs-bullet">4.</span> ACID事务:
   ├─ 舆情指标一致性保证
   ├─ 多维度并发更新无脏数据
   └─ 金融级别的准确性要求

Paimon表设计:
├─ mgir<span class="hljs-emphasis">_events_</span>raw: 原始事件 (90天保留)
├─ mgir<span class="hljs-emphasis">_events_</span>standardized: NLP后标准化事件
└─ mgir<span class="hljs-emphasis">_dimension_</span>scores: 维度指标增量表
</code></pre>
<h3 data-id="heading-15">3.3 为何选择Doris</h3>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> 实时分析性能:
   ├─ 向量化执行+Pipeline模型
   ├─ 查询P95 &lt;1秒 (百亿行数据)
   ├─ 支持1000+并发查询
   └─ BI仪表板实时刷新

<span class="hljs-bullet">2.</span> 多维聚合能力:
   ├─ Rollup和物化视图预计算
   ├─ 按(采购商, 商品, 小时)粒度聚合
   ├─ BI直接读取预聚合结果
   └─ 特别适合舆情指标多维钻取

<span class="hljs-bullet">3.</span> 数据新鲜度:
   ├─ Paimon数据实时导入 (5分钟)
   ├─ 准实时分析能力
   └─ 舆情指标时效性保证

<span class="hljs-bullet">4.</span> 低成本存储:
   ├─ 列式压缩率高 (8-10倍)
   ├─ 相比关系数据库成本 1/10
   └─ 承载2年+历史数据

Doris表设计:
├─ mgir<span class="hljs-emphasis">_indices_</span>fact: 实时指标事实表
├─ mgir<span class="hljs-emphasis">_indices_</span>hourly<span class="hljs-emphasis">_agg: 小时聚合表 (Rollup)
├─ buyer_</span>dimension: 采购商维度表
└─ commodity<span class="hljs-emphasis">_dimension: 商品维度表
</span></code></pre>
<hr/>
<h2 data-id="heading-16">数据模型</h2>
<h3 data-id="heading-17">4.1 Paimon原始事件表</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- mgir_events_raw_paimon</span>
<span class="hljs-comment">-- 存储所有摄取的原始新闻/事件 (未处理)</span>
<span class="hljs-comment">-- 分片: (risk_date, buyer_geo_key) hash</span>
<span class="hljs-comment">-- TTL: 90天 (用于模型再训练)</span>

字段:
├─ event_id (UUID, PK)
├─ ingest_timestamp (<span class="hljs-type">TIMESTAMP</span>)
├─ risk_date (<span class="hljs-type">DATE</span>)
├─ source_type (STRING: news<span class="hljs-operator">/</span>api<span class="hljs-operator">/</span>...)
├─ source_name (STRING)
├─ source_url (STRING)
├─ raw_text (TEXT)
├─ <span class="hljs-keyword">language</span> (STRING)
├─ detected_geo_keys (<span class="hljs-keyword">ARRAY</span><span class="hljs-operator">&lt;</span>STRING<span class="hljs-operator">&gt;</span>)
├─ keywords (<span class="hljs-keyword">ARRAY</span><span class="hljs-operator">&lt;</span>STRING<span class="hljs-operator">&gt;</span>)
├─ nlp_processing_flag (<span class="hljs-type">BOOLEAN</span>)
├─ processing_version (<span class="hljs-type">INT</span>)
└─ confidence_raw (<span class="hljs-type">FLOAT</span>)

特性:
├─ 版本控制: 支持时间旅行查询
├─ ACID: 数据一致性保证
└─ 保留期: <span class="hljs-number">90</span>天
</code></pre>
<h3 data-id="heading-18">4.2 Paimon标准化事件表</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- mgir_events_standardized_paimon</span>
<span class="hljs-comment">-- 存储NLP处理后的标准化事件</span>
<span class="hljs-comment">-- 支持Merge操作 (去重)</span>

关键字段:
├─ event_id (UUID, PK)
├─ raw_event_id (UUID)
├─ risk_date (<span class="hljs-type">DATE</span>)
├─ delivery_impact_dim (ENUM: A<span class="hljs-operator">/</span>B<span class="hljs-operator">/</span>C<span class="hljs-operator">/</span>D)
├─ severity_subcategory (STRING)
├─ impact_severity_score (<span class="hljs-type">FLOAT</span>: <span class="hljs-number">0</span><span class="hljs-number">-10</span>)
├─ sentiment_score_nlp (<span class="hljs-type">FLOAT</span>: <span class="hljs-number">-1</span><span class="hljs-operator">~</span><span class="hljs-number">1</span>)
├─ confidence_score_nlp (<span class="hljs-type">FLOAT</span>: <span class="hljs-number">0</span><span class="hljs-number">-1</span>)
├─ primary_buyer_geo_key (STRING)
├─ affected_buyer_geo_keys (<span class="hljs-keyword">ARRAY</span><span class="hljs-operator">&lt;</span>STRING<span class="hljs-operator">&gt;</span>)
├─ commodity_type (STRING)
├─ geographic_locations (<span class="hljs-keyword">ARRAY</span><span class="hljs-operator">&lt;</span>STRUCT<span class="hljs-operator">&gt;</span>)
│  ├─ location_name, latitude, longitude
│  ├─ gis_type, relevance_score
├─ extracted_entities (<span class="hljs-keyword">ARRAY</span><span class="hljs-operator">&lt;</span>STRUCT<span class="hljs-operator">&gt;</span>)
│  ├─ entity_name, entity_type, confidence
├─ nlp_model_version (STRING)
├─ processing_timestamp (<span class="hljs-type">TIMESTAMP</span>)
└─ update_version (<span class="hljs-type">INT</span>)

特性:
├─ 去重: <span class="hljs-keyword">Merge</span>按event_id, 保留最新版本
├─ ACID事务: 保证一致性
└─ 主键约束: event_id
</code></pre>
<h3 data-id="heading-19">4.3 Doris实时指标事实表</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- mgir_indices_fact_doris</span>
<span class="hljs-comment">-- 存储计算后的实时舆情指标</span>
<span class="hljs-comment">-- 分区: risk_date | Bucket: 32 (按buyer_geo_key hash)</span>

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> mgir_indices_fact_doris (
  event_id UUID <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  ingest_timestamp DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  risk_date <span class="hljs-type">DATE</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  buyer_geo_key <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  commodity_type <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  delivery_impact_dim <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">10</span>),
  impact_severity_score <span class="hljs-type">FLOAT</span>,
  sentiment_score_nlp <span class="hljs-type">FLOAT</span>,
  confidence_score_nlp <span class="hljs-type">FLOAT</span>,
  ldi_score <span class="hljs-type">FLOAT</span>,          <span class="hljs-comment">-- 物流延迟指标</span>
  cri_score <span class="hljs-type">FLOAT</span>,          <span class="hljs-comment">-- 合规风险指标</span>
  gri_score <span class="hljs-type">FLOAT</span>,          <span class="hljs-comment">-- 地缘政治指标</span>
  fri_score <span class="hljs-type">FLOAT</span>,          <span class="hljs-comment">-- 金融风险指标</span>
  composite_risk_index <span class="hljs-type">FLOAT</span>,       <span class="hljs-comment">-- 综合风险 (0-100)</span>
  buyer_specific_risk_score <span class="hljs-type">FLOAT</span>,  <span class="hljs-comment">-- 采购商特定风险</span>
  sentiment_vs_risk_corr <span class="hljs-type">FLOAT</span>,     <span class="hljs-comment">-- 舆情vs风险相关度</span>
  risk_alert_level <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">10</span>),     <span class="hljs-comment">-- Green/Yellow/Orange/Red</span>
  source_url <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">500</span>),
  location_latitude <span class="hljs-keyword">DOUBLE</span>,
  location_longitude <span class="hljs-keyword">DOUBLE</span>,
  location_distance_to_buyer <span class="hljs-type">FLOAT</span>,
  forecast_impact_duration <span class="hljs-type">INT</span>
)
ENGINE <span class="hljs-operator">=</span> OLAP
DUPLICATE KEY (event_id)
<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">RANGE</span> (risk_date) ()
DISTRIBUTED <span class="hljs-keyword">BY</span> HASH(buyer_geo_key) BUCKETS <span class="hljs-number">32</span>
PROPERTIES ("replication_num" <span class="hljs-operator">=</span> "3");

索引:
├─ <span class="hljs-keyword">PRIMARY</span> KEY: event_id
├─ INDEX: (buyer_geo_key, risk_date)
├─ INDEX: (composite_risk_index)
└─ BLOOM <span class="hljs-keyword">FILTER</span>: (buyer_geo_key, commodity_type)
</code></pre>
<h3 data-id="heading-20">4.4 Doris维度表</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- buyer_dimension_doris (采购商维度)</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> buyer_dimension_doris (
  buyer_geo_key <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">PRIMARY</span> KEY,
  buyer_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">200</span>),
  country_code <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">10</span>),
  region_code <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>),
  latitude <span class="hljs-keyword">DOUBLE</span>,
  longitude <span class="hljs-keyword">DOUBLE</span>,
  annual_volume_usd <span class="hljs-type">BIGINT</span>,
  main_commodities <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">500</span>),
  supply_chain_complexity <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>),
  alternative_suppliers_cnt <span class="hljs-type">INT</span>,
  risk_appetite <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>),
  contact_email <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>),
  risk_manager_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>),
  last_updated DATETIME
)
ENGINE <span class="hljs-operator">=</span> OLAP
DISTRIBUTED <span class="hljs-keyword">BY</span> HASH(buyer_geo_key);

<span class="hljs-comment">-- commodity_dimension_doris (商品维度)</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> commodity_dimension_doris (
  commodity_code <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">PRIMARY</span> KEY,
  commodity_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">200</span>),
  commodity_category <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>),
  perishability_multiplier <span class="hljs-type">FLOAT</span>,    <span class="hljs-comment">-- 0.5-2.0</span>
  storage_cost_per_day_usd <span class="hljs-type">FLOAT</span>,
  typical_transport_duration <span class="hljs-type">INT</span>,
  price_volatility_yearly <span class="hljs-type">FLOAT</span>,
  ldi_base_weight <span class="hljs-type">FLOAT</span>,
  cri_base_weight <span class="hljs-type">FLOAT</span>,
  gri_base_weight <span class="hljs-type">FLOAT</span>,
  fri_base_weight <span class="hljs-type">FLOAT</span>,
  last_updated DATETIME
)
ENGINE <span class="hljs-operator">=</span> OLAP
DISTRIBUTED <span class="hljs-keyword">BY</span> HASH(commodity_code);
</code></pre>
<hr/>
<h2 data-id="heading-21">实时管道</h2>
<h3 data-id="heading-22">5.1 数据源摄取</h3>
<pre><code class="hljs language-markdown" lang="markdown">数据源分类:

<span class="hljs-bullet">1.</span> 新闻与舆情源 (文本)
   ├─ 路透社、彭博社、CNBC、WSJ
   ├─ 区域主流新闻网站
   ├─ Twitter/X舆论情感
   └─ 频率: 实时/5分钟

<span class="hljs-bullet">2.</span> 地缘政治数据 (结构化)
   ├─ ACLED (冲突事件)
   ├─ ICG (危机分析报告)
   ├─ 官方声明 (国务院/外交部)
   └─ 频率: 每天/每周

<span class="hljs-bullet">3.</span> 制裁与监管 (结构化)
   ├─ OFAC制裁名单 (美国财政部)
   ├─ EU制裁名单 (欧盟理事会)
   ├─ 进出口禁令
   └─ 频率: 实时/每天更新

<span class="hljs-bullet">4.</span> 商品市场 (高频结构化)
   ├─ CME期货、LME金属、现货价格
   ├─ 交易所API
   └─ 频率: 秒级更新

<span class="hljs-bullet">5.</span> 港口与物流 (实时)
   ├─ 港口状态、船舶AIS、海峡通过
   └─ 频率: 实时/10分钟

<span class="hljs-bullet">6.</span> 金融与汇率 (高频)
   ├─ 外汇、国债收益率、CDS价差
   └─ 频率: 秒-分钟级

Kafka主题设计:
├─ raw<span class="hljs-emphasis">_news_</span>events: 原始新闻 (32分区, 7天保留)
├─ geopolitical<span class="hljs-emphasis">_conflict_</span>events: 冲突数据 (8分区, 30天)
├─ sanctions<span class="hljs-emphasis">_and_</span>regulations: 制裁更新 (4分区, 90天)
├─ commodity<span class="hljs-emphasis">_prices_</span>stream: 商品价格 (16分区, 3天)
├─ port<span class="hljs-emphasis">_logistics_</span>status: 港口状态 (8分区, 7天)
└─ financial<span class="hljs-emphasis">_indicators: 金融指标 (16分区, 1天)
</span></code></pre>
<h3 data-id="heading-23">5.2 Flink流处理任务</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">Flink任务拓扑:</span>

<span class="hljs-attr">Source:</span> <span class="hljs-string">Kafka</span> <span class="hljs-number">6</span><span class="hljs-string">个Topic消费</span>
  <span class="hljs-string">↓</span>
[<span class="hljs-string">数据清洗与标准化</span>]
  <span class="hljs-string">├─</span> <span class="hljs-string">格式转换</span> <span class="hljs-string">(JSON/XML</span> <span class="hljs-string">→</span> <span class="hljs-string">Struct)</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">去重</span> <span class="hljs-string">(按source_url或content</span> <span class="hljs-string">hash)</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">时间同步</span> <span class="hljs-string">(UTC时区)</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">质量检查</span> <span class="hljs-string">(null处理)</span>
  <span class="hljs-string">└─</span> <span class="hljs-string">异常值处理</span>
  <span class="hljs-string">↓</span>
[<span class="hljs-string">NLP处理</span>] <span class="hljs-string">(Stateless)</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">语言检测与翻译</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">命名实体识别</span> <span class="hljs-string">(NER)</span>
  <span class="hljs-string">│</span>  <span class="hljs-string">├─</span> <span class="hljs-string">地点识别</span> <span class="hljs-string">(港口、国家、海峡)</span>
  <span class="hljs-string">│</span>  <span class="hljs-string">├─</span> <span class="hljs-string">采购商识别</span>
  <span class="hljs-string">│</span>  <span class="hljs-string">└─</span> <span class="hljs-string">商品识别</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">事件分类</span> <span class="hljs-string">(A/B/C/D四维)</span>
  <span class="hljs-string">│</span>  <span class="hljs-string">└─</span> <span class="hljs-string">微调BERT/RoBERTa模型</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">情感分析</span> <span class="hljs-string">(sentiment_score)</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">严重度评分</span> <span class="hljs-string">(impact_severity)</span>
  <span class="hljs-string">└─</span> <span class="hljs-string">置信度评估</span> <span class="hljs-string">(confidence)</span>
  <span class="hljs-string">↓</span>
[<span class="hljs-string">维度指标计算</span>] <span class="hljs-string">(Stateful时间窗口)</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">窗口:</span> <span class="hljs-number">60</span><span class="hljs-string">分钟滑动,</span> <span class="hljs-number">30</span><span class="hljs-string">分钟步长</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">计算LDI:</span> <span class="hljs-string">GroupBy</span> <span class="hljs-string">(buyer_geo_key,</span> <span class="hljs-string">commodity)</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">计算CRI:</span> <span class="hljs-string">GroupBy</span> <span class="hljs-string">(buyer_geo_key,</span> <span class="hljs-string">region)</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">计算GRI:</span> <span class="hljs-string">GroupBy</span> <span class="hljs-string">(buyer_geo_key,</span> <span class="hljs-string">conflict_zone)</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">计算FRI:</span> <span class="hljs-string">GroupBy</span> <span class="hljs-string">(buyer_geo_key,</span> <span class="hljs-string">country)</span>
  <span class="hljs-string">└─</span> <span class="hljs-string">应用衰减函数:</span> <span class="hljs-string">历史事件权重递减</span>
  <span class="hljs-string">↓</span>
[<span class="hljs-string">综合指标合成</span>] <span class="hljs-string">(Stateless)</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">综合风险指数</span> <span class="hljs-string">=</span> <span class="hljs-number">40</span><span class="hljs-string">%(LDI+CRI)/2</span> <span class="hljs-string">+</span> <span class="hljs-number">60</span><span class="hljs-string">%(GRI+FRI)/2</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">采购商特定风险</span> <span class="hljs-string">=</span> <span class="hljs-string">综合指数</span> <span class="hljs-string">×</span> <span class="hljs-string">货运量</span> <span class="hljs-string">×</span> <span class="hljs-string">商品敏感性</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">舆情vs风险相关度</span> <span class="hljs-string">(相关性分析)</span>
  <span class="hljs-string">└─</span> <span class="hljs-string">预警等级转换</span> <span class="hljs-string">(Green/Yellow/Orange/Red)</span>
  <span class="hljs-string">↓</span>
<span class="hljs-attr">Sink:</span> <span class="hljs-string">并行输出</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">Paimon表</span> <span class="hljs-attr">1:</span> <span class="hljs-string">mgir_events_raw</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">Paimon表</span> <span class="hljs-attr">2:</span> <span class="hljs-string">mgir_events_standardized</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">Paimon表</span> <span class="hljs-attr">3:</span> <span class="hljs-string">mgir_dimension_scores</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">Doris表:</span> <span class="hljs-string">mgir_indices_fact</span>
  <span class="hljs-string">├─</span> <span class="hljs-string">告警系统</span> <span class="hljs-string">(即时处理Red级)</span>
  <span class="hljs-string">└─</span> <span class="hljs-string">监控日志</span>

<span class="hljs-string">并行度配置:</span>
<span class="hljs-string">├─</span> <span class="hljs-string">数据清洗:</span> <span class="hljs-number">32</span>
<span class="hljs-string">├─</span> <span class="hljs-string">NLP处理:</span> <span class="hljs-number">16</span> <span class="hljs-string">(GPU场景)</span>
<span class="hljs-string">├─</span> <span class="hljs-string">指标计算:</span> <span class="hljs-number">32</span> <span class="hljs-string">(高计算密集)</span>
<span class="hljs-string">├─</span> <span class="hljs-string">数据输出:</span> <span class="hljs-number">16</span>
<span class="hljs-string">└─</span> <span class="hljs-attr">Checkpoint:</span> <span class="hljs-number">60</span><span class="hljs-string">秒间隔,</span> <span class="hljs-string">RocksDB后端</span>
</code></pre>
<hr/>
<h2 data-id="heading-24">指标计算</h2>
<h3 data-id="heading-25">6.1 LDI计算示例</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># Flink代码示例</span>

<span class="hljs-keyword">from</span> pyflink.datastream <span class="hljs-keyword">import</span> StreamExecutionEnvironment
<span class="hljs-keyword">from</span> pyflink.datastream.functions <span class="hljs-keyword">import</span> MapFunction, WindowFunction
<span class="hljs-keyword">from</span> pyflink.datastream.window <span class="hljs-keyword">import</span> TumblingEventTimeWindow

<span class="hljs-keyword">class</span> <span class="hljs-title class_">LDICalculator</span>(<span class="hljs-title class_ inherited__">WindowFunction</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">apply</span>(<span class="hljs-params">self, key, window, elements</span>):
        buyer_geo, commodity = key
        
        ldi_score = <span class="hljs-number">0.0</span>
        <span class="hljs-keyword">for</span> event <span class="hljs-keyword">in</span> elements:
            <span class="hljs-comment"># 基础严重度</span>
            severity = self.get_severity_score(event[<span class="hljs-string">'delivery_impact_dim'</span>])
            
            <span class="hljs-comment"># 距离衰减系数</span>
            distance = self.get_distance_to_buyer(
                event[<span class="hljs-string">'location_lat'</span>], 
                event[<span class="hljs-string">'location_lon'</span>],
                buyer_geo
            )
            proximity_factor = self.distance_decay(distance)
            
            <span class="hljs-comment"># 商品易腐性乘数</span>
            commodity_multiplier = self.get_commodity_multiplier(commodity)
            
            <span class="hljs-comment"># LDI累加</span>
            event_ldi = severity * proximity_factor * commodity_multiplier
            
            <span class="hljs-comment"># 衰减函数: 事件发生越早权重越小</span>
            days_old = (now - event[<span class="hljs-string">'risk_date'</span>]).days
            decay_factor = math.exp(-<span class="hljs-number">0.1</span> * days_old)  <span class="hljs-comment"># 半衰期10天</span>
            
            ldi_score += event_ldi * decay_factor
        
        <span class="hljs-comment"># 归一化到0-10</span>
        ldi_normalized = <span class="hljs-built_in">min</span>(<span class="hljs-number">10.0</span>, ldi_score)
        
        <span class="hljs-keyword">yield</span> (buyer_geo, commodity, ldi_normalized)
</code></pre>
<h3 data-id="heading-26">6.2 综合风险指数计算</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CompositeRiskCalculator</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate</span>(<span class="hljs-params">self, ldi, cri, gri, fri, 
                  volume_weight, commodity_sensitivity</span>):
        <span class="hljs-string">"""
        综合风险指数 = 40% × (LDI+CRI)/2 + 60% × (GRI+FRI)/2
        采购商特定风险 = 综合指数 × 货运量权重 × 商品敏感性
        """</span>
        
        <span class="hljs-comment"># 第2层: 维度指标平均</span>
        logistics_compliance_avg = (ldi + cri) / <span class="hljs-number">2.0</span>
        geopolitical_financial_avg = (gri + fri) / <span class="hljs-number">2.0</span>
        
        <span class="hljs-comment"># 综合舆情指数 (0-100)</span>
        composite_index = (
            <span class="hljs-number">0.4</span> * logistics_compliance_avg +
            <span class="hljs-number">0.6</span> * geopolitical_financial_avg
        ) * <span class="hljs-number">10</span>  <span class="hljs-comment"># 缩放到0-100</span>
        
        <span class="hljs-comment"># 采购商特定风险 (考虑货运量和商品敏感性)</span>
        buyer_specific_risk = (
            composite_index * 
            volume_weight * 
            commodity_sensitivity
        )
        buyer_specific_risk = <span class="hljs-built_in">min</span>(<span class="hljs-number">100.0</span>, buyer_specific_risk)
        
        <span class="hljs-comment"># 预警等级</span>
        alert_level = self.get_alert_level(buyer_specific_risk)
        
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">'composite_risk_index'</span>: composite_index,
            <span class="hljs-string">'buyer_specific_risk_score'</span>: buyer_specific_risk,
            <span class="hljs-string">'risk_alert_level'</span>: alert_level
        }
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_alert_level</span>(<span class="hljs-params">self, risk_score</span>):
        <span class="hljs-keyword">if</span> risk_score &lt; <span class="hljs-number">25</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">'Green'</span>
        <span class="hljs-keyword">elif</span> risk_score &lt; <span class="hljs-number">50</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">'Yellow'</span>
        <span class="hljs-keyword">elif</span> risk_score &lt; <span class="hljs-number">75</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">'Orange'</span>
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">'Red'</span>
</code></pre>
<h3 data-id="heading-27">6.3 舆情相关度计算</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate_sentiment_risk_correlation</span>(<span class="hljs-params">
    sentiment_scores: <span class="hljs-type">List</span>[<span class="hljs-built_in">float</span>],
    risk_scores: <span class="hljs-type">List</span>[<span class="hljs-built_in">float</span>]
</span>) -&gt; <span class="hljs-built_in">float</span>:
    <span class="hljs-string">"""
    计算舆情热度与实际风险的相关度
    
    &gt;0.7: 舆情热度与实际风险高度相关
    0.3-0.7: 中等相关
    &lt;0.3: 低相关 (舆情为"噪音")
    """</span>
    
    <span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
    
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(sentiment_scores) &lt; <span class="hljs-number">2</span> <span class="hljs-keyword">or</span> <span class="hljs-built_in">len</span>(risk_scores) &lt; <span class="hljs-number">2</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-number">0.0</span>
    
    s = np.array(sentiment_scores)
    r = np.array(risk_scores)
    
    <span class="hljs-comment"># Pearson相关系数</span>
    correlation = np.corrcoef(s, r)[<span class="hljs-number">0</span>, <span class="hljs-number">1</span>]
    
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">float</span>(correlation) <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> np.isnan(correlation) <span class="hljs-keyword">else</span> <span class="hljs-number">0.0</span>
</code></pre>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>