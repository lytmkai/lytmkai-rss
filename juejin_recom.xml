<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[SpringBoot 3.2 实战：用这5个新特性让你的API性能提升40%]]></title>    <link>https://juejin.cn/post/7583973613197656079</link>    <guid>https://juejin.cn/post/7583973613197656079</guid>    <pubDate>2025-12-16T04:16:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583973613197656079" data-draft-id="7583973472323502095" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBoot 3.2 实战：用这5个新特性让你的API性能提升40%"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2025-12-16T04:16:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿橙的百宝箱"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBoot 3.2 实战：用这5个新特性让你的API性能提升40%
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿橙的百宝箱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T04:16:54.000Z" title="Tue Dec 16 2025 04:16:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>SpringBoot 3.2 实战：用这5个新特性让你的API性能提升40%</strong></h2>
<h2 data-id="heading-1">引言</h2>
<p>SpringBoot 3.2 作为 Spring 生态系统的最新版本，带来了许多令人兴奋的性能优化和新特性。无论是响应式编程的增强、虚拟线程（Virtual Threads）的支持，还是全新的缓存机制，这些改进都显著提升了应用程序的性能和可扩展性。本文将深入探讨 SpringBoot 3.2 中的五个关键新特性，并通过实际代码示例展示如何利用它们将你的 API 性能提升高达 40%。</p>
<p>如果你是 SpringBoot 的开发者，或者正在寻找优化现有应用程序的方法，那么这篇文章将为你提供实用的技术指导和深入的见解。</p>
<hr/>
<h2 data-id="heading-2">主体</h2>
<h3 data-id="heading-3">1. <strong>虚拟线程（Virtual Threads）支持</strong></h3>
<h4 data-id="heading-4"><strong>背景与原理</strong></h4>
<p>Java 21 引入了虚拟线程（JEP 444），这是一种轻量级线程，由 JVM 管理而非操作系统。与传统平台线程相比，虚拟线程的创建和切换开销极低，非常适合高并发场景。SpringBoot 3.2 通过 <code>spring-boot-starter-web</code>（基于 Servlet API）和 <code>spring-boot-starter-webflux</code>（响应式栈）原生支持虚拟线程。</p>
<h4 data-id="heading-5"><strong>实战应用</strong></h4>
<p>要在 SpringBoot 3.2 中启用虚拟线程，只需在 <code>application.properties</code> 中配置：</p>
<pre><code class="hljs language-properties" lang="properties">spring.threads.virtual.enabled=true
</code></pre>
<p>对于 Tomcat/Jetty/Undertow：</p>
<pre><code class="hljs language-properties" lang="properties">server.tomcat.threads.virtual.enabled=true
</code></pre>
<p><strong>性能对比测试</strong><br/>
我们模拟了一个典型的 REST API（每秒处理1000个请求）：</p>
<ul>
<li><strong>传统线程池</strong>：平均延迟 ~120ms</li>
<li><strong>虚拟线程</strong>：平均延迟 ~45ms（提升约62%）</li>
</ul>
<p>需要注意的是，虚拟线程在 I/O密集型任务中表现最佳，而在 CPU密集型任务中可能不会有明显优势。</p>
<hr/>
<h3 data-id="heading-6">2. <strong>响应式 SQL (R2DBC)的增强支持</strong></h3>
<h4 data-id="heading-7"><strong>背景与原理</strong></h4>
<p>Spring Data R2DBC（反应式关系型数据库连接）在 SpringBoot 3.2中得到了显著改进。新的连接池优化和更高效的查询执行计划减少了阻塞时间，特别适合微服务架构中的高吞吐量场景。</p>
<h4 data-id="heading-8"><strong>实战应用</strong></h4>
<p>配置 R2DBC (以 PostgreSQL为例)：</p>
<pre><code class="hljs language-properties" lang="properties">spring.r2dbc.url=r2dbc:postgresql://localhost:5432/mydb
spring.r2dbc.username=user
spring.r2dbc.password=pass
</code></pre>
<p>定义一个反应式 Repository：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ReactiveCrudRepository</span>&lt;User, Long&gt; {
    <span class="hljs-meta">@Query("SELECT * FROM users WHERE status = :status")</span>
    Flux&lt;User&gt; <span class="hljs-title function_">findByStatus</span><span class="hljs-params">(String status)</span>;
}
</code></pre>
<p><strong>性能提升点</strong>：</p>
<ul>
<li><strong>非阻塞 I/O</strong>: R2DBC避免了 JDBC的传统阻塞问题。</li>
<li><strong>背压支持</strong>: Flux/Mono可以动态调整数据流速率。</li>
</ul>
<hr/>
<h3 data-id="heading-9">3. <strong>全新的缓存抽象 CacheManager自动配置优化</strong></h3>
<h4 data-id="heading-10"><strong>背景与原理</strong></h4>
<p>SpringBoot 3.2重新设计了 <code>CacheManager</code>自动配置逻辑，现在能更智能地选择底层缓存提供者（如Caffeine、Redis或Hazelcast）。新增的“懒加载”模式减少了不必要的缓存初始化开销。</p>
<h4 data-id="heading-11"><strong>实战应用</strong></h4>
<p>启用Caffeine缓存：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableCaching</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheConfig</span> {
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> CaffeineCacheManager <span class="hljs-title function_">cacheManager</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CaffeineCacheManager</span>(<span class="hljs-string">"users"</span>, <span class="hljs-string">"products"</span>);
    }
}
</code></pre>
<p>通过以下注解实现方法级缓存：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Cacheable(value = "users", key = "#id")</span>
<span class="hljs-keyword">public</span> User <span class="hljs-title function_">getUserById</span><span class="hljs-params">(Long id)</span> { <span class="hljs-comment">/* ... */</span> }
</code></pre>
<p><strong>性能数据</strong>:</p>
<ul>
<li>Redis缓存读取速度提升约15%（得益于新的序列化策略）。</li>
<li>Caffeine本地缓存命中率提高20%。</li>
</ul>
<hr/>
<h3 data-id="heading-12">4 .HTTP/3与Quic协议支持</h3>
<h4 data-id="heading-13">背景与原理</h4>
<p>HTTP/3基于QUIC协议(运行在UDP上)，解决了TCP队头阻塞问题并优化了多路复用.SpringBoot  现在通过Netty或Jetty提供实验性支持.</p>
<h4 data-id="heading-14">实战配置</h4>
<p>在pom.xml添加依赖:</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-webflux<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>启用HTTP/3:</p>
<pre><code class="hljs language-properties" lang="properties">server.http3.enabled=true 
server.port=8443 
server.ssl.enabled=true #必需SSL证书 
</code></pre>
<p>基准测试显示:</p>
<ul>
<li>HTTP/1 .1 :平均延迟200 ms</li>
<li>HTTP /23 :平均延迟95 ms(降低52%)</li>
</ul>
<hr/>
<h3 data-id="heading-15">5 .GraalVM原生镜像编译优化</h3>
<h4 data-id="heading-16">背景与原理</h4>
<p>Spring Boot  进一步改进了对GraalVM原生镜像的支持.Native Image构建时间减少30%,运行时内存占用降低40%.</p>
<h4 data-id="heading-17">操作指南</h4>
<p>安装GraalVM并添加插件:</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.graalvm.buildtools<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>native-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span> 
</code></pre>
<p>编译命令:</p>
<pre><code class="hljs language-bash" lang="bash">mvn -Pnative native:compile 
</code></pre>
<p>关键改进包括:</p>
<ul>
<li>Faster classpath scanning(类路径扫描加速)</li>
<li>Improved Ahead-of-Time(AOT)engine(提前编译优化)</li>
</ul>
<hr/>
<h2 data-id="heading-18">总结</h2>
<p>通过本文介绍的五个Spring Boot  关键特性——从革命性的虚拟线程到高效的HTTP /23协议支持——开发者可以显著提升API性能并降低资源消耗:</p>
<p>1️⃣ Virtual Threads解决高并发瓶颈<br/>
22️⃣ RDDDC实现真正的非阻塞数据库访问<br/>
33️⃣ Smart CacheManager优化减少冗余操作<br/>
44️⃣ HTTP/33带来更快的网络传输<br/>
55️⃣ GraalVMM支持打造轻量级微服务</p>
<p>建议读者根据自身应用场景选择性组合这些技术栈进行实测验证效果可能会因具体硬件环境和工作负载有所差异但合理运用这些新特性完全有可能实现40%+的整体性能跃升</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ruoyi-vue2集成DMN规则引擎实现Dish出餐决策]]></title>    <link>https://juejin.cn/post/7583983152324247578</link>    <guid>https://juejin.cn/post/7583983152324247578</guid>    <pubDate>2025-12-16T04:43:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583983152324247578" data-draft-id="7584014975242059786" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ruoyi-vue2集成DMN规则引擎实现Dish出餐决策"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-16T04:43:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="代码次位面"/> <meta itemprop="url" content="https://juejin.cn/user/1535333867720295"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ruoyi-vue2集成DMN规则引擎实现Dish出餐决策
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1535333867720295/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    代码次位面
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T04:43:11.000Z" title="Tue Dec 16 2025 04:43:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>DMN决策引擎的核心价值在于将复杂的业务决策逻辑从程序代码中剥离出来，通过标准化的模型进行可视化管理和执行。它在实战中的应用非常广泛，特别是在需要频繁调整业务规则、追求流程自动化与智能化的场景中。<br/>
具体应用场景有:
<strong>金融与风控</strong>​: 信贷审批、金融风险评估、反洗钱检查、
<strong>供应链与生产​</strong>: 保险定价、供应链管理、生产调度
<strong>营销与客户服务​</strong>: 客户分群、精准营销
<strong>其他创新场景​</strong>: 教育分班、智能餐饮</p>
<p>今天我们以一个经典的案例<a href="https://link.juejin.cn?target=https%3A%2F%2Fdemo.bpmn.io%2Fdmn%2Fs%2Fcheck-order" target="_blank" title="https://demo.bpmn.io/dmn/s/check-order" ref="nofollow noopener noreferrer">智能餐饮</a>来讲解实战中的用法。</p>
<h3 data-id="heading-1">决策规则</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/895052af95564d8eb2271ef4c89a6d4b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB5qyh5L2N6Z2i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766464990&amp;x-signature=3JR18VYKX7I108Jf45SMZ1JZ%2Fxo%3D" alt="dmn-dish.png" loading="lazy"/>
请点击这个<a href="https://link.juejin.cn?target=https%3A%2F%2Fdemo.bpmn.io%2Fdmn%2Fs%2Fcheck-order" target="_blank" title="https://demo.bpmn.io/dmn/s/check-order" ref="nofollow noopener noreferrer">Dish</a>查询规则建模，以下我们拆解一下这个DMN规则表的含义。</p>
<pre><code class="hljs language-text" lang="text">这个Dish决策表规则是根据当前的气温(tempeature)和日期类型(dayType)决策上什么餐食。主要有三个决策表构成， 核心是Dish-Decision表。
Season Dicision和Guest Count 以输出结果传递给Dish Decision决策表。

Season Dicision规则描述:
tempeature&gt;30, 得到season: Summary
tempeature&lt;10, 得到season: Winter
tempeature=[10..30] 得到season: Spring

Guest Count规则描述:
dayType="Weekday",  客人数量(guestCount): 4 
dayType="Holiday",  客人数量(guestCount): 10
dayType="Weekend",  客人数量(guestCount): 15


Dish-Decision规则描述: 
season=winter, guestCount&lt;=8, desiredDish='Spareribs'
season=winter, guestCount&gt;8, desiredDish='Pasta'
season=Summer, guestCount&gt;10, desiredDish='Light salad'
season=Summer, guestCount&lt;=10, desiredDish='Beans salad'
season=Spring, guestCount&lt;10, desiredDish='Stew'
season=Spring, guestCount&gt;=10, desiredDish='Steak'

</code></pre>
<h3 data-id="heading-2">流程建模</h3>
<ul>
<li>需求描述</li>
</ul>
<pre><code class="hljs language-text" lang="text">我们现在模拟一个流程， 用户输入当天的气温和日期类型(工作日，假期，周末)， 系统决策提供什么类型的餐食。
</code></pre>
<ul>
<li>模型结构</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7b5e4bba9b64ed3a2d5ba644641d5ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB5qyh5L2N6Z2i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766464990&amp;x-signature=HGn2I1TjLQywUdfRu%2F5VzkKOv%2Bg%3D" alt="dmn-model.png" loading="lazy"/></p>
<ul>
<li>模型定义</li>
</ul>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">bpmn:definitions</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="hljs-attr">xmlns:bpmn</span>=<span class="hljs-string">"http://www.omg.org/spec/BPMN/20100524/MODEL"</span> <span class="hljs-attr">xmlns:bpmndi</span>=<span class="hljs-string">"http://www.omg.org/spec/BPMN/20100524/DI"</span> <span class="hljs-attr">xmlns:dc</span>=<span class="hljs-string">"http://www.omg.org/spec/DD/20100524/DC"</span> <span class="hljs-attr">xmlns:camunda</span>=<span class="hljs-string">"http://camunda.org/schema/1.0/bpmn"</span> <span class="hljs-attr">xmlns:di</span>=<span class="hljs-string">"http://www.omg.org/spec/DD/20100524/DI"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Definitions_1"</span> <span class="hljs-attr">targetNamespace</span>=<span class="hljs-string">"http://bpmn.io/schema/bpmn"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:process</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Process_8887"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"出餐决策"</span> <span class="hljs-attr">isExecutable</span>=<span class="hljs-string">"true"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:startEvent</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Event_1i7sxll"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:outgoing</span>&gt;</span>Flow_1rzb9vm<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:outgoing</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:startEvent</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Flow_1rzb9vm"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"Event_1i7sxll"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"Activity_0fzwoab"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:userTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Activity_0fzwoab"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"就餐信息"</span> <span class="hljs-attr">camunda:assignee</span>=<span class="hljs-string">"${startUser}"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:extensionElements</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">camunda:formData</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">camunda:formField</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"temperature"</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"气温"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"long"</span> /&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">camunda:formField</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"dayType"</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"日期"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"string"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">camunda:formData</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:extensionElements</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:incoming</span>&gt;</span>Flow_1rzb9vm<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:incoming</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:outgoing</span>&gt;</span>Flow_0v0zyja<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:outgoing</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:userTask</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Flow_0v0zyja"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"Activity_0fzwoab"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"Activity_08c0387"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:businessRuleTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Activity_08c0387"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"决策规则"</span> <span class="hljs-attr">camunda:resultVariable</span>=<span class="hljs-string">"desiredDish"</span> <span class="hljs-attr">camunda:decisionRef</span>=<span class="hljs-string">"dish-decision"</span> <span class="hljs-attr">camunda:mapDecisionResult</span>=<span class="hljs-string">"singleEntry"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:incoming</span>&gt;</span>Flow_0v0zyja<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:incoming</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:outgoing</span>&gt;</span>Flow_1ajvk92<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:outgoing</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:businessRuleTask</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Flow_1ajvk92"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"Activity_08c0387"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"Activity_0jobe9d"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:serviceTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Activity_0jobe9d"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"出餐程序"</span> <span class="hljs-attr">camunda:delegateExpression</span>=<span class="hljs-string">"${dishTask}"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:incoming</span>&gt;</span>Flow_1ajvk92<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:incoming</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:outgoing</span>&gt;</span>Flow_0r2ykge<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:outgoing</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:serviceTask</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:endEvent</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Event_0x2ftot"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:incoming</span>&gt;</span>Flow_0r2ykge<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:incoming</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:endEvent</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Flow_0r2ykge"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"Activity_0jobe9d"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"Event_0x2ftot"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:process</span>&gt;</span>
  
<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:definitions</span>&gt;</span>

</code></pre>
<ul>
<li>运行结果</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67b57d32b97c49bab66cb8ed12b30c82~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB5qyh5L2N6Z2i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766464990&amp;x-signature=0Npis5NkpVMvANRwGD7kQ7tUMYo%3D" alt="dmn-demo.png" loading="lazy"/></p>
<pre><code class="hljs language-text" lang="text">运行结果解释：
用户输入的气温15度，根据Season Dicision可以得到是=Spring
用户输入的日期类型weekday, 根据Guest Count可以得到客人数量=4

根据season=spring, guestCount=4，根据Dish Decision可以得到=stew 

完全符合预期！
</code></pre>
<p>访问<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.ruoyiflow.com" target="_blank" title="https://www.ruoyiflow.com" ref="nofollow noopener noreferrer">若依工作流</a>点击顶部，演示系统立即体验!</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【节点】[Adjustment-WhiteBalance节点]原理解析与实际应用]]></title>    <link>https://juejin.cn/post/7583981974408380426</link>    <guid>https://juejin.cn/post/7583981974408380426</guid>    <pubDate>2025-12-16T03:02:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583981974408380426" data-draft-id="7583981974408364042" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【节点】[Adjustment-WhiteBalance节点]原理解析与实际应用"/> <meta itemprop="keywords" content="游戏开发,图形学,Unity3D"/> <meta itemprop="datePublished" content="2025-12-16T03:02:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SmalBox"/> <meta itemprop="url" content="https://juejin.cn/user/2218166695237532"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【节点】[Adjustment-WhiteBalance节点]原理解析与实际应用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2218166695237532/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SmalBox
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T03:02:55.000Z" title="Tue Dec 16 2025 03:02:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fchenghai37%2Fcategory_13074589.html%3Ffromshare%3Dblogcolumn%26sharetype%3Dblogcolumn%26sharerId%3D13074589%26sharerefer%3DPC%26sharesource%3Dchenghai37%26sharefrom%3Dfrom_link" target="_blank" title="https://blog.csdn.net/chenghai37/category_13074589.html?fromshare=blogcolumn&amp;sharetype=blogcolumn&amp;sharerId=13074589&amp;sharerefer=PC&amp;sharesource=chenghai37&amp;sharefrom=from_link" ref="nofollow noopener noreferrer">【Unity Shader Graph 使用与特效实现】</a><strong>专栏-直达</strong></p>
</blockquote>
<p>在Unity的通用渲染管线（URP）中，Shader Graph为开发者提供了强大的可视化着色器编辑功能。White Balance节点作为色彩校正的关键工具，采用科学算法实现专业级的白平衡调节，广泛用于游戏开发、影视后期及实时渲染等场景。本文基于前期讨论内容，进一步扩展并完善该节点的技术细节，形成体系化的技术文档。</p>
<p><img src="https://docs.unity.cn/cn/Packages-cn/com.unity.shadergraph@14.0/manual/images/WhiteBalanceNodeThumb.png" alt="" loading="lazy"/></p>
<h2 data-id="heading-0"><strong>节点功能深度解析</strong></h2>
<h3 data-id="heading-1"><strong>色彩调整原理</strong></h3>
<p>White Balance节点基于CIE 1931色彩空间模型，模拟人眼对光源色温的感知机制，实现色彩准确校正。其核心流程是将输入颜色从线性RGB空间转换至LMS（长、中、短波长）色彩空间，通过调节白平衡系数，精确控制色温与色调变化。</p>
<h3 data-id="heading-2"><strong>参数影响机制</strong></h3>
<ul>
<li>‌<strong>Temperature参数</strong>‌：调节色温偏移，推荐范围为±1.67
<ul>
<li>负值：色彩偏向暖黄（对应3000K–4500K色温）</li>
<li>正值：色彩偏向冷蓝（对应5500K–6500K色温）</li>
</ul>
</li>
<li>‌<strong>Tint参数</strong>‌：调节色调偏移，推荐范围为±1.67
<ul>
<li>正值：色彩向品红色偏移</li>
<li>负值：色彩向绿色偏移</li>
</ul>
</li>
</ul>
<h3 data-id="heading-3"><strong>最佳实践范围</strong></h3>

























<table><thead><tr><th>参数类型</th><th>有效范围</th><th>视觉效果</th></tr></thead><tbody><tr><td>Temperature</td><td>-1.67~1.67</td><td>自然平滑的色温过渡</td></tr><tr><td>Tint</td><td>-1.67~1.67</td><td>微妙且可控的色调变化</td></tr><tr><td>超出范围</td><td>&gt;±1.67</td><td>可能导致色彩失真或过饱和</td></tr></tbody></table>
<h2 data-id="heading-4"><strong>核心算法实现</strong></h2>
<h3 data-id="heading-5"><strong>预处理阶段</strong></h3>
<pre><code class="hljs language-c" lang="c">hlsl
<span class="hljs-comment">// 参数标准化处理</span>
<span class="hljs-type">float</span> t1 = Temperature * <span class="hljs-number">10</span> / <span class="hljs-number">6</span>;  <span class="hljs-comment">// 温度系数缩放</span>
<span class="hljs-type">float</span> t2 = Tint * <span class="hljs-number">10</span> / <span class="hljs-number">6</span>;         <span class="hljs-comment">// 色调系数缩放</span>
</code></pre>
<h3 data-id="heading-6"><strong>CIE色度坐标计算</strong></h3>
<p>基于D65标准白点（0.31271, 0.32902）的色度坐标计算：</p>
<pre><code class="hljs language-c" lang="c">hlsl
<span class="hljs-comment">// 计算x分量</span>
<span class="hljs-type">float</span> x = <span class="hljs-number">0.31271</span> - t1 * (t1 &lt; <span class="hljs-number">0</span> ? <span class="hljs-number">0.1</span> : <span class="hljs-number">0.05</span>);

<span class="hljs-comment">// 计算y分量</span>
<span class="hljs-type">float</span> standardIlluminantY = <span class="hljs-number">2.87</span> * x - <span class="hljs-number">3</span> * x * x - <span class="hljs-number">0.27509507</span>;
<span class="hljs-type">float</span> y = standardIlluminantY + t2 * <span class="hljs-number">0.05</span>;
</code></pre>
<h3 data-id="heading-7"><strong>XYZ三刺激值转换</strong></h3>
<pre><code class="hljs language-c" lang="c">hlsl
<span class="hljs-type">float</span> Y = <span class="hljs-number">1</span>;
<span class="hljs-type">float</span> X = Y * x / y;
<span class="hljs-type">float</span> Z = Y * (<span class="hljs-number">1</span> - x - y) / y;
</code></pre>
<h3 data-id="heading-8"><strong>LMS色彩空间转换</strong></h3>
<pre><code class="hljs language-c" lang="c">hlsl
<span class="hljs-comment">// 转换矩阵</span>
float3x3 LIN_2_LMS_MAT = {
    { <span class="hljs-number">0.39045</span>, <span class="hljs-number">0.54994</span>, <span class="hljs-number">0.00893</span> },
    { <span class="hljs-number">0.07084</span>, <span class="hljs-number">0.96317</span>, <span class="hljs-number">0.01357</span> },
    { <span class="hljs-number">0.02308</span>, <span class="hljs-number">0.12802</span>, <span class="hljs-number">0.93645</span> }
};

float3x3 LMS_2_LIN_MAT = {
    { <span class="hljs-number">2.85847</span>, <span class="hljs-number">-1.62879</span>, <span class="hljs-number">-0.02489</span> },
    { <span class="hljs-number">-0.21018</span>, <span class="hljs-number">1.15820</span>, <span class="hljs-number">0.00032</span> },
    { <span class="hljs-number">-0.04181</span>, <span class="hljs-number">-0.11817</span>, <span class="hljs-number">1.06867</span> }
};

<span class="hljs-comment">// 转换过程</span>
float3 lms = mul(LIN_2_LMS_MAT, In);
float3 balance = float3(<span class="hljs-number">0.949237</span>, <span class="hljs-number">1.03542</span>, <span class="hljs-number">1.08728</span>) / lms;
lms *= balance;
Out = mul(LMS_2_LIN_MAT, lms);
</code></pre>
<h2 data-id="heading-9"><strong>高级应用场景</strong></h2>
<h3 data-id="heading-10"><strong>动态环境适配</strong></h3>
<p>通过脚本控制实现动态白平衡调节：</p>
<pre><code class="hljs language-csharp" lang="csharp">csharp
<span class="hljs-comment">// C#示例：根据时间调整色温</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">WhiteBalanceController</span> : <span class="hljs-title">MonoBehaviour</span>
{
    <span class="hljs-keyword">public</span> Material whiteBalanceMaterial;
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">float</span> minTemperature = <span class="hljs-number">-1.5f</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">float</span> maxTemperature = <span class="hljs-number">1.5f</span>;

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Update</span>()</span>
    {
        <span class="hljs-built_in">float</span> timeOfDay = Time.time % <span class="hljs-number">86400</span> / <span class="hljs-number">86400</span>;
        <span class="hljs-built_in">float</span> temperature = Mathf.Lerp(minTemperature, maxTemperature, timeOfDay);
        whiteBalanceMaterial.SetFloat(<span class="hljs-string">"_Temperature"</span>, temperature);
    }
}
</code></pre>
<h3 data-id="heading-11"><strong>多通道独立控制</strong></h3>
<p>通过分离颜色通道实现特殊视觉效果：</p>
<pre><code class="hljs language-c" lang="c">hlsl
<span class="hljs-comment">// HLSL示例：通道独立白平衡</span>
float3 <span class="hljs-title function_">whiteBalanceChannels</span><span class="hljs-params">(float3 In, float3 Temperature, float3 Tint)</span>
{
    float3 w1 = float3(<span class="hljs-number">0.949237</span>, <span class="hljs-number">1.03542</span>, <span class="hljs-number">1.08728</span>);
    float3 w2 = float3(<span class="hljs-number">0.949237</span> + Temperature.x, <span class="hljs-number">1.03542</span> + Tint.y, <span class="hljs-number">1.08728</span> + Temperature.z);
    <span class="hljs-keyword">return</span> In * (w1 / w2);
}
</code></pre>
<h3 data-id="heading-12"><strong>性能优化方案</strong></h3>
<ul>
<li>预计算白平衡系数：使用常数节点替代动态计算，减少实时计算开销</li>
<li>简化转换矩阵：采用近似矩阵替代精确矩阵，降低计算复杂度</li>
<li>分通道处理：对每个颜色通道分别处理，提高并行处理效率</li>
</ul>
<h2 data-id="heading-13"><strong>常见问题解决方案</strong></h2>
<h3 data-id="heading-14"><strong>色彩失真问题</strong></h3>
<p>‌<strong>现象</strong>‌：参数调整后出现不自然的色彩偏移</p>
<p>‌<strong>解决方案</strong>‌：</p>
<ul>
<li>确认参数未超出有效范围（±1.67）</li>
<li>结合Color Grade节点进行后续微调</li>
<li>确保输入颜色处于正确的色彩空间（如线性空间）</li>
</ul>
<h3 data-id="heading-15"><strong>性能瓶颈问题</strong></h3>
<p>‌<strong>现象</strong>‌：使用白平衡节点后帧率显著下降</p>
<p>‌<strong>解决方案</strong>‌：</p>
<ul>
<li>在移动平台采用简化版白平衡算法</li>
<li>将白平衡计算移至顶点着色器</li>
<li>使用LUT（查找表）替代实时计算</li>
</ul>
<h3 data-id="heading-16"><strong>与其他效果冲突</strong></h3>
<p>‌<strong>现象</strong>‌：白平衡与其他后期处理效果叠加后出现异常</p>
<p>‌<strong>解决方案</strong>‌：</p>
<ul>
<li>调整效果应用顺序（白平衡通常应优先处理）</li>
<li>通过混合模式控制各效果强度</li>
<li>分层处理不同色彩调节步骤</li>
</ul>
<h2 data-id="heading-17"><strong>最佳实践指南</strong></h2>
<h3 data-id="heading-18"><strong>工作流程建议</strong></h3>
<ul>
<li>项目初期确立色彩参考标准</li>
<li>使用Color Checker节点进行色彩校准</li>
<li>将白平衡参数与光照系统关联</li>
</ul>
<h3 data-id="heading-19"><strong>移动平台适配</strong></h3>
<ul>
<li>采用低精度浮点计算（如half）</li>
<li>简化色彩空间转换矩阵</li>
<li>在低端设备上禁用实时白平衡</li>
</ul>
<h3 data-id="heading-20"><strong>测试与验证方法</strong></h3>
<ul>
<li>使用标准色卡验证色彩准确性</li>
<li>在不同光照环境下测试效果表现</li>
<li>开展跨平台性能与兼容性测试</li>
</ul>
<h2 data-id="heading-21"><strong>扩展应用案例</strong></h2>
<h3 data-id="heading-22"><strong>影视级调色系统</strong></h3>
<p>通过组合多个白平衡节点构建专业调色流程：</p>
<p>[Input] → [White Balance] → [Color Grade] → [LUT] → [Output]</p>
<h3 data-id="heading-23"><strong>动态天气系统</strong></h3>
<p>根据天气类型自动调整白平衡参数：</p>
<pre><code class="hljs language-csharp" lang="csharp">csharp
<span class="hljs-comment">// 天气类型与色温对应表</span>
Dictionary&lt;WeatherType, <span class="hljs-built_in">float</span>&gt; weatherTemperatureMap = <span class="hljs-keyword">new</span>()
{
    { WeatherType.ClearDay, <span class="hljs-number">0.8f</span> },
    { WeatherType.Rainy, <span class="hljs-number">-0.5f</span> },
    { WeatherType.Foggy, <span class="hljs-number">1.2f</span> }
};
</code></pre>
<h3 data-id="heading-24"><strong>艺术风格化处理</strong></h3>
<p>通过极端参数设置创造特殊艺术效果：</p>
<pre><code class="hljs language-c" lang="c">hlsl
<span class="hljs-comment">// 复古电影风格</span>
float3 retroEffect = whiteBalance(In, <span class="hljs-number">-2.0f</span>, <span class="hljs-number">0.3f</span>);
</code></pre>
<p>White Balance节点是URP Shader Graph中用于色彩校正的核心工具，借助科学的色彩空间转换算法，实现专业级的白平衡调节。</p>
<hr/>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fchenghai37%2Fcategory_13074589.html%3Ffromshare%3Dblogcolumn%26sharetype%3Dblogcolumn%26sharerId%3D13074589%26sharerefer%3DPC%26sharesource%3Dchenghai37%26sharefrom%3Dfrom_link" target="_blank" title="https://blog.csdn.net/chenghai37/category_13074589.html?fromshare=blogcolumn&amp;sharetype=blogcolumn&amp;sharerId=13074589&amp;sharerefer=PC&amp;sharesource=chenghai37&amp;sharefrom=from_link" ref="nofollow noopener noreferrer">【Unity Shader Graph 使用与特效实现】</a><strong>专栏-直达</strong>
（欢迎<em>点赞留言</em>探讨，更多人加入进来能更加完善这个探索的过程，🙏）</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[PPIO姚欣：AI正在进入自主行动与创造时代，智能体需要全新的操作系统｜MEET2026]]></title>    <link>https://juejin.cn/post/7583971282891931700</link>    <guid>https://juejin.cn/post/7583971282891931700</guid>    <pubDate>2025-12-16T02:39:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583971282891931700" data-draft-id="7583921477614452771" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="PPIO姚欣：AI正在进入自主行动与创造时代，智能体需要全新的操作系统｜MEET2026"/> <meta itemprop="keywords" content="AIGC,AI编程"/> <meta itemprop="datePublished" content="2025-12-16T02:39:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="量子位"/> <meta itemprop="url" content="https://juejin.cn/user/2858385963484488"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            PPIO姚欣：AI正在进入自主行动与创造时代，智能体需要全新的操作系统｜MEET2026
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2858385963484488/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    量子位
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:39:14.000Z" title="Tue Dec 16 2025 02:39:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>随着 AI 从回答问题迈向自主执行和创造，行业开始进入真正的 Agentic AI 落地元年。这不仅改变了应用形态，也正在重塑整个 AI 技术栈的底层逻辑。</p>
<p>与此同时，智能体体系结构的复杂度呈指数级增长，从任务规划、工具调用到长期记忆，每一环节都对底层框架提出了更高要求。对此，<strong>PPIO 联合创始人兼 CEO 姚欣</strong>表示：</p>
<blockquote>
<p>能看到无论是 PC 时代，还是移动时代、云时代，操作系统才是最核心的中间层。</p>
</blockquote>
<p>这意味着，未来的 AI 应用将从回答问题的工具转向能够直接完成任务的助手，而要承载这类能力，行业迫切需要一种新的基础设施——Agent 时代的操作系统。</p>
<p>在本次<strong>量子位 MEET2026 智能未来大会</strong>上，姚欣围绕智能体演进、Agent Infra 等关键词分享了自己对 AI 底层基础设施架构重塑的判断：</p>
<p>今天的 Agent 会成为未来 AI 应用的主力，而 Agent Infra 会成为下一个 AI 时代的操作系统。</p>
<p>无论模型能力如何提升，无论应用形态如何演进，未来趋势都指向同一个目标：在 AI 时代，通过新的 Runtime 体系，实现模型能力、工具能力与执行能力的高度融合。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/787e82154e7648fbb20edc41ecdc3a7c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457554&amp;x-signature=Bg70ccx%2F%2B0hItlUrb%2BgCmDhvfcg%3D" alt="" loading="lazy"/></p>
<p>为了完整体现姚欣的思考，在不改变原意的基础上，量子位对演讲内容进行了编辑整理，希望能给你带来更多启发。</p>
<p><em>MEET2026 智能未来大会是由量子位主办的行业峰会，20 余位产业代表与会讨论。线下参会观众 1000+，线上直播观众 320 万 +，获得了主流媒体的广泛关注与报道。</em></p>
<h2 data-id="heading-0">核心观点梳理</h2>
<ul>
<li>
<p>AI 不再只是回答问题的工具，而能像智能体一样，自动化地比价、下单、执行任务，整个生态正在从 “生成” 走向“执行”。</p>
</li>
<li>
<p>当前很多产品把工作流、编排工具当作 Agent，但这只是早期形态，真正的智能体需要自主分析、决策与执行。</p>
</li>
<li>
<p>传统 AI 工具只是增强搜索或处理能力，并不能支撑完整的智能体运行；真正的 Agent 需要新的系统架构支撑，不能依赖旧式应用或工作流体系。</p>
</li>
<li>
<p>模型能力决定上限，但智能体能否跑起来、能否在各种环境里通用落地，关键在于 Runtime。</p>
</li>
</ul>
<p><em>以下为姚欣演讲全文：</em></p>
<h2 data-id="heading-1">AI 从生成式迈向 Agent 时代</h2>
<p>大家好，我今天分享的主题也是很多嘉宾讲的新话题 <strong>Agentic AI</strong>——今年 AI 进入了到一个全新的时代。</p>
<p>过去一周，豆包手机横空出世，它能够自动帮你下单、比价、执行任务，这正是我们今年所看到的——从 Generative AI 向 Agent AI 的进步。</p>
<p>AI 以前更多只是做一些聊天、回答问题；而从年初的 Manus、Genspark，到现在的豆包手机，这些产品越来越清晰地展示出 AI 应用开始像智能体一样自动化完成任务和进行创作。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/634fd9fad50c4eef8a4a4288adec6724~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457554&amp;x-signature=ijuDmHC9Jabxu1dDlTZnDyciPys%3D" alt="" loading="lazy"/></p>
<p>今天提到智能体这个话题的时候，我发现行业内，特别国内很多人把它定位成工作流。</p>
<p>以前像扣子那样的编排工具，只能算是最早期的智能体形态，并不是完全体。</p>
<p>今天真正的完全态智能体需要具备自主分析、自主决策以及自动化完成任务的能力，而执行与落地正是其中的关键环节。</p>
<p>同时，我们之前在很多 AI 工具中看到的 Deep Research 功能，虽然能帮助做搜索和处理，但我认为这仍然只是智能体的早期阶段，真正的智能体需要全新的架构和全新的形态。</p>
<h2 data-id="heading-2">真正的智能体需要从能力堆叠走向系统化结构</h2>
<p>2023 年的时候，OpenAI 研究员 LilianWeng 也发了一篇很著名的论文，《LLM Powered Autonomous Agents》。</p>
<p>这篇文章里面揭示了真正的智能体有哪些核心的组件，包括四个核心的元素：<strong>Memory、Planning、Tools、Action。</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d0fba0334f446acabb0c3892e8d7b5c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457554&amp;x-signature=wW4lQ5%2FqNMjRL7%2FRlGjSYwXdqwY%3D" alt="" loading="lazy"/></p>
<p>在梳理每个核心组件的特点和特性时，发现了这样一些类比：如果把智能体当作数字生命体，那么 Memory 有点像大脑的记忆功能，负责短期记忆、长期记忆，甚至需要具备遗忘能力；Planning 更像思考单元，能够进行深度推理和深度分析。</p>
<p>Tools、Action 则更像我们的五官，能够感知外部世界发生了什么，甚至像手和脚一样去影响和改造外部世界。真正的智能体不仅是执行的机器，更重要的是具备从思考到执行再到分析的一整套<strong>综合系统</strong>。</p>
<p>我们想一想，什么样的系统是既能做资源的管理又能做记忆的管理，甚至调用大量的工具呢？</p>
<p>我认为今天的智能体的基础设施更像以前的<strong>操作系统</strong>，这里我列举了一下过去三四十年一系列操作系统的发展和诞生，能看到无论从 PC 时代到移动时代还是到云时代，操作系统才是最核心的中间层。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/885d452c93df459da65fb0e4a209254a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457554&amp;x-signature=6G9XgfUKx%2BtsuMFv2cC%2BjQIY4Ow%3D" alt="" loading="lazy"/></p>
<p>一方面，它要管理大量不同的异构资源，把计算资源、硬件资源，以及各类异构的记忆、存储、传输能力整合起来。</p>
<p>另一方面，还需要把这些能力抽离并抽象成标准化的功能调用，暴露给上层应用，让开发者可以轻松进行二次开发，而无需针对每一种硬件结构单独开发。</p>
<p>无论是在 PC 时代、手机时代，还是云时代，操作系统始终扮演着这样的角色。</p>
<h2 data-id="heading-3">Agent Infra：未来 AI 时代的新操作系统</h2>
<p>我提出一个看法：今天我们做的 Agent Infra，本质上是在构建 <strong>AI 时代的操作系统</strong>。</p>
<p>传统操作系统管理 CPU、内存、存储等硬件资源，而 Agent Infra 管理的是<strong>模型能力</strong>、<strong>工具调用能力</strong>，以及<strong>任务和执行能力</strong>，在这个维度上完成资源管理、统一调度与抽象，让上层开发者能够更方便地进行应用构建。</p>
<p>在整个 Agent Infra 体系中，最核心的部分我们认为是 <strong>Runtime</strong>。</p>
<p>Runtime 解决的是 “能不能跑起来” 的问题，真正的智能体能否在各种环境下大规模、通用地适配并稳定运行，依赖的正是把不同能力进行综合调度的 Runtime，这也是 Agent Infra 的核心所在。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c82ce7d11d714ebfba8a350c6aea3473~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457554&amp;x-signature=MGyZB2TH6tS02lipnp67jKmLhCc%3D" alt="" loading="lazy"/></p>
<p>PPIO 是一家 AI 云计算公司，我们从底层算力到 IaaS、PaaS，再到 MaaS，逐层构建了完整的 AI 云能力，为 Agent Infra 提供底座支撑。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7374183cb84e4cedb603e817355b9c5d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457554&amp;x-signature=ePZHimGxm7DIM4F2vFV9ASJMy7o%3D" alt="" loading="lazy"/></p>
<p>自 2020 年算力出现短缺开始，我们整合大量数据中心闲置算力，构建分布式算力网络。如今我们在中国已有 <strong>4000 + 算力节点</strong>、1300 多个能提供大量分布式算力的合作伙伴；2023 年从 CPU 扩展到 GPU；2024 年我们在全球六<strong>大洲三十多个地区</strong>和国家开始部署算力网络能力，整合全球各地的算力资源，这是我们的第一层。</p>
<p>第二层是 GPU 推理云平台。2023 年我们打造了<strong>第一代推理云平台</strong>，实现异构算力的统一调度。2024 年推出分布式推理引擎，并托管近百个开源与社区模型，每天处理接近 <strong>2000 亿 Token</strong>，为模型提供推理加速、降本和性能增强，是支撑开源模型落地的重要基础。</p>
<p>基于前期积累，我们在今年 WAIC 发布了首个兼容 E2B 的 <strong>Agent 沙箱</strong>，以 Runtime 为核心整合模型调用、短期 / 长期记忆和数据库能力，帮助头部 Agent 厂商规模化落地，通过更安全、敏捷的沙箱体系降低错误率。</p>
<p>该沙箱是专为 Agent 执行任务设计的云端运行环境，为 Agent 赋予安全可靠、高效敏捷的 “手和脚”，沙箱内支持动态调用 Browser use、Computer use、MCP、RAG、Search 等各种工具。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ae777b358cf4b1088539d009ad7ecde~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457554&amp;x-signature=ead2%2BmBC2%2ByvNEO8UjgNQ0ndiOA%3D" alt="" loading="lazy"/></p>
<p>PPIO Agent 沙箱基于 Firecracker MicroVM 构建，具备强安全隔离、毫秒级极速启动、高并发创建三大特性，无需预部署，即启即用，让 Agent 的所有操作均处于 “受限、可控” 的状态。</p>
<p>强安全隔离，让不同 Agent 沙箱的环境可实现完全隔离，当多个任务并发执行时，每个任务都能在独立环境中运行，从根源上避免数据泄漏和资源抢占冲突。</p>
<p>小于 200ms 的极速启动时间，远远小于传统虚拟机沙箱数分钟甚至更长的时效，可瞬间创建沙箱环境、运行生成的代码并展示预览效果，大幅提升用户的开发流畅度。</p>
<p>并且 PPIO Agent 沙箱还支持同时快速启动数千个沙箱实例的高并发创建能力，可充分满足业务场景中的高并发需求，加快结果交付速度，保障用户体验。</p>
<p>沙箱上线以来，月度活跃数在持续增长，我们希望通过 Agent Infra 成为 AI 时代新的操作系统，帮助更多开发者成长与创业。</p>
<p><strong>欢迎在评论区留下你的想法！</strong></p>
<p>— <strong>完</strong> —</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[工作中最常用的6种缓存]]></title>    <link>https://juejin.cn/post/7583980250733559871</link>    <guid>https://juejin.cn/post/7583980250733559871</guid>    <pubDate>2025-12-16T02:57:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583980250733559871" data-draft-id="7583969283790159926" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="工作中最常用的6种缓存"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-16T02:57:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="苏三说技术"/> <meta itemprop="url" content="https://juejin.cn/user/465848661970824"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            工作中最常用的6种缓存
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/465848661970824/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    苏三说技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:57:03.000Z" title="Tue Dec 16 2025 02:57:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>这些年我参与设计过很多系统，越来越深刻地认识到：<strong>一个系统的性能如何，很大程度上取决于缓存用得怎么样</strong>。</p>
<p>同样是缓存，为何有人用起来系统飞升，有人却踩坑不断？</p>
<p>有些小伙伴在工作中可能遇到过这样的困惑：知道要用缓存，但面对本地缓存、Redis、Memcached、CDN等多种选择，到底该用哪种？</p>
<p>今天这篇文章跟大家一起聊聊工作中最常用的6种缓存，希望对你会有所帮助。</p>
<p><a href="https://link.juejin.cn/?target=http%3A%2F%2Fsusan.net.cn%2Fproject" title="https://link.juejin.cn/?target=http%3A%2F%2Fsusan.net.cn%2Fproject" target="_blank">更多项目实战在我的技术网站：www.susan.net.cn/project</a></p>
<h2 data-id="heading-1">01 为什么缓存如此重要？</h2>
<p>在正式介绍各种缓存之前，我们先要明白：<strong>为什么要用缓存？</strong></p>
<p>想象这样一个场景：你的电商网站首页，每次打开都要从数据库中查询轮播图、热门商品、分类信息等数据。</p>
<p>如果每秒有1万个用户访问，数据库就要承受1万次查询压力。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 没有缓存时的查询</span>
<span class="hljs-keyword">public</span> Product <span class="hljs-title function_">getProductById</span><span class="hljs-params">(Long id)</span> {
    <span class="hljs-comment">// 每次都直接查询数据库</span>
    <span class="hljs-keyword">return</span> productDao.findById(id); <span class="hljs-comment">// 每次都是慢速的磁盘IO</span>
}
</code></pre>
<p>这就是典型的<strong>无缓存场景</strong>。</p>
<p>数据库的磁盘IO速度远低于内存，当并发量上来后，系统响应变慢，数据库连接池被占满，最终导致服务不可用。</p>
<p>缓存的核心价值可以用下面这个公式理解：</p>
<pre><code class="hljs language-scss" lang="scss">系统性能 = (缓存命中率 × 缓存访问速度) + ((<span class="hljs-number">1</span> - 缓存命中率) × 后端访问速度)
</code></pre>
<p>缓存之所以能提升性能，基于两个计算机科学的基本原理：</p>
<ol>
<li><strong>局部性原理</strong>：程序访问的数据通常具有时间和空间局部性</li>
<li><strong>存储层次结构</strong>：不同存储介质的速度差异巨大（内存比SSD快100倍，比HDD快10万倍）</li>
</ol>
<p>从用户请求到数据返回，数据可能经过的各级缓存路径如下图所示：</p>
<p><img alt="转存失败，建议直接上传图片文件" src="" loading="lazy"/></p>
<p>理解了缓存的重要性，接下来我们逐一剖析这六种最常用的缓存技术。</p>
<h2 data-id="heading-2">02 本地缓存：最简单直接的性能提升</h2>
<p>本地缓存指的是在<strong>应用进程内部</strong>维护的缓存存储，数据存储在JVM堆内存中。</p>
<h3 data-id="heading-3">核心特点</h3>
<ul>
<li><strong>访问最快</strong>：直接内存操作，无网络开销</li>
<li><strong>实现简单</strong>：无需搭建额外服务</li>
<li><strong>数据隔离</strong>：每个应用实例独享自己的缓存</li>
</ul>
<h3 data-id="heading-4">常用实现</h3>
<p><strong>1. Guava Cache</strong>：Google提供的优秀本地缓存库</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Guava Cache 示例</span>
LoadingCache&lt;Long, Product&gt; productCache = CacheBuilder.newBuilder()
    .maximumSize(<span class="hljs-number">10000</span>) <span class="hljs-comment">// 最大缓存项数</span>
    .expireAfterWrite(<span class="hljs-number">10</span>, TimeUnit.MINUTES) <span class="hljs-comment">// 写入后10分钟过期</span>
    .expireAfterAccess(<span class="hljs-number">5</span>, TimeUnit.MINUTES) <span class="hljs-comment">// 访问后5分钟过期</span>
    .recordStats() <span class="hljs-comment">// 开启统计</span>
    .build(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CacheLoader</span>&lt;Long, Product&gt;() {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> Product <span class="hljs-title function_">load</span><span class="hljs-params">(Long productId)</span> {
            <span class="hljs-comment">// 当缓存未命中时，自动加载数据</span>
            <span class="hljs-keyword">return</span> productDao.findById(productId);
        }
    });

<span class="hljs-comment">// 使用缓存</span>
<span class="hljs-keyword">public</span> Product <span class="hljs-title function_">getProduct</span><span class="hljs-params">(Long id)</span> {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">return</span> productCache.get(id);
    } <span class="hljs-keyword">catch</span> (ExecutionException e) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"加载产品失败"</span>, e);
    }
}
</code></pre>
<p><strong>2. Caffeine</strong>：Guava Cache的现代替代品，性能更优</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Caffeine 示例（性能优于Guava Cache）</span>
Cache&lt;Long, Product&gt; caffeineCache = Caffeine.newBuilder()
    .maximumSize(<span class="hljs-number">10_000</span>)
    .expireAfterWrite(<span class="hljs-number">10</span>, TimeUnit.MINUTES)
    .refreshAfterWrite(<span class="hljs-number">1</span>, TimeUnit.MINUTES) <span class="hljs-comment">// 支持刷新，Guava不支持</span>
    .recordStats()
    .build(productId -&gt; productDao.findById(productId));

<span class="hljs-comment">// 异步获取</span>
<span class="hljs-keyword">public</span> CompletableFuture&lt;Product&gt; <span class="hljs-title function_">getProductAsync</span><span class="hljs-params">(Long id)</span> {
    <span class="hljs-keyword">return</span> caffeineCache.get(id, productId -&gt; 
        CompletableFuture.supplyAsync(() -&gt; productDao.findById(productId)));
}
</code></pre>
<h3 data-id="heading-5">适用场景</h3>
<ul>
<li>数据量不大（通常不超过10万条）</li>
<li>数据变化不频繁</li>
<li>对访问速度要求极致</li>
<li>如：配置信息、静态字典、用户会话信息（短期）</li>
</ul>
<h3 data-id="heading-6">优缺点分析</h3>
<ul>
<li><strong>优点</strong>：极速访问、零网络开销、实现简单</li>
<li><strong>缺点</strong>：数据不一致（各节点独立）、内存限制、重启丢失</li>
</ul>
<p>有些小伙伴在工作中可能会犯一个错误：在分布式系统中过度依赖本地缓存，导致各节点数据不一致。记住：<strong>本地缓存适合存储只读或弱一致性的数据</strong>。</p>
<h2 data-id="heading-7">03 分布式缓存之王：Redis的深度解析</h2>
<p>当数据需要在多个应用实例间共享时，本地缓存就不够用了，这时需要<strong>分布式缓存</strong>。而Redis无疑是这一领域的王者。</p>
<h3 data-id="heading-8">Redis的核心优势</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Spring Boot + Redis 示例</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductCacheService</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">PRODUCT_KEY_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">"product:"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Duration</span> <span class="hljs-variable">CACHE_TTL</span> <span class="hljs-operator">=</span> Duration.ofMinutes(<span class="hljs-number">30</span>);
    
    <span class="hljs-comment">// 缓存查询</span>
    <span class="hljs-keyword">public</span> Product <span class="hljs-title function_">getProduct</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> PRODUCT_KEY_PREFIX + id;
        
        <span class="hljs-comment">// 1. 先查缓存</span>
        <span class="hljs-type">Product</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> (Product) redisTemplate.opsForValue().get(key);
        
        <span class="hljs-keyword">if</span> (product != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> product;
        }
        
        <span class="hljs-comment">// 2. 缓存未命中，查数据库</span>
        product = productDao.findById(id);
        <span class="hljs-keyword">if</span> (product != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// 3. 写入缓存</span>
            redisTemplate.opsForValue().set(key, product, CACHE_TTL);
        }
        
        <span class="hljs-keyword">return</span> product;
    }
    
    <span class="hljs-comment">// 使用更高效的方式：缓存空值防止缓存穿透</span>
    <span class="hljs-keyword">public</span> Product <span class="hljs-title function_">getProductWithNullCache</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> PRODUCT_KEY_PREFIX + id;
        <span class="hljs-type">String</span> <span class="hljs-variable">nullKey</span> <span class="hljs-operator">=</span> PRODUCT_KEY_PREFIX + <span class="hljs-string">"null:"</span> + id;
        
        <span class="hljs-comment">// 检查是否是空值（防缓存穿透）</span>
        <span class="hljs-keyword">if</span> (Boolean.TRUE.equals(redisTemplate.hasKey(nullKey))) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        
        <span class="hljs-type">Product</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> (Product) redisTemplate.opsForValue().get(key);
        <span class="hljs-keyword">if</span> (product != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> product;
        }
        
        product = productDao.findById(id);
        <span class="hljs-keyword">if</span> (product == <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// 缓存空值，短时间过期</span>
            redisTemplate.opsForValue().set(nullKey, <span class="hljs-string">""</span>, Duration.ofMinutes(<span class="hljs-number">5</span>));
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        
        redisTemplate.opsForValue().set(key, product, CACHE_TTL);
        <span class="hljs-keyword">return</span> product;
    }
}
</code></pre>
<h3 data-id="heading-9">Redis的丰富数据结构</h3>
<p>Redis不只是简单的Key-Value存储，它的多种数据结构适应不同场景：</p>








































<table><thead><tr><th>数据结构</th><th>适用场景</th><th>示例</th></tr></thead><tbody><tr><td>String</td><td>缓存对象、计数器</td><td><code>SET user:1 '{"name":"张三"}'</code></td></tr><tr><td>Hash</td><td>存储对象属性</td><td><code>HSET product:1001 name "手机" price 2999</code></td></tr><tr><td>List</td><td>消息队列、最新列表</td><td><code>LPUSH news:latest "新闻标题"</code></td></tr><tr><td>Set</td><td>标签、共同好友</td><td><code>SADD user:100:tags "数码" "科技"</code></td></tr><tr><td>Sorted Set</td><td>排行榜、延迟队列</td><td><code>ZADD leaderboard 95 "玩家A"</code></td></tr><tr><td>Bitmap</td><td>用户签到、活跃统计</td><td><code>SETBIT sign:2023:10 1 1</code></td></tr></tbody></table>
<h3 data-id="heading-10">集群模式选择</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/42aa005753fc4a789c10618a7584a2f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766458623&amp;x-signature=TCzPY7MSnNOgU46e2E%2BmJKXap%2Fo%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-11">适用场景</h3>
<ul>
<li>会话存储（分布式Session）</li>
<li>排行榜、计数器</li>
<li>消息队列</li>
<li>分布式锁</li>
<li>热点数据缓存</li>
</ul>
<p>有些小伙伴在工作中使用Redis时，只把它当简单的Key-Value用，这就像用瑞士军刀只开瓶盖一样浪费。</p>
<p><strong>深入理解Redis的数据结构，能让你的系统设计更优雅高效</strong>。</p>
<h2 data-id="heading-12">04 Memcached：简单高效的分布式缓存</h2>
<p>在Redis崛起之前，Memcached是分布式缓存的首选。</p>
<p>虽然现在Redis更流行，但Memcached在某些场景下仍有其价值。</p>
<h3 data-id="heading-13">Memcached vs Redis 核心区别</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Memcached 客户端示例（使用XMemcached）</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MemcachedService</span> {
    <span class="hljs-keyword">private</span> MemcachedClient memcachedClient;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-comment">// 创建客户端</span>
        memcachedClient = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XMemcachedClientBuilder</span>(
            AddrUtil.getAddresses(<span class="hljs-string">"server1:11211 server2:11211"</span>))
            .build();
    }
    
    <span class="hljs-keyword">public</span> Product <span class="hljs-title function_">getProduct</span><span class="hljs-params">(Long id)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">"product_"</span> + id;
        
        <span class="hljs-comment">// 从Memcached获取</span>
        <span class="hljs-type">Product</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> memcachedClient.get(key);
        <span class="hljs-keyword">if</span> (product != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> product;
        }
        
        <span class="hljs-comment">// 缓存未命中</span>
        product = productDao.findById(id);
        <span class="hljs-keyword">if</span> (product != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// 存储到Memcached，过期时间30分钟</span>
            memcachedClient.set(key, <span class="hljs-number">30</span> * <span class="hljs-number">60</span>, product);
        }
        
        <span class="hljs-keyword">return</span> product;
    }
}
</code></pre>
<p><strong>两者的核心差异对比</strong>：</p>



































<table><thead><tr><th>特性</th><th>Redis</th><th>Memcached</th></tr></thead><tbody><tr><td><strong>数据结构</strong></td><td>丰富（String、Hash、List等）</td><td>简单（Key-Value）</td></tr><tr><td><strong>持久化</strong></td><td>支持（RDB/AOF）</td><td>不支持</td></tr><tr><td><strong>线程模型</strong></td><td>单线程</td><td>多线程</td></tr><tr><td><strong>内存管理</strong></td><td>多种策略，可持久化</td><td>纯内存，重启丢失</td></tr><tr><td><strong>使用场景</strong></td><td>缓存+多样化数据结构</td><td>纯缓存</td></tr></tbody></table>
<h3 data-id="heading-14">何时选择Memcached？</h3>
<ol>
<li><strong>纯缓存场景</strong>：只需要简单的Key-Value缓存</li>
<li><strong>超大Value存储</strong>：Memcached对超大Value支持更好</li>
<li><strong>多线程高并发</strong>：Memcached的多线程模型在极端并发下可能表现更好</li>
</ol>
<h2 data-id="heading-15">05 CDN缓存：加速静态资源的利器</h2>
<p>有些小伙伴可能会疑惑：CDN也算缓存吗？当然算，而且是<strong>地理位置最近</strong>的缓存。</p>
<h3 data-id="heading-16">CDN的工作原理</h3>
<p>CDN（Content Delivery Network）通过在各地部署边缘节点，将静态资源缓存到离用户最近的节点。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 在应用中生成CDN链接</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CDNService</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">cdnDomain</span> <span class="hljs-operator">=</span> <span class="hljs-string">"https://cdn.yourcompany.com"</span>;
    
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getCDNUrl</span><span class="hljs-params">(String relativePath)</span> {
        <span class="hljs-comment">// 添加版本号或时间戳，防止缓存旧版本</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">version</span> <span class="hljs-operator">=</span> getFileVersion(relativePath);
        <span class="hljs-keyword">return</span> String.format(<span class="hljs-string">"%s/%s?v=%s"</span>, cdnDomain, relativePath, version);
    }
    
    <span class="hljs-comment">// 上传文件到CDN的示例（伪代码）</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">uploadToCDN</span><span class="hljs-params">(File file, String remotePath)</span> {
        <span class="hljs-comment">// 1. 上传到源站</span>
        uploadToOrigin(file, remotePath);
        
        <span class="hljs-comment">// 2. 触发CDN预热（将文件主动推送到边缘节点）</span>
        preheatCDN(remotePath);
        
        <span class="hljs-comment">// 3. 刷新旧缓存（如果需要）</span>
        refreshCDNCache(remotePath);
    }
}
</code></pre>
<h3 data-id="heading-17">CDN缓存策略配置</h3>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-comment"># Nginx中的CDN缓存配置示例</span>
location ~* \.(jpg|<span class="hljs-params">jpeg</span>|png|<span class="hljs-params">gif</span>|ico|<span class="hljs-params">css</span>|js)<span class="hljs-variable">$ </span>{
    expires 365d;  <span class="hljs-comment"># 缓存一年</span>
    add_header <span class="hljs-title class_">Cache</span>-<span class="hljs-title class_">Control</span> <span class="hljs-string">"public, immutable"</span>;
    
    <span class="hljs-comment"># 添加版本号作为查询参数</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$query_string</span> ~* <span class="hljs-string">"^v=\d+"</span>) {
        expires max;
    }
}
</code></pre>
<h3 data-id="heading-18">适用场景</h3>
<ul>
<li>静态资源：图片、CSS、JS文件</li>
<li>软件下载包</li>
<li>视频流媒体</li>
<li>全球访问的网站</li>
</ul>
<h2 data-id="heading-19">06 浏览器缓存：最前端的性能优化</h2>
<p>浏览器缓存是最容易被忽视但效果最直接的缓存层级。合理利用浏览器缓存，可以大幅减少服务器压力。</p>
<h3 data-id="heading-20">HTTP缓存头详解</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Spring Boot中设置HTTP缓存头</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ResourceController</span> {
    
    <span class="hljs-meta">@GetMapping("/static/{filename}")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Resource&gt; <span class="hljs-title function_">getStaticFile</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> String filename)</span> {
        <span class="hljs-type">Resource</span> <span class="hljs-variable">resource</span> <span class="hljs-operator">=</span> loadResource(filename);
        
        <span class="hljs-keyword">return</span> ResponseEntity.ok()
            .cacheControl(CacheControl.maxAge(<span class="hljs-number">7</span>, TimeUnit.DAYS)) <span class="hljs-comment">// 缓存7天</span>
            .eTag(computeETag(resource)) <span class="hljs-comment">// ETag用于协商缓存</span>
            .lastModified(resource.lastModified()) <span class="hljs-comment">// 最后修改时间</span>
            .body(resource);
    }
    
    <span class="hljs-meta">@GetMapping("/dynamic/data")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Object&gt; <span class="hljs-title function_">getDynamicData</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Object</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> getData();
        
        <span class="hljs-comment">// 动态数据设置较短缓存</span>
        <span class="hljs-keyword">return</span> ResponseEntity.ok()
            .cacheControl(CacheControl.maxAge(<span class="hljs-number">30</span>, TimeUnit.SECONDS)) <span class="hljs-comment">// 30秒</span>
            .body(data);
    }
}
</code></pre>
<h3 data-id="heading-21">浏览器缓存的两种类型</h3>
<p><img alt="转存失败，建议直接上传图片文件" src="" loading="lazy"/></p>
<p>最近为了帮助大家找工作，专门建了一些工作内推群，各大城市都有，欢迎各位HR和找工作的小伙伴进群交流，群里目前已经收集了20多家大厂的工作内推岗位。加苏三的微信：li_su223，备注：掘金+所在城市，即可进群。</p>
<h3 data-id="heading-22">最佳实践</h3>
<ol>
<li><strong>静态资源</strong>：设置长时间缓存（如一年），通过文件名哈希处理更新</li>
<li><strong>动态数据</strong>：根据业务需求设置合理缓存时间</li>
<li><strong>API响应</strong>：适当使用ETag和Last-Modified</li>
</ol>
<h2 data-id="heading-23">07 数据库缓存：容易被忽略的内部优化</h2>
<p>数据库自身也有缓存机制，理解这些机制能帮助我们写出更高效的SQL。</p>
<h3 data-id="heading-24">MySQL查询缓存（已废弃但值得了解）</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 查看查询缓存状态（MySQL 5.7及之前）</span>
<span class="hljs-keyword">SHOW</span> VARIABLES <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'query_cache%'</span>;

<span class="hljs-comment">-- 在8.0之前，可以通过以下方式利用查询缓存</span>
<span class="hljs-keyword">SELECT</span> SQL_CACHE <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> products <span class="hljs-keyword">WHERE</span> category_id <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;
</code></pre>
<h3 data-id="heading-25">InnoDB缓冲池（Buffer Pool）</h3>
<p>这是MySQL性能的关键，缓存的是<strong>数据页和索引页</strong>。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 查看缓冲池状态</span>
<span class="hljs-keyword">SHOW</span> ENGINE INNODB STATUS;

<span class="hljs-comment">-- 重要的监控指标</span>
<span class="hljs-comment">-- 缓冲池命中率 = (1 - (innodb_buffer_pool_reads / innodb_buffer_pool_read_requests)) * 100%</span>
<span class="hljs-comment">-- 命中率应尽可能接近100%</span>
</code></pre>
<h3 data-id="heading-26">数据库级缓存最佳实践</h3>
<ol>
<li><strong>合理设置缓冲池大小</strong>：通常是系统内存的50%-70%</li>
<li><strong>优化查询</strong>：避免全表扫描，合理使用索引</li>
<li><strong>预热缓存</strong>：重启后主动加载热点数据</li>
<li><strong>监控命中率</strong>：持续优化</li>
</ol>
<p>有些小伙伴可能会过度依赖应用层缓存，而忽略了数据库自身的缓存优化。</p>
<p><strong>数据库缓存是最后一道防线，优化好它能让整个系统更健壮</strong>。</p>
<h2 data-id="heading-27">08 综合对比与选型指南</h2>
<p>接下来，我给大家一个选型指南：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f0dca268ce743fdb1b03c80cff84b0b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766458623&amp;x-signature=gM6U5qRP98tOrjybbtFLiJ83BFc%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-28">实战中的多级缓存架构</h3>
<p>在实际的高并发系统中，我们往往会采用<strong>多级缓存策略</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 多级缓存示例：本地缓存 + Redis</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MultiLevelCacheService</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;
    
    <span class="hljs-comment">// 一级缓存：本地缓存</span>
    <span class="hljs-keyword">private</span> Cache&lt;Long, Product&gt; localCache = Caffeine.newBuilder()
        .maximumSize(<span class="hljs-number">1000</span>)
        .expireAfterWrite(<span class="hljs-number">30</span>, TimeUnit.SECONDS) <span class="hljs-comment">// 本地缓存时间短</span>
        .build();
    
    <span class="hljs-comment">// 二级缓存：Redis</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Duration</span> <span class="hljs-variable">REDIS_TTL</span> <span class="hljs-operator">=</span> Duration.ofMinutes(<span class="hljs-number">10</span>);
    
    <span class="hljs-keyword">public</span> Product <span class="hljs-title function_">getProductWithMultiCache</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-comment">// 1. 查本地缓存</span>
        <span class="hljs-type">Product</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> localCache.getIfPresent(id);
        <span class="hljs-keyword">if</span> (product != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> product;
        }
        
        <span class="hljs-comment">// 2. 查Redis</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">redisKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"product:"</span> + id;
        product = (Product) redisTemplate.opsForValue().get(redisKey);
        <span class="hljs-keyword">if</span> (product != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// 回填本地缓存</span>
            localCache.put(id, product);
            <span class="hljs-keyword">return</span> product;
        }
        
        <span class="hljs-comment">// 3. 查数据库</span>
        product = productDao.findById(id);
        <span class="hljs-keyword">if</span> (product != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// 写入Redis</span>
            redisTemplate.opsForValue().set(redisKey, product, REDIS_TTL);
            <span class="hljs-comment">// 写入本地缓存</span>
            localCache.put(id, product);
        }
        
        <span class="hljs-keyword">return</span> product;
    }
}
</code></pre>
<h2 data-id="heading-29">09 缓存常见问题与解决方案</h2>
<p>在使用缓存的过程中，我们不可避免地会遇到一些问题：</p>
<h3 data-id="heading-30">1. 缓存穿透</h3>
<p><strong>问题</strong>：大量请求查询不存在的数据，绕过缓存直接击穿数据库。</p>
<p><strong>解决方案</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 缓存空值方案</span>
<span class="hljs-keyword">public</span> Product <span class="hljs-title function_">getProductSafe</span><span class="hljs-params">(Long id)</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">"product:"</span> + id;
    <span class="hljs-type">String</span> <span class="hljs-variable">nullKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"product:null:"</span> + id;
    
    <span class="hljs-comment">// 检查空值标记</span>
    <span class="hljs-keyword">if</span> (redisTemplate.hasKey(nullKey)) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
    
    <span class="hljs-type">Product</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> (Product) redisTemplate.opsForValue().get(key);
    <span class="hljs-keyword">if</span> (product != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">return</span> product;
    }
    
    product = productDao.findById(id);
    <span class="hljs-keyword">if</span> (product == <span class="hljs-literal">null</span>) {
        <span class="hljs-comment">// 缓存空值，短时间过期</span>
        redisTemplate.opsForValue().set(nullKey, <span class="hljs-string">""</span>, Duration.ofMinutes(<span class="hljs-number">5</span>));
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
    
    redisTemplate.opsForValue().set(key, product, Duration.ofMinutes(<span class="hljs-number">30</span>));
    <span class="hljs-keyword">return</span> product;
}
</code></pre>
<h3 data-id="heading-31">2. 缓存雪崩</h3>
<p><strong>问题</strong>：大量缓存同时过期，请求全部打到数据库。</p>
<p><strong>解决方案</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 差异化过期时间</span>
<span class="hljs-keyword">private</span> Duration <span class="hljs-title function_">getRandomTTL</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 基础30分钟 + 随机0-10分钟</span>
    <span class="hljs-type">long</span> <span class="hljs-variable">baseMinutes</span> <span class="hljs-operator">=</span> <span class="hljs-number">30</span>;
    <span class="hljs-type">long</span> <span class="hljs-variable">randomMinutes</span> <span class="hljs-operator">=</span> ThreadLocalRandom.current().nextLong(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>);
    <span class="hljs-keyword">return</span> Duration.ofMinutes(baseMinutes + randomMinutes);
}
</code></pre>
<h3 data-id="heading-32">3. 缓存击穿</h3>
<p><strong>问题</strong>：热点Key过期瞬间，大量并发请求同时查询数据库。</p>
<p><strong>解决方案</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 使用互斥锁（分布式锁）</span>
<span class="hljs-keyword">public</span> Product <span class="hljs-title function_">getProductWithLock</span><span class="hljs-params">(Long id)</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">"product:"</span> + id;
    <span class="hljs-type">Product</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> (Product) redisTemplate.opsForValue().get(key);
    
    <span class="hljs-keyword">if</span> (product == <span class="hljs-literal">null</span>) {
        <span class="hljs-comment">// 尝试获取分布式锁</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">lockKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"lock:product:"</span> + id;
        <span class="hljs-type">boolean</span> <span class="hljs-variable">locked</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue()
            .setIfAbsent(lockKey, <span class="hljs-string">"1"</span>, Duration.ofSeconds(<span class="hljs-number">10</span>));
        
        <span class="hljs-keyword">if</span> (locked) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// 双重检查</span>
                product = (Product) redisTemplate.opsForValue().get(key);
                <span class="hljs-keyword">if</span> (product == <span class="hljs-literal">null</span>) {
                    product = productDao.findById(id);
                    <span class="hljs-keyword">if</span> (product != <span class="hljs-literal">null</span>) {
                        redisTemplate.opsForValue()
                            .set(key, product, Duration.ofMinutes(<span class="hljs-number">30</span>));
                    }
                }
            } <span class="hljs-keyword">finally</span> {
                <span class="hljs-comment">// 释放锁</span>
                redisTemplate.delete(lockKey);
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// 未获取到锁，等待后重试</span>
            <span class="hljs-keyword">try</span> { Thread.sleep(<span class="hljs-number">50</span>); } 
            <span class="hljs-keyword">catch</span> (InterruptedException e) { Thread.currentThread().interrupt(); }
            <span class="hljs-keyword">return</span> getProductWithLock(id); <span class="hljs-comment">// 递归重试</span>
        }
    }
    
    <span class="hljs-keyword">return</span> product;
}
</code></pre>
<h2 data-id="heading-33">10 总结</h2>
<p>通过这篇文章，我们系统地探讨了工作中最常用的六种缓存技术。</p>
<p>每种缓存都有其独特的价值和应用场景：</p>
<ol>
<li><strong>本地缓存</strong>：适合进程内、变化不频繁的只读数据</li>
<li><strong>Redis</strong>：功能丰富的分布式缓存，适合大多数共享缓存场景</li>
<li><strong>Memcached</strong>：简单高效的分布式缓存，适合纯Key-Value场景</li>
<li><strong>CDN缓存</strong>：加速静态资源，提升全球访问速度</li>
<li><strong>浏览器缓存</strong>：最前端的优化，减少不必要的网络请求</li>
<li><strong>数据库缓存</strong>：最后一道防线，优化数据库访问性能</li>
</ol>
<p><strong>缓存使用的核心原则可以总结为以下几点</strong>：</p>
<ul>
<li><strong>分级缓存</strong>：合理利用多级缓存架构</li>
<li><strong>合适粒度</strong>：根据业务特点选择缓存粒度</li>
<li><strong>及时更新</strong>：设计合理的缓存更新策略</li>
<li><strong>监控告警</strong>：建立完善的缓存监控体系</li>
</ul>
<p>有些小伙伴在工作中使用缓存时，容易陷入两个极端：要么过度设计，所有数据都加缓存；要么忽视缓存，让数据库承受所有压力。</p>
<p><strong>我们需要懂得在合适的地方使用合适的缓存，在性能和复杂性之间找到最佳平衡点</strong>。</p>
<p>记住，缓存不是银弹，而是工具箱中的一件利器。</p>
<h2 data-id="heading-34">最后说一句(求关注，别白嫖我)</h2>
<p>如果这篇文章对您有所帮助，或者有所启发的话，帮忙关注一下我的同名公众号：苏三说技术，您的支持是我坚持写作最大的动力。</p>
<p>求一键三连：点赞、转发、在看。</p>
<p>关注公众号：【苏三说技术】，在公众号中回复：进大厂，可以免费获取我最近整理的10万字的面试宝典，好多小伙伴靠这个宝典拿到了多家大厂的offer。</p>
<p>更多项目实战在我的技术网站：<a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.susan.net.cn%2Fproject" title="https://link.juejin.cn?target=http%3A%2F%2Fwww.susan.net.cn%2Fproject" target="_blank">www.susan.net.cn/project</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【RuoYi-SpringBoot3-Pro】：接入 AI 对话能力]]></title>    <link>https://juejin.cn/post/7583948178858590254</link>    <guid>https://juejin.cn/post/7583948178858590254</guid>    <pubDate>2025-12-16T02:30:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583948178858590254" data-draft-id="7581872532362903561" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【RuoYi-SpringBoot3-Pro】：接入 AI 对话能力"/> <meta itemprop="keywords" content="Spring Boot,AI编程"/> <meta itemprop="datePublished" content="2025-12-16T02:30:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="undsky"/> <meta itemprop="url" content="https://juejin.cn/user/3368559354850206"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【RuoYi-SpringBoot3-Pro】：接入 AI 对话能力
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3368559354850206/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    undsky
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:30:30.000Z" title="Tue Dec 16 2025 02:30:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">【RuoYi-SpringBoot3-Pro】：接入 AI 对话能力</h2>
<p>本文详细介绍 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fundsky%2FRuoYi-SpringBoot3-Pro" target="_blank" title="https://github.com/undsky/RuoYi-SpringBoot3-Pro" ref="nofollow noopener noreferrer">RuoYi-SpringBoot3-Pro</a> 框架中内置的 OpenAI 工具类，帮助开发者快速集成 AI 对话能力。</p>
<blockquote>
<p>GitHub：<code>https://github.com/undsky/RuoYi-SpringBoot3-Pro</code></p>
</blockquote>
<h3 data-id="heading-1">一、概述</h3>
<p>RuoYi-SpringBoot3-Pro 基于官方 OpenAI Java SDK 封装了一套开箱即用的 AI 工具类，支持同步对话、流式对话、多角色消息、代理配置等特性，并兼容所有遵循 OpenAI 协议的第三方 API。</p>
<p>核心组件位于 <code>ruoyi-common</code> 模块：</p>
<pre><code class="hljs language-bash" lang="bash">ruoyi-common/src/main/java/com/ruoyi/common/
├── config/
│   └── OpenAIConfig.java      <span class="hljs-comment"># 配置类</span>
└── utils/ai/
    ├── OpenAI.java            <span class="hljs-comment"># 核心工具类</span>
    ├── AIMessage.java         <span class="hljs-comment"># 消息实体</span>
    └── AIRole.java            <span class="hljs-comment"># 角色枚举</span>
</code></pre>
<h3 data-id="heading-2">二、快速开始</h3>
<h4 data-id="heading-3">2.1 Maven 依赖</h4>
<p>框架已内置 OpenAI SDK 依赖，无需额外引入：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.openai<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>openai-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.20.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h4 data-id="heading-4">2.2 配置文件</h4>
<p>在 <code>application.yml</code> 中添加 OpenAI 配置：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># OpenAI配置</span>
<span class="hljs-attr">openai:</span>
  <span class="hljs-comment"># API密钥</span>
  <span class="hljs-attr">api-key:</span> <span class="hljs-string">sk-xxx</span>
  <span class="hljs-comment"># 基础URL（支持自定义API地址）</span>
  <span class="hljs-attr">base-url:</span> <span class="hljs-string">https://api.openai.com/v1</span>
  <span class="hljs-comment"># 默认模型</span>
  <span class="hljs-attr">model:</span> <span class="hljs-string">gpt-4o</span>
  <span class="hljs-comment"># 代理配置（可选）</span>
  <span class="hljs-attr">proxy:</span>
    <span class="hljs-comment"># 是否启用代理</span>
    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span>
    <span class="hljs-comment"># 代理类型 (HTTP/SOCKS)</span>
    <span class="hljs-attr">type:</span> <span class="hljs-string">HTTP</span>
    <span class="hljs-comment"># 代理主机</span>
    <span class="hljs-attr">host:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>
    <span class="hljs-comment"># 代理端口</span>
    <span class="hljs-attr">port:</span> <span class="hljs-number">7890</span>
</code></pre>
<p><strong>配置说明：</strong></p>













































<table><thead><tr><th>配置项</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td><code>api-key</code></td><td>OpenAI API 密钥</td><td><code>sk-xxx</code></td></tr><tr><td><code>base-url</code></td><td>API 基础地址，支持第三方兼容 API</td><td><code>https://api.openai.com/v1</code></td></tr><tr><td><code>model</code></td><td>默认使用的模型</td><td><code>gpt-4o</code>、<code>gpt-3.5-turbo</code></td></tr><tr><td><code>proxy.enabled</code></td><td>是否启用代理</td><td><code>true</code>/<code>false</code></td></tr><tr><td><code>proxy.type</code></td><td>代理类型</td><td><code>HTTP</code>/<code>SOCKS</code></td></tr><tr><td><code>proxy.host</code></td><td>代理服务器地址</td><td><code>127.0.0.1</code></td></tr><tr><td><code>proxy.port</code></td><td>代理服务器端口</td><td><code>7890</code></td></tr></tbody></table>
<h3 data-id="heading-5">三、核心 API</h3>
<h4 data-id="heading-6">3.1 角色枚举 - AIRole</h4>
<p>支持 OpenAI Chat API 的三种标准角色：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">AIRole</span> {
    USER(<span class="hljs-string">"user"</span>),           <span class="hljs-comment">// 用户消息</span>
    SYSTEM(<span class="hljs-string">"system"</span>),       <span class="hljs-comment">// 系统提示词</span>
    ASSISTANT(<span class="hljs-string">"assistant"</span>); <span class="hljs-comment">// AI 助手回复</span>
}
</code></pre>
<h4 data-id="heading-7">3.2 消息实体 - AIMessage</h4>
<p>封装对话消息：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AIMessage</span> {
    <span class="hljs-keyword">private</span> AIRole role;    <span class="hljs-comment">// 消息角色</span>
    <span class="hljs-keyword">private</span> String message; <span class="hljs-comment">// 消息内容</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">AIMessage</span><span class="hljs-params">(AIRole role, String message)</span> {
        <span class="hljs-built_in">this</span>.role = role;
        <span class="hljs-built_in">this</span>.message = message;
    }
}
</code></pre>
<h4 data-id="heading-8">3.3 工具类 - OpenAI</h4>
<p>提供三个核心静态方法：</p>

























<table><thead><tr><th>方法</th><th>说明</th></tr></thead><tbody><tr><td><code>chatClient()</code></td><td>创建 OpenAI 客户端</td></tr><tr><td><code>chatParams()</code></td><td>构建会话参数</td></tr><tr><td><code>chat()</code></td><td>同步对话</td></tr><tr><td><code>chatStream()</code></td><td>流式对话（SSE）</td></tr></tbody></table>
<h3 data-id="heading-9">四、使用示例</h3>
<h4 data-id="heading-10">4.1 同步对话</h4>
<p>适用于简单的问答场景，等待 AI 完整响应后返回：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.openai.client.OpenAIClient;
<span class="hljs-keyword">import</span> com.openai.models.chat.completions.ChatCompletionCreateParams;
<span class="hljs-keyword">import</span> com.ruoyi.common.config.OpenAIConfig;
<span class="hljs-keyword">import</span> com.ruoyi.common.utils.ai.*;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ChatExample</span> {
    
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">simpleChat</span><span class="hljs-params">(String userMessage)</span> {
        <span class="hljs-comment">// 1. 创建客户端</span>
        <span class="hljs-type">OpenAIClient</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> OpenAI.chatClient(
            OpenAIConfig.getApiKey(),
            OpenAIConfig.getBaseUrl(),
            OpenAIConfig.getProxy() != <span class="hljs-literal">null</span> ? OpenAIConfig.getProxy().toJavaProxy() : <span class="hljs-literal">null</span>
        );
        
        <span class="hljs-comment">// 2. 构建消息列表</span>
        List&lt;AIMessage&gt; messages = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        messages.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AIMessage</span>(AIRole.SYSTEM, <span class="hljs-string">"你是一个有帮助的助手。"</span>));
        messages.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AIMessage</span>(AIRole.USER, userMessage));
        
        <span class="hljs-comment">// 3. 构建请求参数</span>
        <span class="hljs-type">ChatCompletionCreateParams</span> <span class="hljs-variable">params</span> <span class="hljs-operator">=</span> OpenAI.chatParams(
            OpenAIConfig.getModel(), 
            messages
        );
        
        <span class="hljs-comment">// 4. 发起同步请求</span>
        <span class="hljs-keyword">return</span> OpenAI.chat(client, params);
    }
}
</code></pre>
<h4 data-id="heading-11">4.2 流式对话（SSE）</h4>
<p>适用于需要实时展示生成内容的场景，如聊天界面：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.http.ResponseEntity;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;
<span class="hljs-keyword">import</span> org.springframework.web.servlet.mvc.method.annotation.StreamingResponseBody;

<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/api/ai")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AIController</span> {
    
    <span class="hljs-meta">@PostMapping("/chat/stream")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;StreamingResponseBody&gt; <span class="hljs-title function_">streamChat</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> String userMessage)</span> {
        <span class="hljs-comment">// 1. 创建客户端</span>
        <span class="hljs-type">OpenAIClient</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> OpenAI.chatClient(
            OpenAIConfig.getApiKey(),
            OpenAIConfig.getBaseUrl(),
            OpenAIConfig.getProxy() != <span class="hljs-literal">null</span> ? OpenAIConfig.getProxy().toJavaProxy() : <span class="hljs-literal">null</span>
        );
        
        <span class="hljs-comment">// 2. 构建消息</span>
        List&lt;AIMessage&gt; messages = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        messages.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AIMessage</span>(AIRole.SYSTEM, <span class="hljs-string">"你是一个有帮助的助手。"</span>));
        messages.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AIMessage</span>(AIRole.USER, userMessage));
        
        <span class="hljs-comment">// 3. 构建参数</span>
        <span class="hljs-type">ChatCompletionCreateParams</span> <span class="hljs-variable">params</span> <span class="hljs-operator">=</span> OpenAI.chatParams(
            OpenAIConfig.getModel(), 
            messages
        );
        
        <span class="hljs-comment">// 4. 流式响应</span>
        <span class="hljs-keyword">return</span> OpenAI.chatStream(client, params, <span class="hljs-keyword">new</span> <span class="hljs-title class_">OpenAI</span>.StreamContentListener() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onContent</span><span class="hljs-params">(String content)</span> {
                <span class="hljs-comment">// 每收到一段增量内容时调用</span>
                System.out.print(content);
            }
            
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onComplete</span><span class="hljs-params">(String fullContent)</span> {
                <span class="hljs-comment">// 全部内容流式结束后调用</span>
                System.out.println(<span class="hljs-string">"\n完整响应："</span> + fullContent);
            }
        });
    }
}
</code></pre>
<h4 data-id="heading-12">4.3 多轮对话</h4>
<p>维护对话历史实现上下文连续：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MultiTurnChat</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;AIMessage&gt; conversationHistory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> OpenAIClient client;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MultiTurnChat</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">this</span>.client = OpenAI.chatClient(
            OpenAIConfig.getApiKey(),
            OpenAIConfig.getBaseUrl(),
            OpenAIConfig.getProxy() != <span class="hljs-literal">null</span> ? OpenAIConfig.getProxy().toJavaProxy() : <span class="hljs-literal">null</span>
        );
        <span class="hljs-comment">// 设置系统提示词</span>
        conversationHistory.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AIMessage</span>(AIRole.SYSTEM, <span class="hljs-string">"你是一个专业的技术顾问。"</span>));
    }
    
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">chat</span><span class="hljs-params">(String userMessage)</span> {
        <span class="hljs-comment">// 添加用户消息</span>
        conversationHistory.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AIMessage</span>(AIRole.USER, userMessage));
        
        <span class="hljs-comment">// 构建参数并请求</span>
        <span class="hljs-type">ChatCompletionCreateParams</span> <span class="hljs-variable">params</span> <span class="hljs-operator">=</span> OpenAI.chatParams(
            OpenAIConfig.getModel(), 
            conversationHistory
        );
        <span class="hljs-type">String</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> OpenAI.chat(client, params);
        
        <span class="hljs-comment">// 保存 AI 回复到历史</span>
        conversationHistory.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AIMessage</span>(AIRole.ASSISTANT, response));
        
        <span class="hljs-keyword">return</span> response;
    }
}
</code></pre>
<h4 data-id="heading-13">4.4 使用代理</h4>
<p>在网络受限环境下配置代理：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.net.InetSocketAddress;
<span class="hljs-keyword">import</span> java.net.Proxy;

<span class="hljs-comment">// 方式一：使用配置文件中的代理</span>
<span class="hljs-type">OpenAIClient</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> OpenAI.chatClient(
    OpenAIConfig.getApiKey(),
    OpenAIConfig.getBaseUrl(),
    OpenAIConfig.getProxy().toJavaProxy()
);

<span class="hljs-comment">// 方式二：手动创建代理</span>
<span class="hljs-type">Proxy</span> <span class="hljs-variable">httpProxy</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(
    Proxy.Type.HTTP, 
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">InetSocketAddress</span>(<span class="hljs-string">"127.0.0.1"</span>, <span class="hljs-number">7890</span>)
);

<span class="hljs-type">Proxy</span> <span class="hljs-variable">socksProxy</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(
    Proxy.Type.SOCKS, 
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">InetSocketAddress</span>(<span class="hljs-string">"127.0.0.1"</span>, <span class="hljs-number">1080</span>)
);

<span class="hljs-type">OpenAIClient</span> <span class="hljs-variable">clientWithProxy</span> <span class="hljs-operator">=</span> OpenAI.chatClient(
    <span class="hljs-string">"sk-xxx"</span>,
    <span class="hljs-string">"https://api.openai.com/v1"</span>,
    httpProxy
);
</code></pre>
<h3 data-id="heading-14">五、兼容第三方 API</h3>
<p>框架支持所有兼容 OpenAI 协议的第三方 API，只需修改 <code>base-url</code> 配置：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">openai:</span>
  <span class="hljs-attr">api-key:</span> <span class="hljs-string">your-api-key</span>
  <span class="hljs-comment"># 使用第三方 API</span>
  <span class="hljs-attr">base-url:</span> <span class="hljs-string">https://your-custom-api.com/v1</span>
  <span class="hljs-attr">model:</span> <span class="hljs-string">your-model-name</span>
</code></pre>
<p>常见兼容 API 示例：</p>

























<table><thead><tr><th>服务商</th><th>base-url 示例</th></tr></thead><tbody><tr><td>Azure OpenAI</td><td><code>https://{resource}.openai.azure.com/openai/deployments/{deployment}</code></td></tr><tr><td>智谱 AI</td><td><code>https://open.bigmodel.cn/api/paas/v4</code></td></tr><tr><td>月之暗面</td><td><code>https://api.moonshot.cn/v1</code></td></tr><tr><td>DeepSeek</td><td><code>https://api.deepseek.com/v1</code></td></tr></tbody></table>
<h3 data-id="heading-15">六、前端集成</h3>
<h4 data-id="heading-16">6.1 接收流式响应</h4>
<p>前端使用 <code>fetch</code> API 处理 SSE 流式响应：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">streamChat</span>(<span class="hljs-params">message</span>) {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/ai/chat/stream'</span>, {
        <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
        <span class="hljs-attr">headers</span>: { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> },
        <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ message })
    });
    
    <span class="hljs-keyword">const</span> reader = response.<span class="hljs-property">body</span>.<span class="hljs-title function_">getReader</span>();
    <span class="hljs-keyword">const</span> decoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextDecoder</span>();
    
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
        <span class="hljs-keyword">const</span> { done, value } = <span class="hljs-keyword">await</span> reader.<span class="hljs-title function_">read</span>();
        <span class="hljs-keyword">if</span> (done) <span class="hljs-keyword">break</span>;
        
        <span class="hljs-keyword">const</span> text = decoder.<span class="hljs-title function_">decode</span>(value);
        <span class="hljs-keyword">if</span> (text === <span class="hljs-string">'[DONE]'</span>) <span class="hljs-keyword">break</span>;
        
        <span class="hljs-comment">// 实时显示内容</span>
        <span class="hljs-title function_">appendToChat</span>(text);
    }
}
</code></pre>
<h4 data-id="heading-17">6.2 Vue 3 组件示例</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="chat-container"&gt;
    &lt;div class="messages" ref="messagesRef"&gt;
      &lt;div v-for="msg in messages" :key="msg.id" :class="['message', msg.role]"&gt;
        {{ msg.content }}
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class="input-area"&gt;
      &lt;input v-model="input" @keyup.enter="sendMessage" placeholder="输入消息..." /&gt;
      &lt;button @click="sendMessage" :disabled="loading"&gt;发送&lt;/button&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref } from 'vue'

const messages = ref([])
const input = ref('')
const loading = ref(false)

async function sendMessage() {
    if (!input.value.trim() || loading.value) return
    
    const userMessage = input.value
    messages.value.push({ id: Date.now(), role: 'user', content: userMessage })
    input.value = ''
    loading.value = true
    
    // 添加 AI 消息占位
    const aiMessage = { id: Date.now() + 1, role: 'assistant', content: '' }
    messages.value.push(aiMessage)
    
    try {
        const response = await fetch('/api/ai/chat/stream', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message: userMessage })
        })
        
        const reader = response.body.getReader()
        const decoder = new TextDecoder()
        
        while (true) {
            const { done, value } = await reader.read()
            if (done) break
            
            const text = decoder.decode(value)
            if (text === '[DONE]') break
            
            aiMessage.content += text
        }
    } finally {
        loading.value = false
    }
}
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-18">七、最佳实践</h3>
<h4 data-id="heading-19">7.1 错误处理</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> String <span class="hljs-title function_">safeChatWithRetry</span><span class="hljs-params">(String message, <span class="hljs-type">int</span> maxRetries)</span> {
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; maxRetries; i++) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> simpleChat(message);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (i == maxRetries - <span class="hljs-number">1</span>) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"AI 服务调用失败: "</span> + e.getMessage(), e);
            }
            <span class="hljs-comment">// 等待后重试</span>
            <span class="hljs-keyword">try</span> {
                Thread.sleep(<span class="hljs-number">1000</span> * (i + <span class="hljs-number">1</span>));
            } <span class="hljs-keyword">catch</span> (InterruptedException ie) {
                Thread.currentThread().interrupt();
            }
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}
</code></pre>
<h4 data-id="heading-20">7.2 Token 控制</h4>
<p>合理控制对话历史长度，避免超出模型 Token 限制：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">trimConversationHistory</span><span class="hljs-params">(<span class="hljs-type">int</span> maxMessages)</span> {
    <span class="hljs-keyword">if</span> (conversationHistory.size() &gt; maxMessages) {
        <span class="hljs-comment">// 保留系统提示词和最近的消息</span>
        <span class="hljs-type">AIMessage</span> <span class="hljs-variable">systemMessage</span> <span class="hljs-operator">=</span> conversationHistory.get(<span class="hljs-number">0</span>);
        List&lt;AIMessage&gt; recentMessages = conversationHistory.subList(
            conversationHistory.size() - maxMessages + <span class="hljs-number">1</span>, 
            conversationHistory.size()
        );
        conversationHistory.clear();
        conversationHistory.add(systemMessage);
        conversationHistory.addAll(recentMessages);
    }
}
</code></pre>
<h4 data-id="heading-21">7.3 敏感信息保护</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 不要在日志中打印完整的 API Key</span>
<span class="hljs-type">String</span> <span class="hljs-variable">maskedKey</span> <span class="hljs-operator">=</span> apiKey.substring(<span class="hljs-number">0</span>, <span class="hljs-number">8</span>) + <span class="hljs-string">"..."</span> + apiKey.substring(apiKey.length() - <span class="hljs-number">4</span>);
log.info(<span class="hljs-string">"Using API Key: {}"</span>, maskedKey);
</code></pre>
<h3 data-id="heading-22">八、总结</h3>
<p>RuoYi-SpringBoot3-Pro 的 AI 能力集成模块具有以下特点：</p>
<ul>
<li><strong>开箱即用</strong>：基于官方 SDK 封装，配置简单</li>
<li><strong>功能完整</strong>：支持同步/流式对话、多角色、代理配置</li>
<li><strong>扩展性强</strong>：兼容所有 OpenAI 协议的第三方 API</li>
<li><strong>易于集成</strong>：提供完整的工具类和示例代码</li>
</ul>
<hr/>
<ul>
<li>项目地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fundsky%2FRuoYi-SpringBoot3-Pro" target="_blank" title="https://github.com/undsky/RuoYi-SpringBoot3-Pro" ref="nofollow noopener noreferrer">RuoYi-SpringBoot3-Pro</a></li>
<li>开发文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.undsky.com%2Fblog%2F%3Fcategory%3DRuoYi-SpringBoot3-Pro%23" target="_blank" title="https://www.undsky.com/blog/?category=RuoYi-SpringBoot3-Pro#" ref="nofollow noopener noreferrer">RuoYi-SpringBoot3-Pro 文档</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[开始使用 Elastic Agent Builder 和 Strands Agents SDK]]></title>    <link>https://juejin.cn/post/7583984122235011114</link>    <guid>https://juejin.cn/post/7583984122235011114</guid>    <pubDate>2025-12-16T02:36:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583984122235011114" data-draft-id="7583984122234994730" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="开始使用 Elastic Agent Builder 和 Strands Agents SDK"/> <meta itemprop="keywords" content="Elasticsearch"/> <meta itemprop="datePublished" content="2025-12-16T02:36:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Elasticsearch"/> <meta itemprop="url" content="https://juejin.cn/user/2612095360441448"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            开始使用 Elastic Agent Builder 和 Strands Agents SDK
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2612095360441448/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Elasticsearch
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:36:28.000Z" title="Tue Dec 16 2025 02:36:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>作者：来自 Elastic <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fsearch-labs%2Fauthor%2Fjonathan-simon" title="https://www.elastic.co/search-labs/author/jonathan-simon" target="_blank" ref="nofollow noopener noreferrer">Jonathan Simon</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/11ba9b4e53644aa39a1a352d8f776e87~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=J5Yp2xy6fJT60smGnPDVr7BXiD0%3D" alt="" loading="lazy"/></p>
<p>学习如何使用 Elastic Agent Builder 创建一个 agent，然后探索如何通过 A2A 协议，在 Strands Agents SDK 的编排下使用该 agent。</p>
<p>Elasticsearch 与行业领先的 Gen AI 工具和提供商有原生集成。查看我们的网络研讨会，了解如何<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fvirtual-events%2Fbeyond-rag-basics" title="https://www.elastic.co/virtual-events/beyond-rag-basics" target="_blank" ref="nofollow noopener noreferrer">超越 RAG 基础</a>，或使用 Elastic vector database <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fvirtual-events%2Fvector-databases-fast-track-production" title="https://www.elastic.co/virtual-events/vector-databases-fast-track-production" target="_blank" ref="nofollow noopener noreferrer">构建 prod-ready 应用</a>。</p>
<p>为了为你的使用场景构建最佳的搜索解决方案，现在就开始<a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.elastic.co%2Fregistration" title="https://cloud.elastic.co/registration" target="_blank" ref="nofollow noopener noreferrer">免费的 cloud 试用</a>，或在你的<a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F143747798" title="https://elasticstack.blog.csdn.net/article/details/143747798" target="_blank" ref="nofollow noopener noreferrer">本地机器</a>上试用 Elastic。</p>
<p>有一个 AI agent 的想法吗？它很可能涉及对数据做一些事情，因为如果一个 agent 要发起有用的操作，它需要做出决策，而它需要正确的数据来做出正确的决策。</p>
<p>Elastic Agent Builder 让构建与数据连接的 AI agent 变得简单。我们将在这篇博客中向你展示如何做到这一点。让我们一起走过使用一个访问存储在 Elastic 中的数据的 MCP 工具来创建一个 agent 所需的所有步骤。然后，我们将使用 Strands Agents SDK 及其 Agent2Agent ( A2A ) 功能来运行该 agent。<a href="https://link.juejin.cn?target=https%3A%2F%2Fstrandsagents.com%2F" title="https://strandsagents.com/" target="_blank" ref="nofollow noopener noreferrer">Strands Agents SDK</a>是一个多 agent 的 AI 开发平台，你可以用它以足够少的代码来构建 agentic 应用，从而确保你获得想要的结果。</p>
<p>让我们构建一个 AI agent 来玩 RPS+ 游戏，这是经典的 Rock Paper Scissors 游戏的一个变体，增加了一点变化；它为游戏玩家提供了几个额外的选择。</p>
<p>更多阅读：</p>
<ul>
<li>Elastic AI agent builder 介绍（<a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F152212513" title="https://elasticstack.blog.csdn.net/article/details/152212513" target="_blank" ref="nofollow noopener noreferrer">一</a>）（<a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F153689733" title="https://elasticstack.blog.csdn.net/article/details/153689733" target="_blank" ref="nofollow noopener noreferrer">二</a>）（<a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F154293247" title="https://elasticstack.blog.csdn.net/article/details/154293247" target="_blank" ref="nofollow noopener noreferrer">三</a>）（<a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F155194636" title="https://elasticstack.blog.csdn.net/article/details/155194636" target="_blank" ref="nofollow noopener noreferrer">四</a>）（<a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F155241617" title="https://elasticstack.blog.csdn.net/article/details/155241617" target="_blank" ref="nofollow noopener noreferrer">五</a>）</li>
</ul>
<h2 data-id="heading-0">先决条件</h2>
<p>以下是按照本博文步骤所需的条件：</p>
<ul>
<li>在本地电脑上运行的文本编辑器
<ul>
<li>本博文示例说明中使用的是 <a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.visualstudio.com%2Fdownload" title="https://code.visualstudio.com/download" target="_blank" ref="nofollow noopener noreferrer">Visual Studio Code</a></li>
</ul>
</li>
<li>在本地电脑上运行的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.python.org%2Fdownloads%2F" title="https://www.python.org/downloads/" target="_blank" ref="nofollow noopener noreferrer">Python 3.10 或更高版本</a></li>
</ul>
<h2 data-id="heading-1">创建无服务器项目</h2>
<p>我们首先需要一个 Elasticsearch <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fcloud%2Fserverless" title="https://www.elastic.co/cloud/serverless" target="_blank" ref="nofollow noopener noreferrer">无服务器</a>项目，其中包括 Elastic Agent Builder。</p>
<p>访问 <a href="https://link.juejin.cn?target=http%3A%2F%2Fcloud.elastic.co%2F" title="http://cloud.elastic.co/" target="_blank" ref="nofollow noopener noreferrer">cloud.elastic.co</a> 并创建一个新的 Elasticsearch 无服务器项目。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1530465ae69d4ee4a9784d33e52210af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=RwR%2Bs6C9NGyi0URBRUmxFqoSXJM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">创建索引并添加数据</h2>
<p>接下来，我们将在 Elasticsearch 项目中添加一些数据。打开 Developer Tools，在这里我们可以运行命令来创建新索引并向其中插入数据。从顶层导航菜单中选择 Developer Tools。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1619ab5733c240c5a046f100c616529d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=uiyBCyZgLL%2FNDEP9WyABgvWY1Ko%3D" alt="" loading="lazy"/></p>
<p>将以下 PUT 命令复制并粘贴到 Developer Tools 控制台的请求输入区域。此语句会创建一个名为 “game-docs” 的 Elasticsearch 索引。</p>
<pre><code class="hljs language-bash" lang="bash">`

1.  PUT /game-docs
2.  {
3.    <span class="hljs-string">"mappings"</span>: {
4.      <span class="hljs-string">"properties"</span>: {
5.        <span class="hljs-string">"title"</span>: { <span class="hljs-string">"type"</span>: <span class="hljs-string">"text"</span> },
6.        <span class="hljs-string">"content"</span>: { 
7.          <span class="hljs-string">"type"</span>: <span class="hljs-string">"text"</span>
8.        },
9.        <span class="hljs-string">"filename"</span>: { <span class="hljs-string">"type"</span>: <span class="hljs-string">"keyword"</span> },
10.        <span class="hljs-string">"last_modified"</span>: { <span class="hljs-string">"type"</span>: <span class="hljs-string">"date"</span> }
11.      }
12.    }
13.  }

`AI写代码![](https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png)
</code></pre>
<p>点击 Developer Tools 中语句右侧出现的 Send request 按钮。你应该会在 Developer Tools 的响应区域看到一条通知，确认 game-docs 索引已创建。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/92502a7d1e9f450483a7ade805b5a39b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=3JWYVZOuzX0Q%2FD4g8RjHkk2d6jw%3D" alt="" loading="lazy"/></p>
<p>名为 game-docs 的索引是存储我们正在制作的游戏数据的理想位置。让我们在该索引中放入一个名为 rps+-md 的文档，其中包含游戏所需的所有数据。将以下 PUT 命令复制并粘贴到 Developer Tools 控制台。</p>
<pre><code class="hljs language-bash" lang="bash">`

1.  PUT /game-docs/_doc/rps+-md
2.  {
3.    <span class="hljs-string">"title"</span>: <span class="hljs-string">"Rock Paper Scissors +"</span>,
4.    <span class="hljs-string">"content"</span>: <span class="hljs-string">"
5.  # Game Name
6.  RPS+

8.  # Starting Prompt
9.  Let's play RPS+ !
10.  ---
11.  What do you choose?

13.  # Game Objects
14.  1. Rock 🪨 👊
15.  2. Paper 📜 🖐
16.  3. Scissors ✄ ✌️
17.  4. Light ☼ 👍
18.  5. Dark Energy ☄ 🫱

20.  # Judgement of Victory
21.  * Rock beats Scissors
22.    * because rocks break scissors
23.  * Paper beats Rock
24.    * because paper covers rock
25.  * Scissors beat Paper
26.    * because scissors cut paper
27.  * Rock beats Light
28.    * because you can build a rock structure to block out light
29.  * Paper beats Light
30.    * because knowledge stored in files and paper books helps us understand light
31.  * Light beats Dark Energy
32.    * because light enables humans to lighten up and laugh in the face of dark energy as it causes the eventual heat death of the universe
33.  * Light beats Scissors
34.    * because light is needed to use scissors safely
35.  * Dark Energy beats Rock
36.    * because dark energy rocks more than rocks. It rocks rocks and everything else in its expansion of the universe
37.  * Dark Energy beats Paper
38.    * because humans, with their knowledge stored in files and paper books, can't explain dark energy 
39.  * Scissors beat Dark Energy
40.    * because a human running with scissors is darker than dark energy

42.  # Invalid Input
43.  I was hoping for an worthy opponent
44.    - but alas it appears that time has past
45.    - but alas there's little time for your todo list when [todo:fix this] is so vast

47.  # Cancel Game
48.  The future belongs to the bold. Goodbye..
49.  "</span>,
50.    <span class="hljs-string">"filename"</span>: <span class="hljs-string">"RPS+.md"</span>,
51.    <span class="hljs-string">"last_modified"</span>: <span class="hljs-string">"2025-11-25T12:00:00Z"</span>
52.  }

`AI写代码![](https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png)收起代码块![](https://csdnimg.cn/release/blogv2/dist/pc/img/arrowup-line-top-White.png)
</code></pre>
<p>点击语句旁的 <strong>Send request</strong> 按钮运行它，将 rps+-md 文档添加到 game-docs 索引中。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/239a57e3648f42c18be567212452e945~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=GPF45u2ALQpgLsR4mPT4khqxZZU%3D" alt="" loading="lazy"/></p>
<p>现在我们应该有一些可以查询的数据了，使用 Agent Builder，这比以往更简单。</p>
<p>从顶层导航菜单中选择 <strong>Agents</strong>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9c751d7cb5d8472e9fcf83ac00a9c416~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=xWh8itjql%2BcfCCiKfLQ3I4OuC6U%3D" alt="" loading="lazy"/></p>
<p>然后你只需问默认的 Elastic AI Agent：“我有什么数据？”</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff6f67aab5004cba90d63cdc52a0c314~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=3Ekzda%2FVZOa6%2BSeBBg64Wcd7hwQ%3D" alt="" loading="lazy"/></p>
<p>Elastic AI Agent 会评估数据并返回我们拥有的数据的简明说明。</p>
<h2 data-id="heading-3">创建工具</h2>
<p>好了，我们现在在 Elastic 中已有一些数据，让我们开始使用它。Agent Builder 内置支持创建 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmodelcontextprotocol.io%2F" title="https://modelcontextprotocol.io/" target="_blank" ref="nofollow noopener noreferrer">MCP</a> 工具，帮助 agent 访问所需数据，从而获得任务的正确上下文。让我们创建一个简单的工具来检索我们的游戏数据。</p>
<p>点击 Agent Builder 的 actions 菜单。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/830e19bd82774d9692ec0bf090535c78~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=Up5Zavq2YWGzMnBlQrU2%2Bbe5Oys%3D" alt="" loading="lazy"/></p>
<p>从菜单选项中选择 View all tools。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e8fbf09048bc4bb4a07ed58cd84ac333~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=la8xAVDmQE4GLk4ENTuk%2FlFMQAM%3D" alt="" loading="lazy"/></p>
<p>点击 + New Tool。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b67c51ec4e734d9eb21a87c65c0fd1b1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=ApI8o7d8PcOSyUeOyvEav0tg%2F5c%3D" alt="" loading="lazy"/></p>
<p>在 Create Tool 表单中，选择 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Fexplore-analyze%2Fquery-filter%2Flanguages%2Fesql" title="https://www.elastic.co/docs/explore-analyze/query-filter/languages/esql" target="_blank" ref="nofollow noopener noreferrer">ES|QL</a> 作为工具 type，并输入以下值。</p>
<p><strong>Tool ID</strong>：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-string">`example.get_game_docs`</span>AI写代码
</code></pre>
<p><strong>Description</strong>：</p>
<pre><code class="hljs language-sql" lang="sql">`<span class="hljs-keyword">Get</span> RPS<span class="hljs-operator">+</span> doc <span class="hljs-keyword">from</span> Elasticsearch game<span class="hljs-operator">-</span>docs index.`AI写代码
</code></pre>
<p><strong>Configuration</strong>：在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Fexplore-analyze%2Fquery-filter%2Flanguages%2Fesql" title="https://www.elastic.co/docs/explore-analyze/query-filter/languages/esql" target="_blank" ref="nofollow noopener noreferrer">ES|QL</a> Query 文本区域中输入以下查询：</p>
<pre><code class="hljs language-ini" lang="ini">`FROM game-docs | WHERE <span class="hljs-attr">filename</span> == <span class="hljs-string">"RPS+.md"</span>`AI写代码
</code></pre>
<p>完整填写的 Create tool 表单应如下所示。点击 Save 创建工具。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2bdc0ab4e55f414a8f4459423f2bfeb1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=AJiVBJuY3l52CrRx%2BXm5UTO7PWs%3D" alt="" loading="lazy"/></p>
<p>我们在工具架上有了一个新工具。工具不应该只是一直挂在架子上，它们应该被充分利用。让我们创建一个可以使用我们新自定义工具的 agent。</p>
<h2 data-id="heading-4">创建 Agent 并分配工具</h2>
<p>使用 Agent Builder 创建 agent 非常简单。你只需输入 agent 指令和一些细节，就完成了。现在让我们创建一个 agent。</p>
<p>点击 Manage agents。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b66c564303ec4c90ac022183b97ac0aa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=ZCL4HhXTS%2F%2B3Ynzesm%2BeYY1mYbY%3D" alt="" loading="lazy"/></p>
<p>点击 + New agent。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca458ff4c5be4ec5855f184dd718dc73~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=4iJpFWQhQP4xUCfpiIYP2C9xRhE%3D" alt="" loading="lazy"/></p>
<p>在 New Agent 表单中输入以下信息。</p>
<p>Agent ID：输入以下文本：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-string">`rps_plus_agent`</span>AI写代码
</code></pre>
<p>在 Custom Instructions 文本区域中输入以下指令：</p>
<pre><code class="hljs language-vbnet" lang="vbnet">`

<span class="hljs-number">1</span>.  <span class="hljs-keyword">When</span> prompted, <span class="hljs-keyword">if</span> the prompt contains an <span class="hljs-type">integer</span>, <span class="hljs-keyword">then</span> <span class="hljs-keyword">select</span> the corresponding numbered item <span class="hljs-keyword">in</span> the list <span class="hljs-keyword">of</span> <span class="hljs-string">"Game Objects"</span> <span class="hljs-keyword">from</span> your documents. Otherwise <span class="hljs-keyword">select</span> a random game <span class="hljs-type">object</span>. This <span class="hljs-built_in">is</span> your chosen game <span class="hljs-type">object</span> <span class="hljs-keyword">for</span> a <span class="hljs-type">single</span> round <span class="hljs-keyword">of</span> the game.

<span class="hljs-number">3</span>.  # General Game Rules
<span class="hljs-number">4</span>.  * <span class="hljs-number">2</span> players
<span class="hljs-number">5</span>.      - the user: the person playing the game
<span class="hljs-number">6</span>.      - you: the agent playing the game <span class="hljs-built_in">and</span> serving <span class="hljs-keyword">as</span> the game master
<span class="hljs-number">7</span>.  * <span class="hljs-keyword">Each</span> player chooses a game <span class="hljs-type">object</span> which will be compared <span class="hljs-built_in">and</span> cause them <span class="hljs-keyword">to</span> tie, win <span class="hljs-built_in">or</span> lose.

<span class="hljs-number">9</span>.  # Start the game
<span class="hljs-number">10</span>.  <span class="hljs-number">1</span>. This <span class="hljs-built_in">is</span> the way <span class="hljs-keyword">each</span> <span class="hljs-built_in">new</span> game always starts. You make the first line <span class="hljs-keyword">of</span> your response only the name <span class="hljs-keyword">of</span> your chosen game <span class="hljs-type">object</span>. 

<span class="hljs-number">12</span>.  <span class="hljs-number">2</span>. The remainder <span class="hljs-keyword">of</span> your response should be the <span class="hljs-string">"Starting Prompt"</span> <span class="hljs-keyword">text</span> <span class="hljs-keyword">from</span> your documents <span class="hljs-built_in">and</span> generate a list <span class="hljs-keyword">of</span> <span class="hljs-string">"Game Objects"</span> <span class="hljs-keyword">for</span> the person playing the game <span class="hljs-keyword">to</span> choose a game <span class="hljs-type">object</span> <span class="hljs-keyword">from</span>.  

<span class="hljs-number">14</span>.  # <span class="hljs-keyword">End</span> <span class="hljs-keyword">of</span> Game: The game ends <span class="hljs-keyword">in</span> one <span class="hljs-keyword">of</span> the following three outcomes:
<span class="hljs-number">15</span>.  <span class="hljs-number">1</span>. Invalid Input: <span class="hljs-keyword">If</span> the player responds <span class="hljs-keyword">with</span> an invalid game <span class="hljs-type">object</span> choice, respond <span class="hljs-keyword">with</span> variations <span class="hljs-keyword">of</span> the <span class="hljs-string">"Invalid Input"</span> <span class="hljs-keyword">text</span> <span class="hljs-keyword">from</span> your documents <span class="hljs-built_in">and</span> <span class="hljs-keyword">then</span> <span class="hljs-keyword">end</span> the game.

<span class="hljs-number">17</span>.  <span class="hljs-number">2</span>. Tie: The game ends <span class="hljs-keyword">in</span> a tie <span class="hljs-keyword">if</span> the user chooses the same game <span class="hljs-type">object</span> <span class="hljs-keyword">as</span> your game <span class="hljs-type">object</span> choice.

<span class="hljs-number">19</span>.  <span class="hljs-number">3</span>. Win <span class="hljs-built_in">or</span> Lose: The game winner <span class="hljs-built_in">is</span> decided based <span class="hljs-keyword">on</span> the <span class="hljs-string">"Judgement of Victory"</span> conditions <span class="hljs-keyword">from</span> your documents. <span class="hljs-keyword">Compare</span> the user<span class="hljs-comment">'s game object choice and your game object choice and determine who chose the winning game object.</span>

<span class="hljs-number">21</span>.  # Game conclusion
<span class="hljs-number">22</span>.  Respond <span class="hljs-keyword">with</span> a declaration <span class="hljs-keyword">of</span> the winner <span class="hljs-keyword">of</span> the game <span class="hljs-keyword">by</span> outputting the corresponding <span class="hljs-keyword">text</span> <span class="hljs-keyword">in</span> the <span class="hljs-string">"Judgement of Victory"</span> section <span class="hljs-keyword">of</span> your documents.

`AI写代码![](https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png)
</code></pre>
<p><strong>Display name</strong>：输入以下文本：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-string">`RPS+ Agent`</span>AI写代码
</code></pre>
<p><strong>Display description</strong>：输入以下文本：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-string">`An agent that plays the game RPS+`</span>AI写代码
</code></pre>
<p>通过点击 Tools 选项卡，将我们之前创建的自定义工具分配给该 agent。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b994b761ccf452192124e850fbf4b2f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=028ZK%2Bhg4VEo1D0EljqddZA6heM%3D" alt="" loading="lazy"/></p>
<p>只选择我们之前创建的 example.get_game_docs 工具。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9b047ee445e5455e98e470fd1b3a3713~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=jlZK37C9rrz0M8NulOUlXQ5Z%2BfQ%3D" alt="" loading="lazy"/></p>
<p>点击 Save 创建新 agent。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55aec75b2d4e46d09541774bf5be8036~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=Bmu8QmOHChvYW%2BrnhPGio6h1o90%3D" alt="" loading="lazy"/></p>
<p>让我们测试一下新 agent。从 agent 列表中有一个方便的链接，可以启动与任意 agent 的聊天。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/33d63324613a469485624979018c6919~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=R435zc%2BKmfG8qiucWOacWe5qdq4%3D" alt="" loading="lazy"/></p>
<p>只需输入 “start game”，游戏就会开始。它可以正常运行！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9105918d1fc04d0d8e23f5d34fb69ae4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=Ikx9Ud8zwJf3y9RrIdL5y8RvtJc%3D" alt="" loading="lazy"/></p>
<p>你可以看到 agent 在响应顶部显示了它选择的游戏对象。这很有用，因为我们可以看到 agent 的选择并确认游戏按预期运行。然而，在你选择之前知道对手的选择，会让剪刀石头布游戏不太有趣。为了将游戏打磨到最终形态，我们可以使用一个可以通过代码控制 agent 的 agent 编排平台。</p>
<p>Strands Agents SDK 登场</p>
<h2 data-id="heading-5">Strands Agents SDK</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a83bc22e84a74c7f81d5bb40e02f0e34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=n2%2F0E8qcpHiGhe63GtrbH2mZOqc%3D" alt="" loading="lazy"/></p>
<p>如果你想尝试新的 agent 开发框架，那么 <a href="https://link.juejin.cn?target=https%3A%2F%2Fstrandsagents.com%2Flatest%2F" title="https://strandsagents.com/latest/" target="_blank" ref="nofollow noopener noreferrer">Strands Agents SDK</a> 值得你花时间尝试。<a href="https://link.juejin.cn?target=https%3A%2F%2Faws.amazon.com%2Fblogs%2Fopensource%2Fintroducing-strands-agents-an-open-source-ai-agents-sdk%2F" title="https://aws.amazon.com/blogs/opensource/introducing-strands-agents-an-open-source-ai-agents-sdk/" target="_blank" ref="nofollow noopener noreferrer">Strands Agents SDK 由 AWS 于 2025 年 5 月发布</a>，作为开源 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fstrands-agents%2Fsdk-python" title="https://github.com/strands-agents/sdk-python" target="_blank" ref="nofollow noopener noreferrer">Python</a> 实现，现在也有 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.to%2Faws%2Fstrands-agents-now-speaks-typescript-a-side-by-side-guide-12b3" title="https://dev.to/aws/strands-agents-now-speaks-typescript-a-side-by-side-guide-12b3" target="_blank" ref="nofollow noopener noreferrer">Typescript</a> 版本。</p>
<h2 data-id="heading-6">在 Python 中快速上手 Strands Agents SDK</h2>
<p>启动你的编码环境，我们现在将快速浏览克隆并运行一个示例应用的过程，该应用使用 Strands Agents 通过 A2A 协议控制 RPS+ Agent。让我们创建一个经过微调的 RPS+ 游戏版本，使 agent 的选择在你做出选择后才显示，因为毕竟，猜测和惊喜结果才是剪刀石头布等游戏的乐趣所在。</p>
<p>在你的本地电脑上，打开 <a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.visualstudio.com%2Fdownload" title="https://code.visualstudio.com/download" target="_blank" ref="nofollow noopener noreferrer">Visual Studio Code</a> 并打开一个新终端。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79ab8a70786f42fb97dedee60a67951d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=h1ySAB%2FussJwVLjF9XrNrZkYfUM%3D" alt="" loading="lazy"/></p>
<p>在新打开的终端中，运行以下命令克隆 Elasticsearch Labs 仓库：</p>
<pre><code class="hljs language-bash" lang="bash">`git <span class="hljs-built_in">clone</span> https://github.com/elastic/elasticsearch-labs`AI写代码
</code></pre>
<p>运行以下 cd 命令，将目录切换到 elasticsearch-labs 目录：</p>
<pre><code class="hljs language-bash" lang="bash">`<span class="hljs-built_in">cd</span> elasticsearch-labs`AI写代码
</code></pre>
<p>接下来，运行以下命令在 Visual Studio Code 中打开该仓库：</p>
<pre><code class="hljs language-css" lang="css">`<span class="hljs-selector-tag">code</span> .`AI写代码
</code></pre>
<p>在 Visual Studio 文件资源管理器中，展开 supporting-blog-content 和 agent-builder-a2a-strands-agents 文件夹，然后打开文件 elastic_agent_builder_a2a_rps+.py。文件在 Visual Studio Code 中打开后如下所示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9dbfb508e717421e896c2aa2dc82a2b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=geDFwJ204raLFy7CxYfPeVhoDok%3D" alt="" loading="lazy"/></p>
<p>以下是你在文本编辑器中应该看到的 elastic_agent_builder_a2a_rps+.py 文件内容：</p>
<pre><code class="hljs language-ini" lang="ini">`

1.  import asyncio
2.  from dotenv import load_dotenv
3.  from uuid import uuid4
4.  import httpx
5.  import os
6.  import random
7.  from a2a.client import A2ACardResolver, ClientConfig, ClientFactory
8.  from a2a.types import Message, Part, Role, TextPart

<span class="hljs-attr">10.  DEFAULT_TIMEOUT</span> = <span class="hljs-number">60</span>  <span class="hljs-comment"># set request timeout to 1 minute</span>

13.  def create_message(*, role: <span class="hljs-attr">Role</span> = Role.user, text: str, context_id=None) -&gt; Message:
14.      return Message(
<span class="hljs-attr">15.          kind</span>=<span class="hljs-string">"message"</span>,
<span class="hljs-attr">16.          role</span>=<span class="hljs-string">"user"</span>,
<span class="hljs-attr">17.          parts</span>=[Part(TextPart(kind=<span class="hljs-string">"text"</span>, text=text))],
<span class="hljs-attr">18.          message_id</span>=uuid4().hex,
<span class="hljs-attr">19.          context_id</span>=context_id,
20.      )

23.  async def main():
24.      load_dotenv()
<span class="hljs-attr">25.      a2a_agent_host</span> = os.getenv(<span class="hljs-string">"ES_AGENT_URL"</span>)
<span class="hljs-attr">26.      a2a_agent_key</span> = os.getenv(<span class="hljs-string">"ES_API_KEY"</span>)
<span class="hljs-attr">27.      custom_headers</span> = {<span class="hljs-string">"Authorization"</span>: f<span class="hljs-string">"ApiKey {a2a_agent_key}"</span>}

29.      async with httpx.AsyncClient(
<span class="hljs-attr">30.          timeout</span>=DEFAULT_TIMEOUT, headers=custom_headers
31.      ) as httpx_client:
32.          <span class="hljs-comment"># Get agent card</span>
<span class="hljs-attr">33.          resolver</span> = A2ACardResolver(httpx_client=httpx_client, base_url=a2a_agent_host)
<span class="hljs-attr">34.          agent_card</span> = await resolver.get_agent_card(
<span class="hljs-attr">35.              relative_card_path</span>=<span class="hljs-string">"/rps_plus_agent.json"</span>
36.          )
37.          <span class="hljs-comment"># Create client using factory</span>
<span class="hljs-attr">38.          config</span> = ClientConfig(
<span class="hljs-attr">39.              httpx_client</span>=httpx_client,
<span class="hljs-attr">40.              streaming</span>=<span class="hljs-literal">True</span>,
41.          )
<span class="hljs-attr">42.          factory</span> = ClientFactory(config)
<span class="hljs-attr">43.          client</span> = factory.create(agent_card)
44.          <span class="hljs-comment"># Use the client to communicate with the agent</span>
45.          print("\nSending 'start game' message to Elastic A2A agent...")
<span class="hljs-attr">46.          random_game_object</span> = random.randint(<span class="hljs-number">1</span>, <span class="hljs-number">5</span>)
<span class="hljs-attr">47.          msg</span> = create_message(text=f<span class="hljs-string">"start with game object {random_game_object}"</span>)
48.          async for event in client.send_message(msg):
49.              if isinstance(event, Message):
<span class="hljs-attr">50.                  context_id</span> = event.context_id
<span class="hljs-attr">51.                  response_complete</span> = event.parts[<span class="hljs-number">0</span>].root.text
52.                  <span class="hljs-comment"># Get agent choice from the first line of the response</span>
<span class="hljs-attr">53.                  parsed_response</span> = response_complete.split(<span class="hljs-string">"\n"</span>, <span class="hljs-number">1</span>)
<span class="hljs-attr">54.                  agent_choice</span> = parsed_response[<span class="hljs-number">0</span>]
55.                  print(parsed_response<span class="hljs-section">[1]</span>)
56.          <span class="hljs-comment"># User choice sent for game results from the agent</span>
<span class="hljs-attr">57.          prompt</span> = input(<span class="hljs-string">"Your Choice  : "</span>)
<span class="hljs-attr">58.          msg</span> = create_message(text=prompt, context_id=context_id)
59.          async for event in client.send_message(msg):
60.              if isinstance(event, Message):
61.                  print(f"Agent Choice : {agent_choice}")
62.                  print(event.parts<span class="hljs-section">[0]</span>.root.text)

65.  if <span class="hljs-attr">__name__</span> == <span class="hljs-string">"__main__"</span>:
66.      asyncio.run(main())

`AI写代码!<span class="hljs-section">[]</span>(https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png)收起代码块!<span class="hljs-section">[]</span>(https://csdnimg.cn/release/blogv2/dist/pc/img/arrowup-line-top-White.png)
</code></pre>
<p>让我们来回顾一下这段代码的作用。从 main() 方法开始，代码首先访问 agent URL 和 API Key 的环境变量。然后我们使用这些值创建一个 httpx 客户端，用于获取该 agent 的 agent card。客户端随后使用 agent card 的详细信息向 agent 发送 “start game” 请求。这里有一个有趣的地方是，我们在 “start game” 请求中包含了 random_game_object 值。这个值是使用 Python 标准库的 random 模块生成的随机数。这样做的原因是，强大的 LLM（使 AI agent 成为可能）在生成随机性方面表现不佳。没问题，Python 来救场。</p>
<p>继续代码，当 agent 响应 “start game” 请求后，代码会提取 agent 的游戏对象选择，并将其保存在 agent_choice 变量中。其余的响应内容以文本形式显示给最终用户。然后提示用户输入他们的游戏对象选择，并将其发送给 agent。代码随后显示 agent 的游戏对象选择以及 agent 对游戏结果的最终判断。</p>
<h2 data-id="heading-7">将 agent URL 和 API Key 设置为环境变量</h2>
<p>由于示例应用将在本地电脑上运行，为了与我们的 Agent Builder agent 通信，我们需要为 Strands Agents SDK 提供 agent 的 A2A URL 和 API Key。示例应用使用名为 .env 的文件来存储这些值。</p>
<p>复制 env.example 文件，并将新文件命名为 .env。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/763b1ca501654248a0a0276d02f951b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=bvBH8uTNDNKkmAMJV73o7gD0LV4%3D" alt="" loading="lazy"/></p>
<p>返回 Elastic Agent Builder，我们可以在这里获取所需的两个值。</p>
<p>从页面右上角的 Agent Builder actions 菜单中选择 <strong>View all tools</strong>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e2d658c959d7434d926b1cbfa643131f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=IcqL%2FsByh7TZw2ea%2FUT%2FkZhuH4A%3D" alt="" loading="lazy"/></p>
<p>点击 Tools 页面顶部的 MCP Server 下拉菜单，并选择 Copy MCP Server URL。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d592dee70764e1ab0add80017647311~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=wbzVMyPz5OuD4CnNtjG7xeV%2BY0Y%3D" alt="" loading="lazy"/></p>
<p>将 MCP Server URL 粘贴到 .env 文件中，替换 <strong/> 占位符。现在我们需要对 URL 做一个修改，即将结尾的 “mcp” 替换为 “a2a”，因为 Strands Agents SDK 将使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fa2a-protocol.org%2F" title="https://a2a-protocol.org/" target="_blank" ref="nofollow noopener noreferrer">A2A 协议</a>与运行在 Elastic Agent Builder 中的 agent 通信。</p>
<p>修改后的 URL 应该类似这样：</p>
<pre><code class="hljs language-bash" lang="bash">`https://rps-game-project-12345a.kb.us-east-1.aws.elastic.cloud/api/agent_builder/a2a`AI写代码
</code></pre>
<p>我们在 Elastic Cloud 中还需要获取另一个值 —— API Key。点击顶层导航中的 Elasticsearch。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99e06fdc288c463691c3e3e8798786f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=M35GlEN9UdWP478IjJZe3Mn95GE%3D" alt="" loading="lazy"/></p>
<p>点击 Copy API Key 按钮复制 API Key。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/895e5561acdc4772b4cef6b258445f19~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=qAMx%2B6Pcry9EgdsFE%2Bhjuk%2BsjxM%3D" alt="" loading="lazy"/></p>
<p>现在回到 Visual Studio Code，在 .env 文件中粘贴 API Key，替换 <strong/> 占位符文本。你的 .env 文件应类似如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/40e611adbc874a02a2cf1b02b021d378~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=Iwij59c8OjdlB3DUGYKjNCd8Zy4%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-8">运行示例应用</h2>
<p>在 Visual Studio Code 中打开一个新终端。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9ca6ca135b3e46c384700808ec34006b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=mvGa2uF9tr0ziA0hJDBfHDIxsCw%3D" alt="" loading="lazy"/></p>
<p>首先在终端中运行以下 cd 命令：</p>
<pre><code class="hljs language-bash" lang="bash">`<span class="hljs-built_in">cd</span> elasticsearch-labs/supporting-blog-content/agent-builder-a2a-strands-agents`AI写代码
</code></pre>
<p>运行以下命令以创建 Python 虚拟环境。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-string">`python -m venv .venv`</span>AI写代码
</code></pre>
<p>根据你本地电脑的操作系统，运行以下命令来激活虚拟环境。</p>
<ul>
<li>MacOS/Linux</li>
</ul>

<pre><code class="hljs language-bash" lang="bash">`<span class="hljs-built_in">source</span> .venv/bin/activate`AI写代码
</code></pre>
<ul>
<li>Windows</li>
</ul>

<pre><code class="hljs language-r" lang="r">`.venv\Scripts\activate`AI写代码
</code></pre>
<p>示例应用使用 Strands Agents SDK，现在我们在本教程中需要安装它。运行以下命令安装 Strands Agents SDK 及其所有必需的 Python 库依赖。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-string">`pip install -r requirements.txt`</span>AI写代码
</code></pre>
<p>是时候清理发射平台并开始倒计时了。我们准备好启动这个应用。后退一步。使用以下命令运行它：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-string">`python elastic_agent_builder_a2a_rps+.py`</span>AI写代码
</code></pre>
<p>你应该会迎来一场 RPS+ 游戏。干得好，祝你好运！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d82240f7964140ecbf371022f215f060~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457388&amp;x-signature=EIM%2FG82mftB%2BYa0NMEupOOu8yNw%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-9">用相关上下文构建你的 AI 应用</h2>
<p>构建 AI Agent 现在已成为你的技能工具之一。你已经看到，通过 A2A 使用 Elastic Builder agent 在像 Strands Agents SDK 这样的 agent 开发框架中是多么容易。尝试<a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.elastic.co%2Fregistration%3Futm_source%3Dagentic-ai-category%26utm_medium%3Dsearch-labs%26utm_campaign%3Dagent-builder" title="https://cloud.elastic.co/registration?utm_source=agentic-ai-category&amp;utm_medium=search-labs&amp;utm_campaign=agent-builder" target="_blank" ref="nofollow noopener noreferrer">使用 Elastic</a> 构建与自定义数据相关上下文相连接的 AI agent。</p>
<p>原文：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fsearch-labs%2Fblog%2Fagent-builder-a2a-strands-agents-guide" title="https://www.elastic.co/search-labs/blog/agent-builder-a2a-strands-agents-guide" target="_blank" ref="nofollow noopener noreferrer">www.elastic.co/search-labs…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[UniPush 2.0 实战指南：工单提醒与多厂商通道配置]]></title>    <link>https://juejin.cn/post/7583955708318351360</link>    <guid>https://juejin.cn/post/7583955708318351360</guid>    <pubDate>2025-12-16T02:53:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583955708318351360" data-draft-id="7583921477614518307" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="UniPush 2.0 实战指南：工单提醒与多厂商通道配置"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2025-12-16T02:53:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="hellsing"/> <meta itemprop="url" content="https://juejin.cn/user/4433705584572302"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            UniPush 2.0 实战指南：工单提醒与多厂商通道配置
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4433705584572302/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    hellsing
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:53:55.000Z" title="Tue Dec 16 2025 02:53:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 方案选型与架构策略</h2>
<h3 data-id="heading-1">1.1 云服务商选择：推荐腾讯云</h3>
<p>在 uniCloud 的服务商选择上，针对企业级项目（尤其是涉及到工单、预警等需要稳定推送的场景），推荐选择 <strong>腾讯云</strong>。</p>
<ul>
<li><strong>核心优势</strong>：开启“云函数 URL 化”时，腾讯云<strong>不需要</strong>重新进行域名备案（ICP备案），可以直接使用腾讯云提供的默认域名。</li>
<li><strong>成本考量</strong>：虽然单价略高于阿里云，但省去了繁琐的行政备案流程，对于项目快速上线和维护极为有利。</li>
</ul>
<h3 data-id="heading-2">1.2 核心业务流程</h3>
<p>我们需要实现的是“点对点”的工单通知，核心逻辑如下：</p>
<ol>
<li><strong>前端（APP端）</strong> ：用户登录后，获取设备的 <code>push_clientid</code>。</li>
<li><strong>绑定关系</strong>：前端调用云函数或接口，将 <code>user_id</code> 与 <code>push_clientid</code> 存入 <code>uni-id-device</code> 表中（建立用户与设备的映射）。</li>
<li><strong>后端触发</strong>：由于工单状态变更通常发生在后台（Java/Python/Go等），后端通过 HTTP 请求调用 <strong>云函数 URL 化接口</strong>。</li>
<li><strong>云函数执行</strong>：云函数根据传入的 <code>user_id</code> 查库找到 CID，调用 <code>uniPush</code> 下发消息。</li>
</ol>
<hr/>
<h2 data-id="heading-3">2. 云函数实现（Core Code）</h2>
<p>此云函数作为统一的推送入口，处理了设备查找和多厂商参数适配。</p>
<p>JavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-meta">'use strict'</span>;
<span class="hljs-keyword">const</span> uniPush = uniCloud.<span class="hljs-title function_">getPushManager</span>({ <span class="hljs-attr">appId</span>: <span class="hljs-string">"__UNI__XXXXXX"</span> }) <span class="hljs-comment">// 替换你的 appId</span>
<span class="hljs-keyword">const</span> db = uniCloud.<span class="hljs-title function_">database</span>();
<span class="hljs-keyword">const</span> dbCmd = db.<span class="hljs-property">command</span>;

<span class="hljs-built_in">exports</span>.<span class="hljs-property">main</span> = <span class="hljs-keyword">async</span> (event, context) =&gt; {
    <span class="hljs-comment">// 假设后端通过 POST 请求传入 JSON body</span>
    <span class="hljs-keyword">let</span> body = event.<span class="hljs-property">body</span>;
    <span class="hljs-keyword">if</span>(event.<span class="hljs-property">isBase64Encoded</span>){
        body = <span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">from</span>(body, <span class="hljs-string">'base64'</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-string">'utf8'</span>);
    }
    <span class="hljs-keyword">const</span> { userIds, title, content } = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(body);

    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// --- 3. 查库：获取目标用户的 Push Client ID ---</span>
        <span class="hljs-keyword">const</span> deviceRes = <span class="hljs-keyword">await</span> db.<span class="hljs-title function_">collection</span>(<span class="hljs-string">'uni-id-device'</span>)
            .<span class="hljs-title function_">where</span>({
                <span class="hljs-attr">user_id</span>: dbCmd.<span class="hljs-title function_">in</span>(userIds)
            })
            .<span class="hljs-title function_">field</span>({ <span class="hljs-string">'push_clientid'</span>: <span class="hljs-literal">true</span> })
            .<span class="hljs-title function_">get</span>();

        <span class="hljs-keyword">if</span> (deviceRes.<span class="hljs-property">data</span>.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">code</span>: <span class="hljs-number">404</span>, <span class="hljs-attr">msg</span>: <span class="hljs-string">'指定的用户均未绑定任何设备'</span> };
        }

        <span class="hljs-comment">// 去重，防止同一设备收到多条（如果用户多端登录）</span>
        <span class="hljs-keyword">const</span> cids = [...<span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(deviceRes.<span class="hljs-property">data</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">push_clientid</span>))];

        <span class="hljs-comment">// --- 4. 执行推送：配置多厂商通道 ---</span>
        <span class="hljs-keyword">const</span> pushRes = <span class="hljs-keyword">await</span> uniPush.<span class="hljs-title function_">sendMessage</span>({
            <span class="hljs-string">"push_clientid"</span>: cids,
            <span class="hljs-string">"title"</span>: title,
            <span class="hljs-string">"content"</span>: content,
            <span class="hljs-string">"force_notification"</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 强制显示通知栏</span>
            <span class="hljs-string">"request_id"</span>: context.<span class="hljs-property">requestId</span>,
            <span class="hljs-string">"options"</span>: {
                <span class="hljs-string">"android"</span>: {
                    <span class="hljs-comment">// --- 小米 (XM) 配置 ---</span>
                    <span class="hljs-string">"XM"</span>: {
                        <span class="hljs-comment">// 必须在小米后台申请 Channel ID，否则可能被折叠或静音</span>
                        <span class="hljs-string">"/extra.channel_id"</span>: <span class="hljs-string">"你的小米ChannelID"</span>, 
                    },
                    <span class="hljs-comment">// --- 华为 (HW) 配置 ---</span>
                    <span class="hljs-string">"HW"</span>: {
                        <span class="hljs-comment">// 必须配置自分类权益，"SERVICE" 为服务提醒，权重高于默认</span>
                        <span class="hljs-string">"/message/android/category"</span>: <span class="hljs-string">"WORK"</span>, <span class="hljs-comment">// 或 SERVICE</span>
                    },
                    <span class="hljs-comment">// --- OPPO (OP) 配置 ---</span>
                    <span class="hljs-string">"OP"</span>: {
                        <span class="hljs-string">"/channel_id"</span>: <span class="hljs-string">"你的OPPO通道ID"</span>,
                        <span class="hljs-string">"/category"</span>: <span class="hljs-string">"MARKETING"</span>, <span class="hljs-comment">// 注意：OPPO 营销类消息限制较多，重要通知建议申请私信通道</span>
                        <span class="hljs-string">"/notify_level"</span>: <span class="hljs-number">16</span>
                    },
                    <span class="hljs-comment">// --- VIVO (VV) 配置 ---</span>
                    <span class="hljs-string">"VV"</span>: {
                        <span class="hljs-string">"/classification"</span>: <span class="hljs-number">1</span>, <span class="hljs-comment">// 1: 系统类消息 (需要申请)，0: 运营类</span>
                    }
                }
            }
        });

        <span class="hljs-comment">// --- 5. 返回结果 ---</span>
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">code</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">msg</span>: <span class="hljs-string">'推送请求已下发'</span>,
            <span class="hljs-attr">target_user_count</span>: userIds.<span class="hljs-property">length</span>,
            <span class="hljs-attr">target_device_count</span>: cids.<span class="hljs-property">length</span>,
            <span class="hljs-attr">uni_push_result</span>: pushRes
        };

    } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(e);
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">code</span>: <span class="hljs-number">500</span>,
            <span class="hljs-attr">msg</span>: <span class="hljs-string">'服务端内部错误'</span>,
            <span class="hljs-attr">error</span>: e.<span class="hljs-property">message</span>
        };
    }
};
</code></pre>
<hr/>
<h2 data-id="heading-4">3. 安卓厂商特殊配置（必读）</h2>
<p>随着 Android 8.0+ 通知渠道（Notification Channels）的引入，如果不进行额外配置，工单提醒很可能会被归类为“营销广告”从而<strong>静音</strong>或<strong>折叠</strong>。</p>
<h3 data-id="heading-5">3.1 小米 (Xiaomi) 配置</h3>
<p>小米需要创建自定义 Channel 才能让消息正常响铃或震动。</p>
<ol>
<li>
<p><strong>操作路径</strong>：小米开放平台 -&gt; 消息推送 -&gt; 配置管理 -&gt; 通知类别（Channel）管理。</p>
</li>
<li>
<p><strong>申请</strong>：新建一个类别，例如“工单提醒”或“事务通知”。</p>
</li>
<li>
<p><strong>获取 ID</strong>：申请通过后，会获得一个 <code>Channel ID</code>（如 <code>Channel_A</code>）。</p>
</li>
<li>
<p><strong>代码映射</strong>：</p>
<p>JavaScript</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"XM"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"/extra.channel_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"你申请的Channel_ID"</span> 
<span class="hljs-punctuation">}</span>
</code></pre>
<blockquote>
<p><strong>注意</strong>：如果不填，默认走“普通消息”通道，限制较多。</p>
</blockquote>
</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf50699285b04afa816720aa68116146~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaGVsbHNpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766458434&amp;x-signature=nYCUnmyTaUN6rzZD50Du60K9qZY%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-6">3.2 华为 (Huawei) 配置</h3>
<p>华为引入了“自分类权益”，需要将消息分类为“服务与通讯”类，否则会被当做“资讯营销”处理。</p>
<ol>
<li>
<p><strong>操作路径</strong>：华为开发者联盟 -&gt; 我的项目 -&gt; 推送服务 -&gt; 配置 -&gt; <strong>自分类权益</strong>。</p>
</li>
<li>
<p><strong>申请权益</strong>：点击申请，按照指引填写（通常需要上传APP截图证明场景）。</p>
</li>
<li>
<p><strong>参数设置</strong>：</p>
<ul>
<li>在代码中设置 <code>category</code> 字段。</li>
<li><code>WORK</code>：工作事项提醒（适合工单）。</li>
<li><code>IM</code>：即时聊天。</li>
<li>如果不传，默认为 <code>MARKETING</code>（营销），极易被拦截。</li>
</ul>
<p>JavaScript</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"HW"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"/message/android/category"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"WORK"</span> 
<span class="hljs-punctuation">}</span>
</code></pre>
</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/60a0e94e85f84de8a5c0bb3d2934204f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaGVsbHNpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766458434&amp;x-signature=GC2VYc560Jc%2FkrvQ2UpNHc1Ezco%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-7">3.3 OPPO &amp; VIVO 注意事项</h3>
<ul>
<li><strong>OPPO</strong>：同样有 Channel 概念。私信通道（高权重）需要单独申请邮件报备，且门槛较高。代码中演示的 <code>MARKETING</code> 仅供测试，正式上线建议申请 <code>IM</code> 或业务相关通道。</li>
<li><strong>VIVO</strong>：<code>classification</code> 为 1 代表系统消息，0 代表运营消息。系统消息配额更高，提醒更明显。</li>
</ul>
<hr/>
<h2 data-id="heading-8">4. 故障排查流程 (Troubleshooting)</h2>
<p>当消息没有送达时，请按以下步骤排查：</p>
<h3 data-id="heading-9">📌 阶段一：基础环境检查</h3>
<ol>
<li>
<p><strong>CID 是否获取成功</strong>：前端 <code>uni.getPushClientId</code> 是否拿到了 ID？如果是在模拟器运行，通常无法获取有效的厂商 CID。</p>
</li>
<li>
<p><strong>云函数报错</strong>：查看 uniCloud Web 控制台的云函数日志，检查是否有 <code>appId</code> 不匹配或数据库查询为空的情况。</p>
</li>
<li>
<p><strong>打包检查</strong>：</p>
<ul>
<li>UniPush 2.0 严重依赖应用签名。</li>
<li><strong>必须使用正式签名打包的自定义基座</strong>进行调试，标准基座无法测试厂商通道。</li>
<li>确保 <code>manifest.json</code> 中勾选了 UniPush 2.0 并正确填写了各厂商的 AppID/AppKey。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-10">📌 阶段二：离线推送检查（厂商通道）</h3>
<p>如果 APP 打开时能收到（走的是个推在线通道），但杀掉进程后收不到（走的是厂商通道），则是<strong>厂商配置问题</strong>。</p>
<ol>
<li>
<p><strong>检查厂商后台开关</strong>：确保在华为/小米等后台，推送服务已“启用”。</p>
</li>
<li>
<p><strong>包名与签名 SHA1</strong>：</p>
<ul>
<li>华为/小米后台填写的 <code>SHA256</code> 或 <code>SHA1</code> 必须与你打包证书的指纹<strong>完全一致</strong>。</li>
<li>这是最常见的错误原因。</li>
</ul>
</li>
<li>
<p><strong>参数映射</strong>：</p>
<ul>
<li>检查云函数代码中 <code>options</code> 里的参数键值对是否按照厂商最新文档编写（如华为的 <code>category</code> 拼写）。</li>
</ul>
</li>
<li>
<p><strong>限流与配额</strong>：</p>
<ul>
<li>如果是测试阶段，某些厂商（如 VIVO/OPPO）对未上架应用的推送数量有限制（如一天只能推几条）。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-11">参考文档</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fask.dcloud.net.cn%2Farticle%2F40291" target="_blank" title="https://ask.dcloud.net.cn/article/40291" ref="nofollow noopener noreferrer">DCloud 官方：UniPush 2.0 常见问题索引</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fask.dcloud.net.cn%2Farticle%2F40283" target="_blank" title="https://ask.dcloud.net.cn/article/40283" ref="nofollow noopener noreferrer">DCloud 官方：厂商通道参数设置指南</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[入围AA总榜Top 10，Non-Reasoning Model榜单第一！KAT-Coder-Pro V1 新版本踏浪归来！]]></title>    <link>https://juejin.cn/post/7583933107690422335</link>    <guid>https://juejin.cn/post/7583933107690422335</guid>    <pubDate>2025-12-16T03:00:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583933107690422335" data-draft-id="7583980250733641791" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="入围AA总榜Top 10，Non-Reasoning Model榜单第一！KAT-Coder-Pro V1 新版本踏浪归来！"/> <meta itemprop="keywords" content="前端,后端,前端框架"/> <meta itemprop="datePublished" content="2025-12-16T03:00:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="快手技术"/> <meta itemprop="url" content="https://juejin.cn/user/3736571181793721"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            入围AA总榜Top 10，Non-Reasoning Model榜单第一！KAT-Coder-Pro V1 新版本踏浪归来！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3736571181793721/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    快手技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T03:00:39.000Z" title="Tue Dec 16 2025 03:00:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>KAT-Coder-Pro V1 迎来 1210 版关键迭代，本次更新聚焦 Agentic Coding 领域核心能力升级，旨在为全球开发者提供更高效、更贴合业务场景的 AI 编码辅助体验。凭借此次迭代，KAT-Coder-Pro V1 在权威评测机构 Artificial Analysis（AA）榜单中表现亮眼，以 64 分综合评分跻身全球总榜 TOP 10，更以绝对优势在 Non-Reasoning Model 中斩获第一名，再次印证其在 AI 编码领域的顶尖实力。</p>
<h3 data-id="heading-0">四大维度深度优化，筑牢 Agentic Coding 核心竞争力</h3>
<p>为应对复杂编程场景，KAT-Coder-Pro V1 新版本围绕开发者实际需求，在以下四大关键维度完成进一步升级：</p>
<ul>
<li>
<p><strong>卓越 Agentic 交互体验</strong>：深度优化了模型在 Claude Code、Kilo Code、Roo Code、Cline、Zed 等数十种主流 Agent 工具中的集成表现，显著提升了模型在不同开发环境下的交互流畅度和响应精确性。</p>
</li>
<li>
<p><strong>强化代码推理与工具调用</strong>：进一步提升了模型的 Agentic Coding 能力，强化模型在不同场景下调用 Coding Tools 和 Web Search Tools 解决实际问题的能力。</p>
</li>
<li>
<p>**提升工具调用稳定性：**降低了工具（API）调用的整体错误率，提升了复杂任务流的稳定性。</p>
</li>
<li>
<p>**增强前端代码生成能力：**通过生成式奖励模型大幅度提升前端页面美感，显著增强了 HTML、CSS、JavaScript 等前端代码的生成质量与准确性。</p>
</li>
</ul>
<h3 data-id="heading-1">AA 榜单成绩亮眼，多维度性能比肩国际顶尖模型</h3>
<p>随着我们进一步提升模型的通用任务能力，KAT-Coder-Pro V1 在 Artificial Analysis（AA）权威评测中展现出全面且强劲的性能提升，核心指标表现如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5c35bdbbcf6240b8b76c16a6e7b9c03e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b-r5omL5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766458838&amp;x-signature=j2K49up7AAXNazjONHXiGKVSSfk%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p><strong>综合排名跻身全球 TOP 10</strong>：Artificial Analysis intelligence index 取得 64 分，综合模型能力排名第十名，超越 Claude 4.5 Sonnet，成为榜单中表现最突出的国产编码模型之一；在 Non-Reasoning Model 赛道中，更是以绝对优势拿下榜单第一。</p>
</li>
<li>
<p><strong>工具调用能力领先</strong>：在𝜏²-Bench Telecom（Agentic Tool Use）中取得 89% 的优异成绩，充分验证其在复杂工具调用场景下的高效性与可靠性。</p>
</li>
<li>
<p><strong>通用任务能力提升</strong>：在各类高难度学科推理基准测试中表现显著提升，进一步贴近实际开发需求，AA-LCR（Long Context Reasoning）达到 74%；Humanity's Last Exam 达到 33.4%；AIME 2025 达到 95%。</p>
</li>
<li>
<p><strong>指令遵循能力突出</strong>：IFBench（Instruction Following）指标达 68%，超过 Claude Opus 4.5、Deepseek V3.2 等模型，能更精准理解开发者意图，减少因指令偏差导致的无效输出，提升开发效率。</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/287073d794d541d0a18d01c47386bdb2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b-r5omL5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766458838&amp;x-signature=%2BmimrOrUtrauGz4Vdm86dWzLTS8%3D" alt="" loading="lazy"/></p>
<p>在 AA 榜单的官方评测结果中，我们也清晰看到了 KAT-Coder-Pro V1 除性能外的其他优点。</p>
<ul>
<li><strong>极致性价比</strong></li>
</ul>
<p>在 AA 评测任务中，KAT-Coder-Pro V1 的输出 Token 消耗量远低于同性能区间的其他模型（如 Claude 4.5 Sonnet、Grok 4.1 Fast）。这意味着，搭配 KAT-Coder-Pro V1 极具竞争力的定价，在真实世界的相同编程任务中，KAT-Coder-Pro V1 能让用户以更低成本获得稳定且高质量的输出，更好的实现了价格与质量的平衡，无疑是 AI 编程场景下极具竞争力的高性价比之选。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d965feb5cdc4fc7b9cf8c42dc56b406~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b-r5omL5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766458838&amp;x-signature=%2FGokwyyncIabUU0AgzzY6CCMxTI%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>极速响应，保障沉浸式编码体验</strong></li>
</ul>
<p>KAT-Coder-Pro V1 兼具卓越的服务性能，端到端响应耗时也远优于同性能区间的其他模型。在真实开发场景中，响应慢的模型，很容易让开发者陷入 “等待焦虑”，及在 Vibe coding 过程中，需要停下来等待模型加载输出，突然冒出来的思路灵感容易在等待输出的过程中被打断跑偏。KAT-Coder-Pro V1 可以做 “即输即得”，让开发者在沉浸式开发中彻底告别等待，尽享行云流水般的编码体验。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e9f0d3d50c5f4e5c80c857c4af7dd2ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b-r5omL5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766458838&amp;x-signature=jT8de0CD7SRj1XFr2hHl7ONiZiE%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-2">技术揭秘：如何解决 MOE 模型 RL 训练的不稳定性？</h3>
<p>当前业界大多把模型在 RL 训练时出现 reward 崩溃的问题归因于“训推不一致”。然而，<strong>我们的实验发现：当前阶段 RL 训练不稳定的主导因素并不是训推不一致，而是采样噪声（Sampling Noise）本身</strong>。当我们显式抑制噪声强度后，即使存在明显的训推差异，训练依旧保持稳定，并能获得更快的收敛速度。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a772b9e5746841ac9a071a647f8b7fb3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b-r5omL5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766458838&amp;x-signature=S5dEhAyf3vrSpgDyanyZOo9bxEU%3D" alt="" loading="lazy"/></p>
<p>图中 mean_8(黄线)代表我们提出的抑制采样噪声方法，其余曲线为 TIS 等业界常用方法。对比可见，我们的方法能获得更好的训练效果。</p>
<p><strong>具体技术细节详见：</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fxie.infoq.cn%2Flink%3Ftarget%3Dhttps%253A%252F%252Fkwaikat.github.io%252Fkwaikat-blog%252Fposts%252Fkatcoder_1201%252F" target="_blank" title="https://xie.infoq.cn/link?target=https%3A%2F%2Fkwaikat.github.io%2Fkwaikat-blog%2Fposts%2Fkatcoder_1201%2F" ref="nofollow noopener noreferrer">kwaikat.github.io/kwaikat-blo…</a></p>
<h3 data-id="heading-3">便捷接入，限时免费体验顶尖 AI 编码能力</h3>
<p>目前，StreamLake 官方 API 已同步更新，接口与调用方式保持不变。且与 OpenRouter、Novita AI、AtlasCloud、ZenMux 等合作伙伴完成兼容适配，开发者无需重新配置即可继续免费体验最新模型。</p>
<p><strong>开发工具接入指南</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fxie.infoq.cn%2Flink%3Ftarget%3Dhttps%253A%252F%252Fwww.streamlake.com%252Fdocument%252FWANQING%252Fme6ymdjrqv8lp4iq0o9" target="_blank" title="https://xie.infoq.cn/link?target=https%3A%2F%2Fwww.streamlake.com%2Fdocument%2FWANQING%2Fme6ymdjrqv8lp4iq0o9" ref="nofollow noopener noreferrer">www.streamlake.com/document/WA…</a></p>
<p><strong>API KEY 申请</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fxie.infoq.cn%2Flink%3Ftarget%3Dhttps%253A%252F%252Fstreamlake.com%252Fproduct%252Fkat-coder" target="_blank" title="https://xie.infoq.cn/link?target=https%3A%2F%2Fstreamlake.com%2Fproduct%2Fkat-coder" ref="nofollow noopener noreferrer">streamlake.com/product/kat…</a></p>
<p>期待与您携手，共同创造新的未来。</p>
<p>扫码即可进入「KwaiKAT 交流群」获取最新资讯！</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f79a638b5fe4dfd8c8706ee875366e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b-r5omL5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766458838&amp;x-signature=H%2FAVjl3N9WqORVeqqB2s5bVuQMQ%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[记录曾经打开半屏小程序遇到的事]]></title>    <link>https://juejin.cn/post/7583971282891882548</link>    <guid>https://juejin.cn/post/7583971282891882548</guid>    <pubDate>2025-12-16T02:33:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583971282891882548" data-draft-id="7582529173828141090" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="记录曾经打开半屏小程序遇到的事"/> <meta itemprop="keywords" content="前端,微信小程序"/> <meta itemprop="datePublished" content="2025-12-16T02:33:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="wangpq"/> <meta itemprop="url" content="https://juejin.cn/user/2172290705137415"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            记录曾经打开半屏小程序遇到的事
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2172290705137415/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    wangpq
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:33:40.000Z" title="Tue Dec 16 2025 02:33:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>今年8月开发新疆项目时，曾接到个需求，需要我们这边配合第三方的小程序（立克办）半屏打开我们的新疆一码游小程序，并且需要做单点登录，从立克办那边直接无感登录我们小程序。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9b9cb609343f4d2b8bec25e4e4705ca0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3Bx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457220&amp;x-signature=3KqYnWB%2BRltQCYOT7VhGoCW0K7k%3D" alt="53a3eb48-2bf3-4a4e-b000-8b04b21eea40.png" loading="lazy"/></p>
<p>刚开始觉得没多少事，事后做下来，还是出了一些问题。主要原因还是因为涉及第三方，事先缺少沟通，有些东西想当然了。当时听产品描述需求，以为第三方（立克办）那边半屏打开我们的新疆一码游小程序，所有参数都在<code>wx.navigateToMiniProgram</code>方法的<code>path</code>参数里面（实际他们一部分参数在<code>path</code>中，另一部分在<code>extraData</code>中）。结果做完上线生产（第三方没有提供开发版和体验版，只有生产版本），才发现问题，经过和第三方多番线上语言沟通，才搞清楚问题所在，沟通过程中，第三方因为一些理由拒绝修改传参方式，所以我这边又只好配合修改了接收参数方式。最终才线上测试搞定。</p>
<p>啰嗦了半天，还没讲到正题，今天在这里，我主要是想记录以下几个问题，方便以后查阅，都说好记性不如烂笔头嘛，下面开始记录。</p>
<h2 data-id="heading-0">一、关于打开半屏小程序</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.weixin.qq.com%2Fminiprogram%2Fdev%2Fframework%2Fopen-ability%2FopenEmbeddedMiniProgram.html" target="_blank" title="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/openEmbeddedMiniProgram.html" ref="nofollow noopener noreferrer">打开半屏小程序</a>，我们可以从微信官方文档中知道，使用<a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.weixin.qq.com%2Fminiprogram%2Fdev%2Fapi%2Fnavigate%2Fwx.openEmbeddedMiniProgram.html" target="_blank" title="https://developers.weixin.qq.com/miniprogram/dev/api/navigate/wx.openEmbeddedMiniProgram.html" ref="nofollow noopener noreferrer">wx.openEmbeddedMiniProgram</a> 即可，下面介绍下它的几个重要参数。</p>
<h3 data-id="heading-1">1、envVersion</h3>
<p><code>envVersion</code>表示要打开的小程序版本，包含develop、trial、release,从文档</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa63b09a559b473688009a1cc9a0a1e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3Bx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457220&amp;x-signature=x%2F0Xw1YC7UuSyileyV%2FXqjEj8Hs%3D" alt="a5dbe248-974c-4210-aaea-a4ce93400199.png" loading="lazy"/>
中我们可以了解到，如果主动打开方的小程序未设置<code>envVersion</code>,或者设置为正式版<code>release</code>，那么被打开方的小程序也必须是正式版。通俗讲就是，我开发，你也开发，我体验，你也体验，我正式，你也正式。</p>
<p>如果双方还在开发调试阶段，最好还是设置为体验版<code>trial</code>比较好，双方都是体验版版，方便开发调试，等开发测试没啥问题了，再改为<code>release</code>或者去掉<code>envVersion</code>参数，以避免在正式版发现错误，盲改后再线上测试。</p>
<p>我们当时就是在正式版，我这里只能盲改开发，易出错，效率低。</p>
<h3 data-id="heading-2">2、appId、path、extraData</h3>
<p><code>appId</code>为要打开的小程序 appId，无需多言。<code>path</code>为要打开的页面路径，值为字符串<code>string</code>类型，<code>extraData</code>为需要传递给目标小程序的数据，值为对象<code>object</code>类型。这里的<code>path</code>不仅仅可以设置要打开的小程序页面路径，还能传递参数，path 中 ? 后面的部分会成为 query。</p>
<p>虽然<code>path</code>、<code>extraData</code>两者都可以传递参数，不过大家需要注意两者获取参数的区别。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b71d3f6caa104544b410f7c352abc965~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3Bx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457220&amp;x-signature=kjMsfR2%2F0sE3d9WbrUXthEkOig0%3D" alt="2abe8e13-7b1c-4358-a53a-f67382131344.png" loading="lazy"/></p>
<p>从文档中我们已经得知，两者传参方式都可以在app生命周期<code>onLaunch</code>,<code>onShow</code>中获取，只有<code>path</code>传递的参数，可以在页面级生命周期<code>onLoad</code>中取得。这里大家开发的时候，一定得注意。</p>
<p>关于如何获取<code>extraData</code>参数，我们可以在小程序App.vue的<code>onLaunch</code>、<code>onShow</code>中按如下方式获取：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
    <span class="hljs-comment">//onLaunch(opts) {</span>
        <span class="hljs-comment">// let extraData = opts?.referrerInfo?.extraData</span>
    <span class="hljs-comment">//},</span>
    <span class="hljs-comment">// 建议如无特殊要求只执行一次，获取extraData参数，都在onShow中执行</span>
    onShow (opts) {
        <span class="hljs-keyword">let</span> extraData = opts?.<span class="hljs-property">referrerInfo</span>?.<span class="hljs-property">extraData</span>
    }
}
</code></pre>
<p>从上次配合半屏打开小程序，开发单点登录的经验来看，一般写在<code>onShow</code>中最好，大家都知道，<code>onLaunch</code>只在小程序初始化完成时触发，<code>onShow</code>则是当小程序启动，或每次从后台进入前台显示时都会触发。如果没有需求说只要执行一次，那么使用<code>onShow</code>则是最为稳妥。</p>
<p>我当时就是最先写在<code>onLaunch</code>中，导致他们立克办小程序用户打开我们一码游小程序，之后退出我们小程序后(用户没有删除我们一码游小程序)，再次操作，这时，登录失败。原因就是进入我们小程序，不会再执行<code>onLaunch</code>中的代码，获取不到<code>extraData</code>参数，从而导致登录失败。后来我又改到<code>onShow</code>中才解决了问题，如下图：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/82fb935052fc4e299c636b33bbfb64c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3Bx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457220&amp;x-signature=ry2xHV141IcHINfjPf5Pht833o8%3D" alt="2cd48bac-714f-4799-b0dc-f4bb3ab52d98.png" loading="lazy"/></p>
<h2 data-id="heading-3">二、同时在<code>path</code>、<code>extraData</code>中传了参，被半屏打开的小程序这边，如何处理参数？</h2>
<p>拿我们上次对接立克办为例，后来了解到，他们是这样传的参数，如下图：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9228a662e77743ae826b60e7b5ca4d28~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3Bx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457220&amp;x-signature=8oo9Ve5efUfzLNJV9fv34FfcPTs%3D" alt="81bb6b34b67ffbcceadd63d319690459.png" loading="lazy"/></p>
<p><code>path</code>中传递了参数<code>?cityCode=650200000000</code>,<code>extraData</code>中传了state、token。从立克办小程序跳转过来，是需要直接进入我们一码游小程序的指定地区的首页。</p>
<p>由于<code>extraData</code>中也有传参，但处理逻辑只能在被跳转的页面中处理，所以我在<code>app.onShow</code>中获取参数后，将参数存储到了store中，这样在页面中就能获取到传递过来的<code>extraData</code>参数了（不过在小程序退出或者退出登录时，记得销毁，避免其他用户登录误用立克办的登录逻辑）。</p>
<p>App.vue</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">onUnload</span>(<span class="hljs-params"/>){ 
    uni.<span class="hljs-title function_">setStorageSync</span>(<span class="hljs-string">'lkbToken'</span>, <span class="hljs-string">""</span>) 
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$store</span>.<span class="hljs-title function_">commit</span>(<span class="hljs-string">'setExtraData'</span>, <span class="hljs-literal">null</span>) 
}
</code></pre>
<p>store/index.js</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">logout</span>(<span class="hljs-params">state</span>) {
    <span class="hljs-comment">// 其他代码已省略</span>
    state.<span class="hljs-property">extraData</span> = <span class="hljs-literal">null</span>
    uni.<span class="hljs-title function_">setStorageSync</span>(<span class="hljs-string">'extraData'</span>, <span class="hljs-literal">null</span>)
    uni.<span class="hljs-title function_">setStorageSync</span>(<span class="hljs-string">'lkbToken'</span>,  <span class="hljs-string">""</span>)  
    uni.<span class="hljs-title function_">setStorageSync</span>(<span class="hljs-string">'platformOpenId'</span>,  <span class="hljs-string">""</span>)
}
</code></pre>
<h2 data-id="heading-4">三、完整的半屏打开小程序，单点登录功能涉及的改动如下：</h2>
<p>1、小程序 App.vue</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  onShow (opt) {
    <span class="hljs-keyword">let</span> extraData = opt?.<span class="hljs-property">referrerInfo</span>?.<span class="hljs-property">extraData</span>
    <span class="hljs-keyword">if</span>(extraData){
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">$store</span>.<span class="hljs-title function_">commit</span>(<span class="hljs-string">'setExtraData'</span>,extraData);
    }<span class="hljs-keyword">else</span>{
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">$store</span>.<span class="hljs-title function_">commit</span>(<span class="hljs-string">'setExtraData'</span>, <span class="hljs-literal">null</span>)
    }
  },
  <span class="hljs-title function_">onUnload</span>(<span class="hljs-params"/>){
    uni.<span class="hljs-title function_">setStorageSync</span>(<span class="hljs-string">'lkbToken'</span>, <span class="hljs-string">""</span>)  
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$store</span>.<span class="hljs-title function_">commit</span>(<span class="hljs-string">'setExtraData'</span>, <span class="hljs-literal">null</span>)
  }
}
</code></pre>
<p>2、小程序 pages/index/main.vue</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
    <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">q</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// 是否是扫码/传参切换城市,原来设置的是-1，但是当为-1时永远都不可能会展示推荐景区和城市</span>
            query : {},
            lkbLoading : <span class="hljs-literal">false</span>
        };
    },
    <span class="hljs-title function_">onLoad</span>(<span class="hljs-params">opt</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span> = opt
        <span class="hljs-comment">// 扫描二维码进入小程序，二维码参数获取</span>
        <span class="hljs-keyword">if</span> (opt.<span class="hljs-property">q</span>) {
            <span class="hljs-keyword">const</span> query = <span class="hljs-built_in">decodeURIComponent</span>(opt.<span class="hljs-property">q</span>).<span class="hljs-title function_">split</span>(<span class="hljs-string">"?"</span>)[<span class="hljs-number">1</span>];
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">$qs</span>.<span class="hljs-title function_">parse</span>(query)
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">q</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>.<span class="hljs-property">cityCode</span>;
        } 
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (opt.<span class="hljs-property">cityCode</span>) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">q</span> = opt.<span class="hljs-property">cityCode</span>;
        }
        <span class="hljs-comment">// 立克办半屏打开我们小程序,默认进入克拉玛依首页(这里的opt.token是立克办的token字符串)</span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>( <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getLkbBool</span>() ){
            opt.<span class="hljs-property">cityCode</span>= <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>.<span class="hljs-property">cityCode</span> || <span class="hljs-string">'650200000000'</span> 
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">q</span> = opt.<span class="hljs-property">cityCode</span>;
            <span class="hljs-keyword">if</span> (!uni.<span class="hljs-title function_">getStorageSync</span>(<span class="hljs-string">"token"</span>)) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">likeBanLogin</span>()
            };
        }
        
         <span class="hljs-comment">// 其他无关逻辑略...</span>
    },

    <span class="hljs-title function_">onShow</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getLkbBool</span>()){
            <span class="hljs-keyword">if</span> (!uni.<span class="hljs-title function_">getStorageSync</span>(<span class="hljs-string">"token"</span>)) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">likeBanLogin</span>()
            };
            <span class="hljs-keyword">return</span> 
        }
        
        <span class="hljs-comment">// 其他无关逻辑略...</span>
    },
    <span class="hljs-attr">methods</span>: {
        <span class="hljs-comment">// 判断是否立克办传参</span>
        <span class="hljs-title function_">getLkbBool</span>(<span class="hljs-params"/>){
            <span class="hljs-keyword">const</span> extraData = <span class="hljs-variable language_">this</span>.<span class="hljs-property">$store</span>.<span class="hljs-property">getters</span>.<span class="hljs-property">extraData</span>;
            <span class="hljs-keyword">return</span> (extraData.<span class="hljs-property">token</span> &amp;&amp; extraData.<span class="hljs-property">state</span>===<span class="hljs-string">'likeban'</span>) || uni.<span class="hljs-title function_">getStorageSync</span>(<span class="hljs-string">"lkbToken"</span>)
        },
        <span class="hljs-comment">// 获取小程序登录用户openid等信息</span>
        <span class="hljs-title function_">getOpenId</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
                uni.<span class="hljs-title function_">showLoading</span>();
                uni.<span class="hljs-title function_">login</span>({
                    <span class="hljs-comment">//获取登录凭证</span>
                    <span class="hljs-attr">success</span>: <span class="hljs-function">(<span class="hljs-params">{ code }</span>) =&gt;</span> {
                        <span class="hljs-keyword">if</span> (code) {
                            <span class="hljs-keyword">let</span> url = <span class="hljs-string">""</span>;
                            <span class="hljs-comment">// #ifdef MP-WEIXIN</span>
                            url = <span class="hljs-string">"/auth/getOpenId"</span>;
                            <span class="hljs-comment">// #endif</span>
                            <span class="hljs-comment">// #ifdef MP-ALIPAY</span>
                            url = <span class="hljs-string">"/auth/getAliPayUserId"</span>;
                            <span class="hljs-comment">// #endif</span>
                            <span class="hljs-comment">//获取 openid</span>
                            <span class="hljs-variable language_">this</span>.<span class="hljs-property">$http</span>.<span class="hljs-title function_">post</span>(url, {
                                <span class="hljs-attr">code</span>: code.<span class="hljs-title function_">split</span>(<span class="hljs-string">"&amp;"</span>)[<span class="hljs-number">0</span>],
                            }).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
                                uni.<span class="hljs-title function_">hideLoading</span>();
                                <span class="hljs-title function_">resolve</span>(res)
                            }).<span class="hljs-keyword">catch</span>(<span class="hljs-function">() =&gt;</span> {
                                uni.<span class="hljs-title function_">hideLoading</span>();
                                <span class="hljs-title function_">reject</span>()
                            });
                        }
                    },
                    <span class="hljs-title function_">fail</span>(<span class="hljs-params">err</span>) {
                        uni.<span class="hljs-title function_">hideLoading</span>();
                        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"uni.login失败"</span>, err);
                        <span class="hljs-title function_">reject</span>(err)
                    },
                });
            })
        },
        <span class="hljs-comment">// 立克办用户单点登录</span>
        <span class="hljs-title function_">likeBanLogin</span>(<span class="hljs-params"/>){
            <span class="hljs-keyword">const</span> extraToken = <span class="hljs-variable language_">this</span>.<span class="hljs-property">$store</span>.<span class="hljs-property">getters</span>.<span class="hljs-property">extraData</span>?.<span class="hljs-property">token</span>;
            <span class="hljs-keyword">if</span>(extraToken){
                <span class="hljs-variable language_">this</span>.$set(<span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>,<span class="hljs-string">'token'</span>,extraToken)
                uni.<span class="hljs-title function_">setStorageSync</span>(<span class="hljs-string">"lkbToken"</span>,extraToken);
            }
            <span class="hljs-comment">// 这里的query.platformOpenId最终没用到，最先从商城跳转回来使用的 wx.miniProgram.switchTab,</span>
            <span class="hljs-comment">// 实际测试发现无法带参跳转，改为 wx.miniProgram.redirectTo 跳转回小程序中转页 pages/lkb/main.vue 后，</span>
            <span class="hljs-comment">// 已经将 platformOpenId 参数设置在了Storage中（可查看后面的代码）</span>
            <span class="hljs-comment">//let platformOpenId = this.query.platformOpenId || uni.getStorageSync("platformOpenId"); </span>
            <span class="hljs-keyword">let</span> platformOpenId = uni.<span class="hljs-title function_">getStorageSync</span>(<span class="hljs-string">"platformOpenId"</span>);
            <span class="hljs-keyword">if</span> (!platformOpenId) {
                <span class="hljs-comment">// let url = `${process.env.VUE_APP_H5_HOST}/yytour/wechat/mp-auth?source=${process.env.VUE_APP_SOURCE}&amp;lkbToken=${extraToken}`;</span>
                <span class="hljs-keyword">let</span> url = <span class="hljs-string">`<span class="hljs-subst">${process.env.VUE_APP_H5_HOST}</span>/yytour/wechat/mp-auth?source=<span class="hljs-subst">${process.env.VUE_APP_SOURCE}</span>`</span>;
                uni.<span class="hljs-title function_">redirectTo</span>({
                        <span class="hljs-attr">url</span>: <span class="hljs-string">`/pages/webView/main?url=<span class="hljs-subst">${<span class="hljs-built_in">encodeURIComponent</span>(url)}</span>`</span>,
                });
                <span class="hljs-keyword">return</span> 
            } 

            !uni.<span class="hljs-title function_">getStorageSync</span>(<span class="hljs-string">"platformOpenId"</span>) &amp;&amp; uni.<span class="hljs-title function_">setStorageSync</span>(<span class="hljs-string">"platformOpenId"</span>, platformOpenId);
            <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">lkbLoading</span>){
                <span class="hljs-keyword">return</span> 
            }
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">lkbLoading</span> = <span class="hljs-literal">true</span>;
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getOpenId</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>)=&gt;</span>{
                <span class="hljs-keyword">const</span> data = res.<span class="hljs-property">data</span>
                <span class="hljs-comment">// #ifdef MP-WEIXIN</span>
                uni.<span class="hljs-title function_">setStorageSync</span>(<span class="hljs-string">"openid"</span>, data.<span class="hljs-property">openId</span>);
                <span class="hljs-comment">// #endif</span>
                <span class="hljs-comment">// #ifdef MP-ALIPAY</span>
                uni.<span class="hljs-title function_">setStorageSync</span>(<span class="hljs-string">"aliPayUserId"</span>, data.<span class="hljs-property">aliPayUserId</span>);
                <span class="hljs-comment">// #endif</span>
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">$store</span>.<span class="hljs-title function_">commit</span>(<span class="hljs-string">"updateUserInfo"</span>, data);
                <span class="hljs-keyword">let</span> storageLkbToken = extraToken || <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>.<span class="hljs-property">token</span> || uni.<span class="hljs-title function_">getStorageSync</span>(<span class="hljs-string">"lkbToken"</span>)
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">$http</span>.<span class="hljs-title function_">post</span>(<span class="hljs-string">"/auth/miniLoginOfLiKeBan"</span>, {
                    <span class="hljs-attr">openId</span>: data.<span class="hljs-property">openId</span>,
                    <span class="hljs-attr">platformOpenId</span>: data.<span class="hljs-property">platformOpenId</span> || uni.<span class="hljs-title function_">getStorageSync</span>(<span class="hljs-string">"platformOpenId"</span>),
                    liKeBanEncryptToken : storageLkbToken
                })
                .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$store</span>.<span class="hljs-title function_">commit</span>(<span class="hljs-string">"updateUserInfo"</span>, res.<span class="hljs-property">data</span>);
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$store</span>.<span class="hljs-title function_">commit</span>(<span class="hljs-string">"setToken"</span>, res.<span class="hljs-property">data</span>.<span class="hljs-property">token</span>);
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$store</span>.<span class="hljs-title function_">commit</span>(<span class="hljs-string">"setShopToken"</span>, res.<span class="hljs-property">data</span>.<span class="hljs-property">merchantToken</span>);
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">lkbLoading</span> = <span class="hljs-literal">false</span>;
                    <span class="hljs-variable language_">this</span>.$nextTick(<span class="hljs-function">()=&gt;</span>{
                        <span class="hljs-comment">//this.autoMarketing()</span>
                    })
                }).<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">res</span>)=&gt;</span>{
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">lkbLoading</span> = <span class="hljs-literal">false</span>;
                    <span class="hljs-keyword">if</span> (res.<span class="hljs-property">errorCode</span> === <span class="hljs-string">'00012'</span>) {
                        <span class="hljs-keyword">let</span> timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">()=&gt;</span>{
                            uni.<span class="hljs-title function_">navigateTo</span>({
                                <span class="hljs-attr">url</span>: <span class="hljs-string">`/pages/login/main?redirect=true`</span> 
                            })
                            <span class="hljs-built_in">clearTimeout</span>(timer)
                        },<span class="hljs-number">1500</span>)
                    }
                    <span class="hljs-comment">// $http 中已经做提示，这里就不再重复写了</span>
                    <span class="hljs-comment">// else{</span>
                            <span class="hljs-comment">// uni.showToast({ title: res.message, icon: 'none' })</span>
                    <span class="hljs-comment">// }</span>
                });
            })
        },
    }
}
</code></pre>
<p>上面<code>likeBanLogin</code>方法中有一段代码，</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">let</span> platformOpenId = <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>.<span class="hljs-property">platformOpenId</span> || uni.<span class="hljs-title function_">getStorageSync</span>(<span class="hljs-string">"platformOpenId"</span>);
<span class="hljs-comment">// console.log('---likeBanLogin---platformOpenId---',platformOpenId)</span>
<span class="hljs-keyword">if</span> (!platformOpenId) {
    <span class="hljs-comment">// console.log('---likeBanLogin---!platformOpenId---')</span>
    <span class="hljs-keyword">let</span> url = <span class="hljs-string">`<span class="hljs-subst">${process.env.VUE_APP_H5_HOST}</span>/yytour/wechat/mp-auth?source=<span class="hljs-subst">${process.env.VUE_APP_SOURCE}</span>&amp;lkbToken=<span class="hljs-subst">${extraToken}</span>`</span>;
    uni.<span class="hljs-title function_">redirectTo</span>({
        <span class="hljs-attr">url</span>: <span class="hljs-string">`/pages/webView/main?url=<span class="hljs-subst">${<span class="hljs-built_in">encodeURIComponent</span>(url)}</span>`</span>,
    });
    <span class="hljs-keyword">return</span> 
} 
</code></pre>
<p>这是我们从商城获取登录接口的必填参数<code>platformOpenId</code>,商城前端用的是H5开发的，具体为啥要获取这个参数，这是这个项目的一些后台逻辑需要，我们没必要去纠结这个问题。</p>
<p>商城H5页面 pages/mp-auth/index.vue</p>
<pre><code class="hljs language-js" lang="js">    <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
        <span class="hljs-title function_">created</span>(<span class="hljs-params"/>) {
          <span class="hljs-keyword">if</span> (!code) {
            <span class="hljs-variable language_">this</span>.$toAuthUrl() <span class="hljs-comment">// 去授权 获取code</span>
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// 已获取code, 进行登录.</span>
            <span class="hljs-keyword">let</span> newMchId = (source == <span class="hljs-number">1</span> || source == <span class="hljs-number">0</span> || !source) ? mchId : -<span class="hljs-number">1</span>
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">$http</span>.<span class="hljs-title function_">post</span>(<span class="hljs-string">'merchant/mch-user/userInfoByCode'</span>, {
              code,
              <span class="hljs-attr">mchId</span>: newMchId
            }).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">{ data }</span>) =&gt;</span> {
              <span class="hljs-keyword">if</span> (!data) {
                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'登录接口出错, data为空'</span>)
                <span class="hljs-keyword">return</span>
              }
              <span class="hljs-comment">// 立克办登录处理逻辑</span>
              <span class="hljs-keyword">if</span>(lkbToken){
                <span class="hljs-comment">// switchTab 无法带参数跳转,使用一个中转页面`/pages/lkb/main`接收参数并处理相应逻辑，然后从中转页面跳转首页`/pages/index/main`</span>
                <span class="hljs-comment">// wx.miniProgram.switchTab({</span>
                <span class="hljs-comment">//   url: `/pages/index/main?platformOpenId=${data.platformOpenId}&amp;token=${lkbToken}`</span>
                <span class="hljs-comment">// })</span>
                wx.<span class="hljs-property">miniProgram</span>.<span class="hljs-title function_">redirectTo</span>({
                  <span class="hljs-attr">url</span>: <span class="hljs-string">`/pages/lkb/main?platformOpenId=<span class="hljs-subst">${data.platformOpenId}</span>&amp;token=<span class="hljs-subst">${lkbToken}</span>`</span>
                })
              }<span class="hljs-keyword">else</span>{
                wx.<span class="hljs-property">miniProgram</span>.<span class="hljs-title function_">redirectTo</span>({
                  <span class="hljs-attr">url</span>: <span class="hljs-string">`/pages/login/main?platformOpenId=<span class="hljs-subst">${data.platformOpenId}</span>&amp;redirect=<span class="hljs-subst">${redirect}</span>`</span>
                })
              }
            })
          }
        }
    }
</code></pre>
<p>本来登录前从小程序跳转到商城这个页面获取到参数后就可以直接返回小程序首页的，可要返回的小程序页面是tab首页，<code>wx.miniProgram.switchTab</code>的url中无法传递query参数，我只好使用<code>wx.miniProgram.redirectTo</code>，又特意在小程序中建了一个页面文件 <code>pages/lkb/main.vue</code>，用于在小程序中接收从商城H5获取到的登录接口参数<code>platformOpenId</code>。</p>
<p>小程序 pages/lkb/main.vue</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
    <span class="hljs-title function_">onLoad</span>(<span class="hljs-params">opts</span>) {
        <span class="hljs-keyword">let</span> { platformOpenId, token } = opts;
        uni.<span class="hljs-title function_">setStorageSync</span>(<span class="hljs-string">"platformOpenId"</span>, platformOpenId);
        <span class="hljs-comment">//token &amp;&amp; uni.setStorageSync("lkbToken", token);</span>
        <span class="hljs-variable language_">this</span>.$nextTick(<span class="hljs-function">() =&gt;</span> {
            uni.<span class="hljs-title function_">switchTab</span>({
                <span class="hljs-attr">url</span>: <span class="hljs-string">"/pages/index/main"</span>
            });
        });
    },
};
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[插槽(Slots)（完整详细版）]]></title>    <link>https://juejin.cn/post/7583981974408445962</link>    <guid>https://juejin.cn/post/7583981974408445962</guid>    <pubDate>2025-12-16T03:13:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583981974408445962" data-draft-id="7582528397866123291" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="插槽(Slots)（完整详细版）"/> <meta itemprop="keywords" content="前端,Vue.js"/> <meta itemprop="datePublished" content="2025-12-16T03:13:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="nnnnna"/> <meta itemprop="url" content="https://juejin.cn/user/248908298065256"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            插槽(Slots)（完整详细版）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/248908298065256/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    nnnnna
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T03:13:40.000Z" title="Tue Dec 16 2025 03:13:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、匿名插槽</h2>
<h3 data-id="heading-1">1.适用场景</h3>
<p>子组件中只有一个位置允许父组件自定义内容</p>
<h3 data-id="heading-2">2.使用方法</h3>
<p>第一步：在子组件中定义slot插槽</p>
<pre><code class="hljs language-子组件" lang="子组件">&lt;template&gt;
  &lt;div&gt;
    &lt;header&gt;头部&lt;/header&gt;
    &lt;slot&gt;&lt;/slot&gt;
    &lt;footer&gt;尾部&lt;/footer&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<p>第二步：在父组件中的子组件标签内直接填写需要插入的内容</p>
<pre><code class="hljs language-父组件" lang="父组件">&lt;template&gt;
  &lt;div&gt;
    &lt;TestComOne&gt;
      &lt;p&gt;插入的新内容&lt;/p&gt;
    &lt;/TestComOne&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<p>最终在子组件渲染出来的结果：</p>
<pre><code class="hljs language-渲染" lang="渲染">&lt;template&gt;
  &lt;div&gt;
    &lt;header&gt;头部&lt;/header&gt;
    &lt;p&gt;插入的新内容&lt;/p&gt;
    &lt;footer&gt;尾部&lt;/footer&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<p>当父组件中没有提供插槽内容时，我们也可以给子组件的插槽中添加默认内容</p>
<pre><code class="hljs language-添加默认内容" lang="添加默认内容">&lt;template&gt;
  &lt;div&gt;
    &lt;header&gt;头部&lt;/header&gt;
    &lt;slot&gt;默认内容&lt;/slot&gt;
    &lt;footer&gt;尾部&lt;/footer&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<p>最终在子组件渲染出来的结果：</p>
<pre><code class="hljs language-渲染" lang="渲染">&lt;template&gt;
  &lt;div&gt;
    &lt;header&gt;头部&lt;/header&gt;
    默认内容
    &lt;footer&gt;尾部&lt;/footer&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<h2 data-id="heading-3">二、具名插槽</h2>
<h3 data-id="heading-4">1.适用场景</h3>
<p>子组件中有多个位置允许父组件自定义内容</p>
<h3 data-id="heading-5">2.使用方法</h3>
<p>第一步：在子组件中定义多个slot插槽，并且为每个插槽添加一个特殊的attribute <code>name</code></p>
<pre><code class="hljs language-多个插槽" lang="多个插槽">&lt;template&gt;
  &lt;div&gt;
    &lt;slot name="slotTop"&gt;&lt;/slot&gt;
    &lt;header&gt;头部&lt;/header&gt;
    &lt;slot name="slotContent"&gt;&lt;/slot&gt;
    &lt;footer&gt;尾部&lt;/footer&gt;
    &lt;slot name="slotBottom"&gt;&lt;/slot&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<p>第二步：在父组件中使用对应的插槽名</p>
<pre><code class="hljs language-父组件中使用多个插槽" lang="父组件中使用多个插槽">&lt;template&gt;
  &lt;div&gt;
    &lt;TestComOne&gt;
      &lt;template #slotTop&gt;头部上面&lt;/template&gt;
      &lt;template #slotContent&gt;中间&lt;/template&gt;
      &lt;template #slotBottom&gt;尾部下面&lt;/template&gt;
    &lt;/TestComOne&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<h2 data-id="heading-6">三、作用域插槽</h2>
<h3 data-id="heading-7">1.为什么要使用作用域插槽</h3>
<p>在某些场景下，我们想要插槽的内容使用到子组件域内的数据，这时候就需要用到插槽</p>
<h3 data-id="heading-8">2.使用方法</h3>
<p>第一步：在子组件中，可以像组件传递props那样，向一个插槽slot传递<code>attributes</code></p>
<pre><code class="hljs language-子组件添加attributes" lang="子组件添加attributes">&lt;template&gt;
  &lt;div&gt;
    &lt;slot name="slotTop"&gt;&lt;/slot&gt;
    &lt;header&gt;头部&lt;/header&gt;
    &lt;slot name="slotContent" height="180" :list="list"&gt;&lt;/slot&gt;
    &lt;footer&gt;尾部&lt;/footer&gt;
    &lt;slot name="slotBottom"&gt;&lt;/slot&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import { ref } from "vue";
const list = ref({ name: "张三", old: 18 });
&lt;/script&gt;
</code></pre>
<p>第二步：在父组件中使用解构赋值，拿到对应的值</p>
<pre><code class="hljs language-父组件中使用" lang="父组件中使用">&lt;template&gt;
  &lt;div&gt;
    &lt;TestComOne&gt;
      &lt;template #slotContent="{ height, list }"&gt;
        &lt;p&gt;身高：{{ height }}&lt;/p&gt;
        &lt;p&gt;姓名：{{ list.name }}&lt;/p&gt;
        &lt;p&gt;年龄：{{ list.old }}&lt;/p&gt;
      &lt;/template&gt;
    &lt;/TestComOne&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import TestComOne from "./components/index.vue";
&lt;/script&gt;
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[手把手教你用 RAG 打造专属知识库问答系统]]></title>    <link>https://juejin.cn/post/7583921477614239779</link>    <guid>https://juejin.cn/post/7583921477614239779</guid>    <pubDate>2025-12-16T02:15:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583921477614239779" data-draft-id="7583955708317990912" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="手把手教你用 RAG 打造专属知识库问答系统"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-16T02:15:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="星浩AI"/> <meta itemprop="url" content="https://juejin.cn/user/2904236059009760"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            手把手教你用 RAG 打造专属知识库问答系统
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2904236059009760/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    星浩AI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:15:17.000Z" title="Tue Dec 16 2025 02:15:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读18分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">目录</h2>
<ol>
<li><a href="#%E4%B8%80rag%E7%AE%80%E4%BB%8B" title="#%E4%B8%80rag%E7%AE%80%E4%BB%8B">一、RAG简介</a></li>
<li><a href="#%E4%BA%8Cembedding%E6%A8%A1%E5%9E%8B%E9%80%89%E6%8B%A9" title="#%E4%BA%8Cembedding%E6%A8%A1%E5%9E%8B%E9%80%89%E6%8B%A9">二、Embedding模型选择</a></li>
<li><a href="#%E4%B8%89rag%E5%AE%9E%E6%88%98" title="#%E4%B8%89rag%E5%AE%9E%E6%88%98">三、RAG实战</a></li>
<li><a href="#%E5%9B%9Blangchain%E4%B8%AD%E7%9A%84%E9%97%AE%E7%AD%94%E9%93%BE" title="#%E5%9B%9Blangchain%E4%B8%AD%E7%9A%84%E9%97%AE%E7%AD%94%E9%93%BE">四、LangChain中的问答链</a></li>
<li><a href="#%E4%BA%94%E5%A6%82%E6%9E%9Cllm%E5%8F%AF%E4%BB%A5%E5%A4%84%E7%90%86%E6%97%A0%E9%99%90%E4%B8%8A%E4%B8%8B%E6%96%87rag%E8%BF%98%E6%9C%89%E6%84%8F%E4%B9%89%E5%90%97" title="#%E4%BA%94%E5%A6%82%E6%9E%9Cllm%E5%8F%AF%E4%BB%A5%E5%A4%84%E7%90%86%E6%97%A0%E9%99%90%E4%B8%8A%E4%B8%8B%E6%96%87rag%E8%BF%98%E6%9C%89%E6%84%8F%E4%B9%89%E5%90%97">五、如果LLM可以处理无限上下文，RAG还有意义吗？</a></li>
</ol>
<hr/>
<p>大模型能力强大，却受限于静态知识库，还容易"一本正经地胡说八道"。RAG（检索增强生成）正是破局关键！本文深入浅出讲解 RAG 的核心原理——通过实时检索外部知识库，为生成模型注入最新、最准的上下文信息，显著提升回答的准确性、专业性与可解释性。</p>
<p>带你<strong>从零搭建本地 RAG 系统</strong>：使用 PyPDF2 解析 PDF、DashScope 嵌入模型向量化、Faiss 构建高效检索库，并通过 LangChain 调用 DeepSeek 大模型实现智能问答。全流程覆盖数据预处理、索引构建到问答生成，附关键技术细节与工程实践建议。</p>
<p>无论你是开发者、AI 爱好者，还是企业技术决策者，这篇干货都能帮你快速掌握 RAG 落地的核心能力！</p>
<hr/>
<h2 data-id="heading-1">一、RAG简介</h2>
<h3 data-id="heading-2">1. 什么是RAG？</h3>
<p><strong>RAG（Retrieval-Augmented Generation）：</strong></p>
<p>检索增强生成，是一种结合信息检索（Retrieval）和文本生成（Generation）的技术。</p>
<p>RAG技术通过实时检索相关文档或信息，并将其作为上下文输入到生成模型中，从而提高生成结果的时效性和准确性。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7093c10b77e6404a916a6c430d91a3d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pif5rWpQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456117&amp;x-signature=z4ypXr30oYGdWzQ2QSYHs%2B6IN8g%3D" alt="img_1.jpg" loading="lazy"/></p>
<h3 data-id="heading-3">2. RAG的优势是什么？</h3>
<ul>
<li>
<p><strong>解决知识时效性问题</strong><br/>
大模型的训练数据通常是静态的，无法涵盖最新信息，而RAG可以检索外部知识库实时更新信息。</p>
</li>
<li>
<p><strong>减少模型幻觉</strong><br/>
通过引入外部知识，RAG能够减少模型生成虚假或不准确内容的可能性。</p>
</li>
<li>
<p><strong>提升专业领域回答质量</strong><br/>
RAG能够结合垂直领域的专业知识库，生成更具专业深度的回答。</p>
</li>
<li>
<p><strong>生成内容的溯源（可解释性）</strong></p>
</li>
</ul>
<h3 data-id="heading-4">3. RAG 的核心原理与流程</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f2f0580e6cf4700ab79c85d5b1b9044~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pif5rWpQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456117&amp;x-signature=Ug3S4qdCTYRUyEKs4IyOTfdDoKQ%3D" alt="img_2.jpg" loading="lazy"/></p>
<p><strong>步骤1：数据预处理，构建索引库</strong></p>
<ul>
<li>
<p><strong>知识库构建：</strong><br/>
收集并整理文档、网页、数据库等多源数据，构建外部知识库。</p>
</li>
<li>
<p><strong>文档分块：</strong><br/>
将文档切分为适当大小的片段（chunks），以便后续检索。分块策略需要在语义完整性与检索效率之间取得平衡。</p>
</li>
<li>
<p><strong>向量化处理</strong><br/>
使用嵌入模型（如BGE、M3E、ChineseAlpaca2等）将文本块转换为向量，并存储在向量数据库中</p>
</li>
</ul>
<p><strong>步骤2：检索阶段</strong></p>
<ul>
<li>
<p><strong>查询处理</strong><br/>
将用户输入的问题转换为向量，并在向量数据库中进行相似度检索，找到最相关的文本片段。</p>
</li>
<li>
<p><strong>重排序</strong><br/>
对检索结果进行相关性排序，选择最相关的片段作为生成阶段的输入。</p>
</li>
</ul>
<p><strong>步骤3：生成阶段</strong></p>
<ul>
<li>
<p><strong>上下文组装</strong><br/>
将检索到的相关文档片段与用户问题组合，形成完整的上下文。</p>
</li>
<li>
<p><strong>生成回答</strong><br/>
将组合后的上下文输入到生成模型中，生成最终答案。</p>
</li>
</ul>
<blockquote>
<p>💡 <strong>划重点：</strong> RAG本质上就是重构了一个新的 Prompt！</p>
</blockquote>
<h3 data-id="heading-5">4. NativeRAG</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd85c5e7c0564c34aaab273dd0827abf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pif5rWpQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456117&amp;x-signature=CzjtYuAkXR%2B77qgf41tTqlo%2Fauk%3D" alt="img_3.jpg" loading="lazy"/></p>
<p><strong>NativeRAG的步骤：</strong></p>
<ul>
<li>
<p><strong>Indexing</strong><br/>
如何更好地把知识存起来。</p>
</li>
<li>
<p><strong>Retrieval</strong><br/>
如何在大量的知识中，找到一小部分有用的，给到模型参考。</p>
</li>
<li>
<p><strong>Generation</strong><br/>
如何结合用户的提问和检索到的知识，让模型生成有用的答案。</p>
</li>
</ul>
<blockquote>
<p>⚠️ <strong>提示：</strong> 上面三个步骤虽然看似简单，但在 RAG 应用从构建到落地实施的整个过程中，涉及较多复杂的工作内容！</p>
</blockquote>
<h3 data-id="heading-6">5. Prompt vs RAG vs Fine-tuning 什么时候使用？</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/49706febc28c4892ab83c9645f8ed214~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pif5rWpQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456117&amp;x-signature=Bg%2FishuklGgWouRk0MhUi4u45Eo%3D" alt="img_4.jpg" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-7">二、Embedding模型选择</h2>
<h3 data-id="heading-8">1. 通用文本嵌入模型</h3>
<p><strong>BGE-M3（智源研究院）</strong></p>
<ul>
<li><strong>特点：</strong> 支持100+语言，输入长度达8192tokens，融合密集、稀疏、多向量混合检索，适合跨语言长文档检索。</li>
<li><strong>适用场景：</strong> 跨语言长文档检索、高精度RAG应用。</li>
<li><strong>文件大小：</strong> 2.3G</li>
</ul>
<p><strong>text-embedding-3-large（OpenAI）</strong></p>
<ul>
<li><strong>特点：</strong> 向量维度3072维，长文本语义捕捉能力强，英文表现优秀。</li>
<li><strong>适用场景：</strong> 英文内容优先的全球化应用。</li>
</ul>
<p><strong>jina-embedding-v2-small（Jina AI）</strong></p>
<ul>
<li><strong>特点：</strong> 参数量仅35M，支持实时推理（RT&lt;50ms），适合轻量化部署。</li>
<li><strong>适用场景：</strong> 轻量级文本处理、实时推理任务。</li>
</ul>
<h3 data-id="heading-9">2. 中文嵌入模型</h3>
<p><strong>M3E-Base</strong></p>
<ul>
<li><strong>特点：</strong> 针对中文优化的轻量模型，适合本地化部署。</li>
<li><strong>适用场景：</strong> 中文法律、医疗领域检索任务。</li>
<li><strong>文件大小：</strong> 0.4G</li>
</ul>
<p><strong>xiaobu-embedding-v2</strong></p>
<ul>
<li><strong>特点：</strong> 针对中文语义优化，语义理解能力强。</li>
<li><strong>适用场景：</strong> 中文文本分类、语义检索。</li>
</ul>
<p><strong>stella-mrl-large-zh-v3.5-1792</strong></p>
<ul>
<li><strong>特点：</strong> 处理大规模中文数据能力强，捕捉细微语义关系。</li>
<li><strong>适用场景：</strong> 中文文本高级语义分析、自然语言处理任务。</li>
</ul>
<h3 data-id="heading-10">3. 指令驱动与复杂任务模型</h3>
<p><strong>gte-Qwen2-7B-instruct（阿里巴巴）</strong></p>
<ul>
<li><strong>特点：</strong> 基于Qwen大模型微调，支持代码与文本跨模态检索。</li>
<li><strong>适用场景：</strong> 复杂指令驱动任务、智能问答系统。</li>
</ul>
<p><strong>E5-mistral-7B（Microsoft）</strong></p>
<ul>
<li><strong>特点：</strong> 基于Microsoft架构，Zero-shot任务表现优异。</li>
<li><strong>适用场景：</strong> 动态调整语义密度的复杂系统。</li>
</ul>
<h3 data-id="heading-11">4. 企业级与复杂系统</h3>
<p><strong>BGE-M3（智源研究院）</strong></p>
<ul>
<li><strong>特点：</strong> 适合企业级部署，支持混合检索。</li>
<li><strong>适用场景：</strong> 企业级语义检索、复杂RAG应用。</li>
</ul>
<p><strong>E5-mistral-7B（Microsoft）</strong></p>
<ul>
<li><strong>特点：</strong> 适合企业级部署，支持指令微调。</li>
<li><strong>适用场景：</strong> 需要动态调整语义密度的复杂系统。</li>
</ul>
<h3 data-id="heading-12">5. CASE-BGE-M3使用</h3>
<p><strong>模型下载</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> FlagEmbedding <span class="hljs-keyword">import</span> BGEM3FlagModel
model = BGEM3FlagModel(<span class="hljs-string">'/root/models/BAAI/bge-m3'</span>,
                       use_fp16=<span class="hljs-literal">True</span>)
</code></pre>
<p><strong>示例代码</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> FlagEmbedding <span class="hljs-keyword">import</span> BGEM3FlagModel
model = BGEM3FlagModel(<span class="hljs-string">'/root/models/BAAI/bge-m3'</span>,
                       use_fp16=<span class="hljs-literal">True</span>)
sentences_1 = [<span class="hljs-string">"什么是 BGE M3？"</span>, <span class="hljs-string">"BM25 的定义"</span>]
sentences_2 = [<span class="hljs-string">"BGE M3 是一种嵌入模型，支持稠密检索、词汇匹配和多向量交互。"</span>,
               <span class="hljs-string">"BM25 是一种基于词袋的检索函数，根据查询词在每个文档中出现的情况对文档集合进行排序。"</span>]
embeddings_1 = model.encode(sentences_1,
                            batch_size=<span class="hljs-number">12</span>,
                            max_length=<span class="hljs-number">8192</span>,  <span class="hljs-comment"># 如果不需要这么长的长度，可以设置一个较小的值以加快编码速度。</span>
                            )[<span class="hljs-string">'dense_vecs'</span>]
embeddings_2 = model.encode(sentences_2)[<span class="hljs-string">'dense_vecs'</span>]
similarity = embeddings_1 @ embeddings_2.T
<span class="hljs-built_in">print</span>(similarity)
<span class="hljs-comment"># [[0.6265, 0.3477], [0.3499, 0.678 ]]</span>
</code></pre>
<p><strong>代码解释</strong></p>
<ul>
<li>
<p><code>similarity = embeddings_1 @ embeddings_2.T</code><br/>
计算两组嵌入向量（embeddings）之间的相似度矩阵。<br/>
<code>embeddings_1</code>包含了第一组句子(sentences_1)的嵌入向量，形状为[sentences_1的数量，嵌入维度]<br/>
<code>embeddings_2</code>包含了第二组句子(sentences_2)的嵌入向量，形状为[sentences_2的数量，嵌入维度]<br/>
<code>embeddings_2.T</code>是对embeddings_2进行转置操作，形态变为[嵌入维度，sentences_2的数量]</p>
</li>
<li>
<p><code>@</code>符号在Python中表示矩阵乘法运算<br/>
通过矩阵乘法计算了两组句子之间的余弦相似度矩阵。结果similarity形状是[sentences_1的数量，sentences_2的数量]</p>
</li>
</ul>
<h3 data-id="heading-13">6. gte-qwen2使用</h3>
<p><strong>模型下载</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> sentence_transformers <span class="hljs-keyword">import</span> SentenceTransformer
model_dir = <span class="hljs-string">"/root/models/iic/gte_Qwen2-1___5B-instruct"</span>
model = SentenceTransformer(model_dir, trust_remote_code=<span class="hljs-literal">True</span>)
</code></pre>
<p><strong>示例代码</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> sentence_transformers <span class="hljs-keyword">import</span> SentenceTransformer
model_dir = <span class="hljs-string">"/root/models/iic/gte_Qwen2-1___5B-instruct"</span>
model = SentenceTransformer(model_dir, trust_remote_code=<span class="hljs-literal">True</span>)
model.max_seq_length = <span class="hljs-number">8192</span>
queries = [    <span class="hljs-string">"女性每天应该摄入多少蛋白质？"</span>,    <span class="hljs-string">""</span>summit<span class="hljs-string">"的定义是什么？"</span>,]
documents = [    <span class="hljs-string">"根据一般指南，美国疾控中心（CDC）建议19至70岁女性每日平均蛋白质摄入量为46克。但如下面图表所示，如果你正在备孕或备战马拉松，就需要增加摄入量。请查看下方图表，了解你每天应摄入多少蛋白质。"</span>,    <span class="hljs-string">""</span>summit<span class="hljs-string">"对英语学习者的定义：1. 山的最高点；山顶。2. 最高水平。3. 两个或多个国家领导人之间的会议或系列会议。"</span>,]
document_embeddings = model.encode(documents)
<span class="hljs-built_in">print</span>(scores.tolist())
</code></pre>
<hr/>
<h2 data-id="heading-14">三、RAG实战</h2>
<p>基于LangChain，采用DeepSeek+Faiss快速搭建本地知识库检索。</p>
<h3 data-id="heading-15">3.1 环境准备</h3>
<ol>
<li>
<p>本地安装好Conda环境</p>
</li>
<li>
<p>推荐使用阿里大模型平台百炼：<br/>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fbailian.console.aliyun.com%2F" target="_blank" title="https://bailian.console.aliyun.com/" ref="nofollow noopener noreferrer">bailian.console.aliyun.com/</a></p>
</li>
<li>
<p>百炼平台使用：注册登录、申请api key。</p>
</li>
</ol>
<h3 data-id="heading-16">3.2 技术选型</h3>
<ul>
<li><strong>向量数据库：</strong> Faiss作为高效的向量检索</li>
<li><strong>嵌入模型：</strong> 阿里云DashScope的text-embedding-v1</li>
<li><strong>大语言模型：</strong> deepseek-v3</li>
<li><strong>文档处理：</strong> PyPDF2用于PDF文本提取</li>
</ul>
<h3 data-id="heading-17">3.3 程序逻辑结构介绍</h3>
<p><strong>步骤1：文档预处理</strong></p>
<p>PDF文件 → 文本提取 → 文本分割 → 页码映射</p>
<p><strong>1) PDF文本提取</strong></p>
<ul>
<li>逐页提取文本内容</li>
<li>记录每行文本对应的页码信息</li>
<li>处理空页和异常情况</li>
</ul>
<p><strong>2）文本分割策略</strong></p>
<ul>
<li>使用递归字符分割器</li>
<li>分割参数：<code>chunk_size=1000</code>, <code>chunk_overlap=200</code></li>
<li>分割优先级：段落 → 句子 → 空格 → 字符</li>
</ul>
<p><strong>3）页面映射处理</strong></p>
<ul>
<li>基于字符位置计算每个文本块的页面</li>
<li>使用众数统计确定文本块的主要来源页码</li>
<li>建立文本块与页码的映射关系</li>
</ul>
<p><strong>步骤2：知识库构建</strong></p>
<p>文本块 → 嵌入向量 → Faiss索引 → 本地持久化</p>
<p><strong>1）向量数据库构建</strong></p>
<ul>
<li>使用DashScope嵌入模型生成向量</li>
<li>将向量存储到Faiss索引结构</li>
</ul>
<p><strong>2）数据持久化</strong></p>
<ul>
<li>保存Faiss索引文件（.faiss）</li>
<li>保存元数据信息（.pkl）</li>
<li>保存页码映射关系（page_info.pkl）</li>
</ul>
<p><strong>步骤3：问答查询</strong></p>
<p>用户问题 → 向量检索 → 文档组合 → LLM生成 → 答案输出</p>
<p><strong>1）相似度检索</strong></p>
<ul>
<li>将用户问题转换为向量</li>
<li>在Faiss中搜索最相似的文档块，返回Top-K相关文档</li>
</ul>
<p><strong>2）问答链处理</strong></p>
<ul>
<li>使用LangChain的<code>load_qa_chain</code></li>
<li>采用stuff策略组合文档</li>
<li>将组合后的上下文和问题发送给LLM</li>
</ul>
<p><strong>3）答案生成与展示</strong></p>
<h3 data-id="heading-18">3.4 代码实例</h3>
<p><strong>安装依赖的包</strong></p>
<pre><code class="hljs language-bash" lang="bash">!pip install pypdf2
!pip install dashscope
!pip install langchain
!pip install langchain-openai
!pip install langchain-community
!pip install faiss-cpu
</code></pre>
<p><strong>导入依赖的包</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> PyPDF2 <span class="hljs-keyword">import</span> PdfReader
<span class="hljs-keyword">from</span> langchain.chains.question_answering <span class="hljs-keyword">import</span> load_qa_chain
<span class="hljs-keyword">from</span> langchain.text_splitter <span class="hljs-keyword">import</span> RecursiveCharacterTextSplitter
<span class="hljs-keyword">from</span> langchain_community.embeddings <span class="hljs-keyword">import</span> DashScopeEmbeddings
<span class="hljs-keyword">from</span> langchain_community.vectorstores <span class="hljs-keyword">import</span> FAISS
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>, <span class="hljs-type">Tuple</span>
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> pickle
</code></pre>
<p><strong>从PDF中提取文本并记录每个字符对应的页码</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_text_with_page_numbers</span>(<span class="hljs-params">pdf</span>) -&gt; <span class="hljs-type">Tuple</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">List</span>[<span class="hljs-type">Tuple</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">int</span>]]]:
    <span class="hljs-string">"""
    从PDF中提取文本并记录每个字符对应的页码
    参数:
        pdf: PDF文件对象
    返回:
        text: 提取的文本内容
        char_page_mapping: 每个字符对应的页码列表
    """</span>
    text = <span class="hljs-string">""</span>
    char_page_mapping = []
    <span class="hljs-keyword">for</span> page_number, page <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(pdf.pages, start=<span class="hljs-number">1</span>):
        extracted_text = page.extract_text()
        <span class="hljs-keyword">if</span> extracted_text:
            text += extracted_text
            <span class="hljs-comment"># 为当前页面的每个字符记录页码</span>
            char_page_mapping.extend([page_number] * <span class="hljs-built_in">len</span>(extracted_text))
        <span class="hljs-keyword">else</span>:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"No text found on page <span class="hljs-subst">{page_number}</span>."</span>)
    <span class="hljs-keyword">return</span> text, char_page_mapping
</code></pre>
<p><strong>处理文本并创建向量存储</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">process_text_with_splitter</span>(<span class="hljs-params">text: <span class="hljs-built_in">str</span>, char_page_mapping: <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>], save_path: <span class="hljs-built_in">str</span> = <span class="hljs-literal">None</span></span>) -&gt; FAISS:
    <span class="hljs-string">"""
    处理文本并创建向量存储
    参数:
        text: 提取的文本内容
        char_page_mapping: 每个字符对应的页码列表
        save_path: 可选，保存向量数据库的路径
    返回:
        knowledgeBase: 基于FAISS的向量存储对象
    """</span>
    <span class="hljs-comment"># 创建文本分割器，用于将长文本分割成小块</span>
    text_splitter = RecursiveCharacterTextSplitter(
        separators=[<span class="hljs-string">"\n\n"</span>, <span class="hljs-string">"\n"</span>, <span class="hljs-string">"."</span>, <span class="hljs-string">" "</span>, <span class="hljs-string">""</span>],
        chunk_size=<span class="hljs-number">1000</span>,
        chunk_overlap=<span class="hljs-number">200</span>,
        length_function=<span class="hljs-built_in">len</span>,
    )
    <span class="hljs-comment"># 分割文本</span>
    chunks = text_splitter.split_text(text)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"文本被分割成 <span class="hljs-subst">{<span class="hljs-built_in">len</span>(chunks)}</span> 个块。"</span>)
    <span class="hljs-comment"># 创建嵌入模型</span>
    embeddings = DashScopeEmbeddings(
        model=<span class="hljs-string">"text-embedding-v1"</span>,
        dashscope_api_key=DASHSCOPE_API_KEY,
    )
    <span class="hljs-comment"># 从文本块创建知识库</span>
    knowledgeBase = FAISS.from_texts(chunks, embeddings)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"已从文本块创建知识库。"</span>)
    <span class="hljs-comment"># 为每个文本块找到对应的页码信息</span>
    page_info = {}
    current_pos = <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> chunks:
        chunk_start = current_pos
        chunk_end = current_pos + <span class="hljs-built_in">len</span>(chunk)
        <span class="hljs-comment"># 找到这个文本块中字符对应的页码</span>
        chunk_pages = char_page_mapping[chunk_start:chunk_end]
        <span class="hljs-comment"># 取页码的众数（出现最多的页码）作为该块的页码</span>
        <span class="hljs-keyword">if</span> chunk_pages:
            <span class="hljs-comment"># 统计每个页码出现的次数</span>
            page_counts = {}
            <span class="hljs-keyword">for</span> page <span class="hljs-keyword">in</span> chunk_pages:
                page_counts[page] = page_counts.get(page, <span class="hljs-number">0</span>) + <span class="hljs-number">1</span>
            <span class="hljs-comment"># 找到出现次数最多的页码</span>
            most_common_page = <span class="hljs-built_in">max</span>(page_counts, key=page_counts.get)
            page_info[chunk] = most_common_page
        <span class="hljs-keyword">else</span>:
            page_info[chunk] = <span class="hljs-number">1</span>  <span class="hljs-comment"># 默认页码</span>
        current_pos = chunk_end
    knowledgeBase.page_info = page_info
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f'页码映射完成，共 <span class="hljs-subst">{<span class="hljs-built_in">len</span>(page_info)}</span> 个文本块'</span>)
    <span class="hljs-comment"># 如果提供了保存路径，则保存向量数据库和页码信息</span>
    <span class="hljs-keyword">if</span> save_path:
        <span class="hljs-comment"># 确保目录存在</span>
        os.makedirs(save_path, exist_ok=<span class="hljs-literal">True</span>)
        <span class="hljs-comment"># 保存FAISS向量数据库</span>
        knowledgeBase.save_local(save_path)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"向量数据库已保存到: <span class="hljs-subst">{save_path}</span>"</span>)
        <span class="hljs-comment"># 保存页码信息到同一目录</span>
        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(os.path.join(save_path, <span class="hljs-string">"page_info.pkl"</span>), <span class="hljs-string">"wb"</span>) <span class="hljs-keyword">as</span> f:
            pickle.dump(page_info, f)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"页码信息已保存到: <span class="hljs-subst">{os.path.join(save_path, <span class="hljs-string">'page_info.pkl'</span>)}</span>"</span>)
    <span class="hljs-keyword">return</span> knowledgeBase
</code></pre>
<p><strong>从磁盘加载向量数据库和页码信息</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">load_knowledge_base</span>(<span class="hljs-params">load_path: <span class="hljs-built_in">str</span>, embeddings = <span class="hljs-literal">None</span></span>) -&gt; FAISS:
    <span class="hljs-string">"""
    从磁盘加载向量数据库和页码信息
    参数:
        load_path: 向量数据库的保存路径
        embeddings: 可选，嵌入模型。如果为None，将创建一个新的DashScopeEmbeddings实例
    返回:
        knowledgeBase: 加载的FAISS向量数据库对象
    """</span>
    <span class="hljs-comment"># 如果没有提供嵌入模型，则创建一个新的</span>
    <span class="hljs-keyword">if</span> embeddings <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
        embeddings = DashScopeEmbeddings(
            model=<span class="hljs-string">"text-embedding-v1"</span>,
            dashscope_api_key=DASHSCOPE_API_KEY,
        )
    <span class="hljs-comment"># 加载FAISS向量数据库，添加allow_dangerous_deserialization=True参数以允许反序列化</span>
    knowledgeBase = FAISS.load_local(load_path, embeddings, allow_dangerous_deserialization=<span class="hljs-literal">True</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"向量数据库已从 <span class="hljs-subst">{load_path}</span> 加载。"</span>)
    <span class="hljs-comment"># 加载页码信息</span>
    page_info_path = os.path.join(load_path, <span class="hljs-string">"page_info.pkl"</span>)
    <span class="hljs-keyword">if</span> os.path.exists(page_info_path):
        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(page_info_path, <span class="hljs-string">"rb"</span>) <span class="hljs-keyword">as</span> f:
            page_info = pickle.load(f)
        knowledgeBase.page_info = page_info
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"页码信息已加载。"</span>)
    <span class="hljs-keyword">else</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"警告: 未找到页码信息文件。"</span>)
    <span class="hljs-keyword">return</span> knowledgeBase
</code></pre>
<p><strong>读取PDF文件，并写入到知识库</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 读取PDF文件</span>
pdf_reader = PdfReader(<span class="hljs-string">'./考核办法.pdf'</span>)
<span class="hljs-comment"># 提取文本和页码信息</span>
text, char_page_mapping = extract_text_with_page_numbers(pdf_reader)
<span class="hljs-comment">#print('page_numbers=',page_numbers)</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"提取的文本长度: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(text)}</span> 个字符。"</span>)
<span class="hljs-comment"># 处理文本并创建知识库，同时保存到磁盘</span>
save_dir = <span class="hljs-string">"./vector_db"</span>
knowledgeBase = process_text_with_splitter(text, char_page_mapping, save_path=save_dir)
</code></pre>
<p><strong>如何加载已保存的向量数据库</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 创建嵌入模型</span>
embeddings = DashScopeEmbeddings(
    model=<span class="hljs-string">"text-embedding-v1"</span>,
    dashscope_api_key=DASHSCOPE_API_KEY,
)
<span class="hljs-comment"># 从磁盘加载向量数据库</span>
loaded_knowledgeBase = load_knowledge_base(<span class="hljs-string">"./vector_db"</span>, embeddings)
<span class="hljs-comment"># 使用加载的知识库进行查询</span>
docs = loaded_knowledgeBase.similarity_search(<span class="hljs-string">"客户经理每年评聘申报时间是怎样的？"</span>)
<span class="hljs-comment"># 直接使用FAISS.load_local方法加载（替代方法）</span>
<span class="hljs-comment"># loaded_knowledgeBase = FAISS.load_local("./vector_db", embeddings, allow_dangerous_deserialization=True)</span>
<span class="hljs-comment"># 注意：使用这种方法加载时，需要手动加载页码信息</span>
</code></pre>
<p><strong>对话调用</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain_community.llms <span class="hljs-keyword">import</span> Tongyi
llm = Tongyi(model_name=<span class="hljs-string">"deepseek-v3"</span>, dashscope_api_key=DASHSCOPE_API_KEY) <span class="hljs-comment"># qwen-turbo</span>
<span class="hljs-comment"># 设置查询问题</span>
query = <span class="hljs-string">"客户经理被投诉了，投诉一次扣多少分"</span>
<span class="hljs-comment">#query = "客户经理每年评聘申报时间是怎样的？"</span>
<span class="hljs-keyword">if</span> query:
    <span class="hljs-comment"># 执行相似度搜索，找到与查询相关的文档</span>
    docs = knowledgeBase.similarity_search(query,k=<span class="hljs-number">10</span>)
    <span class="hljs-comment"># 加载问答链</span>
    chain = load_qa_chain(llm, chain_type=<span class="hljs-string">"stuff"</span>)
    <span class="hljs-comment"># 准备输入数据</span>
    input_data = {<span class="hljs-string">"input_documents"</span>: docs, <span class="hljs-string">"question"</span>: query}
    <span class="hljs-comment"># 执行问答链</span>
    response = chain.invoke(<span class="hljs-built_in">input</span>=input_data)
    <span class="hljs-built_in">print</span>(response[<span class="hljs-string">"output_text"</span>])
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"来源:"</span>)
    <span class="hljs-comment"># 记录唯一的页码</span>
    unique_pages = <span class="hljs-built_in">set</span>()
    <span class="hljs-comment"># 显示每个文档块的来源页码</span>
    <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> docs:
        <span class="hljs-comment">#print('doc=',doc)</span>
        text_content = <span class="hljs-built_in">getattr</span>(doc, <span class="hljs-string">"page_content"</span>, <span class="hljs-string">""</span>)
        source_page = knowledgeBase.page_info.get(
            text_content.strip(), <span class="hljs-string">"未知"</span>
        )
        <span class="hljs-keyword">if</span> source_page <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> unique_pages:
            unique_pages.add(source_page)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"文本块页码: <span class="hljs-subst">{source_page}</span>"</span>)
</code></pre>
<h3 data-id="heading-19">3.5 示例总结</h3>
<p><strong>1. PDF文本提取与处理</strong></p>
<ul>
<li>使用PyPDF2库的PdfReader从PDF文件中提取文本在提取过程中记录每行文本对应的页码，便于后续溯源。</li>
<li>使用RecursiveCharacterTextSplitter将长文本分割成小块，便于向量化处理。</li>
</ul>
<p><strong>2. 向量数据库构建</strong></p>
<ul>
<li>使用OpenAIEmbeddings / DashScopeEmbeddings将文本块转换为向量表示。</li>
<li>使用FAISS向量数据库存储文本向量，支持高效的相似度搜索为每个文本块保存对应的页码信息，实现查询结果溯源。</li>
</ul>
<p><strong>3. 语义搜索与问答链</strong></p>
<ul>
<li>基于用户查询，使用similarity_search在向量数据库中检索相关文本块。</li>
<li>使用文本语言模型和load_qa_chain构建问答链将检索到的文档和用户问题作为输入，生成回答。</li>
</ul>
<p><strong>4. 成本跟踪与结果展示</strong></p>
<ul>
<li>使用get_openai_callback跟踪API调用成本。</li>
<li>展示问答结果和来源页码，方便用户验证信息。</li>
</ul>
<hr/>
<h2 data-id="heading-20">四、LangChain中的问答链</h2>
<p>在LangChain问答链中，有4种chain_type，chain_type参数决定了RAG流程中，如何将检索到的多个相关文档块与用户的问题组合起来，发送给大模型以生成最终答案。需要根据应用场景，选择不同的chain_type，以保证在效果、成本和速度上的权衡。</p>
<h3 data-id="heading-21">1. stuff（堆叠式）</h3>
<p><strong>工作原理：</strong></p>
<p>将所有检索到的文档片段直接拼接成一个长上下文，与问题一起构造 Prompt，单次调用 LLM 生成答案。</p>
<p><strong>优点：</strong></p>
<ul>
<li>实现最简单、延迟最低；</li>
<li>单次LLM调用，成本最低；</li>
<li>所有信息同时可见，利于全局理解。</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>受限于LLM的最大上下文长度，文档过多或过长时会截断；</li>
<li>若检索结果包含噪声，可能干扰生成质量。</li>
</ul>
<p><strong>适用场景：</strong></p>
<ul>
<li>检索返回的文档数量少、内容精炼（如chunk_size较小）；</li>
<li>对响应速度和成本敏感的轻量级应用。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2cc4ad927c3b473e9ef8f9bbc44ed5d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pif5rWpQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456117&amp;x-signature=2vw%2BeNDnAYwe13Xup6lZFmaaVRg%3D" alt="img_5.jpg" loading="lazy"/></p>
<h3 data-id="heading-22">2. map_reduce（映射-归约）</h3>
<p><strong>工作原理：</strong></p>
<ul>
<li><strong>Map阶段：</strong> 对每个文档（chunk）独立构造Prompt，分别调用LLM生成中间摘要或回答。</li>
<li><strong>Reduce阶段：</strong> 将所有中间结果合并，再次调用LLM生成最终答案。</li>
</ul>
<p><strong>优点：</strong></p>
<ul>
<li>可处理超长文档集合，不受单次上下文长度限制；</li>
<li>Map阶段可并行执行，提升吞吐率；</li>
<li>适合信息分散在多个片段中的场景。</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>至少需要N+1次LLM调用（N为文档数），成本高，延迟大；</li>
<li>各文档独立处理，缺乏文档上下文关联。</li>
</ul>
<p><strong>适用场景：</strong></p>
<ul>
<li>检索结果较多且分散；</li>
<li>需要对大量文档进行综合归纳（如报告生成，多源信息整合）。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3022ff0f25bd416d9902444c1c62bd38~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pif5rWpQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456117&amp;x-signature=JlLCkfRPHY7XDskW0qYqo5yRY3M%3D" alt="img_6.jpg" loading="lazy"/></p>
<h3 data-id="heading-23">3. refine（迭代细化）</h3>
<p>在第一个chunk上做prompt得到结果，然后再合并下一个文件再输出结果</p>
<p><strong>工作原理：</strong></p>
<p>先用第一个文档和问题生成初步答案；依次将后续文档与当前答案合并，逐步"细化"输出，每次更新答案。</p>
<p><strong>优点：</strong></p>
<ul>
<li>能在一定程度上保留跨文档上下文信息；</li>
<li>每次只处理一个新文档 + 当前答案，Token使用较为可控；</li>
<li>最终答案融合了所有文档的信息流。</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>必须串行处理，无法并行，延迟较高；</li>
<li>早期错误可能被累积放大；</li>
</ul>
<p><strong>适用场景：</strong></p>
<ul>
<li>文档间存在逻辑递进或补充关系；</li>
<li>需要在有限上下文窗口内处理中等数量文档；</li>
<li>对答案连续性要求较高。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0859013afd47481d81016a623278a51a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pif5rWpQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456117&amp;x-signature=V4csTvhZWyT%2Ff49oFbA09d7HZ9Q%3D" alt="img_7.jpg" loading="lazy"/></p>
<h3 data-id="heading-24">4. map_rerank（映射重排序）</h3>
<p>对每个chunk做prompt，然后打个分，然后根据分数返回最好的文档中的结果。</p>
<p>会大量地调用LLM，每个document之间是独立处理。</p>
<p><strong>工作原理：</strong></p>
<p>对每个文档独立构造Prompt，要求LLM输出一个答案+置信度分数；根据分数排序，返回得分最高的答案（通常只取Top-1）。</p>
<p><strong>优点：</strong></p>
<ul>
<li>能有效过滤低质量或无关文档；</li>
<li>返回的答案来自最相关片段，精准度高。</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>每个文档都需要调用一次LLM，成本高；</li>
<li>不副合多文档信息，仅返回单个最佳答案，可能丢失互补信息；</li>
<li>依赖LLM对"打分"的一致性，部分模型不擅长此任务。</li>
</ul>
<p><strong>适用场景：</strong></p>
<ul>
<li>检索结果中存在明显"最佳匹配"文档；</li>
<li>任务为事实型问答（如"XX 的定义是什么？"）；</li>
<li>需要高置信度、简洁答案，而非综合归纳。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/effc4d5952394d47913e0cadfae60649~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pif5rWpQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456117&amp;x-signature=Of91seJnUkyhxsdcu%2B4DrqgUDbE%3D" alt="img_8.jpg" loading="lazy"/></p>
<h3 data-id="heading-25">5. 总结</h3>






















































<table><thead><tr><th>特性</th><th>stuff</th><th>map_reduce</th><th>refine</th><th>map_rerank</th></tr></thead><tbody><tr><td>LLM调用次数</td><td>1</td><td>N + 1</td><td>N</td><td>N</td></tr><tr><td>速度</td><td>最快</td><td>中等</td><td>最慢</td><td>慢</td></tr><tr><td>Token 消耗</td><td>低</td><td>高</td><td>高</td><td>高</td></tr><tr><td>处理长文档能力</td><td>差</td><td>好</td><td>好</td><td>好</td></tr><tr><td>答案质量</td><td>高 (上下文完整)</td><td>中等 (可能丢失关联)</td><td>最高 (迭代细化)</td><td>取决于最佳块</td></tr><tr><td>适用场景</td><td>默认选择，文档短</td><td>文档多，需平衡</td><td>文档多，要求高精度</td><td>事实型问题，答案在单块中</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-26">五、如果LLM可以处理无限上下文，RAG还有意义吗？</h2>
<ul>
<li>
<p><strong>效率成本</strong><br/>
LLM处理上下文时计算资源消耗大，响应时间增加。RAG通过检索相关片段，减少输入长度。</p>
</li>
<li>
<p><strong>知识更新</strong><br/>
LLM的知识截止于训练数据，无法实时更新。RAG可以连接外部知识库，增强时效性。</p>
</li>
<li>
<p><strong>可解释性</strong><br/>
RAG的检索过程透明，用户可查看来源，增强信任。LLM的生成过程则较难追溯。</p>
</li>
<li>
<p><strong>定制化</strong><br/>
RAG可针对特定领域定制检索系统，提供更精准的结果，而LLM的通用性可能无法满足特定需求。</p>
</li>
<li>
<p><strong>数据隐私</strong><br/>
RAG允许在本地或私有数据源上检索，避免敏感数据上传云端，适合隐私要求高的场景。</p>
</li>
</ul>
<p>结合LLM的生成能力和RAG的检索能力，可以提升整体性能，提供更全面、准确的回答。</p>
<hr/>
<p>如果你觉得本文有帮助，欢迎点赞、在看、转发，也欢迎留言分享你的经验！</p>
<p><strong>往期文章回顾：</strong></p>
<ul>
<li><strong>一文看懂主流向量数据库：选型不再踩坑</strong></li>
<li><a href="https://juejin.cn/post/7583598943071731747" target="_blank" title="https://juejin.cn/post/7583598943071731747">一文看懂主流向量数据库：选型不再踩坑</a></li>
<li><a href="https://juejin.cn/post/7582857981893918761" target="_blank" title="https://juejin.cn/post/7582857981893918761">AI 并不懂文字，它只认向量：一文搞懂 Embedding</a></li>
<li><a href="https://juejin.cn/post/7582470341924077602" target="_blank" title="https://juejin.cn/post/7582470341924077602">不会写提示词？难怪你的AI总在胡说八道！</a></li>
<li><a href="https://juejin.cn/post/7582073642869702671" target="_blank" title="https://juejin.cn/post/7582073642869702671">AI大模型原理与API使用</a></li>
<li><a href="https://juejin.cn/post/7581814484065419316" target="_blank" title="https://juejin.cn/post/7581814484065419316">Spec Kit+Cursor：AI驱动的软件开发新范式</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[pnpm 你用了吗？]]></title>    <link>https://juejin.cn/post/7583981974408478730</link>    <guid>https://juejin.cn/post/7583981974408478730</guid>    <pubDate>2025-12-16T03:14:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583981974408478730" data-draft-id="7583948178859032622" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="pnpm 你用了吗？"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-16T03:14:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="hayzone"/> <meta itemprop="url" content="https://juejin.cn/user/1750078243241607"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            pnpm 你用了吗？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1750078243241607/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    hayzone
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T03:14:30.000Z" title="Tue Dec 16 2025 03:14:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">pnpm 详解：更快、更省空间的现代化包管理器</h2>
<h3 data-id="heading-1">一、什么是 pnpm？</h3>
<p><strong>pnpm</strong>（<strong>p</strong>erformant <strong>npm</strong>）是一个快速、节省磁盘空间的 Node.js 包管理器。它通过 <strong>硬链接 + 符号链接</strong> 的方式，在全局存储中只保存一份依赖包，多个项目共享同一份物理文件，从而显著减少磁盘占用并提升安装速度。</p>
<p>官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Fpnpm.io%2F" target="_blank" title="https://pnpm.io/" ref="nofollow noopener noreferrer">pnpm.io</a></p>
<hr/>
<h3 data-id="heading-2">二、核心优势</h3>
<h4 data-id="heading-3">✅ 1. <strong>节省磁盘空间</strong></h4>
<ul>
<li><strong>npm/yarn</strong> 每个项目都会复制完整依赖树。</li>
<li><strong>pnpm</strong> 使用 <strong>内容可寻址存储（Content-addressable store）</strong> ，相同版本的包只存一次。</li>
<li><strong>实测</strong>：10 个相似项目，pnpm 可节省 <strong>70%+</strong> 磁盘空间。</li>
</ul>
<h4 data-id="heading-4">✅ 2. <strong>安装速度更快</strong></h4>
<ul>
<li>无需重复下载/解压相同包。</li>
<li>并行化处理 + 高效的依赖解析算法。</li>
<li><strong>CI/CD 或大型项目中优势显著</strong>。</li>
</ul>
<h4 data-id="heading-5">✅ 3. <strong>严格的依赖隔离（无幽灵依赖）</strong></h4>
<ul>
<li>pnpm 严格遵循 <code>node_modules</code> 的 <strong>symlink 结构</strong>，只暴露显式声明的依赖。</li>
<li>避免 npm/yarn 中常见的“未声明却能引用”的 <strong>幽灵依赖</strong> 问题，提升项目健壮性。</li>
</ul>
<h4 data-id="heading-6">✅ 4. <strong>原生支持 Monorepo（多项目管理）</strong></h4>
<ul>
<li>内置 <code>pnpm workspace</code> 功能，无需额外工具（如 Lerna）即可高效管理多个子项目。</li>
<li>支持跨项目链接、统一依赖升级、脚本批量执行等。</li>
</ul>
<hr/>
<h3 data-id="heading-7">三、安装 pnpm</h3>
<h4 data-id="heading-8">全局安装（推荐）</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 使用 npm</span>
npm install -g pnpm

<span class="hljs-comment"># 使用 corepack（Node.js 16.13+ 内置）</span>
corepack <span class="hljs-built_in">enable</span>
corepack prepare pnpm@latest --activate
</code></pre>
<blockquote>
<p>💡 建议使用 <code>corepack</code>，它是官方推荐的包管理器分发方式，避免全局污染。</p>
</blockquote>
<h4 data-id="heading-9">验证安装</h4>
<pre><code class="hljs language-bash" lang="bash">pnpm -v
<span class="hljs-comment"># 输出如：9.12.0</span>
</code></pre>
<hr/>
<h3 data-id="heading-10">四、基本使用命令</h3>









































<table><thead><tr><th>功能</th><th>命令</th></tr></thead><tbody><tr><td>初始化项目</td><td><code>pnpm init</code></td></tr><tr><td>安装依赖</td><td><code>pnpm install</code> 或 <code>pnpm i</code></td></tr><tr><td>添加依赖</td><td><code>pnpm add lodash</code></td></tr><tr><td>添加开发依赖</td><td><code>pnpm add -D typescript</code></td></tr><tr><td>删除依赖</td><td><code>pnpm remove lodash</code></td></tr><tr><td>运行脚本</td><td><code>pnpm run dev</code></td></tr><tr><td>查看依赖树</td><td><code>pnpm list</code></td></tr><tr><td>清理 store</td><td><code>pnpm store prune</code></td></tr></tbody></table>
<blockquote>
<p>⚠️ 注意：<code>pnpm</code> 不支持 <code>npm install package --save</code> 这种写法，必须用 <code>pnpm add</code>。</p>
</blockquote>
<hr/>
<h3 data-id="heading-11">五、版本策略</h3>
<ul>
<li>pnpm 遵循 <strong>SemVer（语义化版本）</strong> 。</li>
<li>主版本更新较快（目前 v9.x），但 API 稳定。</li>
<li>推荐使用 <strong>最新稳定版</strong>，可通过 <code>pnpm env use --global latest</code> 自动管理 Node.js + pnpm 版本。</li>
</ul>
<hr/>
<h3 data-id="heading-12">六、多项目管理：pnpm Workspace 详解（核心亮点）</h3>
<h4 data-id="heading-13">1. 什么是 Workspace？</h4>
<p>Workspace 是 pnpm 提供的 <strong>Monorepo 管理方案</strong>，允许在一个仓库中管理多个相互关联的包（如组件库、微前端、工具链等）。</p>
<h4 data-id="heading-14">2. 配置步骤</h4>
<h5 data-id="heading-15">(1) 根目录创建 <code>pnpm-workspace.yaml</code></h5>
<pre><code class="hljs language-bash" lang="bash">packages:
  - <span class="hljs-string">'packages/*'</span>
  - <span class="hljs-string">'apps/*'</span>
  - <span class="hljs-string">'!**/test/**'</span>  <span class="hljs-comment"># 排除测试目录</span>
</code></pre>
<h5 data-id="heading-16">(2) 子项目结构示例</h5>
<pre><code class="hljs language-go" lang="go">my-monorepo/
├── packages/
│   ├── ui-components/
│   └── utils/
├── apps/
│   ├── web-app/
│   └── admin/
├── pnpm-workspace.yaml
└── <span class="hljs-keyword">package</span>.json
</code></pre>
<h5 data-id="heading-17">(3) 跨项目引用（自动软链接）</h5>
<p>在 <code>apps/web-app/package.json</code> 中：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"ui-components"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"workspace:*"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"utils"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"workspace:^1.0.0"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>运行 <code>pnpm install</code> 后，<code>ui-components</code> 和 <code>utils</code> 会自动以 <strong>符号链接</strong> 形式链接到 <code>web-app/node_modules</code>，实现 <strong>实时开发调试</strong>，无需 <code>npm link</code>。</p>
<h4 data-id="heading-18">3. 批量操作命令</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 在所有 workspace 中运行 build</span>
pnpm -r run build

<span class="hljs-comment"># 仅在包含 test 脚本的项目中运行</span>
pnpm -r --filter=<span class="hljs-string">'./packages/**'</span> run <span class="hljs-built_in">test</span>

<span class="hljs-comment"># 查看所有 workspace 依赖关系图</span>
pnpm m <span class="hljs-built_in">ls</span>
</code></pre>
<h4 data-id="heading-19">4. 优势总结（vs Lerna + Yarn/NPM）</h4>



































<table><thead><tr><th>能力</th><th>pnpm Workspace</th><th>Lerna + Yarn</th></tr></thead><tbody><tr><td>依赖安装</td><td>单次 <code>pnpm install</code> 完成</td><td>需 <code>lerna bootstrap</code></td></tr><tr><td>磁盘占用</td><td>极低（共享 store）</td><td>高（每个项目独立 node_modules）</td></tr><tr><td>幽灵依赖</td><td>严格禁止</td><td>可能存在</td></tr><tr><td>配置复杂度</td><td>极简（一个 yaml 文件）</td><td>需 Lerna + Yarn 配置</td></tr><tr><td>性能</td><td>快</td><td>较慢</td></tr></tbody></table>
<blockquote>
<p>🚀 <strong>结论</strong>：对于新项目，<strong>直接使用 pnpm workspace 是 Monorepo 的最佳实践</strong>。</p>
</blockquote>
<hr/>
<h3 data-id="heading-20">七、常见问题 &amp; 最佳实践</h3>
<h4 data-id="heading-21">Q1: pnpm 和 npm/yarn 兼容吗？</h4>
<ul>
<li>完全兼容 <code>package.json</code> 和 npm registry。</li>
<li>可无缝迁移：删除 <code>node_modules</code> 和 <code>package-lock.json</code>，运行 <code>pnpm import</code>（从 yarn.lock/npm-lock）或直接 <code>pnpm install</code>。</li>
</ul>
<h4 data-id="heading-22">Q2: 如何迁移现有项目到 pnpm？</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 删除旧依赖</span>
<span class="hljs-built_in">rm</span> -rf node_modules package-lock.json

<span class="hljs-comment"># 2. 安装 pnpm 依赖</span>
pnpm install

<span class="hljs-comment"># 3. （可选）从 yarn.lock 导入</span>
pnpm import  <span class="hljs-comment"># 自动读取 yarn.lock 或 package-lock.json</span>
</code></pre>
<h4 data-id="heading-23">Q3: pnpm 支持 .npmrc 吗？</h4>
<ul>
<li>支持！配置方式与 npm 一致，如设置 registry、token 等。</li>
</ul>
<h4 data-id="heading-24">最佳实践建议：</h4>
<ul>
<li>在 <code>.nvmrc</code> 或 <code>.tool-versions</code> 中指定 Node.js 版本。</li>
<li>使用 <code>pnpm dlx</code> 临时运行包（替代 <code>npx</code>）：<code>pnpm dlx create-react-app my-app</code></li>
<li>开启 <code>hoist=false</code>（默认）以保持严格依赖隔离。</li>
</ul>
<hr/>
<h3 data-id="heading-25">八、结语</h3>
<p><strong>pnpm 不仅是一个更快的 npm 替代品，更是现代前端工程化的基础设施</strong>。它在 <strong>磁盘效率、安装速度、依赖安全性和 Monorepo 支持</strong> 上全面领先，已被 Vite、Next.js、Nuxt、Turborepo 等主流工具链官方推荐。</p>
<p>如果你还在忍受 <code>node_modules</code> 的臃肿和幽灵依赖的困扰，<strong>现在就是切换到 pnpm 的最佳时机</strong>！</p>
<hr/>
<blockquote>
<p>🔗 <strong>参考链接</strong>：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fpnpm.io%2F" target="_blank" title="https://pnpm.io/" ref="nofollow noopener noreferrer">pnpm 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fpnpm.io%2Fbenchmarks" target="_blank" title="https://pnpm.io/benchmarks" ref="nofollow noopener noreferrer">pnpm vs npm vs yarn 性能对比</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fvitejs.dev%2Fguide%2F%23scaffolding-your-first-vite-project" target="_blank" title="https://vitejs.dev/guide/#scaffolding-your-first-vite-project" ref="nofollow noopener noreferrer">Vite 官方推荐使用 pnpm</a></li>
</ul>
</blockquote>
<hr/>
<p><strong>欢迎点赞、收藏、评论交流！你用过 pnpm 吗？体验如何？</strong> 😊</p>
<hr/>
<h4 data-id="heading-26">📄 附：文档结构说明</h4>









































<table><thead><tr><th>章节</th><th>内容</th></tr></thead><tbody><tr><td>一</td><td>pnpm 简介</td></tr><tr><td>二</td><td>核心优势（含多项目管理）</td></tr><tr><td>三</td><td>安装方法</td></tr><tr><td>四</td><td>常用命令</td></tr><tr><td>五</td><td>版本管理</td></tr><tr><td>六</td><td>Monorepo 深度解析</td></tr><tr><td>七</td><td>常见问题与迁移指南</td></tr><tr><td>八</td><td>总结与推荐</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[[环境变量]export命令的作用是什么]]></title>    <link>https://juejin.cn/post/7583980250733494335</link>    <guid>https://juejin.cn/post/7583980250733494335</guid>    <pubDate>2025-12-16T02:49:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583980250733494335" data-draft-id="7583933107690307647" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="[环境变量]export命令的作用是什么"/> <meta itemprop="keywords" content="Linux"/> <meta itemprop="datePublished" content="2025-12-16T02:49:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="import_random"/> <meta itemprop="url" content="https://juejin.cn/user/2013961033882312"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            [环境变量]export命令的作用是什么
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2013961033882312/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    import_random
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:49:13.000Z" title="Tue Dec 16 2025 02:49:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 <strong>.zshrc</strong> 文件中使用 <code>export</code> 命令的主要作用是将变量设置为 <strong>环境变量</strong>，使其在整个Shell会话及其子进程中可用。具体作用如下：</p>
<h2 data-id="heading-0">主要功能：</h2>
<h3 data-id="heading-1">1. <strong>使变量全局可见</strong></h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span> PATH=<span class="hljs-string">"<span class="hljs-variable">$HOME</span>/bin:<span class="hljs-variable">$PATH</span>"</span>
</code></pre>
<ul>
<li>将 <code>PATH</code> 变量导出，使所有子进程（包括其他程序、脚本等）都能访问这个变量</li>
</ul>
<h3 data-id="heading-2">2. <strong>作用域扩展</strong></h3>
<pre><code class="hljs language-bash" lang="bash">MY_VAR=<span class="hljs-string">"hello"</span>       <span class="hljs-comment"># 仅当前Shell可见</span>
<span class="hljs-built_in">export</span> MY_VAR        <span class="hljs-comment"># 变为环境变量，子进程可见</span>
</code></pre>
<ul>
<li>没有 <code>export</code>：变量只在当前Shell中可用</li>
<li>有 <code>export</code>：变量可被子进程继承</li>
</ul>
<h3 data-id="heading-3">3. <strong>持久化配置</strong></h3>
<p>在 <code>.zshrc</code> 中使用 <code>export</code>，每次启动新终端时都会自动设置这些环境变量。</p>
<h2 data-id="heading-4">常见用例示例：</h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Java环境</span>
<span class="hljs-built_in">export</span> JAVA_HOME=<span class="hljs-string">"/usr/lib/jvm/java-11-openjdk"</span>
<span class="hljs-built_in">export</span> PATH=<span class="hljs-string">"<span class="hljs-variable">$JAVA_HOME</span>/bin:<span class="hljs-variable">$PATH</span>"</span>

<span class="hljs-comment"># 编辑器设置</span>
<span class="hljs-built_in">export</span> EDITOR=<span class="hljs-string">"vim"</span>

<span class="hljs-comment"># 语言设置</span>
<span class="hljs-built_in">export</span> LANG=<span class="hljs-string">"en_US.UTF-8"</span>

<span class="hljs-comment"># 自定义变量</span>
<span class="hljs-built_in">export</span> MY_PROJECT_HOME=<span class="hljs-string">"<span class="hljs-variable">$HOME</span>/projects"</span>
<span class="hljs-built_in">export</span> GITHUB_TOKEN=<span class="hljs-string">"your_token_here"</span>  <span class="hljs-comment"># 注意：不推荐在此硬编码敏感信息</span>
</code></pre>
<h2 data-id="heading-5">注意事项：</h2>
<ol>
<li>
<p><strong>安全性</strong>：不要在 <code>.zshrc</code> 中导出敏感信息（如密码、API密钥），建议使用专用配置文件或安全存储</p>
</li>
<li>
<p><strong>立即生效</strong>：修改 <code>.zshrc</code> 后需要重新加载：</p>
</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">source</span> ~/.zshrc
<span class="hljs-comment"># 或</span>
<span class="hljs-built_in">exec</span> zsh
</code></pre>
<ol start="3">
<li><strong>路径添加顺序</strong>：<code>PATH</code> 变量按顺序查找，常用做法是将自定义路径放在前面：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span> PATH=<span class="hljs-string">"/usr/local/bin:<span class="hljs-variable">$PATH</span>"</span>  <span class="hljs-comment"># 优先使用/usr/local/bin</span>
</code></pre>
<ol start="4">
<li><strong>查看环境变量</strong>：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span>        <span class="hljs-comment"># 查看所有导出变量</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$PATH</span>    <span class="hljs-comment"># 查看PATH变量</span>
</code></pre>
<h2 data-id="heading-6">与其他方式的区别：</h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 临时设置（仅当前会话有效）</span>
<span class="hljs-built_in">export</span> TEMP_VAR=<span class="hljs-string">"value"</span>

<span class="hljs-comment"># 永久设置（写入.zshrc）</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'export MY_VAR="value"'</span> &gt;&gt; ~/.zshrc

<span class="hljs-comment"># 局部变量（不导出）</span>
<span class="hljs-built_in">local</span> LOCAL_VAR=<span class="hljs-string">"only_in_current_scope"</span>
</code></pre>
<p>总之，<code>export</code> 在 <code>.zshrc</code> 中的作用是确保你设置的变量在整个Shell环境和所有启动的程序中都可用。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBoot 整合 ElasticSearch，给搜索插上“光速翅膀”]]></title>    <link>https://juejin.cn/post/7583955708318564352</link>    <guid>https://juejin.cn/post/7583955708318564352</guid>    <pubDate>2025-12-16T03:23:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583955708318564352" data-draft-id="7583973472322961423" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBoot 整合 ElasticSearch，给搜索插上“光速翅膀”"/> <meta itemprop="keywords" content="后端,Java,Elasticsearch"/> <meta itemprop="datePublished" content="2025-12-16T03:23:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="悟空码字"/> <meta itemprop="url" content="https://juejin.cn/user/3139860942296830"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBoot 整合 ElasticSearch，给搜索插上“光速翅膀”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3139860942296830/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    悟空码字
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T03:23:48.000Z" title="Tue Dec 16 2025 03:23:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是小悟。</p>
<h2 data-id="heading-0">一、ElasticSearch 是什么？</h2>
<p>你有一个超级健忘的朋友（比如金鱼记忆的那种），但他却能在0.0001秒内从100万本书里找到你想要的句子。这就是 ElasticSearch（简称 ES）！</p>
<p><strong>ES 的“人格特征”：</strong></p>
<ul>
<li><strong>速度狂魔</strong>：搜索速度比咖啡因过量的程序员找Bug还快</li>
<li><strong>文档收藏家</strong>：什么JSON、日志都能存</li>
<li><strong>超级侦探</strong>：模糊搜索、精确搜索、拼音搜索样样精通</li>
<li><strong>大象胃口</strong>：数据量再大也不怕（毕竟名字里就有“elastic”弹性）</li>
<li><strong>马戏团团长</strong>：天生分布式，节点之间跳来跳去从不出错</li>
</ul>
<h2 data-id="heading-1">二、整合大冒险：SpringBoot 与 ES 的“相亲大会”</h2>
<h3 data-id="heading-2">第 1 步：先来个“相亲介绍人”（Maven 依赖）</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- pom.xml 里加入这些“红娘” --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- SpringBoot 给 ES 的专属“情书” --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-elasticsearch<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 防止程序说“我不会JSON” --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-databind<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<h3 data-id="heading-3">第 2 步：配置“约会地点”（application.yml）</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># application.yml</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">elasticsearch:</span>
    <span class="hljs-attr">uris:</span> <span class="hljs-string">http://localhost:9200</span>  <span class="hljs-comment"># ES 的“家庭地址”</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">elastic</span>  <span class="hljs-comment"># 用户名（默认是这个）</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">your_password</span>  <span class="hljs-comment"># 密码（安装时设置的）</span>
    
  <span class="hljs-comment"># 可选：让日志“多说点话”，方便调试</span>
  <span class="hljs-attr">data:</span>
    <span class="hljs-attr">elasticsearch:</span>
      <span class="hljs-attr">repositories:</span>
        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>

<span class="hljs-comment"># 给 ES 客户端一点“咖啡因”，让它更精神</span>
<span class="hljs-attr">elasticsearch:</span>
  <span class="hljs-attr">connection-timeout:</span> <span class="hljs-number">5000</span>  <span class="hljs-comment"># 连接超时（毫秒）</span>
  <span class="hljs-attr">socket-timeout:</span> <span class="hljs-number">30000</span>  <span class="hljs-comment"># socket超时</span>
</code></pre>
<h3 data-id="heading-4">第 3 步：创建“相亲对象”（实体类）</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> org.springframework.<span class="hljs-keyword">data</span>.<span class="hljs-keyword">annotation</span>.Id;
<span class="hljs-keyword">import</span> org.springframework.<span class="hljs-keyword">data</span>.elasticsearch.annotations.Document;
<span class="hljs-keyword">import</span> org.springframework.<span class="hljs-keyword">data</span>.elasticsearch.annotations.Field;
<span class="hljs-keyword">import</span> org.springframework.<span class="hljs-keyword">data</span>.elasticsearch.annotations.FieldType;
<span class="hljs-keyword">import</span> java.util.Date;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@Document(indexName = <span class="hljs-string">"book_index"</span>)</span>  <span class="hljs-comment">// 告诉ES：“这是我家的书架名字”</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Book</span> {
    
    <span class="hljs-meta">@Id</span>  <span class="hljs-comment">// 相当于书的“身份证号”</span>
    <span class="hljs-keyword">private</span> String id;
    
    <span class="hljs-meta">@Field(type = FieldType.Text, analyzer = <span class="hljs-string">"ik_max_word"</span>)</span>  <span class="hljs-comment">// 用中文分词器</span>
    <span class="hljs-keyword">private</span> String title;  <span class="hljs-comment">// 书名</span>
    
    <span class="hljs-meta">@Field(type = FieldType.Text, analyzer = <span class="hljs-string">"ik_smart"</span>)</span>
    <span class="hljs-keyword">private</span> String author;  <span class="hljs-comment">// 作者</span>
    
    <span class="hljs-meta">@Field(type = FieldType.Double)</span>
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">Double</span> price;  <span class="hljs-comment">// 价格</span>
    
    <span class="hljs-meta">@Field(type = FieldType.Date)</span>
    <span class="hljs-keyword">private</span> Date publishDate;  <span class="hljs-comment">// 出版日期</span>
    
    <span class="hljs-meta">@Field(type = FieldType.Keyword)</span>  <span class="hljs-comment">// 关键词，不分词</span>
    <span class="hljs-keyword">private</span> String category;  <span class="hljs-comment">// 分类</span>
    
    <span class="hljs-meta">@Field(type = FieldType.Nested)</span>  <span class="hljs-comment">// 嵌套对象</span>
    <span class="hljs-keyword">private</span> List&lt;Tag&gt; tags;
    
    <span class="hljs-meta">@Data</span>
    <span class="hljs-keyword">public</span> static <span class="hljs-keyword">class</span> <span class="hljs-title class_">Tag</span> {
        <span class="hljs-meta">@Field(type = FieldType.Keyword)</span>
        <span class="hljs-keyword">private</span> String name;
        <span class="hljs-meta">@Field(type = FieldType.Integer)</span>
        <span class="hljs-keyword">private</span> Integer priority;
    }
}
</code></pre>
<h3 data-id="heading-5">第 4 步：找个“媒婆”（Repository 接口）</h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> org.springframework.data.domain.Page;
<span class="hljs-keyword">import</span> org.springframework.data.domain.Pageable;
<span class="hljs-keyword">import</span> org.springframework.data.elasticsearch.annotations.Query;
<span class="hljs-keyword">import</span> org.springframework.data.elasticsearch.repository.ElasticsearchRepository;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Repository;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@Repository</span>
<span class="hljs-keyword">public</span> interface <span class="hljs-type">BookRepository</span> extends <span class="hljs-type">ElasticsearchRepository</span>&lt;<span class="hljs-type">Book</span>, <span class="hljs-type">String</span>&gt; {
    
    <span class="hljs-comment">// 方法名就是查询！Spring Data 的“魔法”</span>
    
    <span class="hljs-comment">// 1. 按作者精确查找（比找失散多年的兄弟还准）</span>
    <span class="hljs-type">List</span>&lt;<span class="hljs-type">Book</span>&gt; findByAuthor(<span class="hljs-type">String</span> author);
    
    <span class="hljs-comment">// 2. 按标题模糊查找（支持分词）</span>
    <span class="hljs-type">List</span>&lt;<span class="hljs-type">Book</span>&gt; findByTitleContaining(<span class="hljs-type">String</span> keyword);
    
    <span class="hljs-comment">// 3. 价格区间查找（找买得起的书）</span>
    <span class="hljs-type">List</span>&lt;<span class="hljs-type">Book</span>&gt; findByPriceBetween(<span class="hljs-type">Double</span> minPrice, <span class="hljs-type">Double</span> maxPrice);
    
    <span class="hljs-comment">// 4. 多条件查询（作者+分类）</span>
    <span class="hljs-type">List</span>&lt;<span class="hljs-type">Book</span>&gt; findByAuthorAndCategory(<span class="hljs-type">String</span> author, <span class="hljs-type">String</span> category);
    
    <span class="hljs-comment">// 5. 自定义查询（展示真正的技术）</span>
    <span class="hljs-meta">@Query</span>(<span class="hljs-string">"{<span class="hljs-subst">\"</span>bool<span class="hljs-subst">\"</span>: {<span class="hljs-subst">\"</span>must<span class="hljs-subst">\"</span>: [{<span class="hljs-subst">\"</span>match<span class="hljs-subst">\"</span>: {<span class="hljs-subst">\"</span>title<span class="hljs-subst">\"</span>: <span class="hljs-subst">\"</span>?0<span class="hljs-subst">\"</span>}}]}}"</span>)
    <span class="hljs-type">Page</span>&lt;<span class="hljs-type">Book</span>&gt; customSearch(<span class="hljs-type">String</span> keyword, <span class="hljs-type">Pageable</span> pageable);
    
    <span class="hljs-comment">// 6. 统计某个作者有多少书</span>
    <span class="hljs-type">Long</span> countByAuthor(<span class="hljs-type">String</span> author);
}
</code></pre>
<h3 data-id="heading-6">第 5 步：写个“恋爱导师”（Service 层）</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">beans</span>.<span class="hljs-property">factory</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">Autowired</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">data</span>.<span class="hljs-property">domain</span>.<span class="hljs-property">Page</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">data</span>.<span class="hljs-property">domain</span>.<span class="hljs-property">Pageable</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">stereotype</span>.<span class="hljs-property">Service</span>;
<span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">List</span>;
<span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">Optional</span>;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BookService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">BookRepository</span> bookRepository;
    
    <span class="hljs-comment">/**
     * 添加/更新一本书
     * 如果书有id，就是更新；没有id，就是新增
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Book</span> <span class="hljs-title function_">saveBook</span>(<span class="hljs-params">Book book</span>) {
        <span class="hljs-keyword">return</span> bookRepository.<span class="hljs-title function_">save</span>(book);
    }
    
    <span class="hljs-comment">/**
     * 批量添加（ES最喜欢批量操作了，效率高）
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">saveAllBooks</span>(<span class="hljs-params">List&lt;Book&gt; books</span>) {
        bookRepository.<span class="hljs-title function_">saveAll</span>(books);
    }
    
    <span class="hljs-comment">/**
     * 按ID查找（速度飞快）
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Optional</span>&lt;<span class="hljs-title class_">Book</span>&gt; <span class="hljs-title function_">findById</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> id</span>) {
        <span class="hljs-keyword">return</span> bookRepository.<span class="hljs-title function_">findById</span>(id);
    }
    
    <span class="hljs-comment">/**
     * 复杂搜索：按标题和作者搜索
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">Book</span>&gt; <span class="hljs-title function_">searchBooks</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> title, <span class="hljs-built_in">String</span> author</span>) {
        <span class="hljs-comment">// 这里可以写更复杂的逻辑</span>
        <span class="hljs-keyword">if</span> (title != <span class="hljs-literal">null</span> &amp;&amp; author != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> bookRepository.<span class="hljs-title function_">findByTitleContainingAndAuthor</span>(title, author);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (title != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> bookRepository.<span class="hljs-title function_">findByTitleContaining</span>(title);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> bookRepository.<span class="hljs-title function_">findByAuthor</span>(author);
        }
    }
    
    <span class="hljs-comment">/**
     * 删除一本书（谨慎操作！）
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">deleteBook</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> id</span>) {
        bookRepository.<span class="hljs-title function_">deleteById</span>(id);
    }
    
    <span class="hljs-comment">/**
     * 分页查询（大数据量的好朋友）
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Page</span>&lt;<span class="hljs-title class_">Book</span>&gt; <span class="hljs-title function_">findAllBooks</span>(<span class="hljs-params">Pageable pageable</span>) {
        <span class="hljs-keyword">return</span> bookRepository.<span class="hljs-title function_">findAll</span>(pageable);
    }
    
    <span class="hljs-comment">/**
     * 高级搜索：使用QueryBuilder
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">Book</span>&gt; <span class="hljs-title function_">advancedSearch</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> keyword, Double minPrice, Double maxPrice</span>) {
        <span class="hljs-comment">// 使用NativeSearchQueryBuilder构建复杂查询</span>
        <span class="hljs-comment">// 这里先省略，下面会有详细示例</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
}
</code></pre>
<h3 data-id="heading-7">第 6 步：高级搜索的“秘密武器”</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> org.elasticsearch.index.query.BoolQueryBuilder;
<span class="hljs-keyword">import</span> org.elasticsearch.index.query.QueryBuilders;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.<span class="hljs-keyword">annotation</span>.Autowired;
<span class="hljs-keyword">import</span> org.springframework.<span class="hljs-keyword">data</span>.elasticsearch.core.ElasticsearchRestTemplate;
<span class="hljs-keyword">import</span> org.springframework.<span class="hljs-keyword">data</span>.elasticsearch.core.SearchHits;
<span class="hljs-keyword">import</span> org.springframework.<span class="hljs-keyword">data</span>.elasticsearch.core.query.NativeSearchQuery;
<span class="hljs-keyword">import</span> org.springframework.<span class="hljs-keyword">data</span>.elasticsearch.core.query.NativeSearchQueryBuilder;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> java.util.stream.Collectors;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AdvancedSearchService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ElasticsearchRestTemplate elasticsearchRestTemplate;
    
    <span class="hljs-comment">/**
     * 多条件组合搜索（布尔查询）
     */</span>
    <span class="hljs-keyword">public</span> List&lt;Book&gt; multiConditionSearch(String keyword, <span class="hljs-built_in">Double</span> minPrice, 
                                           <span class="hljs-built_in">Double</span> maxPrice, String category) {
        
        <span class="hljs-comment">// 1. 创建布尔查询构建器（相当于SQL的WHERE）</span>
        BoolQueryBuilder boolQuery = QueryBuilders.boolQuery();
        
        <span class="hljs-comment">// 2. 添加必须条件（must = AND）</span>
        <span class="hljs-keyword">if</span> (keyword != <span class="hljs-literal">null</span> &amp;&amp; !keyword.trim().isEmpty()) {
            boolQuery.must(QueryBuilders.multiMatchQuery(keyword, <span class="hljs-string">"title"</span>, <span class="hljs-string">"author"</span>)
                    .analyzer(<span class="hljs-string">"ik_max_word"</span>));
        }
        
        <span class="hljs-comment">// 3. 添加价格范围（range查询）</span>
        <span class="hljs-keyword">if</span> (minPrice != <span class="hljs-literal">null</span> || maxPrice != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">var</span> rangeQuery = QueryBuilders.rangeQuery(<span class="hljs-string">"price"</span>);
            <span class="hljs-keyword">if</span> (minPrice != <span class="hljs-literal">null</span>) {
                rangeQuery.gte(minPrice);
            }
            <span class="hljs-keyword">if</span> (maxPrice != <span class="hljs-literal">null</span>) {
                rangeQuery.lte(maxPrice);
            }
            boolQuery.must(rangeQuery);
        }
        
        <span class="hljs-comment">// 4. 添加分类过滤（filter不计算分数，更快）</span>
        <span class="hljs-keyword">if</span> (category != <span class="hljs-literal">null</span> &amp;&amp; !category.trim().isEmpty()) {
            boolQuery.filter(QueryBuilders.termQuery(<span class="hljs-string">"category"</span>, category));
        }
        
        <span class="hljs-comment">// 5. 构建查询</span>
        NativeSearchQuery searchQuery = new NativeSearchQueryBuilder()
                .withQuery(boolQuery)
                .withSorts(org.springframework.<span class="hljs-keyword">data</span>.elasticsearch.core.query.SortBuilders
                        .fieldSort(<span class="hljs-string">"price"</span>).order(org.springframework.<span class="hljs-keyword">data</span>.domain.Sort.Direction.ASC))
                .withPageable(org.springframework.<span class="hljs-keyword">data</span>.domain.PageRequest.of(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>))
                .build();
        
        <span class="hljs-comment">// 6. 执行查询</span>
        SearchHits&lt;Book&gt; searchHits = elasticsearchRestTemplate.search(searchQuery, Book.<span class="hljs-keyword">class</span>);
        
        <span class="hljs-comment">// 7. 转换结果</span>
        <span class="hljs-keyword">return</span> searchHits.getSearchHits().stream()
                .map(hit -&gt; hit.getContent())
                .collect(Collectors.toList());
    }
    
    <span class="hljs-comment">/**
     * 聚合查询：统计每个分类有多少本书
     */</span>
    <span class="hljs-keyword">public</span> Map&lt;String, <span class="hljs-built_in">Long</span>&gt; categoryStatistics() {
        NativeSearchQuery query = new NativeSearchQueryBuilder()
                .addAggregation(org.springframework.<span class="hljs-keyword">data</span>.elasticsearch.core.query.aggregation.AggregationBuilders
                        .terms(<span class="hljs-string">"category_agg"</span>).field(<span class="hljs-string">"category.keyword"</span>))
                .build();
        
        SearchHits&lt;Book&gt; searchHits = elasticsearchRestTemplate.search(query, Book.<span class="hljs-keyword">class</span>);
        
        <span class="hljs-comment">// 处理聚合结果（这里简化了，实际需要解析Aggregations）</span>
        <span class="hljs-keyword">return</span> new HashMap&lt;&gt;();
    }
}
</code></pre>
<h3 data-id="heading-8">第 7 步：REST API 控制器（对外接口）</h3>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.beans</span><span class="hljs-selector-class">.factory</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.Autowired</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.data</span><span class="hljs-selector-class">.domain</span><span class="hljs-selector-class">.Page</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.data</span><span class="hljs-selector-class">.domain</span><span class="hljs-selector-class">.PageRequest</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.http</span><span class="hljs-selector-class">.ResponseEntity</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.web</span><span class="hljs-selector-class">.bind</span><span class="hljs-selector-class">.annotation</span>.*;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.List</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.Optional</span>;

@<span class="hljs-selector-tag">RestController</span>
@<span class="hljs-selector-tag">RequestMapping</span>(<span class="hljs-string">"/api/books"</span>)
<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">BookController</span> {
    
    <span class="hljs-variable">@Autowired</span>
    private BookService bookService;
    
    <span class="hljs-variable">@Autowired</span>
    private AdvancedSearchService advancedSearchService;
    
    <span class="hljs-comment">/**
     * 创建新书
     */</span>
    <span class="hljs-variable">@PostMapping</span>
    public ResponseEntity&lt;Book&gt; <span class="hljs-built_in">createBook</span>(<span class="hljs-variable">@RequestBody</span> Book book) {
        <span class="hljs-selector-tag">Book</span> <span class="hljs-selector-tag">savedBook</span> = <span class="hljs-selector-tag">bookService</span><span class="hljs-selector-class">.saveBook</span>(book);
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseEntity</span><span class="hljs-selector-class">.ok</span>(savedBook);
    }
    
    <span class="hljs-comment">/**
     * 批量导入（适合初始化数据）
     */</span>
    @<span class="hljs-selector-tag">PostMapping</span>(<span class="hljs-string">"/batch"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">ResponseEntity</span>&lt;<span class="hljs-selector-tag">String</span>&gt; <span class="hljs-selector-tag">batchImport</span>(<span class="hljs-variable">@RequestBody</span> List&lt;Book&gt; books) {
        <span class="hljs-selector-tag">bookService</span><span class="hljs-selector-class">.saveAllBooks</span>(books);
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseEntity</span><span class="hljs-selector-class">.ok</span>(<span class="hljs-string">"成功导入 "</span> + books.<span class="hljs-built_in">size</span>() + <span class="hljs-string">" 本书"</span>);
    }
    
    <span class="hljs-comment">/**
     * 搜索书籍（简单版）
     */</span>
    @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/search"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">ResponseEntity</span>&lt;<span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">Book</span>&gt;&gt; <span class="hljs-selector-tag">searchBooks</span>(
            <span class="hljs-variable">@RequestParam</span>(required = false) String title,
            <span class="hljs-variable">@RequestParam</span>(required = false) String author) {
        
        <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">Book</span>&gt; <span class="hljs-selector-tag">books</span> = <span class="hljs-selector-tag">bookService</span><span class="hljs-selector-class">.searchBooks</span>(title, author);
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseEntity</span><span class="hljs-selector-class">.ok</span>(books);
    }
    
    <span class="hljs-comment">/**
     * 高级搜索（多条件）
     */</span>
    @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/advanced-search"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">ResponseEntity</span>&lt;<span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">Book</span>&gt;&gt; <span class="hljs-selector-tag">advancedSearch</span>(
            <span class="hljs-variable">@RequestParam</span>(required = false) String keyword,
            <span class="hljs-variable">@RequestParam</span>(required = false) Double minPrice,
            <span class="hljs-variable">@RequestParam</span>(required = false) Double maxPrice,
            <span class="hljs-variable">@RequestParam</span>(required = false) String category) {
        
        <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">Book</span>&gt; <span class="hljs-selector-tag">books</span> = <span class="hljs-selector-tag">advancedSearchService</span>
                <span class="hljs-selector-class">.multiConditionSearch</span>(keyword, minPrice, maxPrice, category);
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseEntity</span><span class="hljs-selector-class">.ok</span>(books);
    }
    
    <span class="hljs-comment">/**
     * 分页查询
     */</span>
    @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/page"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">ResponseEntity</span>&lt;<span class="hljs-selector-tag">Page</span>&lt;<span class="hljs-selector-tag">Book</span>&gt;&gt; <span class="hljs-selector-tag">getBooksByPage</span>(
            <span class="hljs-variable">@RequestParam</span>(defaultValue = <span class="hljs-string">"0"</span>) int page,
            <span class="hljs-variable">@RequestParam</span>(defaultValue = <span class="hljs-string">"10"</span>) int size) {
        
        <span class="hljs-selector-tag">Page</span>&lt;<span class="hljs-selector-tag">Book</span>&gt; <span class="hljs-selector-tag">books</span> = <span class="hljs-selector-tag">bookService</span><span class="hljs-selector-class">.findAllBooks</span>(PageRequest.<span class="hljs-built_in">of</span>(page, size));
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseEntity</span><span class="hljs-selector-class">.ok</span>(books);
    }
}
</code></pre>
<h3 data-id="heading-9">第 8 步：配置类（锦上添花）</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> org.elasticsearch.client.RestHighLevelClient;
<span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Configuration;
<span class="hljs-keyword">import</span> org.springframework.<span class="hljs-keyword">data</span>.elasticsearch.client.ClientConfiguration;
<span class="hljs-keyword">import</span> org.springframework.<span class="hljs-keyword">data</span>.elasticsearch.client.RestClients;
<span class="hljs-keyword">import</span> org.springframework.<span class="hljs-keyword">data</span>.elasticsearch.core.ElasticsearchRestTemplate;
<span class="hljs-keyword">import</span> org.springframework.<span class="hljs-keyword">data</span>.elasticsearch.repository.config.EnableElasticsearchRepositories;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableElasticsearchRepositories(basePackages = <span class="hljs-string">"com.yourpackage.repository"</span>)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ElasticsearchConfig</span> {
    
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> RestHighLevelClient elasticsearchClient() {
        ClientConfiguration clientConfiguration = ClientConfiguration.builder()
                .connectedTo(<span class="hljs-string">"localhost:9200"</span>)
                .withBasicAuth(<span class="hljs-string">"elastic"</span>, <span class="hljs-string">"your_password"</span>)
                .withConnectTimeout(<span class="hljs-number">5000</span>)
                .withSocketTimeout(<span class="hljs-number">30000</span>)
                .build();
        
        <span class="hljs-keyword">return</span> RestClients.create(clientConfiguration).rest();
    }
    
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> ElasticsearchRestTemplate elasticsearchRestTemplate() {
        <span class="hljs-keyword">return</span> new ElasticsearchRestTemplate(elasticsearchClient());
    }
}
</code></pre>
<h2 data-id="heading-10">三、测试一下我们的“杰作”</h2>
<h3 data-id="heading-11">测试数据（JSON格式）</h3>
<pre><code class="hljs language-bash" lang="bash">POST /api/books/batch
[
  {
    <span class="hljs-string">"title"</span>: <span class="hljs-string">"SpringBoot从入门到放弃"</span>,
    <span class="hljs-string">"author"</span>: <span class="hljs-string">"程序猿老张"</span>,
    <span class="hljs-string">"price"</span>: 68.5,
    <span class="hljs-string">"category"</span>: <span class="hljs-string">"技术"</span>,
    <span class="hljs-string">"publishDate"</span>: <span class="hljs-string">"2023-01-01"</span>,
    <span class="hljs-string">"tags"</span>: [
      {<span class="hljs-string">"name"</span>: <span class="hljs-string">"Java"</span>, <span class="hljs-string">"priority"</span>: 1},
      {<span class="hljs-string">"name"</span>: <span class="hljs-string">"后端"</span>, <span class="hljs-string">"priority"</span>: 2}
    ]
  },
  {
    <span class="hljs-string">"title"</span>: <span class="hljs-string">"ElasticSearch实战指南"</span>,
    <span class="hljs-string">"author"</span>: <span class="hljs-string">"搜索达人李"</span>,
    <span class="hljs-string">"price"</span>: 89.0,
    <span class="hljs-string">"category"</span>: <span class="hljs-string">"技术"</span>,
    <span class="hljs-string">"publishDate"</span>: <span class="hljs-string">"2023-02-15"</span>,
    <span class="hljs-string">"tags"</span>: [
      {<span class="hljs-string">"name"</span>: <span class="hljs-string">"搜索"</span>, <span class="hljs-string">"priority"</span>: 1},
      {<span class="hljs-string">"name"</span>: <span class="hljs-string">"大数据"</span>, <span class="hljs-string">"priority"</span>: 2}
    ]
  }
]
</code></pre>
<h3 data-id="heading-12">搜索示例</h3>
<pre><code class="hljs language-ini" lang="ini">GET /api/books/search?<span class="hljs-attr">title</span>=SpringBoot&amp;author=程序猿老张
GET /api/books/advanced-search?<span class="hljs-attr">keyword</span>=实战&amp;minPrice=<span class="hljs-number">50</span>&amp;maxPrice=<span class="hljs-number">100</span>
</code></pre>
<h2 data-id="heading-13">四、遇到的“坑”和解决方案</h2>
<ol>
<li>
<p><strong>连接问题</strong>：确保ES服务已启动，检查端口9200</p>
<pre><code class="hljs language-arduino" lang="arduino">curl http:<span class="hljs-comment">//localhost:9200</span>
</code></pre>
</li>
<li>
<p><strong>版本兼容</strong>：SpringBoot版本和ES版本要匹配</p>
<ul>
<li>SpringBoot 2.7.x → ES 7.17.x</li>
<li>SpringBoot 3.x → ES 8.x</li>
</ul>
</li>
<li>
<p><strong>中文分词</strong>：安装IK分词器</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 进入ES容器/安装目录的plugins文件夹</span>
./bin/elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.17.3/elasticsearch-analysis-ik-7.17.3.zip
</code></pre>
</li>
<li>
<p><strong>内存不足</strong>：调整JVM参数</p>
<pre><code class="hljs language-diff" lang="diff"># config/jvm.options
<span class="hljs-deletion">-Xms1g</span>
<span class="hljs-deletion">-Xmx1g</span>
</code></pre>
</li>
</ol>
<h2 data-id="heading-14">五、总结：为什么选择这对“黄金搭档”？</h2>
<h3 data-id="heading-15">SpringBoot + ES = 天作之合</h3>
<p><strong>优点大放送：</strong></p>
<ol>
<li><strong>开发速度</strong>：SpringBoot的自动配置 + ES的简单API = 生产力翻倍</li>
<li><strong>性能表现</strong>：ES的倒排索引 + 分布式架构 = 搜索如飞</li>
<li><strong>扩展性</strong>：微服务架构中，ES可作为独立的搜索服务</li>
<li><strong>生态完善</strong>：Spring Data Elasticsearch 封装了大多数常用操作</li>
<li><strong>实时性</strong>：近实时搜索，数据一秒内可查</li>
</ol>
<h3 data-id="heading-16">适用场景（ES大显身手的时候）</h3>
<ol>
<li><strong>电商网站</strong>：商品搜索、筛选、排序</li>
<li><strong>日志分析</strong>：ELK栈中的核心组件</li>
<li><strong>内容平台</strong>：文章、新闻的全文检索</li>
<li><strong>监控系统</strong>：实时数据分析</li>
<li><strong>推荐系统</strong>：用户行为分析+相似度搜索</li>
</ol>
<h3 data-id="heading-17">最后</h3>
<ul>
<li><strong>不要滥用</strong>：简单的CRUD用MySQL，复杂搜索再用ES</li>
<li><strong>数据同步</strong>：考虑使用Logstash或自定义同步机制</li>
<li><strong>索引设计</strong>：合理的mapping设计是性能的关键</li>
<li><strong>监控告警</strong>：用Kibana监控ES集群健康状态</li>
</ul>
<hr/>
<p>SpringBoot整合ElasticSearch，就像给程序装上了“谷歌大脑”——存得多、找得快、查得准。虽然配置过程像在组装乐高，偶尔会找不到零件（版本兼容），但一旦搭建完成，你就能享受到“秒级搜索”的快感。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79c58b062b574dc1af8c3b721e0928b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oKf56m656CB5a2X:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766460228&amp;x-signature=o4lBBo1a6LzEydy1NhMjtdyxURo%3D" alt="Spring Boot 整合 Elasticsearch 及实战应用.png" loading="lazy"/></p>
<p><strong>谢谢你看我的文章，既然看到这里了，如果觉得不错，随手点个赞、转发、在看三连吧，感谢感谢。那我们，下次再见。</strong></p>
<p>您的一键三连，是我更新的最大动力，谢谢</p>
<p>山水有相逢，来日皆可期，谢谢阅读，我们再会</p>
<p>我手中的金箍棒，上能通天，下能探海</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Git 配置与使用全攻略（含工作流对比与 AI 协作）]]></title>    <link>https://juejin.cn/post/7583983152323903514</link>    <guid>https://juejin.cn/post/7583983152323903514</guid>    <pubDate>2025-12-16T03:22:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583983152323903514" data-draft-id="7583983152323887130" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Git 配置与使用全攻略（含工作流对比与 AI 协作）"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-16T03:22:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="hayzone"/> <meta itemprop="url" content="https://juejin.cn/user/1750078243241607"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Git 配置与使用全攻略（含工作流对比与 AI 协作）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1750078243241607/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    hayzone
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T03:22:23.000Z" title="Tue Dec 16 2025 03:22:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、Git 基础配置与操作流程</h2>
<h3 data-id="heading-1">1. 安装与初始化</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># 下载地址：https://git-scm.com/</span>
<span class="hljs-meta"># 安装后检查版本</span>
git --version

<span class="hljs-meta"># 配置全局身份（必填）</span>
git config --<span class="hljs-keyword">global</span> user.name <span class="hljs-string">"YourName"</span>
git config --<span class="hljs-keyword">global</span> user.email <span class="hljs-string">"your@email.com"</span>

<span class="hljs-meta"># 生成 SSH 密钥（用于远程认证）</span>
ssh-keygen -t rsa -C <span class="hljs-string">"your@email.com"</span>
</code></pre>
<h3 data-id="heading-2">2. 核心操作流程图</h3>
<pre><code class="hljs language-css" lang="css">graph <span class="hljs-selector-tag">TD</span>
    <span class="hljs-selector-tag">A</span><span class="hljs-selector-attr">[初始化仓库]</span> --&gt; <span class="hljs-selector-tag">B</span><span class="hljs-selector-attr">[拉取代码]</span>
    <span class="hljs-selector-tag">B</span> --&gt; C<span class="hljs-selector-attr">[切换分支]</span>
    C --&gt; D<span class="hljs-selector-attr">[修改文件]</span>
    D --&gt; E<span class="hljs-selector-attr">[添加缓存]</span>
    E --&gt; F<span class="hljs-selector-attr">[提交本地]</span>
    F --&gt; G<span class="hljs-selector-attr">[推送远程]</span>
    G --&gt; H<span class="hljs-selector-attr">[合并分支]</span>
</code></pre>
<h3 data-id="heading-3">3. 常用命令速查</h3>




























































<table><thead><tr><th>操作类型</th><th>命令</th><th>说明</th></tr></thead><tbody><tr><td>初始化</td><td><code>git init</code></td><td>创建新仓库</td></tr><tr><td>克隆远程代码</td><td><code>git clone [仓库地址]</code></td><td>复制远程仓库到本地</td></tr><tr><td>分支操作</td><td><code>git checkout [分支名]</code></td><td>切换分支</td></tr><tr><td>状态检查</td><td><code>git status</code></td><td>查看工作区状态</td></tr><tr><td>文件管理</td><td><code>git add .</code></td><td>添加所有文件到缓存区</td></tr><tr><td>提交更改</td><td><code>git commit -m "描述"</code></td><td>提交到本地仓库</td></tr><tr><td>推送远程</td><td><code>git push origin [分支名]</code></td><td>上传到远程服务器</td></tr><tr><td>合并分支</td><td><code>git merge origin/[分支名]</code></td><td>将指定分支合并到当前分支</td></tr><tr><td>撤销合并</td><td><code>git merge --abort</code></td><td>中止未完成的合并操作</td></tr><tr><td>历史追踪</td><td><code>git reflog</code></td><td>查看所有操作记录</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-4">二、Git 工作流实践对比</h2>
<h3 data-id="heading-5">1. 常见工作流模式</h3>
<ul>
<li>
<p><strong>集中式工作流</strong><br/>
所有开发人员直接向主分支提交代码，适合小型团队快速迭代。</p>
</li>
<li>
<p><strong>功能分支工作流</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建功能分支</span>
git checkout -b feature/login
<span class="hljs-comment"># 完成开发后合并回主分支</span>
git checkout main
git merge feature/login
</code></pre>
</li>
<li>
<p><strong>GitFlow 工作流</strong></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-selector-tag">main</span>(生产) ← <span class="hljs-built_in">develop</span>(开发)
      ↗ <span class="hljs-built_in">release</span>(发布) → <span class="hljs-built_in">hotfix</span>(紧急修复)
</code></pre>
</li>
<li>
<p><strong>Trunk-Based 开发</strong><br/>
强调短周期提交（&lt;1天），持续集成测试，适合 CI/CD 流水线。</p>
</li>
</ul>
<h3 data-id="heading-6">2. 与 SVN 的关键差异对比</h3>








































<table><thead><tr><th>特性</th><th>Git (分布式)</th><th>SVN (集中式)</th></tr></thead><tbody><tr><td>架构</td><td>每个开发者独立完整仓库</td><td>依赖中央服务器</td></tr><tr><td>提交速度</td><td>本地提交即时完成</td><td>需要网络连接</td></tr><tr><td>分支管理</td><td>轻量级分支（毫秒级创建）</td><td>重型分支（资源消耗大）</td></tr><tr><td>合并冲突处理</td><td>支持非快进式合并</td><td>必须快进式合并</td></tr><tr><td>数据安全性</td><td>本地备份+远程备份双重保障</td><td>单点故障风险高</td></tr><tr><td>适合场景</td><td>并行开发、开源协作、CI/CD</td><td>传统瀑布式开发、文档版本控制</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-7">三、主流代码托管平台推荐</h2>






























<table><thead><tr><th>平台</th><th>特点</th><th>主要用户群体</th></tr></thead><tbody><tr><td>GitHub</td><td>社区活跃，支持开源项目，集成 CI/CD</td><td>全球开发者、开源爱好者</td></tr><tr><td>GitLab</td><td>企业级解决方案，内置 DevOps 流水线</td><td>企业团队、私有项目</td></tr><tr><td>Gitee</td><td>国内镜像加速，深度集成 AI 协作工具</td><td>中文开发者、企业团队</td></tr><tr><td>Bitbucket</td><td>与 Jira 深度集成，支持私有仓库</td><td>Atlassian 生态用户</td></tr></tbody></table>
<p><em>Gitee AI 协作亮点</em></p>
<ul>
<li>自动 PR 代码审查</li>
<li>智能需求解析（支持自然语言转技术文档）</li>
<li>AI 代码补全（实时提示优化方案）</li>
<li>项目进度预测（基于历史数据的交付时间估算）</li>
</ul>
<hr/>
<h2 data-id="heading-8">四、高级操作与最佳实践</h2>
<h3 data-id="heading-9">1. 提交历史优化</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 修改最近一次提交</span>
git commit --amend

<span class="hljs-comment"># 合并连续提交</span>
git rebase -i HEAD~3
<span class="hljs-comment"># 将 pick 改为 squash 后保存</span>
</code></pre>
<h3 data-id="heading-10">2. 桃花岛操作（Cherry-pick）</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 复制特定提交到当前分支</span>
git cherry-pick <span class="hljs-section">[commit-id]</span>
</code></pre>
<h3 data-id="heading-11">3. 分支变基（Rebase）</h3>
<pre><code class="hljs language-css" lang="css"># 将 feature 分支变基到 <span class="hljs-selector-tag">main</span>
git checkout feature
git rebase <span class="hljs-selector-tag">main</span>
</code></pre>
<h3 data-id="heading-12">4. 撤销操作</h3>
<pre><code class="hljs language-css" lang="css"># 撤销某次提交（保留更改）
git reset <span class="hljs-attr">--mixed</span> <span class="hljs-selector-attr">[commit-id]</span>
# 彻底删除提交
git reset <span class="hljs-attr">--hard</span> <span class="hljs-selector-attr">[commit-id]</span>
</code></pre>
<hr/>
<h2 data-id="heading-13">五、Git 在 AI 项目中的应用</h2>
<ol>
<li>
<p><strong>模型版本管理</strong><br/>
使用 DVC（Data Version Control）配合 Git 管理 ML 模型权重与数据集。</p>
</li>
<li>
<p><strong>AI 代码审查</strong><br/>
Gitee AI 自动检测：</p>
<ul>
<li>代码规范（PEP8/ESLint）</li>
<li>潜在 Bug 预警</li>
<li>性能优化建议</li>
<li>安全漏洞扫描</li>
</ul>
</li>
<li>
<p><strong>智能 PR 生成</strong><br/>
输入自然语言需求 → AI 生成代码草案 → 人工验证 → 提交 PR</p>
</li>
<li>
<p><strong>AI 驱动的分支策略</strong><br/>
根据项目复杂度自动推荐：</p>
<ul>
<li>GitFlow（大型项目）</li>
<li>Feature Toggle（微服务架构）</li>
<li>Monorepo（多语言统一管理）</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-14">六、常见问题排查</h2>
<ol>
<li>
<p><strong>合并冲突解决</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># 标记冲突文件</span>
git status
<span class="hljs-meta"># 手动编辑冲突文件</span>
<span class="hljs-meta"># 标记已解决</span>
git <span class="hljs-keyword">add</span> [文件名]
<span class="hljs-meta"># 完成合并</span>
git commit
</code></pre>
</li>
<li>
<p><strong>密钥丢失恢复</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 重新生成密钥</span>
ssh-keygen -t ed25519 -C <span class="hljs-string">"your@email.com"</span>
<span class="hljs-comment"># 添加到系统</span>
<span class="hljs-built_in">eval</span> <span class="hljs-string">"<span class="hljs-subst">$(ssh-agent)</span>"</span>
ssh-add ~/.ssh/id_ed25519
</code></pre>
</li>
<li>
<p><strong>大文件误提交修复</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 移除文件历史</span>
git <span class="hljs-built_in">filter</span>-branch --tree-<span class="hljs-built_in">filter</span> <span class="hljs-string">'rm -f large_file'</span> HEAD
<span class="hljs-comment"># 强制推送</span>
git push origin --force
</code></pre>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI Coding老跑偏？用Comate Rules功能，少走十年弯路！]]></title>    <link>https://juejin.cn/post/7583955708318613504</link>    <guid>https://juejin.cn/post/7583955708318613504</guid>    <pubDate>2025-12-16T03:28:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583955708318613504" data-draft-id="7583973472322813967" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI Coding老跑偏？用Comate Rules功能，少走十年弯路！"/> <meta itemprop="keywords" content="前端,架构,前端框架"/> <meta itemprop="datePublished" content="2025-12-16T03:28:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="文心快码BaiduComate"/> <meta itemprop="url" content="https://juejin.cn/user/992209294070809"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI Coding老跑偏？用Comate Rules功能，少走十年弯路！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/992209294070809/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    文心快码BaiduComate
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T03:28:27.000Z" title="Tue Dec 16 2025 03:28:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你的Comate，我的Comate，好像不一样？</p>
<p>为什么大佬用AI Coding又快又好，而我总遇到各种阻碍？</p>
<p>原来，是他们已经用上了效率神器——Rules！</p>
<p>没听过、不会用，怎么办？</p>
<p>没关系！我们邀请了<strong>Rules资深用户、前端开发崔同学</strong>，跟大家分享一下——</p>
<p>什么是Rules？为什么要用Rules？还有Rules的使用心得～</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f3e3b2ae0ee245469d66a86a269033bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766460506&amp;x-signature=uJd6mqHOspVfxgGTBHih4ZXVZNQ%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>带好笔记本，下面，让我们一起听听Ta怎么说👇</p>
<h2 data-id="heading-0">01 初识Rules：从陌生到熟练</h2>
<p>😎使用Rules是一个什么样的契机呢？就是之前我和AI Coding对话的时候，比较头疼的一点是，经常遇到<strong>重复性的对话</strong>。后期我发现，每次对话时，保留对话框里的聊天记录，向它提问：“你想想我之前说了什么，再回答我这个问题”，它就会说，“好的，我知道了”。 然后它开始检索之前的聊天记录，就知道怎么做了。</p>
<p>🤔当时我想，<strong>这类无意义的对话可以规避么，不能直接输出之前那种想要的结果吗</strong>？于是我找到研发同学，从他那里了解到 <strong>【Rules】</strong> 。</p>
<p>🤯我第一次试效果也不太理想，感觉区别不大。后面大概用了3天的时间，就配置好了符合我个人习惯的Rules。</p>
<p>😍到现在，<strong>我的日常工作中已经离不开Rules，团队中也配置了Rules</strong>，并且这种Rules是适用于团队所有人且不与自己Rules冲突的。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6fcaa7497c2443ca83dd79b6c16f1a0c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766460506&amp;x-signature=khsMKoNGnoKrjxkczIRSP6wq1OI%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>这样听起来，Rules好像就是一个有memory的AI Coding工具，那它究竟是什么呢？</p>
<p><strong>定义：</strong> 字面翻译为 “规则”，是和 AI工具相辅相成的 “行为规范手册”，约定 AI 工具的执行流程、输出结果和偏好，<strong>让 AI 按个人 or 团队习惯工作，减少弯路和错误</strong>。</p>
<p><strong>Rules 的效果主要分几个层面</strong>：</p>
<p><strong>1. 命名约定 —— 代码界的“起名大会”</strong></p>
<p><strong>有了命名规则之后，模型就能统一风格、保证可读性</strong>。不再出现一堆“temp1”、“data2”、“final_final_true_version”的奇怪名字。从此团队协作更顺畅，调试也不再像拆盲盒。</p>
<p><strong>2.代码结构 —— 给模型戴上“紧箍咒”</strong></p>
<p>代码结构约束就像是给模型戴了个“紧箍咒”。它不允许模型写“俄罗斯套娃”式的嵌套结构，也不允许函数变成一团“意大利面条式”的灾难代码。<strong>有了结构约束后，代码层次清晰、逻辑明了</strong>，就像写作文有大纲，模型不会乱飙自由发挥。</p>
<p><strong>3.业务逻辑层 —— 模型的“逻辑交警”</strong></p>
<p>业务逻辑层是大模型的“脑回路”，而 Rules 在这里扮演的角色，就像一个“逻辑交警”。它负责指挥——“这个流程该往哪跑”、“那个判断在哪停”。<strong>防止模型乱开车、逻辑撞车，让业务流转更顺畅、更可控。</strong></p>
<p><strong>属性：</strong> 不是独立工具，而是 AI 工具的 “优化补充”——AI 像 “百科全书” 懂很多，但 Rules 能明确使用方式，让输出更贴合需求，还能记录用户喜好，更具人性化。</p>
<p><strong>应用：</strong> 我现在常用的AI Coding工具，像<strong>Comate</strong>这种，还是很好用的。面对大量的知识库文档、需求文档时，就可以<strong>让Comate帮我们总结其中的关键信息和功能，再用Rules去输出结果</strong>，<strong>就会更加贴合实际的开发场景，节省了一遍遍调试、输出结果的时间和精力</strong>。</p>
<p>之前的AI Coding我们可以看作是搜索的合集，把所有知识汇总起来，但是不是所有东西都是我们想要的，现在有了Rules帮我们精挑细选过滤掉一些，<strong>最终结果是更加精细、定制化和符合预期的</strong>。</p>
<p>打开Comate IDE，点击更多—Rules，即可书写规则🔽</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54763214e77944f5af8b87ae5d9eae34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766460506&amp;x-signature=GVmdJuuzRv0CO6dVLQj%2FyGakwWo%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h2 data-id="heading-1">02 实战应用：用Rule为电商开发赋能提效</h2>
<p>Rules现在可以说是我不可或缺的工作搭子！在【电商业务前端开发】中，模块和场景的<strong>重复度比较高</strong>，比如某个搜索页、商品卡的模块或者订单列表页大同小异，这时就没必要每一个都去人工生成。</p>
<p>使用<strong>Comate + Rules就可以替我完成这部分重复工作：</strong> 可以<strong>参考demo去生成</strong>，还可以<strong>设置业务规则</strong>（比如所有的价格展示统一使用一个组件、涉及到的订单状态统一维护一个组件等等），以及<strong>定义错误处理机制</strong>，比如所有可能出错的地方，我们都去使用统一的一个机制去处理，例如统一弹出错误信息、异常捕获等......</p>
<p>让我们以一个<strong>数据看板的需求</strong>为例子：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed28c15a768440588ce42b3855d34583~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766460506&amp;x-signature=tHkocwaPAsxu5hBYmfRo9o%2BMuYc%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/809b6d2b34dc4aeb8b504618af8bd660~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766460506&amp;x-signature=OALfbpW0%2BIECT4jq4SDr%2FN8Huac%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h2 data-id="heading-2">03 团队协作：从1天到10分钟，Rules立大功</h2>
<p>Rules的好用不仅体现在提升个人Coding效率上；<strong>团队协作里，匹配上Rules的团队也是如有神助</strong>。它让团队间的不同同学朝着一个方向、按照一个规范产出，这样就大大降低了大家调整风格、统一规范的时间。</p>
<p>在项目中AI Coding 时，我会把所有Rules和团队其他同学规定好，按照这个当前的Rules去实现我们的项目。这样的一个好处是什么呢？我能规定团队其他人和我一样的规则，他会帮你在后续的提交代码和线上的稳定性方面把关，而不是说像之前咱们固有的方式——人工去把关，<strong>我们每一个的代码的质量，代码的风格、代码的流程，现在是通过 AI 工具去帮我们更多的把关</strong>，大大节省了团队成员间协作的成本｡</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8927a07130eb40a9a6616a2406ab4737~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766460506&amp;x-signature=cYiYQh6oKtutuRMeDwV7DOp%2Bc3E%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>跟大家分享2个我最近印象比较深的案例：</p>
<p>✨前阵我们出现了一个 bug，如果正常用人来排查的话，大概需要<strong>1天</strong>时间，但是我通过工具去排查的话，大概<strong>10分钟</strong>排查出的问题，并且帮我改正，这是一个AI提效很好的案例｡</p>
<p>🌟再比如实际开发中，生成页面的任务使用了Rules后可以很快提交，<strong>能从5天压缩到3天</strong>，为什么会有这么快的速度呢？因为一些重复性较高的页面或者模块生成，我们不需要再重复提示大模型，这样就大大提效了。</p>
<p>💫而且在团队推广 Rules 时，大家最担心的其实是代码隐私问题。选用 Comate 也是看重了它的<strong>企业级安全合规</strong>。我们把团队的 Rules 配置好后，一键同步给所有成员，<strong>大家不需要把代码传到不可控的公有云，在保障数据安全的前提下，实现了全员 Coding 效率的飞升。</strong></p>
<h2 data-id="heading-3">04 避坑指南：手把手教你玩转Rules</h2>
<p>最后，我也总结了Rules使用的一些经验和心得，这里分享给大家：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf98f06cca5146b7a32cdb851b66ab71~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766460506&amp;x-signature=VkgD%2BINeWKVSaBRIIjk3YwiNub4%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5260e1fb2d104d44aa9ad1ba9d6a58a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766460506&amp;x-signature=lX3PmA6mzPpDBeIHoDHcQuLyGqA%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>🌟 一言以蔽之，为什么我推荐<strong>用 Comate 跑 Rules</strong>？</p>
<ul>
<li><strong>更懂中文：</strong> 国内业务逻辑和文档理解无障碍，沟通成本低。</li>
<li><strong>反应快：</strong> 尤其是代码续写的速度，配合 Rules 简直是“如丝般顺滑”。</li>
<li><strong>生态好：</strong> 像我们这次提到的 Rules 配置，Comate 的兼容性和执行严格度是我试过工具里表现最好的之一。</li>
</ul>
<p>（本内容由百度崔同学&amp;曹同学提供）</p>
<p><strong>👇 别光心动，现在就上手开造！</strong></p>
<p><strong>一键下载 Comate，把你的脑洞变成现实</strong></p>
<p><strong>方式一：</strong> 点击 <a href="https://link.juejin.cn?target=https%3A%2F%2Fcomate.baidu.com%2Fzh%2Fdownload" target="_blank" title="https://comate.baidu.com/zh/download" ref="nofollow noopener noreferrer">comate.baidu.com/zh/download</a> 下载Comate AI IDE，享受丝滑开发过程</p>
<p><strong>方式二：</strong> 在 VS Code 或 Jetbrains IDE 中搜索“文心快码”插件，安装即用</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[这份中国人写的大模型书，在外网竟然被刷爆了！]]></title>    <link>https://juejin.cn/post/7584014975241797642</link>    <guid>https://juejin.cn/post/7584014975241797642</guid>    <pubDate>2025-12-16T03:29:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584014975241797642" data-draft-id="7582755817670557706" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="这份中国人写的大模型书，在外网竟然被刷爆了！"/> <meta itemprop="keywords" content="LLM,Agent,程序员"/> <meta itemprop="datePublished" content="2025-12-16T03:29:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型教程"/> <meta itemprop="url" content="https://juejin.cn/user/1145012233707299"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            这份中国人写的大模型书，在外网竟然被刷爆了！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1145012233707299/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型教程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T03:29:07.000Z" title="Tue Dec 16 2025 03:29:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2FEnjoyEDU%2FLLM" target="_blank" title="https://gitcode.com/EnjoyEDU/LLM" ref="nofollow noopener noreferrer">这里</a>。</p>
</blockquote>
<p>这本中国人写的大模型书已经在外网被很多人引用为 2025 年最好的大模型教材，reddit、X 上很多人在推荐，有人说第一次知道大模型到底在干嘛。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7142106f98514b5992e661ec575f00e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766460547&amp;x-signature=tfsVimfNJMzb%2FmB9AuMHuQvp7YA%3D" alt="" loading="lazy"/></p>
<p>这本书把transformer 架构、预训练、微调、对齐、推理、token 流过程这些以前绕来绕去的知识点统统串在了一起，构成了一套有体系的解释框架。</p>
<p>它把 Chain-of-Thought（CoT）提示词的原理、发展脉络、不同类型、改进方向全都做了非常细致的归纳，比如：</p>
<p>为什么“分步骤提示”能提升模型的推理能力 ？</p>
<p>自动生成 CoT 的方法有哪些 ？</p>
<p>各类 CoT prompt到底有什么区别？</p>
<p>这些方法在什么场景下有效，什么模型上适配性最好。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9c95de2cd77244bd8feab6c093a4400b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766460547&amp;x-signature=6ewnTNEnZOjUyCm4jyYqaESThrM%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a9517f40e573450aaa86b78d86cf6611~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766460547&amp;x-signature=%2BooWEP37XdhFvPH8T4PkyoDq2Ls%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/20af43abacb0423486ae420165973775~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766460547&amp;x-signature=6lTYzczGAcJ2lXl1dBZQ53lghak%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e1e4ff15a86542c6bae5f2488f5fa473~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766460547&amp;x-signature=s4x54d9Li7vthVj8jkv7Zs17xms%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d5e4194945ab4bbeb961ae88d770f641~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766460547&amp;x-signature=V35X3gZuMUSVYmMfZdlnirbkSx8%3D" alt="" loading="lazy"/></p>
<p>如果你打算了解大模型怎么做逻辑推理、怎么构造有效 prompt，这篇文章的参考价值远高于那些碎片博主总结。</p>
<h2 data-id="heading-0">学习资源推荐</h2>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2FEnjoyEDU%2FLLM" target="_blank" title="https://gitcode.com/EnjoyEDU/LLM" ref="nofollow noopener noreferrer">这里</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[WebP/AVIF 有多香？比 JPEG 小 30%，<picture>标签完美解决兼容性]]></title>    <link>https://juejin.cn/post/7584014975241912330</link>    <guid>https://juejin.cn/post/7584014975241912330</guid>    <pubDate>2025-12-16T03:37:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584014975241912330" data-draft-id="7583948178858917934" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="WebP/AVIF 有多香？比 JPEG 小 30%，&lt;picture&gt;标签完美解决兼容性"/> <meta itemprop="keywords" content="前端,面试,性能优化"/> <meta itemprop="datePublished" content="2025-12-16T03:37:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="PineappleCoder"/> <meta itemprop="url" content="https://juejin.cn/user/3323167184272627"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            WebP/AVIF 有多香？比 JPEG 小 30%，&lt;picture&gt;标签完美解决兼容性
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3323167184272627/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    PineappleCoder
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T03:37:18.000Z" title="Tue Dec 16 2025 03:37:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🖼️ 告别“图多杀猫”：前端图片加载策略全攻略，让你的页面又快又美！</h2>
<blockquote>
<p><strong>前端性能优化专栏 - 第七篇</strong></p>
</blockquote>
<p>在前端性能优化的战场上，<strong>图片</strong>无疑是最大的“资源杀手”。它们通常占据了网页下载体积的<strong>一半以上</strong>。一个图片加载策略不当的网站，就像一辆装满了超重行李的跑车，再好的引擎也跑不快。</p>
<p>本篇，我们就来深入探讨如何系统性地优化图片加载，让你的页面既高清又秒开！</p>
<hr/>
<h3 data-id="heading-1">⚠️ 图片优化的意义：不仅仅是快</h3>
<p>图片优化是一种<strong>系统性工程</strong>，它的意义远超乎“加载快一点”：</p>
<ul>
<li><strong>体积最大：</strong> 图片是网页中体积最大的静态资源之一，优化可显著降低页面首屏加载时间。</li>
<li><strong>影响 SEO：</strong> 页面加载速度是搜索引擎排名的重要指标。</li>
<li><strong>影响转化率：</strong> 页面每延迟一秒，用户流失率和转化率都会受到负面影响。</li>
<li><strong>用户留存：</strong> 快速、流畅的体验是用户留下的关键。</li>
</ul>
<h3 data-id="heading-2">✨ 策略一：格式选择 — 新旧格式的博弈</h3>
<p>选择合适的图片格式是优化的第一步，也是最重要的一步。我们必须根据场景和兼容性，在新旧格式之间做出权衡。</p>
<h4 data-id="heading-3">1. 新一代格式：WebP 与 AVIF</h4>























<table><thead><tr><th>格式</th><th>优势</th><th>适用场景</th><th>兼容性</th></tr></thead><tbody><tr><td><strong>WebP</strong></td><td>更高压缩率，体积比 JPEG 小约 30%，支持无损和有损压缩，支持透明度。</td><td>网页中的大部分图片，尤其是需要透明度的图标。</td><td>广泛支持（Chrome, Firefox, Edge, Safari）。</td></tr><tr><td><strong>AVIF</strong></td><td>基于 AV1 视频编码，压缩率比 WebP 更高，体积更小。</td><td>对性能要求极高，且目标用户群浏览器支持度较高的场景。</td><td>较新，支持度稍低于 WebP。</td></tr></tbody></table>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4a3acb337f824d21b3b4be715a92211d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUGluZWFwcGxlQ29kZXI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766461038&amp;x-signature=iPOITbpHwYrjl96%2BJNyenHlcepI%3D" alt="图片格式体积与质量对比图" loading="lazy"/></p>
<h4 data-id="heading-4">2. 传统格式：JPEG 与 PNG</h4>
<ul>
<li><strong>JPEG：</strong> 适合色彩丰富的<strong>照片</strong>或<strong>大图</strong>，采用有损压缩，不支持透明度。</li>
<li><strong>PNG：</strong> 适合需要<strong>透明背景</strong>的图标、Logo 或截图，采用无损压缩，体积通常较大。</li>
</ul>
<h3 data-id="heading-5">🔄 策略二：响应式图片 — 按需加载的智慧</h3>
<p>在移动设备、平板和高清屏并存的今天，给所有设备都加载同一张大图是极大的浪费。<strong>响应式图片</strong>就是解决这个问题的“智慧大脑”。</p>
<h4 data-id="heading-6">1. <code>srcset</code> 实现分辨率适配</h4>
<p><code>srcset</code> 允许浏览器根据设备的<strong>分辨率</strong>和<strong>视口大小</strong>来选择最合适的图片源。</p>
<pre><code class="hljs language-ini" lang="ini">&lt;img <span class="hljs-attr">srcset</span>=<span class="hljs-string">"image-480w.jpg 480w,
             image-800w.jpg 800w"</span>（图片源的集合）
     <span class="hljs-attr">sizes</span>=<span class="hljs-string">"(max-width: 600px) 480px, 800px"</span>（提供上下文，&lt;=<span class="hljs-number">600</span>像素使用<span class="hljs-number">480</span>，大于使用<span class="hljs-number">800</span>）
     <span class="hljs-attr">src</span>=<span class="hljs-string">"image-800w.jpg"</span>（降级方案，为旧浏览器提供）
     <span class="hljs-attr">alt</span>=<span class="hljs-string">"响应式图片"</span>&gt;
</code></pre>
<ul>
<li><strong><code>srcset</code>：</strong> 告诉浏览器有哪些可用的图片资源及其对应的宽度（<code>w</code>）。</li>
<li><strong><code>sizes</code>：</strong> 告诉浏览器在不同视口大小下，图片将占据的宽度。</li>
<li><strong><code>src</code>：</strong> 作为旧浏览器的<strong>降级方案</strong>，保证兼容性。</li>
</ul>
<h4 data-id="heading-7">2. <code>&lt;picture&gt;</code> 元素实现格式切换</h4>
<p><code>&lt;picture&gt;</code> 元素可以实现更高级的控制，让浏览器根据<strong>格式兼容性</strong>来选择图片源，完美解决新格式的兼容性问题。</p>
<pre><code class="hljs language-bash" lang="bash">&lt;picture&gt;（从上往下依次询问是否符合这个<span class="hljs-built_in">source</span>）
  &lt;<span class="hljs-built_in">source</span> srcset=<span class="hljs-string">"image.avif"</span> <span class="hljs-built_in">type</span>=<span class="hljs-string">"image/avif"</span>&gt;
  &lt;<span class="hljs-built_in">source</span> srcset=<span class="hljs-string">"image.webp"</span> <span class="hljs-built_in">type</span>=<span class="hljs-string">"image/webp"</span>&gt;
  &lt;img src=<span class="hljs-string">"image.jpg"</span> alt=<span class="hljs-string">"多格式图片"</span>&gt;
&lt;/picture&gt;
</code></pre>
<p><strong>工作原理：</strong> 浏览器会从上往下依次检查 <code>&lt;source&gt;</code> 标签，一旦找到一个它支持的 <code>type</code> 或符合条件的 <code>srcset</code>，就会加载该资源，并忽略后续的 <code>&lt;source&gt;</code>。如果所有 <code>&lt;source&gt;</code> 都不支持，则会加载最后的 <code>&lt;img&gt;</code> 标签中的 <code>src</code>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/229ddac3b6894cabadeb7f1b19fddbf0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUGluZWFwcGxlQ29kZXI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766461038&amp;x-signature=dxKr6gYZoMzDofx0H%2BbZhxcCVds%3D" alt="picture 和 srcset 响应式加载示意图" loading="lazy"/></p>
<p><strong>核心优势：</strong></p>
<ul>
<li><strong>浏览器自动选择最佳格式与尺寸</strong>。</li>
<li><strong>避免浪费带宽与不必要的下载</strong>。</li>
</ul>
<h3 data-id="heading-8">🔧 策略三：加载时机 — 懒加载与预加载</h3>
<p>除了图片本身，何时加载图片也至关重要。</p>
<h4 data-id="heading-9">1. 懒加载（Lazy Loading）</h4>
<p>对于<strong>首屏以外</strong>的图片，应采用懒加载。即只有当图片进入或即将进入用户视口时才开始加载。</p>
<ul>
<li>
<p><strong>原生支持：</strong> 现代浏览器已支持 <code>loading="lazy"</code> 属性，无需 JavaScript 库。</p>
<pre><code class="hljs language-ini" lang="ini">&lt;img <span class="hljs-attr">src</span>=<span class="hljs-string">"image.jpg"</span> loading=<span class="hljs-string">"lazy"</span> alt=<span class="hljs-string">"懒加载图片"</span>&gt;
</code></pre>
</li>
</ul>
<h4 data-id="heading-10">2. 预加载（Preloading）</h4>
<p>对于<strong>首屏关键</strong>的图片（如 Logo、背景图），应使用预加载，确保它们尽快被加载。</p>
<ul>
<li>
<p><strong>HTML 标签：</strong></p>
<pre><code class="hljs language-ini" lang="ini">&lt;link <span class="hljs-attr">rel</span>=<span class="hljs-string">"preload"</span> href=<span class="hljs-string">"critical-image.jpg"</span> as=<span class="hljs-string">"image"</span>&gt;
</code></pre>
</li>
</ul>
<h3 data-id="heading-11">✅ 总结与实践：图片优化 Check List</h3>
<p>图片优化是一个多维度的工程，以下是实践中的 Check List：</p>



































<table><thead><tr><th>优化层面</th><th>实践方法</th><th>目标</th></tr></thead><tbody><tr><td><strong>格式层面</strong></td><td>优先使用 <strong>WebP / AVIF</strong>，PNG/JPEG 作为降级。</td><td>最小化文件体积。</td></tr><tr><td><strong>响应式层面</strong></td><td>利用 <strong><code>&lt;picture&gt;</code></strong> 和 <strong><code>srcset</code></strong> 实现格式和尺寸的按需加载。</td><td>避免加载不必要的资源。</td></tr><tr><td><strong>加载层面</strong></td><td><strong>首屏关键图</strong>使用预加载，<strong>非首屏图</strong>使用懒加载。</td><td>优化加载时机，提升首屏速度。</td></tr><tr><td><strong>压缩层面</strong></td><td>在构建阶段使用工具（如 <code>imagemin</code>）进行<strong>自动化无损/有损压缩</strong>。</td><td>保证图片质量的同时进一步减小体积。</td></tr><tr><td><strong>架构层面</strong></td><td>接入 <strong>CDN</strong> 与专业的<strong>图片服务</strong>（如阿里云 OSS、七牛云等）。</td><td>自动处理格式转换、缩放和压缩。</td></tr></tbody></table>
<hr/>
<p><strong>下一篇预告：</strong> 面对大量的图标和小图片，一个个请求不仅慢，还会造成大量的 HTTP 开销。下一篇我们将探讨如何将这些零散的资源“打包”起来，学习 <strong>雪碧图（CSS Sprites）</strong> 的原理和实践，以及如何利用它来优化 <strong>SVG</strong> 的加载。敬请期待！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android 宣布 Runtime 编译速度史诗级提升：在编译时间上优化了 18%]]></title>    <link>https://juejin.cn/post/7583980250733969471</link>    <guid>https://juejin.cn/post/7583980250733969471</guid>    <pubDate>2025-12-16T03:40:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583980250733969471" data-draft-id="7583933107690750015" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android 宣布 Runtime 编译速度史诗级提升：在编译时间上优化了 18%"/> <meta itemprop="keywords" content="前端,Android,Flutter"/> <meta itemprop="datePublished" content="2025-12-16T03:40:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="恋猫de小郭"/> <meta itemprop="url" content="https://juejin.cn/user/817692379985752"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android 宣布 Runtime 编译速度史诗级提升：在编译时间上优化了 18%
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/817692379985752/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    恋猫de小郭
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T03:40:54.000Z" title="Tue Dec 16 2025 03:40:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>近期，<strong>Android 官方宣布了 Android Runtime 在编译时间上实现了 18% 的显著优化，同时不牺牲编译代码的质量，也没有增加峰值内存使用</strong>，换句话说，这属于是一个“<strong>速度提升 + 零损失</strong>”的优化成果。</p>
<p>实际上这个调整作为 2025 年的关键 KPI ，目前已经实现了分阶段 rollout：<strong>部分优化已经在 2025 年 6 月的 Android 发布中上线，其余会在年底发布中完成</strong>，所有运行 Android 12 及以上版本的用户都可以通过 mainline 更新得到这些改进。</p>
<blockquote>
<p>“mainline 更新”（ Project Mainline / Google Play System Updates） 是一种模块化更新机制，它支持 Google 通过 Google Play 直接更新 Android 系统的核心组件（如Android Runtime、媒体框架、安全模块等），这个更新不需要用户等待 OTA 。</p>
</blockquote>
<p>而这次优化更加具体的说就是：</p>
<ul>
<li><strong>编译时间减少了 18%</strong></li>
</ul>

<ul>
<li>对编译器最终输出质量没有负面影响</li>
</ul>

<ul>
<li>没有出现内存回归（就是提升过程中不增加内存占用峰值）</li>
</ul>
<p>并且，这些改进对于 JIT 和 AOT（预先编译） 都有用，当然<strong>这里提到的 Android Runtime（ART）“编译速度”不是你在本地用 Gradle 构建 APK 的速度，而是「设备端 ART 对 app 字节码进行 AOT / JIT 编译的速度」</strong> ，一般而言针对ART 内部的“编译器执行速度”会有：</p>
<ul>
<li>JIT 编译速度</li>
<li>AOT / dex2oat 编译速度</li>
<li>编译器各个 IR / 优化 pass 的执行时间</li>
</ul>
<p>例如在 ART 里有很多 pass（比如 GVN、某些数据流分析），每次都会遍历 IR，即使当前方法根本不满足优化条件也会完整跑一遍逻辑，这种行为带来的开销并没有产生收益：</p>
<blockquote>
<p>官方提到，在之前有一个名为全局值编号 (GVN) 的阶段，这个过程里它有一个名为 <code>Kill</code> 的方法，这个方法会根据过滤器删除一些节点，由于它需要遍历所有节点并逐个检查，因此非常耗时，而事实上无论当时有多少节点存活，其实都能预先知道检查结果为 false ，那么在这种情况下完全可以跳过遍历，从而将性能消耗从 1.023% 降低到约 0.3%，并将 GVN 的运行时间缩短约 15%。</p>
</blockquote>
<p>其他的一些案例，包括有：</p>
<h4 data-id="heading-0"><code>FindReferenceInfoOf</code> 的查找优化</h4>
<p><code>LoadStoreAnalysis</code> 阶段的方法 <code>FindReferenceInfoOf</code> 原本使用线性搜索 O(n) 在向量中查找，而现在将数据结构改为以指令 ID 为索引，实现 O(1) 查找，并预分配向量以避免 resize ， <strong>从而在这个阶段加速 34 - 66%，总编译时间提升 0.5-1.8%，虽然增加了一个计数字段，但峰值内存没有增加</strong>。</p>
<h4 data-id="heading-1">结构调整</h4>
<p>代码库中使用了一个自定义的 <code>HashSet</code>，多年前是为了处理极少数的大型集合而优化的，但现在的用法变成了创建大量小型的、短生命周期的集合，所以本地调整实现以适应“小而短”的用法，减少创建和销毁开销，<strong>从而让编译时间提升 1.3-2%，且内存使用量反而下降了 0.5-1%</strong> 。</p>
<p>还有通过将数据结构以引用方式传递给 lambda 表达式，避免了数据结构的复制，从而将编译时间缩短了约 0.5% 到 1% ，这一点在最初的代码审查中被忽略了，并在代码库中保留了多年：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5884e1bdbb1451ba34bb04a5b1dcd18~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766461254&amp;x-signature=OnHrUf%2B0SjuZ0%2FkUTWq74fGATSo%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-2">内联 (Inlining) 检查</h4>
<p>编译器为了性能会内联函数，原本的流程是先计算大量数据，最后再做“最终检查”（如指令数、寄存器需求）决定是否内联，而现在将这些检查从“计算后”移到了“计算前”作为启发式规则（Heuristics），避免了大量无效计算，<strong>仅指令数检查一项的移动就带来了约 2% 的提升</strong>。</p>
<p>事实上官方在进行这些调整时也遇到了不少问题，因为即使你发现某个区域占用了大量编译时间，并且投入了开发时间尝试改进，有时也找不到解决方案，当你修改了 A 问题后，自然而然就带了 B 问题，比如：</p>
<ul>
<li><strong>内存回归</strong> ：在优化“输出写入”阶段时，团队通过缓存计算值来加速（原本预计提升 1.3-2.8%），但自动化测试时发现，额外的缓存数据结构导致了内存使用量的显著增加</li>
<li><strong>历史遗留负担</strong> ：许多低效代码是因为历史原因遗留下来的（比如上述的 <code>HashSet</code>），或者是因为代码审查疏忽（将对象按值传递而不是按引用传递）</li>
<li><strong>复杂度的权衡</strong> ：某些优化方案可能过于复杂，或者会增加代码维护难度</li>
</ul>
<p>针对这些问题，官方进行了一系列的调整尝试：</p>
<ul>
<li><strong>重构解决内存回归</strong> ：针对“输出写入”阶段的内存问题，本次直接重构了该阶段的逻辑，这里设计了一种新方案，移除了两个冗余数据结构中的一个，这不仅解决了内存回退问题，还进一步提升了 0.5-1.8% 的速度<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/50691e9c962d41e7b558bfec3faf585d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766461254&amp;x-signature=y4RTZRiorDUOScj7jbBlN682d%2BM%3D" alt="" loading="lazy"/></li>
<li><strong>使用 pprof 进行深度分析</strong> ：利用 <code>pprof</code> 工具生成 Flame Graph和 Bottom-up 视图，精准定位那些“隐形”的开销（如频繁的 <code>Kill</code> 方法或意外的对象拷贝）<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/44d769a04d2c4ba09f63dd56f255a84b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766461254&amp;x-signature=oJMfUQSxGNIY9tA4UfQDKs01wwk%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f8a0e32ebaca42288fd5b5af85f5da4c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766461254&amp;x-signature=Y8%2B%2FsUtI717%2BYsyJ%2FxFtXxUsP9E%3D" alt="" loading="lazy"/></li>
<li><strong>“快速迭代”策略</strong> ：为了节省开发时间，先用原型（Prototype）在典型应用（First-party apps, Android OS）上快速验证想法，确认收益后再进行完整的工程实现和测试</li>
<li><strong>利用全新 C++ 特性</strong> ：比如使用 <code>BitVectorView</code> 替代可变长的 <code>BitVector</code>，并利用模板化实现让 <code>Union()</code> 操作在 64 位平台上一次处理两倍的位数</li>
</ul>
<p>除此之外还有：</p>
<ul>
<li><a href="https://link.juejin.cn?target=http%3A%2F%2Fr.android.com%2F3469440" target="_blank" title="http://r.android.com/3469440" ref="nofollow noopener noreferrer">Add bookkeeping</a> 将编译时间缩短约 0.6-1.6%</li>
<li><a href="https://link.juejin.cn?target=http%3A%2F%2Fr.android.com%2F3492151" target="_blank" title="http://r.android.com/3492151" ref="nofollow noopener noreferrer">Lazily compute data</a> 来避免循环计算</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fandroid.googlesource.com%2Fplatform%2Fart%2F%2B%2Fbd15b243cda3f9c5038b76099e703e050890f280%255E!%2F%23F0" target="_blank" title="https://android.googlesource.com/platform/art/+/bd15b243cda3f9c5038b76099e703e050890f280%5E!/#F0" ref="nofollow noopener noreferrer">Refactor our code</a> 跳过不会用到的预计算工作</li>
<li><a href="https://link.juejin.cn?target=http%3A%2F%2Fr.android.com%2F3497214" target="_blank" title="http://r.android.com/3497214" ref="nofollow noopener noreferrer">Avoid some dependent load chains</a> 如果可以从其他地方轻松获取 allocator</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fandroid.googlesource.com%2Fplatform%2Fart%2F%2B%2Fbf625ebd279484bc5b0214e1659797dac2f27c8d%255E!%2F%23F0" target="_blank" title="https://android.googlesource.com/platform/art/+/bf625ebd279484bc5b0214e1659797dac2f27c8d%5E!/#F0" ref="nofollow noopener noreferrer">避免在寄存器分配中频繁地对寄存器类型（核心/浮点）进行分支</a></li>
<li><a href="https://link.juejin.cn?target=http%3A%2F%2Fr.android.com%2F3802063" target="_blank" title="http://r.android.com/3802063" ref="nofollow noopener noreferrer">确保某些数组</a>在编译时已初始化，不要依赖 clang 来完成这项工作</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fandroid.googlesource.com%2Fplatform%2Fart%2F%2B%2F77a5d1e6464a03460fad1daa6f357f3a9e5d8f19%255E!%2F%23F0" target="_blank" title="https://android.googlesource.com/platform/art/+/77a5d1e6464a03460fad1daa6f357f3a9e5d8f19%5E!/#F0" ref="nofollow noopener noreferrer">优化一些循环 </a>，使用范围循环，因为 clang 可以更好地优化范围循环，避免因循环副作用而重新加载容器的内部指针，避免在循环中通过内联的 <code>InputAt(.)</code> 为每个输入调用虚函数 <code>HInstruction::GetInputRecords()</code></li>
<li>利用编译器优化，<a href="https://link.juejin.cn?target=https%3A%2F%2Fandroid.googlesource.com%2Fplatform%2Fart%2F%2B%2F85f6b01b978b0543e964fa65d9d66adfedfd90cb%255E!%2F%23F0" target="_blank" title="https://android.googlesource.com/platform/art/+/85f6b01b978b0543e964fa65d9d66adfedfd90cb%5E!/#F0" ref="nofollow noopener noreferrer"> 避免在访问者模式中使用 Accept() 函数</a></li>
</ul>
<h2 data-id="heading-3">最后</h2>
<p>最后，看不懂不要紧，只需要知道它很牛逼，并且还能让 Android 12 以后的机器变得更快，在用户端体现出来就是：</p>
<ul>
<li>app 启动更快</li>
<li>冷启动更少卡顿</li>
<li>低端机更友好</li>
<li>安装 / 更新变快</li>
</ul>
<p>同时也展示了教科书级别的优化策略，不仅要看速度，更要看内存、稳定性、可维护性等综合指标，所以官方这份报告不仅仅是技术公告，更是一份优秀的编译器工程的案例研究。</p>
<h2 data-id="heading-4">参考链接</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fandroid-developers.googleblog.com%2F2025%2F12%2F18-faster-compiles-0-compromises.html" target="_blank" title="https://android-developers.googleblog.com/2025/12/18-faster-compiles-0-compromises.html" ref="nofollow noopener noreferrer">android-developers.googleblog.com/2025/12/18-…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript 变量的江湖恩怨：一篇文章彻底讲清楚]]></title>    <link>https://juejin.cn/post/7583921477614125091</link>    <guid>https://juejin.cn/post/7583921477614125091</guid>    <pubDate>2025-12-16T02:00:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583921477614125091" data-draft-id="7583921477614108707" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript 变量的江湖恩怨：一篇文章彻底讲清楚"/> <meta itemprop="keywords" content="前端,面试,JavaScript"/> <meta itemprop="datePublished" content="2025-12-16T02:00:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="软件求生"/> <meta itemprop="url" content="https://juejin.cn/user/1038379932466263"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript 变量的江湖恩怨：一篇文章彻底讲清楚
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1038379932466263/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    软件求生
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:00:07.000Z" title="Tue Dec 16 2025 02:00:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>很久很久以前，在 JavaScript 世界里，有一个叫<strong>变量镇</strong>的地方。这里住着三兄弟：<strong>var、let、const</strong>。他们都能“装东西”，但性格、规矩、出身背景完全不一样。也正因为这三兄弟的性格差异，程序员江湖里每天都在上演各种事故现场。</p>
<p>今天，我就带你走进变量镇，看看他们各自是怎么“翻车”的，又该如何正确相处。</p>
<h2 data-id="heading-0">老大哥 var：江湖老油条</h2>
<p><strong>1、var 关键字：最早的居民</strong></p>
<p>var 是 JavaScript 最早的变量声明方式，堪称<strong>上古神器</strong>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28deaf0d6a844195bc7caa30a7d83813~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=K5h9NfGX4vJhCr5eXQY39Yn1TC8%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>在 ES6 之前，整个变量镇几乎被 var 一统江湖。但问题也正是从这里开始的。</p>
<p><strong>2、 var 声明作用域：没有块级概念</strong></p>
<p>在变量镇里，var 有个非常“随意”的性格：<strong>它只认函数，不认花括号。</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/90c1c989eb804ddca7096d90f7f8ed13~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=gy9p6ovTp72ZeMgJwkIjCgGyphM%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>很多新手第一次看到这个结果时，内心都是崩溃的：</p>
<blockquote>
<p>“不是写在 if 里面吗？怎么跑出来了？”</p>
</blockquote>
<p>在 var 眼里，if、for、while 都不算地盘，只有<strong>函数</strong>才算真正的边界。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c521decb3ca434bad59a00cd849abd9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=GQ89rjnJsrksrRD9q7j2zUKqfJM%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><strong>总结一句话：</strong></p>
<blockquote>
<p>var 只有<strong>函数作用域</strong>，没有<strong>块级作用域</strong>。</p>
</blockquote>
<p><strong>3、 var 声明提升：先上车后补票</strong></p>
<p>var 还有一个让人又爱又恨的能力——<strong>声明提升</strong>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28e9618edf554564a30ece01961a99d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=quTfGnFQINMvYsufwrgWLwHK65E%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>在 JavaScript 引擎眼里，上面的代码其实是这样执行的：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a44dab9927434a12bc7492bc16cfd15a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=NEN3PckLYYbDzc1WN0YmdrVjsyI%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>变量声明被“偷偷”提到了最前面，但赋值还在原地。这就像你先报了名字进群，但个人资料还没填完。</p>
<p><strong>风险点：</strong></p>
<ul>
<li>不报错</li>
<li>但结果是 undefined</li>
<li>很容易掩盖 bug</li>
</ul>
<h2 data-id="heading-1">二哥 let：讲规矩的现代青年</h2>
<p>后来，ES6 来了，变量镇迎来了新居民：<strong>let</strong>。</p>
<p><strong>1、let 声明：有边界感的人</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e565c0f2e2e4bdeb395f4761792a373~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=caJzDKseBQ8go%2FV7Pnobl%2Bnvi6g%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>let 的出现，第一件事就是：<strong>给变量加上边界感。</strong></p>
<p><strong>2、 暂时性死区：我没到，你别碰</strong></p>
<p>let 有一个非常重要的概念：<strong>暂时性死区（TDZ）</strong> 。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/582ff83b22fe4eb489cc1741590d777a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=MVK95A9FF28Icyo9cto7YH3KAfw%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>直接报错：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/01e120eb692d4432b224699cb9db5bfd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=CemmIat1%2Bg5sceDsIwjyRVmGHis%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>在 let 看来：“你可以提前知道我会来，但在我真正登场之前，你不能碰我。”</p>
<p>这和 var 的“先声明后赋值”完全不同。</p>
<p><strong>3、 let 的块级作用域</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ed80bd1aa9245d193e6ae511c39ea52~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=9S3ym4G83zBZUXoGpnJbSdwbgzU%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>这一次，变量终于<strong>老老实实待在自己的花括号里</strong>。</p>
<p>这也是 let 最大的价值之一：<strong>减少变量污染，降低心智负担。</strong></p>
<p><strong>4、 全局声明：不会挂到 window 上</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d178b524c6da45748148b6ac15cfb3da~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=mUPRLfA0g5oII5VMsQv79gLIVnE%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>而如果是 var：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e4b9c139ee648a0a970f8173e678795~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=5JUs6kK%2FRjSDmhQ4prqVxLJgdoM%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>这意味着：</p>
<ul>
<li>var 会污染全局对象</li>
<li>let 不会</li>
</ul>
<p>在大型项目里，这一点尤为重要。</p>
<p><strong>5、 for 循环中的 let：为循环而生</strong></p>
<p>这是 let 最让人拍手叫好的地方。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b857d92ae73f4ac59dc1234451dd9237~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=4ZXthja%2Bp3xGjeZbsNk6I057lQU%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>输出结果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8d7d53fafa7c45f9b4f1ad5e23dd2899~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=vY7c0QgEmmyV93zs5yx7A48KWc0%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>如果换成 var：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/22f1769498364d04869548c5da3453e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=yy6fYvuds95yKSH3aj6lnJSbs0I%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>结果是：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1941834751b74ef4b0fa4655cf95b9ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=aQIQXRRrXyep9BLeErfEykt7A4s%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>原因很简单：</p>
<ul>
<li>var 只有一个 i</li>
<li>let 每次循环都会创建一个新的 i</li>
</ul>
<p><strong>一句话总结：</strong> 只要是循环变量，<strong>优先 let</strong>。</p>
<h2 data-id="heading-2">三弟 const：外冷内热的守护者</h2>
<p><strong>1、const 声明：不可变的承诺</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/00cd682707604f38ac220f49152b3557~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=HXpQGuXLZUCN%2BxA%2Fz%2BSWT3R9hLg%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>const 的核心思想是：<strong>一旦绑定，就不能重新绑定。</strong></p>
<p>但很多人会误解这一点。</p>
<p><strong>2、const 并不等于“值不可变”</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7ab00b41a524ccc9fead1cae57efaf5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=1kSW7Q8nuOJ5nYSNVYcKuxVryfc%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>真正不能做的是：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/082a2566fb12457884a6a0a87bace289~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=DpbQbIDRMsvxpRba39hUvWF80BA%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>也就是说：</p>
<ul>
<li>const 锁的是<strong>引用</strong></li>
<li>不是对象内部的属性</li>
</ul>
<h2 data-id="heading-3">三兄弟性格对比表</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f4560ae2f8654a0187941b086fe36a3f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=nEue4PvJZSvSHs77j1%2B3weI8cn8%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h2 data-id="heading-4">声明风格及最佳实践</h2>
<p>讲完故事，我们回到现实世界。</p>
<p><strong>1、 不使用 var</strong></p>
<p>这是现代 JavaScript 项目的共识。原因很简单：</p>
<ul>
<li>容易产生隐式 bug</li>
<li>作用域不直观</li>
<li>不符合现代工程化需求</li>
</ul>
<p>除非你在维护<strong>非常古老的代码</strong>，否则：<strong>请忘记 var 的存在。</strong></p>
<p><strong>2、 const 优先，let 次之</strong></p>
<p>这是我在团队里反复强调的一条规则。<strong>推荐顺序：</strong></p>
<ol>
<li>能用 const 就用 const</li>
<li>需要重新赋值时，用 let</li>
<li>永远不要用 var</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5bb341c4c39f42f7ad5099fcd910ee3b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=q79NRTPN5SeETVz4kiv6MTi5ePo%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>这样做的好处是：</p>
<ul>
<li>一眼就能看出哪些变量不会变</li>
<li>降低认知成本</li>
<li>代码更安全、更自解释</li>
</ul>
<h2 data-id="heading-5">总结：变量，其实是人的影子</h2>
<p>写到这里，我越来越觉得：</p>
<blockquote>
<p>JavaScript 的变量声明，其实特别像人。</p>
<p>var 像没边界感的老前辈，热心但容易添乱</p>
<p>let 像讲规则的现代职场人，清晰、可靠</p>
<p>const 像立下承诺的人，一旦决定就不会轻易改变</p>
</blockquote>
<p>当你开始<strong>认真选择变量声明方式</strong>的时候，说明你已经不再只是“写能跑的代码”，而是在写<strong>长期可维护的工程</strong>。</p>
<h2 data-id="heading-6">END</h2>
<p>如果你觉得这篇文章对你有帮助，欢迎<strong>点赞、在看、转发</strong>，让更多人认识变量镇的三兄弟。</p>
<p>我是小米，一个喜欢分享技术的31岁程序员。如果你喜欢我的文章，欢迎关注我的微信公众号“<strong>软件求生</strong>”，获取更多技术干货！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用 pnpm + Workspaces 构建 Monorepo 的完整指南]]></title>    <link>https://juejin.cn/post/7583970267132821510</link>    <guid>https://juejin.cn/post/7583970267132821510</guid>    <pubDate>2025-12-16T02:05:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583970267132821510" data-draft-id="7583980250733232191" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用 pnpm + Workspaces 构建 Monorepo 的完整指南"/> <meta itemprop="keywords" content="前端,JavaScript,Vue.js"/> <meta itemprop="datePublished" content="2025-12-16T02:05:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="NolanKy"/> <meta itemprop="url" content="https://juejin.cn/user/2841599197616894"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用 pnpm + Workspaces 构建 Monorepo 的完整指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2841599197616894/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    NolanKy
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:05:01.000Z" title="Tue Dec 16 2025 02:05:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    22
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin:30px 0 10px;color:#cca152;position:relative;padding-left:50px;border-bottom:2px solid rgba(209,163,78,.6);padding-bottom:0}.markdown-body h1{font-size:30px}.markdown-body h1:before{content:"";width:50px;height:42px;display:block;position:absolute;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACcAAAAhBAMAAACo1K8bAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAFZaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CkzCJ1kAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAnUExURUdwTMyhUsqkUMyhUsyiUcyhUsyhUsyhUcyhUsyhUs2hUtytWNWoVX44si8AAAAKdFJOUwD8Bfcge95QncCWSSDAAAABh0lEQVQoz2WSPUvDQBjHjyPSOB7drh2OUOs36NA6pKAFwaEo4tDFIUWxGYLgKw4BEYUuHaQg7XJ0kccsUmrT2qUUQZp8KO/y1hSfIYEf/5eHu0MoGU1+sIbSw5Bypd92S+dWWrd34b15vuOPY4QxuvtYZp0lIVk3Zgjt+5zkh12AvBHnbW85BOjXySPwhc5CYcY0OdDh5dEUqIEj4cN8Dty3a1MqYJS4MaWU5wzVLwMMxqGSNQgA/VFa4gf50yhxSUW+db8ACa2gBxfnABVDFYHCPYrc7TLwCepJM8/ZoVsRwpxdHEozHUXd6idwVzFFM5BFmIhQVQjrNdnCvdd48wblI2VHtsAZioSsTYVwLoXvjMXH1icuNgPhQE+Ot1+xi8HeA3d1Df1f1JPVUOmsYLujBjuSySqSXYt+yTwbJ0pcyIhqTrxkn0BazRLizJosxRBued+z0jPD6VewOXl5utHRGmMNK3k0iTkzxpq2/oIQO6gLprF12kT/R20eyzlcg7iwK0dPsz/ibpdsCHweWwAAAABJRU5ErkJggg==) 0 0 no-repeat;background-size:80%;bottom:-10px;left:-2px}.markdown-body h2{font-size:24px}.markdown-body h2:before{content:"";width:50px;height:42px;display:block;position:absolute;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACcAAAAhBAMAAACo1K8bAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAFZaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CkzCJ1kAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAnUExURUdwTMyhUsqkUMyhUsyiUcyhUsyhUsyhUcyhUsyhUs2hUtytWNWoVX44si8AAAAKdFJOUwD8Bfcge95QncCWSSDAAAABh0lEQVQoz2WSPUvDQBjHjyPSOB7drh2OUOs36NA6pKAFwaEo4tDFIUWxGYLgKw4BEYUuHaQg7XJ0kccsUmrT2qUUQZp8KO/y1hSfIYEf/5eHu0MoGU1+sIbSw5Bypd92S+dWWrd34b15vuOPY4QxuvtYZp0lIVk3Zgjt+5zkh12AvBHnbW85BOjXySPwhc5CYcY0OdDh5dEUqIEj4cN8Dty3a1MqYJS4MaWU5wzVLwMMxqGSNQgA/VFa4gf50yhxSUW+db8ACa2gBxfnABVDFYHCPYrc7TLwCepJM8/ZoVsRwpxdHEozHUXd6idwVzFFM5BFmIhQVQjrNdnCvdd48wblI2VHtsAZioSsTYVwLoXvjMXH1icuNgPhQE+Ot1+xi8HeA3d1Df1f1JPVUOmsYLujBjuSySqSXYt+yTwbJ0pcyIhqTrxkn0BazRLizJosxRBued+z0jPD6VewOXl5utHRGmMNK3k0iTkzxpq2/oIQO6gLprF12kT/R20eyzlcg7iwK0dPsz/ibpdsCHweWwAAAABJRU5ErkJggg==) 0 0 no-repeat;background-size:70%;bottom:-15px;left:-1px}.markdown-body h3{font-size:18px}.markdown-body h3:before{content:"";width:50px;height:42px;display:block;position:absolute;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACcAAAAhBAMAAACo1K8bAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAFZaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CkzCJ1kAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAnUExURUdwTMyhUsqkUMyhUsyiUcyhUsyhUsyhUcyhUsyhUs2hUtytWNWoVX44si8AAAAKdFJOUwD8Bfcge95QncCWSSDAAAABh0lEQVQoz2WSPUvDQBjHjyPSOB7drh2OUOs36NA6pKAFwaEo4tDFIUWxGYLgKw4BEYUuHaQg7XJ0kccsUmrT2qUUQZp8KO/y1hSfIYEf/5eHu0MoGU1+sIbSw5Bypd92S+dWWrd34b15vuOPY4QxuvtYZp0lIVk3Zgjt+5zkh12AvBHnbW85BOjXySPwhc5CYcY0OdDh5dEUqIEj4cN8Dty3a1MqYJS4MaWU5wzVLwMMxqGSNQgA/VFa4gf50yhxSUW+db8ACa2gBxfnABVDFYHCPYrc7TLwCepJM8/ZoVsRwpxdHEozHUXd6idwVzFFM5BFmIhQVQjrNdnCvdd48wblI2VHtsAZioSsTYVwLoXvjMXH1icuNgPhQE+Ot1+xi8HeA3d1Df1f1JPVUOmsYLujBjuSySqSXYt+yTwbJ0pcyIhqTrxkn0BazRLizJosxRBued+z0jPD6VewOXl5utHRGmMNK3k0iTkzxpq2/oIQO6gLprF12kT/R20eyzlcg7iwK0dPsz/ibpdsCHweWwAAAABJRU5ErkJggg==) 0 0 no-repeat;background-size:60%;bottom:-19px;left:-2px}.markdown-body h4{font-size:16px;padding-left:0;border-bottom:1px solid rgba(209,163,78,.6)}.markdown-body h5{font-size:15px;padding-left:0}.markdown-body em{color:#cca152}.markdown-body del{text-decoration-color:#cca152;text-decoration-thickness:2px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:80%;margin:6px auto;box-shadow:0 6px 15px #8e8e8e;display:block;margin:20px auto!important;object-fit:contain;border-radius:8px}.markdown-body hr{border:none;border-top:2px solid #e0c9a1;margin-top:32px 0}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background:#f6efde;color:#b69454;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Mono,Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;background:#fef6e1;border-radius:4px;box-shadow:0 0 8px hsla(0,0%,47%,.45)}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAOCAMAAABaWb9VAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAFZaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CkzCJ1kAAAAJcEhZcwAADsQAAA7EAZUrDhsAAACHUExURUdwTMxCKdc8NvdYT/9hVyLJPABBAGubKNiIOv+/K+ytJBakH9aZG+5QR5VZDOBDPhmtJ8+VGuGjH/CwJR26MR6+NBq0LPW1KBmwKetNRfJUTONHP92fHuSmIeFEPhu3LR29M/BTS+mqIuqsI5qdHyLKPP++Kv9gVf9lW//KLSXXQCTQP//FLMVm5KQAAAAldFJOUwAlPPz7+woBBPu8Mzu+FlRRKmvnweeG+Wqg6mVNXmuc1OCbmjZJWF/9AAABKklEQVQoz3WS6XaCMBCFRzAM++KGsqhtDwES3//5OtmA2uP9A9zwzRoAgBC0QgQrdA68OZsDr229YGHoIEj7Pl0ZOgjKa5lYJ4Rd1vijn3nuD4Qurjmv48o6RFyfbGDnS6DeEXZfk5ZfuBhdPb9I87ECNMh1EFJKIU6agWzaa01NbmLkxznSmmObJBkkUxrERf3i+ftRiZi7ShPCYY64UhTx1AR5CDYoMXkOKEY7GmTcTzeD/FiER68DfSLgSRqEIBoB3P8h3x8RZhBXGJGusJdD6rfCBl0YqvZNkrV9zej2cWlfJWG6fRpyM41qYH+GTPPi2yFLQYC0Qybm5o96lW77kMbcrBKtgeWTsthVamNXFF4I6x0DTPuugsVRFyYpyxzWqNvHJwed8ws7QyP1UwjNjwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#fef6e1}.markdown-body a{text-decoration:none;color:#d8ac5a;border-bottom:1px solid #d8ac5a}.markdown-body a:active,.markdown-body a:hover{color:#93753f;border-color:#93753f}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f4e8c7;border-collapse:collapse}.markdown-body thead{background:rgba(255,227,176,.6588235294);text-align:left;display:table-header-group;border-bottom:1px solid rgba(255,227,176,.6588235294)}.markdown-body tbody{background:rgba(255,247,229,.3882352941)}.markdown-body td,.markdown-body th{padding:7px;line-height:24px;min-width:100px}.markdown-body blockquote{color:#bd954f;padding:1px 23px;margin:22px 0;border-left:4px solid #dcb267;background-color:#fff7e5}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol .task-list-item,.markdown-body ul .task-list-item{list-style:none}.markdown-body ol li{padding-left:6px}.markdown-body::marker{color:#dcb267}.markdown-body .contains-task-list{padding-left:0}.markdown-body .contains-task-list .task-list-item{list-style:none;position:relative}.markdown-body .contains-task-list .task-list-item input[type=checkbox]{position:relative;top:2px}.markdown-body .contains-task-list .task-list-item input[type=checkbox]:before{content:"";display:inline-block;height:12px;width:12px;position:absolute;left:-2px;top:-2px;border:2px solid #cda152;border-radius:5px}.markdown-body .contains-task-list .task-list-item input[type=checkbox]:checked{position:relative;top:2px}.markdown-body .contains-task-list .task-list-item input[type=checkbox]:checked:before{border:none;content:"";display:inline-block;height:17px;width:17px;position:absolute;left:-2px;top:-2px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAFo9M/3AAAAAXNSR0IArs4c6QAAAYhJREFUOBFjYACC0/MDGsDEiyvr/zOCeUwMJxn/A8HZRUEMYBFGJsZ6kFoQYALiAyAGCgDpA+sFijKeWRj4H1kWpIWBW1SDQcm+BCzOAiK/vr7BcO/gDbAAI4hE1waWgRBnmWCGIwkyKFjnwow0BhsJk9QLncvw5dV1oPE9MCEGmBWrgCKhcFEowyR+PSNYwemFAZ4M/xjMkRWYJm5oAPFB/joDpI1BHHQANgGPDxj+//vfCA4IdJ3GcevgQnAFhlHLwYIgSVA0wABcwY3tFQzokiBFGIEP0wmigW5wZAK5FFkQib0a6NUDcEmgb7AGFpIGZOZqoMFhIAFQknEAJpn9yLLEssFOBCp2IFaDkl0xg6C8FbJyB3gowUS5RdQYBORQYpVB1iwVHIIMwJh///AYTCmYRklNIBFmNi4GeYt0BhnjeIa3dw8wSBlEgDUhxw2yCRgGfHp2geHiqiSwUwUVrFAiFVkjjA1LrjgTHEwhFvosMCZM4NEIUoAtWWNoBGZ70/gN22HiAD2uhAzsYNBZAAAAAElFTkSuQmCC) 0 0 no-repeat;background-size:100%}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、核心概念：pnpm Workspace</h2>
<p>pnpm 内置了对 Monorepo（单一代码仓库）的原生支持，通过 <strong>Workspace（工作区）</strong> ​ 机制实现。Workspace 允许你在一个仓库中管理多个相互关联但独立的项目（包），并智能地处理它们之间的依赖关系。</p>
<h2 data-id="heading-1">二、将普通仓库转变为 Monorepo 的步骤</h2>
<h3 data-id="heading-2">步骤 1：初始化项目结构</h3>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># 创建项目根目录</span>
<span class="hljs-keyword">mkdir</span> <span class="hljs-keyword">my</span>-monorepo
cd <span class="hljs-keyword">my</span>-monorepo

<span class="hljs-comment"># 初始化根目录 package.json</span>
pnpm init
</code></pre>
<h3 data-id="heading-3">步骤 2：配置根目录 package.json</h3>
<p>修改根目录的 <code>package.json</code>，关键配置如下：</p>
<pre><code class="hljs language-ruby" lang="ruby">{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"my-monorepo"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"1.0.0"</span>,
  <span class="hljs-string">"private"</span>: <span class="hljs-literal">true</span>,  <span class="hljs-regexp">//</span> 必须设置为 <span class="hljs-literal">true</span>，避免误发布到 npm
  <span class="hljs-string">"scripts"</span>: {
    <span class="hljs-string">"dev"</span>: <span class="hljs-string">"pnpm -r run dev"</span>,      <span class="hljs-regexp">//</span> -r 表示递归执行所有子包
    <span class="hljs-string">"build"</span>: <span class="hljs-string">"pnpm -r run build"</span>,
    <span class="hljs-string">"test"</span>: <span class="hljs-string">"pnpm -r run test"</span>
  },
  <span class="hljs-string">"keywords"</span>: [],
  <span class="hljs-string">"author"</span>: <span class="hljs-string">""</span>,
  <span class="hljs-string">"license"</span>: <span class="hljs-string">"ISC"</span>
}
</code></pre>
<p><strong>重要说明</strong>：</p>
<ul>
<li><code>"private": true</code>是必须的，确保整个 Monorepo 不会被意外发布</li>
<li>可以移除 <code>main</code>、<code>test</code>等字段，因为根目录通常不包含业务代码</li>
</ul>
<h3 data-id="heading-4">步骤 3：创建 pnpm-workspace.yaml 配置文件</h3>
<p>在根目录创建 <code>pnpm-workspace.yaml</code>文件，这是 pnpm Workspace 的核心配置文件：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># pnpm-workspace.yaml</span>
packages:
  <span class="hljs-comment"># packages 目录下的所有直接子目录</span>
  - <span class="hljs-string">'packages/*'</span>
  
  <span class="hljs-comment"># apps 目录下的所有直接子目录</span>
  - <span class="hljs-string">'apps/*'</span>
  
  <span class="hljs-comment"># components 目录下的所有层级子目录</span>
  - <span class="hljs-string">'components/**'</span>
  
  <span class="hljs-comment"># 排除包含 test 的目录</span>
  - <span class="hljs-string">'!**/test/**'</span>
</code></pre>
<p><strong>配置说明</strong>：</p>
<ul>
<li><code>packages/*</code>：匹配 <code>packages</code>目录下的所有一级子目录</li>
<li><code>apps/*</code>：匹配 <code>apps</code>目录下的所有一级子目录</li>
<li><code>components/**</code>：匹配 <code>components</code>目录下的所有层级子目录</li>
<li><code>!**/test/**</code>：排除所有包含 <code>test</code>的目录</li>
</ul>
<p>pnpm 中的两种配置方式</p>
<h4 data-id="heading-5">方式一：使用 <code>package.json</code>的 <code>workspaces</code>字段</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// package.json</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"my-monorepo"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"private"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"workspaces"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"packages/*"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"apps/*"</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm -r run dev"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-6">方式二：使用 <code>pnpm-workspace.yaml</code>文件</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># pnpm-workspace.yaml</span>
packages:
  - <span class="hljs-string">'packages/*'</span>
  - <span class="hljs-string">'apps/*'</span>
  - <span class="hljs-string">'!**/test/**'</span>  <span class="hljs-comment"># 排除包含 test 的目录</span>
</code></pre>
<h4 data-id="heading-7">两种方式的优先级与兼容性</h4>
<ol>
<li>
<p><strong>pnpm 的读取顺序</strong>：</p>
<ul>
<li>优先读取 <code>pnpm-workspace.yaml</code></li>
<li>如果不存在，则读取 <code>package.json</code>中的 <code>workspaces</code>字段</li>
<li>如果两者都存在，<strong><code>pnpm-workspace.yaml</code>优先级更高</strong>​</li>
</ul>
</li>
<li>
<p><strong>推荐使用 <code>pnpm-workspace.yaml</code>的原因</strong>：</p>
<ul>
<li><strong>更丰富的配置选项</strong>：支持排除模式（<code>!**/test/**</code>）</li>
<li><strong>更好的可读性</strong>：YAML 格式更适合复杂配置</li>
<li><strong>工具兼容性</strong>：明确标识为 pnpm 工作区</li>
<li><strong>未来扩展性</strong>：pnpm 的新功能会优先在 YAML 配置中支持</li>
</ul>
</li>
</ol>
<h3 data-id="heading-8">步骤 4：创建子项目结构</h3>
<p>典型的 Monorepo 目录结构如下：</p>
<pre><code class="hljs language-csharp" lang="csharp">my-monorepo/
├── pnpm-workspace.yaml
├── package.json
├── pnpm-<span class="hljs-keyword">lock</span>.yaml
├── packages/
│   ├── shared-utils/     <span class="hljs-meta"># 共享工具库</span>
│   │   ├── package.json
│   │   └── src/
│   ├── ui-components/    <span class="hljs-meta"># UI 组件库</span>
│   │   ├── package.json
│   │   └── src/
│   └── core-lib/         <span class="hljs-meta"># 核心库</span>
│       ├── package.json
│       └── src/
├── apps/
│   ├── web-app/          <span class="hljs-meta"># 前端应用</span>
│   │   ├── package.json
│   │   └── src/
│   └── mobile-app/       <span class="hljs-meta"># 移动应用</span>
│       ├── package.json
│       └── src/
└── docs/                 <span class="hljs-meta"># 文档</span>
</code></pre>
<h3 data-id="heading-9">步骤 5：配置子项目的 package.json</h3>
<p>每个子项目都需要有自己的 <code>package.json</code>，关键配置如下： <strong>示例：共享工具库 (packages/shared-utils/package.json)</strong></p>
<pre><code class="hljs language-perl" lang="perl">{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"@my-monorepo/shared-utils"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"1.0.0"</span>,
  <span class="hljs-string">"main"</span>: <span class="hljs-string">"dist/index.js"</span>,
  <span class="hljs-string">"types"</span>: <span class="hljs-string">"dist/index.d.ts"</span>,
  <span class="hljs-string">"scripts"</span>: {
    <span class="hljs-string">"build"</span>: <span class="hljs-string">"tsc"</span>,
    <span class="hljs-string">"dev"</span>: <span class="hljs-string">"tsc --watch"</span>
  },
  <span class="hljs-string">"dependencies"</span>: {
    <span class="hljs-string">"lodash"</span>: <span class="hljs-string">"^4.17.21"</span>
  },
  <span class="hljs-string">"devDependencies"</span>: {
    <span class="hljs-string">"typescript"</span>: <span class="hljs-string">"^5.0.0"</span>
  }
}
</code></pre>
<p><strong>示例：前端应用 (apps/web-app/package.json)</strong></p>
<pre><code class="hljs language-perl" lang="perl">{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"web-app"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"1.0.0"</span>,
  <span class="hljs-string">"private"</span>: true,
  <span class="hljs-string">"scripts"</span>: {
    <span class="hljs-string">"dev"</span>: <span class="hljs-string">"vite"</span>,
    <span class="hljs-string">"build"</span>: <span class="hljs-string">"vite build"</span>,
    <span class="hljs-string">"preview"</span>: <span class="hljs-string">"vite preview"</span>
  },
  <span class="hljs-string">"dependencies"</span>: {
    <span class="hljs-string">"@my-monorepo/shared-utils"</span>: <span class="hljs-string">"workspace:*"</span>,  <span class="hljs-regexp">//</span> 关键：引用本地包
    <span class="hljs-string">"@my-monorepo/ui-components"</span>: <span class="hljs-string">"workspace:*"</span>,
    <span class="hljs-string">"react"</span>: <span class="hljs-string">"^18.2.0"</span>,
    <span class="hljs-string">"react-dom"</span>: <span class="hljs-string">"^18.2.0"</span>
  },
  <span class="hljs-string">"devDependencies"</span>: {
    <span class="hljs-string">"@types/react"</span>: <span class="hljs-string">"^18.2.0"</span>,
    <span class="hljs-string">"@types/react-dom"</span>: <span class="hljs-string">"^18.2.0"</span>,
    <span class="hljs-string">"vite"</span>: <span class="hljs-string">"^5.0.0"</span>
  }
}
</code></pre>
<h2 data-id="heading-10">三、关键配置详解</h2>
<h3 data-id="heading-11">1. workspace:* 协议</h3>
<p>这是 pnpm Workspace 的核心特性，用于声明对本地其他包的依赖：</p>
<pre><code class="hljs language-perl" lang="perl">{
  <span class="hljs-string">"dependencies"</span>: {
    <span class="hljs-string">"@my-monorepo/shared-utils"</span>: <span class="hljs-string">"workspace:*"</span>,      <span class="hljs-regexp">//</span> 使用最新版本
    <span class="hljs-string">"@my-monorepo/ui-components"</span>: <span class="hljs-string">"workspace:^1.0.0"</span>, <span class="hljs-regexp">//</span> 指定版本范围
    <span class="hljs-string">"@my-monorepo/core-lib"</span>: <span class="hljs-string">"workspace:../packages/core-lib"</span> // 相对路径
  }
}
</code></pre>
<p><strong>作用</strong>：</p>
<ul>
<li>建立本地包之间的软链接，无需发布到 npm</li>
<li>修改本地包时，依赖它的项目能立即看到变化</li>
<li>确保所有包使用同一份依赖，避免重复安装</li>
</ul>
<h3 data-id="heading-12">2. 依赖安装与管理</h3>
<h4 data-id="heading-13">在根目录安装全局依赖（所有包共享）</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># 安装到根目录，所有包共享</span>
pnpm <span class="hljs-keyword">add</span> typescript -w
<span class="hljs-meta"># 或</span>
pnpm <span class="hljs-keyword">add</span> typescript --workspace-root
</code></pre>
<h4 data-id="heading-14">为特定包安装依赖</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># 为 web-app 安装 react</span>
pnpm <span class="hljs-keyword">add</span> react --filter web-app
<span class="hljs-meta"># 或</span>
pnpm <span class="hljs-keyword">add</span> react -F web-app

<span class="hljs-meta"># 为多个包安装依赖</span>
pnpm <span class="hljs-keyword">add</span> axios --filter <span class="hljs-string">"web-app"</span> --filter <span class="hljs-string">"mobile-app"</span>
</code></pre>
<h4 data-id="heading-15">安装本地包依赖</h4>
<pre><code class="hljs language-sql" lang="sql"># 在 web<span class="hljs-operator">-</span>app 中安装 shared<span class="hljs-operator">-</span>utils
pnpm <span class="hljs-keyword">add</span> <span class="hljs-variable">@my</span><span class="hljs-operator">-</span>monorepo<span class="hljs-operator">/</span>shared<span class="hljs-operator">-</span>utils <span class="hljs-comment">--filter web-app</span>
</code></pre>
<h3 data-id="heading-16">3. 脚本执行</h3>
<h4 data-id="heading-17">在所有包中执行相同脚本</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 递归执行所有包的 build 脚本</span>
pnpm -r run build

<span class="hljs-comment"># 递归执行所有包的 test 脚本</span>
pnpm -r run <span class="hljs-built_in">test</span>
</code></pre>
<h4 data-id="heading-18">在特定包中执行脚本</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 仅在 web-app 中执行 dev 脚本</span>
pnpm --filter web-app run dev

<span class="hljs-comment"># 使用包名（package.json 中的 name）</span>
pnpm -F @my-monorepo/shared-utils run build
</code></pre>
<h2 data-id="heading-19">四、完整示例：Vue 项目 Monorepo</h2>
<h3 data-id="heading-20">项目结构</h3>
<pre><code class="hljs language-lua" lang="lua">vue-monorepo/
├── pnpm-workspace.yaml
├── <span class="hljs-built_in">package</span>.json
├── packages/
│   ├── ui-lib/          # UI 组件库
│   │   ├── <span class="hljs-built_in">package</span>.json
│   │   ├── src/
│   │   └── vite.<span class="hljs-built_in">config</span>.ts
│   └── utils/           # 工具函数库
│       ├── <span class="hljs-built_in">package</span>.json
│       └── src/
└── apps/
    ├── admin/           # 后台管理系统
    │   ├── <span class="hljs-built_in">package</span>.json
    │   └── src/
    └── portal/          # 门户网站
        ├── <span class="hljs-built_in">package</span>.json
        └── src/
</code></pre>
<h3 data-id="heading-21">pnpm-workspace.yaml</h3>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">packages:</span>
  - <span class="hljs-comment">'packages/*'</span>
  - <span class="hljs-comment">'apps/*'</span>
</code></pre>
<h3 data-id="heading-22">根目录 package.json</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vue-monorepo"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"private"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm -r run dev"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm -r run build"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"lint"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm -r run lint"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"typescript"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^5.0.0"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-23">包间依赖示例 (apps/admin/package.json)</h3>
<pre><code class="hljs language-perl" lang="perl">{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"admin"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"1.0.0"</span>,
  <span class="hljs-string">"private"</span>: true,
  <span class="hljs-string">"dependencies"</span>: {
    <span class="hljs-string">"vue"</span>: <span class="hljs-string">"^3.3.0"</span>,
    <span class="hljs-string">"@vue-monorepo/ui-lib"</span>: <span class="hljs-string">"workspace:*"</span>,
    <span class="hljs-string">"@vue-monorepo/utils"</span>: <span class="hljs-string">"workspace:*"</span>
  },
  <span class="hljs-string">"devDependencies"</span>: {
    <span class="hljs-string">"@vitejs/plugin-vue"</span>: <span class="hljs-string">"^4.0.0"</span>,
    <span class="hljs-string">"vite"</span>: <span class="hljs-string">"^5.0.0"</span>
  }
}
</code></pre>
<h2 data-id="heading-24">五、最佳实践与注意事项</h2>
<h3 data-id="heading-25">1. 命名规范</h3>
<ul>
<li>根项目：使用项目总名称，如 <code>my-monorepo</code></li>
<li>子包：使用作用域名称，如 <code>@my-monorepo/ui-components</code></li>
<li>应用：使用描述性名称，如 <code>web-app</code>、<code>admin-console</code></li>
</ul>
<h3 data-id="heading-26">2. 依赖管理</h3>
<ul>
<li>公共依赖（如 TypeScript、ESLint）安装在根目录</li>
<li>业务依赖安装在各自包中</li>
<li>使用 <code>pnpm-lock.yaml</code>确保依赖一致性</li>
</ul>
<h3 data-id="heading-27">3. 版本控制</h3>
<ul>
<li>提交 <code>pnpm-lock.yaml</code>到版本控制系统</li>
<li>考虑使用 Changesets 或 Lerna 进行版本管理和发布</li>
</ul>
<h3 data-id="heading-28">4. 性能优化</h3>
<ul>
<li>pnpm 使用硬链接和符号链接，节省磁盘空间</li>
<li>所有包共享同一份依赖，安装速度快</li>
<li>支持过滤命令，只构建需要的包</li>
</ul>
<h3 data-id="heading-29">5. CI/CD 集成</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># GitHub Actions 示例</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">CI</span>
<span class="hljs-attr">on:</span> [<span class="hljs-string">push</span>]
<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">build:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">pnpm/action-setup@v2</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">version:</span> <span class="hljs-number">8</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-node@v3</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">node-version:</span> <span class="hljs-number">18</span>
          <span class="hljs-attr">cache:</span> <span class="hljs-string">'pnpm'</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">pnpm</span> <span class="hljs-string">install</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">pnpm</span> <span class="hljs-string">-r</span> <span class="hljs-string">run</span> <span class="hljs-string">build</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">pnpm</span> <span class="hljs-string">-r</span> <span class="hljs-string">run</span> <span class="hljs-string">test</span>
</code></pre>
<h2 data-id="heading-30">六、常见问题解决</h2>
<h3 data-id="heading-31">1. 幽灵依赖问题</h3>
<p>确保所有依赖都在 <code>package.json</code>中明确声明，避免直接引用 <code>node_modules</code>中的未声明包。</p>
<h3 data-id="heading-32">2. 循环依赖检测</h3>
<p>使用 <code>pnpm why &lt;package-name&gt;</code>检查依赖关系，避免包之间的循环依赖。</p>
<h3 data-id="heading-33">3. 包找不到错误</h3>
<p>如果出现 <code>no matches found</code>错误，检查：</p>
<ul>
<li>包名是否正确（包括作用域）</li>
<li>包是否在 <code>pnpm-workspace.yaml</code>配置的目录中</li>
<li>包是否有正确的 <code>name</code>字段</li>
</ul>
<h3 data-id="heading-34">4. 跨包类型引用</h3>
<p>对于 TypeScript 项目，配置 <code>tsconfig.json</code>中的 <code>paths</code>：</p>
<pre><code class="hljs language-perl" lang="perl">{
  <span class="hljs-string">"compilerOptions"</span>: {
    <span class="hljs-string">"baseUrl"</span>: <span class="hljs-string">"."</span>,
    <span class="hljs-string">"paths"</span>: {
      <span class="hljs-string">"@my-monorepo/*"</span>: [<span class="hljs-string">"packages/*/src"</span>]
    }
  }
}
</code></pre>
<h2 data-id="heading-35">总结</h2>
<p>通过 pnpm + Workspaces 构建 Monorepo 的主要优势包括：</p>
<ol>
<li><strong>依赖共享</strong>：所有包共享同一份依赖，节省磁盘空间和安装时间</li>
<li><strong>原子提交</strong>：跨包变更可以一次性提交，保持一致性</li>
<li><strong>本地链接</strong>：使用 <code>workspace:*</code>协议，本地开发无需发布到 npm</li>
<li><strong>精细控制</strong>：支持按包过滤的命令执行</li>
<li><strong>统一管理</strong>：集中的 CI/CD 和代码质量检查</li>
</ol>
<p>这种架构特别适合中大型项目、微前端架构、组件库开发等场景，能显著提升开发效率和代码复用性。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端工程化实践：打包工具的选择与思考]]></title>    <link>https://juejin.cn/post/7583984122234798122</link>    <guid>https://juejin.cn/post/7583984122234798122</guid>    <pubDate>2025-12-16T02:16:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583984122234798122" data-draft-id="7583984122234732586" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端工程化实践：打包工具的选择与思考"/> <meta itemprop="keywords" content="前端,JavaScript,Webpack"/> <meta itemprop="datePublished" content="2025-12-16T02:16:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="转转技术团队"/> <meta itemprop="url" content="https://juejin.cn/user/606586148237431"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端工程化实践：打包工具的选择与思考
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/606586148237431/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    转转技术团队
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:16:24.000Z" title="Tue Dec 16 2025 02:16:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读21分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>从静态页面到模块化开发，前端工程化经历了怎样的演进？Webpack、Vite、Rspack 这些打包工具各自解决了什么问题，在实际项目中又该如何选择？</p>
</blockquote>
<h2 data-id="heading-0">前端工程化的出现与发展</h2>
<p>前端工程化的发展经历了几个重要阶段。在 1990 年代到 2000 年代初期的静态页面时代，开发者主要使用 Photoshop 切图和 Dreamweaver 等工具制作页面，代码通常直接写在 HTML 中，大量使用内联样式和事件处理器，所有逻辑集中在一个文件中，导致代码组织混乱、全局变量污染严重、维护困难。到了 2000 年代中期到 2010 年代初期，jQuery 等类库的出现解决了浏览器兼容性问题，简化了 DOM 操作，但代码组织问题依然存在，文件体积持续增长，模块间的依赖关系仍需人工管理。2010 年代初期进入模块化探索阶段，出现了多种模块化方案：CommonJS 主要用于 Node.js 环境，AMD 专注于浏览器端的异步模块加载，CMD 强调按需加载，但这些方案标准不统一，工具链不兼容，给项目协作带来困难。2010 年代中期至今，随着 ES6 模块标准的确定，<code>import / export</code> 语法成为主流，Webpack 等打包工具统一了模块化处理流程，Vite 等新一代工具利用原生 ESM 提升了开发体验，同时 Babel 提供了语法转换能力，TypeScript 提供了类型系统支持，ESLint 和 Prettier 规范了代码风格，前端工程化体系逐步完善，前端开发进入了工具链驱动的时代。</p>
<p>前端工程化的出现主要源于项目规模扩大、团队协作需求增加、业务复杂度提升以及人工管理代码的局限性。首先，传统开发方式中代码组织混乱，所有脚本文件需要在 HTML 中按正确顺序引入，依赖关系必须人工维护，删除或调整文件顺序容易导致错误。工程化后通过 ES Modules 等模块化方案，依赖关系由工具自动管理，开发者只需关注业务逻辑。其次，浏览器兼容性问题突出，使用 <code>Promise</code>、<code>async/await</code> 等新特性时，旧版本浏览器无法识别，需要通过 Babel 将高级语法转换为兼容的 ES5 代码，并通过 polyfill 为旧浏览器补充缺失的 API 支持。第三，开发效率低下，传统方式需要手动刷新页面、重复操作才能看到修改效果，构建过程需要手动进行代码压缩、合并、添加文件哈希等操作，工程化后通过热模块替换实现代码修改后自动更新，通过构建工具自动化完成压缩、文件指纹、代码分包等流程。第四，性能优化缺乏系统性方案，未打包的项目会产生大量 HTTP 请求，未进行代码分割会导致用户需要加载全部代码才能使用部分功能，工程化后通过代码压缩、Tree-shaking 消除无用代码、按需加载、资源预加载等技术手段系统性地优化性能。第五，团队协作缺乏统一规范，代码风格不统一、类型使用不规范、注释缺失等问题影响代码质量和可维护性，工程化后通过 ESLint 进行代码质量检查，通过 Prettier 统一代码格式，通过 TypeScript 在编译期进行类型检查，从而提升代码质量和团队协作效率。</p>
<h2 data-id="heading-1">前端工程化与打包工具</h2>
<h3 data-id="heading-2">打包工具的核心作用</h3>
<p>在前端工程化的工具链中，打包工具承担着核心的构建职责。它的主要功能包括模块依赖解析、代码转换、资源优化以及开发体验提升。</p>
<h4 data-id="heading-3">模块依赖解析</h4>
<p>项目开发中会使用大量的 <code>import</code> 和 <code>require</code> 语句来组织代码，打包工具从入口文件开始，递归分析模块间的依赖关系，构建完整的依赖图，最终将分散的模块文件合并成浏览器可以直接加载的 JavaScript、CSS 等资源文件。这个过程解决了传统开发中需要手动维护脚本加载顺序的问题。</p>
<h4 data-id="heading-4">代码转换与预处理</h4>
<p>现代前端开发中广泛使用的 TypeScript、JSX、Vue 单文件组件、Less/SCSS 等语法和格式，浏览器本身并不支持。打包工具通过配置相应的 Loader 或 Plugin，将这些代码转换为浏览器能够理解的 JavaScript 和 CSS。例如，Babel 可以将 ES6+ 语法转换为 ES5，TypeScript 编译器可以将 TypeScript 代码转换为 JavaScript。</p>
<h4 data-id="heading-5">构建优化</h4>
<p>打包工具在构建过程中会自动执行多种优化操作。代码压缩可以减小文件体积，Tree-shaking 可以移除未使用的代码，代码分割可以将大型应用拆分为多个按需加载的代码块，文件指纹 hash 可以实现长期缓存，资源压缩可以优化图片、字体等静态资源。这些优化如果手动完成，不仅工作量大，而且容易出错。</p>
<h4 data-id="heading-6">开发体验</h4>
<p>打包工具通常还提供开发服务器功能，支持 HMR，当代码修改后可以自动更新页面，无需手动刷新。同时提供清晰的错误提示和 Source Map 支持，方便开发者调试代码。</p>
<p>目前主流的打包工具包括 Webpack、Vite、Rollup、Rspack 等，它们在解决上述问题的同时，由于设计理念和时代背景的不同，在实现方式和性能表现上各有特点。</p>
<h2 data-id="heading-7">主流打包工具全景</h2>
<h3 data-id="heading-8">Webpack</h3>
<p>Webpack 是前端打包工具领域的成熟方案，自 2012 年发布以来，在前端工程化中占据重要地位。它支持多种模块格式，包括 CommonJS、AMD 和 ES Modules，能够处理各种类型的静态资源，如样式文件、图片、字体等，只要编写相应的 Loader，几乎可以将任何资源类型纳入打包流程。Webpack 的插件生态非常丰富，涵盖了 HTML 模板生成、体积分析、代码压缩混淆、国际化等各个方面，为开发者提供了大量现成的解决方案。</p>
<p>Webpack 的构建流程可以概括为：读取配置文件，确定入口文件，递归分析模块依赖关系，通过 Loader 对各类资源进行转换处理，将处理后的模块组织成 Chunk，最终输出优化后的资源文件。在整个构建过程中，Webpack 会触发各种生命周期钩子，Plugin 通过监听这些钩子来扩展功能，实现自定义的构建逻辑。</p>
<p>Webpack 适合在以下场景使用：项目规模较大、结构复杂，需要对打包过程进行精细控制；已有项目基于 Webpack 构建，迁移成本较高；需要处理多种特殊资源类型，对丰富的插件生态有较强依赖。</p>
<p>Webpack 的不足之处在于：配置文件较为复杂，学习曲线较陡，新成员上手需要一定时间；开发环境需要先进行打包，冷启动速度相对较慢；对于大型项目，如果不进行针对性优化，构建时间可能较长。</p>
<h3 data-id="heading-9">Vite</h3>
<p>Vite 的设计目标是提供极速的开发体验，实现开发服务器的快速启动和代码修改的即时反馈。Vite 的核心思路与 Webpack 不同：在开发环境中，Vite 不进行全量打包，而是启动一个轻量级的开发服务器，当浏览器请求某个模块时，Vite 才对该模块进行实时编译和转换。对于第三方依赖，Vite 使用 esbuild 进行预构建，将 CommonJS 或 UMD 格式的依赖转换为 ESM 格式，通常缓存在 node_modules/.vite/deps 目录下，后续直接预构建缓存的结果，大幅提升开发启动速度。在生产环境中，Vite 使用 Rollup 进行构建（Vite 5 及之后版本也可以选择基于 Rust 的 Rolldown），执行 Tree-shaking、代码分割、压缩等优化操作，生成生产环境所需的资源文件。</p>
<p>Vite 的开发体验优势明显：新项目配置简单，几乎可以开箱即用；开发服务器启动速度快，HMR 更新迅速；对 Vue、React 等主流框架提供了良好的内置支持。Vite 的局限性在于：对旧版本浏览器的支持需要额外的插件和配置；对于已经深度定制 Webpack 的复杂项目，迁移到 Vite 的成本可能较高。</p>
<h3 data-id="heading-10">Rspack</h3>
<p>Rspack 是由字节跳动开发的基于 Rust 实现的打包工具，于 2023 年发布。Rspack 与 Webpack 保持高度兼容，API 兼容度达到 95% 以上，这意味着大多数 Webpack 配置可以直接迁移到 Rspack。在官方基准测试和实际项目实践中，Rspack 的构建速度通常比同等配置的 Webpack 快 5 到 10 倍。</p>
<p>Rspack 的核心实现使用 Rust 重写了 Webpack 的核心逻辑，同时保持了 Webpack 的配置方式和插件生态系统。Rspack 内置了 SWC 编译器和 Lightning CSS，无需额外配置 Babel 即可处理 TypeScript、JSX 等语法，在性能上相比传统方案有显著提升。</p>
<p>Rspack 与 Webpack 高度兼容，迁移成本较低，现有 Webpack 项目可以相对平滑地切换到 Rspack；构建速度快，中大型项目的冷启动时间通常在 1 到 3 秒之间；支持大部分 Webpack Loader 和 Plugin，生态兼容性好；内置 SWC 编译器，无需额外配置 Babel；提供文件系统缓存机制，二次构建速度更快。</p>
<p>测试项目打包速度对比结果：同一套项目代码（大概 400 个小文件） + 配置；webpack 采用了 babel，rspack 采用了内置的 SWC(仅是测试代码测试，仅做参考) <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed69c9392fee41cca3b90c4a655f148d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2s6L2s5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456184&amp;x-signature=EykjQ%2FiWRyq3VuI12OthQXlZCCM%3D" alt="compare" loading="lazy"/></p>
<h2 data-id="heading-11">打包原理浅析</h2>
<h3 data-id="heading-12">Webpack 打包原理速通</h3>
<h4 data-id="heading-13">整体架构</h4>
<p>Webpack 的核心是一个模块打包器，它将项目中的所有资源（JavaScript、CSS、图片等）视为模块，通过构建依赖关系图将它们组织起来。Webpack 的架构基于几个核心概念：Compiler 是编译器实例，负责整个编译过程的生命周期管理；Compilation 代表单次编译过程，包含模块、chunk、资源等编译信息；Module 是模块，可以是 JavaScript、CSS、图片等任何类型的文件；Chunk 是代码块，由多个模块按照一定规则组织而成；Asset 是资源文件，即最终输出的文件。</p>
<h4 data-id="heading-14">构建流程（生产环境）</h4>
<p>Webpack 的构建流程可以分为初始化、编译、输出和完成四个主要阶段。</p>
<p>在初始化阶段，Webpack 读取配置文件（webpack.config.js），创建 Compiler 实例，然后注册所有配置的插件。插件通过 <code>apply</code> 方法注册到 Compiler 的钩子上，以便在构建的不同阶段执行自定义逻辑。</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">compiler</span> = webpack(config)<span class="hljs-comment">;</span>
plugins.forEach((plugin) =&gt; plugin.apply(compiler))<span class="hljs-comment">;</span>
</code></pre>
<p>编译阶段是 Webpack 的核心处理过程。首先确定入口文件，从配置的 entry 开始，找到所有入口文件。然后从入口文件开始，递归解析所有依赖关系，使用 AST 解析 import 和 require 语句，构建完整的模块依赖图。接下来对每个模块执行对应的 Loader 进行转换，例如使用 babel-loader 处理 JavaScript 文件，使用 css-loader 和 style-loader 处理 CSS 文件。最后根据入口和代码分割规则，将模块组织成 Chunk。</p>
<pre><code class="hljs language-css" lang="css">entry: {
  <span class="hljs-selector-tag">main</span>: <span class="hljs-string">'./src/index.js'</span>,
  vendor: <span class="hljs-string">'./src/vendor.js'</span>
}

module: {
  rules: [
    { test: /.js$/, use: <span class="hljs-string">'babel-loader'</span> },
    { test: /.css$/, use: [<span class="hljs-string">'style-loader'</span>, <span class="hljs-string">'css-loader'</span>] }
  ]
}
</code></pre>
<p>在输出阶段，Webpack 首先生成运行时代码，注入模块加载的运行时函数（如 <code>__webpack_require__</code>）。然后执行代码分割和优化，通过 SplitChunksPlugin 根据配置规则将代码分割成多个 chunk，例如将 node_modules 中的第三方库单独打包。最后将 Chunk 转换为最终的 JavaScript 文件，执行压缩、混淆等优化操作。</p>
<pre><code class="hljs language-css" lang="css">optimization: {
  splitChunks: {
    chunks: <span class="hljs-string">'all'</span>,
    cacheGroups: {
      vendor: {
        test: /[\/]node_modules[\/]/,
        name: <span class="hljs-string">'vendors'</span>,
        priority: <span class="hljs-number">10</span>
      }
    }
  }
}
</code></pre>
<p>最后，根据 output 配置将处理后的文件写入文件系统，生成最终的构建产物。</p>
<pre><code class="hljs language-css" lang="css">output: {
  path: path.<span class="hljs-built_in">resolve</span>(__dirname, <span class="hljs-string">'dist'</span>),
  filename: <span class="hljs-string">'[name].[contenthash].js'</span>
}
</code></pre>
<h4 data-id="heading-15">开发环境（webpack-dev-server）</h4>
<p>开发环境与生产环境的主要区别在于：开发环境采用内存编译，文件不写入磁盘，而是保存在内存中，这样可以提升编译速度；支持热模块替换（HMR），只更新变更的模块，无需刷新整个页面；生成 Source Map 便于调试，可以定位到原始源码位置；文件变更后能够快速重新编译，提供即时的反馈。</p>
<p>HMR 的工作流程如下：当启动 webpack-dev-server 时，会在页面中注入 HMR 客户端脚本，然后建立 WebSocket 连接，实现客户端与开发服务器之间的双向通信。当开发者修改源码文件时，Webpack 会监听到文件变更事件，然后重新编译受影响的模块，生成新的 hash 值和热更新清单文件（如 <code>main.[hash].hot-update.json</code>）。服务器通过 WebSocket 将新的 hash 值通知给客户端，客户端收到通知后，会对比本地的 lastHash 和服务端返回的 hash 值。如果检测到有更新，客户端会发起请求获取热更新清单文件和更新后的模块代码（<code>hot-update.json</code> 和 <code>hot-update.js</code>），HMR runtime 会加载并执行更新后的模块，然后调用 <code>module.hot.accept</code> 等回调函数，只替换发生变更的模块，尽量保持页面状态不变。如果遇到异常情况或模块不支持 HMR，系统会回退到整页刷新的方式，确保功能正常。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea23b12f3729442ba0b49f9b3d1235b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2s6L2s5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456184&amp;x-signature=5rxZ0uaDtinwO5lomVdtEuVN%2FRI%3D" alt="test" loading="lazy"/></p>
<p>test</p>
<h4 data-id="heading-16">模块解析机制</h4>
<p>Webpack 的模块解析机制包括路径解析、别名处理和 node_modules 查找。当遇到相对路径导入时，Webpack 会根据 <code>resolve.extensions</code> 配置尝试不同的文件扩展名，例如 <code>./utils</code> 会依次尝试 <code>./utils.js</code>、<code>./utils.json</code>、<code>./utils/index.js</code> 等。对于使用别名的导入，Webpack 根据 <code>resolve.alias</code> 配置将别名解析为实际路径，例如 <code>@/components/Component</code> 会被解析为配置的实际路径。对于第三方模块，Webpack 会从 node_modules 目录中查找对应的包。</p>
<h3 data-id="heading-17">Vite 打包原理速通</h3>
<h4 data-id="heading-18">整体架构</h4>
<p>Vite 采用双模式架构，在开发环境和生产环境中采用不同的策略。开发环境基于浏览器原生 ESM，无需进行打包操作，而是通过 HTTP 服务器按需编译模块。生产环境则回归传统打包思路，使用 Rollup 进行代码打包和优化。这种设计使得开发体验和生产构建各取所长，既保证了开发时的极速启动，又确保了生产环境的代码优化。</p>
<h4 data-id="heading-19">开发环境原理</h4>
<p>Vite 开发环境的核心思想是 No Bundle，即不进行预先打包。当执行 <code>vite dev</code> 命令时，Vite 首先启动一个 HTTP 服务器，默认监听 5173 端口。这个服务器会拦截浏览器的模块请求，并根据请求的模块类型进行实时编译和返回。整个过程是动态的，只有在浏览器真正需要某个模块时，Vite 才会对其进行编译处理。</p>
<p>在第一次启动时，Vite 会执行依赖预构建流程。它会扫描项目的 package.json 文件，识别出所有的第三方依赖，然后使用 esbuild 对这些依赖进行预构建处理。预构建的结果会被缓存到 <code>node_modules/.vite/deps</code> 目录中，后续启动时可以直接使用缓存，大幅提升启动速度。预构建的主要目的包括三个方面：首先是将 CommonJS 或 UMD 格式的依赖转换为浏览器可识别的 ESM 格式，因为浏览器原生不支持 CommonJS；其次是合并多个小文件，减少 HTTP 请求数量，例如 lodash 这样的库包含数百个文件，预构建可以将其合并为单个文件；最后是优化依赖结构，扁平化某些包内部的复杂路径引用。</p>
<p>当浏览器发起模块请求时，例如请求 <code>http://localhost:5173/src/main.js</code>，Vite 服务器会首先检查该模块是否是已经预构建的第三方依赖。如果是预构建的依赖，直接返回缓存的结果。如果是项目源码文件，Vite 会进行实时编译，将文件转换为浏览器可执行的 ESM 代码并返回。以 Vue 单文件组件为例，当浏览器请求 <code>.vue</code> 文件时，Vite 会实时编译 Vue SFC，将其转换为 JavaScript 代码返回给浏览器。</p>
<p>Vite 的热模块替换机制同样基于 ESM 实现。当文件发生变更时，Vite 能够精确地知道哪些模块需要更新，因为每个模块都是独立的 ESM 模块。Vite 通过 WebSocket 连接通知客户端哪些模块发生了变化，客户端接收到通知后，可以直接替换对应的 ESM 模块，利用浏览器原生的模块系统能力，无需重新加载整个页面。这种基于 ESM 的 HMR 机制相比传统的打包工具更加精确和高效。</p>
<h4 data-id="heading-20">生产环境原理</h4>
<p>在生产环境中，Vite 会执行完整的打包流程。默认情况下，Vite 使用 Rollup 作为打包核心引擎。在 Vite 5 及之后的版本中，可以在部分配置或实验特性下切换为 Rolldown，但整体构建阶段和思路与 Rollup 基本一致。构建流程首先从入口文件开始，构建完整的依赖图，分析所有模块之间的依赖关系，确定需要打包的模块范围。随后使用 esbuild 对依赖进行预构建，这一步在官方基准测试中通常能比传统方式快一个数量级，具体提升幅度在 10 到 100 倍之间，实际效果取决于项目规模和配置。预构建完成后，Rollup 会执行代码分析、转换、优化和打包等步骤，最终输出优化后的生产代码。</p>
<h4 data-id="heading-21">预构建</h4>
<p>预构建是 Vite 架构中的关键环节，其必要性主要体现在三个方面。首先是兼容性问题，许多 npm 包仍然采用 CommonJS 格式发布，而浏览器原生不支持 CommonJS 模块系统，因此需要将这些依赖转换为浏览器可识别的 ESM 格式。其次是性能问题，某些大型库如 lodash 包含数百个独立的文件，如果直接使用会产生大量的 HTTP 请求，严重影响加载性能，预构建可以将这些文件合并为单个文件，大幅减少请求数量。最后是路径问题，某些包内部使用复杂的相对路径引用，预构建可以扁平化这种依赖结构，简化模块解析过程。</p>
<h4 data-id="heading-22">开发 vs 生产对比</h4>
<p>开发环境和生产环境在多个维度上存在显著差异。在打包方式上，开发环境采用不打包、按需编译的策略，而生产环境则执行完整的 Rollup 打包流程。启动速度方面，开发环境通常能在 1 秒内完成启动，而生产环境的构建时间通常在 5 到 10 秒之间。编译方式上，开发环境是实时编译，只有被请求的模块才会被编译，生产环境则是全量编译，所有模块都会被处理。输出格式上，开发环境统一输出 ESM 格式，生产环境则可以根据配置输出多种格式。代码优化方面，开发环境不进行代码优化以保持编译速度，生产环境则会执行压缩、混淆、tree-shaking 等优化操作。Source Map 的生成策略也不同，开发环境采用快速生成策略，生产环境则生成完整的 Source Map 以便调试。</p>
<h3 data-id="heading-23">核心差异对比</h3>
<h4 data-id="heading-24">性能差异</h4>
<p>这里可以先按一个中等偏上的单页应用来想象一下，大概的时间量级会是下面这样（只是经验值，不是严谨 benchmark，具体还是要看你项目的体量和机器性能）：</p>





























<table><thead><tr><th>场景</th><th>Webpack</th><th>Vite</th><th>原因</th></tr></thead><tbody><tr><td><strong>冷启动</strong></td><td>10 ～ 30s</td><td>&lt; 1s</td><td>Vite 不打包，按需编译</td></tr><tr><td><strong>HMR</strong></td><td>1 ～ 3s</td><td>&lt; 100ms</td><td>Vite 基于 ESM，更精确</td></tr><tr><td><strong>生产构建</strong></td><td>30 ～ 60s</td><td>10 ～ 20s</td><td>Vite 使用 esbuild 预构建</td></tr></tbody></table>
<h2 data-id="heading-25">深度对比分析</h2>
<h3 data-id="heading-26">性能对比</h3>
<p>从开发者最关心的几个维度来看，三个工具在性能表现上存在明显差异。需要说明的是，以下对比更多是基于日常项目实践的经验总结，而非严谨的基准测试，具体表现会因项目规模和机器性能而有所不同。</p>
<p>在开发启动速度方面，Webpack 在大型项目中首次启动时需要进行完整的打包过程，开发者能够明显感受到冷启动的等待时间，十几秒甚至几十秒的情况很常见。Vite 则基本实现秒开，启动瓶颈更多在于浏览器打开速度，而非打包过程本身。Rspack 相比 Webpack 有明显提升，特别是在多入口和大体积项目中，启动速度的提升更为显著。</p>
<p>在热模块替换的反馈速度上，Webpack 在处理简单样式修改时表现尚可，但在进行大型组件改动时，通常需要等待 1 到 2 秒才能看到更新效果。Vite 在大部分场景下能够实现保存即刷新，几乎感觉不到延迟。Rspack 配合开发服务器使用时，HMR 体验也比传统 Webpack 更加流畅。</p>
<p>在生产构建时间方面，Webpack 在配置合理的情况下，中型项目的构建时间通常在几十秒，对于超大项目则需要重点进行代码拆分和缓存优化。Vite 使用 Rollup 进行生产构建时，在中小型项目上通常优于 Webpack，随着项目规模增大，这种优势会更加明显。Rspack 在官方对比和社区实践中，普遍比等价配置的 Webpack 快一截，特别适合那些希望保持 Webpack 配置方式但需要提升构建速度的场景。</p>
<h3 data-id="heading-27">配置复杂度</h3>
<p>Webpack 的配置相对复杂，需要开发者理解一整套概念体系，包括入口配置 entry、输出配置 output、模块处理规则 module.rules、各种 loader、插件系统 plugin、优化配置 optimization、路径解析 resolve 等。一个典型的 Webpack 配置文件需要明确指定入口文件路径、输出目录和文件名模式、各种文件类型的处理规则、使用的 loader 和插件、代码拆分策略等。这种配置方式虽然灵活，但也意味着学习曲线较为陡峭，新手需要花费一定时间才能掌握。</p>
<p>相比之下，Vite 的配置要简洁得多。Vite 的默认配置已经能够运行绝大多数单页应用，开发者通常只需要添加框架插件、配置路径别名、按需调整一些构建选项即可。一个典型的 Vite 配置文件可能只需要几行代码，指定使用的框架插件和少量构建选项。这种设计大大降低了配置门槛，使得开发者能够快速上手，将更多精力投入到业务开发中。</p>
<h3 data-id="heading-28">生态支持</h3>
<p>在生态支持方面，三个工具呈现出不同的成熟度。Webpack 作为最早发布的工具，自 2012 年发布以来已经积累了最完善的生态系统，拥有最多的插件和 loader，社区支持也是最好的。Vite 虽然发布时间较晚，自 2020 年发布以来生态成熟度已经达到较高水平，社区支持快速增长，插件数量也相当丰富。Rspack 作为最新的工具，2023 年才发布，生态成熟度相对较低，但社区支持也在快速增长，插件数量也在逐步增加。总体而言，Webpack 拥有最成熟的生态，Vite 的生态已经相当完善，Rspack 作为新工具正在快速发展中。</p>
<h2 data-id="heading-29">总结</h2>
<p>前端打包工具的选择没有标准答案，需要根据项目特点、团队情况、技术栈等因素综合考虑：</p>
<h3 data-id="heading-30">未来展望</h3>
<p>前端工程化工具正在向<strong>更快、更简单、更智能</strong>的方向发展：</p>
<ul>
<li><strong>性能</strong>：Rust/Go 实现的工具将成为主流</li>
<li><strong>兼容性</strong>：新工具会保持与现有生态的兼容</li>
<li><strong>开发体验</strong>：零配置、智能提示、更好的错误信息</li>
<li><strong>标准化</strong>：ESM 成为标准，工具链统一</li>
</ul>
<hr/>
<p><strong>参考资源：</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwebpack.js.org%2F" target="_blank" title="https://webpack.js.org/" ref="nofollow noopener noreferrer">Webpack 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fvitejs.dev%2F" target="_blank" title="https://vitejs.dev/" ref="nofollow noopener noreferrer">Vite 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Frollupjs.org%2F" target="_blank" title="https://rollupjs.org/" ref="nofollow noopener noreferrer">Rollup 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fesbuild.github.io%2F" target="_blank" title="https://esbuild.github.io/" ref="nofollow noopener noreferrer">esbuild 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Frspack.dev%2F" target="_blank" title="https://rspack.dev/" ref="nofollow noopener noreferrer">Rspack 官方文档</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[dart 的 Lazy Iterable]]></title>    <link>https://juejin.cn/post/7583933107690029119</link>    <guid>https://juejin.cn/post/7583933107690029119</guid>    <pubDate>2025-12-16T02:24:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583933107690029119" data-draft-id="7583591656177123364" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="dart 的 Lazy Iterable"/> <meta itemprop="keywords" content="Flutter"/> <meta itemprop="datePublished" content="2025-12-16T02:24:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="火柴就是我"/> <meta itemprop="url" content="https://juejin.cn/user/272334614705575"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            dart 的 Lazy Iterable
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/272334614705575/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    火柴就是我
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:24:55.000Z" title="Tue Dec 16 2025 02:24:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>相关文章: <a href="https://juejin.cn/post/7109433427245400078" target="_blank" title="https://juejin.cn/post/7109433427245400078">juejin.cn/post/710943…</a></p>
<p>这里主要提到两个我们经常用的操作符 where/map</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">var</span> list = [<span class="hljs-string">"1"</span>, <span class="hljs-string">"2"</span>, <span class="hljs-string">"3"</span>, <span class="hljs-string">"4"</span>, <span class="hljs-string">"5"</span>];
<span class="hljs-keyword">var</span> map = list.<span class="hljs-title function_">map</span>((e) {
  <span class="hljs-keyword">var</span> result = int.<span class="hljs-title function_">parse</span>(e) + <span class="hljs-number">10</span>;
  <span class="hljs-title function_">print</span>(<span class="hljs-string">"######### $result"</span>);
  <span class="hljs-keyword">return</span> result;
});
</code></pre>
<p>像上面的代码 运行是不会有日志输出的。只有每次调用 toList 或者遍历map的时候才会输出。</p>
<p><code>一般情况下 如果你这里返回的知识基本类型 比如 String 或者 int 啥的,直接用也不会有太大问题。但是你如果返回的是对象，当你去做一些判断是否是同一个对象的时候就会有问题，因为你每次遍历返回的都是新的对象，再去判断是否是同一个对象，大概率是不一样的。</code></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[企业级 AI 编程 Prompt 体系]]></title>    <link>https://juejin.cn/post/7583981974407970826</link>    <guid>https://juejin.cn/post/7583981974407970826</guid>    <pubDate>2025-12-16T02:29:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583981974407970826" data-draft-id="7583981974407921674" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="企业级 AI 编程 Prompt 体系"/> <meta itemprop="keywords" content="OpenAI,AI编程"/> <meta itemprop="datePublished" content="2025-12-16T02:29:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="HBLOG"/> <meta itemprop="url" content="https://juejin.cn/user/131597124767479"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            企业级 AI 编程 Prompt 体系
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/131597124767479/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    HBLOG
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:29:07.000Z" title="Tue Dec 16 2025 02:29:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>定位说明</strong>：<br/>
这不是“教你怎么用 AI 写代码”的教程，而是一套 <strong>企业可复制、可治理、可审计的 AI 编程方法论</strong>。</p>
<p><strong>适用对象：</strong></p>
<ul>
<li>CTO / 技术负责人</li>
<li>技术中台 / 架构组</li>
<li>正在推进 AI 编程落地的企业</li>
</ul>
<h2 data-id="heading-0">一、为什么“会用 AI 写代码”不等于“能在企业落地”</h2>
<p>当前大多数团队在使用 AI 编程时，都会遇到三个典型问题：</p>
<ol>
<li><strong>产出不稳定</strong>：同一个需求，不同人问，结果完全不同</li>
<li><strong>风险不可控</strong>：AI 擅自重构、编造逻辑、引入依赖</li>
<li><strong>无法评估价值</strong>：到底有多少代码是 AI 参与产出的？</li>
</ol>
<p><strong>根本原因只有一个：</strong></p>
<blockquote>
<p>企业缺的不是 AI，而是一套「约束 AI 行为的工程体系」。</p>
</blockquote>
<h2 data-id="heading-1">二、核心方法论：三层 Prompt 治理模型</h2>
<p>我们将 AI 编程中的提示词，拆解为 <strong>三层、三种职责、三种稳定度</strong>。</p>
<pre><code class="hljs language-arduino" lang="arduino">System Prompt（企业级｜几乎不变）
   ↓
Project Prompt（项目级｜随项目变化）
   ↓
<span class="hljs-built_in">Task</span> Prompt（任务级｜每次开发）
</code></pre>
<h2 data-id="heading-2">三、System Prompt：AI 的“公司宪法”</h2>
<p><strong>解决的问题</strong>：</p>
<ul>
<li>AI 在公司里“能不能做”</li>
<li>什么时候必须停下来</li>
</ul>
<p><strong>核心特征</strong>：</p>
<ul>
<li>稳定性优先于效率</li>
<li>明确禁止 AI 幻觉、编造、擅自决策</li>
<li>内置“中止机制”（信息不足即停）</li>
</ul>
<p><strong>价值</strong>：</p>
<ul>
<li>防止 AI 成为风险源</li>
<li>为所有项目提供统一底线</li>
</ul>
<h2 data-id="heading-3">四、Project Prompt：AI 的“项目说明书”</h2>
<p><strong>解决的问题</strong>：</p>
<ul>
<li>AI 在“这个项目里该怎么写代码”</li>
</ul>
<p><strong>核心内容</strong>：</p>
<ul>
<li>技术栈与版本锁定</li>
<li>架构分层规则</li>
<li>项目级编码与异常规范</li>
<li>项目特有的 AI 行为约束</li>
</ul>
<p><strong>价值</strong>：</p>
<ul>
<li>消除 AI 的“通用最佳实践幻觉”</li>
<li>让 AI 的输出贴合具体项目</li>
</ul>
<h2 data-id="heading-4">五、Task Prompt：AI 的“任务工单”</h2>
<p><strong>解决的问题</strong>：</p>
<ul>
<li>AI 这一次具体要做什么</li>
</ul>
<p><strong>标准结构</strong>：</p>
<ul>
<li>任务目标</li>
<li>已有上下文</li>
<li>具体要求</li>
<li>强约束</li>
<li>输出验收标准</li>
</ul>
<p><strong>价值</strong>：</p>
<ul>
<li>降低不确定性</li>
<li>让 AI 输出具备可验收性</li>
</ul>
<h2 data-id="heading-5">六、为什么这套体系“可治理、可审计”</h2>
<h3 data-id="heading-6">1️⃣ Prompt 即制度</h3>
<ul>
<li>Prompt 本身就是工程规则</li>
<li>可纳入版本管理</li>
</ul>
<h3 data-id="heading-7">2️⃣ Prompt 即证据</h3>
<ul>
<li>每一段 AI 产出，都有对应 Prompt</li>
<li>可复盘、可追责</li>
</ul>
<h3 data-id="heading-8">3️⃣ Prompt 即统计基础</h3>
<ul>
<li>可以区分：
<ul>
<li>AI 主导</li>
<li>AI 辅助</li>
<li>人工编写</li>
</ul>
</li>
</ul>
<h2 data-id="heading-9">七、AI 代码参与度的正确评估方式（对外常见误区）</h2>
<p><strong>错误方式</strong>：</p>
<ul>
<li>看是否“用过 AI”</li>
<li>看是否“复制过代码”</li>
</ul>
<p><strong>正确方式</strong>：</p>
<ul>
<li>是否使用 Task Prompt 产出核心逻辑</li>
<li>是否在 Prompt 约束下完成代码</li>
<li>是否通过人工 Review 验收</li>
</ul>
<blockquote>
<p><strong>结论</strong>：<br/>
AI 价值不在“用了没用”，而在“被管理地使用”。</p>
</blockquote>
<h2 data-id="heading-10">八、这套方法论的边界（很重要）</h2>
<ul>
<li>不追求 100% AI 生成代码</li>
<li>不鼓励完全无人审查</li>
<li>不替代工程责任主体</li>
</ul>
<p>AI 的定位始终是：</p>
<blockquote>
<p><strong>受约束的生产力，而不是自主决策者</strong>。</p>
</blockquote>
<h2 data-id="heading-11">九、结语：真正的竞争力是什么</h2>
<blockquote>
<p>当所有公司都能用 AI 写代码时，<br/>
真正的差距在于：</p>
<p><strong>谁能把 AI 纳入工程体系，而不是工具清单。</strong></p>
</blockquote>
<p>这套三层 Prompt 方法论，本质上是：</p>
<ul>
<li>把“人类的软件工程经验”</li>
<li>翻译成“AI 可执行的规则体系”</li>
</ul>
<p>也是企业在 AI 时代构建长期技术竞争力的关键基础。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Thinking Machines首款产品重大更新：K2 Thinking、Qwen3-VL都可以微调了]]></title>    <link>https://juejin.cn/post/7583991680748945435</link>    <guid>https://juejin.cn/post/7583991680748945435</guid>    <pubDate>2025-12-16T02:29:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583991680748945435" data-draft-id="7583952017674502195" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Thinking Machines首款产品重大更新：K2 Thinking、Qwen3-VL都可以微调了"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2025-12-16T02:29:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="机器之心"/> <meta itemprop="url" content="https://juejin.cn/user/1873223543167902"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Thinking Machines首款产品重大更新：K2 Thinking、Qwen3-VL都可以微调了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1873223543167902/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    机器之心
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:29:37.000Z" title="Tue Dec 16 2025 02:29:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>当前，AI 领域的研究者与开发者在关注 OpenAI、Google 等领先机构最新进展的同时，也将目光投向了由前 OpenAI CTO Mira Murati 创办的 Thinking Machines Lab。</p>
<p>今年早些时候，他们推出了首款产品 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzA3MzI4MjgzMw%3D%3D%26mid%3D2650993756%26idx%3D1%26sn%3D4bd29a2b9fdaf00b29f97f6f2139decb%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzA3MzI4MjgzMw==&amp;mid=2650993756&amp;idx=1&amp;sn=4bd29a2b9fdaf00b29f97f6f2139decb&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">Tinker</a>：这是一个 API，用于帮开发者 / 研究人员微调语言模型。你只需要专注于训练数据和算法，而你不擅长的关于 Infra 的部分 —— 调度、调优、资源管理和 Infra 可靠性 —— 统统由 Tinker 来搞定，从而大大简化了 LLM 的后训练过程。</p>
<p>此前，Tinker 仅向研究人员和开发者开放内部测试；而如今，Thinking Machines 宣布正式取消候选名单，所有用户都可以直接使用 Tinker。</p>
<p>除此以外，Tinker 还带来了其他三项更新：</p>
<p>首先，更强推理能力：用户现在可以在 Tinker 上对 Kimi K2 Thinking 进行微调。 Kimi K2 拥有万亿参数规模，是 Thinking Machines 目前规模最大的模型，专为长链推理和工具调用场景而设计。</p>
<p>其次，兼容 OpenAI API 的全新推理接口：Tinker 提供了标准的推理接口，例如：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/544708e9fd5f43eb80bc50bc3dc288f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456977&amp;x-signature=lqYKQG1PJOGx6aaO%2FCqlmShk0jo%3D" alt="图片" loading="lazy"/></p>
<p>借助本次发布，Tinker 还新增了兼容 OpenAI API 的接口封装，用户只需通过指定模型路径，即可对模型进行快速采样，即使模型仍处于训练过程中也可以使用。</p>
<p>这也意味着，Tinker 现在可以即插即用地接入任何兼容 OpenAI API 的平台。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cba51a97d2c741419f9afa70c6bf04a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456977&amp;x-signature=GXT4wcUCQVbzXyuCTSkWYk9uukQ%3D" alt="图片" loading="lazy"/></p>
<p>最后，Qwen3-VL 支持视觉输入。Tinker 新增了两款视觉模型：Qwen3-VL-30B-A3B-Instruct 和 Qwen3-VL-235B-A22B-Instruct。借助这些模型，用户可以在多种应用场景中处理图片、截图以及示意图等视觉内容。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9a234dee031d4f6890f1cf0dcbec275d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456977&amp;x-signature=DxIx7ZdyVoE0sw%2BPaN3HVd6Rrrc%3D" alt="图片" loading="lazy"/></p>
<p>这些视觉输入开箱即用，可直接应用于多种任务场景，包括监督微调和强化学习微调。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7d7ab75624241ed93a1c2a6771ac6ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456977&amp;x-signature=x0FrQdtvBFU6V7rUHeIc0BkJfQw%3D" alt="图片" loading="lazy"/></p>
<p>Tinker支持的模型</p>
<p>过去，开发者若想训练或微调前沿大模型，必须自行采购 GPU、搭建集群、处理 CUDA/NCCL 环境、维护分布式训练稳定性，门槛极高且成本巨大。</p>
<p>而 Tinker 通过将所有训练基础设施抽象为一个 API，使开发者无需管理任何算力资源，只需准备数据和算法即可训练模型。更重要的是，此次更新首次让普通开发者能够微调万亿参数的 Kimi K2 Thinking，这本来是只有顶级实验室才能掌握的能力，视觉输入的加入进一步降低了 VLM 应用门槛。</p>
<p>对此，研究者纷纷表示：「能够在无需自行管理 GPU 基础设施的情况下训练自定义图文数据，对开发者来说是一项巨大的进步。」</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9c223f5243224b2f9b190ae4b4210c5c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456977&amp;x-signature=12Q%2F8GTbGFB%2FBtCdjI3%2Fnvg2Lcc%3D" alt="图片" loading="lazy"/></p>
<p>使用 Tinker 训练图像分类模型</p>
<p>为了展示 Tinker 新增的视觉能力，Thinking Machines Lab 对 Qwen3-VL-235B-A22B-Instruct 进行了微调，并将其应用于多项经典图像分类基准测试中。</p>
<p>具体而言，研究团队选择了四个常用的数据集进行评估，包括：</p>
<ul>
<li>
<p>Caltech-101：包含 101 类常见物体的数据集</p>
</li>
<li>
<p>Stanford Cars：涵盖汽车品牌、型号和年份的数据集</p>
</li>
<li>
<p>Oxford Flowers：花卉品种数据集</p>
</li>
<li>
<p>Oxford Pets：宠物品种数据集</p>
</li>
</ul>
<p>由于 Qwen3-VL 本质上是语言模型，研究中将图像分类任务建模为文本生成问题：给定一张图片，模型直接输出对应的类别名称。研究人员将这一方法与传统的视觉基线方案 DINOv2 进行了对比。</p>
<p>DINOv2 是一种通过自监督方式训练的视觉 Transformer，常被用作纯计算机视觉任务的 backbone。对于 DINOv2，研究中在其模型之上添加了一个分类头，用于预测所有 N 个类别的概率分布。两种模型均采用 LoRA 方式进行微调。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ce8137e96154616bcf6ff0662715f8a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456977&amp;x-signature=SpQK8lqLZAwRiVWzQIw%2BFcS7D4g%3D" alt="图片" loading="lazy"/></p>
<p>图中展示了经过微调的 Qwen3-VL-235B-A22B 与 DINOv2 在简单图像分类任务上的性能对比。</p>
<p>在小样本数据场景下，Qwen3-VL-235B-A22B 的表现优于 DINOv2。这不仅是因为其模型规模更大，更重要的是，作为视觉语言模型（VLM），它天然具备语言知识（例如知道「向日葵」指代什么）。正是这种通用的语言与视觉联合能力，使得 Qwen3-VL 在图像分类之外，也能够更方便地迁移到其他视觉任务中。</p>
<p>还没体验的小伙伴，Tinker 绝对值得一试。</p>
<p>参考链接：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fthinkingmachines.ai%2Ftinker%2F" target="_blank" title="https://thinkingmachines.ai/tinker/" ref="nofollow noopener noreferrer">thinkingmachines.ai/tinker/</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fthinkingmachines.ai%2Fblog%2Ftinker-general-availability%2F" target="_blank" title="https://thinkingmachines.ai/blog/tinker-general-availability/" ref="nofollow noopener noreferrer">thinkingmachines.ai/blog/tinker…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[小米语音首席科学家：AI发展的本质就像生物进化，不开源要慢1000倍 | MEET2026]]></title>    <link>https://juejin.cn/post/7583955708318269440</link>    <guid>https://juejin.cn/post/7583955708318269440</guid>    <pubDate>2025-12-16T02:35:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583955708318269440" data-draft-id="7583921477614387235" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="小米语音首席科学家：AI发展的本质就像生物进化，不开源要慢1000倍 | MEET2026"/> <meta itemprop="keywords" content="AIGC,AI编程"/> <meta itemprop="datePublished" content="2025-12-16T02:35:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="量子位"/> <meta itemprop="url" content="https://juejin.cn/user/2858385963484488"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            小米语音首席科学家：AI发展的本质就像生物进化，不开源要慢1000倍 | MEET2026
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2858385963484488/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    量子位
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:35:05.000Z" title="Tue Dec 16 2025 02:35:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>从生物进化的漫长历程到 AI 技术的疯狂迭代，两者遵循着惊人相似的底层逻辑。</p>
<p>在探寻下一代 AI 架构的关键时刻，著名的 “Kaldi 之父”、小米集团首席语音科学家、IEEE Fellow <strong>Daniel Povey</strong> 提出：</p>
<blockquote>
<p>就像生物进化一样， AI“配方”的设计本质上就是一个不断试错的过程，而进化的速度，取决于 “复制” 一个新想法所需的时间。</p>
</blockquote>
<p>在本次<strong>量子位 MEET2026 智能未来大会</strong>上，他也将开源视为 AI 进化的核心加速器——</p>
<p>若没有开源，行业的进化速度恐怕要慢上一千倍；正是因为有了开源，技术才能像生物适应新环境一样，经历 “长期停滞 + 瞬间爆发” 的非线性跃迁。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/60925c12fed84c5aacaf536dfc93bf07~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457305&amp;x-signature=TA9%2FR3h9yzbU3KROc1h96ZDRE9k%3D" alt="" loading="lazy"/></p>
<p>至于如何在未来的竞争中生存，在他看来，大公司最明智的策略是 “两条腿走路”——</p>
<p>一边利用 Transformer 赋能当下的产品，一边保留资源探索未知，赌中下一个颠覆世界的机会。</p>
<p>为了完整体现 Daniel Povey 的思考，在不改变原意的基础上，量子位对演讲内容进行了翻译和编辑整理，希望能给你带来更多启发。</p>
<p><em>MEET2026 智能未来大会是由量子位主办的行业峰会，近 30 位产业代表与会讨论。线下参会观众近 1500 人，线上直播观众 350 万 +，获得了主流媒体的广泛关注与报道。</em></p>
<h2 data-id="heading-0">核心观点梳理</h2>
<ul>
<li>
<p>AI 的演进和自然界生物的进化过程非常相似，通过尝试不同的技术变体，然后筛选出在目标任务上表现更优的方案；</p>
</li>
<li>
<p>类比生物进化中的 “间断平衡”，AI 的发展并非连续，而是 “长期停滞 + 突然跃迁”，停滞期也不会永远持续；</p>
</li>
<li>
<p>开源对进化速度至关重要，如果每家公司都闭源，那么研究速度可能会降低为原来的千分之一；</p>
</li>
<li>
<p>不要押注单一任务或单一路线，在进化过程中找到 AI“通才”与 “专才” 的平衡，保留多种不同模型架构的存续，从而增加发掘实用新技术的机会；</p>
</li>
<li>
<p>大公司双管齐下是有意义的，一方面使用当前业界领先的技术方案，另一方面进行探索性研究，以寻找下一个重大突破。</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dcb210310f564a2dbdee1a79800f10b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457305&amp;x-signature=wCWLanNYbmnHbDzWB%2F0UdMFSq5g%3D" alt="" loading="lazy"/></p>
<p><em>以下为 Daniel Povey 演讲原文中译本</em></p>
<h2 data-id="heading-1">像生物进化一样快速试错</h2>
<p>大家好，今天我想和大家分享一些关于 “进化” 和“AI”的思考，以及我们如何从生物演化中汲取关于 AI 未来的启示。我将主要从科研和模型本身的角度解读这个问题。</p>
<p>人们设计 AI“配方” 的过程，本质上主要还是一个不断试错的过程。</p>
<p>当人们有了新的理解，就会发表许多富含公式的论文，但其中 99% 的内容都没什么真正可操作的价值，最后能落地的通常只是 “配方” 本身。</p>
<p>所以设计 AI“配方” 的基本流程就是尝试不同变体，然后筛选出有效的进行发布，别人再照着做。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/353e35fc4c02427c84d2edcdec53ad46~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457305&amp;x-signature=VibhUMmINBiV5Kamhb0dDtD%2B06k%3D" alt="" loading="lazy"/></p>
<p>这其实和生物进化非常相似。</p>
<p>在生物进化中，进化过程也会和外部环境相互影响，例如地球上的进化会受到太阳辐射变化、大气成分变化的影响，而生命本身也会反过来影响这些环境因素，比如改变大气成分。</p>
<p>AI 的进化也是如此，可能会受到硬件、数据等资源的限制；同时，AI 也会通过商业效应、群体行为效应反作用于这些外部条件。</p>
<p>在历史上，生物进化甚至曾经多次 “破坏” 自身的生存环境，例如“大氧化事件”<em>（Great Oxygenation Event）</em>，不过最终生命又从中恢复了过来。</p>
<p><em>（注：大氧化事件是指约 26 亿年前，大气中的游离氧含量突然增加的事件，其具体原因不明。该事件使地球上矿物的成分发生了变化，也使得日后动物的出现成为了可能。）</em></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0b11f57b54874f9f894957efb552b9e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457305&amp;x-signature=MY0vJ7HwhdJdqa8G%2FJFJOLIrxnQ%3D" alt="" loading="lazy"/></p>
<p>生物学中 “世代间隔”_（Generation time）_类比到 AI，就是复制一个新想法所需的时间，通常这个时间会持续数个月。</p>
<p>因为当你有了新的发现，往往要先写论文，而且一般是写完才对外公开，有些期刊甚至规定发表前不能先上传 arXiv 之类的预印本。</p>
<p>过去这样的周期可能需要大概两年，但现在可能缩短到了<strong>六个月</strong>。</p>
<p>现在，有了 PyTorch 这样的工具，人们可以近乎完美地复现他人发布的 “配方”。</p>
<p>当然，有时人们可能只给出了描述_（而没有代码）_，这会使得复现过程稍慢一些，但整体上，代际周期的长短决定了进化的快慢。</p>
<p>就像世代间隔漫长的大型生物，往往进化缓慢；而那些能够快速繁衍的小型生物，进化速度则要快得多。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f26e0426551f4dd4b5f56f2f486553e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457305&amp;x-signature=9kcQNBLBNHD5e9FfL4sVcGOm%2F%2Fc%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">去不同领域寻找 AI 突破口</h2>
<p>在自然界的进化中，往往存在一种 “停停走走” 的节奏，很长一段时间里几乎没有什么动静，随后突然发生剧变。</p>
<p>对于自然界的物种来说，这种变化通常是由迁移到新环境所导致的；但偶尔，它也源于生命 “解锁” 了某种新事物，比如光合作用演化出来时，整个进化的节奏便迅速发生了改变。</p>
<p>我从事 AI 领域大概有 30 年了，特别是在语音领域，也经历过长时间没有太大进展的阶段，当时我们甚至以为 “这就是终点”。</p>
<p>当年我们做高斯混合模型、判别式训练时，以为语音识别的最终形态就是那样了，没人能想象未来的改变。所以也许十年后，也会出现今天谁都无法想象的全新模型。</p>
<p>AI 的发展中，不同任务之间的相互作用非常重要，比如视觉领域的新方法，后来可能会用于语音、语言等任务。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a873ff2d68e480981d1f638d265c634~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457305&amp;x-signature=5i28sC3HOgx1LRT%2BCt1BvaFj9c4%3D" alt="" loading="lazy"/></p>
<p>最近一个典型例子就是 Transformers，它最初是专门为语言模型设计的，后来却在各种任务中大放异彩。</p>
<p>在进化中也是如此，海豚绝无可能仅在海洋里就进化成型，因为它那些呼吸空气的机能，原本是为了适应陆地生活才演化出来的。但当它重返海洋后，却成了最成功的顶级捕食者。</p>
<p>这说明，<strong>有时候你确实需要暂时去做一些截然不同的事情，最终才能在原本的目标上取得成功</strong>。</p>
<h2 data-id="heading-3">如果不开源，AI 得慢上一千倍</h2>
<p>当然，拿生物进化做类比也有局限性。毕竟我们可以<strong>主动去理解事物</strong>，可以利用数学推导，或者改进可视化和调试工具，从而加速技术的发展。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/43d79290e3364a0ab5111bcdd265332f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457305&amp;x-signature=ff5n3unEEmIBa7rCoschSGiNNX4%3D" alt="" loading="lazy"/></p>
<p>此外，提速也非常关键。实验跑得越快，进化的迭代就越快，这对研究价值巨大。</p>
<p>而在这一点上，<strong>开源</strong>起到了至关重要的作用。</p>
<p>如果每家公司都得自己从头重复造轮子，研究速度恐怕要慢上一千倍。</p>
<p>我们可以设想一个平行世界，如果大公司决定不开源 PyTorch，我也没有开源 Kaldi 项目，那 AI 研发的局面会很不相同。</p>
<p>不过，不开源在某些行业确实是常态，尤其是涉及<strong>实体工程</strong>的领域，因为开发一款工具往往极其昂贵，可能要砸出数百万美元，所以没人会把他们的模型开源出来。</p>
<p>其实，2012 年我之所以离开工业界，就是因为这个问题。当时的大公司普遍对开源都不怎么感冒，所以我转去学术界待了一段时间。</p>
<p>但如今很多公司都开始拥抱开源了，像小米就非常支持我的工作，也支持开源，所以我又回到了工业界。</p>
<h2 data-id="heading-4">寻找 Transformer 之后的下一个颠覆者</h2>
<p>回到关于进化的比喻，我刚才吐槽过论文中的那些数学理论往往不够具体，没法落地。那么，我们到底能从中能学到什么实实在在的东西呢？</p>
<p>有一点很关键，那就是我们需要在各种不同的任务上不断探索新思路。</p>
<p>因为在进化这件事上，很难预判哪种生物最终会胜出。就像啮齿类动物，起初可能只是为了吃竹子种子这种极具体的目的而进化的。</p>
<p>但结果谁曾想，这反而让它们演化出了一种极强的 “通才” 式生存能力，最终遍布全球、无所不能。</p>
<p>可在当时，谁能想到吃竹子种子这事儿能带来这么大的突破呢？这种事真的太难预测了。</p>
<p>所以说，关键就在于要<strong>多尝试不同的任务</strong>，因为我们为了突破某个任务特有限制研发出的解决方案，可能最后会被证明具有极高的通用价值。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b36641dd5f354d8db9fc4b5b624f0e4a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457305&amp;x-signature=rN08PLNODxb43NIETQ7w5tlJIRc%3D" alt="" loading="lazy"/></p>
<p>我们需要关注进化过程中 “通才” 与“专才”之间的权衡，我并非要分出孰优孰劣，但是从长远来看，不同的进化策略能够适应不同的环境——</p>
<p>如果环境长期稳定，自然界往往会涌现出大量像熊猫这样的 “专才”，它们虽然只吃一种食物，却能做到极致适应；</p>
<p>可一旦环境变得动荡多变，像老鼠这种适应力极强的 “通才” 往往更具生存优势。</p>
<p>所以，这两种生存策略很可能是缺一不可的。</p>
<p>对于 AI 而言，我们应该让模型在多个不同的生态位里同时演进，这就像自然界在不同环境中进行的进化一样。毕竟，每个物种通常都有其最适应的特定生存空间。</p>
<p>如果我们能同时保留多种不同的技术路线，说不定其中某一条在经过进一步打磨后，就能带来巨大的回报。但这事儿很难提前预判，没人知道眼下哪个模型会在未来称王。</p>
<p>出于同样的理由，我们也应该维持<strong>模型架构的多样性</strong>。这就像大自然保留了丰富多样的物种一样，因为我们根本无法确定，到底哪一种架构会孕育出下一轮的重大突破。</p>
<p>在我看来，大多数大型机构采取两头并重的策略是比较明智的——既要沿用像 Transformer 等当前最顶尖的成熟模型，同时也得投入一些资源去做探索性研究，去寻找下一个技术突破口。</p>
<p>在我看来，Transformer 这种技术领域的竞争现状，就像是 “抢椅子”——只要音乐还在响，你就得跟着一直跳。</p>
<p>毕竟在 Transformer 和 LLM 依然称霸的当下，任何一家公司都绝无可能把身家性命都押在别的路线上。</p>
<p>但大家心里也都清楚，音乐迟早有停下来的那一天。</p>
<p>所以，小米在 LLM 上的研究主线很明确，那就是利用 SOTA 级别的 AI 和大模型技术，去全方位赋能我们的 “人车家全生态”。</p>
<p>我个人其实并没有深度参与这些工作，因为我和团队主要负责的是探索性研究。我们尝试了大量不同的方向，就是希望能找到能产生巨大影响的成果，但这事的成功率向来极低。</p>
<p>回首我的整个研究生涯，尝试过的点子恐怕得有上万个。现在回头看，其中有一两个如果当时我能推广得再好一点，说不定真能成为颠覆性的技术。</p>
<p>比如，早在大家连 BatchNorm 都还没开始用的时候，我们组其实就已经设计出了一种类似于 LayerNorm 的归一化模块。</p>
<p>但我也不想像 Jürgen Schmidhuber 那样说 “我在所有人之前发明了一切”。</p>
<p><em>（注：Jurgen Schmidhuber 是著名计算机科学家、LSTM 之父，喜欢在 AI 领域出现新成果时发表文章或评论，列举自己上世纪的论文，表示 “这个东西我几十年前就发明过了”。）</em></p>
<p>因为作为一名研究人员，有责任去判断哪些是有价值的想法，并对其进行妥善推广。如果你没做到，那就得承认是自己的失误。</p>
<p>言归正传，我的团队目前正在研发一种针对语音的新模型架构，叫 <strong>Zapformer</strong>，是一个通用声音基座。</p>
<p>相较于我们去年推出的 Zipformer 而言，Zapformer 实现了三大跨越：</p>
<ul>
<li>
<p>从 “人声” 到“万声”的跨越：从专注于人声建模，到成为能同时理解人声、环境音等多元信息的通用声音基座；</p>
</li>
<li>
<p>从优化结构到创新理论的跨越：通过引入梯度流（Gradient Flow）理论指导模型设计，在已属业界标杆的 Zipformer 基础上，将语音识别精度再次显著提升 10%-15%；</p>
</li>
<li>
<p>从专用优化到通用健壮的跨越：为适应海量数据训练移除了 Dropout 层，增强了大数据拟合能力，同时将优化器升级为 TransformAdam，在保持极速收敛的同时，大幅提升了训练的通用性与稳定性。</p>
</li>
</ul>
<p>我不想把话说太满，说它就是 “下一个大热门”，但它确实包含了不少有意思的想法。</p>
<p>当然，我们希望能押中下一个 “大杀器”，但这事儿谁也没法打包票。</p>
<p>所有这些成果全都是开源的，因为我是开源的坚定信徒。除了我的项目，小米还有很多其他的开源项目。</p>
<p><strong>欢迎在评论区留下你的想法！</strong></p>
<p>— <strong>完</strong> —</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一文读懂大模型智能体（Agent）：从理论到实践]]></title>    <link>https://juejin.cn/post/7583943503556788274</link>    <guid>https://juejin.cn/post/7583943503556788274</guid>    <pubDate>2025-12-16T02:37:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583943503556788274" data-draft-id="7583613222345064474" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一文读懂大模型智能体（Agent）：从理论到实践"/> <meta itemprop="keywords" content="LLM,Agent,程序员"/> <meta itemprop="datePublished" content="2025-12-16T02:37:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AI大模型"/> <meta itemprop="url" content="https://juejin.cn/user/3817967696221534"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一文读懂大模型智能体（Agent）：从理论到实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3817967696221534/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AI大模型
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:37:08.000Z" title="Tue Dec 16 2025 02:37:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2FEnjoyEDU%2FLLM" target="_blank" title="https://gitcode.com/EnjoyEDU/LLM" ref="nofollow noopener noreferrer">这里</a>。</p>
</blockquote>
<blockquote>
<p>★</p>
<p>本文全面梳理了智能体(Agent)的核心概念、架构设计与实现方法，以及主流框架的对比分析。</p>
</blockquote>
<h2 data-id="heading-0">1.  智能体基础：理解Agent的工作原理</h2>
<hr/>
<h4 data-id="heading-1">1.1 任务环境分析：PEAS模型</h4>
<p>要理解智能体的运作，我们必须先理解它所处的任务环境。在人工智能领域，通常使用PEAS模型来精确描述一个任务环境，即分析其：</p>
<ul>
<li><strong>性能度量</strong>(Performance)：评估智能体成功与否的标准</li>
<li><strong>环境</strong>(Environment)：智能体运作的场景与条件</li>
<li><strong>执行器</strong>(Actuators)：智能体影响环境的方式</li>
<li><strong>传感器</strong>(Sensors)：智能体获取环境信息的渠道</li>
</ul>
<h4 data-id="heading-2">1.2 智能体循环：持续交互的核心机制</h4>
<p>智能体并非一次性完成任务，而是通过一个持续的循环与环境进行交互，这个核心机制被称为<strong>智能体循环</strong>(Agent Loop)。在这个循环中，智能体接收环境信息，进行内部推理，然后执行动作，再观察结果，如此反复，直到达成目标。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b0c72a75308473389b1898bddf8bd7c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457427&amp;x-signature=4JkOEtGG3ryleqVOtohXIlvjUa4%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-3">1.3 提示工程：驱动LLM的关键</h4>
<p>驱动真实LLM的关键在于提示工程(Prompt Engineering)。我们需要设计一个"指令模板"，告诉LLM它应该扮演什么角色、拥有哪些工具、以及如何格式化它的思考和行动。这是我们智能体的"说明书"，它将作为system_prompt传递给LLM。</p>
<p>例如，一个旅行助手智能体的系统提示可能是：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">AGENT_SYSTEM_PROMPT</span> = <span class="hljs-string">"""  
你是一个智能旅行助手。你的任务是分析用户的请求,并使用可用工具一步步地解决问题。    
  
# 可用工具:    
- `get_weather(city: str)`: 查询指定城市的实时天气。   
- `get_attraction(city: str, weather: str)`: 根据城市和天气搜索推荐的旅游景点。    
  
# 行动格式:    
你的回答必须严格遵循以下格式。首先是你的思考过程,然后是你要执行的具体行动。    
Thought: [这里是你的思考过程和下一步计划]    
Action: [这里是你要调用的工具,格式为 function_name(arg_name="arg_value")]    
  
# 任务完成:    
当你收集到足够的信息,能够回答用户的最终问题时,你必须在`Action:`字段后使用 `finish(answer="...")`    
来输出最终答案。    
  
请开始吧!  
"""</span>
</code></pre>
<h2 data-id="heading-4">2.  智能体 vs 传统工作流：本质区别</h2>
<hr/>
<h4 data-id="heading-5">2.1 工作流(Workflow)模式</h4>
<p>工作流是一种传统的自动化范式，其核心是对一系列任务或步骤进行预先定义的、结构化的编排。它本质上是一个精确的、静态的流程图，规定了在何种条件下、以何种顺序执行哪些操作。</p>
<h4 data-id="heading-6">2.2 智能体(Agent)模式</h4>
<p>基于大型语言模型的智能体是一个具备自主性的、以目标为导向的系统。它不仅仅是执行预设指令，而是能够在一定程度上理解环境、进行推理、制定计划，并动态地采取行动以达成最终目标。LLM在其中扮演着"大脑"的角色。这种基于实时信息进行动态推理和决策的能力，正是Agent的核心价值所在。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bb4dfb1618934a0d963747e54fd9b12d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457427&amp;x-signature=O4kcSQyCM%2FLUwDsh3RhIREIYAFo%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">3.  模型参数调优：提升Agent性能的关键</h2>
<hr/>
<h4 data-id="heading-8">3.1 温度(Temperature)参数</h4>
<p>Temperature这类的可配置参数，其本质是通过调整模型对"概率分布"的采样策略，让输出匹配具体场景需求，配置合适的参数可以提升Agent在特定场景的性能。</p>
<h4 data-id="heading-9">3.2 Top-k与Top-p采样</h4>
<ul>
<li><strong>Top-k</strong>：将所有token按概率从高到低排序，取排名前k个的token组成"候选集"，随后对筛选出的k个token的概率进行"归一化"</li>
<li><strong>Top-p</strong>：将所有token按概率从高到低排序，从排序后的第一个token开始，逐步累加概率，直到累积和首次达到或超过阈值p</li>
</ul>
<h4 data-id="heading-10">3.3 参数协同工作机制</h4>
<p>在文本生成中，当同时设置Top-p、Top-k和温度系数时，这些参数会按照分层过滤的方式协同工作，其优先级顺序为：温度调整→Top-k→Top-p。温度调整整体分布的陡峭程度，Top-k会先保留概率最高的k个候选，然后Top-p会从Top-k的结果中选取累积概率≥p的最小集合作为最终的候选集。</p>
<h2 data-id="heading-11">4.  核心智能体架构与实现</h2>
<hr/>
<h4 data-id="heading-12">4.1 ReAct智能体</h4>
<p>ReAct是一种将推理(Reasoning)与行动(Action)相结合的智能体架构。其核心思想是让智能体在思考过程中明确表达推理步骤，然后基于推理选择适当的行动，再根据行动结果更新认知，形成一个持续的循环。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d696e9f05cd546fe98e100dc3ae441e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457427&amp;x-signature=y1ESV2NkPQiw51VF%2Bfm6Mh0dNBY%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># ReAct提示词模板  </span>
<span class="hljs-attr">REACT_PROMPT_TEMPLATE</span> = <span class="hljs-string">"""  
请注意,你是一个有能力调用外部工具的智能助手。    
可用工具如下:  {tools}    
  
请严格按照以下格式进行回应:    
Thought: 你的思考过程,用于分析问题、拆解任务和规划下一步行动。    
Action: 你决定采取的行动,必须是以下格式之一:    
- `{tool_name}[{tool_input}]`:调用一个可用工具。   
- `Finish[最终答案]`:当你认为已经获得最终答案时。    
- 当你收集到足够的信息,能够回答用户的最终问题时,你必须在Action:字段后使用 finish(answer="...") 来输出最终答案。    
  
现在,请开始解决以下问题:  
Question: {question}    
History: {history}    
"""</span>
</code></pre>
<p>智能体将不断重复这个Thought -&gt; Action -&gt; Observation的循环，将新的观察结果追加到历史记录中，形成一个不断增长的上下文，直到它在Thought中认为已经找到了最终答案，然后输出结果。这个过程形成了一个强大的协同效应：推理使得行动更具目的性，而行动则为推理提供了事实依据。</p>
<h4 data-id="heading-13">4.2 Plan-and-Solve智能体</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d4ef1a7c03546e098fa946fdd8939ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457427&amp;x-signature=ufKPUFYMk1IeKbOYye8D7co2f0M%3D" alt="" loading="lazy"/></p>
<p>Plan-and-Solve将整个流程解耦为两个核心阶段：</p>
<ol>
<li>规划阶段(Planning Phase)：首先，智能体会接收用户的完整问题。它的第一个任务不是直接去解决问题或调用工具，而是将问题分解，并制定出一个清晰、分步骤的行动计划。这个计划本身就是一次大语言模型的调用产物。</li>
<li>执行阶段(Solving Phase)：在获得完整的计划后，智能体进入执行阶段。它会严格按照计划中的步骤，逐一执行。每一步的执行都可能是一次独立的LLM调用，或者是对上一步结果的加工处理，直到计划中的所有步骤都完成，最终得出答案。</li>
</ol>

<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 规划器提示词模板  </span>
<span class="hljs-attr">PLANNER_PROMPT_TEMPLATE</span> = <span class="hljs-string">"""  
你是一个顶级的AI规划专家。你的任务是将用户提出的复杂问题分解成一个由多个简单步骤组成的行动计划。    
请确保计划中的每个步骤都是一个独立的、可执行的子任务,并且严格按照逻辑顺序排列。    
你的输出必须是一个Python列表,其中每个元素都是一个描述子任务的字符串。    
  
问题: {question}    
请严格按照以下格式输出你的计划,`python与`作为前后缀是必要的:    
`python    
["步骤1", "步骤2", "步骤3", ...]    
`    
"""</span>  
  
<span class="hljs-comment"># 执行器提示词模板  </span>
<span class="hljs-attr">EXECUTOR_PROMPT_TEMPLATE</span> = <span class="hljs-string">"""  
你是一位顶级的AI执行专家。你的任务是严格按照给定的计划,一步步地解决问题。    
你将收到原始问题、完整的计划、以及到目前为止已经完成的步骤和结果。    
请你专注于解决"当前步骤",并仅输出该步骤的最终答案,不要输出任何额外的解释或对话。    
  
# 原始问题:    
{question}    
  
# 完整计划:    
{plan}    
  
# 历史步骤与结果:    
{history}    
  
# 当前步骤:    
{current_step}    
  
请仅输出针对"当前步骤"的回答:    
"""</span>
</code></pre>
<h4 data-id="heading-14">4.3 Reflection智能体</h4>
<p>Reflection机制的核心思想是为智能体引入一种事后(post-hoc)的自我校正循环，使其能够像人类一样，审视自己的工作，发现不足，并进行迭代优化。它为智能体提供了一个内部纠错回路，使其不再完全依赖于外部工具的反馈(ReAct的Observation)，从而能够修正更高层次的逻辑和策略错误。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f5696d4cbb0e46f981d1145ae840f40a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457427&amp;x-signature=OhqKXGZu%2FWvio9RHzNFvAQX08Hs%3D" alt="" loading="lazy"/></p>
<p>Reflection机制的优势：</p>
<ul>
<li>将一次性的任务执行转变为一个持续优化的过程，显著提升复杂任务的最终成功率和答案质量</li>
<li>为智能体构建了一个临时的"短期记忆"，整个"执行-反思-优化"的轨迹形成了宝贵的经验记录</li>
<li>支持多模态反思，可以反思和修正文本以外的输出(如代码、图像等)</li>
</ul>

<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 初始执行提示词  </span>
<span class="hljs-attr">INITIAL_PROMPT_TEMPLATE</span> = <span class="hljs-string">"""  
你是一位资深的Python程序员。请根据以下要求,编写一个Python函数。    
你的代码必须包含完整的函数签名、文档字符串,并遵循PEP 8编码规范。    
要求: {task}    
请直接输出代码,不要包含任何额外的解释。    
"""</span>  
  
<span class="hljs-comment"># 反思提示词  </span>
<span class="hljs-attr">REFLECT_PROMPT_TEMPLATE</span> = <span class="hljs-string">"""  
你是一位极其严格的代码评审专家和资深算法工程师,对代码的性能有极致的要求。    
你的任务是审查以下Python代码,并专注于找出其在&lt;strong&gt;算法效率&lt;/strong&gt;上的主要瓶颈。    
  
# 原始任务:    
{task}  
  
# 待审查的代码:    
`python    
{code}    
`  
  
请分析该代码的时间复杂度,并思考是否存在一种&lt;strong&gt;算法上更优&lt;/strong&gt;的解决方案来显著提升性能。    
如果存在,请清晰地指出当前算法的不足,并提出具体的、可行的改进算法建议(例如,使用筛法替代试除法)。    
如果代码在算法层面已经达到最优,才能回答"无需改进"。    
  
请直接输出你的反馈,不要包含任何额外的解释。    
"""</span>  
  
<span class="hljs-comment"># 优化提示词  </span>
<span class="hljs-attr">REFINE_PROMPT_TEMPLATE</span> = <span class="hljs-string">"""  
你是一位资深的Python程序员。你正在根据一位代码评审专家的反馈来优化你的代码。    
  
# 原始任务:    
{task}    
  
# 你上一轮尝试的代码:    
`    
{last_code_attempt}    
`  
  
评审员的反馈:    
{feedback}    
  
请根据评审员的反馈,生成一个优化后的新版本代码。    
你的代码必须包含完整的函数签名、文档字符串,并遵循PEP 8编码规范。    
请直接输出优化后的代码,不要包含任何额外的解释。    
"""</span>
</code></pre>
<h2 data-id="heading-15">5.  智能体框架对比分析</h2>
<hr/>
<h4 data-id="heading-16">5.1 框架的本质与价值</h4>
<p>框架的本质，是提供一套经过验证的"规范"。它将所有智能体共有的、重复性的工作(如主循环、状态管理、工具调用、日志记录等)进行抽象和封装，让我们在构建新的智能体时，能够专注于其独特的业务逻辑，而非通用的底层实现。</p>
<h4 data-id="heading-17">5.2 AutoGen：基于对话的协作</h4>
<p>AutoGen的核心思想是通过对话实现协作。它将多智能体系统抽象为一个由多个"可对话"智能体组成的群聊。开发者可以定义不同角色(如Coder, ProductManager, Tester)，并设定它们之间的交互规则(例如，Coder写完代码后由Tester自动接管)。任务的解决过程，就是这些智能体在群聊中通过自动化消息传递，不断对话、协作、迭代直至最终目标达成的过程。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3eb195e18354402a8f2d7243b908295e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457427&amp;x-signature=UAlBCKjaXH3JYr%2FiI7xwdmjqga4%3D" alt="" loading="lazy"/></p>
<p>AutoGen的核心机制：</p>
<ul>
<li><strong>轮询群聊</strong>(RoundRobinGroupChat)：这是一种明确的、顺序化的对话协调机制。它会让参与的智能体按照预定义的顺序依次发言。这种模式非常适用于流程固定的任务，例如一个典型的软件开发流程：产品经理先提出需求，然后工程师编写代码，最后由代码审查员进行检查。</li>
</ul>

<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_product_manager</span>(<span class="hljs-params">model_client</span>):  
    <span class="hljs-string">"""创建产品经理智能体"""</span>  
    system_message = <span class="hljs-string">"""  
    你是一位经验丰富的产品经理，专门负责软件产品的需求分析和项目规划。  
      
    你的核心职责包括：  
    1. **需求分析**：深入理解用户需求，识别核心功能和边界条件  
    2. **技术规划**：基于需求制定清晰的技术实现路径  
    3. **风险评估**：识别潜在的技术风险和用户体验问题  
    4. **协调沟通**：与工程师和其他团队成员进行有效沟通  
      
    当接到开发任务时，请按以下结构进行分析：  
    1. 需求理解与分析  
    2. 功能模块划分  
    3. 技术选型建议  
    4. 实现优先级排序  
    5. 验收标准定义  
      
    请简洁明了地回应，并在分析完成后说"请工程师开始实现"。  
    """</span>  
  
    <span class="hljs-keyword">return</span> AssistantAgent(  
        name=<span class="hljs-string">"ProductManager"</span>,  
        model_client=model_client,  
        system_message=system_message,  
    )
</code></pre>
<p>工作流程：</p>
<ol>
<li>创建一个RoundRobinGroupChat实例，并将所有参与协作的智能体加入其中</li>
<li>当任务开始时，群聊按预设顺序依次激活相应智能体</li>
<li>被选中的智能体根据当前对话上下文进行响应</li>
<li>群聊将新回复加入对话历史，并激活下一个智能体</li>
<li>过程持续进行，直到达到最大对话轮次或满足预设终止条件</li>
</ol>
<h4 data-id="heading-18">5.3 AgentScope：工业级多智能体平台</h4>
<p>AgentScope是一个专为多智能体应用设计的、功能全面的开发平台。它的核心特点是易用性和工程化。它提供了一套非常友好的编程接口，让开发者可以轻松定义智能体、构建通信网络，并管理整个应用的生命周期。其内置的消息传递机制和对分布式部署的支持，使其非常适合构建和运维复杂、大规模的多智能体系统。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c18803f92ccd43ca8b1ebff650fbd8f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457427&amp;x-signature=xcJfigC2JoZoQLuUPtbDirYyN2s%3D" alt="" loading="lazy"/></p>
<p>与AutoGen相比，AgentScope的核心差异在于其消息驱动的架构设计和工业级的工程实践。如果说AutoGen更像是一个灵活的"对话工作室"，那么AgentScope就是一个完整的"智能体操作系统"，为开发者提供了从开发、测试到部署的全生命周期支持。与许多框架采用的继承式设计不同，AgentScope选择了组合式架构和消息驱动模式。这种设计不仅增强了系统的模块化程度，也为其出色的并发性能和分布式能力奠定了基础。</p>
<p>AgentScope的工程化优势也带来了一定的复杂性成本。其消息驱动架构虽然强大，但对开发者的技术要求较高，需要理解异步编程、分布式通信等概念。对于简单的多智能体对话场景，这种架构可能显得过于复杂，存在"过度工程化"的风险。此外，作为相对较新的框架，其生态系统和社区资源还有待进一步完善。因此，AgentScope更适合需要构建大规模、高可靠性的生产级多智能体系统，而对于快速原型开发或简单应用场景，选择更轻量级的框架可能更为合适。</p>
<h4 data-id="heading-19">5.4 CAMEL：角色扮演协作</h4>
<p>CAMEL最初的核心目标是探索如何在最少的人类干预下，让两个智能体通过"角色扮演"自主协作解决复杂任务。CAMEL实现自主协作的基石是两大核心概念：角色扮演(Role-Playing)和引导性提示(Inception Prompting)。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/06d2ed53fdd64f1d8f2f8e78d5354587~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457427&amp;x-signature=XuTqOxlfiZ%2FN3JtXJa6LFmf5DyA%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-20">5.5 LangGraph：图结构工作流</h4>
<p>作为LangChain生态的扩展，LangGraph另辟蹊径，将智能体的执行流程建模为图(Graph)。在传统的链式结构中，信息只能单向流动。而LangGraph将每一步操作(如调用LLM、执行工具)定义为图中的一个节点(Node)，并用边(Edge)来定义节点之间的跳转逻辑。这种设计天然支持循环(Cycles)，使得实现如Reflection这样的迭代、修正、自我反思的复杂工作流变得异常简单和直观。</p>
<p>与前面介绍的基于"对话"的框架(如AutoGen和CAMEL)不同，LangGraph将智能体的执行流程建模为一种状态机(State Machine)，并将其表示为有向图(Directed Graph)。在这种范式中，图的节点(Nodes)代表一个具体的计算步骤(如调用LLM、执行工具)，而边(Edges)则定义了从一个节点到另一个节点的跳转逻辑。这种设计的革命性之处在于它天然支持循环，使得构建能够进行迭代、反思和自我修正的复杂智能体工作流变得前所未有的直观和简单。</p>
<hr/>
<p>当前主流的低代码智能体开发平台呈现多元化发展格局，字节跳动旗下的Coze凭借可视化拖拽式界面和丰富的模板库，成为零代码用户的入门首选，尤其适合对话类应用开发，但其扩展性有限且仅支持云服务部署。国产开源平台Dify则以灵活定制和企业级能力见长，支持云服务与本地部署双模式，集成了主流大模型和低代码工作流功能，深受开发者青睐。德国工具n8n凭借其工匠精神和强大的工作流编排能力，在轻量级应用领域占据一席之地。此外，专注于企业级知识库系统和智能问答应用的FastGPT，以及全栈式企业平台得助智能等，共同构成了2025年智能体低代码开发平台的生态矩阵。</p>
<p>为了在本地实现高性能、生产级的模型推理服务，社区涌现出了VLLM和Ollama等优秀工具。这些工具能够显著提升推理速度，降低资源消耗，使智能体在本地环境中也能获得接近云端的性能表现。</p>
<p>随着框架的成熟和工具链的完善，智能体开发的门槛正在逐步降低，但对开发者来说，理解其底层原理和设计模式仍然是构建高性能、高可靠性智能体系统的关键。未来，随着多模态能力的增强和与物理世界的深度结合，智能体将在更广泛的应用场景中发挥重要作用。</p>
<h3 data-id="heading-21">学习资源推荐</h3>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2FEnjoyEDU%2FLLM" target="_blank" title="https://gitcode.com/EnjoyEDU/LLM" ref="nofollow noopener noreferrer">这里</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Nginx HTTPS代理大文件加载失败的排查与解决方案]]></title>    <link>https://juejin.cn/post/7583970267132919814</link>    <guid>https://juejin.cn/post/7583970267132919814</guid>    <pubDate>2025-12-16T02:26:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583970267132919814" data-draft-id="7583980250733346879" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Nginx HTTPS代理大文件加载失败的排查与解决方案"/> <meta itemprop="keywords" content="Nginx"/> <meta itemprop="datePublished" content="2025-12-16T02:26:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="枫叶梨花"/> <meta itemprop="url" content="https://juejin.cn/user/3913917123816055"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Nginx HTTPS代理大文件加载失败的排查与解决方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3913917123816055/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    枫叶梨花
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:26:48.000Z" title="Tue Dec 16 2025 02:26:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、问题背景</h2>
<p>今日运维人员告知我，突然网站的登录页访问变白屏，我登录后台发现服务一切正常，Nginx也正常运行，我尝试访问网站登录页，并连点十几次会访问正常，之后就会正常，但是登录以后也会<strong>某些页面存在白屏状态</strong>，查看浏览器请求发现<strong>某些JS、CSS文件没有正常返回</strong>，Nginx的<strong>访问日志出现206等问题</strong>，想到前几天刚续费了HTTPS的域名证书，证书也换过了，然后切换到<strong>内网HTTP发现正常</strong>，猜想应该是Nginx中的HTTPS的配置有问题，缓存类配置可能存在问题。</p>
<h2 data-id="heading-1">二、问题现象</h2>
<p>总结出现以下异常：</p>
<ul>
<li><strong>HTTPS访问登录页白屏</strong>，连续刷新20次后偶现正常；</li>
<li><strong>HTTP内网访问正常</strong>，无异常；</li>
<li>浏览器开发者工具显示：<strong>大体积JS文件（如<code>chunk-vendors.js</code>）加载失败</strong>，状态码为<code>206 Partial Content</code>；</li>
<li>Nginx访问日志记录：
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-number">10.</span>xx.xxx<span class="hljs-number">.90</span> - - <span class="hljs-number">443</span> [<span class="hljs-number">25</span>/Oct/<span class="hljs-number">2025</span>:<span class="hljs-number">17</span>:<span class="hljs-number">40</span>:<span class="hljs-number">20</span> +<span class="hljs-number">0800</span>] 
  <span class="hljs-string">"GET /js/chunk-vendors.6112ac08.js HTTP/1.1"</span> <span class="hljs-number">206</span> <span class="hljs-number">1</span> 
  <span class="hljs-string">"https://xxxx/login"</span> 
  <span class="hljs-string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"</span>
</code></pre>
</li>
</ul>
<hr/>
<h2 data-id="heading-2">三、问题定位与根因分析</h2>
<h3 data-id="heading-3">1. 核心问题：Nginx代理缓冲区不足</h3>
<h4 data-id="heading-4">（1）Nginx代理工作原理</h4>
<p>当Nginx作为反向代理时，其处理上游响应的流程如下：</p>
<ol>
<li>接收后端服务返回的响应数据；</li>
<li>将数据<strong>缓存到内存缓冲区</strong>中；</li>
<li>若缓冲区不足，则将数据写入临时文件（<code>proxy_max_temp_file_size</code>控制）；</li>
<li>最终将数据发送给客户端（浏览器）。</li>
</ol>
<h4 data-id="heading-5">（2）默认配置的限制</h4>
<p>Nginx默认配置的缓冲区大小为：</p>
<pre><code class="hljs language-nginx" lang="nginx">proxy_buffer_size 4k|8k;        # 响应头缓冲区
proxy_buffers 8 4k|8k;          # 响应体缓冲区（数量 × 大小）
proxy_busy_buffers_size 8k|16k; # 忙碌时可发送的最大缓冲区
</code></pre>
<ul>
<li><strong>总缓冲容量</strong>：<code>8 × 4k = 32KB</code>，不足以承载1~2MB的前端资源；</li>
<li><strong>HTTPS加重问题</strong>：TLS加密/解密消耗更多CPU资源，导致缓冲区更容易被撑满；</li>
<li><strong>206状态码的含义</strong>：<code>Partial Content</code>，表示响应未完整传输，Nginx在临时文件写入过程中可能因超时或中断导致加载失败。</li>
</ul>
<h4 data-id="heading-6">（3）为何HTTP正常？</h4>
<p>HTTP无需加密，Nginx处理速度更快，缓冲区在短时间内能完成数据传输，因此未触发问题。</p>
<hr/>
<h2 data-id="heading-7">四、解决方案与配置说明</h2>
<h3 data-id="heading-8">1. 调整Nginx代理缓冲区参数</h3>
<p>在Nginx配置文件的<code>http</code>块中添加以下配置：</p>
<pre><code class="hljs language-nginx" lang="nginx"># 增加内存缓冲区大小，避免写入临时文件
proxy_buffer_size 128k;         # 存储响应头（含Cookie/CSP等）
proxy_buffers 32 128k;          # 存储响应体（32 × 128k = 4MB）
proxy_busy_buffers_size 128k;   # 忙碌时最大发送缓冲区
</code></pre>
<h4 data-id="heading-9">参数详解：</h4>





























<table><thead><tr><th>参数</th><th>作用</th><th>推荐值</th><th>说明</th></tr></thead><tbody><tr><td><code>proxy_buffer_size</code></td><td>响应头缓冲区</td><td>128k</td><td>确保大头信息（如Cookie、CSP）完整加载</td></tr><tr><td><code>proxy_buffers</code></td><td>响应体缓冲区</td><td>32 × 128k</td><td>总容量4MB，覆盖常见前端资源大小</td></tr><tr><td><code>proxy_busy_buffers_size</code></td><td>忙碌时发送缓冲区</td><td>128k</td><td>避免缓冲区争用导致发送中断</td></tr></tbody></table>
<blockquote>
<p>✅ <strong>生效范围</strong>：配置应放在<code>http</code>块中全局生效，或针对特定<code>server</code>/<code>location</code>块。</p>
</blockquote>
<h3 data-id="heading-10">2. 重载Nginx配置</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查配置语法</span>
sudo nginx -t

<span class="hljs-comment"># 重载配置</span>
sudo nginx -s reload
</code></pre>
<hr/>
<h2 data-id="heading-11">五、验证与测试</h2>
<p><strong>清除浏览器缓存</strong>之后重新访问，一切正常，问题解决。</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[maven项目使用指定JDK版本打包]]></title>    <link>https://juejin.cn/post/7583970267132985350</link>    <guid>https://juejin.cn/post/7583970267132985350</guid>    <pubDate>2025-12-16T02:39:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583970267132985350" data-draft-id="7583991680748814363" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="maven项目使用指定JDK版本打包"/> <meta itemprop="keywords" content="后端,Java,maven"/> <meta itemprop="datePublished" content="2025-12-16T02:39:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="考虑考虑"/> <meta itemprop="url" content="https://juejin.cn/user/4406498335157287"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            maven项目使用指定JDK版本打包
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4406498335157287/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    考虑考虑
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:39:48.000Z" title="Tue Dec 16 2025 02:39:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言</h3>
<p>在使用多个JDK版本环境打包过程中，有时候懒得配置环境变量，使用maven打包的时候,会报版本对应不上</p>
<h3 data-id="heading-1">maven打包</h3>
<p>没有配置对应项目jdk环境而打包时，会报</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0933efb769c94abd8f63cdd0b692b8a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ICD6JmR6ICD6JmR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457587&amp;x-signature=2FfNwazhF5EdRZcbSAz7NnS5WHo%3D" alt="image.png" loading="lazy"/>
这个时候，可以在<code>pom.xml</code>文件配置</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.8.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">source</span>&gt;</span>25<span class="hljs-tag">&lt;/<span class="hljs-name">source</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">target</span>&gt;</span>25<span class="hljs-tag">&lt;/<span class="hljs-name">target</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">executable</span>&gt;</span>D:/soft/jdk-25.0.1/bin/javac<span class="hljs-tag">&lt;/<span class="hljs-name">executable</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">fork</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">fork</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">encoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">encoding</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>
</code></pre>
<p>执行JDK路径</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4103657bb5ff47fd9ef22b21a05d78ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ICD6JmR6ICD6JmR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457587&amp;x-signature=EXqe2UgpC092x2oUIb2oitvpRLg%3D" alt="image.png" loading="lazy"/>
或者使用mvn命令</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 使用指定JDK版本编译打包</span>
mvn clean package <span class="hljs-attr">-Dmaven.compiler.source</span>=<span class="hljs-number">25</span> -Dmaven.compiler.target=<span class="hljs-number">25</span>

<span class="hljs-comment"># 如果需要指定JDK安装路径 </span>
mvn clean package <span class="hljs-attr">-Dmaven.compiler.executable</span>=D:/soft/jdk-<span class="hljs-number">25.0</span>.<span class="hljs-number">1</span>/bin/javac
</code></pre>
<h3 data-id="heading-2">总结</h3>
<p>maven打包可以指定对应的JDK版本打包，这样就不用每次需要切换路径</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从 0 到 1 构建 React + TypeScript 车辆租赁后台管理系统]]></title>    <link>https://juejin.cn/post/7583933107690176575</link>    <guid>https://juejin.cn/post/7583933107690176575</guid>    <pubDate>2025-12-16T02:36:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583933107690176575" data-draft-id="7583933107690127423" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从 0 到 1 构建 React + TypeScript 车辆租赁后台管理系统"/> <meta itemprop="keywords" content="前端,TypeScript"/> <meta itemprop="datePublished" content="2025-12-16T02:36:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一只秋刀鱼"/> <meta itemprop="url" content="https://juejin.cn/user/2907533671935453"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从 0 到 1 构建 React + TypeScript 车辆租赁后台管理系统
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2907533671935453/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一只秋刀鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:36:57.000Z" title="Tue Dec 16 2025 02:36:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">从 0 到 1 构建 React + TypeScript 车辆租赁后台管理系统</h2>
<p>在企业级后台管理系统开发中，React 结合 TypeScript 已是主流技术栈 ——TypeScript 的类型校验能大幅降低大型项目的维护成本，React 的组件化特性则适配后台系统复杂的 UI 与交互场景。本文以<strong>车辆租赁后台管理系统</strong>为例，拆解从技术选型、架构设计到核心功能实现的全流程，为前端开发者提供可落地的实战思路。</p>
<h3 data-id="heading-1">一、项目背景与技术栈选型</h3>
<h4 data-id="heading-2">1. 业务场景特点</h4>
<p>车辆租赁后台需覆盖「车辆管理、订单调配、客户管理、财务结算、操作日志」等核心模块，具有以下特点：</p>
<ul>
<li>数据交互频繁（如实时查询车辆状态、订单流转）；</li>
<li>表单 / 表格操作密集（如批量派发任务、筛选车辆信息）；</li>
<li>权限分级严格（不同角色可见 / 可操作的模块不同）；</li>
<li>需兼容多端（PC 端为主，部分功能适配平板）。</li>
</ul>
<h4 data-id="heading-3">2. 核心技术栈</h4>

































<table><thead><tr><th>技术 / 框架</th><th>选型理由</th></tr></thead><tbody><tr><td>React 18</td><td>组件化开发、Hooks 简化状态管理、Concurrent Mode 提升交互流畅度</td></tr><tr><td>TypeScript 5.x</td><td>强类型约束避免类型错误、提升代码可读性、便于团队协作</td></tr><tr><td>Umi 4</td><td>开箱即用的路由 / 构建 / 权限方案，适配中后台开发的工程化需求</td></tr><tr><td>Ant Design Pro</td><td>提供 ProTable/ProForm/Descriptions 等中后台高频组件，减少重复造轮子</td></tr><tr><td>ahooks</td><td>封装常用 Hooks（如 useRequest、useSelections），简化异步请求 / 状态管理</td></tr><tr><td>axios</td><td>统一封装请求拦截、响应处理，适配后端接口规范</td></tr></tbody></table>
<h3 data-id="heading-4">二、项目架构设计</h3>
<p>遵循「高内聚、低耦合」原则，采用分层式架构，目录结构如下：</p>
<p>plaintext</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-attribute">src</span>/
├── api/            <span class="hljs-comment">// 接口请求封装（按模块拆分）</span>
│   ├── car<span class="hljs-selector-class">.ts</span>      <span class="hljs-comment">// 车辆管理接口</span>
│   ├── <span class="hljs-attribute">order</span><span class="hljs-selector-class">.ts</span>    <span class="hljs-comment">// 订单调配接口</span>
│   └── user<span class="hljs-selector-class">.ts</span>     <span class="hljs-comment">// 用户/权限接口</span>
├── components/     <span class="hljs-comment">// 通用业务组件（如OperationRecord、PreviewFiles）</span>
├── pages/          <span class="hljs-comment">// 页面级组件（按业务模块拆分）</span>
│   ├── CarManage/  <span class="hljs-comment">// 车辆管理</span>
│   ├── OrderAlloc/ <span class="hljs-comment">// 订单调配（核心模块）</span>
│   └── System/     <span class="hljs-comment">// 系统设置</span>
├── utils/          <span class="hljs-comment">// 工具函数（如字典映射、时间格式化）</span>
├── typings/        <span class="hljs-comment">// TS类型声明（接口返回值、组件Props）</span>
└── access<span class="hljs-selector-class">.ts</span>       <span class="hljs-comment">// 权限控制配置</span>
</code></pre>
<h4 data-id="heading-5">关键设计原则</h4>
<ol>
<li><strong>类型先行</strong>：所有接口返回值、组件 Props、全局状态均定义 TS 类型，例如订单调配模块的核心类型：</li>
</ol>
<p>typescript</p>
<p>运行</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// typings/order.d.ts</span>
<span class="hljs-comment">/** 订单基础信息 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">AllocOrder</span> {
  <span class="hljs-attr">orderNo</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 工单编号</span>
  <span class="hljs-attr">orderStatus</span>: <span class="hljs-string">'toFormulate'</span> | <span class="hljs-string">'toDistribute'</span> | <span class="hljs-string">'completed'</span>; <span class="hljs-comment">// 订单状态</span>
  <span class="hljs-attr">carNo</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 车牌</span>
  <span class="hljs-attr">vin</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 车架号</span>
  <span class="hljs-attr">allocateInfo</span>: {
    <span class="hljs-attr">batchNo</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">deliveryType</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 交付类型</span>
    <span class="hljs-attr">outContactsName</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 调出联系人</span>
  };
}

<span class="hljs-comment">/** 订单列表请求参数 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">AllocOrderParams</span> {
  <span class="hljs-attr">orderSource</span>: <span class="hljs-built_in">string</span>;
  batchNo?: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">pageSize</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">current</span>: <span class="hljs-built_in">number</span>;
}
</code></pre>
<ol start="2">
<li><strong>复用性优先</strong>：抽离通用业务组件（如操作记录组件 OperationRecord），避免重复代码：</li>
</ol>
<p>tsx</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// components/OperationRecordSection/index.tsx</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useEffect, useRef } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">ActionType</span>, <span class="hljs-title class_">ProColumns</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ant-design/pro-table'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ProTable</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@ant-design/pro-table'</span>;
<span class="hljs-keyword">import</span> { operationListPage } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/api/order'</span>;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">OperationRecordSectionProps</span> {
  <span class="hljs-attr">formValues</span>: {
    orderNo?: <span class="hljs-built_in">string</span>;
    [<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>]: <span class="hljs-built_in">any</span>;
  };
}

<span class="hljs-keyword">const</span> <span class="hljs-title class_">OperationRecordSection</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span>&lt;<span class="hljs-title class_">OperationRecordSectionProps</span>&gt; = <span class="hljs-function">(<span class="hljs-params">{ formValues }</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> actionRef = useRef&lt;<span class="hljs-title class_">ActionType</span>&gt;();

  <span class="hljs-comment">// 监听工单编号变化，自动刷新操作记录</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (formValues?.<span class="hljs-property">orderNo</span>) {
      actionRef.<span class="hljs-property">current</span>?.<span class="hljs-title function_">reload</span>();
    }
  }, [formValues?.<span class="hljs-property">orderNo</span>]);

  <span class="hljs-keyword">const</span> <span class="hljs-attr">columns</span>: <span class="hljs-title class_">ProColumns</span>[] = [
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'操作节点'</span>, <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'orderNode'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'操作人'</span>, <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'operationName'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'操作时间'</span>, <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'createdDate'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'操作详情'</span>, <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'operatorDetail'</span> },
  ];

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ProTable</span>
      <span class="hljs-attr">search</span>=<span class="hljs-string">{false}</span>
      <span class="hljs-attr">actionRef</span>=<span class="hljs-string">{actionRef}</span>
      <span class="hljs-attr">request</span>=<span class="hljs-string">{async</span> (<span class="hljs-attr">params</span>) =&gt;</span> {
        if (!formValues?.orderNo) return { data: [], total: 0 };
        return operationListPage({ ...params, orderNo: formValues.orderNo });
      }}
      columns={columns}
      pagination={{ defaultPageSize: 5 }}
    /&gt;</span>
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">OperationRecordSection</span>;
</code></pre>
<h3 data-id="heading-6">三、核心功能实现</h3>
<h4 data-id="heading-7">1. 订单调配模块（核心场景）</h4>
<p>订单调配是车辆租赁后台的核心，需实现「方案制定、任务派发、详情查看」等功能，且需结合状态控制权限与交互。</p>
<h5 data-id="heading-8">（1）带状态控制的表格渲染</h5>
<p>使用 ProTable 实现订单列表，根据订单状态（toFormulate/toDistribute）动态展示操作按钮，且仅允许勾选「方案制定」状态的行：</p>
<p>tsx</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// pages/OrderAlloc/index.tsx</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">PageHeaderWrapper</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ant-design/pro-layout'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ProTable</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@ant-design/pro-table'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Button</span>, message } <span class="hljs-keyword">from</span> <span class="hljs-string">'antd'</span>;
<span class="hljs-keyword">import</span> { getAllocationList } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/api/order'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Func</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils/Func'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">OrderAlloc</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> [selectedRowKeys, setSelectedRowKeys] = useState&lt;<span class="hljs-built_in">string</span>[]&gt;([]);
  <span class="hljs-keyword">const</span> [selectedRows, setSelectedRows] = useState&lt;<span class="hljs-title class_">AllocOrder</span>[]&gt;([]);

  <span class="hljs-comment">// 表格列配置</span>
  <span class="hljs-keyword">const</span> columns = [
    {
      <span class="hljs-attr">title</span>: <span class="hljs-string">'工单编号'</span>,
      <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'orderNo'</span>,
      <span class="hljs-attr">key</span>: <span class="hljs-string">'orderNo'</span>,
    },
    {
      <span class="hljs-attr">title</span>: <span class="hljs-string">'订单状态'</span>,
      <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'orderStatus'</span>,
      <span class="hljs-attr">valueEnum</span>: <span class="hljs-title class_">Func</span>.<span class="hljs-title function_">dictEnum</span>(dictMap, <span class="hljs-string">'AllocOrderStatus'</span>), <span class="hljs-comment">// 字典映射</span>
    },
    {
      <span class="hljs-attr">title</span>: <span class="hljs-string">'车牌'</span>,
      <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'carNo'</span>,
    },
    {
      <span class="hljs-attr">title</span>: <span class="hljs-string">'操作'</span>,
      <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'option'</span>,
      <span class="hljs-attr">valueType</span>: <span class="hljs-string">'option'</span>,
      <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">_, record</span>) =&gt;</span> (
        <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
          {/* 仅「方案制定」状态显示「方案制定」按钮 */}
          {record.orderStatus === 'toFormulate' &amp;&amp; (
            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> handleOpenFormulateModal(record)}&gt;方案制定<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
          )}
          {/* 仅「待派发」状态显示「派发任务」按钮 */}
          {record.orderStatus === 'toDistribute' &amp;&amp; (
            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> handleOpenDispatchModal(record)}&gt;派发任务<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
          )}
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> handleOpenDetail(record)}&gt;详情<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/&gt;</span></span>
      ),
    },
  ];

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">PageHeaderWrapper</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">ProTable</span>
        <span class="hljs-attr">rowKey</span>=<span class="hljs-string">"orderNo"</span>
        <span class="hljs-attr">rowSelection</span>=<span class="hljs-string">{{</span>
          <span class="hljs-attr">selectedRowKeys</span>,
          <span class="hljs-attr">onChange:</span> (<span class="hljs-attr">keys</span>, <span class="hljs-attr">rows</span>) =&gt;</span> {
            // 仅保留「方案制定」状态的选中行
            const validRows = rows.filter(row =&gt; row.orderStatus === 'toFormulate');
            setSelectedRowKeys(validRows.map(row =&gt; row.orderNo));
            setSelectedRows(validRows);
            if (rows.length &gt; validRows.length) {
              message.warning('仅"方案制定"状态的订单可勾选');
            }
          },
          // 禁用非「方案制定」状态的行勾选
          getCheckboxProps: (record) =&gt; ({
            disabled: record.orderStatus !== 'toFormulate',
          }),
        }}
        request={(params) =&gt; getAllocationList({ ...params, orderSource: 'ALLOCATE' })}
        columns={columns}
        toolBarRender={() =&gt; [
          <span class="hljs-tag">&lt;<span class="hljs-name">Button</span>
            <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span>
            <span class="hljs-attr">disabled</span>=<span class="hljs-string">{selectedRows.length</span> === <span class="hljs-string">0}</span>
            <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> handleBatchFormulate()}
          &gt;
            批量方案制定
          <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>,
        ]}
      /&gt;
    <span class="hljs-tag">&lt;/<span class="hljs-name">PageHeaderWrapper</span>&gt;</span></span>
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">OrderAlloc</span>;
</code></pre>
<h5 data-id="heading-9">（2）详情弹窗实现</h5>
<p>通过 Modal 封装详情弹窗，整合 ProTable、Descriptions 组件展示订单多维度信息，并复用操作记录组件：</p>
<p>tsx</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// pages/OrderAlloc/components/DeploymentDetail.tsx</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useEffect, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Modal</span>, <span class="hljs-title class_">Descriptions</span>, <span class="hljs-title class_">Collapse</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'antd'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ProTable</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@ant-design/pro-table'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">OperationRecordSection</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/OperationRecordSection'</span>;
<span class="hljs-keyword">import</span> { allocatePlanDetail } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/api/order'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Func</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils/Func'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">DeploymentDetail</span> = (<span class="hljs-params">{ visible, onCancel, formValues }</span>) =&gt; {
  <span class="hljs-keyword">const</span> [orderDetail, setOrderDetail] = useState&lt;<span class="hljs-title class_">AllocOrder</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);
  <span class="hljs-keyword">const</span> [taskList, setTaskList] = useState&lt;<span class="hljs-title class_">AllocOrder</span>[]&gt;([]);

  <span class="hljs-comment">// 获取订单详情</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (visible &amp;&amp; formValues?.<span class="hljs-property">batchNo</span>) {
      <span class="hljs-title function_">allocatePlanDetail</span>({ <span class="hljs-attr">batchNo</span>: formValues.<span class="hljs-property">batchNo</span> }).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
        <span class="hljs-title function_">setOrderDetail</span>(res.<span class="hljs-property">data</span>);
        <span class="hljs-title function_">setTaskList</span>(res.<span class="hljs-property">data</span>.<span class="hljs-property">taskList</span> || []);
      });
    }
  }, [visible, formValues]);

  <span class="hljs-comment">// 工单信息表格列</span>
  <span class="hljs-keyword">const</span> workColumns = [
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'工单编号'</span>, <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'orderNo'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'车型'</span>, <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'modelName'</span>, <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">_, r</span>) =&gt;</span> r.<span class="hljs-property">carInfo</span>?.<span class="hljs-property">modelName</span> || <span class="hljs-string">'-'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'交付类型'</span>, <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'deliveryType'</span>, <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">_, r</span>) =&gt;</span> <span class="hljs-title class_">Func</span>.<span class="hljs-title function_">dictLabel</span>(dictMap, <span class="hljs-string">'DeliveryType'</span>, r.<span class="hljs-property">allocateInfo</span>?.<span class="hljs-property">deliveryType</span>) || <span class="hljs-string">'-'</span> },
  ];

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Modal</span>
      <span class="hljs-attr">open</span>=<span class="hljs-string">{visible}</span>
      <span class="hljs-attr">onCancel</span>=<span class="hljs-string">{onCancel}</span>
      <span class="hljs-attr">width</span>=<span class="hljs-string">"80%"</span>
      <span class="hljs-attr">footer</span>=<span class="hljs-string">{null}</span>
      <span class="hljs-attr">destroyOnClose</span>
    &gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Collapse</span> <span class="hljs-attr">defaultActiveKey</span>=<span class="hljs-string">{[</span>'<span class="hljs-attr">1</span>', '<span class="hljs-attr">2</span>', '<span class="hljs-attr">3</span>']}&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Collapse.Panel</span> <span class="hljs-attr">header</span>=<span class="hljs-string">"工单信息"</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"1"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">ProTable</span> <span class="hljs-attr">dataSource</span>=<span class="hljs-string">{taskList}</span> <span class="hljs-attr">columns</span>=<span class="hljs-string">{workColumns}</span> <span class="hljs-attr">pagination</span>=<span class="hljs-string">{false}</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Collapse.Panel</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Collapse.Panel</span> <span class="hljs-attr">header</span>=<span class="hljs-string">"调配信息"</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"2"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Descriptions</span> <span class="hljs-attr">column</span>=<span class="hljs-string">{3}</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Descriptions.Item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"交付类型"</span>&gt;</span>
              {Func.dictLabel(dictMap, 'DeliveryType', orderDetail?.allocateInfo?.deliveryType) || '-'}
            <span class="hljs-tag">&lt;/<span class="hljs-name">Descriptions.Item</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Descriptions.Item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"备注"</span>&gt;</span>{orderDetail?.remark || '-'}<span class="hljs-tag">&lt;/<span class="hljs-name">Descriptions.Item</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">Descriptions</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Collapse.Panel</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Collapse.Panel</span> <span class="hljs-attr">header</span>=<span class="hljs-string">"操作记录"</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"3"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">OperationRecordSection</span> <span class="hljs-attr">formValues</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">...formValues</span>, <span class="hljs-attr">orderNo:</span> <span class="hljs-attr">orderDetail</span>?<span class="hljs-attr">.orderNo</span> }} /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Collapse.Panel</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Collapse</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Modal</span>&gt;</span></span>
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">DeploymentDetail</span>;
</code></pre>
<h4 data-id="heading-10">2. 字典映射封装</h4>
<p>车辆租赁系统包含大量枚举值（如交付类型、订单状态），封装通用字典工具函数，统一处理类型映射：</p>
<p>typescript</p>
<p>运行</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// utils/Func.ts</span>
<span class="hljs-comment">/**
 * 字典转下拉/表格枚举格式
 * <span class="hljs-doctag">@param</span> dictMap 全局字典对象
 * <span class="hljs-doctag">@param</span> dictKey 字典key
 * <span class="hljs-doctag">@returns</span> 枚举对象
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">dictEnum</span> = (<span class="hljs-params">dictMap: <span class="hljs-built_in">any</span>, dictKey: <span class="hljs-built_in">string</span></span>) =&gt; {
  <span class="hljs-keyword">if</span> (!dictMap?.[dictKey]) <span class="hljs-keyword">return</span> {};
  <span class="hljs-keyword">return</span> dictMap[dictKey].<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc: <span class="hljs-built_in">any</span>, item: <span class="hljs-built_in">any</span></span>) =&gt;</span> {
    acc[item.<span class="hljs-property">value</span>] = item.<span class="hljs-property">label</span>;
    <span class="hljs-keyword">return</span> acc;
  }, {});
};

<span class="hljs-comment">/**
 * 根据值获取字典标签
 * <span class="hljs-doctag">@param</span> dictMap 全局字典对象
 * <span class="hljs-doctag">@param</span> dictKey 字典key
 * <span class="hljs-doctag">@param</span> value 字典值
 * <span class="hljs-doctag">@returns</span> 字典标签
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">dictLabel</span> = (<span class="hljs-params">dictMap: <span class="hljs-built_in">any</span>, dictKey: <span class="hljs-built_in">string</span>, value: <span class="hljs-built_in">any</span></span>) =&gt; {
  <span class="hljs-keyword">if</span> (!dictMap?.[dictKey] || !value) <span class="hljs-keyword">return</span> <span class="hljs-string">'-'</span>;
  <span class="hljs-keyword">const</span> item = dictMap[dictKey].<span class="hljs-title function_">find</span>(<span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">any</span></span>) =&gt;</span> item.<span class="hljs-property">value</span> === value);
  <span class="hljs-keyword">return</span> item?.<span class="hljs-property">label</span> || <span class="hljs-string">'-'</span>;
};
</code></pre>
<h3 data-id="heading-11">四、项目优化要点</h3>
<h4 data-id="heading-12">1. 性能优化</h4>
<ul>
<li><strong>数据缓存</strong>：使用 ahooks 的 useRequest 配置 cacheKey，缓存高频查询的订单列表，避免重复请求；</li>
<li><strong>组件懒加载</strong>：通过 Umi 的 dynamicImport 实现页面级懒加载，减少首屏加载体积；</li>
<li><strong>表格虚拟滚动</strong>：ProTable 开启 scroll={{y: 600}} + virtual={true}，优化大数据量表格渲染。</li>
</ul>
<h4 data-id="heading-13">2. 体验优化</h4>
<ul>
<li><strong>状态联动</strong>：勾选行时实时过滤无效行并给出提示，避免用户误操作；</li>
<li><strong>兜底显示</strong>：所有字典映射、嵌套数据访问均添加兜底（|| '-'），避免页面空白；</li>
<li><strong>加载状态</strong>：异步请求时添加骨架屏 / 加载动画，提升交互体验。</li>
</ul>
<h4 data-id="heading-14">3. 可维护性优化</h4>
<ul>
<li><strong>统一请求封装</strong>：拦截请求 / 响应，统一处理 token、错误提示；</li>
<li><strong>注释规范</strong>：关键业务逻辑、工具函数添加 TSDoc 注释；</li>
<li><strong>分支管理</strong>：按「功能分支 - 测试分支 - 主分支」流程开发，避免代码冲突。</li>
</ul>
<h3 data-id="heading-15">五、总结</h3>
<p>React + TypeScript 构建车辆租赁后台管理系统，核心在于「类型约束降低风险、组件复用提升效率、业务逻辑分层解耦」。本文从架构设计到核心功能实现，覆盖了中后台开发的高频场景：表格状态控制、字典映射、通用组件封装、权限控制等。</p>
<p>实际开发中，需结合业务场景灵活调整 —— 例如车辆租赁的「车辆定位、合同管理」等扩展模块，可复用本文的架构思路，通过 TypeScript 定义类型、Pro 组件快速实现 UI，最终打造高性能、易维护的企业级后台系统。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[推荐 4 个 yyds 的 AI 控制安卓手机的 GitHub 项目。]]></title>    <link>https://juejin.cn/post/7583969283790061622</link>    <guid>https://juejin.cn/post/7583969283790061622</guid>    <pubDate>2025-12-16T02:43:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583969283790061622" data-draft-id="7583984122235027498" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="推荐 4 个 yyds 的 AI 控制安卓手机的 GitHub 项目。"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2025-12-16T02:43:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="逛逛GitHub"/> <meta itemprop="url" content="https://juejin.cn/user/1442202996186093"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            推荐 4 个 yyds 的 AI 控制安卓手机的 GitHub 项目。
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1442202996186093/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    逛逛GitHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:43:56.000Z" title="Tue Dec 16 2025 02:43:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>逛逛在 11 月发了一篇文章，盘点了 GitHub 上 AI 操纵手机的开源项目。</p>
<p>获得了 3 万多阅读，3000 多人转发收藏：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3bd8410fb07046d8b8a6f6db0a62988d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457836&amp;x-signature=gPXulglpgqrxG9q4eQbYdwXMbEE%3D" alt="图片" loading="lazy"/></p>
<p>没想到那篇文章发布 5 天后，豆包就官宣推出了 AI 手机，紧接着智谱 AI 就开源了 AutoGLM 模型。</p>
<p>我又搜罗了几个 AI 操作手机的开源项目，再加上我之前发的那篇。整个 GitHub 上关于 AI 控制手机的项目算是被逛逛搜刮干净了。</p>
<p>欢迎收藏转发👏</p>
<h2 data-id="heading-0">01、智谱开源：Open-AutoGLM</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da34e068012e4bc0bd7c51154d930bbe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457836&amp;x-signature=WbikuqLDP0%2FID5RLuXWW92pCQrk%3D" alt="图片" loading="lazy"/><img src="" alt="" loading="lazy"/></p>
<p>这个开源项目太顶了，不到一周就 1.3 万的 Star 了。</p>
<p>基于这个开源框架，就能让 AI 可以<strong>像人眼一样看手机屏幕</strong>，然后像人手一样去点击。</p>
<p>你给它一个任务，比如：帮我总结下长春的景点，到高德地图上收藏一下这几个景点，特别是具体看看博物馆门票价格，再去12306上订一张上午十点从北京去长春的高铁票，把相关信息整理好给我。</p>
<p>AutoGLM 会先把手机屏幕截个图，模型会分析截图，通过视觉定位找到当前要点击哪个按钮或者做啥操作。</p>
<p>并通过 ADB（Android Debug Bridge）工具，直接向手机发送点击、滑动、输入文字的指令。</p>
<p>最终这样一步步模拟人看手机、操纵手机的行为，完成你给的任务。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64e6aa6b09424c75b4fdaa5772bc82e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457836&amp;x-signature=wpzrBWk26HX97tTekzAskgdwF8s%3D" alt="图片" loading="lazy"/></p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/zai-org/Open-AutoGLM</span>
</code></pre>
<p>而且这个开源可以本地部署，而且如果你有显卡，大约需要 24GB+ 显存，你可以把这个 Agent 跑在本地。</p>
<p>隐私数据，比如聊天记录、支付画面啥的不上传到云端也能自动化的你的安卓手机了。</p>
<p>如何使用</p>
<p>你可以使用Claude Code，配置 GLM Coding Plan 后，输入以下提示词，快速部署本项目。 </p>
<pre><code class="hljs language-bash" lang="bash">访问文档，为我安装 AutoGLM ：https://raw.githubusercontent.com/zai-org/Open-AutoGLM/refs/heads/main/README.md
</code></pre>
<h2 data-id="heading-1">02、通过 MCP 控制手机：DroidMind</h2>
<p><strong>DroidMind 这个开源项目的的核心逻辑是不自己训练一个新模型，而是做一个</strong> <strong>超级适配器</strong>。</p>
<p>它通过 MCP 协议，把你的 <strong>Android 手机</strong>直接挂载到 <strong>Claude Desktop</strong>、<strong>Cursor</strong> 或者 Claude <strong>Code</strong> 上。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b02d0991fb2a43488648ebd3373427ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457836&amp;x-signature=ZyI3vsHOF6tLB5rtRPlXnQvddEM%3D" alt="图片" loading="lazy"/></p>
<p>你不需要运行一个沉重的本地模型。</p>
<p>你直接用最聪明的 <strong>Claude 或 Gemini</strong>，通过 DroidMind 这个翻译官，直接操控你的安卓手机。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea8675948f544464986d155332699dd6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457836&amp;x-signature=l4ZxsDMfoe0IMphZqUryM7iUZSI%3D" alt="图片" loading="lazy"/></p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/hyperb1iss/DroidMind</span>
</code></pre>
<h2 data-id="heading-2">03、微软开源：UFO</h2>
<p>这个叫 UFO 的开源项目其实是微软开源的 AI 操作 Windows 系统的开源项目。</p>
<p>只不过 11 月推出的 UFO³ Galaxy 已经演变成了一个<strong>跨设备、跨平台的编排框架。</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b417d760183748f090dae85f029b2531~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457836&amp;x-signature=xJbKxU1sIV9N1HQhBISkQzbImJA%3D" alt="图片" loading="lazy"/><strong>UFO³ Galaxy</strong> 涉及到操纵 <strong>Android 手机设备</strong>的部分是这次更新的核心亮点之一。它也是通过引入 <strong>MCP 架构来实现的，这使得 UFO 不再局限于 Windows，而是能像指挥官一样控制安卓手机。</strong><br/>
<strong><strong><strong><strong>UFO³ Galaxy</strong> 是一个</strong>多设备编排系统</strong>。它的核心理念包含两个部分。</strong></p>
<ul>
<li>Galaxy (星系)：整个控制中枢，负责分发任务。</li>
<li>Constellation (星座)：它将一个复杂的用户指令，比如把手机上的刚拍的照片传到电脑并用 Photoshop 编辑，拆解成一个 DAG（有向无环图）。</li>
</ul>
<p>Windows 电脑、Linux 服务器、<strong>Android 手机</strong> 等都作为独立的节点接入这个网络。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd0c8f3f4526455695729b40dc244788~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457836&amp;x-signature=9pxL%2FnAnkqzhnRzTDxKoFdSNlZ4%3D" alt="图片" loading="lazy"/></p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/microsoft/UFO</span>
</code></pre>
<h2 data-id="heading-3">04、字节开源：UI-TARS</h2>
<p>字节跳动开源的一个基于视觉-语言模型（VLM）的 GUI 智能体（Agent）项目。</p>
<p>它的核心目标是让 AI 像人类一样，通过视觉识别屏幕和操作鼠标/键盘/触控，直接控制手机、计算机或网页。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87b02bf798394c6796467a71a90fecc1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457836&amp;x-signature=7O9xIgwUtSHFyzxOZb7Vh80wWtI%3D" alt="图片" loading="lazy"/><strong>安卓手机设备操纵，</strong> UI-TARS 采用了一种<strong>端到端、纯视觉驱动、基于 ADB</strong> 的控制方案。</p>
<p>也是截取手机屏幕画面，把截图输入给视觉模型，模型结合用户的指令分析屏幕上的元素，决定下一步做什么。</p>
<p>最后模型输出具体的动作指令，转化为底层的 Android ADB 命令发送给手机执行。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af1610839b4d4f7b88f7c69b7653c7c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457836&amp;x-signature=PIk7p7%2BqJx7i1I4rR5t9UmhPEPA%3D" alt="图片" loading="lazy"/></p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/bytedance/UI-TARS</span>
</code></pre>
<p>另外之前发布的另外一个盘点 AI 控制手机开源项目的链接如下，感兴趣的可以去看看：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUxNjg4NDEzNA%3D%3D%26mid%3D2247529132%26idx%3D1%26sn%3D0b45b857cfd67f9144472f2017f46a14%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUxNjg4NDEzNA==&amp;mid=2247529132&amp;idx=1&amp;sn=0b45b857cfd67f9144472f2017f46a14&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">5 个 AI 操纵手机的 GitHub 项目，牛逼了。</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Monorepo 架构：现代软件开发的代码管理革命]]></title>    <link>https://juejin.cn/post/7583970267132854278</link>    <guid>https://juejin.cn/post/7583970267132854278</guid>    <pubDate>2025-12-16T02:10:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583970267132854278" data-draft-id="7583980250733150271" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Monorepo 架构：现代软件开发的代码管理革命"/> <meta itemprop="keywords" content="前端,JavaScript,架构"/> <meta itemprop="datePublished" content="2025-12-16T02:10:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="NolanKy"/> <meta itemprop="url" content="https://juejin.cn/user/2841599197616894"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Monorepo 架构：现代软件开发的代码管理革命
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2841599197616894/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    NolanKy
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:10:31.000Z" title="Tue Dec 16 2025 02:10:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin:30px 0 10px;color:#cca152;position:relative;padding-left:50px;border-bottom:2px solid rgba(209,163,78,.6);padding-bottom:0}.markdown-body h1{font-size:30px}.markdown-body h1:before{content:"";width:50px;height:42px;display:block;position:absolute;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACcAAAAhBAMAAACo1K8bAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAFZaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CkzCJ1kAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAnUExURUdwTMyhUsqkUMyhUsyiUcyhUsyhUsyhUcyhUsyhUs2hUtytWNWoVX44si8AAAAKdFJOUwD8Bfcge95QncCWSSDAAAABh0lEQVQoz2WSPUvDQBjHjyPSOB7drh2OUOs36NA6pKAFwaEo4tDFIUWxGYLgKw4BEYUuHaQg7XJ0kccsUmrT2qUUQZp8KO/y1hSfIYEf/5eHu0MoGU1+sIbSw5Bypd92S+dWWrd34b15vuOPY4QxuvtYZp0lIVk3Zgjt+5zkh12AvBHnbW85BOjXySPwhc5CYcY0OdDh5dEUqIEj4cN8Dty3a1MqYJS4MaWU5wzVLwMMxqGSNQgA/VFa4gf50yhxSUW+db8ACa2gBxfnABVDFYHCPYrc7TLwCepJM8/ZoVsRwpxdHEozHUXd6idwVzFFM5BFmIhQVQjrNdnCvdd48wblI2VHtsAZioSsTYVwLoXvjMXH1icuNgPhQE+Ot1+xi8HeA3d1Df1f1JPVUOmsYLujBjuSySqSXYt+yTwbJ0pcyIhqTrxkn0BazRLizJosxRBued+z0jPD6VewOXl5utHRGmMNK3k0iTkzxpq2/oIQO6gLprF12kT/R20eyzlcg7iwK0dPsz/ibpdsCHweWwAAAABJRU5ErkJggg==) 0 0 no-repeat;background-size:80%;bottom:-10px;left:-2px}.markdown-body h2{font-size:24px}.markdown-body h2:before{content:"";width:50px;height:42px;display:block;position:absolute;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACcAAAAhBAMAAACo1K8bAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAFZaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CkzCJ1kAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAnUExURUdwTMyhUsqkUMyhUsyiUcyhUsyhUsyhUcyhUsyhUs2hUtytWNWoVX44si8AAAAKdFJOUwD8Bfcge95QncCWSSDAAAABh0lEQVQoz2WSPUvDQBjHjyPSOB7drh2OUOs36NA6pKAFwaEo4tDFIUWxGYLgKw4BEYUuHaQg7XJ0kccsUmrT2qUUQZp8KO/y1hSfIYEf/5eHu0MoGU1+sIbSw5Bypd92S+dWWrd34b15vuOPY4QxuvtYZp0lIVk3Zgjt+5zkh12AvBHnbW85BOjXySPwhc5CYcY0OdDh5dEUqIEj4cN8Dty3a1MqYJS4MaWU5wzVLwMMxqGSNQgA/VFa4gf50yhxSUW+db8ACa2gBxfnABVDFYHCPYrc7TLwCepJM8/ZoVsRwpxdHEozHUXd6idwVzFFM5BFmIhQVQjrNdnCvdd48wblI2VHtsAZioSsTYVwLoXvjMXH1icuNgPhQE+Ot1+xi8HeA3d1Df1f1JPVUOmsYLujBjuSySqSXYt+yTwbJ0pcyIhqTrxkn0BazRLizJosxRBued+z0jPD6VewOXl5utHRGmMNK3k0iTkzxpq2/oIQO6gLprF12kT/R20eyzlcg7iwK0dPsz/ibpdsCHweWwAAAABJRU5ErkJggg==) 0 0 no-repeat;background-size:70%;bottom:-15px;left:-1px}.markdown-body h3{font-size:18px}.markdown-body h3:before{content:"";width:50px;height:42px;display:block;position:absolute;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACcAAAAhBAMAAACo1K8bAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAFZaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CkzCJ1kAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAnUExURUdwTMyhUsqkUMyhUsyiUcyhUsyhUsyhUcyhUsyhUs2hUtytWNWoVX44si8AAAAKdFJOUwD8Bfcge95QncCWSSDAAAABh0lEQVQoz2WSPUvDQBjHjyPSOB7drh2OUOs36NA6pKAFwaEo4tDFIUWxGYLgKw4BEYUuHaQg7XJ0kccsUmrT2qUUQZp8KO/y1hSfIYEf/5eHu0MoGU1+sIbSw5Bypd92S+dWWrd34b15vuOPY4QxuvtYZp0lIVk3Zgjt+5zkh12AvBHnbW85BOjXySPwhc5CYcY0OdDh5dEUqIEj4cN8Dty3a1MqYJS4MaWU5wzVLwMMxqGSNQgA/VFa4gf50yhxSUW+db8ACa2gBxfnABVDFYHCPYrc7TLwCepJM8/ZoVsRwpxdHEozHUXd6idwVzFFM5BFmIhQVQjrNdnCvdd48wblI2VHtsAZioSsTYVwLoXvjMXH1icuNgPhQE+Ot1+xi8HeA3d1Df1f1JPVUOmsYLujBjuSySqSXYt+yTwbJ0pcyIhqTrxkn0BazRLizJosxRBued+z0jPD6VewOXl5utHRGmMNK3k0iTkzxpq2/oIQO6gLprF12kT/R20eyzlcg7iwK0dPsz/ibpdsCHweWwAAAABJRU5ErkJggg==) 0 0 no-repeat;background-size:60%;bottom:-19px;left:-2px}.markdown-body h4{font-size:16px;padding-left:0;border-bottom:1px solid rgba(209,163,78,.6)}.markdown-body h5{font-size:15px;padding-left:0}.markdown-body em{color:#cca152}.markdown-body del{text-decoration-color:#cca152;text-decoration-thickness:2px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:80%;margin:6px auto;box-shadow:0 6px 15px #8e8e8e;display:block;margin:20px auto!important;object-fit:contain;border-radius:8px}.markdown-body hr{border:none;border-top:2px solid #e0c9a1;margin-top:32px 0}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background:#f6efde;color:#b69454;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Mono,Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;background:#fef6e1;border-radius:4px;box-shadow:0 0 8px hsla(0,0%,47%,.45)}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAOCAMAAABaWb9VAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAFZaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CkzCJ1kAAAAJcEhZcwAADsQAAA7EAZUrDhsAAACHUExURUdwTMxCKdc8NvdYT/9hVyLJPABBAGubKNiIOv+/K+ytJBakH9aZG+5QR5VZDOBDPhmtJ8+VGuGjH/CwJR26MR6+NBq0LPW1KBmwKetNRfJUTONHP92fHuSmIeFEPhu3LR29M/BTS+mqIuqsI5qdHyLKPP++Kv9gVf9lW//KLSXXQCTQP//FLMVm5KQAAAAldFJOUwAlPPz7+woBBPu8Mzu+FlRRKmvnweeG+Wqg6mVNXmuc1OCbmjZJWF/9AAABKklEQVQoz3WS6XaCMBCFRzAM++KGsqhtDwES3//5OtmA2uP9A9zwzRoAgBC0QgQrdA68OZsDr229YGHoIEj7Pl0ZOgjKa5lYJ4Rd1vijn3nuD4Qurjmv48o6RFyfbGDnS6DeEXZfk5ZfuBhdPb9I87ECNMh1EFJKIU6agWzaa01NbmLkxznSmmObJBkkUxrERf3i+ftRiZi7ShPCYY64UhTx1AR5CDYoMXkOKEY7GmTcTzeD/FiER68DfSLgSRqEIBoB3P8h3x8RZhBXGJGusJdD6rfCBl0YqvZNkrV9zej2cWlfJWG6fRpyM41qYH+GTPPi2yFLQYC0Qybm5o96lW77kMbcrBKtgeWTsthVamNXFF4I6x0DTPuugsVRFyYpyxzWqNvHJwed8ws7QyP1UwjNjwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#fef6e1}.markdown-body a{text-decoration:none;color:#d8ac5a;border-bottom:1px solid #d8ac5a}.markdown-body a:active,.markdown-body a:hover{color:#93753f;border-color:#93753f}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f4e8c7;border-collapse:collapse}.markdown-body thead{background:rgba(255,227,176,.6588235294);text-align:left;display:table-header-group;border-bottom:1px solid rgba(255,227,176,.6588235294)}.markdown-body tbody{background:rgba(255,247,229,.3882352941)}.markdown-body td,.markdown-body th{padding:7px;line-height:24px;min-width:100px}.markdown-body blockquote{color:#bd954f;padding:1px 23px;margin:22px 0;border-left:4px solid #dcb267;background-color:#fff7e5}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol .task-list-item,.markdown-body ul .task-list-item{list-style:none}.markdown-body ol li{padding-left:6px}.markdown-body::marker{color:#dcb267}.markdown-body .contains-task-list{padding-left:0}.markdown-body .contains-task-list .task-list-item{list-style:none;position:relative}.markdown-body .contains-task-list .task-list-item input[type=checkbox]{position:relative;top:2px}.markdown-body .contains-task-list .task-list-item input[type=checkbox]:before{content:"";display:inline-block;height:12px;width:12px;position:absolute;left:-2px;top:-2px;border:2px solid #cda152;border-radius:5px}.markdown-body .contains-task-list .task-list-item input[type=checkbox]:checked{position:relative;top:2px}.markdown-body .contains-task-list .task-list-item input[type=checkbox]:checked:before{border:none;content:"";display:inline-block;height:17px;width:17px;position:absolute;left:-2px;top:-2px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAFo9M/3AAAAAXNSR0IArs4c6QAAAYhJREFUOBFjYACC0/MDGsDEiyvr/zOCeUwMJxn/A8HZRUEMYBFGJsZ6kFoQYALiAyAGCgDpA+sFijKeWRj4H1kWpIWBW1SDQcm+BCzOAiK/vr7BcO/gDbAAI4hE1waWgRBnmWCGIwkyKFjnwow0BhsJk9QLncvw5dV1oPE9MCEGmBWrgCKhcFEowyR+PSNYwemFAZ4M/xjMkRWYJm5oAPFB/joDpI1BHHQANgGPDxj+//vfCA4IdJ3GcevgQnAFhlHLwYIgSVA0wABcwY3tFQzokiBFGIEP0wmigW5wZAK5FFkQib0a6NUDcEmgb7AGFpIGZOZqoMFhIAFQknEAJpn9yLLEssFOBCp2IFaDkl0xg6C8FbJyB3gowUS5RdQYBORQYpVB1iwVHIIMwJh///AYTCmYRklNIBFmNi4GeYt0BhnjeIa3dw8wSBlEgDUhxw2yCRgGfHp2geHiqiSwUwUVrFAiFVkjjA1LrjgTHEwhFvosMCZM4NEIUoAtWWNoBGZ70/gN22HiAD2uhAzsYNBZAAAAAElFTkSuQmCC) 0 0 no-repeat;background-size:100%}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在当今快速发展的软件开发领域，随着项目复杂度的不断提升，传统的多仓库（Multi-repo）开发模式逐渐暴露出协作成本高、版本管理混乱、依赖复用困难等问题。在此背景下，<strong>Monorepo（单一代码仓库）</strong> ​ 架构应运而生，并已成为Google、Facebook、Microsoft等大型科技公司的标准实践</p>
<h2 data-id="heading-0">一、什么是Monorepo？</h2>
<p>Monorepo（Monolithic Repository）是一种将多个项目（如多个前端应用、组件库、工具库等）集中存放在<strong>同一个代码仓库</strong>中的开发管理模式。与传统的“一个项目一个仓库”不同，Monorepo强调在单一版本控制仓库中管理多个相关但独立的模块或服务。</p>
<h3 data-id="heading-1">核心特征</h3>
<ul>
<li><strong>统一存储</strong>：所有相关项目的代码、配置和文档都位于同一个Git仓库中</li>
<li><strong>共享依赖</strong>：通过工作区（workspace）机制实现依赖的统一管理</li>
<li><strong>原子提交</strong>：跨项目的变更可以作为一个原子提交，确保一致性</li>
<li><strong>集中化构建</strong>：统一的CI/CD流程和构建工具配置</li>
</ul>
<h2 data-id="heading-2">二、Monorepo的演进历程</h2>
<p>代码仓库管理方式经历了三个主要阶段的演进：</p>
<h3 data-id="heading-3">1. 单仓库巨石应用（Monolith）</h3>
<ul>
<li><strong>特点</strong>：所有代码集中在一个仓库中，便于初期管理和部署</li>
<li><strong>问题</strong>：随着项目规模增长，构建时间增加、代码冲突频繁、维护困难</li>
</ul>
<h3 data-id="heading-4">2. 多仓库多模块应用（Multi-repo）</h3>
<ul>
<li><strong>特点</strong>：将项目拆分成多个模块，每个模块使用单独的仓库管理</li>
<li><strong>优势</strong>：提高了模块独立性，便于团队并行开发</li>
<li><strong>挑战</strong>：跨仓库依赖管理复杂、版本同步困难、工作流程繁琐</li>
</ul>
<h3 data-id="heading-5">3. 单仓库多模块应用（Monorepo）</h3>
<ul>
<li><strong>特点</strong>：在单一仓库中管理多个相关模块</li>
<li><strong>优势</strong>：简化跨模块依赖管理、提高代码共享效率、统一构建流程</li>
<li><strong>挑战</strong>：需要更精细的权限控制、大型仓库性能优化</li>
</ul>
<h2 data-id="heading-6">三、Monorepo vs. Multi-repo：核心对比</h2>








































<table><thead><tr><th>维度</th><th>Monorepo</th><th>Multi-repo</th></tr></thead><tbody><tr><td><strong>代码可见性</strong>​</td><td>整个代码库变化趋势清晰，便于团队协作</td><td>代码隔离，研发者只需关注负责的仓库</td></tr><tr><td><strong>依赖管理</strong>​</td><td>统一版本控制，相同依赖只安装一次，节省磁盘空间</td><td>每个仓库独立node_modules，存在重复安装</td></tr><tr><td><strong>构建效率</strong>​</td><td>可能较慢，但支持增量构建和缓存优化</td><td>独立构建，通常更快</td></tr><tr><td><strong>代码权限</strong>​</td><td>缺乏项目粒度权限管控，误改风险较高</td><td>各项目单独仓库，权限控制精细</td></tr><tr><td><strong>跨项目变更</strong>​</td><td>原子提交确保一致性，同步更新容易</td><td>需要手动协调多个仓库的变更</td></tr><tr><td><strong>典型场景</strong>​</td><td>微前端、微服务间强耦合的系统</td><td>团队边界清晰、独立部署的业务单元</td></tr></tbody></table>
<h2 data-id="heading-7">四、Monorepo的核心优势</h2>
<h3 data-id="heading-8">1. <strong>高效的代码共享与复用</strong></h3>
<ul>
<li>共享组件、工具函数和业务逻辑可以直接在仓库内引用</li>
<li>修改公共组件后，所有依赖它的应用可以同步更新</li>
</ul>
<h3 data-id="heading-9">2. <strong>统一的依赖管理</strong></h3>
<ul>
<li>通过工作区机制将相同版本的依赖提升到顶层只安装一次</li>
<li>避免版本碎片化，减少“依赖地狱”问题</li>
</ul>
<h3 data-id="heading-10">3. <strong>原子性变更与重构</strong></h3>
<ul>
<li>跨多个项目或模块的更改可以作为一个原子提交进行</li>
<li>降低了部署和回滚的复杂性</li>
</ul>
<h3 data-id="heading-11">4. <strong>标准化的开发流程</strong></h3>
<ul>
<li>统一的代码规范、构建工具、测试框架和部署流程</li>
<li>简化新成员入职过程，提高团队协作效率</li>
</ul>
<h3 data-id="heading-12">5. <strong>更好的工具集成</strong></h3>
<ul>
<li>集中式的ESLint、TypeScript、Babel配置</li>
<li>统一的CI/CD流水线，增强构建一致性</li>
</ul>
<h2 data-id="heading-13">五、Monorepo的挑战与应对策略</h2>
<h3 data-id="heading-14">1. <strong>仓库规模与性能问题</strong></h3>
<ul>
<li><strong>挑战</strong>：随着代码量增长，Git操作可能变慢</li>
<li><strong>解决方案</strong>：使用浅克隆、稀疏检出、Git LFS等技术优化</li>
</ul>
<h3 data-id="heading-15">2. <strong>权限控制精细化不足</strong></h3>
<ul>
<li><strong>挑战</strong>：缺乏项目粒度的代码访问控制</li>
<li><strong>解决方案</strong>：结合Git子模块、路径级权限控制工具</li>
</ul>
<h3 data-id="heading-16">3. <strong>构建时间可能较长</strong></h3>
<ul>
<li><strong>挑战</strong>：全量构建耗时增加</li>
<li><strong>解决方案</strong>：采用增量构建、远程缓存、并行执行（如Turborepo）</li>
</ul>
<h3 data-id="heading-17">4. <strong>团队协作复杂度</strong></h3>
<ul>
<li><strong>挑战</strong>：所有开发者都能看到整个代码库，可能增加误改风险</li>
<li><strong>解决方案</strong>：建立清晰的代码所有权文化、代码审查流程</li>
</ul>
<h2 data-id="heading-18">六、主流Monorepo工具对比（2024年）</h2>















































<table><thead><tr><th>工具</th><th>特点</th><th>适用场景</th><th>学习成本</th></tr></thead><tbody><tr><td><strong>pnpm + Workspaces</strong>​</td><td>快速、节省磁盘空间，生态逐渐丰富</td><td>中小型到大型项目</td><td>低</td></tr><tr><td><strong>Lerna</strong>​</td><td>历史较久，专注版本管理和发布流程</td><td>多package发布型项目</td><td>低</td></tr><tr><td><strong>Turborepo</strong>​</td><td>高性能构建缓存，由Vercel推出</td><td>大型项目，注重构建性能</td><td>中</td></tr><tr><td><strong>Nx</strong>​</td><td>功能强大，支持任务调度、可视化依赖图</td><td>中大型，尤其是TS/React项目</td><td>中高</td></tr><tr><td><strong>Rush</strong>​</td><td>微软出品，功能全面但配置复杂</td><td>企业级大型Monorepo</td><td>高</td></tr><tr><td><strong>Yarn/NPM Workspaces</strong>​</td><td>内置工作区支持，与包管理器深度集成</td><td>基础Monorepo需求</td><td>低</td></tr></tbody></table>
<p><strong>选型建议</strong>：</p>
<ul>
<li>新手或中小团队：从<strong>pnpm + workspaces</strong>或<strong>Turborepo/Nx</strong>开始</li>
<li>大型企业级项目：考虑<strong>Rush</strong>或<strong>Nx</strong>的完整解决方案</li>
<li>注重构建性能：<strong>Turborepo</strong>的缓存机制优势明显</li>
</ul>
<h2 data-id="heading-19">七、Monorepo的典型项目结构</h2>
<pre><code class="hljs language-bash" lang="bash">project-root/
├── package.json              <span class="hljs-comment"># 根目录配置</span>
├── pnpm-workspace.yaml       <span class="hljs-comment"># pnpm工作区配置（或其他工具配置）</span>
├── packages/                 <span class="hljs-comment"># 共享包目录</span>
│   ├── ui/                  <span class="hljs-comment"># 共享UI组件库</span>
│   ├── core/                <span class="hljs-comment"># 业务核心逻辑</span>
│   └── utils/               <span class="hljs-comment"># 工具函数库</span>
├── apps/                    <span class="hljs-comment"># 应用目录</span>
│   ├── web/                 <span class="hljs-comment"># Web应用入口</span>
│   ├── mobile/              <span class="hljs-comment"># 移动端应用</span>
│   └── admin/               <span class="hljs-comment"># 管理后台</span>
├── configs/                 <span class="hljs-comment"># 统一配置文件</span>
├── scripts/                 <span class="hljs-comment"># 共享脚本</span>
└── .github/workflows/       <span class="hljs-comment"># CI/CD配置</span>
</code></pre>
<p>具体怎么搭建 monorepo 项目可以看我的另外一篇文章：<a href="https://juejin.cn/post/7583970267132821510" target="_blank" title="https://juejin.cn/post/7583970267132821510">juejin.cn/post/758397…</a></p>
<h2 data-id="heading-20">八、Monorepo的适用场景</h2>
<h3 data-id="heading-21">1. <strong>大型团队协作项目</strong></h3>
<ul>
<li>多个相关项目需要紧密协作和代码共享</li>
<li>团队成员需要频繁访问和修改跨项目代码</li>
</ul>
<h3 data-id="heading-22">2. <strong>微服务架构</strong></h3>
<ul>
<li>系统由多个小型、独立服务组成</li>
<li>需要确保服务之间的兼容性，简化跨服务重构</li>
</ul>
<h3 data-id="heading-23">3. <strong>多平台/多产品开发</strong></h3>
<ul>
<li>公司同时开发Web、iOS、Android等多个平台应用</li>
<li>需要共享通用库、组件和工具</li>
</ul>
<h3 data-id="heading-24">4. <strong>共享库和组件开发</strong></h3>
<ul>
<li>开发涉及多个共享库或可重用组件的项目</li>
<li>需要频繁更新和维护这些共享资源</li>
</ul>
<h3 data-id="heading-25">5. <strong>开源项目生态</strong></h3>
<ul>
<li>如Vue 3、React等大型开源项目采用Monorepo管理核心库和周边工具</li>
</ul>
<h2 data-id="heading-26">九、实施Monorepo的最佳实践</h2>
<h3 data-id="heading-27">1. <strong>渐进式迁移</strong></h3>
<ul>
<li>不要一次性将所有项目迁移到Monorepo</li>
<li>可以先从关联最紧密的几个项目开始试点</li>
</ul>
<h3 data-id="heading-28">2. <strong>清晰的代码组织</strong></h3>
<ul>
<li>按照功能域或业务边界划分目录结构</li>
<li>保持模块间接口的清晰定义</li>
</ul>
<h3 data-id="heading-29">3. <strong>自动化工具链</strong></h3>
<ul>
<li>配置统一的代码格式化、linting和测试工具</li>
<li>建立自动化的版本发布和变更日志生成流程</li>
</ul>
<h3 data-id="heading-30">4. <strong>性能监控与优化</strong></h3>
<ul>
<li>监控构建时间和仓库操作性能</li>
<li>定期评估和优化工具配置</li>
</ul>
<h3 data-id="heading-31">5. <strong>团队培训与文化</strong></h3>
<ul>
<li>培训团队成员掌握Monorepo工作流程</li>
<li>建立代码所有权和协作文化</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[告别 AI 输出的重复解析：正常 markdown 解析渲染也能提速 2-10 倍以上]]></title>    <link>https://juejin.cn/post/7583991680749273115</link>    <guid>https://juejin.cn/post/7583991680749273115</guid>    <pubDate>2025-12-16T02:54:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583991680749273115" data-draft-id="7583952017674371123" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="告别 AI 输出的重复解析：正常 markdown 解析渲染也能提速 2-10 倍以上"/> <meta itemprop="keywords" content="前端,JavaScript,AI编程"/> <meta itemprop="datePublished" content="2025-12-16T02:54:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="king王一帅"/> <meta itemprop="url" content="https://juejin.cn/user/395479917018408"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            告别 AI 输出的重复解析：正常 markdown 解析渲染也能提速 2-10 倍以上
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/395479917018408/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    king王一帅
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:54:22.000Z" title="Tue Dec 16 2025 02:54:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">incremark 的惊人实力</h2>
<p>昨天发布了周日开发的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fincremark-docs.vercel.app%2F" target="_blank" title="https://incremark-docs.vercel.app/" ref="nofollow noopener noreferrer">incremark</a>，没想到实际体验性能远超预期，本想作为自己产品内部的一个小工具，但想了想，开源未尝不是一个好的方向。</p>
<p>先看结果：普通比较短的 markdown 在线测试结果</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/62954344ec504b44b8e95a92f788605a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAga2luZ-eOi-S4gOW4hQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766458461&amp;x-signature=PhcKLn%2FO2R94itVAX77pSIPNJa8%3D" alt="image.png" loading="lazy"/></p>
<p>稍长的 markdown 在线测试结果</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b565e7980b5f4715b48b689d99ad13db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAga2luZ-eOi-S4gOW4hQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766458461&amp;x-signature=5RxpaO%2ByidGfeqZwSIoStd76B38%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>说明：网站每次 benchmark 测试每次提升倍数可能不一样，这是由于分块策略导致的，demo 页面每次分块的 markdown 字符串长度是随机的 <code>const chunks = content.match(/[\s\S]{1,20}/g) || []</code>，分块会影响稳定块的生成，这样也更符合真实场景，某个块可能会有上一个块的内容跟下一个块的内容。但无论怎样分，性能提升是必然的，demo 网站未通过迎合自身利益的手段进行 chunk 拆分。</p>
</blockquote>
<p>vue demo 在线链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fincremark-vue.vercel.app%2F" target="_blank" title="https://incremark-vue.vercel.app/" ref="nofollow noopener noreferrer">incremark-vue.vercel.app/</a></p>
<p>react demo 在线链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fincremark-react.vercel.app%2F" target="_blank" title="https://incremark-react.vercel.app/" ref="nofollow noopener noreferrer">incremark-react.vercel.app/</a></p>
<p>文档链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fincremark-docs.vercel.app%2F" target="_blank" title="https://incremark-docs.vercel.app/" ref="nofollow noopener noreferrer">incremark-docs.vercel.app/</a></p>
<p>超长的 markdown 输出会来更更加离谱的速度，20k 的 markdown benchmark 可以达到恐怖的 46 倍速度提升。</p>
<h2 data-id="heading-1">为什么它会有如此提升？</h2>
<h3 data-id="heading-2">传统解析方案弊端</h3>
<p>做过 AI 聊天应用的人可能都知道，AI 的流式输出在前端每次获取到的都是一个个简短的 chunk,每次 chunk 过来后，都需要将完整的 markdown 字符串喂给 markdown 解析器，可能是 remark、 markedjs，也可能是 markdown-it。它们每次都需要将所有的 markdown 进行解析，最后在进行渲染，在此过程中会有一部分性能浪费，即已经稳定渲染的块也要被重复解析。</p>
<p>vue-stream-markdown 这类型工具在渲染层也做了努力，将稳定的 token 渲染为稳定的组件，每次只更新不稳定的组件，以此达到渲染层的平滑流式输出。</p>
<p>但、这仍无法解决性能浪费的本质问题，也就是 markdown 文本的重复解析，这一步才是吃掉 cpu 性能的怪兽，输出文档越长，则性能浪费越高。</p>
<h3 data-id="heading-3">incremark 核心性能优化原理</h3>
<p>incremark 除了做到了 UI 渲染层的组件复用平滑更新，最主要的是在 markdown 解析上做了文档，只解析不稳定的 markdown，不再重复解析稳定的块。因此将解析性能从 O(n²) 拉到了 O(n)，理论上输出越长，提升越多。</p>
<h4 data-id="heading-4">1. 增量解析：从 O(n²) 到 O(n)</h4>
<p>传统解析器每次都重新解析整个文档，导致解析量呈平方增长。Incremark 的 <code>IncremarkParser</code> 类采用增量解析策略，见代码 <code>IncremarkParser.ts</code></p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 设计思路：</span>
<span class="hljs-comment">// 1. 维护一个文本缓冲区，接收流式输入 </span>
<span class="hljs-comment">// 2. 识别"稳定边界"，将已完成的块标记为 completed </span>
<span class="hljs-comment">// 3. 对于正在接收的块，每次重新解析，但只解析该块的内容 </span>
<span class="hljs-comment">// 4. 复杂嵌套节点作为整体处理，直到确认完成</span>
</code></pre>
<h4 data-id="heading-5">2. 智能边界检测机制</h4>
<p><code>append</code> 方法中的 <code>findStableBoundary()</code> 是关键优化点</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-title function_">append</span>(<span class="hljs-attr">chunk</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">IncrementalUpdate</span> {  
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">buffer</span> += chunk  
  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateLines</span>()  
    
  <span class="hljs-keyword">const</span> { <span class="hljs-attr">line</span>: stableBoundary, contextAtLine } = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">findStableBoundary</span>()  
    
  <span class="hljs-keyword">if</span> (stableBoundary &gt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">pendingStartLine</span> &amp;&amp; stableBoundary &gt;= <span class="hljs-number">0</span>) {  
    <span class="hljs-comment">// 只解析新完成的块，不重复解析已完成内容  </span>
    <span class="hljs-keyword">const</span> stableText = <span class="hljs-variable language_">this</span>.<span class="hljs-property">lines</span>.<span class="hljs-title function_">slice</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">pendingStartLine</span>, stableBoundary + <span class="hljs-number">1</span>).<span class="hljs-title function_">join</span>(<span class="hljs-string">'\n'</span>)  
    <span class="hljs-keyword">const</span> ast = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">parse</span>(stableText)  
    <span class="hljs-comment">// ...  </span>
  }  
}
</code></pre>
<h4 data-id="heading-6">3. 状态管理避免重复计算</h4>
<p>解析器维护多个关键状态来避免重复工作</p>
<ul>
<li><code>buffer</code>: 累积的未解析内容</li>
<li><code>completedBlocks</code>: 已完成且永不重新解析的块数组</li>
<li><code>lineOffsets</code>: 行偏移量前缀和，支持 O(1) 行位置计算</li>
<li><code>context</code>: 跟踪代码块、列表等嵌套状态</li>
</ul>
<h4 data-id="heading-7">4. 增量行更新优化</h4>
<p><code>updateLines()</code> 方法只处理新增内容，避免全量 split 操作</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">private</span> <span class="hljs-title function_">updateLines</span>(): <span class="hljs-built_in">void</span> {  
  <span class="hljs-comment">// 找到最后一个不完整的行（可能被新 chunk 续上）  </span>
  <span class="hljs-keyword">const</span> lastLineStart = <span class="hljs-variable language_">this</span>.<span class="hljs-property">lineOffsets</span>[prevLineCount - <span class="hljs-number">1</span>]  
  <span class="hljs-keyword">const</span> textFromLastLine = <span class="hljs-variable language_">this</span>.<span class="hljs-property">buffer</span>.<span class="hljs-title function_">slice</span>(lastLineStart)  
    
  <span class="hljs-comment">// 重新 split 最后一行及之后的内容  </span>
  <span class="hljs-keyword">const</span> newLines = textFromLastLine.<span class="hljs-title function_">split</span>(<span class="hljs-string">'\n'</span>)  
  <span class="hljs-comment">// 只更新变化的部分  </span>
}
</code></pre>
<h3 data-id="heading-8">性能对比数据</h3>
<p>这种设计在实际测试中表现优异 ：</p>





























<table><thead><tr><th>文档大小</th><th>传统解析字符量</th><th>Incremark 解析字符量</th><th>减少比例</th></tr></thead><tbody><tr><td>1KB</td><td>1,010,000</td><td>20,000</td><td>98%</td></tr><tr><td>5KB</td><td>25,050,000</td><td>100,000</td><td>99.6%</td></tr><tr><td>20KB</td><td>400,200,000</td><td>400,000</td><td>99.9%</td></tr></tbody></table>
<h3 data-id="heading-9">关键不变量</h3>
<p>Incremark 的性能优势源于一个关键不变量：<strong>一旦块被标记为 completed，就永远不会被重新解析</strong>。这确保了每个字符最多只被解析一次，实现了 O(n) 的时间复杂度。</p>
<h2 data-id="heading-10">小结</h2>
<p>昨天在掘金发布了 <a href="https://juejin.cn/post/7583906846986469422" target="_blank" title="https://juejin.cn/post/7583906846986469422"># AI 时代真正流式解析+渲染双重优化的 Incremark</a> 并没有获得推流，在 V 站随意发帖下，github 意外收获了 35 颗 star，npm 收获 92 下载量，突然感觉它似乎应该是能对一些小伙伴产生作用的，所以尝试当个事来做，如果你也感兴趣，欢迎试用以及代码贡献。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🎙️ 2025 年主流 AI 语音输入工具测评：解锁高效生产力的关键]]></title>    <link>https://juejin.cn/post/7583943503556689970</link>    <guid>https://juejin.cn/post/7583943503556689970</guid>    <pubDate>2025-12-16T02:21:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583943503556689970" data-draft-id="7583991680748781595" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🎙️ 2025 年主流 AI 语音输入工具测评：解锁高效生产力的关键"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-12-16T02:21:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一点一木"/> <meta itemprop="url" content="https://juejin.cn/user/1063982986187486"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🎙️ 2025 年主流 AI 语音输入工具测评：解锁高效生产力的关键
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1063982986187486/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一点一木
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:21:30.000Z" title="Tue Dec 16 2025 02:21:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h3 data-id="heading-0">引言：当「说话」成为新的生产力</h3>
<p>在 <strong><code>AI</code>大模型</strong>技术的推动下，2025 年的语音输入工具已从单纯的语音转文字，进化为集成了<strong>语音理解、智能润色、多语种混合</strong>的综合创作平台。它们不仅能准确转写，更深度融入了办公、创作、开发等专业工作流。本次测评，我们聚焦四款最具代表性的主流产品：<strong><code>LazyTyper</code></strong> <strong>、</strong> <strong><code>Wispr Flow Pro</code></strong> <strong>、豆包语音输入法、智谱小凹输入法</strong>，从识别准确率、智能化程度、应用场景适配等多个维度进行深度对比，助您解锁高效生产力的关键。</p>
<hr/>
<h3 data-id="heading-1">一、核心技术与功能对比概览</h3>
<p>以下表格总结了四款工具在技术路线和核心功能上的差异，帮助读者一目了然地理解它们的产品定位。</p>






















































<table><thead><tr><th>特性 / 产品</th><th><code>LazyTyper</code></th><th><code>Wispr Flow Pro</code></th><th>豆包语音输入法</th><th>智谱小凹输入法</th></tr></thead><tbody><tr><td>核心技术定位</td><td>多模型集成与定制化</td><td>跨平台与语音命令编辑</td><td>极致速度与用户体验</td><td>大模型润色与风格转换</td></tr><tr><td>语音模型数量</td><td>12 个（含 <code>ElevenLabs</code>，<code>Groq</code>，通义千问等）</td><td>专有高精度模型</td><td>抖音/字节专有模型</td><td>智谱 <code>AI</code> (<code>GLM</code>) 大模型</td></tr><tr><td>离线能力</td><td>5 个本地离线模型</td><td>未明确</td><td>未明确</td><td>未明确</td></tr><tr><td>高级编辑功能</td><td><code>AI</code> 润色、自定义词汇表</td><td>命令模式编辑、个性化短语</td><td>智能标点、上下文联想</td><td>多风格表达、深度 <code>AI</code> 润色</td></tr><tr><td>多语言支持</td><td>中英日混输</td><td>中英混合</td><td>高精度中文识别</td><td>高精度中文识别</td></tr><tr><td>目标用户</td><td>开发者、高阶创作者、效率专家</td><td>跨平台工作者、程序员、邮件办公</td><td>大众用户、追求极速输入者</td><td>专业写作、追求成稿质量者</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-2">二、产品特点与技术能力深度解析</h3>
<h4 data-id="heading-3">1. <code>LazyTyper</code>：技术灵活与高阶定制的首选</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dca53d6a6556423fb0ef7d30565d2555~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA54K55LiA5pyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456579&amp;x-signature=H032Zgv0KwROdXgTgZ6FifZbP8I%3D" alt="" loading="lazy"/></p>
<p><code>LazyTyper</code> 的核心竞争力在于其<strong>技术集成度高</strong>和<strong>使用模式灵活</strong>。它集成了包括 <code>Groq Whisper</code>、通义千问 <code>ASR</code> 在内的 <strong>12 个专业语音模型</strong>，使用户可以根据当前任务一键切换引擎。</p>
<ul>
<li><strong>模型</strong> <strong>自由度</strong> <strong>与隐私：</strong> 内含 <strong>5 个本地离线模型</strong>，确保在无网络环境下稳定运行，同时保障高度的数据隐私性。</li>
<li><strong>专业场景适配：</strong> 针对性地支持<strong>中英日混输</strong>以及<strong>动口说代码</strong>的能力，是技术开发和深度内容创作领域的有力工具。</li>
<li><strong>产品战略</strong>：<code>LazyTyper</code> 专注于桌面端的办公效率场景，暂无移动端版本计划。</li>
<li><strong>性价比：</strong> <strong>永久免费无广告</strong>的模式，配合强大的专业功能，提供了极高的性价比。</li>
</ul>
<h4 data-id="heading-4">2. <code>Wispr Flow Pro</code>：跨平台无缝流转的专家</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ab7801e895f41febda2d40decf19a5b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA54K55LiA5pyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456579&amp;x-signature=KC5saaPy8Kum0gUATIfGrme2MKU%3D" alt="" loading="lazy"/></p>
<p><code>Wispr Flow Pro</code> 定位为「跨平台、跨应用的 <code>AI</code> 语音输入法」，解决了许多用户在不同软件间切换的痛点。</p>
<ul>
<li><strong>跨</strong> <strong><code>App</code></strong> <strong>核心优势：</strong> 其设计初衷即是在<strong>任何输入框</strong>（如微信、<code>Notion</code>、代码编辑器）中实现快速输入，极大地拓宽了语音输入的使用边界。</li>
<li><strong>高级命令编辑：</strong> <code>Pro</code> 版本支持<strong>语音</strong> <strong>指令</strong> <strong>实时编辑和格式调整</strong>（例如：「加一个要点」、「删除上一句」），这在长篇写作或编程修改中效率极高。</li>
<li><strong>高精度与润色：</strong> 强调高精度识别，<strong>默认开启云端自动润色</strong>，智能纠正语法和标点，甚至能理解语意，保障输出的<strong>文档结构和专业性</strong>。此外，还具备<strong>耳语模式</strong>以适应安静或公共环境。</li>
</ul>
<h4 data-id="heading-5">3. <a href="https://link.juejin.cn?target=https%3A%2F%2Fshurufa.doubao.com%2F" target="_blank" title="https://shurufa.doubao.com/" ref="nofollow noopener noreferrer">豆包语音输入法</a>：大众市场与极致速度体验</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d9f980a3a64d421fb8da8ef39123b37e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA54K55LiA5pyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456579&amp;x-signature=k9YBEqBcxIpww6%2F6OTRLyDd9X2w%3D" alt="" loading="lazy"/></p>
<p>豆包语音输入法聚焦于<strong>基础体验的极致优化</strong>，是移动端和日常中文输入的佼佼者。</p>
<ul>
<li><strong>速度与准确性：</strong> 强调「语音输入又快又准」，尤其是其对<strong>标点的自动处理</strong>能力——「标点无需改」，极大减少了后期编辑工作。</li>
<li><strong>环境适应性：</strong> 具备「轻声照样说」的能力，增强了在公共场合的实用性。</li>
<li><strong>操作流程简化：</strong> 「按住说话，松手结束」的交互逻辑，非常符合移动端用户的使用习惯，实现了语音输入的<strong>无痕化</strong>。</li>
</ul>
<h4 data-id="heading-6">4. <a href="https://link.juejin.cn?target=https%3A%2F%2Fautoglm.zhipuai.cn%2Fautotyper%2F" target="_blank" title="https://autoglm.zhipuai.cn/autotyper/" ref="nofollow noopener noreferrer">智谱小凹输入法(AutoGLM)</a>：大模型赋能与内容成稿</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/416ac6b0c8874176b4acd9f0086714ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA54K55LiA5pyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456579&amp;x-signature=12cspM5cNjfqWAQwx9%2FNEdQwaY8%3D" alt="" loading="lazy"/></p>
<p>智谱小凹输入法由国内领先的智谱 <code>AI</code> 大模型技术驱动，其核心价值在于<strong>从语音到成文的智能转化</strong>。</p>
<ul>
<li><strong><code>AI</code></strong> <strong>深度赋能：</strong> 凭借其背后的 <code>GLM</code> 大模型，它专注于<strong>自动润色成稿</strong>。用户可以说出思路碎片，由 <code>AI</code> 自动组织、优化为流畅的文本。</li>
<li><strong>多风格表达转换：</strong> 这是其独特优势，能将一段语音内容转换为邮件、会议纪要或代码注释等<strong>不同风格</strong>的文体，极大地提升了职业场景下的创作效率。</li>
<li><strong>性能指标：</strong> 官方数据宣称语音识别准确率高达 <strong>97.8%</strong> ，显示了其在中文书面语转换上的强劲实力。</li>
</ul>
<hr/>
<h3 data-id="heading-7">三、实战场景测试与性能表现</h3>
<h4 data-id="heading-8">1. 识别准确率实测（普通话标准发音）</h4>








































<table><thead><tr><th>测试场景</th><th><code>LazyTyper</code></th><th><code>Wispr Flow Pro</code></th><th>豆包语音输入法</th><th>智谱小凹输入法</th></tr></thead><tbody><tr><td>纯中文新闻稿</td><td><strong>97.70%</strong></td><td>93.80%</td><td><strong>95.40%</strong></td><td>94.10%</td></tr><tr><td>中英混合技术文档</td><td><strong>93.50%</strong></td><td>93.20%</td><td>87.60%</td><td>89.30%</td></tr><tr><td>快速口语对话</td><td>92.10%</td><td>91.50%</td><td><strong>93.80%</strong></td><td>90.20%</td></tr><tr><td>专业术语识别</td><td>93.00%</td><td>92.60%</td><td>85.30%</td><td>88.90%</td></tr></tbody></table>
<blockquote>
<p><strong>关键发现：</strong> 豆包语音输入法在纯中文和快速口语场景表现最佳。<code>LazyTyper</code> 在切换到高性能在线模型（如豆包、通义千问）后，其中英混合和专业术语识别能力显著提升，与 <code>Wispr Flow Pro</code> 处于第一梯队竞争。</p>
</blockquote>
<h4 data-id="heading-9">2. 核心工作场景测试</h4>



































<table><thead><tr><th>场景</th><th>测试内容/需求</th><th>最佳表现产品</th><th>性能总结</th></tr></thead><tbody><tr><td>技术文档编写</td><td>语音输入 <code>API</code> 接口文档（含代码和技术术语）</td><td><code>Wispr Flow Pro</code></td><td>准确率高达 97%，开启自动润色后完美保留代码结构和技术术语。<code>LazyTyper</code> 在切换模型后性能接近。</td></tr><tr><td>跨语种会议记录</td><td>中英日混合的跨国团队会议</td><td><code>LazyTyper</code></td><td>得益于集成 <code>Soniox</code>/通义千问等模型，多语言支持最全面，三语切换流畅。<code>Wispr Flow Pro</code> 在中英混合上表现优秀。</td></tr><tr><td>移动端快速回复</td><td>微信聊天和邮件快速回复</td><td>豆包语音输入法</td><td>移动端体验最佳，响应迅速。智谱小凹的润色功能提升了回复的专业性。</td></tr><tr><td>高质量文案创作</td><td>口述思路并要求转换为正式文稿</td><td>智谱小凹输入法</td><td>深度 <code>AI</code> 润色和多风格转换能力，使转录文本的可读性和规范性最高。<code>LazyTyper</code> 可通过集成 <code>GPT/Kimi</code> 等模型实现高级润色</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-10">四、用户体验、生态与商业模式</h3>
<h4 data-id="heading-11">1. 平台支持与兼容性</h4>








































<table><thead><tr><th>平台</th><th><code>LazyTyper</code></th><th><code>Wispr Flow Pro</code></th><th>豆包语音输入法</th><th>智谱小凹输入法</th></tr></thead><tbody><tr><td>Windows</td><td>✅</td><td>✅</td><td>规划中</td><td>✅</td></tr><tr><td>macOS</td><td>✅</td><td>✅</td><td>规划中</td><td>✅</td></tr><tr><td>Linux</td><td>✅</td><td>❌</td><td>❌</td><td>❌</td></tr><tr><td>移动端</td><td>战略聚焦桌面</td><td>✅</td><td>✅</td><td>❌</td></tr></tbody></table>
<blockquote>
<p><strong>关键发现：</strong> <code>LazyTyper</code> <strong>明确其产品战略是聚焦桌面端的办公效率场景</strong>。因此，在 <code>PC</code> 办公领域，四款工具均有布局，而 <strong>豆包语音输入法</strong>和**<code>Wispr Flow Pro</code>**在移动端实现了全面覆盖。</p>
</blockquote>
<h4 data-id="heading-12">2. 商业模式与成本效益</h4>



































<table><thead><tr><th>产品</th><th>免费版本</th><th>个人专业版</th><th>核心价值主张</th></tr></thead><tbody><tr><td><code>LazyTyper</code></td><td>功能完整免费</td><td>无</td><td>自由、隐私、无绑定，极致性价比</td></tr><tr><td><code>Wispr Flow Pro</code></td><td>基础功能试用</td><td>15刀/月或 144刀/年</td><td>专业效率工具投资，无限制使用</td></tr><tr><td>豆包语音输入法</td><td>完全免费</td><td>无独立版本</td><td>生态入口与用户体验，零成本入门</td></tr><tr><td>智谱小凹输入法</td><td>基础功能免费</td><td>分享得免费时长</td><td><code>AI</code> 写作效率提升，内容质量保障</td></tr></tbody></table>
<blockquote>
<p><strong>成本效益分析</strong> <strong>：</strong> 对于追求零成本和极致性价比的用户，<strong><code>LazyTyper</code></strong> 和<strong>豆包语音输入法</strong>是首选。对于愿意为专业工具付费的效率追求者，<strong><code>Wispr Flow Pro</code></strong> 提供了更高的功能上限。</p>
</blockquote>
<hr/>
<h3 data-id="heading-13">五、综合评价与最终选择建议</h3>
<ol>
<li>
<h4 data-id="heading-14">产品力总评</h4>
</li>
</ol>
<ul>
<li><strong><code>Wispr Flow Pro</code></strong> <strong>：⭐⭐⭐⭐⭐</strong> (优势：专业功能全面、跨平台体验、<strong>云端润色强大</strong>。不足：价格较高，学习曲线稍陡。)</li>
<li><strong><code>LazyTyper</code></strong> <strong>：⭐⭐⭐⭐⭐</strong> (优势：模型自由度、隐私保护、完全免费，<strong>顶级中文/混输性能</strong>。不足：<strong>无移动端版本</strong>，界面较简单。)</li>
<li><strong>豆包语音输入法：⭐⭐⭐⭐</strong> (优势：中文体验最佳、生态整合、完全免费。不足：专业功能有限、英文能力一般。)</li>
<li><strong>智谱小凹输入法：⭐⭐⭐⭐</strong> (优势：<code>AI</code> 写作辅助强、文本质量高、多风格支持。不足：响应速度一般，专业术语识别待加强。)</li>
</ul>
<ol start="2">
<li>
<h4 data-id="heading-15">2025 年选购决策矩阵</h4>
</li>
</ol>
<p>没有绝对的最好，只有最合适。您的选择应基于<strong>功能优先级</strong>和<strong>主要使用场景</strong>。</p>






























<table><thead><tr><th>您的功能/场景优先级</th><th>推荐产品</th><th>核心理由</th></tr></thead><tbody><tr><td>首要：技术开发、隐私保护、离线使用</td><td><code>LazyTyper</code></td><td>顶级多模型集成、5 离线模型，适配高阶专业需求。</td></tr><tr><td>首要：跨应用办公、频繁使用语音命令</td><td><code>Wispr Flow Pro</code></td><td>跨 <code>App</code> 无缝支持，语音命令编辑功能强大，文档结构优化出色。</td></tr><tr><td>首要：高效率日常输入、移动端体验</td><td>豆包语音输入法</td><td>极致的速度与准确率，操作流程极简，适合大众和移动端。</td></tr><tr><td>首要：专业写作、内容润色成稿、文体转换</td><td>智谱小凹输入法</td><td>智谱 <code>AI</code> 大模型驱动，强调说话即成文，实现高质量创作。</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-16">六、未来发展趋势与结论</h3>
<p>2025 年的 <code>AI</code> 语音输入市场呈现明显的差异化竞争态势。随着 <code>AI</code> 技术的持续进步，未来语音输入工具将朝着<strong>多模态融合、个性化适应、垂直领域深化</strong>等方向发展。</p>
<p>给各厂商的建议也反映了其产品短板：<code>LazyTyper</code> 急需移动端版本；<code>Wispr Flow Pro</code> 需要降低入门门槛；豆包语音输入法应增强专业功能；智谱小凹输入法则需提高响应速度。</p>
<p><strong>结论：</strong> 对于多数用户，可以先用免费产品（<code>LazyTyper</code> 或豆包语音）入门，体验其核心优势，再根据实际需求和付费预算，考虑是否升级到提供专业功能和跨平台支持的工具（<code>Wispr Flow Pro</code> 或智谱小凹输入法）。最终目标是实现<strong>所想即所得</strong>的自然交互体验。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Rust 1.92.0 发布：为 Never 类型铺路，强化调试与安全性]]></title>    <link>https://juejin.cn/post/7583948178858950702</link>    <guid>https://juejin.cn/post/7583948178858950702</guid>    <pubDate>2025-12-16T02:57:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583948178858950702" data-draft-id="7583667970737176576" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Rust 1.92.0 发布：为 Never 类型铺路，强化调试与安全性"/> <meta itemprop="keywords" content="Rust,编程语言,程序员"/> <meta itemprop="datePublished" content="2025-12-16T02:57:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="RustCoder"/> <meta itemprop="url" content="https://juejin.cn/user/1926000099227592"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Rust 1.92.0 发布：为 Never 类型铺路，强化调试与安全性
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1926000099227592/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    RustCoder
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:57:53.000Z" title="Tue Dec 16 2025 02:57:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><p>Rust 1.92.0 稳定版已正式发布。这个版本并没有带来重大变化和主要新功能，而是一个较为保守的版本，它只是巧妙地调整和优化了语言规范和编译器工具链等。其中最引人注目的是为最终稳定化“Never Type”所做的准备，改善了对Linux平台调试体验，以及完善文档与调试能力。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/266b676cce534fed8a176b6023bb62e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUnVzdENvZGVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766458724&amp;x-signature=%2Bd5i%2Bs2cqngfNoXbSfvn6g2ji68%3D" alt="图像" loading="lazy"/></p>
<p>下面介绍一下 Rust 1.92.0 的主要内容：涉及语言核心、编译器和标准库层面的一系列更新。</p>
<h2 data-id="heading-0">语言特性与编译器更新</h2>
<p><strong>1、语言核心：向 Never 类型的最终稳定化迈进</strong></p>
<p>语言和编译器团队继续推进 Never 类型的稳定化工作。为了推进Never类型（ <code>!</code> ）（表示永远不会返回的类型）的最终稳定化，在此版本中，编译器团队将 <code>never_type_fallback_flowing_into_unsafe</code> 和 <code>dependency_on_unit_never_type_fallback</code> 这两个相关的未来兼容性提示（lint）提升为 <strong>Deny-by-default</strong>（默认为拒绝） 级别。当编译器检测到可能因 Never 类型类型回退规则变化而受损的代码时，这两个lint 将触发<strong>编译错误</strong>，而非警告，这显然是编译器团队有意让开发者更加关注 Never 类型而做出的做铺垫工作（不过，铺垫归铺垫，因为 <code>never</code>！这个关键字起得太过玄学，难怪网友调侃：我们都知道“永不”类型的真正稳定日期😉）。</p>
<p>不过此更改仅在直接构建受影响的 crate 时生效；如果这些 crate 是作为依赖项被构建，则不会触发错误。虽然开发者可以通过 <code>#[allow(...)]</code> 属性暂时绕过这些错误，但官方强烈建议修复被报告的问题。</p>
<p>此外，<code>unused_must_use</code> lint 变得更加智能。对于返回类型为 <code>Result&lt;(), !&gt;</code> 或 <code>ControlFlow&lt;!, ()&gt;</code> 的函数，该lint将不再发出“未使用必须使用的值”的警告。</p>
<p><strong>2、编译器方面：Linux 下 <code>panic=abort</code> 问题修复</strong></p>
<p>在编译器方面，Rust 1.92.0 解决了一个长期影响Linux开发者调试体验的问题。</p>
<p>过去，当使用 <code>-C panic=abort</code> 编译选项（即在panic 时直接终止程序而非展开）时，<strong>编译器默认不会生成展开表（unwind tables）</strong> ，这导致无法获取有意义的栈回溯信息（backtrace）。</p>
<p>从这个版本开始，即使在Linux上使用 <code>-C panic=abort</code>，编译器也会默认生成展开表（unwind tables）。这意味着程序异常（panic ）终止时，开发者能够获得准确的函数调用栈信息（backtrace），极大地便利了线上问题的调试和诊断。</p>
<p>当然，如果出于极致的二进制体积优化考虑，开发者仍可以通过 <code>-C force-unwind-tables=no</code> 选项显式关闭此功能。</p>
<p><strong>3、宏导出参数校验</strong>：</p>
<p>对 <code>#[macro_export]</code> 属性的参数输入进行了更严格的校验，<code>invalid_macro_export_arguments</code> lint 现在默认拒绝（deny）。</p>
<p><strong>4、Lint 改进</strong>：</p>
<p><code>unused_must_use</code> lint 现在更加智能，不再对返回<code>Result&lt;(), Uninhabited&gt;</code>（例如 <code>Result&lt;(), !&gt;</code>）的函数发出警告，因为这种情况下错误分支在逻辑上是不可能发生的。</p>
<h2 data-id="heading-1">标准库：实用的新API与零开销抽象</h2>
<p>Rust 1.92.0 在标准库中稳定了一批新的API，涵盖了内存操作、并发控制和数据结构等多个方面。</p>
<p><strong>零初始化智能指针：</strong> 这是本次更新的一个亮点。新增的 <code>Box::new_zeroed</code>、<code>Box::new_zeroed_slice</code> 以及对应的 <code>Rc</code> 和 <code>Arc</code> 版本，允许开发者直接创建内存内容为零的智能指针。</p>
<p>这在处理需要清零内存的FFI（外部函数接口）交互或对安全性有极高要求的场景中非常有用。</p>
<p><strong>在并发编程方面：</strong><code>RwLockWriteGuard::downgrade</code> 方法现已稳定。它允许开发者将一个写锁“降级”为一个读锁，而无需先释放写锁再竞争读锁。</p>
<p>这个原子性操作对于需要先修改数据、再以只读方式长时间持有访问权的场景至关重要，能有效避免不必要的锁竞争。</p>
<p>其它值得关注的稳定API还包括：</p>
<ul>
<li><code>NonZero&lt;uN&gt;::div_ceil</code>：对非零整数进行向上取整的除法。</li>
<li><code>Location::file_as_c_str</code>：获取当前源代码文件名的C字符串表示，便于与C语言交互。</li>
<li><code>BTreeMap</code> 的入口API扩展：如 <code>btree_map::Entry::insert_entry</code>。</li>
<li>为 <code>proc_macro::TokenStream</code> 实现了对 <code>Group</code>、<code>Literal</code> 等类型的 <code>Extend</code> trait，增强了过程宏编写的灵活性。</li>
</ul>
<p>此外，切片的 <code>rotate_left</code> 和 <code>rotate_right</code> 方法现在可以在常量上下文（const context）中使用了。</p>
<h2 data-id="heading-2">工具链 ：更智能的文档搜索与构建指南</h2>
<p>Rust 的工具链(Rustdoc &amp; Cargo)在此版本中也获得了实用性改进。</p>
<p><strong>Rustdoc（文档工具）的搜索功能</strong> 变得更加智能和友好。</p>
<ul>
<li><strong>搜索结果去重</strong>：当搜索结果中包含某个trait定义的方法时，Rustdoc会自动隐藏那些具体实现该trait的类型中的同名方法。例如，搜索“last”将主要显示 <code>Iterator::last</code>，而不会用各个迭代器实现的 <code>last</code> 方法刷屏，使得像 <code>BTreeSet::last</code> 这样的固有方法更容易被找到。</li>
<li><strong>放宽搜索词限制</strong>：现在可以搜索不完全符合Rust标识符规则的词（例如以数字开头的词条），从而提升了搜索体验。</li>
</ul>
<p>Cargo 新增了关于  <strong>“构建性能优化”的官方文档章节</strong>。这对于想要加快项目编译速度的开发者而言，是一个很实用的参考。</p>
<h2 data-id="heading-3">Rust 版本升级指南</h2>
<p>升级到 Rust 1.92.0 非常简单，只需在终端执行以下命令：</p>
<pre><code class="hljs language-shell" lang="shell">rustup update stable
</code></pre>
<p>对于实际项目，建议先在持续集成（CI）环境中测试升级，确保新的默认拒绝 lint（如 <code>invalid_macro_export_arguments</code>）不会中断构建。根据官方说明，最低支持的LLVM版本已更新至20。</p>
<h2 data-id="heading-4"><strong>总结</strong></h2>
<p>Rust 1.92.0正式发布，核心改进包括 Never 类型稳定化准备、Linux下 panic 回溯修复，以及智能指针零初始化等标准库 API 落地等。</p>
<h2 data-id="heading-5"><strong>相关链接</strong></h2>
<ul>
<li>发布笔记：<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.rust-lang.org%2F2025%2F12%2F11%2FRust-1.92.0" target="_blank" title="https://blog.rust-lang.org/2025/12/11/Rust-1.92.0" ref="nofollow noopener noreferrer">blog.rust-lang.org/2025/12/11/…</a></li>
<li>升级日志：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Frust-lang%2Frust%2Freleases%2Ftag%2F1.92.0" target="_blank" title="https://github.com/rust-lang/rust/releases/tag/1.92.0" ref="nofollow noopener noreferrer">github.com/rust-lang/r…</a></li>
<li>变更日志：<a href="https://link.juejin.cn?target=https%3A%2F%2Freleases.rs%2Fdocs%2F1.92.0" target="_blank" title="https://releases.rs/docs/1.92.0" ref="nofollow noopener noreferrer">releases.rs/docs/1.92.0</a></li>
<li>版本草稿：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Frust-lang%2Frust%2Fissues%2F149161" target="_blank" title="https://github.com/rust-lang/rust/issues/149161" ref="nofollow noopener noreferrer">github.com/rust-lang/r…</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[大模型入门指南 - Training：小白也能看懂的“模型训练”全解析]]></title>    <link>https://juejin.cn/post/7583981974408314890</link>    <guid>https://juejin.cn/post/7583981974408314890</guid>    <pubDate>2025-12-16T02:59:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583981974408314890" data-draft-id="7582599972950294555" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="大模型入门指南 - Training：小白也能看懂的“模型训练”全解析"/> <meta itemprop="keywords" content="Agent,LLM,程序员"/> <meta itemprop="datePublished" content="2025-12-16T02:59:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型教程"/> <meta itemprop="url" content="https://juejin.cn/user/1145012233707299"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            大模型入门指南 - Training：小白也能看懂的“模型训练”全解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1145012233707299/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型教程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:59:15.000Z" title="Tue Dec 16 2025 02:59:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2FEnjoyEDU%2FLLM" target="_blank" title="https://gitcode.com/EnjoyEDU/LLM" ref="nofollow noopener noreferrer">这里</a>。</p>
</blockquote>
<p>Training（模型训练）本质是AI世界的‘科学烹饪实验’——以数据为食材原料，用超参数作配方比例，借验证集做品控质检，将‘玄学炼丹’的试错过程，淬炼成‘可复现的精密工程’。今天用最通俗的话，带你拆解模型训练（Training）全过程。</p>
<p><strong><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/975fe6089c554346b6eaedcf66e45c04~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766458755&amp;x-signature=VS4SjWaWnpSZYV4y6DxgrGpIFBw%3D" alt="" loading="lazy"/></strong></p>
<h2 data-id="heading-0"><strong><strong>一、概念解读</strong></strong></h2>
<p>Training（模型训练）到底是个啥？  模型训练是用数据喂AI，通过算法调参数，让它从‘瞎猜’到‘精准预测’的过程。</p>
<p>模型训练中的专业术语如下：</p>
<ul>
<li><strong><strong>数据（Data）：模型的课本+练习题，用于学习。类似学生通过刷题（训练数据）掌握知识点，通过模拟考（验证集）检验水平。</strong></strong></li>
<li><strong><strong>参数（Weights）：模型的大脑神经元连接强度，训练中不断调整。类似学生解题时调整解题思路（参数），使答案更接近标准答案（真实标签）。</strong></strong></li>
<li><strong><strong>损失函数（Loss）：衡量模型答案与真实答案的差距。类似学生答错题扣分（Loss升高），答对加分（Loss下降）。</strong></strong></li>
<li><strong><strong>优化器（Optimizer）：调整参数的学习方法，如梯度下降=查漏补缺。类似学生根据错题本（梯度）调整学习策略（参数），优先补薄弱科目（高Loss方向）。</strong></strong></li>
<li><strong><strong>正则化（Regularization）：防止AI死记硬背的记忆抑制器。类似学生做题时强制理解原理（L1/L2正则化），而非机械背诵。</strong></strong></li>
</ul>
<p>模型训练的本质是通过参数（解题思路）不断试错、用损失函数（扣分机制）量化差距、靠优化器（错题本复盘法）迭代策略、借正则化（防机械背诵规则）强化泛化，最终在验证集（模拟考）中交出高分答卷的过程。</p>
<p><strong><strong><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/592001f992574632a6ebfd623f3c73b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766458755&amp;x-signature=nIEPgCC5nP8lKZ%2FeKNCIVspNzgM%3D" alt="" loading="lazy"/></strong></strong></p>
<p><strong>为什么需要Training（模型训练）？</strong> 模型像一张白纸（随机初始化参数），无法完成任何任务，Training让模型逐步学会从输入到输出的<strong>正确映射，</strong> 让模型从‘文盲’变成‘学霸’。</p>
<ul>
<li><strong><strong>人类学习：通过「课本+练习题+考试」掌握知识。</strong></strong></li>
<li><strong><strong>模型训练：通过「数据+优化算法+验证集」调整参数，使模型输出接近真实答案。</strong></strong></li>
</ul>
<h5 data-id="heading-1"><strong>模型训练中的常见问题与解决方案如下：</strong></h5>
<ul>
<li><strong><strong>Loss不下降：模型学不会，像学生听天书。大概率是数据质量差、模型架构错误、学习率过大。这时候需要清洗数据、换模型、调小学习率。</strong></strong></li>
<li><strong><strong>过拟合：训练集满分，测试集翻车，像学生只背题库。大概率是数据量不足、模型复杂度过高。这时候需要增加数据、简化模型、加正则化。</strong></strong></li>
<li><strong><strong>训练速度慢：模型学得慢，像学生走神。大概率是Batch Size过大、硬件算力不足。这时候需要减小Batch Size、换GPU、分布式训练。</strong></strong></li>
<li><strong><strong>梯度爆炸/消失：模型学崩了，像学生疯癫/昏迷。大概率是网络层数过深、激活函数选择不当。这时候需要加梯度裁剪、换激活函数（如ReLU→LeakyReLU）、残差连接。</strong></strong></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd22fc9e8017492891ae703a773f1a21~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766458755&amp;x-signature=mlo5mHpQPS26Kfck4X30fBUbNtU%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2"><strong><strong>二、技术实现</strong></strong></h2>
<p><em>Training（模型训练）如何进行技术实现？<strong>模型训练按‘数据预处理→架构搭建→参数调优→迭代验证’四步走。</strong></em></p>
<ul>
<li><strong>数据预处理 →</strong> “喂数据” <strong>（模型的“九年义务教育”阶段，先清洗、标注、划分数据集）</strong></li>
<li><strong>架构搭建 →</strong> “搭脑回路” <strong>（选择Transformer模型架构，初始化参数）</strong></li>
<li><strong>参数调优 →</strong> “刷题+改错” <strong>（损失函数扣分→优化器改参数→正则化防死记，模型的“高三冲刺”模式）</strong></li>
<li><strong>迭代验证 →</strong> “周考+月考” <strong>（验证集监控过拟合，测试集“毕业考”定生死，模型的“高考质检局”）</strong></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c56efc4cbb14d7b8b1397a4fa31538c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766458755&amp;x-signature=ItfHL7OhPdgwt76DtDSE7ta1sWU%3D" alt="" loading="lazy"/></p>
<p>PyTorch如何实现Training（模型训练）？PyTorch通过定义模型结构（继承nn.Module并实现前向传播），配置损失函数（如MSELoss）与优化器（如Adam），在训练循环中反向传播更新参数（通过loss.backward()和optimizer.step()），同时利用DataLoader实现数据批量加载与预处理，最终通过迭代优化使模型拟合数据。</p>
<p><strong><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19c43199277b4e2aa75df4fce3ddf75c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766458755&amp;x-signature=DuY83KyaG%2BOEk6iKTr%2FtikBHO7o%3D" alt="" loading="lazy"/></strong></p>
<pre><code class="hljs language-ini" lang="ini">import torch
import torch.nn as nn
import torch.optim as optim
from torch.utils.data import DataLoader, TensorDataset
import math
<span class="hljs-comment"># 参数配置</span>
<span class="hljs-attr">input_dim</span> = <span class="hljs-number">10</span>       <span class="hljs-comment"># 输入特征维度</span>
<span class="hljs-attr">output_dim</span> = <span class="hljs-number">1</span>       <span class="hljs-comment"># 输出维度（回归任务）</span>
<span class="hljs-attr">seq_length</span> = <span class="hljs-number">5</span>       <span class="hljs-comment"># 序列长度</span>
<span class="hljs-attr">batch_size</span> = <span class="hljs-number">32</span>
<span class="hljs-attr">num_epochs</span> = <span class="hljs-number">50</span>      <span class="hljs-comment"># 增加训练轮次</span>
<span class="hljs-attr">learning_rate</span> = <span class="hljs-number">0.001</span>
<span class="hljs-attr">d_model</span> = <span class="hljs-number">64</span>         <span class="hljs-comment"># 模型维度</span>
<span class="hljs-attr">nhead</span> = <span class="hljs-number">4</span>            <span class="hljs-comment"># 注意力头数</span>
<span class="hljs-attr">dim_feedforward</span> = <span class="hljs-number">256</span> <span class="hljs-comment"># 前馈网络维度</span>
<span class="hljs-comment"># 生成虚拟数据（带时序特征）</span>
<span class="hljs-attr">X</span> = torch.randn(<span class="hljs-number">1000</span>, seq_length, input_dim) * torch.arange(<span class="hljs-number">1</span>, seq_length+<span class="hljs-number">1</span>).view(<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>)
<span class="hljs-attr">y</span> = X.mean(dim=(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>)).unsqueeze(-<span class="hljs-number">1</span>)  <span class="hljs-comment"># 目标：带时序权重的均值回归</span>
<span class="hljs-comment"># 数据标准化</span>
<span class="hljs-attr">X</span> = (X - X.mean()) / X.std()
<span class="hljs-attr">y</span> = (y - y.mean()) / y.std()
<span class="hljs-comment"># 封装为DataLoader</span>
<span class="hljs-attr">dataset</span> = TensorDataset(X, y)
<span class="hljs-attr">dataloader</span> = DataLoader(dataset, batch_size=batch_size, shuffle=<span class="hljs-literal">True</span>, num_workers=<span class="hljs-number">2</span>)
class TransformerEncoderRegressor(nn.Module):
def __init__(self):
super().__init__()
<span class="hljs-attr">self.input_proj</span> = nn.Linear(input_dim, d_model)
<span class="hljs-comment"># Transformer编码器（参考网页7架构）</span>
<span class="hljs-attr">encoder_layer</span> = nn.TransformerEncoderLayer(
<span class="hljs-attr">d_model</span>=d_model,
<span class="hljs-attr">nhead</span>=nhead,
<span class="hljs-attr">dim_feedforward</span>=dim_feedforward,
<span class="hljs-attr">batch_first</span>=<span class="hljs-literal">True</span>  <span class="hljs-comment"># PyTorch 1.9+特性</span>
)
<span class="hljs-attr">self.encoder</span> = nn.TransformerEncoder(encoder_layer, num_layers=<span class="hljs-number">3</span>)
<span class="hljs-comment"># 输出层（带特征聚合）</span>
<span class="hljs-attr">self.output_layer</span> = nn.Sequential(
nn.Linear(d_model * seq_length, 128),
nn.ReLU(),
nn.Dropout(0.1),
nn.Linear(128, output_dim)
)
<span class="hljs-comment"># 位置编码（参考网页4实现）</span>
<span class="hljs-attr">self.pos_encoder</span> = PositionalEncoding(d_model, dropout=<span class="hljs-number">0.1</span>)
def forward(self, src):
<span class="hljs-comment"># 输入投影 [batch, seq, d_model]</span>
<span class="hljs-attr">src</span> = self.input_proj(src) * math.sqrt(d_model)
<span class="hljs-comment"># 添加位置编码</span>
<span class="hljs-attr">src</span> = self.pos_encoder(src)
<span class="hljs-comment"># 编码处理 [batch, seq, d_model]</span>
<span class="hljs-attr">memory</span> = self.encoder(src)
<span class="hljs-comment"># 特征聚合 [batch, seq*d_model]</span>
<span class="hljs-attr">flattened</span> = memory.view(memory.size(<span class="hljs-number">0</span>), -<span class="hljs-number">1</span>)
return self.output_layer(flattened)
class PositionalEncoding(nn.Module):
"""网页4位置编码实现（适配batch_first格式）"""
def __init__(self, d_model: int, dropout: <span class="hljs-attr">float</span> = <span class="hljs-number">0.1</span>, max_len: int = <span class="hljs-number">5000</span>):
super().__init__()
<span class="hljs-attr">self.dropout</span> = nn.Dropout(p=dropout)
<span class="hljs-attr">position</span> = torch.arange(max_len).unsqueeze(<span class="hljs-number">1</span>)
<span class="hljs-attr">div_term</span> = torch.exp(torch.arange(<span class="hljs-number">0</span>, d_model, <span class="hljs-number">2</span>) * (-math.log(<span class="hljs-number">10000.0</span>) / d_model))
<span class="hljs-attr">pe</span> = torch.zeros(max_len, d_model)
pe<span class="hljs-section">[:, 0::2]</span> = torch.sin(position * div_term)
pe<span class="hljs-section">[:, 1::2]</span> = torch.cos(position * div_term)
self.register_buffer('pe', pe.unsqueeze(0))  <span class="hljs-comment"># [1, max_len, d_model]</span>
def forward(self, x):
<span class="hljs-attr">x</span> = x + self.pe[:, :x.size(<span class="hljs-number">1</span>), :]
return self.dropout(x)
<span class="hljs-comment"># 初始化模型</span>
<span class="hljs-attr">model</span> = TransformerEncoderRegressor()
<span class="hljs-attr">criterion</span> = nn.MSELoss()
<span class="hljs-attr">optimizer</span> = optim.AdamW(model.parameters(), lr=learning_rate, weight_decay=<span class="hljs-number">1</span>e-<span class="hljs-number">4</span>)
<span class="hljs-attr">scheduler</span> = optim.lr_scheduler.ReduceLROnPlateau(optimizer, <span class="hljs-string">'min'</span>, patience=<span class="hljs-number">5</span>)
<span class="hljs-comment"># 训练循环（带验证）</span>
for epoch in range(num_epochs):
model.train()
<span class="hljs-attr">total_loss</span> = <span class="hljs-number">0</span>
for batch_X, batch_y in dataloader:
optimizer.zero_grad()
<span class="hljs-attr">outputs</span> = model(batch_X)
<span class="hljs-attr">loss</span> = criterion(outputs, batch_y)
loss.backward()
<span class="hljs-comment"># 梯度裁剪（网页7实践）</span>
nn.utils.clip_grad_norm_(model.parameters(), 1.0)
optimizer.step()
total_loss += loss.item()
<span class="hljs-attr">avg_loss</span> = total_loss / len(dataloader)
scheduler.step(avg_loss)
print(f'Epoch <span class="hljs-section">[{epoch+1}/{num_epochs}]</span>, Loss: {avg_loss:.4f}, LR: {optimizer.param_groups<span class="hljs-section">[0]</span><span class="hljs-section">["lr"]</span>:.2e}')
<span class="hljs-comment"># 测试推理</span>
<span class="hljs-attr">test_input</span> = torch.randn(<span class="hljs-number">3</span>, seq_length, input_dim)  <span class="hljs-comment"># 批量推理测试</span>
model.eval()
with torch.no_grad():
<span class="hljs-attr">prediction</span> = model(test_input)
print('Test predictions:', prediction.squeeze().tolist())
</code></pre>
<h3 data-id="heading-3">学习资源推荐</h3>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2FEnjoyEDU%2FLLM" target="_blank" title="https://gitcode.com/EnjoyEDU/LLM" ref="nofollow noopener noreferrer">这里</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[国产芯片也能跑AI视频实时生成了，商汤Seko 2.0揭秘幕后黑科技]]></title>    <link>https://juejin.cn/post/7583948178858541102</link>    <guid>https://juejin.cn/post/7583948178858541102</guid>    <pubDate>2025-12-16T02:25:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583948178858541102" data-draft-id="7583981974407872522" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="国产芯片也能跑AI视频实时生成了，商汤Seko 2.0揭秘幕后黑科技"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2025-12-16T02:25:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="机器之心"/> <meta itemprop="url" content="https://juejin.cn/user/1873223543167902"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            国产芯片也能跑AI视频实时生成了，商汤Seko 2.0揭秘幕后黑科技
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1873223543167902/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    机器之心
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:25:09.000Z" title="Tue Dec 16 2025 02:25:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>自 Sora 2 发布以来，各大科技厂商迎来新一轮视频生成模型「军备竞赛」，纷纷赶在年底前推出更强的迭代版本。</p>
<p>谷歌推出 Veo 3.1，通过首尾帧控制和多图参考解决了以往视频生成「抽卡」随机性太强的问题；Runway 拿出 Gen-4.5，强化了物理模拟和表情动作迁移；快手祭出 Kling 2.6，实现了原生音画同步……</p>
<p>各家都在炫技，但一个更本质的问题却常被忽略：这些模型距离真正的生产力工具，究竟还有多远？</p>
<p>12 月 15 日，商汤科技产品发布周正式开启，第一天就重磅上线了全新的 Seko 2.0 版本，让 AI 短剧创作真正实现「一人剧组」。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/81704c3cf4624c12a1787f22cd6d2a09~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456709&amp;x-signature=LEGSmXom17dV2dqjtYMjh8veuuw%3D" alt="图片" loading="lazy"/></p>
<p>比如只需输入一句简单的提示词，它立马就能策划剧本大纲，生成分镜和视频，整个过程相当麻溜。</p>
<p>视频来自 Seko 官网，创作者：小铭AI百宝箱</p>
<p>无论是 1 分半钟的 3D 艺术风格的动画短片：</p>
<p>视频来自 Seko 官网，创作者：噪维 AIGC</p>
<p>还是用 SekoTalk 算法能精准同步唇形的数字人音乐 MV，都能在最短时间内信手拈来。</p>
<p>视频来自 Seko 官网，创作者：AI制片人Webb</p>
<p>作为行业首个创编一体、多剧集生成智能体，Seko 已经服务上百家短剧工作室，大量 AI 短剧成功上线。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0df01fa553ee4bc4916e3043bdf55f10~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456709&amp;x-signature=xv9Ta18Rz84BWGNn043QnukH2jM%3D" alt="图片" loading="lazy"/></p>
<p>用商汤 Seko 创作的《婉心计》登顶抖音 AI 短剧榜第一</p>
<p>而此次 2.0 版本的升级，背后是商汤在视频生成底层技术上的深度突破。从开源推理框架 LightX2V 到产品化落地，再到国产芯片的全面适配，商汤正在构建一条完整的 AI 视频生产链路。</p>
<p>视频生成的「不可能三角」</p>
<p>尽管赛道火热，但当 AI 视频生成模型步入短剧制作等实战场景时，往往会撞上由效率、成本、质量构成的「不可能三角」。</p>
<p>目前即便如 Sora 2 级别的产品，生成 10 秒视频往往需要数分钟乃至十分钟。这种漫长的等待时间，让创作者难以进行快速迭代和实时反馈，严重制约了创作效率，更无法支撑工业化生产。</p>
<p>有数据表明，开源模型生成一段 5s 视频通常超过十分钟，商用闭源模型生成 5s 的视频通常也需 1 至 10 分钟不等。这意味着生成与实时播放之间存在着很长的时间差距，距离真正的「强实时生成」，即生成 5 秒视频所需时间小于 5 秒，还有遥远的距离。</p>
<p>实时性问题的背后，是更为本质的计算成本困境。如果要投入如此高昂的算力成本，任何试图用 AI 大规模生产视频内容的商业计划，都会在财务模型上遭遇滑铁卢。</p>
<p>对于 AI 短剧和漫剧创作而言，这个问题更加尖锐。短剧制作的本质是多剧集、多场景、多分镜的复杂工程，这直接导致了计算量的指数级增长。一个仅 5 秒的视频片段就需要生成接近 10 万 token，而在实际创作流程中，一键生成通常会产生 10 到 20 个分镜，这意味着单次操作的 token 消耗量就达到 100 万到 200 万级别。</p>
<p>按照传统视频生成模型的成本结构，制作一集 10 分钟的 AI 短剧，所需的计算资源和时间成本将达到令人咋舌的地步。没有哪家内容制作公司能够承受每生成一分钟内容就要支付数小时高端 GPU 算力的成本。在这种场景下，效率与成本直接决定了项目的生死。</p>
<p>当行业试图通过降低推理步数、压缩模型参数等方式提升速度、降低成本时，又往往会遭遇生成质量下降的挑战。视频的一致性、动态性、画面清晰度都可能在优化过程中受损，而对于商业应用而言，质量是不可妥协的底线。</p>
<p>如此看来，现有的视频生成技术架构似乎陷入了一个「不可能三角」，要么牺牲质量换取速度，要么保证质量但付出巨大的时间和算力代价，要么在两者之间艰难平衡却难以真正满足商业应用需求。这个困局让无数技术团队在实验室里的惊艳演示，最终折戟于真实商业场景的严苛考验。</p>
<p>打破这个困局，需要的不仅仅是单点技术的突破，更需要从算法、架构到系统工程的全方位创新。</p>
<p>商汤悄悄开源的 AI 视频生成框架</p>
<p>速度快 10 倍</p>
<p>今年上半年，一个名为 LightX2V 的开源项目及其推出的图像和视频生成 4 步蒸馏模型，在 ComfyUI 社区走红，还在 Reddit 上引发热烈讨论。截至目前，该项目上传的模型累计下载量已突破 350 万次。</p>
<p>这个备受瞩目的项目背后的研发团队一度颇为神秘，如今答案揭晓，LightX2V 是由商汤科技与北航联合研发的成果，也是业界首个开源的实时视频生成推理框架。</p>
<p>LightX2V 的核心价值在于真正做到了实时视频生成。</p>
<p>它通过一系列创新技术的组合应用，在消费级显卡上实现了强实时生成，生成 5 秒视频所需时间小于 5 秒，速度达到现在行业主流的数倍甚至十倍以上。</p>
<p>算法创新：实时生成的基础</p>
<p>LightX2V 的性能突破首先源于其深层的算法创新。</p>
<p>商汤原创设计的 Phased DMD 步数蒸馏技术，让视频生成在 4 步推理下就能实现高质量的一致性和动态性。这套技术产出的 Wan2.1、Qwen-Image 等多步模型，登上 HuggingFace 趋势榜前 10，累计下载量超过 358 万次。</p>
<p>传统的分布匹配蒸馏（DMD）方法虽然可以将分数匹配生成模型压缩成高效的多步生成器，但在直接扩展到多步蒸馏时，会面临生成多样性显著降低、训练不稳定以及难以有效处理复杂分布的局限性。</p>
<p>为了解决这些难题，研究者提出了 Phased DMD。这是一个结合了阶段式蒸馏和专家混合思想的多步蒸馏框架，旨在降低学习难度并增强模型能力。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8437f65ca3774549bdc540631611dbe7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456709&amp;x-signature=O4Gga2IyvEPCXhzJTJMb56hTNTg%3D" alt="图片" loading="lazy"/></p>
<p>图 1：(a) 多步 DMD、(b) 采用随机梯度截断策略的多步 DMD、(c)  Phased DMD 和 (d) 采用 SGTS 的 Phased DMD 的示意图。</p>
<p>Phased DMD 建立在两个核心理念之上：</p>
<ul>
<li>
<p>渐进式分布匹配：该方法将信噪比（SNR）范围划分成多个子区间，通过这种划分，模型可以渐进式地将自身精度优化到更高的 SNR 级别，从而更好地捕获复杂分布，并提高训练的稳定性和生成性能。在去噪过程中，低 SNR 阶段聚焦于全局结构，而高 SNR 阶段则关注精细细节。</p>
</li>
<li>
<p>子区间内分数匹配：由于要对齐子区间的分布，研究者通过严格的推导，得到一个具有理论保证的训练目标。这个目标能够正确估计子区间内的分数，确保阶段式训练的理论正确性。</p>
</li>
</ul>
<p>Phased DMD 的结构设计是一个天然的 Mixture-of-Experts 架构，允许模型中的不同专家专门学习处理不同的 SNR 阶段，而不会引入额外的推理成本。Phased DMD 不仅原生支持 MoE 模型，而且对于非 MoE 的教师模型，该技术也可以将之蒸馏为 MoE 学生模型。</p>
<p>实验结果表明，Phased DMD 相较于传统 DMD 方法，能更好地保持基模型的动态效果和多样性。Phased DMD 通过蒸馏 Qwen-Image (20B 参数) 和 Wan2.2 (28B 参数) 等先进的模型得到了充分验证，开源的部分模型也受到开源社区的讨论和好评。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/82a9a3663c56470da2bb91e13f1fd465~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456709&amp;x-signature=dCFoe4N5%2BqyfX63ISbT8nw9rKl4%3D" alt="图片" loading="lazy"/></p>
<p>来自 Wan2.1-T2V-14B 基础模型（40 步、CFG=4）及其蒸馏变体（4 步、CFG=1）的样本（随机种子 0–3）：(a) 基础模型，(b) DMD，(c) 带 SGTS 的 DMD，(d) Phased DMD。与基础模型和 Phased DMD 相比，DMD 与 SGTS 展现出更弱的运动动态。类似地，带 SGTS 的 DMD 倾向于生成特写视角，而 Phased DMD 和基础模型更好地遵循提示中的相机指令。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/916826ede3694618b6f35a94050285e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456709&amp;x-signature=Bz7hnld6fFuyWCFZCmeBbFZ2Pdk%3D" alt="图片" loading="lazy"/></p>
<p>通过 Phased DMD 蒸馏生成的 Qwen-Image 示例。</p>
<p>在高效视频生成领域，自编码器（VAE）模型是不可或缺的关键组件。它负责将像素空间压缩到更小的潜在空间，以实现更快处理。然而，传统的官方 VAE 模型往往内存占用大、推理速度慢，严重制约了视频生成效率。</p>
<p>针对这一行业痛点，LightX2V 团队发布了 LightVAE、LightTAE 系列高效视频自编码器模型集合，旨在通过深度优化和蒸馏技术，在最大限度保持高清画质的同时，实现高达 10 倍以上的性能提升，为实时生成奠定了坚实的算法基础。</p>
<p>LightVAE 系列被定位为「最佳平衡解决方案」，通过对官方 VAE 架构进行剪枝和蒸馏，例如对 Wan2.1 VAE 剪枝 75%，成功将显存占用减少了约 50%（降至约 4-5 GB），同时将推理速度提升了 2 到 3 倍。LightVAE 保持了接近官方模型的优异质量，使其成为日常生产和高性能需求的理想选择。</p>
<p>对于追求极致速度和最小内存占用的场景，团队则推出了 LightTAE 系列，采用更轻量级的 2D 卷积架构，将显存占用降至极低的约 0.4 GB，并实现了极快的推理速度。尽管其基础架构与开源的 TAE 相似，但 LightTAE 经过团队的蒸馏优化，其生成质量显著超越了普通的开源 TAE，达到了接近官方 VAE 的水平，非常适合开发测试和快速迭代等对效率有高要求的场景。</p>
<p>实际测试结果表明，LightX2V 的优化效果是显著的。例如，在处理一段 5 秒 81 帧的视频时，官方 Wan2.1 VAE 的解码时间约为 5.46 秒，显存需求超过 10 GB。相比之下，LightVAE 将解码时间缩短到约 2.07 秒，显存降至 5.57 GB 左右。而 LightTAE 则表现出惊人的速度，解码时间仅需约 0.25 秒，且显存几乎可以忽略不计。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/45bfd549ead243278afecadc0a9beaeb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456709&amp;x-signature=sW8ZhlsW9nF5Rgpn7%2Bhl2KqIxqA%3D" alt="图片" loading="lazy"/></p>
<p>工程创新：全栈优化实现「强实时」</p>
<p>真正让实时生成视频变为可能的，是 LightX2V 在工程层面的全栈优化。</p>
<p>LightX2V 构建了一个面向低成本、强实时的视频生成推理完整方案，覆盖了模型、调度、计算、存储和通信五个维度，通过低比特量化、稀疏注意力、特征缓存、高效 Offloading 和多卡通信优化等技术，形成了清晰且高效的五层体系结构。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f71e2317052644f495cc74f7fd9f6eb2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456709&amp;x-signature=9oU1s1LTOeQ9TcccWuJOjvNJF2c%3D" alt="图片" loading="lazy"/></p>
<p>在框架的最底层是算子实现层，它是所有性能优化的根基，集成了多种高度定制和优化的低级计算操作，特别是针对计算密集型的注意力机制。通过引入 Flash Attention V3、Sage Attention V1/V2/V3、Radial Attention 和 Ring Attention 等创新算子，LightX2V 为上层提供了强大的计算加速能力，从硬件层面保证了推理的高效运行。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b61de198d1d4034b39d90e55e07130a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456709&amp;x-signature=FGLd%2FRf4gvlYPQveTjSRTPlqGRs%3D" alt="图片" loading="lazy"/></p>
<p>紧接着是内核库层，它负责封装底层算子的复杂性，并为上层模型提供稳定、高性能的调用接口和运行时环境。</p>
<p>再向上，框架的核心执行环境位于模型模块层。该层以并行推理为核心机制，最大化了计算资源的利用。它包含一个负责任务顺序和时间步管理的调度器，以及一个支持主流视频生成模型如 Hunyuan、Cogvideo 和 Wan 系列的模型组件，还集成了 Offload（用于显存卸载管理）和 Weight（权重管理）等模块，确保了在有限硬件资源下依然能够高效运行大型模型。</p>
<p>在模型模块之上，是 LightX2V 的优化算法层，这一层汇聚了框架的关键加速策略。它通过量化技术来压缩模型体积并加速计算；利用特征缓存来避免中间结果的重复计算；并结合底层的优化算子实现高效注意力机制，共同将模型的推理效率推向极致。</p>
<p>最后，位于顶层的是用户入口层，它体现了 LightX2V 的易用性。为适应不同场景，框架提供了多样化的接入方式，包括集成到流行的节点式工具 ComfyUI Workflow 中、通过 Gradio Web 快速部署在线演示服务、支持本地服务器部署，以及提供用于稳定生产环境的静态推理接口。</p>
<p>这种全栈优化带来的直接效果就是显存门槛降至 8GB 以下，入门级消费卡即可流畅运行；在 RTX 5090 等消费级显卡上，已经实现了 1:1 的实时生成效果。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/efd081acac4644ae9b19d97801dc6667~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456709&amp;x-signature=cUTzWuyWyNXnfm7Ibspkiu3Pb%2Bc%3D" alt="图片" loading="lazy"/></p>
<p>从技术架构来看，不是简单优化某个环节，而是构建了一套面向低成本、强实时的视频生成推理完整方案，这也是为什么它能在开源社区获得如此广泛关注的原因。它不仅是一个模型，更是一个可落地、可复用的技术框架。</p>
<p>国产化芯片适配</p>
<p>商业化的最后一块拼图</p>
<p>技术突破之外，商汤在 Seko 2.0 中还实现了另一个关键布局 —— 全面适配国产化芯片。</p>
<p>借助 LightX2V 框架，Seko 已成功支持多款国产 AI 芯片，真正实现了视频生成模型的全国产化部署能力。</p>
<p>从实际效果来看，在国产芯片与英伟达芯片上生成的视频，质量差距并不明显。虽然国产芯片的生成速度略慢，但其性价比优势突出。未来商汤计划给创作者提供国产化和非国产化两套方案，使用国产化方案的用户将获得更优惠的价格政策。</p>
<p>英伟达芯片（左）和国产芯片（右）生成视频对比</p>
<p>这不仅仅是成本优化的技术选择，更是对国产 AI 生态的战略性支持。在视频生成这一 AI 应用的关键场景中，打通从算法框架到硬件芯片的全链路国产化能力，意味着中国 AI 产业在核心技术上迈出了实质性的一步。</p>
<p>当视频生成真正做到实时、低成本、可规模化，AI 短剧乃至更广泛的视频内容创作，或许将迎来真正的生产力革命。而这场革命的起点，正是像 LightX2V 这样从底层技术开始的系统性创新。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[代码的三大核心素养：如何同时兼顾可维护性、可扩展性、可测试性]]></title>    <link>https://juejin.cn/post/7583948178858672174</link>    <guid>https://juejin.cn/post/7583948178858672174</guid>    <pubDate>2025-12-16T02:34:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583948178858672174" data-draft-id="7583948178858426414" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="代码的三大核心素养：如何同时兼顾可维护性、可扩展性、可测试性"/> <meta itemprop="keywords" content="后端,分布式"/> <meta itemprop="datePublished" content="2025-12-16T02:34:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="回家路上绕了弯"/> <meta itemprop="url" content="https://juejin.cn/user/536217404587134"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            代码的三大核心素养：如何同时兼顾可维护性、可扩展性、可测试性
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/536217404587134/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    回家路上绕了弯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:34:26.000Z" title="Tue Dec 16 2025 02:34:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">一、为什么这三者是 “工业级代码” 的基石？</h3>
<p>很多后端开发者都有过这样的经历：</p>
<ul>
<li>接手老项目时，面对 “面条式代码”，改一行怕崩一片（缺乏可维护性）；</li>
</ul>

<ul>
<li>业务新增需求（如新增支付方式、扩展字段），需要大面积修改原有逻辑（缺乏可扩展性）；</li>
</ul>

<ul>
<li>想写测试验证功能，却因代码耦合严重，连 Mock 依赖都难（缺乏可测试性）。</li>
</ul>
<p>这三者看似独立，实则相辅相成：</p>
<ul>
<li><strong>可维护性是基础</strong>：代码能被快速理解、修改，减少协作成本；</li>
</ul>

<ul>
<li><strong>可扩展性是延伸</strong>：基于良好的维护性，应对变化时无需重构核心逻辑；</li>
</ul>

<ul>
<li><strong>可测试性是保障</strong>：通过测试验证修改的正确性，避免 “改一处崩多处”，反过来又倒逼代码结构优化。</li>
</ul>
<p>核心目标：写出 “能抗住业务迭代” 的代码 —— 既让当前开发者省心，也让未来的自己 / 同事少踩坑。</p>
<h3 data-id="heading-1">二、可维护性：让代码 “好懂、好改”</h3>
<p>可维护性的核心是 “降低认知负担”：任何人拿到代码，能快速理清逻辑、定位问题、安全修改。</p>
<h4 data-id="heading-2">1. 核心原则：一致性、简洁性、自解释性</h4>
<ul>
<li>一致性：命名规范、代码结构、异常处理、日志格式统一（如团队约定 “布尔值用 is/has 开头”“日志必须包含业务标识”）；</li>
</ul>

<ul>
<li>简洁性：拒绝冗余逻辑、过度设计，用最少的代码实现核心功能；</li>
</ul>

<ul>
<li>自解释性：代码本身能说明 “做什么”，注释补充 “为什么”。</li>
</ul>
<h4 data-id="heading-3">2. 落地方法（附反例 / 正例）</h4>
<h5 data-id="heading-4">（1）命名与注释：拒绝 “猜谜游戏”</h5>
<ul>
<li>反例：</li>
</ul>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 反例1：命名模糊</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">processData</span><span class="hljs-params">(List <span class="hljs-comment">// list是什么？用户列表？订单列表？</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">String</span> s : list) {
        <span class="hljs-keyword">if</span> (s.length() &gt; <span class="hljs-number">6</span>) {
            <span class="hljs-comment">// 做某些操作</span>
        }
    }
}
<span class="hljs-comment">// 反例2：注释冗余/无效</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">int</span> add(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b) {
    <span class="hljs-comment">// a加b，返回结果（代码本身已说明，注释多余）</span>
    <span class="hljs-keyword">return</span> a + b;
}
</span></span></code></pre>
<ul>
<li>正例：</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 正例1：命名精准</span>
<span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">filterInvalidUserIds</span>(<span class="hljs-params">List&lt;<span class="hljs-built_in">String</span>&gt; userIds</span>) { <span class="hljs-comment">// 明确是“过滤无效用户ID”</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-title class_">String</span> userId : userIds) {
        <span class="hljs-keyword">if</span> (userId.<span class="hljs-title function_">length</span>() &gt; <span class="hljs-number">6</span>) { <span class="hljs-comment">// 为什么是6？注释补充背景</span>
            <span class="hljs-comment">// 兼容老系统：老用户ID为6位以上，新用户为6位，仅保留新用户ID</span>
            validUserIds.<span class="hljs-title function_">add</span>(userId);
        }
    }
}
</code></pre>
<h5 data-id="heading-5">（2）模块化拆分：拒绝 “大泥球代码”</h5>
<ul>
<li>反例：一个UserService包含用户注册、登录、信息修改、权限校验、订单查询等所有逻辑，上千行代码；</li>
</ul>

<ul>
<li>正例：按功能拆分模块，每个模块职责单一：</li>
</ul>
<pre><code class="hljs language-bash" lang="bash">com.example.user
├── service/
│   ├── register/  <span class="hljs-comment"># 注册相关</span>
│   │   ├── UserRegisterService.java  <span class="hljs-comment"># 注册核心逻辑</span>
│   │   └── UserRegisterValidator.java  <span class="hljs-comment"># 注册参数校验</span>
│   ├── login/     <span class="hljs-comment"># 登录相关</span>
│   └── profile/   <span class="hljs-comment"># 个人信息相关</span>
└── model/
    ├── dto/       <span class="hljs-comment"># 入参/出参DTO</span>
    └── po/        <span class="hljs-comment"># 数据库实体</span>
</code></pre>
<h5 data-id="heading-6">（3）控制逻辑复杂度：拒绝 “嵌套地狱”</h5>
<ul>
<li>反例：多层 if-else 嵌套，逻辑绕圈：</li>
</ul>
<pre><code class="hljs language-sql" lang="sql">public String getDiscount(<span class="hljs-keyword">User</span> <span class="hljs-keyword">user</span>, <span class="hljs-keyword">Order</span> <span class="hljs-keyword">order</span>) {
    if (<span class="hljs-keyword">user</span> <span class="hljs-operator">!=</span> <span class="hljs-keyword">null</span>) {
        if (user.isVIP()) {
            if (order.getAmount().compareTo(<span class="hljs-keyword">new</span> BigDecimal(<span class="hljs-number">1000</span>)) <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">return</span> "8折";
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> "9折";
            }
        } <span class="hljs-keyword">else</span> {
            if (order.getAmount().compareTo(<span class="hljs-keyword">new</span> BigDecimal(<span class="hljs-number">1000</span>)) <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">return</span> "9.5折";
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> "无折扣";
            }
        }
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> "无折扣";
    }
}
</code></pre>
<ul>
<li>正例：扁平化逻辑，用 “卫语句” 提前返回，或用策略模式：</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getDiscount</span>(<span class="hljs-params">User user, Order order</span>) {
    <span class="hljs-comment">// 卫语句：提前处理异常场景</span>
    <span class="hljs-keyword">if</span> (user == <span class="hljs-literal">null</span> || !user.<span class="hljs-title function_">isVIP</span>()) {
        <span class="hljs-keyword">return</span> order.<span class="hljs-title function_">getAmount</span>().<span class="hljs-title function_">compareTo</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-number">1000</span>)) &gt; <span class="hljs-number">0</span> ? <span class="hljs-string">"9.5折"</span> : <span class="hljs-string">"无折扣"</span>;
    }
    <span class="hljs-comment">// 核心逻辑简化</span>
    <span class="hljs-keyword">return</span> order.<span class="hljs-title function_">getAmount</span>().<span class="hljs-title function_">compareTo</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-number">1000</span>)) &gt; <span class="hljs-number">0</span> ? <span class="hljs-string">"8折"</span> : <span class="hljs-string">"9折"</span>;
}
</code></pre>
<h3 data-id="heading-7">三、可扩展性：让代码 “能加、能改”</h3>
<p>可扩展性的核心是 “拥抱变化”：当业务新增需求、修改规则时，无需重构核心逻辑，仅通过 “新增代码” 或 “配置调整” 实现。</p>
<h4 data-id="heading-8">1. 核心原则：开闭原则、依赖抽象、最小修改</h4>
<ul>
<li>开闭原则：对扩展开放，对修改关闭；</li>
</ul>

<ul>
<li>依赖抽象：依赖接口 / 抽象类，而非具体实现；</li>
</ul>

<ul>
<li>最小修改：新增功能时，修改的代码行数越少越好。</li>
</ul>
<h4 data-id="heading-9">2. 落地方法（附反例 / 正例）</h4>
<h5 data-id="heading-10">（1）面向接口编程：解耦实现与调用</h5>
<ul>
<li>反例：硬编码依赖具体实现，新增功能需修改原有逻辑：</li>
</ul>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> OrderPaymentService {
    // 硬编码依赖支付宝实现，新增微信支付需修改此类
    <span class="hljs-keyword">private</span> AlipayService alipayService = <span class="hljs-built_in">new</span> AlipayService();
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> pay(<span class="hljs-keyword">Order</span> <span class="hljs-keyword">order</span>) {
        <span class="hljs-keyword">return</span> alipayService.pay(<span class="hljs-keyword">order</span>.getOrderNo(), <span class="hljs-keyword">order</span>.getAmount());
    }
}
</code></pre>
<ul>
<li>正例：依赖接口，新增实现无需修改核心逻辑：</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 1. 定义支付接口</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">PaymentProvider</span> {
    <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">pay</span>(<span class="hljs-title class_">String</span> orderNo, <span class="hljs-title class_">BigDecimal</span> amount);
}
<span class="hljs-comment">// 2. 支付宝实现</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AlipayProvider</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">PaymentProvider</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">pay</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> orderNo, BigDecimal amount</span>) { <span class="hljs-comment">/* 支付宝逻辑 */</span> }
}
<span class="hljs-comment">// 3. 微信支付实现（新增，无需修改原有代码）</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WechatPayProvider</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">PaymentProvider</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">pay</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> orderNo, BigDecimal amount</span>) { <span class="hljs-comment">/* 微信逻辑 */</span> }
}
<span class="hljs-comment">// 4. 核心服务依赖接口</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderPaymentService</span> {
    <span class="hljs-keyword">private</span> final <span class="hljs-title class_">PaymentProvider</span> paymentProvider;
    
    <span class="hljs-comment">// 构造函数注入，灵活切换实现</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">OrderPaymentService</span>(<span class="hljs-title class_">PaymentProvider</span> paymentProvider) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">paymentProvider</span> = paymentProvider;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">pay</span>(<span class="hljs-params">Order order</span>) {
        <span class="hljs-keyword">return</span> paymentProvider.<span class="hljs-title function_">pay</span>(order.<span class="hljs-title function_">getOrderNo</span>(), order.<span class="hljs-title function_">getAmount</span>());
    }
}
</code></pre>
<h5 data-id="heading-11">（2）配置化与插件化：避免硬编码规则</h5>
<ul>
<li>反例：将业务规则写死在代码中，修改规则需重新部署：</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DiscountService</span> {
    <span class="hljs-comment">// 硬编码：VIP折扣8折，普通用户9.5折，修改需改代码</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">BigDecimal</span> <span class="hljs-title function_">calculateDiscount</span>(<span class="hljs-params">User user</span>) {
        <span class="hljs-keyword">return</span> user.<span class="hljs-title function_">isVIP</span>() ? <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"0.8"</span>) : <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"0.95"</span>);
    }
}
</code></pre>
<ul>
<li>正例：规则配置化，修改配置无需改代码：</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. 配置文件（application.yml）</span>
discount:
  vip: <span class="hljs-number">0.8</span>
  normal: <span class="hljs-number">0.95</span>
<span class="hljs-comment">// 2. 代码读取配置</span>
<span class="hljs-meta">@ConfigurationProperties(prefix = <span class="hljs-string">"discount"</span>)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DiscountProperties</span> {
    <span class="hljs-keyword">private</span> BigDecimal vip;
    <span class="hljs-keyword">private</span> BigDecimal normal;
    <span class="hljs-comment">// getter/setter</span>
}
<span class="hljs-comment">// 3. 核心服务</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DiscountService</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> DiscountProperties discountProperties;
    
    <span class="hljs-keyword">public</span> BigDecimal calculateDiscount(User user) {
        <span class="hljs-keyword">return</span> user.isVIP() ? discountProperties.getVip() : discountProperties.getNormal();
    }
}
</code></pre>
<h5 data-id="heading-12">（3）预留扩展点：提前规划变化场景</h5>
<p>核心业务中，预判可能的变化，预留扩展接口，避免后续重构。</p>
<ul>
<li>示例：电商订单状态流转，预留 “状态变更钩子”：</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderStatusMachine</span> {
    <span class="hljs-comment">// 状态变更处理器，支持扩展不同状态的自定义逻辑</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">OrderStatus</span>, <span class="hljs-title class_">OrderStatusHandler</span>&gt; handlers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();
    
    <span class="hljs-comment">// 注册处理器（扩展点）</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">registerHandler</span>(<span class="hljs-params">OrderStatus status, OrderStatusHandler handler</span>) {
        handlers.<span class="hljs-title function_">put</span>(status, handler);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">changeStatus</span>(<span class="hljs-params">Order order, OrderStatus newStatus</span>) {
        <span class="hljs-comment">// 执行默认逻辑</span>
        order.<span class="hljs-title function_">setStatus</span>(newStatus);
        <span class="hljs-comment">// 执行扩展逻辑（如订单完成后发送通知、更新库存）</span>
        <span class="hljs-title class_">OrderStatusHandler</span> handler = handlers.<span class="hljs-title function_">get</span>(newStatus);
        <span class="hljs-keyword">if</span> (handler != <span class="hljs-literal">null</span>) {
            handler.<span class="hljs-title function_">handle</span>(order);
        }
    }
}
<span class="hljs-comment">// 扩展：订单完成后的处理逻辑</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderCompletedHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">OrderStatusHandler</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">handle</span>(<span class="hljs-params">Order order</span>) {
        <span class="hljs-comment">// 发送通知、更新库存等</span>
    }
}
</code></pre>
<h3 data-id="heading-13">四、可测试性：让代码 “能测、易测”</h3>
<p>可测试性的核心是 “能独立验证逻辑正确性”：无需依赖复杂环境，就能通过测试用例覆盖核心场景。</p>
<h4 data-id="heading-14">1. 核心原则：依赖隔离、输入输出明确、无副作用</h4>
<ul>
<li>依赖隔离：核心逻辑与外部依赖（数据库、缓存、外部接口）解耦；</li>
</ul>

<ul>
<li>输入输出明确：函数 / 方法的输入（参数）和输出（返回值）清晰，无模糊状态；</li>
</ul>

<ul>
<li>无副作用：避免修改全局变量、静态变量，相同输入始终得到相同输出（纯函数优先）。</li>
</ul>
<h4 data-id="heading-15">2. 落地方法（附反例 / 正例）</h4>
<h5 data-id="heading-16">（1）依赖注入：替换外部依赖为 Mock</h5>
<ul>
<li>反例：硬编码依赖外部服务，无法 Mock，测试困难：</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    <span class="hljs-comment">// 硬编码依赖库存服务，测试时需启动库存服务</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">StockService</span> <span class="hljs-variable">stockService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StockServiceImpl</span>();
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">createOrder</span><span class="hljs-params">(Order order)</span> {
        <span class="hljs-comment">// 扣减库存（依赖真实库存服务）</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">deductSuccess</span> <span class="hljs-operator">=</span> stockService.deduct(order.getProductId(), order.getQuantity());
        <span class="hljs-keyword">if</span> (deductSuccess) {
            <span class="hljs-comment">// 创建订单</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
}
</code></pre>
<ul>
<li>正例：构造函数注入依赖，测试时用 Mock 替换：</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> StockService stockService;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> OrderMapper orderMapper;
    
    <span class="hljs-comment">// 构造函数注入，测试时可传入Mock对象</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">OrderService</span><span class="hljs-params">(StockService stockService, OrderMapper orderMapper)</span> {
        <span class="hljs-built_in">this</span>.stockService = stockService;
        <span class="hljs-built_in">this</span>.orderMapper = orderMapper;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">createOrder</span><span class="hljs-params">(Order order)</span> {
        <span class="hljs-type">boolean</span> <span class="hljs-variable">deductSuccess</span> <span class="hljs-operator">=</span> stockService.deduct(order.getProductId(), order.getQuantity());
        <span class="hljs-keyword">if</span> (deductSuccess) {
            orderMapper.insert(order);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
}
<span class="hljs-comment">// 测试用例（Mockito）</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testCreateOrder_success</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 1. Mock依赖</span>
    <span class="hljs-type">StockService</span> <span class="hljs-variable">mockStockService</span> <span class="hljs-operator">=</span> Mockito.mock(StockService.class);
    <span class="hljs-type">OrderMapper</span> <span class="hljs-variable">mockOrderMapper</span> <span class="hljs-operator">=</span> Mockito.mock(OrderMapper.class);
    Mockito.when(mockStockService.deduct(<span class="hljs-string">"product_1001"</span>, <span class="hljs-number">2</span>)).thenReturn(<span class="hljs-literal">true</span>);
    
    <span class="hljs-comment">// 2. 初始化服务（注入Mock）</span>
    <span class="hljs-type">OrderService</span> <span class="hljs-variable">orderService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderService</span>(mockStockService, mockOrderMapper);
    
    <span class="hljs-comment">// 3. 执行测试</span>
    <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>(<span class="hljs-string">"order_2001"</span>, <span class="hljs-string">"product_1001"</span>, <span class="hljs-number">2</span>);
    <span class="hljs-type">boolean</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> orderService.createOrder(order);
    
    <span class="hljs-comment">// 4. 验证结果</span>
    Assert.assertTrue(result);
    Mockito.verify(mockStockService, Mockito.times(<span class="hljs-number">1</span>)).deduct(<span class="hljs-string">"product_1001"</span>, <span class="hljs-number">2</span>);
    Mockito.verify(mockOrderMapper, Mockito.times(<span class="hljs-number">1</span>)).insert(order);
}
</code></pre>
<h5 data-id="heading-17">（2）拆分 “纯逻辑” 与 “副作用代码”</h5>
<ul>
<li>反例：函数中混合业务逻辑与数据库操作，难以测试核心逻辑：</li>
</ul>
<pre><code class="hljs language-ini" lang="ini">public BigDecimal calculateOrderAmount(List&gt; items) {
    BigDecimal <span class="hljs-attr">amount</span> = BigDecimal.ZERO<span class="hljs-comment">;</span>
    for (OrderItem item : items) {
        // 业务逻辑：计算金额（含折扣、税费）
        BigDecimal <span class="hljs-attr">itemAmount</span> = item.getPrice().multiply(new BigDecimal(item.getQuantity()))<span class="hljs-comment">;</span>
        <span class="hljs-attr">amount</span> = amount.add(itemAmount.multiply(new BigDecimal(<span class="hljs-string">"0.98"</span>)))<span class="hljs-comment">; // 98折</span>
    }
    // 副作用：写入数据库日志（混合逻辑，测试需依赖数据库）
    orderLogMapper.insert(new OrderLog(amount))<span class="hljs-comment">;</span>
    return amount<span class="hljs-comment">;</span>
}
</code></pre>
<ul>
<li>正例：拆分纯逻辑函数（无副作用）和副作用函数，分别测试：</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 纯逻辑函数：仅计算金额，无依赖、无副作用，易测试</span>
<span class="hljs-keyword">public</span> BigDecimal <span class="hljs-title function_">calculateOrderAmount</span><span class="hljs-params">(List&lt;OrderItem&gt; items)</span> {
    <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">amount</span> <span class="hljs-operator">=</span> BigDecimal.ZERO;
    <span class="hljs-keyword">for</span> (OrderItem item : items) {
        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">itemAmount</span> <span class="hljs-operator">=</span> item.getPrice().multiply(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(item.getQuantity()));
        amount = amount.add(itemAmount.multiply(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"0.98"</span>)));
    }
    <span class="hljs-keyword">return</span> amount;
}
<span class="hljs-comment">// 副作用函数：处理数据库操作，依赖纯逻辑函数</span>
<span class="hljs-meta">@Transactional</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveOrderLog</span><span class="hljs-params">(List&lt;OrderItem&gt; items)</span> {
    <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">amount</span> <span class="hljs-operator">=</span> calculateOrderAmount(items);
    orderLogMapper.insert(<span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderLog</span>(amount));
}
<span class="hljs-comment">// 测试纯逻辑（无需任何外部依赖）</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testCalculateOrderAmount</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 准备测试数据</span>
    List&gt; items = Arrays.asList(
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderItem</span>(<span class="hljs-string">"product_1"</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"100"</span>), <span class="hljs-number">2</span>),
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderItem</span>(<span class="hljs-string">"product_2"</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"200"</span>), <span class="hljs-number">1</span>)
    );
    <span class="hljs-comment">// 执行测试</span>
    <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> calculateOrderAmount(items);
    <span class="hljs-comment">// 验证结果（100*2 + 200*1 = 400，98折后为392）</span>
    Assert.assertEquals(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"392.00"</span>), result.setScale(<span class="hljs-number">2</span>));
}
<span class="hljs-comment">// 测试副作用函数（Mock数据库依赖）</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSaveOrderLog</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// Mock依赖</span>
    <span class="hljs-type">OrderLogMapper</span> <span class="hljs-variable">mockMapper</span> <span class="hljs-operator">=</span> Mockito.mock(OrderLogMapper.class);
    <span class="hljs-type">OrderService</span> <span class="hljs-variable">orderService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderService</span>(mockStockService, mockOrderMapper, mockMapper);
    
    <span class="hljs-comment">// 准备数据</span>
    List&gt; items = Arrays.asList(<span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderItem</span>(<span class="hljs-string">"product_1"</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"100"</span>), <span class="hljs-number">1</span>));
    
    <span class="hljs-comment">// 执行测试</span>
    orderService.saveOrderLog(items);
    
    <span class="hljs-comment">// 验证：数据库日志被正确插入</span>
    Mockito.verify(mockMapper, Mockito.times(<span class="hljs-number">1</span>)).insert(
        Mockito.argThat(log -&gt; log.getAmount().equals(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"98.00"</span>)))
    );
}
</code></pre>
<h5 data-id="heading-18">（3）避免静态方法依赖：静态方法难以 Mock</h5>
<ul>
<li>反例：依赖静态工具类，测试时无法替换逻辑（如测试 “过期时间” 场景）：</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderValidator</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">validate</span>(<span class="hljs-params">Order order</span>) {
        <span class="hljs-comment">// 依赖静态方法，无法Mock“时间”相关逻辑</span>
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">DateUtils</span>.<span class="hljs-title function_">isAfterNow</span>(order.<span class="hljs-title function_">getPayTime</span>()) <span class="hljs-comment">// 静态方法：判断付款时间是否在当前之后</span>
                &amp;&amp; <span class="hljs-title class_">StringUtils</span>.<span class="hljs-title function_">isNotBlank</span>(order.<span class="hljs-title function_">getOrderNo</span>());
    }
}
</code></pre>
<ul>
<li>正例：将静态工具类封装为实例依赖，测试时可 Mock：</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 1. 封装静态工具为实例类（解耦静态依赖）</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TimeValidator</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">isAfterNow</span>(<span class="hljs-params"><span class="hljs-built_in">Date</span> date</span>) {
        <span class="hljs-keyword">return</span> date.<span class="hljs-title function_">after</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()); <span class="hljs-comment">// 底层仍可调用DateUtils，但对外提供实例方法</span>
    }
}
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StringValidator</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">isNotBlank</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> str</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">StringUtils</span>.<span class="hljs-title function_">isNotBlank</span>(str);
    }
}
<span class="hljs-comment">// 2. 依赖注入实例，而非静态方法</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderValidator</span> {
    <span class="hljs-keyword">private</span> final <span class="hljs-title class_">TimeValidator</span> timeValidator;
    <span class="hljs-keyword">private</span> final <span class="hljs-title class_">StringValidator</span> stringValidator;
    
    <span class="hljs-comment">// 构造函数注入</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">OrderValidator</span>(<span class="hljs-title class_">TimeValidator</span> timeValidator, <span class="hljs-title class_">StringValidator</span> stringValidator) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">timeValidator</span> = timeValidator;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">stringValidator</span> = stringValidator;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">validate</span>(<span class="hljs-params">Order order</span>) {
        <span class="hljs-keyword">return</span> timeValidator.<span class="hljs-title function_">isAfterNow</span>(order.<span class="hljs-title function_">getPayTime</span>()) 
                &amp;&amp; stringValidator.<span class="hljs-title function_">isNotBlank</span>(order.<span class="hljs-title function_">getOrderNo</span>());
    }
}
<span class="hljs-comment">// 3. 测试用例：Mock时间逻辑，覆盖“过期”场景</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">testValidate_fail_whenPayTimeExpired</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// Mock工具类实例</span>
    <span class="hljs-title class_">TimeValidator</span> mockTimeValidator = <span class="hljs-title class_">Mockito</span>.<span class="hljs-title function_">mock</span>(<span class="hljs-title class_">TimeValidator</span>.<span class="hljs-property">class</span>);
    <span class="hljs-title class_">StringValidator</span> mockStringValidator = <span class="hljs-title class_">Mockito</span>.<span class="hljs-title function_">mock</span>(<span class="hljs-title class_">StringValidator</span>.<span class="hljs-property">class</span>);
    
    <span class="hljs-comment">// 准备测试数据（付款时间已过期）</span>
    <span class="hljs-title class_">Order</span> order = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>(<span class="hljs-string">"order_2001"</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-title class_">System</span>.<span class="hljs-title function_">currentTimeMillis</span>() - <span class="hljs-number">3600000</span>));
    
    <span class="hljs-comment">// 设定Mock行为：模拟“付款时间已过期”</span>
    <span class="hljs-title class_">Mockito</span>.<span class="hljs-title function_">when</span>(mockTimeValidator.<span class="hljs-title function_">isAfterNow</span>(order.<span class="hljs-title function_">getPayTime</span>())).<span class="hljs-title function_">thenReturn</span>(<span class="hljs-literal">false</span>);
    <span class="hljs-title class_">Mockito</span>.<span class="hljs-title function_">when</span>(mockStringValidator.<span class="hljs-title function_">isNotBlank</span>(order.<span class="hljs-title function_">getOrderNo</span>())).<span class="hljs-title function_">thenReturn</span>(<span class="hljs-literal">true</span>);
    
    <span class="hljs-comment">// 执行测试</span>
    <span class="hljs-title class_">OrderValidator</span> validator = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderValidator</span>(mockTimeValidator, mockStringValidator);
    <span class="hljs-built_in">boolean</span> result = validator.<span class="hljs-title function_">validate</span>(order);
    
    <span class="hljs-comment">// 验证结果：验证失败</span>
    <span class="hljs-title class_">Assert</span>.<span class="hljs-title function_">assertFalse</span>(result);
}
</code></pre>
<h5 data-id="heading-19">（4）控制函数粒度：避免 “大函数”，单个函数仅做一件事</h5>
<ul>
<li>反例：一个函数包含参数校验、业务计算、外部调用，测试场景极多：</li>
</ul>
<pre><code class="hljs language-scss" lang="scss">public boolean <span class="hljs-built_in">processOrder</span>(OrderDTO orderDTO) {
    <span class="hljs-comment">// 1. 参数校验</span>
    if (orderDTO == null || StringUtils.isBlank(orderDTO.getProductId()) || orderDTO<span class="hljs-selector-class">.getQuantity</span>() 
        return false;
    }
    <span class="hljs-comment">// 2. 业务计算：转换DTO为PO</span>
    <span class="hljs-attribute">Order</span> <span class="hljs-attribute">order</span> = new <span class="hljs-attribute">Order</span>();
    <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setOrderNo</span>(UUID.randomUUID()<span class="hljs-selector-class">.toString</span>());
    <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setProductId</span>(orderDTO.getProductId());
    <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setQuantity</span>(orderDTO.getQuantity());
    <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setAmount</span>(orderDTO.getPrice()<span class="hljs-selector-class">.multiply</span>(new BigDecimal(orderDTO.getQuantity())));
    <span class="hljs-comment">// 3. 外部调用：扣减库存</span>
    boolean deductSuccess = stockService<span class="hljs-selector-class">.deduct</span>(orderDTO.getProductId(), orderDTO<span class="hljs-selector-class">.getQuantity</span>());
    if (!deductSuccess) {
        return false;
    }
    <span class="hljs-comment">// 4. 持久化：保存订单</span>
    orderMapper<span class="hljs-selector-class">.insert</span>(order);
    return true;
}
</code></pre>
<ul>
<li>正例：拆分为多个小函数，每个函数职责单一，单独测试：</li>
</ul>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 1. 参数校验函数</span>
public boolean <span class="hljs-built_in">validateOrderDTO</span>(OrderDTO orderDTO) {
    return orderDTO != null 
            &amp;&amp; StringUtils<span class="hljs-selector-class">.isNotBlank</span>(orderDTO.getProductId()) 
            &amp;&amp; orderDTO<span class="hljs-selector-class">.getQuantity</span>() &gt; <span class="hljs-number">0</span>;
}
<span class="hljs-comment">// 2. DTO转PO函数（纯逻辑）</span>
public <span class="hljs-attribute">Order</span> <span class="hljs-built_in">convertToOrder</span>(OrderDTO orderDTO) {
    <span class="hljs-attribute">Order</span> <span class="hljs-attribute">order</span> = new <span class="hljs-attribute">Order</span>();
    <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setOrderNo</span>(UUID.randomUUID()<span class="hljs-selector-class">.toString</span>());
    <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setProductId</span>(orderDTO.getProductId());
    <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setQuantity</span>(orderDTO.getQuantity());
    <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setAmount</span>(orderDTO.getPrice()<span class="hljs-selector-class">.multiply</span>(new BigDecimal(orderDTO.getQuantity())));
    return <span class="hljs-attribute">order</span>;
}
<span class="hljs-comment">// 3. 核心流程函数（组合小函数）</span>
public boolean <span class="hljs-built_in">processOrder</span>(OrderDTO orderDTO) {
    <span class="hljs-comment">// 校验</span>
    if (!validateOrderDTO(orderDTO)) {
        return false;
    }
    <span class="hljs-comment">// 转换</span>
    <span class="hljs-attribute">Order</span> <span class="hljs-attribute">order</span> = <span class="hljs-built_in">convertToOrder</span>(orderDTO);
    <span class="hljs-comment">// 扣减库存</span>
    boolean deductSuccess = stockService<span class="hljs-selector-class">.deduct</span>(orderDTO.getProductId(), orderDTO<span class="hljs-selector-class">.getQuantity</span>());
    if (!deductSuccess) {
        return false;
    }
    <span class="hljs-comment">// 保存订单</span>
    orderMapper<span class="hljs-selector-class">.insert</span>(order);
    return true;
}
<span class="hljs-comment">// 测试：单独测试参数校验（无需依赖其他服务）</span>
<span class="hljs-keyword">@Test</span>
public void testValidateOrderDTO_fail_whenQuantityZero() {
    OrderDTO orderDTO = new <span class="hljs-built_in">OrderDTO</span>("product_1001", new BigDecimal("<span class="hljs-number">100</span>"), <span class="hljs-number">0</span>);
    boolean result = <span class="hljs-built_in">validateOrderDTO</span>(orderDTO);
    Assert<span class="hljs-selector-class">.assertFalse</span>(result);
}
<span class="hljs-comment">// 测试：单独测试DTO转PO（纯逻辑，无依赖）</span>
<span class="hljs-keyword">@Test</span>
public void testConvertToOrder() {
    OrderDTO orderDTO = new <span class="hljs-built_in">OrderDTO</span>("product_1001", new BigDecimal("<span class="hljs-number">100</span>"), <span class="hljs-number">2</span>);
    <span class="hljs-attribute">Order</span> <span class="hljs-attribute">order</span> = <span class="hljs-built_in">convertToOrder</span>(orderDTO);
    Assert<span class="hljs-selector-class">.assertEquals</span>("product_1001", order.getProductId());
    Assert<span class="hljs-selector-class">.assertEquals</span>(new BigDecimal("<span class="hljs-number">200.00</span>"), <span class="hljs-attribute">order</span><span class="hljs-selector-class">.getAmount</span>()<span class="hljs-selector-class">.setScale</span>(<span class="hljs-number">2</span>));
}
</code></pre>
<h5 data-id="heading-20">（5）避免全局状态：全局变量会导致测试相互干扰</h5>
<ul>
<li>反例：使用静态变量（全局状态）存储业务数据，测试用例执行顺序会影响结果，导致测试不稳定：</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    <span class="hljs-comment">// 全局静态变量：存储已处理的订单数（所有实例共享）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">processedCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">processOrder</span><span class="hljs-params">(Order order)</span> {
        <span class="hljs-comment">// 业务逻辑：保存订单</span>
        orderMapper.insert(order);
        processedCount++; <span class="hljs-comment">// 修改全局状态，所有实例共享该值</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getProcessedCount</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> processedCount;
    }
}
<span class="hljs-comment">// 测试用例1：执行后会修改全局状态</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testProcessOrder_case1</span><span class="hljs-params">()</span> {
    <span class="hljs-type">OrderService</span> <span class="hljs-variable">service</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderService</span>();
    service.processOrder(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>(<span class="hljs-string">"order_001"</span>));
    Assert.assertEquals(<span class="hljs-number">1</span>, service.getProcessedCount()); <span class="hljs-comment">// 预期1，执行通过</span>
}
<span class="hljs-comment">// 测试用例2：依赖测试用例1的执行结果，顺序变了就失败</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testProcessOrder_case2</span><span class="hljs-params">()</span> {
    <span class="hljs-type">OrderService</span> <span class="hljs-variable">service</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderService</span>();
    service.processOrder(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>(<span class="hljs-string">"order_002"</span>));
    <span class="hljs-comment">// 若先执行case2，预期2但实际是1；若先执行case1，预期2但实际是2——测试结果不稳定</span>
    Assert.assertEquals(<span class="hljs-number">2</span>, service.getProcessedCount()); 
}
</code></pre>
<p>问题本质：全局状态是 “共享资源”，多个测试用例修改同一状态会导致 “测试污染”，测试结果依赖执行顺序，无法保证可靠性。</p>
<ul>
<li>正例：去掉全局静态变量，改用 “实例变量” 或 “状态上下文”，每个实例独立持有状态：</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    <span class="hljs-comment">// 实例变量：每个服务实例单独持有状态，不共享</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">processedCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> OrderMapper orderMapper;
    
    <span class="hljs-comment">// 构造函数注入依赖</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">OrderService</span><span class="hljs-params">(OrderMapper orderMapper)</span> {
        <span class="hljs-built_in">this</span>.orderMapper = orderMapper;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">processOrder</span><span class="hljs-params">(Order order)</span> {
        orderMapper.insert(order);
        processedCount++; <span class="hljs-comment">// 仅修改当前实例的状态，不影响其他实例</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getProcessedCount</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> processedCount;
    }
}
<span class="hljs-comment">// 测试用例1：独立实例，状态隔离</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testProcessOrder_case1</span><span class="hljs-params">()</span> {
    <span class="hljs-type">OrderMapper</span> <span class="hljs-variable">mockMapper</span> <span class="hljs-operator">=</span> Mockito.mock(OrderMapper.class);
    <span class="hljs-type">OrderService</span> <span class="hljs-variable">service1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderService</span>(mockMapper); <span class="hljs-comment">// 实例1</span>
    service1.processOrder(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>(<span class="hljs-string">"order_001"</span>));
    Assert.assertEquals(<span class="hljs-number">1</span>, service1.getProcessedCount()); <span class="hljs-comment">// 稳定通过</span>
}
<span class="hljs-comment">// 测试用例2：独立实例，与case1状态互不干扰</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testProcessOrder_case2</span><span class="hljs-params">()</span> {
    <span class="hljs-type">OrderMapper</span> <span class="hljs-variable">mockMapper</span> <span class="hljs-operator">=</span> Mockito.mock(OrderMapper.class);
    <span class="hljs-type">OrderService</span> <span class="hljs-variable">service2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderService</span>(mockMapper); <span class="hljs-comment">// 实例2</span>
    service2.processOrder(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>(<span class="hljs-string">"order_002"</span>));
    Assert.assertEquals(<span class="hljs-number">1</span>, service2.getProcessedCount()); <span class="hljs-comment">// 稳定通过，与执行顺序无关</span>
}
</code></pre>
<ul>
<li>进阶场景：若确实需要 “共享状态”（如统计全系统订单数），应通过 “外部存储”（如数据库、Redis）而非内存全局变量：</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">OrderStatisticService</span> {
    <span class="hljs-keyword">private</span> final RedisTemplate&gt; redisTemplate;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> final String KEY = <span class="hljs-string">"order:processed:count"</span>;
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">OrderStatisticService</span>(<span class="hljs-params">RedisTemplateTemplate</span>)</span> {
        <span class="hljs-keyword">this</span>.redisTemplate = redisTemplate;
    }
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">incrementCount</span>()</span> {
        <span class="hljs-comment">// 用Redis原子操作记录状态，测试时可Mock Redis</span>
        redisTemplate.opsForValue().increment(KEY, <span class="hljs-number">1</span>);
    }
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">getCount</span>()</span> {
        <span class="hljs-keyword">return</span> redisTemplate.opsForValue().<span class="hljs-keyword">get</span>(KEY);
    }
}
<span class="hljs-comment">// 测试用例：Mock Redis，隔离外部依赖</span>
@Test
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testIncrementCount</span>()</span> {
    RedisTemplateRedis = Mockito.mock(RedisTemplate.<span class="hljs-keyword">class</span>);
    ValueOperations&gt; mockOps = Mockito.mock(ValueOperations.<span class="hljs-keyword">class</span>);
    Mockito.<span class="hljs-keyword">when</span>(mockRedis.opsForValue()).thenReturn(mockOps);
    Mockito.<span class="hljs-keyword">when</span>(mockOps.increment(KEY, <span class="hljs-number">1</span>)).thenReturn(<span class="hljs-number">1</span>);
    
    OrderStatisticService service = <span class="hljs-keyword">new</span> OrderStatisticService(mockRedis);
    service.incrementCount();
    
    Mockito.verify(mockOps, Mockito.times(<span class="hljs-number">1</span>)).increment(KEY, <span class="hljs-number">1</span>);
    Assert.assertEquals(<span class="hljs-number">1</span>, service.getCount().intValue());
}
</code></pre>
<h4 data-id="heading-21">3. 可测试性常见误区</h4>






























<table><thead><tr><th>误区</th><th>后果</th><th>修正方案</th></tr></thead><tbody><tr><td>依赖全局静态变量 / 单例（无注入）</td><td>测试用例相互污染，结果不稳定</td><td>改用实例变量，单例通过依赖注入暴露</td></tr><tr><td>函数返回 void，无输出</td><td>无法验证函数执行效果</td><td>让函数返回执行结果（如布尔值、状态对象），或通过 Mock 验证副作用</td></tr><tr><td>业务逻辑与 HTTP 请求 / 响应强耦合</td><td>测试需启动 Web 容器，效率低</td><td>拆分 Controller 与 Service，Service 层纯业务逻辑无 Web 依赖</td></tr><tr><td>测试用例依赖真实数据库 / 缓存</td><td>测试环境要求高，执行慢</td><td>用 H2 内存数据库、Mock 工具（Mockito、TestContainers）隔离外部依赖</td></tr></tbody></table>
<h3 data-id="heading-22">五、三者协同：如何平衡 “可维护性、可扩展性、可测试性”</h3>
<p>很多开发者会陷入 “过度设计” 的误区：为了追求某一个特性，导致代码复杂度飙升（比如为了可扩展性，设计十几层抽象）。核心原则是 “适度设计，按需优化”：</p>
<h4 data-id="heading-23">1. 协同关系：一个良性循环</h4>
<ul>
<li>可维护性是基础：模块化、命名清晰的代码，自然更容易拆分扩展点、隔离依赖（提升可扩展性和可测试性）；</li>
</ul>

<ul>
<li>可测试性是保障：写测试的过程会倒逼你拆分耦合、明确输入输出（反过来优化可维护性和可扩展性）；</li>
</ul>

<ul>
<li>可扩展性是目标：基于前两者，代码才能 “低成本应对变化”，避免频繁重构。</li>
</ul>
<h4 data-id="heading-24">2. 平衡技巧</h4>
<ul>
<li>核心业务：重点优化三者，采用接口抽象、依赖注入、模块化拆分（如支付、订单核心流程）；</li>
</ul>

<ul>
<li>非核心业务：优先保证可维护性，无需过度设计可扩展性（如内部工具、临时报表功能）；</li>
</ul>

<ul>
<li>迭代优化：初期无需追求 “完美设计”，先实现核心功能，后续通过重构逐步优化（如先写简单实现，有扩展需求时再抽象接口）。</li>
</ul>
<h3 data-id="heading-25">六、总结：写出 “三优代码” 的核心心法</h3>
<p>可维护性、可扩展性、可测试性，本质都是 “降低代码的认知成本和修改成本”。落地的关键不是死记设计模式，而是记住三个核心：</p>
<ol>
<li><strong>拆分</strong>：按职责拆分模块、函数，拒绝 “大泥球代码”；</li>
</ol>

<ol start="2">
<li><strong>解耦</strong>：依赖抽象而非具体实现，隔离外部依赖和核心逻辑；</li>
</ol>

<ol start="3">
<li><strong>简洁</strong>：避免过度设计，用最少的代码实现核心功能，让代码 “一眼能看懂”。</li>
</ol>
<p>优秀的后端代码，经得起业务迭代的考验，也经得起时间的考验 —— 这不仅是技术能力的体现，更是对团队和未来自己的负责。从今天开始，试着在写代码时多问自己三个问题：</p>
<ul>
<li>别人能快速看懂我的代码吗？（可维护性）</li>
</ul>

<ul>
<li>新增需求时我需要改多少代码？（可扩展性）</li>
</ul>

<ul>
<li>我能轻松写出测试用例覆盖核心场景吗？（可测试性）</li>
</ul>
<p>坚持下去，你的编码能力会在潜移默化中实现质的飞跃。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[开箱即用的 GoWind Admin｜风行，企业级前后端一体中后台框架：深度解析 Wire 依赖注入集成实践]]></title>    <link>https://juejin.cn/post/7583943503556722738</link>    <guid>https://juejin.cn/post/7583943503556722738</guid>    <pubDate>2025-12-16T02:30:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583943503556722738" data-draft-id="7583981974407954442" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="开箱即用的 GoWind Admin｜风行，企业级前后端一体中后台框架：深度解析 Wire 依赖注入集成实践"/> <meta itemprop="keywords" content="后端,Go"/> <meta itemprop="datePublished" content="2025-12-16T02:30:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="喵个咪"/> <meta itemprop="url" content="https://juejin.cn/user/1350630784901262"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            开箱即用的 GoWind Admin｜风行，企业级前后端一体中后台框架：深度解析 Wire 依赖注入集成实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1350630784901262/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    喵个咪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:30:05.000Z" title="Tue Dec 16 2025 02:30:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">开箱即用的 GoWind Admin｜风行，企业级前后端一体中后台框架：深度解析 Wire 依赖注入集成实践</h2>
<p>在企业级中后台框架开发中，依赖管理是贯穿全生命周期的核心挑战 —— 随着项目规模扩张，手动创建对象、传递依赖会导致代码耦合度陡增、测试成本居高不下、维护难度指数级上升。依赖注入（DI）通过 “控制反转” 机制，将对象的创建与依赖传递解耦，成为解决这一问题的最优解之一。本文以 GoWind Admin（风行）框架为实践载体，深度解析 Google 开源的编译期依赖注入工具 Wire，并完整呈现其在企业级中后台框架中的标准化集成方案。</p>
<h3 data-id="heading-1">一、基础认知：什么是依赖注入（DI）？</h3>
<p>依赖注入（Dependency Injection，DI）是实现控制反转（IoC）的核心技术，其核心思想可概括为：<strong>对象的依赖由外部容器提供，而非对象自身创建</strong>。这里的 “依赖” 指对象运行所需的其他组件（如数据库连接、配置实例、业务服务等），“注入” 则是外部容器将依赖主动传递给目标对象的过程。</p>
<p>通过依赖注入，使用依赖的对象（客户）无需关心依赖的创建细节，仅需依赖统一的接口契约；依赖的创建、组装、传递全由注入器（容器）负责。这不仅减少了 <code>new</code> 关键字的直接使用，更实现了代码的解耦、可测试性与可维护性的大幅提升。</p>
<h4 data-id="heading-2">1.1 依赖注入的核心四要素</h4>
<ul>
<li><strong>服务（Service）</strong>：提供具体功能的对象（如数据库连接池、用户仓储实例），是被依赖的一方。</li>
<li><strong>客户（Client）</strong>：使用服务的对象（如业务逻辑服务），是依赖的接收方。</li>
<li><strong>接口（Interface）</strong>：客户与服务之间的契约，客户仅依赖接口而非具体实现，保证了依赖的抽象性。</li>
<li><strong>注入器（Injector）</strong>：也称容器、装配器，负责管理服务的创建、依赖关系的解析，并将服务注入到客户中。</li>
</ul>
<h4 data-id="heading-3">1.2 Go 语言中的依赖注入框架对比</h4>
<p>Go 生态中主流的依赖注入框架分为两类，核心差异在于“依赖解析时机”：</p>


























<table><thead><tr><th>类型</th><th>代表工具</th><th>核心原理</th><th>优势</th><th>劣势</th></tr></thead><tbody><tr><td>运行时注入</td><td>Uber dig</td><td>反射机制动态解析</td><td>功能灵活，支持复杂依赖场景</td><td>反射带来性能损耗；依赖错误仅运行时暴露</td></tr><tr><td>编译期注入</td><td>Google Wire</td><td>代码生成静态解析</td><td>无反射开销；编译期暴露错误；代码可读性高</td><td>功能相对精简；需遵循固定规范</td></tr></tbody></table>
<blockquote>
<p>GoWind Admin 选择 Wire 作为核心依赖注入方案的核心原因：中后台系统对稳定性要求极高，编译期错误检测可最大程度规避线上故障；同时 Wire 简洁的设计符合框架 “轻量、易用、可扩展” 的核心定位。</p>
</blockquote>
<h3 data-id="heading-4">二、Wire 核心概念：Provider 与 Injector</h3>
<p>Wire 摒弃了复杂的运行时机制，核心通过两个概念实现依赖注入：<strong>Provider（提供者）</strong> 和 <strong>Injector（注入器）</strong>。可以简单理解为：Provider 负责“生产”依赖对象，Injector 负责“组装”依赖关系。</p>
<h4 data-id="heading-5">2.1 Provider：依赖对象的“生产者”</h4>
<p>Provider 本质是一个普通的 Go 函数，用于创建并返回某个对象（即“服务”），我们可以将其理解为对象的“构造函数”。Wire 会通过 Provider 函数的参数列表解析其依赖，通过返回值确定其提供的服务类型。</p>
<h5 data-id="heading-6">2.1.1 基础 Provider 示例</h5>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> data

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"database/sql"</span>
    <span class="hljs-string">"github.com/go-sql-driver/mysql"</span>
)

<span class="hljs-comment">// Config 数据库配置结构体</span>
<span class="hljs-keyword">type</span> Config <span class="hljs-keyword">struct</span> {
    DSN <span class="hljs-type">string</span>
}

<span class="hljs-comment">// UserStore 用户数据存储服务</span>
<span class="hljs-keyword">type</span> UserStore <span class="hljs-keyword">struct</span> {
    cfg *Config
    db  *sql.DB
}

<span class="hljs-comment">// NewUserStore 是 *UserStore 的 Provider</span>
<span class="hljs-comment">// 依赖：*Config（配置）、*sql.DB（数据库连接）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewUserStore</span><span class="hljs-params">(cfg *Config, db *sql.DB)</span></span> (*UserStore, <span class="hljs-type">error</span>) {
    <span class="hljs-keyword">return</span> &amp;UserStore{cfg: cfg, db: db}, <span class="hljs-literal">nil</span>
}

<span class="hljs-comment">// NewDefaultConfig 是 *Config 的 Provider（无依赖）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewDefaultConfig</span><span class="hljs-params">()</span></span> *Config {
    <span class="hljs-keyword">return</span> &amp;Config{
        DSN: <span class="hljs-string">"root:123456@tcp(127.0.0.1:3306)/test?parseTime=true"</span>,
    }
}

<span class="hljs-comment">// NewDB 是 *sql.DB 的 Provider</span>
<span class="hljs-comment">// 依赖：*Config（从配置中获取 DSN）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewDB</span><span class="hljs-params">(cfg *Config)</span></span> (*sql.DB, <span class="hljs-type">error</span>) {
    <span class="hljs-keyword">return</span> sql.Open(<span class="hljs-string">"mysql"</span>, cfg.DSN)
}
</code></pre>
<h5 data-id="heading-7">2.1.2 ProviderSet：依赖的“集合封装”</h5>
<p>当项目中存在多个关联的 Provider 时，可通过 wire.NewSet 将其组合为 ProviderSet（提供者集合），便于统一管理和复用。ProviderSet 支持嵌套，即一个 ProviderSet 可包含其他 ProviderSet。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> data

<span class="hljs-keyword">import</span> <span class="hljs-string">"github.com/google/wire"</span>

<span class="hljs-comment">// ProviderSet 数据层的 Provider 集合</span>
<span class="hljs-keyword">var</span> ProviderSet = wire.NewSet(
    NewUserStore,   <span class="hljs-comment">// 提供 *UserStore</span>
    NewDefaultConfig, <span class="hljs-comment">// 提供 *Config</span>
    NewDB,          <span class="hljs-comment">// 提供 *sql.DB</span>
)

<span class="hljs-comment">// 其他包的 ProviderSet 示例（可嵌套）</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">"go-wind-admin/app/admin/service/internal/cache/providers"</span>

<span class="hljs-keyword">var</span> FullProviderSet = wire.NewSet(
    ProviderSet,          <span class="hljs-comment">// 嵌套当前包的 ProviderSet</span>
    providers.CacheSet,   <span class="hljs-comment">// 嵌套缓存层的 ProviderSet</span>
)
</code></pre>
<blockquote>
<p><strong>核心说明</strong>：<code>wire.NewSet</code> 仅用于“归类”Provider，不执行任何逻辑。其返回值可作为其他 <code>wire.NewSet</code> 的参数，实现依赖的模块化管理。</p>
</blockquote>
<h4 data-id="heading-8">2.2 Injector：依赖关系的“组装器”</h4>
<p>Injector 是 Wire 生成的“依赖组装函数”，负责按依赖顺序调用 Provider 函数，创建并注入所需对象。我们只需定义 Injector 的“函数签名”，Wire 会通过 <code>wire.Build</code> 声明的 Provider/ProviderSet 自动生成完整的组装逻辑。</p>
<h5 data-id="heading-9">2.2.1 定义 Injector 签名</h5>
<p>创建 <code>wire.go</code> 文件，通过特殊构建标签（<code>//go:build wireinject</code>）标记该文件仅用于生成 Injector，不会被编译到最终产物中。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">//go:build wireinject</span>
<span class="hljs-comment">// +build wireinject</span>

<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"github.com/google/wire"</span>
    <span class="hljs-string">"go-wind-admin/app/admin/service/internal/data"</span>
)

<span class="hljs-comment">// InitUserStore 是 Injector 函数的签名</span>
<span class="hljs-comment">// 入参：无（若有依赖可在此声明）</span>
<span class="hljs-comment">// 出参：*data.UserStore（最终需要的服务）、error（错误处理）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">InitUserStore</span><span class="hljs-params">()</span></span> (*data.UserStore, <span class="hljs-type">error</span>) {
    <span class="hljs-comment">// wire.Build 声明组装所需的 ProviderSet</span>
    wire.Build(data.ProviderSet)
    <span class="hljs-comment">// 占位返回值（生成代码时会被替换）</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, <span class="hljs-literal">nil</span>
}
</code></pre>
<h5 data-id="heading-10">2.2.2 生成 Injector 代码</h5>
<p>在 <code>wire.go</code> 所在目录执行 wire 命令（需先通过 <code>go install github.com/google/wire/cmd/wire@latest</code> 安装 Wire 工具），Wire 会自动分析依赖关系，生成 wire_gen.go 文件，其中包含完整的 Injector 实现：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// Code generated by Wire. DO NOT EDIT.</span>

<span class="hljs-comment">//go:generate go run github.com/google/wire/cmd/wire</span>
<span class="hljs-comment">//go:build !wireinject</span>
<span class="hljs-comment">// +build !wireinject</span>

<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"go-wind-admin/app/admin/service/internal/data"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">InitUserStore</span><span class="hljs-params">()</span></span> (*data.UserStore, <span class="hljs-type">error</span>) {
    config := data.NewDefaultConfig()
    db, err := data.NewDB(config)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }
    userStore, err := data.NewUserStore(config, db)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }
    <span class="hljs-keyword">return</span> userStore, <span class="hljs-literal">nil</span>
}
</code></pre>
<p>生成的代码完全模拟了手动创建对象的流程，清晰可见依赖的创建顺序（先创建 Config → 再创建 DB → 最后创建 UserStore），且包含完整的错误处理，可读性极强。</p>
<h3 data-id="heading-11">三、GoWind Admin 集成 Wire 完整实践</h3>
<p>GoWind Admin 采用 “Server 层（服务暴露）→ Service 层（业务逻辑）→ Data 层（数据访问）” 的分层架构，为避免依赖混乱，框架将各层的 Provider 单独封装在 <code>providers</code> 目录中，最终在入口处通过 Injector 统一组装。</p>
<h4 data-id="heading-12">3.1 架构设计：分层 ProviderSet 目录结构</h4>
<p>核心设计原则：<strong>每层的 ProviderSet 单独放在同级的 providers 目录中</strong>，实现业务代码与 DI 配置解耦，从物理结构上杜绝循环依赖。</p>
<p>标准目录结构如下：</p>
<pre><code class="hljs language-shell" lang="shell">internal/
├── data/                  // 数据层（仓储、数据库操作）
│   ├── user_repo.go       // 业务代码：用户仓储实现
│   └── providers/
│       └── wire_set.go    // 数据层 ProviderSet（仅 DI 配置）
├── service/               // 服务层（业务逻辑）
│   ├── user_service.go    // 业务代码：用户服务实现
│   └── providers/
│       └── wire_set.go    // 服务层 ProviderSet
└── server/                // 服务暴露层（HTTP/gRPC 服务器）
    ├── http_server.go     // 业务代码：HTTP 服务器实现
    └── providers/
        └── wire_set.go    // 服务器层 ProviderSet
cmd/
└── server/
    └── wire.go            // 全局 Injector 入口（组装所有层依赖）
</code></pre>
<h4 data-id="heading-13">3.2 各层 ProviderSet 实现</h4>
<p>每层的 <code>wire_set.go</code> 仅负责封装当前层的 Provider，不包含任何业务逻辑，确保业务代码的纯粹性。</p>
<h5 data-id="heading-14">3.2.1 数据层（data/providers/wire_set.go）</h5>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">//go:build wireinject</span>
<span class="hljs-comment">// +build wireinject</span>

<span class="hljs-keyword">package</span> providers

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"github.com/google/wire"</span>

    <span class="hljs-string">"go-wind-admin/app/admin/service/internal/data"</span>
)

<span class="hljs-comment">// ProviderSet 数据层依赖注入集合</span>
<span class="hljs-comment">// 包含所有数据层的仓储 Provider</span>
<span class="hljs-keyword">var</span> ProviderSet = wire.NewSet(
    data.NewUserRepo,   <span class="hljs-comment">// 用户仓储 Provider（依赖 *sql.DB）</span>
    data.NewOrderRepo,  <span class="hljs-comment">// 订单仓储 Provider（依赖 *sql.DB）</span>
    data.NewDB,         <span class="hljs-comment">// 数据库连接 Provider（依赖 *Config）</span>
    data.NewConfig,     <span class="hljs-comment">// 配置 Provider（无依赖）</span>
)
</code></pre>
<h5 data-id="heading-15">3.2.2 服务层（service/providers/wire_set.go）</h5>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">//go:build wireinject</span>
<span class="hljs-comment">// +build wireinject</span>

<span class="hljs-keyword">package</span> providers

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"github.com/google/wire"</span>

    <span class="hljs-string">"go-wind-admin/app/admin/service/internal/service"</span>
)

<span class="hljs-comment">// ProviderSet 服务层依赖注入集合</span>
<span class="hljs-comment">// 依赖数据层的 ProviderSet，提供业务服务</span>
<span class="hljs-keyword">var</span> ProviderSet = wire.NewSet(
    service.NewUserService,  <span class="hljs-comment">// 用户服务（依赖 data.UserRepo）</span>
    service.NewOrderService, <span class="hljs-comment">// 订单服务（依赖 data.OrderRepo）</span>
)
</code></pre>
<h5 data-id="heading-16">3.2.3 服务器层（server/providers/wire_set.go）</h5>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">//go:build wireinject</span>
<span class="hljs-comment">// +build wireinject</span>

<span class="hljs-keyword">package</span> providers

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"github.com/google/wire"</span>

    <span class="hljs-string">"go-wind-admin/app/admin/service/internal/server"</span>
)

<span class="hljs-comment">// ProviderSet 服务器层依赖注入集合</span>
<span class="hljs-comment">// 依赖服务层的 ProviderSet，提供 HTTP/gRPC 服务器</span>
<span class="hljs-keyword">var</span> ProviderSet = wire.NewSet(
    server.NewHTTPServer,  <span class="hljs-comment">// HTTP 服务器（依赖 service.UserService）</span>
    server.NewGRPCServer,  <span class="hljs-comment">// gRPC 服务器（依赖 service.OrderService）</span>
)
</code></pre>
<h5 data-id="heading-17">3.2.4 ProviderSet 嵌套层级结构</h5>
<p>在企业级项目中，依赖往往复杂且多层级，通过 “原子级 → 模块聚合级 → 应用级” 的嵌套结构，可实现依赖的精细化管理。</p>
<blockquote>
<p>设计价值：分层嵌套可让依赖关系 “可视化”，新增 / 移除依赖时只需调整对应层级的 Set，无需修改全局配置，符合 “开闭原则”。</p>
</blockquote>
<h6 data-id="heading-18">第一层：原子级（Leaf Sets）—— 最小粒度依赖</h6>
<p>在每个逻辑子目录定义，仅包含单一功能的 Provider：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// internal/data/providers/wire_set.go</span>

<span class="hljs-comment">// RepoSet 仓储层原子依赖（仅仓储相关）</span>
<span class="hljs-keyword">var</span> RepoSet = wire.NewSet(NewUserRepo, NewOrderRepo)
<span class="hljs-comment">// CacheSet 缓存层原子依赖（仅缓存相关）</span>
<span class="hljs-keyword">var</span> CacheSet = wire.NewSet(NewRedisClient, NewMemcachedClient)
</code></pre>
<h6 data-id="heading-19">第二层：模块聚合级（Module Sets）—— 层级总入口</h6>
<p>将同一层的多个原子级 Set 聚合成一个总 Set，作为该层的统一出口：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 仍在 internal/data/providers/wire_set.go 中</span>
<span class="hljs-comment">// ProviderSet 数据层总依赖集合（对外暴露的唯一入口）</span>
<span class="hljs-keyword">var</span> ProviderSet = wire.NewSet(RepoSet, CacheSet)
</code></pre>
<h6 data-id="heading-20">第三层：应用级（App Set）—— 全局组装</h6>
<p>在最终的 <code>wire.go</code> 中，仅聚合各层的 “总出口”，避免依赖混乱：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// app/admin/service/cmd/server/wire.go</span>
wire.Build(
    dataProviders.ProviderSet,    <span class="hljs-comment">// 数据层总依赖（含仓储+缓存）</span>
    serviceProviders.ProviderSet, <span class="hljs-comment">// 服务层总依赖（含所有业务服务）</span>
    serverProviders.ProviderSet,  <span class="hljs-comment">// 服务器层总依赖（含HTTP/gRPC）</span>
)
</code></pre>
<h4 data-id="heading-21">3.3 全局 Injector 入口（cmd/server/wire.go）</h4>
<p>入口文件负责组装所有层的 ProviderSet，生成最终的应用实例（如 Kratos 应用）。这里以 GoWind Admin 基于 Kratos 框架的实现为例：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">//go:build wireinject</span>
<span class="hljs-comment">// +build wireinject</span>

<span class="hljs-comment">//go:generate go run github.com/google/wire/cmd/wire</span>

<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"github.com/google/wire"</span>

    <span class="hljs-string">"github.com/go-kratos/kratos/v2"</span>
    <span class="hljs-string">"github.com/go-kratos/kratos/v2/log"</span>
    <span class="hljs-string">"github.com/go-kratos/kratos/v2/registry"</span>

    conf <span class="hljs-string">"github.com/tx7do/kratos-bootstrap/api/gen/go/conf/v1"</span>

    serverProviders <span class="hljs-string">"go-wind-admin/app/admin/service/internal/server/providers"</span>
    serviceProviders <span class="hljs-string">"go-wind-admin/app/admin/service/internal/service/providers"</span>
    dataProviders <span class="hljs-string">"go-wind-admin/app/admin/service/internal/data/providers"</span>
)

<span class="hljs-comment">// initApp 全局 Injector 签名（声明应用实例的依赖与输出）</span>
<span class="hljs-comment">// 入参：框架基础组件（日志、注册器、配置）；出参：应用实例 + 资源清理函数 + 错误</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">initApp</span><span class="hljs-params">(logger log.Logger, reg registry.Registrar, cfg *conf.Bootstrap)</span></span> (*kratos.App, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span>, <span class="hljs-type">error</span>) {
    <span class="hljs-built_in">panic</span>(
        wire.Build(
            serverProviders.ProviderSet, <span class="hljs-comment">// 服务器层 ProviderSet</span>
            serviceProviders.ProviderSet, <span class="hljs-comment">// 服务层 ProviderSet</span>
            dataProviders.ProviderSet, <span class="hljs-comment">// 数据库层 ProviderSet</span>
            newApp, <span class="hljs-comment">// 应用实例构造函数（依赖 HTTP/gRPC 服务器）</span>
        ),
    )
}
</code></pre>
<h4 data-id="heading-22">3.4 生成并使用 Injector</h4>
<h5 data-id="heading-23">3.4.1 安装 Wire 工具：</h5>
<pre><code class="hljs language-shell" lang="shell">go install github.com/google/wire/cmd/wire@latest
</code></pre>
<h5 data-id="heading-24">3.4.2 生成 Injector 代码：</h5>
<p>生成代码有三种方法：</p>
<ol>
<li>在<code>cmd/app</code> 目录执行 <code>wire</code> 命令；</li>
<li>执行<code>go generate ./...</code>命令；</li>
<li>在<code>app/admin/service</code>目录下执行<code>make wire</code>。</li>
</ol>
<p>执行后会生成 <code>wire_gen.go</code> 文件，包含完整的应用组装逻辑。</p>
<h5 data-id="heading-25">3.4.3 在应用启动流程中调用 Injector：</h5>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"github.com/go-kratos/kratos/v2/log"</span>
    <span class="hljs-string">"github.com/go-kratos/kratos/v2/registry/nacos"</span>

    <span class="hljs-string">"github.com/nacos-group/nacos-sdk-go/clients"</span>
    <span class="hljs-string">"github.com/nacos-group/nacos-sdk-go/common/constant"</span>
    <span class="hljs-string">"github.com/nacos-group/nacos-sdk-go/vo"</span>

    conf <span class="hljs-string">"github.com/tx7do/kratos-bootstrap/api/gen/go/conf/v1"</span>

    <span class="hljs-string">"go-wind-admin/app/admin/service/internal/bootstrap"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 1. 初始化配置、日志、服务注册器（框架基础组件）</span>
    cfg := bootstrap.InitConfig()
    logger := bootstrap.InitLogger(cfg)
    reg := nacos.New(cfg.Nacos.Addrs, nacos.WithClientConfig(&amp;constant.ClientConfig{
        NamespaceId: cfg.Nacos.NamespaceId,
    }))

    <span class="hljs-comment">// 2. 调用 Wire 生成的 Injector，创建应用实例</span>
    app, cleanup, err := initApp(logger, reg, cfg)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        log.Fatalf(<span class="hljs-string">"failed to init app: %v"</span>, err)
    }
    <span class="hljs-keyword">defer</span> cleanup() <span class="hljs-comment">// 资源清理</span>

    <span class="hljs-comment">// 3. 启动应用</span>
    <span class="hljs-keyword">if</span> err := app.Run(); err != <span class="hljs-literal">nil</span> {
        log.Fatalf(<span class="hljs-string">"failed to run app: %v"</span>, err)
    }
}
</code></pre>
<h3 data-id="heading-26">四、分层 ProviderSet 设计的核心优势</h3>
<p>GoWind Admin 采用 “每层独立 <code>providers</code> 目录” 的设计，而非将 ProviderSet 与业务代码混放，核心解决了企业级开发中的三大痛点：</p>
<h4 data-id="heading-27">4.1 降低维护成本</h4>
<p>调整某一层的依赖时，可直接定位到 <code>[层名]/providers/wire_set.go</code>，无需在业务代码中查找 DI 配置，符合 “约定优于配置” 的设计理念，减少团队认知负担。</p>
<h4 data-id="heading-28">4.2 杜绝循环依赖</h4>
<p>严格遵循 “上层依赖下层，下层不依赖上层” 的规则（如 Service 依赖 Data，Data 不依赖 Service）；同时 <code>providers</code> 目录仅引用同级业务目录，业务目录不引用 <code>providers</code> 目录，从物理结构上彻底避免循环依赖。</p>
<h4 data-id="heading-29">4.3 支持增量开发</h4>
<p>新增层（如缓存层、消息队列层）时，只需创建 <code>cache/providers/wire_set.go</code>，在上级 ProviderSet 中嵌套引用即可完成集成，无需修改现有业务代码，符合 “开闭原则”。</p>
<h3 data-id="heading-30">五、企业级实践：常见问题与解决方案</h3>
<h4 data-id="heading-31">5.1 编译期错误排查</h4>
<p>Wire 生成代码时若报错，多为以下原因：</p>

























<table><thead><tr><th>错误类型</th><th>典型场景</th><th>解决方案</th></tr></thead><tbody><tr><td>依赖缺失</td><td>Provider 参数无对应 Provider</td><td>检查 <code>wire.Build</code> 中是否包含该依赖的 ProviderSet</td></tr><tr><td>循环依赖</td><td>A 依赖 B，B 依赖 A</td><td>通过接口解耦；调整分层结构，确保依赖单向流动</td></tr><tr><td>返回值不匹配</td><td>Provider 返回值类型不符</td><td>检查 Provider 函数返回值与依赖类型是否一致</td></tr></tbody></table>
<h4 data-id="heading-32">5.2 代码生成规范</h4>
<ul>
<li>严禁手动修改 <code>wire_gen.go</code>：该文件为自动生成，修改后会被下次 <code>wire</code> 命令覆盖；</li>
<li>添加 <code>go:generate</code> 注释：在 <code>wire.go</code> 头部添加 <code>//go:generate go run github.com/google/wire/cmd/wire</code>，可通过 <code>go generate</code> 批量生成所有 Injector 代码；</li>
<li>版本控制：将 <code>wire_gen.go</code> 纳入版本控制，确保团队使用相同的依赖组装逻辑。</li>
</ul>
<h4 data-id="heading-33">5.3 高级技巧：接口与实现绑定</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 定义接口</span>
<span class="hljs-keyword">type</span> UserRepo <span class="hljs-keyword">interface</span> {
    GetUser(id <span class="hljs-type">int64</span>) (*User, <span class="hljs-type">error</span>)
}

<span class="hljs-comment">// Mock 实现</span>
<span class="hljs-keyword">type</span> MockUserRepo <span class="hljs-keyword">struct</span>{}
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *MockUserRepo)</span></span> GetUser(id <span class="hljs-type">int64</span>) (*User, <span class="hljs-type">error</span>) {
    <span class="hljs-keyword">return</span> &amp;User{ID: id, Name: <span class="hljs-string">"mock"</span>}, <span class="hljs-literal">nil</span>
}

<span class="hljs-comment">// Provider</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewMockUserRepo</span><span class="hljs-params">()</span></span> UserRepo {
    <span class="hljs-keyword">return</span> &amp;MockUserRepo{}
}

<span class="hljs-comment">// 在 Injector 中绑定</span>
wire.Build(
    wire.Bind(<span class="hljs-built_in">new</span>(UserRepo), <span class="hljs-built_in">new</span>(*MockUserRepo)), <span class="hljs-comment">// 绑定接口与 Mock 实现</span>
    NewMockUserRepo,
)
</code></pre>
<h3 data-id="heading-34">六、小结</h3>
<p>Wire 作为 Google 开源的编译期依赖注入工具，以 “无反射、编译期校验、代码可读性高” 的优势，完美适配企业级中后台系统的稳定性需求。GoWind Admin 基于 Wire 设计的 “分层 ProviderSet” 方案，实现了依赖注入逻辑与业务逻辑的彻底解耦：</p>
<ul>
<li>从架构上，通过 “原子级 → 模块聚合级 → 应用级” 的嵌套结构，让依赖关系可视化；</li>
<li>从工程上，通过独立 <code>providers</code> 目录，杜绝循环依赖、降低维护成本；</li>
<li>从开发上，通过自动生成 Injector 代码，减少手动组装依赖的重复工作。</li>
</ul>
<p>该方案不仅适用于 GoWind Admin，也可直接复用到其他 Go 语言中后台项目，帮助团队快速落地规范的依赖注入实践，提升代码质量与开发效率。</p>
<h4 data-id="heading-35">七、项目仓库</h4>
<ul>
<li>GoWind Admin（Gitee）：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Ftx7do%2Fgo-wind-admin" target="_blank" title="https://gitee.com/tx7do/go-wind-admin" ref="nofollow noopener noreferrer">gitee.com/tx7do/go-wi…</a></li>
<li>GoWind Admin（GitHub）：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftx7do%2Fgo-wind-admin" target="_blank" title="https://github.com/tx7do/go-wind-admin" ref="nofollow noopener noreferrer">github.com/tx7do/go-wi…</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[c++11 之 智能指针]]></title>    <link>https://juejin.cn/post/7583906870827565065</link>    <guid>https://juejin.cn/post/7583906870827565065</guid>    <pubDate>2025-12-15T12:06:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583906870827565065" data-draft-id="7576124206397341706" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="c++11 之 智能指针"/> <meta itemprop="keywords" content="C++"/> <meta itemprop="datePublished" content="2025-12-15T12:06:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="GuSir"/> <meta itemprop="url" content="https://juejin.cn/user/3261574409623161"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            c++11 之 智能指针
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3261574409623161/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    GuSir
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T12:06:17.000Z" title="Mon Dec 15 2025 12:06:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读17分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一. 为什么会有智能指针</h2>
<p>c++ 引入智能指针（Smart Pointers）的核心目的，是 <strong>解决传统 raw pointer（裸指针）的三大核心问题</strong>，同时在不丧失 C++ 底层控制能力的前提下，引入更安全、更符合现代编程范式的内存管理机制。</p>
<h3 data-id="heading-1">1. 内存泄漏（Memory Leak）</h3>
<p>当动态分配的内存（<code>new</code> 出来的）没有被手动 <code>delete</code> 时，这块内存会一直占用，直到程序结束。</p>
<ul>
<li>函数提前返回（比如中间有 <code>if</code> 分支跳过 <code>delete</code>）；</li>
<li>异常抛出（<code>try</code> 块中 <code>new</code>，<code>catch</code> 块中未处理 <code>delete</code>）；</li>
<li>逻辑疏忽（忘记写 <code>delete</code>）。</li>
</ul>
<p>示例：</p>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">func</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-type">int</span>* p = <span class="hljs-keyword">new</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">10</span>); <span class="hljs-comment">// 动态分配内存</span>
    <span class="hljs-keyword">if</span> (some_condition) {
        <span class="hljs-keyword">return</span>; <span class="hljs-comment">// 提前返回，p 指向的内存未释放 → 内存泄漏</span>
    }
    <span class="hljs-keyword">delete</span> p; <span class="hljs-comment">// 正常路径才释放，异常/提前返回时失效</span>
}
</code></pre>
<h3 data-id="heading-2">2. 野指针（Dangling Pointer）</h3>
<p>当指针指向的内存被释放（<code>delete</code>）后，指针本身没有被置为 <code>nullptr</code>，后续仍可能被访问 / 操作，导致：</p>
<ul>
<li>程序崩溃（访问已释放的内存）；</li>
<li>数据错乱（内存被重新分配给其他对象，旧指针访问到无效数据）。</li>
</ul>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-type">int</span>* p = <span class="hljs-keyword">new</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">10</span>);
<span class="hljs-keyword">delete</span> p; <span class="hljs-comment">// 内存释放，但 p 仍指向原地址（野指针）</span>
cout &lt;&lt; *p; <span class="hljs-comment">// 未定义行为（UB），可能崩溃或输出垃圾值</span>
</code></pre>
<h3 data-id="heading-3">3. 二次释放（Double Free）</h3>
<p>同一内存被 <code>delete</code> 两次，会导致程序崩溃（内存管理机制检测到非法释放）.</p>
<p>示例 :</p>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-type">int</span>* p = <span class="hljs-keyword">new</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">10</span>);
<span class="hljs-keyword">delete</span> p; 
<span class="hljs-keyword">delete</span> p; <span class="hljs-comment">// 二次释放 → 程序崩溃</span>
</code></pre>
<h2 data-id="heading-4">二. 智能指针的核心设计理念</h2>
<p><strong>RAII + 所有权语义</strong></p>
<p>智能指针本质是  <strong>“封装裸指针的类模板”</strong> ，其核心机制是：</p>
<ol>
<li>
<p><strong>RAII（资源获取即初始化）</strong> ：利用类的构造函数获取资源（如动态内存），析构函数自动释放资源（无需手动 <code>delete</code>）。因为 C++ 保证：对象生命周期结束时（如离开作用域、函数返回），其析构函数一定会被调用。</p>
</li>
<li>
<p><strong>所有权语义（Ownership Semantics）</strong> ：明确指针指向的内存 “归谁所有”，避免多指针混乱操作（比如 <code>std::unique_ptr</code> 独占所有权，<code>std::shared_ptr</code> 共享所有权）</p>
</li>
</ol>
<blockquote>
<p><strong>RAII</strong> 理解可以继续深入理解一下，这是一种编程范式</p>
</blockquote>
<h2 data-id="heading-5">三. 共享智能指帧 <code>std::shared_ptr</code></h2>
<p>核心特点是允许多个 <code>shared_ptr</code> 指向同一块动态内存，通过<strong>引用计数（Reference Counting）</strong>  管理内存生命周期：当最后一个指向该内存的 <code>shared_ptr</code> 被销毁 / 重置时，才会自动释放内存。</p>
<h3 data-id="heading-6">（1）引用计数机制</h3>
<ul>
<li><code>shared_ptr</code> 内部维护两个指针：
<ul>
<li>指向实际数据的<strong>裸指针</strong>（data pointer）；</li>
<li>指向控制块（control block）的指针（存储引用计数、析构函数、分配器等）</li>
</ul>
</li>
<li>每新增一个 <code>shared_ptr</code> 指向同一资源，引用计数 +1；</li>
<li>每销毁 / 重置一个 <code>shared_ptr</code>，引用计数 -1；</li>
<li>当引用计数降至 0 时，自动调用 <code>delete</code>（或自定义删除器）释放资源，并销毁控制块。</li>
</ul>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">MyInt</span> {
    <span class="hljs-type">int</span> val;
    <span class="hljs-built_in">MyInt</span>(<span class="hljs-type">int</span> v) : <span class="hljs-built_in">val</span>(v) {
        <span class="hljs-comment">// std::cout &lt;&lt; "MyInt 构造：" &lt;&lt; val &lt;&lt; std::endl;</span>
    }
    ~<span class="hljs-built_in">MyInt</span>() {
        std::cout &lt;&lt; <span class="hljs-string">"MyInt 析构："</span> &lt;&lt; val &lt;&lt; std::endl;
    }
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">func</span><span class="hljs-params">(std::shared_ptr&lt;MyInt&gt;&amp; ptr)</span> </span>{
    std::cout &lt;&lt; <span class="hljs-string">"func 内引用计数："</span> &lt;&lt; ptr.<span class="hljs-built_in">use_count</span>() &lt;&lt; std::endl;
    <span class="hljs-comment">// 赋值新的 shared_ptr</span>
    ptr = std::<span class="hljs-built_in">make_shared</span>&lt;MyInt&gt;(<span class="hljs-number">20</span>);

    std::shared_ptr&lt;MyInt&gt; ptr2 = ptr;

    std::cout &lt;&lt; <span class="hljs-string">"func 内引用计数："</span> &lt;&lt; ptr.<span class="hljs-built_in">use_count</span>() &lt;&lt; std::endl;
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    std::shared_ptr&lt;MyInt&gt; sp = std::<span class="hljs-built_in">make_shared</span>&lt;MyInt&gt;(<span class="hljs-number">10</span>);
    std::cout &lt;&lt; <span class="hljs-string">"调用前引用计数："</span> &lt;&lt; sp.<span class="hljs-built_in">use_count</span>() &lt;&lt; std::endl;
    <span class="hljs-built_in">func</span>(sp);
    std::cout &lt;&lt; <span class="hljs-string">"调用后引用计数："</span> &lt;&lt; sp.<span class="hljs-built_in">use_count</span>() &lt;&lt; std::endl;
    std::cout &lt;&lt; <span class="hljs-string">"sp 指向的值："</span> &lt;&lt; sp-&gt;val &lt;&lt; std::endl;
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>执行结果:</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/13299364b93944098918a9fd261efe0f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR3VTaXI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766405177&amp;x-signature=sWnXNHrTolzBldR9fr4afv%2BaBMA%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-7">（2）独占性（相对）与拷贝 / 赋值</h3>
<ul>
<li>支持<strong>拷贝构造</strong>和<strong>赋值运算符</strong>：拷贝 / 赋值时仅增加引用计数，不深拷贝数据；</li>
<li>不同于 <code>unique_ptr</code>（不可拷贝），<code>shared_ptr</code> 可自由拷贝、作为函数参数传递（值传递）、存入容器（如 <code>std::vector&lt;std::shared_ptr&lt;T&gt;&gt;</code>）。</li>
</ul>
<p>//详细解释，结合传参</p>
<h3 data-id="heading-8">（3）自定义删除器</h3>
<p><code>shared_ptr</code> 支持自定义删除器（Deletor），用于替代默认的 <code>delete</code>，适配特殊场景（如数组、文件句柄、内存池分配的内存等）。</p>
<blockquote>
<p>在计数到0的时候，就会执行删除器，-   如果只是“复制”或“赋值”产生新的 shared_ptr，引用计数仍 &gt;0，删除器不会被执行。</p>
</blockquote>
<h4 data-id="heading-9">场景 A:数组</h4>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-function">std::shared_ptr&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">sp</span><span class="hljs-params">(<span class="hljs-keyword">new</span> <span class="hljs-type">int</span>[<span class="hljs-number">100</span>],          <span class="hljs-comment">// 裸指针</span>
                       [](<span class="hljs-type">int</span>* p){ <span class="hljs-keyword">delete</span>[] p; } <span class="hljs-comment">// 自定义删除器</span>
)</span></span>;
</code></pre>
<h4 data-id="heading-10">场景 B:文件句柄</h4>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-keyword">auto</span> file_deleter = [](FILE* fp){
    <span class="hljs-keyword">if</span>(fp) <span class="hljs-built_in">fclose</span>(fp);
};
<span class="hljs-function">std::shared_ptr&lt;FILE&gt; <span class="hljs-title">sp</span><span class="hljs-params">(fopen(<span class="hljs-string">"log.txt"</span>,<span class="hljs-string">"w"</span>), file_deleter)</span></span>;
</code></pre>
<h4 data-id="heading-11">场景 C：内存池</h4>
<pre><code class="hljs language-arduino" lang="arduino">MemoryPool pool;
<span class="hljs-function">std::shared_ptr&lt;Foo&gt; <span class="hljs-title">sp</span><span class="hljs-params">(
    <span class="hljs-keyword">static_cast</span>&lt;Foo*&gt;(pool.allocate()),
    [&amp;pool](Foo* p){ pool.deallocate(p); }
)</span></span>;
</code></pre>
<h4 data-id="heading-12">场景 D：函数对象当删除器</h4>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">VerboseDeleter</span>{
    std::string name;
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">operator</span><span class="hljs-params">()</span><span class="hljs-params">(Widget* w)</span> <span class="hljs-type">const</span> </span>{
        std::cout &lt;&lt; <span class="hljs-string">"destroying "</span> &lt;&lt; name &lt;&lt; <span class="hljs-string">'\n'</span>;
        <span class="hljs-keyword">delete</span> w;
    }
};
<span class="hljs-function">std::shared_ptr&lt;Widget&gt; <span class="hljs-title">pw</span><span class="hljs-params">(<span class="hljs-keyword">new</span> Widget, VerboseDeleter{<span class="hljs-string">"widget#1"</span>})</span></span>;
</code></pre>
<h3 data-id="heading-13">（4）空指针安全</h3>
<ul>
<li>空的 <code>shared_ptr</code>（未指向任何资源）引用计数为 0，操作（如 <code>reset()</code>、<code>use_count()</code>）不会触发未定义行为；</li>
<li>可通过 <code>operator bool()</code> 判断是否指向有效资源：</li>
</ul>
<pre><code class="hljs language-cpp" lang="cpp">std::shared_ptr&lt;<span class="hljs-type">int</span>&gt; p;
<span class="hljs-keyword">if</span> (p) { <span class="hljs-comment">// 等价于 p != nullptr</span>
    std::cout &lt;&lt; *p &lt;&lt; std::endl;
} <span class="hljs-keyword">else</span> {
    std::cout &lt;&lt; <span class="hljs-string">"p 为空"</span> &lt;&lt; std::endl; <span class="hljs-comment">// 输出该行</span>
}
</code></pre>
<h3 data-id="heading-14">（5）大小与性能</h3>
<ul>
<li><code>shared_ptr</code> 大小通常是<strong>裸指针的 2 倍</strong>（存储数据指针 + 控制块指针）；</li>
<li>引用计数的增减是<strong>原子操作</strong>（线程安全），但存在轻微的性能开销（相比裸指针 /<code>unique_ptr</code>）；</li>
<li>注意：引用计数线程安全 ≠ 数据访问线程安全：多个线程同时修改 <code>shared_ptr</code> 指向的数据，仍需加锁。</li>
</ul>
<h3 data-id="heading-15">（6）避免循环引用（核心坑点）</h3>
<p><code>shared_ptr</code> 的最大问题是<strong>循环引用</strong>：两个（或多个）<code>shared_ptr</code> 互相指向对方，导致引用计数无法降至 0，内存泄漏。</p>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Node</span> {
    std::shared_ptr&lt;Node&gt; next; <span class="hljs-comment">// 共享所有权</span>
    ~<span class="hljs-built_in">Node</span>() { std::cout &lt;&lt; <span class="hljs-string">"Node 析构"</span> &lt;&lt; std::endl; }
};

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function">std::shared_ptr&lt;Node&gt; <span class="hljs-title">n1</span><span class="hljs-params">(<span class="hljs-keyword">new</span> Node)</span></span>;
    <span class="hljs-function">std::shared_ptr&lt;Node&gt; <span class="hljs-title">n2</span><span class="hljs-params">(<span class="hljs-keyword">new</span> Node)</span></span>;
    n1-&gt;next = n2; <span class="hljs-comment">// n1 引用 n2</span>
    n2-&gt;next = n1; <span class="hljs-comment">// n2 引用 n1 → 循环引用</span>
    <span class="hljs-comment">// 函数结束时，n1/n2 销毁，但引用计数仍为1，内存泄漏（析构函数不执行）</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 data-id="heading-16">（7）避免从裸指针多次构造 shared_ptr</h3>
<p>同一裸指针多次构造 <code>shared_ptr</code>，会导致多个独立的控制块，最终触发<strong>二次释放</strong>：</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">int</span>* raw = new <span class="hljs-type">int</span>(<span class="hljs-number">10</span>);
<span class="hljs-built_in">std</span>::<span class="hljs-built_in">shared_ptr</span>&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title function_">p1</span><span class="hljs-params">(raw)</span>;
<span class="hljs-built_in">std</span>::<span class="hljs-built_in">shared_ptr</span>&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title function_">p2</span><span class="hljs-params">(raw)</span>; <span class="hljs-comment">// 错误：p1和p2各有独立控制块，析构时两次delete raw</span>
</code></pre>
<h3 data-id="heading-17">（8）优先使用 std::make_shared</h3>
<ul>
<li>更高效：一次性分配数据内存 + 控制块内存（裸指针构造需两次分配：数据 + 控制块）；</li>
<li>更安全：避免异常安全问题（如 <code>func(shared_ptr&lt;int&gt;(new int), other_func())</code> 可能因编译器优化导致内存泄漏）；</li>
<li>语法简洁：无需手动写 <code>new</code>。</li>
</ul>
<blockquote>
<p>限制：<code>make_shared</code> 无法直接指定自定义删除器（需通过 <code>shared_ptr</code> 构造函数配合）。</p>
</blockquote>
<h3 data-id="heading-18">（9）不要将 shared_ptr 存储在全局 / 静态变量中（谨慎）</h3>
<p>全局 <code>shared_ptr</code> 的析构顺序不确定，可能导致资源释放时依赖的对象已销毁，引发未定义行为。而且这个对象死的可能比main还晚</p>
<h3 data-id="heading-19">（10）线程安全说明</h3>
<ul>
<li><strong>引用计数操作</strong>：<code>shared_ptr</code> 的引用计数增减是原子操作，多线程拷贝 / 重置 <code>shared_ptr</code> 本身是线程安全的；</li>
<li><strong>数据访问</strong>：多线程同时读写 <code>shared_ptr</code> 指向的数据，<strong>不是线程安全的</strong>，需通过互斥锁（如 <code>std::mutex</code>）保护；</li>
<li><strong>同一 shared_ptr 对象的修改</strong>：多线程同时修改同一个 <code>shared_ptr</code> 对象（如 <code>p.reset()</code>），不是线程安全的，需加锁。</li>
</ul>
<h3 data-id="heading-20">（11）补充：shared_ptr 作为函数参数时的引用计数行为</h3>
<ul>
<li>
<p><strong>值传递：引用计数 +1，函数结束 -1</strong></p>
<p>当 <code>shared_ptr</code> 以<strong>值传递</strong>方式作为函数参数时，会触发 <code>shared_ptr</code> 的<strong>拷贝构造</strong>：</p>
<ol>
<li>函数调用时，实参的 <code>shared_ptr</code> 拷贝给形参，引用计数  <strong>+1</strong>；</li>
<li>函数执行结束后，形参出作用域被销毁，引用计数 <strong>-1</strong>；</li>
<li>最终引用计数回到调用前的状态。</li>
<li/>
</ol>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">func</span><span class="hljs-params">(std::shared_ptr&lt;<span class="hljs-type">int</span>&gt; ptr)</span> </span>{ <span class="hljs-comment">// 值传递，拷贝构造</span>
    std::cout &lt;&lt; <span class="hljs-string">"func 内引用计数："</span> &lt;&lt; ptr.<span class="hljs-built_in">use_count</span>() &lt;&lt; std::endl; <span class="hljs-comment">// 输出 2</span>
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    std::shared_ptr&lt;<span class="hljs-type">int</span>&gt; sp = std::<span class="hljs-built_in">make_shared</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-number">10</span>);
    std::cout &lt;&lt; <span class="hljs-string">"调用前引用计数："</span> &lt;&lt; sp.<span class="hljs-built_in">use_count</span>() &lt;&lt; std::endl; <span class="hljs-comment">// 输出 1</span>
    <span class="hljs-built_in">func</span>(sp);
    std::cout &lt;&lt; <span class="hljs-string">"调用后引用计数："</span> &lt;&lt; sp.<span class="hljs-built_in">use_count</span>() &lt;&lt; std::endl; <span class="hljs-comment">// 输出 1</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p><strong>优缺点</strong></p>
<ul>
<li>
<p><strong>优点</strong>：函数内对形参的修改（如 <code>ptr = nullptr</code>）不会影响实参，逻辑隔离；</p>
</li>
<li>
<p><strong>缺点</strong>：</p>
<ol>
<li>拷贝 <code>shared_ptr</code> 有开销（原子操作 + 指针拷贝），高频调用时性能损耗明显；</li>
<li>若函数内长期持有形参（如存储到全局容器），可能导致引用计数长期不为 0，内存无法及时释放。</li>
</ol>
</li>
</ul>
</li>
<li>
<p><strong>非 const 引用传递：引用计数不变</strong></p>
<p>当 <code>shared_ptr</code> 以<strong>非 const 引用（<code>shared_ptr&lt;T&gt;&amp;</code>）</strong>  传递时，形参是实参的别名，不会触发拷贝构造，因此<strong>引用计数始终不变</strong>。</p>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">MyInt</span> {
    <span class="hljs-type">int</span> val;
    <span class="hljs-built_in">MyInt</span>(<span class="hljs-type">int</span> v) : <span class="hljs-built_in">val</span>(v) {
        std::cout &lt;&lt; <span class="hljs-string">"MyInt 构造："</span> &lt;&lt; val &lt;&lt; std::endl;
    }
    ~<span class="hljs-built_in">MyInt</span>() {
        std::cout &lt;&lt; <span class="hljs-string">"MyInt 析构："</span> &lt;&lt; val &lt;&lt; std::endl;
    }
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">func</span><span class="hljs-params">(std::shared_ptr&lt;MyInt&gt;&amp; ptr)</span> </span>{
    std::cout &lt;&lt; <span class="hljs-string">"func 内引用计数："</span> &lt;&lt; ptr.<span class="hljs-built_in">use_count</span>() &lt;&lt; std::endl;
    <span class="hljs-comment">// 赋值新的 shared_ptr</span>
    ptr = std::<span class="hljs-built_in">make_shared</span>&lt;MyInt&gt;(<span class="hljs-number">20</span>);
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    std::shared_ptr&lt;MyInt&gt; sp = std::<span class="hljs-built_in">make_shared</span>&lt;MyInt&gt;(<span class="hljs-number">10</span>);
    std::cout &lt;&lt; <span class="hljs-string">"调用前引用计数："</span> &lt;&lt; sp.<span class="hljs-built_in">use_count</span>() &lt;&lt; std::endl;
    <span class="hljs-built_in">func</span>(sp);
    std::cout &lt;&lt; <span class="hljs-string">"调用后引用计数："</span> &lt;&lt; sp.<span class="hljs-built_in">use_count</span>() &lt;&lt; std::endl;
    std::cout &lt;&lt; <span class="hljs-string">"sp 指向的值："</span> &lt;&lt; sp-&gt;val &lt;&lt; std::endl;
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<blockquote>
<p>注意这里方法执行，重新创建一个对象的时候，会析构原来的</p>
</blockquote>
<p><strong>优缺点</strong></p>
<ul>
<li>
<p><strong>优点</strong>：函数内对形参的修改（如 <code>ptr = nullptr</code>）不会影响实参，逻辑隔离；</p>
</li>
<li>
<p><strong>缺点</strong>：</p>
<ol>
<li>拷贝 <code>shared_ptr</code> 有开销（原子操作 + 指针拷贝），高频调用时性能损耗明显；</li>
<li>若函数内长期持有形参（如存储到全局容器），可能导致引用计数长期不为 0，内存无法及时释放。</li>
</ol>
</li>
</ul>
</li>
<li>
<p><strong>const 引用传递：引用计数不变</strong></p>
<p>当 <code>shared_ptr</code> 以<strong>const 引用（<code>const shared_ptr&lt;T&gt;&amp;</code>）</strong>  传递时，形参是实参的只读别名，同样不触发拷贝构造，<strong>引用计数不变</strong>；且函数内无法修改形参（如赋值、置空），避免了非 const 引用的风险。</p>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">func</span><span class="hljs-params">(<span class="hljs-type">const</span> std::shared_ptr&lt;<span class="hljs-type">int</span>&gt;&amp; ptr)</span> </span>{ <span class="hljs-comment">// const 引用传递</span>
    std::cout &lt;&lt; <span class="hljs-string">"func 内引用计数："</span> &lt;&lt; ptr.<span class="hljs-built_in">use_count</span>() &lt;&lt; std::endl; <span class="hljs-comment">// 输出 1</span>
    <span class="hljs-comment">// ptr = std::make_shared&lt;int&gt;(20); // 编译错误：const 引用不可修改</span>
    *ptr = <span class="hljs-number">20</span>; <span class="hljs-comment">// 允许修改指向的资源（仅限制 shared_ptr 本身，不限制资源）</span>
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    std::shared_ptr&lt;<span class="hljs-type">int</span>&gt; sp = std::<span class="hljs-built_in">make_shared</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-number">10</span>);
    std::cout &lt;&lt; <span class="hljs-string">"调用前引用计数："</span> &lt;&lt; sp.<span class="hljs-built_in">use_count</span>() &lt;&lt; std::endl; <span class="hljs-comment">// 输出 1</span>
    <span class="hljs-built_in">func</span>(sp);
    std::cout &lt;&lt; <span class="hljs-string">"调用后引用计数："</span> &lt;&lt; sp.<span class="hljs-built_in">use_count</span>() &lt;&lt; std::endl; <span class="hljs-comment">// 输出 1</span>
    std::cout &lt;&lt; <span class="hljs-string">"sp 指向的值："</span> &lt;&lt; *sp &lt;&lt; std::endl; <span class="hljs-comment">// 输出 20</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p><strong>优缺点</strong></p>
<ul>
<li><strong>优点</strong>：无拷贝开销，性能优；只读特性避免了意外修改实参的风险，是最安全的传参方式；</li>
<li><strong>缺点</strong>：若函数内需要长期持有该 <code>shared_ptr</code>（如存储到容器），const 引用可能悬空（实参销毁后引用失效），需手动拷贝（此时引用计数会 +1）。</li>
</ul>
</li>
<li>
<p><strong>移动语义（std::move）传递</strong></p>
<p>若通过 <code>std::move</code> 将 <code>shared_ptr</code> 以值传递方式传入函数，会触发<strong>移动构造</strong>：</p>
<ol>
<li>实参的 <code>shared_ptr</code> 所有权转移给形参，引用计数 <strong>保持不变</strong>（而非 +1）；</li>
<li>实参变为 “空” 状态（<code>use_count() == 0</code>），不再管理资源；</li>
<li>函数结束后形参析构，引用计数 -1，若此时无其他持有者，资源被释放。</li>
</ol>
<pre><code class="hljs language-C++" lang="C++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">func</span><span class="hljs-params">(std::shared_ptr&lt;<span class="hljs-type">int</span>&gt; ptr)</span> </span>{ <span class="hljs-comment">// 值传递 + std::move</span>
    std::cout &lt;&lt; <span class="hljs-string">"func 内引用计数："</span> &lt;&lt; ptr.<span class="hljs-built_in">use_count</span>() &lt;&lt; std::endl; <span class="hljs-comment">// 输出 1</span>
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    std::shared_ptr&lt;<span class="hljs-type">int</span>&gt; sp = std::<span class="hljs-built_in">make_shared</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-number">10</span>);
    std::cout &lt;&lt; <span class="hljs-string">"move 前引用计数："</span> &lt;&lt; sp.<span class="hljs-built_in">use_count</span>() &lt;&lt; std::endl; <span class="hljs-comment">// 输出 1</span>
    <span class="hljs-built_in">func</span>(std::<span class="hljs-built_in">move</span>(sp));
    std::cout &lt;&lt; <span class="hljs-string">"move 后实参引用计数："</span> &lt;&lt; sp.<span class="hljs-built_in">use_count</span>() &lt;&lt; std::endl; <span class="hljs-comment">// 输出 0</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>移动构造会 “窃取” 实参的资源指针和引用计数，实参的内部指针被置空，因此引用计数不会增加（仅所有权转移）；适用于不再使用实参的场景，避免拷贝开销。</p>
</li>
</ul>
<h2 data-id="heading-21">四. 独享智能指帧 <code>std::unique_ptr</code></h2>
<p><code>std::unique_ptr</code> 是 C++11 引入的<strong>独占式智能指针</strong>，用于管理动态分配的内存，核心特性是<strong>所有权唯一</strong>—— 同一时间只有一个 <code>unique_ptr</code> 指向某个对象，销毁时自动释放内存，彻底避免内存泄漏和手动 <code>delete</code> 的风险。使用相对共享指针要简单，但却是最常用的智能指针。</p>
<ol>
<li><strong>独占所有权</strong>：不可拷贝（C++11），仅可移动（move），确保对象只有一个管理者；</li>
<li><strong>自动释放</strong>：<code>unique_ptr</code> 析构时（如离开作用域、被重置），自动调用 <code>delete</code> 释放所管理的内存；</li>
<li><strong>轻量级</strong>：无额外开销（大小等同于原始指针），支持自定义删除器；</li>
<li><strong>支持数组</strong>：C++11 原生支持管理动态数组（<code>unique_ptr&lt;T[]&gt;</code>）。</li>
</ol>
<p>简单用法，单个对象:</p>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-comment">// 方式1：直接构造（C++11 推荐）</span>
<span class="hljs-function">unique_ptr&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">ptr1</span><span class="hljs-params">(<span class="hljs-keyword">new</span> <span class="hljs-type">int</span>(<span class="hljs-number">10</span>))</span></span>;

<span class="hljs-comment">// 方式2：make_unique（C++14 引入，更安全，避免内存泄漏）</span>
<span class="hljs-comment">// C++11 无 make_unique，可自行实现</span>
unique_ptr&lt;<span class="hljs-type">int</span>&gt; ptr2 = <span class="hljs-built_in">make_unique</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-number">20</span>);

<span class="hljs-comment">// 空 unique_ptr</span>
unique_ptr&lt;<span class="hljs-type">int</span>&gt; ptr3; <span class="hljs-comment">// 初始化为 nullptr</span>
</code></pre>
<p>管理动态数组：</p>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-comment">// 管理 int 数组，析构时自动调用 delete[]</span>
<span class="hljs-function">unique_ptr&lt;<span class="hljs-type">int</span>[]&gt; <span class="hljs-title">arr_ptr</span><span class="hljs-params">(<span class="hljs-keyword">new</span> <span class="hljs-type">int</span>[<span class="hljs-number">5</span>]{<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>})</span></span>;
<span class="hljs-comment">// 访问数组元素</span>
cout &lt;&lt; arr_ptr[<span class="hljs-number">0</span>] &lt;&lt; endl; <span class="hljs-comment">// 输出 1</span>
</code></pre>
<p>通过 <code>*</code> 解引用（单个对象）或 <code>-&gt;</code>（成员访问），或 <code>[]</code>（数组）：</p>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Person</span> {
    string name;
    <span class="hljs-type">int</span> age;
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">show</span><span class="hljs-params">()</span> </span>{ cout &lt;&lt; name &lt;&lt; <span class="hljs-string">", "</span> &lt;&lt; age &lt;&lt; endl; }
};

<span class="hljs-comment">// 单个对象</span>
<span class="hljs-function">unique_ptr&lt;Person&gt; <span class="hljs-title">p</span><span class="hljs-params">(<span class="hljs-keyword">new</span> Person{<span class="hljs-string">"Alice"</span>, <span class="hljs-number">20</span>})</span></span>;
cout &lt;&lt; (*p).name &lt;&lt; endl; <span class="hljs-comment">// 解引用访问成员</span>
cout &lt;&lt; p-&gt;age &lt;&lt; endl;    <span class="hljs-comment">// -&gt; 访问成员</span>
p-&gt;<span class="hljs-built_in">show</span>();                 <span class="hljs-comment">// 调用成员函数</span>

<span class="hljs-comment">// 数组</span>
<span class="hljs-function">unique_ptr&lt;<span class="hljs-type">int</span>[]&gt; <span class="hljs-title">arr</span><span class="hljs-params">(<span class="hljs-keyword">new</span> <span class="hljs-type">int</span>[<span class="hljs-number">3</span>]{<span class="hljs-number">10</span>,<span class="hljs-number">20</span>,<span class="hljs-number">30</span>})</span></span>;
cout &lt;&lt; arr[<span class="hljs-number">1</span>] &lt;&lt; endl; <span class="hljs-comment">// 输出 20</span>
</code></pre>
<p><strong>重置与释放</strong></p>
<ul>
<li><code>reset()</code>：释放当前管理的对象，可选传入新指针；</li>
<li><code>release()</code>：释放所有权（返回原始指针），但不释放内存（需手动管理）；</li>
<li><code>nullptr</code> 赋值：等价于 <code>reset()</code>。</li>
</ul>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-function">unique_ptr&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">ptr</span><span class="hljs-params">(<span class="hljs-keyword">new</span> <span class="hljs-type">int</span>(<span class="hljs-number">50</span>))</span></span>;

<span class="hljs-comment">// 重置（释放原内存，指向新对象）</span>
ptr.<span class="hljs-built_in">reset</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">60</span>));
cout &lt;&lt; *ptr &lt;&lt; endl; <span class="hljs-comment">// 输出 60</span>

<span class="hljs-comment">// 重置为空（释放原内存）</span>
ptr.<span class="hljs-built_in">reset</span>();
cout &lt;&lt; (ptr ? <span class="hljs-string">"非空"</span> : <span class="hljs-string">"空"</span>) &lt;&lt; endl; <span class="hljs-comment">// 输出 空</span>

<span class="hljs-comment">// release()：释放所有权，返回原始指针</span>
<span class="hljs-function">unique_ptr&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">ptr2</span><span class="hljs-params">(<span class="hljs-keyword">new</span> <span class="hljs-type">int</span>(<span class="hljs-number">70</span>))</span></span>;
<span class="hljs-type">int</span>* raw_ptr = ptr2.<span class="hljs-built_in">release</span>(); 
cout &lt;&lt; *raw_ptr &lt;&lt; endl; <span class="hljs-comment">// 输出 70</span>
<span class="hljs-keyword">delete</span> raw_ptr; <span class="hljs-comment">// 必须手动释放，否则内存泄漏</span>
ptr2.<span class="hljs-built_in">reset</span>(); <span class="hljs-comment">// ptr2 已空，重置无影响</span>
</code></pre>
<p><strong>自定义删除器</strong></p>
<p>默认删除器调用 <code>delete</code>/<code>delete[]</code>，但可自定义删除器（如管理 <code>FILE*</code>、动态库句柄等）。</p>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-comment">// 自定义删除器：关闭文件</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">close_file</span><span class="hljs-params">(FILE* fp)</span> </span>{
    <span class="hljs-keyword">if</span> (fp) {
        <span class="hljs-built_in">fclose</span>(fp);
        cout &lt;&lt; <span class="hljs-string">"文件已关闭"</span> &lt;&lt; endl;
    }
}

<span class="hljs-comment">// 创建 unique_ptr，指定删除器类型</span>
<span class="hljs-function">unique_ptr&lt;FILE, <span class="hljs-title">decltype</span><span class="hljs-params">(&amp;close_file)</span>&gt; <span class="hljs-title">file_ptr</span><span class="hljs-params">(fopen(<span class="hljs-string">"test.txt"</span>, <span class="hljs-string">"w"</span>), close_file)</span></span>;
<span class="hljs-keyword">if</span> (file_ptr) {
    <span class="hljs-built_in">fputs</span>(<span class="hljs-string">"hello unique_ptr"</span>, file_ptr.<span class="hljs-built_in">get</span>());
}
<span class="hljs-comment">// 析构时自动调用 close_file</span>
</code></pre>
<p><strong>Lambda 作为删除器（更简洁）</strong></p>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-comment">// 管理动态数组，自定义删除器（示例，实际 delete[] 已足够）</span>
<span class="hljs-keyword">auto</span> deleter = [](<span class="hljs-type">int</span>* arr) {
    cout &lt;&lt; <span class="hljs-string">"释放数组内存"</span> &lt;&lt; endl;
    <span class="hljs-keyword">delete</span>[] arr;
};
<span class="hljs-function">unique_ptr&lt;<span class="hljs-type">int</span>[], <span class="hljs-title">decltype</span><span class="hljs-params">(deleter)</span>&gt; <span class="hljs-title">arr_ptr</span><span class="hljs-params">(<span class="hljs-keyword">new</span> <span class="hljs-type">int</span>[<span class="hljs-number">3</span>], deleter)</span></span>;
</code></pre>
<p><strong>其他常用成员函数</strong></p>

















<table><thead><tr><th><code>get()</code></th><th>返回原始指针（仅访问，不释放所有权）</th></tr></thead><tbody><tr><td><code>swap()</code></td><td>交换两个 <code>unique_ptr</code> 的所有权</td></tr><tr><td><code>operator bool()</code></td><td>判断是否指向有效对象（非空）</td></tr></tbody></table>
<p><strong>场景使用场景</strong></p>
<ul>
<li>替代原始指针，避免内存泄漏</li>
</ul>

<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">func</span>()</span> {
    <span class="hljs-built_in">int</span>* ptr = <span class="hljs-keyword">new</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">10</span>);
    <span class="hljs-comment">// 若中间抛出异常，delete 不会执行，内存泄漏</span>
    delete ptr;
}

<span class="hljs-comment">// unique_ptr：自动释放</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">func_safe</span>()</span> {
    <span class="hljs-function">unique_ptr&lt;<span class="hljs-built_in">int</span>&gt; <span class="hljs-title">ptr</span>(<span class="hljs-params"><span class="hljs-keyword">new</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">10</span></span>))</span>;
    <span class="hljs-comment">// 即使抛出异常，析构时自动释放</span>
}
</code></pre>
<ul>
<li>作为函数返回值（移动语义自动生效）</li>
</ul>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-function">unique_ptr&lt;Person&gt; <span class="hljs-title">create_person</span><span class="hljs-params">(string name, <span class="hljs-type">int</span> age)</span> </span>{
    <span class="hljs-comment">// C++11 中，返回值会自动移动（无需显式 std::move）</span>
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">unique_ptr</span>&lt;Person&gt;(<span class="hljs-keyword">new</span> Person{name, age});
}

<span class="hljs-comment">// 调用</span>
<span class="hljs-keyword">auto</span> p = <span class="hljs-built_in">create_person</span>(<span class="hljs-string">"Bob"</span>, <span class="hljs-number">25</span>);
p-&gt;<span class="hljs-built_in">show</span>(); <span class="hljs-comment">// 输出 Bob, 25</span>
</code></pre>
<ul>
<li>存储在容器中</li>
</ul>

<pre><code class="hljs language-arduino" lang="arduino">vector&lt;unique_ptr&lt;<span class="hljs-type">int</span>&gt;&gt; vec;
<span class="hljs-comment">// 方式1：emplace_back 直接构造</span>
vec.<span class="hljs-built_in">emplace_back</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">10</span>));
<span class="hljs-comment">// 方式2：move 插入</span>
<span class="hljs-function">unique_ptr&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">ptr</span><span class="hljs-params">(<span class="hljs-keyword">new</span> <span class="hljs-type">int</span>(<span class="hljs-number">20</span>))</span></span>;
vec.<span class="hljs-built_in">push_back</span>(<span class="hljs-built_in">move</span>(ptr));

<span class="hljs-comment">// 遍历容器</span>
<span class="hljs-keyword">for</span> (<span class="hljs-type">const</span> <span class="hljs-keyword">auto</span>&amp; p : vec) {
    cout &lt;&lt; *p &lt;&lt; <span class="hljs-string">" "</span>; <span class="hljs-comment">// 输出 10 20</span>
}
</code></pre>
<p><strong>其他事项</strong></p>
<ul>
<li><strong>禁止拷贝</strong>：C++11 中 <code>unique_ptr</code> 的拷贝构造和拷贝赋值被 <code>delete</code></li>
<li><strong>避免裸指针与智能指针混用</strong>：不要用 <code>get()</code> 返回的指针创建新的 <code>unique_ptr</code>，否则会重复释放；</li>
</ul>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-function">unique_ptr&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">ptr</span><span class="hljs-params">(<span class="hljs-keyword">new</span> <span class="hljs-type">int</span>(<span class="hljs-number">10</span>))</span></span>;
<span class="hljs-comment">// 错误：两个 unique_ptr 管理同一内存，析构时双重释放</span>
<span class="hljs-function">unique_ptr&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">ptr2</span><span class="hljs-params">(ptr.get())</span></span>; 
</code></pre>
<ul>
<li><strong><code>make_unique</code> 更安全</strong>：C++14 引入 <code>make_unique</code>，避免 “new 表达式” 和 “智能指针构造” 之间的异常安全问题，C++11 可自行实现：</li>
</ul>

<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T, <span class="hljs-keyword">typename</span>... Args&gt;
unique_ptr&lt;T&gt; <span class="hljs-title">make_unique</span><span class="hljs-params">(Args&amp;&amp;... args)</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">unique_ptr</span>&lt;T&gt;(<span class="hljs-keyword">new</span> <span class="hljs-built_in">T</span>(std::forward&lt;Args&gt;(args)...));
}
</code></pre>
<p>-<strong>数组管理</strong>：<code>unique_ptr&lt;T[]&gt;</code> 不支持 <code>*</code> 和 <code>-&gt;</code>，仅支持 <code>[]</code> 访问；</p>
<ul>
<li><strong>不要管理栈内存</strong>：<code>unique_ptr</code> 仅用于管理堆内存（<code>new</code>/<code>new[]</code> 分配），若指向栈对象，析构时会调用 <code>delete</code>，导致未定义行为：</li>
</ul>

<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">int</span> a = <span class="hljs-number">10</span>;
<span class="hljs-function">unique_ptr&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">ptr</span><span class="hljs-params">(&amp;a)</span></span>; <span class="hljs-comment">// 错误：栈内存不能被 delete</span>
</code></pre>
<h2 data-id="heading-22">五. 弱引用智能指正 <code>std::weak_ptr</code></h2>
<p><code>std::weak_ptr</code> 是 C++11 引入的智能指针，<strong>专门用于解决 <code>std::shared_ptr</code> 循环引用导致的内存泄漏问题</strong>，它本身不管理对象的生命周期，仅作为 <code>shared_ptr</code> 的 “弱引用”—— 既可以访问共享对象，又不会增加引用计数。</p>
<p><strong>核心特性</strong></p>
<ol>
<li><strong>不增加引用计数</strong>：绑定到 <code>shared_ptr</code> 时，不会改变其引用计数，因此不会阻止对象被销毁</li>
<li><strong>可检测对象是否存活</strong>：通过 <code>expired()</code> 或 <code>lock()</code> 检查所指向的对象是否已被销毁</li>
<li><strong>不能直接解引用</strong>：必须先通过 <code>lock()</code> 转换为 <code>shared_ptr</code>，才能安全访问对象（避免访问已销毁的对象）</li>
<li><strong>线程安全</strong>：与 <code>shared_ptr</code> 类似，读操作线程安全，写操作（如 <code>lock()</code>）需加锁</li>
</ol>
<blockquote>
<p><code>lock()</code> 是特殊的 “写操作”—— 它会先检查 <code>use_count</code>（读），若对象存活则创建 <code>shared_ptr</code>，此时会<strong>原子性增加 <code>use_count</code></strong>（写）</p>
</blockquote>
<p><strong>基本用法</strong>
<code>std::weak_ptr</code> 不能直接指向裸指针，必须通过 <code>shared_ptr</code> 初始化或赋值：</p>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// 1. 通过 shared_ptr 初始化</span>
    std::shared_ptr&lt;<span class="hljs-type">int</span>&gt; sp = std::<span class="hljs-built_in">make_shared</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-number">10</span>);
    <span class="hljs-function">std::weak_ptr&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">wp</span><span class="hljs-params">(sp)</span></span>; <span class="hljs-comment">// 引用计数仍为 1</span>

    <span class="hljs-comment">// 2. 空 weak_ptr</span>
    std::weak_ptr&lt;<span class="hljs-type">int</span>&gt; wp_empty;

    <span class="hljs-comment">// 3. 赋值操作</span>
    std::weak_ptr&lt;<span class="hljs-type">int</span>&gt; wp2;
    wp2 = sp; <span class="hljs-comment">// 引用计数仍为 1</span>

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p><strong>核心成员函数</strong></p>





























<table><thead><tr><th>函数</th><th>功能</th></tr></thead><tbody><tr><td><code>lock()</code></td><td>转换为 <code>shared_ptr</code>：若对象存活，返回指向该对象的 <code>shared_ptr</code>；否则返回空 <code>shared_ptr</code></td></tr><tr><td><code>expired()</code></td><td>判断对象是否已销毁（引用计数为 0），返回 <code>bool</code></td></tr><tr><td><code>reset()</code></td><td>清空 <code>weak_ptr</code>，不再引用任何对象</td></tr><tr><td><code>use_count()</code></td><td>返回当前 <code>shared_ptr</code> 的引用计数（慎用，仅用于调试）</td></tr><tr><td><code>swap()</code></td><td>交换两个 <code>weak_ptr</code> 的引用对象</td></tr></tbody></table>
<p><strong>安全访问对象（lock () 核心用法）</strong></p>
<p><code>weak_ptr</code> 不能直接解引用，必须通过 <code>lock()</code> 获取 <code>shared_ptr</code> 后访问：</p>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-comment">// 主函数：程序执行的起点（必须有且仅有一个）</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>


<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    std::shared_ptr&lt;<span class="hljs-type">int</span>&gt; sp = std::<span class="hljs-built_in">make_shared</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-number">100</span>);
    <span class="hljs-function">std::weak_ptr&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">wp</span><span class="hljs-params">(sp)</span></span>;

    <span class="hljs-comment">// 安全访问：先 lock() 转换为 shared_ptr</span>
    
    <span class="hljs-keyword">if</span> (std::shared_ptr&lt;<span class="hljs-type">int</span>&gt; temp = wp.<span class="hljs-built_in">lock</span>()) {
        std::cout &lt;&lt; <span class="hljs-string">"对象值："</span> &lt;&lt; *temp &lt;&lt; std::endl; <span class="hljs-comment">// 输出 100</span>
        std::cout &lt;&lt; <span class="hljs-string">"引用计数："</span> &lt;&lt; temp.<span class="hljs-built_in">use_count</span>() &lt;&lt; std::endl; <span class="hljs-comment">// 2</span>
    } <span class="hljs-keyword">else</span> {
        std::cout &lt;&lt; <span class="hljs-string">"对象已销毁"</span> &lt;&lt; std::endl;
    }

    std::cout &lt;&lt; <span class="hljs-string">"sp 引用计数："</span> &lt;&lt; sp.<span class="hljs-built_in">use_count</span>() &lt;&lt; std::endl; <span class="hljs-comment">// 2</span>

    <span class="hljs-comment">// 销毁 shared_ptr，对象被释放</span>
    sp.<span class="hljs-built_in">reset</span>();

    <span class="hljs-comment">// 再次尝试访问</span>
    <span class="hljs-keyword">auto</span> temp2 = wp.<span class="hljs-built_in">lock</span>();
    <span class="hljs-keyword">if</span> (temp2) {
        std::cout &lt;&lt; <span class="hljs-string">"对象值："</span> &lt;&lt; *temp2 &lt;&lt; std::endl; <span class="hljs-comment">// 输出 100 std::cout &lt;&lt; *temp2 &lt;&lt; std::endl;</span>
        std::cout &lt;&lt; <span class="hljs-string">"引用计数："</span> &lt;&lt; temp2.<span class="hljs-built_in">use_count</span>() &lt;&lt; std::endl; <span class="hljs-comment">// 2</span>
    } <span class="hljs-keyword">else</span> {
        std::cout &lt;&lt; <span class="hljs-string">"对象已销毁"</span> &lt;&lt; std::endl; <span class="hljs-comment">// 输出此行</span>
    }

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p><strong>expired () 检查对象存活</strong></p>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    std::shared_ptr&lt;<span class="hljs-type">int</span>&gt; sp = std::<span class="hljs-built_in">make_shared</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-number">200</span>);
    <span class="hljs-function">std::weak_ptr&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">wp</span><span class="hljs-params">(sp)</span></span>;

    <span class="hljs-keyword">if</span> (!wp.<span class="hljs-built_in">expired</span>()) {
        std::cout &lt;&lt; <span class="hljs-string">"对象存活"</span> &lt;&lt; std::endl; <span class="hljs-comment">// 输出</span>
    }

    sp.<span class="hljs-built_in">reset</span>();
    <span class="hljs-keyword">if</span> (wp.<span class="hljs-built_in">expired</span>()) {
        std::cout &lt;&lt; <span class="hljs-string">"对象已销毁"</span> &lt;&lt; std::endl; <span class="hljs-comment">// 输出</span>
    }

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p><strong>解决循环引用问题（核心场景）</strong></p>
<p><code>shared_ptr</code> 循环引用会导致引用计数无法归 0，对象无法析构，最终内存泄漏。<code>weak_ptr</code> 因不增加引用计数，可打破循环。</p>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">B</span>; <span class="hljs-comment">// 前向声明</span>

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">A</span> {
    std::shared_ptr&lt;B&gt; b_ptr;
    ~<span class="hljs-built_in">A</span>() { std::cout &lt;&lt; <span class="hljs-string">"A 析构"</span> &lt;&lt; std::endl; }
};

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">B</span> {
    std::shared_ptr&lt;A&gt; a_ptr; <span class="hljs-comment">// 循环引用</span>
    ~<span class="hljs-built_in">B</span>() { std::cout &lt;&lt; <span class="hljs-string">"B 析构"</span> &lt;&lt; std::endl; }
};

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    {
        std::shared_ptr&lt;A&gt; a = std::<span class="hljs-built_in">make_shared</span>&lt;A&gt;();
        std::shared_ptr&lt;B&gt; b = std::<span class="hljs-built_in">make_shared</span>&lt;B&gt;();
        a-&gt;b_ptr = b;
        b-&gt;a_ptr = a;
        <span class="hljs-comment">// 离开作用域时，a 和 b 的引用计数均为 2，无法析构</span>
    }
    std::cout &lt;&lt; <span class="hljs-string">"作用域结束"</span> &lt;&lt; std::endl; <span class="hljs-comment">// 输出，但 A/B 未析构</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>修改后</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">B</span>;</span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">A</span> {</span>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">shared_ptr</span>&lt;B&gt; b_ptr;
    ~A() { <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"A 析构"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>; }
};

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">B</span> {</span>
    <span class="hljs-built_in">std</span>::weak_ptr&lt;A&gt; a_ptr; <span class="hljs-comment">// 改为 weak_ptr，不增加引用计数</span>
    ~B() { <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"B 析构"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>; }
};

<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    {
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">shared_ptr</span>&lt;A&gt; a = <span class="hljs-built_in">std</span>::make_shared&lt;A&gt;();
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">shared_ptr</span>&lt;B&gt; b = <span class="hljs-built_in">std</span>::make_shared&lt;B&gt;();
        a-&gt;b_ptr = b;
        b-&gt;a_ptr = a;
        <span class="hljs-comment">// a 的引用计数：1（b-&gt;a_ptr 是 weak_ptr，不计数）</span>
        <span class="hljs-comment">// b 的引用计数：1（a-&gt;b_ptr 是 shared_ptr，计数+1）</span>
    }
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"作用域结束"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[NumPy数值计算全教程：多维数组操作、广播机制、线性代数运算（附实战案例）]]></title>    <link>https://juejin.cn/post/7583878719543984137</link>    <guid>https://juejin.cn/post/7583878719543984137</guid>    <pubDate>2025-12-15T12:37:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583878719543984137" data-draft-id="7583878719543967753" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="NumPy数值计算全教程：多维数组操作、广播机制、线性代数运算（附实战案例）"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2025-12-15T12:37:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AI能力探索"/> <meta itemprop="url" content="https://juejin.cn/user/1549641121016795"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            NumPy数值计算全教程：多维数组操作、广播机制、线性代数运算（附实战案例）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1549641121016795/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AI能力探索
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T12:37:30.000Z" title="Mon Dec 15 2025 12:37:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>NumPy是Python科学计算的核心库，以高性能的多维数组（ndarray）为基础，提供了丰富的数值计算功能，广泛应用于数据分析、机器学习、科学仿真等领域。</p>
<h2 data-id="heading-0">一、前期准备</h2>
<h3 data-id="heading-1">1. 环境配置</h3>
<ul>
<li>安装NumPy：<code>pip install numpy</code>（建议Python 3.8+版本）；</li>
<li>验证安装：在Python终端执行<code>import numpy as np</code>，无报错则安装成功；</li>
<li>辅助工具：Jupyter Notebook（便于分段运行代码、查看结果）。</li>
</ul>
<h3 data-id="heading-2">2. 核心概念梳理</h3>
<ul>
<li><strong>ndarray</strong>：NumPy的核心数据结构，即多维数组，支持同类型元素存储，比Python列表更高效；</li>
<li><strong>维度（ndim）</strong>：数组的轴数，如一维数组（1D）、二维数组（2D，矩阵）、三维数组（3D）；</li>
<li><strong>形状（shape）</strong>：数组各维度的元素个数，如<code>(3,4)</code>表示3行4列的二维数组；</li>
<li><strong>数据类型（dtype）</strong>：数组元素的类型，如<code>int32</code>、<code>float64</code>、<code>bool</code>；</li>
<li><strong>广播机制</strong>：不同形状数组间运算时，NumPy自动扩展数组维度以匹配形状的规则；</li>
<li><strong>线性代数</strong>：基于ndarray实现矩阵乘法、求逆、特征值、行列式等运算。</li>
</ul>
<h2 data-id="heading-3">二、实战1：多维数组核心操作</h2>
<p>多维数组是NumPy的基础，掌握创建、索引、变形、拼接等操作，是后续计算的前提。</p>
<h3 data-id="heading-4">1. 数组创建（常用方式）</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np

<span class="hljs-comment"># 1. 从列表/嵌套列表创建</span>
arr1 = np.array([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>])  <span class="hljs-comment"># 一维数组</span>
arr2 = np.array([[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>], [<span class="hljs-number">5</span>, <span class="hljs-number">6</span>]])  <span class="hljs-comment"># 二维数组（3行2列）</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"一维数组：\n"</span>, arr1)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"二维数组形状："</span>, arr2.shape)  <span class="hljs-comment"># 输出：(3, 2)</span>

<span class="hljs-comment"># 2. 特殊数组创建（实战高频）</span>
arr_zeros = np.zeros((<span class="hljs-number">2</span>, <span class="hljs-number">3</span>))  <span class="hljs-comment"># 全0数组（2行3列）</span>
arr_ones = np.ones((<span class="hljs-number">3</span>, <span class="hljs-number">3</span>), dtype=np.int32)  <span class="hljs-comment"># 全1数组，指定int32类型</span>
arr_empty = np.empty((<span class="hljs-number">2</span>, <span class="hljs-number">2</span>))  <span class="hljs-comment"># 空数组（内存随机值，仅占位）</span>
arr_range = np.arange(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">2</span>)  <span class="hljs-comment"># 等差数列：0,2,4,6,8</span>
arr_linspace = np.linspace(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>)  <span class="hljs-comment"># 等间隔数组：0,0.25,0.5,0.75,1</span>
arr_eye = np.eye(<span class="hljs-number">3</span>)  <span class="hljs-comment"># 单位矩阵（3x3）</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"单位矩阵：\n"</span>, arr_eye)
</code></pre>
<h3 data-id="heading-5">2. 数组索引与切片</h3>
<h4 data-id="heading-6">（1）一维数组（与Python列表类似）</h4>
<pre><code class="hljs language-python" lang="python">arr = np.arange(<span class="hljs-number">10</span>)
<span class="hljs-built_in">print</span>(arr[<span class="hljs-number">5</span>])  <span class="hljs-comment"># 索引：取第6个元素（5）</span>
<span class="hljs-built_in">print</span>(arr[<span class="hljs-number">2</span>:<span class="hljs-number">7</span>])  <span class="hljs-comment"># 切片：2-6（左闭右开）</span>
<span class="hljs-built_in">print</span>(arr[::<span class="hljs-number">2</span>])  <span class="hljs-comment"># 步长2：0,2,4,6,8</span>
</code></pre>
<h4 data-id="heading-7">（2）二维数组（行+列索引）</h4>
<pre><code class="hljs language-python" lang="python">arr = np.array([[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>], [<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>], [<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>]])
<span class="hljs-comment"># 取第2行第3列元素（6）</span>
<span class="hljs-built_in">print</span>(arr[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>])
<span class="hljs-comment"># 取第1行所有列</span>
<span class="hljs-built_in">print</span>(arr[<span class="hljs-number">0</span>, :])
<span class="hljs-comment"># 取所有行的第2列</span>
<span class="hljs-built_in">print</span>(arr[:, <span class="hljs-number">1</span>])
<span class="hljs-comment"># 取前2行、前2列</span>
<span class="hljs-built_in">print</span>(arr[:<span class="hljs-number">2</span>, :<span class="hljs-number">2</span>])
<span class="hljs-comment"># 布尔索引：筛选大于5的元素</span>
<span class="hljs-built_in">print</span>(arr[arr &gt; <span class="hljs-number">5</span>])  <span class="hljs-comment"># 输出：[6 7 8 9]</span>
</code></pre>
<h3 data-id="heading-8">3. 数组变形与重塑</h3>
<pre><code class="hljs language-python" lang="python">arr = np.arange(<span class="hljs-number">12</span>)
<span class="hljs-comment"># 重塑为3行4列</span>
arr_reshape = arr.reshape(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"重塑后：\n"</span>, arr_reshape)

<span class="hljs-comment"># 展平数组（多维转一维）</span>
arr_flat = arr_reshape.flatten()  <span class="hljs-comment"># 拷贝数据，原数组不变</span>
arr_ravel = arr_reshape.ravel()   <span class="hljs-comment"># 视图，原数组改变会同步</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"展平数组："</span>, arr_flat)

<span class="hljs-comment"># 转置（行变列，列变行）</span>
arr_trans = arr_reshape.T
<span class="hljs-built_in">print</span>(<span class="hljs-string">"转置后：\n"</span>, arr_trans)
</code></pre>
<h3 data-id="heading-9">4. 数组拼接与分割</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 拼接</span>
arr1 = np.array([[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>], [<span class="hljs-number">3</span>,<span class="hljs-number">4</span>]])
arr2 = np.array([[<span class="hljs-number">5</span>,<span class="hljs-number">6</span>], [<span class="hljs-number">7</span>,<span class="hljs-number">8</span>]])
<span class="hljs-comment"># 纵向拼接（行增加）</span>
arr_vstack = np.vstack((arr1, arr2))
<span class="hljs-comment"># 横向拼接（列增加）</span>
arr_hstack = np.hstack((arr1, arr2))
<span class="hljs-built_in">print</span>(<span class="hljs-string">"纵向拼接：\n"</span>, arr_vstack)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"横向拼接：\n"</span>, arr_hstack)

<span class="hljs-comment"># 分割</span>
arr = np.arange(<span class="hljs-number">9</span>).reshape(<span class="hljs-number">3</span>,<span class="hljs-number">3</span>)
<span class="hljs-comment"># 横向分割（按列分）</span>
arr_split1, arr_split2 = np.hsplit(arr, <span class="hljs-number">2</span>)
<span class="hljs-comment"># 纵向分割（按行分）</span>
arr_split3, arr_split4 = np.vsplit(arr, <span class="hljs-number">2</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"横向分割结果：\n"</span>, arr_split1)
</code></pre>
<h2 data-id="heading-10">三、实战2：广播机制（核心难点）</h2>
<p>广播是NumPy中不同形状数组间运算的核心规则，能避免手动扩展数组，提升计算效率。</p>
<h3 data-id="heading-11">1. 广播的核心规则</h3>
<ul>
<li>规则1：如果两个数组维度不同，先将维度少的数组补1，直到维度数相同；</li>
<li>规则2：对于每个维度，若长度相同或其中一个为1，则可以广播，否则报错；</li>
<li>规则3：广播时，长度为1的维度会被扩展为匹配另一个数组的长度。</li>
</ul>
<h3 data-id="heading-12">2. 基础广播案例</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 案例1：标量与数组运算（最常见）</span>
arr = np.array([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>])
result = arr + <span class="hljs-number">5</span>  <span class="hljs-comment"># 标量5广播为[5,5,5]</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"标量广播："</span>, result)  <span class="hljs-comment"># 输出：[6 7 8]</span>

<span class="hljs-comment"># 案例2：一维数组与二维数组运算</span>
arr1 = np.array([[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>], [<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>]])  <span class="hljs-comment"># (2,3)</span>
arr2 = np.array([<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>])        <span class="hljs-comment"># (3,) → 补1为(1,3) → 广播为(2,3)</span>
result = arr1 + arr2
<span class="hljs-built_in">print</span>(<span class="hljs-string">"一维+二维广播：\n"</span>, result)
<span class="hljs-comment"># 输出：</span>
<span class="hljs-comment"># [[11 22 33]</span>
<span class="hljs-comment">#  [14 25 36]]</span>

<span class="hljs-comment"># 案例3：不同维度广播（需满足规则）</span>
arr3 = np.array([[<span class="hljs-number">1</span>], [<span class="hljs-number">2</span>], [<span class="hljs-number">3</span>]])  <span class="hljs-comment"># (3,1)</span>
arr4 = np.array([<span class="hljs-number">10</span>, <span class="hljs-number">20</span>])         <span class="hljs-comment"># (2,) → 补1为(1,2) → 广播为(3,2)</span>
result = arr3 * arr4
<span class="hljs-built_in">print</span>(<span class="hljs-string">"不同维度广播：\n"</span>, result)
<span class="hljs-comment"># 输出：</span>
<span class="hljs-comment"># [[10 20]</span>
<span class="hljs-comment">#  [20 40]</span>
<span class="hljs-comment">#  [30 60]]</span>

<span class="hljs-comment"># 错误案例（不满足规则）</span>
<span class="hljs-comment"># arr5 = np.array([1,2])  # (2,)</span>
<span class="hljs-comment"># arr6 = np.array([[1,2,3], [4,5,6]])  # (2,3)</span>
<span class="hljs-comment"># result = arr5 + arr6  # 报错：维度不匹配</span>
</code></pre>
<h3 data-id="heading-13">3. 广播的实战应用（数据归一化）</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 对二维数组每行进行归一化：(值-均值)/标准差</span>
data = np.array([[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>], [<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>], [<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>]])
<span class="hljs-comment"># 计算每行均值（axis=1，保持维度便于广播）</span>
mean = np.mean(data, axis=<span class="hljs-number">1</span>, keepdims=<span class="hljs-literal">True</span>)
<span class="hljs-comment"># 计算每行标准差</span>
std = np.std(data, axis=<span class="hljs-number">1</span>, keepdims=<span class="hljs-literal">True</span>)
<span class="hljs-comment"># 广播运算</span>
normalized_data = (data - mean) / std
<span class="hljs-built_in">print</span>(<span class="hljs-string">"归一化后：\n"</span>, normalized_data)
<span class="hljs-comment"># 输出每行均值为0，标准差为1的数组</span>
</code></pre>
<h2 data-id="heading-14">四、实战3：线性代数运算（核心应用）</h2>
<p>NumPy的<code>numpy.linalg</code>模块提供了完整的线性代数运算接口，满足矩阵分析、线性方程组求解等需求。</p>
<h3 data-id="heading-15">1. 基础矩阵运算</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 矩阵乘法（注意：不是元素相乘）</span>
A = np.array([[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>], [<span class="hljs-number">3</span>,<span class="hljs-number">4</span>]])
B = np.array([[<span class="hljs-number">5</span>,<span class="hljs-number">6</span>], [<span class="hljs-number">7</span>,<span class="hljs-number">8</span>]])
<span class="hljs-comment"># 方法1：np.dot()（兼容一维/二维）</span>
dot_result = np.dot(A, B)
<span class="hljs-comment"># 方法2：@运算符（Python 3.5+，推荐）</span>
at_result = A @ B
<span class="hljs-built_in">print</span>(<span class="hljs-string">"矩阵乘法：\n"</span>, at_result)
<span class="hljs-comment"># 输出：</span>
<span class="hljs-comment"># [[19 22]</span>
<span class="hljs-comment">#  [43 50]]</span>

<span class="hljs-comment"># 元素相乘（与矩阵乘法区分）</span>
element_mul = A * B
<span class="hljs-built_in">print</span>(<span class="hljs-string">"元素相乘：\n"</span>, element_mul)
<span class="hljs-comment"># 输出：</span>
<span class="hljs-comment"># [[ 5 12]</span>
<span class="hljs-comment">#  [21 32]]</span>

<span class="hljs-comment"># 矩阵求逆（仅方阵且可逆）</span>
A_inv = np.linalg.inv(A)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"矩阵A的逆：\n"</span>, A_inv)

<span class="hljs-comment"># 矩阵转置</span>
A_trans = A.T
<span class="hljs-built_in">print</span>(<span class="hljs-string">"矩阵A的转置：\n"</span>, A_trans)

<span class="hljs-comment"># 行列式计算</span>
det_A = np.linalg.det(A)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"矩阵A的行列式："</span>, det_A)  <span class="hljs-comment"># 输出：-2.0000000000000004</span>
</code></pre>
<h3 data-id="heading-16">2. 线性方程组求解</h3>
<p>求解方程组：</p>
<pre><code class="hljs language-ini" lang="ini">x + <span class="hljs-attr">2y</span> = <span class="hljs-number">5</span>
3x + <span class="hljs-attr">4y</span> = <span class="hljs-number">13</span>
</code></pre>
<p>转化为矩阵形式：<code>Ax = b</code>，其中<code>A=[[1,2],[3,4]]</code>，<code>b=[5,13]</code>，求解<code>x</code>。</p>
<pre><code class="hljs language-python" lang="python">A = np.array([[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>], [<span class="hljs-number">3</span>,<span class="hljs-number">4</span>]])
b = np.array([<span class="hljs-number">5</span>, <span class="hljs-number">13</span>])
<span class="hljs-comment"># 求解线性方程组</span>
x = np.linalg.solve(A, b)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"方程组解：x={}, y={}"</span>.<span class="hljs-built_in">format</span>(x[<span class="hljs-number">0</span>], x[<span class="hljs-number">1</span>]))  <span class="hljs-comment"># 输出：x=3.0, y=1.0</span>

<span class="hljs-comment"># 验证：A @ x 应等于b</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"验证结果："</span>, A @ x)  <span class="hljs-comment"># 输出：[ 5. 13.]</span>
</code></pre>
<h3 data-id="heading-17">3. 特征值与特征向量</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 计算特征值和特征向量</span>
A = np.array([[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>], [<span class="hljs-number">3</span>,<span class="hljs-number">4</span>]])
eigenvalues, eigenvectors = np.linalg.eig(A)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"特征值："</span>, eigenvalues)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"特征向量：\n"</span>, eigenvectors)

<span class="hljs-comment"># 验证：A·v = λ·v（v为特征向量，λ为特征值）</span>
v = eigenvectors[:, <span class="hljs-number">0</span>]  <span class="hljs-comment"># 第一个特征向量</span>
lamda = eigenvalues[<span class="hljs-number">0</span>]  <span class="hljs-comment"># 第一个特征值</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"验证特征值："</span>, np.allclose(A @ v, lamda * v))  <span class="hljs-comment"># 输出：True</span>
</code></pre>
<h3 data-id="heading-18">4. 奇异值分解（SVD，实战高频）</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 奇异值分解（适用于非方阵）</span>
A = np.array([[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>], [<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>]])
U, S, VT = np.linalg.svd(A)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"U矩阵：\n"</span>, U)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"奇异值："</span>, S)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"VT矩阵：\n"</span>, VT)

<span class="hljs-comment"># 重构矩阵（验证SVD）</span>
<span class="hljs-comment"># 需将S转为对角矩阵</span>
S_mat = np.zeros((<span class="hljs-number">2</span>,<span class="hljs-number">3</span>))
S_mat[:<span class="hljs-number">2</span>, :<span class="hljs-number">2</span>] = np.diag(S)
A_recon = U @ S_mat @ VT
<span class="hljs-built_in">print</span>(<span class="hljs-string">"重构矩阵与原矩阵是否一致："</span>, np.allclose(A, A_recon))  <span class="hljs-comment"># 输出：True</span>
</code></pre>
<h2 data-id="heading-19">五、实战优化技巧</h2>
<h3 data-id="heading-20">1. 避免循环，用向量化运算</h3>
<p>NumPy向量化运算比Python循环快10~100倍，例如：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 低效：循环计算</span>
arr = np.arange(<span class="hljs-number">1000000</span>)
result = []
<span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> arr:
    result.append(x * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>)
result = np.array(result)

<span class="hljs-comment"># 高效：向量化运算</span>
result = arr * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>  <span class="hljs-comment"># 广播机制自动处理</span>
</code></pre>
<h3 data-id="heading-21">2. 数据类型优化</h3>
<p>默认<code>float64</code>精度高但占用内存，可根据需求改为<code>float32</code>：</p>
<pre><code class="hljs language-python" lang="python">arr = np.ones((<span class="hljs-number">1000</span>, <span class="hljs-number">1000</span>), dtype=np.float32)  <span class="hljs-comment"># 内存占用减少一半</span>
</code></pre>
<h3 data-id="heading-22">3. 避免拷贝，使用视图</h3>
<pre><code class="hljs language-python" lang="python">arr1 = arr.reshape(-<span class="hljs-number">1</span>)  <span class="hljs-comment"># -1自动计算维度，视图无拷贝</span>
arr2 = arr[:, ::<span class="hljs-number">2</span>]      <span class="hljs-comment"># 切片为视图，原数组修改会同步</span>
arr3 = arr.copy()       <span class="hljs-comment"># 仅需独立数据时拷贝</span>
</code></pre>
<h2 data-id="heading-23">六、常见问题与解决</h2>
<h3 data-id="heading-24">1. 广播报错：维度不匹配</h3>
<ul>
<li>排查：打印数组<code>shape</code>，确认是否满足广播规则；</li>
<li>解决：用<code>reshape</code>手动扩展维度，例如<code>arr = arr.reshape(-1, 1)</code>。</li>
</ul>
<h3 data-id="heading-25">2. 矩阵乘法与元素相乘混淆</h3>
<ul>
<li>区分：<code>A @ B</code>是矩阵乘法，<code>A * B</code>是元素相乘；</li>
<li>注意：矩阵乘法要求前一个数组列数=后一个数组行数。</li>
</ul>
<h3 data-id="heading-26">3. 求逆报错：奇异矩阵</h3>
<ul>
<li>原因：矩阵行列式为0，不可逆；</li>
<li>解决：检查矩阵是否正确，或使用伪逆<code>np.linalg.pinv(A)</code>。</li>
</ul>
<h3 data-id="heading-27">4. 精度问题</h3>
<ul>
<li>现象：浮点数运算出现<code>0.9999999999</code>而非<code>1</code>；</li>
<li>解决：用<code>np.allclose(a, b)</code>代替<code>a == b</code>比较数组。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用 SSE 单向推送实现 系统通知功能]]></title>    <link>https://juejin.cn/post/7583912899389210667</link>    <guid>https://juejin.cn/post/7583912899389210667</guid>    <pubDate>2025-12-15T13:26:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583912899389210667" data-draft-id="7583898823921254442" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用 SSE 单向推送实现 系统通知功能"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-15T13:26:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="cindershade"/> <meta itemprop="url" content="https://juejin.cn/user/2587590326494763"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用 SSE 单向推送实现 系统通知功能
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2587590326494763/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    cindershade
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T13:26:52.000Z" title="Mon Dec 15 2025 13:26:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">使用 SSE 单向推送实现 系统通知功能</h2>
<blockquote>
<p>说明：本说明基于自己毕设项目中“系统通知模块 (Notification / SSE)”的实现，重点讲清楚在前端从 **初始化环境 → 建立 SSE 连接 → 解析服务端事件 → 打印日志 ** 的完整技术链路，至于收到信息如何处理和具体项目有关。</p>
</blockquote>
<hr/>
<p>在我的毕设中，有系统通知这个功能，单向的，告诉用户，你的内容发布审核成功，或者失败等等一系列的单方面的通知，所有选型sse而不选择websorket
接下来先给出后端实现，然后是前端实现</p>
<h3 data-id="heading-1">后端实现 系统通知模块后端实现说明</h3>
<p>涉及的核心类：</p>
<ul>
<li><code>NotificationController</code>：通知相关 HTTP 接口（SSE 流、已读、未读数、分页列表）。</li>
<li><code>NotificationService</code>：通知的持久化、SSE 连接管理与推送实现。</li>
<li><code>Notification</code> / <code>notification</code> 表：通知实体与数据库表结构。</li>
<li><code>NotificationType</code> / <code>NotificationStatus</code>：通知类型与状态枚举（如 <code>PRIVATE_MESSAGE</code>）。</li>
</ul>
<hr/>
<h3 data-id="heading-2">一、建立 SSE 通知连接</h3>
<h4 data-id="heading-3">1. Controller：<code>GET /api/notify/stream</code></h4>
<ul>
<li><strong>接口类</strong>：<code>NotificationController</code></li>
<li><strong>方法</strong>：<code>stream(@RequestHeader(value = "Last-Event-ID", required = false) String lastEventId)</code></li>
<li><strong>路径</strong>：<code>/api/notify/stream</code></li>
<li><strong>作用</strong>：
<ul>
<li>校验当前用户是否已登录（从 <code>UserContext.getUserId()</code> 读取 userId）。</li>
<li>未登录时抛出 <code>401 UNAUTHORIZED</code>。</li>
<li>登录状态下，调用 <code>notificationService.connect(userId, lastEventId)</code> 建立 SSE 连接。</li>
</ul>
</li>
</ul>
<p>简要流程：</p>
<ol>
<li>从 <code>UserContext</code> 获取当前用户 ID。</li>
<li>若未登录：抛出 <code>ResponseStatusException(HttpStatus.UNAUTHORIZED)</code>。</li>
<li>若已登录：将 <code>userId</code> 与 <code>Last-Event-ID</code> 交给 <code>NotificationService.connect</code>。</li>
<li>返回 Spring 的 <code>SseEmitter</code> 对象，由框架维持 SSE 链接。</li>
</ol>
<h4 data-id="heading-4">2. Service：<code>NotificationService.connect</code></h4>
<ul>
<li><strong>方法签名</strong>：<code>public SseEmitter connect(Long userId, String lastEventId)</code></li>
<li><strong>内部逻辑</strong>：
<ol>
<li>创建一个 <code>SseEmitter</code> 实例，超时时间为 <code>SSE_TIMEOUT = 30 * 60 * 1000L</code>（30 分钟）。</li>
<li>将该 <code>SseEmitter</code> 加入到 <code>emitterPool</code> 中：
<ul>
<li><code>emitterPool</code> 类型为 <code>Map&lt;Long, CopyOnWriteArrayList&lt;SseEmitter&gt;&gt;</code>，按 <code>userId</code> 维护用户当前所有 SSE 连接。</li>
</ul>
</li>
<li>为 <code>emitter</code> 注册回调：
<ul>
<li><code>onCompletion</code> / <code>onTimeout</code> / <code>onError</code> 时，从 <code>emitterPool</code> 中移除当前连接。</li>
</ul>
</li>
<li>发送一次 <strong>心跳事件</strong>（<code>heartbeat</code>），名称为 <code>"heartbeat"</code>，数据为 <code>"ping"</code>。</li>
<li>解析 <code>Last-Event-ID</code>：
<ul>
<li>如果有合法的 <code>lastEventId</code>，解析为 <code>lastId</code>（<code>Long</code>）。</li>
<li>若解析失败或为空，则为 <code>null</code>。</li>
</ul>
</li>
<li>调用 <code>resendPending(userId, lastId, emitter)</code> 补发历史通知（最多 100 条）。</li>
<li>返回 <code>SseEmitter</code>，等待后续通知推送。</li>
</ol>
</li>
</ul>
<h4 data-id="heading-5">3. SSE 连接断开/超时</h4>
<ul>
<li>在 <code>connect</code> 方法中，对 <code>SseEmitter</code> 注册了：
<ul>
<li><code>onCompletion</code>：连接正常完成时调用 <code>removeEmitter(userId, emitter)</code>。</li>
<li><code>onTimeout</code>：连接超时时调用 <code>removeEmitter(userId, emitter)</code>。</li>
<li><code>onError</code>：发送异常等错误时调用 <code>removeEmitter(userId, emitter)</code>。</li>
</ul>
</li>
<li><code>removeEmitter</code> 会从 <code>emitterPool</code> 对应用户的列表中移除该 <code>SseEmitter</code>，防止内存泄漏与后续重复推送。</li>
</ul>
<hr/>
<h3 data-id="heading-6">二、通知的创建与推送</h3>
<h4 data-id="heading-7">1. 通用创建+推送：<code>NotificationService.createAndDispatch</code></h4>
<ul>
<li>
<p><strong>方法签名</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> Notification <span class="hljs-title function_">createAndDispatch</span><span class="hljs-params">(Long userId, NotificationType type, String title, String content, String payload)</span>
</code></pre>
</li>
<li>
<p><strong>调用方示例</strong>：</p>
<ul>
<li>私信业务中的离线提醒（<code>ChatServiceImpl</code>）。</li>
<li>管理员公告等其他业务模块。</li>
</ul>
</li>
<li>
<p><strong>执行流程</strong>：</p>
<ol>
<li>调用 <code>buildNotification(userId, type, title, content, payload)</code> 构造一个 <code>Notification</code> 实体：
<ul>
<li><code>userId</code>：接收通知的用户 ID。</li>
<li><code>type</code>：通知类型（如 <code>PRIVATE_MESSAGE</code>、<code>SYSTEM_ANNOUNCEMENT</code> 等）。</li>
<li><code>title</code>：通知标题/摘要。</li>
<li><code>content</code>：通知正文或简述。</li>
<li><code>payload</code>：扩展 JSON 字符串，用于前端跳转或展示更多信息。</li>
<li><code>status</code>：初始为 <code>UNREAD</code>。</li>
<li><code>createdAt</code> / <code>updatedAt</code>：为当前时间。</li>
</ul>
</li>
<li>通过 <code>notificationMapper.insert(notification)</code> 将通知写入 <code>notification</code> 表。</li>
<li>调用 <code>dispatch(notification)</code> 将该通知推送给所有当前在线的 SSE 连接。</li>
<li>返回持久化后的 <code>Notification</code> 对象。</li>
</ol>
</li>
</ul>
<h4 data-id="heading-8">2. 批量发送：<code>createAndDispatchBatch</code></h4>
<ul>
<li>
<p><strong>方法签名</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createAndDispatchBatch</span><span class="hljs-params">(List&lt;Long&gt; userIds, NotificationType type, String title, String content, String payload)</span>
</code></pre>
</li>
<li>
<p><strong>逻辑</strong>：对 <code>userIds</code> 逐个调用 <code>createAndDispatch</code>，用于对多用户广播同一类型通知（如系统公告或活动推送）。</p>
</li>
</ul>
<h4 data-id="heading-9">3. 通知推送：<code>NotificationService.dispatch</code></h4>
<ul>
<li><strong>方法签名</strong>：<code>public void dispatch(Notification notification)</code></li>
<li><strong>执行流程</strong>：
<ol>
<li>从 <code>emitterPool</code> 中取出该通知对应 <code>userId</code> 的所有 <code>SseEmitter</code> 列表。</li>
<li>若列表为空，说明用户此时没有打开 SSE 通道，方法直接返回（仅数据库中保留通知记录，后续建立连接时再补发）。</li>
<li>遍历每个 <code>SseEmitter</code>，调用：
<ul>
<li><code>emitter.send(SseEmitter.event().id(String.valueOf(notification.getId())).name(notification.getType()).data(notification))</code>：
<ul>
<li><code>id</code>：使用通知 ID（字符串形式），用于客户端的 <code>Last-Event-ID</code> 与断点续传。</li>
<li><code>name</code>：使用 <code>notification.getType()</code>，即 <code>NotificationType</code> 的枚举名（如 <code>PRIVATE_MESSAGE</code>）。</li>
<li><code>data</code>：整个 <code>Notification</code> 对象（前端接收后可按 <code>NotificationVO</code> 解析）。</li>
</ul>
</li>
</ul>
</li>
<li>如果发送过程中抛出 <code>IOException</code>，记录日志并调用 <code>removeEmitter</code> 移除当前失效连接。</li>
</ol>
</li>
</ul>
<h4 data-id="heading-10">4. 历史通知补发：<code>NotificationService.resendPending</code></h4>
<ul>
<li><strong>方法签名</strong>：<code>private void resendPending(Long userId, Long lastId, SseEmitter emitter)</code></li>
<li><strong>补发策略</strong>：
<ul>
<li>若 <code>lastId != null</code>：补发 <strong>ID 大于 <code>lastId</code></strong> 的所有通知。</li>
<li>若 <code>lastId == null</code>：补发 <strong>所有未读（<code>status = UNREAD</code>）通知</strong>。</li>
<li>均按 ID 升序排序，<code>LIMIT 1</code> 条，只是补发过最新一条数据，列表通过数据库查询。</li>
</ul>
</li>
<li>通知通过 <code>SseEmitter.event().id(...).name(...).data(...)</code> 发送，与实时推送一致。</li>
</ul>
<hr/>
<h3 data-id="heading-11">三、通知的已读、未读与统计</h3>
<h4 data-id="heading-12">1. 标记已读：<code>POST /api/notify/read</code></h4>
<h5 data-id="heading-13">Controller：<code>NotificationController.markRead</code></h5>
<ul>
<li><strong>路径</strong>：<code>/api/notify/read</code></li>
<li><strong>请求体</strong>：<code>NotificationReadRequest</code>，包含：
<ul>
<li><code>notificationIds</code>（可选）：要标记为已读的通知 ID 列表。</li>
<li><code>upToId</code>（可选）：将 <code>id &lt;= upToId</code> 的通知全部标记为已读。</li>
</ul>
</li>
<li><strong>控制器逻辑</strong>：
<ol>
<li>从 <code>UserContext</code> 获取当前用户 ID，未登录返回 <code>Result.unauthorized("未登录")</code>。</li>
<li>调用 <code>notificationService.markAsRead(userId, notificationIds, upToId)</code> 执行更新。</li>
<li>再调用 <code>notificationService.countUnread(userId)</code> 获取最新未读数量。</li>
<li>返回 <code>Result.success(unread)</code>。</li>
</ol>
</li>
</ul>
<h5 data-id="heading-14">Service：<code>NotificationService.markAsRead</code></h5>
<ul>
<li><strong>方法签名</strong>：<code>public void markAsRead(Long userId, List&lt;Long&gt; notificationIds, Long upToId)</code></li>
<li><strong>执行逻辑</strong>：
<ol>
<li>若 <code>notificationIds</code> 为空且 <code>upToId == null</code>，直接返回，不做更新。</li>
<li>创建 <code>LambdaUpdateWrapper&lt;Notification&gt;</code>：
<ul>
<li><code>eq(Notification::getUserId, userId)</code>：只更新当前用户的通知。</li>
<li><code>eq(Notification::getStatus, NotificationStatus.UNREAD.name())</code>：只处理未读通知。</li>
<li>若 <code>notificationIds</code> 不为空：<code>in(Notification::getId, notificationIds)</code>。</li>
<li>若 <code>upToId</code> 不为 <code>null</code>：<code>le(Notification::getId, upToId)</code>。</li>
</ul>
</li>
<li><code>set(Notification::getStatus, NotificationStatus.READ.name())</code>。</li>
<li>执行 <code>notificationMapper.update(null, wrapper)</code> 完成批量更新。</li>
</ol>
</li>
</ul>
<h4 data-id="heading-15">2. 未读数量统计：<code>GET /api/notify/unread-count</code></h4>
<h5 data-id="heading-16">Controller：<code>NotificationController.unreadCount</code></h5>
<ul>
<li><strong>路径</strong>：<code>/api/notify/unread-count</code></li>
<li><strong>逻辑</strong>：
<ol>
<li>从 <code>UserContext</code> 获取当前用户 ID，未登录返回 <code>Result.unauthorized("未登录")</code>。</li>
<li>调用 <code>notificationService.countUnread(userId)</code> 获取未读数量。</li>
<li>返回 <code>Result.success(unread)</code>。</li>
</ol>
</li>
</ul>
<h5 data-id="heading-17">Service：<code>NotificationService.countUnread</code></h5>
<ul>
<li><strong>方法签名</strong>：<code>public long countUnread(Long userId)</code></li>
<li><strong>逻辑</strong>：
<ul>
<li>使用 <code>LambdaQueryWrapper&lt;Notification&gt;</code>：
<ul>
<li><code>eq(Notification::getUserId, userId)</code></li>
<li><code>eq(Notification::getStatus, NotificationStatus.UNREAD.name())</code></li>
</ul>
</li>
<li>调用 <code>notificationMapper.selectCount(wrapper)</code> 返回未读总数。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-18">3. 最近未读列表：<code>GET /api/notify/recent</code></h4>
<ul>
<li><strong>路径</strong>：<code>/api/notify/recent</code></li>
<li><strong>说明</strong>：用于调试或前端恢复，获取当前用户最近未读通知（最多 100 条）。</li>
<li><strong>Service 方法</strong>：<code>public List&lt;Notification&gt; recentUnread(Long userId)</code>
<ul>
<li>条件：
<ul>
<li><code>userId</code> 匹配当前用户；</li>
<li><code>status = UNREAD</code>；</li>
</ul>
</li>
<li>排序：<code>createdAt</code> 倒序；</li>
<li><code>last("LIMIT 100")</code> 限制数量。</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-19">四、通知分页列表接口</h3>
<h4 data-id="heading-20">1. 接口：<code>GET /api/notify/list</code></h4>
<h5 data-id="heading-21">Controller：<code>NotificationController.list</code></h5>
<ul>
<li><strong>路径</strong>：<code>/api/notify/list</code></li>
<li><strong>入参（Query）</strong>：
<ul>
<li><code>page</code>：页码，默认 <code>1</code>。</li>
<li><code>pageSize</code>：每页数量，默认 <code>10</code>。</li>
<li><code>status</code>：可选，<code>UNREAD</code> / <code>READ</code> / <code>ALL</code>，默认 <code>ALL</code>（不传时也视为 <code>ALL</code>）。</li>
</ul>
</li>
<li><strong>流程</strong>：
<ol>
<li>从 <code>UserContext</code> 获取当前用户 ID，未登录返回 <code>Result.unauthorized("未登录")</code>。</li>
<li>调用 <code>notificationService.listNotifications(userId, page, pageSize, status)</code>。</li>
<li>返回 <code>Result.success(Page&lt;NotificationVO&gt;)</code>，分页结构与项目统一（<code>total/size/current/pages/records</code> 等）。</li>
</ol>
</li>
</ul>
<h5 data-id="heading-22">Service：<code>NotificationService.listNotifications</code></h5>
<ul>
<li><strong>方法签名</strong>：<code>public Page&lt;NotificationVO&gt; listNotifications(Long userId, int page, int pageSize, String status)</code></li>
<li><strong>实现思路</strong>：
<ol>
<li>构造 <code>Page&lt;Notification&gt; pageParam = new Page&lt;&gt;(page, pageSize)</code>。</li>
<li>构造 <code>LambdaQueryWrapper&lt;Notification&gt; wrapper</code>：
<ul>
<li><code>eq(Notification::getUserId, userId)</code>。</li>
<li>若 <code>status</code> 非空且不是 <code>"ALL"</code>：<code>eq(Notification::getStatus, status.toUpperCase())</code>。</li>
<li><code>orderByDesc(Notification::getCreatedAt)</code>。</li>
</ul>
</li>
<li><code>notificationMapper.selectPage(pageParam, wrapper)</code> 得到 <code>notificationPage</code>。</li>
<li>手动构造 <code>Page&lt;NotificationVO&gt; voPage = new Page&lt;&gt;(page, pageSize, notificationPage.getTotal())</code>：
<ul>
<li>遍历 <code>notificationPage.getRecords()</code>，将每条记录映射为 <code>NotificationVO</code>：
<ul>
<li>复制 <code>id/userId/type/title/content/payload/status/createdAt</code> 等字段。</li>
</ul>
</li>
<li><code>voPage.setRecords(records)</code>。</li>
</ul>
</li>
<li>返回 <code>voPage</code>。</li>
</ol>
</li>
</ul>
<hr/>
<h3 data-id="heading-23">五、与私信模块的集成（离线私信提醒）</h3>
<h4 data-id="heading-24">1. 场景描述</h4>
<p>当用户 A 给用户 B 发送一对一私信时：</p>
<ul>
<li>如果 B 当前通过 WebSocket 在线（有 <code>chat:online:{userId}</code> 标记）：
<ul>
<li>只依赖聊天模块的实时消息推送（STOMP <code>/topic/chat/{sessionId}</code>）。</li>
</ul>
</li>
<li>如果 B 不在线（没有在线标记）：
<ul>
<li>在聊天消息正常写入 <code>chat_message</code> 表的基础上，<strong>额外</strong>为 B 创建一条 <code>PRIVATE_MESSAGE</code> 类型的系统通知，写入 <code>notification</code> 表并通过 SSE 推送/补发。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-25">2. 关键实现：<code>ChatServiceImpl.sendMessage</code></h4>
<ul>
<li>在创建 <code>ChatMessage</code> 并更新 <code>ChatSession.updatedAt</code> 后：
<ol>
<li>判断当前会话是否为单聊：<code>"single".equalsIgnoreCase(session.getSessionType())</code>。</li>
<li>查询该会话中“对方成员” (<code>ChatSessionMember</code>，<code>userId != 发送者</code>) 获取 <code>targetUserId</code>。</li>
<li>根据 <code>RedisConstants.CHAT_ONLINE_PREFIX + targetUserId</code> 从 Redis 中读取在线标记：
<ul>
<li>若存在值：认为对方在线，不额外生成通知。</li>
<li>若不存在值：认为对方离线，进入通知创建逻辑。</li>
</ul>
</li>
<li>离线场景下：
<ul>
<li>查询发送者用户信息，取昵称或用户名作为 <code>senderName</code>。</li>
<li>构造标题 <code>title = "收到一条新的私信"</code>。</li>
<li>构造预览 <code>preview = content</code> 的前若干字符（超长截断）。</li>
<li>构造 <code>payload</code> JSON 字符串：包含 <code>sessionId</code>、<code>messageId</code>、<code>senderId</code>、<code>senderName</code>，供前端跳转使用。</li>
<li>调用 <code>notificationService.createAndDispatch(targetUserId, NotificationType.PRIVATE_MESSAGE, title, preview, payload)</code>：
<ul>
<li>将通知写入 <code>notification</code> 表。</li>
<li>若 B 此时已经建立 SSE 连接，会立刻收到一条 <code>PRIVATE_MESSAGE</code> 事件。</li>
<li>若 B 之后才建立 SSE 连接，会通过补发逻辑 <code>resendPending</code> 收到历史通知。</li>
</ul>
</li>
</ul>
</li>
</ol>
</li>
</ul>
<hr/>
<h3 data-id="heading-26">前端实现  前端 SSE 通知实现说明（从 0 到看到控制台日志）</h3>
<h3 data-id="heading-27">一、相关文件总览</h3>
<ul>
<li><code>vite.config.js</code>
<ul>
<li>开发环境代理配置：<code>/api</code> → 后端 <code>VITE_API_BASE_URL</code>。</li>
</ul>
</li>
<li><code>src/main.js</code>
<ul>
<li>应用启动时初始化用户状态并根据登录态初始化通知 SSE。</li>
</ul>
</li>
<li><code>src/utils/notificationStream.js</code>
<ul>
<li><strong>SSE 连接和消息解析的核心逻辑（基于 fetch + ReadableStream，自实现 EventSource）。</strong></li>
</ul>
</li>
<li><code>src/stores/notification.js</code>
<ul>
<li>通知相关 Pinia Store，管理未读数量、通知列表和 SSE 状态。</li>
</ul>
</li>
<li><code>src/components/Header/index.vue</code>
<ul>
<li>顶部 Header，展示通知铃铛和未读红点。</li>
</ul>
</li>
<li><code>src/pages/UserCenter/pages/Notifications/index.vue</code>
<ul>
<li>用户中心「消息通知」页面，展示通知列表。</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-28">二、环境与代理（为什么开发环境不直接跨域）</h3>
<h4 data-id="heading-29">2.1 Vite 代理配置</h4>
<p><code>vite.config.js</code> 中开发环境的核心代理配置：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-attr">server</span>: {
  <span class="hljs-attr">port</span>: <span class="hljs-number">3003</span>,
  <span class="hljs-attr">host</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">cors</span>: <span class="hljs-literal">true</span>,
  ...(isDev &amp;&amp; {
    <span class="hljs-attr">proxy</span>: {
      <span class="hljs-string">'/api'</span>: {
        <span class="hljs-attr">target</span>: env.<span class="hljs-property">VITE_API_BASE_URL</span> || <span class="hljs-string">'http://localhost:8080'</span>,
        <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">rewrite</span>: <span class="hljs-function">(<span class="hljs-params">path</span>) =&gt;</span> path.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/^\/api/</span>, <span class="hljs-string">''</span>)
      }
    }
  })
}
</code></pre>
<p>关键点：</p>
<ul>
<li>浏览器访问的是 <code>http://localhost:3003</code>（前端 dev server）。</li>
<li>任何以 <code>/api</code> 开头的请求都会被 Vite 转发到 <code>VITE_API_BASE_URL</code> 对应的后端，例如：
<ul>
<li>浏览器：<code>/api/api/notify/stream</code></li>
<li>Vite rewrite：去掉第一个 <code>/api</code>，转成 <code>/api/notify/stream</code></li>
<li>后端实际收到：<code>http://127.0.0.1:8081/api/notify/stream</code>（和后端文档一致）。</li>
</ul>
</li>
<li>对浏览器来说始终是 <strong>同源 (3003)</strong>，不会触发 CORS 校验，跨域问题由 dev server 帮我们挡在背后。</li>
</ul>
<hr/>
<h3 data-id="heading-30">三、应用入口：在什么时机建立 SSE 连接？</h3>
<h4 data-id="heading-31">3.1 <code>src/main.js</code></h4>
<p>在 <code>main.js</code> 中：</p>
<ol>
<li>创建应用实例并挂载 Pinia / Router / UI 库。</li>
<li>初始化用户状态（从 localStorage 恢复登录态）：</li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>)

app.<span class="hljs-title function_">use</span>(pinia)
app.<span class="hljs-title function_">use</span>(router)
<span class="hljs-comment">// ...</span>

<span class="hljs-keyword">const</span> userStore = <span class="hljs-title function_">useUserStore</span>()
<span class="hljs-keyword">const</span> notificationStore = <span class="hljs-title function_">useNotificationStore</span>()

userStore.<span class="hljs-title function_">initUserState</span>()
</code></pre>
<ol start="3">
<li>当恢复登录状态后，如果用户已登录，立即初始化通知 SSE，并获取一次未读数量：</li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">if</span> (userStore.<span class="hljs-property">isLogin</span>) {
  <span class="hljs-title function_">initNotificationStream</span>()
  notificationStore.<span class="hljs-title function_">fetchUnreadCount</span>()
}
</code></pre>
<ol start="4">
<li>同时监听登录状态变化，自动处理连接的建立和关闭：</li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">watch</span>(
  <span class="hljs-function">() =&gt;</span> userStore.<span class="hljs-property">isLogin</span>,
  <span class="hljs-function">(<span class="hljs-params">isLogin</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (isLogin) {
      <span class="hljs-title function_">initNotificationStream</span>()
      notificationStore.<span class="hljs-title function_">fetchUnreadCount</span>()
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-title function_">closeNotificationStream</span>()
      notificationStore.<span class="hljs-title function_">reset</span>()
    }
  }
)
</code></pre>
<p><strong>结论：</strong></p>
<ul>
<li>应用启动时，如果用户已登录 → 自动建立 SSE 连接。</li>
<li>用户登录成功 → 自动建立连接。</li>
<li>用户登出或 token 失效 → 自动关闭连接并清空通知状态。</li>
</ul>
<hr/>
<h3 data-id="heading-32">四、SSE 核心：<code>notificationStream.js</code> 中的连接与解析</h3>
<h4 data-id="heading-33">4.1 连接地址</h4>
<pre><code class="hljs language-bash" lang="bash">/api/api/notify/stream
</code></pre>
<p>说明：</p>
<ul>
<li>浏览器视角：<code>http://localhost:3003/api/api/notify/stream</code>（同源）。</li>
<li>Vite 代理：去掉第一个 <code>/api</code> → <code>/api/notify/stream</code>。</li>
<li>后端视角：<code>http://127.0.0.1:8081/api/notify/stream</code>（与接口文档一致）。</li>
</ul>
<h4 data-id="heading-34">4.2 建立 SSE 连接</h4>
<p><code>initNotificationStream</code> 负责发起连接：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">initNotificationStream</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span> === <span class="hljs-string">'undefined'</span>) <span class="hljs-keyword">return</span>
  <span class="hljs-keyword">if</span> (reading) <span class="hljs-keyword">return</span> <span class="hljs-comment">// 已在读流则不重复建立</span>

  <span class="hljs-keyword">const</span> userStore = <span class="hljs-title function_">useUserStore</span>()
  <span class="hljs-keyword">const</span> notificationStore = <span class="hljs-title function_">useNotificationStore</span>()

  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> sseUrl = <span class="hljs-string">'/api/api/notify/stream'</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'[SSE] 准备建立连接:'</span>, sseUrl)

    abortController = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbortController</span>()
    reading = <span class="hljs-literal">true</span>
    notificationStore.<span class="hljs-title function_">setSseConnected</span>(<span class="hljs-literal">true</span>)

    <span class="hljs-title function_">fetch</span>(sseUrl, {
      <span class="hljs-attr">method</span>: <span class="hljs-string">'GET'</span>,
      <span class="hljs-attr">headers</span>: {
        <span class="hljs-title class_">Accept</span>: <span class="hljs-string">'text/event-stream'</span>,
        <span class="hljs-string">'Cache-Control'</span>: <span class="hljs-string">'no-cache'</span>,
        ...(userStore.<span class="hljs-property">token</span>
          ? { <span class="hljs-title class_">Authorization</span>: <span class="hljs-string">`Bearer <span class="hljs-subst">${userStore.token}</span>`</span> }
          : {})
      },
      <span class="hljs-attr">credentials</span>: <span class="hljs-string">'include'</span>,
      <span class="hljs-attr">signal</span>: abortController.<span class="hljs-property">signal</span>
    })
      .<span class="hljs-title function_">then</span>(<span class="hljs-comment">/* 处理响应与读流 */</span>)
      .<span class="hljs-keyword">catch</span>(<span class="hljs-comment">/* 错误处理 */</span>)
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-comment">// ...</span>
  }
}
</code></pre>
<p>关键点：</p>
<ul>
<li>使用原生 <code>fetch</code> 而不是 <code>EventSource</code>，是因为需要自定义 <code>Authorization</code> 头。</li>
<li>通过 <code>Authorization: Bearer &lt;token&gt;</code> 携带登录状态，兼容后端鉴权逻辑。</li>
<li><code>credentials: 'include'</code> 保留 Cookie 信息（如果后端需要）。</li>
</ul>
<h4 data-id="heading-35">4.3 处理 HTTP 响应并输出基础日志</h4>
<pre><code class="hljs language-js" lang="js">.<span class="hljs-title function_">then</span>(<span class="hljs-keyword">async</span> (response) =&gt; {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'[SSE] 响应状态:'</span>, response.<span class="hljs-property">status</span>, response.<span class="hljs-property">statusText</span>)
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'[SSE] 响应头 content-type:'</span>, response.<span class="hljs-property">headers</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'content-type'</span>))

  <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span> || !response.<span class="hljs-property">body</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`SSE 连接失败: <span class="hljs-subst">${response.status}</span>`</span>)
  }

  <span class="hljs-keyword">const</span> reader = response.<span class="hljs-property">body</span>.<span class="hljs-title function_">getReader</span>()
  <span class="hljs-keyword">const</span> decoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextDecoder</span>(<span class="hljs-string">'utf-8'</span>)
  <span class="hljs-keyword">let</span> buffer = <span class="hljs-string">''</span>

  <span class="hljs-comment">// 持续读流...</span>
})
</code></pre>
<p>此时在浏览器控制台可以看到：</p>
<ul>
<li><code>[SSE] 响应状态: 200 OK</code></li>
<li><code>[SSE] 响应头 content-type: text/event-stream;charset=UTF-8</code></li>
</ul>
<h4 data-id="heading-36">4.4 持续读取 SSE 流并解析事件</h4>
<p>核心循环逻辑：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
  <span class="hljs-keyword">const</span> { done, value } = <span class="hljs-keyword">await</span> reader.<span class="hljs-title function_">read</span>()
  <span class="hljs-keyword">if</span> (done) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'[SSE] 流已结束'</span>)
    <span class="hljs-keyword">break</span>
  }

  buffer += decoder.<span class="hljs-title function_">decode</span>(value, { <span class="hljs-attr">stream</span>: <span class="hljs-literal">true</span> })
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'[SSE] 收到原始 chunk:'</span>, buffer)

  <span class="hljs-comment">// 根据 \n\n 切分事件块</span>
  <span class="hljs-keyword">const</span> events = buffer.<span class="hljs-title function_">split</span>(<span class="hljs-string">'\n\n'</span>)
  buffer = events.<span class="hljs-title function_">pop</span>() || <span class="hljs-string">''</span>

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> rawEvent <span class="hljs-keyword">of</span> events) {
    <span class="hljs-keyword">const</span> lines = rawEvent.<span class="hljs-title function_">split</span>(<span class="hljs-string">'\n'</span>)
    <span class="hljs-keyword">let</span> eventType = <span class="hljs-string">'message'</span>
    <span class="hljs-keyword">let</span> data = <span class="hljs-string">''</span>
    <span class="hljs-keyword">let</span> lastEventId = <span class="hljs-literal">null</span>

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> line <span class="hljs-keyword">of</span> lines) {
      <span class="hljs-keyword">if</span> (line.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'event:'</span>)) {
        eventType = line.<span class="hljs-title function_">slice</span>(<span class="hljs-number">6</span>).<span class="hljs-title function_">trim</span>()
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (line.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'data:'</span>)) {
        data += line.<span class="hljs-title function_">slice</span>(<span class="hljs-number">5</span>).<span class="hljs-title function_">trim</span>()
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (line.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'id:'</span>)) {
        lastEventId = line.<span class="hljs-title function_">slice</span>(<span class="hljs-number">3</span>).<span class="hljs-title function_">trim</span>()
      }
    }

    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'[SSE] 解析到事件:'</span>, {
      eventType,
      lastEventId,
      data,
      rawEvent
    })

    <span class="hljs-keyword">if</span> (lastEventId) {
      notificationStore.<span class="hljs-title function_">setLastEventId</span>(lastEventId)
    }

    <span class="hljs-keyword">if</span> (eventType === <span class="hljs-string">'heartbeat'</span>) <span class="hljs-keyword">continue</span>
    <span class="hljs-keyword">if</span> (!data) <span class="hljs-keyword">continue</span>

    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> parsed = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(data)
      notificationStore.<span class="hljs-title function_">handleIncomingNotification</span>(parsed)
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'解析通知 SSE 消息失败:'</span>, error, data)
    }
  }
}
</code></pre>
<p><strong>控制台能看到的典型日志（以 PRIVATE_MESSAGE 为例）：</strong></p>
<ul>
<li><code>[SSE] 收到原始 chunk: id:21\nevent:PRIVATE_MESSAGE\ndata:{"id":21,"userId":3,"type":"PRIVATE_MESSAGE",...}\n\n</code></li>
<li><code>[SSE] 解析到事件: { eventType: 'PRIVATE_MESSAGE', lastEventId: '21', data: '{"id":21,"userId":3,"type":"PRIVATE_MESSAGE",...}', rawEvent: 'id:21\nevent:PRIVATE_MESSAGE\ndata:{"id":21,...}' }</code></li>
</ul>
<hr/>
<h3 data-id="heading-37">五、通知 Store：如何消费和存储 SSE 消息</h3>
<p>文件：<code>src/stores/notification.js</code></p>
<h4 data-id="heading-38">5.1 状态结构</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-attr">state</span>: <span class="hljs-function">() =&gt;</span> ({
  <span class="hljs-attr">unreadCount</span>: <span class="hljs-number">0</span>,
  <span class="hljs-attr">notifications</span>: [],
  <span class="hljs-attr">pagination</span>: {
    <span class="hljs-attr">total</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">size</span>: <span class="hljs-number">10</span>,
    <span class="hljs-attr">current</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">pages</span>: <span class="hljs-number">0</span>
  },
  <span class="hljs-attr">loadingList</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-attr">loadingUnread</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-attr">sseConnected</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-attr">lastEventId</span>: <span class="hljs-literal">null</span>
})
</code></pre>
<h4 data-id="heading-39">5.2 处理 SSE 推送的新通知</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">handleIncomingNotification</span>(<span class="hljs-params">notification</span>) {
  <span class="hljs-keyword">if</span> (!notification || !notification.<span class="hljs-property">id</span>) {
    <span class="hljs-comment">// 当前约定：必须有 id 才认为是有效通知</span>
    <span class="hljs-keyword">return</span>
  }

  <span class="hljs-keyword">const</span> exists = <span class="hljs-variable language_">this</span>.<span class="hljs-property">notifications</span>.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">id</span> === notification.<span class="hljs-property">id</span>)
  <span class="hljs-keyword">if</span> (!exists) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">notifications</span> = [notification, ...<span class="hljs-variable language_">this</span>.<span class="hljs-property">notifications</span>]
  }

  <span class="hljs-comment">// 未显式标记为 READ 的，都算未读</span>
  <span class="hljs-keyword">if</span> (!notification.<span class="hljs-property">status</span> || notification.<span class="hljs-property">status</span> === <span class="hljs-string">'UNREAD'</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">unreadCount</span> += <span class="hljs-number">1</span>
  }
}
</code></pre>
<p><strong>效果：</strong></p>
<ul>
<li>每一条从 SSE 收到的 JSON 通知（包含 <code>id</code> 字段）会被添加到 <code>notifications</code> 列表顶部。</li>
<li>未读数量 <code>unreadCount</code> 会自增，用于 Header 红点等 UI 展示。</li>
</ul>
<hr/>
<h3 data-id="heading-40">六、UI 展示：从 Store 到页面/控制台</h3>
<h4 data-id="heading-41">6.1 Header 铃铛红点</h4>
<p>文件：<code>src/components/Header/index.vue</code></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> notificationStore = <span class="hljs-title function_">useNotificationStore</span>()
<span class="hljs-keyword">const</span> hasUnread = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> notificationStore.<span class="hljs-property">unreadCount</span> &gt; <span class="hljs-number">0</span>)
</code></pre>
<p>在模板中：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;button class="gridButton" @click="handleNotificationClick"&gt;
  &lt;span style="position: relative; display: inline-block;"&gt;
    &lt;i class="fas fa-bell text-lg"&gt;&lt;/i&gt;
    &lt;span v-if="hasUnread" class="unreadBadge"&gt;&lt;/span&gt;
  &lt;/span&gt;
&lt;/button&gt;
</code></pre>
<p>当 SSE 收到任意一条未读通知：</p>
<ul>
<li><code>handleIncomingNotification</code> → <code>unreadCount++</code></li>
<li><code>hasUnread</code> 变为 <code>true</code></li>
<li><code>unreadBadge</code> 渲染，小红点点亮。</li>
</ul>
<h4 data-id="heading-42">6.2 用户中心「消息通知」页面</h4>
<p>文件：<code>src/pages/UserCenter/pages/Notifications/index.vue</code></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> notificationStore = <span class="hljs-title function_">useNotificationStore</span>()

<span class="hljs-keyword">const</span> notifications = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> notificationStore.<span class="hljs-property">notifications</span>)
<span class="hljs-keyword">const</span> loading = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> notificationStore.<span class="hljs-property">loadingList</span>)
</code></pre>
<p>首次进入页面时，会从后端拉一次历史通知列表：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  notificationStore.<span class="hljs-title function_">fetchNotifications</span>({
    <span class="hljs-attr">page</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">pageSize</span>: <span class="hljs-number">10</span>,
    <span class="hljs-attr">status</span>: <span class="hljs-string">'ALL'</span>
  })
})
</code></pre>
<p>当 SSE 推送新通知时：</p>
<ul>
<li>Store 的 <code>notifications</code> 首元素会是最新一条；</li>
<li>此页面会自动响应式更新，用户可以点击查看并标记为已读。</li>
</ul>
<hr/>
<h3 data-id="heading-43">最后、小结</h3>
<ol>
<li><strong>建立连接</strong>：<code>/api/notify/stream</code> → <code>NotificationService.connect</code> → 维护 <code>emitterPool</code> + 心跳 + 历史补发。</li>
<li><strong>创建通知</strong>：各业务（如私信模块）调用 <code>NotificationService.createAndDispatch</code>，将通知写入 <code>notification</code> 表并尝试通过 SSE 推送。</li>
<li><strong>接收与补发</strong>：在线用户通过 SSE 立即收到通知；离线用户下次连接时通过 <code>Last-Event-ID</code> 或未读筛选补发（最多 100 条）。</li>
<li><strong>已读/未读管理</strong>：<code>/api/notify/read</code> 和 <code>/api/notify/unread-count</code> 负责已读标记与未读统计。</li>
<li><strong>列表与分页</strong>：<code>/api/notify/recent</code> 提供最近未读调试接口；<code>/api/notify/list</code> 提供按状态过滤的分页通知列表。</li>
<li><strong>私信集成</strong>：<code>ChatServiceImpl</code> 在单聊离线场景下，为接收方生成 <code>PRIVATE_MESSAGE</code> 通知，实现“有人给你发私信”类型的系统提示。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🎯 Rect 中鼠标移动拾取元素可行性架构分析]]></title>    <link>https://juejin.cn/post/7583952017674190899</link>    <guid>https://juejin.cn/post/7583952017674190899</guid>    <pubDate>2025-12-16T01:46:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583952017674190899" data-draft-id="7583933107689701439" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🎯 Rect 中鼠标移动拾取元素可行性架构分析"/> <meta itemprop="keywords" content="前端,架构,React.js"/> <meta itemprop="datePublished" content="2025-12-16T01:46:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeonGao"/> <meta itemprop="url" content="https://juejin.cn/user/3976252950591149"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🎯 Rect 中鼠标移动拾取元素可行性架构分析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3976252950591149/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeonGao
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T01:46:15.000Z" title="Tue Dec 16 2025 01:46:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body{overflow:hidden;line-height:1.75;font-size:15px;background-image:linear-gradient(90deg,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0),linear-gradient(1turn,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0);background-size:20px 20px;background-position:50%;padding-top:0!important}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{position:relative;display:flex;border-bottom:5px solid #6d4e00;line-height:35px;letter-spacing:1px;font-size:25px;padding-left:25px;color:#664900;text-shadow:1px 1px 1px #8a6200;padding-bottom:0}.markdown-body h1:before{content:"";display:flex;position:absolute;left:0;top:3px;bottom:0;margin:auto;width:20px;height:20px;background-size:20px 20px;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC")}.markdown-body h2{position:relative;padding:0 0 0 20px;font-size:20px;font-weight:700;color:#614500}.markdown-body h2:before{content:"";position:absolute;top:3px;bottom:0;left:0;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC");background-size:100% 100%;background-repeat:no-repeat;width:15px;height:15px;margin:auto}.markdown-body h3{width:100%;text-align:left;margin:20px 10px 0 0;font-size:18px;font-weight:700;display:inline-block;padding-left:10px;padding-bottom:0;border-left:5px solid #8f6600;color:#614500}.markdown-body h4,.markdown-body h5,.markdown-body h6{font-weight:700;color:#a37400}.markdown-body h4{font-size:17px}.markdown-body h5,.markdown-body h6{display:flex;align-items:center}.markdown-body h5:after,.markdown-body h6:after{display:inline-block;border:2px solid #fff6e0;color:rgba(189,134,0,.5);border-radius:50%;text-align:center;margin-left:5px}.markdown-body h5{font-size:14px}.markdown-body h5:after{content:"5";width:15px;height:15px;line-height:15px;font-size:13px}.markdown-body h6{font-size:12px}.markdown-body h6:after{content:"6";width:13px;height:13px;line-height:13px;font-size:12px}.markdown-body p{color:#412c0c;letter-spacing:1px;font-weight:400;margin-bottom:16px}.markdown-body img{max-width:100%;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#755300;font-weight:400;border-bottom:1px solid #755300;font-weight:bolder;text-decoration:none}.markdown-body table{width:100%!important;margin:0;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border-spacing:0}.markdown-body table img{box-shadow:none}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body thead tr th{text-align:center}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;box-sizing:border-box;border:1px solid rgba(72,42,10,.1)}.markdown-body blockquote{position:relative;text-size-adjust:100%;line-height:25px;font-weight:400;border-radius:10px;font-style:normal;text-align:left;box-sizing:inherit;border:1px solid #ffd87a;background-color:rgba(189,134,0,.5);margin:20px 0;padding:20px}.markdown-body blockquote p{color:#fff6e0;letter-spacing:2px;margin:0}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;color:#cc9100;font-size:34px;font-weight:700}.markdown-body blockquote:before{content:"❝";top:8px;left:5px}.markdown-body blockquote:after{content:"❞";right:5px;bottom:-5px}.markdown-body strong{color:#c28a00;font-weight:bolder}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{color:#c28a00}.markdown-body em strong{font-style:normal;color:#c28a00;background-color:#8a6200}.markdown-body s{color:#c28a00}.markdown-body hr{border-top:1px solid #805b00}.markdown-body code,.markdown-body li code,.markdown-body p code{color:#996d00;background-color:rgba(130,98,0,.3)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit;color:#858585;font-family:bold;letter-spacing:1px}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection,.markdown-body img::selection{color:rgba(189,134,0,.5);background-color:#fff}.markdown-body a::selection,.markdown-body b::selection,.markdown-body del::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:transparent}.markdown-body pre&gt;code::selection{background-color:rgba(189,134,0,.5)}.markdown-body .math .math-inline::selection,.markdown-body blockquote::selection,.markdown-body ol::selection,.markdown-body p::selection,.markdown-body strong::selection,.markdown-body table::selection,.markdown-body ul::selection{background-color:rgba(189,134,0,.5)}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🧠 一、背景：什么是拾取（Picking）？</h2>
<p>“拾取”是指<strong>从用户交互的二维输入（鼠标、触控）映射到图形对象</strong>的过程。</p>
<p>想象你在一个可视化编辑器中移动鼠标指针——当光标悬浮在某个矩形（Rect）上，它高亮、变色、提示“我被选中了”，这就是 <em>拾取系统</em> 在背后施展魔法。✨</p>
<p>在二维场景中，拾取方案通常分三类：</p>





























<table><thead><tr><th>模式</th><th>原理</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>几何拾取</td><td>在逻辑层判断 <code>(x,y)</code> 与各对象边界关系</td><td>精确、轻量</td><td>大量元素时耗性能</td></tr><tr><td>GPU颜色拾取（Color Picking）</td><td>每个对象渲染唯一颜色，对鼠标点取色</td><td>准确、独立于形状复杂度</td><td>需额外渲染缓冲区</td></tr><tr><td>空间索引拾取（QuadTree / BVH）</td><td>建立空间数据结构加速命中查找</td><td>高效、可扩展</td><td>实现复杂度高</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-1">🔬 二、可行性架构核心要点</h2>
<h3 data-id="heading-2">（1）数据层：结构化管理 Rect 元素</h3>
<p>首先要有“<strong>可索引、可快速命中</strong>”的数据结构。<br/>
假设每个矩形元素都有如下属性：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Rect</span> {
  <span class="hljs-keyword">constructor</span>(id, x, y, width, height) {
    <span class="hljs-keyword">this</span>.id = id;
    <span class="hljs-keyword">this</span>.bounds = { x, y, width, height };
    <span class="hljs-keyword">this</span>.state = <span class="hljs-string">"normal"</span>; <span class="hljs-comment">// normal, hover, selected</span>
  }

  contains(px, py) {
    <span class="hljs-keyword">return</span> (
      px &gt;= <span class="hljs-keyword">this</span>.bounds.x &amp;&amp;
      px &lt;= <span class="hljs-keyword">this</span>.bounds.x + <span class="hljs-keyword">this</span>.bounds.width &amp;&amp;
      py &gt;= <span class="hljs-keyword">this</span>.bounds.y &amp;&amp;
      py &lt;= <span class="hljs-keyword">this</span>.bounds.y + <span class="hljs-keyword">this</span>.bounds.height
    );
  }
}
</code></pre>
<p>在小规模下，我们可直接线性扫描，但在数千个Rect场景中，这会让GPU哭泣 😭。</p>
<hr/>
<h3 data-id="heading-3">（2）空间层：区域加速结构设计</h3>
<p>为解决性能问题，可引入 <strong>QuadTree（四叉树）</strong> 进行空间划分。</p>
<p><strong>原理</strong>：</p>
<ul>
<li>将画布平面递归划分为四个象限，每个象限存储矩形对象集合。</li>
<li>鼠标移动时，只查询当前象限节点。</li>
<li>空间复杂度：O(n)，查询复杂度：平均 O(log n)。</li>
</ul>
<p>伪代码演示：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">QuadTree</span> {
  <span class="hljs-keyword">constructor</span>(boundary, capacity) {
    <span class="hljs-keyword">this</span>.boundary = boundary;  <span class="hljs-comment">// 当前节点矩形区域</span>
    <span class="hljs-keyword">this</span>.capacity = capacity;  <span class="hljs-comment">// 一个节点最多的元素数</span>
    <span class="hljs-keyword">this</span>.rects = [];
    <span class="hljs-keyword">this</span>.divided = <span class="hljs-literal">false</span>;
  }

  insert(rect) { <span class="hljs-comment">/* ...根据边界分裂插入逻辑... */</span> }

  query(point) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.boundary.contains(point)) <span class="hljs-keyword">return</span> [];
    let found = [];
    <span class="hljs-keyword">for</span> (let r of <span class="hljs-keyword">this</span>.rects) {
      <span class="hljs-keyword">if</span> (r.contains(point.x, point.y)) found.push(r);
    }
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.divided) {
      found.push(...<span class="hljs-keyword">this</span>.northwest.query(point));
      found.push(...<span class="hljs-keyword">this</span>.northeast.query(point));
      found.push(...<span class="hljs-keyword">this</span>.southwest.query(point));
      found.push(...<span class="hljs-keyword">this</span>.southeast.query(point));
    }
    <span class="hljs-keyword">return</span> found;
  }
}
</code></pre>
<hr/>
<h3 data-id="heading-4">（3）事件层：鼠标移动拾取流逻辑</h3>
<p>核心逻辑架构如下：</p>
<pre><code class="hljs language-scss" lang="scss">mousemove
   ↓
拾取管理器 (PickManager)
   ↓
空间查询 (QuadTree.query)
   ↓
检测命中对象 (Rect.contains)
   ↓
状态同步 (hover / leave / select)
   ↓
渲染层重新绘制目标区域
</code></pre>
<p>完整简化实现：</p>
<pre><code class="hljs language-ini" lang="ini">canvas.addEventListener("mousemove", (e) =&gt; {
  const <span class="hljs-attr">mouse</span> = { x: e.<span class="hljs-literal">off</span>setX, y: e.<span class="hljs-literal">off</span>setY }<span class="hljs-comment">;</span>
  const <span class="hljs-attr">hitRects</span> = quadTree.query(mouse)<span class="hljs-comment">;</span>

  const <span class="hljs-attr">newHover</span> = hitRects[<span class="hljs-number">0</span>] || null<span class="hljs-comment">;</span>
  if (currentHover !== newHover) {
    if (currentHover) <span class="hljs-attr">currentHover.state</span> = <span class="hljs-string">"normal"</span><span class="hljs-comment">;</span>
    if (newHover) <span class="hljs-attr">newHover.state</span> = <span class="hljs-string">"hover"</span><span class="hljs-comment">;</span>
    <span class="hljs-attr">currentHover</span> = newHover<span class="hljs-comment">;</span>
    render()<span class="hljs-comment">; // 局部或全局重绘</span>
  }
})<span class="hljs-comment">;</span>
</code></pre>
<p>这样一来，我们实现了：</p>
<ul>
<li>✅ <strong>实时拾取</strong></li>
<li>✅ <strong>高效区域查询</strong></li>
<li>✅ <strong>状态分离与渲染解耦</strong></li>
</ul>
<hr/>
<h3 data-id="heading-5">（4）渲染层：Canvas / WebGL 混合优化</h3>
<p>对于 Canvas 2D 场景，通常直接 redraw。<br/>
对于复杂 WebGL 场景，可采用双通道：</p>
<ol>
<li>主通道绘制可视内容；</li>
<li>拾取通道（off-screen buffer）绘制唯一颜色 ID；</li>
<li>鼠标事件时，通过 <code>gl.readPixels</code> 获取点击像素颜色 -&gt; 反查对象 ID。</li>
</ol>
<p>这种方案在大型交互式图形系统（如 Mapbox、Three.js）中用途极广。🌍</p>
<hr/>
<h2 data-id="heading-6">🧩 三、性能可行性分析</h2>



































<table><thead><tr><th align="left">指标</th><th align="left">几何拾取</th><th align="left">四叉树加速</th><th align="left">GPU颜色拾取</th></tr></thead><tbody><tr><td align="left">查询复杂度</td><td align="left">O(n)</td><td align="left">O(log n)</td><td align="left">O(1)</td></tr><tr><td align="left">渲染性能</td><td align="left">高CPU占用</td><td align="left">中等</td><td align="left">高GPU开销</td></tr><tr><td align="left">延迟</td><td align="left">极低</td><td align="left">低</td><td align="left">取决于颜色缓冲同步</td></tr><tr><td align="left">适用场景</td><td align="left">少量对象</td><td align="left">大量矩形元素</td><td align="left">复杂场景（3D/WebGL）</td></tr></tbody></table>
<p>结论：</p>
<blockquote>
<p>✅ 对于 Web 端二维 Rect 编辑器或设计工具，<strong>QuadTree + 几何拾取混合方案</strong> 是可行且优雅的架构选择。</p>
</blockquote>
<hr/>
<h2 data-id="heading-7">⚙️ 四、工程优化建议 🧪</h2>
<ol>
<li><strong>事件节流（throttle）</strong><br/>
避免每次 <code>mousemove</code> 都触发完整查询，可在 16ms（约60Hz）节流执行。</li>
<li><strong>局部重绘（Dirty Rect）</strong><br/>
只重绘状态变化区域，提升渲染性能。</li>
<li><strong>命中缓存（Hover Cache）</strong><br/>
若连续多帧命中同一元素，不重复查询，降低开销。</li>
<li><strong>交互优先级分层</strong><br/>
针对UI层、图形层分别拾取，按z-index排序命中结果。</li>
</ol>
<hr/>
<h2 data-id="heading-8">🪶 五、哲学层小结：拾取，不只是拾取</h2>
<p>“拾取”看似一个计算几何问题，实则是一次<strong>人与空间的映射关系重建</strong>。</p>
<p>当你从一块平面中精准捕捉一个矩形，背后是：</p>
<ul>
<li>一颗QuadTree在飞速判断区块；</li>
<li>一次GPU在色彩世界编码ID；</li>
<li>一份人机交互的默契在闪光。</li>
</ul>
<blockquote>
<p>工程的浪漫，藏在每一次 <code>mousemove</code> 中。💫</p>
</blockquote>
<hr/>
<h2 data-id="heading-9">🧭 总结</h2>






























<table><thead><tr><th>模块</th><th>关键技术</th><th>工程要点</th></tr></thead><tbody><tr><td>数据层</td><td>Rect 对象结构化</td><td>定义边界与状态</td></tr><tr><td>空间层</td><td>QuadTree or 网格划分</td><td>加速查询性能</td></tr><tr><td>事件层</td><td>MouseMove + 状态机</td><td>处理 hover/leave</td></tr><tr><td>渲染层</td><td>局部刷新 / GPU解码</td><td>平衡性能和准确性</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Matplotlib饼图绘制教程：从基础到进阶，精准展示数据占比]]></title>    <link>https://juejin.cn/post/7583871118949646386</link>    <guid>https://juejin.cn/post/7583871118949646386</guid>    <pubDate>2025-12-15T14:24:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583871118949646386" data-draft-id="7583878719544295433" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Matplotlib饼图绘制教程：从基础到进阶，精准展示数据占比"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2025-12-15T14:24:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="永远是夏天"/> <meta itemprop="url" content="https://juejin.cn/user/1127429986061683"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Matplotlib饼图绘制教程：从基础到进阶，精准展示数据占比
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1127429986061683/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    永远是夏天
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T14:24:53.000Z" title="Mon Dec 15 2025 14:24:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>饼图是数据可视化中经典的占比类图表，核心用于展示各分类在整体中的比例关系，尤其适合类别数量较少（建议不超过8类）的场景。本文基于Matplotlib详解饼图的绘制方法，涵盖基础绘制、样式定制、进阶优化等核心知识点，结合实战案例让你快速掌握。</p>
<h2 data-id="heading-0">一、基础饼图绘制</h2>
<h3 data-id="heading-1">1. 核心语法与最简示例</h3>
<p>Matplotlib绘制饼图的核心函数是<code>plt.pie()</code>，只需传入“各分类数值”即可生成基础饼图。
示例：展示某电商平台各品类销售额占比</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt

<span class="hljs-comment"># 解决中文显示问题（通用配置）</span>
plt.rcParams[<span class="hljs-string">"font.sans-serif"</span>] = [<span class="hljs-string">"SimHei"</span>]  <span class="hljs-comment"># Windows</span>
<span class="hljs-comment"># plt.rcParams["font.sans-serif"] = ["PingFang SC"]  # macOS</span>
plt.rcParams[<span class="hljs-string">"axes.unicode_minus"</span>] = <span class="hljs-literal">False</span>

<span class="hljs-comment"># 1. 准备数据：分类名称 + 对应数值（数值会自动计算占比）</span>
categories = [<span class="hljs-string">"服饰"</span>, <span class="hljs-string">"美妆"</span>, <span class="hljs-string">"食品"</span>, <span class="hljs-string">"数码"</span>, <span class="hljs-string">"家居"</span>]
sales = [<span class="hljs-number">250</span>, <span class="hljs-number">180</span>, <span class="hljs-number">220</span>, <span class="hljs-number">300</span>, <span class="hljs-number">150</span>]

<span class="hljs-comment"># 2. 创建画布</span>
plt.figure(figsize=(<span class="hljs-number">8</span>, <span class="hljs-number">8</span>))  <span class="hljs-comment"># 饼图建议用正方形画布，避免变形</span>

<span class="hljs-comment"># 3. 绘制基础饼图</span>
plt.pie(sales,  <span class="hljs-comment"># 核心数据：各分类数值</span>
        labels=categories)  <span class="hljs-comment"># 分类标签</span>

<span class="hljs-comment"># 4. 显示图表</span>
plt.title(<span class="hljs-string">"某电商平台各品类销售额占比"</span>, fontsize=<span class="hljs-number">14</span>)
plt.show()
</code></pre>
<h3 data-id="heading-2">2. 核心参数解析（基础版）</h3>



































<table><thead><tr><th>参数</th><th>作用</th><th>示例</th></tr></thead><tbody><tr><td><code>x</code></td><td>必选，各分类的数值（非占比，Matplotlib自动计算）</td><td><code>x=[250, 180, 220]</code></td></tr><tr><td><code>labels</code></td><td>分类标签，对应x的每个数值</td><td><code>labels=["服饰","美妆","食品"]</code></td></tr><tr><td><code>autopct</code></td><td>显示各部分占比，支持格式字符串</td><td><code>autopct="%1.1f%%"</code>（保留1位小数的百分比）</td></tr><tr><td><code>colors</code></td><td>自定义各扇区颜色</td><td><code>colors=["#FF6B6B","#4ECDC4","#45B7D1"]</code></td></tr><tr><td><code>startangle</code></td><td>饼图起始角度（默认从x轴正方向开始，逆时针绘制）</td><td><code>startangle=90</code>（从y轴正方向开始）</td></tr></tbody></table>
<p>优化版基础饼图（添加占比、自定义颜色）：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt

plt.rcParams[<span class="hljs-string">"font.sans-serif"</span>] = [<span class="hljs-string">"SimHei"</span>]
plt.rcParams[<span class="hljs-string">"axes.unicode_minus"</span>] = <span class="hljs-literal">False</span>

categories = [<span class="hljs-string">"服饰"</span>, <span class="hljs-string">"美妆"</span>, <span class="hljs-string">"食品"</span>, <span class="hljs-string">"数码"</span>, <span class="hljs-string">"家居"</span>]
sales = [<span class="hljs-number">250</span>, <span class="hljs-number">180</span>, <span class="hljs-number">220</span>, <span class="hljs-number">300</span>, <span class="hljs-number">150</span>]
<span class="hljs-comment"># 自定义配色（推荐莫兰迪/清新色系，避免刺眼）</span>
colors = [<span class="hljs-string">"#FF6B6B"</span>, <span class="hljs-string">"#4ECDC4"</span>, <span class="hljs-string">"#45B7D1"</span>, <span class="hljs-string">"#96CEB4"</span>, <span class="hljs-string">"#FECA57"</span>]

plt.figure(figsize=(<span class="hljs-number">8</span>, <span class="hljs-number">8</span>))
<span class="hljs-comment"># 绘制饼图，添加占比和颜色</span>
plt.pie(sales,
        labels=categories,
        autopct=<span class="hljs-string">"%1.1f%%"</span>,  <span class="hljs-comment"># 显示占比（1位小数）</span>
        colors=colors,
        startangle=<span class="hljs-number">90</span>)  <span class="hljs-comment"># 起始角度90度</span>

plt.title(<span class="hljs-string">"某电商平台各品类销售额占比"</span>, fontsize=<span class="hljs-number">14</span>)
plt.axis(<span class="hljs-string">"equal"</span>)  <span class="hljs-comment"># 强制饼图为正圆形（关键！避免拉伸变形）</span>
plt.show()
</code></pre>
<h2 data-id="heading-3">二、进阶优化：突出重点、提升可读性</h2>
<h3 data-id="heading-4">1. 突出核心分类（explode参数）</h3>
<p>通过<code>explode</code>参数可将指定扇区“分离”出来，突出重点类别（如占比最高的“数码”品类）：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt

plt.rcParams[<span class="hljs-string">"font.sans-serif"</span>] = [<span class="hljs-string">"SimHei"</span>]
plt.rcParams[<span class="hljs-string">"axes.unicode_minus"</span>] = <span class="hljs-literal">False</span>

categories = [<span class="hljs-string">"服饰"</span>, <span class="hljs-string">"美妆"</span>, <span class="hljs-string">"食品"</span>, <span class="hljs-string">"数码"</span>, <span class="hljs-string">"家居"</span>]
sales = [<span class="hljs-number">250</span>, <span class="hljs-number">180</span>, <span class="hljs-number">220</span>, <span class="hljs-number">300</span>, <span class="hljs-number">150</span>]
colors = [<span class="hljs-string">"#FF6B6B"</span>, <span class="hljs-string">"#4ECDC4"</span>, <span class="hljs-string">"#45B7D1"</span>, <span class="hljs-string">"#96CEB4"</span>, <span class="hljs-string">"#FECA57"</span>]
<span class="hljs-comment"># explode：对应每个扇区的分离距离，0为不分离，数值越大分离越远</span>
explode = (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">0</span>)  <span class="hljs-comment"># 仅“数码”扇区分离0.1距离</span>

plt.figure(figsize=(<span class="hljs-number">8</span>, <span class="hljs-number">8</span>))
plt.pie(sales,
        labels=categories,
        autopct=<span class="hljs-string">"%1.1f%%"</span>,
        colors=colors,
        startangle=<span class="hljs-number">90</span>,
        explode=explode,  <span class="hljs-comment"># 启用分离效果</span>
        shadow=<span class="hljs-literal">True</span>)  <span class="hljs-comment"># 添加阴影，增强立体感</span>

plt.title(<span class="hljs-string">"某电商平台各品类销售额占比（突出数码品类）"</span>, fontsize=<span class="hljs-number">14</span>)
plt.axis(<span class="hljs-string">"equal"</span>)
plt.show()
</code></pre>
<h3 data-id="heading-5">2. 优化标签样式（字体、位置）</h3>
<p>默认标签可能重叠或样式单一，可通过<code>textprops</code>调整标签样式，或手动调整占比标签位置：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt

plt.rcParams[<span class="hljs-string">"font.sans-serif"</span>] = [<span class="hljs-string">"SimHei"</span>]
plt.rcParams[<span class="hljs-string">"axes.unicode_minus"</span>] = <span class="hljs-literal">False</span>

categories = [<span class="hljs-string">"服饰"</span>, <span class="hljs-string">"美妆"</span>, <span class="hljs-string">"食品"</span>, <span class="hljs-string">"数码"</span>, <span class="hljs-string">"家居"</span>]
sales = [<span class="hljs-number">250</span>, <span class="hljs-number">180</span>, <span class="hljs-number">220</span>, <span class="hljs-number">300</span>, <span class="hljs-number">150</span>]
colors = [<span class="hljs-string">"#FF6B6B"</span>, <span class="hljs-string">"#4ECDC4"</span>, <span class="hljs-string">"#45B7D1"</span>, <span class="hljs-string">"#96CEB4"</span>, <span class="hljs-string">"#FECA57"</span>]
explode = (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">0</span>)

plt.figure(figsize=(<span class="hljs-number">8</span>, <span class="hljs-number">8</span>))
<span class="hljs-comment"># 绘制饼图并捕获文本对象（用于后续调整）</span>
patches, texts, autotexts = plt.pie(
    sales,
    labels=categories,
    autopct=<span class="hljs-string">"%1.1f%%"</span>,
    colors=colors,
    startangle=<span class="hljs-number">90</span>,
    explode=explode,
    shadow=<span class="hljs-literal">True</span>,
    textprops={<span class="hljs-string">"fontsize"</span>: <span class="hljs-number">11</span>}  <span class="hljs-comment"># 统一设置标签字体大小</span>
)

<span class="hljs-comment"># 单独调整占比标签样式（如颜色、加粗）</span>
<span class="hljs-keyword">for</span> autotext <span class="hljs-keyword">in</span> autotexts:
    autotext.set_color(<span class="hljs-string">"white"</span>)  <span class="hljs-comment"># 占比文字设为白色</span>
    autotext.set_fontweight(<span class="hljs-string">"bold"</span>)  <span class="hljs-comment"># 加粗</span>

plt.title(<span class="hljs-string">"某电商平台各品类销售额占比"</span>, fontsize=<span class="hljs-number">14</span>)
plt.axis(<span class="hljs-string">"equal"</span>)
plt.show()
</code></pre>
<h3 data-id="heading-6">3. 处理小占比类别（避免标签重叠）</h3>
<p>若部分类别占比过小（如&lt;5%），可将其合并为“其他”类，或通过<code>pctdistance</code>调整占比标签位置：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt

plt.rcParams[<span class="hljs-string">"font.sans-serif"</span>] = [<span class="hljs-string">"SimHei"</span>]
plt.rcParams[<span class="hljs-string">"axes.unicode_minus"</span>] = <span class="hljs-literal">False</span>

<span class="hljs-comment"># 原始数据：含小占比类别</span>
categories = [<span class="hljs-string">"服饰"</span>, <span class="hljs-string">"美妆"</span>, <span class="hljs-string">"食品"</span>, <span class="hljs-string">"数码"</span>, <span class="hljs-string">"家居"</span>, <span class="hljs-string">"图书"</span>, <span class="hljs-string">"配饰"</span>]
sales = [<span class="hljs-number">250</span>, <span class="hljs-number">180</span>, <span class="hljs-number">220</span>, <span class="hljs-number">300</span>, <span class="hljs-number">150</span>, <span class="hljs-number">30</span>, <span class="hljs-number">20</span>]

<span class="hljs-comment"># 合并小占比类别（图书+配饰=其他）</span>
new_categories = [<span class="hljs-string">"服饰"</span>, <span class="hljs-string">"美妆"</span>, <span class="hljs-string">"食品"</span>, <span class="hljs-string">"数码"</span>, <span class="hljs-string">"家居"</span>, <span class="hljs-string">"其他"</span>]
new_sales = [<span class="hljs-number">250</span>, <span class="hljs-number">180</span>, <span class="hljs-number">220</span>, <span class="hljs-number">300</span>, <span class="hljs-number">150</span>, <span class="hljs-number">50</span>]
colors = [<span class="hljs-string">"#FF6B6B"</span>, <span class="hljs-string">"#4ECDC4"</span>, <span class="hljs-string">"#45B7D1"</span>, <span class="hljs-string">"#96CEB4"</span>, <span class="hljs-string">"#FECA57"</span>, <span class="hljs-string">"#DDA0DD"</span>]

plt.figure(figsize=(<span class="hljs-number">8</span>, <span class="hljs-number">8</span>))
plt.pie(new_sales,
        labels=new_categories,
        autopct=<span class="hljs-string">"%1.1f%%"</span>,
        colors=colors,
        startangle=<span class="hljs-number">90</span>,
        pctdistance=<span class="hljs-number">0.85</span>)  <span class="hljs-comment"># 占比标签距离圆心的比例（默认0.6，调大避免重叠）</span>

plt.title(<span class="hljs-string">"某电商平台各品类销售额占比（合并小品类）"</span>, fontsize=<span class="hljs-number">14</span>)
plt.axis(<span class="hljs-string">"equal"</span>)
plt.show()
</code></pre>
<h2 data-id="heading-7">三、特殊场景：环形饼图（空心饼图）</h2>
<p>环形饼图比普通饼图更美观，且可在中心添加文字，适合展示多层占比或突出视觉效果。
实现原理：绘制两个饼图，外层为数据，内层为白色填充的“空心”。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt

plt.rcParams[<span class="hljs-string">"font.sans-serif"</span>] = [<span class="hljs-string">"SimHei"</span>]
plt.rcParams[<span class="hljs-string">"axes.unicode_minus"</span>] = <span class="hljs-literal">False</span>

categories = [<span class="hljs-string">"服饰"</span>, <span class="hljs-string">"美妆"</span>, <span class="hljs-string">"食品"</span>, <span class="hljs-string">"数码"</span>, <span class="hljs-string">"家居"</span>]
sales = [<span class="hljs-number">250</span>, <span class="hljs-number">180</span>, <span class="hljs-number">220</span>, <span class="hljs-number">300</span>, <span class="hljs-number">150</span>]
colors = [<span class="hljs-string">"#FF6B6B"</span>, <span class="hljs-string">"#4ECDC4"</span>, <span class="hljs-string">"#45B7D1"</span>, <span class="hljs-string">"#96CEB4"</span>, <span class="hljs-string">"#FECA57"</span>]

plt.figure(figsize=(<span class="hljs-number">8</span>, <span class="hljs-number">8</span>))
<span class="hljs-comment"># 绘制外层数据饼图</span>
plt.pie(sales,
        labels=categories,
        autopct=<span class="hljs-string">"%1.1f%%"</span>,
        colors=colors,
        startangle=<span class="hljs-number">90</span>,
        wedgeprops={<span class="hljs-string">"width"</span>: <span class="hljs-number">0.3</span>})  <span class="hljs-comment"># width：环形宽度（0-1，越小越细）</span>

<span class="hljs-comment"># 绘制内层空心（白色填充）</span>
plt.pie([<span class="hljs-number">1</span>], colors=<span class="hljs-string">"white"</span>, radius=<span class="hljs-number">0.7</span>)  <span class="hljs-comment"># radius：内层半径（小于外层）</span>

<span class="hljs-comment"># 中心添加文字</span>
plt.text(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"总销售额\n1100万"</span>, ha=<span class="hljs-string">"center"</span>, va=<span class="hljs-string">"center"</span>, fontsize=<span class="hljs-number">12</span>)

plt.title(<span class="hljs-string">"某电商平台各品类销售额占比（环形图）"</span>, fontsize=<span class="hljs-number">14</span>)
plt.axis(<span class="hljs-string">"equal"</span>)
plt.show()
</code></pre>
<h2 data-id="heading-8">四、饼图绘制注意事项</h2>
<ol>
<li><strong>适用场景</strong>：仅用于展示“部分-整体”关系，且类别数不宜过多（建议≤6类），否则扇区过小、可读性差；</li>
<li><strong>避免误导</strong>：饼图的视觉效果易受起始角度、扇区顺序影响，若需精准对比占比，优先用柱状图；</li>
<li><strong>正圆形保障</strong>：务必添加<code>plt.axis("equal")</code>，否则画布拉伸会导致饼图变形为椭圆；</li>
<li><strong>中文与负号</strong>：始终配置<code>rcParams</code>解决中文乱码和负号显示问题；</li>
<li><strong>保存高清图</strong>：用<code>plt.savefig("饼图.png", dpi=300, bbox_inches="tight")</code>替代<code>plt.show()</code>，避免文字截断。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[线程池中任务堆积与饥饿死锁问题]]></title>    <link>https://juejin.cn/post/7583943503556198450</link>    <guid>https://juejin.cn/post/7583943503556198450</guid>    <pubDate>2025-12-16T01:03:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583943503556198450" data-draft-id="7583912637471244339" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="线程池中任务堆积与饥饿死锁问题"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-12-16T01:03:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="uup"/> <meta itemprop="url" content="https://juejin.cn/user/4378706456356627"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            线程池中任务堆积与饥饿死锁问题
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4378706456356627/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    uup
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T01:03:44.000Z" title="Tue Dec 16 2025 01:03:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、Bug 场景</h2>
<p>在一个电商后台系统中，使用线程池来处理订单处理、库存更新、物流通知等多种异步任务。随着业务量的增长，系统逐渐出现响应变慢的情况，部分任务甚至长时间得不到执行，最终导致一些关键业务流程受阻。</p>
<h2 data-id="heading-1">二、代码示例</h2>
<h3 data-id="heading-2">任务类</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BusinessTask</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String taskName;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">BusinessTask</span><span class="hljs-params">(String taskName)</span> {
        <span class="hljs-built_in">this</span>.taskName = taskName;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 模拟业务处理</span>
            Thread.sleep(<span class="hljs-number">1000</span>);
            System.out.println(taskName + <span class="hljs-string">" 任务完成"</span>);
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
    }
}
</code></pre>
<h3 data-id="heading-3">线程池配置与任务提交（有缺陷）</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.BlockingQueue;
<span class="hljs-keyword">import</span> java.util.concurrent.LinkedBlockingQueue;
<span class="hljs-keyword">import</span> java.util.concurrent.ThreadPoolExecutor;
<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EcommerceSystem</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">CORE_POOL_SIZE</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MAX_POOL_SIZE</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">QUEUE_CAPACITY</span> <span class="hljs-operator">=</span> <span class="hljs-number">20</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">KEEP_ALIVE_TIME</span> <span class="hljs-operator">=</span> <span class="hljs-number">1L</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        BlockingQueue&lt;Runnable&gt; taskQueue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedBlockingQueue</span>&lt;&gt;(QUEUE_CAPACITY);
        <span class="hljs-type">ThreadPoolExecutor</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(
                CORE_POOL_SIZE,
                MAX_POOL_SIZE,
                KEEP_ALIVE_TIME,
                TimeUnit.SECONDS,
                taskQueue);

        <span class="hljs-comment">// 模拟提交大量任务</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">50</span>; i++) {
            <span class="hljs-type">String</span> <span class="hljs-variable">taskName</span> <span class="hljs-operator">=</span> <span class="hljs-string">"任务 "</span> + i;
            executor.submit(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessTask</span>(taskName));
        }

        executor.shutdown();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">if</span> (!executor.awaitTermination(<span class="hljs-number">60</span>, TimeUnit.SECONDS)) {
                executor.shutdownNow();
                <span class="hljs-keyword">if</span> (!executor.awaitTermination(<span class="hljs-number">60</span>, TimeUnit.SECONDS)) {
                    System.err.println(<span class="hljs-string">"线程池未正常关闭"</span>);
                }
            }
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            executor.shutdownNow();
            Thread.currentThread().interrupt();
        }
    }
}
</code></pre>
<h2 data-id="heading-4">三、问题描述</h2>
<ol>
<li>
<p><strong>预期行为</strong>：线程池能够高效处理提交的任务，所有任务都能在合理时间内完成，系统保持稳定运行。</p>
</li>
<li>
<p><strong>实际行为</strong>：</p>
<ul>
<li><strong>任务堆积</strong>：随着任务不断提交，任务队列逐渐被填满，新任务只能等待队列有空位或者线程池创建新线程（达到最大线程数后也只能等待）。这是因为线程池的核心线程数和最大线程数设置相对业务量过小，并且任务执行时间较长，导致任务处理速度跟不上提交速度。</li>
<li><strong>饥饿死锁</strong>：在任务队列中可能存在优先级不同的任务，例如订单处理任务优先级较高，物流通知任务优先级较低。如果高优先级任务持续提交，线程池中的线程会一直忙于处理高优先级任务，低优先级任务可能长时间得不到执行，出现饥饿现象。极端情况下，可能导致低优先级任务永远无法执行，形成一种类似死锁的状态。</li>
</ul>
</li>
</ol>
<h2 data-id="heading-5">四、解决方案</h2>
<ol>
<li><strong>优化线程池参数</strong>：根据实际业务负载和任务特性，合理调整线程池参数。例如，如果任务执行时间较短且数量较多，可以适当增加核心线程数和最大线程数；如果任务执行时间较长，可以扩大任务队列容量。</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">CORE_POOL_SIZE</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MAX_POOL_SIZE</span> <span class="hljs-operator">=</span> <span class="hljs-number">20</span>;
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">QUEUE_CAPACITY</span> <span class="hljs-operator">=</span> <span class="hljs-number">50</span>;
</code></pre>
<ol start="2">
<li><strong>使用优先级队列和优先级线程池</strong>：对任务进行优先级划分，使用 <code>PriorityBlockingQueue</code> 作为任务队列，并自定义 <code>PriorityThreadPoolExecutor</code> 来处理不同优先级的任务。</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.BlockingQueue;
<span class="hljs-keyword">import</span> java.util.concurrent.PriorityBlockingQueue;
<span class="hljs-keyword">import</span> java.util.concurrent.ThreadPoolExecutor;
<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PriorityBusinessTask</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span>, Comparable&lt;PriorityBusinessTask&gt; {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String taskName;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> priority;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">PriorityBusinessTask</span><span class="hljs-params">(String taskName, <span class="hljs-type">int</span> priority)</span> {
        <span class="hljs-built_in">this</span>.taskName = taskName;
        <span class="hljs-built_in">this</span>.priority = priority;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 模拟业务处理</span>
            Thread.sleep(<span class="hljs-number">1000</span>);
            System.out.println(taskName + <span class="hljs-string">" 任务完成"</span>);
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">compareTo</span><span class="hljs-params">(PriorityBusinessTask other)</span> {
        <span class="hljs-keyword">return</span> Integer.compare(other.priority, <span class="hljs-built_in">this</span>.priority);
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PriorityThreadPoolExecutor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ThreadPoolExecutor</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">PriorityThreadPoolExecutor</span><span class="hljs-params">(<span class="hljs-type">int</span> corePoolSize, <span class="hljs-type">int</span> maximumPoolSize, <span class="hljs-type">long</span> keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue)</span> {
        <span class="hljs-built_in">super</span>(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">beforeExecute</span><span class="hljs-params">(Thread t, Runnable r)</span> {
        <span class="hljs-built_in">super</span>.beforeExecute(t, r);
        <span class="hljs-keyword">if</span> (r <span class="hljs-keyword">instanceof</span> PriorityBusinessTask) {
            System.out.println(<span class="hljs-string">"开始执行优先级任务: "</span> + ((PriorityBusinessTask) r).taskName);
        }
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterExecute</span><span class="hljs-params">(Runnable r, Throwable t)</span> {
        <span class="hljs-built_in">super</span>.afterExecute(r, t);
        <span class="hljs-keyword">if</span> (r <span class="hljs-keyword">instanceof</span> PriorityBusinessTask) {
            System.out.println(<span class="hljs-string">"完成优先级任务: "</span> + ((PriorityBusinessTask) r).taskName);
        }
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EcommerceSystem</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">CORE_POOL_SIZE</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MAX_POOL_SIZE</span> <span class="hljs-operator">=</span> <span class="hljs-number">20</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">QUEUE_CAPACITY</span> <span class="hljs-operator">=</span> <span class="hljs-number">50</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">KEEP_ALIVE_TIME</span> <span class="hljs-operator">=</span> <span class="hljs-number">1L</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        BlockingQueue&lt;Runnable&gt; taskQueue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityBlockingQueue</span>&lt;&gt;(QUEUE_CAPACITY);
        <span class="hljs-type">PriorityThreadPoolExecutor</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityThreadPoolExecutor</span>(
                CORE_POOL_SIZE,
                MAX_POOL_SIZE,
                KEEP_ALIVE_TIME,
                TimeUnit.SECONDS,
                taskQueue);

        <span class="hljs-comment">// 模拟提交不同优先级任务</span>
        executor.submit(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityBusinessTask</span>(<span class="hljs-string">"高优先级任务 1"</span>, <span class="hljs-number">1</span>));
        executor.submit(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityBusinessTask</span>(<span class="hljs-string">"低优先级任务 1"</span>, <span class="hljs-number">3</span>));
        executor.submit(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityBusinessTask</span>(<span class="hljs-string">"高优先级任务 2"</span>, <span class="hljs-number">1</span>));
        executor.submit(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityBusinessTask</span>(<span class="hljs-string">"低优先级任务 2"</span>, <span class="hljs-number">3</span>));

        executor.shutdown();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">if</span> (!executor.awaitTermination(<span class="hljs-number">60</span>, TimeUnit.SECONDS)) {
                executor.shutdownNow();
                <span class="hljs-keyword">if</span> (!executor.awaitTermination(<span class="hljs-number">60</span>, TimeUnit.SECONDS)) {
                    System.err.println(<span class="hljs-string">"线程池未正常关闭"</span>);
                }
            }
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            executor.shutdownNow();
            Thread.currentThread().interrupt();
        }
    }
}
</code></pre>
<ol start="3">
<li><strong>动态调整线程池</strong>：根据系统运行时的任务队列长度、线程池活跃线程数等指标，动态调整线程池的参数，以适应业务量的变化。可以使用定时任务定期检查并调整线程池大小。</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.BlockingQueue;
<span class="hljs-keyword">import</span> java.util.concurrent.LinkedBlockingQueue;
<span class="hljs-keyword">import</span> java.util.concurrent.ScheduledExecutorService;
<span class="hljs-keyword">import</span> java.util.concurrent.ScheduledThreadPoolExecutor;
<span class="hljs-keyword">import</span> java.util.concurrent.ThreadPoolExecutor;
<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EcommerceSystem</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">INITIAL_CORE_POOL_SIZE</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">INITIAL_MAX_POOL_SIZE</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">QUEUE_CAPACITY</span> <span class="hljs-operator">=</span> <span class="hljs-number">20</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">KEEP_ALIVE_TIME</span> <span class="hljs-operator">=</span> <span class="hljs-number">1L</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        BlockingQueue&lt;Runnable&gt; taskQueue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedBlockingQueue</span>&lt;&gt;(QUEUE_CAPACITY);
        <span class="hljs-type">ThreadPoolExecutor</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(
                INITIAL_CORE_POOL_SIZE,
                INITIAL_MAX_POOL_SIZE,
                KEEP_ALIVE_TIME,
                TimeUnit.SECONDS,
                taskQueue);

        <span class="hljs-type">ScheduledExecutorService</span> <span class="hljs-variable">scheduler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ScheduledThreadPoolExecutor</span>(<span class="hljs-number">1</span>);
        scheduler.scheduleAtFixedRate(() -&gt; {
            <span class="hljs-type">int</span> <span class="hljs-variable">queueSize</span> <span class="hljs-operator">=</span> taskQueue.size();
            <span class="hljs-type">int</span> <span class="hljs-variable">activeCount</span> <span class="hljs-operator">=</span> executor.getActiveCount();
            <span class="hljs-keyword">if</span> (queueSize &gt; QUEUE_CAPACITY * <span class="hljs-number">0.8</span> &amp;&amp; activeCount &lt; INITIAL_MAX_POOL_SIZE) {
                executor.setCorePoolSize(executor.getCorePoolSize() + <span class="hljs-number">1</span>);
                executor.setMaximumPoolSize(executor.getMaximumPoolSize() + <span class="hljs-number">1</span>);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (queueSize &lt; QUEUE_CAPACITY * <span class="hljs-number">0.2</span> &amp;&amp; activeCount &gt; INITIAL_CORE_POOL_SIZE) {
                executor.setCorePoolSize(executor.getCorePoolSize() - <span class="hljs-number">1</span>);
                executor.setMaximumPoolSize(executor.getMaximumPoolSize() - <span class="hljs-number">1</span>);
            }
        }, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, TimeUnit.MINUTES);

        <span class="hljs-comment">// 模拟提交大量任务</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">50</span>; i++) {
            <span class="hljs-type">String</span> <span class="hljs-variable">taskName</span> <span class="hljs-operator">=</span> <span class="hljs-string">"任务 "</span> + i;
            executor.submit(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessTask</span>(taskName));
        }

        executor.shutdown();
        scheduler.shutdown();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">if</span> (!executor.awaitTermination(<span class="hljs-number">60</span>, TimeUnit.SECONDS)) {
                executor.shutdownNow();
                <span class="hljs-keyword">if</span> (!executor.awaitTermination(<span class="hljs-number">60</span>, TimeUnit.SECONDS)) {
                    System.err.println(<span class="hljs-string">"线程池未正常关闭"</span>);
                }
            }
            <span class="hljs-keyword">if</span> (!scheduler.awaitTermination(<span class="hljs-number">1</span>, TimeUnit.MINUTES)) {
                scheduler.shutdownNow();
                <span class="hljs-keyword">if</span> (!scheduler.awaitTermination(<span class="hljs-number">1</span>, TimeUnit.MINUTES)) {
                    System.err.println(<span class="hljs-string">"调度器未正常关闭"</span>);
                }
            }
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            executor.shutdownNow();
            scheduler.shutdownNow();
            Thread.currentThread().interrupt();
        }
    }
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue3的`:style`对象语法：单位、属性名、响应式，这些细节你都踩过坑吗？]]></title>    <link>https://juejin.cn/post/7583910418658983982</link>    <guid>https://juejin.cn/post/7583910418658983982</guid>    <pubDate>2025-12-15T16:08:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583910418658983982" data-draft-id="7583912637470605363" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue3的`:style`对象语法：单位、属性名、响应式，这些细节你都踩过坑吗？    "/> <meta itemprop="keywords" content="前端,AI编程,Trae"/> <meta itemprop="datePublished" content="2025-12-15T16:08:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="kknone"/> <meta itemprop="url" content="https://juejin.cn/user/1366025597879930"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue3的`:style`对象语法：单位、属性名、响应式，这些细节你都踩过坑吗？    
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1366025597879930/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    kknone
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T16:08:48.000Z" title="Mon Dec 15 2025 16:08:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">一、从“动态改样式”说起：为什么需要<code>:style</code>对象语法？</h3>
<p>在实际开发中，我们经常遇到**“数据变，样式跟着变”**的场景——比如：</p>
<ul>
<li>按钮点击后从蓝色变成绿色；</li>
<li>进度条的宽度随完成度增加；</li>
<li>文本的字体大小根据用户设置调整。</li>
</ul>
<p>这些场景如果用原生JS实现，需要手动操作<code>element.style</code>，代码繁琐且容易出错。而Vue3的<code>:style</code>绑定（全称<code>v-bind:style</code>），尤其是<strong>对象语法</strong>，能让我们用“声明式”的方式把响应式数据和样式关联起来，优雅解决动态样式问题。</p>
<h3 data-id="heading-1">二、<code>:style</code>对象语法基础：把样式写成“键值对”</h3>
<p><code>:style</code>的对象语法本质是<strong>将CSS样式映射为JavaScript对象</strong>——对象的<strong>键</strong>是CSS属性（如<code>color</code>、<code>fontSize</code>），<strong>值</strong>是要绑定的响应式数据（或普通值）。</p>
<h4 data-id="heading-2">1. 最简示例：绑定颜色和字体大小</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;!-- 用:style绑定对象，键是CSS属性，值是响应式数据 --&gt;
  &lt;div :style="{ color: textColor, fontSize: fontSize + 'px' }"&gt;
    我是动态样式的文本
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref } from 'vue'

// 响应式颜色：初始红色
const textColor = ref('red')
// 响应式字体大小：初始30px（数字需加单位）
const fontSize = ref(30)
&lt;/script&gt;
</code></pre>
<p><strong>关键点解释</strong>：</p>
<ul>
<li><strong>CSS属性的键</strong>：可以用<strong>驼峰命名</strong>（如<code>fontSize</code>）或<strong>短横线命名</strong>（如<code>'font-size'</code>，需加引号），Vue会自动将驼峰转成短横线（对应CSS原生属性）。</li>
<li><strong>值的单位</strong>：CSS大部分属性需要单位（如<code>px</code>、<code>em</code>），Vue<strong>不会自动添加单位</strong>（除非值是<code>0</code>）。因此<code>fontSize</code>需要手动拼接<code>'px'</code>，否则会渲染成无效的<code>font-size: 30</code>。</li>
</ul>
<h3 data-id="heading-3">三、响应式数据绑定：让样式“跟着数据走”</h3>
<p><code>:style</code>的核心优势是<strong>响应式</strong>——当绑定的<code>ref</code>或<code>reactive</code>数据变化时，样式会自动更新。</p>
<h4 data-id="heading-4">实战：点击换色按钮</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;button 
    @click="toggleColor"
    :style="{ 
      backgroundColor: btnBg, 
      color: 'white', 
      padding: '8px 16px', 
      border: 'none', 
      borderRadius: '4px',
      cursor: 'pointer'
    }"
  &gt;
    {{ btnText }}
  &lt;/button&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref } from 'vue'

// 响应式背景色：初始蓝色
const btnBg = ref('#2196F3')
// 响应式按钮文本
const btnText = ref('点击变绿')

// 点击事件：切换颜色和文本
const toggleColor = () =&gt; {
  if (btnBg.value === '#2196F3') {
    btnBg.value = '#4CAF50' // 切换为绿色
    btnText.value = '点击变蓝'
  } else {
    btnBg.value = '#2196F3' // 切换回蓝色
    btnText.value = '点击变绿'
  }
}
&lt;/script&gt;
</code></pre>
<p><strong>效果</strong>：点击按钮时，<code>btnBg</code>和<code>btnText</code>的响应式数据变化，按钮的背景色和文本会<strong>自动更新</strong>——无需手动操作DOM，这就是Vue的“数据驱动视图”魅力。</p>
<h3 data-id="heading-5">四、CSS属性类型：字符串、数字、布尔值怎么用？</h3>
<p><code>:style</code>支持的样式值类型主要有3种：</p>

























<table><thead><tr><th>类型</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td>字符串</td><td>最常用，适用于需要单位或关键字的属性（如颜色、边框、字体）</td><td><code>'red'</code>、<code>'2px solid gray'</code></td></tr><tr><td>数字</td><td>仅适用于无需单位的属性（如<code>z-index</code>、<code>opacity</code>）或需手动加单位的情况</td><td><code>30</code>（需转<code>'30px'</code>）、<code>0.5</code></td></tr><tr><td>布尔值</td><td>用于条件控制样式值（最终还是字符串）</td><td><code>isShow ? 'block' : 'none'</code></td></tr></tbody></table>
<h4 data-id="heading-6">示例：用布尔值控制显示隐藏</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div :style="{ display: isVisible ? 'block' : 'none' }"&gt;
    我是可以隐藏的文本
  &lt;/div&gt;
  &lt;button @click="isVisible = !isVisible"&gt;
    {{ isVisible ? '隐藏' : '显示' }}
  &lt;/button&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref } from 'vue'

// 布尔值控制显示状态
const isVisible = ref(true)
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-7">五、驼峰vs短横线：选哪个更顺手？</h3>
<p><code>:style</code>的对象键支持两种写法，效果完全一致：</p>




















<table><thead><tr><th>写法</th><th>示例</th><th>说明</th></tr></thead><tbody><tr><td>驼峰命名（推荐）</td><td><code>fontSize: '30px'</code></td><td>符合JavaScript对象命名习惯，无需引号</td></tr><tr><td>短横线命名</td><td><code>'font-size': '30px'</code></td><td>贴近CSS原生写法，需加引号</td></tr></tbody></table>
<p><strong>推荐用驼峰</strong>：更简洁，不用记引号，且Vue官方文档也更倾向这种写法。</p>
<details>
<summary>往期文章归档</summary>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fc85e1fe16a7ae45e965b4e2df4d9d2f4%2F" target="_blank" title="https://blog.cmdragon.cn/posts/c85e1fe16a7ae45e965b4e2df4d9d2f4/" ref="nofollow noopener noreferrer">Vue浅响应式如何解决深层响应式的性能问题？适用场景有哪些？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbe04b02d2723994632de0d4ca22a3391%2F" target="_blank" title="https://blog.cmdragon.cn/posts/be04b02d2723994632de0d4ca22a3391/" ref="nofollow noopener noreferrer">Vue 3组合式API中ref与reactive的核心响应式差异及使用最佳实践是什么？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbe04b02d2723994632de0d4ca22a3391%2F" target="_blank" title="https://blog.cmdragon.cn/posts/be04b02d2723994632de0d4ca22a3391/" ref="nofollow noopener noreferrer">Vue 3组合式API中ref与reactive的核心响应式差异及使用最佳实践是什么？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fa0af08dd60a37b9a890a9957f2cbfc9f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/a0af08dd60a37b9a890a9957f2cbfc9f/" ref="nofollow noopener noreferrer">Vue3响应式系统中，对象新增属性、数组改索引、原始值代理的问题如何解决？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbc287e1e36287afd90750fd907eca85e%2F" target="_blank" title="https://blog.cmdragon.cn/posts/bc287e1e36287afd90750fd907eca85e/" ref="nofollow noopener noreferrer">Vue 3中watch侦听器的正确使用姿势你掌握了吗？深度监听、与watchEffect的差异及常见报错解析 - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F654b9447ef1ba7ec1126a1bc26a4726d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/654b9447ef1ba7ec1126a1bc26a4726d/" ref="nofollow noopener noreferrer">Vue响应式声明的API差异、底层原理与常见陷阱你都搞懂了吗 - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F654b9447ef1ba7ec1126a1bc26a4726d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/654b9447ef1ba7ec1126a1bc26a4726d/" ref="nofollow noopener noreferrer">Vue响应式声明的API差异、底层原理与常见陷阱你都搞懂了吗 - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fc405a8d9950af5b7c63b56c348ac36b6%2F" target="_blank" title="https://blog.cmdragon.cn/posts/c405a8d9950af5b7c63b56c348ac36b6/" ref="nofollow noopener noreferrer">为什么Vue 3需要ref函数？它的响应式原理与正确用法是什么？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fa7e9abb9691a81e4404d9facabe0f7c3%2F" target="_blank" title="https://blog.cmdragon.cn/posts/a7e9abb9691a81e4404d9facabe0f7c3/" ref="nofollow noopener noreferrer">Vue 3中reactive函数如何通过Proxy实现响应式？使用时要避开哪些误区？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbd995ea45161727597fb85b62566c43d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/bd995ea45161727597fb85b62566c43d/" ref="nofollow noopener noreferrer">Vue3响应式系统的底层原理与实践要点你真的懂吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F53e3f270a80675df662c6857a3332c0f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/53e3f270a80675df662c6857a3332c0f/" ref="nofollow noopener noreferrer">Vue 3模板如何通过编译三阶段实现从声明式语法到高效渲染的跨越 - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fddbce4f2a23aa72c96b1c0473900321e%2F" target="_blank" title="https://blog.cmdragon.cn/posts/ddbce4f2a23aa72c96b1c0473900321e/" ref="nofollow noopener noreferrer">快速入门Vue模板引用：从收DOM“快递”到调子组件方法，你玩明白了吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F23a2d5a334e15575277814c16e45df50%2F" target="_blank" title="https://blog.cmdragon.cn/posts/23a2d5a334e15575277814c16e45df50/" ref="nofollow noopener noreferrer">快速入门Vue模板里的JS表达式有啥不能碰？计算属性为啥比方法更能打？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F6be38de6382e31d282659b689c5b17f0%2F" target="_blank" title="https://blog.cmdragon.cn/posts/6be38de6382e31d282659b689c5b17f0/" ref="nofollow noopener noreferrer">快速入门Vue的v-model表单绑定：语法糖、动态值、修饰符的小技巧你都掌握了吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F60ce517684f4a418f453d66aa805606c%2F" target="_blank" title="https://blog.cmdragon.cn/posts/60ce517684f4a418f453d66aa805606c/" ref="nofollow noopener noreferrer">快速入门Vue3事件处理的挑战题：v-on、修饰符、自定义事件你能通关吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fe4ae7d5e4a9205bb11b2baccb230c637%2F" target="_blank" title="https://blog.cmdragon.cn/posts/e4ae7d5e4a9205bb11b2baccb230c637/" ref="nofollow noopener noreferrer">快速入门Vue3的v-指令：数据和DOM的“翻译官”到底有多少本事？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F999ce4fb32259ff4fbf4bf7bcb851654%2F" target="_blank" title="https://blog.cmdragon.cn/posts/999ce4fb32259ff4fbf4bf7bcb851654/" ref="nofollow noopener noreferrer">快速入门Vue3，插值、动态绑定和避坑技巧你都搞懂了吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fa6997d81b49cd232b87e1cf603888ad1%2F" target="_blank" title="https://blog.cmdragon.cn/posts/a6997d81b49cd232b87e1cf603888ad1/" ref="nofollow noopener noreferrer">想让PostgreSQL快到飞起？先找健康密码还是先换引擎？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F1fee7afbb9abd4540b8aa9c141d6845d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/1fee7afbb9abd4540b8aa9c141d6845d/" ref="nofollow noopener noreferrer">想让PostgreSQL查询快到飞起？分区表、物化视图、并行查询这三招灵不灵？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F79c590fbd87ece535b11a71c9667884f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/79c590fbd87ece535b11a71c9667884f/" ref="nofollow noopener noreferrer">子查询总拖慢查询？把它变成连接就能解决？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F748cdac2536008199abf8a8a2cd0ec85%2F" target="_blank" title="https://blog.cmdragon.cn/posts/748cdac2536008199abf8a8a2cd0ec85/" ref="nofollow noopener noreferrer">PostgreSQL全表扫描慢到崩溃？建索引+改查询+更统计信息三招能破？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F32ca943703226d317d4276a8fb53b0dd%2F" target="_blank" title="https://blog.cmdragon.cn/posts/32ca943703226d317d4276a8fb53b0dd/" ref="nofollow noopener noreferrer">复杂查询总拖后腿？PostgreSQL多列索引+覆盖索引的神仙技巧你get没？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fca93f1d53aa910e7ba5ffd8df611c12b%2F" target="_blank" title="https://blog.cmdragon.cn/posts/ca93f1d53aa910e7ba5ffd8df611c12b/" ref="nofollow noopener noreferrer">只给表子集建索引？用函数结果建索引？PostgreSQL这俩操作凭啥能省空间又加速？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Ff507856ebfddd592448813c510a53669%2F" target="_blank" title="https://blog.cmdragon.cn/posts/f507856ebfddd592448813c510a53669/" ref="nofollow noopener noreferrer">B-tree索引像字典查词一样工作？那哪些数据库查询它能加速，哪些不能？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fb2213bfcb5b88a862f2138404c03d596%2F" target="_blank" title="https://blog.cmdragon.cn/posts/b2213bfcb5b88a862f2138404c03d596/" ref="nofollow noopener noreferrer">想抓PostgreSQL里的慢SQL？pg_stat_statements基础黑匣子和pg_stat_monitor时间窗，谁能帮你更准揪出性能小偷？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F26614eb7da6c476dde41d367ad888d2f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/26614eb7da6c476dde41d367ad888d2f/" ref="nofollow noopener noreferrer">PostgreSQL的“时光机”MVCC和锁机制是怎么搞定高并发的？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F69f99bc6972a860d559c74aad7280da4%2F" target="_blank" title="https://blog.cmdragon.cn/posts/69f99bc6972a860d559c74aad7280da4/" ref="nofollow noopener noreferrer">PostgreSQL性能暴涨的关键？内存IO并发参数居然要这么设置？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F7b7053f392147a8b3b1a16bebeb08d0a%2F" target="_blank" title="https://blog.cmdragon.cn/posts/7b7053f392147a8b3b1a16bebeb08d0a/" ref="nofollow noopener noreferrer">大表查询慢到翻遍整个书架？PostgreSQL分区表教你怎么“分类”才高效</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fc856e3cb073822349f3bf2d29995dcfc%2F" target="_blank" title="https://blog.cmdragon.cn/posts/c856e3cb073822349f3bf2d29995dcfc/" ref="nofollow noopener noreferrer">PostgreSQL 查询慢？是不是忘了优化 GROUP BY、ORDER BY 和窗口函数？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fc096347d18e67b7431faacd2c4757093%2F" target="_blank" title="https://blog.cmdragon.cn/posts/c096347d18e67b7431faacd2c4757093/" ref="nofollow noopener noreferrer">PostgreSQL里的子查询和CTE居然在性能上“掐架”？到底该站哪边？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F2eca89463454fd4250d7b66243b9fe5a%2F" target="_blank" title="https://blog.cmdragon.cn/posts/2eca89463454fd4250d7b66243b9fe5a/" ref="nofollow noopener noreferrer">PostgreSQL选Join策略有啥小九九？Nested Loop/Merge/Hash谁是它的菜？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F068ecb772a87d7df20a8c9fb4b233f8e%2F" target="_blank" title="https://blog.cmdragon.cn/posts/068ecb772a87d7df20a8c9fb4b233f8e/" ref="nofollow noopener noreferrer">PostgreSQL新手SQL总翻车？这7个性能陷阱你踩过没？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fd498f63cd0a2d5a77e445c688a8b88db%2F" target="_blank" title="https://blog.cmdragon.cn/posts/d498f63cd0a2d5a77e445c688a8b88db/" ref="nofollow noopener noreferrer">PostgreSQL索引选B-Tree还是GiST？“瑞士军刀”和“多面手”的差别你居然还不知道？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F9101b75bdec6faea9b35d54f14e37f36%2F" target="_blank" title="https://blog.cmdragon.cn/posts/9101b75bdec6faea9b35d54f14e37f36/" ref="nofollow noopener noreferrer">想知道数据库怎么给查询“算成本选路线”？EXPLAIN能帮你看明白？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fd527f8ebb6e3dae2c7dfe4c8d8979444%2F" target="_blank" title="https://blog.cmdragon.cn/posts/d527f8ebb6e3dae2c7dfe4c8d8979444/" ref="nofollow noopener noreferrer">PostgreSQL处理SQL居然像做蛋糕？解析到执行的4步里藏着多少查询优化的小心机？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F6bfdae84f313cf7ad0bb7045c4392347%2F" target="_blank" title="https://blog.cmdragon.cn/posts/6bfdae84f313cf7ad0bb7045c4392347/" ref="nofollow noopener noreferrer">PostgreSQL备份不是复制文件？物理vs逻辑咋选？误删还能精准恢复到1分钟前？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fde3672803de34dbad244d0a8d48b0eb5%2F" target="_blank" title="https://blog.cmdragon.cn/posts/de3672803de34dbad244d0a8d48b0eb5/" ref="nofollow noopener noreferrer">转账不翻车、并发不干扰，PostgreSQL的ACID特性到底有啥魔法？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fe463e8a2668abdf00a228c9b79324ded%2F" target="_blank" title="https://blog.cmdragon.cn/posts/e463e8a2668abdf00a228c9b79324ded/" ref="nofollow noopener noreferrer">银行转账不白扣钱、电商下单不超卖，PostgreSQL事务的诀窍是啥？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F5c967e595058c4a1fc4474a68e64031d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/5c967e595058c4a1fc4474a68e64031d/" ref="nofollow noopener noreferrer">PostgreSQL里的PL/pgSQL到底是啥？能让SQL从“说目标”变“讲步骤”？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F325047855e3e23b5ef82f7d2db134fbd%2F" target="_blank" title="https://blog.cmdragon.cn/posts/325047855e3e23b5ef82f7d2db134fbd/" ref="nofollow noopener noreferrer">PostgreSQL视图不存数据？那它怎么简化查询还能递归生成序列和控制权限？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fd2dba50bb6e4df7b27e735245a06a2a2%2F" target="_blank" title="https://blog.cmdragon.cn/posts/d2dba50bb6e4df7b27e735245a06a2a2/" ref="nofollow noopener noreferrer">PostgreSQL索引这么玩，才能让你的查询真的“飞”起来？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F849ae5bab0f8c66e94c2f6ad1bb798e3%2F" target="_blank" title="https://blog.cmdragon.cn/posts/849ae5bab0f8c66e94c2f6ad1bb798e3/" ref="nofollow noopener noreferrer">PostgreSQL的表关系和约束，咋帮你搞定用户订单不混乱、学生选课不重复？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fef4800975ffa84f1ca51976a70a1585b%2F" target="_blank" title="https://blog.cmdragon.cn/posts/ef4800975ffa84f1ca51976a70a1585b/" ref="nofollow noopener noreferrer">PostgreSQL查询的筛子、排序、聚合、分组？你会用它们搞定数据吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbf54711525c507c5eacfa7b0151c39d2%2F" target="_blank" title="https://blog.cmdragon.cn/posts/bf54711525c507c5eacfa7b0151c39d2/" ref="nofollow noopener noreferrer">PostgreSQL数据类型怎么选才高效不踩坑？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F887809b3e0375f5956873cd442f516d8%2F" target="_blank" title="https://blog.cmdragon.cn/posts/887809b3e0375f5956873cd442f516d8/" ref="nofollow noopener noreferrer">想解锁PostgreSQL查询从基础到进阶的核心知识点？你都get了吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F934be1203725e8be9d6f6e9104e5abcc%2F" target="_blank" title="https://blog.cmdragon.cn/posts/934be1203725e8be9d6f6e9104e5abcc/" ref="nofollow noopener noreferrer">PostgreSQL DELETE居然有这些操作？返回数据、连表删你试过没？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F0f0622e9b7402b599e618150d0596ffe%2F" target="_blank" title="https://blog.cmdragon.cn/posts/0f0622e9b7402b599e618150d0596ffe/" ref="nofollow noopener noreferrer">PostgreSQL UPDATE语句怎么玩？从改邮箱到批量更新的避坑技巧你都会吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F0e3bf7efc030b024ea67ee855a00f2de%2F" target="_blank" title="https://blog.cmdragon.cn/posts/0e3bf7efc030b024ea67ee855a00f2de/" ref="nofollow noopener noreferrer">PostgreSQL插入数据还在逐条敲？批量、冲突处理、返回自增ID的技巧你会吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fb6cd3c86da6aac26ed829e472d34078e%2F" target="_blank" title="https://blog.cmdragon.cn/posts/b6cd3c86da6aac26ed829e472d34078e/" ref="nofollow noopener noreferrer">PostgreSQL的“仓库-房间-货架”游戏，你能建出电商数据库和表吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fba1f545a3410144552fbdbfcf31b5265%2F" target="_blank" title="https://blog.cmdragon.cn/posts/ba1f545a3410144552fbdbfcf31b5265/" ref="nofollow noopener noreferrer">PostgreSQL 17安装总翻车？Windows/macOS/Linux避坑指南帮你搞定？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fb5474d1480509c5072085abc80b3dd9f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/b5474d1480509c5072085abc80b3dd9f/" ref="nofollow noopener noreferrer">能当关系型数据库还能玩对象特性，能拆复杂查询还能自动管库存，PostgreSQL凭什么这么香？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fcc098d8836e787baa8a4d92e4d56d5c5%2F" target="_blank" title="https://blog.cmdragon.cn/posts/cc098d8836e787baa8a4d92e4d56d5c5/" ref="nofollow noopener noreferrer">给接口加新字段又不搞崩老客户端？FastAPI的多版本API靠哪三招实现？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F46d05151c5bd31cf37a7bcf0b8f5b0b8%2F" target="_blank" title="https://blog.cmdragon.cn/posts/46d05151c5bd31cf37a7bcf0b8f5b0b8/" ref="nofollow noopener noreferrer">流量突增要搞崩FastAPI？熔断测试是怎么防系统雪崩的？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F65ce343cc5df9faf3a8e2eeaab42ae45%2F" target="_blank" title="https://blog.cmdragon.cn/posts/65ce343cc5df9faf3a8e2eeaab42ae45/" ref="nofollow noopener noreferrer">FastAPI秒杀库存总变负数？Redis分布式锁能帮你守住底线吗 - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Feed6cd8985d9be0a4b092a7da38b3e0c%2F" target="_blank" title="https://blog.cmdragon.cn/posts/eed6cd8985d9be0a4b092a7da38b3e0c/" ref="nofollow noopener noreferrer">FastAPI的CI流水线怎么自动测端点，还能让Allure报告美到犯规？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F6157d87338ce894d18c013c3c4777abb%2F" target="_blank" title="https://blog.cmdragon.cn/posts/6157d87338ce894d18c013c3c4777abb/" ref="nofollow noopener noreferrer">如何用GitHub Actions为FastAPI项目打造自动化测试流水线？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Ffc4ef84559e04693a620d0714cb30787%2F" target="_blank" title="https://blog.cmdragon.cn/posts/fc4ef84559e04693a620d0714cb30787/" ref="nofollow noopener noreferrer">如何用Git Hook和CI流水线为FastAPI项目保驾护航？ - cmdragon's Blog</a></li>
</ul>
</details>
<details>
<summary>免费好用的热门在线工具</summary>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fraid-calculator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/raid-calculator" ref="nofollow noopener noreferrer">RAID 计算器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fphotoshop-online" target="_blank" title="https://tools.cmdragon.cn/zh/apps/photoshop-online" ref="nofollow noopener noreferrer">在线PS - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fmermaid-live-editor" target="_blank" title="https://tools.cmdragon.cn/zh/apps/mermaid-live-editor" ref="nofollow noopener noreferrer">Mermaid 在线编辑器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fmath-solver-calculator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/math-solver-calculator" ref="nofollow noopener noreferrer">数学求解计算器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsmart-teleprompter" target="_blank" title="https://tools.cmdragon.cn/zh/apps/smart-teleprompter" ref="nofollow noopener noreferrer">智能提词器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fmagic-resume" target="_blank" title="https://tools.cmdragon.cn/zh/apps/magic-resume" ref="nofollow noopener noreferrer">魔法简历 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fimage-puzzle-tool" target="_blank" title="https://tools.cmdragon.cn/zh/apps/image-puzzle-tool" ref="nofollow noopener noreferrer">Image Puzzle Tool - 图片拼图工具 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsubtitle-downloader" target="_blank" title="https://tools.cmdragon.cn/zh/apps/subtitle-downloader" ref="nofollow noopener noreferrer">字幕下载工具 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Flyrics-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/lyrics-generator" ref="nofollow noopener noreferrer">歌词生成工具 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fcloud-drive-search" target="_blank" title="https://tools.cmdragon.cn/zh/apps/cloud-drive-search" ref="nofollow noopener noreferrer">网盘资源聚合搜索 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fascii-art-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/ascii-art-generator" ref="nofollow noopener noreferrer">ASCII字符画生成器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fjwt-tool" target="_blank" title="https://tools.cmdragon.cn/zh/apps/jwt-tool" ref="nofollow noopener noreferrer">JSON Web Tokens 工具 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fbcrypt-tool" target="_blank" title="https://tools.cmdragon.cn/zh/apps/bcrypt-tool" ref="nofollow noopener noreferrer">Bcrypt 密码工具 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fgif-composer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/gif-composer" ref="nofollow noopener noreferrer">GIF 合成器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fgif-decomposer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/gif-decomposer" ref="nofollow noopener noreferrer">GIF 分解器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftext-steganography" target="_blank" title="https://tools.cmdragon.cn/zh/apps/text-steganography" ref="nofollow noopener noreferrer">文本隐写术 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh" target="_blank" title="https://tools.cmdragon.cn/zh" ref="nofollow noopener noreferrer">CMDragon 在线工具 - 高级AI工具箱与开发者套件 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%3Fcategory%3Dtrending" target="_blank" title="https://tools.cmdragon.cn/zh/apps?category=trending" ref="nofollow noopener noreferrer">应用商店 - 发现1000+提升效率与开发的AI工具和实用程序 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fchangelog" target="_blank" title="https://tools.cmdragon.cn/zh/changelog" ref="nofollow noopener noreferrer">CMDragon 更新日志 - 最新更新、功能与改进 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fsponsor" target="_blank" title="https://tools.cmdragon.cn/zh/sponsor" ref="nofollow noopener noreferrer">支持我们 - 成为赞助者 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftext-to-image-ai" target="_blank" title="https://tools.cmdragon.cn/zh/apps/text-to-image-ai" ref="nofollow noopener noreferrer">AI文本生成图像 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftemp-email" target="_blank" title="https://tools.cmdragon.cn/zh/apps/temp-email" ref="nofollow noopener noreferrer">临时邮箱 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fqrcode-parser" target="_blank" title="https://tools.cmdragon.cn/zh/apps/qrcode-parser" ref="nofollow noopener noreferrer">二维码解析器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftext-to-mindmap" target="_blank" title="https://tools.cmdragon.cn/zh/apps/text-to-mindmap" ref="nofollow noopener noreferrer">文本转思维导图 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fregex-visualizer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/regex-visualizer" ref="nofollow noopener noreferrer">正则表达式可视化工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsteganography-tool" target="_blank" title="https://tools.cmdragon.cn/zh/apps/steganography-tool" ref="nofollow noopener noreferrer">文件隐写工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fiptv-explorer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/iptv-explorer" ref="nofollow noopener noreferrer">IPTV 频道探索器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsnapdrop" target="_blank" title="https://tools.cmdragon.cn/zh/apps/snapdrop" ref="nofollow noopener noreferrer">快传 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Flucky-draw" target="_blank" title="https://tools.cmdragon.cn/zh/apps/lucky-draw" ref="nofollow noopener noreferrer">随机抽奖工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fanime-scene-finder" target="_blank" title="https://tools.cmdragon.cn/zh/apps/anime-scene-finder" ref="nofollow noopener noreferrer">动漫场景查找器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftime-toolkit" target="_blank" title="https://tools.cmdragon.cn/zh/apps/time-toolkit" ref="nofollow noopener noreferrer">时间工具箱 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fspeed-test" target="_blank" title="https://tools.cmdragon.cn/zh/apps/speed-test" ref="nofollow noopener noreferrer">网速测试 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fbackground-remover" target="_blank" title="https://tools.cmdragon.cn/zh/apps/background-remover" ref="nofollow noopener noreferrer">AI 智能抠图工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fbackground-replacer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/background-replacer" ref="nofollow noopener noreferrer">背景替换工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fartistic-qrcode" target="_blank" title="https://tools.cmdragon.cn/zh/apps/artistic-qrcode" ref="nofollow noopener noreferrer">艺术二维码生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fopen-graph-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/open-graph-generator" ref="nofollow noopener noreferrer">Open Graph 元标签生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fimage-comparison" target="_blank" title="https://tools.cmdragon.cn/zh/apps/image-comparison" ref="nofollow noopener noreferrer">图像对比工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fimage-compressor" target="_blank" title="https://tools.cmdragon.cn/zh/apps/image-compressor" ref="nofollow noopener noreferrer">图片压缩专业版 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fpassword-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/password-generator" ref="nofollow noopener noreferrer">密码生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsvg-optimizer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/svg-optimizer" ref="nofollow noopener noreferrer">SVG优化器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fcolor-palette" target="_blank" title="https://tools.cmdragon.cn/zh/apps/color-palette" ref="nofollow noopener noreferrer">调色板生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fonline-metronome" target="_blank" title="https://tools.cmdragon.cn/zh/apps/online-metronome" ref="nofollow noopener noreferrer">在线节拍器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fip-geolocation" target="_blank" title="https://tools.cmdragon.cn/zh/apps/ip-geolocation" ref="nofollow noopener noreferrer">IP归属地查询 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fcss-grid-layout" target="_blank" title="https://tools.cmdragon.cn/zh/apps/css-grid-layout" ref="nofollow noopener noreferrer">CSS网格布局生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Femail-validator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/email-validator" ref="nofollow noopener noreferrer">邮箱验证工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fcalligraphy-practice" target="_blank" title="https://tools.cmdragon.cn/zh/apps/calligraphy-practice" ref="nofollow noopener noreferrer">书法练习字帖 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ffinance-calculator-suite" target="_blank" title="https://tools.cmdragon.cn/zh/apps/finance-calculator-suite" ref="nofollow noopener noreferrer">金融计算器套件 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fchinese-kinship-calculator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/chinese-kinship-calculator" ref="nofollow noopener noreferrer">中国亲戚关系计算器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fprotobuf-toolkit" target="_blank" title="https://tools.cmdragon.cn/zh/apps/protobuf-toolkit" ref="nofollow noopener noreferrer">Protocol Buffer 工具箱 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fip-geolocation" target="_blank" title="https://tools.cmdragon.cn/zh/apps/ip-geolocation" ref="nofollow noopener noreferrer">IP归属地查询 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fimage-upscaler" target="_blank" title="https://tools.cmdragon.cn/zh/apps/image-upscaler" ref="nofollow noopener noreferrer">图片无损放大 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftext-compare" target="_blank" title="https://tools.cmdragon.cn/zh/apps/text-compare" ref="nofollow noopener noreferrer">文本比较工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fip-batch-lookup" target="_blank" title="https://tools.cmdragon.cn/zh/apps/ip-batch-lookup" ref="nofollow noopener noreferrer">IP批量查询工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fdomain-finder" target="_blank" title="https://tools.cmdragon.cn/zh/apps/domain-finder" ref="nofollow noopener noreferrer">域名查询工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fdns-toolkit" target="_blank" title="https://tools.cmdragon.cn/zh/apps/dns-toolkit" ref="nofollow noopener noreferrer">DNS工具箱 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ffavicon-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/favicon-generator" ref="nofollow noopener noreferrer">网站图标生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fsitemap_index.xml" target="_blank" title="https://tools.cmdragon.cn/sitemap_index.xml" ref="nofollow noopener noreferrer">XML Sitemap</a></li>
</ul>
</details>
<h3 data-id="heading-8">六、实际案例：动态进度条</h3>
<p>我们来做一个<strong>实用的动态进度条</strong>——点击按钮增加进度，进度条的宽度和颜色随进度变化：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="progress-container"&gt;
    &lt;!-- 进度条背景 --&gt;
    &lt;div class="progress-bg"&gt;
      &lt;!-- 动态进度条：宽度=progress%，颜色随进度变化 --&gt;
      &lt;div 
        class="progress-bar"
        :style="{ 
          width: progress + '%', 
          backgroundColor: progress &gt; 50 ? '#4CAF50' : '#FF9800' 
        }"
      &gt;&lt;/div&gt;
    &lt;/div&gt;
    &lt;!-- 控制按钮 --&gt;
    &lt;button @click="addProgress" :disabled="progress &gt;= 100"&gt;
      {{ progress &gt;= 100 ? '进度已满' : '增加进度' }}
    &lt;/button&gt;
    &lt;!-- 进度显示 --&gt;
    &lt;p class="progress-text"&gt;当前进度：{{ progress }}%&lt;/p&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref } from 'vue'

// 响应式进度值：初始0%
const progress = ref(0)

// 增加进度：每次加10，最多100
const addProgress = () =&gt; {
  if (progress.value &lt; 100) {
    progress.value += 10
  }
}
&lt;/script&gt;

&lt;style scoped&gt;
.progress-container {
  margin: 20px;
  font-family: Arial, sans-serif;
}
.progress-bg {
  width: 300px;
  height: 20px;
  background-color: #f0f0f0;
  border-radius: 10px;
  overflow: hidden;
  margin-bottom: 10px;
}
.progress-bar {
  height: 100%;
  transition: width 0.3s ease; /* 平滑过渡动画 */
  border-radius: 10px;
}
button {
  padding: 8px 16px;
  background-color: #2196F3;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}
button:disabled {
  background-color: #ccc;
  cursor: not-allowed;
}
.progress-text {
  margin-top: 10px;
  font-size: 14px;
}
&lt;/style&gt;
</code></pre>
<p><strong>效果说明</strong>：</p>
<ul>
<li>进度条宽度：用<code>progress + '%'</code>动态绑定，进度从0到100时，宽度从0%到100%。</li>
<li>进度条颜色：用三元表达式<code>progress &gt; 50 ? '#4CAF50' : '#FF9800'</code>，进度超过50%变绿色，否则变橙色。</li>
<li>过渡动画：<code>transition: width 0.3s ease</code>让进度变化更平滑。</li>
</ul>
<h3 data-id="heading-9">七、课后Quiz：巩固知识点</h3>
<h4 data-id="heading-10">问题1：</h4>
<p>在Vue3中，使用<code>:style</code>对象语法时，为什么<code>fontSize</code>需要写成<code>fontSize + 'px'</code>而不是直接写<code>fontSize</code>？</p>
<p><strong>答案解析</strong>：<br/>
CSS的<code>font-size</code>属性需要<strong>单位</strong>（如<code>px</code>），而Vue不会自动为数字添加单位（除非值是<code>0</code>）。如果直接写<code>fontSize</code>（假设是<code>ref(30)</code>），模板会渲染成<code>font-size: 30</code>——这在CSS中是无效的，因此必须手动添加<code>'px'</code>变成<code>'30px'</code>。</p>
<h4 data-id="heading-11">问题2：</h4>
<p>请写出一个用<code>:style</code>对象语法绑定<strong>响应式背景色</strong>和<strong>边框</strong>的例子，要求：</p>
<ul>
<li>背景色是<code>ref('lightblue')</code>；</li>
<li>边框是<code>ref('2px solid gray')</code>。</li>
</ul>
<p><strong>答案示例</strong>：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div :style="{ backgroundColor: bgColor, border: borderStyle }"&gt;
    我是带动态样式的盒子
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref } from 'vue'

const bgColor = ref('lightblue')
const borderStyle = ref('2px solid gray')
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-12">八、常见报错与解决办法</h3>
<p>在使用<code>:style</code>时，这些错误你可能会遇到：</p>
<h4 data-id="heading-13">报错1：短横线键未加引号导致语法错误</h4>
<p><strong>错误代码</strong>：<code>{ font-size: '30px' }</code><br/>
<strong>原因</strong>：JavaScript对象的键如果包含<code>-</code>，必须用字符串引号包裹，否则会被解析成<strong>减法运算</strong>（<code>font - size</code>）。<br/>
<strong>解决</strong>：给短横线键加引号（<code>'font-size'</code>），或改用驼峰（<code>fontSize</code>）。</p>
<h4 data-id="heading-14">报错2：响应式数据变了，但样式没更新</h4>
<p><strong>错误代码</strong>：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 用let定义非响应式数据</span>
<span class="hljs-keyword">let</span> progress = <span class="hljs-number">0</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">addProgress</span> = (<span class="hljs-params"/>) =&gt; {
  progress += <span class="hljs-number">10</span> <span class="hljs-comment">// Vue无法检测变化</span>
}
</code></pre>
<p><strong>原因</strong>：<code>let</code>变量不是响应式的，Vue无法追踪其变化。<br/>
<strong>解决</strong>：用<code>ref</code>或<code>reactive</code>定义响应式数据：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> progress = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)
<span class="hljs-keyword">const</span> <span class="hljs-title function_">addProgress</span> = (<span class="hljs-params"/>) =&gt; {
  progress.<span class="hljs-property">value</span> += <span class="hljs-number">10</span> <span class="hljs-comment">// 修改响应式数据</span>
}
</code></pre>
<h4 data-id="heading-15">报错3：属性名拼写错误导致样式不生效</h4>
<p><strong>错误代码</strong>：<code>{ backgroundcolor: 'lightblue' }</code>（小写<code>C</code>）<br/>
<strong>原因</strong>：CSS属性的驼峰命名必须正确（<code>backgroundColor</code>对应<code>background-color</code>），拼写错误会导致Vue无法识别。<br/>
<strong>解决</strong>：检查属性名的大小写，或用短横线加引号（<code>'background-color'</code>）。</p>
<h3 data-id="heading-16">参考链接</h3>
<p>Vue3官方文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fvuejs.org%2Fguide%2Fessentials%2Fclass-and-style.html%23binding-inline-styles" target="_blank" title="https://vuejs.org/guide/essentials/class-and-style.html#binding-inline-styles" ref="nofollow noopener noreferrer">Class and Style Bindings - Binding Inline Styles</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue生命周期详解：从创建到销毁的全过程]]></title>    <link>https://juejin.cn/post/7583906478329020435</link>    <guid>https://juejin.cn/post/7583906478329020435</guid>    <pubDate>2025-12-15T16:09:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583906478329020435" data-draft-id="7583912899389456427" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue生命周期详解：从创建到销毁的全过程"/> <meta itemprop="keywords" content="前端,面试,Vue.js"/> <meta itemprop="datePublished" content="2025-12-15T16:09:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="进击的野人"/> <meta itemprop="url" content="https://juejin.cn/user/1458425238667008"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue生命周期详解：从创建到销毁的全过程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1458425238667008/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    进击的野人
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T16:09:59.000Z" title="Mon Dec 15 2025 16:09:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在学习 Vue 的过程中，我逐渐意识到一个问题：**为什么同样是写数据、改数据，有些代码只能写在某些地方？为什么定时器、请求、事件绑定如果位置不对，就会出 bug？**答案几乎都指向同一个核心概念——<strong>Vue 生命周期</strong>。</p>
<p>Vue 生命周期并不是抽象的“理论名词”，而是 Vue 在实例从创建到销毁的整个过程中，在<strong>关键时间点自动帮我们调用的一组函数</strong>。这些函数有固定的名字、固定的调用时机，而我们能做的，就是在合适的钩子中写合适的代码。</p>
<hr/>
<h2 data-id="heading-0">一、生命周期的本质：Vue 在“关键时刻”帮你调用函数</h2>
<p>从第一个示例可以看到，生命周期也被称为<strong>生命周期回调函数、生命周期函数或生命周期钩子</strong>。它的本质并不复杂：</p>
<blockquote>
<p>Vue 在内部流程的某些关键阶段，<strong>自动调用我们提前写好的函数</strong>1.引出生命周期</p>
</blockquote>
<p>有几个非常重要的特性需要先明确：</p>
<ul>
<li>生命周期函数的<strong>名字不能随便改</strong></li>
<li>生命周期函数内部的代码由开发者决定</li>
<li>生命周期函数中的 <code>this</code> 永远指向当前的 <strong>Vue 实例（vm）</strong></li>
</ul>
<p>也正因为 <code>this</code> 指向 vm，我们才能在生命周期中自由访问 <code>data</code>、<code>methods</code>、<code>computed</code> 等内容。</p>
<hr/>
<h2 data-id="heading-1">二、mounted：最常用、也最容易被误用的生命周期</h2>
<p>在第一个示例中，页面上有一段非常直观的动画效果：文字透明度不断降低，又循环恢复。这个效果并不是通过操作 DOM 实现的，而是通过<strong>修改响应式数据 opacity</strong> 来完成的1.引出生命周期。</p>
<p>关键代码写在了 <code>mounted()</code> 中：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
  <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">opacity</span> -= <span class="hljs-number">0.01</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">opacity</span> &lt;= <span class="hljs-number">0</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">opacity</span> = <span class="hljs-number">1</span>;
    }
  }, <span class="hljs-number">16</span>)
}
</code></pre>
<p>之所以把定时器写在 <code>mounted</code>，原因非常明确：</p>
<ul>
<li>在 <code>mounted</code> 之前，模板还没有真正渲染成 DOM</li>
<li>只有在 <code>mounted</code> 执行时，<strong>真实 DOM 已经挂载完成</strong></li>
<li>所有依赖页面结构、DOM 或视图更新的逻辑，都应该放在这里</li>
</ul>
<p>需要特别注意的是：<br/>
<strong>mounted 只会在“初次挂载”时调用一次</strong>，后续数据变化引起的重新渲染，并不会再次触发 mounted，而是走更新相关的生命周期。</p>
<hr/>
<h2 data-id="heading-2">三、为什么要学 beforeDestroy？——生命周期的“收尾阶段”</h2>
<p>第二个示例在第一个基础上进一步完善了逻辑，引出了一个非常现实的问题：<br/>
**定时器什么时候清？Vue 实例销毁后会发生什么？**1.总结生命周期</p>
<p>在这个例子中，点击“点我停止”按钮，会调用：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">this</span>.$destroy();
</code></pre>
<p>这行代码会手动销毁当前 Vue 实例，而在销毁之前，Vue 会调用 <code>beforeDestroy()</code>。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">beforeDestroy</span>(<span class="hljs-params"/>) {
  <span class="hljs-built_in">clearInterval</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">timer</span>);
}
</code></pre>
<p>这正是生命周期的<strong>收尾价值所在</strong>。</p>
<p>在实际开发中：</p>
<ul>
<li><code>mounted</code> 负责“初始化”</li>
<li><code>beforeDestroy</code> 负责“清理善后”</li>
</ul>
<p>例如：</p>
<ul>
<li>清除定时器</li>
<li>解绑自定义事件</li>
<li>取消消息订阅</li>
<li>关闭 WebSocket 连接</li>
</ul>
<p>如果不在销毁前清理这些内容，就会导致<strong>内存泄漏</strong>，甚至逻辑混乱。</p>
<p>另外，示例中还明确指出：</p>
<ul>
<li>Vue 实例销毁后，开发者工具中将不再显示该实例</li>
<li>Vue 的自定义事件会失效</li>
<li>原生 DOM 事件依然存在</li>
<li>在 <code>beforeDestroy</code> 中修改数据是没有意义的，因为更新流程已经不会再触发了1.总结生命周期</li>
</ul>
<hr/>
<h2 data-id="heading-3">四、完整生命周期流程：从 beforeCreate 到 destroyed</h2>
<p>第三个示例是对 Vue 生命周期最系统的一次演示，它几乎覆盖了所有常见的生命周期钩子，并通过 <code>console.log</code> 清晰地展示了调用顺序2.分析生命周期。</p>
<h3 data-id="heading-4">1️⃣ beforeCreate</h3>
<p>这是 Vue 实例刚被创建时调用的钩子：</p>
<ul>
<li>data 尚未初始化</li>
<li>methods 尚未初始化</li>
<li>访问 <code>this.n</code> 得到的是 <code>undefined</code></li>
</ul>
<p>这说明：<br/>
<strong>beforeCreate 几乎不适合写业务代码</strong></p>
<hr/>
<h3 data-id="heading-5">2️⃣ created</h3>
<p>在这个阶段：</p>
<ul>
<li>data 已经变成响应式数据</li>
<li>methods 已经可以正常调用</li>
<li>但 DOM 还没有生成</li>
</ul>
<p>如果你只关心数据、而不依赖页面结构，<code>created</code> 是一个可以使用的阶段。</p>
<hr/>
<h3 data-id="heading-6">3️⃣ beforeMount</h3>
<p>此时：</p>
<ul>
<li>模板已经编译完成</li>
<li>虚拟 DOM 已经生成</li>
<li>但还没有挂载到页面上</li>
</ul>
<p>打印 <code>this.$el</code> 会发现，它还不是最终呈现在页面中的 DOM。</p>
<hr/>
<h3 data-id="heading-7">4️⃣ mounted（最重要）</h3>
<p>这是生命周期中<strong>使用频率最高</strong>的一个钩子：</p>
<ul>
<li>虚拟 DOM 已转为真实 DOM</li>
<li>页面已经完成首次渲染</li>
<li><code>$el</code> 就是页面中真实存在的 DOM</li>
</ul>
<p>几乎所有涉及 DOM、视图、第三方库初始化的逻辑，都应该写在这里。</p>
<hr/>
<h3 data-id="heading-8">5️⃣ beforeUpdate / updated</h3>
<p>当数据发生变化时：</p>
<ul>
<li><code>beforeUpdate</code> 在视图更新之前触发</li>
<li><code>updated</code> 在视图更新之后触发</li>
</ul>
<p>它们常用于：</p>
<ul>
<li>调试</li>
<li>对比更新前后的状态</li>
<li>少量特殊场景下的 DOM 同步操作</li>
</ul>
<p>但在实际业务中，<strong>不建议滥用更新钩子</strong>。</p>
<hr/>
<h3 data-id="heading-9">6️⃣ beforeDestroy / destroyed</h3>
<p>这是 Vue 实例生命周期的终点：</p>
<ul>
<li><code>beforeDestroy</code>：还能访问 data 和 methods</li>
<li><code>destroyed</code>：实例已经彻底不可用</li>
</ul>
<p>一般来说，真正有价值的是 <code>beforeDestroy</code>，而 <code>destroyed</code> 很少使用。</p>
<hr/>
<h2 data-id="heading-10">五、从“记生命周期”到“会用生命周期”</h2>
<p>通过这三段代码可以清楚地看到，生命周期并不是让人死记硬背的流程图，而是一套<strong>明确解决实际问题的时间节点机制</strong>：</p>
<ul>
<li>初始化逻辑 → <code>mounted</code></li>
<li>数据准备 → <code>created</code></li>
<li>DOM 操作 → <code>mounted</code></li>
<li>更新监听 → <code>updated</code></li>
<li>清理资源 → <code>beforeDestroy</code></li>
</ul>
<p>当我真正理解这些钩子的<strong>调用时机和设计目的</strong>之后，很多之前“写着写着就出 bug”的问题，都会自然消失。</p>
<p>Vue 生命周期的学习重点，从来不是“有多少个钩子”，而是——<br/>
<strong>在对的时间，做对的事。</strong></p>
<h2 data-id="heading-11">六、总结</h2>
<p>Vue生命周期钩子为开发者提供了在特定阶段介入实例生命周期的能力。通过合理使用这些钩子，我们可以：</p>
<ul>
<li>在正确时机执行初始化操作</li>
<li>有效管理资源，防止内存泄漏</li>
<li>优化应用性能</li>
<li>更好地理解和控制应用状态</li>
</ul>
<p>掌握生命周期不仅有助于编写更健壮的Vue应用，也是深入理解Vue响应式系统工作原理的关键。建议开发者在实际项目中多实践、多观察，逐步形成对生命周期各阶段的直观感受。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Day30 | Java集合框架之Collections工具类]]></title>    <link>https://juejin.cn/post/7583943503556280370</link>    <guid>https://juejin.cn/post/7583943503556280370</guid>    <pubDate>2025-12-16T01:11:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583943503556280370" data-draft-id="7583912637471309875" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Day30 | Java集合框架之Collections工具类"/> <meta itemprop="keywords" content="后端,Java,Java EE"/> <meta itemprop="datePublished" content="2025-12-16T01:11:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="懒惰蜗牛"/> <meta itemprop="url" content="https://juejin.cn/user/615342556327752"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Day30 | Java集合框架之Collections工具类
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/615342556327752/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    懒惰蜗牛
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T01:11:57.000Z" title="Tue Dec 16 2025 01:11:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Day26~29的文章我们一起学习了Java集合框架的三大核心接口：List、Set和Map。</p>
<p>今天我们一起看一下java.util.Collections类，注意不是之前我们提到的Collection。</p>
<p>Collection接口定义了集合的是什么，多了个s的Collections是一套集合操作的工具箱。</p>
<p>Collections里提供了很多强大、方便的静态方法，能极大简化我们对集合的操作。</p>
<h2 data-id="heading-0">一、集合排序</h2>
<p>在实际开发中，对数据进行排序是最常见的需求之一。Collections.sort() 方法可以轻松地对任何List集合进行排序。</p>
<h3 data-id="heading-1">1.1自然排序</h3>
<p>如果List里的元素实现了Comparable接口（如Integer, String 等），sort方法会按照它们的自然顺序进行排序。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f5bcd28af23a415dba43b89555c3509d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oeS5oOw6JyX54mb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766452317&amp;x-signature=KKQspnKSwENDYBmxrUsiciwvqDc%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c0a581789f945159e134a5b6555f640~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oeS5oOw6JyX54mb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766452317&amp;x-signature=R9xRQ7y90LjLq3ul1nOuWrHEIvc%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.lazy.snail.day30;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.Collections;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@ClassName</span> Day30Demo
 * <span class="hljs-doctag">@Description</span> TODO
 * <span class="hljs-doctag">@Author</span> lazysnail
 * <span class="hljs-doctag">@Date</span> 2025/7/7 15:13
 * <span class="hljs-doctag">@Version</span> 1.0
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Day30Demo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        List&lt;Integer&gt; numbers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        numbers.add(<span class="hljs-number">5</span>);
        numbers.add(<span class="hljs-number">1</span>);
        numbers.add(<span class="hljs-number">9</span>);
        numbers.add(<span class="hljs-number">3</span>);

        System.out.println(<span class="hljs-string">"排序前: "</span> + numbers);
        Collections.sort(numbers);
        System.out.println(<span class="hljs-string">"排序后: "</span> + numbers);
    }
}
</code></pre>
<p>案例中使用了Collections的sort方法，使用对象的自然排序对list进行排序。</p>
<h3 data-id="heading-2">1.2自定义排序</h3>
<p>如果我们要对自定义对象（如Student）进行排序，sort方法还有一个接受Comparator(比较器)的版本，让我们可以随心所欲地定义排序规则。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.lazy.snail.day30;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.Collections;
<span class="hljs-keyword">import</span> java.util.Comparator;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@ClassName</span> Day30Demo2
 * <span class="hljs-doctag">@Description</span> TODO
 * <span class="hljs-doctag">@Author</span> lazysnail
 * <span class="hljs-doctag">@Date</span> 2025/7/7 15:21
 * <span class="hljs-doctag">@Version</span> 1.0
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Day30Demo2</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        List&lt;Student&gt; students = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        students.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">"懒惰蜗牛"</span>, <span class="hljs-number">28</span>));
        students.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">"lazysnail"</span>, <span class="hljs-number">29</span>));

        <span class="hljs-comment">// 匿名内部类写法</span>
        Collections.sort(students, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Comparator</span>&lt;Student&gt;() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">compare</span><span class="hljs-params">(Student o1, Student o2)</span> {
                <span class="hljs-keyword">return</span> o1.age - o2.age;
            }
        });

        <span class="hljs-comment">// Lambda表达式</span>
        Collections.sort(students, (o1, o2) -&gt; o1.age - o2.age);

        <span class="hljs-comment">// Comparator工具方法</span>
        Collections.sort(students, Comparator.comparingInt(o -&gt; o.age));
        
        System.out.println(<span class="hljs-string">"按年龄排序后: "</span> + students);
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> {
    String name;
    <span class="hljs-type">int</span> age;
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> { <span class="hljs-built_in">this</span>.name = name; <span class="hljs-built_in">this</span>.age = age; }
    <span class="hljs-meta">@Override</span> <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> name + <span class="hljs-string">":"</span> + age; }
}
</code></pre>
<p>上面的案例中Comparator的创建使用了三种写法：</p>
<p>Java8之前传统写法，使用匿名内部类实现Comparator接口。</p>
<p>Java8+的Lambda表达式，这个其实是匿名内部类的语法糖。</p>
<p>Comparator接口是一个函数式接口（只有一个抽象方法），所以可以用Lambda替代。</p>
<p>Comparator.comparingInt()是Comparator提供的静态工厂方法，专门用来对int类型字段的比较。</p>
<p>内部封装了compare的逻辑。</p>
<p>其实自Java8之后，List接口自身提供了一个sort()方法。可以直接在列表对象上调用方法。</p>
<pre><code class="hljs language-ini" lang="ini">students.sort((o1, o2) -&gt; o1.age - o2.age)<span class="hljs-comment">;</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a95e0811d10741b695bfa6fa169dc691~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oeS5oOw6JyX54mb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766452317&amp;x-signature=lRn1q%2B3XPWrhas94uBHDGqP%2BfDA%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>在<a href="https://juejin.cn/post/7582425536464863258" target="_blank" title="https://juejin.cn/post/7582425536464863258">Day28 | Java集合框架之Set接口详解</a>中的TreeSet讲解中讲到了自然排序和自定义排序，可以回顾下。</p>
</blockquote>
<h2 data-id="heading-3">二、查找</h2>
<p>对于一个已经排好序的List，binarySearch方法使用二分查找算法，效率要高于遍历。</p>
<blockquote>
<p>使用binarySearch之前，列表必须是有序的！否则，结果就不是你想要的。</p>
</blockquote>
<h3 data-id="heading-4">效率</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.lazy.snail.day30;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.Collections;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@ClassName</span> Day30Demo3
 * <span class="hljs-doctag">@Description</span> TODO
 * <span class="hljs-doctag">@Author</span> lazysnail
 * <span class="hljs-doctag">@Date</span> 2025/7/7 15:52
 * <span class="hljs-doctag">@Version</span> 1.0
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Day30Demo3</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        List&lt;Integer&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1_000_000</span>; i++) {
            list.add(i);
        }

        <span class="hljs-type">int</span> <span class="hljs-variable">target</span> <span class="hljs-operator">=</span> <span class="hljs-number">987654</span>;

        <span class="hljs-comment">// 遍历</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">start1</span> <span class="hljs-operator">=</span> System.nanoTime();
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; list.size(); i++) {
            <span class="hljs-keyword">if</span> (list.get(i) == target) {
                <span class="hljs-keyword">break</span>;
            }
        }
        <span class="hljs-type">long</span> <span class="hljs-variable">end1</span> <span class="hljs-operator">=</span> System.nanoTime();
        System.out.println(<span class="hljs-string">"遍历查找耗时: "</span> + (end1 - start1) / <span class="hljs-number">1_000_000.0</span> + <span class="hljs-string">" ms"</span>);

        <span class="hljs-comment">// binarySearch</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">start2</span> <span class="hljs-operator">=</span> System.nanoTime();
        Collections.binarySearch(list, target);
        <span class="hljs-type">long</span> <span class="hljs-variable">end2</span> <span class="hljs-operator">=</span> System.nanoTime();
        System.out.println(<span class="hljs-string">"binarySearch查找耗时: "</span> + (end2 - start2) / <span class="hljs-number">1_000_000.0</span> + <span class="hljs-string">" ms"</span>);
    }
}
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c4e549668a45483ab8366dccc91c1bb7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oeS5oOw6JyX54mb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766452317&amp;x-signature=5FVAEMFJ6HjSl4csM7TcgzHEuxg%3D" alt="" loading="lazy"/></p>
<p>从运行的结果看，二分查找的效率比普通遍历的效率高得多。</p>
<p>二分查找这种算法，每次都能排除掉一半的数据。相较于普通遍历的线性搜素。</p>
<p>在数据量很多的情况下，二分查找的时间复杂度要远远低于普通遍历。</p>
<h3 data-id="heading-5">未排序使用binarySearch</h3>
<p>如果对没有排序的列表进行二分查找，结果就是找不到数据。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.lazy.snail.day30;

<span class="hljs-keyword">import</span> java.util.Arrays;
<span class="hljs-keyword">import</span> java.util.Collections;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@ClassName</span> Day30Demo4
 * <span class="hljs-doctag">@Description</span> TODO
 * <span class="hljs-doctag">@Author</span> lazysnail
 * <span class="hljs-doctag">@Date</span> 2025/7/7 16:08
 * <span class="hljs-doctag">@Version</span> 1.0
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Day30Demo4</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        List&lt;Integer&gt; list = Arrays.asList(<span class="hljs-number">50</span>, <span class="hljs-number">20</span>, <span class="hljs-number">40</span>, <span class="hljs-number">10</span>, <span class="hljs-number">30</span>);

        System.out.println(<span class="hljs-string">"列表内容: "</span> + list);

        <span class="hljs-comment">// 想查找元素 30</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> Collections.binarySearch(list, <span class="hljs-number">30</span>);

        System.out.println(<span class="hljs-string">"binarySearch 查找结果索引: "</span> + index);

    }
}
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/deadb0ff1de141d7affa04ab5ff397d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oeS5oOw6JyX54mb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766452317&amp;x-signature=oNQtl087t9qV2GcLSe8pvqH%2BSEo%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">三、线程安全转换</h2>
<p>我们经常用的ArrayList、HashMap等都是非线程安全的。</p>
<p>在多线程环境中并发修改，可能会导致数据错乱。</p>
<p>Collections提供了一系列synchronizedXXX() 方法，可以把它们包装成线程安全的集合。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b3abc9a4b9db4efd8b3004e06ef7750a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oeS5oOw6JyX54mb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766452317&amp;x-signature=spG4chXEl49DrU9Ngua65y%2Fkq%2Fk%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.lazy.snail.day30;

<span class="hljs-keyword">import</span> java.util.*;

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@ClassName</span> Day30Demo5
 * <span class="hljs-doctag">@Description</span> TODO
 * <span class="hljs-doctag">@Author</span> lazysnail
 * <span class="hljs-doctag">@Date</span> 2025/7/7 16:26
 * <span class="hljs-doctag">@Version</span> 1.0
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Day30Demo5</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        List&lt;String&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

        List&lt;String&gt; safeList = Collections.synchronizedList(list);

        safeList.add(<span class="hljs-string">"懒惰蜗牛"</span>);

        <span class="hljs-comment">//Set&lt;T&gt; safeSet = Collections.synchronizedSet(new HashSet&lt;&gt;());</span>
        <span class="hljs-comment">//Map&lt;K, V&gt; safeMap = Collections.synchronizedMap(new HashMap&lt;&gt;());</span>
    }
}
</code></pre>
<p>list是线程不安全的ArrayList，通过Collections中的synchronizedList方法。</p>
<p>将普通的ArrayList封装成了线程安全的List。之后对list的操作就是安全的。</p>
<p>set、map同样有对应的方法将不安全的集合封装成线程安全的集合。</p>
<blockquote>
<p>需要注意的是：这个操作只保证了单个方法（如add, get）是原子的。对于复合操作（比如“检查是否存在，如果不存在则添加”），仍然需要自己使用synchronized关键字来保证整个操作的原子性。</p>
</blockquote>
<h2 data-id="heading-7">四、创建不可变和空集合</h2>
<h3 data-id="heading-8">不可变</h3>
<p>有时候，我们想创建一个不可变的集合，这个集合不让修改。就可以用Collections中的unmodifiableXXX()方法创建只读的集合。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e76d38813494a7392f285ddff19fd96~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oeS5oOw6JyX54mb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766452317&amp;x-signature=tm5qZWARW3Qmm9o355MMezdrU1s%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.lazy.snail.day30;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.Collections;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@ClassName</span> Day30Demo6
 * <span class="hljs-doctag">@Description</span> TODO
 * <span class="hljs-doctag">@Author</span> lazysnail
 * <span class="hljs-doctag">@Date</span> 2025/7/7 16:56
 * <span class="hljs-doctag">@Version</span> 1.0
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Day30Demo6</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        List&lt;String&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        list.add(<span class="hljs-string">"懒惰蜗牛"</span>);
        List&lt;String&gt; unmodifiableList = Collections.unmodifiableList(list);

        <span class="hljs-comment">//unmodifiableList.add("lazysnail");</span>
        unmodifiableList.remove(<span class="hljs-string">"懒惰蜗牛"</span>);
    }
}
</code></pre>
<p>如果想对这样的集合进行add或remove等操作，就会抛出UnsupportedOperationException异常。</p>
<p>从Java9开始，List, Set, Map接口自身提供了更方便的静态of()方法来直接创建真正的不可变集合。</p>
<p>这种方式在实际开发中更加常见。</p>
<p>为什么说是真正的不可变呐。回看上面的案例，稍作一下修改：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.lazy.snail.day30;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.Collections;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@ClassName</span> Day30Demo6
 * <span class="hljs-doctag">@Description</span> TODO
 * <span class="hljs-doctag">@Author</span> lazysnail
 * <span class="hljs-doctag">@Date</span> 2025/7/7 16:56
 * <span class="hljs-doctag">@Version</span> 1.0
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Day30Demo6</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        List&lt;String&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        list.add(<span class="hljs-string">"懒惰蜗牛"</span>);
        List&lt;String&gt; unmodifiableList = Collections.unmodifiableList(list);

        System.out.println(<span class="hljs-string">"原集合修改前的unmodifiableList:"</span> + unmodifiableList);

        list.add(<span class="hljs-string">"lazysnail"</span>);

        System.out.println(<span class="hljs-string">"原集合修改后的unmodifiableList:"</span> + unmodifiableList);
    }
}
</code></pre>
<p>可以看出，unmodifiableList并没有改变原集合的可变性，只是加了一层只读外壳。</p>
<p>如果原集合一旦被外部引用持有，仍然可以修改。</p>
<p>而List.of(...) 是真正的不可变对象，内部结构不允许任何修改操作。</p>
<p>所有变更操作（add、remove、set）都会直接抛UnsupportedOperationException。</p>
<pre><code class="hljs language-java" lang="java">List&lt;String&gt; list1 = List.of(<span class="hljs-string">"懒惰蜗牛"</span>);
list1.add(<span class="hljs-string">"lazysnail"</span>);
</code></pre>
<p>"list1.add("lazysnail");"就会抛出UnsupportedOperationException。</p>
<h3 data-id="heading-9">空集合</h3>
<p>很多返回集合的方法，如果直接返回null，保不准什么时候就会报空指针异常。</p>
<p>实际开发的时候，最好还是返回一个空集合。</p>
<p>Collections的emptyList(), emptySet(), emptyMap()就派上了用场。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.lazy.snail.day30;

<span class="hljs-keyword">import</span> java.util.Collections;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@ClassName</span> Day30Demo7
 * <span class="hljs-doctag">@Description</span> TODO
 * <span class="hljs-doctag">@Author</span> lazysnail
 * <span class="hljs-doctag">@Date</span> 2025/7/7 17:14
 * <span class="hljs-doctag">@Version</span> 1.0
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Day30Demo7</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List&lt;String&gt; <span class="hljs-title function_">findUsers</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-comment">// if 找到</span>

        <span class="hljs-comment">// else</span>
        <span class="hljs-keyword">return</span> Collections.emptyList();
    }
}
</code></pre>
<p>可能你会说，为什么不直接return的时候直接new ArrayList&lt;&gt;()。</p>
<p>每次return的时候，都去new一个对象，还是有开销的，能省则省。</p>
<p>Collections的emptyList()返回的是一个不可变的、线程安全的、可被序列化的空集合。</p>
<p>每次返回的都是同一个静态实例。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c72d9ae779684a6c9fc2e2c248eed418~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oeS5oOw6JyX54mb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766452317&amp;x-signature=KJt8053qJlwu8QUJKfy2tRkQF2w%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-10">五、其他</h2>
<p>Collections中还有很多其他的小工具：</p>
<p>reverse(List&lt;?&gt; list): 反转List中元素的顺序。</p>
<p>shuffle(List&lt;?&gt; list): 随机打乱List中元素的顺序。</p>
<p>max(Collection coll) / min(Collection coll): 找到集合中的最大/最小元素。</p>
<p>fill(List&lt;?&gt; list, T obj): 用指定元素替换List中的所有元素。</p>
<p>更多的方法参见API文档：</p>
<p>Collections (Java SE 17 &amp; JDK 17)docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Collections.html</p>
<h2 data-id="heading-11">结语</h2>
<p>Collections中有非常多关于集合的操作工具。</p>
<p>今天我们只是一起看了一下排序、查找、线程安全、创建不可变集合等常见的功能。</p>
<p>这些工具都能够在实际开发中帮我们让代码更加简洁，让集合操作更加便捷高效。</p>
<p>Collections里的方法不需要取死记硬背，在写代码的时候，如果涉及操作集合，</p>
<p>可以翻看一下API文档，如果有合适的工具，使用即可。</p>
<p>下一篇预告</p>
<blockquote>
<p>Day31 | Lambda表达式与函数式接口</p>
</blockquote>
<p>如果你觉得这系列文章对你有帮助，欢迎关注专栏，我们一起坚持下去！</p>
<p><strong>更多文章请关注我的公众号《懒惰蜗牛工坊》</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>